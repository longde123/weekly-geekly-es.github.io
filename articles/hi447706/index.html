<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯХУ ЁЯРТ ЁЯМ▒ рдПрдХ рднреА рдУрдЖрд░рдПрдо рдирд╣реАрдВ ЁЯУп ЁЯЫМ тЩУя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдПрдХ рднреА рдУрдЖрд░рдПрдо рдирд╣реАрдВ 


 рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░! рдореИрдВ Ostrovok.ru рд╣реЛрдЯрд▓ рдЖрд░рдХреНрд╖рдг рд╕реЗрд╡рд╛ рдХреЗ рднрд╛рдЧреАрджрд╛рд░ рд╡рд┐рдХрд╛рд╕ рд╡рд┐рднрд╛рдЧ рдХрд╛ рдкреНрд░рднрд╛рд░реА рд╣реВрдВред рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдХ рднреА рдУрдЖрд░рдПрдо рдирд╣реАрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/447706/"><h1 id="ne-ormom-edinym">  рдПрдХ рднреА рдУрдЖрд░рдПрдо рдирд╣реАрдВ </h1><br><p>  рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░!  рдореИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Ostrovok.ru</a> рд╣реЛрдЯрд▓ рдЖрд░рдХреНрд╖рдг рд╕реЗрд╡рд╛ рдХреЗ рднрд╛рдЧреАрджрд╛рд░ рд╡рд┐рдХрд╛рд╕ рд╡рд┐рднрд╛рдЧ рдХрд╛ рдкреНрд░рднрд╛рд░реА рд╣реВрдВред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ рдХрд┐ рдХреИрд╕реЗ рд╣рдордиреЗ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Django ORM рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдореИрдВ рдзреЛрдЦрд╛ рджреЗ рд░рд╣рд╛ рдерд╛, рдирд╛рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдерд╛ " <del>  рдирд╣реАрдВ </del>  ORM рдПрдХрд▓ "ред рдпрджрд┐ рдЖрдк рд╕реЛрдЪ рд░рд╣реЗ рд╣реИрдВ рдХрд┐ рдореИрдВрдиреЗ рдпрд╣ рдХреНрдпреЛрдВ рд▓рд┐рдЦрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд╕рд╛рде: </p><br><ul><li> рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕реНрдЯреИрдХ рдкрд░ Django рд╣реИ, рдФрд░ рдЖрдк ORM рд╕реЗ рдЕрдзрд┐рдХрддрдо <code>Model.objects.all()</code> , рди рдХрд┐ рдХреЗрд╡рд▓ <code>Model.objects.all()</code> , </li><li>  рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реНрддрд░ рдкрд░ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, </li><li>  рдпрд╛ рдХреНрдпрд╛ рдЖрдк рдпрд╣ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ B2B.Ostrovok.ru рдкрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд▓рдЧрд╛рддрд╛рд░ рдмрд╣рд╛рдирд╛ <em>"рдЗрддрдирд╛ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ" рдХреНрдпреЛрдВ рд╣реИ</em> , </li></ul><br><p>  ... рдмрд┐рд▓реНрд▓реА рдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/66b/308/b1c/66b308b1cd5afefead46ef7bffdbbddf.jpg" alt="kdpv"></p><a name="habracut"></a><br><p>  2014 рдореЗрдВ, рд╣рдордиреЗ B2B.Ostrovok.ru рд╢реБрд░реВ рдХрд┐рдпрд╛ - рдкрд░реНрдпрдЯрди рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдкреЗрд╢реЗрд╡рд░реЛрдВ (рдЯреНрд░реИрд╡рд▓ рдПрдЬреЗрдВрдЯреЛрдВ, рдСрдкрд░реЗрдЯрд░реЛрдВ рдФрд░ рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдЧреНрд░рд╛рд╣рдХреЛрдВ) рдХреЗ рд▓рд┐рдП рд╣реЛрдЯрд▓, рд╕реНрдерд╛рдирд╛рдиреНрддрд░рдг, рдХрд╛рд░реЛрдВ рдФрд░ рдЕрдиреНрдп рдпрд╛рддреНрд░рд╛ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдСрдирд▓рд╛рдЗрди рдмреБрдХрд┐рдВрдЧ рд╕реЗрд╡рд╛ред </p><br><p>  B2B рдореЗрдВ, рд╣рдордиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>GenericForeignKey</code></a> - рдореЗрдЯрд╛ рдСрд░реНрдбрд░ - <code>MetaOrder</code> рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдЕрдореВрд░реНрдд рдСрд░реНрдбрд░ рдореЙрдбрд▓ рдХрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдФрд░ рдХрд╛рдлреА рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред </p><br><p>  рдПрдХ рдореЗрдЯрд╛ рдСрд░реНрдбрд░ рдПрдХ рдЕрдореВрд░реНрдд рдЗрдХрд╛рдИ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрджреЗрд╢ рд╕реЗ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рд╣реЛрдЯрд▓ ( <code>Hotel</code> ), рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЗрд╡рд╛ ( <code>Upsell</code> ) рдпрд╛ рдХрд╛рд░ ( <code>Car</code> )ред  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╣рдореЗрд╢рд╛ рд╕реЗ рдРрд╕рд╛ рдирд╣реАрдВ рд░рд╣рд╛ рд╣реИред  рдЬрдм рдмреА 2 рдмреА рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХреА рдЧрдИ рдереА, рддреЛ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЗрд╡рд▓ рд╣реЛрдЯрд▓ рдмреБрдХ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рдереЗ, рдФрд░ рд╕рднреА рд╡реНрдпрд╛рдкрд╛рд░рд┐рдХ рддрд░реНрдХ рдЙрди рдкрд░ рдХреЗрдВрджреНрд░рд┐рдд рдереЗред  рдХрдИ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдмрд┐рдХреНрд░реА рд░рд╛рд╢рд┐ рдФрд░ рдЖрд░рдХреНрд╖рдг рд╡рд╛рдкрд╕реА рд░рд╛рд╢рд┐ рдХреА рд╡рд┐рдирд┐рдордп рджрд░реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рд╕рдордп рдХреЗ рд╕рд╛рде, рд╣рдордиреЗ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдХрд┐ рдореЗрдЯрд╛-рдСрд░реНрдбрд░ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП рдЗрд╕ рдбреЗрдЯрд╛ рдХреЛ рдХреИрд╕реЗ рд╕реНрдЯреЛрд░ рдФрд░ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдкреВрд░реЗ рдХреЛрдб рдХреЛ рджреЛрдмрд╛рд░рд╛ рдирд╣реАрдВ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрд╛ рдФрд░ рдЗрд╕ рдзрд░реЛрд╣рд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирдИ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдореЗрдВ рдЖ рдЧрдпрд╛ред  рджрд░рдЕрд╕рд▓, рдЗрд╕рд╕реЗ рдЧрдгрдирд╛ рдореЗрдВ рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛, рдЬреЛ рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрджреЗрд╢реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдХреНрдпрд╛ рдХрд░реЗрдВ - рддреЛ <em>рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ</em> ... </p><br><p>  рдореЗрд░рд╛ рд▓рдХреНрд╖реНрдп рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ Django ORM рдХреА рд╢рдХреНрддрд┐ рджрд┐рдЦрд╛рдирд╛ рд╣реИред </p><br><h2 id="predystoriya">  рдкреНрд░рд╛рдЧрд┐рддрд┐рд╣рд╛рд╕ </h2><br><p>  рдЕрдкрдиреЗ рдЦрд░реНрдЪреЛрдВ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдмреА 2 рдмреА рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рдмрд╛рдд рдХреА рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рдереА рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЕрдм / рдХрд▓ / рдмрд╛рдж рдореЗрдВ рдХрд┐рддрдирд╛ рднреБрдЧрддрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпрд╛ рдЙрдирдХреЗ рдкрд╛рд╕ рдСрд░реНрдбрд░ рдкрд░ рдХрд░реНрдЬ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░ рдХреНрдпрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд╕рд╛рде рд╡реЗ рдЕрдкрдиреА рд╕реАрдорд╛ рдХреЗ рднреАрддрд░ рдХрд┐рддрдирд╛ рдЦрд░реНрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдордиреЗ рдбреИрд╢рдмреЛрд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ - рдПрдХ рд╕реНрдкрд╖реНрдЯ рдЖрд░реЗрдЦ рдХреЗ рд╕рд╛рде рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╕реЙрдХреЗрдЯред </p><br><p><img src="https://habrastorage.org/webt/2a/rj/yo/2arjyoaa9_xfe8ddcaz5qn4w5mu.gif" alt="dash1"><br>  <em>(рд╕рднреА рдорд╛рди рдкрд░реАрдХреНрд╖рдг рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рднрд╛рдЧреАрджрд╛рд░ рдкрд░ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ)</em> </p><br><p>  рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ, рд╕рдм рдХреБрдЫ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ - рд╣рдо рд╕рд╛рдереА рдХреЗ рд╕рднреА рдЖрджреЗрд╢реЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рддреЗ рд╣реИрдВ, рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВред </p><br><h2 id="varianty-resheniya">  рд╕рдорд╛рдзрд╛рди рдХреЗ рд╡рд┐рдХрд▓реНрдк </h2><br><p>  рд╣рдо рдЧрдгрдирд╛ рдХреИрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕ рдкрд░ рдереЛрдбрд╝рд╛ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдгред  рд╣рдо рдПрдХ рдЕрдВрддрд░рд░рд╛рд╖реНрдЯреНрд░реАрдп рдХрдВрдкрдиреА рд╣реИрдВ, рд╡рд┐рднрд┐рдиреНрди рджреЗрд╢реЛрдВ рдХреЗ рд╣рдорд╛рд░реЗ рд╕рд╛рдЭреЗрджрд╛рд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдореБрджреНрд░рд╛рдУрдВ рдореЗрдВ рдкрд░рд┐рдЪрд╛рд▓рди - рдЦрд░реАрдж рдФрд░ рдлрд┐рд░ рд╕реЗ рдмреЗрдЪрдирд╛ рдЖрд░рдХреНрд╖рдг рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреА рдЪреБрдиреА рд╣реБрдИ рдореБрджреНрд░рд╛ (рдЖрдорддреМрд░ рдкрд░ рд╕реНрдерд╛рдиреАрдп) рдореЗрдВ рд╡рд┐рддреНрддреАрдп рд╡рд┐рд╡рд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗред  рдпрд╣ рд╕рднреА рдореБрджреНрд░рд╛рдУрдВ рдХреА рджрд░реЛрдВ рдкрд░ рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд░реНрдЦрддрд╛рдкреВрд░реНрдг рдФрд░ рдЕрд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рд╕рдВрджрд░реНрдн рдореБрджреНрд░рд╛ рдЪреБрдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд░реВрдмрд▓ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЖрдк рд╕рднреА рдореБрджреНрд░рд╛рдУрдВ рдХреА рджрд░реЛрдВ рдХреЛ рдХреЗрд╡рд▓ рд░реВрдмрд▓ рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рддрджрдиреБрд╕рд╛рд░, рдЬрдм рдПрдХ рд╕рд╛рдереА рдПрдХ рд╕рд╛рд░рд╛рдВрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рддреЛ рд╣рдо рдмрд┐рдХреНрд░реА рдХреЗ рд╕рдордп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рджрд░ рдкрд░ рдорд╛рддреНрд░рд╛рдУрдВ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </p><br><h3 id="v-lob">  "рдорд╛рдереЗ рдореЗрдВ" </h3><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ <code>Model.objects.all()</code> рдФрд░ рд╕реНрдерд┐рддрд┐рдпрд╛рдВ рд▓реВрдк рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд╢рд░реНрддреЛрдВ рдХреЗ рд╕рд╛рде Model.objects.all ()</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(partner_id)</span></span></span><span class="hljs-function">:</span></span> today = dt.date.today() <span class="hljs-comment"><span class="hljs-comment"># query_get_one -    partner = query_get_one(Partner.objects.filter(id=partner_id)) #    -  query = MetaOrder.objects.filter(partner=partner) result = defaultdict(Decimal) for morder in query: #  ,     #     payment_pending = morder.get_payment_pending() payment_due = morder.get_payment_due() #        # (     ) payable = morder.get_payable_in_cur() #       if payment_pending &gt; today: result['payment_pending'] += payable # ,     if payment_pending &lt; today and payment_due &gt; today: result['payment_due'] += payable return result</span></span></code> </pre> </div></div><br><p>  рдпрд╣ рдХреНрд╡реЗрд░реА рдПрдХ рдЬрдирд░реЗрдЯрд░ рд▓реМрдЯрд╛рдПрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдХрдИ рд╕реМ рдмреБрдХрд┐рдВрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдмреБрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЪрдХреНрд░ рдмрд╣реБрдд рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред </p><br><p>  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>prefetch_related</code></a> рд╡рд┐рдзрд┐ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЪреАрдЬрд╝реЛрдВ рдХреЛ рдереЛрдбрд╝рд╛ рддреЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># object -      GenericForeignKey. query = query.prefetch_related('object')</span></span></code> </pre> <br><p>  рддрдм рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝реЗ рдХрдо рдЕрдиреБрд░реЛрдз рд╣реЛрдВрдЧреЗ ( <code>GenericForeignKey</code> рдкрд░ <code>GenericForeignKey</code> ), рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА, рдЕрдВрдд рдореЗрдВ, рд╣рдо рдЙрдирдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рд░реЛрдХ рджреЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЪрдХреНрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдкрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдЕрднреА рднреА рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  <code>output</code> рд╡рд┐рдзрд┐ (рдФрд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП) рдХреЛ рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдкрд╣рд▓реА рдХреЙрд▓ рдПрдХ рдорд┐рдирдЯ рдХреЗ рдЖрджреЗрд╢ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреА рд╣реИ, рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИред </p><br><p>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/yz/ur/wq/yzurwquhxoeqczgncqi66je8570.png" alt="timing_before"></p><br><p>  рдФрд╕рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп 4 рд╕реЗрдХрдВрдб рд╣реИ, рдФрд░ 21 рд╕реЗрдХрдВрдб рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реА рдЪреЛрдЯрд┐рдпрд╛рдВ рд╣реИрдВред  рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╕рдордп рд╣реИред </p><br><p>  рд╣рдордиреЗ рд╕рднреА рднрд╛рдЧреАрджрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдбреИрд╢рдмреЛрд░реНрдб рдХреЛ рд░реЛрд▓ рдЖрдЙрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХрдИ рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рдХрд┐рдП рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдордЭрдирд╛ рдЕрднреА рднреА рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдХрд┐ рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкреНрд░рднрд╛рд╡реА рдирд╣реАрдВ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/f0/rz/yn/f0rzynfsqypr3z0mh1cnwoi6ee0.png" alt="count_before"><br>  <em>рдиреАрдЪреЗ рджрд╛рдИрдВ рдУрд░ рдХреА рд╕рдВрдЦреНрдпрд╛рдПрдБ рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИрдВ: рдиреНрдпреВрдирддрдо, рдЕрдзрд┐рдХрддрдо, рдФрд╕рдд, рдХреБрд▓ред</em> </p><br><h3 id="s-umom">  рдорди рдХреЗ рд╕рд╛рде </h3><br><p>  рдорд╛рдереЗ рдХрд╛ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдХрд╛рд░реНрдп рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЗрд╖реНрдЯрддрдо рдирд╣реАрдВ рдерд╛ред  рд╣рдордиреЗ рддрдп рдХрд┐рдпрд╛ рдХрд┐ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрдИ рд╕рд░рд▓ рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрдИ рдЬрдЯрд┐рд▓ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рддреЗрдЬрд╝ рдФрд░ рдХрдо рд╕рдВрд╕рд╛рдзрди-рдЧрд╣рди рд╣реЛрдЧрд╛ред </p><br><h4 id="plan-zaprosa">  рдЕрдиреБрд░реЛрдз рдпреЛрдЬрдирд╛ </h4><br><p>  рдХреНрд╡реЗрд░реА рдкреНрд▓рд╛рди рдХреЗ рд╡рд┐рд╕реНрддреГрдд рд╕реНрдЯреНрд░реЛрдХ рдЗрд╕ рддрд░рд╣ рд╡рд░реНрдгрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><ul><li>  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╢рд░реНрддреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЖрджреЗрд╢ рдПрдХрддреНрд░ рдХрд░реЗрдВ, </li><li>  <code>annotate</code> рдорд╛рдзреНрдпрдо рд╕реЗ рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдлрд╝реАрд▓реНрдб рддреИрдпрд╛рд░ рдХрд░реЗрдВ, </li><li>  рдлрд╝реАрд▓реНрдб рдорд╛рдиреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ </li><li>  рд░рд╛рд╢рд┐ рдФрд░ рдорд╛рддреНрд░рд╛ рдХреЗ <code>aggregate</code> рд╕реЗ <code>aggregate</code> рдмрдирд╛рдПрдВ </li></ul><br><h4 id="nachalnye-usloviya">  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╢рд░реНрддреЗрдВ </h4><br><p>  рд╕рд╛рдЗрдЯ рдкрд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рд╛рдереА рдЕрдкрдиреЗ рдЕрдиреБрдмрдВрдз рдкрд░ рдХреЗрд╡рд▓ рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs">partner = query_get_one(Partner.objects.filter(id=partner_id))</code> </pre> <br><p>  рдпрджрд┐ рд╣рдо рдирдП рдкреНрд░рдХрд╛рд░ рдХреЗ рдСрд░реНрдбрд░ / рдмреБрдХрд┐рдВрдЧ рджрд┐рдЦрд╛рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдХреЗрд╡рд▓ рд╕рдорд░реНрдерд┐рдд рд▓реЛрдЧреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="python hljs">query = MetaOrder.objects.filter( partner=partner, content_type__in=[ Hotel.get_content_type(), Car.get_content_type(), Upsell.get_content_type(), ] )</code> </pre> <br><p>  рдЖрджреЗрд╢ рдХреА рд╕реНрдерд┐рддрд┐ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>Q</code></a> рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ): </p><br><pre> <code class="python hljs">query = query.filter( Q(hotel__status__in=[<span class="hljs-string"><span class="hljs-string">'completed'</span></span>, <span class="hljs-string"><span class="hljs-string">'cancelled'</span></span>]) <span class="hljs-comment"><span class="hljs-comment">#     ,    # | Q(car__status__in=[...]) )</span></span></code> </pre> <br><p>  рд╣рдо рдЕрдХреНрд╕рд░ рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрди рд╕рднреА рдЖрджреЗрд╢реЛрдВ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдиреНрд╣реЗрдВ рднреБрдЧрддрд╛рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рд╣реИрдВ, рдЬреЛ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рдврд╛рдВрдЪреЗ рдореЗрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдпреЗ рд╕рд┐рд░реНрдл рдЕрддрд┐рд░рд┐рдХреНрдд рдлрд┐рд▓реНрдЯрд░ рд╣реИрдВред  рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛ рдПрдХ рддреИрдпрд╛рд░ рдХреНрд╡реЗрд░реА рд▓реМрдЯрд╛рддреА рд╣реИ, рд╡рд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦ рд╕рдХрддреА рд╣реИ: </p><br><pre> <code class="python hljs">query = MetaOrder.exclude_non_payable_metaorders(query)</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдПрдХ рдХреНрд▓рд╛рд╕ рд╡рд┐рдзрд┐ рд╣реИ рдЬреЛ рдПрдХ <code>QuerySet</code> рднреА <code>QuerySet</code> ред </p><br><p>  рд╣рдо рд╕рд╢рд░реНрдд рдирд┐рд░реНрдорд╛рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдФрд░ рдЧрдгрдирд╛ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЪрд░ рднреА рддреИрдпрд╛рд░ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing.decimal <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Decimal today = dt.date.today() result = defaultdict(Decimal)</code> </pre> <br><h4 id="podgotovka-poley-annotatehttpsdocsdjangoprojectcomen21refmodelsquerysetsannotate">  рдлреАрд▓реНрдб рддреИрдпрд╛рд░реА ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>annotate</code></a> ) </h4><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рд╣рдореЗрдВ рдСрд░реНрдбрд░ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЦреЗрддреЛрдВ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдирд╛ рд╣реИ, рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>Coalesce</code></a> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдХрд┐рд╕реА рднреА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдирдП рдЖрджреЗрд╢реЛрдВ рдХреЛ рд╕рд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣рд╛рдБ <code>annotate</code> рдмреНрд▓реЙрдХ рдХрд╛ рдкрд╣рд▓рд╛ рднрд╛рдЧ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдкрд╣рд▓реЗ рдПрдиреЛрдЯреЗрдЯ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     , #      from app.helpers.numbers import ZERO, ONE query_annoted = query.annotate( _payment_pending=Coalesce( 'hotel__payment_pending', 'car__payment_pending', 'upsell__payment_pending', ), _payment_due=Coalesce( 'hotel__payment_due', 'car__payment_due', 'upsell__payment_due', ), _refund=Coalesce( 'hotel__refund', Value(ZERO) ), _refund_currency_rate=Coalesce( 'hotel__refund_currency_rate', Value(ONE) ), _sell=Coalesce( 'hotel__sell', Value(ZERO) ), _sell_currency_rate=Coalesce( 'hotel__sell_currency_rate', Value(ONE) ), )</span></span></code> </pre> </div></div><br><p>  <code>Coalesce</code> рдпрд╣рд╛рдВ рдзрдорд╛рдХреЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣реЛрдЯрд▓ рдХреЗ рдСрд░реНрдбрд░ рдореЗрдВ рдХрдИ рд╡рд┐рд╢реЗрд╖ рдЧреБрдг рд╣реИрдВ, рдФрд░ рдЕрдиреНрдп рд╕рднреА рдорд╛рдорд▓реЛрдВ рдореЗрдВ (рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдХрд╛рд░реЛрдВ) рдпреЗ рдЧреБрдг рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИрдВред  рдпрд╣ рд╣реИ рдХрд┐ рд░рд╛рд╢рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП <code>Value(ZERO)</code> рдФрд░ рд╡рд┐рдирд┐рдордп рджрд░реЛрдВ рдХреЗ рд▓рд┐рдП <code>Value(ONE)</code> рдкреНрд░рдХрдЯ рд╣реЛрддреЗ рд╣реИрдВред  <code>ZERO</code> рдФрд░ <code>ONE</code> рдХреЗрд╡рд▓ <code>Decimal('0')</code> рдФрд░ <code>Decimal(1)</code> , рдХреЗрд╡рд▓ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВред  рдПрдХ рд╢реМрдХрд┐рдпрд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг, рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЖрдкрдХреЗ рдорди рдореЗрдВ рд╕рд╡рд╛рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдореЗрдЯрд╛ рдСрд░реНрдбрд░ рдореЗрдВ рдХреБрдЫ рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рдПрдХ рд╕реНрддрд░ рддрдХ рдХреНрдпреЛрдВ рдирд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рдП?  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>payment_pending</code> , рдЬреЛ рд╣рд░ рдЬрдЧрд╣ рд╣реИред  рджрд░рдЕрд╕рд▓, рд╕рдордп рдХреЗ рд╕рд╛рде, рд╣рдо рдРрд╕реЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдореЗрдЯрд╛-рдСрд░реНрдбрд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдм рдХреЛрдб рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдРрд╕реЗ рдХрд╛рд░реНрдп рд╣рдорд╛рд░реА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдирд╣реАрдВ рд╣реИрдВред </p><br><h4 id="esche-odna-podgotovka-i-raschety">  рдПрдХ рдФрд░ рддреИрдпрд╛рд░реА рдФрд░ рдЧрдгрдирд╛ </h4><br><p>  рдЕрдм рд╣рдореЗрдВ рдЙрди рд░рд╛рд╢рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдЧрдгрдирд╛рдПрдБ рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдкрд┐рдЫрд▓реЗ <code>annotate</code> рдмреНрд▓реЙрдХ рдореЗрдВ рдорд┐рд▓реА рдереАрдВред  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдм рдЖрдкрдХреЛ рдЖрджреЗрд╢ рдХреЗ рдкреНрд░рдХрд╛рд░ (рдПрдХ рдЕрдкрд╡рд╛рдж рдХреЛ рдЫреЛрдбрд╝рдХрд░) рд╕реЗ рдмрдВрдзреЗ рд░рд╣рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рджреВрд╕рд░рд╛ рдПрдиреЛрдЯреЗрдЯ</b> <div class="spoiler_text"><pre> <code class="python hljs">.annotate( <span class="hljs-comment"><span class="hljs-comment">#  _base     _sell_base=( F('_sell') * F('_sell_currency_rate') ), _refund_base=( F('_refund') * F('_refund_currency_rate') ), _payable_base=( F('_sell_base') - F('_refund_base') ), _reporting_currency_rate=Case( When( content_type=Hotel.get_content_type(), then=RawSQL( '(hotel.currency_data-&gt;&gt;%s)::numeric', (partner.reporting_currency,), ), ), output_field=DecimalField(), default=Decimal('1'), ), )</span></span></code> </pre> </div></div><br><p>  рдЗрд╕ рдмреНрд▓реЙрдХ рдХрд╛ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣рд┐рд╕реНрд╕рд╛ <code>_reporting_currency_rate</code> рдлрд╝реАрд▓реНрдб рдпрд╛ рдмрд┐рдХреНрд░реА рдХреЗ рд╕рдордп рд╕рдВрджрд░реНрдн рдореБрджреНрд░рд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рдирд┐рдордп рджрд░ рд╣реИред  рдПрдХ рд╣реЛрдЯрд▓ рдХреЗ рдСрд░реНрдбрд░ рдХреЗ рд▓рд┐рдП рд╕рднреА рдореБрджреНрд░рд╛рдУрдВ рдХреА рд╡рд┐рдирд┐рдордп рджрд░реЛрдВ рдкрд░ рдбреЗрдЯрд╛ рдореБрджреНрд░рд╛ рдореБрджреНрд░рд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕рд┐рд░реНрдл JSON рд╣реИред  рд╣рдо рдРрд╕рд╛ рдХреНрдпреЛрдВ рд░рдЦрддреЗ рд╣реИрдВ?  <em>рдпрд╣ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ рдорд╛рдорд▓рд╛ рд╣реИ</em> ред </p><br><p>  рдФрд░ рдпрд╣рд╛рдБ, рдпрд╣ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВ рдирд╣реАрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>F</code></a> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрдмрдВрдз рдореБрджреНрд░рд╛ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ?  рдпрджрд┐ рдЖрдк рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="python hljs">F(<span class="hljs-string"><span class="hljs-string">f'currency_data__</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{partner.reporting_currency}</span></span></span><span class="hljs-string">'</span></span>)</code> </pre> <br><p>  рд▓реЗрдХрд┐рди <code>f-strings</code> рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ <code>F</code>  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рддрдереНрдп рдХрд┐ Django ORM рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдиреЗрд╕реНрдЯреЗрдб json рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ, рдмрд╣реБрдд рд╣реА рдордирднрд╛рд╡рди рд╣реИ - <code>F('currency_data__USD')</code> ред </p><br><p>  рдФрд░ рдЕрдВрддрд┐рдо <code>annotate</code> рдмреНрд▓реЙрдХ <code>_payable_in_cur</code> рдЧрдгрдирд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╕рднреА рдЖрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП <code>_payable_in_cur</code> рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрд╣ рдореВрд▓реНрдп рдЕрдиреБрдмрдВрдз рдореБрджреНрд░рд╛ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p><img src="https://habrastorage.org/webt/3g/hi/rd/3ghirdq4rnexrp2vnhwucju7rkw.png" alt="dash2"></p><br><pre> <code class="python hljs">.annotate( _payable_in_cur=( F(<span class="hljs-string"><span class="hljs-string">'_payable_base'</span></span>) / F(<span class="hljs-string"><span class="hljs-string">'_reporting_currency_rate'</span></span>) ) )</code> </pre> <br><p>  <code>annotate</code> рд╡рд┐рдзрд┐ рдХреА рдЦрд╝рд╛рд╕рд┐рдпрдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдмрд╣реБрдд <code>SELECT something AS something_else</code> рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ <code>SELECT something AS something_else</code> рдХрд┐ <code>SELECT something AS something_else</code> рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕реАрдзреЗ рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕реЗ SQL рдХреНрд╡реЗрд░реА - <code>query.__str__()</code> рдХреЛ рдЕрдирд▓реЛрдб рдХрд░рдХреЗ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣ рд╡рд╣ рдЖрдзрд╛рд░ рд╣реИ рдЬреЛ</a> Django ORM рджреНрд╡рд╛рд░рд╛ <code>base_query_annotated</code> рд▓рд┐рдП рдЬрдирд░реЗрдЯ рдХрд┐рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрдпрд╛</a> SQL рдХреЛрдб <code>base_query_annotated</code> ред  рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдмрд╛рд░ рдкрдврд╝рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдк рдЕрдкрдиреА рдХреНрд╡реЗрд░реА рдХреЛ рдХрд╣рд╛рдВ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h4 id="zaklyuchitelnye-podschety">  рдЕрдВрддрд┐рдо рдЧрдгрдирд╛ </h4><br><p>  <code>aggregate</code> рд▓рд┐рдП рдПрдХ рдЫреЛрдЯрд╛ рдЖрд╡рд░рдг рд╣реЛрдЧрд╛, рддрд╛рдХрд┐ рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдпрджрд┐ рд╕рд╛рдереА рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдореАрдЯреНрд░рд┐рдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рддреЛ рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХреЗред </p><br><p><img src="https://habrastorage.org/webt/ky/qm/pi/kyqmpiht-jwpwuripuf6wlfiqv0.png" alt="dash3"></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_data_from_query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(query: QuerySet)</span></span></span><span class="hljs-function"> -&gt; Decimal:</span></span> result = query.aggregate( _sum_payable=Sum(F(<span class="hljs-string"><span class="hljs-string">'_payable_in_cur'</span></span>)), ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result[<span class="hljs-string"><span class="hljs-string">'_sum_payable'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ZERO</code> </pre> <br><p>  рдФрд░ рдПрдХ рдФрд░ рдмрд╛рдд - рдпрд╣ рд╡реНрдпрд╡рд╕рд╛рдп рдХреА рд╕реНрдерд┐рддрд┐ рд╕реЗ рдЕрдВрддрд┐рдо рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрди рд╕рднреА рдЖрджреЗрд╢реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЬрд▓реНрдж рд╣реА рднреБрдЧрддрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </p><br><p><img src="https://habrastorage.org/webt/xz/rj/ss/xzrjssl1barwnpvtegjkg1tkvs0.png" alt="dash4"></p><br><pre> <code class="python hljs">before_payment_pending_query = _get_data_from_query( base_query_annotated.filter(_payment_pending__gt=today) )</code> </pre> <br><h4 id="otladka-i-proverka">  рдбрд┐рдмрдЧрд┐рдВрдЧ рдФрд░ рд╕рддреНрдпрд╛рдкрди </h4><br><p>  рдмрдирд╛рдП рдЧрдП рдЕрдиреБрд░реЛрдз рдХреА рд╢реБрджреНрдзрддрд╛ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рд╣реА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЧрдгрдирд╛ рдХреЗ рдЕрдзрд┐рдХ рдкрдардиреАрдп рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдЗрд╕рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> morder <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> query: payable = morder.get_payable_in_cur() payment_pending = morder.get_payment_pending() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> payment_pending &gt; today: result[<span class="hljs-string"><span class="hljs-string">'payment_pending'</span></span>] += payable</code> </pre> <br><p>  рдХреНрдпрд╛ рдЖрдк "рдорд╛рдереЗ" рд╡рд┐рдзрд┐ рдЬрд╛рдирддреЗ рд╣реИрдВ? </p><br><h3 id="finalnyy-kod">  рдЕрдВрддрд┐рдо рдХреЛрдб </h3><br><p>  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕рд╛ рдХреБрдЫ рдорд┐рд▓рд╛: </p><br><div class="spoiler">  <b class="spoiler_title">рдЕрдВрддрд┐рдо рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_data_from_query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(query: QuerySet)</span></span></span><span class="hljs-function"> -&gt; tuple:</span></span> result = query.aggregate( _sum_payable=Sum(F(<span class="hljs-string"><span class="hljs-string">'_payable_in_cur'</span></span>)), ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result[<span class="hljs-string"><span class="hljs-string">'_sum_payable'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ZERO <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(partner_id: int)</span></span></span><span class="hljs-function">:</span></span> today = dt.date.today() partner = query_get_one(Partner.objects.filter(id=partner_id)) query = MetaOrder.objects.filter(partner=partner, content_type__in=[ Hotel.get_content_type(), Car.get_content_type(), Upsell.get_content_type(), ]) result = defaultdict(Decimal) query_annoted = query.annotate( _payment_pending=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__payment_pending'</span></span>, <span class="hljs-string"><span class="hljs-string">'car__payment_pending'</span></span>, <span class="hljs-string"><span class="hljs-string">'upsell__payment_pending'</span></span>, ), _payment_due=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__payment_due'</span></span>, <span class="hljs-string"><span class="hljs-string">'car__payment_due'</span></span>, <span class="hljs-string"><span class="hljs-string">'upsell__payment_due'</span></span>, ), _refund=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__refund'</span></span>, Value(ZERO) ), _refund_currency_rate=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__refund_currency_rate'</span></span>, Value(Decimal(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)) ), _sell=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__sell'</span></span>, Value(ZERO) ), _sell_currency_rate=Coalesce( <span class="hljs-string"><span class="hljs-string">'hotel__sell_currency_rate'</span></span>, Value(Decimal(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)) ), ).annotate( <span class="hljs-comment"><span class="hljs-comment"># Calculated fields _sell_base=( F('_sell') * F('_sell_currency_rate') ), _refund_base=( F('_refund') * F('_refund_currency_rate') ), _payable_base=( F('_sell_base') - F('_refund_base') ), _reporting_currency_rate=Case( # Only hotels have currency_data, therefore we need a # check and default value When( content_type=Hotel.get_content_type(), then=RawSQL( '(hotel.currency_data-&gt;&gt;%s)::numeric', (partner.reporting_currency,), ), ), output_field=DecimalField(), default=Decimal('1'), ), ) .annotate( _payable_in_cur=( F('_payable_base') / F('_reporting_currency_rate') ) ) before_payment_pending_query = _get_data_from_query( base_query_annotated.filter(_payment_pending__gt=today) ) after_payment_pending_before_payment_due_query = _get_data_from_query( base_query_annotated.filter( Q(_payment_pending__lte=today) &amp; Q(_payment_due__gt=today) ) )</span></span></code> </pre></div></div><br><p>  рдпрд╣ рдЕрдм рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/xg/1i/rf/xg1irfnazuk-rqk14wdlxn32nhi.png" alt="timing_after"></p><br><p><img src="https://habrastorage.org/webt/mt/k7/cq/mtk7cqefuzlx96roihjpgvpeaz8.png" alt="count_after"></p><br><h2 id="vyvody">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>  рддрд░реНрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдФрд░ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╕рдВрдмрджреНрдз рдореАрдЯреНрд░рд┐рдХ рдХреЗ рд▓рд┐рдП рдПрдХ рддреНрд╡рд░рд┐рдд рд░реВрдк рд╕реЗ рддреНрд╡рд░рд┐рдд рд╣реИрдВрдбрд▓ рдмрдирд╛рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣реЗ рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░ рджрд┐рдпрд╛ред  рд╕рдорд╛рдзрд╛рди рдЕрдЪреНрдЫрд╛ рдирд┐рдХрд▓рд╛, рдФрд░ рд╣рдо рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдиреНрдп рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдЗрд╕ рддрд░реНрдХ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  ORM рд╣рдорд╛рд░рд╛ рд╕рдм рдХреБрдЫ рд╣реИред </p><br><p>  рдЯрд┐рдкреНрдкрдгреА рд▓рд┐рдЦреЗрдВ, рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ - рд╣рдо рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗ!  рдзрдиреНрдпрд╡рд╛рдж! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi447706/">https://habr.com/ru/post/hi447706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi447696/index.html">рд╢рд╣рд░реЛрдВ рдиреЗ рдкрд╣рд▓реЗ рдЧреИрд░-рдХреИрд╢ рд╕реНрдЯреЛрд░ рдЕрдореЗрдЬрд╝рди рдЧреЛ рдХрд╛ рд╡рд┐рд░реЛрдз рдХреНрдпреЛрдВ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi447698/index.html">рд░реЗрдб рд╣реЙрдЧрд╡рд░реНрдЯреНрд╕: рдПрдХ рдбрд┐рдкреНрд▓реЛрдорд╛ рдХреЗ рдмрд┐рдирд╛ рд╢рд┐рдХреНрд╖рд╛рд╡рд┐рдж</a></li>
<li><a href="../hi447700/index.html">рднрд╛рд╡рдирд╛рддреНрдордХ рд▓рдЪреАрд▓рд╛рдкрди рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╡рд┐рдХрд╛рд╕ рдХреА рдХреБрдВрдЬреА рд╣реИред</a></li>
<li><a href="../hi447702/index.html">рдЖрджрд░реНрд╢ рдЧрдгрд┐рддреАрдп рдЪрдХреНрд░ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi447704/index.html">рдЪрдврд╝рд╛рдИ рдПрд▓рдмреНрд░рд╕ - рд▓рдбрд╝рд╛рдИ рдореЗрдВ рдЯреЛрд╣реАред рддрдХрдиреАрдХреА рднрд╛рдЧ 1. рд░рдЬрд┐рд╕реНрдЯрд░, рдвреЗрд░ рдФрд░ рдЕрдиреНрдп рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг</a></li>
<li><a href="../hi447708/index.html">рдпреИрдВрдбреЗрдХреНрд╕ рдиреЗ рдкрд╣рд▓реЗ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХреЛрдВ рдХреЛ рдЗрд▓реНрдпрд╛ рд╕реЗрдЧрд╛рд▓реЛрд╡рд┐рдЪ рдХреЗ рдирд╛рдо рдкрд░ рдпреБрд╡рд╛ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХреЛрдВ рдФрд░ рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХреЛрдВ рдХреЛ рд╕рдореНрдорд╛рдирд┐рдд рдХрд┐рдпрд╛</a></li>
<li><a href="../hi447712/index.html">рд╣рд╛рдп, рд╕рд╛рд╕ | рд░реВрд╕реА рд╕рд╛рд╕ 2018 - рдкрд░рд┐рдгрд╛рдо</a></li>
<li><a href="../hi447714/index.html">рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдЕрднреНрдпрд╛рд╕ рдореЗрдВ ARMA рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЗ рдЖрд╡реЗрджрди рдкрд░</a></li>
<li><a href="../hi447716/index.html">рдПрдХрддрд╛: рдПрдХ рдбреНрд░реЙрдХрд▓ рдореЗрдВ рдХрдИ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдмрд╛рд░ рдЦреАрдВрдЪреЗ</a></li>
<li><a href="../hi447718/index.html">рд╕рдм рдХреБрдЫ рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╣реЛрдЧрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>