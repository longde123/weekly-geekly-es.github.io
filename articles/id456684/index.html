<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👇🏻 🤶🏾 🔩 Memperbaiki bug kecil di calc.exe 🎛️ 👩🏾‍💼 🐜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada hari Minggu, saya diam seperti biasa, browsing melalui Reddit. Menggulir melalui kesenangan anak anjing dan humor buruk programmer, satu posting ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memperbaiki bug kecil di calc.exe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456684/"> Pada hari Minggu, saya diam seperti biasa, browsing melalui Reddit.  Menggulir melalui kesenangan anak anjing dan humor buruk programmer, satu posting tertentu menarik perhatian saya.  Itu adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bug di calc.exe</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ff/288/f42/0ff288f4235c494798b085d51a9d777e.png"><br>  <i><font color="gray">Penghitungan rentang tanggal salah dalam Windows Calculator</font></i> <br><br>  "Yah, itu kedengarannya seperti kesalahan yang aneh, aku ingin tahu apa yang menyebabkannya," aku berpikir dalam hati.  Jumlah minggu, tentu saja, membuat bug terlihat seperti semacam kesalahan overflow atau range, Anda tahu, alasan khas.  Tapi itu selalu bisa sedikit dibalik oleh sinar berenergi tinggi dari tetangga kosmik yang ramah. <br><a name="habracut"></a><br>  Karena tertarik pada alasannya, saya melakukan apa yang Anda lakukan dalam kasus-kasus seperti itu: Saya mencobanya di komputer saya untuk memposting "Semuanya bekerja untuk saya."  Dan pengulangan situasi dari pos "31 Juli - 31 Desember" di komputer saya memberikan hasil yang benar dari "5 bulan".  Tetapi setelah menguji sedikit, saya menemukan bahwa "31 Juli - 30 Desember" sebenarnya menyebabkan kesalahan.  Nilai yang salah "5 bulan, 613566756 minggu, 3 hari" ditampilkan. <br><br>  Saya belum selesai mengguncang program, dan kemudian saya ingat: "Oh, bukankah kalkulator adalah salah satu dari hal-hal yang Microsoft telah membuka sumbernya?"  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dan sungguh</a> .  Kesalahan ini tidak bisa terlalu rumit, jadi saya pikir saya akan berusaha menemukannya.  Mengunduh sumbernya cukup sederhana, dan menambahkan beban kerja UWP yang diperlukan ke Visual Studio juga berjalan tanpa hambatan. <br><br>  Menavigasi basis kode yang tidak Anda kenal adalah sesuatu yang terbiasa dengan waktu.  Terutama ketika Anda ingin berkontribusi pada proyek open source di mana Anda menemukan bug.  Namun, ketidaktahuan XAML atau WinRT, tentu saja, tidak membuat segalanya menjadi lebih mudah. <br><br>  Saya membuka file solusi dan melihat ke dalam proyek "Kalkulator" untuk mencari file yang terkait dengan bug.  Saya menemukan <code>DateCalculator.xaml</code> , maka sepertinya cocok untuk nama <code>DateDiff_FromDate to DateCalculatorViewModel.cpp</code> dan, akhirnya, <code>DateCalculator.cpp</code> . <br><br>  Setelah menetapkan breakpoint dan melihat beberapa variabel, saya melihat bahwa nilai <code>DateDifference</code> akhir sudah salah.  Artinya, itu bukan hanya kesalahan konversi menjadi string, tetapi kesalahan perhitungan yang sebenarnya. <br><br>  <a href="">Perhitungan aktual</a> dalam pseudo-code sederhana terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">DateDifference </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate_difference</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(start_date, end_date)</span></span></span><span class="hljs-function"> </span></span>{ uint[] diff_types = [year, month, week, day] uint[] typical_days_in_type = [<span class="hljs-number"><span class="hljs-number">365</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] uint[] calculated_difference = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] date temp_pivot_date date pivot_date = start_date uint days_diff = calculate_days_difference(start_date, end_date) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(type in differenceTypes) { temp_pivot_date = pivot_date uint current_guess = days_diff /typicalDaysInType[type] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(current_guess !=<span class="hljs-number"><span class="hljs-number">0</span></span>) pivot_date = advance_date_by(pivot_date, type, current_guess) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> diff_remaining <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> best_guess_hit = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>{ diff_remaining = calculate_days_difference(pivot_date, end_date) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(diff_remaining &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// pivotDate has gone over the end date; start from the beginning of this unit current_guess = current_guess - 1 pivot_date = temp_pivot_date pivot_date = advance_date_by(pivot_date, type, current_guess) best_guess_hit = true } else if(diff_remaining &gt; 0) { // pivot_date is still below the end date if(best_guess_hit) break; current_guess = current_guess + 1 pivot_date = advance_date_by(pivot_date, type, 1) } } while(diff_remaining!=0) temp_pivot_date = advance_date_by(temp_pivot_date, type, current_guess) pivot_date = temp_pivot_date calculated_difference[type] = current_guess days_diff = calculate_days_difference(pivot_date, end_date) } calculcated_difference[day] = days_diff return calculcated_difference }</span></span></code> </pre> <br>  Itu terlihat baik.  Tidak ada masalah dalam logika.  Pada dasarnya, fungsi melakukan hal berikut: <br><br><ul><li>  dihitung tahun penuh sejak tanggal mulai <br></li><li>  dari tanggal tahun penuh terakhir dihitung bulan <br></li><li>  dihitung minggu dari tanggal bulan penuh terakhir <br></li><li>  dari tanggal minggu penuh terakhir menghitung hari yang tersisa </li></ul><br>  Sebenarnya, masalahnya adalah asumsi bahwa mulai berurutan <br><br><pre> <code class="cpp hljs">date = advance_date_by(date, month, somenumber) date = advance_date_by(date, month, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  sama dengan <br><br><pre> <code class="cpp hljs">date = advance_date_by(date, month, somenumber + <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Ini biasanya hal yang sama.  Tetapi muncul pertanyaan: <b>"Jika Anda mencapai hari ke-31 bulan itu, bulan berikutnya 30 hari, Anda menambahkan satu bulan, lalu ke mana Anda akan pergi?"</b> <br><br>  Sepertinya untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Windows.Globalization.Calendar.AddMonths (Int32)</a> jawabannya adalah "pada tanggal 30". <br><br>  Dan ini berarti: <br>  “31 Juli + 4 bulan = 30 November” <br>  "30 November + 1 bulan = 30 Desember" <br>  “31 Juli + 5 bulan = 31 Desember” <br><br>  Dengan demikian, operasi AddMonths tidak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">distributif</a> (dengan AddMonth-multiplikasi), atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komutatif</a> , atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">asosiatif</a> .  Apa yang sebenarnya harus menjadi operasi "penambahan".  Bukankah menyenangkan bekerja dengan waktu dan kalender? <br><br>  Mengapa dalam kasus ini, kesalahan pengaturan rentang menyebabkan sejumlah besar minggu?  Seperti yang mungkin sudah Anda duga, ini disebabkan oleh fakta bahwa <code>days_diff</code> adalah tipe yang tidak ditandatangani.  Ini mengubah -1 hari menjadi jumlah yang sangat besar, yang kemudian diteruskan ke iterasi siklus berikutnya dengan minggu.  Yang kemudian mencoba untuk memperbaiki situasi dengan mengurangi <code>current_guess</code> tetapi tidak mengurangi variabel yang tidak ditandatangani. <br><br>  Ya, itu cara yang menarik untuk menghabiskan hari Minggu.  Saya membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">permintaan tarik</a> di Github dengan "perbaikan" minimal.  Saya meletakkan "koreksi" dalam tanda kutip, karena sekarang perhitungannya terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c03/81a/771/c0381a771757769634f9a90c64eb35a8.png"><br><br>  Saya pikir secara teknis ini adalah hasil yang benar, jika kita asumsikan bahwa "31 Juli + 4 bulan = 30 November."  Meskipun opsi ini tidak sepenuhnya konsisten dengan intuisi manusia tentang perbedaan tanggal.  Tetapi bagaimanapun juga, ini tidak salah seperti sebelumnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id456684/">https://habr.com/ru/post/id456684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id456672/index.html">Resep Nginx: pemberitahuan asinkron dari PostgreSQL ke websocket</a></li>
<li><a href="../id456676/index.html">Masuk dalam aplikasi php yang didistribusikan</a></li>
<li><a href="../id456678/index.html">Keadaan elektronik masa depan. Bagian 4</a></li>
<li><a href="../id456680/index.html">Delapan Hukum Penamaan dalam Desain UX (Bagian 2)</a></li>
<li><a href="../id456682/index.html">Perilaku tidak terdefinisi dengan deklarasi fungsi yang tidak digunakan lagi di ANSI C</a></li>
<li><a href="../id456686/index.html">Seluk-beluk wawancara ketika mempekerjakan udalenka</a></li>
<li><a href="../id456690/index.html">Headphone Sehari-hari oleh Case Guru - CGPods Sport</a></li>
<li><a href="../id456692/index.html">Naik turunnya Visual Basic</a></li>
<li><a href="../id456696/index.html">Bagaimana bunga pinjaman bertambah dan bagaimana cara menerapkannya</a></li>
<li><a href="../id456700/index.html">GeekUniversity Membuka Rekrutmen di Fakultas Manajemen Produk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>