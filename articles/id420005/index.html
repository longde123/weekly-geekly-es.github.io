<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏼 💮 🐴 Pengawasan video tidak profesional di apartemen itu menyenangkan dan tidak mahal 👤 ↕️ 🏁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dari saat saya mendapatkan sistem alarm GSM di apartemen saya yang sedang dijaga, saya mendapat ide bahwa akan lebih baik memiliki "mata" jika saya ti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengawasan video tidak profesional di apartemen itu menyenangkan dan tidak mahal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420005/"><img align="left" src="https://habrastorage.org/webt/af/kl/ma/afklma2ivyuyigiy4x2qvej-tjc.jpeg">  Dari saat saya mendapatkan sistem alarm GSM di apartemen saya yang sedang dijaga, saya mendapat ide bahwa akan lebih baik memiliki "mata" jika saya tidak berada di apartemen jika sensor alarm dipicu (atau mungkin alarm itu salah?).  Karena saya seorang insinyur di bidang teknologi informasi, tidak ada pertanyaan tentang solusi profesional dalam bentuk registrar dan banyak kamera - hanya semuanya sendiri, dengan tangan saya sendiri.  Juga diputuskan untuk segera membatasi anggaran, dan jika proyek berhasil, sudah dipikirkan peningkatan dan modernisasi selanjutnya. <br><a name="habracut"></a><br><h4>  Besi </h4><br>  Pertama-tama, kami memilih setrika.  "Mata" berarti kamera, tidak ada tujuan apa pun.  Kemudian muncul pertanyaan tentang apa yang harus dilakukan dengan gambar yang diterima - untuk menyimpannya, mentransfernya ke suatu tempat, dll.  Jadi saya berpikir tentang router yang terhubung melalui UPS dengan modem 4G untuk saluran Internet yang stabil yang sulit dimasukkan ke pencuri potensial. <br><br>  Di tempat kerja, kami telah berhasil menggunakan router dengan port USB ZyXel Keenetic selama beberapa tahun (khususnya model Giga2 saya yang sudah usang).  Setelah pengembang firmware "mengacaukan" hal seperti OPKG (manajer paket), menjadi mungkin untuk mengubah router saya menjadi komputer pribadi dengan linux dengan kemungkinan terluas, yang saya putuskan untuk digunakan untuk tujuan saya.  Secara total, sudah memiliki router komputer di rumah dengan modem 4G yang terhubung, saya hanya tidak memiliki "mata" - kamera USB.  Mengingat bahwa saya membeli webcam C270 logitech untuk orang tua saya tiga atau empat tahun yang lalu untuk komunikasi mereka dengan kerabat melalui skype di komputer dan bahwa mereka sekarang sudah berkomunikasi melalui tablet - saya meminta kamera dari mereka.  Ngomong-ngomong, ada LED di panel depan kamera yang menunjukkan apakah kamera berfungsi atau tidak - nanti ternyata sangat nyaman untuk secara visual menentukan pengoperasian sistem pengawasan video. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jc/mn/7h/jcmn7hy7culoiu4yxzchbbrhpzo.jpeg"></div><br><h4>  Pasangkan dan konfigurasikan setrika </h4><br>  Jadi ada besi.  Dan apa yang tidak bisa tidak bersuka cita - sementara kita berada dalam anggaran. <br>  Ada dua port USB pada router saya, salah satunya sudah ditempati oleh modem USB 4G.  Kami akan menggunakan yang kedua dengan menempelkan kamera logitech C270 di sana.  Agar router dapat bekerja dengan kamera, Anda harus terlebih dahulu menginstal komponen OPKG pada router (dalam komponen ini kami menaruh semua tanda centang kecuali "modul Kernel untuk mendukung tuner DVB USB").  Tetapi ada masalah - agar OPKG bekerja di router, Anda membutuhkan ruang disk (satu gigabyte sudah cukup untuk mata), tetapi di mana saya bisa mendapatkannya, karena kedua port USB pada router sudah diambil?  Ada dua solusi yang mungkin - baik hub USB dengan USB flash drive (hal pertama yang langsung terlintas dalam pikiran), atau fakta bahwa Anda dapat meletakkan kartu microSD di modem USB 4G saya.  Dan kartu microSD lambat 8 ​​gigabyte yang ditemukan di rumah segera pergi ke modem.  Meninggalkan sistem file pada kartu NTFS (walaupun EXT2 atau EXT3 sangat disarankan).  Buat folder Instal dan unggah gambar Entware yang diinginkan ke dalamnya. <br><br>  Kemudian kita pergi ke panel admin router, tab OPKG, pilih kartu memori kita, di baris "initrc script" tulis <br><br><pre><code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/rc.unslung</code> </pre> <br>  dan klik <i>Terapkan</i> . <br>  Setelah menginstal OPKG, klien SSH (saya menggunakan program Putty di laptop saya dengan windows) menempel ke router dan menjalankan perintah berikut untuk memperbarui OPKG: <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> opkg <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span></code> </pre> <br>  Secara default, pada SSH, <i>kata</i> sandi <i>root</i> adalah <i>tajam</i> (atau <i>zyxel</i> , tergantung pada versi firmware).  Sangat disarankan agar Anda mengganti kata sandi dengan perintah <i>passwd</i> . <br><br><h4>  Perangkat lunak </h4><br>  Selanjutnya, instal program gerak. <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> motion</code> </pre> <br>  Dialah yang akan bekerja dengan kamera kami, menganalisis perubahan dalam gambar dan menginstruksikan router ke mana harus mengirim gambar yang diterima.  File pengaturan program gerak adalah \ etc \ motion \ motion.conf, mengeditnya kita mengubah pengaturan yang kita butuhkan.  Pertama-tama, saya mengatur resolusi maksimum yang didukung oleh kamera ke 1280x720, memutarnya 180 derajat (lebih mudah bagi saya untuk mengatur kamera terbalik), merekam 2 frame per detik. <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">rotate</span></span> <span class="hljs-number"><span class="hljs-number">180</span></span> width <span class="hljs-number"><span class="hljs-number">1280</span></span> height <span class="hljs-number"><span class="hljs-number">720</span></span> framerate <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Saya tidak melihat kebutuhan untuk merekam seluruh aliran video dan menyiarkannya ke Internet, jadi saya mengatur gerakan untuk merekam video dan mentransfernya hanya jika gambar berubah.  Dalam proses mengonfigurasi gerakan, menjadi jelas bahwa itu tidak mendukung mode MJPEG dengan kamera saya, tetapi hanya mendukung mode YUYV - sebagai akibatnya hasil pekerjaan bukan urutan video, tetapi hanya urutan foto JPEG. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">v4l2_palette</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre> <br>  Saya juga mengkonfigurasi gerakan sehingga salinan foto disalin ke server FTP eksternal. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">on_picture_save</span></span> wput ftp://login:pass<span class="hljs-variable"><span class="hljs-variable">@XX</span></span>.29.136.XX %f</code> </pre> <br>  Jika router dengan kartu memori dikeluarkan dari apartemen, masih ada peluang untuk melihat bagaimana tepatnya hal ini terjadi. <br><br>  Sangat disarankan agar Anda mengubah kata sandi login untuk terhubung ke kamera Anda. <br><br><pre> <code class="hljs pgsql">stream_authentication <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>:pass</code> </pre> <br>  Setelah semua pengaturan, lihat di browser untuk hasilnya di: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8081</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b4/xd/wk/b4xdwknikb-elwngaufq3z8setg.jpeg"></div><br>  Perhatian!  Jika Anda tidak melihat gambar apa pun di peramban, Anda harus memperhatikan versi firmware Keenetic Anda.  Agaknya mulai dari versi firmware 2.11.A.4.0-1, modul video tidak dimuat secara default, jadi Anda perlu memuatnya dalam "SSH" "pena" atau menambahkannya ke skrip startup: <br><br><pre> <code class="hljs powershell">/opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-dev</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videodev.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-memops</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-vmalloc</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/v4l2<span class="hljs-literal"><span class="hljs-literal">-common</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/uvcvideo.ko</code> </pre> <br>  Jika gambar tidak muncul bahkan setelah itu, pertama-tama kita melihat log Keenetic, apa yang terjadi ketika kamera terhubung.  Apakah kamera terdeteksi sebagai perangkat video, dll. <br><br><h4>  Manajemen </h4><br>  Setelah melakukan semua pekerjaan ini, muncul ide bahwa kita perlu mengelola ini entah bagaimana, yaitu  hidupkan dan matikan pada waktu yang tepat (dan sebagian besar dari jarak jauh).  Saya memecahkan masalah dengan menginstal klien SSH pada ponsel cerdas android saya.  Setelah memilih klien SSH, mereka memilih ScriptKitty.  Dengan menekan dua atau tiga tombol pada ponsel cerdas, Anda dapat dengan cepat menghidupkan atau mematikan gerakan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0r/dj/to/0rdjtofm6gsjlzfjxq_dkrk6zgo.jpeg"></div><br>  Menjalankan gerak melalui SSH: <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> restart</code> </pre> <br>  Menyelesaikan gerakan melalui SSH: <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> stop</code> </pre> <br>  Tapi ada satu lagi tangkapan: alamat ip "abu-abu" pada modem 4G saya.  Dengan menyambungkan ke router melalui Wi-fi, Anda dapat mematikan atau bergerak tanpa masalah.  Tetapi bagaimana jika Anda berada di luar Wi-fi router Anda, dan router Anda memiliki ip "abu-abu"?  Saya menemukan penyelamatan dalam bentuk VPN.  Skema ini adalah sebagai berikut - dengan router rumah saya, saya berpegang teguh pada router di tempat kerja dengan IP statis menggunakan klien PPTP (server PPTP diinstal bekerja di router).  Sekarang, setelah meneruskan port SSH dari router yang bekerja ke router rumah, saya akhirnya dapat mengontrol kamera saya dari jarak jauh dengan mengakses alamat statis router yang sedang bekerja dari smartphone saya. <br><br>  Saya juga mencoba mengotomatisasi kontrol menggunakan alat otomatisasi Tasker (ia memiliki klien SSH yang terpisah) - untuk memantau koneksi ponsel cerdas ke router Wi-Fi dan menghidupkan atau mematikan gerakan tergantung pada ini.  Logikanya adalah ini: smartphone terhubung ke router Wi-Fi - jadi saya di rumah - untuk mematikan kamera.  Ponsel cerdas tidak terhubung ke router Wi-Fi - jadi saya tidak di rumah - nyalakan kamera.  Tetapi setelah bereksperimen, ia menolak opsi ini - ada terlalu banyak hal positif yang salah.  Misalnya, saya di rumah, smartphone tertidur, router kehilangan smartphone, kamera dihidupkan - yah, dll.  Saat ini saya hanya menggunakan metode manual. <br><br><h4>  Kesimpulan </h4><br>  Pada prinsipnya, apa yang saya inginkan dari proyek adalah apa yang saya dapatkan.  Saya dapat "melihat" apartemen kapan pun saya mau, dan jika ada alarm GSM yang memicu, saya sudah dapat memutuskan apa yang harus dilakukan selanjutnya.  Dalam proses implementasi, saya memecahkan banyak masalah, tetapi solusi mereka menyebabkan sensasi tertentu dari pengetahuan yang diperoleh dan implementasi rencana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/av/fa/ux/avfauxqtn-lu_v2vmvijmrrd1em.jpeg"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420005/">https://habr.com/ru/post/id420005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id419995/index.html">Sebuah studi tentang Ivy, kompiler Angular baru</a></li>
<li><a href="../id419997/index.html">Parsing pola "Modul" dalam JavaScript</a></li>
<li><a href="../id419999/index.html">Pembagian otentikasi Yii1 / yii2</a></li>
<li><a href="../id420001/index.html">Memperkenalkan Pembaruan 3CX v15.5 6 BETA dan WebRTC Browser Softphone</a></li>
<li><a href="../id420003/index.html">Jendela dengan tombol di JavaFX:</a></li>
<li><a href="../id420007/index.html">Gelisah, lampu aneh dan kubus pembagi: mengenal Allocacoc</a></li>
<li><a href="../id420009/index.html">Seluk-beluk desain produk</a></li>
<li><a href="../id420011/index.html">Cara Memilih Printer 3D: Panduan Pemula</a></li>
<li><a href="../id420013/index.html">Pencarian Alamat MAC pada Switch Juniper</a></li>
<li><a href="../id420015/index.html">Cara mengukur kecepatan saluran Internet dengan benar dan berhenti terlihat seperti orang bodoh di mata penyedia Anda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>