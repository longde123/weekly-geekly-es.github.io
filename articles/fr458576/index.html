<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌 🎓 👇🏼 Gestion et localisation de texte dans une application web 🚻 🤲 👨🏾‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, habravchane! 


 Dans cet article, je parlerai d'une solution simple au problème de la gestion du texte et de la localisation dans une applic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestion et localisation de texte dans une application web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458576/"><p>  Bonjour, habravchane! </p><br><p>  Dans cet article, je parlerai d'une solution simple au problème de la gestion du texte et de la localisation dans une application Web, que vous pouvez implémenter vous-même ou utiliser une application prête à l'emploi. </p><br><p><img src="https://habrastorage.org/webt/6d/oq/q0/6doqq0la0c6khk4k23-bft5atxk.png"></p><br><p>  Je souhaite depuis longtemps partager mes propres pensées et expériences ... et, bien sûr, parler pour la vie. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Contexte</b> <div class="spoiler_text"><p>  Évidemment, des solutions pour gérer le texte et la localisation existent déjà, mais elles ne me convenaient pas pour diverses raisons: encombrantes, peu pratiques à utiliser, non adaptées, ne correspondent pas à ma vision de résoudre ce problème, manquent de fonctionnalités. </p><br><p>  De plus, je n'aime pas vraiment les bibliothèques tierces en raison de leur tendance à croître (c'est quand nous n'avons besoin que d'une petite partie de toutes les fonctionnalités). </p><br><p>  L'entreprise dans laquelle je travaille a sa propre solution, mais, à mon avis, elle est également loin d'être idéale.  Et la nécessité d'une rétrocompatibilité avec les anciennes versions complique inutilement les choses. </p><br><p> À un moment donné, je voulais quelque chose de simple, facile, compréhensible et extensible à l'infini pour différentes tâches. </p></div></div><br><h1 id="postanovka-zadachi">  Énoncé du problème </h1><br><p>  Tout semble clair ici.  Ou pas?  Pensons à ce que nous aimerions. </p><br><p>  Nous devons en quelque sorte obtenir des textes localisés.  Les textes peuvent contenir des variables.  Les variables peuvent-elles également être localisées?!  En théorie, oui.  Et si la variable est une date ou un nombre?!  Plus le support de démarque.  Et enfin, une solution au cas où le texte ne serait pas trouvé. </p><br><h1 id="realizaciya">  Implémentation </h1><br><p>  La base sera un objet simple, où la clé est le code texte, et la valeur est le texte réel dont vous avez besoin, rien de compliqué: </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textsBundle = { <span class="hljs-string"><span class="hljs-string">'button.open'</span></span>: <span class="hljs-string"><span class="hljs-string">'Open'</span></span>, <span class="hljs-string"><span class="hljs-string">'button.save'</span></span>: <span class="hljs-string"><span class="hljs-string">'Save'</span></span>, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">texts</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getText = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> texts[code]; }; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextManager(textsBundle); textManager.getText(<span class="hljs-string"><span class="hljs-string">'button.open'</span></span>);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Un peu sur le nom des clés</b> <div class="spoiler_text"><p>  Le nom des clés est un sujet distinct.  Il vaut mieux se mettre immédiatement d’accord sur une seule option, sinon des touches différentes «remueront» :).  Il n'y a pas de solution unique, choisissez ce que vous pensez être plus pratique et plus cohérent avec le projet.  Personnellement, j'aime le premier: <br> <code>'button.open.label'</code> <br> <code>'button.open.help_text'</code> <br>  ou <br> <code>'button.label.open'</code> <br> <code>'button.help_text.open'</code> <br>  ou <br> <code>'label.button.open'</code> <br> <code>'help_text.button.open'</code> </p> </div></div><br><p>  Ensuite, nous avons besoin d'un mécanisme qui serait capable d'effectuer une sorte de manipulation du texte avant qu'il ne donne le résultat final, par exemple, insérer des paramètres.  Et puis j'ai eu une idée intéressante - et si nous utilisons un middleware pour manipuler du texte?  Après tout, je n'ai pas vu de telles décisions ... eh bien, ou j'ai mal regardé :) </p><br><p>  Nous décidons des exigences pour le middleware: à l'entrée, le middleware acceptera le texte et les paramètres, et donnera le texte résultant, après les manipulations nécessaires. <br>  Le premier middleware recevra le texte d'origine et les suivants recevront le texte du middleware précédent.  Ajoutons le code manquant: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">texts, middleware</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, parameters, code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!middleware) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> middleware.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prevText, middlewareItem</span></span></span><span class="hljs-function">) =&gt;</span></span> middlewareItem(prevText, parameters, code), text); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getText = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code, parameters</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> applyMiddleware(texts[code], parameters, code); }; }</code> </pre> <br><p>  TextManager peut sortir du texte par son code.  Il peut également être étendu à l'aide d'un middleware, ce qui ouvre de nombreuses possibilités, par exemple: </p><br><ul><li>  gérer le cas où le texte est introuvable </li><li>  utilisation de paramètres dans le texte </li><li>  localisation des paramètres </li><li>  utiliser la démarque </li><li>  blindage de texte, etc. </li></ul><br><h1 id="praktika">  Pratique </h1><br><p>  Nous allons écrire quelques middleware nécessaires.  Vous en aurez besoin à 100%. </p><br><p>  <b>InsertParams</b> <br>  Permet l'utilisation de paramètres dans les textes.  Par exemple, nous devons afficher le texte "Bonjour {{nom d'utilisateur}}".  Le middleware suivant fournira ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertParams</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, parameters</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!parameters) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nextText = text; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parameters) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.hasOwnProperty(key)) { nextText = text.replace(<span class="hljs-string"><span class="hljs-string">'{{'</span></span> + key + <span class="hljs-string"><span class="hljs-string">'}}'</span></span>, parameters[key]); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nextText; }</code> </pre> <br><p>  <b>UseCodeIfNoText</b> <br>  Vous permet de renvoyer le code texte, au lieu de <code>undefined</code> , si le texte est introuvable: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UseCodeIfNoText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, parameters, code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text ? text : code; }</code> </pre> <br><p>  Au total, nous recevons environ l'utilisation suivante: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textsBundle = { <span class="hljs-string"><span class="hljs-string">'text.hello'</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'text.hello_with_numeric_parameter'</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello {{0}}'</span></span>, <span class="hljs-string"><span class="hljs-string">'text.hello_with_named_parameter'</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello {{username}}'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextManager(textsBundle, [InsertParams, UseCodeIfNoText]); textManager.getText(<span class="hljs-string"><span class="hljs-string">'nonexistent.code'</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 'nonexistent.code' textManager.getText('text.hello') // 'Hello' textManager.getText('text.hello_with_numeric_parameter', ['Vasya']) // 'Hello Vasya' textManager.getText('text.hello_with_named_parameter', { username: 'Petya' }) // 'Hello Petya'</span></span></code> </pre> <br><h2 id="primer-ispolzovaniya-v-react-prilozhenii">  Exemple d'application React </h2><br><p>  Tout d'abord, initialisez au niveau supérieur <code>TextManager</code> et ajoutez des textes. <br>  À mon avis, il est préférable d'extraire des textes du serveur, mais pour plus de simplicité, je ne le ferai pas. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textsBundle = { <span class="hljs-string"><span class="hljs-string">'text.hello'</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello {{username}}'</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextManagerProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ children }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextManager(textsBundle, [InsertParams, UseCodeIfNoText]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TextManagerContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{textManager}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TextManagerContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br><p>  Ensuite, dans le composant, <code>textManager</code> utilisons <code>textManager</code> , par exemple, en utilisant un crochet, et nous obtenons le texte souhaité par code. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SayHello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textManager = useContext(TextManagerContext); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {textManager.getText('text.hello', { username })} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) }</code> </pre> <br><h1 id="lokalizaciya">  Localisation </h1><br><p>  Vous demandez: "Qu'est-ce que la localisation a à voir avec cela?". <br>  Tout est très simple - lors du changement de langue, créez une nouvelle instance de <code>TextManager</code> , ajoutez des textes et obtenez immédiatement le résultat. </p><br><h1 id="glava-predposlednyaya-">  L'avant-dernier chapitre :) </h1><br><p>  Comme vous pouvez le voir dans les exemples, l'utilisation est extrêmement simple et grâce au middleware, vous pouvez étendre la fonctionnalité indéfiniment. </p><br><p>  J'ai posté mon implémentation sur github et j'ai l'intention de développer davantage le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gestionnaire de texte</a> .  Utilisez, offrez des améliorations et, comme on dit, vous êtes les bienvenus!  :) </p><br><h1 id="v-zaklyuchenie">  En conclusion </h1><br><p>  J'ai donc réalisé mon désir de daaaaavnee - a écrit un article sur Habr.  J'espère vraiment que cet article sera utile et plaira à la communauté. </p><br><p>  Merci de votre attention. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458576/">https://habr.com/ru/post/fr458576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458560/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 12. VLAN avancé</a></li>
<li><a href="../fr458564/index.html">Pits sur le chemin de devenir programmeur</a></li>
<li><a href="../fr458566/index.html">Comment avons-nous attrapé un concepteur UX sur des appâts vivants?</a></li>
<li><a href="../fr458568/index.html">Comment avons-nous obtenu les premières images 3D de peut-être la plus ancienne église chrétienne de Russie</a></li>
<li><a href="../fr458572/index.html">Anatoly Slyusar: «La période de l'ordinateur européen nous a permis de former des programmeurs système et appliqués»</a></li>
<li><a href="../fr458582/index.html">Un ingénieur d'Amazon a créé un dispositif de blocage de l'IA qui empêche les chats de sortir de la rue</a></li>
<li><a href="../fr458584/index.html">11 juillet, Webinaire Group-IB «Analyse des logiciels malveillants pour les débutants: approches de base»</a></li>
<li><a href="../fr458590/index.html">Approches architecturales dans les applications iOS</a></li>
<li><a href="../fr458592/index.html">De la latence Ceph élevée au patch du noyau avec eBPF / BCC</a></li>
<li><a href="../fr458594/index.html">N'oubliez pas d'augmenter les chances de réponse au client en utilisant une demande répétée dans l'équilibrage L7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>