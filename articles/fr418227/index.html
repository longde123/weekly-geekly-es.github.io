<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘† ğŸ¤¦ğŸ» ğŸ‘ŒğŸ¿ Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Le Sandbox Native Client, Partie 3 ğŸ‘‡ ğŸš ğŸ“’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "SÃ©curitÃ© des systÃ¨mes informatiques." Nikolai Zeldovich, James Mickens. 2014 annÃ©e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Le Sandbox Native Client, Partie 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418227/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "SÃ©curitÃ© des systÃ¨mes informatiques."  Nikolai Zeldovich, James Mickens.  2014 annÃ©e </h3><br>  Computer Systems Security est un cours sur le dÃ©veloppement et la mise en Å“uvre de systÃ¨mes informatiques sÃ©curisÃ©s.  Les confÃ©rences couvrent les modÃ¨les de menace, les attaques qui compromettent la sÃ©curitÃ© et les techniques de sÃ©curitÃ© basÃ©es sur des travaux scientifiques rÃ©cents.  Les sujets incluent la sÃ©curitÃ© du systÃ¨me d'exploitation (OS), les fonctionnalitÃ©s, la gestion du flux d'informations, la sÃ©curitÃ© des langues, les protocoles rÃ©seau, la sÃ©curitÃ© matÃ©rielle et la sÃ©curitÃ© des applications Web. <br><br>  Cours 1: Â«Introduction: modÃ¨les de menaceÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 2: Â«ContrÃ´le des attaques de piratesÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 3: Â«DÃ©bordements de tampon: exploits et protectionÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 4: Â«SÃ©paration des privilÃ¨gesÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 5: Â«D'oÃ¹ viennent les systÃ¨mes de sÃ©curitÃ©?Â» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> <br>  ConfÃ©rence 6: Â«OpportunitÃ©sÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 7: Â«Native Client SandboxÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  Il y a une mise en garde dans la rÃ¨gle <b>C4</b> .  Vous ne pouvez pas "sauter" la fin d'un programme.  La derniÃ¨re chose Ã  laquelle vous pouvez accÃ©der est la derniÃ¨re instruction.  Cette rÃ¨gle garantit donc que lorsque le programme est exÃ©cutÃ© dans le processus Â«moteurÂ», il n'y aura pas de divergence. <br><br>  La rÃ¨gle <b>C5</b> indique qu'il ne peut pas y avoir d'instructions supÃ©rieures Ã  32 octets.  Nous avons envisagÃ© une certaine version de cette rÃ¨gle lorsque nous avons parlÃ© de la multiplicitÃ© des tailles d'instruction Ã  32 octets, sinon vous pouvez sauter au milieu de l'instruction et crÃ©er un problÃ¨me avec l'appel systÃ¨me, qui peut s'y Â«cacherÂ». <br><br>  La rÃ¨gle <b>C6</b> stipule que toutes les instructions disponibles peuvent Ãªtre dÃ©sassemblÃ©es dÃ¨s le dÃ©but.  Ainsi, cela garantit que nous voyons chaque instruction et peut vÃ©rifier toutes les instructions qui s'exÃ©cutent lorsque le programme s'exÃ©cute. <br><br>  La rÃ¨gle <b>C7</b> stipule que tous les sauts directs sont corrects.  Par exemple, vous passez directement Ã  la partie de l'instruction oÃ¹ la cible est indiquÃ©e, et bien qu'il ne s'agisse pas d'un multiple de 32, c'est toujours l'instruction correcte Ã  laquelle le dÃ©sassemblage est appliquÃ© de gauche Ã  droite. <br><br><img src="https://habrastorage.org/webt/1-/3i/vl/1-3ivlo26n7llpnkbkvzgzm-tci.jpeg"><br><br>  <b>Public:</b> quelle est la diffÃ©rence entre <b>C5</b> et <b>C3</b> ? <br><br>  <b>Professeur:</b> Je pense que <b>C5</b> dit que si j'ai une instruction multi-octets, elle ne peut pas traverser les frontiÃ¨res des adresses adjacentes.  Supposons que j'ai un flux d'instructions et qu'il y ait une adresse 32 et une adresse 64. Ainsi, une instruction ne peut pas franchir le multiple de 32 octets, c'est-Ã -dire qu'elle ne doit pas commencer par une adresse infÃ©rieure Ã  64 et se terminer par une adresse supÃ©rieure Ã  64. <br><br><img src="https://habrastorage.org/webt/di/oc/l5/diocl5ztxk3kmc1ol0mmm_badik.jpeg"><br><br>  C'est ce que dit la rÃ¨gle <b>C5</b> .  Parce qu'autrement, aprÃ¨s avoir fait un saut de multiplicitÃ© 32, vous pouvez entrer au milieu d'une autre instruction, oÃ¹ l'on ne sait pas ce qui se passe. <br><br>  Et la rÃ¨gle <b>C3</b> est un analogue de cette interdiction du cÃ´tÃ© du saut.  Il indique que chaque fois que vous sautez, la longueur de votre saut doit Ãªtre un multiple de 32. <br><br>  <b>C5</b> prÃ©tend Ã©galement que tout ce qui est dans la plage d'adresses qui est un multiple de 32 est une instruction sÃ»re. <br><br>  AprÃ¨s avoir lu la liste de ces rÃ¨gles, j'ai eu un sentiment mitigÃ©, car je n'ai pas pu Ã©valuer si ces rÃ¨gles sont suffisantes, c'est-Ã -dire que la liste est minimale ou complÃ¨te. <br>  RÃ©flÃ©chissons donc aux devoirs que vous devez accomplir.  Je pense qu'en fait il y a une erreur dans le fonctionnement du <b>Native Client</b> lors de l'exÃ©cution de certaines instructions compliquÃ©es dans le sandbox.  Je pense qu'ils n'avaient pas le bon codage de longueur, ce qui pourrait conduire Ã  quelque chose de mauvais, mais je ne me souviens pas exactement de l'erreur. <br><br>  Supposons qu'un validateur de bac Ã  sable obtienne incorrectement la longueur d'une sorte d'instruction.  Quel mal peut arriver dans ce cas?  Comment utiliseriez-vous ce feuillet? <br><br>  <b>Public:</b> par exemple, vous pouvez masquer l'appel systÃ¨me ou l'instruction return return. <br><br>  <b>Professeur:</b> oui.  Supposons qu'il existe une version sophistiquÃ©e de l'instruction <b>AND</b> que vous avez notÃ©e.  Il est possible que le validateur se soit trompÃ© et ait considÃ©rÃ© que sa longueur est de 6 octets avec la longueur rÃ©elle de 5 octets. <br><br><img src="https://habrastorage.org/webt/2z/ak/mg/2zakmgsficxcsi5tqkqnb-r_tj4.jpeg"><br><br>  Que va-t-il se passer?  Le validateur considÃ¨re que la longueur de cette instruction est de 6 octets et a une autre instruction valide derriÃ¨re elle.  Mais le processeur, lors du lancement du code, utilise la longueur rÃ©elle de l'instruction, soit 5 octets.  Par consÃ©quent, nous avons un octet libre Ã  la fin de l'instruction <b>AND</b> , oÃ¹ nous pourrions insÃ©rer un appel systÃ¨me et l'utiliser Ã  notre avantage.  Et si nous insÃ©rons un octet de <b>CD</b> ici, ce sera comme le dÃ©but d'une autre instruction.  Ensuite, nous mettrons quelque chose dans la prochaine plage de 6 octets, et cela ressemblera Ã  une instruction qui commence par l'octet <b>CD</b> , bien qu'en fait elle fasse partie de l'instruction <b>AND</b> .  AprÃ¨s cela, nous pouvons effectuer un appel systÃ¨me et Â«s'Ã©chapperÂ» du bac Ã  sable. <br><br>  Ainsi, le validateur <b>Native Client</b> doit synchroniser ses actions avec les actions du <b>CPU</b> , c'est-Ã -dire Â«devinerÂ» exactement comment le processeur interprÃ©tera chaque instruction.  Et cela devrait Ãªtre Ã  tous les niveaux du bac Ã  sable, ce qui est assez difficile Ã  mettre en Å“uvre. <br><br>  En fait, il existe d'autres erreurs intÃ©ressantes dans le <b>client natif</b> .  L'un d'eux est le nettoyage incorrect de l'environnement du processeur lors du passage au <b>Trusted Service Runtime</b> .  Je pense que nous en parlerons dans une seconde.  Mais le <b>Trusted Service Runtime</b> fonctionnera essentiellement avec le mÃªme ensemble de registres <b>CPU</b> qui sont conÃ§us pour exÃ©cuter des modules non approuvÃ©s.  Donc, si le processeur oublie d'effacer quelque chose ou de redÃ©marrer, le runtime peut Ãªtre trompÃ© en considÃ©rant le module non fiable comme une application de confiance et en faisant quelque chose qu'il n'aurait pas dÃ» faire ou qui n'Ã©tait pas l'intention des dÃ©veloppeurs. <br><br>  OÃ¹ en sommes-nous maintenant?  Pour le moment, nous comprenons comment dÃ©monter toutes les instructions et comment empÃªcher l'exÃ©cution d'instructions interdites.  Voyons maintenant comment nous stockons la mÃ©moire et les liens pour le code et les donnÃ©es dans le module <b>Native Client</b> . <br><br>  Pour des raisons de performances, les gars de <b>Native Client</b> commencent Ã  utiliser la prise en charge matÃ©rielle pour s'assurer que le stockage de la mÃ©moire et des liens ne cause pas vraiment beaucoup de surcharge.  Mais avant d'envisager le support matÃ©riel qu'ils utilisent, je veux entendre des suggestions, comment pourrais-je faire de mÃªme sans le support matÃ©riel?  Pouvons-nous simplement fournir l'accÃ¨s Ã  tous les processus de mÃ©moire dans les limites dÃ©finies par la machine plus tÃ´t? <br><br>  <b>Public:</b> Vous pouvez instrumenter des instructions pour effacer tous les bits hauts. <br><br><img src="https://habrastorage.org/webt/h1/b7/yg/h1b7ygdlwrvvs7y7ywxitmabec8.jpeg"><br><br>  <b>Professeur:</b> oui, c'est vrai.  En fait, nous voyons que nous avons cette instruction <b>ET</b> ici, et chaque fois, par exemple, que nous sautons quelque part, cela efface les bits bas.  Mais si nous voulons conserver tout le code possible qui s'exÃ©cute dans les 256 Mo bas, nous pouvons simplement remplacer le premier attribut <b>f</b> par <b>0</b> et obtenir <b>$ 0x0fffffe0</b> au lieu de <b>$ 0xffffffe0</b> .  Cela efface les bits bas et dÃ©finit une limite supÃ©rieure de 256 Mo. <br><br>  Ainsi, cela fait exactement ce que vous proposez, en vous assurant que chaque fois que vous sautez, vous Ãªtes Ã  moins de 256 Mo.  Et le fait que nous procÃ©dions au dÃ©montage permet Ã©galement de vÃ©rifier que tous les sauts directs sont Ã  portÃ©e de main. <br><br>  La raison pour laquelle ils ne le font pas pour leur code est que sur la plate-forme <b>x86</b> , vous pouvez trÃ¨s efficacement coder <b>AND</b> , oÃ¹ tous les bits supÃ©rieurs sont 1. Cela se traduit par l'existence d'une instruction de 3 octets pour <b>AND</b> et d'une instruction de 2 octets pour le saut.  Ainsi, nous avons une dÃ©pense supplÃ©mentaire de 3 octets.  Mais si vous avez besoin d'un bit Ã©levÃ© non unitaire, comme ce <b>0</b> au lieu de <b>f</b> , vous avez soudainement une instruction de 5 octets.  Par consÃ©quent, je pense que dans ce cas, ils sont prÃ©occupÃ©s par les frais gÃ©nÃ©raux. <br><br>  <b>Public:</b> Y a <b>-</b> t-il un problÃ¨me avec l'existence de certaines instructions qui incrÃ©mentent la version que vous essayez d'obtenir?  Autrement dit, vous pouvez dire que votre instruction peut avoir un biais constant ou quelque chose comme Ã§a? <br><br>  <b>Professeur:</b> Je pense que oui.  Vous interdirez probablement les instructions qui sautent Ã  une formule d'adresse complexe et ne supporterez que les instructions qui sautent directement Ã  cette valeur, et cette valeur obtient toujours <b>AND</b> . <br><br>  <b>Public:</b> il est plus nÃ©cessaire d'accÃ©der Ã  la mÃ©moire que ... <br><br>  <b>Professeur:</b> oui, parce que c'est juste du code.  Et pour accÃ©der Ã  la mÃ©moire sur la plate-forme <b>x86</b> , il existe de nombreuses faÃ§ons Ã©tranges d'accÃ©der Ã  un emplacement de mÃ©moire spÃ©cifique.  Habituellement, vous devez d'abord calculer l'emplacement de la mÃ©moire, puis ajouter un <b>ET</b> supplÃ©mentaire <b>,</b> et ensuite seulement y accÃ©der.  Je pense que c'est la vraie raison de leur inquiÃ©tude quant Ã  la baisse des performances due Ã  l'utilisation de cette boÃ®te Ã  outils. <br><br>  Sur la plate-forme <b>x86</b> , ou au moins sur la plate-forme 32 bits dÃ©crite dans l'article, ils utilisent la prise en charge matÃ©rielle au lieu de restreindre le code et les donnÃ©es d'adresse rÃ©fÃ©renÃ§ant les modules non approuvÃ©s. <br><br>  Voyons Ã  quoi il ressemble avant de dÃ©couvrir comment utiliser le module <b>NaCl</b> dans un bac Ã  sable.  Ce matÃ©riel est appelÃ© segmentation.  Il est survenu avant mÃªme que la plate-forme <b>x86 ne</b> reÃ§oive un fichier d'Ã©change.  Sur la plate-forme <b>x86</b> , une table matÃ©rielle prise en charge existe pendant le processus.  Nous l'appelons le tableau des descripteurs de segments.  Il s'agit d'un groupe de segments numÃ©rotÃ©s de 0 Ã  la fin d'un tableau de n'importe quelle taille.  C'est quelque chose comme un descripteur de fichier sous <b>Unix</b> , sauf que chaque entrÃ©e se compose de 2 valeurs: la base de <b>base</b> et la longueur. <br><br>  Ce tableau nous indique que nous avons une paire de segments, et chaque fois que nous nous rÃ©fÃ©rons Ã  un segment spÃ©cifique, cela signifie dans un sens que nous parlons d'un morceau de mÃ©moire qui commence Ã  l'adresse de <b>base</b> de la <b>base</b> et continue sur la <b>longueur</b> . <br><br><img src="https://habrastorage.org/webt/bc/5z/ly/bc5zlyp2hzg0aa6nn9nfsbbzwoe.jpeg"><br><br>  Cela nous aide Ã  garder les limites de la mÃ©moire sur la plate-forme <b>x86</b> , car chaque instruction, accÃ©dant Ã  la mÃ©moire, fait rÃ©fÃ©rence Ã  un segment spÃ©cifique dans ce tableau. <br><br>  Par exemple, lorsque nous exÃ©cutons <b>mov (% eax), (% ebx)</b> , c'est-Ã -dire que nous dÃ©plaÃ§ons la valeur de la mÃ©moire d'un pointeur stockÃ© dans le registre <b>EAX</b> vers un autre pointeur stockÃ© dans le registre <b>EBX</b> , le programme sait quelles sont les adresses de dÃ©but et de fin. en vue de, et enregistrera la valeur dans la deuxiÃ¨me adresse. <br><br>  Mais en fait, sur la plate-forme <b>x86</b> , lorsque nous parlons de mÃ©moire, il existe une chose implicite appelÃ©e un descripteur de segment, similaire Ã  un descripteur de fichier sous <b>Unix</b> .  Il s'agit simplement d'un index dans la table des descripteurs et, sauf indication contraire, chaque code d'opÃ©ration contient un segment par dÃ©faut. <br><br>  Par consÃ©quent, lorsque vous exÃ©cutez <b>mov (% eax)</b> , il fait rÃ©fÃ©rence Ã  <b>% ds</b> ou au registre de segment de donnÃ©es, qui est un registre spÃ©cial dans votre processeur.  Si je me souviens bien, c'est un entier de 16 bits qui pointe vers cette table de descripteurs. <br><br>  Et il en va de mÃªme pour <b>(% ebx)</b> - il fait rÃ©fÃ©rence au mÃªme sÃ©lecteur de segment <b>% ds</b> .  En fait, en <b>x86,</b> nous avons un groupe de 6 sÃ©lecteurs de code: <b>CS, DS, ES, FS, GS</b> et <b>SS</b> .  Le <b>sÃ©lecteur d'appel CS est</b> implicitement utilisÃ© pour recevoir des instructions.  Donc, si le pointeur de votre instruction pointe sur quelque chose, il fait rÃ©fÃ©rence Ã  celui qui a sÃ©lectionnÃ© le sÃ©lecteur de segment <b>CS</b> . <br><br><img src="https://habrastorage.org/webt/li/vq/nz/livqnzyn6jk6muyb93siboedkik.jpeg"><br><br>  La plupart des rÃ©fÃ©rences de donnÃ©es utilisent implicitement <b>DS</b> ou <b>ES</b> , <b>FS</b> et <b>GS</b> indiquent des choses spÃ©ciales, et <b>SS est</b> toujours utilisÃ© pour les opÃ©rations de pile.  Et si vous faites du <b>push &amp; pop</b> , ils viennent implicitement de ce sÃ©lecteur de segment.  C'est une mÃ©canique plutÃ´t archaÃ¯que, mais elle s'avÃ¨re extrÃªmement utile dans ce cas particulier. <br><br>  Si vous avez accÃ¨s Ã  une adresse, par exemple, dans le sÃ©lecteur <b>% ds: addr</b> , le matÃ©riel la redirigera vers l'opÃ©ration avec la table <b>adrr + T [% ds] .base</b> .  Cela signifie qu'il prendra l'adresse de longueur de module de la mÃªme table.  Ainsi, chaque fois que vous accÃ©dez Ã  la mÃ©moire, il dispose d'une base de donnÃ©es de sÃ©lecteurs de segments sous la forme d'entrÃ©es de table de descripteurs, et il prend l'adresse que vous spÃ©cifiez et la fait correspondre avec la longueur du segment correspondant. <br><br>  <b>Public:</b> alors pourquoi n'est-il pas utilisÃ©, par exemple, pour protÃ©ger le tampon? <br><br>  <b>Professeur:</b> oui, c'est une bonne question!  Pourrions-nous l'utiliser pour se protÃ©ger contre les dÃ©passements de tampon?  Par exemple, pour chaque tampon que nous avons, vous pouvez mettre la base du tampon ici et lÃ  la taille du tampon. <br><br>  <b>Public:</b> que se passe-t-il si vous n'avez pas besoin de le mettre dans un tableau avant de l'Ã©crire?  Vous n'avez pas besoin d'Ãªtre lÃ  en permanence. <br><br>  <b>Professeur:</b> oui.  Par consÃ©quent, je pense que la raison pour laquelle cette approche n'est pas souvent utilisÃ©e pour se protÃ©ger contre les dÃ©bordements de tampon est que le nombre d'entrÃ©es dans ce tableau ne peut pas dÃ©passer 2 au 16e degrÃ©, car les descripteurs sont de 16 bits, mais en fait en fait, quelques bits de plus sont utilisÃ©s pour d'autres choses.  Donc, en fait, vous ne pouvez placer que 2 au 13e pouvoir des enregistrements dans ce tableau.  Par consÃ©quent, si vous avez dans votre code un tableau de donnÃ©es supÃ©rieur Ã  2 <sup>13</sup> , un dÃ©bordement de cette table peut se produire. <br><br>  De plus, il serait Ã©trange que le compilateur gÃ¨re directement cette table, car elle est gÃ©nÃ©ralement manipulÃ©e Ã  l'aide d'appels systÃ¨me.  Vous ne pouvez pas Ã©crire directement dans cette table, vous devez d'abord effectuer un appel systÃ¨me au systÃ¨me d'exploitation, aprÃ¨s quoi le systÃ¨me d'exploitation placera l'enregistrement dans cette table.  Par consÃ©quent, je pense que la plupart des compilateurs ne voudront tout simplement pas gÃ©rer un systÃ¨me de gestion de mÃ©moire tampon aussi complexe. <br><br><img src="https://habrastorage.org/webt/rp/sa/hb/rpsahbydh4eumva5z7st5cfuc2a.jpeg"><br><br>  Soit dit en passant, <b>Multex</b> utilise cette approche: il dispose de 2 <sup>18</sup> enregistrements pour divers segments et de 2 <sup>18</sup> enregistrements pour d'Ã©ventuels dÃ©calages.  Et chaque fragment de bibliothÃ¨que ou fragment de mÃ©moire commun est un segment distinct.  Ils sont tous vÃ©rifiÃ©s pour la plage et ne peuvent donc pas Ãªtre utilisÃ©s Ã  un niveau variable. <br><br>  <b>Public:</b> Vraisemblablement, le besoin constant d'utiliser le noyau ralentira le processus. <br><br>  <b>Professeur:</b> oui, c'est vrai.  Nous aurons donc des frais gÃ©nÃ©raux dus au fait que lorsqu'un nouveau tampon est soudainement crÃ©Ã© sur la pile, nous devons effectuer un appel systÃ¨me pour l'ajouter. <br><br>  Alors, combien de ces Ã©lÃ©ments utilisent rÃ©ellement le mÃ©canisme de segmentation?  Vous pouvez deviner comment cela fonctionne.  Je pense que, par dÃ©faut, tous ces segments en <b>x86</b> ont une base Ã©gale Ã  0, et la longueur est de 2 Ã  32. Ainsi, vous pouvez accÃ©der Ã  toute la plage de mÃ©moire que vous souhaitez.  Par consÃ©quent, pour <b>NaCl,</b> ils codent la base 0 et dÃ©finissent la longueur Ã  256 mÃ©gaoctets.  Ensuite, ils pointent vers tous les registres de 6 sÃ©lecteurs de segment dans cet enregistrement pour la zone de 256 Mo.  Ainsi, chaque fois que l'Ã©quipement accÃ¨de Ã  la mÃ©moire, il la modifie avec un dÃ©calage de 256 Mo.  La possibilitÃ© de modifier le module sera donc limitÃ©e Ã  256 Mo. <br><br>  Je pense que vous comprenez maintenant comment ce matÃ©riel est pris en charge et comment il fonctionne, de sorte que vous pourriez finir par utiliser ces sÃ©lecteurs de segments. <br>  Alors, qu'est-ce qui peut mal tourner si nous mettons simplement en Å“uvre ce plan?  Peut-on sauter du sÃ©lecteur de segment dans un module non fiable?  Je pense qu'une chose Ã  laquelle il faut faire attention est que ces registres sont comme des registres normaux, et vous pouvez y dÃ©placer des valeurs.  Par consÃ©quent, vous devez vous assurer que le module non approuvÃ© ne dÃ©forme pas ces registres de sÃ©lection de segment.  Parce que quelque part dans la table des descripteurs, il peut bien y avoir un enregistrement, qui est Ã©galement le descripteur de segment source pour un processus qui a une base de 0 et une longueur maximale de 2 <sup>32</sup> . <br><br><img src="https://habrastorage.org/webt/vg/k-/sv/vgk-svh5b3xlsnke_meuehgaira.jpeg"><br><br>  Donc, si un module non fiable a pu modifier <b>CS</b> , ou <b>DS</b> , ou <b>ES</b> , ou l'un de ces sÃ©lecteurs afin qu'ils commencent Ã  pointer vers ce systÃ¨me d'exploitation d'origine, qui couvre tout votre espace d'adressage, vous pouvez crÃ©er un lien mÃ©moire vers ce segment et " sauter hors du bac Ã  sable. <br><br>  Ainsi, le <b>client natif</b> a dÃ» ajouter quelques instructions supplÃ©mentaires Ã  cette liste interdite.  Je pense qu'ils interdisent toutes les instructions comme <b>mov% ds, es</b> et ainsi de suite.  Par consÃ©quent, une fois dans le bac Ã  sable, vous ne pouvez pas modifier le segment auquel se rÃ©fÃ¨rent certaines choses qui s'y rÃ©fÃ¨rent.  Sur la plate <b>-</b> forme <b>x86, les</b> instructions de modification de la table des descripteurs de segment sont privilÃ©giÃ©es, mais la modification des <b>ds, es</b> eux <b>-</b> mÃªmes <b>,</b> etc.  La table est totalement sans privilÃ¨ges. <br><br>  <b>Public:</b> pouvez-vous initialiser le tableau afin que la longueur nulle soit placÃ©e dans tous les emplacements inutilisÃ©s? <br><br>  <b>Professeur:</b> oui.  Vous pouvez dÃ©finir la longueur de la table pour quelque chose oÃ¹ il n'y a pas d'emplacements inutilisÃ©s.  Il s'avÃ¨re que vous avez vraiment besoin de cet emplacement supplÃ©mentaire contenant 0 et 2 <sup>32</sup> , car l'environnement d' <b>exÃ©cution approuvÃ©</b> doit dÃ©marrer dans ce segment et accÃ©der Ã  toute la plage de mÃ©moire.  Cette entrÃ©e est donc nÃ©cessaire pour que l'environnement d' <b>exÃ©cution</b> approuvÃ© fonctionne. <br><br>  Public: de quoi a-t-on besoin pour changer la longueur de la sortie du tableau? <br>  Professeur: vous devez avoir des privilÃ¨ges root.  <b>Linux a</b> en fait un systÃ¨me appelÃ© <b>modify_ldt ()</b> pour la table de descripteurs locaux, qui permet Ã  tout processus de modifier sa propre table, c'est-Ã -dire qu'il y a en fait une table pour chaque processus.  Mais sur la plate-forme <b>x86,</b> c'est plus compliquÃ©, il y a Ã  la fois une table globale et une table locale.  Une table locale pour un processus spÃ©cifique peut Ãªtre modifiÃ©e. <br><br>  Essayons maintenant de comprendre comment nous sautons et sautons du processus d'exÃ©cution de <b>Native Client</b> ou sortons du bac Ã  sable.  Que signifie sauter hors de nous? <br><br><img src="https://habrastorage.org/webt/8t/lb/yj/8tlbyjy5erf0s-x7stz29ca1qae.jpeg"><br><br>  Nous devons donc exÃ©cuter ce code de confiance, et ce code de confiance Â«vitÂ» quelque part au-dessus de la limite de 256 Mo.  Pour y aller, nous devrons annuler toutes les protections que <b>Native Client a</b> installÃ©es.  Fondamentalement, ils se rÃ©sument Ã  changer ces six sÃ©lecteurs.  Je pense que notre validateur ne va pas appliquer les mÃªmes rÃ¨gles pour les choses situÃ©es au-dessus de la limite de 256 Mo, donc c'est assez simple. <br><br>  Mais ensuite, nous devons en quelque sorte sauter dans le <b>runtime d'exÃ©cution de confiance</b> et rÃ©installer les sÃ©lecteurs de segment aux valeurs correctes pour ce segment gÃ©ant, couvrant l'espace d'adressage de l'ensemble du processus - cette plage va de 0 Ã  2 <sup>32</sup> .  Ils ont appelÃ© de tels mÃ©canismes existant dans les <b>trampolines</b> et tremplins Â«trampolineÂ» <b>Native Client</b> .  Ils vivent dans un module bas de 64k.  Le plus cool est que ces Â«trampolinesÂ» et Â«sautsÂ» sont des morceaux de code se trouvant dans les 64k infÃ©rieurs de l'espace de processus.  Cela signifie que ce module peu fiable peut y sauter, car il s'agit d'une adresse de code valide dans les limites de 32 bits et de 256 Mo.  Vous pouvez donc sauter sur ce trampoline. <br><br>    <b>Native Client</b>    Â«Â» - .  ,  <b>Native Client</b>       Â«Â»,   trampoline      <b>trusted runtime</b> .         ,    <b>DS, CS</b>   ,       . <br><br>  ,        ,   -  <b>malo</b>   ,    Â«Â»,  Â«Â»  32-  . <br><br> ,     4096 + 32        ,     .   , ,   <b>mov %ds, 7</b> ,       <b>ds</b> ,   7         0  2 <sup>32</sup> .    <b>CS</b>       <b>trusted service runtime</b> ,     256 . <br><br><img src="https://habrastorage.org/webt/cr/fx/xj/crfxxjwdpg1tcflmflesmj_8obq.jpeg"><br><br>  ,     ,     ,         <b>trusted service runtime</b> ,    .            ,   .      DS ,   ,      ,     ,    -       . <br><br> ,        ? ,          Â«Â»? ,    ? <br><br> <b>:</b>    64. <br><br> <b>:</b> , ,          .         malo,       64,     32 .        ,       ,  ,     . <br><br>   ,        32-  ,       .  , ,        32 ,     32-    ,    .       Â«Â»    <b>trusted runtime</b>   32  . <br><br><img src="https://habrastorage.org/webt/hq/zy/tj/hqzytj99szvgxayslg6aqmwlmrk.jpeg"><br><br>      .     ,     ,     <b>DS, CS</b>   .    ,       256-  ,    <b>trusted runtime</b> ,      .                 . <br><br>         Â«Â»,      <b>trusted runtime</b>   256     <b>Native Client</b> . Â«Â»   <b>DS</b> , ,  <b>mov %ds, 7</b> ,        ,  <b>trusted runtime</b>    .     .     ,        Â«Â»,       - . <br><br>      <b>halt</b>    32-   Â«Â».        Â«Â»,   .      <b>trusted service runtime</b>      ,   1    . <br><br><img src="https://habrastorage.org/webt/50/am/cy/50amcyeulmago9zmrdvmjrsipvg.jpeg"><br><br>       <b>trusted service runtime</b> ,     ,        . <br><br> <b>:</b>   Â«Â»    ? <br><br> <b>:</b> Â«Â»     0  256   .        64-     ,    ,       Â«Â»,    - -.     <b>Native Client</b>       . <br><br> <b>:</b>          ? <br><br> <b>:</b> ,         ?  ,      Â«Â»?   ? <br><br> <b>:</b>    ,   ? <br><br> <b>:</b>  ,            -  <b>%eax</b> ,  <b>trusted runtime</b> : Â«,      Â»!      <b>EAX</b> ,    <b>mov</b> ,  Â«Â»      <b>EAX</b> ,        <b>trusted runtime</b> .   ,       Â«Â»? <br><br> <b>:</b> ,        ,         .   â€¦ <br><br> <b>:</b> ,   ,       â€”  ,       ,            0  2 <sup>32</sup> .   .         Â«Â»,                256 . <br><br>  ,      Â«Â»,          .  , Â«Â»    ,    .    ,   Â«Â»   . <br><br> <b>:</b>    Â«Â»   256 ? <br><br> <b>:</b>  ,      .    ,       <b>CS</b>         -  .     Â«Â»,       <b>halt</b> ,   mov,    <b>CS</b> ,        ,       256 . <br><br>  ,         ,    Â«Â».  ,       <b>DS</b> ,  ,  <b>CS</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et sauter quelque part. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probablement, si vous essayiez, vous pourriez trouver une sÃ©quence d'instructions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui pourrait le faire en dehors des limites de l'espace d'adressage du module </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Native Client</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, Ã  la semaine prochaine et parlez de la sÃ©curitÃ© Web.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I0Psvvky-44" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version complÃ¨te du cours est disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci de rester avec nous.</font></font> Aimez-vous nos articles?  Vous voulez voir des matÃ©riaux plus intÃ©ressants?  Soutenez-nous en passant une commande ou en le recommandant Ã  vos amis, une <b>rÃ©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entrÃ©e de gamme que nous avons inventÃ©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la vÃ©ritÃ© sur VPS (KVM) E5-2650 v4 (6 cÅ“urs) 10 Go DDR4 240 Go SSD 1 Gbps Ã  partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'Ã  24 cÅ“urs et jusqu'Ã  40 Go de DDR4). <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS (KVM) E5-2650 v4 (6 cÅ“urs) 10 Go DDR4 240 Go SSD 1 Gbit / s jusqu'en dÃ©cembre gratuitement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en payant pour une pÃ©riode de six mois, vous pouvez commander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV Ã  partir de 249 $</a> aux Pays-Bas et aux Ã‰tats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crÃ©ation d'un bÃ¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coÃ»tant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418227/">https://habr.com/ru/post/fr418227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418217/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: Â«OpportunitÃ©sÂ», partie 1</a></li>
<li><a href="../fr418219/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: OpportunitÃ©s, partie 2</a></li>
<li><a href="../fr418221/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: Â«OpportunitÃ©sÂ», partie 3</a></li>
<li><a href="../fr418223/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Le Sandbox Native Client, Partie 1</a></li>
<li><a href="../fr418225/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Native Client Sandbox Part 2</a></li>
<li><a href="../fr418229/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 8: ModÃ¨le de sÃ©curitÃ© rÃ©seau, partie 1</a></li>
<li><a href="../fr418233/index.html">Les mnÃ©moniques BMW pour trouver les valeurs limites</a></li>
<li><a href="../fr418235/index.html">Saga orchestrÃ©e ou comment crÃ©er des transactions commerciales dans les services avec la base de donnÃ©es par modÃ¨le de service</a></li>
<li><a href="../fr418237/index.html">DÃ©veloppement d'applications multi-locataires sur la plateforme cloud SAP dans Neo, partie 2: autorisation et authentification</a></li>
<li><a href="../fr418239/index.html">48 mÃ©gapixels pour smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>