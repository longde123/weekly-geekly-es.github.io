<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆 🤦🏻 👌🏿 Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Le Sandbox Native Client, Partie 3 👇 🐚 📒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "Sécurité des systèmes informatiques." Nikolai Zeldovich, James Mickens. 2014 année...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Le Sandbox Native Client, Partie 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418227/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "Sécurité des systèmes informatiques."  Nikolai Zeldovich, James Mickens.  2014 année </h3><br>  Computer Systems Security est un cours sur le développement et la mise en œuvre de systèmes informatiques sécurisés.  Les conférences couvrent les modèles de menace, les attaques qui compromettent la sécurité et les techniques de sécurité basées sur des travaux scientifiques récents.  Les sujets incluent la sécurité du système d'exploitation (OS), les fonctionnalités, la gestion du flux d'informations, la sécurité des langues, les protocoles réseau, la sécurité matérielle et la sécurité des applications Web. <br><br>  Cours 1: «Introduction: modèles de menace» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 2: «Contrôle des attaques de pirates» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 3: «Débordements de tampon: exploits et protection» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 4: «Séparation des privilèges» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 5: «D'où viennent les systèmes de sécurité?» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> <br>  Conférence 6: «Opportunités» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 7: «Native Client Sandbox» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  Il y a une mise en garde dans la règle <b>C4</b> .  Vous ne pouvez pas "sauter" la fin d'un programme.  La dernière chose à laquelle vous pouvez accéder est la dernière instruction.  Cette règle garantit donc que lorsque le programme est exécuté dans le processus «moteur», il n'y aura pas de divergence. <br><br>  La règle <b>C5</b> indique qu'il ne peut pas y avoir d'instructions supérieures à 32 octets.  Nous avons envisagé une certaine version de cette règle lorsque nous avons parlé de la multiplicité des tailles d'instruction à 32 octets, sinon vous pouvez sauter au milieu de l'instruction et créer un problème avec l'appel système, qui peut s'y «cacher». <br><br>  La règle <b>C6</b> stipule que toutes les instructions disponibles peuvent être désassemblées dès le début.  Ainsi, cela garantit que nous voyons chaque instruction et peut vérifier toutes les instructions qui s'exécutent lorsque le programme s'exécute. <br><br>  La règle <b>C7</b> stipule que tous les sauts directs sont corrects.  Par exemple, vous passez directement à la partie de l'instruction où la cible est indiquée, et bien qu'il ne s'agisse pas d'un multiple de 32, c'est toujours l'instruction correcte à laquelle le désassemblage est appliqué de gauche à droite. <br><br><img src="https://habrastorage.org/webt/1-/3i/vl/1-3ivlo26n7llpnkbkvzgzm-tci.jpeg"><br><br>  <b>Public:</b> quelle est la différence entre <b>C5</b> et <b>C3</b> ? <br><br>  <b>Professeur:</b> Je pense que <b>C5</b> dit que si j'ai une instruction multi-octets, elle ne peut pas traverser les frontières des adresses adjacentes.  Supposons que j'ai un flux d'instructions et qu'il y ait une adresse 32 et une adresse 64. Ainsi, une instruction ne peut pas franchir le multiple de 32 octets, c'est-à-dire qu'elle ne doit pas commencer par une adresse inférieure à 64 et se terminer par une adresse supérieure à 64. <br><br><img src="https://habrastorage.org/webt/di/oc/l5/diocl5ztxk3kmc1ol0mmm_badik.jpeg"><br><br>  C'est ce que dit la règle <b>C5</b> .  Parce qu'autrement, après avoir fait un saut de multiplicité 32, vous pouvez entrer au milieu d'une autre instruction, où l'on ne sait pas ce qui se passe. <br><br>  Et la règle <b>C3</b> est un analogue de cette interdiction du côté du saut.  Il indique que chaque fois que vous sautez, la longueur de votre saut doit être un multiple de 32. <br><br>  <b>C5</b> prétend également que tout ce qui est dans la plage d'adresses qui est un multiple de 32 est une instruction sûre. <br><br>  Après avoir lu la liste de ces règles, j'ai eu un sentiment mitigé, car je n'ai pas pu évaluer si ces règles sont suffisantes, c'est-à-dire que la liste est minimale ou complète. <br>  Réfléchissons donc aux devoirs que vous devez accomplir.  Je pense qu'en fait il y a une erreur dans le fonctionnement du <b>Native Client</b> lors de l'exécution de certaines instructions compliquées dans le sandbox.  Je pense qu'ils n'avaient pas le bon codage de longueur, ce qui pourrait conduire à quelque chose de mauvais, mais je ne me souviens pas exactement de l'erreur. <br><br>  Supposons qu'un validateur de bac à sable obtienne incorrectement la longueur d'une sorte d'instruction.  Quel mal peut arriver dans ce cas?  Comment utiliseriez-vous ce feuillet? <br><br>  <b>Public:</b> par exemple, vous pouvez masquer l'appel système ou l'instruction return return. <br><br>  <b>Professeur:</b> oui.  Supposons qu'il existe une version sophistiquée de l'instruction <b>AND</b> que vous avez notée.  Il est possible que le validateur se soit trompé et ait considéré que sa longueur est de 6 octets avec la longueur réelle de 5 octets. <br><br><img src="https://habrastorage.org/webt/2z/ak/mg/2zakmgsficxcsi5tqkqnb-r_tj4.jpeg"><br><br>  Que va-t-il se passer?  Le validateur considère que la longueur de cette instruction est de 6 octets et a une autre instruction valide derrière elle.  Mais le processeur, lors du lancement du code, utilise la longueur réelle de l'instruction, soit 5 octets.  Par conséquent, nous avons un octet libre à la fin de l'instruction <b>AND</b> , où nous pourrions insérer un appel système et l'utiliser à notre avantage.  Et si nous insérons un octet de <b>CD</b> ici, ce sera comme le début d'une autre instruction.  Ensuite, nous mettrons quelque chose dans la prochaine plage de 6 octets, et cela ressemblera à une instruction qui commence par l'octet <b>CD</b> , bien qu'en fait elle fasse partie de l'instruction <b>AND</b> .  Après cela, nous pouvons effectuer un appel système et «s'échapper» du bac à sable. <br><br>  Ainsi, le validateur <b>Native Client</b> doit synchroniser ses actions avec les actions du <b>CPU</b> , c'est-à-dire «deviner» exactement comment le processeur interprétera chaque instruction.  Et cela devrait être à tous les niveaux du bac à sable, ce qui est assez difficile à mettre en œuvre. <br><br>  En fait, il existe d'autres erreurs intéressantes dans le <b>client natif</b> .  L'un d'eux est le nettoyage incorrect de l'environnement du processeur lors du passage au <b>Trusted Service Runtime</b> .  Je pense que nous en parlerons dans une seconde.  Mais le <b>Trusted Service Runtime</b> fonctionnera essentiellement avec le même ensemble de registres <b>CPU</b> qui sont conçus pour exécuter des modules non approuvés.  Donc, si le processeur oublie d'effacer quelque chose ou de redémarrer, le runtime peut être trompé en considérant le module non fiable comme une application de confiance et en faisant quelque chose qu'il n'aurait pas dû faire ou qui n'était pas l'intention des développeurs. <br><br>  Où en sommes-nous maintenant?  Pour le moment, nous comprenons comment démonter toutes les instructions et comment empêcher l'exécution d'instructions interdites.  Voyons maintenant comment nous stockons la mémoire et les liens pour le code et les données dans le module <b>Native Client</b> . <br><br>  Pour des raisons de performances, les gars de <b>Native Client</b> commencent à utiliser la prise en charge matérielle pour s'assurer que le stockage de la mémoire et des liens ne cause pas vraiment beaucoup de surcharge.  Mais avant d'envisager le support matériel qu'ils utilisent, je veux entendre des suggestions, comment pourrais-je faire de même sans le support matériel?  Pouvons-nous simplement fournir l'accès à tous les processus de mémoire dans les limites définies par la machine plus tôt? <br><br>  <b>Public:</b> Vous pouvez instrumenter des instructions pour effacer tous les bits hauts. <br><br><img src="https://habrastorage.org/webt/h1/b7/yg/h1b7ygdlwrvvs7y7ywxitmabec8.jpeg"><br><br>  <b>Professeur:</b> oui, c'est vrai.  En fait, nous voyons que nous avons cette instruction <b>ET</b> ici, et chaque fois, par exemple, que nous sautons quelque part, cela efface les bits bas.  Mais si nous voulons conserver tout le code possible qui s'exécute dans les 256 Mo bas, nous pouvons simplement remplacer le premier attribut <b>f</b> par <b>0</b> et obtenir <b>$ 0x0fffffe0</b> au lieu de <b>$ 0xffffffe0</b> .  Cela efface les bits bas et définit une limite supérieure de 256 Mo. <br><br>  Ainsi, cela fait exactement ce que vous proposez, en vous assurant que chaque fois que vous sautez, vous êtes à moins de 256 Mo.  Et le fait que nous procédions au démontage permet également de vérifier que tous les sauts directs sont à portée de main. <br><br>  La raison pour laquelle ils ne le font pas pour leur code est que sur la plate-forme <b>x86</b> , vous pouvez très efficacement coder <b>AND</b> , où tous les bits supérieurs sont 1. Cela se traduit par l'existence d'une instruction de 3 octets pour <b>AND</b> et d'une instruction de 2 octets pour le saut.  Ainsi, nous avons une dépense supplémentaire de 3 octets.  Mais si vous avez besoin d'un bit élevé non unitaire, comme ce <b>0</b> au lieu de <b>f</b> , vous avez soudainement une instruction de 5 octets.  Par conséquent, je pense que dans ce cas, ils sont préoccupés par les frais généraux. <br><br>  <b>Public:</b> Y a <b>-</b> t-il un problème avec l'existence de certaines instructions qui incrémentent la version que vous essayez d'obtenir?  Autrement dit, vous pouvez dire que votre instruction peut avoir un biais constant ou quelque chose comme ça? <br><br>  <b>Professeur:</b> Je pense que oui.  Vous interdirez probablement les instructions qui sautent à une formule d'adresse complexe et ne supporterez que les instructions qui sautent directement à cette valeur, et cette valeur obtient toujours <b>AND</b> . <br><br>  <b>Public:</b> il est plus nécessaire d'accéder à la mémoire que ... <br><br>  <b>Professeur:</b> oui, parce que c'est juste du code.  Et pour accéder à la mémoire sur la plate-forme <b>x86</b> , il existe de nombreuses façons étranges d'accéder à un emplacement de mémoire spécifique.  Habituellement, vous devez d'abord calculer l'emplacement de la mémoire, puis ajouter un <b>ET</b> supplémentaire <b>,</b> et ensuite seulement y accéder.  Je pense que c'est la vraie raison de leur inquiétude quant à la baisse des performances due à l'utilisation de cette boîte à outils. <br><br>  Sur la plate-forme <b>x86</b> , ou au moins sur la plate-forme 32 bits décrite dans l'article, ils utilisent la prise en charge matérielle au lieu de restreindre le code et les données d'adresse référençant les modules non approuvés. <br><br>  Voyons à quoi il ressemble avant de découvrir comment utiliser le module <b>NaCl</b> dans un bac à sable.  Ce matériel est appelé segmentation.  Il est survenu avant même que la plate-forme <b>x86 ne</b> reçoive un fichier d'échange.  Sur la plate-forme <b>x86</b> , une table matérielle prise en charge existe pendant le processus.  Nous l'appelons le tableau des descripteurs de segments.  Il s'agit d'un groupe de segments numérotés de 0 à la fin d'un tableau de n'importe quelle taille.  C'est quelque chose comme un descripteur de fichier sous <b>Unix</b> , sauf que chaque entrée se compose de 2 valeurs: la base de <b>base</b> et la longueur. <br><br>  Ce tableau nous indique que nous avons une paire de segments, et chaque fois que nous nous référons à un segment spécifique, cela signifie dans un sens que nous parlons d'un morceau de mémoire qui commence à l'adresse de <b>base</b> de la <b>base</b> et continue sur la <b>longueur</b> . <br><br><img src="https://habrastorage.org/webt/bc/5z/ly/bc5zlyp2hzg0aa6nn9nfsbbzwoe.jpeg"><br><br>  Cela nous aide à garder les limites de la mémoire sur la plate-forme <b>x86</b> , car chaque instruction, accédant à la mémoire, fait référence à un segment spécifique dans ce tableau. <br><br>  Par exemple, lorsque nous exécutons <b>mov (% eax), (% ebx)</b> , c'est-à-dire que nous déplaçons la valeur de la mémoire d'un pointeur stocké dans le registre <b>EAX</b> vers un autre pointeur stocké dans le registre <b>EBX</b> , le programme sait quelles sont les adresses de début et de fin. en vue de, et enregistrera la valeur dans la deuxième adresse. <br><br>  Mais en fait, sur la plate-forme <b>x86</b> , lorsque nous parlons de mémoire, il existe une chose implicite appelée un descripteur de segment, similaire à un descripteur de fichier sous <b>Unix</b> .  Il s'agit simplement d'un index dans la table des descripteurs et, sauf indication contraire, chaque code d'opération contient un segment par défaut. <br><br>  Par conséquent, lorsque vous exécutez <b>mov (% eax)</b> , il fait référence à <b>% ds</b> ou au registre de segment de données, qui est un registre spécial dans votre processeur.  Si je me souviens bien, c'est un entier de 16 bits qui pointe vers cette table de descripteurs. <br><br>  Et il en va de même pour <b>(% ebx)</b> - il fait référence au même sélecteur de segment <b>% ds</b> .  En fait, en <b>x86,</b> nous avons un groupe de 6 sélecteurs de code: <b>CS, DS, ES, FS, GS</b> et <b>SS</b> .  Le <b>sélecteur d'appel CS est</b> implicitement utilisé pour recevoir des instructions.  Donc, si le pointeur de votre instruction pointe sur quelque chose, il fait référence à celui qui a sélectionné le sélecteur de segment <b>CS</b> . <br><br><img src="https://habrastorage.org/webt/li/vq/nz/livqnzyn6jk6muyb93siboedkik.jpeg"><br><br>  La plupart des références de données utilisent implicitement <b>DS</b> ou <b>ES</b> , <b>FS</b> et <b>GS</b> indiquent des choses spéciales, et <b>SS est</b> toujours utilisé pour les opérations de pile.  Et si vous faites du <b>push &amp; pop</b> , ils viennent implicitement de ce sélecteur de segment.  C'est une mécanique plutôt archaïque, mais elle s'avère extrêmement utile dans ce cas particulier. <br><br>  Si vous avez accès à une adresse, par exemple, dans le sélecteur <b>% ds: addr</b> , le matériel la redirigera vers l'opération avec la table <b>adrr + T [% ds] .base</b> .  Cela signifie qu'il prendra l'adresse de longueur de module de la même table.  Ainsi, chaque fois que vous accédez à la mémoire, il dispose d'une base de données de sélecteurs de segments sous la forme d'entrées de table de descripteurs, et il prend l'adresse que vous spécifiez et la fait correspondre avec la longueur du segment correspondant. <br><br>  <b>Public:</b> alors pourquoi n'est-il pas utilisé, par exemple, pour protéger le tampon? <br><br>  <b>Professeur:</b> oui, c'est une bonne question!  Pourrions-nous l'utiliser pour se protéger contre les dépassements de tampon?  Par exemple, pour chaque tampon que nous avons, vous pouvez mettre la base du tampon ici et là la taille du tampon. <br><br>  <b>Public:</b> que se passe-t-il si vous n'avez pas besoin de le mettre dans un tableau avant de l'écrire?  Vous n'avez pas besoin d'être là en permanence. <br><br>  <b>Professeur:</b> oui.  Par conséquent, je pense que la raison pour laquelle cette approche n'est pas souvent utilisée pour se protéger contre les débordements de tampon est que le nombre d'entrées dans ce tableau ne peut pas dépasser 2 au 16e degré, car les descripteurs sont de 16 bits, mais en fait en fait, quelques bits de plus sont utilisés pour d'autres choses.  Donc, en fait, vous ne pouvez placer que 2 au 13e pouvoir des enregistrements dans ce tableau.  Par conséquent, si vous avez dans votre code un tableau de données supérieur à 2 <sup>13</sup> , un débordement de cette table peut se produire. <br><br>  De plus, il serait étrange que le compilateur gère directement cette table, car elle est généralement manipulée à l'aide d'appels système.  Vous ne pouvez pas écrire directement dans cette table, vous devez d'abord effectuer un appel système au système d'exploitation, après quoi le système d'exploitation placera l'enregistrement dans cette table.  Par conséquent, je pense que la plupart des compilateurs ne voudront tout simplement pas gérer un système de gestion de mémoire tampon aussi complexe. <br><br><img src="https://habrastorage.org/webt/rp/sa/hb/rpsahbydh4eumva5z7st5cfuc2a.jpeg"><br><br>  Soit dit en passant, <b>Multex</b> utilise cette approche: il dispose de 2 <sup>18</sup> enregistrements pour divers segments et de 2 <sup>18</sup> enregistrements pour d'éventuels décalages.  Et chaque fragment de bibliothèque ou fragment de mémoire commun est un segment distinct.  Ils sont tous vérifiés pour la plage et ne peuvent donc pas être utilisés à un niveau variable. <br><br>  <b>Public:</b> Vraisemblablement, le besoin constant d'utiliser le noyau ralentira le processus. <br><br>  <b>Professeur:</b> oui, c'est vrai.  Nous aurons donc des frais généraux dus au fait que lorsqu'un nouveau tampon est soudainement créé sur la pile, nous devons effectuer un appel système pour l'ajouter. <br><br>  Alors, combien de ces éléments utilisent réellement le mécanisme de segmentation?  Vous pouvez deviner comment cela fonctionne.  Je pense que, par défaut, tous ces segments en <b>x86</b> ont une base égale à 0, et la longueur est de 2 à 32. Ainsi, vous pouvez accéder à toute la plage de mémoire que vous souhaitez.  Par conséquent, pour <b>NaCl,</b> ils codent la base 0 et définissent la longueur à 256 mégaoctets.  Ensuite, ils pointent vers tous les registres de 6 sélecteurs de segment dans cet enregistrement pour la zone de 256 Mo.  Ainsi, chaque fois que l'équipement accède à la mémoire, il la modifie avec un décalage de 256 Mo.  La possibilité de modifier le module sera donc limitée à 256 Mo. <br><br>  Je pense que vous comprenez maintenant comment ce matériel est pris en charge et comment il fonctionne, de sorte que vous pourriez finir par utiliser ces sélecteurs de segments. <br>  Alors, qu'est-ce qui peut mal tourner si nous mettons simplement en œuvre ce plan?  Peut-on sauter du sélecteur de segment dans un module non fiable?  Je pense qu'une chose à laquelle il faut faire attention est que ces registres sont comme des registres normaux, et vous pouvez y déplacer des valeurs.  Par conséquent, vous devez vous assurer que le module non approuvé ne déforme pas ces registres de sélection de segment.  Parce que quelque part dans la table des descripteurs, il peut bien y avoir un enregistrement, qui est également le descripteur de segment source pour un processus qui a une base de 0 et une longueur maximale de 2 <sup>32</sup> . <br><br><img src="https://habrastorage.org/webt/vg/k-/sv/vgk-svh5b3xlsnke_meuehgaira.jpeg"><br><br>  Donc, si un module non fiable a pu modifier <b>CS</b> , ou <b>DS</b> , ou <b>ES</b> , ou l'un de ces sélecteurs afin qu'ils commencent à pointer vers ce système d'exploitation d'origine, qui couvre tout votre espace d'adressage, vous pouvez créer un lien mémoire vers ce segment et " sauter hors du bac à sable. <br><br>  Ainsi, le <b>client natif</b> a dû ajouter quelques instructions supplémentaires à cette liste interdite.  Je pense qu'ils interdisent toutes les instructions comme <b>mov% ds, es</b> et ainsi de suite.  Par conséquent, une fois dans le bac à sable, vous ne pouvez pas modifier le segment auquel se réfèrent certaines choses qui s'y réfèrent.  Sur la plate <b>-</b> forme <b>x86, les</b> instructions de modification de la table des descripteurs de segment sont privilégiées, mais la modification des <b>ds, es</b> eux <b>-</b> mêmes <b>,</b> etc.  La table est totalement sans privilèges. <br><br>  <b>Public:</b> pouvez-vous initialiser le tableau afin que la longueur nulle soit placée dans tous les emplacements inutilisés? <br><br>  <b>Professeur:</b> oui.  Vous pouvez définir la longueur de la table pour quelque chose où il n'y a pas d'emplacements inutilisés.  Il s'avère que vous avez vraiment besoin de cet emplacement supplémentaire contenant 0 et 2 <sup>32</sup> , car l'environnement d' <b>exécution approuvé</b> doit démarrer dans ce segment et accéder à toute la plage de mémoire.  Cette entrée est donc nécessaire pour que l'environnement d' <b>exécution</b> approuvé fonctionne. <br><br>  Public: de quoi a-t-on besoin pour changer la longueur de la sortie du tableau? <br>  Professeur: vous devez avoir des privilèges root.  <b>Linux a</b> en fait un système appelé <b>modify_ldt ()</b> pour la table de descripteurs locaux, qui permet à tout processus de modifier sa propre table, c'est-à-dire qu'il y a en fait une table pour chaque processus.  Mais sur la plate-forme <b>x86,</b> c'est plus compliqué, il y a à la fois une table globale et une table locale.  Une table locale pour un processus spécifique peut être modifiée. <br><br>  Essayons maintenant de comprendre comment nous sautons et sautons du processus d'exécution de <b>Native Client</b> ou sortons du bac à sable.  Que signifie sauter hors de nous? <br><br><img src="https://habrastorage.org/webt/8t/lb/yj/8tlbyjy5erf0s-x7stz29ca1qae.jpeg"><br><br>  Nous devons donc exécuter ce code de confiance, et ce code de confiance «vit» quelque part au-dessus de la limite de 256 Mo.  Pour y aller, nous devrons annuler toutes les protections que <b>Native Client a</b> installées.  Fondamentalement, ils se résument à changer ces six sélecteurs.  Je pense que notre validateur ne va pas appliquer les mêmes règles pour les choses situées au-dessus de la limite de 256 Mo, donc c'est assez simple. <br><br>  Mais ensuite, nous devons en quelque sorte sauter dans le <b>runtime d'exécution de confiance</b> et réinstaller les sélecteurs de segment aux valeurs correctes pour ce segment géant, couvrant l'espace d'adressage de l'ensemble du processus - cette plage va de 0 à 2 <sup>32</sup> .  Ils ont appelé de tels mécanismes existant dans les <b>trampolines</b> et tremplins «trampoline» <b>Native Client</b> .  Ils vivent dans un module bas de 64k.  Le plus cool est que ces «trampolines» et «sauts» sont des morceaux de code se trouvant dans les 64k inférieurs de l'espace de processus.  Cela signifie que ce module peu fiable peut y sauter, car il s'agit d'une adresse de code valide dans les limites de 32 bits et de 256 Mo.  Vous pouvez donc sauter sur ce trampoline. <br><br>    <b>Native Client</b>    «» - .  ,  <b>Native Client</b>       «»,   trampoline      <b>trusted runtime</b> .         ,    <b>DS, CS</b>   ,       . <br><br>  ,        ,   -  <b>malo</b>   ,    «»,  «»  32-  . <br><br> ,     4096 + 32        ,     .   , ,   <b>mov %ds, 7</b> ,       <b>ds</b> ,   7         0  2 <sup>32</sup> .    <b>CS</b>       <b>trusted service runtime</b> ,     256 . <br><br><img src="https://habrastorage.org/webt/cr/fx/xj/crfxxjwdpg1tcflmflesmj_8obq.jpeg"><br><br>  ,     ,     ,         <b>trusted service runtime</b> ,    .            ,   .      DS ,   ,      ,     ,    -       . <br><br> ,        ? ,          «»? ,    ? <br><br> <b>:</b>    64. <br><br> <b>:</b> , ,          .         malo,       64,     32 .        ,       ,  ,     . <br><br>   ,        32-  ,       .  , ,        32 ,     32-    ,    .       «»    <b>trusted runtime</b>   32  . <br><br><img src="https://habrastorage.org/webt/hq/zy/tj/hqzytj99szvgxayslg6aqmwlmrk.jpeg"><br><br>      .     ,     ,     <b>DS, CS</b>   .    ,       256-  ,    <b>trusted runtime</b> ,      .                 . <br><br>         «»,      <b>trusted runtime</b>   256     <b>Native Client</b> . «»   <b>DS</b> , ,  <b>mov %ds, 7</b> ,        ,  <b>trusted runtime</b>    .     .     ,        «»,       - . <br><br>      <b>halt</b>    32-   «».        «»,   .      <b>trusted service runtime</b>      ,   1    . <br><br><img src="https://habrastorage.org/webt/50/am/cy/50amcyeulmago9zmrdvmjrsipvg.jpeg"><br><br>       <b>trusted service runtime</b> ,     ,        . <br><br> <b>:</b>   «»    ? <br><br> <b>:</b> «»     0  256   .        64-     ,    ,       «»,    - -.     <b>Native Client</b>       . <br><br> <b>:</b>          ? <br><br> <b>:</b> ,         ?  ,      «»?   ? <br><br> <b>:</b>    ,   ? <br><br> <b>:</b>  ,            -  <b>%eax</b> ,  <b>trusted runtime</b> : «,      »!      <b>EAX</b> ,    <b>mov</b> ,  «»      <b>EAX</b> ,        <b>trusted runtime</b> .   ,       «»? <br><br> <b>:</b> ,        ,         .   … <br><br> <b>:</b> ,   ,       —  ,       ,            0  2 <sup>32</sup> .   .         «»,                256 . <br><br>  ,      «»,          .  , «»    ,    .    ,   «»   . <br><br> <b>:</b>    «»   256 ? <br><br> <b>:</b>  ,      .    ,       <b>CS</b>         -  .     «»,       <b>halt</b> ,   mov,    <b>CS</b> ,        ,       256 . <br><br>  ,         ,    «».  ,       <b>DS</b> ,  ,  <b>CS</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et sauter quelque part. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probablement, si vous essayiez, vous pourriez trouver une séquence d'instructions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui pourrait le faire en dehors des limites de l'espace d'adressage du module </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Native Client</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, à la semaine prochaine et parlez de la sécurité Web.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I0Psvvky-44" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version complète du cours est disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci de rester avec nous.</font></font> Aimez-vous nos articles?  Vous voulez voir des matériaux plus intéressants?  Soutenez-nous en passant une commande ou en le recommandant à vos amis, une <b>réduction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entrée de gamme que nous avons inventés pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la vérité sur VPS (KVM) E5-2650 v4 (6 cœurs) 10 Go DDR4 240 Go SSD 1 Gbps à partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'à 24 cœurs et jusqu'à 40 Go de DDR4). <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS (KVM) E5-2650 v4 (6 cœurs) 10 Go DDR4 240 Go SSD 1 Gbit / s jusqu'en décembre gratuitement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en payant pour une période de six mois, vous pouvez commander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV à partir de 249 $</a> aux Pays-Bas et aux États-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">création d'un bâtiment d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418227/">https://habr.com/ru/post/fr418227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418217/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: «Opportunités», partie 1</a></li>
<li><a href="../fr418219/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: Opportunités, partie 2</a></li>
<li><a href="../fr418221/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: «Opportunités», partie 3</a></li>
<li><a href="../fr418223/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Le Sandbox Native Client, Partie 1</a></li>
<li><a href="../fr418225/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Native Client Sandbox Part 2</a></li>
<li><a href="../fr418229/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 8: Modèle de sécurité réseau, partie 1</a></li>
<li><a href="../fr418233/index.html">Les mnémoniques BMW pour trouver les valeurs limites</a></li>
<li><a href="../fr418235/index.html">Saga orchestrée ou comment créer des transactions commerciales dans les services avec la base de données par modèle de service</a></li>
<li><a href="../fr418237/index.html">Développement d'applications multi-locataires sur la plateforme cloud SAP dans Neo, partie 2: autorisation et authentification</a></li>
<li><a href="../fr418239/index.html">48 mégapixels pour smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>