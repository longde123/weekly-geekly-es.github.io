<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüî¨ üêê ü§òüèø Bot√≥n m√°gico para LED en ATtiny4 ü§° üí¥ üë©üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SESAM 


 Una vez tuve hace mucho tiempo el interruptor milagroso sensible al tacto SESAM . Realmente me gust√≥. Pero los tiempos est√°n cambiando, ya n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot√≥n m√°gico para LED en ATtiny4</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411263/"><h4 id="sezam">  SESAM </h4><br><p> Una vez tuve hace mucho tiempo el interruptor milagroso sensible al tacto <em>SESAM</em> .  Realmente me gust√≥.  Pero los tiempos est√°n cambiando, ya no cabe en el interior, y luego no fue completamente dise√±ado para funcionar con todo tipo de l√°mparas de bajo consumo de moda.  Me gust√≥ el principio de gesti√≥n en √©l.  Un toque breve del sensor encendi√≥ / apag√≥ la luz, y uno largo ajust√≥ el brillo.  <em>A</em> qui√©n <em>le importa</em> : el interruptor autom√°tico fue <em>K145AP2</em> , un an√°logo de <em>Siemens S576B</em> (K145AP2 todav√≠a se vende). </p><br><p>  Bajo el corte, mi versi√≥n de emular el funcionamiento de este chip. </p><a name="habracut"></a><br><p>  No hace mucho tiempo, constru√≠ una tira de luz LED en un perfil de aluminio con un difusor sobre la mesa para m√≠ y surgi√≥ la pregunta sobre el interruptor.  Prepararse es de alguna manera engorroso.  Para que cuelgue del cable, no es hermoso, para poner un interruptor ordinario, arruina la vista, y realmente no hay a d√≥nde ir. </p><br><p>  Decid√≠ construir un interruptor, y para uno y un atenuador, en el extremo del aglomerado de 16 mm.  Haz que toque, cubre con una pegatina, que los fabricantes de muebles enmascaran con pernos. </p><br><h4 id="zhelezo">  Hierro </h4><br><p>  Comenz√≥ con un sensor.  <em>Prob√©</em> con el principio de transferencia de carga al <em>ATtiny13A</em> .  La opci√≥n est√° funcionando, pero era demasiado vago para molestarme con los par√°metros de autoajuste, etc.  Tampoco tom√≥ el terminado. </p><br><p>  Entonces decid√≠ intentar implementar el sensor en la biblioteca <em>QTouch</em> .  Como un sensor <em>ATtiny10</em> .  Hay una utilidad <em>lista</em> para <em>usar</em> que convierte <em>ATtiny10</em> en un bot√≥n t√°ctil con todas las ventajas.  Pero en la salida, el binario es dif√≠cil de agregar su c√≥digo all√≠.  Pens√© en qu√© hacer, navegu√© por Internet y luego me encontr√© <em>con una</em> menci√≥n del <em>TTP223</em> , el controlador de un bot√≥n t√°ctil.  Esta opci√≥n me fue perfecta. </p><br><p>  Como MK, la elecci√≥n recay√≥ en <em>ATtiny4</em> .  Tan peque√±o como <em>TTP223</em> , un temporizador de 16 bits.  S√≠, y durante mucho tiempo quise hacer algo √∫til en estos tinki. </p><br><p>  Como clave: <em>P3055LD</em> de la antigua placa base. </p><br><h4 id="pechatnaya-plata">  Placa de circuito </h4><br><p>  Al desarrollar una placa de circuito impreso, proced√≠ del hecho de que los agujeros en el extremo de la placa de aglomerado necesitaban el m√≠nimo posible, decid√≠ que un di√°metro de 7 mm ser√≠a suficiente.  El tablero result√≥ 7x28mm, dos capas. </p><br><p>  M√°s tarde, cuando se soldaba la placa, se hizo evidente que la placa no encajar√≠a en el orificio de 7 mm, al menos 9 mm, no tuvo en cuenta la altura de los elementos.  La idea con una pegatina de alguna manera tambi√©n dej√≥ de gustar.  ¬°Y luego un trozo de mueble me llam√≥ la atenci√≥n!  ¬°Dise√±ado para orificios de 10 mm y un di√°metro interno de exactamente 7 mm!  ¬°Todo coincidi√≥! </p><br><p>  El sensor se remueve en una bufanda separada que est√° soldada al extremo principal.  En las fotos puedes ver. </p><br><div class="spoiler">  <b class="spoiler_title">Im√°genes</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/getpro/geektimes/post_images/c90/811/124/c908111247ab756b2667c342f63910ef.jpg" alt="imagen genial"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/8e7/bb2/c17/8e7bb2c177c2f1f1940cc7a9edf1d7c6.jpg" alt="imagen genial"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/626/916/1bb/6269161bb3a78aa01bd7f6b77119af5d.jpg" alt="imagen genial"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e14/976/8f0/e149768f0a162a2598003f83d5741e4a.jpg" alt="imagen genial"></p></div></div><br><h4 id="programma">  El programa </h4><br><p>  El programa de control est√° escrito en ensamblador.  Cada 32 ms (temporizador de vigilancia) se sondea el sensor.  Dependiendo del estado actual y la duraci√≥n de la presi√≥n, se realizan ciertas acciones.  La l√≥gica del trabajo es ligeramente diferente del prototipo <em>K145AP2</em> </p><br><p>  Si la luz est√° apagada (estado despu√©s del encendido): </p><br><ul><li>  Una pulsaci√≥n breve enciende la iluminaci√≥n al mismo nivel en el que se apag√≥.  Cuando se enciende por primera vez con el brillo m√°ximo </li><li>  Pulsaci√≥n larga enciende la luz al m√°ximo nivel. </li></ul><br><p>  Si la luz est√° encendida: </p><br><ul><li>  Una pulsaci√≥n corta apaga la luz </li><li>  Una pulsaci√≥n larga cambia el brillo.  La direcci√≥n del cambio de brillo cambia al presionar repetidamente </li></ul><br><p>  Se ignoran las presiones demasiado cortas (interferencia) del programa.  El brillo se establece mediante el coeficiente PWM (16 bits).  Frecuencia PWM aproximadamente 122 Hz (8,000,000 Hz / 2 <sup>16</sup> ‚âà 122 Hz) </p><br><p>  <strong>Para compensar la percepci√≥n psicofisiol√≥gica del brillo de la iluminaci√≥n del brillo real, se produce un cambio en este √∫ltimo a lo largo de una porci√≥n de la par√°bola c√∫bica</strong> .  Por lo general, se usan tablas para esto, pero en mi versi√≥n se calcula el coeficiente.  El coeficiente var√≠a con la frecuencia PWM, es decir, cuando cambia el brillo, cada pulso se obtiene con su propia duraci√≥n.  El valor m√≠nimo de PWM es limitado por software. </p><br><p>  La mayor√≠a de las veces, MK duerme y consume alrededor de 16 microamperios junto con <em>TTP223</em> .  Es decir, el circuito es bastante adecuado para dispositivos con alimentaci√≥n aut√≥noma. </p><br><p>  <em>ATtiny4 tiene</em> seis pines.  Dos para el poder, uno predeterminado para restablecer.  Ya he involucrado a dos.  Solo queda uno.  Pens√© en c√≥mo usarlo.  Y luego record√© la computadora port√°til de un nuevo amigo con el trackpad Force Touch.  Como experimento, decid√≠ hacer algo similar.  No necesito mucha confiabilidad de la respuesta, y hay muchos vibromotores de tel√©fonos viejos.  Como resultado, implement√© tal funci√≥n en el programa que aparece un impulso breve en una salida libre, cuando se alcanza el l√≠mite de ajuste.  En <em>K145AP2,</em> cuando se alcanza el l√≠mite de ajuste, la direcci√≥n del ajuste cambia.  Por lo tanto, se necesitaba cierta habilidad para quitar la mano del sensor al m√°ximo o al m√≠nimo.  En mi implementaci√≥n, cuando se alcanza el borde, el ajuste se detiene.  El tiempo total de ajuste de un l√≠mite a otro es de aproximadamente 4 segundos. </p><br><p>  C√≥digo disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="¬°Emp√∫jalo!">GitHub</a> </p><br><h4 id="tpi-cherez-arduinu">  TPI a trav√©s de Arduino </h4><br><p>  Por separado, noto la programaci√≥n de MK.  Mi <em>JTAGICE3</em> no es compatible con la interfaz de programaci√≥n TPI.  Pero, afortunadamente, las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buenas personas escribieron un boceto sobre Arduin</a> para programar esta peque√±a cosa.  No de inmediato, pero todo funcion√≥ para m√≠, el firmware se inund√≥ y todo funcion√≥.  Adem√°s de arduins, se necesitan 4 resistencias.  Todo el proceso est√° pintado en un boceto. </p><br><h4 id="itog">  Resumen </h4><br><p>  El bot√≥n m√°gico est√° instalado y funciona seg√∫n lo previsto.  El consumo y las dimensiones actuales le permiten integrarse en dispositivos con alimentaci√≥n aut√≥noma. </p><br><p>  No obtuve el efecto esperado de la vibraci√≥n.  Aqu√≠ aparentemente se necesitan experimentos con el sitio de instalaci√≥n. </p><br><p>  En el prototipo <em>K145AP2</em> y el an√°logo <em>Siemens S576B</em> hay una conclusi√≥n "Sleep".  Este es un modo en el que el brillo cae muy lentamente hasta que se apaga por completo.  Seg√∫n lo previsto por el fabricante, para esto se instala un sensor adicional cerca de la cabecera de la cama.  16 bits del temporizador PWM habilitan este modo. </p><br><p>  Esto es de ideas para el futuro. </p><br><div class="spoiler">  <b class="spoiler_title">Bot√≥n en su lugar</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/getpro/geektimes/post_images/757/2da/2b5/7572da2b50cf61fc18aef6e609b80650.jpg" alt="imagen genial"></p></div></div><br><p>  Como todo </p><br><p>  Gracias a todos! </p><br><p>  UPD: Como promet√≠, elev√© la frecuencia PWM a casi 1kHz.  C√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="¬°Emp√∫jalo!">Github</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es411263/">https://habr.com/ru/post/es411263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es411253/index.html">La fusi√≥n de las estrellas de neutrones puso fin a las alternativas de la materia oscura y la energ√≠a oscura.</a></li>
<li><a href="../es411255/index.html">Aplicaciones descentralizadas para millones de usuarios en Ethereum</a></li>
<li><a href="../es411257/index.html">En los EE. UU., Crean un sistema l√°ser que asustar√° al enemigo con sonido</a></li>
<li><a href="../es411259/index.html">Conectamos un medidor de agua a una casa inteligente</a></li>
<li><a href="../es411261/index.html">Respuesta a la vibraci√≥n en pr√≥tesis: una nueva forma de mejorar el control de las extremidades bi√≥nicas</a></li>
<li><a href="../es411265/index.html">Casos de esp√≠as (Parte 3)</a></li>
<li><a href="../es411267/index.html">¬øQui√©n est√° realmente detr√°s de los nuevos tel√©fonos inteligentes con la marca Nokia?</a></li>
<li><a href="../es411269/index.html">Los tres componentes de "LOAD"</a></li>
<li><a href="../es411271/index.html">El auto el√©ctrico Tesla Autopilot se enreda en tramos de carretera dif√≠ciles</a></li>
<li><a href="../es411273/index.html">El primer estudio sobre el atractivo de los robolits.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>