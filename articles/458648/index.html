<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÄ üë®üèø‚Äçü§ù‚Äçüë®üèª üßïüèæ CI / CD con AWS y Bamboo üÜö üôáüèª üë®‚Äçüë®‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nuestro equipo consta de un desarrollador y un ingeniero de DevOps. Soy responsable de implementar la aplicaci√≥n en el cl√∫ster de Amazon ECS. Como ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CI / CD con AWS y Bamboo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/">  Nuestro equipo consta de un desarrollador y un ingeniero de DevOps.  Soy responsable de implementar la aplicaci√≥n en el cl√∫ster de Amazon ECS.  Como servidor CI / CD, uso Bamboo.  En este art√≠culo, describir√© en detalle c√≥mo implemento una aplicaci√≥n en un entorno de desarrollo. <br><br><img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br><br><h4>  Construir una imagen de Docker </h4><br>  Aqu√≠ sigo estos pasos: <br><br><ul><li>  Paso 1: Instalar y configurar Docker; </li><li>  Paso 2: Configurar artefactos en Bamboo; </li><li>  Paso 3: configurar el repositorio de Amazon ECR; </li><li>  Paso 4: compila la imagen de Docker en Bamboo. </li></ul><br><h1>  Paso 1: Instalar y configurar Docker </h1><br>  Primero, actualizo el servidor donde est√° instalado Bamboo, instalo los paquetes necesarios y configuro el repositorio de Docker.  Cabe se√±alar que instal√© Bamboo en el sistema operativo CentOS 7. La informaci√≥n sobre la instalaci√≥n de Docker en otros sistemas operativos se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.docker.com</a> . <br><br><pre><code class="plaintext hljs">$ sudo yum update $ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code> </pre> <br>  Luego instalo la aplicaci√≥n Docker e inicio el servicio: <br><br><pre> <code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl enable docker $ sudo systemctl start docker</code> </pre><br>  Luego agrego el usuario de bamb√∫ al grupo Docker: <br><br><pre> <code class="plaintext hljs">$ sudo usermod -aG docker bamboo $ sudo su - bamboo $ docker run hello-world</code> </pre><br>  Si, despu√©s de ejecutar estos comandos, Docker responde con el mensaje "¬°Hola desde Docker!", Entonces esto significa que mi instalaci√≥n funciona correctamente. <br><br><h1>  Paso 2. Configurar artefactos en Bamboo </h1><br>  El desarrollo de aplicaciones est√° en marcha en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grails</a> .  Al compilar la aplicaci√≥n, se crea un archivo con la extensi√≥n war.  Este archivo, en terminolog√≠a de Bamboo, es un artefacto.  Configure Bamboo para usar este archivo en tareas posteriores.  Para hacer esto, voy a la pesta√±a <b>Tareas</b> : <br><br><img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br><br>  Y configur√© la tarea de Grails, como se muestra a continuaci√≥n: <br><br><img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br><br>  Vemos que Grails primero borra la carpeta de compilaci√≥n, luego ejecuta las pruebas y finalmente crea un archivo war para el entorno de desarrollo. <br><br>  Despu√©s de eso, hago clic en la pesta√±a <b>Artefactos</b> y en el bot√≥n <b>Crear artefacto</b> : <br><br><img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br><br>  Defino un artefacto como se muestra a continuaci√≥n: <br><br><img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br><br>  Grails coloca el archivo war en el directorio <b>build / libs</b> .  Comprobar√© el par√°metro <b>Shared</b> , ya que necesitar√© este artefacto m√°s adelante. <br><br>  Ahora estoy creando un proyecto de implementaci√≥n y especificando un artefacto para usar en mi plan de compilaci√≥n: <br><br><img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br><br><img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br><br>  Tambi√©n configur√© la tarea de <b>descarga de artefactos</b> en el proyecto de implementaci√≥n: <br><br><img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br><br>  Por lo tanto, Bamboo ahora est√° configurado para usar un archivo war. <br><br><h1>  Paso 3. Configurar el repositorio de Amazon ECR </h1><br>  Amazon ECR es un servicio de almacenamiento y administraci√≥n de Docker para im√°genes.  Para configurar, abra la consola de AWS y seleccione ECR: <br><br><img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br><br>  Una vez creado el repositorio, obtengo la siguiente direcci√≥n: <br><br><pre> <code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard</code> </pre><br>  Despu√©s de completar la configuraci√≥n, aqu√≠ tambi√©n puede encontrar instrucciones sobre c√≥mo iniciar sesi√≥n, c√≥mo descargar una imagen del repositorio y cargar la imagen en el repositorio. <br><br><h1>  Paso 4: compila la imagen de Docker en Bamboo </h1><br>  Ahora necesito configurar el disparador para comenzar a construir la imagen de Docker.  Para hacer esto, voy a la pesta√±a <b>Disparadores</b> y hago clic en el bot√≥n <b>Agregar disparador</b> : <br><br><img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br><br>  Aqu√≠ selecciono la opci√≥n Construir despu√©s de compilar <b>correctamente el plan</b> para que la imagen de Docker se construya despu√©s de compilar el proyecto. <br><br>  Ahora necesitamos agregar la tarea de creaci√≥n de im√°genes Docker.  Para hacer esto, vaya a la pesta√±a <b>Tareas</b> , haga clic en <b>Agregar tarea</b> , seleccione el tipo <b>Docker</b> .  Ingrese una descripci√≥n y seleccione <b>Crear una imagen de Docker</b> en el men√∫ desplegable.  En el campo <b>Repositorio</b> , ingrese <br><br><pre> <code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest.</code> </pre><br>  En cuanto al Dockerfile, puede ser como se muestra a continuaci√≥n: <br><br><pre> <code class="plaintext hljs">FROM openjdk:8-jre COPY *.war /usr/src/onboard.war WORKDIR /usr/src CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"]</code> </pre><br>  Cuando inicia la aplicaci√≥n, debe especificar la base de datos.  Las variables de entorno DATASOURCE_URL, DATASOURCE_USERNAME, DATASOURCE_PASSWORD se utilizan para transmitir esta informaci√≥n a la aplicaci√≥n, pero sus valores se establecen cuando se inicia el contenedor. <br><br>  Esto completa el proceso de configuraci√≥n para ensamblar la imagen de Docker con la aplicaci√≥n.  El siguiente paso es configurar la descarga de esta imagen en el repositorio de Amazon ECR. <br><br><img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br><br><h4>  Subir imagen a Elastic Container Registry </h4><br>  Puede usar el Elastic Container Registry para almacenar im√°genes recopiladas con Bamboo.  Para lograr esto, sigo estos pasos: <br><br><ul><li>  Paso 1. Instalar Amazon ECR Docker Credential Helper </li><li>  Paso 2. Conecte la funci√≥n IAM al servidor Bamboo </li><li>  Paso 3: Configurar el trabajo de arranque de la imagen Docker </li></ul><br><h1>  Paso 1. Instalar Amazon ECR Docker Credential Helper </h1><br>  Para descargar im√°genes de Docker a Amazon ECR, debe tener credenciales.  Estas credenciales se pueden obtener ejecutando el comando <br><br><pre> <code class="plaintext hljs">aws ecr get-login</code> </pre><br>  Sin embargo, estas credenciales solo son v√°lidas por 12 horas.  Por lo tanto, puede ejecutar el comando anterior cada vez antes de cargar la imagen en el ECR, o instalar el Docker Credential Helper de ECR, que mantiene las credenciales temporales actualizadas e inicia sesi√≥n en el ECR.  Siga estos pasos para instalar ECR Docker Credential Helper. <br><br>  Primero necesita instalar <i>git</i> y luego clonar el repositorio de github: <br><br><pre> <code class="plaintext hljs">$ sudo yum install git $ sudo su - bamboo $ git clone https://github.com/awslabs/amazon-ecr-credential-helper.git $ make docker</code> </pre><br>  Luego debe colocar las siguientes l√≠neas en el archivo <i>/home/bamboo/.docker/config.json</i> : <br><br><pre> <code class="plaintext hljs">{ "credsStore": "ecr-login" }</code> </pre><br>  Y copie la aplicaci√≥n compilada en el <i>directorio / usr / bin</i> : <br><br><pre> <code class="plaintext hljs">$ exit $ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/</code> </pre><br><h1>  Paso 2. Conecte la funci√≥n IAM al servidor Bamboo </h1><br>  Para que el servidor Bamboo pueda usar ECR, debe crear un rol, agregar la pol√≠tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AmazonEC2ContainerRegistryPowerUser</a> a este rol y luego adjuntar este rol a la instancia de EC2 Bamboo.  Abra la consola de AWS y seleccione IAM.  A continuaci√≥n, haga clic en el bot√≥n <b>Crear rol</b> , seleccione el <b>servicio AWS</b> y <b>EC2</b> , como se muestra a continuaci√≥n: <br><br><img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br><br>  Luego hacemos clic en el bot√≥n <b>Siguiente: Permisos</b> y en la siguiente pantalla encontramos y seleccionamos la pol√≠tica <b>AmazonEC2ContainerRegistryPowerUser</b> .  Despu√©s de eso, terminamos de crear el rol y lo adjuntamos a nuestro servidor Bamboo. <br><br><h1>  Paso 3: Configurar el trabajo de arranque de la imagen Docker </h1><br>  La aplicaci√≥n que creamos y creamos una imagen de Docker con un archivo de guerra.  Ahora necesita subir esta imagen al repositorio.  Para hacer esto, agrego otra tarea de Docker, esta vez para cargar la imagen en el repositorio de ECR.  Voy a la pesta√±a <b>Tareas</b> , hago clic en <b>Agregar tarea</b> , selecciono el tipo <b>Docker</b> .  Entro en una descripci√≥n y selecciono <b>Insertar una imagen de Docker en un registro de Docker</b> en el men√∫ desplegable.  Selecciono <b>Registro personalizado</b> e ingreso la direcci√≥n del repositorio en el campo <b>Repositorio</b> .  Para el <b>tipo de autenticaci√≥n,</b> selecciono <b>Usar las credenciales nativas del agente</b> . <br><br>  Esto completa el proceso de configuraci√≥n para cargar la imagen de Docker en el repositorio de Amazon ECR.  Los siguientes pasos describen el proceso de configuraci√≥n de un cl√∫ster y un servicio para iniciar una aplicaci√≥n de contenedor.  Pero antes de eso, debe configurar las opciones de inicio para el contenedor.  Esto es lo que haremos ahora. <br><br><img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br><br><h4>  Crear definici√≥n de tarea de Amazon ECS </h4><br>  Definici√≥n de tarea: aqu√≠ se escriben los par√°metros de ejecuci√≥n del contenedor.  Nuestra aplicaci√≥n utiliza una base de datos cuyos par√°metros se especifican cuando se inicia el contenedor, por lo que en esta secci√≥n tambi√©n crearemos una base de datos.  Utilizo <b>Amazon RDS</b> como la base de datos y almaceno la contrase√±a para acceder a la base de datos en forma cifrada en <b>AWS Systems Manager Parameter Store</b> .  Los siguientes pasos que sigo para crear una Definici√≥n de tarea: <br><br><ul><li>  Paso 1. Crear una base de datos en una instancia de Amazon RDS; </li><li>  Paso 2. Configuraci√≥n del almac√©n de par√°metros de AWS Systems Manager; </li><li>  Paso 3. Crear definici√≥n de tarea. </li></ul><br><h1>  Paso 1. Crear una base de datos en una instancia de Amazon RDS </h1><br>  Nuestra aplicaci√≥n utiliza la base de datos PostgreSQL.  Para crear una base de datos, abra la consola de AWS, seleccione el servicio Amazon RDS, haga clic en el bot√≥n <b>Crear base de datos</b> , luego seleccione <b>PostgreSQL</b> como motor de base de datos.  En la p√°gina siguiente, selecciono <b>Dev / Test</b> como el entorno de trabajo y hago clic en <b>Siguiente</b> .  Luego designo el <b>identificador de instancia de DB como onboard-dev-db</b> , y el <b>nombre de usuario maestro</b> como <b>devdbadmin</b> .  Luego voy a la p√°gina siguiente para configurar la VPC, el grupo de subred y el grupo de seguridad.  Esta base de datos se usar√° en una red privada, por lo que selecciono <b>No</b> para el par√°metro <b>Accesibilidad p√∫blica</b> .  <b>Entro</b> en <b>devdb</b> en el <b>campo</b> <b>Nombre de</b> la <b>base de datos</b> y <b>hago</b> clic en el bot√≥n <b>Crear base de datos</b> . <br><br><h1>  Paso 2. Configuraci√≥n del almac√©n de par√°metros de AWS Systems Manager </h1><br>  Guardo la contrase√±a de la base de datos en forma cifrada.  Para hacer esto, abra la consola de AWS y vaya a AWS Systems Manager ‚Üí Recursos compartidos ‚Üí Almac√©n de par√°metros ‚Üí Crear par√°metro.  <b>Ingreso devdbpassword</b> como <b>nombre</b> del par√°metro y selecciono <b>SecureString</b> para el tipo de par√°metro, luego ingreso la contrase√±a de la base de datos en el campo <b>Valor</b> . <br><br><h1>  Paso 3. Crear definici√≥n de tarea </h1><br>  Amazon ECS es el cl√∫ster donde se ejecutan las aplicaciones de contenedor.  Utiliza la Definici√≥n de tarea para especificar par√°metros de ejecuci√≥n para una aplicaci√≥n contenedor.  Para establecer dichos par√°metros, haga clic en el bot√≥n <b>Crear nueva definici√≥n de tarea</b> .  Luego selecciono <b>Fargate</b> como el <b>tipo de</b> inicio y paso al siguiente paso.  Aqu√≠ configuro el nombre como <b>onboard-dev-taskdef</b> .  Para el par√°metro del <b>campo de rol IAM de ejecuci√≥n de tarea</b> , seleccione <b>Crear nuevo rol</b> .  En cuanto a los recursos asignados para esta aplicaci√≥n, designo 2 GB de memoria y 1 vCPU.  Ahora necesita agregar opciones de inicio de contenedor.  Voy a nombrar el contenedor <b>onboard-dev-container</b> .  Voy a nombrar el nombre de la imagen as√≠: <br><br>  <i>aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</i> .  Amazon ECR Docker Credential Helper se encargar√° de la autenticaci√≥n ECR, por lo que dejo la opci√≥n de <b>autenticaci√≥n de repositorio privado</b> sin marcar.  En el entorno de desarrollo, la aplicaci√≥n est√° disponible en el puerto 8080, por lo que para el par√°metro de mapeo de puertos escribo <b>8080</b> y selecciono el protocolo <b>tcp</b> .  Los par√°metros de URL de la base de datos, el nombre de usuario y la contrase√±a se pasan al contenedor utilizando variables de entorno.  Establec√≠ estos par√°metros en la secci√≥n Variables de entorno.  Para obtener el valor del par√°metro <b>devdbpassword</b> del <b>Almac√©n</b> de par√°metros, especifico el tipo <b>ValueFrom</b> .  Lo √∫ltimo que configuro es la configuraci√≥n del <b>registro</b> , aqu√≠ selecciono <b>Configurar autom√°ticamente los registros de CloudWatch</b> .  Ahora la creaci√≥n de la definici√≥n de tarea est√° completa. <br><br>  Sin embargo, el rol ecsTaskExecutionRole necesita una pol√≠tica para obtener devdbpassword del Almac√©n de par√°metros.  Para hacer esto, vaya a Roles de IAM y seleccione ecsTaskExecutionRole, haga clic en <b>Agregar pol√≠tica en l√≠nea</b> .  En este caso, estoy agregando usando un editor visual.  Por lo tanto, en el campo Servicio, entro en <b>Systems Manager</b> , en el campo Acciones - <b>GetParameters</b> .  Luego hago clic en <b>Agregar ARN</b> para el campo Recursos y complete mis valores: <br><br><img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br><br>  Al final, miro los valores de los par√°metros que se establecen haciendo clic en Revisar pol√≠tica, le doy un nombre y termino de trabajar con la configuraci√≥n ecsTaskExecutionRole. <br><br>  Esto completa la configuraci√≥n de la configuraci√≥n de la aplicaci√≥n del contenedor de inicio.  Ahora necesita crear un cl√∫ster y servicio ECS. <br><br><img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br><br><h4>  Crear servicio de Amazon ECS </h4><br>  Nuestra aplicaci√≥n contenedor se ejecuta como un servicio en un cl√∫ster ECS.  Para configurar, debe realizar los siguientes pasos: <br><br><ul><li>  Paso 1. Crear un cl√∫ster de Amazon ECS; </li><li>  Paso 2: crear un servicio </li></ul><br><h1>  Paso 1. Crear un cl√∫ster de Amazon ECS </h1><br>  Para crear un cl√∫ster ECS, vaya a la consola de AWS y seleccione el servicio ECS.  Luego, haga clic en <b>Crear cl√∫ster</b> y seleccione la plantilla de cl√∫ster de <b>solo redes</b> .  En la p√°gina siguiente, denomino el cl√∫ster como <b>onboard-dev-cluster</b> y completo el cl√∫ster.  Ahora tengo un cl√∫ster ECS basado en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fargate</a> . <br><br><h1>  Paso 2: crear un servicio </h1><br>  Para crear un servicio, hago clic en el enlace <b>onboard-dev-cluster</b> , luego voy a la pesta√±a <b>Servicios</b> y hago clic en el bot√≥n <b>Crear</b> .  Para el <b>tipo de inicio,</b> selecciono Fargate, para <b>Definici√≥n de tarea,</b> selecciono onboard-dev-taskdef.  Adem√°s, selecciono onboard-dev-cluster en el campo Cluster.  En el campo <b>Nombre</b> del <b>servicio</b> , escribo onboard-dev.  Establec√≠ el par√°metro <b>N√∫mero de tareas</b> en cero, ya que no quiero iniciar la aplicaci√≥n en este momento.  Dejo los valores <b>m√≠nimos del</b> par√°metro de <b>porcentaje saludable</b> a 100 y el par√°metro de <b>porcentaje m√°ximo</b> a 200. Para el par√°metro <b>Tipo de implementaci√≥n</b> , seleccione <b>Actualizaci√≥n</b> continua y vaya al siguiente paso. <br><br>  En la p√°gina <b>Configurar red</b> , para el par√°metro <b>Cluster VPC</b> , selecciono una VPC creada anteriormente llamada <b>Development VPC</b> .  La aplicaci√≥n en desarrollo solo est√° disponible en la red privada, por lo que elijo dos subredes privadas.  Para configurar grupos de seguridad, hago clic en el bot√≥n <b>Editar</b> , luego selecciono <b>Seleccionar grupo de seguridad existente</b> , luego el grupo de seguridad <b>predeterminado</b> y hago clic en el bot√≥n <b>Guardar</b> .  Para el par√°metro <b>IP p√∫blico de asignaci√≥n autom√°tica</b> , selecciono <b>Disabled</b> .  A continuaci√≥n, para el par√°metro <b>Tipo de equilibrador de carga</b> , selecciono <b>Ninguno</b> y dejo la opci√≥n <b>Habilitar integraci√≥n de descubrimiento de servicios sin marcar</b> .  Luego hago clic en <b>Siguiente, Siguiente</b> y <b>Crear servicio</b> . <br><br>  Ahora tengo un servicio en el que el n√∫mero de trabajos en ejecuci√≥n es cero.  Configuraremos el inicio de la aplicaci√≥n en el siguiente paso. <br><br><img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br><br><h4>  Actualizaci√≥n de servicio </h4><br>  Tan pronto como el desarrollador actualiza el c√≥digo de la aplicaci√≥n, nuestra implementaci√≥n pasa por crear una imagen Docker, cargarla en el Elastic Container Registry y finalmente lanzar la aplicaci√≥n contenedor como un servicio en el cl√∫ster ECS Fargate.  En este momento, el n√∫mero de trabajos que se ejecutan en el cl√∫ster es cero.  Para que la aplicaci√≥n se inicie, debe actualizar el servicio, indicando la cantidad igual a uno.  Sigo estos pasos para lograr esto: <br><br><ul><li>  Paso 1. Instalar las tareas para el complemento AWS Bamboo; </li><li>  Paso 2. Actualizaci√≥n del servicio ECS </li></ul><br><h1>  Paso 1. Instalar las tareas para el plugin AWS Bamboo </h1><br>  <b>Tareas para AWS Bamboo</b> es un complemento que simplifica la preparaci√≥n y el funcionamiento de los recursos de AWS de los proyectos de construcci√≥n e implementaci√≥n de Bamboo.  Para instalar este complemento, voy al proyecto de implementaci√≥n, hago clic en <b>Agregar tarea</b> , voy al Mercado Atlassian e instalo <b>Tareas para AWS (Bamboo)</b> . <br><br><h1>  Paso 2. Actualizaci√≥n del servicio ECS </h1><br>  Ahora en el proyecto de implementaci√≥n, estoy agregando el trabajo de <b>Amazon ECS Service</b> .  Luego escribo en el campo de descripci√≥n del trabajo <b>Servicio de actualizaci√≥n para onBoard-dev</b> .  En el campo Acci√≥n, seleccione <b>Actualizar servicio</b> y <b>Forzar nueva implementaci√≥n</b> .  Luego selecciono US East (Ohio) como la regi√≥n de lanzamiento.  Luego escribo en los campos apropiados ARN (nombre de recurso de Amazon) para la definici√≥n de tareas, el cl√∫ster y el servicio.  En esta tarea, actualizo el n√∫mero deseado de tareas en ejecuci√≥n a una.  A continuaci√≥n, relleno el cuadro de texto de configuraci√≥n de implementaci√≥n con los siguientes valores: <br><br><pre> <code class="plaintext hljs">{ "maximumPercent": 200, "minimumHealthyPercent": 100 }</code> </pre><br>  Estoy configurando una red sin una IP p√∫blica de la siguiente manera: <br><br><pre> <code class="plaintext hljs">{ "awsvpcConfiguration": { "assignPublicIp": "DISABLED", "subnets": ["subnet-ID1", "subnet-ID2"], "securityGroups": ["sg-ID"] } }</code> </pre><br>  En la secci√≥n <b>Fuente</b> de las <b>credenciales de seguridad de AWS,</b> selecciono el <b>rol de IAM para EC2</b> . <br><br>  Necesito poder actualizar ECS, por lo que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">adjunto la</a> pol√≠tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AmazonECS_FullAccess</a> a mi instancia Bamboo EC2.  Para hacer esto, abra la consola de AWS, seleccione IAM.  Luego selecciono la funci√≥n que uso para mi servidor Bamboo.  Hago clic en el bot√≥n <b>Adjuntar pol√≠ticas</b> , encuentro la pol√≠tica AmazonECS_FullAccess, marco la casilla a la izquierda y termino de adjuntar la pol√≠tica. <br><br>  Esto concluye la configuraci√≥n de CI / CD usando AWS y Bamboo.  Por lo tanto, cuando el desarrollador actualiza el c√≥digo de la aplicaci√≥n, carga este c√≥digo en el repositorio, se inician las pruebas y el ensamblaje de la aplicaci√≥n.  Luego, la imagen de Docker se crea con el archivo war de la aplicaci√≥n, y esta imagen se copia en el repositorio de Amazon ECR.  A continuaci√≥n, en el cl√∫ster de Amazon ECS, se inicia una aplicaci√≥n contenedor como un servicio, que actualiza la aplicaci√≥n actual si no se ha detenido.  Si la aplicaci√≥n se detuvo para ahorrar recursos, la aplicaci√≥n simplemente se inicia.  Despu√©s de verificar la aplicaci√≥n en el entorno de desarrollo, puede detener la aplicaci√≥n especificando el n√∫mero de trabajos que se ejecutan en el cl√∫ster a cero. <br><br>  Si le gust√≥ el art√≠culo y tiene ideas para mejorar, escriba en los comentarios. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458648/">https://habr.com/ru/post/458648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458636/index.html">Cintas de video de mitap DevLeads de la oficina de Tutu.ru</a></li>
<li><a href="../458638/index.html">Proyecto Intel oneAPI: muchas arquitecturas, una API</a></li>
<li><a href="../458640/index.html">Encontrar un gui√≥n largo</a></li>
<li><a href="../458642/index.html">Teor√≠a en lugar de heur√≠stica: mejorando como desarrolladores frontend</a></li>
<li><a href="../458646/index.html">Swaps at√≥micos en pocas palabras</a></li>
<li><a href="../458650/index.html">Cyber ‚Äã‚ÄãChallenge. Un nuevo nivel. Competencia en l√≠nea de Rostelecom Solar</a></li>
<li><a href="../458652/index.html">RamblerFront y Meetup # 7</a></li>
<li><a href="../458654/index.html">El virus Lurk hacke√≥ bancos mientras fue escrito por trabajadores contratados ordinarios</a></li>
<li><a href="../458658/index.html">Cambio de m√°quinas virtuales a contenedores LXC: razones, ventajas e instrucciones listas para usar</a></li>
<li><a href="../458660/index.html">La implementaci√≥n de software fallida bloquea el servicio Cloudflare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>