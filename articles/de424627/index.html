<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òîÔ∏è ü¶Å ‚õé √Ñnderung der Registrierkassen. Teil 1 ü§≤ üçÉ üê¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag an alle. Vor einigen Jahren fiel mir versehentlich eine alte stillgelegte Registrierkasse in die H√§nde. Es wurde "Elves Micro-F" genannt. We...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√Ñnderung der Registrierkassen. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424627/"><p>  Guten Tag an alle.  Vor einigen Jahren fiel mir versehentlich eine alte stillgelegte Registrierkasse in die H√§nde.  Es wurde "Elves Micro-F" genannt.  Weil  Ich interessiere mich f√ºr Elektronik und Programmierung, einschlie√ülich des Aufbaus verschiedener Ger√§te auf Mikrocontrollern, die das Ger√§t untersuchen wollte.  Nachdem ich es zerlegt hatte, sah ich: </p><br><ul><li>  eine Platine mit elektronischer F√ºllung und einem AT89C52-Mikrocontroller in einer Steckdose </li><li>  Anzeige </li><li>  Thermodrucker </li><li>  Batterie </li><li>  Filmtastatur </li><li>  zwei LEDs </li></ul><a name="habracut"></a><br><p><img src="http://avsrv2.sytes.net/pics/kassa/IMAG0162.jpg" alt="Bild"><br>  <em>Abb. 1 Erscheinungsbild der Kasse</em> </p><br><p>  Zu diesem Zeitpunkt hatte ich bereits die Erfahrung, einfache Ger√§te von Grund auf neu zu erstellen (Uhren, Relais, die √ºber den COM-Anschluss gesteuert werden usw.).  Das fertige Ger√§t zu verstehen schien viel schwieriger.  Zun√§chst fand ich im Netzwerk eine Beschreibung dieses Ger√§ts, ein Diagramm und eine Reparaturdokumentation.  Wie sich herausstellte, gibt es mehrere Schemata, die sich sehr stark unterscheiden, obwohl die Ger√§te fast gleich hei√üen.  Aber am Ende habe ich die richtige Schaltung gefunden.  Er sah sie an und stellte fest, dass das Kassenger√§t tats√§chlich nicht so kompliziert ist. </p><br><p>  Ich musste herausfinden: </p><br><ul><li>  wie einfach es ist, den Mikrocontroller so zu programmieren, dass er nicht hin und her gezogen wird, dann zum Programmierer und dann zur√ºck zur Platine </li><li>  wie man einen Austausch mit einem Computer herstellt </li><li>  wie man mit RAM arbeitet (und es gab einen seriellen AT24C08) </li><li>  wie man etwas auf dem Display zeichnet </li><li>  wie man Tastenanschl√§ge bekommt </li><li>  und vor allem!  wie man etwas Sinnvolles f√ºr einen Thermodrucker ausgibt </li></ul><br><p>  In diesem Artikel werde ich √ºber den Beginn meiner Arbeit sprechen.  Das ultimative Ziel ist es, einen Thermodrucker aus einer alten abgeschriebenen Kasse zu erstellen. </p><br><p>  Teil 1 <br>  Starten Sie </p><br><p>  Zuerst entschied ich mich, den Mikrocontroller, der sich auf der Platine befand, aufzugeben.  Erstens konnte es nur auf einem Programmierer programmiert werden, den ich f√ºr diesen Controllertyp nicht hatte.  Zweitens hatte er wenig internen Flash-Speicher f√ºr Programme. <br>  Nachdem ich mit der Wahl gequ√§lt worden war, entschied ich mich f√ºr den Winbond w78e58b Mikrocontroller.  Es befand sich im selben Paket (plcc44), hatte 32 KB Programmspeicher und mehr internen statischen Speicher zum Speichern von Variablen und vor allem erm√∂glichte es Ihnen, sich mit dem In-Circuit-Programmierer zu programmieren, ohne ihn aus dem Socket zu entfernen! </p><br><p>  Es gab jedoch eine Schwierigkeit: Um mit der Programmierung zu beginnen, ben√∂tigte ein paralleler Programmierer f√ºr diesen Mikrocontrollertyp einen Flash-Bootloader, mit dem ich sp√§ter meine Firmware hochladen w√ºrde.  Ich habe Informationen dar√ºber gefunden, wie man einen solchen Programmierer im Internet erstellt, einen Programmierer zusammenstellt und einen Bootloader gepatcht! </p><br><p>  Dann gab es ein anderes Problem - dieses Ger√§t hatte keinen Anschluss zum Anschlie√üen an einen PC! </p><br><p><img src="http://avsrv2.sytes.net/pics/kassa/int_plats_big.jpg" alt="Bild"><br>  <em>Abb. 2 Original-Schnittstellenkarte</em> <em><br></em> <br>  Wie ich in den Handb√ºchern gelesen habe, gab es zwar ein solches Taschentuch und Stecker im Geh√§use des Ger√§ts und einen Stecker auf der Platine, aber ich konnte diese Paarung nicht bekommen.  Zu dieser Zeit war es nirgendwo im Verkauf und kostete kein schlechtes Geld.  Dann habe ich beschlossen, die Schnittstelle selbst zu machen.  Ich brach einen Stecker aus dem Geh√§use, zerlegte die Steckdose mit einem RJ45-Stecker aus dem lokalen Netzwerk, schnitt diesen Stecker in ein St√ºck der Platine und klebte ihn f√ºr Schmelzkleber in die Abendkasse.  Dadurch wurde das √ºbliche Twisted Pair von au√üen bis zu einem Klick perfekt eingef√ºgt!  Die Verbindungsstifte m√ºssen noch mit dem Mikrocontroller verbunden werden.  Nat√ºrlich ist dies nicht direkt m√∂glich, sondern √ºber einen Pegelwandler, beispielsweise MAX232.  Auf ein kleines St√ºck des Steckbretts legte er den Chip selbst, die Umreifungskondensatoren, und l√∂te die Verkabelung.  Ich habe ein Kabel f√ºr die Verbindung mit einem Computer aus einem St√ºck Twisted Pair gel√∂tet.  Einerseits ein normaler RJ45-Anschluss, andererseits eine DB9-Mutter f√ºr einen COM-Port-Anschluss. </p><br><p>  Die n√§chste Aufgabe bestand darin, einen Compiler zu finden, der f√ºr solche Zwecke frei und nicht besonders schwierig ist.  Ich bin auf Keil Microvision gesto√üen.  Es war eine Art Demoversion mit einer Begrenzung der Codel√§nge.  Genug f√ºr meine Zwecke.  Das erste Programm war einfach: im Terminalprogramm auf den Computer auszugeben, so etwas wie Hallo Welt! </p><br><p>  Ich habe ein Programm geschrieben, die Schwierigkeit bestand nur in der anf√§nglichen Initialisierung von Ports und Serviceregistern.  Aber nachdem ich im Netzwerk nach Beispielen gesucht hatte, ging ich schnell darauf ein.  Als n√§chstes startete ich das Programm <br>  8051IspWriter, der Firmware hochl√§dt.  Damit der Mikrocontroller in den Schachtmodus der Firmware wechseln konnte, musste der eingebaute Bootloader aktiviert werden.  Wie sich herausstellte, kann dies erreicht werden, indem der Ausgang des Controllers gegen Masse kurzgeschlossen wird, bevor Strom angelegt wird.  Welches - im Datenblatt des Mikrocontrollers gefunden.  Die Firmware wurde hochgeladen, danach habe ich ausgeschaltet, die Kasse eingeschaltet und meinen Text auf dem Terminalbildschirm gesehen!  Das System hat funktioniert! </p><br><p>  Au√üerdem habe ich beschlossen, die Registrierkasse selbst ein wenig zu steuern oder die LED zu blinken.  Gem√§√ü dem Schema habe ich festgestellt, zu welchem ‚Äã‚ÄãBein des Mikrocontrollers diese LED geht, ich habe ein einfaches Blinklicht geschrieben und die LED begann an der Kasse zu blinken!  Der Weg zum Endziel ist bereits sichtbar geworden! </p><br><p>  Ausz√ºge aus dem Quellcode: </p><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { UCHAR i; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; UCHAR bCassaTypeOld; UCHAR iNumSymbolsOld; jmpLDROM=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//            P0 |= 0x01; // PPWR = 1 P1 |= 0x20; // PM1 = 1 P1 |= 0x40; // PM2 = 1 P3 &amp;= ~0x40; // SI = 0 P3 &amp;= ~0x20; // CLOCK = 0 P3 |= 0x80; // LATCH = 1 P3 |= 0x10; // STBA = 1 P3 |= 0x08; // STBB = 1 //          initUart(BAUD_RATE_19200); puts("Hello world!"); while(1) ; }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424627/">https://habr.com/ru/post/de424627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424613/index.html">Erfahrung mit Redux ohne Reduzierst√ºcke</a></li>
<li><a href="../de424615/index.html">Kurvenfunktionsausgabe zur reibungslosen Begrenzung von Parametern, Signalen und nicht nur in Wolfram Mathematica</a></li>
<li><a href="../de424621/index.html">Nicht-Film-Superhelden. Wer und wie sch√ºtzt die Baustelle des Lakhta Centers vor Br√§nden?</a></li>
<li><a href="../de424623/index.html">Lassen Sie uns den Sound auf Go verarbeiten</a></li>
<li><a href="../de424625/index.html">Quellcode-Leck bei Aeroflot-Webdiensten</a></li>
<li><a href="../de424629/index.html">Wie erh√∂hen Startups ihre Investitionschancen bei der Kommunikation mit einem Investor?</a></li>
<li><a href="../de424633/index.html">Wie STACKLEAK die Sicherheit des Linux-Kernels verbessert</a></li>
<li><a href="../de424635/index.html">Willkommen bei Sberbank Data Science Journey 2018 - Algorithmus f√ºr maschinelles Lernen</a></li>
<li><a href="../de424637/index.html">Magischer Barcode</a></li>
<li><a href="../de424639/index.html">Google ist 20 Jahre alt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>