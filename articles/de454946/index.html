<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòâ ü•ì ‚ô†Ô∏è Globale Staaten: warum und wie man sie vermeidet üí¨ üö∂üèª ü•á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Globale Bedingungen. Dieser Satz verursacht Angst und Schmerz im Herzen jedes Entwicklers, der das Ungl√ºck hatte, sich diesem Ph√§nomen zu stellen. Sin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Globale Staaten: warum und wie man sie vermeidet</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  Globale Bedingungen.  Dieser Satz verursacht Angst und Schmerz im Herzen jedes Entwicklers, der das Ungl√ºck hatte, sich diesem Ph√§nomen zu stellen.  Sind Sie bereits auf unerwartetes Anwendungsverhalten gesto√üen, ohne die Gr√ºnde daf√ºr zu verstehen, wie ein ungl√ºcklicher Ritter, der versucht, Hydra mit vielen K√∂pfen zu t√∂ten?  Sie befinden sich in einem endlosen Zyklus von Versuch und Irrtum. 90% der Zeit fragen Sie sich, was passiert? <br><br>  All dies kann √§rgerliche Folgen von Globals sein: versteckte Variablen, die ihren Status an unbekannten Orten √§ndern, aus Gr√ºnden, die Sie noch nicht herausgefunden haben. <br><a name="habracut"></a><br>  Wandern Sie gerne im Dunkeln, w√§hrend Sie versuchen, die Anwendung zu √§ndern?  Nat√ºrlich mag ich es nicht.  Zum Gl√ºck habe ich Kerzen f√ºr Sie: <br><br><ol><li>  Zun√§chst werde ich beschreiben, was wir am h√§ufigsten als globale Staaten bezeichnen.  Dieser Begriff wird nicht immer genau verwendet und muss daher gekl√§rt werden. <br></li><li>  Als n√§chstes werden wir herausfinden, warum Globals f√ºr unsere Codebasis sch√§dlich sind. <br></li><li>  Dann werde ich erkl√§ren, wie man den Umfang der Globals trimmt, um sie in lokale Variablen umzuwandeln. <br></li><li>  Abschlie√üend werde ich √ºber die Kapselung sprechen und warum der Kreuzzug gegen globale Variablen nur ein Teil des gro√üen Problems ist. <br></li></ol><br>  Ich hoffe, dieser Artikel erkl√§rt alles, was Sie √ºber globale Staaten wissen m√ºssen.  Wenn du denkst, dass ich viel vermisst habe und du mich daf√ºr hasst und mich nicht mehr sehen willst, schreibe dar√ºber in den Kommentaren.  Es wird mir, meinen Lesern und allen, die pl√∂tzlich auf dieser Seite erschienen sind, angenehm sein. <br><br>  Bist du bereit, lieber Leser, auf ein Pferd zu springen und deinen Feind zu kennen?  Finde diese Globalen und lass sie den Stahl unserer Schwerter schmecken! <br><br><h1>  Was ist eine Bedingung? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Beginnen wir mit den Grundlagen, damit Sie Entwickler sich verstehen. <br><br>  Ein Zustand ist eine Definition eines Systems oder einer Entit√§t.  Zust√§nde sind im wirklichen Leben zu finden: <br><br><ul><li>  Wenn der Computer ausgeschaltet ist, wird sein Status ausgeschaltet. <br></li><li>  Wenn eine Tasse Tee hei√ü ist, ist ihr Zustand hei√ü. <br></li></ul><br>  In der Softwareentwicklung k√∂nnen einige Konstrukte (z. B. Variablen) Zust√§nde haben.  Angenommen, die Zeichenfolge "Hallo" oder die Zahl 11 werden nicht als Zust√§nde betrachtet, sondern als Werte.  Sie werden zum Status, wenn sie an eine Variable angeh√§ngt und im Speicher abgelegt werden. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  Es k√∂nnen zwei Arten von Zust√§nden unterschieden werden: <br><br>  Variable Zust√§nde: Nach ihrer Initialisierung k√∂nnen sie sich jederzeit w√§hrend der Ausf√ºhrung Ihrer Anwendung √§ndern. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  Unver√§nderliche Zust√§nde: k√∂nnen sich w√§hrend der Ausf√ºhrung nicht √§ndern.  Sie weisen Ihrer Variablen den ersten Status zu, dessen Wert sich anschlie√üend nicht √§ndert.  "Konstanten" im Alltag werden Beispiele f√ºr unver√§nderliche Zust√§nde genannt: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  H√∂ren wir uns jetzt ein hypothetisches Gespr√§ch zwischen Denis und Vasily an, Ihren Mitentwicklern: <br><br>  - Dan!  Sie haben √ºberall globale Variablen erstellt!  Sie k√∂nnen nicht ge√§ndert werden, ohne dass alles kaputt geht!  Ich werde dich t√∂ten! <br>  - Nifiga, Vasek!  Mein globales Schicksal ist gro√üartig!  Ich lege meine Seele in sie, das sind Meisterwerke!  Ich verehre meine Globalen! <br><br>  Am h√§ufigsten nennen Entwickler globale Zust√§nde, globale Variablen oder globale Zust√§nde, was sie als globale ver√§nderbare Zust√§nde bezeichnen sollten.  Das hei√üt, Zust√§nde, die in dem gr√∂√üten der Ihnen zur Verf√ºgung stehenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bereiche</a> ge√§ndert werden k√∂nnen: in der gesamten Anwendung. <br><br>  Wenn eine Variable nicht die gesamte Anwendung als G√ºltigkeitsbereich hat, handelt es sich um lokale Variablen oder Gebietsschemas.  Sie existieren in bestimmten Sichtbarkeitsbereichen, weniger als im Bereich der gesamten Anwendung. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  Sie k√∂nnten denken: Wie bequem ist es, Variablen zu haben, auf die Sie von √ºberall aus zugreifen und sie √§ndern k√∂nnen!  Ich kann Zust√§nde von einem Teil der Anwendung auf einen anderen √ºbertragen!  Sie m√ºssen sie nicht durch Funktionen f√ºhren und so viel Code schreiben!  Sei gegr√º√üt, global ver√§nderlicher Staat! <br><br>  Wenn Sie das wirklich gedacht haben, empfehle ich dringend, weiterzulesen. <br><br><h1>  Globale Staaten schlimmer als Pest und Cholera? </h1><br><h2>  Das gr√∂√üte Linkdiagramm </h2><br>  Fakt: Es ist f√ºr Sie einfacher, ein genaues Anwendungsverbindungsdiagramm zu erstellen, wenn es nur Gebietsschemas mit kleinen und definierten Bereichen ohne globale Elemente enth√§lt. <br><br>  Warum? <br><br>  Angenommen, Sie haben eine gro√üe Anwendung mit globalen Variablen.  Jedes Mal, wenn Sie etwas √§ndern m√ºssen, m√ºssen Sie: <br><br><ul><li>  Denken Sie daran, dass diese ver√§nderlichen globalen Zust√§nde existieren. <br></li><li>  Sch√§tzen Sie, ob sie sich auf den Umfang auswirken, den Sie √§ndern werden. <br></li></ul><br>  Normalerweise m√ºssen Sie nicht √ºber lokale Variablen nachdenken, die sich in anderen Bereichen befinden. Was auch immer Sie tun, Sie m√ºssen in Ihrem m√ºden Gehirn immer einen Ort f√ºr globale ver√§nderbare Zust√§nde behalten, da diese alle Bereiche betreffen k√∂nnen. <br><br>  Dar√ºber hinaus k√∂nnen sich Ihre globalen ver√§nderlichen Zust√§nde √ºberall in der Anwendung √§ndern.  Man muss sich normalerweise fragen, wie ihr aktueller Zustand ist.  Dies bedeutet, dass Sie gezwungen sind, in der gesamten Anwendung zu suchen und zu versuchen, die Werte der Globals im ver√§nderbaren Bereich zu berechnen. <br><br>  Das ist noch nicht alles.  Wenn Sie den Status der Globals √§ndern m√ºssen, k√∂nnen Sie sich nicht vorstellen, welchen Umfang dies hat.  Wird dies zu unerwartetem Verhalten einer anderen Klasse, Methode oder Funktion f√ºhren?  Erfolg bei der Suche. <br><br>  Kurz gesagt, Sie kombinieren alle Klassen, Methoden und Funktionen, die denselben globalen Status verwenden.  Vergessen Sie nicht: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abh√§ngigkeiten erh√∂hen die Komplexit√§t erheblich</a> .  Erschreckt es dich?  Es sollte sein.  Kleine spezifische Sichtbarkeitsbereiche sind sehr n√ºtzlich: Sie m√ºssen nicht die gesamte Anwendung im Auge behalten, es reicht aus, sich nur an die Bereiche zu erinnern, mit denen Sie arbeiten. <br><br>  Menschen verfolgen nicht sofort eine gro√üe Menge an Informationen.  Wenn wir dies versuchen, ersch√∂pfen wir schnell das Angebot an kognitiven F√§higkeiten, es wird schwierig f√ºr uns, uns zu konzentrieren, und wir beginnen, Fehler und dumme Dinge zu schaffen.  Aus diesem Grund ist es so unangenehm, im globalen Bereich Ihrer Anwendung zu agieren. <br><br><h2>  Globale Namenskollisionen </h2><br>  Es gibt Schwierigkeiten bei der Verwendung von Bibliotheken von Drittanbietern.  Stellen Sie sich vor, Sie m√∂chten diese supercoole Bibliothek verwenden, die jedes Zeichen zuf√§llig mit einem Flickereffekt f√§rbt.  Der Traum eines jeden Entwicklers!  Wenn diese Bibliothek auch Globals verwendet, die dieselben Namen wie Ihre eigenen haben, werden Sie Kollisionen von Namen genie√üen.  Ihre Anwendung wird abst√ºrzen und Sie werden die Gr√ºnde wahrscheinlich f√ºr eine lange Zeit erraten: <br><br><ul><li>  Zun√§chst m√ºssen Sie herausfinden, dass Ihre Bibliothek globale Variablen verwendet. <br></li><li>  Zweitens m√ºssen Sie berechnen, welche Variable w√§hrend der Ausf√ºhrung verwendet wurde - Ihre oder Bibliotheken?  Es ist nicht so einfach, die Namen sind die gleichen! <br></li><li>  Drittens m√ºssen Sie Ihre globalen ver√§nderlichen Variablen umbenennen, da Sie die Bibliothek nicht selbst √§ndern k√∂nnen.  Wenn Sie w√§hrend der gesamten Anwendung verwendet werden, werden Sie weinen. <br></li></ul><br>  In jedem Stadium werden Sie Ihre Haare vor Wut und Verzweiflung rei√üen.  Bald brauchen Sie keinen Kamm mehr.  Dieses Szenario wird Sie wahrscheinlich nicht verf√ºhren.  Vielleicht wird sich jemand daran erinnern, dass die JavaScript-Bibliotheken Mootools, Underscore und jQuery immer miteinander kollidierten, wenn sie nicht in kleineren Bereichen platziert wurden.  Oh, und das ber√ºhmte globale <code>$</code> -Objekt in jQuery! <br><br><h2>  Testen wird zum Albtraum </h2><br>  Wenn ich Sie noch nicht √ºberzeugt habe, betrachten wir die Situation unter dem Gesichtspunkt des Unit-Tests: Wie schreiben Sie Tests bei Vorhandensein globaler Variablen?  Da Tests die globalen Werte √§ndern k√∂nnen, wissen Sie nicht, in welchem ‚Äã‚ÄãTest sich der Status befand.  Sie m√ºssen die Tests voneinander isolieren, und globale Zust√§nde binden sie zusammen. <br><br>  Haben Sie es jemals gehabt, damit Isolationstests gut funktionieren, und wenn Sie das gesamte Paket ausf√ºhren, werden sie fehlschlagen?  Nein?  Und ich hatte es.  Jedes Mal, wenn ich mich daran erinnere, leide ich. <br><br><h2>  Parallelit√§tsprobleme </h2><br>  Variable globale Zust√§nde k√∂nnen viele Probleme verursachen, wenn Sie Parallelit√§t ben√∂tigen.  Wenn Sie den Status von Globals in mehreren Hinrichtungsf√§den √§ndern, dann gehen Sie Hals √ºber Kopf in einem m√§chtigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zustand des Rennens</a> . <br><br>  Wenn Sie ein PHP-Entwickler sind, st√∂rt Sie dies nicht, es sei denn, Sie verwenden Bibliotheken, mit denen Sie Parallelit√§t erstellen k√∂nnen.  Wenn Sie jedoch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine neue Sprache lernen,</a> in der Parallelit√§t leicht zu implementieren ist, hoffe ich, dass Sie sich an meine Prosa erinnern. <br><br><h1>  Vermeidung global ver√§nderlicher Zust√§nde </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  W√§hrend globale ver√§nderbare Zust√§nde eine Menge Probleme verursachen k√∂nnen, sind sie manchmal schwer zu vermeiden. <br><br>  Nehmen Sie die REST-API: Endpunkte empfangen HTTP-Anforderungen mit Parametern und senden Antworten.  Diese an den Server gesendeten HTTP-Parameter k√∂nnen auf vielen Ebenen Ihrer Anwendung angefordert werden.  Es ist sehr verlockend, diese Parameter beim Empfang einer HTTP-Anfrage global zu machen und sie vor dem Senden einer Antwort zu √§ndern.  F√ºgen Sie zu jeder Anforderung Parallelit√§t hinzu, und das Katastrophenrezept ist fertig. <br><br>  Globale ver√§nderbare Zust√§nde k√∂nnen auch direkt in Sprachimplementierungen unterst√ºtzt werden.  Zum Beispiel gibt es in PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Superglobale</a> . <br><br>  Wenn Globale von irgendwoher kommen, wie soll man dann mit ihnen umgehen?  Wie kann man die Anwendung von Denis umgestalten, Ihrem Entwicklerkollegen, der, wo immer m√∂glich, Globals erstellt hat, weil er in den letzten 20 Jahren nichts √ºber die Entwicklung gelesen hat? <br><br><h2>  Funktionsargumente </h2><br>  Der einfachste Weg, Globale zu vermeiden, besteht darin, Variablen mithilfe von Funktionsargumenten zu √ºbergeben.  Nehmen Sie ein einfaches Beispiel: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, <code>$productData</code> das <code>$productData</code> vom Controller √ºber eine HTTP-Anforderung verschiedene Ebenen: <br><br><ol><li>  Der Controller hat eine HTTP-Anfrage erhalten. <br></li><li>  An das Modell √ºbergebene Parameter. <br></li><li>  Parameter an das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DAO √ºbergeben</a> . <br></li><li>  Parameter werden in der Anwendungsdatenbank gespeichert. <br></li></ol><br>  Wir k√∂nnten dieses Parameterarray global machen, wenn wir es von der HTTP-Anforderung abrufen.  Es scheint so einfach zu sein: Es m√ºssen keine Daten an 4 verschiedene Funktionen √ºbertragen werden.  √úbergeben von Parametern als Argumente an Funktionen: <br><br><ul><li>  Es wird offensichtlich zeigen, dass diese Funktionen das <code>$productData</code> . <br></li><li>  Es wird offensichtlich gezeigt, welche Funktionen welche Parameter verwenden.  Es ist ersichtlich, dass f√ºr <code>ProductDao::find</code> aus dem <code>$productData</code> nur <code>$id</code> ben√∂tigt wird und nicht alles. <br></li></ul><br>  Globale machen den Code weniger verst√§ndlich und verkn√ºpfen Methoden miteinander, was ein sehr hoher Preis f√ºr das fast vollst√§ndige Fehlen von Vorteilen ist. <br><br>  Sie h√∂ren bereits Denis Protest: ‚ÄûUnd wenn eine Funktion drei oder mehr Argumente hat?  Wenn Sie noch mehr hinzuf√ºgen m√ºssen, erh√∂ht sich die Komplexit√§t der Funktion!  Und was ist mit den Variablen, Objekten und anderen Konstrukten, die √ºberall ben√∂tigt werden?  √úbergeben Sie sie an jede Funktion in der Anwendung? ‚Äú <br><br>  Fragen sind fair, lieber Leser.  Als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">guter Entwickler</a> sollten Sie Denis anhand Ihrer Kommunikationsf√§higkeiten Folgendes erkl√§ren: <br><br>  <i>‚ÄûDenis, wenn Ihre Funktionen zu viele Argumente haben, k√∂nnen die Funktionen selbst ein Problem sein.</i>  <i>Sie tun wahrscheinlich zu viel, sind f√ºr zu viele Dinge verantwortlich.</i>  <i>Du hast nicht daran gedacht, sie in kleinere Funktionen zu unterteilen? "</i>  . <br><br>  Sie f√ºhlen sich wie ein Redner auf der Akropolis von Athen und fahren fort: <br><br>  <i>‚ÄûWenn Sie Variablen in vielen Bereichen der Sichtbarkeit ben√∂tigen, ist dies ein Problem, und wir werden bald dar√ºber sprechen.</i>  <i>Aber wenn Sie sie wirklich brauchen, was ist dann falsch daran, sie durch Funktionsargumente zu f√ºhren?</i>  <i>Ja, Sie m√ºssen sie auf der Tastatur eingeben, aber wir sind Entwickler. Es ist unsere Aufgabe, Code zu schreiben. ‚Äú</i> <br><br>  Es mag komplizierter erscheinen, wenn Sie mehr Argumente haben (vielleicht ist dies so), aber ich wiederhole, die Vorteile √ºberwiegen die Nachteile: Es ist besser, wenn der Code so klar wie m√∂glich ist und keine versteckten globalen ver√§nderlichen Zust√§nde verwendet. <br><br><h2>  Kontextobjekte </h2><br>  Kontextobjekte sind solche, die Daten enthalten, die durch einen bestimmten Kontext definiert sind.  In der Regel werden diese Daten als Schl√ºsselpaarkonstrukt gespeichert, z. B. als assoziatives Array in PHP.  Ein solches Objekt hat kein Verhalten, nur Daten, √§hnlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einem Wertobjekt</a> . <br><br>  Ein Kontextobjekt kann jeden globalen ver√§nderlichen Zustand ersetzen.  Kehren Sie zum vorherigen Codebeispiel zur√ºck.  Anstatt Daten aus der Anforderung durch die Ebenen zu leiten, k√∂nnen wir ein Objekt verwenden, das diese Daten kapselt. <br><br>  Der Kontext ist die Abfrage selbst: eine andere Abfrage - ein anderer Kontext - ein anderer Datensatz.  Anschlie√üend wird das Kontextobjekt an eine Methode √ºbergeben, die diese Daten ben√∂tigt. <br><br>  Sie sagen: "Es ist gro√üartig und das alles, aber was gibt es?" <br><br><ul><li>  Daten werden in ein Objekt eingekapselt.  In den meisten F√§llen besteht Ihre Aufgabe darin, die Daten unver√§nderlich zu machen, dh, dass Sie den Status - den Wert der Daten im Objekt nach der Initialisierung - nicht √§ndern k√∂nnen. <br></li><li>  Offensichtlich ben√∂tigt der Kontext die Daten des Kontextobjekts, da sie an alle Funktionen (oder Methoden) √ºbertragen werden, die diese Daten ben√∂tigen. <br></li><li>  Dies l√∂st das Parallelit√§tsproblem: Wenn jede Anforderung ein eigenes Kontextobjekt hat, k√∂nnen Sie diese sicher in ihre eigenen Ausf√ºhrungsthreads schreiben oder lesen. <br></li></ul><br>  Aber alles in der Entwicklung hat einen Preis.  Kontextobjekte k√∂nnen sch√§dlich sein: <br><br><ul><li>  Wenn Sie sich die Argumente der Funktion ansehen, wissen Sie nicht, welche Daten sich im Kontextobjekt befinden. <br></li><li>  Sie k√∂nnen alles in ein Kontextobjekt einf√ºgen.  Achten Sie darauf, nicht zu viel zu speichern, z. B. die gesamte Benutzersitzung oder sogar die meisten Ihrer Anwendungsdaten.  Und dann kann dies passieren: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Brechen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gesetz von Demeter</a> , und Ihr Fluch wird wahnsinnige Komplexit√§t sein. <br></li><li>  Je gr√∂√üer das Kontextobjekt ist, desto schwieriger ist es herauszufinden, welche Daten und in welchem ‚Äã‚ÄãUmfang sie verwendet werden. <br></li></ul><br>  Im Allgemeinen w√ºrde ich die Verwendung von Kontextobjekten so weit wie m√∂glich vermeiden.  Sie k√∂nnen viele Zweifel hervorrufen.  Die Unver√§nderlichkeit von Daten ist ein gro√ües Plus, aber wir d√ºrfen die M√§ngel nicht vergessen.  Wenn Sie ein Kontextobjekt verwenden, stellen Sie sicher, dass es klein genug ist, und √ºbergeben Sie es an einen kleinen und sorgf√§ltig definierten Bereich. <br><br>  Wenn Sie vor dem Ausf√ºhren eines Programms keine Ahnung haben, wie viele Status an Ihre Funktionen √ºbergeben werden (z. B. Parameter aus einer HTTP-Anforderung), k√∂nnen Kontextobjekte hilfreich sein.  Einige von ihnen verwenden sie daher. Denken Sie beispielsweise an das <code>Request</code> Objekt in Symfony. <br><br><h2>  Abh√§ngigkeitsinjektion </h2><br>  Eine weitere gute Alternative zu globalen ver√§nderlichen Zust√§nden besteht darin, die ben√∂tigten Daten direkt beim Erstellen direkt in das Objekt einzubetten.  Dies ist die Definition der Abh√§ngigkeitsinjektion: Eine Reihe von Techniken zum Einbetten von Objekten in Ihre Komponenten (Klassen). <br><br><h3>  Warum genau Abh√§ngigkeitsinjektion? </h3><br>  Ziel ist es, die Verwendung Ihrer Variablen, Objekte oder anderer Konstrukte einzuschr√§nken und sie in einem begrenzten Bereich zu platzieren.  Wenn Sie Abh√§ngigkeiten haben, die eingebettet sind und daher nur im Rahmen eines Objekts agieren k√∂nnen, k√∂nnen Sie leichter herausfinden, in welchem ‚Äã‚ÄãKontext sie verwendet werden und warum.  Keine Qual und Qual! <br><br>  Die Abh√§ngigkeitsinjektion unterteilt den Anwendungslebenszyklus in zwei wichtige Phasen: <br><br><ol><li>  Anwendungsobjekte erstellen und deren Abh√§ngigkeiten implementieren. <br></li><li>  Verwenden Sie Objekte, um Ihre Ziele zu erreichen. <br></li></ol><br>  Dieser Ansatz macht den Code klarer: Sie m√ºssen nicht alles an zuf√§lligen Orten instanziieren oder, noch schlimmer, √ºberall globale Objekte verwenden. <br><br>  Viele Frameworks verwenden die Abh√§ngigkeitsinjektion, manchmal in relativ komplexen Schemata, mit Konfigurationsdateien und einem Dependency Injection Container (DIC).  Es ist jedoch keineswegs notwendig, die Dinge zu komplizieren.  Sie k√∂nnen einfach Abh√§ngigkeiten auf einer Ebene erstellen und auf einer niedrigeren Ebene implementieren.  In der Go-Welt kenne ich beispielsweise niemanden, der DIC verwenden w√ºrde.  Sie erstellen einfach die Abh√§ngigkeiten in der Hauptdatei mit dem Code (main.go) und √ºbertragen sie dann auf die n√§chste Ebene.  Sie k√∂nnen auch alles in verschiedenen Paketen instanziieren, um klar anzuzeigen, dass die ‚ÄûPhase der Abh√§ngigkeitsinjektion‚Äú nur auf dieser bestimmten Ebene durchgef√ºhrt werden sollte.  In Go kann der Umfang der Pakete die Dinge einfacher machen als in PHP, in dem DICs in jedem mir bekannten Framework, einschlie√ülich Symfony und Laravel, weit verbreitet sind. <br><br><h3>  Implementierung √ºber Konstruktor oder Setter </h3><br>  Es gibt zwei M√∂glichkeiten, Abh√§ngigkeiten einzuf√ºgen: √ºber den Konstruktor oder die Setter.  Ich rate, wenn m√∂glich, sich an die erste Methode zu halten: <br><br><ul><li>  Wenn Sie wissen m√∂chten, was Klassenabh√§ngigkeiten sind, m√ºssen Sie nur einen Konstruktor finden.  Sie m√ºssen nicht nach Methoden suchen, die √ºber die gesamte Klasse verteilt sind. <br></li><li>  Durch das Festlegen von Abh√§ngigkeiten w√§hrend der Installation k√∂nnen Sie sicher sein, dass das Objekt sicher verwendet wird. <br></li></ul><br>  Lassen Sie uns ein wenig √ºber den letzten Punkt sprechen: Dies wird als "Erzwingen der Invariante" bezeichnet.  Indem Sie eine Instanz eines Objekts erstellen und seine Abh√§ngigkeiten implementieren, wissen Sie, dass es unabh√§ngig von den Anforderungen Ihres Objekts korrekt konfiguriert ist.  Und wenn Sie Setter verwenden, woher wissen Sie, dass Ihre Abh√§ngigkeiten zum Zeitpunkt der Verwendung des Objekts bereits festgelegt sind?  Sie k√∂nnen auf den Stapel gehen und versuchen herauszufinden, ob die Setter aufgerufen wurden, aber ich bin sicher, dass Sie dies nicht tun m√∂chten. <br><br><h1>  Kapselungsverletzung </h1><br>  Schlie√ülich besteht der einzige Unterschied zwischen lokalen und globalen Staaten in ihrem Umfang.  Sie sind f√ºr lokale Staaten begrenzt, und f√ºr globale Staaten ist die gesamte Anwendung verf√ºgbar.  Wenn Sie jedoch lokale Zust√§nde verwenden, k√∂nnen Probleme auftreten, die f√ºr globale Zust√§nde spezifisch sind.  Warum? <br><br><h2>  Hast du Kapselung gesagt? </h2><br>  Die Verwendung globaler Zust√§nde unterbricht m√∂glicherweise die Kapselung, genauso wie Sie sie mit lokalen Zust√§nden aufheben k√∂nnen. <br><br>  Beginnen wir von vorne.  Was sagt uns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wikipedia</a> √ºber die Definition der Kapselung?  Der Sprachmechanismus zum Einschr√§nken des direkten Zugriffs auf einige Komponenten eines Objekts.  Zugangsbeschr√§nkung?  Warum? <br><br>  Nun, wie wir oben gesehen haben, ist es viel einfacher, im lokalen Bereich zu argumentieren als im globalen.  Globale ver√§nderbare Zust√§nde sind per Definition √ºberall verf√ºgbar, und dies ist gegen die Einkapselung!  Keine Zugriffsbeschr√§nkungen f√ºr Sie. <br><br><h2>  Wachsender Umfang und Zustandsleckage </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Stellen wir uns einen Staat in seinem eigenen kleinen Rahmen vor.  Leider w√§chst die Anwendung im Laufe der Zeit und dieser lokale Status wird als Argument an die Funktion in der gesamten Anwendung √ºbergeben.  Jetzt wird Ihr Gebietsschema in vielen Bereichen verwendet, und in allen ist der direkte Zugriff auf das Gebietsschema autorisiert.  Jetzt f√§llt es Ihnen schwer, den genauen Status des Gebietsschemas zu berechnen, ohne alle Sichtbarkeitsbereiche zu untersuchen, in denen es vorhanden ist und in denen es ge√§ndert werden kann.  All dies haben wir bereits bei global ver√§nderlichen Staaten gesehen. <br><br>  Nehmen Sie ein Beispiel: Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">an√§mische Dom√§nenmodell</a> kann den Umfang Ihrer ver√§nderlichen Modelle erh√∂hen.  Tats√§chlich unterteilt das an√§mische Dom√§nenmodell die Daten und das Verhalten Ihrer Dom√§nenobjekte in zwei Gruppen: Modelle (nur Objekte mit Daten) und Dienste (nur Objekte mit Verhalten).  Meistens werden diese Modelle in allen Diensten verwendet.  Daher ist es wahrscheinlich, dass irgendeine Art von Modell den Umfang st√§ndig vergr√∂√üert.  Sie werden nicht verstehen, welches Modell in welchem ‚Äã‚ÄãKontext verwendet wird, ihr Status wird sich √§ndern und dieselben Probleme werden auf Sie fallen. <br><br>  Ich m√∂chte eine wichtige Idee vermitteln: Wenn Sie globale ver√§nderbare Zust√§nde vermeiden, bedeutet dies nicht, dass Sie sich entspannen, einen Cocktail in einer Hand halten und mit der anderen die Kn√∂pfe dr√ºcken k√∂nnen, um das Leben und Ihren legend√§ren Code zu genie√üen. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   ‚Äî  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : ¬´,     ¬ª. <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     .  Ist es dumm    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   ‚Äî   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       ‚Äî      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454946/">https://habr.com/ru/post/de454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454932/index.html">Investitionen und Software: 5 Handelsterminals f√ºr den Handel an der B√∂rse</a></li>
<li><a href="../de454936/index.html">Vivaldi: Das Blockieren von Anzeigen sollte die Wahl des Nutzers sein</a></li>
<li><a href="../de454938/index.html">Entwicklung eines eigenen Kerns zur Einbettung in ein auf FPGA basierendes Prozessorsystem</a></li>
<li><a href="../de454940/index.html">Reisekrankenversicherung: detaillierte Anweisungen</a></li>
<li><a href="../de454944/index.html">So funktioniert das JPEG-Format</a></li>
<li><a href="../de454958/index.html">Ein Einblick: Graduiertenschule an der EPFL. Teil 4.1: Alltag</a></li>
<li><a href="../de454960/index.html">Microbiota. Wie Medikamente Darmbakterien beeinflussen</a></li>
<li><a href="../de454962/index.html">Wie sch√ºtzen sich IT-Unternehmen weltweit vor Wettbewerbern gegen√ºber ehemaligen Mitarbeitern?</a></li>
<li><a href="../de454966/index.html">Erstellen Sie Sofortspiele auf Unity in Google Play Instant</a></li>
<li><a href="../de454968/index.html">Vladimir Vorobyov: ‚ÄûMikhail Botvinnik war froh, dass die Maschine nicht die L√∂sung gefunden hat, die er an der Tafel gefunden hat.‚Äú</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>