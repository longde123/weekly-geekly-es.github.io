<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèòÔ∏è ü§≤ ‚úñÔ∏è Geplantes Nachtlicht üôÖ üö£üèª üí∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit der Geburt eines Kindes stellte sich die Frage nach einer Nachtlampe. Irgendwo lesen sie, dass es f√ºr einen ruhigen Schlaf notwendig ist. Schnell ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Geplantes Nachtlicht</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433194/"><img src="https://habrastorage.org/webt/nf/ev/13/nfev13d1ijvairxa-ebeg7ng7am.jpeg" alt="Bild"><br><br>  Mit der Geburt eines Kindes stellte sich die Frage nach einer Nachtlampe.  Irgendwo lesen sie, dass es f√ºr einen ruhigen Schlaf notwendig ist.  Schnell verwendet, um mit einem schwachen Licht zu schlafen.  Es ist sehr praktisch, mitten in der Nacht von Schreien und Heulen aufzuwachen und zu sehen, wor√ºber sich das Baby beschwert (wenn Sie verstehen k√∂nnen).  Bei schwachem Licht k√∂nnen Sie auch rocken, sich umdrehen und weiter schlafen. <br><br>  Zun√§chst wurde eine Testprobe der Lampe aus einem St√ºck gelbem LED-Streifen (12 Volt) hergestellt, der 1,5 Jahre lang verwendet wurde. <br><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/an/hw/kd/anhwkdovnnwhdziqqhhbcxr0hbc.jpeg" alt="Bild"><br><br>  Zus√§tzlich zu dem fadenscheinigen Design wurde es jeden Morgen √§rgerlich, das Netzteil aus der Lampensteckdose zu ziehen.  Ich stehe morgens auf, genug Licht kommt von der Stra√üe in den Raum.  Somit wird die Lampe jeden Tag mehrere Stunden lang verschwendet.  In einem halben Jahr verga√ü der chinesische RGB-Bandcontroller erneut die aktuelle Einstellung und es musste nach einem Bedienfeld gesucht werden, um ihn an die Arbeitsweise zu erinnern.  Ich entschied mich f√ºr eine neue Lampe mit automatischer Abschaltung und Farbanpassung sowohl mit Potentiometern als auch mit Radio. <br><br>  Schneller Zusammenbau eines Prototyps basierend auf Arduino Nano.  Grundfunktionalit√§t debuggen. <br><br><img src="https://habrastorage.org/webt/fb/jy/xu/fbjyxu7k6vr2uk2wa66e2oc58yy.jpeg" alt="Bild"><br><br>  Ich nutzte diese Gelegenheit, um Fritzing auszuprobieren.  Es hat mir nicht gefallen, aber die Bilder sind klar und "lustig".  Anscheinend wurde nichts Neues erfunden. <br><br><img src="https://habrastorage.org/webt/el/8v/pr/el8vprz7g0kiuxlvu61ac184t7a.jpeg" alt="Bild"><br><br>  "Nano" wurde durch ein wenig bekanntes, Arduino-kompatibles Modul mit integriertem Funk-Transceiver ersetzt (8-Bit-Controller, Leistung und F√ºllung sind vergleichbar mit "Nana").  Zu Hause habe ich bereits ein Ger√§t, das mit einer Frequenz von 868 MHz arbeitet. Dies ist das zweite.  Kurze Angaben auf der Website des Herstellers: <br><br><div class="spoiler">  <b class="spoiler_title">Kurze Eigenschaften</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jq/6n/c-/jq6nc-tmx6s5s1xlln6t9bm1m8u.png" alt="Bild"><br></div></div><br><br><img src="https://habrastorage.org/webt/gu/1d/rl/gu1drlc_2banpoqihqjrlsiawms.jpeg" alt="Bild"><br><br>  Ich sehe keine gro√üen Probleme bei ESP8266 (es gibt einen praktischen Online-Firmware-Collector f√ºr Skripte auf LUA).  Etwas komplizierter bei Bluetooth (zum Flashen des HM-10-Moduls ben√∂tigen Sie einen kosteng√ºnstigen Programmierer, eine Entwicklungsumgebung und ein Verst√§ndnis des Protokolls).  Obwohl Sie das Bluetooth-Modul mit dem Arduino verwenden k√∂nnen.  Aber ich habe ZUNo verwendet, weil es lange gelogen und auf mich gewartet hat und die gesamte Infrastruktur bereit ist, √§hnliche Ger√§te in einem Netzwerk zu verbinden und zu verwalten (ich spreche vom Smart-Home-Netzwerkcontroller). <br>  F√ºr alle verwendeten Beine auf Arduino wurden Analoga im Modul gefunden. <br><br><img src="https://habrastorage.org/webt/yl/e1/nw/yle1nwmi36wleu53yyx6lunkr0y.png" alt="Bild"><br><br>  Um mit dem Modul aus der Arduino IDE arbeiten zu k√∂nnen, m√ºssen Sie es konfigurieren (die Beschreibung der Einstellungen finden Sie auf der Website des Herstellers).  Es geschah kein Wunder.  Beim Versuch zu kompilieren wurde der Fehler "unterst√ºtzt nicht" f√ºr "Anweisung mit leeren Spalten oder ohne Text!"  Ich habe die Adafruit_NeoPixel-Bibliothek verwendet.  Ich stieg hinein, sah, wie viele Zyklen darin waren und schloss es.  Ich musste erneut auf die Website des Herstellers gehen und nach Beispielen f√ºr die Arbeit mit LEDs suchen (ein Beispiel wurde schnell gefunden).  Ich bin also nicht der erste, der auf ein √§hnliches Problem st√∂√üt. <br><br>  Damit diese Lampe im Arduino-Code per Funk gesteuert werden kann, m√ºssen Sie ein Makro hinzuf√ºgen und mehrere Funktionen implementieren: <br><br><pre><code class="cpp hljs">ZUNO_SETUP_CHANNELS( ZUNO_SWITCH_MULTILEVEL(getRed, setRed), ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen), ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue), ZUNO_SWITCH_BINARY(switch_getter, switch_setter) );</code> </pre> <br>  Dieses Makro beschreibt ein Z-Wave-Ger√§t mit drei mehrstufigen Schaltern (RGB-Steuerung) und einem einfachen Schalter (einfaches Ein- / Ausschalten). <br><br>  Ich habe die einfachste Implementierung von Funktionen (wie in den Beispielen auf der Website des Herstellers).  Sie k√∂nnen es in der beigef√ºgten Liste sehen. <br><br><h3>  <b>Fallauswahl</b> </h3><br>  Ich hatte schon einen Fall.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Versiegelt mit einer transparenten Abdeckung</a> .  Unter den Deckel passen 25 LEDs.  Die Tests waren erfolgreich.  Die Lampe hat einen gro√üen Helligkeitsspielraum f√ºr mein Zimmer.  Die Abdeckung dieses Geh√§uses ist transparent, daher habe ich beschlossen, das Licht etwas zu streuen. <br><br><img src="https://habrastorage.org/webt/eb/dn/a2/ebdna25kb2xg3dedtuhpib2k8qe.jpeg" alt="Bild"><br><br>  Skizziert farbige Perlen und Acrylw√ºrfel, gef√ºllt mit transparentem Epoxid.  Die Farbe der farbigen Perlen l√∂ste sich unter dem Einfluss des Harzes auf. <br><br><img src="https://habrastorage.org/webt/kq/gh/dn/kqghdnnc4qp4dcxa058oun_zwb4.jpeg" alt="Bild"><br><br>  Das Interessanteste ist, dass die Kappe aus dem versiegelten Geh√§use undicht ist und fast das gesamte Harz durchgesickert ist.  Ich wei√ü nicht, wo ich den Deckel getroffen habe, aber nach dem Trocknen ist der Riss deutlich sichtbar. <br><br><img src="https://habrastorage.org/webt/1h/aa/aq/1haaaqrcyeoacbznogmwonzgb8g.jpeg" alt="Bild"><br><br>  Die Leiterplatte wurde nach dem photoresistiven Verfahren hergestellt. <br><br><img src="https://habrastorage.org/webt/me/3w/th/me3wthtnt9ybhvyzc3v_-nhvy0o.jpeg" alt="Bild"><br><br><img src="https://habrastorage.org/webt/oa/kh/vl/oakhvltkcldrtlncqd8kwkub_ms.jpeg" alt="Bild"><br><br>  Nach dem Beizen und Bearbeiten <br><br><img src="https://habrastorage.org/webt/yh/oy/zy/yhoyzyalmtvzihrg_adlie0l0k0.jpeg" alt="Bild"><br><br>  Das Modul mit dem Mikrocontroller wurde durch seinen Prototyp ersetzt, der im Schrank lag (weil es nicht schade ist, aber ZUNo muss gesch√ºtzt werden).  Die erste Version von ZUNo, aber die Abmessungen sind gr√∂√üer und schlechter als bei der Antenne, und Sie k√∂nnen sie noch nicht kaufen.  Die Tests waren mehr oder weniger erfolgreich.  Das letzte Segment musste neu verl√∂tet werden.  Es wurde urspr√ºnglich auf die falsche Seite gel√∂tet.  Und passen Sie die Anzahl der LEDs in der Firmware an. <br><br><img src="https://habrastorage.org/webt/_j/wd/ys/_jwdyskx5_cwxqkea6xt7jbkjqk.jpeg" alt="Bild"><br><br><img src="https://habrastorage.org/webt/gx/qc/qa/gxqcqaaas0qbg7gy54ysyzofbnu.jpeg" alt="Bild"><br><br>  Folgendes ist passiert: <br><br><img src="https://habrastorage.org/webt/i7/fb/0u/i7fb0ul-f1kejvabyxrbhzmkcea.jpeg" alt="Bild"><br><br><h3>  <b>Funksteuerung</b> </h3><br>  Hauptfenster mit Lampensteuerkan√§len <br><br><img src="https://habrastorage.org/webt/zj/r_/_0/zjr__02hc4it_fasqf-qkhi0gle.png" alt="Bild"><br><br>  Stellen Sie die Helligkeit eines Kanals des LED-Streifens ein <br><br><img src="https://habrastorage.org/webt/1b/80/ho/1b80hohb7oaxhwyyzga6k5osnw0.png" alt="Bild"><br><br>  Einstellen der morgendlichen Abschaltung des Nachtlichts <br><br><img src="https://habrastorage.org/webt/yx/ar/ua/yxaruahy9rj26onaqu6tbo2uu5a.png" alt="Bild"><br><br><h3>  <b>Fazit</b> </h3><br>  Das Ger√§t funktioniert.  Es ist kompakt und ordentlich.  Es wird durch Aufladen eines Mobiltelefons mit Strom versorgt. <br>  Aus den festgestellten Problemen: <br><br><ul><li>  W√§hrend der Montage einen Teil der Spuren an variablen Widerst√§nden abrei√üen, sodass Sie im manuellen Modus nur einen Kanal steuern k√∂nnen. </li><li>  Nur 20 von 25 LEDs funktionieren normal. Ich habe viel davon, daher √ºberlasse ich es h√∂chstwahrscheinlich, um schwerwiegendere M√§ngel zu identifizieren </li></ul><br><div class="spoiler">  <b class="spoiler_title">Nachtlichtskizze</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ZUNO_NeoPixel.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_PIXELS 20 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// NB! Z-Uno can not control more than 25 WS2811 without harming RF communications #define PIXEL_SIZE 3 // Three colors per pixel #define BUFF_SIZE (MAX_PIXELS * PIXEL_SIZE) byte pixel_buff[BUFF_SIZE]; NeoPixel pixels(pixel_buff, BUFF_SIZE); #define B_PRESSED 1 #define BUTTON_PIN 1 // Digital IO pin connected to the button. This will be #define DEF_RED 30 #define DEF_GREEN 20 byte red = DEF_RED; byte green = DEF_GREEN; byte blue = 0; #define POWER_ON 1 #define POWER_OFF 0 byte light_power = POWER_ON; byte last_light_power = POWER_OFF; ZUNO_SETUP_CHANNELS( ZUNO_SWITCH_MULTILEVEL(getRed, setRed), ZUNO_SWITCH_MULTILEVEL(getGreen, setGreen), ZUNO_SWITCH_MULTILEVEL(getBlue, setBlue), ZUNO_SWITCH_BINARY(switch_getter, switch_setter) ); void switch_setter(byte value) { Serial.println("switch"); Serial.print("value= "); Serial.println(value); if(value &gt; 1) light_power = POWER_ON; else light_power = POWER_OFF; } byte switch_getter() { return light_power; } int getRed() { return red/2.56; } int getGreen() { return green/2.56; } int getBlue() { return blue/2.56; } void setRed(byte value) { red = value * 2,56; for(uint8_t i = 0; i &lt; MAX_PIXELS; i++) pixels.setPixelColor(i, pixels.Color(red, green, blue)); pixels.show(); Serial.print("set red = "); Serial.println(value); } void setGreen(byte value) { green = value * 2,56; for(uint8_t i = 0; i &lt; MAX_PIXELS; i++) pixels.setPixelColor(i, pixels.Color(red, green, blue)); pixels.show(); Serial.print("set red = "); Serial.println(value); } void setBlue(byte value) { blue = value * 2,56; for(uint8_t i = 0; i &lt; MAX_PIXELS; i++) pixels.setPixelColor(i, pixels.Color(red, green, blue)); pixels.show(); Serial.print("set red = "); Serial.println(value); } void set_LEDS() { for(uint8_t i = 0; i &lt; MAX_PIXELS; i++) pixels.setPixelColor(i, pixels.Color(red, green, blue)); pixels.show(); } void read_resistors() { red = (analogRead(A0) &gt;&gt; 2) &amp; 0xff; green = (analogRead(A1) &gt;&gt; 2) &amp; 0xff; blue = (analogRead(A3) &gt;&gt; 2) &amp; 0xff; Serial.print(red); Serial.print(" "); Serial.print(green); Serial.print(" "); Serial.print(blue); Serial.print(" "); Serial.println(); set_LEDS(); } #define DEBOUNCE_ACK 10 byte check_button() { static bool oldState = HIGH; byte debounce_cnt = 0; static byte ret = 0; if(digitalRead(BUTTON_PIN) == LOW) { if(ret != B_PRESSED) while(digitalRead(BUTTON_PIN) == LOW) { if(debounce_cnt == DEBOUNCE_ACK) { ret = B_PRESSED; break; } else debounce_cnt++; delay(10); } } else { debounce_cnt = 0; ret = 0; } return ret; } void setup() { Serial.begin(9600); pixels.begin(); pixels.clear(); pinMode(BUTTON_PIN, INPUT_PULLUP); } void loop() { if(check_button() == B_PRESSED) read_resistors(); if(last_light_power != light_power) { Serial.println("set power"); if(light_power == POWER_OFF) { Serial.println("power off"); red = 0; green = 0; blue = 0; } else { Serial.println("power on"); red = DEF_RED; green = DEF_GREEN; blue = 0; } set_LEDS(); last_light_power = light_power; } }</span></span></span></span></code> </pre> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433194/">https://habr.com/ru/post/de433194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433182/index.html">Ist es m√∂glich, einen Agenten f√ºr den Handel an der B√∂rse mit Verst√§rkung auszubilden? Implementierung der R-Sprache</a></li>
<li><a href="../de433184/index.html">ASP.NET Core 2.2 ver√∂ffentlicht. Was gibt's Neues? (2 von 3)</a></li>
<li><a href="../de433186/index.html">Es reicht nicht aus, Polygone zu z√§hlen, um 3D-Modelle zu optimieren</a></li>
<li><a href="../de433188/index.html">Die Staatsduma legte einen Gesetzentwurf zur autonomen Arbeit von Runet vor</a></li>
<li><a href="../de433192/index.html">Kubernetes: Eine erstaunlich erschwingliche pers√∂nliche Projektl√∂sung</a></li>
<li><a href="../de433196/index.html">Neujahrsgeschenkf√ºhrer</a></li>
<li><a href="../de433198/index.html">10 Dollar f√ºr Hosting: Vor 20 Jahren und heute</a></li>
<li><a href="../de433202/index.html">Auswahl der Architektur einer L√∂sung f√ºr einen Marktplatz f√ºr Frachtdienste</a></li>
<li><a href="../de433204/index.html">Wie lerne ich die Java-Entwicklung? Die Erfahrung des GeekUniversity-Studenten Nikita Chernetsov</a></li>
<li><a href="../de433206/index.html">Wir laden Sie am 22. Dezember zum Data Christmas Tree ein</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>