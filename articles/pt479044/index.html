<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüíº üë©üèª‚Äçüéì üë©üèæ‚Äçü§ù‚Äçüë®üèø Minha implementa√ß√£o de buffer de anel no flash NOR üîÖ ü§úüèº üíñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antecedentes 


 Existem m√°quinas de venda autom√°tica com design pr√≥prio. Dentro do Raspberry Pi e um pouco de cintas em uma placa separada. Um aceita...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Minha implementa√ß√£o de buffer de anel no flash NOR</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479044/"><h1 id="predystoriya">  Antecedentes </h1><br><p>  Existem m√°quinas de venda autom√°tica com design pr√≥prio.  Dentro do Raspberry Pi e um pouco de cintas em uma placa separada.  Um aceitador de moedas, um aceitador de contas e um terminal banc√°rio est√£o conectados ... Um programa auto-escrito gerencia tudo.  Todo o hist√≥rico do trabalho √© gravado na revista em uma unidade flash USB (MicroSD), que √© transmitida pela Internet (usando um modem USB) para o servidor, onde √© adicionada ao banco de dados.  As informa√ß√µes de vendas s√£o carregadas em 1s, tamb√©m h√° uma interface web simples para monitoramento etc. </p><br><p>  Ou seja, a revista √© vital - para contabilidade (receita, vendas, etc.), monitoramento (todos os tipos de falhas e outras circunst√¢ncias de for√ßa maior);  voc√™ pode dizer todas as informa√ß√µes que temos sobre esta m√°quina. </p><br><h1 id="problema">  O problema </h1><br><p>  As unidades flash se mostram dispositivos muito pouco confi√°veis.  Eles falham com regularidade invej√°vel.  Isso leva ao tempo de inatividade da m√°quina e (se por algum motivo o di√°rio n√£o puder ser transmitido on-line) √† perda de dados. </p><br><p>  <em>Esta n√£o √© a primeira experi√™ncia do uso de pen drives, antes disso havia outro projeto com mais de cem dispositivos em que a revista era armazenada em pen drives USB, havia tamb√©m problemas de confiabilidade, √†s vezes o n√∫mero de falhas por m√™s era de dezenas.</em>  <em>Tentamos diferentes drives flash, incluindo os de marca na mem√≥ria SLC, e alguns modelos s√£o mais confi√°veis ‚Äã‚Äãque outros, mas a substitui√ß√£o de drives flash n√£o resolveu o problema radicalmente.</em> </p><a name="habracut"></a><br><p>  <strong>Aten√ß√£o!</strong>  Longrid!  Se voc√™ n√£o est√° interessado em "por que", mas apenas em "como", pode ir imediatamente <a href="https://habr.com/ru/post/479044/">para o final do</a> artigo. </p><br><h1 id="reshenie">  Solu√ß√£o </h1><br><p>  A primeira coisa que vem √† mente: abandone o MicroSD, coloque, por exemplo, SSD e inicialize a partir dele.  √â teoricamente poss√≠vel, provavelmente, mas relativamente caro e n√£o t√£o confi√°vel (um adaptador USB-SATA √© adicionado; nos SSDs de or√ßamento, as estat√≠sticas de falha tamb√©m n√£o s√£o felizes). </p><br><p>  O HDD USB tamb√©m n√£o parece uma solu√ß√£o particularmente atraente. </p><br><p>  Portanto, chegamos a esta op√ß√£o: deixe o download do MicroSD, mas use-o no modo somente leitura e armazene o log de opera√ß√µes (e outras informa√ß√µes exclusivas de uma pe√ßa de hardware espec√≠fica - n√∫mero de s√©rie, calibra√ß√µes do sensor etc.) em outro local. </p><br><p>  O t√≥pico FS somente leitura para framboesas j√° foi estudado ao longo do tempo. N√£o vou me debru√ßar sobre os detalhes da implementa√ß√£o neste artigo <em>(mas se houver interesse, talvez eu escreva um mini-artigo sobre esse t√≥pico)</em> .  O √∫nico ponto que quero ressaltar: pela experi√™ncia pessoal e pelas avalia√ß√µes que j√° implementaram um ganho em confiabilidade, √©.  Sim, √© imposs√≠vel se livrar completamente das falhas, mas √© bem poss√≠vel reduzir significativamente sua frequ√™ncia.  Sim, e os cart√µes se tornam unificados, o que simplifica bastante a substitui√ß√£o da equipe de manuten√ß√£o. </p><br><h2 id="apparatnaya-chast">  Hardware </h2><br><p>  N√£o havia d√∫vida sobre a escolha do tipo de mem√≥ria - NOR Flash. <br>  Argumentos: </p><br><ul><li>  conex√£o simples (na maioria das vezes o barramento SPI, a experi√™ncia de usar que j√° existe, para que n√£o haja problemas "de ferro" esperados); </li><li>  pre√ßo rid√≠culo; </li><li>  protocolo operacional padr√£o (a implementa√ß√£o j√° est√° no kernel do Linux, se desejar, voc√™ pode contratar um terceiro, que tamb√©m est√° presente, ou at√© mesmo escrever o seu, o benef√≠cio √© simples); </li><li>  confiabilidade e recursos: <br>  de uma folha de dados t√≠pica: os dados s√£o armazenados por 20 anos, 100.000 ciclos de apagamento para cada bloco; <br>  de fontes de terceiros: BER extremamente baixo, postula-se que n√£o h√° necessidade de c√≥digos de corre√ß√£o de erros <em>(em alguns documentos, o ECC para NOR √© considerado, mas geralmente MLC NOR √© usado para isso, acontece)</em> . </li></ul><br><p>  Vamos estimar os requisitos de volume e recurso. </p><br><p>  Quero ter a garantia de salvar dados por v√°rios dias.  Isso √© necess√°rio para que, em caso de problemas com a conex√£o, o hist√≥rico de vendas n√£o seja perdido.  Vamos nos concentrar em 5 dias, durante esse per√≠odo <em>(mesmo levando em considera√ß√£o fins de semana e feriados),</em> podemos resolver o problema. </p><br><p>  Agora estamos digitando cerca de 100kb de revista por dia (3-4 mil registros), mas gradualmente esse n√∫mero est√° crescendo - os detalhes est√£o aumentando, novos eventos est√£o sendo adicionados.  Al√©m disso, √†s vezes h√° explos√µes (alguns sensores come√ßam a enviar spam com falsos positivos, por exemplo).  Vamos calcular 10 mil registros de 100 bytes - megabytes por dia. </p><br><p>  Um total de 5 MB de dados limpos (bem compact√°veis) sai.  Eles tamb√©m <em>(estimativa aproximada)</em> 1 MB de dados de servi√ßo. </p><br><p>  Ou seja, precisamos de um microchip de 8 MB se voc√™ n√£o usar compacta√ß√£o ou 4 MB se voc√™ o usar.  N√∫meros reais para esse tipo de mem√≥ria. </p><br><p>  Quanto ao recurso: se planejarmos que toda a mem√≥ria seja reescrita n√£o mais que uma vez a cada 5 dias, em 10 anos de servi√ßo obteremos menos de mil ciclos de reescrita. <br>  Lembro-me, o fabricante promete cem mil. </p><br><div class="spoiler">  <b class="spoiler_title">Um pouco sobre NOR vs NAND</b> <div class="spoiler_text"><p>  Hoje, √© claro, a mem√≥ria NAND √© muito mais popular, mas para este projeto eu n√£o a usaria: NAND, ao contr√°rio da NOR, requer necessariamente o uso de c√≥digos de corre√ß√£o de erros, uma tabela de blocos defeituosos, etc., e as pernas dos chips NAND geralmente muito mais. </p><br><p>  As desvantagens da NOR incluem: </p><br><ul><li>  pequeno volume (e, consequentemente, alto pre√ßo por megabyte); </li><li>  baixa taxa de c√¢mbio (em grande parte devido ao uso de uma interface serial, geralmente SPI ou I2C); </li><li>  apagamento lento (dependendo do tamanho do bloco, leva de fra√ß√µes de segundo a v√°rios segundos). </li></ul><br><p>  Parece n√£o ser nada cr√≠tico para n√≥s, ent√£o continue. </p></div></div><br><p>  Se os detalhes forem interessantes, o chip <a href="https://www.adestotech.com/wp-content/uploads/doc3686.pdf" rel="nofollow">at25df321a</a> foi escolhido <em>(no entanto, isso √© insignificante, existem muitos an√°logos no mercado que s√£o compat√≠veis com a pinagem e o sistema de comando; mesmo que desejemos colocar o chip de outro fabricante e / ou outro volume, tudo funcionar√° sem alterar o c√≥digo)</em> . </p><br><p>  Eu uso o driver embutido no kernel do Linux, no Raspberry, gra√ßas ao suporte √† sobreposi√ß√£o de √°rvore de dispositivos, tudo √© muito simples - voc√™ precisa colocar a sobreposi√ß√£o compilada em / boot / overlays e modificar um pouco o /boot/config.txt. </p><br><div class="spoiler">  <b class="spoiler_title">Arquivo dts de exemplo</b> <div class="spoiler_text"><p>  Honestamente, n√£o tenho certeza do que est√° escrito sem erros, mas funciona. </p><br><pre><code class="plaintext hljs">/* * Device tree overlay for at25 at spi0.1 */ /dts-v1/; /plugin/; / { compatible = "brcm,bcm2835", "brcm,bcm2836", "brcm,bcm2708", "brcm,bcm2709"; /* disable spi-dev for spi0.1 */ fragment@0 { target = &lt;&amp;spi0&gt;; __overlay__ { status = "okay"; spidev@1{ status = "disabled"; }; }; }; /* the spi config of the at25 */ fragment@1 { target = &lt;&amp;spi0&gt;; __overlay__ { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; flash: m25p80@1 { compatible = "atmel,at25df321a"; reg = &lt;1&gt;; spi-max-frequency = &lt;50000000&gt;; /* default to false: m25p,fast-read ; */ }; }; }; __overrides__ { spimaxfrequency = &lt;&amp;flash&gt;,"spi-max-frequency:0"; fastread = &lt;&amp;flash&gt;,"m25p,fast-read?"; }; };</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">E outra linha no config.txt</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">dtoverlay=at25:spimaxfrequency=50000000</code> </pre> </div></div><br><p>  Omitirei a descri√ß√£o de conectar o chip ao Raspberry Pi.  Por um lado, n√£o sou especialista em eletr√¥nica, por outro lado, tudo √© trivial at√© para mim: o microcircuito possui apenas 8 pernas, das quais precisamos de terra, energia, SPI (CS, SI, SO, SCK);  os n√≠veis coincidem com os do Raspberry Pi, nenhuma liga√ß√£o adicional √© necess√°ria - basta conectar os 6 contatos especificados. </p><br><h2 id="postanovka-zadachi">  Declara√ß√£o do problema </h2><br><p>  Como sempre, a formula√ß√£o do problema passa por v√°rias itera√ß√µes, parece-me que chegou a hora da pr√≥xima.  Ent√£o vamos parar, montar o que j√° foi escrito e esclarecer os detalhes restantes nas sombras. </p><br><p>  Portanto, decidimos que o log ser√° armazenado no SPI NOR Flash. </p><br><div class="spoiler">  <b class="spoiler_title">O que √© o NOR Flash para quem n√£o sabe</b> <div class="spoiler_text"><p>  Essa √© uma mem√≥ria n√£o vol√°til com a qual voc√™ pode executar tr√™s opera√ß√µes: </p><br><ol><li>  Leitura: <br>  A leitura mais comum: passamos o endere√ßo e lemos quantos bytes precisamos; </li><li>  Registro: <br>  Gravar em flash NOR se parece com um normal, mas tem uma peculiaridade: voc√™ pode alterar apenas 1 para 0, mas n√£o vice-versa.  Por exemplo, se tiv√©ssemos 0x55 na c√©lula de mem√≥ria, depois de escrever 0x0f nela, 0x05 j√° estar√° armazenado l√° <em>(veja a tabela abaixo)</em> ; </li><li>  Apagar: <br>  Obviamente, tamb√©m precisamos ser capazes de fazer a opera√ß√£o inversa - alterar 0 para 1, e √© por isso que a opera√ß√£o de exclus√£o existe.  Diferentemente dos dois primeiros, ele opera n√£o em bytes, mas em blocos (o bloco de apagamento m√≠nimo no microcircuito selecionado √© 4kb).  A exclus√£o destr√≥i o bloco inteiro e essa √© a √∫nica maneira de alterar de 0 para 1. Portanto, ao trabalhar com mem√≥ria flash, muitas vezes √© necess√°rio alinhar as estruturas de dados √† borda do bloco de apagamento. <br>  Registro no NOR Flash: </li></ol><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Dados bin√°rios </th></tr></thead><tbody><tr><td>  <strong>Was</strong> </td><td> <code>01010101</code> </td> </tr><tr><td>  <strong>Gravado</strong> </td><td> <code>00001111</code> </td> </tr><tr><td>  <strong>Tornou-se</strong> </td><td> <code>00000101</code> </td> </tr></tbody></table></div></div></div><br><p>  O pr√≥prio di√°rio representa uma sequ√™ncia de registros de tamanho vari√°vel.  Um comprimento de grava√ß√£o t√≠pico √© de cerca de 30 bytes (embora algumas vezes ocorram grava√ß√µes de v√°rios kilobytes).  <em>Nesse caso, trabalhamos com eles como um conjunto de bytes, mas, se voc√™ estiver interessado, o CBOR √© usado dentro dos registros.</em> </p><br><p>  Al√©m do di√°rio, precisamos armazenar algumas informa√ß√µes de "ajuste", atualizadas ou n√£o: um determinado ID do dispositivo, calibra√ß√£o do sensor, o sinalizador "o dispositivo est√° temporariamente desativado", etc. <br>  Essas informa√ß√µes s√£o um conjunto de registros de valores-chave, tamb√©m armazenados no CBOR. N√£o temos muitas informa√ß√µes (no m√°ximo alguns kilobytes), elas s√£o atualizadas com pouca frequ√™ncia. <br>  No futuro, chamaremos de contexto. </p><br><p>  Se voc√™ se lembrar de onde este artigo come√ßou, √© muito importante garantir a confiabilidade do armazenamento de dados e, se poss√≠vel, opera√ß√£o cont√≠nua, mesmo no caso de falhas de hardware / corrup√ß√£o de dados. </p><br><p>  Quais fontes de problemas podem ser consideradas? </p><br><ul><li>  Desligue durante as opera√ß√µes de grava√ß√£o / exclus√£o.  Isto √© da categoria de "contra sucata sem recep√ß√£o". <br>  Informa√ß√µes da <a href="https://electronics.stackexchange.com/questions/225956/what-would-happen-in-case-of-power-outage-during-nor-flash-erase-or-programming" rel="nofollow">discuss√£o</a> sobre stackexchange: quando a energia √© desligada durante o trabalho com flash, a exclus√£o (configura√ß√£o 1), a grava√ß√£o (configura√ß√£o 0) levam a um comportamento indefinido: os dados podem ser gravados, parcialmente gravados (por exemplo, transferimos 10 bytes / 80 bits) e apenas 45 bits conseguiram ser gravados), tamb√©m √© poss√≠vel que alguns bits estejam no estado "intermedi√°rio" (a leitura pode produzir 0 ou 1); </li><li>  Erros da pr√≥pria mem√≥ria flash. <br>  BER, embora muito baixo, n√£o pode ser igual a zero; </li><li>  Erros de barramento <br>  Os dados transmitidos via SPI n√£o s√£o protegidos de forma alguma, podem ocorrer como erros de bit √∫nico ou erros de sincroniza√ß√£o - perda ou inser√ß√£o de bits (o que leva a uma distor√ß√£o maci√ßa de dados); </li><li>  Outros erros / falhas <br>  Erros no c√≥digo, "falhas" de framboesa, interven√ß√£o alien√≠gena ... </li></ul><br><p>  Formulei requisitos, cujo cumprimento, na minha opini√£o, √© necess√°rio para garantir a confiabilidade: </p><br><ul><li>  Os registros devem ser gravados na mem√≥ria flash imediatamente, a grava√ß√£o pendente n√£o √© considerada; - se ocorrer um erro, ele deve ser detectado e processado o mais r√°pido poss√≠vel; - o sistema deve, se poss√≠vel, recuperar-se de erros. <br>  <em>(um exemplo da vida "como n√£o deveria ser", que acho que todos conheceram: ap√≥s uma reinicializa√ß√£o de emerg√™ncia, o sistema de arquivos "quebrou" e o sistema operacional n√£o inicializa)</em> </li></ul><br><h2 id="idei-podhody-razmyshleniya">  Ideias, Abordagens, Pensamentos </h2><br><p>  Quando comecei a pensar nessa tarefa, v√°rias id√©ias passaram pela minha cabe√ßa, por exemplo: </p><br><ul><li>  Usar compacta√ß√£o de dados </li><li>  Use estruturas de dados complicadas, por exemplo, armazene cabe√ßalhos de registros separadamente dos pr√≥prios registros, para que, se ocorrer um erro em um registro, voc√™ possa ler o restante sem problemas </li><li>  use campos de bits para controlar a integridade da grava√ß√£o quando a energia for desligada; </li><li>  armazenar somas de verifica√ß√£o para tudo e tudo; </li><li>  use algum tipo de codifica√ß√£o de corre√ß√£o de erros. </li></ul><br><p>  Algumas dessas id√©ias foram usadas, outras foram decididas recusar.  Vamos em ordem. </p><br><h3 id="szhatie-dannyh">  Compress√£o de dados </h3><br><p>  Os eventos que gravamos no di√°rio s√£o iguais e repet√≠veis ("jogou uma moeda de 5 rublos", "clicou no bot√£o de entrega de trocas", ...).  Portanto, a compacta√ß√£o deve ser bastante eficaz. </p><br><p>  A sobrecarga para compacta√ß√£o √© insignificante (o processador que temos √© bastante poderoso, mesmo no primeiro Pi havia um n√∫cleo com frequ√™ncia de 700 MHz, nos modelos atuais havia v√°rios n√∫cleos com frequ√™ncia superior a um gigahertz), a velocidade de troca com o armazenamento √© baixa (v√°rios megabytes por segundo), o tamanho do registro √© pequeno.  Em geral, se a compacta√ß√£o afetar√° o desempenho, apenas positivo <em>(absolutamente n√£o cr√≠tico, apenas afirmando)</em> .  Al√©m disso, n√£o temos um Linux realmente incorporado, mas comum - portanto a implementa√ß√£o n√£o deve exigir muito esfor√ßo (basta vincular a biblioteca e usar v√°rias fun√ß√µes). </p><br><p>  Uma parte do log foi retirada do dispositivo de trabalho (1,7 MB, 70 mil registros) e, para come√ßar, foi verificada a compressibilidade usando os gzip, lz4, lzop, bzip2, xz, zstd dispon√≠veis no computador. </p><br><ul><li>  gzip, xz, zstd apresentaram resultados semelhantes (40Kb). <br>  Fiquei surpreso que o xz da moda se mostrasse aqui no n√≠vel gzip ou zstd; </li><li>  O lzip com configura√ß√µes padr√£o deu um resultado um pouco pior; </li><li>  lz4 e lzop n√£o apresentaram resultados muito bons (150Kb); </li><li>  O bzip2 mostrou resultados surpreendentemente bons (18Kb). </li></ul><br><p>  Portanto, os dados s√£o compactados muito bem. <br>  Ent√£o (se n√£o encontrarmos falhas fatais), deve haver compress√£o!  S√≥ porque mais dados caber√£o na mesma unidade flash. </p><br><p>  Vamos pensar nas falhas. </p><br><p>  O primeiro problema: j√° concordamos que cada registro deve aparecer imediatamente.  Normalmente, o arquivador coleta dados do fluxo de entrada at√© decidir que √© hora de gravar na sa√≠da.  Precisamos obter imediatamente um bloco de dados compactados e salv√°-lo na mem√≥ria n√£o vol√°til. </p><br><p>  Eu vejo tr√™s maneiras: </p><br><ol><li>  Compacte cada entrada usando a compacta√ß√£o de dicion√°rio em vez dos algoritmos discutidos acima. <br>  √â uma op√ß√£o de trabalho, mas eu n√£o gosto.  Para garantir um n√≠vel de compacta√ß√£o mais ou menos decente, o dicion√°rio deve ser "aprimorado" para dados espec√≠ficos, qualquer altera√ß√£o levar√° ao fato de que o n√≠vel de compacta√ß√£o cai catastroficamente.  Sim, o problema √© resolvido com a cria√ß√£o de uma nova vers√£o do dicion√°rio, mas isso √© uma dor de cabe√ßa - precisaremos armazenar todas as vers√µes do dicion√°rio;  em cada entrada, precisaremos indicar com qual vers√£o do dicion√°rio ele foi compactado ... </li><li>  Comprima cada entrada com algoritmos "cl√°ssicos", mas independentemente dos outros. <br>  Os algoritmos de compacta√ß√£o em quest√£o n√£o foram projetados para trabalhar com registros desse tamanho (dezenas de bytes); o coeficiente de compacta√ß√£o ser√° claramente menor que 1 (ou seja, um aumento na quantidade de dados em vez da compacta√ß√£o); </li><li>  FLUSH ap√≥s cada grava√ß√£o. <br>  Muitas bibliotecas de compacta√ß√£o t√™m suporte para FLUSH.  Este √© um comando (ou par√¢metro do procedimento de compacta√ß√£o), ap√≥s o recebimento do arquivador, que gera um fluxo compactado para que, com base em <strong>todos os</strong> dados n√£o compactados j√° recebidos, possam ser restaurados.  Um an√°logo de <code>sync</code> em sistemas de arquivos ou <code>commit</code> em sql. <br>  O que √© importante, as opera√ß√µes de compacta√ß√£o subsequentes poder√£o usar o dicion√°rio acumulado e a taxa de compacta√ß√£o n√£o sofrer√° tanto quanto na vers√£o anterior. </li></ol><br><p>  Eu acho que √© √≥bvio que escolhi a terceira op√ß√£o, vamos falar mais detalhadamente. </p><br><p>  Houve um <a href="https://www.bolet.org/~pornin/deflate-flush.html" rel="nofollow">√≥timo artigo</a> sobre o FLUSH no zlib. </p><br><p>  Fiz um teste motivado com base no artigo, peguei 70 mil entradas de di√°rio de um dispositivo real, com um tamanho de p√°gina de 60Kb <em>(retornaremos ao tamanho da p√°gina)</em> : </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Dados de origem </th><th>  Compress√£o Gzip -9 (sem FLUSH) </th><th>  zlib com Z_PARTIAL_FLUSH </th><th>  zlib com Z_SYNC_FLUSH </th></tr></thead><tbody><tr><td>  <strong>Volume, Kb</strong> </td><td>  1692 </td><td>  40. </td><td>  352 </td><td>  604 </td></tr></tbody></table></div><br><p>  √Ä primeira vista, o pre√ßo introduzido pelo FLUSH √© excessivamente alto, mas, na realidade, temos uma m√° escolha - n√£o comprimir nada, nem comprimir (e com muita efici√™ncia) o FLUSH.  N√£o esque√ßa que temos 70 mil registros, a redund√¢ncia introduzida por Z_PARTIAL_FLUSH √© de apenas 4-5 bytes por registro.  E a taxa de compress√£o acabou por ser quase 5: 1, o que √© mais do que um excelente resultado. </p><br><div class="spoiler">  <b class="spoiler_title">Pode parecer inesperado, mas na verdade o Z_SYNC_FLUSH √© uma maneira mais eficiente de executar o FLUSH</b> <div class="spoiler_text"><p>  No caso de usar Z_SYNC_FLUSH, os √∫ltimos 4 bytes de cada registro sempre ser√£o 0x00, 0x00, 0xff, 0xff.  E se os conhecemos, n√£o podemos armazen√°-los, ent√£o o tamanho total √© de apenas 324Kb. </p><br><p>  O artigo ao qual estou me referindo tem uma explica√ß√£o: </p><br><blockquote>  Um novo bloco do tipo 0 com conte√∫do vazio √© anexado. <br><br>  Um bloco do tipo 0 com conte√∫do vazio consiste em: <br><ul><li>  o cabe√ßalho do bloco de tr√™s bits; </li><li>  0 a 7 bits igual a zero, para obter alinhamento de bytes; </li><li>  a sequ√™ncia de quatro bytes 00 00 FF FF. </li></ul><br></blockquote><p>  Como voc√™ pode ver, no √∫ltimo bloco anterior a esses 4 bytes vem de 3 a 10 bits zero.  No entanto, a pr√°tica mostrou que zero bits s√£o realmente pelo menos 10. </p><br><p>  Acontece que esses blocos de dados curtos geralmente s√£o (sempre?) Codificados usando um bloco do tipo 1 (bloco fixo), que necessariamente termina com 7 bits zero, ent√£o obtemos 10-17 bits zero garantidos (e o restante ser√° zero com uma probabilidade de cerca de 50%). </p><br><p>  Portanto, nos dados de teste, em 100% dos casos, antes de 0x00, 0x00, 0xff, 0xff, existe um byte zero e, mais do que no terceiro caso, dois bytes zero <em>(talvez o fato seja que eu uso CBOR bin√°rio e quando uso o texto CBOR √â mais prov√°vel que o JSON encontre blocos do tipo 2 - bloco din√¢mico, respectivamente, os blocos ocorreriam sem zero bytes adicionais antes de 0x00, 0x00, 0xff, 0xff)</em> . </p><br><p>  O total dos dados de teste dispon√≠veis pode caber em menos de 250 KB de dados compactados. </p><br><p>  Voc√™ pode economizar um pouco mais fazendo malabarismos com bits: agora ignoramos a presen√ßa de v√°rios bits zero no final do bloco, v√°rios bits no in√≠cio do bloco tamb√©m n√£o s√£o alterados ... <br>  Mas ent√£o tomei uma forte decis√£o de parar, caso contr√°rio, a esse ritmo, voc√™ poder√° alcan√ßar o desenvolvimento do seu arquivador. </p></div></div><br><p>  No total, obtive de 3 a 4 bytes por registro dos meus dados de teste, a taxa de compacta√ß√£o era superior a 6: 1.  Honestamente, eu n√£o contei com esse resultado, na minha opini√£o tudo o que √© melhor que 2: 1 j√° √© um resultado que justifica o uso da compacta√ß√£o. </p><br><p>  Est√° tudo bem, mas o zlib (deflate) ainda est√° <del>  arcaico </del>  algoritmo de compress√£o bem merecido e levemente antiquado.  O mero fato de que os √∫ltimos 32 KB do fluxo de dados n√£o compactados sejam usados ‚Äã‚Äãcomo um dicion√°rio parece hoje estranho (ou seja, se algum bloco de dados for muito semelhante ao que estava no fluxo de entrada de 40 KB novamente, ele come√ßar√° a ser arquivado novamente, mas n√£o ser√° consulte a entrada anterior).  Em <del>  elegante </del>  o dicion√°rio de tamanho dos arquivadores modernos √© geralmente medido em megabytes em vez de kilobytes. </p><br><p>  Ent√£o, continuamos nosso mini-estudo de arquivadores. </p><br><p>  Em seguida, o bzip2 foi testado (lembre-se, sem FLUSH, ele mostrou uma taxa de compress√£o fant√°stica, quase 100: 1).  Infelizmente, com o FLUSH mostrou-se muito pouco, o tamanho dos dados compactados foi maior que o dos n√£o compactados. </p><br><div class="spoiler">  <b class="spoiler_title">Minhas suposi√ß√µes sobre os motivos da falha</b> <div class="spoiler_text"><p>  O Libbz2 oferece apenas uma op√ß√£o de libera√ß√£o, que parece limpar o dicion√°rio (semelhante a Z_FULL_FLUSH no zlib), n√£o h√° motivo para falar sobre algum tipo de compacta√ß√£o efetiva. </p></div></div><br><p>  E o zstd foi o √∫ltimo a ser testado.  Dependendo dos par√¢metros, ele √© compactado no n√≠vel gzip, mas muito mais r√°pido, ou gzip √© melhor. </p><br><p>  Infelizmente, com o FLUSH, ele provou ser "n√£o muito": o tamanho dos dados compactados ficou em torno de 700Kb. </p><br><p>  Fiz <a href="https://github.com/facebook/zstd/issues/900" rel="nofollow">uma pergunta</a> na p√°gina do projeto no github, recebi uma resposta que vale a pena contar com at√© 10 bytes de dados de servi√ßo para cada bloco de dados compactados, que √© pr√≥ximo aos resultados, capturar deflate n√£o funciona. </p><br><p>  Decidi parar com isso em experimentos com arquivadores (lembro que xz, lzip, lzo, lz4 n√£o apareceram no est√°gio de teste sem o FLUSH, mas n√£o considerei algoritmos de compress√£o mais ex√≥ticos). </p><br><p>  Voltamos aos problemas de arquivamento. </p><br><p>  O segundo problema (como eles dizem em ordem, mas n√£o em valor) - os dados compactados s√£o um √∫nico fluxo no qual h√° constantemente o envio para as se√ß√µes anteriores.  Assim, quando uma se√ß√£o de dados compactados √© danificada, perdemos n√£o apenas o bloco de dados n√£o compactados associado a ela, mas tamb√©m todos os subsequentes. </p><br><p>  Existe uma abordagem para resolver esse problema: </p><br><ol><li>  Evitar a ocorr√™ncia de um problema - adicione redund√¢ncia aos dados compactados, o que permitir√° identificar e corrigir erros;  falaremos sobre isso mais tarde; </li><li>  Minimize as consequ√™ncias em caso de problema <br>  J√° dissemos anteriormente que √© poss√≠vel compactar cada bloco de dados de forma independente, e o problema desaparecer√° por si s√≥ (a corrup√ß√£o de dados de um bloco levar√° √† perda de dados apenas desse bloco).  No entanto, este √© um caso extremo em que a compacta√ß√£o de dados ser√° ineficiente.  O extremo oposto: use todos os 4 MB do nosso microcircuito como um √∫nico arquivo, o que nos dar√° uma excelente compress√£o, mas consequ√™ncias catastr√≥ficas em caso de corrup√ß√£o de dados. <br>  <em>Sim, √© necess√°rio um compromisso em termos de confiabilidade.</em>  <em>Mas devemos lembrar que estamos desenvolvendo um formato de armazenamento de dados para mem√≥ria n√£o vol√°til com um BER extremamente baixo e um per√≠odo de armazenamento de dados declarado de 20 anos.</em> </li></ol><br><p>  No decorrer das experi√™ncias, descobri que as perdas mais ou menos percept√≠veis no n√≠vel de compacta√ß√£o come√ßam em blocos de dados compactados com um tamanho inferior a 10 KB. <br>  Foi mencionado anteriormente que a mem√≥ria usada possui uma organiza√ß√£o da p√°gina; n√£o vejo raz√£o para que voc√™ n√£o deva usar a correspond√™ncia ‚Äúuma p√°gina - um bloco de dados compactados‚Äù. </p><br><p>  Ou seja, o tamanho m√≠nimo de p√°gina razo√°vel √© 16 KB (com uma margem para informa√ß√µes de servi√ßo).  No entanto, um tamanho de p√°gina t√£o pequeno imp√µe restri√ß√µes significativas ao tamanho m√°ximo de grava√ß√£o. </p><br><p>  Embora eu ainda n√£o espere registros de mais unidades de kilobytes na forma compactada, decidi usar 32 KB de p√°ginas (um total de 128 p√°ginas por chip). </p><br><p>  <strong>Resumo:</strong> </p><br><ul><li>  Armazenamos dados compactados usando zlib (deflate); </li><li>  Para cada registro, defina Z_SYNC_FLUSH; </li><li>  Para cada registro compactado, recortamos os bytes finais <em>(por exemplo, 0x00, 0x00, 0xff, 0xff)</em> ;  no cabe√ßalho, indique quantos bytes cortamos; </li><li>  Armazenamos dados em p√°ginas de 32Kb;  dentro da p√°gina, h√° um √∫nico fluxo de dados compactados;  em cada p√°gina, come√ßamos a compacta√ß√£o novamente. </li></ul><br><p>  E, antes de terminar a compacta√ß√£o, gostaria de chamar a aten√ß√£o para o fato de termos apenas alguns bytes de dados de grava√ß√£o, por isso √© extremamente importante n√£o aumentar as informa√ß√µes de servi√ßo, pois cada byte √© contado. </p><br><h3 id="hranenie-zagolovkov-dannyh">  Armazenando cabe√ßalhos de dados </h3><br><p>  Como temos registros de comprimento vari√°vel, precisamos determinar de alguma forma a localiza√ß√£o / limites dos registros. </p><br><p>  Conhe√ßo tr√™s abordagens: </p><br><ol><li>  Todos os registros s√£o armazenados em um fluxo cont√≠nuo, primeiro vem o cabe√ßalho do registro que cont√©m o comprimento e depois o pr√≥prio registro. <br>  Nesta modalidade, os cabe√ßalhos e os dados podem ter um comprimento vari√°vel. <br>  De fato, obtemos uma lista vinculada √∫nica que √© usada o tempo todo; </li><li>  Os pr√≥prios cabe√ßalhos e registros s√£o armazenados em fluxos separados. <br>  Usando cabe√ßalhos de comprimento constante, garantimos que os danos a um cabe√ßalho n√£o afetem o restante. <br>  Uma abordagem semelhante √© usada, por exemplo, em muitos sistemas de arquivos; </li><li>  Os registros s√£o armazenados em um fluxo cont√≠nuo, o limite do registro √© determinado por algum marcador (s√≠mbolo / sequ√™ncia de caracteres, que √© / que √© proibido dentro de blocos de dados).  Se um marcador for encontrado dentro do registro, ent√£o o substituiremos por uma determinada sequ√™ncia (escape). <br>  Uma abordagem semelhante √© usada, por exemplo, no protocolo PPP. </li></ol><br><p>  Vou ilustrar. </p><br><p>  Op√ß√£o 1: <br><img src="https://habrastorage.org/webt/b3/yu/q8/b3yuq8z6elbufkrice2g_vjtuhe.png" alt="Op√ß√£o 1"><br>  Tudo √© muito simples aqui: sabendo o tamanho do registro, podemos calcular o endere√ßo do pr√≥ximo cabe√ßalho.  Ent√£o, movemos os cabe√ßalhos at√© encontrarmos uma regi√£o preenchida com 0xff (regi√£o livre) ou no final da p√°gina. </p><br><p>  Op√ß√£o 2: <br><img src="https://habrastorage.org/webt/kf/qy/_7/kfqy_7qzi7pzmk-g5cqa4r6s75q.png" alt="Op√ß√£o 2"><br>  Devido ao tamanho vari√°vel do registro, n√£o podemos dizer antecipadamente quantos registros (e, portanto, os cabe√ßalhos) por p√°gina que precisamos.  Voc√™ pode espalhar os cabe√ßalhos e os dados em p√°ginas diferentes, mas eu prefiro uma abordagem diferente: colocamos os cabe√ßalhos e os dados na mesma p√°gina, no entanto, os cabe√ßalhos (de tamanho constante) v√™m do in√≠cio da p√°gina e os dados (de tamanho vari√°vel) do final.  Assim que eles "se encontram" (n√£o h√° espa√ßo livre suficiente para um novo registro) - consideramos que esta p√°gina est√° cheia. </p><br><p>  Op√ß√£o 3: <br><img src="https://habrastorage.org/webt/-q/u1/qj/-qu1qjmqlcvfi570ovsdy_nzzny.png" alt="Op√ß√£o 3"><br>  N√£o h√° necessidade de armazenar no cabe√ßalho o comprimento ou outras informa√ß√µes sobre a localiza√ß√£o dos dados, existem marcadores suficientes que indicam os limites dos registros.  No entanto, os dados devem ser processados ‚Äã‚Äãdurante a grava√ß√£o / leitura. <br>  Como marcador, eu usaria 0xff (que a p√°gina √© preenchida ap√≥s a exclus√£o), para que a √°rea livre definitivamente n√£o seja tratada como dados. </p><br><p>  Tabela de compara√ß√£o: </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Op√ß√£o 1 </th><th>  Op√ß√£o 2 </th><th>  Op√ß√£o 3 </th></tr></thead><tbody><tr><td>  <strong>Toler√¢ncia a erros</strong> </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  <strong>Compacidade</strong> </td><td>  + </td><td>  - </td><td>  + </td></tr><tr><td>  <strong>Complexidade de implementa√ß√£o</strong> </td><td>  * </td><td>  ** </td><td>  ** </td></tr></tbody></table></div><br><p>  A op√ß√£o 1 tem uma falha fatal: se algum cabe√ßalho estiver danificado, toda a cadeia subsequente ser√° destru√≠da.  Outras op√ß√µes permitem recuperar parte dos dados, mesmo com grandes danos. <br>  Mas aqui √© apropriado lembrar que decidimos armazenar os dados em um formato compactado e, portanto, perdemos todos os dados na p√°gina ap√≥s o registro "quebrado", portanto, mesmo que haja um sinal de menos na tabela, n√£o levamos em conta. </p><br><p>  Compacidade: </p><br><ul><li>  na primeira vers√£o, precisamos armazenar apenas o comprimento no cabe√ßalho, se n√∫meros inteiros de comprimento vari√°vel forem usados, na maioria dos casos, podemos fazer com um byte; </li><li>  na segunda op√ß√£o, precisamos armazenar o endere√ßo inicial e o comprimento;  o registro deve ter um tamanho constante, eu estimo 4 bytes por registro (dois bytes por deslocamento e dois bytes por comprimento); </li><li>          ,    -    1-2%.       . </li></ul><br><p>        (   ).      ,     . </p><br><p> <em>, -  -    . ,        ,      ‚Äî     ,  , ...</em> </p><br><p>     :          ,      ,      .. , , ,      ‚Äî     ,   . </p><br><p> <strong>:</strong>       "   ‚Äî   " -    . </p><br><h3 id="ispolzovanie-bitovyh-poley-dlya-kontrolya-uspeshnosti-operaciy-zapisi">         </h3><br><p>    ,    ,     : <br>         . <br> <em>   ,  erase    1,     1  0,   .</em>    "  "  1,  " " ‚Äî 0. </p><br><p>          flash: </p><br><ol><li>   ‚Äú  ‚Äù; </li><li>  ; </li><li>   ‚Äú  ‚Äù; </li><li>  ; </li><li>   ‚Äú ‚Äù. </li></ol><br><p>  ,     ‚Äú ‚Äù,  4  . </p><br><p>          ‚Äú1111‚Äù ‚Äî     ‚Äú1000‚Äù ‚Äî   ;         ,        . </p><br><p>  ,           , , , ,      (   )   . </p><br><p> <strong>:</strong>      . </p><br><h3 id="kontrolnye-summy">   </h3><br><p>       (  )     ,     . ,       ,   . </p><br><p>      ,     ,           <em>( , ,   ‚Äî       )</em> . </p><br><p>  ,    ,   ,   ‚Äî  . </p><br><p>         ‚Äî CRC.   ,     100%    ,   ‚Äî               <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x2212;</mo><mi>n</mi></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.659ex" height="2.298ex" viewBox="0 -883.9 1575.6 989.6" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-6E" x="778" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mo>‚àí</mo><mi>n</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">2^{-n}</script>  .      ,      ,       :       ,      .  ‚Äî      . </p><br><p>   : <a href="http://amsoftware.narod.ru/algo.html" rel="nofollow"> 1</a> , <a href="http://amsoftware.narod.ru/algo2.html" rel="nofollow"> 2</a> <em>(  narod.ru, )</em> . </p><br><p>       , CRC ‚Äî     .    ,    . </p><br><p>        ,     . </p><br><p> : <br>         <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>10</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x2212;</mo><mn>3</mn></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.658ex" height="2.419ex" viewBox="0 -935.7 2005.4 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-30" x="500" y="0"></use><g transform="translate(1001,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-33" x="778" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mo>‚àí</mo><mn>3</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-2">10^{-3}</script>    ,       : </p><br><div class="scrollable-table"><table><thead><tr><th> ,  </th><th>  ,  </th><th>   </th><th>    </th><th>    </th></tr></thead><tbody><tr><td>  1 </td><td>  0 0 </td><td>  1000 </td><td>  0 0 </td><td>  1000 </td></tr><tr><td>  1 </td><td>  1 </td><td>  4 </td><td> 999 </td><td> 1003 </td></tr><tr><td>  1 </td><td>  2 </td><td> ‚âà0 </td><td> 1997 </td><td> 1997 </td></tr><tr><td>  1 </td><td>  4 </td><td> ‚âà0 </td><td> 3990 </td><td> 3990 </td></tr><tr><td>  10 </td><td>  0 0 </td><td> 9955 </td><td>  0 0 </td><td> 9955 </td></tr><tr><td>  10 </td><td>  1 </td><td>  39. </td><td> 990 </td><td> 1029 </td></tr><tr><td>  10 </td><td>  2 </td><td> ‚âà0 </td><td> 1979 </td><td> 1979 </td></tr><tr><td>  10 </td><td>  4 </td><td> ‚âà0 </td><td> 3954 </td><td> 3954 </td></tr><tr><td>  1000 </td><td>  0 0 </td><td> 632305 </td><td>  0 0 </td><td> 632305 </td></tr><tr><td>  1000 </td><td>  1 </td><td> 2470 </td><td> 368 </td><td> 2838 </td></tr><tr><td>  1000 </td><td>  2 </td><td>  10 </td><td> 735 </td><td> 745 </td></tr><tr><td>  1000 </td><td>  4 </td><td> ‚âà0 </td><td> 1469 </td><td> 1469 </td></tr></tbody></table></div><br><p>  ,   ‚Äî               ‚Äî    . </p><br><p> ,      : ,       ,           .     ,  <a href="https://habr.com/ru/post/428746/">   </a> . </p><br><p> ,        ,      32    <em>(   64     -)</em> . </p><br><p>   ,    ,      , -   32-   (16  ,    0.01%;  24 ,  ,     ). </p><br><p>    :          ,    4  ?           ?  ,   <em> </em> ,      . </p><br><p>       ,     CRC-32C. <br>    6      22  (,     c), 4      655  (    ), 2           . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><p> <a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check" rel="nofollow"> </a>  CRC. </p><br><p> <a href="https://users.ece.cmu.edu/~koopman/crc/c32/0x8f6e37a0_len.txt" rel="nofollow">  crc-32c</a>  <a href="http://users.ece.cmu.edu/~koopman/crc/notes.html" rel="nofollow"> </a> ‚Äî ,    CRC  . </p><br><p>  <a href="http://users.ece.cmu.edu/~koopman/networks/dsn02/dsn02_koopman.pdf" rel="nofollow"> </a>  <a href="https://users.ece.cmu.edu/~koopman/crc/c32/0xfa567d89_len.txt" rel="nofollow">   </a> ,          ,      ,    ,         . </p></div></div><br><p> ,      ,  :       ? </p><br><p>  ""     : </p><br><ul><li>          ‚Äî       (         /, ,     ..); </li><li>  deflate  zlib      <em> </em>   ""  ,  ,         ,      (        , zlib      ). </li></ul><br><p>  ""     : </p><br><ul><li> CRC ""     ,    - (          ,  ,  ,   "" ); </li><li>          , <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-72/product_id-1820/GNU-Zlib.html" rel="nofollow">  </a> ,   . </li></ul><br><p>              . </p><br><p> <strong>:</strong>  CRC-32C,        ,      flash ( ). </p><br><h3 id="izbytochnost">  </h3><br><p>     , ,   , ,    (   )     . </p><br><p>        ,   . <br>       ,  - ,           RAID-6         . <br>         ,   ,           ,     . </p><br><p>   ,       .        ? </p><br><ol><li>   ( -      ,  Raspberry, ...) <br> ,             ; </li><li>   ( -   flash-   ,  ) <br>      ,         ; </li><li>       ; </li><li>   <br>            . </li></ol><br><p>       (    )       . ,   -  . </p><br><p> <strong>:</strong>      , ,      ,      (     ,      ). </p><br><h3 id="prochee">  Outros </h3><br><p> ,          <em>(      )</em> ,      ,   . </p><br><ul><li>     "" <br>     -    ,    ..,    ,      . <br>     ,    ,    ; </li><li>     . <br>       ‚Äî ! <br>         Magic Number (),        <em>( ,       )</em> ; </li><li>    (  )   ,         1 ; </li><li>               . </li></ul><br><p>   <a href="https://planetcalc.com/2481/" rel="nofollow">-</a>  .          . </p><br><h1 id="anchorformatanchoropisanie-formata-hraneniya-dannyh"><a name="format"></a>     </h1><br><h2 id="byte-order"> Byte order </h2><br><p> ,    ,   big-endian  (network byte order),   0x1234   0x12, 0x34. </p><br><h2 id="delenie-na-stranicy">    </h2><br><p>  -     . </p><br><p>     32,   ,  1/4      (   4  128 ). </p><br><p>        (          ). </p><br><p>       (   ),    0 (     0,  ‚Äî  32,  ‚Äî  64  ..) </p><br><p>       (ring buffer),          0,    1, ...,     ,          . </p><br><h2 id="vnutri-stranicy">   </h2><br><p><img src="https://habrastorage.org/webt/7r/sr/fa/7rsrfafqrc263dsu8zd5ptceqga.png" alt="Page"><br>     4-  ,     (CRC-32C),      ", ,  ". </p><br><p>   (  -)  : </p><br><ul><li>   Magic Number (  ‚Äî   ) <br>        <code>0xed00 ‚äï  </code> ; </li><li>   " " (   ). </li></ul><br><p>        (  deflate).          (  ),       .              (   ). </p><br><p>      Z_SYNC_FLUSH,        4  0x00, 0x00, 0xff, 0xff, , ,      . <br>   ( 4, 5  6 )      -. </p><br><p>      1, 2  3 , : </p><br><ul><li>   (T),   : 0 ‚Äî , 1 ‚Äî ; </li><li>    (S)  1  7 ,     "",       ; </li><li>   (L). </li></ul><br><p>   S: </p><br><div class="scrollable-table"><table><thead><tr><th> S </th><th>  ,  </th><th>   ,  </th></tr></thead><tbody><tr><td> <code>0</code> </td> <td>  1 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>10</code> </td> <td>  1 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr><tr><td> <code>110</code> </td> <td>  2 </td><td> 4 ( <code>00 00 ff ff</code> ) </td></tr><tr><td> <code>1110</code> </td> <td>  2 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>11110</code> </td> <td>  2 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr><tr><td> <code>1111100</code> </td> <td>  3 </td><td> 4 ( <code>00 00 ff ff</code> ) </td></tr><tr><td> <code>1111101</code> </td> <td>  3 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>1111110</code> </td> <td>  3 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr></tbody></table></div><br><p>  ,  ,   : <br><img src="https://habrastorage.org/webt/iu/fu/bp/iufubpdgxnpv9czd45tomt-0vtc.png" alt="Entrada do t√≠tulo"><br>     T,  ‚Äî  S,  L (    ),  ‚Äî  ,  ‚Äî    ,     -. </p><br><p>  ,      ( 63+5    )     . </p><br><p>       CRC-32C,       (init)      . </p><br><p> <em>CRC   "",  (-    )  :</em> <math> </math><em><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>B</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mi>B</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.505ex" height="2.66ex" viewBox="0 -832 18731.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-52" x="760" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="1520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-28" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-69" x="2670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-6E" x="3015" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-69" x="3616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-74" x="3961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-2C" x="4323" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-41" x="4768" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-7C" x="5518" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-7C" x="5797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-42" x="6075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-29" x="6835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-3D" x="7502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="8558" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-52" x="9319" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="10078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-28" x="10839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="11228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-52" x="11989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-43" x="12748" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-28" x="13509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-69" x="13898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-6E" x="14244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-69" x="14844" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-74" x="15190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-2C" x="15551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-41" x="15996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-29" x="16747" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-2C" x="17136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMATHI-42" x="17582" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhhNYBjVwHLx4VDfo1k4K5CSLHrfVw#MJMAIN-29" x="18341" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mo stretchy="false">)</mo><mo>,</mo><mi>B</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">CRC(init, A || B) = CRC(CRC(init, A), B)</script></em>   <em>.</em> <em><br>      CRC         .</em> </p><br><p>        . </p><br><p>    ,         0x00  0xff (       0xff,      ; 0x00    ). </p><br><h2 id="primernye-algoritmy">   </h2><br><h3 id="chtenie-iz-flesh-pamyati">   - </h3><br><p>       . <br>      ‚Äî       -  . </p><br><p> <em>(  , Linux     NOR Flash, )</em> </p><br><h3 id="zapis-v-flesh-pamyat">   - </h3><br><p>  . <br>  . </p><br><p>        ‚Äî       . </p><br><h3 id="podgotovka-novoy-mikroshemy-k-rabote">      </h3><br><p>     ( )      1. <br>         ( UUID    ). </p><br><p> , -   . </p><br><h3 id="zagruzka-avtomata">   </h3><br><p>     8    ( + CRC),    Magic Number   CRC . <br>  ""      ,    ,   . <br>   ,   CRC,   "".    ‚Äî    .   ‚Äî   ,    "" . <br>      , ,    "" . <br>   zlib (      ). </p><br><p> ,  ,  ,  . </p><br><h3 id="dobavlenie-zapisi-v-zhurnal">     </h3><br><p>     ,  Z_SYNC_FLUSH.,       . <br>    (     CRC) ‚Äî    (. ). <br>    CRC.    ‚Äî   . </p><br><h3 id="novaya-stranica">   </h3><br><p>       (              ).     ‚Äî       ,     . <br>    erase.    0xff.  -   ‚Äî    ,  .. <br>     ,     ,  ‚Äî    (  ). </p><br><h1 id="primenimost-formata">   </h1><br><p>   ,       -    ( , JSON, MessagePack, CBOR, , protobuf)  NOR Flash. </p><br><p> ,  ""  SLC NOR Flash. </p><br><p>         BER,  NAND  MLC NOR <em>(      ?        )</em> . </p><br><p>  ,      ,   FTL: USB flash, SD, MicroSD, etc <em>(          512 ,          ‚Äî   ""        )</em> . </p><br><p>             128 (16)  1 (128).         , , ,     <em>(      ,   NOR Flash    )</em> . </p><br><p>  -   ,         ‚Äî ,   ,      github. </p><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>  ,      <em>  </em> . </p><br><p>        ,  :     - , ,         . ,  () -         . </p><br><p>    ,   ?  Sim claro.   , ,      .   -        . </p><br><p>        ?  ,       ,   .    . </p><br><p>    ,       ,   " ". </p><br><p>        ,       <em>()</em>   , ,    ""  (, ,     ;      ).        <em>(    ‚Äî   )</em> . </p><br><p>          ,      . </p><br><h1 id="literatura">  Literatura </h1><br><p>        ,       . </p><br><p>      ,     ,        ,      : </p><br><ol><li>  <a href="https://github.com/madler/infgen/" rel="nofollow">infgen</a>   zlib.        deflate/zlib/gzip.         deflate ( gzip) ‚Äî  . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479044/">https://habr.com/ru/post/pt479044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479034/index.html">Como conectar-se a uma VPN corporativa no Linux usando openconnect e vpn-slice</a></li>
<li><a href="../pt479036/index.html">A Intel n√£o pode lidar com a demanda por processadores. HP e Dell sofrem como resultado</a></li>
<li><a href="../pt479038/index.html">Transforma√ß√£o digital Leroy Merlin: projetando uma interface para trabalhar com chamadas de clientes</a></li>
<li><a href="../pt479040/index.html">Testes de regress√£o visual. Reiniciar</a></li>
<li><a href="../pt479042/index.html">O m√©todo Y √© uma maneira muito f√°cil de construir um cubo de Rubik</a></li>
<li><a href="../pt479048/index.html">Node.js Streams para manequins ou como trabalhar com streams</a></li>
<li><a href="../pt479050/index.html">Pesquisa de patentes em TI. O curso do jovem lutador. Parte II Fontes de informa√ß√£o para pesquisa de patentes</a></li>
<li><a href="../pt479052/index.html">[Supercomputa√ß√£o 2019]. Armazenamento em v√°rias nuvens como um aplicativo para novas unidades Kingston DC1000M</a></li>
<li><a href="../pt479054/index.html">Friday Mobile Poll</a></li>
<li><a href="../pt479056/index.html">Falar sobre a vida? Equipe DREAM no Pr√™mio Alexa Desafio Socialbot 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>