<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔲 🦈 🐘 Conception basée sur le domaine: une recette pour un pragmatique 🐻 🖕🏼 ☝🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pourquoi les DDD sont-ils généralement abordés du mauvais côté? Et de quel côté voulez-vous? Qu'est-ce que les girafes et les ornithorynques ont à voi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conception basée sur le domaine: une recette pour un pragmatique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/440772/"><img src="https://habrastorage.org/webt/0d/g2/_y/0dg2_yqhafnwjnnd2iqwabmrysc.jpeg"><br>  Pourquoi les DDD sont-ils généralement abordés du mauvais côté?  Et de quel côté voulez-vous?  Qu'est-ce que les girafes et les ornithorynques ont à voir avec tout ça? <br><br>  Surtout pour Habr - une transcription textuelle du rapport "Conception axée sur le domaine: une recette pour un pragmatique".  Le rapport a été fait lors de la conférence DotNext .NET, mais il peut être utile non seulement aux donateurs, mais à tous ceux qui sont intéressés par DDD (nous pensons que vous maîtriserez quelques exemples de code C #).  Un enregistrement vidéo du rapport est également joint. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CR9mLGN9jh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Bonjour à tous, je m'appelle Alexey Merson.  Je vais vous dire ce qu'est la conception pilotée par domaine et quelle est son essence, mais d'abord, essayons de comprendre pourquoi elle est nécessaire. <br><br><img src="https://habrastorage.org/webt/mb/3q/2v/mb3q2vmpui3hndlrdyxscvi-ovo.jpeg"><br><br>  Martin Fowler a déclaré: "Il y a peu de choses qui sont moins logiques que la logique métier."  La girafe est certainement l'une de ces rares.  La distance entre le cerveau et le larynx d'une girafe n'est que de quelques centimètres.  Cependant, le nerf qui les relie atteint 4 mètres.  D'abord, il descend par tout le cou, il fait le tour de l'artère puis il revient presque de la même façon. <br><br>  À première vue, il n'y a vraiment aucune logique.  Mais ce n'est qu'un héritage dense laissé par d'anciens poissons.  Chez les poissons, comme vous le savez, il n'y a pas de cou, donc ce nerf parcourt le chemin optimal.  Et lorsque les mammifères sont apparus après plusieurs millions d'années de refactoring, le nerf a dû être étendu pour maintenir la compatibilité descendante.  Eh bien, ne pas remodeler à cause de certaines girafes? <br><br>  Mais la girafe va bien, car il y a un ornithorynque. <br><br><img src="https://habrastorage.org/webt/j0/fv/t3/j0fvt3ieyzwdykfidna95z9w-vw.jpeg"><br>  Pensez-y.  Le mammifère  Avec un bec.  Vit principalement dans l'eau.  Pond des œufs.  Et en plus, toxique.  Il peut sembler que la seule explication logique de son existence est qu'il vient d'Australie. <br><br>  Mais je pense que tout est plus banal.  L'entrepreneur a simplement oublié la conception et économisé avec StackOverflow, enfin, ou ce qu'il y avait à l'époque. <br><img src="https://habrastorage.org/webt/hr/xm/lw/hrxmlwxz0r0fwr4xfrueljqhc7e.jpeg"><br>  Je sais ce que vous pensez maintenant: "Alexey, eh bien, vous nous avez promis une conception pilotée par domaine, et voici une sorte de" Dans le monde animal "!" <br><br>  Chers collègues, qu'est-ce que le développement?  Le développement, c'est lorsque nous prenons une partie du monde réel, un processus métier, et que nous le transformons en code, c'est-à-dire en construisant un modèle logiciel.  Quels problèmes nous attendent en cours de route? <br><br>  Le premier est la complexité des processus métier eux-mêmes, c'est-à-dire la difficulté à comprendre comment fonctionne l'entreprise, quels processus se déroulent là-bas, par quelle logique ils sont construits. <br><br>  Le deuxième problème est la mise en œuvre de ces processus métier sous forme de code, l'utilisation des bons modèles, les bonnes approches, etc.  C'est aussi un sujet assez compliqué. <br><img src="https://habrastorage.org/webt/41/de/a2/41dea2lr4g73nouzxekhq8-t3qm.jpeg"><br>  Regardez, les processus commerciaux sont comme cette girafe: ils ont commencé avec les plus simples unicellulaires, puis «ça» vous regarde, et personne ne comprend «d'où ça vient» ou «comment ça marche». <br><br>  Pour construire un modèle réussi d'un tel processus, vous devez d'abord répondre à la question «pourquoi?».  Pourquoi voulons-nous construire ce modèle?  Quels objectifs voulons-nous atteindre?  Après tout, si le client voulait une girafe en peluche, mais a eu le courage, alors il sera contrarié, même si la digestion dans ce modèle est mise en œuvre pour un régal pour les yeux.  Et le client perdra non seulement de l'argent et du temps, il perdra confiance en nous en tant que développeurs, et nous perdrons notre réputation et notre client. <br><br>  Mais même si nous avons déterminé les objectifs, cela ne garantit toujours pas que nous n'obtiendrons pas l'ornithorynque en conséquence.  Le fait est que l'objectif est peu compréhensible.  L'objectif doit être atteint.  Et cela nous aide à concevoir un domaine. <br><img src="https://habrastorage.org/webt/qb/dz/ib/qbdzibra6bypzj_36zfv-dnhlti.jpeg"><br>  L'objectif principal de la conception pilotée par domaine est de lutter contre la complexité des processus métier, leur automatisation et leur implémentation dans le code.  «Domaine» se traduit par «domaine», et le développement et la conception dans le cadre de cette approche sont éloignés du domaine. <br><br>  La conception pilotée par domaine comprend de nombreux éléments.  Cette conception stratégique, l'interaction entre les gens, les approches de l'architecture et les modèles tactiques - c'est tout un arsenal qui fonctionne vraiment et aide vraiment à faire des projets.  Il n'y a qu'un «mais».  Avant de commencer à gérer la complexité de la conception pilotée par domaine, vous devez apprendre à gérer la complexité de la conception pilotée par domaine elle-même. <br><br><img src="https://habrastorage.org/webt/ho/xz/9k/hoxz9k3iyujhnbgzlt8dlfzd4b0.png"><br><br>  Quand une personne commence à plonger dans ce sujet, une énorme quantité d'informations lui tombe dessus: des livres épais, un tas d'articles, des modèles, des exemples.  Tout cela est déroutant, et il est facile, comme on dit, de ne pas remarquer derrière les arbres de la forêt.  Je l'ai ressenti une fois sur moi-même, mais aujourd'hui, je veux partager mon expérience avec vous et vous aider à traverser cette jungle, en commençant enfin à utiliser la conception pilotée par domaine. <br><img src="https://habrastorage.org/webt/bm/mi/hs/bmmihsln4udtdm2d892qwb9elmo.jpeg"><br>  Le terme Domain-Driven Design lui-même a été proposé par Eric Evans en 2003 dans son livre imprononçable, que la communauté appelle simplement le Blue Book.  Le problème est que la première moitié du livre Evans parle de schémas tactiques (vous les connaissez tous: il s'agit d'usines, d'entités, de référentiels, de services), et les gens n'obtiennent généralement pas la seconde moitié.  L’homme regarde: tout est familier, je vais chercher l’application DDD. <br><img src="https://habrastorage.org/webt/7y/xz/_r/7yxz_r9ayavde_qjite3vti58fi.jpeg"><br>  À droite, ce qui se passe si vous lancez follement des modèles tactiques sur le compilateur.  Gauche - si vous utilisez des modèles stratégiques. <br><br><img src="https://habrastorage.org/webt/g9/bd/cj/g9bdcj-skoztnm7s3rsbxyo9w68.jpeg"><br><br>  Depuis la sortie du Blue Book, une communauté DDD assez forte s'est formée, beaucoup de choses ont été repensées.  Oui, et Evans lui-même a admis qu'il ne comprenait plus comment il pouvait mettre fin à une chose aussi importante que la conception stratégique. <br><br>  Et 10 ans plus tard, en 2013, le Livre rouge a été publié par Vaughn Vernon.  Et dans ce livre, la présentation est déjà construite dans le bon ordre: elle commence par la conception stratégique, par les bases.  Et lorsque le lecteur a reçu la base nécessaire, il commence déjà à parler des modèles tactiques et des détails de mise en œuvre. <br><br>  Habituellement, dans les rapports sur DDD, ils recommandent de lire Evans, sur Internet, il y a même des manuels entiers dans quel ordre vous devez lire les chapitres pour une immersion appropriée.  Je recommande de le faire plus facilement: commencez par le Livre rouge, lisez-le, puis passez au bleu. <br><br>  Et puisque la conception stratégique est une chose si importante, parlons de ses idées clés. <br><br><h2>  "Idées clés de la conception stratégique" </h2><br>  Dans tout projet d'automatisation d'entreprise, il y a toujours des experts du domaine.  Ce sont des personnes qui comprennent le mieux le fonctionnement des processus métier à modéliser.  Ceux-ci peuvent être des développeurs, des dirigeants et des cadres supérieurs de premier plan.  En général, cela peut être n'importe qui, si seulement il comprend les processus commerciaux avec lesquels nous devons traiter. <br><br><img src="https://habrastorage.org/webt/c0/s1/ho/c0s1ho_prs7h-b-qbkh7_rrroaa.jpeg"><br><br>  D'autre part, il y a des experts techniques: développeurs, architectes directement impliqués dans l'automatisation et la mise en œuvre des applications.  Dans l'exemple illustré, le client voulait probablement un chemin de fer pour enfants, mais il s'est avéré être une sorte de monstre. <br><br>  Pourquoi cela se produit-il?  Parce que l'interaction entre les experts techniques et les experts du domaine dans une situation typique ressemble à ceci: il y a un grand-grand mur entre eux, et un gestionnaire marche le long du haut de ce mur et essaie d'abord d'entendre ce qu'ils crient d'un côté du mur, puis il essaie de le crier au mieux des bundles de l'autre côté du mur, et ainsi de suite en cercle. <br><br>  Parfois, un gestionnaire est sourd, alors toute une chaîne de tels gestionnaires peut être constituée, ce qui, bien sûr, ne contribue pas à la réussite du projet.  Et comment ça devrait être? <br><br><img src="https://habrastorage.org/webt/wc/ov/sh/wcovshn5e04eei99ry9a9ydm4gy.jpeg"><br><br>  Il doit y avoir une interaction constante.  Experts techniques, experts du domaine - tous les participants au projet doivent constamment maintenir la communication, se synchroniser, discuter des objectifs, des moyens de les atteindre et pourquoi faisons-nous tout cela. <br><br>  Et nous arrivons ici au premier et, probablement, au point clé le plus important de la conception stratégique et de la conception pilotée par le domaine en général. <br><br><img src="https://habrastorage.org/webt/tz/nl/jg/tznljgxy0ptqsd5vw-5s3ptopdk.jpeg"><br><br>  La communication entre les participants au projet forme ce que la conception pilotée par domaine appelle un langage omniprésent.  Il n'est pas un dans le sens où il l'est pour toutes les occasions.  Bien au contraire.  Il est unique dans le sens où tous les participants y communiquent, toute discussion se déroule en termes d'une seule langue, et tous les artefacts doivent être au maximum en termes d'une seule langue, c'est-à-dire à partir de TK et se terminant par un code. <br><br><h2>  Scénarios d'affaires </h2><br>  Pour une discussion plus approfondie, nous avons besoin d'une sorte de scénario d'entreprise.  Imaginons cette situation: <br><br><img src="https://habrastorage.org/webt/nm/4g/ig/nm4gigksgfmt0bgp-iixvbbxow4.jpeg"><br><br>  Le directeur du groupe JUG.ru vient à nous et dit: "Les gars, le flux des rapports augmente, les gens, en général, sont torturés pour tout faire manuellement ... Automatisons le processus de préparation de la conférence."  Nous répondons: "D'accord!"  - et se mettre au travail. <br><br>  Le premier scénario que nous automatiserons est le suivant: «L'orateur soumet une demande de rapport à un événement spécifique et ajoute des informations sur son rapport.»  Que voyons-nous dans ce scénario?  Qu'est-ce qu'un orateur, il y a un événement, et il y a un rapport, ce qui signifie qu'il est déjà possible de construire le premier modèle de domaine. <br><br><img src="https://habrastorage.org/webt/e_/up/_t/e_up_tj4aagy5ewxeq1xwdnim_k.jpeg"><br><br>  Nous avons ici un modèle de domaine: Conférencier - conférencier, Talk - report, Event - event.  Mais le modèle de domaine ne peut pas être illimité, ne peut pas tout couvrir, sinon il deviendra flou et perdra le focus, donc le modèle de domaine doit être limité par quelque chose.  Ceci est le prochain point clé. <br><br><img src="https://habrastorage.org/webt/e_/0w/w8/e_0ww82sof-x_waqu_epiihi8de.jpeg"><br><br>  Le modèle de domaine et le langage omniprésent sont tous deux limités par le contexte que la conception pilotée par domaine appelle contexte borné.  Il restreint le modèle de domaine de telle manière que tous les concepts qu'il contient sont sans ambiguïté et que tout le monde comprend ce qui est en jeu. <br><br>  S'ils disent «utilisateur», alors tout doit être clair à la fois, il doit avoir un rôle compréhensible, un sens compréhensible, il ne doit pas être une sorte d'utilisateur abstrait du point de vue de l'industrie informatique. <br><br><img src="https://habrastorage.org/webt/fv/v-/7r/fvv-7rprlvfbdhyo81bgitdvvny.jpeg"><br><br>  Dans notre cas, ce modèle de domaine est valable pour le contexte de la préparation de la conférence, c'est donc dans le contexte que nous appellerons le «contexte de planification d'événement».  Mais pour que l'orateur ajoute quelque chose, change des informations, il doit d'une manière ou d'une autre se connecter, il doit avoir des droits.  Et ce sera déjà un autre contexte, «contexte d'identité», dans lequel il y aura une sorte de leurs propres entités: utilisateur, rôle, profil. <br><br>  Et regardez ce que la chose est ici.  Lorsqu'une personne se connecte au système et a l'intention d'entrer une sorte d'information, physiquement, c'est la même personne, mais dans différents contextes, elle est représentée par différentes entités, et ces entités ne sont pas directement liées. <br><br>  Si nous prenions et, par exemple, héritions Speaker de User, nous mélangerions des choses qui ne peuvent pas être mélangées, et certains attributs pourraient être mélangés par la logique.  Et le modèle perdrait le focus sur le sens spécifique qu'il a, étant divisé en plusieurs contextes. <br><br><h2>  Démo: Service commercial </h2><br>  Écartons un peu de la théorie sèche et regardons le code. <br><br>  Une conférence n'est pas seulement la préparation d'un contenu, mais aussi des ventes.  Imaginons qu'un service de vente de billets ait déjà été écrit, et un responsable des ventes vient nous voir et dit: «Les gars!  Une fois que quelqu'un a écrit ce service, découvrons-le, quelque chose n'est pas clair pour moi comment la remise pour les clients réguliers est considérée. " <br><br>  Après avoir discuté avec le gestionnaire, nous découvrons que tout le scénario de ce service est le suivant: en cliquant sur Commander, le prix final du billet est considéré en tenant compte de la réduction client régulière, et la commande passe à l'état «En attente de paiement». <br><br>  Le code que nous allons maintenant analyser peut être consulté séparément dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel</a> . <br><br>  Solution ouverte, regardez la structure: <br><br><img src="https://habrastorage.org/webt/hy/wl/j4/hywlj4jodqlkuhsfza7b_gglj2u.png"><br><br>  Il semble que tout semble bien: il y a Application et Core (apparemment, les gens connaissent les couches), Repository ... Apparemment, la personne a maîtrisé la première moitié d'Evans. <br><br>  Ouvrez OrderCheckoutService.  Que voyons-nous là-bas?  Voici <a href="">le code</a> : <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Checkout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ord = _ordersRepository.GetOrder(id); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> orders = _ordersRepository.GetOrders() .Count(o =&gt; o.CustomerId == ord.CustomerId &amp;&amp; o.StateId == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; o.OrderDate &gt;= DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>)); ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>; ord.StateId = <span class="hljs-number"><span class="hljs-number">1</span></span>; _ordersRepository.SaveOrder(ord); }</code> </pre> <br><br>  Nous regardons la ligne avec le prix: ici le prix change.  Nous appelons notre directeur des ventes et lui disons: "Ici, en bref, la remise est considérée ici, tout est clair": <br><br><pre> <code class="cs hljs">ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  Il regarde par-dessus son épaule: «Oh!  Voilà à quoi ressemble Brainfuck!  Et ils m'ont en quelque sorte dit que les gars écrivaient en C # ». <br><br>  De toute évidence, le développeur de ce code a bien répondu à une interview sur les algorithmes et les structures de données.  J'ai écrit à l'école des olympiades dans le même style.  Après un certain temps, en utilisant le formatage et le refactoring <s>obscène</s> , nous découvrons ce qui est quoi et expliquons à notre directeur des ventes qui souffre depuis longtemps que la logique est la suivante: si le nombre de commandes au cours des 3 dernières années n'est pas inférieur à un, alors il reçoit une remise de 10% , pas moins de trois à 20% et pas moins de cinq à 30%.  Il part joyeux - maintenant, il est clair comment tout cela fonctionne. <br><br>  Je pense que beaucoup ont lu le Clean Code de Bob Martin.  Là, il dit à propos de la règle du boy-scout: "Le parking après notre départ devrait être plus propre qu'il ne l'était avant notre arrivée."  Par conséquent, refactorisons ce code afin qu'il ait l'air humain et corresponde à ce dont nous avons parlé un peu plus tôt à propos du langage omniprésent et de son utilisation dans le code. <br><br>  Voici le code refactorisé. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DiscountCalculator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IOrdersRepository _ordersRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrdersRepository ordersRepository</span></span></span><span class="hljs-function">)</span></span> { _ordersRepository = ordersRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateDiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completedOrdersCount = _ordersRepository.GetLast3YearsCompletedOrdersCountFor(customerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DiscountBy(completedOrdersCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completedOrdersCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  La première chose que nous faisons est de transférer le calcul de la remise vers un DiscountCalculator distinct, dans lequel la méthode CalculateDiscountBy customerId apparaît.  Tout est lu humainement, tout est clair: quoi, pourquoi et comment.  À l'intérieur de cette méthode, nous voyons que nous avons globalement deux étapes pour calculer la remise.  Premièrement: nous recevons quelque chose du référentiel de commandes, tout est selon le cas d'utilisateur, vous n'avez même pas besoin d'aller à l'intérieur si ce n'est pas la partie qui vous intéresse maintenant.  Le fait est que nous obtenons le nombre de certaines commandes terminées, après quoi nous considérons immédiatement la deuxième remise pour cette quantité comme la deuxième étape. <br><br>  Si nous voulons voir comment cela est considéré, nous allons à DiscountBy, et ici presque la même chose est écrite en anglais presque humain que notre "type de brainfair" était avant, tout est clair et précis. <br><br>  La seule question qui pourrait se poser est de savoir dans quelles unités la remise est mesurée.  Il serait possible d'ajouter le mot «pour cent» dans le nom de la méthode pour le clarifier, mais d'après le contexte et les chiffres impliqués, devinez probablement que ce sont des pourcentages, et pour plus de concision, il peut être omis.  Si nous voulons voir le nombre de commandes, nous irons dans le code du référentiel et verrons.  Maintenant, nous ne le ferons pas.  Dans notre service, nous devons ajouter une nouvelle dépendance DiscountCalculator.  Et voyons ce que nous avons fini avec la deuxième version de la méthode Checkout. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckoutV2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> order = _ordersRepository.GetOrder(orderId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> discount = _discountCalculator.CalculateDiscountBy(order.CustomerId); order.ApplyDiscount(discount); order.State = OrderState.AwaitingPayment; _ordersRepository.SaveOrder(order); }</code> </pre><br><br>  Regardez, la méthode Checkout reçoit orderId, puis reçoit un orderId par orderId, selon le CustomerId de cette commande, elle considère la remise à l'aide du calculateur de remise, applique la remise à la commande, définit le statut sur AwaitingPayment et enregistre la commande.  Nous avions un script en russe sur la diapositive, mais ici nous lisons pratiquement la traduction de ce script en anglais et tout est clair, tout est évident. <br><br>  Voyez-vous quel est le charme?  Ce code peut être montré à n'importe qui: pas seulement aux programmeurs, mais au contrôle qualité, aux analystes et aux clients.  Ils comprendront tous ce qui se passe, car tout est écrit en langage humain.  J'utilise ceci dans notre projet, vraiment QA peut regarder quelques morceaux, vérifier avec Wiki et comprendre qu'il y a une sorte de bogue.  Parce que le Wiki le dit et que le code est un peu différent, mais il comprend ce qui se passe là-bas, bien qu'il ne soit pas développeur.  Et de la même manière, nous pouvons discuter du code avec l'analyste et en discuter en détail.  Je dis: "Regardez, voici comment cela fonctionne dans le code."  Notre dernier recours n'est pas le Wiki, mais le code.  Tout fonctionne comme il est écrit dans le code.  Il est très important d'utiliser un langage omniprésent lors de l'écriture de code. <br><br><img src="https://habrastorage.org/webt/-a/15/pc/-a15pcu9tfp6xjadw-98qlpcxrs.jpeg"><br><br>  Ceci est le troisième point clé. <br><br>  Il y a tellement de confusion à propos de la conception pilotée par domaine dans des choses comme le domaine, le sous-domaine, le contexte délimité, la façon dont ils se rapportent à ce qu'ils signifient.  Il semble que tout le monde limite quelque chose, tous sont en quelque sorte bien rangés.  Mais il n'est pas clair alors quelle est la différence, pourquoi ils sont si différents inventés. <br><br><img src="https://habrastorage.org/webt/tp/zo/nf/tpzonf_lfbysx7pgiiqrxbiineo.jpeg"><br><br>  Le domaine est une chose globale, c'est un domaine mondial dans lequel cette entreprise particulière fait de l'argent.  Par exemple, pour DotNext c'est une conférence, pour Pyaterochka c'est une vente au détail de marchandises. <br><br>  Les grandes sociétés peuvent avoir plusieurs domaines.  Par exemple, Amazon est engagé à la fois dans la vente de biens via Internet et dans la fourniture de services cloud, ce sont des domaines différents. <br><br>  Néanmoins, c'est quelque chose de mondial et ne peut pas être automatisé directement, même il est difficile d'enquêter.  Pour l'analyse, le domaine est inévitablement divisé en sous-domaines, c'est-à-dire en sous-domaines. <br><br><img src="https://habrastorage.org/webt/rc/wv/qz/rcwvqzdcicpkiw57o6p1lzunmn4.jpeg"><br><br>  Les sous-domaines font partie d'une entreprise qui, dans notre langue, sont hautement connectés, c'est-à-dire qu'il s'agit d'une sorte de processus logiques isolés qui interagissent les uns avec les autres à un niveau majeur. <br><br>  Par exemple, si nous prenons une boutique en ligne, ce sera la formation et le traitement des commandes, ce sera la livraison, c'est le travail avec les fournisseurs, c'est le marketing, c'est la comptabilité.  Voici quelques-unes de ces pièces - c'est ce que l'entreprise est divisée. <br><br><img src="https://habrastorage.org/webt/yc/rc/ub/ycrcubvepugwbmk-xpidrsxc1pu.jpeg"><br><br>  Du point de vue de DDD, les sous-domaines sont divisés en trois types.  Et ici, je veux dire encore une chose: souvent dans les livres et articles, le sous-domaine est simplement réduit au domaine, mais généralement dans le cas où il est combiné avec le type de sous-domaine.  Autrement dit, quand ils disent «domaine principal», ils signifient sous-domaine principal, s'il vous plaît ne vous y trompez pas.  Cela m'a époustouflé au début. <br><br>  Les sous-domaines sont divisés en trois types. <br><br><img src="https://habrastorage.org/webt/a0/vg/jh/a0vgjhuiklcpufzsw_lsdzgisnw.jpeg"><br><br>  Le premier et le plus important est Core.  Le noyau est le sous-domaine principal, c'est l'avantage concurrentiel de l'entreprise, ce qui fait de l'argent de cette entreprise, en quoi elle diffère de ses concurrents, son savoir-faire, peu importe comment vous l'appelez.  Si nous prenons la conférence DotNext, alors c'est le contenu.  Vous êtes tous venus ici pour du contenu, s'il n'y en avait pas ici, vous n'iriez pas ou n'iriez pas à une autre conférence.  Il n'y aurait pas de DotNext sous la forme dans laquelle il se trouve. <br><br><img src="https://habrastorage.org/webt/up/dr/cc/updrcc6vh3xb0niwkpsuqnrlr-s.jpeg"><br><br>  Le deuxième type est Supporting Subdomain.  C'est aussi une chose importante pour gagner de l'argent, c'est aussi quelque chose sans lequel c'est impossible, mais ce n'est pas une sorte de savoir-faire, un réel avantage concurrentiel.  C'est ce que prend en charge Core Subdomain.  Du point de vue de l'application de la conception pilotée par domaine, cela signifie que moins d'efforts sont consacrés à la prise en charge du sous-domaine, toutes les forces principales sont lancées sur Core. <br><br>  Un exemple pour le même DotNext est le marketing.  C'est impossible sans marketing, sinon personne n'aurait été au courant de la conférence, mais sans marketing de contenu n'est pas nécessaire. <br><br><img src="https://habrastorage.org/webt/ad/in/ar/adinar6ki4kdf1xnozjylhho9ea.jpeg"><br><br>  Et enfin, le sous-domaine générique.  Le générique est une tâche commerciale typique qui, en règle générale, peut être automatisée avec des produits finis ou externalisée.  C'est ce qui est également nécessaire, mais cela ne nécessite pas nécessairement une mise en œuvre indépendante par nous, et plus encore, ce sera généralement une bonne idée d'utiliser un produit tiers. <br><br>  Par exemple, vendre des billets.  DotNext vend des billets via TimePad.  Ce sous-domaine est parfaitement automatisé par TimePad, et vous n'avez pas besoin d'écrire un deuxième TimePad vous-même. <br><br><img src="https://habrastorage.org/webt/38/xi/5c/38xi5cgogl1edatrnmd4jy6o5yg.jpeg"><br><br>  Et enfin, contexte borné.  Le contexte délimité et le sous-domaine sont toujours quelque part à proximité, mais il existe une différence significative entre eux.  C'est très important. <br><br><img src="https://habrastorage.org/webt/pa/xm/bo/paxmbosiaaglpdk-fc-38ouji3g.jpeg"><br><br>  Il y a une question sur StackExchange en quoi le contexte borné diffère du sous-domaine.  Le sous-domaine est une entreprise, un morceau du monde réel, c'est le concept d'un espace de déclaration de problème.  Le contexte borné limite le modèle de domaine et le langage omniprésent, c'est-à-dire le résultat de la modélisation et, par conséquent, le contexte borné est le concept d'espace de solution.  Dans le processus de mise en œuvre du projet, une sorte de mappage des sous-domaines a lieu dans des contextes limités. <br><br><img src="https://habrastorage.org/webt/ba/91/mi/ba91mikbrcn3l50d_k2dwedusug.jpeg"><br><br>  Un exemple classique: la comptabilité en tant que sous-domaine, la façon dont le processus est mappé, est automatisée, par exemple, 1C Bookkeeping, Elba ou «My business» - est en quelque sorte automatisée par un produit.  C'est le contexte borné de la comptabilité, dans lequel il y a son langage omniprésent, sa propre terminologie.  C’est la différence entre eux. <br><br><img src="https://habrastorage.org/webt/fs/y1/lv/fsy1lvc6qabh0flcrli7bkxvpho.jpeg"><br><br>  Si nous revenons à DotNext, comme je l'ai dit, les tickets sont mappés à TimePad et le contenu qui est notre sous-domaine principal est mappé à une application personnalisée que nous développons pour la gestion de contenu. <br><br><h3>  Taille du contexte borné </h3><br>  Il y a un moment qui soulève de nombreuses questions.  Comment choisir la bonne taille pour un contexte délimité?  Dans les livres, on peut trouver une telle définition: "Le contexte borné doit être exactement tel que le langage omniprésent est complet, cohérent, sans ambiguïté, sans ambiguïté, cohérent."  Définition cool, dans le style d'un mathématicien d'une célèbre blague: très précis, mais inutile. <br><br>  Voyons comment comprendre tout de même: s'il doit s'agir d'une solution, d'un projet ou d'un espace de noms - quelle échelle doit être attachée au contexte délimité? <br><br><img src="https://habrastorage.org/webt/l8/h5/7y/l8h57y11erupofzzpnc3q6li7ei.jpeg"><br><br>  La première chose que vous pouvez lire presque partout: idéalement, <b>un sous-domaine doit être mappé à un contexte limité</b> , c'est-à-dire être automatisé par un contexte limité.  Cela semble logique, car à la fois là et il y a des limites d'un processus métier distinct, dans les deux cas, certains termes commerciaux, une seule langue apparaît.  Mais ici, vous devez comprendre que c'est une situation idéale, vous ne l'aurez pas nécessairement, et il n'est pas nécessaire d'essayer d'y parvenir. <br><br>  Parce que, d'un côté, un sous-domaine peut être assez volumineux, et vous pouvez obtenir plusieurs applications ou services qui vont l'automatiser, il peut donc s'avérer que plusieurs contextes limités correspondent à un sous-domaine. <br><br>  Mais il y a une situation inverse, en règle générale, c'est typique de Legacy.  Autrement dit, lorsqu'ils ont créé une grande, grande application qui automatise tout dans le monde dans cette entreprise, le contraire se révélera.  Une application est un contexte borné, là le modèle sera probablement une sorte d'ambiguïté, mais les sous-domaines n'y ont pas disparu, respectivement, un contexte borné correspondra à plusieurs sous-domaines. <br><br>  Lorsque l'architecture des microservices est devenue à la mode, une autre recommandation est apparue (bien qu'elles ne se contredisent pas): <b>un contexte limité par microservice</b> .  Encore une fois, cela semble logique, les gens le font vraiment.  Parce que le microservice doit assumer une fonction claire, qui dispose en interne d'une connectivité élevée et communique avec d'autres services via une sorte d'interaction.  Si vous utilisez une architecture de microservice, vous pouvez prendre cette recommandation par vous-même. <br><br>  Mais ce n'est pas tout.  Permettez-moi de vous rappeler une fois de plus que la conception pilotée par domaine concerne beaucoup: la langue, les gens.  Et vous ne pouvez pas ignorer les gens et ne faire que des critères techniques dans ce domaine.  Par conséquent, j'ai écrit ceci: <b>un contexte est égal à X-man</b> .  Je pensais que x est environ 10, mais nous avons discuté un peu avec Igor Labutin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">twitter.com/ilabutin</a> ) et la question est restée ouverte. <br><br>  Ici, il est important de comprendre ceci: une seule langue reste unifiée pendant que tous les participants parlent, discutent et tout le monde la comprend sans ambiguïté.  Il est clair qu'un nombre infini de personnes ne peuvent pas parler la même langue.  Notre histoire de l'humanité le montre clairement.  Dans tous les cas, certains dialectes apparaissent, certaines de leurs significations, maintenant vous pouvez même ajouter des mèmes et ainsi de suite.  D'une manière ou d'une autre, la langue deviendra floue. <br><br>  Par conséquent, il faut comprendre que le nombre de personnes qui utilisent ce langage unique et, par conséquent, participent au développement, à l'automatisation, est limité.  Les livres parlent également de certaines raisons politiques: si deux équipes travaillent sous la direction de différents gestionnaires et travaillent sur le même contexte délimité, et pour une raison quelconque, ces gestionnaires ne sont pas amis, les conflits commenceront et la concentration sera perdue.  Par conséquent, il sera beaucoup plus simple et plus correct de créer deux contextes bornés pour chaque commande et de ne pas essayer de combiner ce qui n'est pas combiné. <br><br><h2>  Architecture et gestion des dépendances </h2><br>  Du point de vue de la conception pilotée par domaine, peu importe l'architecture que vous choisissez.  La conception pilotée par domaine ne concerne pas cela; la conception pilotée par domaine concerne le langage et la communication. <br><br><img src="https://habrastorage.org/webt/3r/de/2i/3rde2isfgddxyjfzswpj2nvxtbe.jpeg"><br><br>  Mais il y a un point important, du point de vue des critères de choix de l'architecture qui nous intéresse du point de vue de la conception pilotée par le domaine: <b>notre objectif est de débarrasser au maximum la logique métier des dépendances tierces</b> .  Parce que, dès que des dépendances tierces apparaissent, la terminologie apparaît, des mots apparaissent qui n'entrent pas dans une seule langue et commencent à joncher notre logique métier. <br><br><img src="https://habrastorage.org/webt/nz/pw/nu/nzpwnurj_5kkbnmjo6uhosycd1u.jpeg"><br><br>  Regardons un exemple classique d'architecture: l'architecture bien connue à trois couches.  Dès qu’ils n’appellent pas une couche de domaine (ici la couche d’entreprise): l’entreprise, le cœur et le domaine sont tous les mêmes.  Dans tous les cas, il s'agit de la couche dans laquelle se trouve la logique métier, et si elle dépend de la couche de données, cela signifie que certains concepts de la couche de données se déverseront d'une manière ou d'une autre dans la couche de domaine et la joncheront. <br><br><img src="https://habrastorage.org/webt/ft/kh/34/ftkh34ce3zbpt26jx3v8id9vaym.jpeg"><br><br>  L'architecture à quatre couches est essentiellement la même, la couche de domaine dépend toujours, et comme elle dépend, des dépendances tierces inutiles y parviendront. <br><br><img src="https://habrastorage.org/webt/wz/uv/ky/wzuvky-2bgljcwwarvtseclyqjy.jpeg"><br><br>  Et dans ce sens, il existe une architecture qui permet d'éviter cela - c'est l'oignon-architecture («oignon»).  Sa différence est qu'il est constitué de couches concentriques, les dépendances vont de l'extérieur vers le centre.  C'est-à-dire que la couche externe peut dépendre de toutes les couches internes, la couche interne ne peut pas dépendre des couches externes. <br><br>  La couche la plus externe est l'interface utilisateur dans un sens global (c'est-à-dire qu'elle n'est pas nécessairement une interface utilisateur humaine, elle peut être une API REST ou quoi que ce soit).  Et l'infrastructure, qui ressemble souvent en général à des E / S, est la même base de données, en fait, une couche de données.  Toutes ces choses sont dans la couche externe.  Autrement dit, en raison de laquelle l'application reçoit en quelque sorte des données, des commandes, etc., elles sont supprimées et la couche de domaine se débarrasse de la dépendance à ces choses. <br><br>  Vient ensuite la couche Application - un thème plutôt holistique, mais c'est la couche dans laquelle se trouvent les scripts, les cas d'utilisateurs.  Cette couche utilise la couche domaine pour implémenter ses concepts. <br><br>  Au centre se trouve la couche de domaine.  On le voit, il ne dépend plus de rien, il devient une chose en soi.  Et c'est pourquoi la couche de domaine est souvent appelée «Core», car c'est le coeur, c'est ce qui est au centre, ce qui ne dépend pas de choses tierces. <br><br><img src="https://habrastorage.org/webt/h4/cl/_n/h4cl_nmaowsib1bw1thjvpolr8u.jpeg"><br><br>  L'une des options pour mettre en œuvre une telle architecture oignon est l'architecture hexagonale, ou «ports et adaptateurs».  J'ai apporté cette photo pour intimidation, je n'en parlerai pas.  À la fin de l'article, il y a un lien vers l'un des millions d'articles sur cette architecture, vous pouvez le lire. <br><br><h2>  Un peu sur les modèles tactiques: Interface séparée </h2><br>  Comme je l'ai dit, premièrement, la plupart des schémas tactiques sont familiers à tout le monde et, deuxièmement, tout l'intérêt de mon rapport est qu'ils ne sont pas essentiels.  Mais j'aime le modèle d'interface séparée séparément, et je veux en parler séparément. <br><br>  Revenons au code de notre microservice et voyons ce qui s'est passé avec le référentiel. <br><br><img src="https://habrastorage.org/webt/jl/c7/_d/jlc7_dwrkqw8mfy4zd1nibrdwti.png"><br><br>  La couche de domaine avait <a href="">l'</a> interface de <a href="">référentiel</a> IOrdersRepository.cs et son <a href="">implémentation,</a> OrdersRepository.cs. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DotNext.Sales.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrdersRepository</span></span> { <span class="hljs-function"><span class="hljs-function">Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IQueryable&lt;Order&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> V2 int GetLast3YearsCompletedOrdersCountFor(long customerId); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Ici, nous avons ajouté ici une certaine méthode pour recevoir des commandes pour les trois dernières années GetLast3YearsCompletedOrdersCountFor. <br><br>  Et ils l'ont implémenté sous une forme (dans ce cas, via Entity Framework, mais cela peut être n'importe quoi): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLast3YearsCompletedOrdersCountFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> threeYearsAgo = DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dbContext.Orders .Count(o =&gt; o.CustomerId == customerId &amp;&amp; o.State == OrderState.Completed &amp;&amp; o.OrderDate &gt;= threeYearsAgo); }</code> </pre><br><br>  Voyez quel est le problème.  Le référentiel s'est retrouvé dans la couche domaine, son implémentation dans la couche domaine, mais le code, commençant par DateTime.UtcNow.AddYears (-3), n'appartient pas intrinsèquement à la couche domaine et n'est pas une logique métier.  Oui, LINQ le rend plus ou moins humanisé, mais si, par exemple, il y avait des requêtes SQL ici, tout serait complètement triste. <br><br>  La signification du modèle d'interface séparée est que l'interface de service que nous utilisons dans la logique de domaine est déclarée dans la couche de domaine.  Nous parlons de référentiels et de services similaires dans lesquels les détails de la mise en œuvre de ces services ne sont pas une logique métier.  La logique métier est le fait de l'existence de ces services et le fait de leur appel et de leur utilisation dans la couche domaine.  Par conséquent, l'interface du référentiel reste dans la couche domaine et l'implémentation passe à la couche infrastructure. <br><br>  J'ai préparé une autre option.  L'interface du référentiel reste dans l'assembly Core, mais l'implémentation passe à Infrastructure.EF. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rh/k0/b_/rhk0b_dgbqe72y--hxcx13qlqco.png"></div><br><br>  Ainsi, nous avons apporté à l'infrastructure les concepts qui n'étaient pas propres à la couche domaine.  Comme effet secondaire, nous pouvons remplacer cette infrastructure par une autre implémentation.  Mais ce n'est pas l'objectif principal, l'objectif principal est, comme je l'ai dit, de débarrasser la logique de domaine des dépendances tierces. <br><br><h2>  Encore une fois sur la langue </h2><br>  Parlons encore et encore et encore de la langue. <br><br>  Au tout début, nous avons construit le modèle de domaine «haut-parleur - conversation - événement».  Je pense que personne n'a soulevé de questions particulières. <br><br>  Et voici le scénario sur la base duquel nous avons construit ce modèle de domaine: <br><br><img src="https://habrastorage.org/webt/2r/go/hp/2rgohppxhq7iqwvndfimzctuit8.jpeg"><br><br>  Vous voyez, le script est en russe et le modèle de domaine est en anglais. <br><br>  Pour les développeurs non anglophones, c'est quelque chose avec lequel vous devez vivre constamment. <br><br><img src="https://habrastorage.org/webt/jm/3p/rf/jm3prfqcjwydo3mg2c1p0zh3olc.jpeg"><br><br>  Chacun de vous, très probablement, fait constamment ce processus: traduit du russe en anglais et vice versa.  Ceux qui travaillent avec des clients et des projets anglophones sont un peu plus faciles, car les exigences sont en anglais, les discussions avec les clients en anglais, en règle générale, tous les scénarios sont en anglais, le code est en anglais, et il n'y a que la communication au sein de l'équipe en russe, qui se développe rapidement en anglais (client - client, commande - commande).  Et cette charge cognitive, cette surcharge, qui est créée par une traduction constante, recule un peu. <br><br>   ,     ,        ,    .    ,    . <br><br>         1,        .   ,  —    ,     ,          . <br><br><img src="https://habrastorage.org/webt/1e/b7/jh/1eb7jhuiy5i1ft1bsfrnu1x7_9u.jpeg"><br><br>      1. PascalCase  ,     ,     ,     <s></s>  ,      ,    , ,  - -     . <br><br>  ,  -  ? <br><br><img src="https://habrastorage.org/webt/lj/js/vd/ljjsvdrqh4v9117mps2yrelyxna.jpeg"><br><br>   ,     use case,   ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ,   .        C#,  ,  , .       ,    ,   ,  . <br><br>        ,  ,      Domain-Driven Design.      ,   ,    , ,        C#    .                    . <br><br>   ,      -  Continuous Integration.  ,       ,    , -   - .   ,     -  ,   ,  .  ,  95%      ,      ,  Continuous Integration,  , TeamCity .   . <br><br>               ,          . .   ,           1-,  ,    .        «»  ,     .    ,   ,    . <br><br><img src="https://habrastorage.org/webt/qh/ff/32/qhff32udhgwxb4cav3gjjoakn4e.jpeg"><br><br>         ,   Domain-Driven Design. <br><br>  —  ,   . Domain-Driven Design —    ,    .  —    ,  ,          ubiquitous language.     ,     ,   .      ,   ,      ,        . <br><br> .    ,  .    - ,      ,    ,     ,  ,     ,  ,  ,  ,      ,  — .     . <br><br>       .      .      .      .   ,    ,      .        DSL-.        .NET-,     - ,    ,  ,  ,   .   ,     . <br><br> , -    .    ,    ,     ubiquitous language  -.     . <br><br><h2>    </h2><br><ul><li> <b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">marshinov</a> </b> .    ,      DDD: , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«   DDD, CQRS  Event Sourcing    »</a> .    ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,  AutoMapper   MediatR.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,       Domain-Driven Design,      . </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«F# for fun and profit»</a> ,   ,   F#  Domain-Driven Design.  ,  ,   ,    . </li><li>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>    ,   . </li></ul><br>   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  GitHub</a> . <br><br><blockquote>   DotNext: <br>   , «       ,     ».   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <b>DotNext</b> ( <b>15-16   </b> )     .    ,   1   ,         . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440772/">https://habr.com/ru/post/fr440772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440756/index.html">CI / CD sans serveur sur AWS</a></li>
<li><a href="../fr440758/index.html">Allez Meetup à Acronis! (Moscou, Fiztehpark)</a></li>
<li><a href="../fr440760/index.html">Le nouvel âge d'or de l'architecture informatique</a></li>
<li><a href="../fr440762/index.html">Avis des employeurs: la nature et le non-sens des avis anonymes</a></li>
<li><a href="../fr440766/index.html">Des geeks aux geeks: des cadeaux pour le 23 février</a></li>
<li><a href="../fr440774/index.html">De graves erreurs mathématiques de la NHTSA permettent à Tesla de revendiquer la sécurité du pilote automatique</a></li>
<li><a href="../fr440776/index.html">Courriel, vue intérieure</a></li>
<li><a href="../fr440778/index.html">Deuxième rencontre OpenStack au groupe Mail.ru: 22 février</a></li>
<li><a href="../fr440780/index.html">Google ne bloquera pas les bloqueurs de publicités tiers dans le navigateur Chromium</a></li>
<li><a href="../fr440782/index.html">Je vais plus loin dans la clandestinité, ou ce que vous devez savoir sur l'optimisation de l'application réseau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>