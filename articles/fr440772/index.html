<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≤ ü¶à üêò Conception bas√©e sur le domaine: une recette pour un pragmatique üêª üñïüèº ‚òùüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pourquoi les DDD sont-ils g√©n√©ralement abord√©s du mauvais c√¥t√©? Et de quel c√¥t√© voulez-vous? Qu'est-ce que les girafes et les ornithorynques ont √† voi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conception bas√©e sur le domaine: une recette pour un pragmatique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/440772/"><img src="https://habrastorage.org/webt/0d/g2/_y/0dg2_yqhafnwjnnd2iqwabmrysc.jpeg"><br>  Pourquoi les DDD sont-ils g√©n√©ralement abord√©s du mauvais c√¥t√©?  Et de quel c√¥t√© voulez-vous?  Qu'est-ce que les girafes et les ornithorynques ont √† voir avec tout √ßa? <br><br>  Surtout pour Habr - une transcription textuelle du rapport "Conception ax√©e sur le domaine: une recette pour un pragmatique".  Le rapport a √©t√© fait lors de la conf√©rence DotNext .NET, mais il peut √™tre utile non seulement aux donateurs, mais √† tous ceux qui sont int√©ress√©s par DDD (nous pensons que vous ma√Ætriserez quelques exemples de code C #).  Un enregistrement vid√©o du rapport est √©galement joint. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CR9mLGN9jh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Bonjour √† tous, je m'appelle Alexey Merson.  Je vais vous dire ce qu'est la conception pilot√©e par domaine et quelle est son essence, mais d'abord, essayons de comprendre pourquoi elle est n√©cessaire. <br><br><img src="https://habrastorage.org/webt/mb/3q/2v/mb3q2vmpui3hndlrdyxscvi-ovo.jpeg"><br><br>  Martin Fowler a d√©clar√©: "Il y a peu de choses qui sont moins logiques que la logique m√©tier."  La girafe est certainement l'une de ces rares.  La distance entre le cerveau et le larynx d'une girafe n'est que de quelques centim√®tres.  Cependant, le nerf qui les relie atteint 4 m√®tres.  D'abord, il descend par tout le cou, il fait le tour de l'art√®re puis il revient presque de la m√™me fa√ßon. <br><br>  √Ä premi√®re vue, il n'y a vraiment aucune logique.  Mais ce n'est qu'un h√©ritage dense laiss√© par d'anciens poissons.  Chez les poissons, comme vous le savez, il n'y a pas de cou, donc ce nerf parcourt le chemin optimal.  Et lorsque les mammif√®res sont apparus apr√®s plusieurs millions d'ann√©es de refactoring, le nerf a d√ª √™tre √©tendu pour maintenir la compatibilit√© descendante.  Eh bien, ne pas remodeler √† cause de certaines girafes? <br><br>  Mais la girafe va bien, car il y a un ornithorynque. <br><br><img src="https://habrastorage.org/webt/j0/fv/t3/j0fvt3ieyzwdykfidna95z9w-vw.jpeg"><br>  Pensez-y.  Le mammif√®re  Avec un bec.  Vit principalement dans l'eau.  Pond des ≈ìufs.  Et en plus, toxique.  Il peut sembler que la seule explication logique de son existence est qu'il vient d'Australie. <br><br>  Mais je pense que tout est plus banal.  L'entrepreneur a simplement oubli√© la conception et √©conomis√© avec StackOverflow, enfin, ou ce qu'il y avait √† l'√©poque. <br><img src="https://habrastorage.org/webt/hr/xm/lw/hrxmlwxz0r0fwr4xfrueljqhc7e.jpeg"><br>  Je sais ce que vous pensez maintenant: "Alexey, eh bien, vous nous avez promis une conception pilot√©e par domaine, et voici une sorte de" Dans le monde animal "!" <br><br>  Chers coll√®gues, qu'est-ce que le d√©veloppement?  Le d√©veloppement, c'est lorsque nous prenons une partie du monde r√©el, un processus m√©tier, et que nous le transformons en code, c'est-√†-dire en construisant un mod√®le logiciel.  Quels probl√®mes nous attendent en cours de route? <br><br>  Le premier est la complexit√© des processus m√©tier eux-m√™mes, c'est-√†-dire la difficult√© √† comprendre comment fonctionne l'entreprise, quels processus se d√©roulent l√†-bas, par quelle logique ils sont construits. <br><br>  Le deuxi√®me probl√®me est la mise en ≈ìuvre de ces processus m√©tier sous forme de code, l'utilisation des bons mod√®les, les bonnes approches, etc.  C'est aussi un sujet assez compliqu√©. <br><img src="https://habrastorage.org/webt/41/de/a2/41dea2lr4g73nouzxekhq8-t3qm.jpeg"><br>  Regardez, les processus commerciaux sont comme cette girafe: ils ont commenc√© avec les plus simples unicellulaires, puis ¬´√ßa¬ª vous regarde, et personne ne comprend ¬´d'o√π √ßa vient¬ª ou ¬´comment √ßa marche¬ª. <br><br>  Pour construire un mod√®le r√©ussi d'un tel processus, vous devez d'abord r√©pondre √† la question ¬´pourquoi?¬ª.  Pourquoi voulons-nous construire ce mod√®le?  Quels objectifs voulons-nous atteindre?  Apr√®s tout, si le client voulait une girafe en peluche, mais a eu le courage, alors il sera contrari√©, m√™me si la digestion dans ce mod√®le est mise en ≈ìuvre pour un r√©gal pour les yeux.  Et le client perdra non seulement de l'argent et du temps, il perdra confiance en nous en tant que d√©veloppeurs, et nous perdrons notre r√©putation et notre client. <br><br>  Mais m√™me si nous avons d√©termin√© les objectifs, cela ne garantit toujours pas que nous n'obtiendrons pas l'ornithorynque en cons√©quence.  Le fait est que l'objectif est peu compr√©hensible.  L'objectif doit √™tre atteint.  Et cela nous aide √† concevoir un domaine. <br><img src="https://habrastorage.org/webt/qb/dz/ib/qbdzibra6bypzj_36zfv-dnhlti.jpeg"><br>  L'objectif principal de la conception pilot√©e par domaine est de lutter contre la complexit√© des processus m√©tier, leur automatisation et leur impl√©mentation dans le code.  ¬´Domaine¬ª se traduit par ¬´domaine¬ª, et le d√©veloppement et la conception dans le cadre de cette approche sont √©loign√©s du domaine. <br><br>  La conception pilot√©e par domaine comprend de nombreux √©l√©ments.  Cette conception strat√©gique, l'interaction entre les gens, les approches de l'architecture et les mod√®les tactiques - c'est tout un arsenal qui fonctionne vraiment et aide vraiment √† faire des projets.  Il n'y a qu'un ¬´mais¬ª.  Avant de commencer √† g√©rer la complexit√© de la conception pilot√©e par domaine, vous devez apprendre √† g√©rer la complexit√© de la conception pilot√©e par domaine elle-m√™me. <br><br><img src="https://habrastorage.org/webt/ho/xz/9k/hoxz9k3iyujhnbgzlt8dlfzd4b0.png"><br><br>  Quand une personne commence √† plonger dans ce sujet, une √©norme quantit√© d'informations lui tombe dessus: des livres √©pais, un tas d'articles, des mod√®les, des exemples.  Tout cela est d√©routant, et il est facile, comme on dit, de ne pas remarquer derri√®re les arbres de la for√™t.  Je l'ai ressenti une fois sur moi-m√™me, mais aujourd'hui, je veux partager mon exp√©rience avec vous et vous aider √† traverser cette jungle, en commen√ßant enfin √† utiliser la conception pilot√©e par domaine. <br><img src="https://habrastorage.org/webt/bm/mi/hs/bmmihsln4udtdm2d892qwb9elmo.jpeg"><br>  Le terme Domain-Driven Design lui-m√™me a √©t√© propos√© par Eric Evans en 2003 dans son livre impronon√ßable, que la communaut√© appelle simplement le Blue Book.  Le probl√®me est que la premi√®re moiti√© du livre Evans parle de sch√©mas tactiques (vous les connaissez tous: il s'agit d'usines, d'entit√©s, de r√©f√©rentiels, de services), et les gens n'obtiennent g√©n√©ralement pas la seconde moiti√©.  L‚Äôhomme regarde: tout est familier, je vais chercher l‚Äôapplication DDD. <br><img src="https://habrastorage.org/webt/7y/xz/_r/7yxz_r9ayavde_qjite3vti58fi.jpeg"><br>  √Ä droite, ce qui se passe si vous lancez follement des mod√®les tactiques sur le compilateur.  Gauche - si vous utilisez des mod√®les strat√©giques. <br><br><img src="https://habrastorage.org/webt/g9/bd/cj/g9bdcj-skoztnm7s3rsbxyo9w68.jpeg"><br><br>  Depuis la sortie du Blue Book, une communaut√© DDD assez forte s'est form√©e, beaucoup de choses ont √©t√© repens√©es.  Oui, et Evans lui-m√™me a admis qu'il ne comprenait plus comment il pouvait mettre fin √† une chose aussi importante que la conception strat√©gique. <br><br>  Et 10 ans plus tard, en 2013, le Livre rouge a √©t√© publi√© par Vaughn Vernon.  Et dans ce livre, la pr√©sentation est d√©j√† construite dans le bon ordre: elle commence par la conception strat√©gique, par les bases.  Et lorsque le lecteur a re√ßu la base n√©cessaire, il commence d√©j√† √† parler des mod√®les tactiques et des d√©tails de mise en ≈ìuvre. <br><br>  Habituellement, dans les rapports sur DDD, ils recommandent de lire Evans, sur Internet, il y a m√™me des manuels entiers dans quel ordre vous devez lire les chapitres pour une immersion appropri√©e.  Je recommande de le faire plus facilement: commencez par le Livre rouge, lisez-le, puis passez au bleu. <br><br>  Et puisque la conception strat√©gique est une chose si importante, parlons de ses id√©es cl√©s. <br><br><h2>  "Id√©es cl√©s de la conception strat√©gique" </h2><br>  Dans tout projet d'automatisation d'entreprise, il y a toujours des experts du domaine.  Ce sont des personnes qui comprennent le mieux le fonctionnement des processus m√©tier √† mod√©liser.  Ceux-ci peuvent √™tre des d√©veloppeurs, des dirigeants et des cadres sup√©rieurs de premier plan.  En g√©n√©ral, cela peut √™tre n'importe qui, si seulement il comprend les processus commerciaux avec lesquels nous devons traiter. <br><br><img src="https://habrastorage.org/webt/c0/s1/ho/c0s1ho_prs7h-b-qbkh7_rrroaa.jpeg"><br><br>  D'autre part, il y a des experts techniques: d√©veloppeurs, architectes directement impliqu√©s dans l'automatisation et la mise en ≈ìuvre des applications.  Dans l'exemple illustr√©, le client voulait probablement un chemin de fer pour enfants, mais il s'est av√©r√© √™tre une sorte de monstre. <br><br>  Pourquoi cela se produit-il?  Parce que l'interaction entre les experts techniques et les experts du domaine dans une situation typique ressemble √† ceci: il y a un grand-grand mur entre eux, et un gestionnaire marche le long du haut de ce mur et essaie d'abord d'entendre ce qu'ils crient d'un c√¥t√© du mur, puis il essaie de le crier au mieux des bundles de l'autre c√¥t√© du mur, et ainsi de suite en cercle. <br><br>  Parfois, un gestionnaire est sourd, alors toute une cha√Æne de tels gestionnaires peut √™tre constitu√©e, ce qui, bien s√ªr, ne contribue pas √† la r√©ussite du projet.  Et comment √ßa devrait √™tre? <br><br><img src="https://habrastorage.org/webt/wc/ov/sh/wcovshn5e04eei99ry9a9ydm4gy.jpeg"><br><br>  Il doit y avoir une interaction constante.  Experts techniques, experts du domaine - tous les participants au projet doivent constamment maintenir la communication, se synchroniser, discuter des objectifs, des moyens de les atteindre et pourquoi faisons-nous tout cela. <br><br>  Et nous arrivons ici au premier et, probablement, au point cl√© le plus important de la conception strat√©gique et de la conception pilot√©e par le domaine en g√©n√©ral. <br><br><img src="https://habrastorage.org/webt/tz/nl/jg/tznljgxy0ptqsd5vw-5s3ptopdk.jpeg"><br><br>  La communication entre les participants au projet forme ce que la conception pilot√©e par domaine appelle un langage omnipr√©sent.  Il n'est pas un dans le sens o√π il l'est pour toutes les occasions.  Bien au contraire.  Il est unique dans le sens o√π tous les participants y communiquent, toute discussion se d√©roule en termes d'une seule langue, et tous les artefacts doivent √™tre au maximum en termes d'une seule langue, c'est-√†-dire √† partir de TK et se terminant par un code. <br><br><h2>  Sc√©narios d'affaires </h2><br>  Pour une discussion plus approfondie, nous avons besoin d'une sorte de sc√©nario d'entreprise.  Imaginons cette situation: <br><br><img src="https://habrastorage.org/webt/nm/4g/ig/nm4gigksgfmt0bgp-iixvbbxow4.jpeg"><br><br>  Le directeur du groupe JUG.ru vient √† nous et dit: "Les gars, le flux des rapports augmente, les gens, en g√©n√©ral, sont tortur√©s pour tout faire manuellement ... Automatisons le processus de pr√©paration de la conf√©rence."  Nous r√©pondons: "D'accord!"  - et se mettre au travail. <br><br>  Le premier sc√©nario que nous automatiserons est le suivant: ¬´L'orateur soumet une demande de rapport √† un √©v√©nement sp√©cifique et ajoute des informations sur son rapport.¬ª  Que voyons-nous dans ce sc√©nario?  Qu'est-ce qu'un orateur, il y a un √©v√©nement, et il y a un rapport, ce qui signifie qu'il est d√©j√† possible de construire le premier mod√®le de domaine. <br><br><img src="https://habrastorage.org/webt/e_/up/_t/e_up_tj4aagy5ewxeq1xwdnim_k.jpeg"><br><br>  Nous avons ici un mod√®le de domaine: Conf√©rencier - conf√©rencier, Talk - report, Event - event.  Mais le mod√®le de domaine ne peut pas √™tre illimit√©, ne peut pas tout couvrir, sinon il deviendra flou et perdra le focus, donc le mod√®le de domaine doit √™tre limit√© par quelque chose.  Ceci est le prochain point cl√©. <br><br><img src="https://habrastorage.org/webt/e_/0w/w8/e_0ww82sof-x_waqu_epiihi8de.jpeg"><br><br>  Le mod√®le de domaine et le langage omnipr√©sent sont tous deux limit√©s par le contexte que la conception pilot√©e par domaine appelle contexte born√©.  Il restreint le mod√®le de domaine de telle mani√®re que tous les concepts qu'il contient sont sans ambigu√Øt√© et que tout le monde comprend ce qui est en jeu. <br><br>  S'ils disent ¬´utilisateur¬ª, alors tout doit √™tre clair √† la fois, il doit avoir un r√¥le compr√©hensible, un sens compr√©hensible, il ne doit pas √™tre une sorte d'utilisateur abstrait du point de vue de l'industrie informatique. <br><br><img src="https://habrastorage.org/webt/fv/v-/7r/fvv-7rprlvfbdhyo81bgitdvvny.jpeg"><br><br>  Dans notre cas, ce mod√®le de domaine est valable pour le contexte de la pr√©paration de la conf√©rence, c'est donc dans le contexte que nous appellerons le ¬´contexte de planification d'√©v√©nement¬ª.  Mais pour que l'orateur ajoute quelque chose, change des informations, il doit d'une mani√®re ou d'une autre se connecter, il doit avoir des droits.  Et ce sera d√©j√† un autre contexte, ¬´contexte d'identit√©¬ª, dans lequel il y aura une sorte de leurs propres entit√©s: utilisateur, r√¥le, profil. <br><br>  Et regardez ce que la chose est ici.  Lorsqu'une personne se connecte au syst√®me et a l'intention d'entrer une sorte d'information, physiquement, c'est la m√™me personne, mais dans diff√©rents contextes, elle est repr√©sent√©e par diff√©rentes entit√©s, et ces entit√©s ne sont pas directement li√©es. <br><br>  Si nous prenions et, par exemple, h√©ritions Speaker de User, nous m√©langerions des choses qui ne peuvent pas √™tre m√©lang√©es, et certains attributs pourraient √™tre m√©lang√©s par la logique.  Et le mod√®le perdrait le focus sur le sens sp√©cifique qu'il a, √©tant divis√© en plusieurs contextes. <br><br><h2>  D√©mo: Service commercial </h2><br>  √âcartons un peu de la th√©orie s√®che et regardons le code. <br><br>  Une conf√©rence n'est pas seulement la pr√©paration d'un contenu, mais aussi des ventes.  Imaginons qu'un service de vente de billets ait d√©j√† √©t√© √©crit, et un responsable des ventes vient nous voir et dit: ¬´Les gars!  Une fois que quelqu'un a √©crit ce service, d√©couvrons-le, quelque chose n'est pas clair pour moi comment la remise pour les clients r√©guliers est consid√©r√©e. " <br><br>  Apr√®s avoir discut√© avec le gestionnaire, nous d√©couvrons que tout le sc√©nario de ce service est le suivant: en cliquant sur Commander, le prix final du billet est consid√©r√© en tenant compte de la r√©duction client r√©guli√®re, et la commande passe √† l'√©tat ¬´En attente de paiement¬ª. <br><br>  Le code que nous allons maintenant analyser peut √™tre consult√© s√©par√©ment dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> . <br><br>  Solution ouverte, regardez la structure: <br><br><img src="https://habrastorage.org/webt/hy/wl/j4/hywlj4jodqlkuhsfza7b_gglj2u.png"><br><br>  Il semble que tout semble bien: il y a Application et Core (apparemment, les gens connaissent les couches), Repository ... Apparemment, la personne a ma√Ætris√© la premi√®re moiti√© d'Evans. <br><br>  Ouvrez OrderCheckoutService.  Que voyons-nous l√†-bas?  Voici <a href="">le code</a> : <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Checkout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ord = _ordersRepository.GetOrder(id); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> orders = _ordersRepository.GetOrders() .Count(o =&gt; o.CustomerId == ord.CustomerId &amp;&amp; o.StateId == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; o.OrderDate &gt;= DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>)); ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>; ord.StateId = <span class="hljs-number"><span class="hljs-number">1</span></span>; _ordersRepository.SaveOrder(ord); }</code> </pre> <br><br>  Nous regardons la ligne avec le prix: ici le prix change.  Nous appelons notre directeur des ventes et lui disons: "Ici, en bref, la remise est consid√©r√©e ici, tout est clair": <br><br><pre> <code class="cs hljs">ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  Il regarde par-dessus son √©paule: ¬´Oh!  Voil√† √† quoi ressemble Brainfuck!  Et ils m'ont en quelque sorte dit que les gars √©crivaient en C # ¬ª. <br><br>  De toute √©vidence, le d√©veloppeur de ce code a bien r√©pondu √† une interview sur les algorithmes et les structures de donn√©es.  J'ai √©crit √† l'√©cole des olympiades dans le m√™me style.  Apr√®s un certain temps, en utilisant le formatage et le refactoring <s>obsc√®ne</s> , nous d√©couvrons ce qui est quoi et expliquons √† notre directeur des ventes qui souffre depuis longtemps que la logique est la suivante: si le nombre de commandes au cours des 3 derni√®res ann√©es n'est pas inf√©rieur √† un, alors il re√ßoit une remise de 10% , pas moins de trois √† 20% et pas moins de cinq √† 30%.  Il part joyeux - maintenant, il est clair comment tout cela fonctionne. <br><br>  Je pense que beaucoup ont lu le Clean Code de Bob Martin.  L√†, il dit √† propos de la r√®gle du boy-scout: "Le parking apr√®s notre d√©part devrait √™tre plus propre qu'il ne l'√©tait avant notre arriv√©e."  Par cons√©quent, refactorisons ce code afin qu'il ait l'air humain et corresponde √† ce dont nous avons parl√© un peu plus t√¥t √† propos du langage omnipr√©sent et de son utilisation dans le code. <br><br>  Voici le code refactoris√©. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DiscountCalculator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IOrdersRepository _ordersRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrdersRepository ordersRepository</span></span></span><span class="hljs-function">)</span></span> { _ordersRepository = ordersRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateDiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completedOrdersCount = _ordersRepository.GetLast3YearsCompletedOrdersCountFor(customerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DiscountBy(completedOrdersCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completedOrdersCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  La premi√®re chose que nous faisons est de transf√©rer le calcul de la remise vers un DiscountCalculator distinct, dans lequel la m√©thode CalculateDiscountBy customerId appara√Æt.  Tout est lu humainement, tout est clair: quoi, pourquoi et comment.  √Ä l'int√©rieur de cette m√©thode, nous voyons que nous avons globalement deux √©tapes pour calculer la remise.  Premi√®rement: nous recevons quelque chose du r√©f√©rentiel de commandes, tout est selon le cas d'utilisateur, vous n'avez m√™me pas besoin d'aller √† l'int√©rieur si ce n'est pas la partie qui vous int√©resse maintenant.  Le fait est que nous obtenons le nombre de certaines commandes termin√©es, apr√®s quoi nous consid√©rons imm√©diatement la deuxi√®me remise pour cette quantit√© comme la deuxi√®me √©tape. <br><br>  Si nous voulons voir comment cela est consid√©r√©, nous allons √† DiscountBy, et ici presque la m√™me chose est √©crite en anglais presque humain que notre "type de brainfair" √©tait avant, tout est clair et pr√©cis. <br><br>  La seule question qui pourrait se poser est de savoir dans quelles unit√©s la remise est mesur√©e.  Il serait possible d'ajouter le mot ¬´pour cent¬ª dans le nom de la m√©thode pour le clarifier, mais d'apr√®s le contexte et les chiffres impliqu√©s, devinez probablement que ce sont des pourcentages, et pour plus de concision, il peut √™tre omis.  Si nous voulons voir le nombre de commandes, nous irons dans le code du r√©f√©rentiel et verrons.  Maintenant, nous ne le ferons pas.  Dans notre service, nous devons ajouter une nouvelle d√©pendance DiscountCalculator.  Et voyons ce que nous avons fini avec la deuxi√®me version de la m√©thode Checkout. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckoutV2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> order = _ordersRepository.GetOrder(orderId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> discount = _discountCalculator.CalculateDiscountBy(order.CustomerId); order.ApplyDiscount(discount); order.State = OrderState.AwaitingPayment; _ordersRepository.SaveOrder(order); }</code> </pre><br><br>  Regardez, la m√©thode Checkout re√ßoit orderId, puis re√ßoit un orderId par orderId, selon le CustomerId de cette commande, elle consid√®re la remise √† l'aide du calculateur de remise, applique la remise √† la commande, d√©finit le statut sur AwaitingPayment et enregistre la commande.  Nous avions un script en russe sur la diapositive, mais ici nous lisons pratiquement la traduction de ce script en anglais et tout est clair, tout est √©vident. <br><br>  Voyez-vous quel est le charme?  Ce code peut √™tre montr√© √† n'importe qui: pas seulement aux programmeurs, mais au contr√¥le qualit√©, aux analystes et aux clients.  Ils comprendront tous ce qui se passe, car tout est √©crit en langage humain.  J'utilise ceci dans notre projet, vraiment QA peut regarder quelques morceaux, v√©rifier avec Wiki et comprendre qu'il y a une sorte de bogue.  Parce que le Wiki le dit et que le code est un peu diff√©rent, mais il comprend ce qui se passe l√†-bas, bien qu'il ne soit pas d√©veloppeur.  Et de la m√™me mani√®re, nous pouvons discuter du code avec l'analyste et en discuter en d√©tail.  Je dis: "Regardez, voici comment cela fonctionne dans le code."  Notre dernier recours n'est pas le Wiki, mais le code.  Tout fonctionne comme il est √©crit dans le code.  Il est tr√®s important d'utiliser un langage omnipr√©sent lors de l'√©criture de code. <br><br><img src="https://habrastorage.org/webt/-a/15/pc/-a15pcu9tfp6xjadw-98qlpcxrs.jpeg"><br><br>  Ceci est le troisi√®me point cl√©. <br><br>  Il y a tellement de confusion √† propos de la conception pilot√©e par domaine dans des choses comme le domaine, le sous-domaine, le contexte d√©limit√©, la fa√ßon dont ils se rapportent √† ce qu'ils signifient.  Il semble que tout le monde limite quelque chose, tous sont en quelque sorte bien rang√©s.  Mais il n'est pas clair alors quelle est la diff√©rence, pourquoi ils sont si diff√©rents invent√©s. <br><br><img src="https://habrastorage.org/webt/tp/zo/nf/tpzonf_lfbysx7pgiiqrxbiineo.jpeg"><br><br>  Le domaine est une chose globale, c'est un domaine mondial dans lequel cette entreprise particuli√®re fait de l'argent.  Par exemple, pour DotNext c'est une conf√©rence, pour Pyaterochka c'est une vente au d√©tail de marchandises. <br><br>  Les grandes soci√©t√©s peuvent avoir plusieurs domaines.  Par exemple, Amazon est engag√© √† la fois dans la vente de biens via Internet et dans la fourniture de services cloud, ce sont des domaines diff√©rents. <br><br>  N√©anmoins, c'est quelque chose de mondial et ne peut pas √™tre automatis√© directement, m√™me il est difficile d'enqu√™ter.  Pour l'analyse, le domaine est in√©vitablement divis√© en sous-domaines, c'est-√†-dire en sous-domaines. <br><br><img src="https://habrastorage.org/webt/rc/wv/qz/rcwvqzdcicpkiw57o6p1lzunmn4.jpeg"><br><br>  Les sous-domaines font partie d'une entreprise qui, dans notre langue, sont hautement connect√©s, c'est-√†-dire qu'il s'agit d'une sorte de processus logiques isol√©s qui interagissent les uns avec les autres √† un niveau majeur. <br><br>  Par exemple, si nous prenons une boutique en ligne, ce sera la formation et le traitement des commandes, ce sera la livraison, c'est le travail avec les fournisseurs, c'est le marketing, c'est la comptabilit√©.  Voici quelques-unes de ces pi√®ces - c'est ce que l'entreprise est divis√©e. <br><br><img src="https://habrastorage.org/webt/yc/rc/ub/ycrcubvepugwbmk-xpidrsxc1pu.jpeg"><br><br>  Du point de vue de DDD, les sous-domaines sont divis√©s en trois types.  Et ici, je veux dire encore une chose: souvent dans les livres et articles, le sous-domaine est simplement r√©duit au domaine, mais g√©n√©ralement dans le cas o√π il est combin√© avec le type de sous-domaine.  Autrement dit, quand ils disent ¬´domaine principal¬ª, ils signifient sous-domaine principal, s'il vous pla√Æt ne vous y trompez pas.  Cela m'a √©poustoufl√© au d√©but. <br><br>  Les sous-domaines sont divis√©s en trois types. <br><br><img src="https://habrastorage.org/webt/a0/vg/jh/a0vgjhuiklcpufzsw_lsdzgisnw.jpeg"><br><br>  Le premier et le plus important est Core.  Le noyau est le sous-domaine principal, c'est l'avantage concurrentiel de l'entreprise, ce qui fait de l'argent de cette entreprise, en quoi elle diff√®re de ses concurrents, son savoir-faire, peu importe comment vous l'appelez.  Si nous prenons la conf√©rence DotNext, alors c'est le contenu.  Vous √™tes tous venus ici pour du contenu, s'il n'y en avait pas ici, vous n'iriez pas ou n'iriez pas √† une autre conf√©rence.  Il n'y aurait pas de DotNext sous la forme dans laquelle il se trouve. <br><br><img src="https://habrastorage.org/webt/up/dr/cc/updrcc6vh3xb0niwkpsuqnrlr-s.jpeg"><br><br>  Le deuxi√®me type est Supporting Subdomain.  C'est aussi une chose importante pour gagner de l'argent, c'est aussi quelque chose sans lequel c'est impossible, mais ce n'est pas une sorte de savoir-faire, un r√©el avantage concurrentiel.  C'est ce que prend en charge Core Subdomain.  Du point de vue de l'application de la conception pilot√©e par domaine, cela signifie que moins d'efforts sont consacr√©s √† la prise en charge du sous-domaine, toutes les forces principales sont lanc√©es sur Core. <br><br>  Un exemple pour le m√™me DotNext est le marketing.  C'est impossible sans marketing, sinon personne n'aurait √©t√© au courant de la conf√©rence, mais sans marketing de contenu n'est pas n√©cessaire. <br><br><img src="https://habrastorage.org/webt/ad/in/ar/adinar6ki4kdf1xnozjylhho9ea.jpeg"><br><br>  Et enfin, le sous-domaine g√©n√©rique.  Le g√©n√©rique est une t√¢che commerciale typique qui, en r√®gle g√©n√©rale, peut √™tre automatis√©e avec des produits finis ou externalis√©e.  C'est ce qui est √©galement n√©cessaire, mais cela ne n√©cessite pas n√©cessairement une mise en ≈ìuvre ind√©pendante par nous, et plus encore, ce sera g√©n√©ralement une bonne id√©e d'utiliser un produit tiers. <br><br>  Par exemple, vendre des billets.  DotNext vend des billets via TimePad.  Ce sous-domaine est parfaitement automatis√© par TimePad, et vous n'avez pas besoin d'√©crire un deuxi√®me TimePad vous-m√™me. <br><br><img src="https://habrastorage.org/webt/38/xi/5c/38xi5cgogl1edatrnmd4jy6o5yg.jpeg"><br><br>  Et enfin, contexte born√©.  Le contexte d√©limit√© et le sous-domaine sont toujours quelque part √† proximit√©, mais il existe une diff√©rence significative entre eux.  C'est tr√®s important. <br><br><img src="https://habrastorage.org/webt/pa/xm/bo/paxmbosiaaglpdk-fc-38ouji3g.jpeg"><br><br>  Il y a une question sur StackExchange en quoi le contexte born√© diff√®re du sous-domaine.  Le sous-domaine est une entreprise, un morceau du monde r√©el, c'est le concept d'un espace de d√©claration de probl√®me.  Le contexte born√© limite le mod√®le de domaine et le langage omnipr√©sent, c'est-√†-dire le r√©sultat de la mod√©lisation et, par cons√©quent, le contexte born√© est le concept d'espace de solution.  Dans le processus de mise en ≈ìuvre du projet, une sorte de mappage des sous-domaines a lieu dans des contextes limit√©s. <br><br><img src="https://habrastorage.org/webt/ba/91/mi/ba91mikbrcn3l50d_k2dwedusug.jpeg"><br><br>  Un exemple classique: la comptabilit√© en tant que sous-domaine, la fa√ßon dont le processus est mapp√©, est automatis√©e, par exemple, 1C Bookkeeping, Elba ou ¬´My business¬ª - est en quelque sorte automatis√©e par un produit.  C'est le contexte born√© de la comptabilit√©, dans lequel il y a son langage omnipr√©sent, sa propre terminologie.  C‚Äôest la diff√©rence entre eux. <br><br><img src="https://habrastorage.org/webt/fs/y1/lv/fsy1lvc6qabh0flcrli7bkxvpho.jpeg"><br><br>  Si nous revenons √† DotNext, comme je l'ai dit, les tickets sont mapp√©s √† TimePad et le contenu qui est notre sous-domaine principal est mapp√© √† une application personnalis√©e que nous d√©veloppons pour la gestion de contenu. <br><br><h3>  Taille du contexte born√© </h3><br>  Il y a un moment qui soul√®ve de nombreuses questions.  Comment choisir la bonne taille pour un contexte d√©limit√©?  Dans les livres, on peut trouver une telle d√©finition: "Le contexte born√© doit √™tre exactement tel que le langage omnipr√©sent est complet, coh√©rent, sans ambigu√Øt√©, sans ambigu√Øt√©, coh√©rent."  D√©finition cool, dans le style d'un math√©maticien d'une c√©l√®bre blague: tr√®s pr√©cis, mais inutile. <br><br>  Voyons comment comprendre tout de m√™me: s'il doit s'agir d'une solution, d'un projet ou d'un espace de noms - quelle √©chelle doit √™tre attach√©e au contexte d√©limit√©? <br><br><img src="https://habrastorage.org/webt/l8/h5/7y/l8h57y11erupofzzpnc3q6li7ei.jpeg"><br><br>  La premi√®re chose que vous pouvez lire presque partout: id√©alement, <b>un sous-domaine doit √™tre mapp√© √† un contexte limit√©</b> , c'est-√†-dire √™tre automatis√© par un contexte limit√©.  Cela semble logique, car √† la fois l√† et il y a des limites d'un processus m√©tier distinct, dans les deux cas, certains termes commerciaux, une seule langue appara√Æt.  Mais ici, vous devez comprendre que c'est une situation id√©ale, vous ne l'aurez pas n√©cessairement, et il n'est pas n√©cessaire d'essayer d'y parvenir. <br><br>  Parce que, d'un c√¥t√©, un sous-domaine peut √™tre assez volumineux, et vous pouvez obtenir plusieurs applications ou services qui vont l'automatiser, il peut donc s'av√©rer que plusieurs contextes limit√©s correspondent √† un sous-domaine. <br><br>  Mais il y a une situation inverse, en r√®gle g√©n√©rale, c'est typique de Legacy.  Autrement dit, lorsqu'ils ont cr√©√© une grande, grande application qui automatise tout dans le monde dans cette entreprise, le contraire se r√©v√©lera.  Une application est un contexte born√©, l√† le mod√®le sera probablement une sorte d'ambigu√Øt√©, mais les sous-domaines n'y ont pas disparu, respectivement, un contexte born√© correspondra √† plusieurs sous-domaines. <br><br>  Lorsque l'architecture des microservices est devenue √† la mode, une autre recommandation est apparue (bien qu'elles ne se contredisent pas): <b>un contexte limit√© par microservice</b> .  Encore une fois, cela semble logique, les gens le font vraiment.  Parce que le microservice doit assumer une fonction claire, qui dispose en interne d'une connectivit√© √©lev√©e et communique avec d'autres services via une sorte d'interaction.  Si vous utilisez une architecture de microservice, vous pouvez prendre cette recommandation par vous-m√™me. <br><br>  Mais ce n'est pas tout.  Permettez-moi de vous rappeler une fois de plus que la conception pilot√©e par domaine concerne beaucoup: la langue, les gens.  Et vous ne pouvez pas ignorer les gens et ne faire que des crit√®res techniques dans ce domaine.  Par cons√©quent, j'ai √©crit ceci: <b>un contexte est √©gal √† X-man</b> .  Je pensais que x est environ 10, mais nous avons discut√© un peu avec Igor Labutin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">twitter.com/ilabutin</a> ) et la question est rest√©e ouverte. <br><br>  Ici, il est important de comprendre ceci: une seule langue reste unifi√©e pendant que tous les participants parlent, discutent et tout le monde la comprend sans ambigu√Øt√©.  Il est clair qu'un nombre infini de personnes ne peuvent pas parler la m√™me langue.  Notre histoire de l'humanit√© le montre clairement.  Dans tous les cas, certains dialectes apparaissent, certaines de leurs significations, maintenant vous pouvez m√™me ajouter des m√®mes et ainsi de suite.  D'une mani√®re ou d'une autre, la langue deviendra floue. <br><br>  Par cons√©quent, il faut comprendre que le nombre de personnes qui utilisent ce langage unique et, par cons√©quent, participent au d√©veloppement, √† l'automatisation, est limit√©.  Les livres parlent √©galement de certaines raisons politiques: si deux √©quipes travaillent sous la direction de diff√©rents gestionnaires et travaillent sur le m√™me contexte d√©limit√©, et pour une raison quelconque, ces gestionnaires ne sont pas amis, les conflits commenceront et la concentration sera perdue.  Par cons√©quent, il sera beaucoup plus simple et plus correct de cr√©er deux contextes born√©s pour chaque commande et de ne pas essayer de combiner ce qui n'est pas combin√©. <br><br><h2>  Architecture et gestion des d√©pendances </h2><br>  Du point de vue de la conception pilot√©e par domaine, peu importe l'architecture que vous choisissez.  La conception pilot√©e par domaine ne concerne pas cela; la conception pilot√©e par domaine concerne le langage et la communication. <br><br><img src="https://habrastorage.org/webt/3r/de/2i/3rde2isfgddxyjfzswpj2nvxtbe.jpeg"><br><br>  Mais il y a un point important, du point de vue des crit√®res de choix de l'architecture qui nous int√©resse du point de vue de la conception pilot√©e par le domaine: <b>notre objectif est de d√©barrasser au maximum la logique m√©tier des d√©pendances tierces</b> .  Parce que, d√®s que des d√©pendances tierces apparaissent, la terminologie appara√Æt, des mots apparaissent qui n'entrent pas dans une seule langue et commencent √† joncher notre logique m√©tier. <br><br><img src="https://habrastorage.org/webt/nz/pw/nu/nzpwnurj_5kkbnmjo6uhosycd1u.jpeg"><br><br>  Regardons un exemple classique d'architecture: l'architecture bien connue √† trois couches.  D√®s qu‚Äôils n‚Äôappellent pas une couche de domaine (ici la couche d‚Äôentreprise): l‚Äôentreprise, le c≈ìur et le domaine sont tous les m√™mes.  Dans tous les cas, il s'agit de la couche dans laquelle se trouve la logique m√©tier, et si elle d√©pend de la couche de donn√©es, cela signifie que certains concepts de la couche de donn√©es se d√©verseront d'une mani√®re ou d'une autre dans la couche de domaine et la joncheront. <br><br><img src="https://habrastorage.org/webt/ft/kh/34/ftkh34ce3zbpt26jx3v8id9vaym.jpeg"><br><br>  L'architecture √† quatre couches est essentiellement la m√™me, la couche de domaine d√©pend toujours, et comme elle d√©pend, des d√©pendances tierces inutiles y parviendront. <br><br><img src="https://habrastorage.org/webt/wz/uv/ky/wzuvky-2bgljcwwarvtseclyqjy.jpeg"><br><br>  Et dans ce sens, il existe une architecture qui permet d'√©viter cela - c'est l'oignon-architecture (¬´oignon¬ª).  Sa diff√©rence est qu'il est constitu√© de couches concentriques, les d√©pendances vont de l'ext√©rieur vers le centre.  C'est-√†-dire que la couche externe peut d√©pendre de toutes les couches internes, la couche interne ne peut pas d√©pendre des couches externes. <br><br>  La couche la plus externe est l'interface utilisateur dans un sens global (c'est-√†-dire qu'elle n'est pas n√©cessairement une interface utilisateur humaine, elle peut √™tre une API REST ou quoi que ce soit).  Et l'infrastructure, qui ressemble souvent en g√©n√©ral √† des E / S, est la m√™me base de donn√©es, en fait, une couche de donn√©es.  Toutes ces choses sont dans la couche externe.  Autrement dit, en raison de laquelle l'application re√ßoit en quelque sorte des donn√©es, des commandes, etc., elles sont supprim√©es et la couche de domaine se d√©barrasse de la d√©pendance √† ces choses. <br><br>  Vient ensuite la couche Application - un th√®me plut√¥t holistique, mais c'est la couche dans laquelle se trouvent les scripts, les cas d'utilisateurs.  Cette couche utilise la couche domaine pour impl√©menter ses concepts. <br><br>  Au centre se trouve la couche de domaine.  On le voit, il ne d√©pend plus de rien, il devient une chose en soi.  Et c'est pourquoi la couche de domaine est souvent appel√©e ¬´Core¬ª, car c'est le coeur, c'est ce qui est au centre, ce qui ne d√©pend pas de choses tierces. <br><br><img src="https://habrastorage.org/webt/h4/cl/_n/h4cl_nmaowsib1bw1thjvpolr8u.jpeg"><br><br>  L'une des options pour mettre en ≈ìuvre une telle architecture oignon est l'architecture hexagonale, ou ¬´ports et adaptateurs¬ª.  J'ai apport√© cette photo pour intimidation, je n'en parlerai pas.  √Ä la fin de l'article, il y a un lien vers l'un des millions d'articles sur cette architecture, vous pouvez le lire. <br><br><h2>  Un peu sur les mod√®les tactiques: Interface s√©par√©e </h2><br>  Comme je l'ai dit, premi√®rement, la plupart des sch√©mas tactiques sont familiers √† tout le monde et, deuxi√®mement, tout l'int√©r√™t de mon rapport est qu'ils ne sont pas essentiels.  Mais j'aime le mod√®le d'interface s√©par√©e s√©par√©ment, et je veux en parler s√©par√©ment. <br><br>  Revenons au code de notre microservice et voyons ce qui s'est pass√© avec le r√©f√©rentiel. <br><br><img src="https://habrastorage.org/webt/jl/c7/_d/jlc7_dwrkqw8mfy4zd1nibrdwti.png"><br><br>  La couche de domaine avait <a href="">l'</a> interface de <a href="">r√©f√©rentiel</a> IOrdersRepository.cs et son <a href="">impl√©mentation,</a> OrdersRepository.cs. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DotNext.Sales.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrdersRepository</span></span> { <span class="hljs-function"><span class="hljs-function">Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IQueryable&lt;Order&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> V2 int GetLast3YearsCompletedOrdersCountFor(long customerId); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Ici, nous avons ajout√© ici une certaine m√©thode pour recevoir des commandes pour les trois derni√®res ann√©es GetLast3YearsCompletedOrdersCountFor. <br><br>  Et ils l'ont impl√©ment√© sous une forme (dans ce cas, via Entity Framework, mais cela peut √™tre n'importe quoi): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLast3YearsCompletedOrdersCountFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> threeYearsAgo = DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dbContext.Orders .Count(o =&gt; o.CustomerId == customerId &amp;&amp; o.State == OrderState.Completed &amp;&amp; o.OrderDate &gt;= threeYearsAgo); }</code> </pre><br><br>  Voyez quel est le probl√®me.  Le r√©f√©rentiel s'est retrouv√© dans la couche domaine, son impl√©mentation dans la couche domaine, mais le code, commen√ßant par DateTime.UtcNow.AddYears (-3), n'appartient pas intrins√®quement √† la couche domaine et n'est pas une logique m√©tier.  Oui, LINQ le rend plus ou moins humanis√©, mais si, par exemple, il y avait des requ√™tes SQL ici, tout serait compl√®tement triste. <br><br>  La signification du mod√®le d'interface s√©par√©e est que l'interface de service que nous utilisons dans la logique de domaine est d√©clar√©e dans la couche de domaine.  Nous parlons de r√©f√©rentiels et de services similaires dans lesquels les d√©tails de la mise en ≈ìuvre de ces services ne sont pas une logique m√©tier.  La logique m√©tier est le fait de l'existence de ces services et le fait de leur appel et de leur utilisation dans la couche domaine.  Par cons√©quent, l'interface du r√©f√©rentiel reste dans la couche domaine et l'impl√©mentation passe √† la couche infrastructure. <br><br>  J'ai pr√©par√© une autre option.  L'interface du r√©f√©rentiel reste dans l'assembly Core, mais l'impl√©mentation passe √† Infrastructure.EF. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rh/k0/b_/rhk0b_dgbqe72y--hxcx13qlqco.png"></div><br><br>  Ainsi, nous avons apport√© √† l'infrastructure les concepts qui n'√©taient pas propres √† la couche domaine.  Comme effet secondaire, nous pouvons remplacer cette infrastructure par une autre impl√©mentation.  Mais ce n'est pas l'objectif principal, l'objectif principal est, comme je l'ai dit, de d√©barrasser la logique de domaine des d√©pendances tierces. <br><br><h2>  Encore une fois sur la langue </h2><br>  Parlons encore et encore et encore de la langue. <br><br>  Au tout d√©but, nous avons construit le mod√®le de domaine ¬´haut-parleur - conversation - √©v√©nement¬ª.  Je pense que personne n'a soulev√© de questions particuli√®res. <br><br>  Et voici le sc√©nario sur la base duquel nous avons construit ce mod√®le de domaine: <br><br><img src="https://habrastorage.org/webt/2r/go/hp/2rgohppxhq7iqwvndfimzctuit8.jpeg"><br><br>  Vous voyez, le script est en russe et le mod√®le de domaine est en anglais. <br><br>  Pour les d√©veloppeurs non anglophones, c'est quelque chose avec lequel vous devez vivre constamment. <br><br><img src="https://habrastorage.org/webt/jm/3p/rf/jm3prfqcjwydo3mg2c1p0zh3olc.jpeg"><br><br>  Chacun de vous, tr√®s probablement, fait constamment ce processus: traduit du russe en anglais et vice versa.  Ceux qui travaillent avec des clients et des projets anglophones sont un peu plus faciles, car les exigences sont en anglais, les discussions avec les clients en anglais, en r√®gle g√©n√©rale, tous les sc√©narios sont en anglais, le code est en anglais, et il n'y a que la communication au sein de l'√©quipe en russe, qui se d√©veloppe rapidement en anglais (client - client, commande - commande).  Et cette charge cognitive, cette surcharge, qui est cr√©√©e par une traduction constante, recule un peu. <br><br>   ,     ,        ,    .    ,    . <br><br>         1,        .   ,  ‚Äî    ,     ,          . <br><br><img src="https://habrastorage.org/webt/1e/b7/jh/1eb7jhuiy5i1ft1bsfrnu1x7_9u.jpeg"><br><br>      1. PascalCase  ,     ,     ,     <s></s>  ,      ,    , ,  - -     . <br><br>  ,  -  ? <br><br><img src="https://habrastorage.org/webt/lj/js/vd/ljjsvdrqh4v9117mps2yrelyxna.jpeg"><br><br>   ,     use case,   ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ,   .        C#,  ,  , .       ,    ,   ,  . <br><br>        ,  ,      Domain-Driven Design.      ,   ,    , ,        C#    .                    . <br><br>   ,      -  Continuous Integration.  ,       ,    , -   - .   ,     -  ,   ,  .  ,  95%      ,      ,  Continuous Integration,  , TeamCity .   . <br><br>               ,          . .   ,           1-,  ,    .        ¬´¬ª  ,     .    ,   ,    . <br><br><img src="https://habrastorage.org/webt/qh/ff/32/qhff32udhgwxb4cav3gjjoakn4e.jpeg"><br><br>         ,   Domain-Driven Design. <br><br>  ‚Äî  ,   . Domain-Driven Design ‚Äî    ,    .  ‚Äî    ,  ,          ubiquitous language.     ,     ,   .      ,   ,      ,        . <br><br> .    ,  .    - ,      ,    ,     ,  ,     ,  ,  ,  ,      ,  ‚Äî .     . <br><br>       .      .      .      .   ,    ,      .        DSL-.        .NET-,     - ,    ,  ,  ,   .   ,     . <br><br> , -    .    ,    ,     ubiquitous language  -.     . <br><br><h2>    </h2><br><ul><li> <b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">marshinov</a> </b> .    ,      DDD: , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´   DDD, CQRS  Event Sourcing    ¬ª</a> .    ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,  AutoMapper   MediatR.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,       Domain-Driven Design,      . </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´F# for fun and profit¬ª</a> ,   ,   F#  Domain-Driven Design.  ,  ,   ,    . </li><li>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>    ,   . </li></ul><br>   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  GitHub</a> . <br><br><blockquote>   DotNext: <br>   , ¬´       ,     ¬ª.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <b>DotNext</b> ( <b>15-16   </b> )     .    ,   1   ,         . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440772/">https://habr.com/ru/post/fr440772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440756/index.html">CI / CD sans serveur sur AWS</a></li>
<li><a href="../fr440758/index.html">Allez Meetup √† Acronis! (Moscou, Fiztehpark)</a></li>
<li><a href="../fr440760/index.html">Le nouvel √¢ge d'or de l'architecture informatique</a></li>
<li><a href="../fr440762/index.html">Avis des employeurs: la nature et le non-sens des avis anonymes</a></li>
<li><a href="../fr440766/index.html">Des geeks aux geeks: des cadeaux pour le 23 f√©vrier</a></li>
<li><a href="../fr440774/index.html">De graves erreurs math√©matiques de la NHTSA permettent √† Tesla de revendiquer la s√©curit√© du pilote automatique</a></li>
<li><a href="../fr440776/index.html">Courriel, vue int√©rieure</a></li>
<li><a href="../fr440778/index.html">Deuxi√®me rencontre OpenStack au groupe Mail.ru: 22 f√©vrier</a></li>
<li><a href="../fr440780/index.html">Google ne bloquera pas les bloqueurs de publicit√©s tiers dans le navigateur Chromium</a></li>
<li><a href="../fr440782/index.html">Je vais plus loin dans la clandestinit√©, ou ce que vous devez savoir sur l'optimisation de l'application r√©seau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>