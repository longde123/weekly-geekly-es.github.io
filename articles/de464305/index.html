<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔢 📆 👨🏽‍🎓 Klein, ja. Unboxing des Firecracker mikrovirtuell 👐🏿 🧒🏻 🐯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nehmen Sie Firecracker-Mikrovirtuals auf. Wir verwenden zwei beliebte Methoden zum Isolieren von Mehrbenutzer-Workloads - virtuelle Maschinen und Cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Klein, ja. Unboxing des Firecracker mikrovirtuell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/464305/">  Nehmen Sie Firecracker-Mikrovirtuals auf.  Wir verwenden zwei beliebte Methoden zum Isolieren von Mehrbenutzer-Workloads - virtuelle Maschinen und Container.  Wir drücken das Beste aus beiden Ansätzen aus, vereinfachen so viel wie möglich und testen auf einer echten Hochlast.  Als Ergebnis erhalten wir eine undurchdringliche Isolation von virtuellen Computern, die in Hunderten von Millisekunden gestartet werden können.  Diese Lösung funktioniert unter der Haube von AWS Lambda und Fargate und führt jede Sekunde Millionen von Funktionen und Containern ohne Server in der Cloud aus.  Es heißt Kracher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/ps/oo/rmpsoo1w1jptnyp2qwsaestydsq.png" width="400"></div><br><br>  Dieses Mikrovirtualisierungstool ist in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenSource</a> verfügbar.  Wenn Ihre Aufgaben eine Mandantenisolation erfordern (z. B. wenn Sie sich für die Erstellung einer eigenen Cloud entscheiden), ist Firecracker genau das Richtige für Sie. <br><br>  <strong>Vasily Pantyukhin</strong> , Architekt von Amazon Web Services, spricht über die Firecracker-Architektur, wie sie von AWS Lambda verwendet wird, vergleicht sie mit alternativen Lösungen und gibt Beispiele für die Integration. <br><br>  <em>Haftungsausschluss: Alles, was unten steht, ist Vasilys persönliche Meinung und stimmt möglicherweise nicht mit der Position von Amazon Web Services überein.</em> <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cfsICOzt6Do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Natürliche Merkmale öffentlicher Wolken </h2><br><blockquote>  Eine der grundlegenden Eigenschaften von Public Clouds ist die Mandantenfähigkeit. </blockquote><br>  Jemand übersetzt diesen Begriff als "Mandantenfähigkeit" oder "Mehrbenutzerumgebung".  Aus meiner Sicht spiegelt dies jedoch nicht das Wesentliche wider.  Mandantenfähigkeit ist, wenn verschiedene Benutzer und ihre Lasten in derselben physischen Infrastruktur leben, diese untereinander teilen, aber nichts voneinander wissen.  Bei Mehrbenutzer-Workloads unterscheidet sich die Mandantenfähigkeit durch grundlegend strengere Anforderungen an die Ressourcenisolierung und den Zugriff auf diese. <br><br><blockquote>  Eine weitere Eigenschaft, die öffentlichen Clouds innewohnt, ist die Hochlast. </blockquote><br>  Glauben Sie mir, im Fall von AWS ist dies eine enorme Belastung!  Der Screenshot ist ein Beispiel für reale Daten.  Ich werde nicht sagen, wie lange und in welcher Region diese Millionen von "Papageien" gemessen wurden, aber dies ist kein Notfall, sondern die für uns übliche Betriebsart. <br><br><img src="https://habrastorage.org/webt/up/dt/qs/updtqsp7dmtqk1czi5f2zuscbkq.png"><br><br>  Es stellt sich ein gewisser Widerspruch heraus.  Einerseits müssen wir die Benutzer so isoliert wie möglich halten.  Andererseits müssen wir ein sehr hohes Maß an Produktivität und Ressourcennutzung sicherstellen.  Die Verbesserung des einen führt oft zu den Einschränkungen des anderen.  Wie kann man einen Kompromiss finden und noch besser, um an allen Fronten das Maximum zu erreichen? <br><br><h2>  Virtuelle Maschinen oder Container? </h2><br>  Es gibt zwei grundlegende Ansätze, die möglicherweise helfen könnten.  Dies sind virtuelle Maschinen und Container.  Jeder hat seine Vor- und Nachteile. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/hl/ba/djhlbailazcjnfxycokcrv38a64.png" width="400"></div><br><br>  Der Hauptnachteil virtueller Maschinen besteht darin, dass das <strong>Laden lange dauert</strong> .  Normalerweise dauert es einige zehn Sekunden oder sogar Minuten, um die Maschine zu starten.  Aber Virtualoks haben eine Tugend - sie <strong>isolieren</strong> Betonlasten voneinander.  Und aus beiden Blickwinkeln: <br><br><ul><li>  <strong>Sicherheit,</strong> wenn eine virtuelle Maschine nicht auf Daten in einer anderen Maschine zugreifen kann; </li><li>  <strong>Ressourcen</strong> , als ich 8 GB Speicher bestellt habe, hoffe ich, dass dieser RAM mir gehört und niemand die Ressource beanspruchen kann, für die ich bezahlt habe. </li></ul><br>  Das Gegenteil ist bei Containern der Fall: Sie sind leicht und <strong>laden</strong> daher <strong>sehr schnell.</strong>  Sie können leicht horizontal skaliert werden.  Es gibt jedoch eine Funktion, mit der wir als öffentlicher Cloud-Anbieter nicht leben können.  Sie verwenden einen <strong>gemeinsam genutzten Kernel - der Betriebssystemkernel wird von allen Containern gemeinsam genutzt</strong> . <br><br><img src="https://habrastorage.org/webt/pa/pz/hm/papzhmvppqzce7pxbezk8bp9owg.png"><br><br>  Kann man sagen, dass Container unsicher sind?  Nein, obwohl es schwerwiegende Sicherheitslücken gibt. <br><br><blockquote>  Ich glaube, dass ein ordnungsgemäß „geschweißter“ Behälter heute ein ausreichendes Maß an Sicherheit bietet. </blockquote><br>  Das Problem ist anders: Ein gemeinsam genutzter Kernel garantiert nicht grundsätzlich, dass irgendwann in der Zukunft keine Schwachstellen auftreten, die die Isolation der Mandanten aufheben.  Die öffentliche Cloud kann es sich nicht einmal theoretisch leisten. <br><br>  Es gibt noch einen weiteren Widerspruch, und es muss nach einer Lösung gesucht werden.  Der einfachste Weg ist, das Beste von Mama - einer virtuellen Maschine - und von Papa - einem Container - zu nehmen, zu kreuzen und etwas <strong>Konvergentes zu bekommen</strong> .  Eigentlich haben wir es geschafft.  Es stellte sich heraus, Kracher. <br><br>  Kracher ist bereits in Produktion.  In der gleichen Menge kritischer Dienste, zum Beispiel AWS Lambda (Serverless-Funktionen) und AWS Fargate (Serverless-Container). <br><br><h3>  Probleme des alten AWS Lambda </h3><br>  AWS Lambda ist ein Serverless Feature Service.  Wir übernehmen die Funktion in Java, Go, Python oder einer anderen Sprache, wir werfen sie in Lambda und sie wird magisch ausgeführt.  Es ist nicht erforderlich, Ressourcen zuzuweisen und zu verwalten.  Wie wurde das vorher umgesetzt? <br><br><img src="https://habrastorage.org/webt/ou/ck/-s/ouck-sm6pjv4ul6t13dwlefxtry.png"><br><br>  Für jedes AWS-Konto wurden eine oder mehrere separate virtuelle EC2-Maschinen zugewiesen, um Funktionen zu isolieren, die verschiedenen Mandanten gehören.  Eine solche virtuelle Maschine verbraucht Ressourcen, selbst wenn sie nichts tut.  Angenommen, wir führen eine Funktion alle 10 Minuten einmal aus und sie wird in 200 ms wie ein normaler Lambda ausgeführt.  Es stellt sich heraus, dass die EC2-Maschine innerhalb einer Stunde nur wenige Sekunden benutzt wird.  Darüber hinaus verbraucht es auch zur Laufzeit nicht alle verfügbaren Ressourcen - Entsorgung unterhalb der Fußleiste.  Das ist wütend unrentabel. <br><br><img src="https://habrastorage.org/webt/jy/lo/0q/jylo0qlzudppsa5042qv858mfya.png"><br><br><h3>  Wie haben Sie das Recyclingproblem gelöst? </h3><br>  Entwickelte von Grund auf ihre eigene Firecracker-Lösung.  Dies geht aus dem Titel des Berichts hervor :) <br><br>  Um mit der Entwicklung eines neuen Produkts zu beginnen, benötigen Sie eine technische Aufgabe.  Es enthält viel Text, aber wenn Sie nur die Bedeutung auswählen, erhalten Sie Folgendes. <br><br><ul><li>  <strong>Unterstützt von KVM</strong> als Hypervisor.  Wer mit AWS arbeitet, weiß, dass wir zwei Lieblingshypervisoren haben.  Legacy-VMs werden unter Xen ausgeführt.  Seit Ende 2017 lebt KVM unter der Haube aller Autos. </li><li>  <strong>Es beginnt so schnell wie möglich.</strong>  Auf der Referenzhardware war die Anforderung eine volle Auslastung des Mikrovirtuals in 125 ms. </li><li>  <strong>Minimaler Virtualisierungsaufwand</strong> .  In der Referenzarchitektur verbraucht eine einzelne mikro-virtuelle Firecracker-Maschine zusätzlich nur 5 MB Speicher. </li><li>  <strong>Die Möglichkeit des dichtesten Starts</strong> .  Designparameter - volle Last von 5 Mikrovirtualen pro Kern pro Sekunde.  Diese Anforderung ist für Dienste wie AWS Lambda von grundlegender Bedeutung.  Funktionen müssen schnell abheben, trainieren und sterben, um Ressourcen für die nächsten freizugeben. </li><li>  <strong>Die Möglichkeit einer erneuten Anmeldung</strong> .  Es ist eine Gelegenheit - es ist nicht notwendig, sie zu nutzen.  Tatsächlich ist dies die Zuweisung virtueller Ressourcen in größerem Umfang, als sie physisch verfügbar sind.  Dies bedeutet, dass der Server über 16 GB RAM verfügt und Sie gleichzeitig 4 virtuelle Maschinen ausführen, von denen jede sicher ist, dass er über 8 GB Arbeitsspeicher verfügt. </li></ul><br><h3>  AWS Lambda mit Kracher unter der Haube </h3><br>  Was hat sich in der neuen Version von AWS Lambda geändert?  Aus Sicht des Endbenutzers hat sich nichts geändert.  Die Migration zu einer aktualisierten Architektur in der Produktion war vollständig transparent und für die Verbraucher unsichtbar.  Lambda-Funktionen sind von kurzer Dauer - das war einfach. <br><br>  Wie sieht moderne Architektur aus? <br><br><blockquote>  Auf der untersten Ebene befindet sich jetzt keine virtuelle Maschine, sondern ein physisches Bare-Metal. </blockquote><br>  Solche Server ermöglichen die vollständige Nutzung aller Funktionen der CPU, beispielsweise Intel VT.  Dies bietet zusätzliche Vorteile bei Verwendung der Virtualisierung auf höheren Ebenen. <br><br><img src="https://habrastorage.org/webt/rg/i6/s3/rgi6s36v7vgfuc2onnb-cuahbui.png"><br><br>  Auf dem Stück Eisen befindet sich das <strong>Host-Betriebssystem</strong> mit dem KVM-Modul im Kernel.  <strong>Firecracker-</strong> Mikrovirtuals mit eigenen <strong>Gastbetriebssystemen</strong> werden oben gestartet.  Nun, sie haben bereits Komponenten des AWS Lambda-Service selbst implementiert. <br><br>  Bisher haben wir für jeden Kunden, der die Lambda-Funktionen verwendet, separate virtuelle EC2-Maschinen mit geringer Auslastung zugewiesen.  Mit dem neuen Ansatz können Sie ein leichtes Mikrovirtual nur dann ausführen, wenn Sie es wirklich benötigen.  Durch das Isolieren von Firecracker-Ressourcen voneinander können wir dies auf einer gemeinsamen Hardware mit maximaler Dichte tun.  Die Ressourcennutzung hat sich grundlegend verbessert. <br><br><h2>  Was ist in der Box? </h2><br>  Ich habe Anboxing versprochen, also gehen wir die Hauptkomponenten von Firecracker durch, betrachten sie einzeln und setzen dann alles zusammen. <br><br><img src="https://habrastorage.org/webt/o_/by/mq/o_bymqjtw5d6aomlwpmfa7grqgk.jpeg"><br><br><h3>  Gestaltungsprinzipien </h3><br>  Als wir zum ersten Mal über die Entwicklung von Firecracker diskutierten, waren wir uns einig, zwei Prinzipien einzuhalten. <br><br>  <strong>Alles Unnötige loswerden.</strong>  Warum wurden klassische virtuelle Maschinen langsam geladen?  Insbesondere, weil der Code überladen ist.  Sie müssen eine Vielzahl von Legacy-Geräten unterstützen.  Aber warum ein Gerät emulieren, das vor 10 Jahren noch niemand benutzt hat?  Es besteht keine Notwendigkeit, deshalb werden wir alles überflüssige los.  Wir lösen eine bestimmte enge Aufgabe, und alle Funktionen, die zur Lösung dieses Problems nicht beitragen, werden als unnötig angesehen. <br><br><blockquote>  Befreien Sie sich von allem Überflüssigen und konzentrieren Sie sich auf eine Aufgabe. </blockquote><br>  <strong>Vereinfachen Sie, was noch übrig ist.</strong>  Auch was übrig bleibt, sollte so einfach wie möglich sein. <br><br><h3>  Worüber haben sie geschrieben? </h3><br>  Firecracker ist in trendigem Rust geschrieben, weil: <br><br><ul><li>  Sie können damit <strong>sichereren Code</strong> schreiben, insbesondere in Bezug auf den Speicher. </li><li>  <strong>Leistung</strong> und Overhead sind vergleichbar mit modernem C ++; </li><li>  Rust wird <strong>seit langem verwendet und hat</strong> seit 2015 viele coole Hochlastlösungen geschrieben. </li></ul><br><h3>  Eisen </h3><br>  Ich wiederhole - Firecracker erfordert die Installation auf echter Hardware.  Als Referenzkonfiguration wurde die Bare-Metal-Maschine i3.metal gewählt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rg/to/nh/rgtonh5b1jbhgpzizky2wc6bsfk.png" width="400"></div><br>  <em>Hinweis: Der Bericht wurde Anfang April 2019 erstellt. Zu diesem Zeitpunkt wurde nur die Intel-Plattform unterstützt.</em>  <em>Im Mai wurde die Alpha-Unterstützung für AMD und im Juni für ARM hinzugefügt.</em>  <em>AMD ist möglicherweise etwas billiger als Intel, und der ARM-Support bietet interessante Möglichkeiten für die Arbeit mit IoT mit mehreren Mandanten.</em> <br><br>  Wenn Sie eine i3.metal- oder andere Bare-Metal-Maschine in AWS bestellen, ist diese für Experimente zu leistungsfähig und zu teuer.  Wenn Sie sich entscheiden, Firecracker darauf zu installieren, vergessen Sie daher nicht, diese Maschinen nach den Experimenten auszuzahlen.  Andernfalls wird am Ende des Monats eine anständige Punktzahl erzielt. <br><br>  Gibt es eine günstigere Option?  Ja, Sie können Firecracker in einer virtuellen Umgebung starten.  Aber nicht mehr in AWS - wir unterstützen verschachtelte Virtualisierung auf EC2 grundsätzlich nicht.  Sie können dies jedoch in GCP, Azure, DigitalOcean oder mit Proxmox, Parallels und VMware Fusion tun.  Alles funktioniert, wenn Sie die Anforderungen einhalten, insbesondere entsprechend der Kernel-Version des Gastbetriebssystems. <br><br><h3>  Der Kern </h3><br><blockquote>  Das grundlegende Element der Lösung ist das KVM-Kernelmodul. </blockquote><br>  Nur für den Fall, ich werde als Exkurs beschreiben, was KVM ist.  Dies ist nicht der gesamte Hypervisor, sondern nur ein Teil davon.  Die Hauptaufgaben bestehen darin <strong>, einen virtuellen Prozessor</strong> (vCPU) <strong>einzurichten</strong> und <strong>eine virtuelle Maschine zu starten</strong> . <br><br><img src="https://habrastorage.org/webt/gp/3l/ee/gp3leep27-zq3yzx9fiiho15pkm.png"><br><br>  Für eine vollwertige Arbeit reicht dies jedoch nicht aus.  Neben dem Prozessor werden einige andere Geräte benötigt.  Ihre Emulation erfolgt im User Space. <br><br><h3>  VMM </h3><br>  Damit mindestens grundlegende Geräte angezeigt werden, benötigen Sie eine andere Komponente - Virtual Machine Manager (VMM).  Vor Firecracker war QEMU die primäre VMM-Option. <br><br><img src="https://habrastorage.org/webt/kg/s8/kr/kgs8krmluije10ql6x6vtch7f9g.png"><br><br>  Wir haben ernsthaft über die Möglichkeit nachgedacht, QEMU zu verwenden, aber beschlossen, unser eigenes „Fahrrad“ zu entwickeln.  Dafür gab es mehrere Gründe. <br><br>  <strong>Entwicklungsmanagement</strong> .  QEMU ist ein großes, ausgereiftes Produkt mit über einer Million Codezeilen.  Um Änderungen vorzunehmen, müssen Sie zu viele Quellcodes anzeigen.  Viele Menschen beteiligen sich an der Entwicklung und Entscheidungsfindung bei der Entwicklung. <br><br>  <strong>Sicherheit</strong>  QEMU kann viele Geräte emulieren.  Deshalb hat es eine ziemlich große Angriffsfläche.  Unsere Aufgabe ist es, ein Mikrovirtual zu machen.  Aus Sicherheitsgründen müssen wir die Angriffsfläche minimieren. <br><br>  <strong>Die Notwendigkeit, neue Funktionen zu implementieren.</strong>  QEMU hat guten Code.  Dies ist ein ausgereiftes Produkt, in dem alle offensichtlichen Fehler bereits erkannt wurden.  In der jetzigen Form passte die QEMU-Funktionalität jedoch immer noch nicht zu uns - wir müssten viel hinzufügen.  Unter diesem Gesichtspunkt hätte der neue Code in QEMU und im neuen Produkt die gleiche Qualität.  Daher würde ein besonderer Gewinn nicht funktionieren. <br><br><h3>  Geräte </h3><br>  Firecracker implementiert VMM, mit dem Geräte emuliert werden.  Wir emulieren folgende Geräte: <br><br><ul><li>  <strong>Konsole</strong>  Eine nützliche und notwendige Sache, obwohl sie ausgeschaltet werden kann. </li><li>  <strong>Tastatur</strong>  Wir haben eine knifflige Tastatur erstellt - mit nur einer "Reset" -Taste.  Wir vertrauen einfach nicht der Software "Reset" der Betriebssysteme, die möglicherweise in Firecracker ausgeführt werden könnten.  Deshalb machten sie Eisen. </li><li>  <strong>Virtio-Treiber für Festplatte und Netzwerk</strong> .  Virtio ist ein sehr primitives Gerät.  Im Wesentlichen ist dies ein "Ringpuffer".  Das Gastsystem hat etwas in den Puffer geschrieben, auf den Aufruf geklickt und das Hostsystem hat die Daten aus diesem Puffer durch eine Datei gelesen. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/av/hw/pvavhwc_g42zvrjrg7ftiqmcfda.png" width="500"></div><br><br>  In einigen Fällen, zum Beispiel für die Integration in Container, benötigen wir noch ein Netzwerkgerät, das die Grundfunktionalität einer normalen Netzwerkkarte darstellt.  Virtio passt hier nicht, zu einfach.  Daher verwenden wir für das Netzwerk ein anderes Gerät - <strong>Vsock</strong> . <br><br>  Nun, wir brauchen auch die Fähigkeit, den Ressourcenverbrauch zu kontrollieren.  Der <strong>Ratenbegrenzer</strong> ist dafür verantwortlich. <br><br>  Es gibt Geräte.  Aber wie werden Mikrovirtuale verwaltet und konfiguriert?  Die Management-API hilft uns hier. <br><br><h3>  Management </h3><br>  Amazon hat mehrere unzerbrechliche Grundprinzipien.  Einer davon ist, dass alle Dienste nur über die API miteinander kommunizieren.  Es spielt keine Rolle, ob es sich um externe Dienste handelt, die Sie als Benutzer verwenden, oder um unsere internen Dienste.  Es kommt nicht vor, dass ein Dienst direkt in die Datenbank eines anderen Dienstes geht - es ist verboten und strafbar.  Der Firecracker-API-Thread wird nur verwendet, um über die REST-API auf die Einstellungen und Funktionen von Mikrovirtualen zuzugreifen. <br><br><img src="https://habrastorage.org/webt/1s/qj/bt/1sqjbtijgutp6qfwscgu_vnq1va.png"><br><br>  Wir halten uns an die Open API-Spezifikation, sodass Sie Swagger verwenden können. <br><br><h3>  Metadaten </h3><br>  Es gibt so eine böse - harte Kodierung.  In diesem Fall werden einige Daten direkt in den Code eingenäht, z. B. das Login und das Kennwort für den Zugriff auf eine andere Ressource.  Dies ist natürlich nicht zulässig.  In regelmäßigen Abständen müssen wir einige Daten innerhalb des Mikrovirtuals übertragen.  Dies erfolgt über den <strong>Metadatendienst</strong> . <br><br><img src="https://habrastorage.org/webt/q_/ll/0m/q_ll0msnhoarxu6k5aag0ie2fug.png"><br><br>  Wir geben die erforderlichen Informationen über den Socket an den IMDS-Metadatenhandel weiter.  Um diese Informationen im Mikrovirtual zu erhalten, müssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://169.254.169.254/latest/meta-data</a> mithilfe der REST-API anfordern.  AWS-Benutzer kennen diese magische IP bereits.  Auf die gleiche Weise können Mikrovirtualisten detaillierte Informationen über ihre eigene Konfiguration erhalten. <br><br><h3>  Protokolle </h3><br>  Es ist unerlässlich, Protokolle von Mikrovirtualen in die Außenwelt werfen zu können, bevor sie stirbt.  Dies erfolgt über ein reguläres Unix- <strong>FIFO</strong> . <br><br><img src="https://habrastorage.org/webt/vr/p6/ib/vrp6ibzybyivbp68mi7wt1awobc.png"><br><br><h3>  Zusätzliche Isolierung </h3><br>  Das Hauptplus der virtuellen Maschine für sich.  Es scheint, dass dies ausreichen sollte, aber wir gingen weiter.  Für den Fall, dass in der Produktion gearbeitet werden soll, wird empfohlen, eine zusätzliche Isolationsschicht namens <strong>Jailer aufzubringen</strong> . <br><br><img src="https://habrastorage.org/webt/1o/_2/j6/1o_2j6t6y7_ae7h1cmzk36xqliq.png"><br><br>  Dies sind die üblichen Vorsichtsmaßnahmen: <br><br><ul><li>  <strong>cGruppen</strong> zur Begrenzung von Ressourcen; </li></ul><br><ul><li>  <strong>Namespace</strong> zum Isolieren von Prozessen; </li><li>  <strong>seccomp</strong> - ein Analogon der Firewall für Systemaufrufe; </li><li>  und natürlich jedermanns Lieblings- <strong>Chroot.</strong> </li></ul><br><h2>  Integration mit anderen Diensten </h2><br>  Gibt es fertige Lösungen, die auf Firecracker basieren?  Ja natürlich. <br><br><h3>  OSV </h3><br>  Dieses Betriebssystem ist darauf zugeschnitten, nur eine Anwendung auszuführen.  Aus diesem Grund hat sie die Arbeit mit Speicher und einem Planer sehr einfach organisiert.  Ein leistungsstarkes und einfach zu verwaltendes Betriebssystem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">funktioniert</a> jetzt zusätzlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu Firecracker</a> . <br><br><h3>  Container </h3><br>  Wir haben auch die Integration mit Containerd gemacht.  Wenn Sie bereits mit ihm zusammenarbeiten, müssen Sie mit minimalem Aufwand Container starten, die zur Isolierung in Firecracker verpackt sind. <br><br><img src="https://habrastorage.org/webt/xm/l3/1n/xml31nghhesczi3x2ul1vagz5xw.png"><br><br>  Anstelle der üblichen Unterlegscheibe bezieht sich Containerd auf die Firecracker-Unterlegscheibe.  Es verwaltet runc bereits über einen Agenten, der im Mikrovirtual installiert ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Überprüft, funktioniert</a> . <br><br><h3>  Kata-Container </h3><br>  Als wir Firecracker zum ersten Mal ankündigten, war eine der beliebtesten Kundenfragen: <br><br>  <em>- Der Mechanismus zum Isolieren von Behältern wurde bereits erfunden - dies sind Kata-Behälter.</em>  <em>Warum hast du sie nicht benutzt?</em>  <em>Warum eigene entwickeln?</em> <br>  <em>- Kata arbeitet mit QEMU, aber wir möchten nicht mit QEMU arbeiten.</em>  <em>Deshalb haben wir uns entschlossen, selbst zu kochen.</em> <br><br>  Aber es stellte sich als interessant heraus.  Kata-Entwickler trafen sich mit Firecracker-Entwicklern und stimmten der Integration zu.  Weil jeder dies als großes Plus ansieht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kata Containers v1.5</a> unterstützt bereits QEMU und Firecracker. <br><br>  Es stellt sich heraus, dass wir nicht miteinander konkurrieren, sondern uns harmonisch ergänzen.  In Kubernetes mit Version 1.12 können Sie runtimeClassName als Kata FC oder Kata QEMU definieren und Ihre Container in geeigneter Isolation ausführen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/1-/bn/yt1-bnzwtgnbvhvkkr48gmhsj5o.png" width="500"></div><br><br>  Wie wähle ich die Isolierung aus, die zu Ihrer Anwendung passt - Firecracker oder QEMU?  Meine persönliche Meinung ist, dass es darauf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ankommt, ob es sich bei</a> Ihrer Bewerbung um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Haustiere oder Rinder handelt</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/le/yj/vsleyjeqq1hypjljyr3jcjcpsvc.png" width="300"></div><br><br>  Kata mit QEMU ist eine Lösung für Haustiere.  QEMU ist ein großes, multifunktionales System.  Möglicherweise bietet es mehr Unterstützung und Behandlungsmöglichkeiten für Ihre Lieblingstiere. <br><br>  Kracher ist geeignet, wenn die Ladung Vieh ist.  Für den Fall, dass Ihre zustandslose Anwendung ursprünglich für eine flexible horizontale Skalierung konzipiert wurde und der Ausfall eines oder mehrerer Container nicht kritisch ist.  Durch die zuverlässige Isolierung können Sie schnell die erforderliche Anzahl neuer Container laden, um ausgefallene zu ersetzen. <br><br><h2>  Was ist das Ergebnis? </h2><br>  Wir haben mit Widersprüchen begonnen.  Es scheint, dass die Lösung des Widerspruchs ein „sowohl unser als auch Ihr“ Ansatz ist, etwas dazwischen, das alle zufriedenstellen wird.  Die Erfahrung zeigt jedoch, dass ein Kompromiss nicht erforderlich ist. <br><br>  Wir haben uns zum Ziel gesetzt, eine neue Lösung zu entwickeln, bei der es nichts Überflüssiges gibt, das zur Lösung einer engen Aufgabe nicht erforderlich ist.  Es war auch wichtig, alles, was wir verwenden, so weit wie möglich zu vereinfachen.  Ich würde gerne glauben, dass wir keinen Kompromiss gefunden haben, sondern eine solide Lösung, mit der Sie schnell und dicht Tausende von Mikrovirtualen starten können, ohne ihre Isolation zu beeinträchtigen. <br><br>  Wir verwenden Firecracker bereits bei der Produktion einiger unserer Dienstleistungen.  Das Hauptvorteil, das wir erhalten haben, ist die Verbesserung der Service-Nutzung.  Dadurch konnten erhebliche Einsparungen erzielt werden.  Ein Teil dieser Einsparungen haben wir mit Kunden geteilt.  Beispielsweise fielen nach der Einführung von Firecracker die Preise für serverlose AWS Fargate-Container im Januar 2019 um 35-50%.  Der Nutzen ist mit bloßem Auge sichtbar, daher besteht kein Zweifel daran, dass wir dieses Produkt weiterentwickeln und unsere Best Practices mit Open Source teilen werden.  Die Tatsache, dass Firecracker bereits begonnen hat, sich in andere Lösungen zu integrieren, zeigt ein wachsendes Interesse der Community. <br><br>  Wenn Sie eine Idee oder ein fertiges Produkt haben, in dessen Beschreibung die Wörter „Mandantenisolation“ stehen, ist dies ein klarer Indikator dafür, was Sie mit Firecracker-Mikrovirtuals experimentieren sollten. <br><br><blockquote>  Dieser Bericht veranschaulicht perfekt das Prinzip, an das wir uns bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ontiko-</a> Konferenzen halten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wollen</a> - um weltweite Erfahrungen von russischsprachigen Experten zu erhalten.  Und es geht nicht nur um eine mögliche Sprachbarriere, sondern auch um die Kultur, die wir gewohnt sind, technische Details auszutauschen.  Im November wird Vasily <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wieder</a> bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HighLoad ++</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auftreten.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dazu kommen</a> beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artemy Kolesnikov</a> von Facebook, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vittorio Cioe</a> von Oracle und natürlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Petr Zaitsev</a> von Percona.  Wir werden auch Berichte in englischer Sprache haben, den Newsletter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">abonnieren</a> - wir werden Ihnen mitteilen, wann neue zu den vierzig akzeptierten Berichten hinzugefügt werden. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464305/">https://habr.com/ru/post/de464305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464291/index.html">Die 10 einflussreichsten Programmiersprachen der letzten 50 Jahre und ihre Schöpfer</a></li>
<li><a href="../de464293/index.html">Ersetzen Haken in React Redux?</a></li>
<li><a href="../de464295/index.html">Beispiele für die Verwendung einiger neuer JavaScript-Funktionen</a></li>
<li><a href="../de464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../de464303/index.html">Zeitreihendaten in einem relationalen DBMS. Erweiterungen TimescaleDB und PipelineDB für PostgreSQL</a></li>
<li><a href="../de464307/index.html">Integrationstests von Microservices auf Scala</a></li>
<li><a href="../de464309/index.html">DIY Ruftaste. Raspberry Pi, MajorDoMo, Freeswitch und Linphonec</a></li>
<li><a href="../de464315/index.html">Der Film, in dem es Erde gab. Yandex-Forschung und eine kurze Geschichte der Suche nach Bedeutung</a></li>
<li><a href="../de464317/index.html">Konbanwa-Projekt</a></li>
<li><a href="../de464325/index.html">Wie Scrumban das Beste aus Kanban- und Scrum-Methoden vereint</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>