<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¢ üìÜ üë®üèΩ‚Äçüéì Klein, ja. Unboxing des Firecracker mikrovirtuell üëêüèø üßíüèª üêØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nehmen Sie Firecracker-Mikrovirtuals auf. Wir verwenden zwei beliebte Methoden zum Isolieren von Mehrbenutzer-Workloads - virtuelle Maschinen und Cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Klein, ja. Unboxing des Firecracker mikrovirtuell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/464305/">  Nehmen Sie Firecracker-Mikrovirtuals auf.  Wir verwenden zwei beliebte Methoden zum Isolieren von Mehrbenutzer-Workloads - virtuelle Maschinen und Container.  Wir dr√ºcken das Beste aus beiden Ans√§tzen aus, vereinfachen so viel wie m√∂glich und testen auf einer echten Hochlast.  Als Ergebnis erhalten wir eine undurchdringliche Isolation von virtuellen Computern, die in Hunderten von Millisekunden gestartet werden k√∂nnen.  Diese L√∂sung funktioniert unter der Haube von AWS Lambda und Fargate und f√ºhrt jede Sekunde Millionen von Funktionen und Containern ohne Server in der Cloud aus.  Es hei√üt Kracher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/ps/oo/rmpsoo1w1jptnyp2qwsaestydsq.png" width="400"></div><br><br>  Dieses Mikrovirtualisierungstool ist in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenSource</a> verf√ºgbar.  Wenn Ihre Aufgaben eine Mandantenisolation erfordern (z. B. wenn Sie sich f√ºr die Erstellung einer eigenen Cloud entscheiden), ist Firecracker genau das Richtige f√ºr Sie. <br><br>  <strong>Vasily Pantyukhin</strong> , Architekt von Amazon Web Services, spricht √ºber die Firecracker-Architektur, wie sie von AWS Lambda verwendet wird, vergleicht sie mit alternativen L√∂sungen und gibt Beispiele f√ºr die Integration. <br><br>  <em>Haftungsausschluss: Alles, was unten steht, ist Vasilys pers√∂nliche Meinung und stimmt m√∂glicherweise nicht mit der Position von Amazon Web Services √ºberein.</em> <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cfsICOzt6Do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Nat√ºrliche Merkmale √∂ffentlicher Wolken </h2><br><blockquote>  Eine der grundlegenden Eigenschaften von Public Clouds ist die Mandantenf√§higkeit. </blockquote><br>  Jemand √ºbersetzt diesen Begriff als "Mandantenf√§higkeit" oder "Mehrbenutzerumgebung".  Aus meiner Sicht spiegelt dies jedoch nicht das Wesentliche wider.  Mandantenf√§higkeit ist, wenn verschiedene Benutzer und ihre Lasten in derselben physischen Infrastruktur leben, diese untereinander teilen, aber nichts voneinander wissen.  Bei Mehrbenutzer-Workloads unterscheidet sich die Mandantenf√§higkeit durch grundlegend strengere Anforderungen an die Ressourcenisolierung und den Zugriff auf diese. <br><br><blockquote>  Eine weitere Eigenschaft, die √∂ffentlichen Clouds innewohnt, ist die Hochlast. </blockquote><br>  Glauben Sie mir, im Fall von AWS ist dies eine enorme Belastung!  Der Screenshot ist ein Beispiel f√ºr reale Daten.  Ich werde nicht sagen, wie lange und in welcher Region diese Millionen von "Papageien" gemessen wurden, aber dies ist kein Notfall, sondern die f√ºr uns √ºbliche Betriebsart. <br><br><img src="https://habrastorage.org/webt/up/dt/qs/updtqsp7dmtqk1czi5f2zuscbkq.png"><br><br>  Es stellt sich ein gewisser Widerspruch heraus.  Einerseits m√ºssen wir die Benutzer so isoliert wie m√∂glich halten.  Andererseits m√ºssen wir ein sehr hohes Ma√ü an Produktivit√§t und Ressourcennutzung sicherstellen.  Die Verbesserung des einen f√ºhrt oft zu den Einschr√§nkungen des anderen.  Wie kann man einen Kompromiss finden und noch besser, um an allen Fronten das Maximum zu erreichen? <br><br><h2>  Virtuelle Maschinen oder Container? </h2><br>  Es gibt zwei grundlegende Ans√§tze, die m√∂glicherweise helfen k√∂nnten.  Dies sind virtuelle Maschinen und Container.  Jeder hat seine Vor- und Nachteile. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/hl/ba/djhlbailazcjnfxycokcrv38a64.png" width="400"></div><br><br>  Der Hauptnachteil virtueller Maschinen besteht darin, dass das <strong>Laden lange dauert</strong> .  Normalerweise dauert es einige zehn Sekunden oder sogar Minuten, um die Maschine zu starten.  Aber Virtualoks haben eine Tugend - sie <strong>isolieren</strong> Betonlasten voneinander.  Und aus beiden Blickwinkeln: <br><br><ul><li>  <strong>Sicherheit,</strong> wenn eine virtuelle Maschine nicht auf Daten in einer anderen Maschine zugreifen kann; </li><li>  <strong>Ressourcen</strong> , als ich 8 GB Speicher bestellt habe, hoffe ich, dass dieser RAM mir geh√∂rt und niemand die Ressource beanspruchen kann, f√ºr die ich bezahlt habe. </li></ul><br>  Das Gegenteil ist bei Containern der Fall: Sie sind leicht und <strong>laden</strong> daher <strong>sehr schnell.</strong>  Sie k√∂nnen leicht horizontal skaliert werden.  Es gibt jedoch eine Funktion, mit der wir als √∂ffentlicher Cloud-Anbieter nicht leben k√∂nnen.  Sie verwenden einen <strong>gemeinsam genutzten Kernel - der Betriebssystemkernel wird von allen Containern gemeinsam genutzt</strong> . <br><br><img src="https://habrastorage.org/webt/pa/pz/hm/papzhmvppqzce7pxbezk8bp9owg.png"><br><br>  Kann man sagen, dass Container unsicher sind?  Nein, obwohl es schwerwiegende Sicherheitsl√ºcken gibt. <br><br><blockquote>  Ich glaube, dass ein ordnungsgem√§√ü ‚Äûgeschwei√üter‚Äú Beh√§lter heute ein ausreichendes Ma√ü an Sicherheit bietet. </blockquote><br>  Das Problem ist anders: Ein gemeinsam genutzter Kernel garantiert nicht grunds√§tzlich, dass irgendwann in der Zukunft keine Schwachstellen auftreten, die die Isolation der Mandanten aufheben.  Die √∂ffentliche Cloud kann es sich nicht einmal theoretisch leisten. <br><br>  Es gibt noch einen weiteren Widerspruch, und es muss nach einer L√∂sung gesucht werden.  Der einfachste Weg ist, das Beste von Mama - einer virtuellen Maschine - und von Papa - einem Container - zu nehmen, zu kreuzen und etwas <strong>Konvergentes zu bekommen</strong> .  Eigentlich haben wir es geschafft.  Es stellte sich heraus, Kracher. <br><br>  Kracher ist bereits in Produktion.  In der gleichen Menge kritischer Dienste, zum Beispiel AWS Lambda (Serverless-Funktionen) und AWS Fargate (Serverless-Container). <br><br><h3>  Probleme des alten AWS Lambda </h3><br>  AWS Lambda ist ein Serverless Feature Service.  Wir √ºbernehmen die Funktion in Java, Go, Python oder einer anderen Sprache, wir werfen sie in Lambda und sie wird magisch ausgef√ºhrt.  Es ist nicht erforderlich, Ressourcen zuzuweisen und zu verwalten.  Wie wurde das vorher umgesetzt? <br><br><img src="https://habrastorage.org/webt/ou/ck/-s/ouck-sm6pjv4ul6t13dwlefxtry.png"><br><br>  F√ºr jedes AWS-Konto wurden eine oder mehrere separate virtuelle EC2-Maschinen zugewiesen, um Funktionen zu isolieren, die verschiedenen Mandanten geh√∂ren.  Eine solche virtuelle Maschine verbraucht Ressourcen, selbst wenn sie nichts tut.  Angenommen, wir f√ºhren eine Funktion alle 10 Minuten einmal aus und sie wird in 200 ms wie ein normaler Lambda ausgef√ºhrt.  Es stellt sich heraus, dass die EC2-Maschine innerhalb einer Stunde nur wenige Sekunden benutzt wird.  Dar√ºber hinaus verbraucht es auch zur Laufzeit nicht alle verf√ºgbaren Ressourcen - Entsorgung unterhalb der Fu√üleiste.  Das ist w√ºtend unrentabel. <br><br><img src="https://habrastorage.org/webt/jy/lo/0q/jylo0qlzudppsa5042qv858mfya.png"><br><br><h3>  Wie haben Sie das Recyclingproblem gel√∂st? </h3><br>  Entwickelte von Grund auf ihre eigene Firecracker-L√∂sung.  Dies geht aus dem Titel des Berichts hervor :) <br><br>  Um mit der Entwicklung eines neuen Produkts zu beginnen, ben√∂tigen Sie eine technische Aufgabe.  Es enth√§lt viel Text, aber wenn Sie nur die Bedeutung ausw√§hlen, erhalten Sie Folgendes. <br><br><ul><li>  <strong>Unterst√ºtzt von KVM</strong> als Hypervisor.  Wer mit AWS arbeitet, wei√ü, dass wir zwei Lieblingshypervisoren haben.  Legacy-VMs werden unter Xen ausgef√ºhrt.  Seit Ende 2017 lebt KVM unter der Haube aller Autos. </li><li>  <strong>Es beginnt so schnell wie m√∂glich.</strong>  Auf der Referenzhardware war die Anforderung eine volle Auslastung des Mikrovirtuals in 125 ms. </li><li>  <strong>Minimaler Virtualisierungsaufwand</strong> .  In der Referenzarchitektur verbraucht eine einzelne mikro-virtuelle Firecracker-Maschine zus√§tzlich nur 5 MB Speicher. </li><li>  <strong>Die M√∂glichkeit des dichtesten Starts</strong> .  Designparameter - volle Last von 5 Mikrovirtualen pro Kern pro Sekunde.  Diese Anforderung ist f√ºr Dienste wie AWS Lambda von grundlegender Bedeutung.  Funktionen m√ºssen schnell abheben, trainieren und sterben, um Ressourcen f√ºr die n√§chsten freizugeben. </li><li>  <strong>Die M√∂glichkeit einer erneuten Anmeldung</strong> .  Es ist eine Gelegenheit - es ist nicht notwendig, sie zu nutzen.  Tats√§chlich ist dies die Zuweisung virtueller Ressourcen in gr√∂√üerem Umfang, als sie physisch verf√ºgbar sind.  Dies bedeutet, dass der Server √ºber 16 GB RAM verf√ºgt und Sie gleichzeitig 4 virtuelle Maschinen ausf√ºhren, von denen jede sicher ist, dass er √ºber 8 GB Arbeitsspeicher verf√ºgt. </li></ul><br><h3>  AWS Lambda mit Kracher unter der Haube </h3><br>  Was hat sich in der neuen Version von AWS Lambda ge√§ndert?  Aus Sicht des Endbenutzers hat sich nichts ge√§ndert.  Die Migration zu einer aktualisierten Architektur in der Produktion war vollst√§ndig transparent und f√ºr die Verbraucher unsichtbar.  Lambda-Funktionen sind von kurzer Dauer - das war einfach. <br><br>  Wie sieht moderne Architektur aus? <br><br><blockquote>  Auf der untersten Ebene befindet sich jetzt keine virtuelle Maschine, sondern ein physisches Bare-Metal. </blockquote><br>  Solche Server erm√∂glichen die vollst√§ndige Nutzung aller Funktionen der CPU, beispielsweise Intel VT.  Dies bietet zus√§tzliche Vorteile bei Verwendung der Virtualisierung auf h√∂heren Ebenen. <br><br><img src="https://habrastorage.org/webt/rg/i6/s3/rgi6s36v7vgfuc2onnb-cuahbui.png"><br><br>  Auf dem St√ºck Eisen befindet sich das <strong>Host-Betriebssystem</strong> mit dem KVM-Modul im Kernel.  <strong>Firecracker-</strong> Mikrovirtuals mit eigenen <strong>Gastbetriebssystemen</strong> werden oben gestartet.  Nun, sie haben bereits Komponenten des AWS Lambda-Service selbst implementiert. <br><br>  Bisher haben wir f√ºr jeden Kunden, der die Lambda-Funktionen verwendet, separate virtuelle EC2-Maschinen mit geringer Auslastung zugewiesen.  Mit dem neuen Ansatz k√∂nnen Sie ein leichtes Mikrovirtual nur dann ausf√ºhren, wenn Sie es wirklich ben√∂tigen.  Durch das Isolieren von Firecracker-Ressourcen voneinander k√∂nnen wir dies auf einer gemeinsamen Hardware mit maximaler Dichte tun.  Die Ressourcennutzung hat sich grundlegend verbessert. <br><br><h2>  Was ist in der Box? </h2><br>  Ich habe Anboxing versprochen, also gehen wir die Hauptkomponenten von Firecracker durch, betrachten sie einzeln und setzen dann alles zusammen. <br><br><img src="https://habrastorage.org/webt/o_/by/mq/o_bymqjtw5d6aomlwpmfa7grqgk.jpeg"><br><br><h3>  Gestaltungsprinzipien </h3><br>  Als wir zum ersten Mal √ºber die Entwicklung von Firecracker diskutierten, waren wir uns einig, zwei Prinzipien einzuhalten. <br><br>  <strong>Alles Unn√∂tige loswerden.</strong>  Warum wurden klassische virtuelle Maschinen langsam geladen?  Insbesondere, weil der Code √ºberladen ist.  Sie m√ºssen eine Vielzahl von Legacy-Ger√§ten unterst√ºtzen.  Aber warum ein Ger√§t emulieren, das vor 10 Jahren noch niemand benutzt hat?  Es besteht keine Notwendigkeit, deshalb werden wir alles √ºberfl√ºssige los.  Wir l√∂sen eine bestimmte enge Aufgabe, und alle Funktionen, die zur L√∂sung dieses Problems nicht beitragen, werden als unn√∂tig angesehen. <br><br><blockquote>  Befreien Sie sich von allem √úberfl√ºssigen und konzentrieren Sie sich auf eine Aufgabe. </blockquote><br>  <strong>Vereinfachen Sie, was noch √ºbrig ist.</strong>  Auch was √ºbrig bleibt, sollte so einfach wie m√∂glich sein. <br><br><h3>  Wor√ºber haben sie geschrieben? </h3><br>  Firecracker ist in trendigem Rust geschrieben, weil: <br><br><ul><li>  Sie k√∂nnen damit <strong>sichereren Code</strong> schreiben, insbesondere in Bezug auf den Speicher. </li><li>  <strong>Leistung</strong> und Overhead sind vergleichbar mit modernem C ++; </li><li>  Rust wird <strong>seit langem verwendet und hat</strong> seit 2015 viele coole Hochlastl√∂sungen geschrieben. </li></ul><br><h3>  Eisen </h3><br>  Ich wiederhole - Firecracker erfordert die Installation auf echter Hardware.  Als Referenzkonfiguration wurde die Bare-Metal-Maschine i3.metal gew√§hlt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rg/to/nh/rgtonh5b1jbhgpzizky2wc6bsfk.png" width="400"></div><br>  <em>Hinweis: Der Bericht wurde Anfang April 2019 erstellt. Zu diesem Zeitpunkt wurde nur die Intel-Plattform unterst√ºtzt.</em>  <em>Im Mai wurde die Alpha-Unterst√ºtzung f√ºr AMD und im Juni f√ºr ARM hinzugef√ºgt.</em>  <em>AMD ist m√∂glicherweise etwas billiger als Intel, und der ARM-Support bietet interessante M√∂glichkeiten f√ºr die Arbeit mit IoT mit mehreren Mandanten.</em> <br><br>  Wenn Sie eine i3.metal- oder andere Bare-Metal-Maschine in AWS bestellen, ist diese f√ºr Experimente zu leistungsf√§hig und zu teuer.  Wenn Sie sich entscheiden, Firecracker darauf zu installieren, vergessen Sie daher nicht, diese Maschinen nach den Experimenten auszuzahlen.  Andernfalls wird am Ende des Monats eine anst√§ndige Punktzahl erzielt. <br><br>  Gibt es eine g√ºnstigere Option?  Ja, Sie k√∂nnen Firecracker in einer virtuellen Umgebung starten.  Aber nicht mehr in AWS - wir unterst√ºtzen verschachtelte Virtualisierung auf EC2 grunds√§tzlich nicht.  Sie k√∂nnen dies jedoch in GCP, Azure, DigitalOcean oder mit Proxmox, Parallels und VMware Fusion tun.  Alles funktioniert, wenn Sie die Anforderungen einhalten, insbesondere entsprechend der Kernel-Version des Gastbetriebssystems. <br><br><h3>  Der Kern </h3><br><blockquote>  Das grundlegende Element der L√∂sung ist das KVM-Kernelmodul. </blockquote><br>  Nur f√ºr den Fall, ich werde als Exkurs beschreiben, was KVM ist.  Dies ist nicht der gesamte Hypervisor, sondern nur ein Teil davon.  Die Hauptaufgaben bestehen darin <strong>, einen virtuellen Prozessor</strong> (vCPU) <strong>einzurichten</strong> und <strong>eine virtuelle Maschine zu starten</strong> . <br><br><img src="https://habrastorage.org/webt/gp/3l/ee/gp3leep27-zq3yzx9fiiho15pkm.png"><br><br>  F√ºr eine vollwertige Arbeit reicht dies jedoch nicht aus.  Neben dem Prozessor werden einige andere Ger√§te ben√∂tigt.  Ihre Emulation erfolgt im User Space. <br><br><h3>  VMM </h3><br>  Damit mindestens grundlegende Ger√§te angezeigt werden, ben√∂tigen Sie eine andere Komponente - Virtual Machine Manager (VMM).  Vor Firecracker war QEMU die prim√§re VMM-Option. <br><br><img src="https://habrastorage.org/webt/kg/s8/kr/kgs8krmluije10ql6x6vtch7f9g.png"><br><br>  Wir haben ernsthaft √ºber die M√∂glichkeit nachgedacht, QEMU zu verwenden, aber beschlossen, unser eigenes ‚ÄûFahrrad‚Äú zu entwickeln.  Daf√ºr gab es mehrere Gr√ºnde. <br><br>  <strong>Entwicklungsmanagement</strong> .  QEMU ist ein gro√ües, ausgereiftes Produkt mit √ºber einer Million Codezeilen.  Um √Ñnderungen vorzunehmen, m√ºssen Sie zu viele Quellcodes anzeigen.  Viele Menschen beteiligen sich an der Entwicklung und Entscheidungsfindung bei der Entwicklung. <br><br>  <strong>Sicherheit</strong>  QEMU kann viele Ger√§te emulieren.  Deshalb hat es eine ziemlich gro√üe Angriffsfl√§che.  Unsere Aufgabe ist es, ein Mikrovirtual zu machen.  Aus Sicherheitsgr√ºnden m√ºssen wir die Angriffsfl√§che minimieren. <br><br>  <strong>Die Notwendigkeit, neue Funktionen zu implementieren.</strong>  QEMU hat guten Code.  Dies ist ein ausgereiftes Produkt, in dem alle offensichtlichen Fehler bereits erkannt wurden.  In der jetzigen Form passte die QEMU-Funktionalit√§t jedoch immer noch nicht zu uns - wir m√ºssten viel hinzuf√ºgen.  Unter diesem Gesichtspunkt h√§tte der neue Code in QEMU und im neuen Produkt die gleiche Qualit√§t.  Daher w√ºrde ein besonderer Gewinn nicht funktionieren. <br><br><h3>  Ger√§te </h3><br>  Firecracker implementiert VMM, mit dem Ger√§te emuliert werden.  Wir emulieren folgende Ger√§te: <br><br><ul><li>  <strong>Konsole</strong>  Eine n√ºtzliche und notwendige Sache, obwohl sie ausgeschaltet werden kann. </li><li>  <strong>Tastatur</strong>  Wir haben eine knifflige Tastatur erstellt - mit nur einer "Reset" -Taste.  Wir vertrauen einfach nicht der Software "Reset" der Betriebssysteme, die m√∂glicherweise in Firecracker ausgef√ºhrt werden k√∂nnten.  Deshalb machten sie Eisen. </li><li>  <strong>Virtio-Treiber f√ºr Festplatte und Netzwerk</strong> .  Virtio ist ein sehr primitives Ger√§t.  Im Wesentlichen ist dies ein "Ringpuffer".  Das Gastsystem hat etwas in den Puffer geschrieben, auf den Aufruf geklickt und das Hostsystem hat die Daten aus diesem Puffer durch eine Datei gelesen. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/av/hw/pvavhwc_g42zvrjrg7ftiqmcfda.png" width="500"></div><br><br>  In einigen F√§llen, zum Beispiel f√ºr die Integration in Container, ben√∂tigen wir noch ein Netzwerkger√§t, das die Grundfunktionalit√§t einer normalen Netzwerkkarte darstellt.  Virtio passt hier nicht, zu einfach.  Daher verwenden wir f√ºr das Netzwerk ein anderes Ger√§t - <strong>Vsock</strong> . <br><br>  Nun, wir brauchen auch die F√§higkeit, den Ressourcenverbrauch zu kontrollieren.  Der <strong>Ratenbegrenzer</strong> ist daf√ºr verantwortlich. <br><br>  Es gibt Ger√§te.  Aber wie werden Mikrovirtuale verwaltet und konfiguriert?  Die Management-API hilft uns hier. <br><br><h3>  Management </h3><br>  Amazon hat mehrere unzerbrechliche Grundprinzipien.  Einer davon ist, dass alle Dienste nur √ºber die API miteinander kommunizieren.  Es spielt keine Rolle, ob es sich um externe Dienste handelt, die Sie als Benutzer verwenden, oder um unsere internen Dienste.  Es kommt nicht vor, dass ein Dienst direkt in die Datenbank eines anderen Dienstes geht - es ist verboten und strafbar.  Der Firecracker-API-Thread wird nur verwendet, um √ºber die REST-API auf die Einstellungen und Funktionen von Mikrovirtualen zuzugreifen. <br><br><img src="https://habrastorage.org/webt/1s/qj/bt/1sqjbtijgutp6qfwscgu_vnq1va.png"><br><br>  Wir halten uns an die Open API-Spezifikation, sodass Sie Swagger verwenden k√∂nnen. <br><br><h3>  Metadaten </h3><br>  Es gibt so eine b√∂se - harte Kodierung.  In diesem Fall werden einige Daten direkt in den Code eingen√§ht, z. B. das Login und das Kennwort f√ºr den Zugriff auf eine andere Ressource.  Dies ist nat√ºrlich nicht zul√§ssig.  In regelm√§√üigen Abst√§nden m√ºssen wir einige Daten innerhalb des Mikrovirtuals √ºbertragen.  Dies erfolgt √ºber den <strong>Metadatendienst</strong> . <br><br><img src="https://habrastorage.org/webt/q_/ll/0m/q_ll0msnhoarxu6k5aag0ie2fug.png"><br><br>  Wir geben die erforderlichen Informationen √ºber den Socket an den IMDS-Metadatenhandel weiter.  Um diese Informationen im Mikrovirtual zu erhalten, m√ºssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://169.254.169.254/latest/meta-data</a> mithilfe der REST-API anfordern.  AWS-Benutzer kennen diese magische IP bereits.  Auf die gleiche Weise k√∂nnen Mikrovirtualisten detaillierte Informationen √ºber ihre eigene Konfiguration erhalten. <br><br><h3>  Protokolle </h3><br>  Es ist unerl√§sslich, Protokolle von Mikrovirtualen in die Au√üenwelt werfen zu k√∂nnen, bevor sie stirbt.  Dies erfolgt √ºber ein regul√§res Unix- <strong>FIFO</strong> . <br><br><img src="https://habrastorage.org/webt/vr/p6/ib/vrp6ibzybyivbp68mi7wt1awobc.png"><br><br><h3>  Zus√§tzliche Isolierung </h3><br>  Das Hauptplus der virtuellen Maschine f√ºr sich.  Es scheint, dass dies ausreichen sollte, aber wir gingen weiter.  F√ºr den Fall, dass in der Produktion gearbeitet werden soll, wird empfohlen, eine zus√§tzliche Isolationsschicht namens <strong>Jailer aufzubringen</strong> . <br><br><img src="https://habrastorage.org/webt/1o/_2/j6/1o_2j6t6y7_ae7h1cmzk36xqliq.png"><br><br>  Dies sind die √ºblichen Vorsichtsma√ünahmen: <br><br><ul><li>  <strong>cGruppen</strong> zur Begrenzung von Ressourcen; </li></ul><br><ul><li>  <strong>Namespace</strong> zum Isolieren von Prozessen; </li><li>  <strong>seccomp</strong> - ein Analogon der Firewall f√ºr Systemaufrufe; </li><li>  und nat√ºrlich jedermanns Lieblings- <strong>Chroot.</strong> </li></ul><br><h2>  Integration mit anderen Diensten </h2><br>  Gibt es fertige L√∂sungen, die auf Firecracker basieren?  Ja nat√ºrlich. <br><br><h3>  OSV </h3><br>  Dieses Betriebssystem ist darauf zugeschnitten, nur eine Anwendung auszuf√ºhren.  Aus diesem Grund hat sie die Arbeit mit Speicher und einem Planer sehr einfach organisiert.  Ein leistungsstarkes und einfach zu verwaltendes Betriebssystem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">funktioniert</a> jetzt zus√§tzlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu Firecracker</a> . <br><br><h3>  Container </h3><br>  Wir haben auch die Integration mit Containerd gemacht.  Wenn Sie bereits mit ihm zusammenarbeiten, m√ºssen Sie mit minimalem Aufwand Container starten, die zur Isolierung in Firecracker verpackt sind. <br><br><img src="https://habrastorage.org/webt/xm/l3/1n/xml31nghhesczi3x2ul1vagz5xw.png"><br><br>  Anstelle der √ºblichen Unterlegscheibe bezieht sich Containerd auf die Firecracker-Unterlegscheibe.  Es verwaltet runc bereits √ºber einen Agenten, der im Mikrovirtual installiert ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úberpr√ºft, funktioniert</a> . <br><br><h3>  Kata-Container </h3><br>  Als wir Firecracker zum ersten Mal ank√ºndigten, war eine der beliebtesten Kundenfragen: <br><br>  <em>- Der Mechanismus zum Isolieren von Beh√§ltern wurde bereits erfunden - dies sind Kata-Beh√§lter.</em>  <em>Warum hast du sie nicht benutzt?</em>  <em>Warum eigene entwickeln?</em> <br>  <em>- Kata arbeitet mit QEMU, aber wir m√∂chten nicht mit QEMU arbeiten.</em>  <em>Deshalb haben wir uns entschlossen, selbst zu kochen.</em> <br><br>  Aber es stellte sich als interessant heraus.  Kata-Entwickler trafen sich mit Firecracker-Entwicklern und stimmten der Integration zu.  Weil jeder dies als gro√ües Plus ansieht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kata Containers v1.5</a> unterst√ºtzt bereits QEMU und Firecracker. <br><br>  Es stellt sich heraus, dass wir nicht miteinander konkurrieren, sondern uns harmonisch erg√§nzen.  In Kubernetes mit Version 1.12 k√∂nnen Sie runtimeClassName als Kata FC oder Kata QEMU definieren und Ihre Container in geeigneter Isolation ausf√ºhren. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/1-/bn/yt1-bnzwtgnbvhvkkr48gmhsj5o.png" width="500"></div><br><br>  Wie w√§hle ich die Isolierung aus, die zu Ihrer Anwendung passt - Firecracker oder QEMU?  Meine pers√∂nliche Meinung ist, dass es darauf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ankommt, ob es sich bei</a> Ihrer Bewerbung um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Haustiere oder Rinder handelt</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/le/yj/vsleyjeqq1hypjljyr3jcjcpsvc.png" width="300"></div><br><br>  Kata mit QEMU ist eine L√∂sung f√ºr Haustiere.  QEMU ist ein gro√ües, multifunktionales System.  M√∂glicherweise bietet es mehr Unterst√ºtzung und Behandlungsm√∂glichkeiten f√ºr Ihre Lieblingstiere. <br><br>  Kracher ist geeignet, wenn die Ladung Vieh ist.  F√ºr den Fall, dass Ihre zustandslose Anwendung urspr√ºnglich f√ºr eine flexible horizontale Skalierung konzipiert wurde und der Ausfall eines oder mehrerer Container nicht kritisch ist.  Durch die zuverl√§ssige Isolierung k√∂nnen Sie schnell die erforderliche Anzahl neuer Container laden, um ausgefallene zu ersetzen. <br><br><h2>  Was ist das Ergebnis? </h2><br>  Wir haben mit Widerspr√ºchen begonnen.  Es scheint, dass die L√∂sung des Widerspruchs ein ‚Äûsowohl unser als auch Ihr‚Äú Ansatz ist, etwas dazwischen, das alle zufriedenstellen wird.  Die Erfahrung zeigt jedoch, dass ein Kompromiss nicht erforderlich ist. <br><br>  Wir haben uns zum Ziel gesetzt, eine neue L√∂sung zu entwickeln, bei der es nichts √úberfl√ºssiges gibt, das zur L√∂sung einer engen Aufgabe nicht erforderlich ist.  Es war auch wichtig, alles, was wir verwenden, so weit wie m√∂glich zu vereinfachen.  Ich w√ºrde gerne glauben, dass wir keinen Kompromiss gefunden haben, sondern eine solide L√∂sung, mit der Sie schnell und dicht Tausende von Mikrovirtualen starten k√∂nnen, ohne ihre Isolation zu beeintr√§chtigen. <br><br>  Wir verwenden Firecracker bereits bei der Produktion einiger unserer Dienstleistungen.  Das Hauptvorteil, das wir erhalten haben, ist die Verbesserung der Service-Nutzung.  Dadurch konnten erhebliche Einsparungen erzielt werden.  Ein Teil dieser Einsparungen haben wir mit Kunden geteilt.  Beispielsweise fielen nach der Einf√ºhrung von Firecracker die Preise f√ºr serverlose AWS Fargate-Container im Januar 2019 um 35-50%.  Der Nutzen ist mit blo√üem Auge sichtbar, daher besteht kein Zweifel daran, dass wir dieses Produkt weiterentwickeln und unsere Best Practices mit Open Source teilen werden.  Die Tatsache, dass Firecracker bereits begonnen hat, sich in andere L√∂sungen zu integrieren, zeigt ein wachsendes Interesse der Community. <br><br>  Wenn Sie eine Idee oder ein fertiges Produkt haben, in dessen Beschreibung die W√∂rter ‚ÄûMandantenisolation‚Äú stehen, ist dies ein klarer Indikator daf√ºr, was Sie mit Firecracker-Mikrovirtuals experimentieren sollten. <br><br><blockquote>  Dieser Bericht veranschaulicht perfekt das Prinzip, an das wir uns bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ontiko-</a> Konferenzen halten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wollen</a> - um weltweite Erfahrungen von russischsprachigen Experten zu erhalten.  Und es geht nicht nur um eine m√∂gliche Sprachbarriere, sondern auch um die Kultur, die wir gewohnt sind, technische Details auszutauschen.  Im November wird Vasily <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wieder</a> bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HighLoad ++</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auftreten.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dazu kommen</a> beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artemy Kolesnikov</a> von Facebook, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vittorio Cioe</a> von Oracle und nat√ºrlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Petr Zaitsev</a> von Percona.  Wir werden auch Berichte in englischer Sprache haben, den Newsletter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">abonnieren</a> - wir werden Ihnen mitteilen, wann neue zu den vierzig akzeptierten Berichten hinzugef√ºgt werden. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464305/">https://habr.com/ru/post/de464305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464291/index.html">Die 10 einflussreichsten Programmiersprachen der letzten 50 Jahre und ihre Sch√∂pfer</a></li>
<li><a href="../de464293/index.html">Ersetzen Haken in React Redux?</a></li>
<li><a href="../de464295/index.html">Beispiele f√ºr die Verwendung einiger neuer JavaScript-Funktionen</a></li>
<li><a href="../de464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../de464303/index.html">Zeitreihendaten in einem relationalen DBMS. Erweiterungen TimescaleDB und PipelineDB f√ºr PostgreSQL</a></li>
<li><a href="../de464307/index.html">Integrationstests von Microservices auf Scala</a></li>
<li><a href="../de464309/index.html">DIY Ruftaste. Raspberry Pi, MajorDoMo, Freeswitch und Linphonec</a></li>
<li><a href="../de464315/index.html">Der Film, in dem es Erde gab. Yandex-Forschung und eine kurze Geschichte der Suche nach Bedeutung</a></li>
<li><a href="../de464317/index.html">Konbanwa-Projekt</a></li>
<li><a href="../de464325/index.html">Wie Scrumban das Beste aus Kanban- und Scrum-Methoden vereint</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>