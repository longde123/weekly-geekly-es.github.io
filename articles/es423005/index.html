<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåø üïµüèª ‚úãüèæ C√≥mo Yandex.Zen, el complemento de almacenamiento en cach√© de WordPress y el alojamiento aumentaron mi presi√≥n ü•Ö ‚úãüèº üëΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es, m√°s bien, de una serie de "notas de anfitriona". Bueno, un poco m√°s sobre experiencias personales y gubias. 

 Si tiene que lidiar c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo Yandex.Zen, el complemento de almacenamiento en cach√© de WordPress y el alojamiento aumentaron mi presi√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423005/"><img src="https://habrastorage.org/webt/12/3o/cf/123ocfvpows898t7vrwuhhveguo.jpeg" alt="imagen" width="100%"><br><br>  Este art√≠culo es, m√°s bien, de una serie de "notas de anfitriona".  Bueno, un poco m√°s sobre experiencias personales y gubias. <br><br>  Si tiene que lidiar con sitios de WordPress que tienen instalado el complemento de almacenamiento en cach√© de WP Super Cache, entonces el art√≠culo puede serle √∫til.  De lo contrario, esto es solo una historia corta. <br><a name="habracut"></a><br>  En resumen, el comienzo de la historia es esta: hab√≠a un sitio.  Noticias e informaci√≥n tem√°ticas.  Hecho por un asistente desconocido en CMS WordPress.  Y hecho exactamente como estaba permitido en ese momento por los medios de su due√±o.  Con el tiempo, el sitio gan√≥ popularidad, el n√∫mero de visitantes creci√≥.  El sitio en s√≠ "gan√≥" en publicidad.  Es decir  Cuantos m√°s visitantes, mejor.  En alg√∫n momento, durante las cargas m√°ximas, el sitio comenz√≥ a aparecer: las p√°ginas se cargaban lentamente y todo eso.  Pero, por supuesto, hasta que la polla picote√≥, nadie realmente se movi√≥.  El gallo apareci√≥ en el momento en que se supon√≠a que el sitio cubr√≠a alg√∫n evento que atrajo la atenci√≥n del p√∫blico.  Los visitantes entraron corriendo, el sitio se cay√≥ y todos los ingresos estimados se derritieron ante nuestros ojos.  Debido a las circunstancias, tuve que actuar como resucitador.  Escrib√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo</a> sobre esto entonces.  Mi decisi√≥n fue espeluznante (no repita), pero el objetivo principal se cumpli√≥: los sue√±os se salvaron.  Mayormente <br><br>  Por supuesto, nadie estaba interesado en repetir una situaci√≥n similar y trabaj√≥ en el sitio.  En primer lugar, descubrieron las razones de la ca√≠da y la alta carga en el servidor.  Eran comunes: la falta de un sitio de almacenamiento en cach√© como tal y un mecanismo mal implementado para registrar y mostrar el n√∫mero de vistas de art√≠culos.  Este √∫ltimo cre√≥ una carga decente: con cada solicitud de la p√°gina del art√≠culo, tomaba de la base de datos el n√∫mero de visitas de este art√≠culo, lo mostraba y luego agregaba uno y lo volv√≠a a escribir en la base de datos.  Al mismo tiempo, la tabla <b>wp_postmeta</b> con metadatos se us√≥ para el almacenamiento (como parece llamarse en WP).  En el que la masa se almacenaba completamente irrelevante para las vistas contables de la informaci√≥n y que era muy grande. <br><br>  El problema de almacenamiento en cach√© se resolvi√≥ simplemente: en un entorno silencioso, el complemento WP Super Cache se instal√≥ normalmente.  Lo que, si recuerdo bien, me aconsej√≥ que hiciera en lugar de la misteriosa muleta que constru√≠ en los comentarios sobre ese art√≠culo m√≠o.  Honestamente, entonces y ahora navegaba mal en el ecosistema de WordPress y, por lo tanto, apareci√≥ esa muleta.  El complemento de almacenamiento en cach√© se instal√≥ y configur√≥ por personas que ya conoc√≠an, y se levant√≥ de inmediato.  Por lo tanto, se resolvi√≥ el problema de almacenamiento en cach√©.  Por qu√© se eligi√≥ este complemento, no estoy seguro.  Seg√∫n tengo entendido, este es uno de los complementos m√°s populares de este tipo para WP. <br><br>  Dadas las opiniones, actuaron de manera algo diferente.  Est√° claro que el mecanismo original tuvo que ser abandonado.  No quer√≠a negarme a tener en cuenta las opiniones en s√≠ mismas: al menos un bloque que mostraba "los art√≠culos m√°s populares de la semana" estaba vinculado a √©l.  Todos los complementos para grabar vistas, incluso si eran "amigos" con el complemento de almacenamiento en cach√©, resultaron ser muy voraces y, con mayor frecuencia, implementaron el mismo mecanismo para escribir y extraer datos de wp_postmeta.  Para un sitio peque√±o, esto es bastante adecuado.  Para un sitio con tasas m√°ximas de asistencia bastante s√≥lidas, ya no: demasiado glot√≥n para una funci√≥n tan peque√±a.  Luego, por cierto, present√© hosting pagado y no utilizado en los a√±os venideros.  La m√°s f√°cil y barata.  Las responsabilidades de almacenar, registrar y devolver datos sobre las vistas fueron acumuladas en √©l.  Todo es as√≠ncrono, es decir.  incluso si cae, el sitio principal continuar√° mostrando silenciosamente art√≠culos, anuncios y todo lo que deber√≠a mostrar.  El almacenamiento en l√≠nea de los datos de visualizaci√≥n se asign√≥ a Redis y el almacenamiento a largo plazo a MySQL.  Por lo tanto, est√° girando, realmente no pregunta, y consume 1-2% de la carga m√°xima permitida en ese alojamiento. <br><br>  Y as√≠, pasa mucho tiempo.  Una y otra vez una vieja historia.  Un tr√°fico bastante potente va al sitio y el sitio comienza a caer.  Y nuevamente, soy el √∫nico especialista condicional despierto en el √°rea.  Por supuesto, estoy sorprendido por la repetici√≥n de eventos.  Mi primer pensamiento es que alguien apag√≥ accidentalmente el almacenamiento en cach√©.  Pero no, en el c√≥digo fuente de la p√°gina del sitio que me da el servidor que cae, veo signos de que funciona un complemento de almacenamiento en cach√©.  Todo deber√≠a estar bien.  Pero en el panel de control del servidor, veo que no queda RAM, la cantidad de consultas a la base de datos es incre√≠ble y todo est√° mal.  En primer lugar, abro la p√°gina con la descripci√≥n del complemento, r√°pidamente paso por sus ojos, no encuentro nada y dejo esta actividad.  El siguiente paso es ver las estad√≠sticas.  Veo que el flujo de tr√°fico principal est√° llegando al sitio desde Yandex.Zen.  Y la solicitud que lleva al usuario al sitio se ve as√≠: <br><br><blockquote>  https://example.com <b>? utm_referrer = https:% 2F% 2Fzen.yandex.com</b> </blockquote><br>  Es decir  Yandex.Zen agrega su etiqueta utm a la direcci√≥n.  Dado que el servidor ya est√° completamente acostado y me da solo 500, por alguna raz√≥n no puedo verificar claramente la teor√≠a de que las p√°ginas con tal "ponderaci√≥n" no est√©n en cach√©.  Por lo tanto, nace otra "muleta" (se reemplaz√≥ posteriormente): se agrega una redirecci√≥n a .htaccess, que convierte la solicitud con etiquetas utm en una solicitud sin ellas antes de que WordPress y todos sus complementos potentes entren en juego.  La m√°quina se reinicia y, voila, todo funciona: el sitio se carga r√°pidamente, el servidor se mueve silenciosamente a bajas velocidades.  Como no pas√≥ nada. <br><br>  Luego me relaj√© y sub√≠ tranquilamente mirando la configuraci√≥n del plugin de almacenamiento en cach√©.  En primer lugar, la casilla de verificaci√≥n "No almacenar en cach√© las p√°ginas con par√°metros GET", que est√° all√≠.  Todo est√° bien, ella no lo vale.  Adem√°s, como lo mostr√≥ el experimento, el complemento hace frente al almacenamiento en cach√© de consultas con cualquier conjunto de par√°metros arbitrarios.  Si no se trata de etiquetas utm (de hecho, solo redirig√≠ las solicitudes de cierto tipo y no cort√© todas las etiquetas utm). <br><br>  Aqu√≠ cuidadosamente (usando CTRL + F) mir√© la p√°gina del complemento.  Y encontr√© all√≠ en las preguntas frecuentes el glorioso p√°rrafo "¬øC√≥mo debo usar mejor las herramientas de seguimiento utm_source en Google Analytics con este complemento?".  Est√° claro que durante el primer examen superficial, lo ignor√© con seguridad: parece que no hay nada que ver con el problema.  Al mismo tiempo, por cierto, no es tan informativo y no ofrece ninguna soluci√≥n espec√≠fica. <br><br>  <b>La √∫nica conclusi√≥n √∫til posible en el art√≠culo:</b> si tiene un sitio WP con el complemento WP Super Cache, compruebe lo que hace (o no), si env√≠a una solicitud con los par√°metros ‚Äú? Utm_referrer = https:% 2F% 2Fzen. yandex.com ", etc.  No estoy seguro de que al instalar este complemento, todos lean sus preguntas frecuentes con tanto cuidado.  La implementaci√≥n espec√≠fica, aparentemente, permanece con los propietarios del sitio: cuando vi por √∫ltima vez la actualizaci√≥n de este complemento, no vi ning√∫n cambio con respecto a su extra√±a reacci√≥n a las etiquetas utm. <br><br>  Pero la historia habr√≠a sido incompleta (y no lo habr√≠a contado) si no hubiera habido otra confirmaci√≥n de la ley de Murphy.  Mientras mantuvimos correspondencia tranquila con el propietario del sitio y vimos c√≥mo el sitio funcion√≥ en silencio durante aproximadamente una hora ... el sitio cay√≥.  Inesperadamente y finalmente.  No hay acceso al panel de control del servidor, FTP, SSH y todo lo dem√°s no funciona.  Nada funciona  Si antes de eso, mi presi√≥n aument√≥ ligeramente al resolver el problema que vomitaron J. Zen y el plugin de almacenamiento en cach√© (despu√©s de todo, es un placer especial comprender r√°pidamente y solucionar algo sin problemas), entonces me ocurri√≥ un ataque de mini-p√°nico.  Y solo la vaga sensaci√≥n de que un par de l√≠neas en .htaccess no puede matar todo una hora despu√©s de hacer estas l√≠neas no permiti√≥ que el "mini" se convirtiera en algo m√°s completo.  En general, despu√©s de un par de minutos de intercambiar mensajes sorprendidos, ingresamos a la cuenta personal del proveedor de alojamiento donde vive el servidor.  Y all√≠, en las entradas, encontramos una advertencia sobre "trabajo t√©cnico de X a Y en MSC".  Lo m√°s interesante es que en la oficina de correos, no importa c√≥mo buscamos, no encontramos ning√∫n mensaje del proveedor sobre estos trabajos.  El boleto ten√≠a al menos un d√≠a de antig√ºedad.  Antes de esto, tales mensajes llegaban al correo, y generalmente nadie mira los tickets del servicio de soporte (y la propia oficina del proveedor de alojamiento) generalmente sin ninguna necesidad especial.  Por lo tanto, lo que sucedi√≥ fue una gran sorpresa.  Despu√©s de eso, rega√±amos los ojos del hoster, nos re√≠mos, esperamos hasta que todo funcion√≥ y nos fuimos a dormir. <br><br>  Aqu√≠ hay una historia. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423005/">https://habr.com/ru/post/es423005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422989/index.html">Una base de datos no es solo un almac√©n de datos</a></li>
<li><a href="../es422993/index.html">Quemando televisores OLED en pruebas reales</a></li>
<li><a href="../es422995/index.html">QA mitap en Redmadrobot</a></li>
<li><a href="../es422997/index.html">El libro "PHP moderno"</a></li>
<li><a href="../es422999/index.html">Crea tu propio conjunto de datos alien√≠genas</a></li>
<li><a href="../es423007/index.html">"Malyavki, pero bien": c√≥mo llevamos a los estudiantes a practicar</a></li>
<li><a href="../es423009/index.html">Diagn√≥stico SENS. Biomarcadores de glicaci√≥n proteica</a></li>
<li><a href="../es423011/index.html">Gesti√≥n de microservicios con Kubernetes e Istio</a></li>
<li><a href="../es423013/index.html">C√≥mo organizar tus dependencias en una aplicaci√≥n Vue</a></li>
<li><a href="../es423015/index.html">Git: errores comunes y c√≥mo solucionarlos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>