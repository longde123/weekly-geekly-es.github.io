<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèæ üë® üéå Otimiza√ß√£o de contratos inteligentes. Como os tipos de solidez afetam os custos de transa√ß√£o üë®üèΩ üï¥üèø üë®üèø‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúOs programadores passam muito tempo se preocupando com a velocidade de seus programas, e as tentativas de obter efici√™ncia geralmente t√™m um impacto ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimiza√ß√£o de contratos inteligentes. Como os tipos de solidez afetam os custos de transa√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415791/"><blockquote> <i>‚ÄúOs programadores passam muito tempo se preocupando com a velocidade de seus programas, e as tentativas de obter efici√™ncia geralmente t√™m um impacto negativo dram√°tico na capacidade de depurar e dar suporte a eles.</i>  <i>√â necess√°rio esquecer pequenas otimiza√ß√µes, por exemplo, em 97% dos casos.</i>  <i>Otimiza√ß√£o prematura √© a raiz de todo mal!</i>  <i>Mas n√£o devemos perder de vista esses 3% onde √© realmente importante! ‚Äù</i> <br>  <b>Donald Knut.</b> <br></blockquote><img src="https://habrastorage.org/webt/dw/wh/fv/dwwhfvvtvsgi2ilhvtjscuk8xyc.png" alt="G√°s Ethereum"><br><br>  Ao conduzir auditorias de contratos inteligentes, √†s vezes nos perguntamos se o desenvolvimento deles est√° relacionado aos 97% em que n√£o h√° necessidade de pensar em otimiza√ß√£o ou estamos lidando apenas com os 3% dos casos em que isso √© importante.  Na nossa opini√£o, provavelmente o segundo.  Diferentemente de outros aplicativos, os contratos inteligentes n√£o s√£o atualizados, eles n√£o podem ser otimizados "on the go" (desde que o algoritmo deles n√£o seja estabelecido, mas esse √© um t√≥pico separado).  O segundo argumento a favor da otimiza√ß√£o <i>antecipada de</i> contratos √© que, ao contr√°rio da maioria dos sistemas em que a subotimidade se manifesta apenas em escala, relacionada √†s especificidades de ferro e ambiente, √© medida por um grande n√∫mero de m√©tricas, um contrato inteligente tem essencialmente a √∫nica m√©trica de desempenho - consumo de g√°s. <br><br>  Portanto, √© tecnicamente mais f√°cil avaliar a efic√°cia de um contrato, mas os desenvolvedores geralmente continuam confiando em sua intui√ß√£o e fazem a mesma "otimiza√ß√£o prematura" cega da qual o professor Knut falou.  Verificaremos qu√£o intuitiva a solu√ß√£o corresponde √† realidade pelo exemplo da escolha da profundidade de bits de uma vari√°vel.  Neste exemplo, como na maioria dos casos pr√°ticos, n√£o obteremos economia e, vice-versa, nosso contrato se tornar√° mais caro em termos de g√°s consumido. <br><a name="habracut"></a><br><h2>  Que tipo de g√°s? </h2><br>  O Ethereum √© como um computador global, cujo "processador" √© a m√°quina virtual EVM, "c√≥digo do programa" √© uma sequ√™ncia de comandos e dados gravados em um contrato inteligente, e chamadas s√£o transa√ß√µes do mundo exterior.  As transa√ß√µes s√£o empacotadas em estruturas relacionadas - blocos que ocorrem uma vez a cada poucos segundos.  E como o tamanho do bloco √© limitado por defini√ß√£o e o protocolo de processamento √© determin√≠stico (requer processamento uniforme de todas as transa√ß√µes no bloco por todos os n√≥s da rede), para satisfazer a demanda potencialmente ilimitada com um recurso limitado de n√≥s e proteger contra o DoS, o sistema deve fornecer um algoritmo adequado para escolher a solicita√ß√£o a ser atendida, e cujo ignorar, como mecanismo em muitas cadeias p√∫blicas de blockchain, existe um princ√≠pio simples - o remetente pode escolher a quantia de remunera√ß√£o para o minerador por executar sua transa√ß√£o  ktsii e escolhe mineiro cujas necessidades incluem um bloco, e n√£o cuja, escolhendo o mais rent√°vel para si pr√≥prios. <br><br>  Por exemplo, no Bitcoin, onde o bloco √© limitado a um megabyte, o minerador escolhe incluir a transa√ß√£o no bloco ou n√£o com base no seu comprimento e na comiss√£o proposta (escolhendo aqueles com a taxa m√°xima de satoshis por byte). <br><br>  Para o protocolo Ethereum mais complexo, essa abordagem n√£o √© adequada, porque um √∫nico byte pode representar a aus√™ncia de uma opera√ß√£o (por exemplo, o c√≥digo STOP) e a opera√ß√£o cara e lenta de grava√ß√£o no armazenamento (SSTORE).  Portanto, para cada c√≥digo operacional no ar, seu pr√≥prio pre√ßo √© fornecido, dependendo do consumo de recursos. <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de taxas da especifica√ß√£o do protocolo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wb/to/i4/wbtoi4ymmqlobftzqqvykhau2iq.png" alt="Tabela de taxas do Ethereum"><br>  Tabela de fluxo de g√°s para diferentes tipos de opera√ß√µes.  Na especifica√ß√£o do protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ethereum Yellow Paper</a> . <br></div></div><br>  Ao contr√°rio do Bitcoin, o remetente da transa√ß√£o Ethereum n√£o define a comiss√£o em criptomoeda, mas a quantidade m√°xima de g√°s que ele est√° disposto a gastar - <b>startGas</b> e o pre√ßo por unidade de g√°s - <b>gasPrice</b> .  Quando a m√°quina virtual executa o c√≥digo, a quantidade de g√°s para cada opera√ß√£o subseq√ºente √© subtra√≠da de startGas at√© que a sa√≠da do c√≥digo seja alcan√ßada ou o g√°s acabe.  Aparentemente, √© por isso que um nome t√£o estranho √© usado para esta unidade de trabalho - a transa√ß√£o √© cheia de gasolina como um carro e chegar√° ao ponto de destino ou n√£o, depende se h√° volume suficiente no tanque.  Ap√≥s a conclus√£o da execu√ß√£o do c√≥digo para enviar um valor da transa√ß√£o √© deduzido √©ster obtido multiplicando o g√°s efectivamente consumida por uma taxa de remetente predeterminados ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wei</a> g√°s por).  Na rede global, isso acontece no momento da ‚Äúminera√ß√£o‚Äù do bloco, que inclui a transa√ß√£o correspondente, e no ambiente Remix, a transa√ß√£o √© ‚Äúminerada‚Äù instantaneamente, gratuitamente e sem quaisquer condi√ß√µes. <br><br><h2>  Nossa ferramenta - Remix IDE </h2><br>  Para o "perfil" do consumo de g√°s, usaremos o ambiente on-line para desenvolver os contratos Ethereum do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Remix IDE</a> .  Esse IDE cont√©m editor de c√≥digo de destaque de sintaxe, visualizador de artefatos, renderiza√ß√£o da interface do contrato, depurador visual da m√°quina virtual, compiladores JS de todas as vers√µes poss√≠veis e muitas outras ferramentas importantes.  Eu recomendo iniciar o estudo do √©ter com ele.  Uma vantagem adicional √© que ele n√£o requer instala√ß√£o - basta abri-lo em um navegador no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> . <br><br><h2>  Sele√ß√£o de tipo vari√°vel </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A especifica√ß√£o da linguagem Solidity</a> oferece ao desenvolvedor at√© 32 bits de tipos inteiros uint - de 8 a 256 bits.  Imagine que voc√™ esteja desenvolvendo um contrato inteligente projetado para armazenar a idade de uma pessoa em anos.  Que profundidade de bit voc√™ escolhe? <br><br>  Seria bastante natural escolher o tipo m√≠nimo suficiente para uma tarefa espec√≠fica - o uint8 caberia matematicamente aqui.  Seria l√≥gico supor que quanto menor o objeto que armazenamos na blockchain e menos mem√≥ria gastamos na execu√ß√£o, menos sobrecarga temos, menos pagamos.  Mas na maioria dos casos, essa suposi√ß√£o estar√° incorreta. <br><br>  Para o experimento, pegamos o contrato mais simples do que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> oficial do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Solidity</a> oferece e o coletamos em duas vers√µes - usando o tipo vari√°vel uint256 e o ‚Äã‚Äãtipo 32 vezes menor - uint8. <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_uint256.sol</b> <div class="spoiler_text"><pre> <code class="hljs powershell"><code>pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>; contract SimpleStorage { //uint is alias <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> uint256 uint storedData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span></span> { storedData = x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedData; } }</code> <br></code> </pre> <code><code>pragma solidity ^0.4.0; contract SimpleStorage { //uint is alias for uint256 uint storedData; function set(uint x) public { storedData = x; } function get() public view returns (uint) { return storedData; } }</code> <br></code> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_uint8.sol</b> <div class="spoiler_text"><pre> <code class="hljs powershell">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>; contract SimpleStorage { uint8 storedData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint8 x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span></span> { storedData = x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedData; } }</code> </pre> <br><br></div></div><br><h2>  Medindo "economias" </h2><br>  Portanto, os contratos s√£o criados, carregados no Remix, implantados e as chamadas para os m√©todos .set () s√£o executadas pelas transa√ß√µes.  O que n√≥s vemos?  <b>Gravar um tipo longo √© mais caro que um curto</b> - 20464 versus 20205 unidades de g√°s!  Como  Porque  Vamos descobrir! <br><br><img src="https://habrastorage.org/webt/rq/7p/bo/rq7pbohiqrtea8mp2bem0hddqlu.png" alt="Consumo de g√°s Ethereum no Remix IDE"><br><br><h2>  Loja uint8 vs uint256 </h2><br>  Gravar no armazenamento persistente √© uma das opera√ß√µes mais caras do protocolo por raz√µes √≥bvias: primeiro, gravar o estado aumenta o tamanho do espa√ßo em disco requerido pelo n√≥ completo.  O tamanho desse armazenamento est√° aumentando constantemente e, quanto mais estados s√£o armazenados nos n√≥s, mais lenta a sincroniza√ß√£o ocorre, maior √© o requisito de infraestrutura (tamanho da parti√ß√£o, n√∫mero de Iops).  Nos hor√°rios de pico, s√£o as opera√ß√µes de E / S do disco lento que determinam o desempenho de toda a rede. <br><br>  Seria l√≥gico esperar que o armazenamento do uint8 custasse dezenas de vezes mais barato que o uint256.  No entanto, no depurador, voc√™ pode ver que os dois valores est√£o localizados exatamente no mesmo slot de armazenamento que um valor de 256 bits. <br><br><img src="https://habrastorage.org/webt/7x/v-/e8/7xv-e8hrnzwrta4z0z7adgticm0.png"><br><br>  E, neste caso espec√≠fico, o uso do uint8 n√£o oferece nenhuma vantagem no custo de grava√ß√£o no armazenamento. <br><br><h2>  Manuseando uint8 vs uint256 </h2><br>  Talvez tenhamos benef√≠cios ao trabalhar com o uint8, se n√£o durante o armazenamento, pelo menos ao manipular dados na mem√≥ria?  A seguir, compara as instru√ß√µes para a mesma fun√ß√£o obtida para diferentes tipos de vari√°veis. <br><br><img src="https://habrastorage.org/webt/wj/qq/4h/wjqq4hi8_gkc0lfxckcyhjygbu4.png"><br><br>  Voc√™ pode ver que as opera√ß√µes com o uint8 t√™m ainda <b>mais instru√ß√µes</b> que o uint256.  Isso ocorre porque a m√°quina converte o valor de 8 bits em uma palavra nativa de 256 bits e, como resultado, o c√≥digo √© cercado por instru√ß√µes adicionais pagas pelo remetente.  N√£o apenas escrever, mas tamb√©m executar c√≥digo com um tipo uint8, nesse caso, √© mais caro. <br><br><h2>  Onde o uso de tipos curtos pode ser justificado? </h2><br>  Nossa equipe est√° envolvida na auditoria de contratos inteligentes h√° muito tempo e, at√© o momento, n√£o houve um √∫nico caso pr√°tico em que o uso de um tipo pequeno no c√≥digo fornecido para a auditoria levasse a economias.  Enquanto isso, em alguns casos muito espec√≠ficos, a economia √© teoricamente poss√≠vel.  Por exemplo, se seu contrato armazena um grande n√∫mero de pequenas vari√°veis ‚Äã‚Äãou estruturas de estado, elas podem ser compactadas em menos slots de armazenamento. <br><br>  A diferen√ßa ser√° mais aparente no exemplo a seguir: <br><br>  1. contrato com 32 vari√°veis ‚Äã‚Äãuint256 <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_32x_uint256.sol</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pragma</span></span> solidity<span class="hljs-regexp"><span class="hljs-regexp"> ^0.4.0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">contract</span></span> SimpleStorage { <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData1; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData2; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData3; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData4; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData5; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData6; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData7; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData8; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData9; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData10; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData11; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData12; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData13; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData14; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData15; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData16; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData17; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData18; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData19; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData20; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData21; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData22; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData23; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData24; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData25; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData26; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData27; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData28; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData29; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData30; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData31; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData32; <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> set(uint x) public { <span class="hljs-attribute"><span class="hljs-attribute">storedData1</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData2</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData3</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData4</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData5</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData6</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData7</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData8</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData9</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData10</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData11</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData12</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData13</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData14</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData15</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData16</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData17</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData18</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData19</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData20</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData21</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData22</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData23</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData24</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData25</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData26</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData27</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData28</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData29</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData30</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData31</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData32</span></span> = x; } <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> get() public view returns (uint) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> storedData1; } }</code> </pre> <br><br></div></div><br>  2. contrato com 32 vari√°veis ‚Äã‚Äãuint8 <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_32x_uint8.sol</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pragma</span></span> solidity<span class="hljs-regexp"><span class="hljs-regexp"> ^0.4.0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">contract</span></span> SimpleStorage { <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData1; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData2; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData3; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData4; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData5; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData6; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData7; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData8; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData9; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData10; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData11; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData12; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData13; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData14; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData15; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData16; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData17; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData18; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData19; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData20; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData21; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData22; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData23; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData24; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData25; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData26; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData27; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData28; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData29; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData30; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData31; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData32; <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> set(uint8 x) public { <span class="hljs-attribute"><span class="hljs-attribute">storedData1</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData2</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData3</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData4</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData5</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData6</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData7</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData8</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData9</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData10</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData11</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData12</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData13</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData14</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData15</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData16</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData17</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData18</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData19</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData20</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData21</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData22</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData23</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData24</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData25</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData26</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData27</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData28</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData29</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData30</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData31</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData32</span></span> = x; } <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> get() public view returns (uint) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> storedData1; } }</code> </pre> <br><br></div></div><br>  A implanta√ß√£o do primeiro contrato (32 uint256) custar√° menos - apenas 89941 de g√°s, mas .set () ser√° muito mais caro, pois  Ele ocupar√° 256 slots de armazenamento, o que custar√° 640.639 de g√°s para cada chamada.  O segundo contrato (32 uint8) ser√° duas vezes e meia mais caro ao implantar (g√°s 221663), mas cada chamada para o m√©todo .set () ser√° muito mais barata, porque  altera apenas uma c√©lula do est√°gio (185291 g√°s). <br><br><h2>  Essa otimiza√ß√£o deve ser aplicada? </h2><br>  Qu√£o significativo √© o efeito da otimiza√ß√£o de tipo √© um ponto discut√≠vel.  Como voc√™ pode ver, mesmo para um caso sint√©tico especialmente selecionado, <b>n√£o obtivemos</b> v√°rias diferen√ßas.  A escolha de usar o uint8 ou o uint256 √© mais uma ilustra√ß√£o do fato de que a otimiza√ß√£o deve ser aplicada de maneira significativa (com entendimento de ferramentas, cria√ß√£o de perfil) ou n√£o pensar sobre o assunto.  Aqui est√£o algumas diretrizes gerais: <br><br><ul><li>  se o contrato contiver muitos n√∫meros pequenos ou estruturas compactas no reposit√≥rio, voc√™ poder√° pensar em otimiza√ß√£o; </li><li>  se voc√™ usar o tipo "abreviado" - lembre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-se das vulnerabilidades de excesso / insufici√™ncia de fluxo</a> ; </li><li>  para vari√°veis ‚Äã‚Äãde mem√≥ria e argumentos de fun√ß√£o que n√£o s√£o gravados no reposit√≥rio, √© sempre melhor usar o tipo nativo uint256 (ou seu apelido uint).  Por exemplo, n√£o faz sentido definir o iterador da lista como uint8 - apenas perca; </li><li>  De grande import√¢ncia para o empacotamento correto nos slots de armazenamento para o compilador √© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ordem das vari√°veis ‚Äã‚Äãno contrato</a> . </li></ul><br><h2>  Refer√™ncias </h2><br>  Termino com conselhos que n√£o t√™m contra-indica√ß√µes: experimente ferramentas de desenvolvimento, conhe√ßa as especifica√ß√µes da linguagem, biblioteca e estruturas.  Aqui est√£o os links mais √∫teis, na minha opini√£o, para come√ßar a aprender sobre a plataforma Ethereum: <br><br><ul><li>  contratos de ambiente de desenvolvimento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Remix</a> - IDE muito funcional baseada em browser; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Na especifica√ß√£o da linguagem Solidity</a> , o link ir√° especificamente para a se√ß√£o Layout de Vari√°veis ‚Äã‚Äãde Estado; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um reposit√≥rio de</a> contratos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muito interessante</a> da famosa equipe do OpenZeppelin.  Exemplos da implementa√ß√£o de tokens, contratos de crowdsale e, o mais importante - a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SafeMath</a> , que ajuda a trabalhar com seguran√ßa com tipos; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ethereum Yellow Paper</a> , especifica√ß√£o formal da m√°quina virtual Ethereum; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ethereum White Paper</a> , a especifica√ß√£o da plataforma Ethereum, um documento mais geral e de alto n√≠vel com um grande n√∫mero de links; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ethereum em 25 minutos</a> , uma breve introdu√ß√£o t√©cnica ao Ethereum, curta, mas no entanto abrangente, do criador da plataforma, Vitalik Buterin; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Etherscan blockchain explorer</a> , uma janela para o mundo real do √©ter, um navegador de blocos, transa√ß√µes, tokens, contratos na rede principal.  No Etherscan, voc√™ encontrar√° o explorador para redes de teste Rinkeby, Ropsten, Kovan (redes com transmiss√£o gratuita, baseadas em diferentes protocolos de consenso). </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415791/">https://habr.com/ru/post/pt415791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415779/index.html">Implementa√ß√£o de uma plataforma de software NAS segura</a></li>
<li><a href="../pt415781/index.html">Por que os f√≠sicos pensam que a teoria das cordas pode se tornar "a teoria de tudo"</a></li>
<li><a href="../pt415783/index.html">Os discos estelares nos revelam os segredos da apar√™ncia dos planetas</a></li>
<li><a href="../pt415785/index.html">SpaceX envia rob√¥ de intelig√™ncia artificial para a ISS</a></li>
<li><a href="../pt415789/index.html">Algoritmos de patente para programas de computador</a></li>
<li><a href="../pt415793/index.html">Guia completo de pedidos pendentes de dom√≠nio</a></li>
<li><a href="../pt415795/index.html">Escrevendo uma interface do Snapchat no Swift</a></li>
<li><a href="../pt415797/index.html">Express√µes regulares + programa√ß√£o l√≥gica. Qual √© o resultado?</a></li>
<li><a href="../pt415801/index.html">Google: nossa IA de "telefone" n√£o √© boa o suficiente para ser perigosa</a></li>
<li><a href="../pt415805/index.html">Modifica√ß√£o do m√≥dulo de barreira GSM Doorhan para controle da Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>