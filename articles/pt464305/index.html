<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåã üóùÔ∏è üñçÔ∏è Pequeno sim. Desembalagem do microvirtual Firecracker ü§úüèª üë§ üèöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gravar microvirtuais do Firecracker. Adotamos dois m√©todos populares para isolar cargas de trabalho multiusu√°rio - m√°quinas virtuais e cont√™ineres. Ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pequeno sim. Desembalagem do microvirtual Firecracker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/464305/">  Gravar microvirtuais do Firecracker.  Adotamos dois m√©todos populares para isolar cargas de trabalho multiusu√°rio - m√°quinas virtuais e cont√™ineres.  Apertamos o melhor de ambas as abordagens, simplificamos o m√°ximo poss√≠vel, testamos em uma carga alta real.  Como resultado, obtemos um isolamento impenetr√°vel de computadores virtuais que podem ser iniciados em centenas de milissegundos.  Essa solu√ß√£o funciona sob o cap√¥ da AWS Lambda e Fargate, executando milh√µes de fun√ß√µes e cont√™ineres sem servidor a cada segundo na nuvem.  Chama-se Firecracker. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/ps/oo/rmpsoo1w1jptnyp2qwsaestydsq.png" width="400"></div><br><br>  Essa ferramenta de microvirtualiza√ß√£o est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenSource</a> .  Se suas tarefas exigem isolamento de v√°rios locat√°rios (por exemplo, voc√™ decide criar sua pr√≥pria nuvem), o Firecracker √© o que voc√™ precisa. <br><br>  <strong>Vasily Pantyukhin</strong> , arquiteto da Amazon Web Services, fala sobre a arquitetura Firecracker, como √© usada pela AWS Lambda, a compara com solu√ß√µes alternativas e fornece exemplos de integra√ß√£o. <br><br>  <em>Isen√ß√£o de responsabilidade: tudo abaixo √© da opini√£o pessoal de Vasily e pode n√£o coincidir com a posi√ß√£o da Amazon Web Services.</em> <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cfsICOzt6Do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Caracter√≠sticas naturais de nuvens p√∫blicas </h2><br><blockquote>  Uma das propriedades fundamentais das nuvens p√∫blicas √© a multiloca√ß√£o. </blockquote><br>  Algu√©m traduz esse termo como "multiloca√ß√£o" ou "ambiente multiusu√°rio".  Mas, do meu ponto de vista, isso n√£o reflete a ess√™ncia.  A multiloca√ß√£o √© quando usu√°rios diferentes e suas cargas vivem na mesma infraestrutura f√≠sica, compartilham entre si, mas n√£o sabem nada um do outro.  Das cargas de trabalho para v√°rios usu√°rios, a multiloca√ß√£o √© diferenciada por requisitos fundamentalmente mais rigorosos para isolamento de recursos e acesso a eles. <br><br><blockquote>  Outra propriedade inerente √†s nuvens p√∫blicas √© a carga alta. </blockquote><br>  Acredite, no caso da AWS, essa √© uma carga enorme!  A captura de tela √© um exemplo de dados reais.  N√£o vou dizer por quanto tempo e em que regi√£o esses milh√µes de "papagaios" foram medidos, mas isso n√£o √© algum tipo de emerg√™ncia, mas o modo operacional usual para n√≥s. <br><br><img src="https://habrastorage.org/webt/up/dt/qs/updtqsp7dmtqk1czi5f2zuscbkq.png"><br><br>  Acontece uma certa contradi√ß√£o.  Por um lado, precisamos manter os usu√°rios o mais isolados poss√≠vel.  Por outro lado, devemos garantir um n√≠vel muito alto de produtividade e utiliza√ß√£o de recursos.  Melhorar um geralmente leva √†s limita√ß√µes do outro.  Como encontrar um compromisso e, melhor ainda, obter o m√°ximo em todas as frentes? <br><br><h2>  M√°quinas virtuais ou cont√™ineres? </h2><br>  Existem duas abordagens b√°sicas que podem potencialmente ajudar.  Essas s√£o m√°quinas e cont√™ineres virtuais.  Cada um tem seus pr√≥s e contras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/hl/ba/djhlbailazcjnfxycokcrv38a64.png" width="400"></div><br><br>  A principal desvantagem das m√°quinas virtuais √© que elas levam <strong>muito tempo para carregar</strong> .  Geralmente, leva dezenas de segundos ou at√© minutos para iniciar a m√°quina.  Mas os virtualoks t√™m uma virtude - eles <strong>isolam</strong> cargas <strong>concretas</strong> um do outro.  E de ambos os pontos de vista: <br><br><ul><li>  <strong>seguran√ßa</strong> quando uma m√°quina virtual n√£o √© capaz de acessar dados em outra m√°quina; </li><li>  <strong>recursos</strong> , quando pedi 8 GB de mem√≥ria, espero que essa RAM seja minha e que ningu√©m possa reivindicar o recurso pelo qual paguei. </li></ul><br>  O oposto √© o caso dos cont√™ineres: eles s√£o leves e, portanto, <strong>carregam muito rapidamente.</strong>  Eles podem ser facilmente dimensionados horizontalmente.  Mas h√° um recurso com o qual n√≥s, como provedor de nuvem p√∫blica, n√£o podemos viver.  Eles usam um <strong>kernel compartilhado - o kernel do sistema operacional √© compartilhado entre todos os cont√™ineres</strong> . <br><br><img src="https://habrastorage.org/webt/pa/pz/hm/papzhmvppqzce7pxbezk8bp9owg.png"><br><br>  Pode-se dizer que os cont√™ineres s√£o inseguros?  N√£o, mesmo que haja s√©rias vulnerabilidades. <br><br><blockquote>  Acredito que hoje um cont√™iner "soldado" adequadamente oferece um n√≠vel de seguran√ßa suficiente. </blockquote><br>  O problema √© diferente - um kernel compartilhado n√£o garante fundamentalmente que, em algum momento no futuro, n√£o ocorram vulnerabilidades que quebrem o isolamento dos inquilinos.  A nuvem p√∫blica n√£o pode pagar, mesmo em teoria. <br><br>  Existe ainda outra contradi√ß√£o, e uma solu√ß√£o deve ser buscada.  A maneira mais f√°cil √© tirar o melhor proveito da m√£e - uma m√°quina virtual e do pai - um cont√™iner, atravessar e obter algo <strong>convergente</strong> .  Na verdade, n√≥s fizemos isso.  Acabou Firecracker. <br><br>  Firecracker j√° est√° em produ√ß√£o.  Na mesma carga de servi√ßos cr√≠ticos, por exemplo, AWS Lambda (fun√ß√µes sem servidor) e AWS Fargate (cont√™ineres sem servidor). <br><br><h3>  Problemas do antigo AWS Lambda </h3><br>  O AWS Lambda √© um servi√ßo de recursos sem servidor.  Pegamos a fun√ß√£o em Java, Go, Python ou outra linguagem, a jogamos no Lambda, e ela √© executada magicamente.  N√£o √© necess√°rio alocar e gerenciar recursos.  Como isso foi implementado antes? <br><br><img src="https://habrastorage.org/webt/ou/ck/-s/ouck-sm6pjv4ul6t13dwlefxtry.png"><br><br>  Para cada conta da AWS, uma ou mais m√°quinas virtuais EC2 separadas foram alocadas para isolar fun√ß√µes que pertencem a diferentes inquilinos.  Essa m√°quina virtual consome recursos, mesmo quando n√£o faz nada.  Suponha que executemos uma fun√ß√£o a cada 10 minutos e ela seja executada em 200 ms como um Lambda comum.  Acontece que dentro de uma hora a m√°quina EC2 √© usada apenas alguns segundos.  Al√©m disso, mesmo em tempo de execu√ß√£o, ele n√£o consome todos os recursos dispon√≠veis - descarte abaixo do rodap√©.  Isso √© furiosamente in√∫til. <br><br><img src="https://habrastorage.org/webt/jy/lo/0q/jylo0qlzudppsa5042qv858mfya.png"><br><br><h3>  Como voc√™ resolveu o problema de reciclagem? </h3><br>  Desenvolvido a partir do zero, sua pr√≥pria solu√ß√£o Firecracker.  Isso √© √≥bvio no t√≠tulo do relat√≥rio :) <br><br>  Para come√ßar a desenvolver um novo produto, voc√™ precisa de uma tarefa t√©cnica.  Tem muito texto, mas se voc√™ selecionar apenas o significado, obter√° o seguinte. <br><br><ul><li>  <strong>Desenvolvido pela KVM</strong> como um hypervisor.  Quem trabalha com a AWS sabe que temos dois hipervisores favoritos.  VMs herdadas executadas no Xen.  Desde o final de 2017, a KVM vive sob o cap√¥ de todos os carros. </li><li>  <strong>Come√ßa o mais r√°pido poss√≠vel.</strong>  No hardware de refer√™ncia, o requisito era uma carga completa do microvirtual em 125 ms. </li><li>  <strong>Sobrecarga m√≠nima de virtualiza√ß√£o</strong> .  Na arquitetura de refer√™ncia, uma √∫nica m√°quina micro-virtual do Firecracker consome adicionalmente apenas 5 MB de mem√≥ria. </li><li>  <strong>A possibilidade do come√ßo mais denso</strong> .  Par√¢metros de projeto - carga total de 5 microvirtuais por n√∫cleo por segundo.  Esse requisito √© fundamental para servi√ßos como o AWS Lambda.  As fun√ß√µes devem decolar, trabalhar e morrer rapidamente, liberando recursos para o pr√≥ximo. </li><li>  <strong>A possibilidade de reinscri√ß√£o</strong> .  √â uma oportunidade - n√£o √© necess√°rio us√°-lo.  De fato, essa √© a aloca√ß√£o de recursos virtuais em maior extens√£o do que eles est√£o fisicamente dispon√≠veis.  Isso significa que o servidor possui 16 GB de RAM e voc√™ executa simultaneamente 4 m√°quinas virtuais, cada uma das quais tem 8 GB de mem√≥ria. </li></ul><br><h3>  AWS Lambda com Firecracker sob o cap√¥ </h3><br>  O que mudou na nova vers√£o do AWS Lambda?  Do ponto de vista do usu√°rio final, nada mudou.  A migra√ß√£o para uma arquitetura atualizada na produ√ß√£o foi completamente transparente e invis√≠vel para os consumidores.  Os recursos do Lambda t√™m vida curta - foi f√°cil de fazer. <br><br>  Como √© a arquitetura moderna? <br><br><blockquote>  No n√≠vel mais baixo, agora n√£o √© uma m√°quina virtual, mas um bare-metal f√≠sico. </blockquote><br>  Esses servidores permitem o uso completo de todas as fun√ß√µes da CPU, por exemplo, Intel VT.  Isso fornece benef√≠cios adicionais ao usar a virtualiza√ß√£o em n√≠veis mais altos. <br><br><img src="https://habrastorage.org/webt/rg/i6/s3/rgi6s36v7vgfuc2onnb-cuahbui.png"><br><br>  No topo da pe√ßa de ferro, est√° o <strong>sistema operacional host</strong> com o m√≥dulo KVM no kernel.  <strong>Os</strong> microvirtuais do <strong>Firecracker</strong> com seus pr√≥prios <strong>SOs convidados</strong> s√£o lan√ßados acima.  Bem, eles j√° implementaram componentes do pr√≥prio servi√ßo da AWS Lambda. <br><br>  Anteriormente, para cada cliente que usa os recursos do Lambda, alocamos m√°quinas virtuais EC2 separadas com baixa utiliza√ß√£o.  A nova abordagem permite executar um microvirtual leve apenas quando voc√™ realmente precisa.  Isolar os recursos do Firecracker um do outro nos permite fazer isso em um hardware comum com densidade m√°xima.  A utiliza√ß√£o de recursos melhorou fundamentalmente. <br><br><h2>  O que h√° na caixa? </h2><br>  Prometi o anboxing, ent√£o vamos examinar os principais componentes do Firecracker, considerar cada um deles separadamente e, em seguida, juntar tudo. <br><br><img src="https://habrastorage.org/webt/o_/by/mq/o_bymqjtw5d6aomlwpmfa7grqgk.jpeg"><br><br><h3>  Princ√≠pios de design </h3><br>  Quando come√ßamos a discutir o desenvolvimento do Firecracker, concordamos em aderir a dois princ√≠pios. <br><br>  <strong>Livre-se de tudo o que √© desnecess√°rio.</strong>  Por que as m√°quinas virtuais cl√°ssicas carregavam lentamente?  Em particular, porque o c√≥digo est√° sobrecarregado.  Eles precisam suportar um grande n√∫mero de dispositivos herdados.  Mas por que imitar um dispositivo que ningu√©m mais usava 10 anos atr√°s?  N√£o h√° necessidade, portanto, nos livramos de tudo o que √© sup√©rfluo.  Resolvemos uma tarefa restrita espec√≠fica e qualquer funcionalidade que n√£o ajude na solu√ß√£o desse problema √© considerada desnecess√°ria. <br><br><blockquote>  Livre-se de tudo que √© sup√©rfluo e concentre-se em uma tarefa. </blockquote><br>  <strong>Simplifique o que resta.</strong>  Mesmo o que resta deve ser o mais simples poss√≠vel. <br><br><h3>  No que eles escreveram? </h3><br>  Firecracker est√° escrito em Rust na moda porque: <br><br><ul><li>  permite escrever <strong>c√≥digo</strong> mais <strong>seguro</strong> , em particular em termos de mem√≥ria; </li><li>  <strong>O desempenho</strong> e a sobrecarga s√£o compar√°veis ‚Äã‚Äãao C ++ moderno; </li><li>  A ferrugem <strong>√© utilizada h√° muito tempo;</strong> desde 2015, ele criou muitas solu√ß√µes legais de carga alta. </li></ul><br><h3>  Ferro </h3><br>  Repito - o Firecracker requer instala√ß√£o em hardware real.  Como configura√ß√£o de refer√™ncia, foi escolhida a m√°quina bare metal i3.metal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rg/to/nh/rgtonh5b1jbhgpzizky2wc6bsfk.png" width="400"></div><br>  <em>Nota: o relat√≥rio foi no in√≠cio de abril de 2019. Naquela √©poca, apenas a plataforma Intel era suportada.</em>  <em>Em maio, eles adicionaram suporte alfa √† AMD e em junho ao ARM.</em>  <em>A AMD pode ser um pouco mais barata que a Intel, e o suporte a ARM oferece oportunidades interessantes para trabalhar com a IoT de v√°rios locat√°rios.</em> <br><br>  Se voc√™ solicitar um i3.metal ou outra m√°quina bare metal na AWS, em experimentos, ser√° uma configura√ß√£o muito poderosa e cara.  Portanto, se voc√™ decidir instalar o Firecracker neles, n√£o esque√ßa de pagar essas m√°quinas ap√≥s os experimentos.  Caso contr√°rio, uma pontua√ß√£o decente chegar√° ao final do m√™s. <br><br>  Existe uma op√ß√£o mais barata?  Sim, voc√™ pode inicializar o Firecracker em um ambiente virtual.  Mas n√£o mais na AWS - basicamente n√£o oferecemos suporte √† virtualiza√ß√£o aninhada no EC2.  Mas voc√™ pode fazer isso no GCP, Azure, DigitalOcean ou usar Proxmox, Parallels, VMware Fusion.  Tudo funcionar√° se voc√™ seguir os requisitos, em particular, de acordo com a vers√£o do kernel do sistema operacional convidado. <br><br><h3>  O n√∫cleo </h3><br><blockquote>  O elemento fundamental da solu√ß√£o √© o m√≥dulo do kernel KVM. </blockquote><br>  Apenas no caso, descreverei como uma digress√£o o que √© KVM.  Este n√£o √© o hypervisor inteiro, mas apenas parte dele.  Suas principais tarefas s√£o <strong>configurar um processador virtual</strong> (vCPU) e <strong>iniciar uma m√°quina virtual</strong> . <br><br><img src="https://habrastorage.org/webt/gp/3l/ee/gp3leep27-zq3yzx9fiiho15pkm.png"><br><br>  Mas isso n√£o √© suficiente para um trabalho completo.  Al√©m do processador, alguns outros dispositivos s√£o necess√°rios.  Sua emula√ß√£o ocorre no espa√ßo do usu√°rio. <br><br><h3>  VMM </h3><br>  Para que pelo menos os dispositivos b√°sicos apare√ßam, voc√™ precisa de outro componente - Virtual Machine Manager (VMM).  Antes do Firecracker, a op√ß√£o principal do VMM era QEMU. <br><br><img src="https://habrastorage.org/webt/kg/s8/kr/kgs8krmluije10ql6x6vtch7f9g.png"><br><br>  Consideramos seriamente a possibilidade de usar o QEMU, mas decidimos desenvolver nossa pr√≥pria ‚Äúbicicleta‚Äù.  Havia v√°rias raz√µes para isso. <br><br>  <strong>Gerenciamento de desenvolvimento</strong> .  O QEMU √© um produto grande e maduro, com mais de um milh√£o de linhas de c√≥digo.  Para fazer altera√ß√µes, voc√™ precisa visualizar muitos c√≥digos-fonte.  Muitas pessoas participam do desenvolvimento e da tomada de decis√µes sobre o desenvolvimento. <br><br>  <strong>Seguran√ßa</strong>  O QEMU pode emular muitos dispositivos.  √â por isso que possui uma superf√≠cie de ataque bastante grande.  Nossa tarefa √© fazer um microvirtual.  Do ponto de vista da seguran√ßa, devemos minimizar a superf√≠cie de ataque. <br><br>  <strong>A necessidade de implementar novos recursos.</strong>  QEMU tem um bom c√≥digo.  Este √© um produto maduro no qual todos os erros √≥bvios j√° foram detectados.  Mas, na sua forma atual, a funcionalidade QEMU ainda n√£o nos convinha - ter√≠amos que adicionar muito.  Desse ponto de vista, o novo c√≥digo no QEMU e no novo produto teria a mesma qualidade.  Portanto, uma vit√≥ria especial n√£o funcionaria. <br><br><h3>  Aparelhos </h3><br>  O Firecracker implementa o VMM, usado para emular dispositivos.  Emulamos os seguintes dispositivos: <br><br><ul><li>  <strong>Console</strong>  Uma coisa √∫til e necess√°ria, embora possa ser desligada. </li><li>  <strong>Teclado</strong>  Fizemos um teclado complicado - com apenas um bot√£o "Reset".  Simplesmente n√£o confiamos no software "Reset" dos sistemas operacionais que poderiam ser executados no Firecracker.  Portanto, eles fizeram ferro. </li><li>  <strong>Drivers Virtio para disco e rede</strong> .  Virtio √© um dispositivo muito primitivo.  Em ess√™ncia, este √© um "buffer de anel".  O sistema convidado gravou algo no buffer, clicou na chamada e o sistema host leu os dados desse buffer atrav√©s de um arquivo. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/av/hw/pvavhwc_g42zvrjrg7ftiqmcfda.png" width="500"></div><br><br>  Em alguns casos, por exemplo, para integra√ß√£o com cont√™ineres, ainda precisamos de um dispositivo de rede que represente a funcionalidade b√°sica de uma placa de rede comum.  Virtio n√£o se encaixa aqui, muito simples.  Portanto, para a rede, usamos outro dispositivo - <strong>Vsock</strong> . <br><br>  Bem, tamb√©m precisamos da capacidade de controlar o consumo de recursos.  O <strong>limitador de taxa</strong> √© respons√°vel por isso. <br><br>  Existem dispositivos.  Mas como gerenciar e configurar microvirtuais?  A API de gerenciamento nos ajudar√° aqui. <br><br><h3>  Ger√™ncia </h3><br>  A Amazon possui v√°rios princ√≠pios fundamentais inquebr√°veis.  Uma delas √© que qualquer servi√ßo se comunica apenas atrav√©s da API.  N√£o importa se esses s√£o servi√ßos externos que voc√™ usa como usu√°rio ou nossos servi√ßos internos.  N√£o acontece que um servi√ßo v√° diretamente para o banco de dados de outro servi√ßo - √© proibido e pun√≠vel.  O thread da API do Firecracker √© usado apenas para acessar as configura√ß√µes e a funcionalidade dos microvirtuais por meio da API REST. <br><br><img src="https://habrastorage.org/webt/1s/qj/bt/1sqjbtijgutp6qfwscgu_vnq1va.png"><br><br>  Aderimos √† especifica√ß√£o Open API, para que voc√™ possa usar o Swagger. <br><br><h3>  Metadados </h3><br>  Existe uma codifica√ß√£o t√£o maligna.  √â quando alguns dados s√£o costurados diretamente no c√≥digo, por exemplo, o login e a senha de acesso a outro recurso.  Isso, √© claro, n√£o √© permitido.  Periodicamente, precisamos transferir alguns dados para dentro do microvirtual.  Isso √© feito atrav√©s do <strong>servi√ßo de metadados</strong> . <br><br><img src="https://habrastorage.org/webt/q_/ll/0m/q_ll0msnhoarxu6k5aag0ie2fug.png"><br><br>  Passamos as informa√ß√µes necess√°rias pelo soquete para o com√©rcio de metadados do IMDS.  Para obter essas informa√ß√µes dentro do microvirtual, √© necess√°rio solicitar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://169.254.169.254/latest/meta-data</a> usando a API REST.  Os usu√°rios da AWS j√° conhecem esse IP m√°gico.  Da mesma forma, os microvirtuais podem obter informa√ß√µes detalhadas sobre sua pr√≥pria configura√ß√£o. <br><br><h3>  Logs </h3><br>  √â imperativo poder lan√ßar toras de microvirtual no mundo exterior antes de ela morrer.  Isso √© feito atrav√©s de um <strong>FIFO</strong> Unix comum. <br><br><img src="https://habrastorage.org/webt/vr/p6/ib/vrp6ibzybyivbp68mi7wt1awobc.png"><br><br><h3>  Isolamento adicional </h3><br>  A principal vantagem da m√°quina virtual isolada.  Parece que isso deve ser suficiente, mas fomos al√©m.  Para garantir a execu√ß√£o da produ√ß√£o, √© recomend√°vel colocar uma camada adicional de isolamento chamada <strong>Jailer</strong> . <br><br><img src="https://habrastorage.org/webt/1o/_2/j6/1o_2j6t6y7_ae7h1cmzk36xqliq.png"><br><br>  Estas s√£o precau√ß√µes padr√£o: <br><br><ul><li>  <strong>cgroups</strong> para limitar recursos; </li></ul><br><ul><li>  <strong>espa√ßo</strong> para <strong>nome</strong> para isolar processos; </li><li>  <strong>seccomp</strong> - um an√°logo do firewall para chamadas do sistema; </li><li>  e, claro, o <strong>chroot</strong> favorito de todos <strong>.</strong> </li></ul><br><h2>  Integra√ß√£o com outros servi√ßos </h2><br>  Existem solu√ß√µes prontas baseadas no Firecracker?  Claro que sim. <br><br><h3>  OSV </h3><br>  Este sistema operacional foi desenvolvido para executar apenas um aplicativo.  Devido a isso, ela organizou de maneira muito simples o trabalho com mem√≥ria e um agendador.  Um sistema operacional poderoso e f√°cil de gerenciar agora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">funciona em cima do Firecracker</a> . <br><br><h3>  Containerd </h3><br>  Tamb√©m fizemos a integra√ß√£o com o container.  Se voc√™ j√° trabalha com ele, precisa de um m√≠nimo de esfor√ßo para lan√ßar os cont√™ineres que est√£o envolvidos no Firecracker para isolamento. <br><br><img src="https://habrastorage.org/webt/xm/l3/1n/xml31nghhesczi3x2ul1vagz5xw.png"><br><br>  Em vez do cal√ßo habitual, o cont√™iner refere-se ao cal√ßo do foguete.  J√° gerencia runc, atrav√©s de um agente que √© instalado dentro do microvirtual.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificado, funciona</a> . <br><br><h3>  Contentores Kata </h3><br>  Quando anunciamos o Firecracker, uma das perguntas mais populares dos clientes era: <br><br>  <em>- O mecanismo de isolamento de cont√™ineres j√° foi inventado - este √© o Kata Containers.</em>  <em>Por que voc√™ n√£o os usou?</em>  <em>Por que desenvolver o seu pr√≥prio?</em> <br>  <em>- O Kata trabalha com o QEMU, mas n√£o queremos trabalhar com o QEMU.</em>  <em>Por isso, decidimos cozinhar nossos pr√≥prios.</em> <br><br>  Mas acabou sendo interessante.  Os desenvolvedores de Kata se reuniram com os desenvolvedores do Firecracker e concordaram em integrar.  Porque todo mundo v√™ isso como uma enorme vantagem.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Kata Containers v1.5</a> j√° suporta QEMU e Firecracker. <br><br>  Acontece que n√£o competimos, mas que se complementam harmoniosamente.  No Kubernetes com v1.12, voc√™ pode definir runtimeClassName como Kata FC ou Kata QEMU e executar seus cont√™ineres em isolamento apropriado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/1-/bn/yt1-bnzwtgnbvhvkkr48gmhsj5o.png" width="500"></div><br><br>  Como escolher o isolamento adequado √† sua aplica√ß√£o - Firecracker ou QEMU?  Minha opini√£o pessoal √© que o que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">importa √© se o</a> seu aplicativo √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">animal de estima√ß√£o ou gado</a> ? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/le/yj/vsleyjeqq1hypjljyr3jcjcpsvc.png" width="300"></div><br><br>  Kata com QEMU √© uma solu√ß√£o para animais de estima√ß√£o.  QEMU √© um sistema grande e multifuncional.  Potencialmente, oferece mais op√ß√µes de suporte e tratamento para seus animais de estima√ß√£o favoritos. <br><br>  Firecracker √© adequado quando a carga √© de gado.  Caso seu aplicativo sem estado tenha sido originalmente projetado para dimensionamento horizontal flex√≠vel e a falha de um ou mais cont√™ineres n√£o seja cr√≠tica.  Fornecendo isolamento confi√°vel, permite carregar rapidamente o n√∫mero necess√°rio de novos cont√™ineres para substituir os que falharam. <br><br><h2>  Qual √© o resultado? </h2><br>  Come√ßamos com contradi√ß√µes.  Parece que resolver a contradi√ß√£o √© uma abordagem ‚Äútanto nossa quanto sua‚Äù, algo que satisfar√° a todos.  Mas a experi√™ncia diz que o compromisso n√£o √© necess√°rio. <br><br>  Estabelecemos o objetivo de desenvolver uma nova solu√ß√£o na qual n√£o haver√° nada sup√©rfluo que n√£o seja necess√°rio para resolver uma tarefa restrita.  Tamb√©m era importante simplificar tudo o que usamos, tanto quanto poss√≠vel.  Gostaria de acreditar que n√£o conseguimos um compromisso, mas uma solu√ß√£o s√≥lida, que permite lan√ßar r√°pida e densamente milhares de microvirtuais sem sacrificar o isolamento. <br><br>  J√° utilizamos o Firecracker na produ√ß√£o de v√°rios de nossos servi√ßos.  A principal vantagem que obtivemos √© a melhoria da utiliza√ß√£o do servi√ßo.  Isso permitiu economizar significativamente.  Parte dessa economia que compartilhamos com os clientes.  Por exemplo, ap√≥s a introdu√ß√£o do Firecracker, os pre√ßos dos cont√™ineres sem servidor da AWS Fargate em janeiro de 2019 ca√≠ram de 35 a 50%.  O benef√≠cio √© vis√≠vel a olho nu, ent√£o n√£o h√° d√∫vida de que continuaremos desenvolvendo este produto e compartilhando nossas melhores pr√°ticas com o c√≥digo-fonte aberto.  O fato de o Firecracker j√° ter come√ßado a se integrar a outras solu√ß√µes indica um crescente interesse por parte da comunidade. <br><br>  Se voc√™ tem uma id√©ia ou um produto acabado na descri√ß√£o com as palavras "isolamento de v√°rios locat√°rios" - este √© um indicador claro do que voc√™ deve experimentar com os microvirtuais do Firecracker. <br><br><blockquote>  Este relat√≥rio ilustra perfeitamente o princ√≠pio que estamos tentando aderir nas confer√™ncias da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ontiko</a> - para receber experi√™ncia mundial de especialistas em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">l√≠ngua russa</a> .  E o ponto n√£o est√° apenas em uma poss√≠vel barreira do idioma, mas na cultura que estamos acostumados a compartilhar detalhes t√©cnicos.  Em novembro, Vasily <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">se apresentar√°</a> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HighLoad ++</a> novamente, e ele se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">juntar√° a</a> , por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artemy Kolesnikov</a> do Facebook, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vittorio Cioe</a> da Oracle e, √© claro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Petr Zaitsev</a> da Percona.  Tamb√©m teremos relat√≥rios em ingl√™s, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">assinaremos</a> a newsletter - informaremos quando novos ser√£o adicionados aos quarenta relat√≥rios aceitos. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464305/">https://habr.com/ru/post/pt464305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464291/index.html">As 10 linguagens de programa√ß√£o mais influentes dos √∫ltimos 50 anos e seus criadores</a></li>
<li><a href="../pt464293/index.html">Os ganchos s√£o substitu√≠dos no React Redux?</a></li>
<li><a href="../pt464295/index.html">Exemplos de uso de alguns novos recursos JavaScript</a></li>
<li><a href="../pt464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../pt464303/index.html">Dados de s√©ries temporais em um DBMS relacional. Extens√µes TimescaleDB e PipelineDB for PostgreSQL</a></li>
<li><a href="../pt464307/index.html">Teste de integra√ß√£o de microsservi√ßos no Scala</a></li>
<li><a href="../pt464309/index.html">Bot√£o de chamada DIY. Raspberry Pi, MajorDoMo, Freeswitch e Linphonec</a></li>
<li><a href="../pt464315/index.html">O filme em que havia solo. Pesquisa Yandex e um breve hist√≥rico de pesquisa por significado</a></li>
<li><a href="../pt464317/index.html">Projeto Konbanwa</a></li>
<li><a href="../pt464325/index.html">Como o Scrumban une o melhor das metodologias Kanban e Scrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>