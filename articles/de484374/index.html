<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüîß ü•´ üêª Reise in die Mitte ... Hafenarbeiter Bild. Oder wie man ein Bild aus der Registrierung ohne Andockfenster herunterl√§dt üë®üèº‚Äçüåæ üßëüèª‚Äçü§ù‚Äçüßëüèª üë®üèª‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="3 Tage vor dem neuen Jahr gab es eine Aufgabe, unsere Software √ºber den Manager auf einem Flash-Laufwerk auf den Client zu √ºbertragen. Software ist ei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reise in die Mitte ... Hafenarbeiter Bild. Oder wie man ein Bild aus der Registrierung ohne Andockfenster herunterl√§dt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484374/"><p>  3 Tage vor dem neuen Jahr gab es eine Aufgabe, unsere Software √ºber den Manager auf einem Flash-Laufwerk auf den Client zu √ºbertragen.  Software ist eine Microservice-Plattform mit mehreren Dutzend Docker-Bildern mit vielen Einstellungen und einer kilometerlangen Helmkarte.  Was wir hatten: </p><br><ul><li>  Manager in Moskau (ich komme nicht von dort) </li><li>  Windows </li><li>  Es gibt keine direkte Interaktion (und wenn ja, hat es nicht wirklich geholfen) </li><li>  Hafenarbeiter Nr </li></ul><br><p>  Pff, dachte ich!  Ich nehme Golang, schreibe ein Programm, kompiliere f√ºr Windows. <br>  ... und 5 Stunden sp√§ter erkannte ich die Eile meiner Schlussfolgerungen.  In diesem Moment erinnerte sich Nelsons Lachen zum ersten Mal.  HA HA!  Das hat mich die ganze Zeit verfolgt, in der ich mich mit dem Thema befasst habe. <a name="habracut"></a></p><br><p>  Die meisten Beispiele, die ich gefunden habe, erfordern dockerd.  Zwei Skripte ohne Dockerd, die nach einer Stunde googeln gefunden wurden, <a href="" rel="nofollow">eins</a> und <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">zwei</a> .  Die erste Option hat mir geholfen, den Vorgang des Erlangens aller Bildebenen und Konfigurationsdateien zu verstehen, aber es ist unm√∂glich, sie mit Windows zu verwenden.  Und die zweite Option zeigte an, dass nicht nur verschiedene Hashes auf dem Bildschirm flackerten, speziell dieses <a href="https://github.com/NotGlop/docker-drag/blob/69b2bae59c6c0a5cbdf224feb9c067e3edcc6068/docker_pull.py" rel="nofollow">FIXME</a> .  Man k√∂nnte nat√ºrlich dort aufh√∂ren, es funktioniert!  Transfer zum Mitnehmen ist nicht schwierig.  Aber wie kann man √ºberpr√ºfen, ob die Bilder des Managers dieselbe Form haben wie in unserer Registrierung?  Aber auf keinen Fall!  Aus diesem Grund habe ich nur Bilder in den freigegebenen Speicher hochgeladen, mit dem Befehl docker save heruntergeladen und den Link freigegeben.  Und beruhigte sich dar√ºber. </p><br><p>  Am vierten Tag der Ferien, ziemlich m√ºde von ihnen, <a href="https://github.com/moby/moby" rel="nofollow">√ºberfiel</a> mich die Idee, das Docker-Image korrekt herunterzuladen und zusammenzusetzen, wieder und ich tauchte f√ºr ein paar Stunden in den <a href="https://github.com/moby/moby" rel="nofollow">Moby-</a> Code ein. </p><br><p>  Was ich diesmal hatte: </p><br><ul><li>  Verstehen, wie man alle Schichten erh√§lt </li></ul><br><p>  Ich habe Python "in die Hand genommen" und basierend auf diesem <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">Skript</a> beschlossen, es zu beheben.  Am zweiten Tag beschloss ich, ein Drehbuch von Grund auf neu zu schreiben.  Ich erinnerte mich an mein Handwerk zur Autorisierung und kopierte einfach einen Teil des Codes von dort sowie die Entwicklungen, die ich bereits bei der Bearbeitung des Skripts gemacht hatte.  Es gab keine Probleme mit der Autorisierung und dem Herunterladen dieser Daten, aber es stellten sich Fragen: </p><br><ul><li>  Welche Hashes werden angezeigt, wenn der Docker Pull-Befehl ausgef√ºhrt wird? </li><li>  Mit welchen Hashes werden Verzeichnisse im Image-Tarball benannt? </li><li>  Wie erstelle ich ein Tar-Archiv, damit die Pr√ºfsumme mit dem Original-Image √ºbereinstimmt? </li></ul><br><p> F√ºr das Studium habe ich ein Ubuntu-Bild ausgew√§hlt: 18.04 <br>  sha256sum Bild √ºber <code>docker save</code> gespeichert <code>docker save</code> - 257cab9137419a53359d0ed76f680fe926ed3645238357bdcdb84070a8f26cd0. </p><br><pre> <code class="plaintext hljs">&gt; docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 2746a4a261c9: Downloading [==============&gt; ] 6.909MB/26.69MB 4c1d20cdee96: Download complete 0d3160e1d0de: Download complete c8e37668deea: Download complete Digest: sha256:250cc6f3f3ffc5cdaa9d8f4946ac79821aafb4d3afc93928f0de9336eba21aa4 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04</code> </pre> <br><p>  <strong>Bild-Tarball-Inhalt</strong> </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0 root root 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0 root root 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0 root root 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0 root root 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0 root root 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0 root root 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0 root root 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0 root root 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0 root root 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0 root root 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0 root root 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0 root root 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0 root root 432 Jan 1 1970 manifest.json -rw-r--r-- 0 root root 88 Jan 1 1970 repositories</code> </pre> <br><p>  <strong>Bildkonfiguration</strong> </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"rootfs"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"layers"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"diff_ids"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"sha256:2dc9f76fb25b31e0ae9d36adce713364c682ba0d2fa70756486e5cedfaf40012"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:9f3bfcc4a1a8a676da07287a1aa6f2dcc8e869ea6f054c337593481a5bb1345e"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:27dd43ea46a831c39d224e7426794145fba953cd7309feccf4d5ea628072f6a2"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:918efb8f161b4cbfa560e00e8e0efb737d7a8b00bf91bb77976257cd0014b765"</span></span> ] } ... }</code> </pre> <br><p>  Die erste Frage wurde schnell genug gekl√§rt, die Dokumentation <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/config.md</a> half.  Die Hashes, die angezeigt werden, wenn Sie den Docker-Pull-Befehl ausf√ºhren, sind chainIDs, die aus der diff_ids-Liste des Image-Config-Manifests berechnet werden, wobei die erste chainID immer die erste aus der diff_ids-Liste ist und die nachfolgenden Hashsummen aus der Zeichenfolge <code>(chain_id[i-1] + " " + diff_id[i])</code> .  Code zum Erstellen von chainID chainID: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chain_ids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: list)</span></span></span><span class="hljs-function"> -&gt; list:</span></span> chain = list() chain.append(ids[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(ids) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ids nxt = list() nxt.append(<span class="hljs-string"><span class="hljs-string">"sha256:"</span></span> + hashlib.sha256(<span class="hljs-string"><span class="hljs-string">f'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">'</span></span>.encode()).hexdigest()) nxt.extend(ids[<span class="hljs-number"><span class="hljs-number">2</span></span>:]) chain.extend(chain_ids(nxt)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> chain</code> </pre> <br><p>  Das Hinzuf√ºgen eines Pr√§fixes mit dem Namen des Algorithmus, in diesem Fall "sha256:", ist obligatorisch und geh√∂rt zu den Anforderungen des opencontainers-Standards, d.h.  Die Zeichenfolge sollte die Form "Algorithmus: Hash" haben. </p><br><p>  Er verbrachte zwei Abende mit der Frage nach der Benennung eines Verzeichnisses.  Lange genug habe ich mir den Quellcode von docker-daemon und Oh!  ein wunder!  Ich habe es geschafft, den Generierungscode <a href="" rel="nofollow">hier</a> und <a href="" rel="nofollow">hier zu finden</a> .  Um den Verzeichnisnamen zu generieren, m√ºssen Sie den Hash aus der Konfiguration der JSON-Ebene berechnen.  Docker hat mehrere Konfigurationsversionen und vor Docker Engine 1.9 wurden Konfigurationen der Version v1 verwendet.  Gesagt, getan!  Und wieder entsteht die Silhouette von Nelson.  Nach einem kurzen Debug wurde mir klar, dass sich das Problem in der Generation von Json versteckt.  In Python kann sich die Reihenfolge der Daten in einem W√∂rterbuch von der Reihenfolge der Daten in json unterscheiden, die aus diesem W√∂rterbuch generiert wurden.  Die Reihenfolge der Daten in json ist unterschiedlich, und dementsprechend ist auch der Hash unterschiedlich.  Ich musste zu OrderedDict gehen und dort die gew√ºnschte Datenreihenfolge vorregistrieren.  Dies erh√∂hte die Codegr√∂√üe um das Eineinhalbfache. </p><br><p>  Es scheint, dass alles korrigiert ist, ich f√ºhre das Skript aus und ... irgendwo tief im Inneren taucht das ber√ºchtigte HA-HA auf!  Der letzte Hash stimmt nicht √ºberein.  Ich studiere noch einmal den Code und <a href="" rel="nofollow">sehe</a> , und dies ist eine andere v1-config, die alle Informationen √ºber das Image enth√§lt, die mit dem <code>docker inspect</code> .  F√ºgen Sie ein weiteres OrderDict speziell f√ºr ihn hinzu, erg√§nzen Sie den Code und ... HA HA! <br>  Es war bereits 5 Uhr morgens und mein Kopf dachte nicht wirklich nach, also kehrte ich nach dem Schlafen zum Anzeigen des Codes zur√ºck.  Beim wiederholten Betrachten des Generierungscodes wurde eine <a href="" rel="nofollow">Zeile angezeigt</a> .  Wie froh, dass ich das gesehen habe.  Bevor ich sie sah, dachte ich daran, meinen Hafenarbeiter damit zu bauen <del>  Black Jack und </del>  Datenerfassung.  Ich schalte Debug ein, f√ºhre den <code>docker save</code> und ... es ist √ºberhaupt nicht lustig, in docker-desktop f√ºr Mac OS gibt es eine Begrenzung der Zeilenl√§nge im Protokoll von 947 Zeichen und die generierte Konfiguration bricht auf <code>\"</code> . Nachdem ich alle diese Schritte in Linux ausgef√ºhrt habe, habe ich es geschafft, die Konfiguration zu erhalten Ebene der ersten Version, auf deren Basis ich den Code geschrieben habe, und ich habe es geschafft, den gew√ºnschten Hash der letzten Ebene zu erhalten. Die Hashs f√ºr alle Dateien sind die gleichen, die Verzeichnisse werden auf die gleiche Weise benannt wie das Original-Image. Es ist Zeit, ein Tar-Archiv zu erstellen ... HAHA! </p><br><p>  Die Dateigr√∂√üe stimmt nicht √ºberein, lesen Sie <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/layer.md</a> und das <a href="https://www.gnu.org/software/tar/manual/html_node/Standard.html" rel="nofollow">tar-Archivformat</a> .  <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">Der Standardwert ist</a> 10240 Bytes und die Gr√∂√üe des von mir gesammelten Archivs ist 9216 Bytes gr√∂√üer.  Zuerst dachte ich, es sei notwendig, die Blockgr√∂√üe auf 1024 Bytes zu reduzieren, was sich als falsch herausstellte. Infolgedessen entsprach die Blockgr√∂√üe von 512 Bytes der Gr√∂√üe der Archive. </p><br><pre> <code class="python hljs">tarfile.RECORDSIZE = <span class="hljs-number"><span class="hljs-number">512</span></span></code> </pre> <br><p>  Die erste Zeile des neu erstellten Archivs enth√§lt den Stammordner "/".  Diese Option ist nicht geeignet, daher erg√§nze ich den Code, indem ich den Inhalt des Ordners scanne und ihn einzeln zum Archiv hinzuf√ºge, nachdem ich ihn zuvor sortiert habe. </p><br><p>  Schlie√ülich ist es uns gelungen, die gleiche Dateigr√∂√üe und ein einheitliches Erscheinungsbild der Verzeichnisse zu erzielen, aber das ist noch nicht alles.  Dateien und Verzeichnisse m√ºssen mit Ausnahme von manifest.json und respoitories die Attribute st_atime im Archiv haben, st_mtime gleich st_ctime.  F√ºr manifest.json- und respoitories-Dateien m√ºssen die Attribute st_atime, st_mtime und st_ctime auf den Beginn der √Ñra <code>1970-01-01 00:00</code> datiert sein.  Alle Daten m√ºssen entsprechend der Zeitzone eingestellt werden.  Da ich alle Arbeiten unter Mac OS ausgef√ºhrt habe, ist mir ein Unterschied aufgefallen.  Beim Speichern des Images unter Linux sah die Liste der Dateien im Archiv folgenderma√üen aus: </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0/0 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0/0 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0/0 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0/0 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0/0 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0/0 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0/0 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0/0 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0/0 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0/0 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0/0 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0/0 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0/0 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0/0 432 Jan 1 1970 manifest.json -rw-r--r-- 0/0 88 Jan 1 1970 repositories</code> </pre> <br><p>  Im Gegensatz zu der Liste am Anfang des Artikels wird das Archiv unter Linux mit dem Nur-Zahlen-Flag gespeichert.  Das daf√ºr verantwortliche tarinfo-Objekt enth√§lt zwei Variablen, tarinfo.uname und tarinfo.gname.  Das zweite Problem bei Mac OS ist das Fehlen einer Stammgruppe. Es wird mit der Variablen tarinfo.gid im selben tarinfo-Objekt behoben.  Nun, alles scheint ein Archiv zu schaffen ... </p><br><p><img src="https://habrastorage.org/webt/hp/p8/pl/hpp8plcgi09ybuarim4bb5awcga.jpeg"></p><br><p>  F√ºr alle Dateien konvergiert der Hash, die Namen der Verzeichnisse und Dateien sind gleich, die Attribute st_atime, st_mtime und st_ctime konvergieren mit dem Original, die Rechte an den Dateien sind exakt gleich.  Beim √ñffnen beider Archive in einem Hex-Editor wurde ein kleiner Unterschied festgestellt: </p><br><p><img src="https://habrastorage.org/webt/qc/j6/xm/qcj6xmv9ghzaesgeaaq5owvaxnm.png"><br>  Das obere Fenster ist das Original, das untere Archiv habe ich gesammelt. </p><br><p>  Das tar-Format verstehen.  Nach dem Namen des Verzeichnisses steht der Wert der Rechte an der Datei (oranges Rechteck).  Der Unterschied besteht darin, dass Informationen √ºber das zum Archiv hinzugef√ºgte Objekt nicht zu den Verzeichnisrechten hinzugef√ºgt werden.  Ein in den Rechten angegebener Wert von 40755 gibt an, dass dies ein Verzeichnis mit Berechtigungen von 755 ist, und 100644 ist eine Datei mit Rechten von 644. Das rote Rechteck ist ein magischer String und wird nach dem Tarfile-Code, dem magischen String <code>ustar\000</code> , nur in den Formaten PAX und USTAR verwendet.  Das PAX-Format passt √ºberhaupt nicht, es verwendet eine spezielle Art von Header.  Das blaue Rechteck ist eine Pr√ºfsumme und unterscheidet sich durch die Verwendung unterschiedlicher Formate zum Schreiben von Rechten auf eine Datei und Magic-Header. </p><br><p>  Ich √§ndere das Archivformat auf USTAR, aber es ist nicht klar, was ich mit den Dateiberechtigungen anfangen soll.  Hier und <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">hier</a> passiert Magie f√ºr mich, ich habe noch nie mit dem Oktalsystem gearbeitet und ich verstehe nicht, warum das kaufm√§nnische Und hier ben√∂tigt wird (jeder kann sein Wissen in den Kommentaren teilen).  Ich musste mehrere Drucke hinzuf√ºgen, um zu sehen, welche Daten mit Argumenten ankommen und welche Daten zur Bildung des Archivblocks verwendet werden.  Nimmt man eine Ganzzahl von der zweiten Position des Datenblocks, war es 16877, und f√ºhrt sie zur Oktalrechnung, stellt sich heraus, dass dieser Wert <code>0o40755</code> , was <code>0o40755</code> das ist <code>0o40755</code> was ich brauche.  Nachdem ich nur die Funktionen get_info und _create_header √ºberschrieben und <code>&amp; 0o7777</code> aus ihnen <code>&amp; 0o7777</code> hatte (mir fiel nichts anderes ein), gelang es mir, ein tar-Archiv mit einem sha256-Hash zu sammeln, der mit dem urspr√ºnglichen √ºbereinstimmte. </p><br><p>  PS Beim Schreiben eines Artikels wurde das Bild von Ubuntu aktualisiert: 18.04 auf hub.docker.com.  Also musste ich das Bild auf Digest herunterladen.  Die Hash-Summen stimmen nicht mehr mit dem Original √ºberein, da Digest anstelle des Tags geschrieben wurde, da es sich ansonsten um identische Bilder handelte. </p><br><p>  Die zweite Entdeckung f√ºr mich war das Fehlen einer Repository-Datei im Archiv, wenn ein Bild mit einem fehlenden Tag mit dem <code>docker save</code> gespeichert wurde. </p><br><p>  Voller Arbeitscode hier: <a href="https://github.com/myback/docker_pull" rel="nofollow">https://github.com/myback/docker_pull</a> </p><br><p>  Bild von Nelson Manz, sowie sein Lachen "HA-HA" ist Eigentum von FOX :) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484374/">https://habr.com/ru/post/de484374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484356/index.html">Ein interessantes Projekt in einem freundlichen Team, oder wie viel kostet der richtige Mitarbeiter?</a></li>
<li><a href="../de484358/index.html">Portfoliomanagement in R</a></li>
<li><a href="../de484364/index.html">Mit 26 Jahren leitet Yana Harlan die Entwicklung einer Raumfahrtmaschine. N√§chstes Jahr planen sie den Start.</a></li>
<li><a href="../de484370/index.html">Slurm SRE - lernen, die Zufriedenheit der Benutzer zu gew√§hrleisten</a></li>
<li><a href="../de484372/index.html">Smart House mit Xiaomi am Beispiel einer Sauna</a></li>
<li><a href="../de484376/index.html">Samsung Moskauer Zentrum f√ºr K√ºnstliche Intelligenz in Mitarbeitergeschichten</a></li>
<li><a href="../de484378/index.html">SwayWM - UnixPorn Yourself</a></li>
<li><a href="../de484380/index.html">Umzug - das letzte Jahrhundert! Alternativen zu std :: move in ‚ÄûC ++ der Zukunft‚Äú</a></li>
<li><a href="../de484382/index.html">Bellman-Ford-Algorithmus</a></li>
<li><a href="../de484386/index.html">AWS_Ru Meetup bei der Raiffeisenbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>