<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ üë®‚Äçüî¨ ü•Ç P√°ginas sob o cap√¥ Turbo: arquitetura da tecnologia de download r√°pido de p√°ginas da Web ‚¨ÖÔ∏è üë©‚Äçüë©‚Äçüëß‚Äçüëß üõÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, meu nome √© Stas Makeev. Na Yandex, lidero o desenvolvimento de tecnologia para p√°ginas Turbo, que fornece carregamento r√°pido de conte√∫do, mesmo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>P√°ginas sob o cap√¥ Turbo: arquitetura da tecnologia de download r√°pido de p√°ginas da Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/460373/">  Ol√°, meu nome √© Stas Makeev.  Na Yandex, lidero o desenvolvimento de tecnologia para p√°ginas Turbo, que fornece carregamento r√°pido de conte√∫do, mesmo com uma conex√£o lenta.  Hoje vou contar aos leitores de Habr um pouco sobre a arquitetura do nosso projeto. <br><br>  A felicidade do usu√°rio √© amplamente influenciada pela rapidez com que ele v√™ o conte√∫do da p√°gina da web.  A velocidade preocupa muitos: na loja de aplicativos para dispositivos m√≥veis, apenas o Speedtest possui mais de cem milh√µes de instala√ß√µes.  Fornecedores, operadoras de celular, desenvolvedores de sites e aplicativos se esfor√ßam para fornecer o acesso mais r√°pido ao conte√∫do, para que os clientes fiquem satisfeitos. <br><br>  A velocidade m√©dia de download nas redes m√≥veis russas √© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">16,26 Mbit / s</a> - este √© um bom indicador.  Mas a velocidade da conex√£o √© desigual, ainda estamos enfrentando uma conex√£o lenta √† Internet - 3G, 2G, EDGE.  Certamente voc√™ estava em uma situa√ß√£o em que, em um caf√© ou shopping center, na estrada ou em uma casa de campo, a velocidade habitualmente alta √© bastante reduzida: os locais s√£o carregados por dezenas de segundos ou at√© mais. <br><br>  A tecnologia Turbo-page resolve o problema de acesso ao conte√∫do, inclusive em velocidades de conex√£o baixas ou inst√°veis.  Isso √© importante para os propriet√°rios de sites que t√™m uma porcentagem reduzida de visitantes "caindo" durante a transi√ß√£o da pesquisa. <br><br><img src="https://habrastorage.org/webt/r5/du/oe/r5duoeno8m1eogct3fsti4qgupc.png"><br><a name="habracut"></a><br><h2>  Como funcionam as p√°ginas Turbo </h2><br>  O propriet√°rio do site registra o feed RSS no Yandex.Webmaster.  O feed entra no sistema de conte√∫do do Turbo Pages, que leva atualiza√ß√µes a cada poucos minutos.  Conte√∫do pesado - principalmente fotos e v√≠deos - armazenamos e armazenamos em cache em uma CDN.  Al√©m do RSS, o conte√∫do pode ser transmitido atrav√©s da API e do autoparser. <br><blockquote>  O volume de imagens em cache das p√°ginas Turbo est√° chegando a 100 Tb </blockquote><br>  A confiabilidade e a toler√¢ncia a falhas do sistema s√£o importantes para n√≥s; portanto, fazemos v√°rias r√©plicas dos dados e as armazenamos em nossos tr√™s datacenters.  Em cada data center, centenas de servidores processam milhares de solicita√ß√µes por segundo, o que permite equilibrar a carga de maneira flex√≠vel. <br><br>  O sistema de conte√∫do do Turbo Pages merece uma postagem separada, e n√≥s a escreveremos.  Por enquanto, nos restringimos a um esquema simplificado. <br><br><img src="https://habrastorage.org/webt/yu/s8/5g/yus85gt3p8lf4_91p87latqspac.png"><br><br><h2>  O que acontece quando voc√™ abre um URL em um navegador? </h2><br>  Quando o usu√°rio acessa a p√°gina Turbo, algo como o seguinte acontece "sob o cap√¥": <br><br><img src="https://habrastorage.org/webt/pw/g0/8w/pwg08wrb3dnoc5cozornpe_6uco.png"><br><br>  <b>O adaptador HTTP</b> processa a solicita√ß√£o HTTP do usu√°rio e faz uma solicita√ß√£o no gr√°fico desejado no AppHost e no renderizador de relat√≥rios. <br><br>  <b>O AppHost</b> √© um componente especial que encapsula a intera√ß√£o de fontes na rede, descrita como um gr√°fico de depend√™ncia.  As fontes s√£o interrogadas na ordem de classifica√ß√£o topol√≥gica neste gr√°fico; toda a l√≥gica de neg√≥cios √© costurada nelas e na configura√ß√£o do gr√°fico.  Em particular, no n√≠vel do gr√°fico, o armazenamento KV √© pesquisado e uma solicita√ß√£o de dados √© enviada para APIs de terceiros. <br><br>  <b>O renderizador de relat√≥rio</b> √© um aplicativo escrito em node.js que aceita entrada JSON, executa modelos gravados em JS e retorna uma sequ√™ncia. <br><br>  Tudo isso acontece quase instantaneamente. <br><br><h2>  O que afeta a velocidade do download? </h2><br>  Estamos trabalhando em todos os aspectos da velocidade: da implementa√ß√£o do HTTP / 2 no balanceador e da otimiza√ß√£o do handshake TLS √† otimiza√ß√£o manual do SVG.  Nesse caso, voc√™ precisa entender de que √© composta a velocidade do usu√°rio final. <br><br>  Dentro da equipe, distinguimos tr√™s est√°gios do processamento de solicita√ß√µes: servidor, rede e cliente. <br><br>  <b>Servidor</b> <br><br>  Isso inclui tudo o que acontece nos datacenters: desde o momento em que a solicita√ß√£o HTTP chega ao nosso servidor at√© a gera√ß√£o da p√°gina HTML, que √© enviada diretamente ao cliente. <br><br>  O tempo de processamento da solicita√ß√£o no servidor deve ser m√≠nimo.  Apesar dos valores relativamente pequenos, afeta absolutamente todas as consultas do usu√°rio.  Al√©m disso, todos os processos ocorrem em nosso ambiente controlado - simplesmente n√£o pode haver desculpas para grandes atrasos. <br><br>  O tempo do servidor consiste em intera√ß√µes de rede entre os v√©rtices do gr√°fico de depend√™ncia de origem e os tempos de opera√ß√£o de cada um dos v√©rtices.  Mas n√£o focaremos nos recursos da infraestrutura de rede dos datacenters Yandex - eles merecem uma postagem separada. <br><br>  Eu gostaria de prestar mais aten√ß√£o ao segundo componente - o tempo de execu√ß√£o de cada um dos picos.  Como exemplo, vamos dar uma olhada em nossos princ√≠pios e ferramentas para trabalhar com o componente Report-renderer, respons√°vel pela gera√ß√£o de HTML.  Para outros componentes, eles s√£o muito semelhantes. <br><br>  Em nosso processo de IC, existem tarefas que aceitam solicita√ß√µes pull no dev, que executam verifica√ß√µes b√°sicas para cada confirma√ß√£o na ramifica√ß√£o do recurso.  Se algum indicador exceder os limites especificados, a influ√™ncia no dev ser√° congelada at√© que os motivos sejam esclarecidos. <br><br>  M√©tricas principais nesta fase: <br><br><ul><li>  hora do modelo; </li><li>  tamanho da p√°gina de resumo; </li><li>  tamanho de arquivos est√°ticos. </li></ul><br>  Coletamos estat√≠sticas do cliente (CSS e JS) para cada p√°gina, dependendo dos dados, mas os pacotes configur√°veis ‚Äã‚Äãcom os pr√≥prios blocos s√£o independentes da solicita√ß√£o, portanto, basta comparar o tamanho dos arquivos na ramifica√ß√£o com arquivos semelhantes no dev.  Para diferentes tipos de arquivos, definimos diferentes valores limite, ap√≥s os quais a tarefa n√£o pode ser despejada no dev sem "OK" dos respons√°veis ‚Äã‚Äãpela velocidade. <br><br>  Como regra, h√° uma an√°lise conjunta do c√≥digo e procura maneiras de otimizar. <br><br>  Temos que agir de maneira diferente com as m√©tricas de tamanho da p√°gina e o tempo do modelo, pois elas s√£o altamente dependentes de uma solicita√ß√£o espec√≠fica e √© necess√°rio algum tipo de certeza estat√≠stica.  Al√©m disso, voc√™ n√£o pode fazer consultas sint√©ticas, porque essas ser√£o medidas desonestas.  Portanto, constantemente coletamos solicita√ß√µes aleat√≥rias de usu√°rios para logs de acesso, formamos "cartuchos" deles e "disparamos" neles com padr√µes no ramo com altera√ß√µes e com o desenvolvedor.  Isso permite capturar altera√ß√µes mesmo em solicita√ß√µes n√£o muito populares. <br><br>  Temos v√°rios "cestos de pedidos" que nos permitem cobrir a maior parte do tr√°fego para as p√°ginas Turbo. <br><br>  Al√©m de otimizar nossos modelos, seguimos as otimiza√ß√µes que ocorrem na V8.  Por exemplo, a mudan√ßa para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TurboFan</a> produziu excelentes resultados: o tempo de modelagem no servidor foi reduzido significativamente. <br><br><img src="https://habrastorage.org/webt/tz/pd/kx/tzpdkxmsqdg8x5sonpthevid_nk.png"><br>  O tempo de modelagem do servidor diminuiu ap√≥s a mudan√ßa para o TurboFan <br><br>  <b>Rede</b> <br><br>  Na parte da rede, inclu√≠mos tudo o que acontece entre o cliente e o servidor: tempo de transfer√™ncia de dados, tamanho da p√°gina e est√°tica, al√©m de cache de recursos.  Isso j√° √© mais interessante, porque a partir de nossos aconchegantes data centers nos encontramos no mundo selvagem, onde nem tudo depende de n√≥s.  As medi√ß√µes se tornam um pouco mais complicadas e o mais importante - voc√™ pode obter resultados realmente tang√≠veis em centenas de milissegundos. <br><br>  Aqui est√° o que fazemos. <br><br>  Torcemos os par√¢metros TCP e TLS, que permitem ganhar v√°rios RTT (Round Trip Time), proporcionando excelentes resultados em redes com alta lat√™ncia.  Nossos colegas j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escreveram</a> sobre isso, ent√£o n√£o vou me aprofundar. <br><br>  O tamanho dos dados transmitidos pode afetar bastante a velocidade do download, por isso tentamos enviar apenas o que a p√°gina atual precisa da maneira mais eficiente. <br><br>  As imagens em nossas interfaces s√£o otimizadas usando o ImageOptim.  Para otimizar o SVG, usamos n√£o apenas o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SVGO</a> , mas tamb√©m n√£o temos pregui√ßa de analisar o conte√∫do e, se poss√≠vel, otimiz√°-lo manualmente. <br><br>  Carregamos imagens dos propriet√°rios do site em uma CDN especial, otimizada para a renderiza√ß√£o de imagens.  Recortamos o perfil exif e de cores da imagem, primeiro convertendo a imagem em sRGB.  A taxa de bits √© reduzida para 8 bits por canal, o n√≠vel de compress√£o √© definido como 85. O filtro lanczos √© usado para redimensionar. <br><br>  Criamos dezenas de op√ß√µes para cada imagem para uma combina√ß√£o de diferentes tamanhos de tela, levando em considera√ß√£o a densidade de pixels (telas de retina).  E, √© claro, codificamos automaticamente imagens no formato WebP, se suportadas pelo navegador. <br>  Os formatos de texto (HTML, JavaScript, CSS) s√£o compactados usando gzip / zopfli e brotli, se o navegador suportar. <br><br>  √â importante n√£o esquecer a dist√¢ncia dos usu√°rios dos servidores.  As p√°ginas Turbo s√£o usadas em muitas regi√µes e o conte√∫do pode ser qualquer um.  Portanto, n√£o comprometemos e reduzimos a lat√™ncia, mesmo nas regi√µes mais remotas que usamos CDN, que est√° em constante expans√£o. <br><br>  E, claro, a consulta mais r√°pida √© que eles n√£o fazem nada.  Todas as est√°ticas s√£o fornecidas com o cache eterno de um dom√≠nio separado sem cookies e, para aumentar o acerto do cache, ainda pode ser adicionalmente aquecido na p√°gina principal e na p√°gina com os resultados da pesquisa. <br><br>  <b>Cliente</b> <br><br>  N√£o basta formar uma resposta do servidor e entreg√°-la ao navegador pela rede, ele ainda precisa ser mostrado com efic√°cia.  Otimizamos o hor√°rio de in√≠cio da renderiza√ß√£o da p√°gina para que a pessoa comece a ler o conte√∫do mais rapidamente. <br><br>  No cabe√ßalho HTML, "aquecemos" a conex√£o com nossos servidores de distribui√ß√£o est√°tica e a pr√©-carregamos adicionalmente.  Estilos embutidos na p√°gina, o que permite que o navegador comece a renderizar a p√°gina sem aguardar o carregamento dos estilos pela rede. <br><br>  Imagens de conte√∫do, incorpora√ß√µes e an√∫ncios n√£o s√£o carregados imediatamente, mas quando eles leem a p√°gina, quando se aproximam do campo de vis√£o do usu√°rio. <br><br>  O JavaScript √© parcialmente incorporado ao HTML e todos os outros scripts s√£o carregados no final com solicita√ß√µes HTTP separadas.  Os scripts cr√≠ticos para iniciar, a cole√ß√£o de erros e m√©tricas, bem como os componentes que geralmente n√£o s√£o encontrados na p√°gina, s√£o incorporados na p√°gina. <br><br>  Coletamos m√©tricas de carregamento de p√°gina RUM.  O mais cr√≠tico: o tempo at√© o primeiro byte, o primeiro desenho e o in√≠cio da interatividade, quando todos os scripts conclu√≠ram a inicializa√ß√£o e o usu√°rio pode usar a p√°gina. <br><br>  A maioria dos usu√°rios n√£o acessa as p√°ginas Turbo diretamente, mas de outros servi√ßos Yandex, e quer√≠amos avaliar o tempo de carregamento da p√°gina no contexto da experi√™ncia do usu√°rio.  N√£o apenas obtendo tempo abstrato no v√°cuo, mas uma m√©trica de como o usu√°rio v√™ tudo. <br><br>  Por isso, formulamos a m√©trica de velocidade integral: <br> <code>max (firstContentfulPaint, firstImageLoadTime, timeToVisible) ‚Äî timeToClick</code> <br> <br>  Onde: <br><br><ul><li>  timeToClick - tempo absoluto de clique que levou √† exibi√ß√£o da p√°gina Turbo.  Pode ser um clique em um trecho na p√°gina de resultados da pesquisa ou em um cart√£o no Yandex.Zen. </li><li>  firstImageLoadTime - tempo de carregamento absoluto da primeira imagem de conte√∫do na primeira tela. </li><li>  timeToVisible - o tempo absoluto em que a p√°gina entra no estado vis√≠vel.  Isso ocorre nos casos em que a p√°gina foi carregada em segundo plano. </li></ul><br>  E obteve uma m√©trica de experi√™ncia do usu√°rio: <br><br><ul><li>  se 2/3 da tela estiver ocupada por uma imagem que ainda n√£o foi carregada, a integridade da primeira m√©tricaContentfulPaint ser√° bastante duvidosa; </li><li>  existem muitos manipuladores de eventos nos links, entre o clique e o hor√°rio de in√≠cio real da p√°gina que carrega um hor√°rio diferente de zero, o que eu gostaria de entender. </li></ul><br><img src="https://habrastorage.org/webt/zb/kx/m_/zbkxm_or2yhbbupxfcrk9ugzbic.png"><br><br>  Estamos constantemente desenvolvendo tecnologia para que os sites atraiam mais visitantes.  Agora, uma p√°gina Turbo carrega em m√©dia 15 vezes mais r√°pido que uma vers√£o m√≥vel comum.  Dezenas de milhares de sites usam o Turbo, e o n√∫mero total de visitas a eles √© superior a 12 bilh√µes. <br><br>  Tudo isso √© resultado do trabalho de desenvolvedores, servi√ßos de suporte, gerentes que trabalham com propriet√°rios de sites e muitos outros.  Com o tempo, a equipe, √© claro, se expande.  Por exemplo, agora estamos procurando especialistas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em front-end e back-end</a> e teremos prazer em conhecer novos colegas. <br><br>  Quais componentes da tecnologia Turbo Page voc√™ gostaria de ler materiais t√©cnicos mais detalhados no futuro?  Em que experi√™ncia voc√™ estaria interessado?  Tamb√©m receberemos feedback e id√©ias.  Obrigada </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460373/">https://habr.com/ru/post/pt460373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460359/index.html">Young Game Designer 2 Course: Balanceando Progress√£o e Din√¢mica sem Matem√°tica</a></li>
<li><a href="../pt460361/index.html">√ìtimas perguntas frequentes sobre seguran√ßa cibern√©tica de sistemas de informa√ß√µes m√©dicas</a></li>
<li><a href="../pt460363/index.html">7 fatores ausentes na abordagem 12 Factor App</a></li>
<li><a href="../pt460365/index.html">Rastreio distribu√≠do: fizemos tudo errado</a></li>
<li><a href="../pt460367/index.html">Engenharia do Caos: a arte da destrui√ß√£o intencional. Parte 1</a></li>
<li><a href="../pt460375/index.html">Livro "Aprendizado de m√°quina para neg√≥cios e marketing"</a></li>
<li><a href="../pt460377/index.html">Usando o Liquibase para gerenciar a estrutura do banco de dados em um aplicativo Spring Boot. Parte 1</a></li>
<li><a href="../pt460381/index.html">O que √© assertividade e por que √© necess√°rio</a></li>
<li><a href="../pt460383/index.html">As transi√ß√µes de tela em Legend of Zelda usam os recursos n√£o documentados do NES</a></li>
<li><a href="../pt460387/index.html">Guia do Iniciante do SELinux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>