<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👹 🍅 🔓 在微控制器上使用和测试C ++代码的功能 🌁 😷 ☝🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="碰巧，使用微控制器的主要语言是C。上面写了许多大型项目。但是生活不会停滞不前。长期以来，现代开发工具在为嵌入式系统开发软件时便能够使用C ++。但是，这种方法仍然很少。不久前，我在另一个项目上工作时尝试使用C ++。我将在本文中讨论这种经验。
 
 
 
 参赛作品
 
 我对微控制器的大部分工作都...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在微控制器上使用和测试C ++代码的功能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/390837/"><img src="https://habrastorage.org/files/38e/0cb/e8e/38e0cbe8e4c0498cadd1c9a0d51a0a6f.png" align="left" width="150"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">碰巧，使用微控制器的主要语言是C。上面写了许多大型项目。</font><font style="vertical-align: inherit;">但是生活不会停滞不前。</font><font style="vertical-align: inherit;">长期以来，现代开发工具在为嵌入式系统开发软件时便能够使用C ++。</font><font style="vertical-align: inherit;">但是，这种方法仍然很少。</font><font style="vertical-align: inherit;">不久前，我在另一个项目上工作时尝试使用C ++。</font><font style="vertical-align: inherit;">我将在本文中讨论这种经验。</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参赛作品</font></font></h4><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我对微控制器的大部分工作都与C有关。首先，这是客户的要求，然后就成了一种习惯。同时，在Windows应用程序中，首先在此使用C ++，然后在一般情况下使用C＃。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
很长时间以来，对C或C ++一直没有疑问。甚至发布了带有ARM的C ++支持的Keil MDK的下一版本，也丝毫不困扰我。如果您查看Keil演示项目，那么所有内容都用C编写。与此同时，C ++与Blinky项目一起移到了单独的文件夹中。 CMSIS和LPCOpen也是用C编写的。如果“每个人”都使用C，则有一些原因。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，.Net Micro Framework发生了很大变化。如果没有人知道，那么这是一个.Net实现，可让您在Visual Studio中使用C＃编写用于微控制器的应用程序。您可以在中了解有关他的更多信息</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，.Net Micro Framework是使用C ++编写的。</font><font style="vertical-align: inherit;">对此印象深刻，我决定尝试用C ++编写另一个项目。</font><font style="vertical-align: inherit;">我必须马上说，我没有找到任何支持C ++的明确参数，但是这种方法有一些有趣和有用的要点。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C和C ++项目之间有什么区别？</font></font></h4><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C和C ++之间的主要区别之一是第二种是面向对象的语言。</font><font style="vertical-align: inherit;">众所周知的封装，多态和继承在这里很常见。</font><font style="vertical-align: inherit;">C是一种过程语言。</font><font style="vertical-align: inherit;">只有功能和过程，并且对于代码的逻辑分组，使用了模块（一对.h + .c）。</font><font style="vertical-align: inherit;">但是，如果仔细研究微控制器中C的用法，您会看到通常的面向对象方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下使用MCB1000的Keil示例中的LED进行工作的代码（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keil_v5 \ ARM \ Boards \ Keil \ MCB1000 \ MCB11C14 \ CAN_Demo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LED.h：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __LED_H</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __LED_H</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/* LED Definitions */</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_NUM     8                        </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Number of user LEDs          */</span></span></span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_on</span></span></span><span class="hljs-function">  </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_off</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_out</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LED.c：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"LPC11xx.h"</span></span></span><span class="hljs-meta">                    </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* LPC11xx definitions                */</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"LED.h"</span></span></span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> led_mask[] = {<span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, 
                                  <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span> };<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------
  initialize LED Pins
 *----------------------------------------------------------------------------*/</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_init</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
  LPC_SYSCON-&gt;SYSAHBCLKCTRL |= (<span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt;  <span class="hljs-number"><span class="hljs-number">6</span></span>);     <span class="hljs-comment"><span class="hljs-comment">/* enable clock for GPIO      */</span></span><font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">/* configure GPIO as output */</span></span>
  LPC_GPIO2-&gt;DIR  |=  (led_mask[<span class="hljs-number"><span class="hljs-number">0</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">1</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">2</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">3</span></span>] |<font></font>
                       led_mask[<span class="hljs-number"><span class="hljs-number">4</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">5</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">6</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">7</span></span>] );<font></font>
<font></font>
  LPC_GPIO2-&gt;DATA &amp;= ~(led_mask[<span class="hljs-number"><span class="hljs-number">0</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">1</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">2</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">3</span></span>] |<font></font>
                       led_mask[<span class="hljs-number"><span class="hljs-number">4</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">5</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">6</span></span>] | led_mask[<span class="hljs-number"><span class="hljs-number">7</span></span>] );<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------
  Function that turns on requested LED
 *----------------------------------------------------------------------------*/</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_on</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
  LPC_GPIO2-&gt;DATA |=  led_mask[num];<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------
  Function that turns off requested LED
 *----------------------------------------------------------------------------*/</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_off</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
  LPC_GPIO2-&gt;DATA &amp;= ~led_mask[num];<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------
  Output value to LEDs
 *----------------------------------------------------------------------------*/</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LED_out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i;<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; LED_NUM; i++) {
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;i)) {<font></font>
      LED_on (i);<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      LED_off(i);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果仔细观察，可以与OOP打个比方。</font><font style="vertical-align: inherit;">LED是具有一个公共常量，构造函数，3个公共方法和一个私有字段的对象：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LED</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> led_mask[] = {<span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, 
                                  <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1U</span></span>L &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span> };<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
	<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> LED_NUM=<span class="hljs-number"><span class="hljs-number">8</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
        LED(); <span class="hljs-comment"><span class="hljs-comment">// LED_init</span></span>
        <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function">  </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;
        <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;
        <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led)</span></span></span></span>;<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管代码是用C编写的，但它还是使用对象编程的范例。 .C文件是一个对象，它允许您封装在.h文件中描述的公共方法的实现机制中。但是这里没有继承，因此也有多态性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我遇到的项目中的大多数代码都是用相同的样式编写的。如果使用了OOP方法，那为什么不使用完全支持它的语言呢？同时，大体上，当切换到C ++时，只会改变语法，而不会改变开发原理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑另一个例子。</font><font style="vertical-align: inherit;">假设我们有一个使用通过I2C连接的温度传感器的设备。</font><font style="vertical-align: inherit;">但是该设备的新版本发布了，并且同一传感器现在已连接到SPI。</font><font style="vertical-align: inherit;">怎么办 </font><font style="vertical-align: inherit;">必须同时支持该设备的第一版和第二版，这意味着代码必须灵活地考虑这些更改。</font><font style="vertical-align: inherit;">在C语言中，您可以使用#define预定义来避免编写两个几乎相同的文件。</font><font style="vertical-align: inherit;">举个例子</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV1</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> “i2c.h”</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV2</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> “spi.h”</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TEMPERATURE_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV1</span></span><font></font>
	I2C_int()<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV2</span></span><font></font>
	SPI_int()<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span><font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在C ++中，您可以更优雅地解决此问题。</font><font style="vertical-align: inherit;">制作界面</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITemperature</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并实现2</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Temperature_I2C</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITemperature<font></font>
{<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Temperature_SPI</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITemperature<font></font>
{<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后根据修订版本使用该实现：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemperatureGetter</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <font></font>
         ITemperature* _temperature;<font></font>
<font></font>
pubic:<font></font>
         Init(ITemperature* temperature)<font></font>
         {<font></font>
                 _temperature = temperature;<font></font>
         }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>:
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTemperature</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
        </span></span>{<font></font>
                _temperature-&gt;GetValue();<font></font>
        }<font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV1</span></span><font></font>
	Temperature_I2C temperature;<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> REV2</span></span><font></font>
	Temperature_SPI temperature;<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span><font></font>
<font></font>
TemperatureGetter tGetter;<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
        tGetter.Init(&amp;temperature);<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
似乎C和C ++代码之间的差异不是很大。</font><font style="vertical-align: inherit;">面向对象的选项看起来更加麻烦。</font><font style="vertical-align: inherit;">但这使您可以做出更灵活的决定。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用C时，可以区分两个主要解决方案：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上所示使用#define。</font><font style="vertical-align: inherit;">此选项不是很好，因为它“侵蚀”了模块的责任。</font><font style="vertical-align: inherit;">事实证明，他负责该项目的多个修订。</font><font style="vertical-align: inherit;">当有许多这样的文件时，很难维护它们。</font></font></li>
<li> 2 ,     C++.  “”  ,     .       ,           #ifdef.   ,  ,   .          ,     .          ,    ,      .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多态性的使用给出了更漂亮的结果。一方面，每个类都解决了一个明显的原子问题，另一方面，代码不乱且易于阅读。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在第一种情况和第二种情况下，仍必须在修订版上“分支”代码，但是使用多态性可以更轻松地在程序层之间转移分支位置，而不会用#ifdef重载代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用多态可以使做出更有趣的决定变得容易。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假设发布了一个新版本，其中安装了两个温度传感器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只需进行很少的更改即可使用相同的代码，您只需使用Init（＆temperature）方法即可实时选择SPI和I2C实现。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该示例非常简化，但是在一个实际项目中，我使用了相同的方法在两个不同的物理数据传输接口之上实现了相同的协议。</font><font style="vertical-align: inherit;">这样可以轻松在设备设置中选择接口。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，使用上述所有方法，使用C和C ++之间的差异仍然不是很大。</font><font style="vertical-align: inherit;">与OOP相关的C ++的优势不是那么明显，而是来自“业余”类别。</font><font style="vertical-align: inherit;">但是，在微控制器中使用C ++存在相当严重的问题。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么使用C ++很危险？</font></font></h4><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C和C ++之间的第二个重要区别是内存使用情况。 C语言大部分是静态的。所有功能和过程都有固定的地址，并且仅在必要时才进行处理。 C ++是一种更具动态性的语言。通常，它的使用意味着需要进行分配和释放内存的积极工作。这就是C ++的危险。微控制器的资源很少，因此对其进行控制非常重要。对RAM的无节制使用会严重破坏那里存储的数据，而且程序工作中的此类“奇迹”是没人能想到的。许多开发人员都遇到过此类问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果仔细查看上面的示例，可以注意到类没有构造函数和析构函数。这是因为它们从未动态创建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用动态内存时（以及使用new时），始终会调用malloc函数，该函数从堆中分配所需的字节数。即使您仔细考虑（尽管这很困难）并控制内存的使用，也可能会遇到碎片问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一束可以表示为一个数组。例如，我们为其选择20个字节：</font></font><br>
<img src="https://habrastorage.org/files/05a/c96/6c5/05ac966c58a744058f06c0552789825c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每次分配内存时，将扫描整个内存（从左到右或从右到左-这并不重要），以查看是否存在给定数量的未占用字节。此外，这些字节都应该位于附近：</font></font><br>
<img src="https://habrastorage.org/files/72d/0bf/e62/72d0bfe6220048a487dddf81032082fb.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当不再需要内存时，它将返回其原始状态：</font></font><br>
<img src="https://habrastorage.org/files/05a/c96/6c5/05ac966c58a744058f06c0552789825c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当有足够的可用字节，但是没有将它们排成一行时，很容易发生这种情况。分配10个区域，每个区域2个字节：</font></font><br>
<img src="https://habrastorage.org/files/a26/7b6/698/a267b6698df2402aaab7340b86b1357d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，将释放2、4、6、8、10个区域：</font></font><br>
<img src="https://habrastorage.org/files/ad6/b46/3af/ad6b463af9804994ad77c1e20e039426.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
形式上，整个堆的一半（10个字节）保持空闲。但是，分配3个字节的内存区域仍将失败，因为该阵列连续没有3个空闲单元。这称为内存碎片。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在没有内存虚拟化的系统上处理此问题非常困难。特别是在大型项目中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这种情况可以很容易地模拟。我是在Keil mVision的LPC11C24微控制器上完成此操作的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将堆大小设置为256个字节：</font></font><br>
<img src="https://habrastorage.org/files/928/56b/179/92856b179a9e4165b8c476fe40870c25.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假设我们有2个类：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>:
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pr1;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pr2;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pr3;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pr4;<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pb1;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pb2;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pb3;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pb4;<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pc1;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pc2;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pc3;
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pc4;<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
	foo()<font></font>
	{<font></font>
		_pr1 = <span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
		_pr2 = <span class="hljs-number"><span class="hljs-number">200</span></span>;<font></font>
		_pr3 = <span class="hljs-number"><span class="hljs-number">300</span></span>;<font></font>
		_pr4 = <span class="hljs-number"><span class="hljs-number">400</span></span>;<font></font>
		<font></font>
		_pb1 = <span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
		_pb2 = <span class="hljs-number"><span class="hljs-number">200</span></span>;<font></font>
		_pb3 = <span class="hljs-number"><span class="hljs-number">300</span></span>;<font></font>
		_pb4 = <span class="hljs-number"><span class="hljs-number">400</span></span>;<font></font>
		<font></font>
		_pc1 = <span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
		_pc2 = <span class="hljs-number"><span class="hljs-number">200</span></span>;<font></font>
		_pc3 = <span class="hljs-number"><span class="hljs-number">300</span></span>;<font></font>
		_pc4 = <span class="hljs-number"><span class="hljs-number">400</span></span>;<font></font>
	}<font></font>
	~foo(){};	<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> F1(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr1*a;<font></font>
	};<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> F2(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr1/a;<font></font>
	};<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> F3(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr1+a;<font></font>
	};<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> F4(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr1-a;<font></font>
	};<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bar</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>:
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> _pr1;
	<span class="hljs-keyword"><span class="hljs-keyword">int8_t</span></span> _pr2;<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
	bar()<font></font>
	{<font></font>
		_pr1 = <span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
		_pr2 = <span class="hljs-number"><span class="hljs-number">10</span></span>;<font></font>
	}<font></font>
	~bar() {};	<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> F1(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr2/a;<font></font>
	}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> F2(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> a)<font></font>
	{<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _pr2*a;<font></font>
	}<font></font>
};<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，bar类将比foo占用更多的内存。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bar类的14个实例放置在堆中，而foo类的实例不再适合：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">  
</span></span>{<font></font>
		foo *f;<font></font>
		bar *b[<span class="hljs-number"><span class="hljs-number">14</span></span>];<font></font>
<font></font>
                b[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar(); <font></font>
		b[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
<font></font>
f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> foo(); <font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果仅创建7个bar实例，则foo也将正常创建：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">  
</span></span>{<font></font>
		foo *f;<font></font>
		bar *b[<span class="hljs-number"><span class="hljs-number">14</span></span>];<font></font>
<font></font>
               <span class="hljs-comment"><span class="hljs-comment">//b[0] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[2] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[4] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[6] = new bar(); </span></span>
		b[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[8] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[10] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();
		<span class="hljs-comment"><span class="hljs-comment">//b[12] = new bar();</span></span>
		b[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
<font></font>
f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> foo(); <font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果首先创建bar的14个实例，然后删除0、2、4、6、8、10和12个实例，则由于堆的碎片化，foo将无法分配内存：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">  
</span></span>{<font></font>
		foo *f;<font></font>
		bar *b[<span class="hljs-number"><span class="hljs-number">14</span></span>];<font></font>
<font></font>
               b[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar(); <font></font>
		b[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
		b[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bar();<font></font>
<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">0</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">2</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">4</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">6</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">8</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">10</span></span>];
		<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> b[<span class="hljs-number"><span class="hljs-number">12</span></span>];<font></font>
<font></font>
f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> foo(); <font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，您不能完全使用C ++，这是一个很大的缺点。</font><font style="vertical-align: inherit;">从体系结构的角度来看，尽管C ++优于C，但它并不重要。</font><font style="vertical-align: inherit;">结果，向C ++的过渡不会带来明显的好处（尽管也没有很大的负面影响）。</font><font style="vertical-align: inherit;">因此，由于差异很小，语言的选择将仍然只是开发人员的个人喜好。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是对于我自己，我发现使用C ++有一个重要的积极意义。</font><font style="vertical-align: inherit;">事实是，使用正确的C ++方法，可以在Visual Studio中用单元测试轻松涵盖微控制器的代码。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++的一大优点是可以使用Visual Studio。</font></font></h4><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就我个人而言，微控制器的代码测试主题一直非常复杂。自然地，会以各种可能的方式对代码进行检查，但是创建完整的自动测试系统始终需要巨额成本，因为必须组装硬件支架并为其编写专用固件。尤其是涉及由数百个设备组成的分布式物联网系统时。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当我开始用C ++编写项目时，我立即想尝试将代码放在Visual Studio中，并仅将Keil mVision用于调试。首先，在Visual Studio中，它是一个功能强大且方便的代码编辑器，其次，在Keil mVision中，它与版本控制系统完全不方便集成，而在Visual Studio中，它都是自动完成的。第三，我希望我可以设法用单元测试覆盖至少部分代码，Visual Studio也很好地支持了单元测试。第四，这是Resharper C ++的外观-一种使用C ++代码的Visual Studio扩展，因此，您可以提前避免许多潜在的错误并监视代码的样式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Visual Studio中创建项目并将其连接到版本控制系统不会引起任何问题。但是我不得不修改单元测试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从硬件抽象的类（例如，协议解析器）易于测试。</font><font style="vertical-align: inherit;">但是我想要更多！</font><font style="vertical-align: inherit;">在外围项目中，我使用Keil头文件。</font><font style="vertical-align: inherit;">例如，对于LPC11C24，它是LPC11xx.h。</font><font style="vertical-align: inherit;">这些文件描述了根据CMSIS标准的所有必需的寄存器。</font><font style="vertical-align: inherit;">通过#define直接定义特定的寄存器：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LPC_I2C_BASE          (LPC_APB0_BASE + 0x00000)</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LPC_I2C               ((LPC_I2C_TypeDef    *) LPC_I2C_BASE   )</span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，如果您正确地覆盖了寄存器并创建了两个存根，那么使用外围设备的代码就可以很好地编译到VisualStudio中。</font><font style="vertical-align: inherit;">不仅如此，如果您创建一个静态类并将其字段指定为寄存器地址，您将获得一个成熟的微控制器仿真器，该仿真器可让您全面测试甚至使用外设：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;LPC11xx.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LPC11C24Emulator</span></span></span><span class="hljs-class">
{</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
	<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Registers</span></span></span><span class="hljs-class">
	{</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
		<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LPC_ADC_TypeDef ADC;<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
		<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
		</span></span>{
			<span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;ADC, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(LPC_ADC_TypeDef));<font></font>
		}<font></font>
	};<font></font>
}<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> LPC_ADC</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LPC_ADC				((LPC_ADC_TypeDef *) &amp;LPC11C24Emulator::Registers::ADC)</span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后执行以下操作：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined ( _M_IX86 )</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"..\Emulator\LPC11C24Emulator.h"</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;LPC11xx.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样，您只需很少的更改就可以编译和测试VisualStudio中微控制器的所有项目代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在用C ++开发项目的过程中，我编写了300多个测试，涵盖了纯硬件方面以及从硬件中提取的代码。</font><font style="vertical-align: inherit;">而且，预先发现了大约20个相当严重的错误，由于项目的规模，如果没有自动测试，将很难发现这些错误。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h4><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在使用微控制器时使用或不使用C ++是一个相当复杂的问题。我在上面已经表明，一方面，成熟的OOP的体系结构优势不是很大，并且不能完全与一堆对象一起工作是一个很大的问题。鉴于这些方面，使用微控制器工作的C和C ++之间没有太大区别，开发人员的个人偏好很可能证明它们之间的选择是合理的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，我设法在与Visaul Studio一起使用C ++方面找到了很大的积极点。由于版本控制系统的完整工作，使用完整的单元测试（包括用于外围设备的测试）以及Visual Studio的其他优点，因此，您可以显着提高开发的可靠性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
希望我的经验对您有所帮助，并能帮助某人提高工作效率。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在评论的英文</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文介绍了这个话题有用的链接：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议C ++ 2015闪电演讲：Odin Holmes-特殊功能寄存器抽象</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com/watch?v=AKAYc9ZFBhk</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meeting C ++ 2015：John Hinke-深度嵌入的C ++ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com/watch?v=TYqbgvHfxjM</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议C ++ 2014：Wouter van Ooijen-对象？</font><font style="vertical-align: inherit;">不用了 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com/watch?v=k8sRQMx2qUw</font></font></a></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN390837/">https://habr.com/ru/post/zh-CN390837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN390825/index.html">如何为IoT网络选择通信标准</a></li>
<li><a href="../zh-CN390827/index.html">“预先警告-武装”或您需要了解的中风知识，即使您还很年轻</a></li>
<li><a href="../zh-CN390829/index.html">蒂姆·库克（Tim Cook）再次确认了自己的立场，接受调查的美国人中有51％支持FBI</a></li>
<li><a href="../zh-CN390833/index.html">OCZ Trion 100 SSD概述</a></li>
<li><a href="../zh-CN390835/index.html">Opera Presto更新至版本12.18</a></li>
<li><a href="../zh-CN390841/index.html">在Playpen儿童色情案件中，法官命令FBI揭露Tor骇客技术</a></li>
<li><a href="../zh-CN390843/index.html">项目“眼睛”第16部分</a></li>
<li><a href="../zh-CN390845/index.html">回顾8英寸“ thermonuclear”平板电脑bb-mobile Topol'LTE</a></li>
<li><a href="../zh-CN390849/index.html">美国海关官员开始对越过美国边境的人进行生物识别</a></li>
<li><a href="../zh-CN390851/index.html">ROS在Raspberry Pi上的实际使用-第3部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>