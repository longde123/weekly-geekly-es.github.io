<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïù üëàüèø ü§π Engenharia reversa do cliente do Dropbox üëéüèæ ü§µüèæ üôèüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR. O artigo fala sobre o desenvolvimento reverso do cliente Dropbox, invadindo os mecanismos de ofusca√ß√£o e descompila√ß√£o do cliente em Python, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Engenharia reversa do cliente do Dropbox</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452276/">  <i>TL; DR.</i>  <i>O artigo fala sobre o desenvolvimento reverso do cliente Dropbox, invadindo os mecanismos de ofusca√ß√£o e descompila√ß√£o do cliente em Python, al√©m de alterar o programa para ativar as fun√ß√µes de depura√ß√£o ocultas no modo normal.</i>  <i>Se voc√™ estiver interessado apenas no c√≥digo e nas instru√ß√µes apropriadas, role at√© o final.</i>  <i>No momento da reda√ß√£o deste texto, o c√≥digo √© compat√≠vel com as vers√µes mais recentes do Dropbox, baseadas no interpretador CPython 3.6.</i> <br><br><h3>  1. Introdu√ß√£o </h3><br>  O Dropbox me fascinou imediatamente.  O conceito ainda √© enganosamente simples.  Aqui est√° a pasta  Coloque arquivos l√°.  Est√° sincronizado.  Indo para outro dispositivo.  √â sincronizado novamente.  Pasta e arquivos agora apareceram l√° tamb√©m! <br><br>  A quantidade de trabalho oculto em segundo plano √© realmente incr√≠vel.  Primeiro, todos os problemas com os quais voc√™ precisa lidar ao criar e manter um aplicativo de plataforma cruzada para os principais sistemas operacionais de desktop (OS X, Linux, Windows) n√£o desaparecem.  Adicione a isso o suporte de v√°rios navegadores da web, v√°rios sistemas operacionais m√≥veis.  E estamos falando apenas do lado do cliente.  Tamb√©m estou interessado no back-end do Dropbox, que me permitiu alcan√ßar tal escalabilidade e baixa lat√™ncia com a carga de trabalho incrivelmente pesada criada por meio bilh√£o de usu√°rios. <br><a name="habracut"></a><br>  √â por esses motivos que eu sempre gostei de ver o que o Dropbox faz sob o cap√¥ e como ele evoluiu ao longo dos anos.  H√° cerca de oito anos, tentei descobrir como o cliente Dropbox realmente funciona quando notei a transmiss√£o de tr√°fego desconhecido enquanto estava no hotel.  A investiga√ß√£o mostrou que isso faz parte do recurso do Dropbox chamado LanSync, que permite sincronizar mais rapidamente se os hosts do Dropbox na mesma LAN tiverem acesso aos mesmos arquivos.  No entanto, o protocolo n√£o foi documentado e eu queria saber mais.  Portanto, decidi dar uma olhada em mais detalhes e, como resultado, conduzi a engenharia reversa de quase todo o programa.  Este estudo nunca foi publicado, embora √†s vezes eu compartilhasse notas com algumas pessoas. <br><br>  Quando abrimos a Anvil Ventures, Chris e eu apreciamos v√°rias ferramentas para armazenamento, compartilhamento e colabora√ß√£o de documentos.  Um deles, obviamente, era o Dropbox, e para mim esse √© outro motivo para desenterrar estudos antigos e verific√°-los na vers√£o atual do cliente. <br><br><h3>  Descriptografia e desofusca√ß√£o </h3><br>  Primeiro, baixei o cliente para Linux e descobri rapidamente que ele estava escrito em Python.  Como a licen√ßa do Python √© bastante permissiva, √© f√°cil para as pessoas modificar e distribuir o int√©rprete do Python junto com outras depend√™ncias, como software comercial.  Ent√£o comecei a engenharia reversa para entender como o cliente funciona. <br><br>  Naquela √©poca, os arquivos de bytecode estavam em um arquivo ZIP combinado com um bin√°rio execut√°vel.  O bin√°rio principal era apenas um interpretador Python modificado que era carregado capturando mecanismos de importa√ß√£o do Python.  Cada chamada de importa√ß√£o subsequente foi redirecionada para este bin√°rio com uma an√°lise de arquivo ZIP.  Obviamente, √© f√°cil extrair esse ZIP do bin√°rio.  Por exemplo, a ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">binwalk</a> √∫til a recupera com todos os arquivos .pyc compilados por bytes. <br><br>  Ent√£o n√£o pude quebrar a criptografia dos arquivos .pyc, mas no final peguei o objeto geral da biblioteca Python padr√£o e o recompilei, injetando um backdoor dentro.  Agora que o cliente Dropbox estava carregando esse objeto, eu poderia facilmente executar c√≥digo Python arbitr√°rio em um int√©rprete ativo.  Embora eu tenha descoberto isso sozinho, o mesmo m√©todo foi usado por Florian Leda e Nicolas Raff em uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apresenta√ß√£o</a> no Hack.lu em 2012. <br><br>  A capacidade de explorar e manipular o c√≥digo em execu√ß√£o no Dropbox revelou muito.  O c√≥digo usou v√°rios truques de prote√ß√£o para dificultar o despejo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">objetos de c√≥digo</a> .  Por exemplo, em um int√©rprete CPython comum, √© f√°cil recuperar um bytecode compilado que representa uma fun√ß√£o.  Um exemplo simples: <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i * i ... &gt;&gt;&gt; f.__code__ &lt;code object f at <span class="hljs-number"><span class="hljs-number">0x109deb540</span></span>, file <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>&gt; &gt;&gt;&gt; f.__code__.co_code <span class="hljs-string"><span class="hljs-string">b'|\x00|\x00\x14\x00S\x00'</span></span> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dis &gt;&gt;&gt; dis.dis(f) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (i) <span class="hljs-number"><span class="hljs-number">2</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (i) <span class="hljs-number"><span class="hljs-number">4</span></span> BINARY_MULTIPLY <span class="hljs-number"><span class="hljs-number">6</span></span> RETURN_VALUE &gt;&gt;&gt;</code> </pre> <br>  Mas na vers√£o compilada de <i>Objects / codeobject.c, a</i> propriedade <i>co_code</i> <code>co_code</code> removida da lista aberta.  Esta lista de membros geralmente se parece com isso: <br><br><pre> <code class="python hljs"> static PyMemberDef code_memberlist[] = { ... {<span class="hljs-string"><span class="hljs-string">"co_flags"</span></span>, T_INT, OFF(co_flags), READONLY}, {<span class="hljs-string"><span class="hljs-string">"co_code"</span></span>, T_OBJECT, OFF(co_code), READONLY}, {<span class="hljs-string"><span class="hljs-string">"co_consts"</span></span>, T_OBJECT, OFF(co_consts), READONLY}, ... };</code> </pre> <br>  O desaparecimento da propriedade <code>co_code</code> torna imposs√≠vel despejar esses objetos de c√≥digo. <br><br>  Al√©m disso, outras bibliotecas, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desmontador</a> padr√£o do Python, foram removidas.  No final, ainda consegui despejar os objetos de c√≥digo em arquivos, mas ainda n√£o consegui descompil√°-los.  Demorou um pouco para eu perceber que os opcodes usados ‚Äã‚Äãpelo interpretador do Dropbox n√£o correspondem aos opcodes padr√£o do Python.  Portanto, era necess√°rio entender os novos opcodes para reescrever os objetos de c√≥digo de volta no bytecode original do Python. <br><br>  Uma op√ß√£o √© o remapeamento do c√≥digo de opera√ß√£o.  At√© onde eu sei, essa t√©cnica foi desenvolvida por Rich Smith e introduzida na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Defcon 18</a> .  Nessa palestra, ele tamb√©m mostrou a ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pyREtic</a> para engenharia reversa do bytecode Python na mem√≥ria.  Parece que o c√≥digo pyREtic √© pouco suportado e a ferramenta tem como alvo os bin√°rios "antigos" do Python 2.x.  Para se familiarizar com as t√©cnicas criadas por Rich, √© altamente recomend√°vel assistir a seu desempenho. <br><br>  O m√©todo de convers√£o de opcode pega todos os objetos de c√≥digo da biblioteca Python padr√£o e os compara com os objetos extra√≠dos do bin√°rio do Dropbox.  Por exemplo, objetos de c√≥digo de <i>hashlib.pyc</i> ou <i>socket.pyc</i> , que est√£o na biblioteca padr√£o.  Digamos, se toda vez que o c√≥digo de opera√ß√£o <code>0x43</code> corresponder ao c√≥digo de opera√ß√£o <code>0x43</code> , podemos construir gradualmente uma tabela de convers√£o para reescrever objetos de c√≥digo.  Esses objetos de c√≥digo podem ser passados ‚Äã‚Äãpelo descompilador Python.  Para despejar, voc√™ ainda precisa de um int√©rprete corrigido com o objeto <code>co_code</code> correto. <br><br>  Outra op√ß√£o √© hackear o formato de serializa√ß√£o.  No Python, a serializa√ß√£o √© chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">empacotamento</a> .  A desserializa√ß√£o de arquivos ofuscados da maneira usual n√£o funcionou.  Ao fazer engenharia reversa do bin√°rio no IDA Pro, descobri a etapa de descriptografia.  At√© onde eu sei, o primeiro a publicar publicamente algo sobre esse assunto foi Hagen Fritch em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seu blog</a> .  L√°, ele se refere a altera√ß√µes nas novas vers√µes do Dropbox (quando o Dropbox mudou do Python 2.5 para o Python 2.7).  O algoritmo funciona da seguinte maneira: <br><br><ul><li>  Ao descompactar um arquivo pyc, um cabe√ßalho √© lido para determinar a vers√£o do empacotamento.  Este formato n√£o est√° documentado, exceto pela implementa√ß√£o do pr√≥prio CPython. <br></li><li>  O formato define uma lista de tipos que s√£o codificados nele.  Tipos <code>True</code> , <code>False</code> , <code>floats</code> , etc., mas o mais importante √© o tipo para os <code>code object</code> Python acima, <code>code object</code> . <br></li><li>  Ao carregar o <code>code object</code> , dois valores adicionais s√£o lidos primeiro no arquivo de entrada. <br></li><li>  O primeiro √© o valor <code>random</code> 32 bits. <br></li><li>  O segundo √© um valor de <code>length</code> 32 bits, indicando o tamanho do objeto de c√≥digo serializado. <br></li><li>  Em seguida, os valores de <code>rand</code> e <code>length</code> s√£o <code>rand</code> para uma fun√ß√£o RNG simples que gera <code>seed</code> . <br></li><li>  Essa semente √© entregue ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≥rtice de Mersenne</a> , que gera quatro valores de 32 bits. <br></li><li>  Combinados, esses quatro valores fornecem uma chave de criptografia para dados serializados.  O algoritmo de criptografia descriptografa os dados usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">algoritmo de criptografia min√∫scula</a> . </li></ul><br>  No meu c√≥digo, escrevi o procedimento de desempacotamento do Python do zero.  A parte que descriptografa os objetos de c√≥digo se parece com o fragmento abaixo.  Deve-se notar que esse m√©todo precisar√° ser chamado recursivamente.  O objeto de n√≠vel superior para um arquivo pyc √© um objeto de c√≥digo que cont√©m objetos de c√≥digo, que podem ser classes, fun√ß√µes ou lambdas.  Por sua vez, eles tamb√©m podem conter m√©todos, fun√ß√µes ou lambdas.  Estes s√£o todos os objetos de c√≥digo na hierarquia! <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> rand = self.r_long() length = self.r_long() seed = rng(rand, length) mt = MT19937(seed) key = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): key.append(mt.extract_number()) <span class="hljs-comment"><span class="hljs-comment"># take care of padding for size calculation sz = (length + 15) &amp; ~0xf words = sz / 4 # convert data to list of dwords buf = self._read(sz) data = list(struct.unpack("&lt;%dL" % words, buf)) # decrypt and convert back to stream of bytes data = tea.tea_decipher(data, key) data = struct.pack("&lt;%dL" % words, *data)</span></span></code> </pre> <br>  A capacidade de descriptografar objetos de c√≥digo significa que, ap√≥s desserializar os procedimentos, voc√™ precisa reescrever o c√≥digo de bytes real.  Os objetos de c√≥digo cont√™m informa√ß√µes sobre n√∫meros de linha, constantes e outras informa√ß√µes.  O bytecode real est√° no objeto <code>co_code</code> .  Quando criamos a tabela de convers√£o de opcode, podemos simplesmente substituir os valores ocultos do Dropbox pelos equivalentes padr√£o do Python 3.6. <br><br>  Agora, os objetos de c√≥digo est√£o no formato usual do Python 3.6 e podem ser passados ‚Äã‚Äãpara o descompilador.  A qualidade dos descompiladores Python aumentou significativamente gra√ßas ao projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">unipolar6 de</a> R. Bernstein.  A descompila√ß√£o deu um bom resultado, e eu pude reunir tudo em uma ferramenta que descompila a vers√£o atual do cliente Dropbox da melhor maneira poss√≠vel. <br><br>  Se voc√™ clonar este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> e seguir as instru√ß√µes, o resultado ser√° algo como isto: <br><br><pre>  ...
     __main__ - INFO - Dropbox / cliente / features / browse_search / __ init __. pyc descompilado com √™xito
     __main__ - INFO - Descriptografando, corrigindo e descompilando _bootstrap_overrides.pyc
     __main__ - INFO - _bootstrap_overrides.pyc descompilado com √™xito
     __main__ - INFO - Arquivos 3713 processados ‚Äã‚Äã(3591 descompilado com sucesso, 122 com falha)
     opcodemap - AVISO - N√ÉO est√° escrevendo o mapa do opcode porque a substitui√ß√£o for√ßada n√£o est√° definida </pre><br>  Isso significa que agora voc√™ tem um diret√≥rio <code>out/</code> com uma vers√£o descompilada do c√≥digo-fonte do Dropbox. <br><br><h3>  Ativando o rastreamento do Dropbox </h3><br>  No c√≥digo aberto, comecei a procurar por algo interessante, e o fragmento a seguir chamou minha aten√ß√£o.  Os manipuladores de rastreamento em <code>out/dropbox/client/high_trace.py</code> ser√£o instalados apenas se o assembly n√£o estiver congelado ou se a chave m√°gica ou o cookie que restringe a funcionalidade n√£o estiver definido na linha <code>1430</code> . <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">1424</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">install_global_trace_handlers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(flags=None, args=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">1425</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> _tracing_initialized <span class="hljs-number"><span class="hljs-number">1426</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _tracing_initialized: <span class="hljs-number"><span class="hljs-number">1427</span></span> TRACE(<span class="hljs-string"><span class="hljs-string">'!! Already enabled tracing system'</span></span>) <span class="hljs-number"><span class="hljs-number">1428</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1429</span></span> _tracing_initialized = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">1430</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> build_number.is_frozen() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> magic_trace_key_is_set() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> limited_support_cookie_is_set(): <span class="hljs-number"><span class="hljs-number">1431</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">'DBNOLOCALTRACE'</span></span>): <span class="hljs-number"><span class="hljs-number">1432</span></span> add_trace_handler(db_thread(LtraceThread)().trace) <span class="hljs-number"><span class="hljs-number">1433</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">'DBTRACEFILE'</span></span>): <span class="hljs-number"><span class="hljs-number">1434</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  Mencionar constru√ß√µes congeladas refere-se √†s constru√ß√µes de depura√ß√£o internas do Dropbox.  E um pouco mais alto no mesmo arquivo, voc√™ pode encontrar essas linhas: <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">272</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_valid_time_limited_cookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cookie)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">273</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">274</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">275</span></span> t_when = int(cookie[:<span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) ^ <span class="hljs-number"><span class="hljs-number">1686035233</span></span> <span class="hljs-number"><span class="hljs-number">276</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-number"><span class="hljs-number">277</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">278</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">279</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> abs(time.time() - t_when) &lt; SECONDS_PER_DAY * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> md5(make_bytes(cookie[:<span class="hljs-number"><span class="hljs-number">8</span></span>]) + <span class="hljs-string"><span class="hljs-string">b'traceme'</span></span>).hexdigest()[:<span class="hljs-number"><span class="hljs-number">6</span></span>] == cookie[<span class="hljs-number"><span class="hljs-number">8</span></span>:]: <span class="hljs-number"><span class="hljs-number">280</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">281</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception: <span class="hljs-number"><span class="hljs-number">282</span></span> report_exception() <span class="hljs-number"><span class="hljs-number">283</span></span> <span class="hljs-number"><span class="hljs-number">284</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">285</span></span> <span class="hljs-number"><span class="hljs-number">286</span></span> <span class="hljs-number"><span class="hljs-number">287</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limited_support_cookie_is_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">288</span></span> dbdev = os.getenv(<span class="hljs-string"><span class="hljs-string">'DBDEV'</span></span>) <span class="hljs-number"><span class="hljs-number">289</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dbdev <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_valid_time_limited_cookie(dbdev) build_number/environment.py</code> </pre> <br>  Como voc√™ pode ver no m√©todo <code>limited_support_cookie_is_set</code> na linha <code>287</code> , o rastreamento s√≥ ser√° ativado se a vari√°vel de ambiente denominada <code>DBDEV</code> configurada corretamente em cookies com uma vida √∫til limitada.  Bem, isso √© interessante!  E agora sabemos como gerar esses cookies com tempo limitado.  A julgar pelo nome, os engenheiros do Dropbox podem gerar esses cookies e, em alguns casos, ativar temporariamente o rastreamento em alguns casos quando for necess√°rio oferecer suporte aos clientes.  Ap√≥s reiniciar o Dropbox ou reiniciar o computador, mesmo que o cookie especificado ainda esteja no local, ele expirar√° automaticamente.  Suponho que isso deva impedir, por exemplo, a degrada√ß√£o do desempenho devido ao rastreamento cont√≠nuo.  Isso tamb√©m dificulta a engenharia reversa do Dropbox. <br><br>  No entanto, um pequeno script pode simplesmente gerar e definir constantemente esses cookies.  Algo assim: <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 def output_env(name, value): print("%s=%s; export %s" % (name, value, name)) def generate_time_cookie(): t = int(time.time()) c = 1686035233 s = "%.8x" % (t ^ c) h = md5(s.encode("utf-8?") + b"traceme").hexdigest() ret = "%s%s" % (s, h[:6]) return ret c = generate_time_cookie() output_env("DBDEV", c)</span></span></code> </pre> <br>  Em seguida, um cookie baseado em tempo √© criado: <br><br><pre> <code class="python hljs"> $ python3 setenv.py DBDEV=<span class="hljs-number"><span class="hljs-number">38</span></span>b28b3f349714; export DBDEV;</code> </pre> <br>  Em seguida, carregue corretamente a sa√≠da desse script no ambiente e execute o cliente Dropbox. <br><br><pre> <code class="python hljs"> $ eval `python3 setenv.py` $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number"><span class="hljs-number">-71.4</span></span><span class="hljs-number"><span class="hljs-number">.108</span></span>/dropbox</code> </pre> <br>  Isso inclui sa√≠da de rastreamento, com formata√ß√£o colorida e tudo mais.  Parece algo como este cliente n√£o registrado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e83/d0a/a4f/e83d0aa4f475709108cb1cfc0cb16d74.png"><br><br><h3>  Implementar novo c√≥digo </h3><br>  Tudo isso √© um pouco engra√ßado.  Estudando mais o c√≥digo descompilado, descobrimos <code>out/build_number/environment.pyc</code> .  H√° uma fun√ß√£o que verifica se uma certa chave m√°gica est√° instalada.  Essa chave n√£o est√° codificada no c√≥digo, mas √© comparada com o hash SHA-256.  Aqui est√° o trecho correspondente. <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib, os <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Optional, Text <span class="hljs-number"><span class="hljs-number">3</span></span> _MAGIC_TRACE_KEY_IS_SET = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magic_trace_key_is_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> _MAGIC_TRACE_KEY_IS_SET <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _MAGIC_TRACE_KEY_IS_SET <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> dbdev = os.getenv(<span class="hljs-string"><span class="hljs-string">'DBDEV'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(dbdev, Text): <span class="hljs-number"><span class="hljs-number">10</span></span> bytes_dbdev = dbdev.encode(<span class="hljs-string"><span class="hljs-string">'ascii'</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> bytes_dbdev = dbdev <span class="hljs-number"><span class="hljs-number">13</span></span> dbdev_hash = hashlib.sha256(bytes_dbdev).hexdigest() <span class="hljs-number"><span class="hljs-number">14</span></span> _MAGIC_TRACE_KEY_IS_SET = dbdev_hash == <span class="hljs-string"><span class="hljs-string">'e27eae61e774b19f4053361e523c771a92e838026da42c60e6b097d9cb2bc825'</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _MAGIC_TRACE_KEY_IS_SET</code> </pre> <br>  Esse m√©todo √© chamado v√°rias vezes em diferentes locais do c√≥digo para verificar se a chave de rastreamento m√°gico est√° definida.  Tentei decifrar o hash SHA-256 com a for√ßa bruta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">John, o Estripador</a> , mas uma for√ßa bruta simples levou muito tempo e n√£o pude reduzir o n√∫mero de op√ß√µes porque n√£o havia palpites sobre o conte√∫do.  No Dropbox, os desenvolvedores podem ter uma chave de desenvolvimento codificada espec√≠fica, que eles instalam, se necess√°rio, ativando o modo "chave m√°gica" do cliente para rastreamento. <br><br>  Isso me irritou porque eu queria encontrar uma maneira r√°pida e f√°cil de iniciar o Dropbox com este conjunto de chaves para rastreamento.  Ent√£o, eu escrevi um procedimento de empacotamento que gera arquivos pyc criptografados de acordo com a criptografia do Dropbox.  Assim, consegui inserir meu pr√≥prio c√≥digo ou simplesmente substituir o hash acima.  Esse c√≥digo no reposit√≥rio do Github est√° no arquivo <code>patchzip.py</code> .  Como resultado, o hash √© substitu√≠do pelo hash SHA-256 de <code>ANVILVENTURES</code> .  Em seguida, o objeto de c√≥digo √© criptografado novamente e colocado em um zip, onde todo o c√≥digo ofuscado √© armazenado.  Isso permite que voc√™ fa√ßa o seguinte: <br><br><pre>  $ DBDEV = ANVILVENTURES;  exportar DBDEV;
     $ ~ / .dropbox-dist / dropbox-lnx_64-71.4.108 / dropbox </pre><br>  Agora todas as fun√ß√µes de depura√ß√£o s√£o exibidas quando voc√™ clica com o bot√£o direito do mouse no √≠cone do Dropbox na bandeja do sistema. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/619/c68/385/619c6838574ff7023a0dbdf27b880b2d.png"></div><br><br>  Estudando ainda mais as fontes descompiladas, no arquivo <code>dropbox/webdebugger/server.py</code> , descobri um m√©todo chamado <code>is_enabled</code> .  Parece que est√° verificando se √© necess√°rio ativar o depurador da web interno.  Primeiro de tudo, ele verifica a chave m√°gica mencionada.  Como substitu√≠mos o hash SHA-256, podemos simplesmente definir o valor para <code>ANVILVENTURES</code> .  A segunda parte nas linhas <code>201</code> e <code>202</code> verifica se existe uma vari√°vel de ambiente denominada <code>DB&lt;x&gt;</code> que possui <code>x</code> igual ao hash SHA-256.  O valor do ambiente define cookies com limite de tempo, como j√° vimos. <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">191</span></span> @classmethod <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cls._magic_key_set: <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls._magic_key_set <span class="hljs-number"><span class="hljs-number">195</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">196</span></span> cls._magic_key_set = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> magic_trace_key_is_set(): <span class="hljs-number"><span class="hljs-number">198</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">199</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.environ: <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var.startswith(<span class="hljs-string"><span class="hljs-string">'DB'</span></span>): <span class="hljs-number"><span class="hljs-number">201</span></span> var_hash = hashlib.sha256(make_bytes(var[<span class="hljs-number"><span class="hljs-number">2</span></span>:])).hexdigest() <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var_hash == <span class="hljs-string"><span class="hljs-string">'5df50a9c69f00ac71f873d02ff14f3b86e39600312c0b603cbb76b8b8a433d3ff0757214287b25fb01'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_valid_time_limited_cookie(os.environ[var]): <span class="hljs-number"><span class="hljs-number">203</span></span> cls._magic_key_set = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">204</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">205</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Usando exatamente a mesma t√©cnica, substituindo esse hash pelo SHA-256 usado anteriormente, agora podemos alterar o script <code>setenv</code> escrito anteriormente para algo como isto: <br><br><pre> <code class="python hljs"> $ cat setenv.py ‚Ä¶ c = generate_time_cookie() output_env(<span class="hljs-string"><span class="hljs-string">"DBDEV"</span></span>, <span class="hljs-string"><span class="hljs-string">"ANVILVENTURES"</span></span>) output_env(<span class="hljs-string"><span class="hljs-string">"DBANVILVENTURES"</span></span>, c) $ python3 setenv.py DBDEV=ANVILVENTURES; export DBDEV; DBANVILVENTURES=<span class="hljs-number"><span class="hljs-number">38</span></span>b285c4034a67; export DBANVILVENTURES $ eval `python3 setenv.py` $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number"><span class="hljs-number">-71.4</span></span><span class="hljs-number"><span class="hljs-number">.108</span></span>/dropbox</code> </pre> <br>  Como voc√™ pode ver, depois de iniciar o cliente, uma nova porta TCP √© aberta para escuta.  Ele n√£o ser√° aberto se as vari√°veis ‚Äã‚Äãde ambiente n√£o estiverem definidas corretamente. <br><br><pre>  $ netstat --tcp -lnp |  grep dropbox
     tcp 0 0 127.0.0.1:4242 0.0.0.0:* ESCUTE 1517 / dropbox </pre><br>  Mais adiante no c√≥digo, voc√™ pode encontrar a interface WebSocket no arquivo <code>webpdb.pyc</code> .  Este √© um inv√≥lucro para utilit√°rios padr√£o python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pdb</a> .  O acesso √† interface √© feito atrav√©s de um servidor HTTP nesta porta.  Vamos instalar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o cliente websocket</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">experiment√°</a> -lo: <br><br><pre>  $ websocat -t ws: //127.0.0.1: 4242 / pdb
     --Voltar--
    
     &gt; /home/gvb/dropbox/webdebugger/webpdb.pyc(101)run()-&gt; Nenhum
     &gt;
     (Pdb) de build_number.environment importa magic_trace_key_is_set como ms
     (Pdb) ms ()
     Verdadeiro </pre><br>  Portanto, agora temos um depurador completo no cliente, que em todos os outros aspectos funciona como antes.  Podemos executar c√≥digo Python arbitr√°rio, conseguimos ativar o menu de depura√ß√£o interno e rastrear as fun√ß√µes.  Tudo isso ajudar√° bastante na an√°lise mais aprofundada do cliente Dropbox. <br><br><h3>  Conclus√£o </h3><br>  Pudemos fazer engenharia reversa do Dropbox, escrever ferramentas de descriptografia e inje√ß√£o de c√≥digo que funcionem com os clientes atuais do Dropbox baseados no Python 3.6.  Revertemos a engenharia das fun√ß√µes ocultas individuais e as ativamos.  Obviamente, o depurador realmente ajudar√° em novos hackers.  Especialmente com v√°rios arquivos que n√£o podem ser descompilados com √™xito devido √†s desvantagens do decompyle6. <br><br><h3>  C√≥digo </h3><br>  O c√≥digo pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no Github</a> .  Instru√ß√µes de uso l√°.  Este reposit√≥rio tamb√©m cont√©m meu c√≥digo antigo escrito em 2011.  Ele deve funcionar com apenas algumas modifica√ß√µes, desde que algu√©m tenha vers√µes mais antigas do Dropbox com base no Python 2.7. <br><br>  O reposit√≥rio tamb√©m cont√©m scripts para difus√£o de c√≥digos de opera√ß√£o, instru√ß√µes para definir vari√°veis ‚Äã‚Äãde ambiente do Dropbox e tudo o necess√°rio para alterar o arquivo zip. <br><br><h3>  Agradecimentos </h3><br>  Agrade√ßo ao Brian da Anvil Ventures por revisar meu c√≥digo.  O trabalho nesse c√≥digo continuou por v√°rios anos; de tempos em tempos eu o atualizava, introduzia novos m√©todos e reescrevia fragmentos para restaur√°-lo para que funcionasse em novas vers√µes do Dropbox. <br><br>  Como mencionado anteriormente, um excelente ponto de partida para aplicativos Python de engenharia reversa √© o trabalho de Rich Smith, Florian Ledoux e Nicolas Raff, al√©m de Hagen Fritch.  Especialmente, o trabalho deles √© relevante para o desenvolvimento reverso de um dos maiores aplicativos Python do mundo - o cliente Dropbox. <br><br>  Deve-se notar que a descompila√ß√£o do c√≥digo Python avan√ßou bastante gra√ßas ao projeto uncompyle6 liderado por R. Bernstein.  Esse descompilador compilou e melhorou muitos descompiladores diferentes do Python. <br><br>  Tamb√©m muito obrigado aos colegas Brian, Austin, Stefan e Chris pela revis√£o deste artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452276/">https://habr.com/ru/post/pt452276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452264/index.html">Como criamos o site para o pr√™mio de carro Mascot</a></li>
<li><a href="../pt452266/index.html">Racks sem servidor</a></li>
<li><a href="../pt452268/index.html">Window.ShowDialog () anal√≥gico em C # WPF ou lidar com DispatcherFrame</a></li>
<li><a href="../pt452270/index.html">A documenta√ß√£o da API do Xamarin agora est√° dispon√≠vel ao p√∫blico</a></li>
<li><a href="../pt452272/index.html">Menina sob a cachoeira</a></li>
<li><a href="../pt452278/index.html">Bluetooth LE n√£o √© t√£o assustador, ou como melhorar a experi√™ncia do usu√°rio sem muito esfor√ßo</a></li>
<li><a href="../pt452280/index.html">PostgreSQL 11: A evolu√ß√£o do particionamento do Postgres 9.6 para o Postgres 11</a></li>
<li><a href="../pt452282/index.html">Elementar, Watson: voc√™ se integra ao Voximplant</a></li>
<li><a href="../pt452284/index.html">Classifica√ß√£o da cobertura do solo usando o eo-learn. Parte 1</a></li>
<li><a href="../pt452288/index.html">Situa√ß√£o: operadoras de telefonia m√≥vel dos EUA acusadas de com√©rcio ilegal de dados geogr√°ficos de assinantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>