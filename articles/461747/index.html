<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôåüèª üë®üèø‚Äçü§ù‚Äçüë®üèª üë®üèæ‚Äçüé§ C√≥mo implementamos ML en una aplicaci√≥n con casi 50 millones de usuarios. Experiencia Sberbank ‚úñÔ∏è üõçÔ∏è ‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Nikolai y estoy involucrado en la construcci√≥n e implementaci√≥n de modelos de aprendizaje autom√°tico en Sberbank. Hoy hablar√© ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo implementamos ML en una aplicaci√≥n con casi 50 millones de usuarios. Experiencia Sberbank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/461747/">  Hola Habr!  Mi nombre es Nikolai y estoy involucrado en la construcci√≥n e implementaci√≥n de modelos de aprendizaje autom√°tico en Sberbank.  Hoy hablar√© sobre el desarrollo de un sistema de recomendaci√≥n para pagos y transferencias en la aplicaci√≥n en sus tel√©fonos inteligentes. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/358/23c/0f8/35823c0f8e513f268f58de291b8504c7.png"></a> <br>  <i>Dise√±o de la pantalla principal de la aplicaci√≥n m√≥vil con recomendaciones.</i> <br><br>  Ten√≠amos doscientas mil opciones de pago posibles, 55 millones de clientes, 5 fuentes bancarias diferentes, media columna de desarrollador y una monta√±a de actividad bancaria, algoritmos y todo eso, todos los colores, as√≠ como un litro de semillas aleatorias, una caja de hiperpar√°metros, medio litro de factores de correcci√≥n y dos docenas de bibliotecas.  No es que todo esto fuera necesario en el trabajo, pero desde que comenz√≥ a mejorar la vida de los clientes, ve a tu pasatiempo hasta el final.  Debajo del corte est√° la historia de la batalla por UX, la formulaci√≥n correcta del problema, la lucha contra la dimensionalidad de los datos, la contribuci√≥n al c√≥digo abierto y nuestros resultados. <br><br><a name="habracut"></a><br><h2>  Declaraci√≥n del problema. </h2><br>  A medida que se desarrolla y ampl√≠a, la aplicaci√≥n Sberbank Online est√° adquiriendo caracter√≠sticas √∫tiles y funcionalidades adicionales.  En particular, en la aplicaci√≥n puede transferir dinero o pagar los servicios de varias organizaciones. <br><br>  ‚ÄúObservamos cuidadosamente todas las rutas de usuario dentro de la aplicaci√≥n y nos dimos cuenta de que muchas de ellas se pueden reducir significativamente.  Para hacer esto, decidimos personalizar la pantalla principal en varias etapas.  Primero, tratamos de eliminar de la pantalla lo que el cliente no usa, comenzando con las tarjetas bancarias.  Luego pusieron de manifiesto aquellas acciones que el cliente ya hab√≠a realizado anteriormente y para las cuales podr√≠a ingresar a la aplicaci√≥n ahora mismo.  Ahora, la lista de acciones incluye pagos a organizaciones y transferencias a contactos, luego la lista de tales acciones se ampliar√° ‚Äù, dijo mi colega Sergey Komarov, quien est√° desarrollando la funcionalidad desde el punto de vista del cliente en el equipo de Sberbank Online.  Es necesario construir un modelo que llene los espacios designados en los widgets de Acciones (figura anterior) con recomendaciones personales de pagos y transferencias en lugar de reglas simples. <br><br><h2>  Soluci√≥n </h2><br>  Nosotros en el equipo descomponemos la tarea en dos partes: <br><br><ul><li>  la recomendaci√≥n de la repetici√≥n de operaciones para pagar servicios o transferir fondos (bloque "Operaciones recomendadas") <br></li><li>  recomendaci√≥n de ejemplos de solicitudes de b√∫squeda para el pago de servicios no utilizados anteriormente por este cliente (bloque "Ejemplos de b√∫squeda") <br></li></ul><br>  Decidimos probar la funcionalidad primero en la pesta√±a de b√∫squeda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/450/0ee/8fe4500ee0d612b4210a7237a643850b.png"></div><br>  <i>Dise√±o de pantalla de b√∫squeda recomendada</i> <br><br><h2>  Operaciones recomendadas </h2><br><h3>  Optimizaci√≥n de puntaje </h3><br>  Si establecemos la subtarea como una recurrencia de operaciones, esto nos permite deshacernos del c√°lculo y la evaluaci√≥n de billones de combinaciones de todas las operaciones posibles para todos los clientes y centrarnos en un n√∫mero mucho m√°s limitado de ellas.  Si, de todo el conjunto de operaciones disponibles para nuestros clientes, el cliente hipot√©tico con el hash YYY solo us√≥ el pago de gas y estacionamiento, entonces evaluaremos la probabilidad de repetir solo estas operaciones para este cliente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33f/d0e/415/33fd0e4159a1143ff54c6834c0cd964d.png"><br>  <i>Un ejemplo de reducci√≥n de la dimensi√≥n de datos para puntuaci√≥n</i> <br><br><h3>  Preparando el conjunto de datos </h3><br>  La muestra es una observaci√≥n transaccional, enriquecida con factores de demograf√≠a del cliente, agregados financieros y diversas caracter√≠sticas de frecuencia de una operaci√≥n en particular. <br><br>  La variable objetivo en este caso es binaria y refleja el hecho del evento el d√≠a siguiente al d√≠a en que se calculan los factores.  Por lo tanto, moviendo iterativamente el d√≠a de c√°lculo de los factores y estableciendo la bandera de la variable objetivo, multiplicamos y marcamos las mismas operaciones y las marcamos de manera diferente dependiendo de la posici√≥n con respecto a este d√≠a. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/929/618/c8a/929618c8a1fbcf3b2385300bf9669ae3.png"></div><br>  <i>Esquema de observaci√≥n</i> <br><br>  Calculando el corte el 17/03/2019 para el cliente "YYY", obtenemos dos observaciones: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e70/741/78be707412f6a3fee92dcb5d62413de9.png"></div><br>  <i>Un ejemplo de las observaciones para un conjunto de datos.</i> <br><br>  "Caracter√≠stica 1" puede significar, por ejemplo, el saldo de todas las tarjetas del cliente, "Caracter√≠stica 2" - la presencia de este tipo de operaci√≥n en la √∫ltima semana. <br><br>  Tomamos las mismas transacciones, pero formamos observaciones para capacitaci√≥n en una fecha diferente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/901/c8e/618/901c8e6188d792bb9c77fc207f7d95d1.png"></div><br>  <i>Esquema de observaci√≥n</i> <br><br>  Obtendremos observaciones para un conjunto de datos con otros valores de ambas caracter√≠sticas y la variable objetivo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e99/a4f/060/e99a4f0602c8c127f47aecee38f02292.png"><br>  <i>Un ejemplo de las observaciones para un conjunto de datos.</i> <br><br>  En los ejemplos anteriores, para mayor claridad, se proporcionan los valores reales de los factores, pero de hecho, los valores se procesan mediante un algoritmo autom√°tico: los resultados de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conversi√≥n de WOE</a> se introducen en la entrada del modelo.  Le permite llevar las variables a una relaci√≥n monot√≥nica con la variable objetivo y al mismo tiempo eliminar los efectos de los valores at√≠picos.  Por ejemplo, tenemos el factor "N√∫mero de tarjetas" y alguna distribuci√≥n de la variable objetivo: <br><br><img src="https://habrastorage.org/webt/4z/vz/xt/4zvzxtz04cy0corijvcyz4zfhf0.png"><br><br>  <i>Ejemplo de conversi√≥n de WOE</i> <br><br>  La transformaci√≥n de WOE nos permite transformar una dependencia no lineal en al menos una dependencia monot√≥nica.  Cada valor del factor analizado se asocia con su propio valor WOE y, por lo tanto, se forma un nuevo factor, y el original se elimina del conjunto de datos: <br><br><img src="https://habrastorage.org/webt/9j/os/o4/9joso4mjqdpris64sxtrb3ji34k.png"><br>  <i>El efecto de la transformaci√≥n WOE en la relaci√≥n con la variable objetivo</i> <br><br>  El diccionario para convertir valores variables a WOE se guarda y se usa m√°s tarde para la puntuaci√≥n.  Es decir, si necesitamos calcular las probabilidades para ma√±ana, creamos un conjunto de datos como en las tablas con ejemplos de observaciones anteriores, convertimos las variables necesarias en WOE con el c√≥digo guardado y aplicamos el modelo en estos datos. <br><br><h3>  Entrenamiento </h3><br>  La elecci√≥n del m√©todo era estrictamente limitada: interpretabilidad.  Por lo tanto, para cumplir con los plazos, se decidi√≥ posponer las explicaciones usando el mismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SHAP</a> en la segunda mitad del problema y probar m√©todos relativamente simples: regresi√≥n y neuronas superficiales.  La herramienta fue SAS Miner, un software para preprocesar, analizar y construir modelos en varios datos en una forma interactiva, lo que ahorra mucho tiempo en la escritura de c√≥digo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/80d/b3c/1ae80db3c2741d5c70a2cbc9e48dd0ff.png"><br>  <i>Interfaz SAS Miner</i> <br><br><h3>  Evaluaci√≥n de calidad </h3><br>  La comparaci√≥n de la m√©trica GINI en una muestra fuera de tiempo mostr√≥ que la red neuronal se adapta mejor a la tarea: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d24/553/e79/d24553e79a193415b2fa94c6e3b0d987.png"></div><br>  <i>Tabla comparativa de modelos de calidad y reglas de frecuencia.</i> <br><br>  El modelo tiene dos puntos de salida.  Las recomendaciones en forma de tarjetas de widgets en la pantalla principal incluyen operaciones cuyo pron√≥stico est√° por encima de cierto umbral (ver la primera imagen en la publicaci√≥n).  El borde se selecciona en funci√≥n de un equilibrio de calidad y cobertura, que en dicha arquitectura es la mitad de todas las operaciones realizadas.  Las 4 operaciones principales se env√≠an al bloque de "operaciones recomendadas" de la pantalla de b√∫squeda (vea la segunda imagen). <br><br><h2>  Buscar ejemplos </h2><br>  Pasando a la segunda parte de la tarea, volvemos al problema de una gran cantidad de posibles opciones de pago para los servicios de proveedores que deben evaluarse y clasificarse dentro de cada cliente: billones de pares.  Adem√°s de esto, tenemos datos impl√≠citos, es decir, no hay informaci√≥n sobre la evaluaci√≥n de los pagos realizados, o por qu√© el cliente no realiz√≥ ning√∫n pago.  Por lo tanto, para empezar, se decidi√≥ probar varios m√©todos para expandir la matriz de pagos de clientes a proveedores: ALS y FM. <br><br><h3>  ALS </h3><br>  ALS (Alternating Least Squares) o Alternating Least Squares - en el filtrado colaborativo, uno de los m√©todos para resolver el problema de factorizaci√≥n de la matriz de interacci√≥n.  Presentaremos nuestros datos transaccionales sobre el pago de servicios en forma de matriz en la que las columnas son identificadores √∫nicos de todos los servicios de los proveedores, y las filas son clientes √∫nicos.  En las celdas colocamos el n√∫mero de operaciones de clientes espec√≠ficos con proveedores espec√≠ficos durante un cierto per√≠odo de tiempo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/430/fcd/db7/430fcddb7494ed4ba54411d0423b5b16.png"><br>  <i>Principio de descomposici√≥n de la matriz</i> <br><br>  El significado del m√©todo es que creamos dos de esas matrices de dimensi√≥n inferior, cuya multiplicaci√≥n da el resultado m√°s cercano a la matriz grande original en las celdas rellenas.  El modelo aprende a crear una descripci√≥n factorial oculta para clientes y proveedores.  Se utiliz√≥ una implementaci√≥n del m√©todo en la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">impl√≠cita</a> .  El entrenamiento se lleva a cabo de acuerdo con el siguiente algoritmo: <br><br><ol><li>  Se inicializan las matrices de clientes y proveedores con factores ocultos.  Su n√∫mero es el hiperpar√°metro del modelo. <br></li><li>  La matriz de factores ocultos de los proveedores es fija y se considera la derivada de la funci√≥n de p√©rdida para la correcci√≥n de la matriz del cliente.  El autor utiliz√≥ un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©todo</a> interesante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de gradientes conjugados</a> , que le permite acelerar mucho este paso. <br></li><li>  El paso anterior se repite de manera similar para la matriz de factores ocultos de los clientes. </li><li>  Los pasos 2-3 se alternan hasta que el algoritmo converge. </li></ol><br><h3>  Preparaci√≥n </h3><br>  Los datos transaccionales se transformaron en una matriz de interacciones con un grado de dispersi√≥n de ~ 99% con gran desigualdad entre los proveedores.  Para separar los datos en muestras de tren y validaci√≥n, enmascaramos al azar la proporci√≥n de celdas llenas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d60/d96/282/d60d96282aac1b7425ee0ea597253d66.png"><br>  <i>Ejemplo de intercambio de datos</i> <br><br>  Las transacciones se tomaron como una prueba para el per√≠odo de tiempo posterior a la capacitaci√≥n y se presentaron en una matriz del mismo formato: result√≥ fuera de tiempo. <br><br><h3>  Entrenamiento </h3><br>  El modelo tiene varios hiperpar√°metros que se pueden ajustar para mejorar la calidad: <br><br><ul><li>  Alfa es el coeficiente por el cual se pondera la matriz, ajustando el grado de confianza ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C_iu</a> ) de que el servicio dado es realmente "querido" por el cliente. <br></li><li>  El n√∫mero de factores en las matrices ocultas de clientes y proveedores es el n√∫mero de columnas y filas, respectivamente. <br></li><li>  Coeficiente de regularizaci√≥n L2 Œª. <br></li><li>  El n√∫mero de iteraciones del m√©todo. <br></li></ul><br>  Utilizamos la biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hiperopt</a> , que nos permite evaluar el efecto de los hiperpar√°metros en la m√©trica de calidad utilizando el m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TPE</a> y seleccionar su valor √≥ptimo.  El algoritmo comienza con un arranque en fr√≠o y realiza varias evaluaciones de la m√©trica de calidad seg√∫n los valores de los hiperpar√°metros analizados.  Luego, en esencia, trata de seleccionar un conjunto de valores de hiperpar√°metros que sea m√°s probable que proporcione un buen valor para la m√©trica de calidad.  Los resultados se guardan en un diccionario desde el que puede construir un gr√°fico y evaluar visualmente el resultado del optimizador (el azul es mejor): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa2/175/64a/fa217564a3f448a81abbbfad1d27f7a1.png"></div><br>  <i>El gr√°fico de la dependencia de la m√©trica de calidad en la combinaci√≥n de hiperpar√°metros.</i> <br><br>  El gr√°fico muestra que los valores de los hiperpar√°metros afectan fuertemente la calidad del modelo.  Como es necesario aplicar rangos para cada uno de ellos a la entrada del m√©todo, el gr√°fico puede determinar a√∫n m√°s si tiene sentido expandir el espacio de valores o no.  Por ejemplo, en nuestra tarea est√° claro que tiene sentido probar valores grandes para la cantidad de factores.  En el futuro, esto realmente mejor√≥ el modelo. <br><br><h3>  Evaluaci√≥n de calidad m√©trica y complejidad </h3><br>  ¬øC√≥mo evaluar la calidad del modelo?  Una de las m√©tricas m√°s utilizadas para los sistemas de recomendaci√≥n donde el pedido es importante es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAP @ k</a> o Precisi√≥n media promedio en K. Esta m√©trica estima la precisi√≥n del modelo en las recomendaciones K teniendo en cuenta el orden de los art√≠culos en la lista de estas recomendaciones en promedio para todos los clientes. <br><br>  Desafortunadamente, una operaci√≥n de evaluaci√≥n de calidad incluso en una muestra tom√≥ varias horas.  Despu√©s de arremangarnos, comenzamos a perfilar la funci√≥n mean_average_pecision_at_k () con la biblioteca line_profiler.  La tarea se complic√≥ a√∫n m√°s por el hecho de que la funci√≥n usaba c√≥digo cython y ten√≠a que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tenerse en cuenta</a> correctamente, de lo contrario las estad√≠sticas necesarias simplemente no se recopilaron.  Como resultado, nuevamente enfrentamos el problema de la dimensionalidad de nuestros datos.  Para calcular esta m√©trica, debe obtener algunas estimaciones de cada servicio de todas las posibles para cada cliente y seleccionar las recomendaciones personales de K principales clasific√°ndolas de la matriz resultante.  Incluso teniendo en cuenta el uso de la clasificaci√≥n parcial de numpy.argpartition () con O (n) complejidad, la clasificaci√≥n de las calificaciones result√≥ ser el paso m√°s largo que estira la calificaci√≥n de calidad a lo largo del reloj.  Como numpy.argpartition () no utiliz√≥ todos los n√∫cleos de nuestro servidor, se decidi√≥ mejorar el algoritmo reescribiendo esta parte en C ++ y OpenMP a trav√©s de cython.  Un algoritmo brevemente nuevo es el siguiente: <br><br><ol><li>  Los clientes cortan los datos en lotes. <br></li><li>  Se inicializan una matriz vac√≠a y punteros a la memoria. <br></li><li>  Las cadenas de lotes por punteros se ordenan de dos maneras: por la funci√≥n partial_sort y luego se ordenan por la biblioteca de algoritmos de C ++. <br></li><li>  Los resultados se escriben en las celdas de la matriz vac√≠a en paralelo. <br></li><li>  Los datos se devuelven en python. <br></li></ol><br>  Esto nos permiti√≥ acelerar el c√°lculo de recomendaciones varias veces.  La revisi√≥n se ha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agregado</a> al repositorio oficial. <br><br><h2>  An√°lisis de resultados OOT </h2><br>  Y ahora es el momento de evaluar la calidad del modelo.  ¬øPor qu√© necesitamos un muestreo fuera de tiempo?  Si observamos la distribuci√≥n de operaciones por proveedores, veremos la siguiente imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/345/5d2/3d4/3455d23d4093172fbbf416d9719e14fa.png"></div><br>  <i>Distribuci√≥n de la popularidad de los proveedores de servicios.</i> <br><br>  Hay un desequilibrio.  Esto lleva al hecho de que el modelo est√° tratando de recomendar servicios populares.  De vuelta a la imagen de arriba: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ef/0fd/b08/6ef0fdb084bd7495ad12821c42cd70c2.png"><br><br>  El problema es que si verifica la precisi√≥n del modelo enmascarando la misma matriz, como se recomienda en casi todas partes, entonces para la mayor√≠a de los clientes (ejemplos marginales: "W", "E" e "I") la calidad de los pron√≥sticos de validaci√≥n (vamos a pretender que ella no particip√≥ en la selecci√≥n de hiperpar√°metros) ser√° alta si estos son los proveedores m√°s populares.  Como resultado, tenemos una falsa confianza en la solidez del modelo.  Por lo tanto, actuamos de la siguiente manera: <br><br><ol><li>  Estimaciones formadas de proveedores por modelo. <br></li><li>  Los pares existentes de servicio al cliente se excluyeron de las clasificaciones (consulte la figura a continuaci√≥n) y las matrices OOT. <br></li><li>  Formado a partir de las calificaciones restantes de las principales recomendaciones de K y calificado MAP @ k en el OOT restante. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/ee7/c06/f4b/ee7c06f4b68beda0b4f0e22e3c8163c1.png"><br>  <i>La l√≥gica de preparar la matriz para generar pron√≥sticos</i> <br><br>  Como l√≠nea de base, compilamos una lista de proveedores, ordenada por popularidad, y la multiplicamos por todos los clientes, excluyendo nuevamente los pares existentes de servicio al cliente.  Result√≥ ser triste y nada de lo que esper√°bamos y vimos en las muestras de validaci√≥n del tren: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/a94/050/ee2a94050abe17d305bdcffeb895f2d0.png"></div><br>  <i>Tabla comparativa de calidad de referencia y modelo</i> <br><br>  Basta!  Tenemos factores de cliente y par√°metros de proveedores.  Tenemos m√°quinas de factorizaci√≥n. <br><br><h3>  FM </h3><br>  M√°quinas de factorizaci√≥n (m√°quina de factorizaci√≥n): un algoritmo de aprendizaje con un maestro, dise√±ado para encontrar relaciones entre factores que describen entidades interactuantes, que se presentan en forma de matrices dispersas.  Utilizamos la implementaci√≥n FM de la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LightFM</a> . <br><br><h3>  Formato de datos </h3><br>  Adem√°s de la matriz de interacci√≥n normalizada, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©todo</a> utiliza dos conjuntos de datos adicionales con factores para clientes y para servicios de proveedores en forma de matrices codificadas en caliente conectadas a unidades individuales: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61b/fa6/c8a/61bfa6c8ab458cfb9b747a37a28e0e32.png"><br>  <i>La l√≥gica de preparar la matriz para generar pron√≥sticos</i> <br><br><h3>  Evaluaci√≥n de calidad </h3><br>  La calidad del modelo FM en nuestros datos result√≥ ser inferior a ALS: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/457/003/48b457003013f435b77ba2d9ecc4cb25.png"></div><br>  <i>Tabla comparativa de modelos de calidad y l√≠nea de base.</i> <br><br><h3>  Cambiar la arquitectura del modelo: impulsar </h3><br>  Se decidi√≥ venir desde el otro lado.  Recordando la distribuci√≥n de la popularidad de los servicios, identificamos 300 de ellos, transacciones en las que cubre el 80% de todas las operaciones, y capacitamos a un clasificador en ellas.  Aqu√≠, los datos representan agregados de transacciones de clientes enriquecidos con caracter√≠sticas de clientes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d25/47d/718/d2547d718a7199fba96be2d0f653bf9a.png"><br>  <i>Esquema de agregaci√≥n de transacciones</i> <br><br>  ¬øPor qu√© solo del lado del cliente, preguntas?  Porque en este caso, para preparar recomendaciones, ser√° suficiente para nosotros tener una l√≠nea por cliente.  Al aplicarle el modelo, obtenemos el vector de salida de las probabilidades para todas las clases, de las cuales es f√°cil elegir las recomendaciones de K principales.  Si agregamos las caracter√≠sticas de los servicios del proveedor al conjunto de capacitaci√≥n, en la etapa de aplicaci√≥n del modelo nos veremos obligados a preparar 300 l√≠neas para cada cliente, una para cada servicio del proveedor con caracter√≠sticas que las describan, o construir otro modelo para clasificar previamente a los candidatos que califican. . <br><br>  Agregar caracter√≠sticas a los clientes de ALS no aument√≥ nuestros datos, ya que ya tomamos en cuenta la actividad transaccional, por ejemplo, en secciones del MCC o categor√≠as en el estilo de "jugador" o "teatro".  En este formato, logramos buenos resultados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/66a/389/eed66a389e4b545fa18a59c6c4ac123a.png"></div><br>  <i>Tabla comparativa de modelos de calidad y l√≠nea de base.</i> <br><br><h3>  Filtro regional </h3><br>  A pesar de la alta calidad del modelo, un problema m√°s permanece en este enfoque.  Dado que la arquitectura de los datos y el modelo no implica el uso de caracter√≠sticas de los servicios de los proveedores, el modelo no tiene en cuenta la geograf√≠a y puede recomendar que las personas paguen por el servicio de un proveedor local de otra regi√≥n.  Para minimizar este riesgo, hemos desarrollado un peque√±o filtro para cortar las opciones antes de entrar en recomendaciones.  Se arroja un fleur f√°cil de recursi√≥n en el algoritmo: <br><br><ol><li>  Recopilamos informaci√≥n sobre la regi√≥n del cliente a partir de perfiles bancarios y otras fuentes internas. <br></li><li>  Seleccionamos las principales regiones de presencia para cada proveedor. <br></li><li>  Aclaramos / completamos la informaci√≥n sobre la regi√≥n del cliente por las regiones de los proveedores que utiliza. <br></li></ol><br>  Despu√©s de estas manipulaciones, utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el √≠ndice Herfindahl,</a> separamos los proveedores regionales, que est√°n representados en un conjunto limitado de regiones, de los federales: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/15f/090/62015f090d3bdcc34d468f7b36ffef90.png"></div><br>  <i>Separaci√≥n de proveedores por presencia en las regiones.</i> <br><br>  Formamos una m√°scara con proveedores regionales aceptables para los clientes y excluimos art√≠culos innecesarios de las predicciones del modelo antes de crear una lista de recomendaciones. <br><br><h2>  Conclusi√≥n </h2><br>  Hemos desarrollado dos modelos que juntos forman un conjunto completo de recomendaciones sobre pagos y transferencias.  Fue posible reducir la ruta del cliente para la mitad de las operaciones recurrentes a un solo clic.  En los planes futuros para mejorar el modelo de "operaciones recomendadas" utilizando datos de retroalimentaci√≥n (las tarjetas se pueden ocultar, etc.), lo que reducir√° el umbral para seleccionar recomendaciones y aumentar√° la cobertura.  Tambi√©n est√° previsto ampliar la cobertura de los pagos recomendados en el modelo de "ejemplos de b√∫squeda" y desarrollar un algoritmo para la optimizaci√≥n de la puntuaci√≥n. <br><br>  Hemos recorrido el camino espinoso de construir un sistema de recomendaci√≥n de pagos y transferencias.  En el camino, obtuvimos golpes y ganamos experiencia en la descomposici√≥n y simplificaci√≥n de tales tareas, evaluando correctamente dichos sistemas, aplicabilidad de m√©todos, trabajo √≥ptimo con grandes vol√∫menes de datos, y expandimos significativamente nuestra comprensi√≥n de los detalles de tales tareas.  En el camino, logr√© contribuir al c√≥digo abierto, que nosotros mismos usamos.  Le deseo tareas interesantes, l√≠neas de base realistas y un solo F1.  Gracias por su atencion! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461747/">https://habr.com/ru/post/461747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461737/index.html">Recopilamos el entorno para TDD moderno en c√≥digo JavaScript + VS</a></li>
<li><a href="../461739/index.html">Backend United 4: Okroshka. Incidentes</a></li>
<li><a href="../461741/index.html">Agrupaci√≥n jer√°rquica de datos categ√≥ricos en R</a></li>
<li><a href="../461743/index.html">Semana de la seguridad 31: vulnerabilidad VLC y tel√©fono roto</a></li>
<li><a href="../461745/index.html">DeviceLock DLP: precios del mercado negro ruso por romper datos personales (m√°s una respuesta a la respuesta de Tinkoff Bank)</a></li>
<li><a href="../461749/index.html">Belleza en el ojo del espectador</a></li>
<li><a href="../461751/index.html">Contribuci√≥n del dise√±ador al desarrollo de aplicaciones m√≥viles</a></li>
<li><a href="../461753/index.html">Transacciones globales de InterSystems IRIS</a></li>
<li><a href="../461755/index.html">La psicolog√≠a de la visi√≥n sana. Svetlana Lebedeva cont√≥ c√≥mo se les ense√±a a las personas una nueva forma de percibir</a></li>
<li><a href="../461759/index.html">Escuchando comunicaciones VoIP cifradas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>