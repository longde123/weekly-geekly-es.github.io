<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèæ ü§µüèæ üë©üèΩ‚Äçüåæ NestJS - le m√™me backend r√©el sur nodejs ‚òùüèª üåù ü¶è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="NestJS est ce cadre cr√©√© pour faciliter la vie du d√©veloppeur, en utilisant les bonnes approches architecturales et en dictant ses propres r√®gles. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NestJS - le m√™me backend r√©el sur nodejs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439434/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d11/98b/ac8/d1198bac8e4ced0d89d5e5983061f418.png" alt="image" width="400"></div><br>  NestJS est ce cadre cr√©√© pour faciliter la vie du d√©veloppeur, en utilisant les bonnes approches architecturales et en dictant ses propres r√®gles. <br><br>  Par cons√©quent, NestJS n'est pas seulement un framework backend, mais aussi l'opportunit√© d'entrer dans le monde des concepts avanc√©s, tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DDD</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Event sourcing</a> et architecture de microservices.  Tout est emball√© de mani√®re simple et facile, vous avez donc le choix - que vous d√©cidiez d'utiliser la plate-forme enti√®re ou simplement d'utiliser ses composants. <br><a name="habracut"></a><br>  Tout d'abord, je vais vous parler de mon exp√©rience.  Pendant longtemps, j'ai √©crit sur ASP.NET, puis il y avait un frontend sur AngularJS.  En octobre 2016, il y a eu un passage √† Angular et Typescript.  Et voil√†!  En tapant dans le frontend, vous pouvez faire des choses complexes assez facilement!  Avant cela (d√©veloppement sur nestjs) sur le n≈ìud, je l'avais d√©velopp√© uniquement pour le plaisir, et d'une mani√®re ou d'une autre, il y avait m√™me une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tentative d'introduire de bonnes pratiques et de la dactylographie dans le Koa populaire</a> .  Mais NestJS est toujours un peu diff√©rent. <br><br>  NestJS, un framework enti√®rement √©crit en TypeScript (il prend √©galement en charge JS, mais les types sont tr√®s bons), il est facile √† tester et contient tout ce dont vous avez besoin. <br><br>  <b>Comment cr√©er une application simple sur NestJS?</b> <br><br>  NestJS a express sous le capot.  Toutes les extensions pour express sont faciles √† impl√©menter dans Nest.  Mais ce n'est pas le sujet ici, avec un fort d√©sir d'exprimer peut √™tre pris et chang√©. <br><br>  Tout d'abord, vous pouvez vous copier un petit kit de d√©marrage: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nestjs/typescript-starter.git project</code> </pre> <br>  Server.ts inclut une fonction asynchrone qui est responsable du chargement de notre application: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NestFactory } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ApplicationModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./modules/app.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.create(ApplicationModule); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } bootstrap();</code> </pre><br>  Eh bien, lancez npm run start et voyez l'application sur le port 3000. <br><br>  <b>De quoi NestJS est-il fait?</b> <br><br>  L'auteur du cadre a √©t√© inspir√© par les id√©es d'Angular, et NestJS s'est av√©r√© √™tre tr√®s similaire √† Angular, en particulier dans les versions ant√©rieures. <br><br>  <b>Contr√¥leurs</b> <br><br>  La couche contr√¥leur est responsable du traitement des demandes entrantes et du renvoi d'une r√©ponse au client.  Un exemple simple de contr√¥leur: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Controller, Get } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Controller(<span class="hljs-string"><span class="hljs-string">'cats'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsController</span></span></span><span class="hljs-class"> </span></span>{ @Get() findAll() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; } }</code> </pre><br>  <b>Fournisseurs</b> <br><br>  Presque tout est fournisseur - Service, r√©f√©rentiel, usine, aide, etc.  Ils peuvent √™tre impl√©ment√©s dans les contr√¥leurs et autres fournisseurs.  Si vous dites la langue d'Angular - c'est tout `@Injectables <br><br>  Par exemple, un service r√©gulier: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Injectable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Cat } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./interfaces/cat.interface'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsService</span></span></span><span class="hljs-class"> </span></span>{ private readonly cats: Cat[] = []; create(cat: Cat) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cats.push(cat); } findAll(): Cat[] { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cats; } }</code> </pre><br>  <b>Modules</b> <br><br>  Un module est une classe avec le d√©corateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Module</a> ().  Le d√©corateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Module</a> () fournit des m√©tadonn√©es que Nest utilise pour organiser la structure de l'application.  Chaque application Nest poss√®de au moins un module, le module racine.  Le module racine est l'endroit o√π Nest commence √† organiser l'arborescence des applications.  En fait, le module racine peut √™tre le seul module de votre application, en particulier lorsque l'application est petite, mais cela n'a pas de sens.  Dans la plupart des cas, vous disposerez de plusieurs modules, chacun ayant un ensemble de fonctionnalit√©s √©troitement li√©es.  Dans Nest, les modules sont singleton par d√©faut, vous pouvez donc facilement partager la m√™me instance de composant entre deux modules ou plus. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CatsController } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./cats.controller'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CatsService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./cats.service'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">controllers</span></span>: [CatsController], <span class="hljs-attr"><span class="hljs-attr">components</span></span>: [CatsService], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsModule</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  <b>Un peu sur les modules dynamiques</b> <br><br>  Le syst√®me modulaire Nest est dot√© d'une fonction de module dynamique.  Cela vous permet de cr√©er des modules personnalis√©s sans aucun effort.  Jetons un coup d'≈ìil au DatabaseModule: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module, DynamicModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createDatabaseProviders } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./database.providers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Connection } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./connection.component'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: [Connection], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DatabaseModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> forRoot(entities = [], options?): DynamicModule { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> providers = createDatabaseProviders(options, entities); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">module</span></span>: DatabaseModule, <span class="hljs-attr"><span class="hljs-attr">components</span></span>: providers, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: providers, }; } }</code> </pre><br>  Il d√©finit le composant Connexion par d√©faut, mais en plus - en fonction des options et entit√©s transf√©r√©es - cr√©e une collection de fournisseurs, par exemple, des composants de r√©f√©rentiel.  En fait, le module dynamique d√©veloppe les m√©tadonn√©es du module.  Cette fonctionnalit√© essentielle est utile lorsque vous devez enregistrer dynamiquement des composants.  Vous pouvez ensuite importer le DatabaseModule comme suit: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DatabaseModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./database/database.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./users/entities/user.entity'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: [ DatabaseModule.forRoot([User]), ], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationModule</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  Soit dit en passant, pour travailler avec la base de donn√©es, il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TypeORM</a> cool qui peut fonctionner avec la plupart des bases de donn√©es. <br><br>  <b>Middlewares</b> <br><br>  Middlewares est une fonction qui est appel√©e avant le gestionnaire d'itin√©raire.  Ils ont acc√®s √† la demande et √† la r√©ponse.  En fait, ce sont les m√™mes qu'en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">express</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Injectable, NestMiddleware, MiddlewareFunction } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerMiddleware</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NestMiddleware</span></span></span><span class="hljs-class"> </span></span>{ resolve(...args: any[]): MiddlewareFunction { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Request...'</span></span>); next(); }; } }</code> </pre><br>  <b>Filtres d'exception</b> <br><br>  Nest poss√®de une couche d'exception, qui est charg√©e de d√©tecter les exceptions non g√©r√©es et de renvoyer la r√©ponse appropri√©e √† l'utilisateur final. <br><br>  Chaque exception est g√©r√©e par le filtre d'exception global, et lorsqu'elle n'est pas reconnue (pas une HttpException ou une classe qui h√©rite d'une HttpException), l'utilisateur re√ßoit la r√©ponse JSON suivante: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Internal server error"</span></span> }</code> </pre><br>  <b>Pipes</b> <br><br>  Pipe doit impl√©menter l'interface PipeTransform. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PipeTransform, Injectable, ArgumentMetadata } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidationPipe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PipeTransform</span></span></span><span class="hljs-class"> </span></span>{ transform(value: any, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: ArgumentMetadata) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } }</code> </pre><br>  Pipe convertit l'entr√©e au r√©sultat souhait√©. <br><br>  En outre, cela peut passer pour la validation, car il est √©galement possible pour eux de lever une exception si les donn√©es sont incorrectes.  Par exemple: <br><br><pre> <code class="javascript hljs">@Post() @UsePipes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationPipe(createCatSchema)) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> create(@Body() createCatDto: CreateCatDto) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.catsService.create(createCatDto); }</code> </pre><br>  Ou vous pouvez d√©clarer un canal global: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.create(ApplicationModule); app.useGlobalPipes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationPipe()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } bootstrap();</code> </pre><br>  <b>Gardes</b> <br><br>  Les gardes doivent impl√©menter l'interface CanActivate.  Les gardiens ont l'enti√®re responsabilit√©.  Ils d√©terminent si la demande doit √™tre trait√©e par le gestionnaire d'itin√©raire ou non. <br><br><pre> <code class="javascript hljs">@Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RolesGuard</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CanActivate</span></span></span><span class="hljs-class"> </span></span>{ canActivate( context: ExecutionContext, ): boolean | <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;boolean&gt; | Observable&lt;boolean&gt; { <span class="hljs-comment"><span class="hljs-comment">// const request = context.switchToHttp().getRequest(); // const data = context.switchToWs().getData(); return true; } } : &lt;source lang="javascript"&gt; @Controller('cats') @UseGuards(RolesGuard) export class CatsController {}</span></span></code> </pre><br>  <b>Intercepteurs</b> <br><br>  Les intercepteurs ont un certain nombre de fonctionnalit√©s utiles qui sont inspir√©es de la technique de programmation orient√©e aspect (AOP).  Ils vous permettent de: <br><br><ul><li>  lier une logique suppl√©mentaire avant / apr√®s l'ex√©cution de la m√©thode; </li><li>  convertir le r√©sultat renvoy√© par la fonction; </li><li>  Convertir une exception lev√©e √† partir d'une fonction </li><li>  red√©finissez compl√®tement la fonction en fonction des conditions s√©lectionn√©es (par exemple, pour la mise en cache). </li></ul><br>  <b>Microservices</b> <br><br>  Nest Microservice est juste une application qui utilise une couche de transport diff√©rente (pas HTTP). <br><br>  Nest prend en charge deux types de communication - TCP et Redis pub / sub, mais la nouvelle strat√©gie de transport est facile √† mettre en ≈ìuvre en impl√©mentant l'interface CustomTransportStrategy. <br><br>  Vous pouvez facilement cr√©er un microservice √† partir de votre application: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NestFactory } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ApplicationModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./modules/app.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Transport } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/microservices'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.createMicroservice(ApplicationModule, { <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: Transport.TCP, }); app.listen(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Microservice is listening'</span></span>)); } bootstrap();</code> </pre><br>  Nest Microservice reconna√Æt les messages par des mod√®les.  Un mod√®le est une valeur simple, un objet, une cha√Æne ou m√™me un nombre. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Controller } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MessagePattern } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/microservices'</span></span>; @Controller() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathController</span></span></span><span class="hljs-class"> </span></span>{ @MessagePattern({ <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">'sum'</span></span> }) sum(data: number[]): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data || []</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reduce</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b); } }</code> </pre><br>  Et pour la communication entre microservices, vous devez utiliser le client: <br><br><pre> <code class="javascript hljs">@Client({ <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: Transport.TCP, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">5667</span></span> }) client: ClientProxy;</code> </pre><br>  Et voici l'envoi du message: <br><br><pre> <code class="javascript hljs">@Get() call(): Observable&lt;number&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pattern = { <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">'sum'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client.send&lt;number&gt;(pattern, data); }</code> </pre><br>  NestJS et Angular sont si √©troitement li√©s que l'auteur du framework peut √™tre facilement vu lors des conf√©rences et r√©unions.  Par exemple, l'√©quipe nrwl a r√©cemment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inclus le</a> mod√®le nestjs dans son nx. <br><br><pre> <code class="bash hljs">ng g node-app nestjs-app -framework nestjs</code> </pre> <br>  NestJS est d√©j√† suffisamment mature et de nombreuses entreprises l'utilisent d√©j√†. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qui utilise NestJS en production en ce moment?</a> <br><br>  Le cadre lui-m√™me: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/nestjs/nest</a> <br><br>  De nombreux liens sympas ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Awesome-nestjs</a> <br>  Communaut√© russophone de NestJS dans un t√©l√©gramme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://t.me/nest_ru</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rapport en langue russe sur NestJS.</a> <br><br>  Et bien s√ªr, abonnez-vous √† la cha√Æne dans le t√©l√©gramme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ngFanatic</a> o√π il y a des nouvelles sur NestJS et Angular. <br><br>  PS: Ce n'est qu'une partie des capacit√©s de NestJS, √† propos d'une exp√©rience personnelle d'un an, il y aura un article s√©par√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439434/">https://habr.com/ru/post/fr439434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439424/index.html">Comment j'ai lutt√© avec l'h√©bergement gratuit et Composer</a></li>
<li><a href="../fr439426/index.html">Situation: une nouvelle vague d'attaques avec interception de requ√™tes DNS - nous analysons les m√©thodes de base de protection</a></li>
<li><a href="../fr439428/index.html">Comment pr√©venir les cyberattaques cibl√©es? 10 meilleurs sandbox r√©seau</a></li>
<li><a href="../fr439430/index.html">Croyez-moi si vous le pouvez. Compteurs d'eau. partie 1</a></li>
<li><a href="../fr439432/index.html">Comment devenir d√©veloppeur Java en 1,5 an</a></li>
<li><a href="../fr439436/index.html">R√©duction des co√ªts de petites s√©ries d'√©lectronique en Russie. Bo√Ætier radio Internet WOLNA</a></li>
<li><a href="../fr439440/index.html">Impl√©mentez Zimbra Collaboration Open Source, autorisez via AD et cr√©ez automatiquement des bo√Ætes aux lettres</a></li>
<li><a href="../fr439442/index.html">Julia. G√©n√©rateurs de rapports et de documents</a></li>
<li><a href="../fr439446/index.html">Ce que vous devez savoir sur JavaScript Engine Switcher 3.0</a></li>
<li><a href="../fr439448/index.html">√Ä quelles questions sur la virtualisation attendez-vous une r√©ponse d'un dipl√¥m√©?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>