<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèΩ üèúÔ∏è üìê Brilla siempre, brilla en todas partes. Parte 2 üì∂ üèπ üëÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La versi√≥n actual de la placa del m√≥dulo del procesador
 
 Ha llegado la segunda parte del material sobre el sistema de control de iluminaci√≥n de bici...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Brilla siempre, brilla en todas partes. Parte 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/381907/"><img src="https://habrastorage.org/files/5e2/2b5/dd1/5e22b5dd1e73455c8c72089c9fbcc16c.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La versi√≥n actual de la placa del m√≥dulo del procesador</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ha llegado la segunda parte del material sobre el sistema de control de iluminaci√≥n de bicicleta hecho a s√≠ mismo. </font><font style="vertical-align: inherit;">Perm√≠tame recordarle que decid√≠ construir una red RS-485, en la que hay dispositivos de control y ejecutivos, y el maestro es una computadora en la que se ejecuta el programa que implementa la l√≥gica. </font><font style="vertical-align: inherit;">Antes de continuar con la descripci√≥n de la l√≥gica del sistema, hablar√© sobre las mejoras y los cambios de paradigma en t√©rminos de hardware que surgieron como resultado de la discusi√≥n y prueba de prototipos de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primera parte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dopilirovanie</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En primer lugar, se decidi√≥ hacer las gl√°ndulas modulares, por analog√≠a con Arduino y una serie de otros proyectos. Pens√© que mi m√≥dulo principal (procesador) contiene m√°s componentes que m√≥dulos funcionales, por lo tanto, ser√° la madre. Y se insertar√°n "escudos" en √©l. En t√©rminos de circuitos, se realizaron los siguientes cambios: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Se agreg√≥ un estabilizador de potencia (AMS1117-5.0). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Se cambia el cableado de alimentaci√≥n del microcontrolador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) La placa del m√≥dulo principal est√° divorciada teniendo en cuenta la fabricaci√≥n industrial, pero la segunda capa de cobre se utiliza al m√≠nimo: puede hacer una placa de una sola capa en casa y colocar puentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Puente de punto final agregado para terminar la l√≠nea en el √∫ltimo dispositivo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Se agreg√≥ el puente de bloqueo RST para bloquear el reinicio del microcontrolador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) De manera similar a la cl√°usula 3, las placas secundarias del codificador y el controlador de la tira de LED est√°n divorciadas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) Estoy esperando el primer pedido de prueba de placas de circuito impreso, mientras que solo los m√≥dulos principales (ITEAD Studio). </font></font><br>
<br>
<img src="https://habrastorage.org/files/8b3/d44/5ba/8b3d445ba6f64dc88013d76349ace4b0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La placa secundaria del controlador de tira de LED </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vanity alrededor del RS-485</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora paso al maestro de la red. En t√©rminos de hierro, todo es simple all√≠, bueno, al menos eso creo. Tom√© un adaptador USB-UART, conect√© una placa peque√±a con MAX485 y varias resistencias, y comenc√© a trabajar. Y pis√≥ un rastrillo excelente, bastante documentado, pero para un principiante no era del todo obvio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El MAX485 debe cambiarse entre recepci√≥n (baja en pines fijados ~ RE y DE) y transmisi√≥n (alta). Guiado por una l√≥gica simple, utilic√© la salida DTR del convertidor (en CP2102) para controlar el modo, tirando de √©l mediante programaci√≥n. Y tengo una desgracia. El sistema de alguna manera funcion√≥ solo con retrasos inaceptablemente grandes entre la recepci√≥n y la transmisi√≥n. Y todo porque el DTR cambia lentamente. Cu√°n lentamente, no ten√≠a nada que medir, as√≠ que solo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proporciono un enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a un estudio de rastrillo m√°s sano usando un osciloscopio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Del mismo material, entend√≠ lo siguiente: usar FT232 ser√° lo menos doloroso, ya que tiene una conclusi√≥n, cuando el chip est√° configurado por defecto, est√° dise√±ado para cambiar los modos RS-485. En pocas palabras, aparece un alto nivel al transmitir a trav√©s de UART. Entonces, el clon chino Arduino Nano se extrajo de los contenedores, ~ RST est√° en cortocircuito a tierra, el cable est√° soldado a la pata 13 del FT232, y todo esto est√° conectado al MAX485. Funciona como un reloj. En la versi√≥n de "combate" del sistema, por supuesto, dicho dise√±o no se utilizar√°: la industria china se complace en ofrecer tableros confeccionados similares. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√≥gica del sistema</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, a c√≥mo se ve todo el proceso desde el punto de vista del maestro. Funciona con objetos de dispositivo, que pueden ser de control o ejecutivos. Los gerentes se dividen en reales ("hierro"), virtuales y temporizadores. El ejecutivo solo puede ser real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se necesitar√°n dispositivos de control virtual cuando se implemente una administraci√≥n de sistemas m√°s compleja, en particular, cuando se le adjuntar√° una interfaz web. Tambi√©n ser√°n √∫tiles para la integraci√≥n con algo que a√∫n no se me ocurri√≥. S√≠, aqu√≠, probablemente, debo decir que, en general, ese "dispositivo" est√° dentro del sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un dispositivo es un objeto de la clase Dispositivo. El conjunto m√≠nimo de atributos es el nombre, el tipo y el indicador de uso. Adem√°s, seg√∫n el tipo, se pueden agregar la direcci√≥n en el bus, el nombre del dispositivo esclavo, la prioridad de control, los valores iniciales de los registros y algunos otros atributos. Los principales m√©todos de la clase se relacionan con el trabajo con dispositivos reales: esto es leer y escribir registros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora, habiendo decidido m√°s o menos la estructura del programa del sistema, podemos comenzar la implementaci√≥n. Actualmente, existe lo siguiente: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) M√≥dulo Comm485 que contiene una descripci√≥n de la clase Conn. Los m√©todos de clase son abrir y cerrar una conexi√≥n, enviar y recibir un paquete y verificar una suma de verificaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) el m√≥dulo Device485 contiene la clase de dispositivo descrita anteriormente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) el m√≥dulo de software principal. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b91/569/3db/b915693dbb1f4dbd833aa59414837274.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoder Daughter Board</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, se implementan dos cosas en el m√≥dulo principal. El primero es crear los objetos necesarios de la clase Dispositivo de acuerdo con el archivo de configuraci√≥n. El segundo es directamente la l√≥gica del sistema. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el proceso</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Actualmente, los siguientes trabajos: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Compilar una lista de actuadores involucrados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Para cada artista, se compila una lista de los dispositivos de control involucrados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Los valores de los registros del dispositivo de control con la prioridad m√°s alta se registran en los registros del actuador y control, que tienen una prioridad m√°s baja.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, supongamos que tenemos un codificador (hierro) con baja prioridad y un dispositivo de control virtual con alta prioridad. En modo de espera, el dispositivo virtual est√° deshabilitado. Cuando necesita ajustar la luz sin levantar el quinto punto del sof√°, se activa un dispositivo virtual (por un corto per√≠odo de tiempo) para proporcionar nuevos par√°metros al int√©rprete y al codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero lo m√°s probable es que, despu√©s de una peque√±a alteraci√≥n del software, el modo principal sea el siguiente: hay dos dispositivos de control con la misma prioridad. Al cambiar los registros de uno de ellos, los valores se escriben en los registros del ejecutor y del otro administrador, que no tuvo cambios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, por ahora. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proyecto est√° disponible en github.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en la carpeta del host puede ver el c√≥digo escalofriante de Python. </font><font style="vertical-align: inherit;">Hay dos m√≥dulos (Comm485, Device485), el programa principal (host) y la carpeta cfg en la que se encuentran los archivos de configuraci√≥n: configuraci√≥n de una conexi√≥n UART y una lista de dispositivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La continuaci√≥n ciertamente seguir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PD Ser v√≠ctima de la migraci√≥n desde Habr, en una serie de posibilidades es limitada.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es381907/">https://habr.com/ru/post/es381907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es381897/index.html">La furia roja. Revisi√≥n de la tarjeta de video AMD Radeon Fury X</a></li>
<li><a href="../es381899/index.html">Apuntes con gadgets. El camino a Microsoft. Parte tres</a></li>
<li><a href="../es381901/index.html">Actualizaci√≥n de la foto de julio ITER</a></li>
<li><a href="../es381903/index.html">Tan similar y tan diferente "Uni√≥n" y "Apolo"</a></li>
<li><a href="../es381905/index.html">Nuevo dispositivo para neurocirujanos ayuda a navegar el cuerpo humano con realidad aumentada</a></li>
<li><a href="../es381909/index.html">C√≥mo hacer una casa inteligente con una casa vieja</a></li>
<li><a href="../es381911/index.html">¬øC√≥mo funciona la f√°brica de discos de vinilo m√°s grande?</a></li>
<li><a href="../es381913/index.html">Los defensores de las teor√≠as de la conspiraci√≥n ya han anunciado una falsa expedici√≥n a Plut√≥n.</a></li>
<li><a href="../es381915/index.html">Si llamaste a Baidu para tu desgracia</a></li>
<li><a href="../es381917/index.html">Culturismo para un profesional independiente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>