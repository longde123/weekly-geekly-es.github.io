<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ó ü§≤ üëâ Falsificaci√≥n de solicitud de servidor, operaci√≥n SSRF ciega ü§∑üèø üö¥üèº ü§æ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe una cosa llamada SSRF. Mucho se ha escrito sobre ella, pero a√∫n as√≠, te lo contar√© brevemente. 
 Supongamos que va al sitio, completa el perfil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Falsificaci√≥n de solicitud de servidor, operaci√≥n SSRF ciega</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485888/">  Existe una cosa llamada SSRF.  Mucho se ha escrito sobre ella, pero a√∫n as√≠, te lo contar√© brevemente. <br>  Supongamos que va al sitio, completa el perfil y accede al elemento "cargar avatar".  Y tiene una opci√≥n: cargar un archivo o especificar un enlace. <br><a name="habracut"></a><br>  En este caso, estamos interesados ‚Äã‚Äãen el segundo punto.  Si proporcionamos un enlace a un recurso que contiene una imagen, la aplicaci√≥n web: <br><br><ol><li>  Lo descarga </li><li>  Comprueba que la imagen es la imagen </li><li>  Verifique los tama√±os, porque pueden no encajar </li><li>  Se lo muestra al usuario (para cortar) </li></ol><br><br>  Entonces aqu√≠.  Si el sitio no comprueba desde d√≥nde est√° intentando descargar la imagen, esto es una vulnerabilidad (como regla).  Adem√°s, los vectores de ataques a una funci√≥n tan peque√±a como la descarga de im√°genes son tan extensos que no hay suficiente reuni√≥n en la barra para ver todas las opciones. <br><br><img src="https://habrastorage.org/webt/-f/1o/ws/-f1owsnmnosberjwjdwv9sp76bq.jpeg"><br><br>  Una vez me preguntaron: "¬øQu√© puedo hacer si puedo poner solo un enlace http (s)?  ¬°No da nada! " <br>  Te digo <br><br>  La opci√≥n m√°s f√°cil es tratar de identificar los servicios dentro.  Si hablamos de la imagen, puede intentar mirar las rutas est√°ndar como favicon.ico, logos o el directorio de iconos, lo que sugiere que se utiliza Apache.  Al enviar solicitudes, podemos iterar sobre direcciones locales populares, as√≠ como subdominios del sitio que funcionan en la infraestructura interna.  Estos son todo tipo de bamb√∫, jira, gitlab y otras cosas queridas por todas las empresas. <br><br>  ¬øPara qu√© es necesario?  Pero porque el conocimiento es poder.  Despu√©s de todo, incluso a ciegas, puede usar varias vulnerabilidades y exploits.  Al conocer el proveedor o la versi√≥n del servidor web o servicio utilizado, reduce el rango de ataques que puede aplicar.  Tal vez ni siquiera ahora, pero en el futuro, conocer la informaci√≥n t√©cnica sobre la infraestructura interna lo ayudar√° a explotar otras vulnerabilidades. <br><br>  Bueno, se nos prohibi√≥ ingresar direcciones IP.  Supongamos que tenemos un recurso importante dentro de la infraestructura y su direcci√≥n IP es 192.168.1.1 <br><br>  En primer lugar, iniciamos mentalmente un dominio al que asignaremos esta IP.  Deja que sea my-test-site.com.  En la vida real, debe crear subdominios cuya direcci√≥n se dirigir√° a la IP que necesitamos, pero m√°s sobre eso m√°s adelante. <br><br><h3>  Contrase√±a fuerza bruta </h3><br><br>  So√±emos que tenemos un enrutador adentro.  El directorio / admin / est√° en autenticaci√≥n b√°sica.  Al cambiar el enlace, podemos seleccionar inicios de sesi√≥n y contrase√±as para el enrutador.  Pero aqu√≠ es bastante simple, solo formamos un enlace del formulario <br><br> <code>http://login:password@my-test-site.com/admin/</code> <br> <br>  Por lo tanto, el valor antes de los dos puntos ser√° el inicio de sesi√≥n, despu√©s de eso, la contrase√±a.  Y a trav√©s del signo @ habr√° un dominio donde se enviar√°n estos datos.  Tenga en cuenta que no funciona con todo tipo de personas de contacto donde necesita completar un formulario.  Por lo tanto, se necesita autenticaci√≥n b√°sica: una ventana emergente con una respuesta 401 del servidor. <br><br>  Si tuvimos suerte y el sitio devolver√≠a al menos el c√≥digo de respuesta (200, 401, 503), ser√≠a mucho m√°s f√°cil.  Entonces podemos observar claramente el proceso y ver nuestra victoria: <br><br> <code>http://admin:password@my-test-site.com/admin/ - 401 <br> http://admin:admin@my-test-site.com/admin/ - 401 <br> http://admin:123456@my-test-site.com/admin/ - 200</code> <br> <br>  Al enviar una docena o dos de tales solicitudes, puede intentar encontrar la contrase√±a para este enrutador.  Y luego recurra al script para guardar su propio DNS o incluso /reboot.cgi <br><br>  ¬øY si no hay respuesta y siempre es la misma? <br><br>  Aqu√≠ los horarios nos ayudar√°n. <br><br><h3>  Tiempos </h3><br><br>  Todo lleva tiempo.  Como me tomo su tiempo para leer un art√≠culo, los servicios se toman su tiempo para responder. <br>  La peculiaridad es que podemos intentar acceder a los recursos internos y medir los tiempos para responder a la pregunta: ¬øhay un servicio all√≠ o no? <br>  Despu√©s de haber enviado muchas solicitudes, puede clasificar a ciegas los servicios internos, los puertos e incluso los directorios y archivos, bas√°ndose en una anomal√≠a de respuestas. <br><br> <code>1302 ms - http://test.company.com <br> 1307 ms - http://db.company.com <br> 5483 ms - http://jira.company.com <br> 1410 ms - http://docs.company.com <br> 1366 ms - http://kafka.company.com</code> <br> <br>  El subdominio jira respondi√≥ m√°s tiempo, lo m√°s probable es que est√© dentro, y la diferencia es notable debido al hecho de que el servidor web intent√≥ cargar la p√°gina, y luego se dio cuenta de que esto no era una imagen.  Y lo que nos importa no es el hecho de "¬øQui√©n respondi√≥ m√°s tiempo?", Sino precisamente "¬øQui√©n respondi√≥ no como todos los dem√°s?"  Porque el tiempo puede ser como un retraso, por ejemplo, si encuentra un archivo o secuencia de comandos de gran tama√±o que tarda mucho tiempo en ejecutarse.  O viceversa, una respuesta r√°pida. <br><br> <code>1302 ms - http://test.company.com <br> 1307 ms - http://db.company.com <br> 423 ms - http://jira.company.com <br> 1410 ms - http://docs.company.com <br> 1366 ms - http://kafka.company.com</code> <br> <br>  En este caso, la respuesta dice que es 401 o una redirecci√≥n que no procesa el analizador de im√°genes.  O tal vez el sitio sea accesible, pero despu√©s de verificar los primeros bytes o tipo de contenido, nuestra aplicaci√≥n web lo rechaz√≥ antes de descargar la p√°gina por completo.  Otros sitios en este ejemplo no esperaron una conexi√≥n (o el nombre de host no se mostr√≥ sobrio) <br><br><h3>  Mecanismos de verificaci√≥n de IP </h3><br><br>  Muchos sitios han ingresado una verificaci√≥n de que la direcci√≥n IP no es interna.  Pero la l√≥gica puede ser incorrecta y, a veces, a√∫n puede hacer que la aplicaci√≥n se conecte a la direcci√≥n IP interna.  Por ejemplo, un sitio verifica en dos bloques l√≥gicos.  Primero, verifica si el host que apunta a la IP externa me fue proporcionado con precisi√≥n.  Si despu√©s de pasar con √©xito la primera verificaci√≥n, el sitio establece una conexi√≥n, mientras no almacena en cach√© la direcci√≥n IP del p√°rrafo anterior, puede hacer un truco divertido. <br><br>  A la primera solicitud del dominio my-test-site.com, proporcione una IP externa, por ejemplo 123.123.123.123 <br>  Y tan pronto como pase la validaci√≥n, comience a enviar IP interna al mismo dominio. <br><br>  En este caso, <a href="https://github.com/neex" rel="nofollow">Emil Lerner</a> hizo un servicio genial: ¬°1u.ms! <br><br>  El dominio 1u.ms responde con las direcciones IP que especific√≥. <br><br>  El formato del dominio debe ser el siguiente: <br><br> <code>make-%IP%-rebind-%IP-rr.1u.ms</code> <br> <br>  Por ejemplo <br><br> <code>make-123.123.123.123-rebind-127.0.0.1-rr.1u.ms</code> <br> <br>  la primera solicitud ser√° respondida con la direcci√≥n 123.123.123.123, y la segunda solicitud ya ser√° respondida en 127.0.0.1 (si son una tras otra, en 5 segundos). <br><br>  Por cierto, la direcci√≥n IP se puede escribir sin puntos, en caso de que necesite un subdominio: <br><br> <code>make-123-123-123-123-rebind-127-0-0-1-rr.1u.ms</code> <br> <br>  Por cierto, antes de hacer y despu√©s de rr, puede escribir palabras arbitrarias para evitar el uso de datos en cach√©: <br><br> <code>bo0om-make-123-123-123-123-rebind-127-0-0.1-rr-test.1u.ms</code> <br> <br>  Y para ver el registro, el an√°logo de tail -f: <br> <code>curl http://1u.ms:8080/log</code> <br>  (o el mismo enlace en el navegador) <br><br><h3>  Escaneo de puertos usando DNS </h3><br><br>  De hecho, al administrar registros DNS, puede intentar escanear puertos.  Un peque√±o truco nos ayudar√° con esto. <br><br>  Supongamos que tenemos un dominio my-test-site.com. <br><br>  Por lo general, contiene al menos un registro A para que se abra el recurso. <br>  Digamos que la IP de nuestro sitio es 172.217.20.46 (tomada de google.com).  ¬°Pero podemos especificar varias entradas de este tipo!  Imagine que los creamos y nuestros registros DNS se ven as√≠: <br><br> <code>my-test-site.com 172.217.20.46 <br> my-test-site.com 192.168.1.1</code> <br> <br>  ¬øSe abrir√° nuestro recurso?  S√≠ lo har√°  Y todo porque el primer disco va primero. <br><br>  Ahora cambie los registros DNS de esta manera: <br><br> <code>my-test-site.com 192.168.1.1 <br> my-test-site.com 172.217.20.46</code> <br> <br>  ¬øSe abrir√° nuestro recurso?  Volveremos :) <br><br>  Y todo porque el recurso primero intentar√° arrancar desde la primera IP especificada, y si hay alg√∫n problema con √©l, ir√° a la segunda. <br><br> <code>curl "my-test-site.com" -v <br> * Trying 192.168.1.1... <br> * TCP_NODELAY set <br> * Immediate connect fail for 192.168.1.1: Host is down <br> * Trying 172.217.20.46... <br> * TCP_NODELAY set <br> * Connected to my-test-site.com (172.217.20.46) port 80 (#0) <br> &gt; GET / HTTP/1.1 <br> &gt; Host: my-test-site.com <br> &gt; User-Agent: curl/7.64.1 <br> &gt; Accept: */* <br> &gt; <br> &lt; HTTP/1.1 404 Not Found <br> &lt; Content-Type: text/html; charset=UTF-8 <br> &lt; Referrer-Policy: no-referrer <br> &lt; Content-Length: 1561 <br> &lt; Date: Tue, 21 Jan 2020 16:35:08 GMT</code> <br> <br>  Con esta funci√≥n, puede averiguar qu√© puertos est√°n abiertos y cu√°les no.  De hecho, muchas (pero no todas) las bibliotecas intentar√°n llegar primero al primer recurso, que se enumera primero en los registros DNS, y luego al segundo. <br>  Aqu√≠ hemos indicado el enlace a nuestro recurso para cargar el avatar. <br><br>  Al especificar nuestro dominio y cambiar el puerto, intentamos usar el m√©todo de excepci√≥n para determinar qu√© puerto est√° disponible. <br><br> <code>http://my-test-site.com:22 -    172.217.20.46:22 <br> http://my-test-site.com:80 -    172.217.20.46:80 <br> http://my-test-site.com:8080 -    <br> http://my-test-site.com:9200 -    172.217.20.46:9200 <br> http://my-test-site.com:3306 -   </code> <br> <br>  Como especificamos 192.168.1.1 como la primera entrada, concluimos que esta direcci√≥n respondi√≥ a la biblioteca en 192.168.1.1 (puertos 8080 y 3306), incluso si era incorrecta, pero respondi√≥.  Entonces, estos puertos est√°n abiertos y hay servicios en ellos.  En este caso, no cambiar√° a la segunda direcci√≥n. <br><br>  El servicio 1u.ms aqu√≠ tambi√©n puede ayudar, en este caso tendremos la siguiente configuraci√≥n: <br><br> <code>make-%IP%-and-%IP%rr.1u.ms</code> <br> <br>  de tipo <br><br> <code>make-192.168.1.1-and-172.217.20.46rr.1u.ms</code> <br> <br>  Devolver√° dos entradas, todas las dem√°s caracter√≠sticas a partir del p√°rrafo anterior. <br><br>  Por cierto, este enfoque se puede utilizar para un Rebinding de DNS m√°s r√°pido, lo que obliga al navegador a cambiar de un servidor "colgado" a uno que funcione.  Creo que ser√° m√°s r√°pido que esperar un minuto para actualizar el cach√© de DNS.  Sin embargo, con Chrome, por ejemplo, este truco no funcionar√°, ya que toma una IP aleatoria. <br><br>  Otro inconveniente es que el servidor DNS con el que la aplicaci√≥n web determina que las direcciones de dominio pueden tener una operaci√≥n por turnos incorporada: cambie el orden de los registros, distribuyendo de manera uniforme la carga en todos los servidores.  Por ejemplo, 8.8.8.8 rechaz√≥ esta caracter√≠stica, pero en 1.1.1.1 est√° presente. <br><br><h3>  Redireccionamientos </h3><br><br>  ¬°Prueba redirecciones!  Bueno, en primer lugar, los redireccionamientos pueden reducir la cantidad de solicitudes de una aplicaci√≥n web, por ejemplo, al escanear puertos utilizando DNS.  Si la respuesta llega a usted, redirija a otro puerto o dominio.  Si no, tal vez tropez√≥ en un puerto abierto. <br><br>  Pero lo mejor, por supuesto, es intentar cambiar el protocolo utilizando la redirecci√≥n.  En mi pr√°ctica, hubo casos en que una redirecci√≥n al archivo: /// etc / passwd funcion√≥ y mostr√≥ el contenido del archivo.  En la versi√≥n con ssrf ciego, puede intentar cambiar el protocolo a Gopher (mientras todav√≠a exista), y ya puede enviar cartas usando comandos a SMTP y otra magia. <br><br><h3>  Denegaci√≥n de servicio </h3><br>  ¬øSe detendr√° el gestor de arranque si le doy un archivo de entrada de 10 GB de tama√±o?  O una imagen de 225,000 por 225,000 p√≠xeles, que ocupa 141.4 GB de RAM.  Esto puede afectar el rendimiento del sitio.  Es cierto que un servidor bloqueado no nos traer√° ninguna diversi√≥n, as√≠ que tenlo en cuenta. <br><br><h3>  Y un mont√≥n de todo </h3><br><br>  Esto es probablemente todo lo que puedo nombrar ahora.  Esto no tiene en cuenta las vulnerabilidades asociadas con la descarga (d√≥nde se carga, c√≥mo se guarda, qu√© se verifica al mismo tiempo) y piezas de terceros (recuerde <a href="https://imagetragick.com/" rel="nofollow">imagetragick</a> y <a href="https://github.com/neex/gifoeb" rel="nofollow">gifoeb</a> ).  Si tienes alguna otra idea, deja un comentario. <br><br>  No puedo evitar darle a la <a href="https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/edit" rel="nofollow">SSRF una biblia</a> que describe la mayor√≠a de los casos en este ataque.  Y tambi√©n una p√°gina con SSRF en el repositorio de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%2520Side%2520Request%2520Forgery" rel="nofollow">PayloadsAllTheThings</a> favorito de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%2520Side%2520Request%2520Forgery" rel="nofollow">todos</a> , que cuenta con el apoyo activo de la comunidad. <br>  Por cierto, muchos ataques son aplicables tanto al lado del servidor (en el servidor) como al lado del cliente (en el navegador).  Atacante: ataca, s√© creativo.  Defender: defi√©ndete, s√© m√°s astuto que atacar. <br><br>  <a href="https://bo0om.ru/blind-ssrf" rel="nofollow">https://bo0om.ru/blind-ssrf</a> <br>  <a href="https://zen.yandex.ru/media/id/5d2d9c1e31878200ad93e4c0/poddelka-servernyh-zaprosov-ekspluataciia-ataki-blind-ssrf-5e305b669b2c49359f7c72da" rel="nofollow">Zen</a> </div></div><p>Source: <a href="https://habr.com/ru/post/485888/">https://habr.com/ru/post/485888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485874/index.html">El libro "Learning Python: programaci√≥n de juegos, visualizaci√≥n de datos, aplicaciones web. 3ra ed.</a></li>
<li><a href="../485876/index.html">Aceleramos OpenVPN en el enrutador Openwrt. Versi√≥n alternativa sin soldador y extremismo duro</a></li>
<li><a href="../485878/index.html">Una secuencia de pasos para organizar la contabilidad de gesti√≥n en la plataforma JetCalc</a></li>
<li><a href="../485884/index.html">C√≥mo configurar Levitron chino</a></li>
<li><a href="../485886/index.html">C√≥mo (y por qu√©) analizar las claves y anuncios de la competencia de Yandex.Direct y Google Ads gratis</a></li>
<li><a href="../485892/index.html">El fin de la era del Tridente</a></li>
<li><a href="../485896/index.html">Base de datos paralela masiva Greenplum: un breve programa educativo</a></li>
<li><a href="../485898/index.html">Exporte Google Forms + descargue Google Script a trav√©s de REST API (Python)</a></li>
<li><a href="../485904/index.html">Meetup de prueba de carga en Raiffeisenbank</a></li>
<li><a href="../485908/index.html">Gracias a la sorprendente falla en Ocarina of Time, fue posible agregar modelos de Star Fox 64</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>