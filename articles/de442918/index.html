<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöö üò¥ ü•£ Handbuch zum Bereitstellen von Modellen f√ºr maschinelles Lernen in einer Produktionsumgebung als API mithilfe von Flask üë®üèΩ üë®‚Äçüî¨ üçù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Freunde, Ende M√§rz starten wir einen neuen Stream zum Kurs ‚ÄûData Scientist‚Äú . Und im Moment beginnen wir, n√ºtzliches Material √ºber den Kurs mit Ihnen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Handbuch zum Bereitstellen von Modellen f√ºr maschinelles Lernen in einer Produktionsumgebung als API mithilfe von Flask</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/442918/">  Freunde, Ende M√§rz starten wir einen neuen Stream zum Kurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûData Scientist‚Äú</a> .  Und im Moment beginnen wir, n√ºtzliches Material √ºber den Kurs mit Ihnen zu teilen. <br><br>  <b>Einf√ºhrung</b> <br><br>  Ich erinnere mich an die fr√ºhen Erfahrungen meiner Leidenschaft f√ºr maschinelles Lernen (ML) und kann sagen, dass viel Aufwand in den Aufbau eines wirklich guten Modells gesteckt wurde.  Ich habe mich mit Experten auf diesem Gebiet beraten, um zu verstehen, wie ich mein Modell verbessern kann, √ºber die erforderlichen Funktionen nachgedacht und versucht, sicherzustellen, dass alle von ihnen vorgeschlagenen Tipps ber√ºcksichtigt wurden.  Trotzdem bin ich auf ein Problem gesto√üen. <br><br>  Wie implementiere ich das Modell in ein reales Projekt?  Ich hatte diesbez√ºglich keine Ideen.  Die gesamte Literatur, die ich bis zu diesem Punkt studiert habe, konzentrierte sich nur auf die Verbesserung von Modellen.  Ich habe den n√§chsten Schritt in ihrer Entwicklung nicht gesehen. <br><br><img src="https://habrastorage.org/webt/dp/dc/yl/dpdcylcyxdnyzfasmeoxefjf-e8.png"><br><br>  Deshalb schreibe ich jetzt diesen Leitfaden.  Ich m√∂chte, dass Sie sich dem Problem stellen, auf das ich in meiner Zeit gesto√üen bin, aber ich k√∂nnte es schnell l√∂sen.  Gegen Ende dieses Artikels werde ich Ihnen zeigen, wie Sie ein Modell f√ºr maschinelles Lernen mithilfe des Flask-Frameworks in Python implementieren. <a name="habracut"></a><br><br>  <b>Inhalt</b> <br><br><ol><li>  Implementierungsoptionen f√ºr Modelle des maschinellen Lernens. </li><li>  Was ist eine API? </li><li>  Installieren der Python-Umgebung und grundlegende Informationen zu Flask. </li><li>  Erstellen eines maschinellen Lernmodells. </li><li>  Speichern von Modellen f√ºr maschinelles Lernen: Serialisierung und Deserialisierung. </li><li>  Erstellen einer API mit Flask. </li></ol><br>  <b>Implementierungsoptionen f√ºr Modelle des maschinellen Lernens.</b> <b><br></b> <br>  In den meisten F√§llen ist die tats√§chliche Verwendung von Modellen f√ºr maschinelles Lernen ein zentraler Bestandteil der Entwicklung, auch wenn es sich nur um eine kleine Komponente eines automatisierten E-Mail-Verteilungssystems oder Chatbots handelt.  Manchmal scheinen die Hindernisse f√ºr die Umsetzung un√ºberwindbar. <br><br>  Beispielsweise verwenden die meisten ML-Spezialisten R oder Python f√ºr ihre wissenschaftliche Forschung.  Softwareentwickler, die einen v√∂llig anderen Technologie-Stack verwenden, werden jedoch Verbraucher dieser Modelle sein.  Es gibt zwei M√∂glichkeiten, um dieses Problem zu l√∂sen: <br><br>  <b>Option 1: Schreiben Sie den gesamten Code in der Sprache neu, mit der die Entwicklungsingenieure arbeiten.</b>  Es klingt bis zu einem gewissen Grad logisch, aber es erfordert viel Zeit und M√ºhe, die entwickelten Modelle zu replizieren.  Am Ende ist es nur Zeitverschwendung.  Die meisten Sprachen wie JavaScript verf√ºgen nicht √ºber geeignete Bibliotheken f√ºr die Arbeit mit ML.  Daher ist es eine rationale L√∂sung, diese Option nicht zu verwenden. <br><br>  <b>Option 2: Verwenden Sie die API.</b>  Netzwerk-APIs l√∂sten das Problem der Arbeit mit Anwendungen in verschiedenen Sprachen.  Wenn der Front-End-Entwickler Ihr Modell f√ºr maschinelles Lernen verwenden muss, um eine Webanwendung auf dieser Basis zu erstellen, muss er nur die URL des Zielservers abrufen, auf dem die API erl√§utert wird. <br><br>  <b>Was ist eine API?</b> <br><br>  Mit einfachen Worten, die API (Application Programming Interface) ist eine Art Vertrag zwischen zwei Programmen. Wenn ein Benutzerprogramm Eingabedaten in einem bestimmten Format bereitstellt, leitet das Entwicklerprogramm (API) diese durch sich selbst und stellt dem Benutzer Ausgabedaten zur Verf√ºgung. <br><br>  Sie k√∂nnen einige Artikel selbst lesen, die gut beschreiben, warum die API bei Entwicklern sehr beliebt ist. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">API-Verlauf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">API-Einf√ºhrung</a> </li></ul><br>  Die meisten gro√üen Cloud-Dienstleister und kleinere Unternehmen mit Schwerpunkt auf maschinellem Lernen bieten gebrauchsfertige APIs an.  Sie erf√ºllen die Anforderungen von Entwicklern, die maschinelles Lernen nicht verstehen, diese Technologie jedoch in ihre L√∂sungen integrieren m√∂chten. <br><br>  Einer dieser API-Anbieter ist beispielsweise Google mit seiner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Vision-API</a> . <br><br>  Der Entwickler muss lediglich die REST-API (Representational State Transfer) mit dem von Google bereitgestellten SDK aufrufen.  Sehen Sie, was Sie mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Vision-API</a> tun k√∂nnen. <br><br>  H√∂rt sich toll an, oder?  In diesem Artikel erfahren Sie, wie Sie mit Flask, einem Python-Framework, eine eigene API erstellen. <br><br>  <i><b>Hinweis</b></i> : Flask ist nicht das einzige Netzwerkframework f√ºr diesen Zweck.  Es gibt auch Django, Falcon, Hug und viele andere, die in diesem Artikel nicht erw√§hnt werden.  F√ºr R gibt es beispielsweise ein Paket namens <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klempner</a></i> <br><br>  <b>Installieren der Python-Umgebung und grundlegende Informationen zu Flask.</b> <br><br>  <b>1) Erstellen einer virtuellen Umgebung mit Anaconda.</b>  Wenn Sie eine eigene virtuelle Umgebung f√ºr Python erstellen und den erforderlichen Abh√§ngigkeitsstatus beibehalten m√ºssen, bietet Anaconda hierf√ºr gute L√∂sungen.  Weiter wird mit der Kommandozeile arbeiten. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier</a> finden Sie das <i>Miniconda-</i> Installationsprogramm f√ºr Python. </li><li><code>wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh</code> </li> <li> <code>bash Miniconda3-latest-Linux-x86_64.sh</code> </li> <li>  Folgen Sie der Reihenfolge der Fragen. </li><li> <code>source .bashrc</code> </li> <li>  Wenn Sie <code>conda</code> : <code>conda</code> , wird eine Liste der verf√ºgbaren Befehle und Hilfen <code>conda</code> . </li><li>  <code>conda create --name &lt;environment-name&gt; python=3.6</code> zum Erstellen einer neuen Umgebung <code>conda create --name &lt;environment-name&gt; python=3.6</code> : <code>conda create --name &lt;environment-name&gt; python=3.6</code> </li><li>  Befolgen Sie die Schritte, zu denen Sie aufgefordert werden, und geben Sie am Ende Folgendes ein: <code>source activate &lt;environment-name&gt;</code> </li><li>  Installieren Sie die erforderlichen Python-Pakete.  Die wichtigsten sind <i>Flasche</i> und <i>Gunicorn.</i> </li></ul><br>  <b>2) Wir werden versuchen, unsere einfache "Hello World" <i>-Kolbenanwendung</i> mit <i>Gunicorn zu erstellen</i> .</b> <br><br><ul><li>  √ñffnen Sie Ihren bevorzugten Texteditor und erstellen Sie die Datei <code>hello-world.py</code> im Ordner </li><li>  Schreiben Sie den folgenden Code: </li></ul><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Filename: hello-world.py """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">'/users/&lt;string:username&gt;'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello_world</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(username=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello {}!"</span></span>.format(username))</code> </pre> <br><ul><li>  Speichern Sie die Datei und kehren Sie zum Terminal zur√ºck. </li><li>  Um die API zu starten, f√ºhren Sie sie im Terminal aus: <code>gunicorn --bind 0.0.0.0:8000 hello-world:app</code> </li><li>  Wenn Sie Folgendes erhalten, sind Sie auf dem richtigen Weg: </li></ul><br><img src="https://habrastorage.org/webt/fl/69/hj/fl69hjmljbp5ezgivwxa6o-b73k.jpeg"><br><br><ul><li>  Geben Sie im Browser Folgendes ein: <code>https://localhost:8000/users/any-name</code> <br></li></ul><br><img src="https://habrastorage.org/webt/8i/gj/v-/8igjv-h34rhxj6rie9rbffgdda8.jpeg"><br><br>  Hurra!  Du hast dein erstes Flask-Programm geschrieben!  Da Sie bereits Erfahrung mit diesen einfachen Schritten haben, k√∂nnen wir Netzwerkendpunkte erstellen, auf die lokal zugegriffen werden kann. <br><br>  Mit Flask k√∂nnen wir unsere Modelle verpacken und als Web-API verwenden.  Wenn wir komplexere Netzwerkanwendungen erstellen m√∂chten (z. B. in JavaScript), m√ºssen wir einige √Ñnderungen hinzuf√ºgen. <br><br>  <b>Erstellen eines maschinellen Lernmodells.</b> <br><br><ul><li>  Schauen wir uns zun√§chst den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wettbewerb f√ºr</a> maschinelles Lernen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Darlehensvorhersagewettbewerbs an</a> .  Das Hauptziel besteht darin, eine Vorverarbeitungspipeline einzurichten und ML-Modelle zu erstellen, um die Vorhersageaufgabe w√§hrend der Bereitstellung zu erleichtern. </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.externals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> joblib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split, GridSearchCV <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseEstimator, TransformerMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.pipeline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> make_pipeline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> warnings warnings.filterwarnings(<span class="hljs-string"><span class="hljs-string">"ignore"</span></span>)</code> </pre> <br><ul><li>  Speichern Sie den Datensatz im Ordner: </li></ul><br><pre> <code class="python hljs">!ls /home/pratos/Side-Project/av_articles/flask_api/data/</code> </pre> <br><pre> <code class="python hljs">test.csv training.csv</code> </pre> <br><pre> <code class="python hljs">data = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/training.csv'</span></span>)</code> </pre> <br><pre> <code class="python hljs">list(data.columns)</code> </pre> <br><pre> <code class="python hljs">[<span class="hljs-string"><span class="hljs-string">'Loan_ID'</span></span>, <span class="hljs-string"><span class="hljs-string">'Gender'</span></span>, <span class="hljs-string"><span class="hljs-string">'Married'</span></span>, <span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>, <span class="hljs-string"><span class="hljs-string">'Education'</span></span>, <span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>, <span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>, <span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>, <span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>, <span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>, <span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>, <span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>, <span class="hljs-string"><span class="hljs-string">'Loan_Status'</span></span>]</code> </pre> <br><pre> <code class="python hljs">data.shape</code> </pre> <br><br><pre> <code class="python hljs">(<span class="hljs-number"><span class="hljs-number">614</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre>  ul&gt; <br>  Finden Sie die Null / Nan-Werte in den Spalten: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.columns: print(<span class="hljs-string"><span class="hljs-string">"The number of null values in:{} == {}"</span></span>.format(_, data[_].isnull().sum()))</code> </pre> <br><br><pre> <code class="python hljs">The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_ID == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Gender == <span class="hljs-number"><span class="hljs-number">13</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Married == <span class="hljs-number"><span class="hljs-number">3</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Dependents == <span class="hljs-number"><span class="hljs-number">15</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Education == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Self_Employed == <span class="hljs-number"><span class="hljs-number">32</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:ApplicantIncome == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:CoapplicantIncome == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:LoanAmount == <span class="hljs-number"><span class="hljs-number">22</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_Amount_Term == <span class="hljs-number"><span class="hljs-number">14</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Credit_History == <span class="hljs-number"><span class="hljs-number">50</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Property_Area == <span class="hljs-number"><span class="hljs-number">0</span></span> The number of null values <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>:Loan_Status == <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><ul><li>  Der n√§chste Schritt besteht darin, Datens√§tze f√ºr Schulungen und Tests zu erstellen: </li></ul><br><pre> <code class="python hljs">red_var = [<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>,<span class="hljs-string"><span class="hljs-string">'Married'</span></span>,<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>,<span class="hljs-string"><span class="hljs-string">'Education'</span></span>,<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>,<span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>,<span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>,\ <span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>,<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>,<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>,<span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>] X_train, X_test, y_train, y_test = train_test_split(data[pred_var], data[<span class="hljs-string"><span class="hljs-string">'Loan_Status'</span></span>], \ test_size=<span class="hljs-number"><span class="hljs-number">0.25</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><ul><li>  Um sicherzustellen, dass alle Vorverarbeitungsschritte auch nach dem Experimentieren korrekt ausgef√ºhrt werden und wir w√§hrend der Vorhersage nichts verpasst haben, erstellen wir unseren eigenen Scikit-Lern-Evaluator f√ºr die Vorverarbeitung (Vorverarbeitungs-Scikit-Lernsch√§tzer). . </li></ul><br>  Lesen Sie <a href="">Folgendes</a> , um zu verstehen, wie wir es erstellt haben. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseEstimator, TransformerMixin <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreProcessing</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseEstimator, TransformerMixin)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Custom Pre-Processing estimator for our use-case """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, df)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Regular transform() that is a help for training, validation &amp; testing datasets (NOTE: The operations performed here are the ones that we did prior to this cell) """</span></span> pred_var = [<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>,<span class="hljs-string"><span class="hljs-string">'Married'</span></span>,<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>,<span class="hljs-string"><span class="hljs-string">'Education'</span></span>,<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>,<span class="hljs-string"><span class="hljs-string">'ApplicantIncome'</span></span>,\ <span class="hljs-string"><span class="hljs-string">'CoapplicantIncome'</span></span>,<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>,<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>,<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>,<span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>] df = df[pred_var] df[<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>].fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'No'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>].fillna(self.term_mean_) df[<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Credit_History'</span></span>].fillna(<span class="hljs-number"><span class="hljs-number">1</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Married'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Married'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'No'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>].fillna(<span class="hljs-string"><span class="hljs-string">'Male'</span></span>) df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>] = df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>].fillna(self.amt_mean_) gender_values = {<span class="hljs-string"><span class="hljs-string">'Female'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Male'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} married_values = {<span class="hljs-string"><span class="hljs-string">'No'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Yes'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} education_values = {<span class="hljs-string"><span class="hljs-string">'Graduate'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Not Graduate'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} employed_values = {<span class="hljs-string"><span class="hljs-string">'No'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Yes'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>} property_values = {<span class="hljs-string"><span class="hljs-string">'Rural'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'Urban'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Semiurban'</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>} dependent_values = {<span class="hljs-string"><span class="hljs-string">'3+'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.replace({<span class="hljs-string"><span class="hljs-string">'Gender'</span></span>: gender_values, <span class="hljs-string"><span class="hljs-string">'Married'</span></span>: married_values, <span class="hljs-string"><span class="hljs-string">'Education'</span></span>: education_values, \ <span class="hljs-string"><span class="hljs-string">'Self_Employed'</span></span>: employed_values, <span class="hljs-string"><span class="hljs-string">'Property_Area'</span></span>: property_values, \ <span class="hljs-string"><span class="hljs-string">'Dependents'</span></span>: dependent_values}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> df.as_matrix() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, df, y=None, **fit_params)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Fitting the Training dataset &amp; calculating the required values from train eg: We will need the mean of X_train['Loan_Amount_Term'] that will be used in transformation of X_test """</span></span> self.term_mean_ = df[<span class="hljs-string"><span class="hljs-string">'Loan_Amount_Term'</span></span>].mean() self.amt_mean_ = df[<span class="hljs-string"><span class="hljs-string">'LoanAmount'</span></span>].mean() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self</code> </pre> <br><ul><li>  Konvertieren Sie <code>y_train</code> und <code>y_test</code> in <code>np.array</code> : </li></ul><br><pre> <code class="python hljs">y_train = y_train.replace({<span class="hljs-string"><span class="hljs-string">'Y'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'N'</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}).as_matrix() y_test = y_test.replace({<span class="hljs-string"><span class="hljs-string">'Y'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'N'</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}).as_matrix()</code> </pre> <br>  Erstellen wir eine Pipeline, um sicherzustellen, dass alle Vorverarbeitungsschritte, die wir ausf√ºhren, die Arbeit des Scikit-Learn-Evaluators sind. <br><br><pre> <code class="python hljs">pipe = make_pipeline(PreProcessing(), RandomForestClassifier())</code> </pre> <br><pre> <code class="python hljs">pipe</code> </pre> <br><pre> <code class="python hljs">Pipeline(memory=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, steps=[(<span class="hljs-string"><span class="hljs-string">'preprocessing'</span></span>, PreProcessing()), (<span class="hljs-string"><span class="hljs-string">'randomforestclassifier'</span></span>, RandomForestClassifier(bootstrap=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, class_weight=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, criterion=<span class="hljs-string"><span class="hljs-string">'gini'</span></span>, max_depth=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, max_features=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, max_leaf_nodes=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_impurity_decrease=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, min_impurity_split=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_samples_leaf=<span class="hljs-number"><span class="hljs-number">1</span></span>, min_samples_split=<span class="hljs-number"><span class="hljs-number">2</span></span>, min_weight_fraction_leaf=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, n_estimators=<span class="hljs-number"><span class="hljs-number">10</span></span>, n_jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, oob_score=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, random_state=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>, warm_start=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>))])</code> </pre> <br>  Um nach geeigneten Hyperparametern zu suchen (Grad f√ºr Polynomobjekte und Alpha f√ºr eine Kante), f√ºhren wir eine Rastersuche (Rastersuche) durch: <br><br><ul><li>  Definiere param_grid: </li></ul><br><pre> <code class="python hljs">param_grid = {<span class="hljs-string"><span class="hljs-string">"randomforestclassifier__n_estimators"</span></span> : [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__max_depth"</span></span> : [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__max_leaf_nodes"</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>], <span class="hljs-string"><span class="hljs-string">"randomforestclassifier__min_impurity_split"</span></span>: [<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>]}</code> </pre> <br><ul><li>  Startet die Rastersuche: </li></ul><br><pre> <code class="python hljs">grid = GridSearchCV(pipe, param_grid=param_grid, cv=<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br><ul><li>  Wir passen die Trainingsdaten f√ºr den Pipeline-Sch√§tzer an: </li></ul><br><pre> <code class="python hljs">grid.fit(X_train, y_train)</code> </pre> <br><pre> <code class="python hljs">GridSearchCV(cv=<span class="hljs-number"><span class="hljs-number">3</span></span>, error_score=<span class="hljs-string"><span class="hljs-string">'raise'</span></span>, estimator=Pipeline(memory=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, steps=[(<span class="hljs-string"><span class="hljs-string">'preprocessing'</span></span>, PreProcessing()), (<span class="hljs-string"><span class="hljs-string">'randomforestclassifier'</span></span>, RandomForestClassifier(bootstrap=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, class_weight=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, criterion=<span class="hljs-string"><span class="hljs-string">'gini'</span></span>, max_depth=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, max_features=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, max_leaf_nodes=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, min_impurity_decrease=<span class="hljs-number"><span class="hljs-number">0.0</span></span>, min_impu..._jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, oob_score=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, random_state=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>, warm_start=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>))]), fit_params=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, iid=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, n_jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, param_grid={<span class="hljs-string"><span class="hljs-string">'randomforestclassifier__n_estimators'</span></span>: [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_leaf_nodes'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__min_impurity_split'</span></span>: [<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>], <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_depth'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]}, pre_dispatch=<span class="hljs-string"><span class="hljs-string">'2*n_jobs'</span></span>, refit=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, return_train_score=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, scoring=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><ul><li>  Mal sehen, welchen Parameter die Suche im Raster gew√§hlt hat: </li></ul><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"Best parameters: {}"</span></span>.format(grid.best_params_))</code> </pre> <br><pre> <code class="python hljs">Best parameters: {<span class="hljs-string"><span class="hljs-string">'randomforestclassifier__n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_leaf_nodes'</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__min_impurity_split'</span></span>: <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-string"><span class="hljs-string">'randomforestclassifier__max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span>}</code> </pre> <br><ul><li>  Berechnen Sie: </li></ul><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"Validation set score: {:.2f}"</span></span>.format(grid.score(X_test, y_test)))</code> </pre><br><pre> <code class="python hljs">Validation set score: <span class="hljs-number"><span class="hljs-number">0.79</span></span></code> </pre><br><ul><li>  Laden Sie die Testsuite herunter: </li></ul><br><pre> <code class="python hljs">test_df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/test.csv'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">"utf-8-sig"</span></span>) test_df = test_df.head()</code> </pre> <br><pre> <code class="python hljs">grid.predict(test_df)</code> </pre> <br><pre> <code class="python hljs">array([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br>  Unsere Pipeline sieht gut genug aus, um mit dem n√§chsten wichtigen Schritt fortzufahren: der Serialisierung des maschinellen Lernmodells. <br><br>  <b>Speichern eines maschinellen Lernmodells: Serialisierung und Deserialisierung.</b> <br><br><blockquote>  "In der Informatik bedeutet Serialisierung im Kontext der Datenspeicherung, Datenstrukturen oder Objektzust√§nde in ein gespeichertes Format (z. B. eine Datei oder einen Speicherpuffer) zu √ºbersetzen und sp√§ter in derselben oder einer anderen Computerumgebung zu rekonstruieren." </blockquote><br><br>  In Python ist das Beizen die Standardmethode zum Speichern und Abrufen von Objekten in ihrem urspr√ºnglichen Zustand.  Um es klarer zu machen, werde ich ein einfaches Beispiel geben: <br><br><pre> <code class="python hljs">list_to_pickle = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'here'</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'walker'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#Pickling the list import pickle list_pickle = pickle.dumps(list_to_pickle)</span></span></code> </pre> <br><pre> <code class="python hljs">list_pickle</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">b'\x80\x03]q\x00(K\x01X\x04\x00\x00\x00hereq\x01K{X\x06\x00\x00\x00walkerq\x02e.'</span></span></code> </pre> <br>  Dann entladen wir das Dosenobjekt erneut: <br><br><pre> <code class="python hljs">loaded_pickle = pickle.loads(list_pickle)</code> </pre> <br><pre> <code class="python hljs">loaded_pickle</code> </pre> <br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'here'</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'walker'</span></span>]</code> </pre> <br>  Wir k√∂nnen vordefinierte Objekte in einer Datei speichern und verwenden.  Diese Methode √§hnelt dem Erstellen von <code>.rda</code> Dateien, wie beispielsweise bei der R-Programmierung. <br><br>  <i><b>Hinweis:</b></i> Einige m√∂gen diese Aufbewahrungsmethode f√ºr die Serialisierung m√∂glicherweise nicht.  Eine Alternative k√∂nnte <code>h5py</code> . <br><br>  Wir haben eine benutzerdefinierte Klasse (Class), die wir w√§hrend des Trainings importieren m√ºssen. Daher verwenden wir das <code>dill</code> Modul, um den Klassenauswerter mit dem <code>dill</code> zu verpacken. <br><br>  Es wird empfohlen, eine separate Datei <code>training.py</code> erstellen, die den gesamten Code zum Trainieren des Modells enth√§lt.  (Ein Beispiel ist hier zu sehen). <br><br><ul><li>  Installieren Sie den <code>dill</code> </li></ul><br><pre> <code class="python hljs">!pip install dill</code> </pre> <br><pre> <code class="python hljs">Requirement already satisfied: dill <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /home/pratos/miniconda3/envs/ordermanagement/lib/python3<span class="hljs-number"><span class="hljs-number">.5</span></span>/site-packages</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dill <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pickle filename = <span class="hljs-string"><span class="hljs-string">'model_v1.pk'</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'../flask_api/models/'</span></span>+filename, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> file: pickle.dump(grid, file)</code> </pre> <br>  Das Modell wird in dem oben ausgew√§hlten Verzeichnis gespeichert.  Sobald ein Modell eingemottet ist, kann es in eine Flaschenverpackung eingewickelt werden.  Zuvor m√ºssen Sie jedoch sicherstellen, dass die vordefinierte Datei funktioniert.  Laden wir es zur√ºck und machen eine Vorhersage: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'../flask_api/models/'</span></span>+filename ,<span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: loaded_model = pickle.load(f)</code> </pre> <br><pre> <code class="python hljs">loaded_model.predict(test_df)</code> </pre> <br><pre> <code class="python hljs">array([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br>  Da wir die Vorverarbeitungsschritte befolgt haben, damit die neu angekommenen Daten Teil der Pipeline sind, m√ºssen wir nur Predict () ausf√ºhren.  Mit der Scikit-Learn-Bibliothek ist es ganz einfach, mit Pipelines zu arbeiten.  Gutachter und Pipelines k√ºmmern sich um Ihre Zeit und Ihre Nerven, auch wenn die anf√§ngliche Implementierung wild erscheint. <br><br>  <b>Erstellen einer API mit Flask</b> <br><br>  Lassen Sie uns die Ordnerstruktur so einfach wie m√∂glich halten: <br><br><img src="https://habrastorage.org/webt/y4/hm/2p/y4hm2pao2sje1zdmwe4t8cnjvhg.png"><br><br>  Das Erstellen eines Wrappers f√ºr die Funktion <code>apicall()</code> besteht aus drei wichtigen Teilen: <br><br><ul><li>  Empfangen von <code>request</code> (f√ºr die eine Prognose erstellt wird); </li><li>  Laden eines Dosengutachters; </li><li>  √úbersetzung unserer Prognosen im JSON-Format und Erhalt eines Antwortstatuscodes <code>status code: 200</code> ; </li></ul><br>  HTTP-Nachrichten werden aus dem Header und dem Body erstellt.  Im Allgemeinen wird der Hauptteilinhalt im JSON-Format √ºbertragen.  Wir senden ( <code>POST url-endpoint/</code> ) eingehende Daten als Paket f√ºr den Empfang von Prognosen. <br><br>  <i><b>Hinweis:</b></i> Sie k√∂nnen einfachen Text, XML, Lebensl√§ufe oder ein Bild direkt senden, um das Format auszutauschen. In unserem Fall ist es jedoch vorzuziehen, JSON zu verwenden. <br><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Filename: server.py """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.externals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> joblib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, jsonify, request app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apicall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""API Call Pandas dataframe (sent as a payload) from API Call """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: test_json = request.get_json() test = pd.read_json(test_json, orient=<span class="hljs-string"><span class="hljs-string">'records'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#To resolve the issue of TypeError: Cannot compare types 'ndarray(dtype=int64)' and 'str' test['Dependents'] = [str(x) for x in list(test['Dependents'])] #Getting the Loan_IDs separated out loan_ids = test['Loan_ID'] except Exception as e: raise e clf = 'model_v1.pk' if test.empty: return(bad_request()) else: #Load the saved model print("Loading the model...") loaded_model = None with open('./models/'+clf,'rb') as f: loaded_model = pickle.load(f) print("The model has been loaded...doing predictions now...") predictions = loaded_model.predict(test) """Add the predictions as Series to a new pandas dataframe OR Depending on the use-case, the entire test data appended with the new files """ prediction_series = list(pd.Series(predictions)) final_predictions = pd.DataFrame(list(zip(loan_ids, prediction_series))) """We can be as creative in sending the responses. But we need to send the response codes as well. """ responses = jsonify(predictions=final_predictions.to_json(orient="records")) responses.status_code = 200 return (responses)</span></span></code> </pre> <br>  <code>gunicorn --bind 0.0.0.0:8000 server:app</code> nach der Ausf√ºhrung <code>gunicorn --bind 0.0.0.0:8000 server:app</code> ein: <code>gunicorn --bind 0.0.0.0:8000 server:app</code> <br>  Generieren wir Daten f√ºr die Prognose und eine Warteschlange f√ºr die <code>https:0.0.0.0:8000/predict</code> Ausf√ºhrung der API unter <code>https:0.0.0.0:8000/predict</code> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setting the headers to send and accept json responses """</span></span> header = {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, \ <span class="hljs-string"><span class="hljs-string">'Accept'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>} <span class="hljs-string"><span class="hljs-string">"""Reading test batch """</span></span> df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'../data/test.csv'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">"utf-8-sig"</span></span>) df = df.head() <span class="hljs-string"><span class="hljs-string">"""Converting Pandas Dataframe to json """</span></span> data = df.to_json(orient=<span class="hljs-string"><span class="hljs-string">'records'</span></span>)</code> </pre> <br><pre> <code class="python hljs">data</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">'[{"Loan_ID":"LP001015","Gender":"Male","Married":"Yes","Dependents":"0","Education":"Graduate","Self_Employed":"No","ApplicantIncome":5720,"CoapplicantIncome":0,"LoanAmount":110.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001022","Gender":"Male","Married":"Yes","Dependents":"1","Education":"Graduate","Self_Employed":"No","ApplicantIncome":3076,"CoapplicantIncome":1500,"LoanAmount":126.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001031","Gender":"Male","Married":"Yes","Dependents":"2","Education":"Graduate","Self_Employed":"No","ApplicantIncome":5000,"CoapplicantIncome":1800,"LoanAmount":208.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"},{"Loan_ID":"LP001035","Gender":"Male","Married":"Yes","Dependents":"2","Education":"Graduate","Self_Employed":"No","ApplicantIncome":2340,"CoapplicantIncome":2546,"LoanAmount":100.0,"Loan_Amount_Term":360.0,"Credit_History":null,"Property_Area":"Urban"},{"Loan_ID":"LP001051","Gender":"Male","Married":"No","Dependents":"0","Education":"Not Graduate","Self_Employed":"No","ApplicantIncome":3276,"CoapplicantIncome":0,"LoanAmount":78.0,"Loan_Amount_Term":360.0,"Credit_History":1.0,"Property_Area":"Urban"}]'</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""POST &lt;url&gt;/predict """</span></span> resp = requests.post(<span class="hljs-string"><span class="hljs-string">"http://0.0.0.0:8000/predict"</span></span>, \ data = json.dumps(data),\ headers= header)</code> </pre> <br><pre> <code class="python hljs">resp.status_code</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""The final response we get is as follows: """</span></span> resp.json()</code> </pre> <br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">'predictions'</span></span>: <span class="hljs-string"><span class="hljs-string">'[{"0":"LP001015","1":1},{...</span></span></code> </pre><br>  <b>Fazit</b> <br><br>  In diesem Artikel haben wir nur die H√§lfte des Weges zur√ºckgelegt und eine funktionierende API erstellt, die Prognosen liefert, und sind der direkten Integration von ML-L√∂sungen in entwickelte Anwendungen einen Schritt n√§her gekommen.  Wir haben eine ziemlich einfache API erstellt, die beim Prototyping des Produkts hilft und es wirklich funktionsf√§hig macht. Um es jedoch an die Produktion zu senden, m√ºssen Sie einige Anpassungen vornehmen, die nicht mehr im Bereich des maschinellen Lernens liegen. <br><br>  Beim Erstellen der API sind einige Dinge zu beachten: <br><br><ul><li>  Das Erstellen einer Qualit√§ts-API aus Spaghetti-Code ist nahezu unm√∂glich. Verwenden Sie daher Ihr Wissen im maschinellen Lernen, um eine n√ºtzliche und bequeme API zu erstellen. </li><li>  Versuchen Sie, die Versionskontrolle f√ºr Modelle und API-Code zu verwenden.  Beachten Sie, dass Flask keine Unterst√ºtzung f√ºr Tools zur Versionskontrolle bietet.  Das Speichern und Verfolgen von ML-Modellen ist eine schwierige Aufgabe. Finden Sie einen f√ºr Sie geeigneten Weg.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier</a> gibt es einen Artikel dar√ºber, wie das geht. </li><li>  Aufgrund der Besonderheiten von Scikit-Lernmodellen m√ºssen Sie sicherstellen, dass der Evaluator und der Trainingscode nebeneinander liegen (wenn Sie einen benutzerdefinierten Evaluator f√ºr die Vorverarbeitung oder √§hnliche Aufgaben verwenden).  Daher befindet sich neben dem vordefinierten Modell ein Klassenauswerter. </li></ul><br>  Der n√§chste logische Schritt besteht darin, Mechaniken f√ºr die Bereitstellung einer solchen API auf einer kleinen virtuellen Maschine zu erstellen.  Es gibt verschiedene M√∂glichkeiten, dies zu tun, aber wir werden sie im n√§chsten Artikel behandeln. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Code und Erkl√§rung f√ºr diesen Artikel</a> <br><br>  <b>N√ºtzliche Quellen:</b> <br><br>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geben Sie Ihre Daten nicht ein.</a> <br>  [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scikit Learn-kompatible Transformatoren erstellen</a> . <br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwenden von jsonify in Flask</a> . <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flask-QuickStart.</a> <br><br>  Hier ist so ein Material.  Abonnieren Sie uns, wenn Ihnen die Ver√∂ffentlichung gefallen hat, und melden Sie sich f√ºr ein kostenloses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offenes Webinar</a> zum Thema ‚ÄûMetrische Klassifizierungsalgorithmen‚Äú an, das am 12. M√§rz vom Entwickler und Datenwissenschaftler mit 5 Jahren Erfahrung - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alexander Nikitin</a> - abgehalten wird. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442918/">https://habr.com/ru/post/de442918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442906/index.html">Gibt es Leben auf dem russischen OS-Markt? √úberblick √ºber das beliebte russische Betriebssystem</a></li>
<li><a href="../de442910/index.html">Warum brauchen wir erweiterte Analysen in SIBUR?</a></li>
<li><a href="../de442912/index.html">Kundgebung gegen die Isolation von Runet</a></li>
<li><a href="../de442914/index.html">Battle Royale: Designgeheimnisse des beliebtesten Gaming-Genres</a></li>
<li><a href="../de442916/index.html">Sind Raubkopien von UKW-Radiosendern heute relevant?</a></li>
<li><a href="../de442920/index.html">Coroutinen :: praktische Erfahrung</a></li>
<li><a href="../de442922/index.html">Mondmission "Bereshit" - Eigenschaften des Ger√§ts, eine Reihe von Man√∂vern und der l√§ngste Weg zum Mond</a></li>
<li><a href="../de442924/index.html">Erweitertes Terrain Texture Splatting</a></li>
<li><a href="../de442926/index.html">"Mausaufhebens" im Infrarotlicht: das Einbringen von Nanopartikeln in die subretinale Region des Mausauges</a></li>
<li><a href="../de442928/index.html">Schreiben eines flexiblen Codes mit SOLID</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>