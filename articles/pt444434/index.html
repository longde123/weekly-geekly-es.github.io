<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè© üòû ü¶ñ Chegou a hora do Java 12! Revis√£o dos PECs quentes üë®üèª‚Äçüéì üë®üèΩ‚Äç‚úàÔ∏è üïú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seis meses se passaram, o que significa que √© hora de instalar o novo Java ! Foi uma longa jornada, e poucos chegaram ao fim. As linhas brutas ca√≠ram ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chegou a hora do Java 12! Revis√£o dos PECs quentes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/444434/"><p><img src="https://habrastorage.org/webt/k8/rn/qa/k8rnqagstd_wu4hezoj_bnjzfem.png"></p><br><p>  Seis meses se passaram, o que significa que √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hora de instalar o novo Java</a> !  Foi uma longa jornada, e poucos chegaram ao fim.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As linhas</a> brutas ca√≠ram de PECs interessantes, mas falaremos sobre o resto. </p><a name="habracut"></a><br><h1 id="kak-vsyo-proishodit">  Como est√° indo tudo </h1><br><p>  O lan√ßamento da nova vers√£o do Java ocorre de acordo com o novo ciclo de lan√ßamento "acelerado", com dura√ß√£o de cerca de seis meses.  As datas exatas s√£o definidas na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina do projeto</a> .  Havia v√°rias fases principais para o JDK 12: </p><br><ul><li>  13/12/2018 - A primeira fase da desacelera√ß√£o (neste momento, um fork √© feito a partir da ramifica√ß√£o principal no reposit√≥rio); </li><li>  17/01/2019 - A segunda fase de desacelera√ß√£o (para concluir tudo o que √© poss√≠vel); </li><li>  07/02/2019 - Liberar candidato (apenas os bugs mais importantes s√£o corrigidos); </li><li>  19/03/2019 - Lan√ßamento, Disponibilidade geral.  <strong>&lt;- voc√™ est√° aqui</strong> </li></ul><br><p>  O que temos dessa programa√ß√£o?  Sim, de fato, nada - acabamos de chegar √† linha de chegada e assistimos aos amantes do legado de uma altura do nov√≠ssimo JDK 12. </p><br><h1 id="bagi-panika-vse-na-dno">  Bugs!  Panic!  Tudo para o fundo! </h1><br><p><img src="https://habrastorage.org/webt/9j/jw/j8/9jjwj87t8vtlqyiv4zmox4xljem.jpeg"></p><br><p>  Quando uma nova vers√£o n√£o LTS √© lan√ßada, geralmente todos n√£o d√£o a m√≠nima para novos recursos.  √â mais interessante se tudo desmoronar para o inferno. </p><br><p>  Claro, existem muitos bugs, mas n√£o no JDK 12 :) A julgar pelo jir, tudo √© normal: </p><br><p><img src="https://habrastorage.org/webt/st/yr/cr/styrcrroe8hobgqc6jpxgv5hknw.jpeg"></p><br><p>  Vou citar a solicita√ß√£o para que voc√™ entenda <em>exatamente</em> qual √© a "norma": </p><br><pre><code class="plaintext hljs">project = JDK AND issuetype = Bug AND status in (Open, "In Progress", New) AND priority in (P1) AND (fixVersion in (12) OR fixVersion is EMPTY AND affectedVersion in (12) AND affectedVersion not in regexVersion("11.*", "10.*", "9.*", "8.*", "7.*", "6.*")) AND (labels is EMPTY OR labels not in (jdk12-defer-request, noreg-demo, noreg-doc, noreg-self)) AND (component not in (docs, globalization, infrastructure) OR component = infrastructure AND subcomponent = build) AND reporter != "Shadow Bug" ORDER BY priority, component, subcomponent, assignee</code> </pre> <br><p>  Obviamente, <em>em geral os</em> bugs t√™m um lugar para estar, eles n√£o v√£o a lugar algum em um projeto t√£o grande.  Alega-se apenas que, no momento, os erros de P1 n√£o foram notados. </p><br><p>  Uma comunica√ß√£o mais formal com bugs √© declarada em um documento especial, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JEP 3: JDK Release Process</a> , que pertence ao nosso administrador imortal nas ondas turbulentas do oceano Java - Mark Reinhold. </p><br><p>  E, em particular, vale a pena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenterrar um par√°grafo</a> dizendo <del>  quem √© o culpado e o que fazer </del>  como transferir ingressos se voc√™ n√£o tiver tempo para o 12¬∫ lan√ßamento.  √â necess√°rio colocar no rastreador de erros o r√≥tulo <code>jdk$N-defer-request</code> no qual N indica de qual release voc√™ deseja transferir e deixar um coment√°rio cuja primeira linha seja <em>Pedido de Adiamento</em> .  Al√©m disso, a an√°lise de todas essas solicita√ß√µes √© feita pelos l√≠deres das respectivas √°reas e projetos. </p><br><p>  Os problemas de aprova√ß√£o do TCK n√£o podem ser ignorados dessa maneira - √© garantido que o Java continua sendo o Java, e n√£o algo parecido com um sapo.  O <code>jdk$N-defer-request label</code> nunca desaparece.  √â interessante o que eles fazem com pessoas que violam a regra de n√£o excluir tags - sugiro alimentar porquinhos da √≠ndia. </p><br><p>  No entanto, desta maneira, voc√™ pode ver quantos bugs foram portados para o JDK 13. Vamos tentar esta consulta: </p><br><pre> <code class="plaintext hljs">project = JDK AND issuetype = Bug AND status in (Open, "In Progress", New) AND (labels in (jdk12-defer-request) AND labels not in (noreg-demo, noreg-doc, noreg-self)) AND (component not in (docs, globalization, infrastructure) OR component = infrastructure AND subcomponent = build) AND reporter != "Shadow Bug" ORDER BY priority, component, subcomponent, assignee</code> </pre> <br><p>  Apenas uma pe√ßa, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JDK-8216039</a> : "TLS com BC e RSASSA-PSS quebra o ECDHServerKeyExchange".  N√£o √© grosso.  Se esse argumento ainda n√£o ajudar, ent√£o, como seu advogado, recomendo tentar um sedativo. </p><br><h1 id="i-chto-zhe-v-suhom-ostatke">  E qual √© o resultado final? </h1><br><p><img src="https://habrastorage.org/webt/ef/uf/mx/efufmx-2rdphagrcihuscp0cswo.png"></p><br><p>  √â claro que a maioria dos recursos n√£o afeta os usu√°rios (programadores Java), mas os desenvolvedores do pr√≥prio OpenJDK.  Portanto, apenas no caso, divido os recursos em <strong>externo</strong> e <strong>interno</strong> .  Voc√™ pode pular os internos, mas estou ofendido, escrevi muito texto. </p><br><p>  <strong>189: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Shenandoah: um coletor de lixo com pouco tempo de pausa (experimental)</a></strong> </p><br><p>  <strong>Recurso externo</strong> .  Em resumo, as pessoas n√£o gostam quando o Java fica mais lento, principalmente se o SLA exigir capacidade de resposta da ordem de 10 a 500 milissegundos.  Agora, temos um GC de baixo impacto gratuito que est√° tentando trabalhar mais perto da borda esquerda desse intervalo.  A desvantagem √© que trocamos a CPU e a RAM para reduzir a lat√™ncia.  As fases de marca√ß√£o e compacta√ß√£o de quadril funcionam em paralelo com os threads de aplicativos ativos.  As pequenas pausas restantes devem-se ao fato de voc√™ ainda precisar pesquisar e atualizar as ra√≠zes do gr√°fico de objetos. </p><br><p>  Se nenhuma das op√ß√µes acima faz sentido para voc√™ - n√£o importa, Shenandoah <em>simplesmente funciona</em> , independentemente de entender ou n√£o os processos subjacentes. </p><br><p>  Alexei Shipilev, Christina Flood e Roman Kennke est√£o trabalhando nisso - voc√™ precisa se esfor√ßar para n√£o conhecer essas pessoas.  Se voc√™ geralmente entende como o GC funciona, mas n√£o sabe o que um desenvolvedor pode fazer por l√°, recomendo que voc√™ d√™ uma olhada na maravilhosa tradu√ß√£o do maravilhoso artigo de Leshina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Coletor de lixo caseiro para OpenJDK"</a> ou da s√©rie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JVM Anatomy Quarks</a> .  Isso √© <strong>muito interessante</strong> . </p><br><blockquote>  <strong>Extremamente importante.</strong>  A Oracle decidiu n√£o enviar o Sheandoah com nenhuma de suas vers√µes de lan√ßamento - nem a do jdk.java.net nem a do oracle.com.  Dado que Shenandoah √© um dos recursos mais importantes do JDK 12, vale a pena instalar outra montagem oficial, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por exemplo, da Azul</a> . </blockquote><br><hr><br><p>  <strong>230: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Su√≠te Microbenchmark</a></strong> </p><br><p>  <strong>Recurso interno</strong> .  Se voc√™ j√° tentou escrever marcas de micropigmenta√ß√£o, sabe que isso √© feito no JMH.  O JMH √© uma estrutura para criar, montar, ativar e analisar marcas de microbench para Java e outras linguagens da JVM. Voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">entende quem o</a> escreveu (todas as coincid√™ncias s√£o aleat√≥rias).  Infelizmente, nem tudo o que √© feito no mundo dos aplicativos "normais" pode ser aplicado dentro do JDK.  Por exemplo, √© improv√°vel que voc√™ veja o c√≥digo normal do Spring Framework l√°. </p><br><p>  Felizmente, a partir da vers√£o 12, √© poss√≠vel usar pelo menos JMH, e j√° existe um conjunto de testes gravados nela.  Voc√™ pode v√™-lo em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>jdk/jdk/test/micro/org/openjdk/bench</code></a> (voc√™ pode olhar diretamente no navegador, esse caminho √© um link). </p><br><p>  Por exemplo, eis a apar√™ncia do <a href="">teste de GC</a> . </p><br><blockquote>  Deixe-me lembr√°-lo de que n√£o temos o StackOverflow aqui e √© proibido usar o c√≥digo de copiar e colar, aqui e a seguir, sem ler e observar todas as licen√ßas do <a href="">arquivo correspondente</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do projeto OpenJDK</a> em geral, caso contr√°rio, voc√™ poder√° obter facilmente as √∫ltimas meias. </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Alloc</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LENGTH = <span class="hljs-number"><span class="hljs-number">400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ARR_LEN = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> largeLen = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> smalllen = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLargeConstArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blackhole bh)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localArrlen = ARR_LEN; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; LENGTH; i++) { Object[] tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[localArrlen]; bh.consume(tmp); } } <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br><hr><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">325: Alternar express√µes (visualiza√ß√£o)</a></strong> </p><br><p>  <strong>Recurso externo</strong> .  Isso mudar√° fundamentalmente sua abordagem para escrever switches sem fim com mais de duas telas.  Veja: </p><br><h3 id="virgin-java-switch-vs-">  Virgem Java Switch vs ... </h3><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dayNum = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (day) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MONDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> FRIDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SUNDAY: dayNum = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TUESDAY: dayNum = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> THURSDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SATURDAY: dayNum = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> WEDNESDAY: dayNum = <span class="hljs-number"><span class="hljs-number">9</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><p>  <strong>Por que √© ruim</strong> : h√° muitas cartas, voc√™ pode pular o intervalo (especialmente se voc√™ √© viciado em drogas ou est√° com TDAH). </p><br><h3 id="-vs-chad-java-swtich-expression">  ... vs Chad Java Swtich Expression! </h3><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dayNum = <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (day) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MONDAY -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TUESDAY -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = day.toString().length(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = f(k); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> result; } };</code> </pre> <br><p>  <strong>Por que bom</strong> : poucas letras, seguro, conveniente, novo recurso interessante. </p><br><p>  <strong>B√¥nus</strong> : se voc√™ √© um s√°dico, isso lhe dar√° a maior satisfa√ß√£o, j√° que milhares de desenvolvedores de IDE agora s√£o atormentados com o suporte desse recurso.  Sim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">lany</a> , sim? <del>  Voc√™ pode peg√°-lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ap√≥s o relat√≥rio em 6 de abril</a> e gentilmente pedir para fornecer todos os detalhes sujos. </del></p><br><blockquote>  <strong>Este √© um recurso de visualiza√ß√£o, mas n√£o funciona!</strong>  Ao compilar, no <code>javac</code> voc√™ precisa passar as op√ß√µes da linha de comando <code>--enable-preview --release 12</code> e executar o <code>java</code> - apenas o sinalizador <code>--enable-preview</code> . </blockquote><br><hr><br><p>  <strong>334: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API de constantes da JVM</a></strong> </p><br><p>  <strong>Recurso interno</strong> .  Os desenvolvedores querem manipular arquivos de classe.  Voc√™ precisa fazer isso de forma conveniente, e esta √© a declara√ß√£o do problema.  Pelo menos, √© o que Brian Goetz, dono deste JEP, disse :-) Tudo isso faz parte de um campo de batalha maior, mas por enquanto n√£o vamos nos aprofundar. </p><br><p>  Cada classe Java possui um chamado "pool constante", no qual existe um dump de alguns valores (como strings e ints) ou entidades de tempo de execu√ß√£o, como classes e m√©todos.  Voc√™ pode cavar esse despejo usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a instru√ß√£o ldc</a> - "load costant", para que todo esse lixo seja chamado de constantes carreg√°veis.  Ainda existe um caso especial para invokedynamic, mas n√£o importa. </p><br><p>  Se trabalharmos com arquivos de classe, queremos simular convenientemente instrumentos de bytecode e, portanto, constantes carreg√°veis.  O primeiro desejo √© simplesmente criar os tipos Java correspondentes, mas como voc√™ os apresenta com uma classe "viva", a estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>CONSTANT_Class_info</code></a> ?  Objetos de <code>Class</code> dependem da corre√ß√£o e consist√™ncia do carregamento de classes e, com o carregamento de classes em Java, uma bacanal infernal √© criada.  Para come√ßar, nem todas as classes podem ser carregadas na VM, mas voc√™ ainda precisa descrev√™-las! </p><br><p>  Eu gostaria de, de alguma forma, gerenciar coisas como classes, m√©todos e bestas menos conhecidas, como identificadores de m√©todos e constantes din√¢micas, levando em conta todas essas sutilezas. </p><br><p>  Isso √© resolvido com a introdu√ß√£o de novos tipos de links simb√≥licos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">baseados em valor</a> (no sentido da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JVMS 5.1</a> ), cada um dos quais descreve um tipo espec√≠fico de constante.  Descreve puramente nominalmente, isoladamente do carregamento de classes ou problemas de acesso.  Eles vivem em pacotes como <code>java.lang.invoke.constant</code> e n√£o solicitam, mas voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dar uma olhada</a> no patch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><hr><br><p>  <strong>340: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma porta AArch64, n√£o duas</a></strong> <br>  <strong>Recurso externo</strong> .  J√° no JDK 9, havia uma situa√ß√£o estranha quando a Oracle e a Red Hat colocavam simultaneamente suas portas ARM em alerta.  E agora vemos o final da hist√≥ria: a parte de 64 bits do porto de Oraklov foi removida do rio acima. </p><br><p>  Voc√™ poderia ter mergulhado na hist√≥ria por um longo tempo, mas existe uma maneira melhor.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A BellSoft</a> participou do desenvolvimento deste JEP, e seu escrit√≥rio est√° localizado em S√£o Petersburgo, pr√≥ximo ao antigo escrit√≥rio da Oracle. </p><br><p>  Portanto, imediatamente me virei imediatamente para Alexey Voitilov, CTO da BellSoft: </p><br><blockquote>  "A BellSoft lan√ßa o Liberica JDK, que, al√©m do x86 Linux / Windows / Mac e Solaris / SPARC, tamb√©m suporta ARM. A partir do JDK 9 para ARM, focamos em melhorar o desempenho da porta AARCH64 para aplicativos de servidor e continuamos a suportar a porta ARM de 32 bits para Portanto, na √©poca do lan√ßamento do JDK 11, havia uma situa√ß√£o em que ningu√©m suportava a parte da porta de 64 bits da Oracle (incluindo a Oracle), e a comunidade OpenJDK decidiu remov√™-la para se concentrar na porta AARCH64. No momento, √© mais produtivo ( ver, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PEC 315</a> , que  integrado ao JDK 11) e, a partir do JDK 12, suporta todos os recursos presentes na porta do Oracle (o √∫ltimo VM m√≠nimo que integrei em setembro). Portanto, fiquei feliz em ajudar Bob Vandette a remover esse rudimento no JDK 12. Como resultado, o OpenJDK a comunidade recebeu uma porta no AARCH64 e uma porta ARM32, o que certamente facilita o suporte ". </blockquote><br><hr><br><p>  <strong>341: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquivos CDS padr√£o</a></strong> </p><br><p>  <strong>Recurso interno</strong> .  O problema √© que, no in√≠cio de um aplicativo Java, milhares de classes s√£o carregadas, o que cria a sensa√ß√£o de que o Java diminui significativamente na inicializa√ß√£o.  Mas quem est√° l√° para mentir, isso n√£o √© apenas uma "sensa√ß√£o" - √© assim.  Para resolver o problema desde os tempos antigos, v√°rios rituais s√£o praticados. </p><br><p>  O Compartilhamento de dados de classe √© um recurso que surgiu h√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√©culos</a> , como um recurso comercial do JDK 8, atualiza√ß√£o 40. Ele permite que voc√™ empacote todo esse lixo de inicializa√ß√£o em um arquivo de algum formato pr√≥prio (voc√™ n√£o precisa saber qual), ap√≥s o qual a velocidade de inicializa√ß√£o aplica√ß√µes est√° aumentando.  Depois de um tempo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JEP 310</a> apareceu: Application Class-Data Sharing, o que nos permitiu trabalhar da mesma maneira n√£o apenas com as classes do sistema, mas tamb√©m com as classes de aplicativos. </p><br><p>  Para as classes JDK, √© assim.  Primeiro, despejamos as classes com o comando <code>java -Xshare:dump</code> e, em seguida, executamos o aplicativo, solicitando que ele use esse cache: <code>java -Xshare:on -jar app.jar</code> .  Tudo, a startup melhorou um pouco.  Voc√™ sabia sobre esse recurso?  Muitos que ainda n√£o sabem! </p><br><p>  Parece estranho aqui: por que cada vez que escrever ritualmente <code>-Xshare:dump</code> se o resultado padr√£o deste comando √© um pouco previs√≠vel, mesmo no est√°gio de cria√ß√£o da distribui√ß√£o JDK?  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> , se a distribui√ß√£o Java 8 foi instalada usando o instalador, no momento da instala√ß√£o, ela deve executar os comandos necess√°rios para voc√™.  Como, o instalador est√° minando silenciosamente no canto.  Mas porque?  E o que fazer com a distribui√ß√£o, que √© distribu√≠da n√£o como instalador, mas como um arquivo zip? </p><br><p>  √â simples: a partir do JDK 12, o arquivo CDS ser√° gerado pelos criadores do kit de distribui√ß√£o, imediatamente ap√≥s a vincula√ß√£o.  Mesmo para compila√ß√µes noturnas (desde que sejam de 64 bits e nativas, n√£o para compila√ß√£o cruzada). </p><br><p>  Os usu√°rios nem precisam saber sobre a presen√ßa desse recurso, porque, come√ßando com o JDK 11, <code>-Xshare:auto</code> ativado por padr√£o, e esse arquivo √© recuperado automaticamente.  Assim, o simples <strong>fato de atualizar para o JDK 12 acelera o lan√ßamento do aplicativo!</strong> </p><hr><br><p>  <strong>344: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cole√ß√µes Mistas Abort√°veis ‚Äã‚Äãpara G1</a></strong> </p><br><p>  <strong>Recurso interno</strong> .  Para ser honesto <del>  Eu n√£o entendo nada no trabalho do G1 </del>  Uma explica√ß√£o dos recursos do GC √© uma tarefa ingrata.  Requer uma compreens√£o dos detalhes de seu trabalho, tanto do explicador quanto do entendimento.  Para a maioria das pessoas, o GC √© uma esp√©cie de inferno fora de uma caixa de rap√© que voc√™ pode trapacear em caso de algo.  Portanto, o problema deve ser explicado de alguma forma mais simples. </p><br><p>  <strong>Problema</strong> : G1 pode funcionar melhor. </p><br><p>  Bem, o problema √© que o GC √© um compromisso de muitos par√¢metros, um dos quais √© a dura√ß√£o da pausa.  √Äs vezes, a pausa √© muito longa e √© bom poder cancel√°-la. </p><br><p>  Quando isso acontece?  O G1 realmente analisa o comportamento do aplicativo e seleciona a frente do trabalho (expressa como um <em>conjunto de coleta</em> ) com base em suas conclus√µes.  Quando o escopo do trabalho √© aprovado, G1 se compromete a coletar todos os objetos vivos no conjunto de coleta, teimosamente e sem parar, de uma s√≥ vez.  √Äs vezes, leva muito tempo.  Em ess√™ncia, isso significa que G1 calculou incorretamente a quantidade de trabalho.  Voc√™ pode engan√°-lo, alterando repentinamente o comportamento do seu aplicativo para que a heur√≠stica funcione com dados incorretos quando muitas regi√µes antigas entrarem no conjunto de coleta. </p><br><p>  Para sair da situa√ß√£o, o G1 foi finalizado pelo seguinte mecanismo: se a heur√≠stica seleciona regularmente a quantidade errada de trabalho, o G1 muda para a coleta incremental de lixo, passo a passo, e cada pr√≥ximo passo (se n√£o se encaixar no tempo de execu√ß√£o do destino) pode ser cancelado.  N√£o faz sentido coletar algo de forma incremental (regi√µes jovens), portanto, todo esse trabalho √© destacado no bloco ‚Äúobrigat√≥rio‚Äù, que ainda √© realizado continuamente. </p><br><p>  O que fazer com o usu√°rio final?  Nada, voc√™ precisa atualizar para o JDK 12, tudo ficar√° melhor por si s√≥. </p><hr><br><p>  <strong>346: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Retorno imediato da mem√≥ria confirmada n√£o utilizada do G1</a></strong> </p><br><p>  <strong>Recurso interno</strong> .  O problema √© que, se temos um grande quadril que ningu√©m usa ativamente, parece justo recuperar toda essa mem√≥ria inativa de volta ao sistema operacional.  Antes do JDK 12, no entanto, isso n√£o acontecia. </p><br><p>  Para atingir seu objetivo em termos do comprimento de pausa permitido, o G1 executa um conjunto de ciclos incrementais, paralelos e de v√°rios est√°gios.  No JDK 11, ele fornece mem√≥ria confirmada ao sistema operacional apenas com GC completo ou durante a fase de marca√ß√£o paralela.  Se voc√™ conectar o log (-Xloggc: /home/gc.log -XX: + PrintGCDetails -XX: + PrintGCDateStamps), essa fase ser√° exibida da seguinte forma: </p><br><pre> <code class="plaintext hljs">8801.974: [G1Ergonomics (Concurrent Cycles) request concurrent cycle initiation, reason: occupancy higher than threshold, occupancy: 12582912000 bytes, allocation request: 0 bytes, threshold: 12562779330 bytes (45.00 %), source: end of GC] 8804.670: [G1Ergonomics (Concurrent Cycles) initiate concurrent cycle, reason: concurrent cycle initiation requested] 8805.612: [GC concurrent-mark-start] 8820.483: [GC concurrent-mark-end, 14.8711620 secs]</code> </pre> <br><p>  O engra√ßado √© que o G1, como pode, luta com paradas completas, e o ciclo simult√¢neo come√ßa apenas com aloca√ß√µes frequentes e um monte entupido.  Nossa situa√ß√£o, quando ningu√©m toca no quadril, √© exatamente o oposto.  Situa√ß√µes em que o G1 arranha para dar mem√≥ria ao sistema operacional acontecem muito raramente! </p><br><p>  Portanto, todos teriam pontuado esse problema ("compre ainda mais mem√≥ria RAM, que √© como um trapaceiro!"). Se n√£o um, mas - existem todos os tipos de nuvens e cont√™ineres nos quais isso significa utiliza√ß√£o insuficiente e perda de dinheiro s√©rio.  Olha, que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio legal</a> , cheio de dor. </p><br><p>  A solu√ß√£o foi ensinar G1 a se comportar bem nesse caso espec√≠fico, como Shenanda ou GenCon do OpenJ9 j√° sabem.  √â necess√°rio determinar a utiliza√ß√£o insuficiente do quadril e, consequentemente, reduzir seu uso.  Em alguns testes no Tomcat, isso permitiu reduzir o consumo de mem√≥ria em quase metade. </p><br><p>  A conclus√£o √© que o aplicativo √© considerado inativo ou se o intervalo (em milissegundos) <code>getloadavg()</code> da √∫ltima compila√ß√£o e n√£o h√° ciclo simult√¢neo ou se <code>getloadavg()</code> por um per√≠odo de um minuto mostrou uma carga abaixo de um determinado limite.  Assim que isso acontece, a coleta peri√≥dica de lixo √© iniciada - ela certamente n√£o limpa, nem a montagem completa, mas afeta o aplicativo minimamente. </p><br><p>  Voc√™ pode envi√°-lo para este log: </p><br><pre> <code class="plaintext hljs">(1) [6.084s][debug][gc,periodic ] Checking for periodic GC. [6.086s][info ][gc ] GC(13) Pause Young (Concurrent Start) (G1 Periodic Collection) 37M-&gt;36M(78M) 1.786ms (2) [9.087s][debug][gc,periodic ] Checking for periodic GC. [9.088s][info ][gc ] GC(15) Pause Young (Prepare Mixed) (G1 Periodic Collection) 9M-&gt;9M(32M) 0.722ms (3) [12.089s][debug][gc,periodic ] Checking for periodic GC. [12.091s][info ][gc ] GC(16) Pause Young (Mixed) (G1 Periodic Collection) 9M-&gt;5M(32M) 1.776ms (4) [15.092s][debug][gc,periodic ] Checking for periodic GC. [15.097s][info ][gc ] GC(17) Pause Young (Mixed) (G1 Periodic Collection) 5M-&gt;1M(32M) 4.142ms (5) [18.098s][debug][gc,periodic ] Checking for periodic GC. [18.100s][info ][gc ] GC(18) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 1.685ms (6) [21.101s][debug][gc,periodic ] Checking for periodic GC. [21.102s][info ][gc ] GC(20) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 0.868ms (7) [24.104s][debug][gc,periodic ] Checking for periodic GC. [24.104s][info ][gc ] GC(22) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 0.778ms</code> </pre> <br><p>  Descobriu?  Eu n√£o  No JEP, h√° uma tradu√ß√£o detalhada em linguagem de sinais de cada linha do log, e como o algoritmo funciona, e tudo mais. </p><br><p>  "Ent√£o o que, por que eu descobri?"  - voc√™ pergunta.  Agora, temos dois identificadores adicionais: <code>G1PeriodicGCInterval</code> e <code>G1PeriodicGCSystemLoadThreshold</code> , que podem ser distorcidos quando ficam ruins.  √â certo que um dia ser√° ruim, √© Java, baby! </p><hr><br><h1 id="itogi">  Sum√°rio </h1><br><p>  Como resultado, temos um forte lan√ßamento em nossas m√£os - n√£o uma revolu√ß√£o, mas uma evolu√ß√£o focada em melhorar o desempenho.  Exatamente metade das melhorias est√£o relacionadas ao desempenho: tr√™s JEPs sobre GC e um sobre CDS, que prometem ativar sozinhos, precisam apenas atualizar para o JDK 12. Al√©m disso, temos um recurso de idioma (switch expression), duas novas ferramentas para desenvolvedores de JDK ( Testes de API de constantes e JMH), e agora a comunidade pode se concentrar melhor em uma √∫nica porta de 64 bits no ARM. </p><br><p>  Em geral, atualize para o JDK 12 agora e a For√ßa esteja com voc√™.  Voc√™ precisar√° disso. </p><br><blockquote>  Minuto de publicidade.  Muito em breve, de 5 a 6 de abril, ser√° realizada a confer√™ncia JPoint, que reunir√° um grande n√∫mero de pessoas que sabem muito sobre o JDK e todos os tipos de novos recursos.  Por exemplo, certamente haver√° Simon Ritter, da Azul, com uma palestra sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"JDK 12: Armadilhas para os incautos"</a> .  O lugar mais apropriado para discutir a vers√£o mais recente!  Voc√™ pode aprender mais sobre o JPoint no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444434/">https://habr.com/ru/post/pt444434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444424/index.html">AMD Radeon VII: chip de √∫ltima gera√ß√£o (parte 2)</a></li>
<li><a href="../pt444426/index.html">Lyft e Uber fazem abertura de capital p√∫blica. Por que investir na Lyft?</a></li>
<li><a href="../pt444428/index.html">Carro de montanha: resolvendo o desafio cl√°ssico com treinamento de refor√ßo</a></li>
<li><a href="../pt444430/index.html">An√°lise: como realmente usar o Present Perfect em ingl√™s</a></li>
<li><a href="../pt444432/index.html">Aplica√ß√£o de Linux e software de c√≥digo aberto em nossa institui√ß√£o educacional: ser ou n√£o ser?</a></li>
<li><a href="../pt444436/index.html">O que √© um botnet Mirai e como posso proteger meus dispositivos?</a></li>
<li><a href="../pt444438/index.html">Uma breve hist√≥ria do c√≥digo aberto - como o software livre lutou com propriet√°rios</a></li>
<li><a href="../pt444442/index.html">Jetson Nano: Placa √∫nica da Nvidia Machine Learning</a></li>
<li><a href="../pt444444/index.html">As melhores falhas de nossas confer√™ncias (Joker, JPoint, DotNext, Mobius, TechTrain e assim por diante)</a></li>
<li><a href="../pt444446/index.html">Criando um aplicativo Web moderno do zero</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>