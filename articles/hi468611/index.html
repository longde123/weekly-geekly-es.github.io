<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯШЦ ЁЯСЫ ЁЯеФ .NET рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ: рдЬрдм рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдХрдореА рд╣реЛрддреА рд╣реИ тЬМЁЯП┐ ЁЯСйЁЯП╝тАНЁЯдЭтАНЁЯСиЁЯП╜ тЬМЁЯП╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".NET рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХрдИ рдкреНрд░реА-рдмрд┐рд▓реНрдЯ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рд╛рдЗрдореЗрдЯрд┐рд╡ рдФрд░ рдереНрд░реЗрдб-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЧреНрд░рд╣ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>.NET рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ: рдЬрдм рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдХрдореА рд╣реЛрддреА рд╣реИ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/468611/"><img src="https://habrastorage.org/webt/rn/su/tj/rnsutjjvg7sllluahknu8brlnbc.jpeg"><br><br>  .NET рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХрдИ рдкреНрд░реА-рдмрд┐рд▓реНрдЯ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рд╛рдЗрдореЗрдЯрд┐рд╡ рдФрд░ рдереНрд░реЗрдб-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЧреНрд░рд╣ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп рдПрдХ рдереНрд░реЗрдб-рд╕реБрд░рдХреНрд╖рд┐рдд рдХреИрд╢ рдпрд╛ рдПрдХ рдЕрдиреБрд░реЛрдз рдХрддрд╛рд░, рдпреЗ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╕рдорд╛рдзрд╛рди рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдХрднреА-рдХрднреА рдХрдИ рдмрд╛рд░ред  рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдпрд╣ рдкреНрд░рджрд░реНрд╢рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ: рддрд╛рд▓реЗ рдкрд░ рд▓рдВрдмрд╛ рдЗрдВрддрдЬрд╛рд░, рд╕реНрдореГрддрд┐ рдХреА рдЕрддреНрдпрдзрд┐рдХ рдЦрдкрдд рдФрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдХрдЪрд░рд╛ рд╕рдВрдЧреНрд░рд╣ред <br><br>  рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ рд╣рдо рдЗрд╕ рдмрд╛рдд рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВ рдХрд┐ рдорд╛рдирдХ рд╕рдорд╛рдзрд╛рди рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ - рд╡реЗ рд╣рдорд╛рд░реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдПрдХ рдЙрдкрд░рд┐ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдмреЗрдорд╛рдиреА рд╣реИрдВред  рддрджрдиреБрд╕рд╛рд░, рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдкреНрд░рднрд╛рд╡реА рдереНрд░реЗрдб-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЧреНрд░рд╣ред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Cutscene</a> рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рддрд╣рдд DotNext</a> рдХреЙрдиреНрдлреНрд░реЗрдВрд╕ рд╕реЗ рдореЗрд░реА рд░рд┐рдкреЛрд░реНрдЯ рдХрд╛ рдПрдХ рд╡реАрдбрд┐рдпреЛ рдФрд░ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рд╣реИ, рдЬрд╣рд╛рдВ рдореИрдВ рдорд╛рдирдХ .NET рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдХреБрдЫ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реВрдВ (Task.Delay, SemaphoreSlim, ConcurrentDictionary) рдиреЗ рдкреНрд░рджрд░реНрд╢рди рдбреНрд░реЙрдк рдХрд╛ рдиреЗрддреГрддреНрд╡ рдХрд┐рдпрд╛, рдФрд░ рдореИрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рд░рдЦрддрд╛ рд╣реВрдВ рдФрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рд░рд╣рд┐рдд рд╣реВрдВред рдЗрди рдХрдорд┐рдпреЛрдВред <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-tNeYjRNJtY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  рд░рд┐рдкреЛрд░реНрдЯ рдХреЗ рд╕рдордп, рдЙрдиреНрд╣реЛрдВрдиреЗ рдХреЛрдВрддреВрд░ рдореЗрдВ рдХрд╛рдо рдХрд┐рдпрд╛ред  рдХреЛрдВрдЯреВрд░ рд╡реНрдпрд╡рд╕рд╛рдп рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдореИрдВрдиреЗ рдЬрд┐рд╕ рдЯреАрдо рдореЗрдВ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд╕рдорд░реНрдерди рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдиреНрдп рдЯреАрдореЛрдВ рдореЗрдВ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдЙрддреНрдкрд╛рдж рд╕реЗрд╡рд╛рдПрдВ рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдЯреАрдо рдиреЗ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕, рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдкреНрд▓реАрдХреЗрд╢рди рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ред  рд╣рдорд╛рд░реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдПрдХ рдорд╛рдЗрдХреНрд░реЛрд╕реЗрд╕реНрдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВ - рд╕рднреА рд╕реЗрд╡рд╛рдПрдВ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рддреА рд╣реИрдВ, рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╡реЗ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдФрд░ рдмрд╣реБ-рдереНрд░реЗрдбреЗрдб рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╕реЗ рдХреБрдЫ рдХрд╛рдлреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рджрд░реНрд╢рди рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдЖрдЬ рд╣рдо рдХрд┐рд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ? <br><br><ul><li>  .NET рдореЗрдВ Multithreading рдФрд░ Asynchrony; </li><li>  рд╕реНрдЯреИрдХрд┐рдВрдЧ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рд╛рдЗрдореЗрдЯреАрдЬрд╝ рдФрд░ рд╕рдВрдЧреНрд░рд╣; </li><li>  рдпрджрд┐ рдорд╛рдирдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд▓реЛрдб рдХреЗ рд╕рд╛рде рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рдХрд░реЗрдВ? </li></ul><br>  рдЖрдЗрдП .NET рдореЗрдВ рдорд▓реНрдЯреАрдереНрд░реЗрдб рдФрд░ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВред  рдЖрдЗрдП рдХреБрдЫ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рд╛рдЗрдореЗрдЯреАрдЬрд╝ рдФрд░ рд╕рдорд╡рд░реНрддреА рд╕рдВрдЧреНрд░рд╣ рдХреЛ рджреЗрдЦреЗрдВ, рджреЗрдЦреЗрдВ рдХрд┐ рд╡реЗ рдЕрдВрджрд░ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рд╣рдо рдЗрд╕ рдмрд╛рдд рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдпрджрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдХрдХреНрд╖рд╛рдПрдВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рддреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рдЕрдЧрд░ рдорд╛рдирдХ рдХрдХреНрд╖рд╛рдПрдВ рднрд╛рд░ рдХрд╛ рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рд╣реИрдВ, рдФрд░ рдХреНрдпрд╛ рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХреБрдЫ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдореИрдВ рдЖрдкрдХреЛ рдЪрд╛рд░ рдХрд╣рд╛рдирд┐рдпрд╛рдВ рдмрддрд╛рдКрдВрдЧрд╛ рдЬреЛ рд╣рдорд╛рд░реЗ рдЙрддреНрдкрд╛рджрди рд╕реНрдерд▓ рдкрд░ рд╣реБрдИ рдереАрдВред <br><br><h2>  рдЗрддрд┐рд╣рд╛рд╕ 1: рдЯрд╛рд╕реНрдХ.рдбреЗрд▓реЗ рдФрд░ рдЯрд┐рдорд░рдХреНрдпреВ </h2><br>  рдпрд╣ рдХрд╣рд╛рдиреА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрд╛рдлреА рдкреНрд░рд╕рд┐рджреНрдз рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрд┐рдЫрд▓реЗ DotNext рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд╕реАрдХреНрд╡реЗрд▓ рдорд┐рд▓рд╛, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрд╕реЗ рдЬреЛрдбрд╝рд╛ред  рддреЛ рдХреНрдпрд╛ рдмрд╛рдд рд╣реИ? <br><br><h3>  1.1 рдорддрджрд╛рди рдФрд░ рд▓рдВрдмрд╛ рдорддрджрд╛рди </h3><br>  рд╕рд░реНрд╡рд░ рд▓рдВрдмреЗ рдСрдкрд░реЗрд╢рди рдХрд░рддрд╛ рд╣реИ, рдХреНрд▓рд╛рдЗрдВрдЯ рдЙрдирдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИред <br>  <b>рдкреЛрд▓рд┐рдВрдЧ:</b> рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рдордп-рд╕рдордп рдкрд░ рд╕рд░реНрд╡рд░ рд╕реЗ рд░рд┐рдЬрд▓реНрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫрддрд╛ рд╣реИред <br>  <b>рд▓рдВрдмрд╛ рдорддрджрд╛рди:</b> рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдХ рд▓рдВрдмреЗ рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ, рдФрд░ рдСрдкрд░реЗрд╢рди рдкреВрд░рд╛ рд╣реЛрдиреЗ рдкрд░ рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИред <br><br>  рдлрд╛рдпрджреЗ: <br><br><ul><li>  рдХрдо рдпрд╛рддрд╛рдпрд╛рдд </li><li>  рдХреНрд▓рд╛рдЗрдВрдЯ рддреЗрдЬреА рд╕реЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрддрд╛ рд╣реИ </li></ul><br>  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╕рд░реНрд╡рд░ рд╣реИ рдЬреЛ рдХреБрдЫ рд▓рдВрдмреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛ рдПрдХреНрд╕рдПрдордПрд▓ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдРрд╕реЗ рдЧреНрд░рд╛рд╣рдХ рд╣реИрдВ рдЬреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдФрд░ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдЕрдкрдиреЗ рдкрд░рд┐рдгрд╛рдо рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдРрд╕реА рдЙрдореНрдореАрдж рдХреИрд╕реЗ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ? <br><br>  рдкрд╣рд▓рд╛ рддрд░реАрдХрд╛ <b>рдорддрджрд╛рди рд╣реИ</b> ред  рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд░реНрд╡рд░ рдкрд░ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рд╕рдордп-рд╕рдордп рдкрд░ рдЗрд╕ рдХрд╛рд░реНрдп рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рд╕рд░реНрд╡рд░ рдХрд╛рд░реНрдп рдХреА рд╕реНрдерд┐рддрд┐ ("рдкреВрд░рд╛ рд╣реБрдЖ" / "рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реБрдЖ" / "рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдкреВрд░рд╛ рд╣реБрдЖ") рд╡рд╛рдкрд╕ рдХрд░ рджреЗрддрд╛ рд╣реИред  рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рдордп-рд╕рдордп рдкрд░ рд░рд┐рдЬрд▓реНрдЯ рдЖрдиреЗ рддрдХ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рднреЗрдЬрддрд╛ рд╣реИред <br><br>  рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛ <b>рд▓рдВрдмрд╛ рдорддрджрд╛рди рд╣реИ</b> ред  рдпрд╣рд╛рдВ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рд▓рдВрдмреЗ рд╕рдордп рдХреЗ рд╕рд╛рде рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИред  рд╕рд░реНрд╡рд░, рдЗрд╕ рддрд░рд╣ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реБрдП, рддреБрд░рдВрдд рд░рд┐рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдХрд┐ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реБрдЖ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдордп рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред <br>  рддреЛ рдирд┐рдпрдорд┐рдд рдорддрджрд╛рди рдкрд░ рд▓рдВрдмреЗ рдорддрджрд╛рди рдХрд╛ рдХреНрдпрд╛ рдлрд╛рдпрджрд╛ рд╣реИ?  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХрдо рдпрд╛рддрд╛рдпрд╛рдд рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред  рд╣рдо рдХрдо рдиреЗрдЯрд╡рд░реНрдХ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ - рдкреВрд░реЗ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХрдо рдЯреНрд░реИрдлрд╝рд┐рдХ рдХрд╛ рдкреАрдЫрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред  рд╕рд╛рде рд╣реА, рдЧреНрд░рд╛рд╣рдХ рдирд┐рдпрдорд┐рдд рдорддрджрд╛рди рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬреА рд╕реЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрддрд╛ рд▓рдЧрд╛ рдкрд╛рдПрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХрдИ рдорддрджрд╛рди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░рд╛рд▓ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рд╣рдо рдЬреЛ рдкрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рд╡рд╣ рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рд╣реИред  рд╣рдо рдЗрд╕реЗ рдХреЛрдб рдореЗрдВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗ? <br><blockquote>  рдЯрд╛рд╕реНрдХ: рдЯрд╛рдЗрдордЖрдЙрдЯ <br>  рд╣рдо рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рд╕рд╛рде рдЯрд╛рд╕реНрдХ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ <br>  Senditync рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ (); </blockquote>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЯрд╛рд╕реНрдХ рд╣реИ рдЬреЛ рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ, рдФрд░ рд╣рдо рдПрдХ рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рд╕рд╛рде рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рдд, рд╣рдо рдпрд╛ рддреЛ рдЗрд╕ рдЯрд╛рд╕реНрдХ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╡рд╛рдкрд╕ рдХрд░реЗрдВрдЧреЗ рдпрд╛ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рддреНрд░реБрдЯрд┐ рднреЗрдЬреЗрдВрдЧреЗред  рд╕реА # рдХреЛрдб рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sendTask = SendAsync(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delayTask = Task.Delay(timeout); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.WhenAny(sendTask, delayTask); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task == delayTask) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Timeout;</code> </pre> <br>  рдпрд╣ рдХреЛрдб рд╣рдорд╛рд░реЗ рдЯрд╛рд╕реНрдХ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреА рд╣рдо рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдФрд░ рдЯрд╛рд╕реНрдХред  рдЗрд╕рдХреЗ рдмрд╛рдж, Task.WhenAny рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдпрд╛ рддреЛ рд╣рдорд╛рд░реЗ рдЯрд╛рд╕реНрдХ рдпрд╛ рдЯрд╛рд╕реНрдХ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЯрд╛рд╕реНрдХред рдбреЗрд▓ рдХреЛ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ, рд╣рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ рд╡рд╛рдкрд╕ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред <br><br>  рдпрд╣ рдХреЛрдб, рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╣реА рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЯрд╛рд╕реНрдХ рдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрдЦ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЕрдЧрд░ SendAsync рдкрд╣рд▓реЗ рд▓реМрдЯ рдЖрдП, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрднреА рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИред  рд▓рдмреНрдмреЛрд▓реБрдЖрдм рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдо рдРрд╕рд╛ рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдорддрджрд╛рди рдХреЗ рд╕рд╛рде рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдХреБрдЫ рдкреНрд░рджрд░реНрд╢рди рд╕рдорд╕реНрдпрд╛рдПрдВ рдорд┐рд▓реЗрдВрдЧреАред <br><br><h3>  1.2 рд▓рдВрдмреЗ рдорддрджрд╛рди рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдПрдВ </h3><br><ul><li>  рдмрдбрд╝реЗ рдЯрд╛рдЗрдордЖрдЙрдЯ </li><li>  рдХрдИ рд╕рдорд╡рд░реНрддреА рдкреНрд░рд╢реНрди </li><li>  =&gt; рдЙрдЪреНрдЪ CPU рдЙрдкрдпреЛрдЧ </li></ul><br>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рдорд╕реНрдпрд╛ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЙрдЪреНрдЪ рдЦрдкрдд рд╣реИред  рдРрд╕рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ 100% рдкрд░ рднрд░рд╛ рд╣реБрдЖ рд╣реИ, рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЖрдорддреМрд░ рдкрд░ рдХрд╛рдо рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИред  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрднреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ: рд╣рдо рдХреБрдЫ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╕рдВрдЪрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ, рд╕рд░реНрд╡рд░ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдЕрднреА рднреА рд╣рдорд╛рд░реЗ рд╕рд╛рде рднрд░рд╛ рд╣реБрдЖ рд╣реИред <br><br>  рдЬрдм рд╣рдордиреЗ рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛, рддреЛ рд╣рдордиреЗ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдореЗрдореЛрд░реА рдбрдВрдк рд╣рдЯрд╛ рджрд┐рдпрд╛: <br><br><pre> <code class="cs hljs"> ~*e!clrstack System.Threading.Monitor.Enter(System.Object) System.Threading.TimerQueueTimer.Change(тАж) System.Threading.Timer.TimerSetup(тАж) System.Threading.Timer..ctor(тАж) System.Threading.Tasks.Task.Delay(тАж)</code> </pre> <br>  рдбрдВрдк рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ WinDbg рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рд╣рдордиреЗ рдПрдХ рдХрдорд╛рдВрдб рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬреЛ рд╕рднреА рдкреНрд░рдмрдВрдзрд┐рдд рдереНрд░реЗрдбреНрд╕ рдХреЗ рд╕реНрдЯреИрдХ рдХреЗ рдирд┐рд╢рд╛рди рджрд┐рдЦрд╛рддрд╛ рд╣реИ, рдФрд░ рдРрд╕рд╛ рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрд╛ред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдзрд╛рдЧреЗ рд╣реИрдВ рдЬреЛ рдХреБрдЫ рд▓реЙрдХ рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдореЙрдирд┐рдЯрд░.рдЗрдВрдЯрд░ рд╡рд┐рдзрд┐ рд╡рд╣ рд╣реИ рдЬреЛ C # рдореЗрдВ рд▓реЙрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреА рд╣реИред  рдЗрд╕ рд▓реЙрдХ рдХреЛ рдЯрд╛рдЗрдорд░ рдФрд░ рдЯрд┐рдорд░рдХреНрдпреВрдпреВрдЯреАрдорд░ рдирд╛рдордХ рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рдЕрдВрджрд░ рдХреИрдж рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЯрд╛рдЗрдорд░ рдореЗрдВ, рд╣рдо рдЯрд╛рд╕реНрдХ рд╕реЗ рдЖрдП рдереЗред рддрдм рдЬрдм рд╣рдордиреЗ рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреАред  рдпрд╣ рдХреНрдпрд╛ рд╣реИ?  рдЬрдм Task.Delay рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ TimerQueue рдХреЗ рдЕрдВрджрд░ рд▓реЙрдХ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><h3>  1.3 рддрд╛рд▓рд╛ рдХрд╛рдлрд┐рд▓рд╛ </h3><br><ul><li>  рдХрдИ рдзрд╛рдЧреЗ рдПрдХ рддрд╛рд▓рд╛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ </li><li>  рд▓реЙрдХ рдХреЗ рддрд╣рдд, рдереЛрдбрд╝рд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </li><li>  рд╕рдордп рдереНрд░реЗрдб рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдкрд░ рдЦрд░реНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкрд░ рдирд╣реАрдВред </li><li>  рдереНрд░реЗрдбрдмреНрд▓реЙрдХ рдЕрд╡рд░реБрджреНрдз рд╣реИрдВ - рд╡реЗ рдЕрдирдВрдд рдирд╣реАрдВ рд╣реИрдВ </li></ul><br>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЖрд╡реЗрджрди рдореЗрдВ рд▓реЙрдХ рдХрд╛рдлрд┐рд▓рд╛ рдерд╛ред  рдХрдИ рдзрд╛рдЧреЗ рдПрдХ рд╣реА рд▓реЙрдХ рдХреЛ рдкрдХрдбрд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рд▓реЙрдХ рдХреЗ рддрд╣рдд, рдХреЛрдб рдХрд╛ рдПрдХ рдмрд╣реБрдд рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред  рдпрд╣рд╛рдВ рд╕рдВрд╕рд╛рдзрди рд╕рдВрд╕рд╛рдзрди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб рдкрд░ рд╣реА рдЦрд░реНрдЪ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕ рд▓реЙрдХ рдкрд░ рдЖрдкрд╕ рдореЗрдВ рдереНрд░реЗрдб рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдкрд░реЗрд╢рди рдкрд░ред  рдпрд╣ .NET рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рднреА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ: рд▓реЙрдХ рдХрд╛рдлрд┐рд▓реЗ рдореЗрдВ рднрд╛рдЧ рд▓реЗрдиреЗ рд╡рд╛рд▓реЗ рдзрд╛рдЧреЗ рдереНрд░реЗрдб рдкреВрд▓ рд╕реЗ рдереНрд░реЗрдб рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рддрджрдиреБрд╕рд╛рд░, рдпрджрд┐ рдереНрд░реЗрдб рдкреВрд▓ рд╕реЗ рдереНрд░реЗрдбреНрд╕ рдЕрд╡рд░реБрджреНрдз рд╣реИрдВ, рддреЛ рд╡реЗ рд╕рдорд╛рдкреНрдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ - рдереНрд░реЗрдб рдкреВрд▓ рдореЗрдВ рдереНрд░реЗрдбреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реАрдорд┐рдд рд╣реИред  рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рдПрдХ рдКрдкрд░реА рд╕реАрдорд╛ рд╣реИред  рдпрд╣ рдкреВрд░рд╛ рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╕рднреА рдереНрд░реЗрдбрдкреВрд▓ рдереНрд░реЗрдб рд▓реЙрдХ рдХрд╛рдлрд┐рд▓реЗ рдореЗрдВ рднрд╛рдЧ рд▓реЗрдВрдЧреЗ, рдФрд░ рдереНрд░реЗрдбрдкреБрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХреЛрдИ рднреА рдХреЛрдб рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЗрд╕рд╕реЗ рд╕реНрдерд┐рддрд┐ рдмрд╣реБрдд рдЦрд░рд╛рдм рд╣реЛ рдЬрд╛рддреА рд╣реИред <br><br><h3>  рез.рек рдЯрд┐рдорд░рдХреНрдпреВ </h3><br><ul><li>  рдХрд┐рд╕реА .NET рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ рдЯрд╛рдЗрдорд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред </li><li>  рдЯрд╛рдЗрдорд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br>  - рдХрд╛рд░реНрдп <br>  - рд░рджреНрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <br>  - HttpClient </li></ul><br>  TimerQueue рдПрдХ рд╡рд░реНрдЧ рд╣реИ рдЬреЛ .NET рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ рд╕рднреА рдЯрд╛рдЗрдорд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдПрдХ рдмрд╛рд░ WinForms рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдиреЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЯрд╛рдЗрдорд░ рдмрдирд╛рдП рд╣реЛрдВрдЧреЗред  рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЯрд╛рдЗрдорд░ рдХреНрдпрд╛ рд╣реИрдВ: рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЯрд╛рд╕реНрдХ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдбреЗрд▓рдп (рдпрд╣ рд╕рд┐рд░реНрдл рд╣рдорд╛рд░рд╛ рдорд╛рдорд▓рд╛ рд╣реИ), рдЙрдиреНрд╣реЗрдВ рдХреИрдВрд╕рд┐рд▓реЗрд╢рдирдЯреЛрдХрди рдХреЗ рдЕрдВрджрд░ рднреА рд░рджреНрдж рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рдпрд╣реА рд╣реИ, рдЯрд╛рд╕реНрдХрдбреЗрд▓ рдХреЛ рд░рджреНрдж рдХрд░рдирд╛ рд░рджреНрдж рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдЯрд╛рд╕реНрдХрд▓реЗрдиред рдХрд╛рдВрдХреЗрд▓реЗ рдХреЗ рдмрд╛рдж рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рд╣рдорд╛рд░реА рдорджрдж рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрдИ рдЖрдВрддрд░рд┐рдХ .NET рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рдЯрд╛рдЗрдорд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, HttpClient рдореЗрдВред <br><br>  рдЬрд╣рд╛рдБ рддрдХ рдореБрдЭреЗ рдкрддрд╛ рд╣реИ, HttpClient рд╣реИрдВрдбрд▓рд░реНрд╕ рдХреЗ рдХреБрдЫ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдЯрд╛рдЗрдорд░ рд╣реИрдВред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрдЧрд░ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЯрд╛рд╕реНрдХ рд╢реБрд░реВ рди рдХрд░реЗрдВред рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдЖрдк рдЕрднреА рднреА рд╡реИрд╕реЗ рднреА рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдЕрдм рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдЯрд┐рдореЗрд░рдХреНрдпреВ рдХреЛ рдЕрдВрджрд░ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><ul><li>  рд╡реИрд╢реНрд╡рд┐рдХ рд░рд╛рдЬреНрдп (рдкреНрд░рддрд┐-рдЕрдиреБрдЧрд╛рдореА): <br>  - TimerQueueTimer рдХреА рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА <br>  - рддрд╛рд▓рд╛ рд╡рд╕реНрддреБ </li><li>  рдирд┐рдпрдорд┐рдд рдЯрд╛рдЗрдорд░ рдХреЙрд▓рдмреИрдХ </li><li>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рджреНрд╡рд╛рд░рд╛ рдЯрд╛рдЗрдорд░ рдХрд╛ рдЖрджреЗрд╢ рдирд╣реАрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ </li><li>  рдЯрд╛рдЗрдорд░ рдЬреЛрдбрд╝рдирд╛: O (1) + рд▓реЙрдХ </li><li>  рдЯрд╛рдЗрдорд░ рд╣рдЯрд╛рдирд╛: O (1) + рд▓реЙрдХ </li><li>  рдкреНрд░рд╛рд░рдВрдн рдЯрд╛рдЗрдорд░: O (N) + рд▓реЙрдХ </li></ul><br>  TimerQueue рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рд╕реНрдерд┐рддрд┐ рд╣реИ, рдпрд╣ TimerQueueTimer рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреА рджреЛрд╣рд░реА рд░реВрдк рд╕реЗ рдЬреБрдбрд╝реА рд╕реВрдЪреА рд╣реИред  TimerQueueTimer рдореЗрдВ рдЕрдиреНрдп TimerQueueTimer рдХрд╛ рд▓рд┐рдВрдХ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдПрдХ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд╕реВрдЪреА рдореЗрдВ рдкрдбрд╝реЛрд╕реА, рдЗрд╕рдореЗрдВ рдЯрд╛рдЗрдорд░ рдФрд░ рдХреЙрд▓рдмреИрдХ рдХрд╛ рд╕рдордп рднреА рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕реЗ рдЯрд╛рдЗрдорд░ рдлрд╛рдпрд░ рд╣реЛрдиреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрд╣ рджреЛрдЧреБрдиреА рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд╕реВрдЪреА рдХреЛ рд▓реЙрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕ рдкрд░ рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ рд▓реЙрдХ рдХрд╛рдлрд┐рд▓рд╛ рд╣реБрдЖ рдерд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЯрд┐рдорд░рдХреНрдпреВ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд░реВрдЯреАрди рд╣реИ рдЬреЛ рд╣рдорд╛рд░реЗ рдЯрд╛рдЗрдорд░ рд╕реЗ рдмрдВрдзреЗ рдХреЙрд▓рдмреИрдХ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рддрд╛ рд╣реИред <br><br>  рдЯрд╛рдЗрдорд░ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рдХрд╛ рдЖрджреЗрд╢ рдирд╣реАрдВ рд╣реИ, рдкреВрд░реА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдирдП рдЯрд╛рдЗрдорд░ рдЬреЛрдбрд╝рдиреЗ / рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЬрдм рд░реВрдЯреАрди рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рджреЛрд╣рд░реА рд╕реВрдЪреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рддрд╛ рд╣реИ, рдЙрди рдЯрд╛рдЗрдорд░ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреЙрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдпрд╣рд╛рдВ рдСрдкрд░реЗрд╢рди рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдРрд╕реА рд╣реИред  рдЯрд╛рдЗрдорд░ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдкрд░ рдкреНрд░рддрд┐ рдпреВрдирд┐рдЯ рдУ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЯрд╛рдЗрдорд░ рдХреА рд╢реБрд░реБрдЖрдд рдкреНрд░рддрд┐ рдкрдВрдХреНрддрд┐ рдореЗрдВ рд╣реЛрддреА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдЧрд░ рдПрд▓реНрдЧреЛрд░рд┐рдердо рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рд╕рд╛рде рд╕рдм рдХреБрдЫ рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИ, рддреЛ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ: рдпреЗ рд╕рднреА рдСрдкрд░реЗрд╢рди рд▓реЙрдХ рдХреЛ рдкрдХрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рдХреНрдпрд╛ рд╕реНрдерд┐рддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИ?  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЯрд┐рдорд░рдХреНрдпреВ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реА рдЗрдорд╛рд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЬрдм рд░реВрдЯреАрди рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЕрдкрдиреЗ рд▓рдВрдмреЗ рд░реИрдЦрд┐рдХ рдСрдкрд░реЗрд╢рди рдХреЛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИ, рдЙрд╕ рд╕рдордп рдЬреЛ рд▓реЛрдЧ рдЯрд┐рдорд░рдХреНрдпреВ рд╕реЗ рдЯрд╛рдЗрдорд░ рд╢реБрд░реВ рдХрд░рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред  рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рд▓реЙрдХ рдХрд╛рдлрд┐рд▓рд╛ рд╣реЛрддрд╛ рд╣реИред  рдпрд╣ рд╕рдорд╕реНрдпрд╛ .NET рдХреЛрд░ рдореЗрдВ рдареАрдХ рдХреА рдЧрдИ рд╣реИред <br><blockquote>  рдЯрд╛рдЗрдорд░ рд▓реЙрдХ рд╡рд┐рд╡рд╛рдж рдХреЛ рдХрдо рдХрд░реЗрдВ (coreclr # 14527) <br><ul><li>  рддрд╛рд▓рд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдХрд╛рдо <br>  - рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯредрдкреНрд░реЛрд╕реЗрд╕рд░ Count TimerQueue's TimerQueueTimer </li><li>  рдЫреЛрдЯреЗ / рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд░рд╣рдиреЗ рд╡рд╛рд▓реЗ рдЯрд╛рдЗрдорд░ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрддрд╛рд░реЗрдВ </li><li>  рд▓рдШреБ рдЯрд╛рдЗрдорд░: рд╕рдордп &lt;= 1/3 рд╕реЗрдХрдВрдб </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/dotnet/coreclr/issues/14462</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/dotnet/coreclr/pull/14527</a> <br></blockquote>  рдпрд╣ рдХреИрд╕реЗ рддрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛?  рдЙрдиреНрд╣реЛрдВрдиреЗ рдЯрд┐рдореЗрд░рдХреНрдпреВ рдкрд░ рдЫрд╛рдкрд╛ рдорд╛рд░рд╛: рдПрдХ рдЯрд┐рдорд░рдХреНрдпреВ рдХреЗ рдмрдЬрд╛рдп, рдЬреЛ рдкреВрд░реЗ рдПрдкрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рд╕реНрдерд┐рд░ рдерд╛, рдкреВрд░реЗ рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП, рдХрдИ рдЯрд┐рдорд░рдХреНрдпреВ рдХреЛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЬрдм рдереНрд░реЗрдбреНрд╕ рд╡рд╣рд╛рдВ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреА рдЯрд╛рдЗрдорд░ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпреЗ рдЯрд╛рдЗрдорд░ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЯрд╛рдЗрдорд░ рдореЗрдВ рдЧрд┐рд░ рдЬрд╛рдПрдВрдЧреЗ, рдФрд░ рдереНрд░реЗрдбреНрд╕ рдХреЗ рдПрдХ рд▓реЙрдХ рдкрд░ рдЯрдХрд░рд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реЛрдЧреАред <br><br>  .NET рдХреЛрд░ рдореЗрдВ рднреА рдХреБрдЫ рдЕрдиреБрдХреВрд▓рди рд▓рд╛рдЧреВ рдХрд┐рдП рдЧрдПред  рдЯрд╛рдЗрдорд░ рдХреЛ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЬреАрд╡рд┐рдд рдФрд░ рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЙрдирдХреЗ рд▓рд┐рдП рдЕрдм рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЯрд┐рдорд░рдХреНрдпреВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдЯрд╛рдЗрдорд░ рдХреЛ рд╕реЗрдХрдВрдб рдХреЗ 1/3 рд╕реЗ рдХрдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдРрд╕рд╛ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреНрдпреЛрдВ рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛ред  .NET рдХреЛрд░ рдореЗрдВ, рд╣рдо рдЯрд╛рдЗрдорд░ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдкрдХрдбрд╝рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд░рд╣реЗред <br><br><img src="https://habrastorage.org/webt/f_/am/cv/f_amcv6bohiq54ciyuunvtrr0ei.jpeg"><br><br>  <a href="">https://github.com/Microsoft/dotnet-framework-early-access/blob/master/release-notes/NET48/dotnet-48-changes.md</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/dotnet/coreclr/labels/netfx-port-consider</a> <br><br>  рдпрд╣ рдлрд┐рдХреНрд╕ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ, рд╕рдВрд╕реНрдХрд░рдг 4.8 рдореЗрдВ рдмреИрдХрдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  Netfx-port-рдЧреМрд░ рдЯреИрдЧ рдКрдкрд░ рджрд┐рдП рдЧрдП рд▓рд┐рдВрдХ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрджрд┐ рдЖрдк .NET рдХреЛрд░, CoreCLR, CoreFX рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕ рдореБрджреНрджреЗ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЬреЛ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ рдореЗрдВ рдмреИрдХрдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЕрдм рдЙрдирдореЗрдВ рд╕реЗ рд▓рдЧрднрдЧ рдкрдЪрд╛рд╕ рд╣реИрдВред  рдпрд╣реА рд╣реИ, рдЦреБрд▓реЗ рд╕реНрд░реЛрдд .NET рдиреЗ рдмрд╣реБрдд рдорджрдж рдХреА, рдХрд╛рдлреА рдХреБрдЫ рдХреАрдбрд╝реЗ рддрдп рдХрд┐рдП рдЧрдП рдереЗред  рдЖрдк рдЪреЗрдВрдЬрд▓реЙрдЧ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ 4.8 рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ: рдмрд╣реБрдд рд╕рд╛рд░реЗ рдмрдЧ рдлрд┐рдХреНрд╕ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЕрдиреНрдп .NET рд░рд┐рд▓реАрдЬ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИред  рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдлреНрд░реЗрдорд╡рд░реНрдХ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ 4.8 рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдмрдВрдж рд╣реИред  рдпрд╣ рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк App.config рдХрд╣рддреЗ рд╣реИрдВ <br><br>  рдЗрд╕ рдлрд┐рдХреНрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ App.config рдореЗрдВ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ UseNetCoreTimer рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  .NET рдлреНрд░реЗрдорд╡рд░реНрдХ 4.8 рдЖрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдФрд░ рд▓реЙрдХ рдХрд╛рдлрд┐рд▓реЗ рдореЗрдВ рди рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ Task.Delay рдХреЗ рдЕрдкрдиреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдерд╛ред  рдЗрд╕рдореЗрдВ, рд╣рдордиреЗ рдмрд╛рдЗрдирд░реА рд╣реАрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рддрд╛рдХрд┐ рдЕрдзрд┐рдХ рдХреБрд╢рд▓рддрд╛ рд╕реЗ рд╕рдордЭ рд╕рдХреЗрдВ рдХрд┐ рдХрд┐рд╕ рд╕рдордп рдЯрд╛рдЗрдорд░ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><h3>  1.5 рдЯрд╛рд╕реНрдХред рдбреЗрд▓рдп: рджреЗрд╢реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h3><br><ul><li>  BinaryHeap </li><li>  Sharding </li><li>  рдЗрд╕рдиреЗ рдорджрдж рдХреА, рд▓реЗрдХрд┐рди рд╕рднреА рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдирд╣реАрдВ </li></ul><br>  рдПрдХ рдмрд╛рдЗрдирд░реА рд╣реАрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЖрдкрдХреЛ рд░реВрдЯреАрди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ, рдЬреЛ рдХреЙрд▓рдмреИрдХ рдХрд╣рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдХрддрд╛рд░ рд╕реЗ рдПрдХ рдордирдорд╛рдирд╛ рдЯрд╛рдЗрдорд░ рдХреЛ рд╣рдЯрд╛рдиреЗ рдореЗрдВ рд▓рдЧрдиреЗ рд╡рд╛рд▓рд╛ рд╕рдордп рдмрд┐рдЧрдбрд╝ рдЬрд╛рддрд╛ рд╣реИ - рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╣реАрдк рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ .NET рдбрдмрд▓ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ рдХрд░рддрд╛ рд╣реИред  рдмреЗрд╢рдХ, рдмрд╕ рдПрдХ рдмрд╛рдЗрдирд░реА рд╣реАрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рд╣рдореЗрдВ рдпрд╣рд╛рдВ рдорджрдж рдирд╣реАрдВ рдорд┐рд▓реЗрдЧреА, рд╣рдореЗрдВ рдЯрд┐рдорд░рдХреНрдпреВ рднреА рдХрд╛рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдиреЗ рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕рднреА рд╕рдорд╛рди, рд╕рдм рдХреБрдЫ рдлрд┐рд░ рд╕реЗ рддрд╛рд▓рд╛ рдХрд╛рдлрд┐рд▓реЗ рдореЗрдВ рдЧрд┐рд░ рдЧрдпрд╛ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдЯрд╛рдЗрдорд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХреЗрд╡рд▓ рдЬрд╣рд╛рдВ рд╡реЗ рдХреЛрдб рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдФрд░ .NET рдХреЛрдб рдореЗрдВ рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ рд╕рдВрд╕реНрдХрд░рдг 4.8 рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ .NET рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕реЗ рдлрд┐рдХреНрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br><h3>  рез.рем рдЯрд╛рд╕реНрдХрдбреЗрд▓ред рдирд┐рд╖реНрдХрд░реНрд╖: рдирд┐рд╖реНрдХрд░реНрд╖ </h3><br><ul><li>  рд╣рд░ рдЬрдЧрд╣ рдиреБрдХрд╕рд╛рди - рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╕рдмрд╕реЗ рдЬреНрдпрд╛рджрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЪреАрдЬреЛрдВ рдореЗрдВ рднреА </li><li>  рддрдирд╛рд╡ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ </li><li>  рдХреЛрд░ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВ, рдкрд╣рд▓реЗ рдмрдЧ рдХреЛ рдареАрдХ рдХрд░реЗрдВ (рдФрд░ рдирдП рдмрдЧ) :) </li></ul><br>  рдЗрд╕ рдкреВрд░реА рдХрд╣рд╛рдиреА рд╕реЗ рдХреНрдпрд╛ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд▓рддрд╛ рд╣реИ?  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдиреБрдХрд╕рд╛рди рд╣рд░ рдЬрдЧрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЙрди рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рднреА рдЬреЛ рдЖрдк рдмрд┐рдирд╛ рд╕реЛрдЪреЗ-рд╕рдордЭреЗ рд╣рд░ рджрд┐рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╣реА рдХрд╛рд░реНрдп, рдЯрд╛рд╕реНрдХред <br><br>  рдореИрдВ рдЖрдкрдХреЗ рдкреНрд░рд╕реНрддрд╛рд╡реЛрдВ рдХрд╛ рддрдирд╛рд╡ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВред  рдпрд╣ рд╕рдорд╕реНрдпрд╛ рд╣рдордиреЗ рд╕рд┐рд░реНрдл рд▓реЛрдб рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рдЪрд░рдг рдореЗрдВ рдкрд╣рдЪрд╛рдиреАред  рдлрд┐рд░ рд╣рдордиреЗ рдЗрд╕реЗ рдЕрдиреНрдп рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрддреНрдкрд╛рджрди рдкрд░ рдХрдИ рдмрд╛рд░ рд╢реВрдЯ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА, рддрдирд╛рд╡ рдкрд░реАрдХреНрд╖рдг рдиреЗ рд╣рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рдордп рдореЗрдВ рджреЗрд░реА рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХреАред <br><br>  .NET рдХреЛрд░ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВ - рдЖрдк рдмрдЧ рдлрд┐рдХреНрд╕ (рдФрд░ рдирдП рдмрдЧ) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрд╣рд▓реЗ рд╡реНрдпрдХреНрддрд┐ рд╣реЛрдВрдЧреЗред  рдирдП рдмрдЧ рдХреЗ рдмрд┐рдирд╛ рдХрд╣рд╛рдБ? <br><br>  рдЯрд╛рдЗрдорд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╣рд╛рдиреА рдЦрддреНрдо рд╣реЛ рдЧрдИ рд╣реИ, рдФрд░ рд╣рдо рдЕрдЧрд▓реЗ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред <br><br><h2>  рдХрд╣рд╛рдиреА реи: рд╕реЗрдордлреЛрд░рд╕реНрд▓реАрдо </h2><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╣рд╛рдиреА рдкреНрд░рд╕рд┐рджреНрдз рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓реАрдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред <br><br><h3>  2.1 рд╕рд░реНрд╡рд░ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ </h3><br><ul><li>  рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдорд╡рд░реНрддреА рд╕рдВрд╕рд╛рдзрд┐рдд рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ </li></ul><br>  рд╣рдо рд╕рд░реНрд╡рд░ рдкрд░ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗред  рдпрд╣ рдХреНрдпрд╛ рд╣реИ  рдЖрдк рд╢рд╛рдпрдж рд╕реАрдкреАрдпреВ рдкрд░ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рдЬрд╛рдирддреЗ рд╣реИрдВ: рдЬрдм рдкреНрд░реЛрд╕реЗрд╕рд░ рдЬрд╝реНрдпрд╛рджрд╛ рдЧрд░рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдардВрдбрд╛ рд╣реЛрдиреЗ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХрдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдЗрд╕рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред  рддреЛ рдпрд╣ рдпрд╣рд╛рдБ рд╣реИред  рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░рд╛ рд╕рд░реНрд╡рд░ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдПрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЧрд┐рд░ рдирд╣реАрдВ рд╕рдХрддрд╛ рд╣реИред  рд╣рдо рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?  рдЗрд╕ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рд╕рдВрд╕рд╛рдзрд┐рдд рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдРрд╕рд╛ рдХрд░реЗрдВ рдХрд┐ рдпрджрд┐ рдЕрдзрд┐рдХ рдЕрдиреБрд░реЛрдз рдЖрддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рдХрддрд╛рд░рдмрджреНрдз рд╣реЛ рдЬрд╛рдПрдВ рдФрд░ рдЙрди рдЕрдиреБрд░реЛрдзреЛрдВ рддрдХ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬреЛ рдкрд╣рд▓реЗ рдЖрдП рдереЗред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХреИрд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ?  рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬреЗрд╢рди рдЖрджрд┐рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br><br>  рд╕реЗрдорд╛рдлреЛрд░ рдПрдХ рддреБрд▓реНрдпрдХрд╛рд▓рди рдЖрджрд┐рдо рд╣реИ рдЬрд┐рд╕ рдкрд░ рдЖрдк рдПрди рдмрд╛рд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдЬреЛ рдПрди + рдлрд░реНрд╕реНрдЯ рдЖрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реА рддрд░рд╣ рдЙрд╕ рдкрд░ рддрдм рддрдХ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдЬреЛ рдкрд╣рд▓реЗ рдкреНрд░рд╡реЗрд╢ рдХрд░ рдЧрдП рдереЗ рд╡реЗ рд╕реЗрдорд╛рдлреЛрд░ рд░рд┐рд▓реАрдЬ рдХрд░ рджреЗрдВред  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдирд┐рдХрд▓рддрд╛ рд╣реИ: рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреЛ рдзрд╛рдЧреЗ, рджреЛ рд╢реНрд░рдорд┐рдХ рд╕реЗрдорд╛рдлреЛрд░ рдХреЗ рддрд╣рдд рдЪрд▓реЗ рдЧрдП, рдмрд╛рдХреА рд▓рд╛рдЗрди рдореЗрдВ рдЦрдбрд╝реЗ рдереЗред <br><br><img src="https://habrastorage.org/webt/6s/bu/h7/6sbuh77p4temzi5yiofjlh-rxoi.png"><br><br>  рдмреЗрд╢рдХ, рдпрд╣ рд╕рд┐рд░реНрдл рдЗрддрдирд╛ рд╣реИ рдХрд┐ рд╕реЗрдорд╛рдлреЛрд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реИ, рдпрд╣ .NET рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕реЗрдордлреЛрд░рд╕реНрд▓реАрдо рд▓рд┐рдпрд╛ рдФрд░ рдпрд╣ рдХреЛрдб рд▓рд┐рдЦрд╛: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> semaphore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SemaphoreSlim(N); тАж <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> semaphore.WaitAsync(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> HandleRequestAsync(request); semaphore.Release();</code> </pre> <br>  рд╣рдо рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓реАрдо рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрд╕ рдкрд░ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ, рд╕реЗрдорд╛рдлреЛрд░ рдХреЗ рддрд╣рдд рд╣рдо рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдо рд╕реЗрдорд╛рдлреЛрд░ рдЬрд╛рд░реА рдХрд░рддреЗ рд╣реИрдВред  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рд░реНрд╡рд░ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рдХрд╛ рдПрдХ рдЖрджрд░реНрд╢ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИ, рдФрд░ рдпрд╣ рдЕрдм рдмреЗрд╣рддрд░ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред <br><br><h3>  2.2 рд╕рд░реНрд╡рд░ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ: рдЬрдЯрд┐рд▓рддрд╛ </h3><br><ul><li>  LIFO рдЖрджреЗрд╢ рдореЗрдВ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЕрдиреБрд░реЛрдз </li><li>  SemaphoreSlim </li><li>  ConcurrentStack </li><li>  TaskCompletionSource </li></ul><br>  рд╣рдо рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рднреВрд▓ рдЧрдПред  рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдз рд╡рд╛рд╕реНрддрд╡рд┐рдХ http рдЕрдиреБрд░реЛрдз рд╣реИрдВред  рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдЙрдирдХреЗ рдкрд╛рд╕ рдХреБрдЫ рд╕рдордпрдмрд╛рд╣реНрдп рд╣реИ, рдЬреЛ рдЙрди рд▓реЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдпрд╣ рдЕрдиреБрд░реЛрдз рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рднреЗрдЬрд╛ рд╣реИ, рдпрд╛ рдХреБрдЫ рд╕рдордп рдХреЗ рдмрд╛рдж F5 рджрдмрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдпрджрд┐ рдЖрдк рдПрдХ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рд╕реЗрдорд╛рдлреЛрд░ рдХреА рддрд░рд╣, рдХрддрд╛рд░ рдХреНрд░рдо рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдХрддрд╛рд░ рд╕реЗ рдЙрди рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк рд╕реНрдЯреИрдХ рдСрд░реНрдбрд░ рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ - рдЙрди рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд╕реЗ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░реЗрдВ рдЬреЛ рдмрд╣реБрдд рдЕрдВрддрд┐рдо рд╕рдордп рдореЗрдВ рдЖрдП, рдРрд╕реА рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реЛрдЧреАред <br><br>  рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓реАрдо рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдЗрд╕ рд╕рдм рдХреЗ рдЖрд╕рдкрд╛рд╕ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдХреЛрдб рдХреЛ рд▓рдкреЗрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдирдХреЙрдиреНрдЯреНрд░реИрдХреНрдЯрд╕реНрдЯреИрдХ, рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рди рд╕реНрд░реЛрдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдерд╛, рддрд╛рдХрд┐ рд╕рдм рдХреБрдЫ рдЙрд╕ рдХреНрд░рдо рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХреЗ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдЬрд╝рд░реВрд░рдд рдереАред  TaskCompletionSource рдПрдХ рдРрд╕реА рдЪреАрдЬрд╝ рд╣реИ, рдЬреЛ рдХреИрдВрд╕реЗрд▓реЗрд╢рдирдЯреЛрдЯреЗрдирд╕реЗрди рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдХреИрдВрд╕реЗрд▓реЗрд╢рдирдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдЯрд╛рд╕реНрдХ рдХреЗ рд▓рд┐рдПред  рдЖрдк TaskCompletionSource рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕рдореЗрдВ рд╕реЗ рдПрдХ рдЯрд╛рд╕реНрдХ рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕реЗ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ TaskCompletionSource рдХреЛ рдмрддрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреЛ рдЗрд╕ рдЯрд╛рд╕реНрдХ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЬреЛ рд▓реЛрдЧ рдЗрд╕ рдЯрд╛рд╕реНрдХ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рдкрд░рд┐рдгрд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрддрд╛ рдЪрд▓реЗрдЧрд╛ред <br><br>  рд╣рдо рд╕рднреА рдиреЗ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рд╣реИред  рдХреЛрдб рднрдпрд╛рдирдХ рд╣реИред  рдФрд░, рд╕рдмрд╕реЗ рдмреБрд░рд╛, рдпрд╣ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реЛ рдЧрдпрд╛ред <br><br>  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдПрдХ рднрд╛рд░реА рд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рд╢реБрд░реБрдЖрдд рдХреЗ рдХреБрдЫ рдорд╣реАрдиреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛ред  рдкрд┐рдЫрд▓реЗ рдорд╛рдорд▓реЗ рдХреА рддрд░рд╣ рд╣реА, рд╕реАрдкреАрдпреВ рдХреА рдЦрдкрдд рдмрдврд╝рдХрд░ 100% рд╣реЛ рдЧрдИ рд╣реИред  рд╣рдордиреЗ рдРрд╕рд╛ рд╣реА рдХрд┐рдпрд╛, рдбрдВрдк рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛, рд╡рд┐рдирдбрдмрдЧ рдореЗрдВ рдЗрд╕реЗ рджреЗрдЦрд╛, рдФрд░ рдлрд┐рд░ рд╕реЗ рд▓реЙрдХ рдХрд╛рдлрд┐рд▓рд╛ рдорд┐рд▓рд╛ред <br><br><img src="https://habrastorage.org/webt/h_/ef/as/h_efasuul34r0fm7vwopo2hm1bc.jpeg"><br><br>  рдЗрд╕ рдмрд╛рд░ рд▓реЙрдХ рдХрд╛рдлрд┐рд▓рд╛ рд╕реЗрдордлреЛрд░рд╕реНрд▓рд╛рдЗрдо.рд╡реЗрд▓рд┐рдЯреНрд╕рд╕реБрдВрдХ рдФрд░ рд╕реЗрдордлреЛрд░рд╕реНрд▓реАрдо.рд▓реАрдЬ рдХреЗ рдЕрдВрджрд░ рд╣реБрдЖред  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕реЗрдордлреЛрд░рд╕реНрд▓реАрдо рдХреЗ рдЕрдВрджрд░ рдПрдХ рддрд╛рд▓рд╛ рд╣реИ, рдпрд╣ рд▓реЙрдХ-рдлреНрд░реА рдирд╣реАрдВ рд╣реИред  рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рдЧрдВрднреАрд░ рд╕рдорд╕реНрдпрд╛ рдереАред <br><br><img src="https://habrastorage.org/webt/0h/-k/qq/0h-kqqxojlujm3dglokmacabvwq.jpeg"><br><br>  рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓реАрдо рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЖрдВрддрд░рд┐рдХ рд╕реНрдерд┐рддрд┐ рд╣реЛрддреА рд╣реИ (рдХрд┐рддрдиреЗ рдХрд░реНрдордЪрд╛рд░реА рдЕрднреА рднреА рдЗрд╕рдХреЗ рддрд╣рдд рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ) рдХрд╛ рдПрдХ рдХрд╛рдЙрдВрдЯрд░ рд╣реИ, рдФрд░ рдЗрд╕ рд╕реЗрдорд╛рдлреЛрд░ рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд▓реЛрдЧреЛрдВ рдХреА рдПрдХ рдбрдмрд▓ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд╕реВрдЪреА рд╣реИред  рдпрд╣рд╛рдВ рд╡рд┐рдЪрд╛рд░ рд╕рдорд╛рди рд╣реИрдВ: рдЖрдк рдЗрд╕ рд╕реЗрдорд╛рдлреЛрд░ рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдЕрдкрдиреА рдЙрдореНрдореАрдж рдХреЛ рд░рджреНрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдЗрд╕ рдХрддрд╛рд░ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдПред  рдПрдХ рддрд╛рд▓рд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдмрд╕ рд╣рдорд╛рд░реЗ рдЬреАрд╡рди рдХреЛ рдмрд░реНрдмрд╛рдж рдХрд░ рджрд┐рдпрд╛ рд╣реИред <br><br>  рд╣рдордиреЗ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛: рд╕рднреА рднрдпрд╛рдирдХ рдХреЛрдб рдХреЗ рд╕рд╛рде рдЬреЛ рд╣рдореЗрдВ рд▓рд┐рдЦрдирд╛ рдерд╛ред <br><br><img src="https://habrastorage.org/webt/ax/ls/3i/axls3iseuxmgjt-vqkeiqs7hvtq.jpeg"><br><br>  рдЖрдЗрдП рд╣рдорд╛рд░реЗ рд╕реЗрдореАрдлреЛрд░ рдХреЛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдЬреЛ рддреБрд░рдВрдд рд▓реЙрдХ-рдлреНрд░реА рд╣реЛрдЧрд╛ рдФрд░ рдЬреЛ рддреБрд░рдВрдд рд╕реНрдЯреИрдХ рдСрд░реНрдбрд░ рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЛ рд░рджреНрдж рдХрд░рдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред <br><br><img src="https://habrastorage.org/webt/rv/rg/wv/rvrgwv8apebibtiymhxpvm5giti.jpeg"><br><br>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВред  рдпрд╣рд╛рдВ рдирдВрдмрд░ рдХрд░реЗрдВрдЯ-рдХреЙрдЙрдВрдЯ рд╣реЛрдЧрд╛ - рдпрд╣ рд╣реИ рдХрд┐ рд╕реЗрдордлреЛрд░ рдореЗрдВ рдХрд┐рддрдиреЗ рдФрд░ рд╕реНрдерд╛рди рдмрдЪреЗ рд╣реИрдВред  рдпрджрд┐ рд╕реЗрдорд╛рдлреЛрд░ рдореЗрдВ рд╕реАрдЯреЗрдВ рдирд╣реАрдВ рдмрдЪреА рд╣реИрдВ, рддреЛ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдЧреА рдФрд░ рдпрд╣ рджрд░реНрд╢рд╛рдПрдЧреА рдХрд┐ рдХрд┐рддрдиреЗ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХрддрд╛рд░ рдореЗрдВ рд╣реИрдВред  рдПрдХ рд╕рдорд╡рд░реНрддреА рд╕реНрдЯрд╛реЕрдХ рднреА рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рдирд╕реНрд░реЛрд╕реЛрд╡ рд╢рд╛рдорд┐рд▓ рд╣реИ - рдпрд╣ рд╡реЗрдЯрд░'рдУрд╡ рдХрд╛ рдПрдХ рд╕реНрдЯреИрдХ рд╣реИ, рдЬрд╣рд╛рдВ рд╕реЗ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдЙрдиреНрд╣реЗрдВ рдЦреАрдВрдЪ рд▓рд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЪрд▓рд┐рдП WaitAsync рд╡рд┐рдзрд┐ рд▓рд┐рдЦрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> decrementedCount = Interlocked.Decrement(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (decrementedCount &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.CompletedTask; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> waiter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskCompletionSource&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(); waiters.Push(waiter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waiter.Task;</code> </pre> <br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдХрд╛рдЙрдВрдЯрд░ рдХреЛ рдХрдо рдХрд░рддреЗ рд╣реИрдВ, рдЕрдкрдиреЗ рд▓рд┐рдП рд╕реЗрдорд╛рдлреЛрд░ рдореЗрдВ рдПрдХ рдЬрдЧрд╣ рд▓реЗрддреЗ рд╣реИрдВ, рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдореБрдлреНрдд рд╕реНрдерд╛рди рдереЗ, рдФрд░ рдлрд┐рд░ рд╣рдо рдХрд╣рддреЗ рд╣реИрдВ: "рдпрд╣ рдмрд╛рдд рд╣реИ, рдЖрдк рд╕реЗрдореАрдлреЛрд░ рдХреЗ рддрд╣рдд рдЧрдП рдереЗ"ред <br><br>  рдпрджрд┐ рд╕реЗрдордлреЛрд░ рдореЗрдВ рдХреЛрдИ рдЬрдЧрд╣ рдирд╣реАрдВ рдереА, рддреЛ рд╣рдо рдПрдХ рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рди рд╕реНрд░реЛрдд рдмрдирд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╡реЗрдЯрд░'рдУрд╡ рдХреЗ рдвреЗрд░ рдкрд░ рдлреЗрдВрдХ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдЯрд╛рд╕реНрдХ рдХреЛ рдмрд╛рд╣рд░реА рджреБрдирд┐рдпрд╛ рдореЗрдВ рд▓реМрдЯрд╛ рджреЗрддреЗ рд╣реИрдВред  рд╕рдордп рдЖрдиреЗ рдкрд░, рдпрд╣ рдХрд╛рд░реНрдп рдХрд╛рдо рдХрд░реЗрдЧрд╛, рдФрд░ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдЕрдкрдирд╛ рдХрд╛рдо рдЬрд╛рд░реА рд░рдЦ рд╕рдХреЗрдЧрд╛ рдФрд░ рд╕реЗрдорд╛рдлреЛрд░ рдХреЗ рдЕрдзреАрди рд╣реЛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдЕрдм рд╣рдо рд░рд┐рд▓реАрдЬрд╝ рд╡рд┐рдзрд┐ рд▓рд┐рдЦрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countBefore = Interlocked.Increment(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countBefore &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waiters.TryPop(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> waiter)) waiter.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  рд░рд┐рд▓реАрдЬ рд╡рд┐рдзрд┐ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br><ul><li>  рд╕реЗрдорд╛рдлреЛрд░ рдореЗрдВ рдПрдХ рд╕реАрдЯ </li><li>  рдЗрдВрдХреНрд░реАрдореЗрдВрдЯ рдХрд░рдВрдЯ </li></ul><br>  рдпрджрд┐ рд╣рдо currentCount рджреНрд╡рд╛рд░рд╛ рдмрддрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реНрдЯреИрдХ рдХреЗ рдЕрдВрджрд░ рд╡реЗрдЯрд░ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдореЗрдВ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдРрд╕реЗ рд╡реЗрдЯрд░ рдХреЛ рд╕реНрдЯреИрдХ рдФрд░ рд╕рд┐рдЧреНрдирд▓ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рддреЗ рд╣реИрдВред  рдпрд╣рд╛рдБ рд╡реЗрдЯрд░ рдПрдХ TaskCompletionSource рд╣реИред  рдЗрд╕ рдХреЛрдб рдкрд░ рд╕рд╡рд╛рд▓: рдпрд╣ рддрд░реНрдХрд╕рдВрдЧрдд рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рдпрд╣ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?  рдХреНрдпрд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВ?  рдирд┐рд░рдВрддрд░рддрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рд╣реИ, рдЬрд╣рд╛рдВ 'TaskCompletionSource'y' рдХреЛ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/_1/zo/hu/_1zohu07rqeiemrkwrcubv7gwhe.png"><br><br>  рдЗрд╕ рдХреЛрдб рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред  рд╣рдордиреЗ рдПрдХ TaskCompletionSource рдмрдирд╛рдпрд╛ рдФрд░ рджреЛ рдЯрд╛рд╕реНрдХ рд▓реЙрдиреНрдЪ рдХрд┐рдПред  рдкрд╣рд▓рд╛ рдЯрд╛рд╕реНрдХ рдПрдХ рдпреВрдирд┐рдЯ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рди рд╕реНрд░реЛрдд рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдХрдВрд╕реЛрд▓ рдкрд░ рдПрдХ рдбреНрдпреВрд╕ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред  рджреВрд╕рд░рд╛ рдЯрд╛рд╕реНрдХ рдЗрд╕ рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рди рд╕реЛрд░реНрд╕ рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЯрд╛рд╕реНрдХ рдкрд░, рдФрд░ рдлрд┐рд░ рд╣рдореЗрд╢рд╛ рдереНрд░реЗрдб рдкреВрд▓ рд╕реЗ рдЗрд╕рдХреЗ рдереНрд░реЗрдб рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?  рд╕рдВрдХрд▓рди рдореЗрдВ рдЯрд╛рд╕реНрдХ 2 рдХреЛ рджреЛ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рдирдореЗрдВ рд╕реЗ рджреВрд╕рд░рд╛ рдереНрд░реЗрдб рд╣реИред рдереНрд░реЗрдбред рд╕реЛрд▓реЗрдкред  TaskCompletionSource рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рдирд┐рд░рдВрддрд░рддрд╛ рдЙрд╕реА рдереНрд░реЗрдб рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рдХрд╛рд░реНрдп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рддрджрдиреБрд╕рд╛рд░, рдкрд╣рд▓реЗ рдЯрд╛рд╕реНрдХ рдХрд╛ рдкреНрд░рд╡рд╛рд╣ рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рдЕрд╡рд░реБрджреНрдз рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдХрдВрд╕реЛрд▓ рдХреЗ рдбреНрдпреВрд╕ рдХреЛ рдЕрдм рдореБрджреНрд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рдореИрдВрдиреЗ рдЗрд╕ рдХреЛрдб рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рдФрд░ рдЕрдЧрд░ рдореИрдВрдиреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдХрдВрд╕реЛрд▓ рдпреВрдирд┐рдЯ рдореЗрдВ рд╣рдЯрд╛ рджрд┐рдпрд╛, рддреЛ рдереНрд░реЗрдб рдкреВрд▓ рд╕реЗ рджреВрд╕рд░реЗ рдереНрд░реЗрдб рдкрд░ рдирд┐рд░рдВрддрд░рддрд╛ рд▓реЙрдиреНрдЪ рдХреА рдЧрдИ рдФрд░ рдбреНрдпреВрд╕ рдкреНрд░рд┐рдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рдЬрд┐рди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдПрдХ рд╣реА рдереНрд░реЗрдб рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдЬрд┐рд╕рдореЗрдВ - рдереНрд░реЗрдб рдкреВрд▓ рдХреЛ рдорд┐рд▓реЗрдЧрд╛ - рдкрд╛рдардХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╢реНрдиред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tcs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskCompletionSource&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;( TaskCreationOptions.RunContinuationsAsynchronously); <span class="hljs-comment"><span class="hljs-comment">/* OR */</span></span> Task.Run(() =&gt; tcs.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>));</code> </pre> <br>  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдпрд╛ рддреЛ рд╕рдВрдмрдВрдзрд┐рдд RunContinuationsAsynchronously рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд╛рд╕реНрдХрдХреЙрдордкреНрд▓реЗрдХреНрд╢рди рд╕реНрд░реЛрдд рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЯрд╛рд╕реНрдХ рдХреЗ рдЕрдВрджрд░ TrySetResult рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Run/ThreadPool.QueueUserWebItem рддрд╛рдХрд┐ рдпрд╣ рд╣рдорд╛рд░реЗ рдзрд╛рдЧреЗ рдкрд░ рди рдЪрд▓реЗред  рдпрджрд┐ рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рдзрд╛рдЧреЗ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрд╡рд╛рдВрдЫрд┐рдд рджреБрд╖реНрдкреНрд░рднрд╛рд╡ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рджреВрд╕рд░реА рд╕рдорд╕реНрдпрд╛ рд╣реИ, рд╣рдо рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдзреНрдпрд╛рди рджреЗрдВрдЧреЗред <br><br><img src="https://habrastorage.org/webt/m9/x8/gx/m9x8gxz7x5tw3mjcps7nygdmkjs.jpeg"><br><br>  WaitAsync рдФрд░ рд░рд┐рд▓реАрдЬрд╝ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ рдФрд░ рд░рд┐рд▓реАрдЬрд╝ рд╡рд┐рдзрд┐ рдореЗрдВ рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред <br><br>  рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдЙрд╕реЗ рдмрд╕ рдЗрддрдирд╛ рдЕрд╕рдВрднрд╡ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред  рдпрд╣рд╛рдВ рдПрдХ рджреМрдбрд╝ рд╣реИред <br><br><img src="https://habrastorage.org/webt/cs/1e/4q/cs1e4q3yaz4d3084_24z2ucsd6y.jpeg"><br><br>  рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ рдХрд┐ WaitAsync рд╡рд┐рдзрд┐ рдореЗрдВ рд░рд╛рдЬреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдкрд░рдорд╛рдгреБ рдирд╣реАрдВ рд╣реИред  рдкрд╣рд▓реЗ рд╣рдо рдХрд╛рдЙрдВрдЯрд░ рдХреЛ рдШрдЯрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╣реА рд╕реНрдЯреИрдХ рдкрд░ рд╡реЗрдЯрд░ рдХреЛ рдзрдХреНрдХрд╛ рджреЗрддреЗ рд╣реИрдВред  рдпрджрд┐ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рд░рд┐рд▓реАрдЬ рдореЗрдВ рдХрдореА рдФрд░ рдзрдХреНрдХрд╛ рдХреЗ рдмреАрдЪ рдирд┐рд╖реНрдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рд╕реНрдЯреИрдХ рд╕реЗ рдмрд╛рд╣рд░ рдХреБрдЫ рднреА рди рдЦреАрдВрдЪреЗред  рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рд░рд┐рд▓реАрдЬрд╝ рд╡рд┐рдзрд┐ рдореЗрдВ, рд╕реНрдЯреИрдХ рдкрд░ рд╡реЗрдЯрд░ рдХреЗ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countBefore = Interlocked.Increment(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countBefore &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { Waiter waiter; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spinner = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpinWait(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!waiter.TryPop(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> waiter)) spinner.SpinOnce(); waiter.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  рдпрд╣рд╛рдВ рд╣рдо рдЗрд╕реЗ рд▓реВрдк рдореЗрдВ рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рд╣рдо рдЗрд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рдиреЗ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдирд╣реАрдВ рдХрд░рддреЗред  рдкреНрд░реЛрд╕реЗрд╕рд░ рдЪрдХреНрд░ рдХреЛ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рдмрд░реНрдмрд╛рдж рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реНрдкрд┐рдирд╡рд╛рдЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдкрд╣рд▓реЗ рдХреБрдЫ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдореЗрдВ, рдпрд╣ рдПрдХ рд▓реВрдк рдореЗрдВ рд╕реНрдкрд┐рди рдХрд░реЗрдЧрд╛ред  рдпрджрд┐ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпрд╛рдВ рд╣реИрдВ, рддреЛ рд╡реЗрдЯрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрдЧрд╛, рдлрд┐рд░ рд╣рдорд╛рд░рд╛ рдзрд╛рдЧрд╛ рдереНрд░реЗрдб рд╕реЛ рдЬрд╛рдПрдЧрд╛ред рддрд╛рдХрд┐ рд╕реАрдкреАрдпреВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рдмрд░реНрдмрд╛рдж рди рдХрд░реЗрдВред <br><br>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, LIFO- рдСрд░реНрдбрд░ рд╕реЗрдорд╛рдлреЛрд░ рдХреЗрд╡рд▓ рд╣рдорд╛рд░рд╛ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рд╣реИред <br><blockquote>  <b>LowLevelLifoSemaphore</b> <br><ul><li>  рдПрдХ рд╕рдордп рдХрд╛ </li><li>  рд╡рд┐рдВрдбреЛрдЬ рдкрд░ рд╡рд┐рдВрдбреЛрдЬ рд╕реНрдЯреИрдХ рдХреЗ рд░реВрдк рдореЗрдВ IO рдХрдореНрдкреЗрдХреНрд╢рди рдкреЛрд░реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ </li></ul><br>  <a href="">https://github.com/dotnet/corert/blob/master/src/System.Private.CoreLib/src/System/Threading/LowLevelLifoSemaphore.cs</a> </blockquote>  .NET рдореЗрдВ рд╣реА рдРрд╕рд╛ рд╕реЗрдорд╛рдлреЛрд░ рд╣реИ, рд▓реЗрдХрд┐рди CoreCLR рдореЗрдВ рдирд╣реАрдВ, CoreFX рдореЗрдВ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ CoreRT рдореЗрдВред  рдпрд╣ рдХрднреА-рдХрднреА .NET рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЖрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдЙрдкрдпреЛрдЧреА рд╣реИред  рдПрдХ рд╕реЗрдорд╛рдлреЛрд░ рд╣реИ рдЬрд┐рд╕реЗ рд▓реЛрд╡реЗрд▓рд╡реЗрд▓рд┐рдлреЛрд╕реЗрдорд╛рдлреЛрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕реЗрдорд╛рдлреЛрд░ рд╣рдореЗрдВ рд╡реИрд╕реЗ рднреА рд╕реВрдЯ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛: рдпрд╣ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд╣реИред <br><br>  рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд░реВрдк рд╕реЗ, рд╡рд┐рдВрдбреЛрдЬ рдкрд░ рдпрд╣ IO рдХрдореНрдкреНрд▓реАрд╢рди рдкреЛрд░реНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдЙрдирдХреЗ рдкрд╛рд╕ рд╕рдВрдкрддреНрддрд┐ рд╣реИ рдХрд┐ рдзрд╛рдЧреЗ рдЙрди рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпреЗ рдзрд╛рдЧреЗ рд╕рд┐рд░реНрдл рдПрд▓рдЖрдИрдПрдлрдУ рдХреЗ рдЖрджреЗрд╢ рдореЗрдВ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╡рд╣рд╛рдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд▓реЛрд╡реЗрд▓ рд╣реИред <br><br><h3>  2.3 рдирд┐рд╖реНрдХрд░реНрд╖: </h3><br><ul><li>  рдЙрдореНрдореАрдж рди рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЗ рд▓реЛрдб рдХреЗ рддрд╣рдд рдврд╛рдВрдЪреЗ рдХреЛ рднрд░рдирд╛ рдмрдЪ рдЬрд╛рдПрдЧрд╛ </li><li>  рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред </li><li>  рддрдирд╛рд╡ рдкрд░реАрдХреНрд╖рдг рд╣рдореЗрд╢рд╛ рдорджрдж рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ </li><li>  рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рд╕реЗ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ </li></ul><br>  рдЗрд╕ рдкреВрд░реА рдХрд╣рд╛рдиреА рд╕реЗ рдХреНрдпрд╛ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд▓рддрд╛ рд╣реИ?  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдЖрд╢рд╛ рди рдХрд░реЗрдВ рдХрд┐ рдорд╛рдирдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╕реЗ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд░реВрдкрд░реЗрдЦрд╛ рд╕реЗ рдХреБрдЫ рдХрдХреНрд╖рд╛рдПрдВ рдЖрдкрдХреЗ рднрд╛рд░ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░реЗрдВрдЧреАред  рдореИрдВ рдпрд╣ рдирд╣реАрдВ рдХрд╣рдирд╛ рдЪрд╛рд╣рддрд╛ рдХрд┐ рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓рд┐рдо рдЦрд░рд╛рдм рд╣реИ, рдпрд╣ рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдкрдпреБрдХреНрдд рд╣реИред <br><br>  рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рд╕реЗрдореАрдлреЛрд░ рдХреЛ рд▓рд┐рдЦрдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛ рдЧрдпрд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрдорд╛рдлреЛрд░рд╕реНрд▓рд┐рдо рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдиреЗ рд╣рдореЗрдВ рдХреЛрдб рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рд╣реИред <br><br>  рд▓реЛрдб рдкрд░реАрдХреНрд╖рдг, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдорджрдж рдХрд░рддрд╛ рд╣реИ, рд╣рдореЗрд╢рд╛ рдорджрдж рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред <br><br> .NET  ,           тАФ   .        lock,  : ┬л    ?┬╗     CPU 100%,     lock', , ,   -  .NET.      . <br><br>    . <br><br><h2>  3: (A)sync IO </h2><br>    /,      . <br><br><img src="https://habrastorage.org/webt/84/qh/sz/84qhsz9je7twmgbswt5so0dfx2q.jpeg"><br><br>    lock convoy,    stack trace     Overlapped  PinnableBufferCache.   lock.     : Overlapped  PinnableBufferCache? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">OVERLAPPED</a> тАФ    Windows,      /.      ,        .        ,  .       ,     lock convoy.   ,      lock convoy,    ,   . <br><br><img src="https://habrastorage.org/webt/if/j_/fc/ifj_fclqmvkfgfff7zedxpj63mo.jpeg"><br><br>  ,       ,   .NET 4.5.1  4.5.2.     .NET 4.5.2,     ,    .NET 4.5.2.  .NET 4.5.1     OverlappedDataCache,      Overlapped тАФ ,       ,   .    ,  lock-free,   ConcurrentStack,       .  .NET 4.5.2     :  OverlappedDataCache   PinnableBufferCache. <br><br>   ? PinnableBufferCache     ,   Overlapped     ,    ,       тАФ      . ,     ,      . PinnableBufferCache     .   , lock-free,   ConcurrentStack.     ,      .        ,        ,  -    lock-free    list  lock'. <br><br><h3> 3.1 PinnableBufferCache </h3><br> LockConvoy: <br><br><ul><li>    </li><li>      </li></ul><br>  lock convoy  ,   -     .        list      ,     lock   ,  ,                . <br><br>     PinnableBufferCache  ,         .    : <br><br><pre> <code class="plaintext hljs">PinnableBufferCache_System.ThreadingOverlappedData_MinCount</code> </pre> <br>      ,      .  : ┬л !         -  ┬╗.         -: <br><br><pre> <code class="cs hljs">Environment.SetEnvironmentVariable( <span class="hljs-string"><span class="hljs-string">"PinnableBufferCache_System.Threading.OverlappedData_MinCount"</span></span>, <span class="hljs-string"><span class="hljs-string">"10000"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Overlapped().GetHashCode(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced);</code> </pre> <br>    ?     ,    Overlapped  ,   ,        .     ,   ,     ,     ,  PinnableBufferCache      lock convoy'.    ,           . <br><br>  .NET Core  PinnableBufferCache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ,   OverlappedData   . ,        , Garbage collector     ,      .     .NET Core  .  .NET Framework,   ,     . <br><br><h3> 3.2 : </h3><br><ul><li>      </li><li>      </li><li>   .NET Core </li></ul><br>      ,     .   ,   .NET            ,       . ,  ,  .NET Core. ,     ,         -. <br><br>    key-value . <br><br><h2>  4: Concurrent key-value collections </h2><br>  .NET   concurrent-.  lock-free  ConcurrentStack  ConcurrentQueu,       .   ConcurrentDictionary,    .   lock-free  ,   ,      .    ConcurrentDictionary? <br><br><h3> 4.1 ConcurrentDictionary </h3><br> : <br><br><ul><li>  </li><li>  </li></ul><br>  рдкреЗрд╢реЗрд╡рд░реЛрдВ: <br><br><ul><li>     </li><li>   (TryAdd/TryUpdate/AddOrUpdate) </li><li> Lock-free  </li><li> Lock-free enumeration </li></ul><br>      , memory-,  ,        .    ,    ,    .NET Framework.            . ,  ,      (enumeration) lock-free. ,   . <br><br>  ,   ,   -  .NET.  key-value    -    : <br><br><img src="https://habrastorage.org/webt/ff/9f/g_/ff9fg_qzzuzvafep8c-p3seyigm.jpeg"><br><br>  -,     bucket'.      bucket',    .   ,    bucket   ,       . <br><br>    тАФ   ,  ConcurrentDictionary.  ConcurrentDictionary    ┬л-┬╗   .    ,      ,   ,       memory traffic.     ConcurrentDictionary,   lock'.   тАФ   . <br><br>    ,    Dictionary. <br><br><img src="https://habrastorage.org/webt/-_/dw/jo/-_dwjoxswmd1kecoi3aln8m7bow.jpeg"><br><br>  Dictionary  ,  Concurrent,      .     :  buckets,  entries.   buckets       bucket'   entries.   ┬л-┬╗    entries.          .      ┬л-┬╗   int,     bucket'. <br><br>   memory overhead,     ConcurrentDictionary   Dictionary. <br><br><img src="https://habrastorage.org/webt/em/aa/ch/emaachor-z_xxt7m_1wc7ntqupm.jpeg"><br><br>    Dictionary. Memory overhea'    ,       .    Dictionary  overhead  -    ,  int'.  8 . <br><br>    ConcurrentDictionary.  ConcurrentDictionary     ConcurrentDictionary.Node.   , .     int hashCode        .       ,    table (  16 ),  int hashCode     .      ,   64-    28  overhead'.       Dictionary. <br><br>  memory overhead', ConcurrentDictionary     GC   ,       .     Benchmark.   ConcurrentDictionary  ,       GC.Collect.    ? <br><br><img src="https://habrastorage.org/webt/on/yj/uq/onyjuq1rqgfkv8iav5x4z8nrnq8.jpeg"><br><br>     .       ConcurrentDictionary  10  ,        ,             ,      .   Dictionary   .      ,   ,  ,    .       . <br><br>     ,     ConcurrentDictionary? <br><br><h3> 4.2   </h3><br><ul><li>    </li><li> TTL </li><li> Dictionary+lock </li><li> Sharding </li></ul><br>     .      ConcurrentDictionary.        10  .   ,     .   TTL  ,    .        Dictionary  lock'. ,  ,  lock    .       Dictionary  lock'      ,   -     ,           lock.      ,     . <br><br><h3> 4.3  </h3><br><ul><li>   in-memory  &lt;Guid,Guid&gt; </li><li>   &gt;10 <sup>6</sup>  </li><li>       </li><li>   </li><li>        </li></ul><br>     .      тАФ      ,       in-memory   Guid'  Guid,     .       .     - - ,     .  ,            15    .   .     Semaphore     ConcurrentDictionary. <br><br><img src="https://habrastorage.org/webt/u4/kw/kt/u4kwkttmxwpyelqlqoqp9zxahaa.jpeg"><br><br> ,    lock-free    ,    overhead      GC.   ,          .      ,    ,       ,   .   ,     -  ,       ,    .  ,  ,      Large Object Heap.    ? <br><br>       ,     ,     Dictionary   . <br><br><img src="https://habrastorage.org/webt/kx/yn/oi/kxynoiatsy8zcyrc5dei-xohlk4.jpeg"><br><br>   Dictionary   bucket',  Entry.  Entry  , ,   ,   . <br><br><img src="https://habrastorage.org/webt/n8/7a/5r/n87a5rlkgdk62nw82qysi3fmi18.png"><br><br>  Dictionary   ,   ,      . ,     - . <br><br>      ,  -     ? -,  ,       ,     ,      .     .    Dictionary,     , buckets, entries,              Interlocked. ,         . <br><blockquote> <b>Dictionary</b> <br><ul><li>   ,    </li><li>     ,   ? <br> тАФ  Resize  buckets  entries   <br> тАФ      - <br> тАФ    Dictionary.Entry <br> тАФ   -   </li></ul><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://blogs.msdn.microsoft.com/tess/2009/12/21/high-cpu-in-net-app-using-a-static-generic-dictionary/</a> </blockquote>     ,       Dictionary       -  bucket'.       ,      .    ,     ,        .       ,       ,    . <br><br>      Entry  Dictionary.     - -    .  ,     . <br><br><img src="https://habrastorage.org/webt/4p/xb/aq/4pxbaqil2cd4jaxnayxjqz-5yae.jpeg"><br><br>    .NET Framework  1.1.     Hashtable,   Dictionary,    object'.     MSDN ,      .  ,             -.   .  ,  Hashtable  .  ,      . <br><br><h3> 4.4    Dictionary.Entry </h3><br><img src="https://habrastorage.org/webt/y2/ww/rs/y2wwrslyuqpioqcalmpnt8dh6cw.jpeg"><br>    ? Dictionary.Entry ,  ,  8 , ,  ,   ,     .   ? <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> writing; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; buckets[index] = тАж; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>   :  (    ,    )  int-.   ,  .   ,     , ,  ,  . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> writing; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version; bucket = bickets[index]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing || version != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br>    ,     ,         .       ,   .       ,  8 . <br><br><h3> 4.5   -   </h3><br>  ,   . <br><br><img src="https://habrastorage.org/webt/hh/bp/0l/hhbp0leb95qndz4bmg-2gtvmeue.jpeg"><br><br>  Dictionary     bucket    ,     . <br><br>  Dictionary,    .      : 0  2.   bucket, 1       2.   ?     0.   ,       ,    2.     .   ,  2,       , , 1. 1       2 тАФ     bucket.   ,      ,   .    1 тАФ ,     bucket.  Hashtable     ,     bucket'  -.        тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">double hashing</a> . <br><br><h3> 4.6   </h3><br><ul><li>     </li><li>      </li></ul><br> <b></b> <br><br><ul><li>        </li><li>    ,  resize </li></ul><br> <b></b> <br><br><ul><li>     ,      </li></ul><br>        .         ,       Buckets,     Entries (   Buckets,     Entries).   -  ,       ,   ,          ,    . <br><br>             .    ,    . <br><br>  :     ,      ,    ,     ,     . ,       ,   . <br><br><img src="https://habrastorage.org/webt/pm/lo/ah/pmloah0wlfbq7ilvlnrvbh3pyuu.png"><br><br>     ,   , тАФ  . <br><br>   ?   ,  -    2.   -   Capacity  ,            .    тАФ 2.       ,   .      2.    ?  ,  ,     ,   .    -  ,        ,       3. ,    ,  ,    ,  ,  . <br><br>  ,    Hashtable,  .   ,     double hashing.     ,       ,   ,     . <br><br>   ,      ,     тАФ   ,            .     Hashtable.   ,    тАФ     тАФ       .                 .  ,     bucket',       -  ,       .  . <br><br>     ,  ,   lock-free      LOH. <br><br><img src="https://habrastorage.org/webt/pg/2b/6b/pg2b6bbfkm_3nnkds27g2krziz8.jpeg"><br><br>   lock-free ?  MSDN    Hashtable ,      .    ,            ,            . <br><br><img src="https://habrastorage.org/webt/yu/sg/he/yusghe0crfu9ywaic0aozpr7wri.jpeg"><br><br>      ,     ,        ,   bucket'.         Dictionary  bucket',  -,   bucket'      .    -    bucket,  bucket  .      ,     . <br><br>  ,       Large Object Heap. <br><br><img src="https://habrastorage.org/webt/wf/po/8o/wfpo8ou1_fpzhdkgcdbjzw-7u9q.jpeg"><br><br>      .  CustomDictionary  CustomDictionarySegment    .   Dictionary,    ,      .   тАФ   Dictionary,      .       ,      Large Object Heap.        ,   bucket'   . ,      ,    ,   bucket,     - - . <br><br>           .       ConcurrentDictionary,     .NET,        ,      . <br><br><h3> 4.7  </h3><br><ul><li> .NET   </li><li>    </li><li>   </li><li> ,     </li><li>   </li><li>   </li></ul><br>     ? .NET  .   .   ,     ,       .    -   тАФ   - .   ,  , ,     . <br><br>  -   , ,   ,     ,   .   ,   ,   ,        , ,          .   тАФ   , ,   . <br><br><h3>   </h3><br><ul><li>   ConcurrentDictionary: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://habr.com/ru/company/skbkontur/blog/348508/</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/vostok/commons.threading</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/epeshk/dotnext-2019-threading</a> </li></ul><br>   тАФ          ConcurrentDictionary. ,      ,   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">Diafilm</a> ),       . <br><br>      GitHub.   тАФ     ,    ,    LIFO-Semaphore,    .       ,    . <br><blockquote> 6-7     <b>DotNext 2019 Moscow</b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">┬л.NET:  ┬╗</a>    ,        .NET Framework  .NET Core,  ,        . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi468611/">https://habr.com/ru/post/hi468611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi468601/index.html">рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рдЕрд╡рдзрд┐ рдХрд╛ рдЕрдиреБрдорд╛рдиред рдХреНрдпреЛрдВ рдпрд╣ рд▓рдЧрднрдЧ рд╣рдореЗрд╢рд╛ рдмрд╣реБрдд рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ</a></li>
<li><a href="../hi468603/index.html">рд░рдЯреНрд░реИрдХрд░ рдиреЗ eSNI рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рд╣реИред DPI рдпреБрдЧ рдХрд╛ рдЕрдВрдд рдФрд░ рддрд╛рд▓реЛрдВ рдХрд╛ рдЕрдВрдд</a></li>
<li><a href="../hi468605/index.html">рд▓рдЧрд╛рддрд╛рд░ рд╕рдВрдХреЗрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдХреЗрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдХреЗрдд ...</a></li>
<li><a href="../hi468607/index.html">рд░реЗрдбрд┐рдпреЛ рдЗрдВрдЬреАрдирд┐рдпрд░ рдХреЗ рд▓рд┐рдП Android (рднрд╛рдЧ рджреЛ)</a></li>
<li><a href="../hi468609/index.html">рдХрдИ рд╢реЗрдбреНрдпреВрд▓рд┐рдВрдЧ рдХрд╛ рд╕рдордЭ рд╕реЗ рдмрд╛рд╣рд░ рдкреНрд░рджрд░реНрд╢рди</a></li>
<li><a href="../hi468615/index.html">рдРрдк рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖ 10 рднрд╛рд╖рд╛рдПрдБ</a></li>
<li><a href="../hi468621/index.html">рд╣рдо рд╣реЛрдо рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ DoH рдореЗрдВ рдЯреНрд░рд╛рдВрд╕рд▓реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдпрд╛ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдирд╛рдХ рдкрд░ рдПрдХ рдФрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi468623/index.html">рдореБрдЭреЗ рд╣реИрдмрд░ рдкрд░ рд╕рдореАрдХреНрд╖рд╛рдПрдВ рдЪрд╛рд╣рд┐рдП</a></li>
<li><a href="../hi468625/index.html">рд╕рд░реНрд╡рд░ рд░рд╣рд┐рдд: 15% рдзреАрдорд╛ рдФрд░ рдЖрда рдЧреБрдирд╛ рдЕрдзрд┐рдХ рдорд╣рдВрдЧрд╛</a></li>
<li><a href="../hi468629/index.html">рдореИрдВрдиреЗ рдПрдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬреЛ рдПрдХ рд▓рд╛рдЦ рд░рди рдХреЗ рдмрд╛рдж рднреА рдЫрд╡рд┐ рдХреЛ рджреВрд╖рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ - рднрд╛рдЧ 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>