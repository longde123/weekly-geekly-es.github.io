<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñºÔ∏è üë©üèø‚Äç‚öïÔ∏è üßôüèø Configurando um servidor de impress√£o CUPS do zero, com e sem autoriza√ß√£o de dom√≠nio em uma rede com diferentes sistemas operacionais üé° üôãüèæ üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Configurando um servidor de impress√£o CUPS do zero, com e sem autoriza√ß√£o de dom√≠nio em uma rede com diferentes sistemas operacionais 
 Entrada 


 En...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configurando um servidor de impress√£o CUPS do zero, com e sem autoriza√ß√£o de dom√≠nio em uma rede com diferentes sistemas operacionais</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443094/"><h2 id="nastroyka-s-nulya-printservera-cups-s-domennoy-avtorizaciey-i-bez-nee-v-seti-s-raznymi-os">  Configurando um servidor de impress√£o CUPS do zero, com e sem autoriza√ß√£o de dom√≠nio em uma rede com diferentes sistemas operacionais </h2><br><h3 id="vstuplenie">  Entrada </h3><br><p>  Ent√£o  Presumivelmente, o servi√ßo de impress√£o CUPS √© uma solu√ß√£o poderosa que permite organizar o gerenciamento centralizado de impressoras na empresa.  Assim √©, mas durante o processo de configura√ß√£o, voc√™ precisar√° gastar algum tempo procurando uma solu√ß√£o para muitos pequenos problemas n√£o √≥bvios do Google, especialmente se sua necessidade for al√©m dos manuais de configura√ß√£o padr√£o. </p><br><p>  O artigo descrever√° a instala√ß√£o do servidor de impress√£o CUPS no Ubuntu Server em uma rede com um dom√≠nio ativo do Active Directory, embora sua presen√ßa seja completamente opcional e voc√™ possa pular com seguran√ßa as instru√ß√µes para configurar a intera√ß√£o com ele, configur√°-lo e configurar m√°quinas clientes Linux e Windows para interagir com este servidor de impress√£o. </p><a name="habracut"></a><br><p>  Nas instru√ß√µes, o dom√≠nio ser√° nomeado <strong>example.com</strong> , o pr√≥prio servidor de impress√£o ser√° <strong>cupsserver</strong> ( <strong>cupsserver.example.com</strong> ) com um endere√ßo IP 10.10.100.50 e as m√°quinas cliente <strong>linux1</strong> , <strong>linux2</strong> , <strong>linux3</strong> etc. para as m√°quinas cliente Linux e <strong>Windows1</strong> , <strong>Windows2</strong> , <strong>Windows3</strong> e etc.  para m√°quinas clientes Windows, respectivamente. </p><br><h3 id="nastroyka-printservera">  Configurando um servidor de impress√£o </h3><br><p>  Antes de tudo, configuraremos o servidor de impress√£o, ou melhor, configuraremos o acesso administrativo, depois configuramos a impress√£o e descreveremos a configura√ß√£o das m√°quinas clientes. </p><br><p>  Vamos ao servidor de impress√£o de qualquer maneira conveniente e atualizamos os pacotes: </p><br><pre><code class="plaintext hljs">root@cupsserver:~# apt update &amp;&amp; apt uprgrade -y</code> </pre> <br><p>  Em seguida, verifique se o CUPS est√° instalado no servidor: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# which cupsd</code> </pre> <br><p>  Se a sa√≠da for algo parecido com isto: </p><br><pre> <code class="plaintext hljs">/usr/bin/cupsd</code> </pre> <br><p>  o CUPS est√° instalado; se n√£o houver sa√≠da, instale o CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# apt install cups -y</code> </pre> <br><p>  Agora configure o acesso administrativo √† interface da web do CUPS.  Todos os arquivos de configura√ß√£o est√£o localizados no caminho <em>/ etc / cups /</em> .  Para come√ßar, apenas no caso, faremos backup dos principais arquivos de configura√ß√£o do CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cp /etc/cups/cupsd.conf /etc/cups/cupsd.conf.original root@cupsserver:~# cp /etc/cups/cups-files.conf /etc/cups/cups-files.conf.original root@cupsserver:~# cp /etc/cups/cups-browsed.conf /etc/cups/cups-browsed.conf.original</code> </pre> <br><p>  No entanto, se voc√™ n√£o fez isso - n√£o importa, por padr√£o, os arquivos de dados de amostra est√£o localizados no caminho <em>/ usr / share / cups</em> .  Tamb√©m vale ressaltar que voc√™ pode verificar qualquer op√ß√£o adicionada nos arquivos de configura√ß√£o do CUPS usando o comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cupsd -t</code> </pre> <br><p>  Se voc√™ estragou alguma coisa, selou ou usou uma op√ß√£o que n√£o √© mais suportada pelo CUPS, a sa√≠da do comando refletir√° esses erros. </p><br><p>  Mas, finalmente, vamos come√ßar a configurar.  Ap√≥s qualquer altera√ß√£o nos arquivos na pasta <em>/ etc / cups /</em> , voc√™ precisa reiniciar o servi√ßo CUPS para obter o efeito: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups restart  root@cupsserver:~# systemctl restart cups  root@cupsserver:~# /etc/init.d/cups restart</code> </pre> <br><p>  E se voc√™ editou o arquivo <em>/etc/cups/cups-browsed.conf</em> , um servi√ßo separado de <strong>navega√ß√£o por copa</strong> √© respons√°vel por ele, que tamb√©m precisa ser reiniciado: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups-browsed restart  root@cupsserver:~# systemctl restart cups-browsed  root@cupsserver:~# /etc/init.d/cups-browsed restart</code> </pre> <br><p>  Execute o comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# nano /etc/cups/cupsd.conf</code> </pre> <br><p>  A primeira op√ß√£o n√£o comentada √© </p><br><pre> <code class="plaintext hljs">LogLevel warn</code> </pre> <br><p>  Determina o conte√∫do m√≠nimo de informa√ß√µes dos logs do CUPS.  Os arquivos de log do CUPS est√£o localizados em <em>/ var / log / cups /</em> .  No momento da instala√ß√£o, configura√ß√£o e depura√ß√£o do servidor de impress√£o, seria aconselh√°vel colocar o log no modo de depura√ß√£o.  Para fazer isso, altere warn para debug2: </p><br><pre> <code class="plaintext hljs">LogLevel debug2</code> </pre> <br><p>  Por padr√£o, o CUPS escuta as conex√µes de entrada apenas do <strong>host local</strong> , ou seja, na interface de loopback.  Para garantir isso, voc√™ pode executar o comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# netstat -plutn</code> </pre> <br><p>  Uma das linhas ser√° mais ou menos assim: </p><br><pre> <code class="plaintext hljs">tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 737/cupsd</code> </pre> <br><p>  Outras a√ß√µes dependem do grau de sua paran√≥ia.  Voc√™ pode adicionar no bloco, que come√ßa condicionalmente com o coment√°rio <strong>#Apenas para conex√µes da m√°quina local,</strong> v√°rias linhas com os endere√ßos IP ou sub-redes, de onde o CUPS poder√° ouvir as conex√µes. </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen localhost:631 Listen /run/cups/cups.sock #    IP  Listen 10.10.100.67:631 #     Listen 172.16.0.0:631</code> </pre> <br><p>  Ou voc√™ pode permitir que o CUPS ou√ßa conex√µes de todos os endere√ßos </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen /run/cups/cups.sock Port 631</code> </pre> <br><p>  O pr√≥ximo ponto de configura√ß√£o √© a descoberta de impressoras de rede e compartilhadas. </p><br><pre> <code class="plaintext hljs"># Show shared printers on the local network. Browsing Off BrowseLocalProtocols dnssd</code> </pre> <br><p>  Na minha opini√£o, essa op√ß√£o deve permanecer desativada, pois determina se as informa√ß√µes de difus√£o ser√£o enviadas pela rede sobre impressoras conectadas ao servidor de impress√£o.  Mas todos eles estar√£o conectados a ele.  E, portanto, todas as m√°quinas clientes exibir√£o imediatamente todas as impressoras.  Nosso servidor de impress√£o deve procurar e detectar todas as impressoras na rede, mas n√£o envi√°-las sem pensar pela rede. </p><br><p>  A seguir est√£o as configura√ß√µes de autentica√ß√£o: </p><br><pre> <code class="plaintext hljs"># Default authentication type, when authentication is required... DefaultAuthType Basic</code> </pre> <br><p>  Define os direitos de acesso √† interface da web do CUPS, bem como √† sua parte administrativa.  Para que o usu√°rio <strong>usu√°rio</strong> tenha o direito de administrar o CUPS, ele deve ser adicionado ao grupo de sistemas <strong>lpadmin</strong> : </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# usermod -a -G lpadmin user</code> </pre> <br><p>  Em geral, os grupos aos quais √© permitido acesso administrativo ao CUPS s√£o definidos no arquivo de configura√ß√£o <em>cups-files.conf</em> no bloco </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  Se voc√™ deseja adicionar direitos para administrar um servidor de impress√£o, por exemplo <strong>printadmins</strong> , a um determinado grupo de usu√°rios do Linux, adicione-os com um espa√ßo para <strong>lpadmin</strong> .  Se o grupo for de dom√≠nio, ser√° um pouco mais complicado e ser√° descrito mais adiante. </p><br><p>  Agora vamos para o bloco <strong>&lt;Location /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny &lt;/Location&gt;</code> </pre> <br><p>  <strong>Ordem permitir, negar</strong> significa que conex√µes de todos os lugares s√£o proibidas, a menos que a permiss√£o seja especificamente indicada.  Ou seja, voc√™ precisa adicionar endere√ßos IP, sub-redes, hosts ou hosts por m√°scara ( <em><strong>.example.com</strong> ) no formato "</em> Permitir do [endere√ßo permitido] *": </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from cupsserver #         Allow from cupsserver.example.com #       FQDN Allow from localhost #       loopback  Allow from 10.10.100.* #    Allow from linux4.example.com #     Allow from 172.168.5.125 #  , IP   &lt;/Location&gt;</code> </pre> <br><p>  Para total confian√ßa e depura√ß√£o, voc√™ pode deixar, at√© configurar tudo o resto, um design que permita a impress√£o de qualquer lugar: </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from all &lt;/Location&gt;</code> </pre> <br><p>  Vamos configurar o acesso administrativo ao CUPS no servidor de impress√£o.  Decida a quais IPs e / ou sub-redes voc√™ ir√° se conectar no CUPS e adicione-os por analogia com o bloco <strong>&lt;Location /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt;</code> </pre> <br><p>  Opcionalmente, voc√™ pode adicionar o idioma da interface padr√£o.  A lista de idiomas dispon√≠veis pode ser visualizada usando o comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# ls /usr/share/cups/locale</code> </pre> <br><p>  Se a localiza√ß√£o que voc√™ precisa, por exemplo <strong>ru</strong> , for, adicione uma linha em <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru</code> </pre> <br><p>  Para que seu servidor de impress√£o <strong>cupsserver.example.com</strong> seja acessado por seu host (nome do host), voc√™ precisa criar um arquivo <em>client.conf</em> na pasta <em>/ etc / cups /</em> com o seguinte conte√∫do: </p><br><pre> <code class="plaintext hljs">ServerName _</code> </pre> <br><p>  Da maneira mais simples, isso pode ser feito assim: </p><br><pre> <code class="plaintext hljs">root@cupsserver:/etc/cups# echo "ServerName $(cat /etc/hostname)" &gt; /etc/cups/client.conf</code> </pre> <br><p>  Como assumimos que existe um servidor DNS na rede, √© prefer√≠vel que voc√™ possa acessar o servidor de impress√£o pelo seu nome de dom√≠nio ( <strong>cupsserver.example.com</strong> ).  O servidor tamb√©m pode receber um alias CNAME no servidor DNS, como <strong>impress√£o</strong> ou <strong>copinhos</strong> .  Para que o servidor de impress√£o aceite conex√µes nessas chamadas, voc√™ deve adicionar a seguinte linha ao arquivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">ServerAlias cupsserver.example.com print cups</code> </pre> <br><p>  Se voc√™ deseja que o servidor de impress√£o aceite chamadas ou n√£o se preocupe, adicione isso: </p><br><pre> <code class="plaintext hljs">ServerAlias *</code> </pre> <br><p>  Voc√™ tamb√©m precisa procurar dentro do arquivo <em>/etc/cups/cups-browsed.conf</em> .  Este arquivo controla como o servidor de impress√£o procura impressoras na rede e transmite suas impressoras.  Sugiro desativar completamente a op√ß√£o de boletim informativo.  O servidor de impress√£o procurar√° a impressora na rede, mas a partir dela as impressoras para as m√°quinas clientes ser√£o conectadas manualmente.  Abaixo ser√° descrito o porqu√™.  Enquanto isso, encontramos a linha <strong>BrowseRemoteProtocols dnssd cups</strong> : </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to discover printers on the network? # Can use DNSSD and/or CUPS and/or LDAP, or 'none' for neither. BrowseRemoteProtocols dnssd cups</code> </pre> <br><p>  Gra√ßas a esta op√ß√£o, o servidor de impress√£o procura impressoras compartilhadas na rede.  Deixamos a impressora ligada, pois √© do nosso interesse que o servidor de impress√£o pesquise a impressora na rede.  Mas n√£o precisamos absolutamente do servidor de impress√£o para enviar todas as impressoras conectadas a ele, caso contr√°rio, haver√° muita confus√£o.  Para evitar esse cen√°rio, encontre a seguinte op√ß√£o <strong>#BrowseLocalProtocols none</strong> e descomente-a: </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to broadcast shared local printers to the network? # Can use DNSSD and/or CUPS, or 'none' for neither. # Only CUPS is actually supported, as DNSSD is done by CUPS itself (we ignore DNSSD in this directive). BrowseLocalProtocols none</code> </pre> <br><p>  Nisso, suspendemos a configura√ß√£o do servidor de impress√£o e prosseguimos para a configura√ß√£o dos computadores clientes Windows e Linux.  Os requisitos para eles s√£o os seguintes: permitir o envio de trabalhos de impress√£o ao servidor de impress√£o e enviar trabalhos de impress√£o para (e somente) o servidor de impress√£o, se for necess√°rio imprimir em uma impressora de rede. </p><br><p>  Como exemplo, configuraremos a impress√£o atrav√©s de um servidor de impress√£o entre duas m√°quinas clientes com Linux (nome do host <strong>linux1</strong> ) e Windows 8, respectivamente (nome do host <strong>windows1</strong> ).  Vamos come√ßar configurando o <strong>windows1</strong> como um receptor de impress√£o de um servidor de impress√£o.  Eu tenho uma impressora Canon i-SENSYS MF4410 conectada e funcionando normalmente.  O nome da impressora √© Canon-MF4400.  De fato, a maneira mais f√°cil de garantir a impress√£o de um servidor de impress√£o no <strong>windows1</strong> √© ir ao <em>Painel de Controle&gt; Programas&gt; Programas e Recursos&gt; Ativar ou desativar os Recursos do Windows</em> .  L√°, <em>ativamos o</em> componente <em>Servi√ßos de impress√£o e documentos&gt; Servi√ßo de impress√£o LPD</em> .  Isso permitir√° que voc√™ conecte esta impressora ao servidor de impress√£o usando o <em>endere√ßo lpd: // windows1 / Canon-MF4400</em> .  Claro, a quest√£o est√° amadurecendo, por que n√£o conectar usando SMB?  Ningu√©m pro√≠be.  Se voc√™ depurou esse m√©todo, pode compartilhar a impressora dessa maneira e conect√°-la ao servidor de impress√£o usando o protocolo SMB.  As instru√ß√µes para essa conex√£o, na minha opini√£o, est√£o al√©m do escopo deste artigo, que j√° √© bastante volumoso.  Enquanto isso, acreditamos que o leitor foi com √™xito para o endere√ßo <code>http://cupsserver:631/admin</code> clicou no bot√£o "Adicionar uma nova impressora" e, seguindo a intui√ß√£o, a l√≥gica e os manuais lidos anteriormente, ele conectou a impressora com <strong>windows1</strong> por meio do protocolo <strong>LPD</strong> ao <strong>cupsserver [exemplo. com]</strong> e a p√°gina da impressora est√° dispon√≠vel em <code>http://cupsserver:631/printers/Canon-MF4400</code> . </p><br><p>  Agora, realizamos uma opera√ß√£o semelhante na m√°quina cliente Linux com o nome do host <strong>linux1</strong> .  Em geral, essa parte ser√° muito maior, pois a m√°quina cliente possui seu pr√≥prio servi√ßo CUPS e tamb√©m precisa ser configurada da mesma maneira que um servidor de impress√£o, exceto por seu papel subordinado na organiza√ß√£o da impress√£o. </p><br><h3 id="ispravlenie-oshibki-obrascheniya-k-cups-cherez-loopback-po-imeni-hosta">  Corre√ß√£o do erro ao acessar o CUPS via loopback pelo nome do host </h3><br><p>  H√° um momento desagrad√°vel.  Se voc√™ digitar <strong>linux1</strong> em um dom√≠nio, configure o CUPS de acordo com estas instru√ß√µes, poder√° notar uma situa√ß√£o absurda quando acessar a interface WEB <strong>linux1</strong> de fora, mas n√£o poder√° fazer isso no pr√≥prio host!  E aplicativos gr√°ficos para impressoras de configura√ß√£o local, como o aplicativo <strong>system-config-printer</strong> no Linux Mint, se recusam a trabalhar.  Se voc√™ tentar se conectar ao seu pr√≥prio CUPS no endere√ßo <code>http://linux1:631/</code> haver√° uma mensagem "Proibido" ou "Solicita√ß√£o incorreta".  Esse √© um problema conhecido e n√£o realmente resolvido em muitos f√≥runs da Internet. </p><br><p>  Na maioria das instru√ß√µes sobre a introdu√ß√£o do Linux em um dom√≠nio, um dos pontos √© fazer com que o <em>arquivo / etc / hosts</em> seja algo como isto: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 127.0.1.1 linux1.example.com linux1 # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe02::2 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters</code> </pre> <br><p>  Por alguma raz√£o, o CUPS n√£o pode associar chamadas atrav√©s do 127.0.1.1, ou seja, atrav√©s da interface Loopback, com o nome do host. </p><br><p>  Este erro foi corrigido de duas maneiras.  Se seus endere√ßos IP de rede forem est√°ticos, no <em>arquivo / etc / hosts,</em> corrija 127.0.1.1 para o endere√ßo IP da interface de rede externa da m√°quina cliente, por exemplo: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 192.168.1.50 linux1.example.com linux1</code> </pre> <br><p>  Ou, como voc√™ insere o Linux no dom√≠nio, ele pressup√µe que o DHCP e o servidor DNS do Active Directory estejam em execu√ß√£o na sua rede.  Nesse caso, basta comentar esta linha: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost # 127.0.1.1 linux1.example.com linux1</code> </pre> <br><p>  Diferen√ßas no desempenho ou problemas dessa a√ß√£o ainda n√£o foram detectadas. </p><br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups-u-klientskih-mashin-linux">  Definindo endere√ßos de escuta de conex√£o CUPS em m√°quinas cliente Linux </h3><br><p>  Vamos ao <strong>linux1 de</strong> qualquer maneira conveniente.  Editando o arquivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cupsd.conf</code> </pre> <br><p>  Encontramos, adicionamos ou modificamos linhas: </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru #      /usr/share/cups/locale ServerAlias linux1.example.com linux1 [CNAME    DNS ]  ServerAlias * #      Listen /run/cups/cups.sock Listen localhost:631 #  localhost Listen 10.10.100.50:631 # IP   . Listen cupsserver:631 #   .    IP  ,    Listen linux1:631 #  Port 631 #       Listen /run/cups/cups.sock Browsing off # .       DefaultAuthType Basic #  .     Kerberos,     </code> </pre> <br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups">  Definindo endere√ßos de escuta da conex√£o CUPS </h3><br><p>  No bloco anterior, configuramos a capacidade de conectar-se ao CUPS.  Agora, vamos definir as permiss√µes para impress√£o, bem como as p√°ginas administrativas do servi√ßo CUPS no host <strong>linux1</strong> .  Reabrimos, se fechado, o arquivo <em>/etc/cups/cupsd.conf</em> e continuamos editando os blocos <strong>&lt;Localiza√ß√£o /&gt;</strong> , <strong>&lt;Localiza√ß√£o / admin&gt;</strong> , <strong>&lt;Localiza√ß√£o / admin / conf&gt;</strong> , <strong>&lt;Localiza√ß√£o / admin / log&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny #    "  ,  " Allow from localhost #    linux1 Allow from linux1 #     .      Allow from cupsserver #  CUPS    DNS,  . ,     Allow from cupsserver.example.com # FQDN  Allow from 10.10.100.50 #     IP  **cupsserver** &lt;/Location&gt; # Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt;</code> </pre> <br><h3 id="nastroyka-razdachi-i-polucheniya-shirokoveschatelnoy-rassylki-setevyh-printerov">  Configurando a distribui√ß√£o e transmiss√£o de impressoras de rede </h3><br><p>  Mesmo em uma m√°quina cliente Linux, neste caso, <strong><em>linux1</em></strong> , voc√™ precisa editar o arquivo <em>/etc/cups/cups-browsed.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cups-browsed.conf BrowseRemoteProtocols none #  none      . BrowseLocalProtocols cups #     . DNSSD   ,    cupsd.conf BrowseOrder Allow,Deny #   Order  cupsd.conf -   ,        BrowseAllow 10.10.100.50 # IP  BrowseAllow cupsserver #    BrowseAllow cupsserver.example.com #    </code> </pre> <br><h3 id="nastroyka-administrativnogo-dostupa">  Configurar acesso administrativo </h3><br><p>  Mais algumas palavras sobre o acesso administrativo, tanto na interface do CUPS WEB em um servidor de impress√£o quanto em qualquer m√°quina cliente Linux.  Mesmo se voc√™ tiver de 30 a 50 computadores, precisar√° unificar a autoriza√ß√£o no CUPS e n√£o tenha em mente ou onde quer que as senhas de cada m√°quina.  E isso √© importante em todas as m√°quinas Linux, porque para adicionar uma impressora ao servidor, voc√™ deve primeiro instal√°-la localmente.  Eu vejo v√°rias maneiras. </p><br><p>  O primeiro √© criar um usu√°rio <strong>printeradmin</strong> em cada sistema Linux (por exemplo) e adicionar <strong>lpadmin</strong> ao grupo: </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo usermod -a -G lpamin printeradmin</code> </pre> <br><p>  e efetue login em <code>http://_:631/admin</code> usando suas credenciais. </p><br><p>  A segunda op√ß√£o √© quase id√™ntica e sugere a cria√ß√£o de um grupo no sistema, por exemplo, <strong>printersadmins</strong> , adicionando o administrador do CUPS necess√°rio ( <strong>printeradmin</strong> , <strong>user</strong> ) l√°: </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo groupadd printersadmins user@linux1:~$ sudo usermod -a -G printersadmins printeradmin user@linux1:~$ sudo usermod -a -G printersadmins user</code> </pre> <br><p>  Ent√£o voc√™ precisa encontrar a linha no arquivo <em>/etc/cups/cups-files.conf</em> </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  e adicione um ou mais grupos de usu√°rios com o direito de administrar o CUPS por um espa√ßo. </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin printersadmins somegroup</code> </pre> <br><p>  E, finalmente, a terceira op√ß√£o.  Torne os administradores do servidor de impress√£o e do CUPS das m√°quinas clientes um grupo de usu√°rios.  Para fazer isso, o servidor de impress√£o e as m√°quinas clientes Linux devem ser ingressadas no dom√≠nio do AD.  Existem v√°rios m√©todos para conectar o Linux ao dom√≠nio do Windows, mas, at√© onde eu sei, os principais s√£o os de conex√£o usando o winbind e o SSSD (realmd).  Uma descri√ß√£o desses m√©todos n√£o est√° inclu√≠da no artigo, portanto, focarei apenas nos pontos relacionados especificamente ao CUPS. </p><br><h3 id="nastroyka-ispolzovaniya-domennyh-grupp-polzovateley-dlya-administrirovaniya-cups">  Configurando o uso de grupos de usu√°rios do dom√≠nio para administra√ß√£o do CUPS </h3><br><p>  Cada m√©todo para ingressar em um sistema de autoriza√ß√£o central no Linux cria um arquivo "pipe" especial atrav√©s do qual os aplicativos podem ver a lista de usu√°rios do dom√≠nio.  Para que o CUPS possa fazer isso, √© necess√°rio permitir que ele use pipe no AppArmor para autenticar usu√°rios.  O AppArmor √© um m√≥dulo de controle de acesso de seguran√ßa do Linux.  Limita certos programas ao conjunto de arquivos listados em suas pol√≠ticas.  Para adicionar ao CUPS o direito de usar usu√°rios e grupos de dom√≠nio por meio do winbindd, adicione a seguinte linha ao arquivo <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> : </p><br><pre> <code class="plaintext hljs">/var/lib/samba/winbindd_privileged/pipe rw</code> </pre> <br><p>  Se o Linux for inserido no dom√≠nio por meio do SSSD, voc√™ dever√° especificar a localiza√ß√£o do seu pipe em <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> , adicionando a linha: </p><br><pre> <code class="plaintext hljs">/var/lib/sss/pipes/private/pam rw</code> </pre> <br><p>  Al√©m disso, no caso do SSSD, isso permite a autentica√ß√£o (para descobrir quem est√° efetuando login), mas para se autenticar (descobrir se o usu√°rio tem o direito de gerenciar o CUPS), voc√™ tamb√©m deve adicionar a linha ao arquivo de configura√ß√£o do SSSD <em>/etc/sssd/sssd.conf</em> : </p><br><pre> <code class="plaintext hljs">ad_gpo_map_interactive = +cups</code> </pre> <br><p>  Isso, condicionalmente, d√° ao CUPS o direito de "olhar" para o SSSD. </p><br><p>  Al√©m disso, devido ao fato de o CUPS agora depender do servi√ßo SSSD, voc√™ precisa informar ao CUPS que ele deve iniciar ap√≥s o SSSD; caso contr√°rio, ele cair√° quando estiver ligado e precisar√° ser ativado manualmente a cada vez. </p><br><p>  Adicione instru√ß√µes do CUPS para inicializar ap√≥s o SSSD.  Edite o <em>arquivo de</em> servi√ßo <em>cups.service</em> no caminho <em>/ lib / systemd / system /</em> , adicionando a instru√ß√£o <strong>After</strong> √† se√ß√£o <strong>[Unit]</strong> : </p><br><pre> <code class="plaintext hljs">[Unit] Description=CUPS Scheduler Documentation=man:cupsd(8) After=sssd.service</code> </pre> <br><p>  Assim, o CUPS √© configurado para autoriza√ß√£o b√°sica por meio de um dom√≠nio, ou seja, autoriza√ß√£o digitando o login e a senha de um usu√°rio do dom√≠nio com privil√©gio de administra√ß√£o do CUPS. </p><br><p>  A autoriza√ß√£o pode ser configurada de outra maneira, mas o princ√≠pio (arquivo de pipe) √© geralmente universal e existe a chance de configur√°-lo para LDAP, FreeIPA e outros servi√ßos de diret√≥rio por analogia. </p><br><h3 id="ustanovka-printera-v-linux">  Instalando uma impressora no Linux </h3><br><p>  A instala√ß√£o de uma impressora no Linux geralmente √© uma tarefa espec√≠fica, diferente para diferentes marcas e at√© modelos.  Portanto, n√£o vejo raz√£o para descrever a instala√ß√£o da impressora e suponho que o host <strong>linux1 tenha</strong> uma impressora Kyocera-1024FP com o nome <strong>Kyocera-1024FP instalado</strong> e a p√°gina da impressora esteja dispon√≠vel em <code>http://linux1:631/printers/Kyocera-1024FP</code> . </p><br><p>  Agora que o servidor Linux e as m√°quinas clientes est√£o configuradas, as impressoras est√£o conectadas a algumas delas, e tamb√©m existem m√°quinas Windows com as quais imprimir, e todo esse sistema deve ser est√°vel, mesmo que seja necess√°rio substituir a impressora em um dos computadores. , isso n√£o implica a reconfigura√ß√£o de uma boa metade de todos os PCs, se n√£o todos.  Al√©m disso, voc√™ precisa do menor n√∫mero poss√≠vel de problemas com os drivers.  E √© bem poss√≠vel. </p><br><h3 id="gruppy-printerov-classes">  Grupos de impressoras (classes) </h3><br><p>     <strong>Canon-MF4400</strong> c  <strong>windows1</strong>   LPD.            <code>http://cupsserver:631/printers/Canon-MF4400</code> .          <strong>cupsserver</strong> <code>http://cupsserver:631/admin</code> .      " " [Add Class].   .      "", "", "",       .            .  <strong>Canon-MF4400</strong>    ,    "" ,  <strong>printer-windows1</strong> , ""  ""   ,   " ". </p><br><p>      <strong>printer-windows1</strong>   <strong>Canon-MF4400</strong>  .           <strong>Canon-MF4400</strong>       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> . </p><br><p>         <strong>linux1</strong>  Kyocera-1024FP.      HTTP.    "   (http)" [Internet Printing Protocol (http)],      "Generic",  "IPP Everywhere".    ,        <strong>linux1</strong> ‚Äî <strong>Kyocera-1024FP</strong> .        <code>http://cupsserver:631/printers/Kyocera-1024FP</code> .    <strong>printer-windows1</strong>   <strong>printer-linux1</strong> c  <strong>Kyocera-1024FP</strong>  .    <code>http://cupsserver:631/classes/printer-linux1</code> . </p><br><p>    <strong>Kyocera-1024FP</strong>   <strong>linux1</strong>   <strong>cupsserver</strong>   <strong>windows1</strong>   Windows 8      (!)  .        "    ".  <strong></strong>    <code>http://_c:631/classes/_</code> .     ‚Äî <code>http://cupsserver:631/classes/printer-linux1</code> .        "Generic",  ‚Äî "MS Publisher Imagesetter".   ,        <code>printer-linux1  http://cupsserver:631</code> .             ,          Kyocera-1024FP. </p><br><p>    <strong>Canon-MF4400</strong>   <strong>windows1</strong>   <strong>cupsserver</strong>   <strong>linux1</strong>   Linux      (!)  .         ,   <strong>Kyocera-1024FP</strong>   <strong>cupsserver</strong> .       <strong>linux1</strong>    "   (http)",     ( <strong>Canon-MF4400</strong> )       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> .        "Generic",  ‚Äî "IPP Everywhere".    ,       ‚Äî <strong>printer-windows1</strong> .     <strong>linux1</strong>   <code>http://linux1:631/printers/printer-windows1</code> ,        . </p><br><p>      ,        ,   ,     ,       ,         .      ‚Äî     ,   ,     ,  ,       .        ,          .  "IPP Everywhere"  "MS Publisher Imagesetter"     ,   ..,          . </p><br><h3 id="zaklyuchenie">  Conclus√£o </h3><br><p>   ,   - ,       .  ,   ,    ,      ,           . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443094/">https://habr.com/ru/post/pt443094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443082/index.html">Por que voc√™ n√£o deve olhar para os outros ao aprender um idioma</a></li>
<li><a href="../pt443084/index.html">O Facebook se recusa a transferir servidores para pa√≠ses com viola√ß√£o da liberdade de express√£o e introduz a criptografia de ponta a ponta</a></li>
<li><a href="../pt443086/index.html">Food Design Digest, fevereiro de 2019</a></li>
<li><a href="../pt443090/index.html">Excurs√£o √† central nuclear de Rostov</a></li>
<li><a href="../pt443092/index.html">O novo sensor ultrass√¥nico permite "ouvir" bact√©rias - como funciona</a></li>
<li><a href="../pt443096/index.html">O designer n√£o √© jornalista. Como conduzir uma entrevista com um usu√°rio</a></li>
<li><a href="../pt443098/index.html">Os dados s√£o gravados no disco usando √≠m√£s e lasers</a></li>
<li><a href="../pt443100/index.html">Contando bugs na calculadora do Windows</a></li>
<li><a href="../pt443102/index.html">Mudan√ßa comportamental como produto: Por que Marie Kondo est√° levantando uma rodada de US $ 40 milh√µes com a Sequoia Capital?</a></li>
<li><a href="../pt443104/index.html">Calcular express√µes simb√≥licas com n√∫meros triangulares difusos em python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>