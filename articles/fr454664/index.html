<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù§Ô∏è üöÆ üìú Jouer √† Tetris en AR üòØ ü•â üßë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il m'est venu √† l'esprit une petite id√©e √©trange que la maison pourrait √™tre une bonne plate-forme pour jouer √† Tetris. Non loin de moi, il n'y avait ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jouer √† Tetris en AR</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454664/">  Il m'est venu √† l'esprit une petite id√©e √©trange que la maison pourrait √™tre une bonne plate-forme pour jouer √† Tetris.  Non loin de moi, il n'y avait qu'un seul b√¢timent adapt√© √† cela.  Le r√©sultat peut √™tre vu dans la vid√©o: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eGaokauVQ2o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Le projet est mis en ≈ìuvre √† un niveau assez bas, sans utiliser de solution toute faite. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source</a> <br><a name="habracut"></a><br>  Le plus souvent, ils utilisent 2 options pour impl√©menter la r√©alit√© augment√©e: <br><br><ul><li>  sans marqueur, c.-√†-d.  la position de la cam√©ra est d√©termin√©e par le mouvement des points cl√©s de son flux vid√©o; </li><li>  l'image comme marqueur par rapport auquel la position de la cam√©ra est. </li></ul><br>  Ces impl√©mentations ne n√©cessitent pas de pr√©paration sp√©ciale ni de conditions particuli√®res. <br><br>  Il existe une autre option d'impl√©mentation - pour reconna√Ætre un objet sp√©cifique et l'utiliser comme marqueur.  Cela n√©cessite au moins sa pr√©sence, mais permet de le contr√¥ler visuellement.  L'une des m√©thodes d'une telle reconnaissance est la d√©tection d'un objet par les bords.  Il a des limites - l'objet marqueur doit avoir des bords clairement d√©finis, c'est-√†-dire  l'objet doit tr√®s probablement √™tre solide. <br><br>  Ou les bords doivent √™tre clairement d√©limit√©s, comme l'√©clairage de ce b√¢timent: <br><br><img src="https://habrastorage.org/webt/51/y8/nt/51y8ntbjtnm_hdy6iy5v2pmwgsu.jpeg"><br><br>  On peut voir que le r√©tro-√©clairage peut facilement √™tre s√©par√© dans l'image et utilis√© pour la d√©tection. <br><br><h2>  Impl√©mentation </h2><br>  Le Qt.  Ce framework vous permet de travailler sur diff√©rentes plateformes et en m√™me temps en C ++.  Puisque les performances sont importantes pour nous, les pros semblent √™tre un choix √©vident. <br><br>  Bien que Qt ne fonctionnait pas tr√®s bien avec Android (lancement long, le d√©bogage √©tait d√©sactiv√©), mais tout cela √©tait nivel√© par la possibilit√© de d√©boguer l'algorithme sur le bureau. <br><br>  Des graphiques en trois dimensions ont √©t√© visualis√©s sur l'OpenGL brut int√©gr√© dans Qt. <br><br>  Le travail avec la cam√©ra a √©t√© effectu√© via Qt.  Une vid√©o a √©t√© enregistr√©e pour le d√©bogage, et c'√©tait assez pratique pour remplacer le flux vid√©o de la cam√©ra par un flux vid√©o √† partir d'un fichier. <br><br>  La sortie a √©t√© effectu√©e via des outils qml.  Se faire des amis qml et OpenGL n'a pas √©t√© sans probl√®me, mais nous ne nous attarderons pas l√†-dessus. <br><br>  Pour le traitement d'image, la biblioth√®que OpenCV est connect√©e. <br><br><h4>  Algorithme de suivi </h4><br>  Passons maintenant √† la partie la plus int√©ressante - l'algorithme de suivi d'un objet le long de ses bords. <br>  Et commencez par mettre en surbrillance les bords de l'image.  Tous les bords dans notre cas ont la forme de lignes droites, donc la premi√®re pens√©e qui vient √† l'esprit est d'utiliser un d√©tecteur de ligne.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les transform√©es de Hough</a> pourraient √™tre utilis√©es comme d√©tecteur de ligne.  Cependant, cette m√©thode ne me semble pas tr√®s vraie, car la transform√©e de Hough est assez ch√®re, et ce d√©tecteur n'est pas tr√®s fiable (c'est subjectif, peut-√™tre que tout d√©pend de la t√¢che). <br>  Au lieu de cela, allons d'une mani√®re diff√©rente et plus g√©n√©rale.  Nous ne prendrons pas en compte le fait que nos lignes sont droites, mais nous travaillerons simplement sur une image binaire.  La pr√©sence de bords sera encod√©e dans l'image binaire.  C'est-√†-dire  un pixel avec une valeur de z√©ro signifie qu'il y a un bord √† cet endroit, la valeur du pixel est sup√©rieure √† z√©ro - il n'y a pas de bord.  Une telle image peut √™tre obtenue √† l'aide d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un d√©tecteur de limites Canny</a> ou √† l'aide d'une simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transformation de seuil</a> .  Ces algorithmes peuvent √™tre trouv√©s dans OpenCV. <br><br>  Toujours dans OpenCV, il y a une autre fonction qui nous est utile maintenant - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">distanceTransform</a> , qui prend une image binaire √† l'entr√©e et donne une image √† la sortie, dans les pixels dont la distance au pixel z√©ro le plus proche est cod√©e. <br><br>  Supposons maintenant que nous ayons d√©j√† la premi√®re bonne approximation de l'emplacement de notre mod√®le.  Ensuite, nous d√©crivons la fonction d'erreur, qui d√©crit dans quelle mesure les bords de notre approximation ne co√Øncident pas avec les bords de l'image r√©sultante.  En utilisant l'image de distanceTransform, nous pouvons d√©j√† le faire.  Et puis nous ex√©cutons l'algorithme d'optimisation de fonction, ne modifiant que notre approximation de la position de l'objet dans l'espace.  Par cons√©quent, notre approximation devrait d√©crire assez pr√©cis√©ment la position r√©elle de l'objet. <br>  En cons√©quence, l'algorithme peut √™tre divis√© en deux √©tapes: <br><br><ol><li>  Pr√©traitement d'image - binarisation, filtrage et utilisation de la fonction distanceTransfrom. </li><li>  Suivi - optimisation de la fonction d'erreur. </li></ol><br><h4>  Pr√©traitement d'image </h4><br>  √Ä ce stade, vous devez mettre en √©vidence les bords de l'image.  Vous pouvez utiliser le d√©tecteur de limites Canny, mais dans notre cas, la conversion de seuil habituelle ou sa version adaptative fonctionne mieux (dans OpenCV, ce sont des fonctions de seuil ou adaptiveThreshold).  Il est clair qu'il y aura du bruit sur une telle image, un filtrage est donc n√©cessaire.  Faisons-le comme suit - s√©lectionnez le contour √† l'aide de la fonction OpenCV <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">findCountours</a> et supprimez les segments trop petits ou pas assez comme une ligne. <br><br>  Le r√©sultat du traitement peut √™tre vu dans l'image: <br><br><img src="https://habrastorage.org/webt/ef/g9/ts/efg9tspnpbvzqb1gn2o0cricah8.jpeg"><br><br>  Constamment: l'image d'origine -&gt; apr√®s la transformation du seuil -&gt; apr√®s le filtrage. <br><br>  Cette image nous dit d√©j√† assez clairement o√π il y a le bord droit et o√π non.  Apr√®s cela, nous utilisons la fonction distanceTransform, et en cons√©quence, nous aurons des informations sur la distance de chaque point par rapport au bord.  L'image r√©sultante est not√©e comme <img src="https://habrastorage.org/webt/qt/cr/xz/qtcrxzl1ow1zbp0xoducghnxhms.png">  . <br><br>  Voici √† quoi cela ressemble s'il est normalis√© et visualis√©: <br><br><img src="https://habrastorage.org/webt/ho/ll/vm/hollvmy8tp4ozcc424szu5pjjuc.jpeg"><br><br>  Ensuite, nous aurons besoin de quelques outils math√©matiques. <br><br><h5>  Algorithme d'optimisation de fonction </h5><br>  L'optimisation des fonctions consiste √† trouver le minimum d'une fonction. <br><br>  Si nous avons affaire √† un syst√®me d'√©quations lin√©aire, alors trouver un minimum est assez simple.  Imaginez le syst√®me d'√©quations sous forme matricielle: <img src="https://habrastorage.org/webt/8o/ib/1o/8oib1oj6a6trr7kkhjozgiy3day.png">  , alors notre solution: <img src="https://habrastorage.org/webt/ly/rc/qu/lyrcqutfkhebqb6tqlrfix5d1ms.png">  .  Si nous avons un syst√®me d'√©quations surd√©termin√©, alors nous pouvons utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la m√©thode des moindres carr√©s</a> : <img src="https://habrastorage.org/webt/ll/4i/ok/ll4iok4um66gxr9zxre_lxlyylm.png">  . <br><br>  Si notre fonction est non lin√©aire, alors la t√¢che devient plus compliqu√©e.  Pour trouver le minimum, vous pouvez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'algorithme de Gauss-Newton</a> .  L'algorithme fonctionne comme suit: <br><br><ol><li>  On suppose que nous avons d√©j√† une premi√®re approximation de la solution <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  que nous allons affiner it√©rativement. </li><li>  En utilisant l'expansion de Taylor, nous pouvons approximer notre fonction non lin√©aire lin√©aire au point d'approximation actuel.  Nous r√©solvons le syst√®me lin√©aire d'√©quations r√©sultant par la m√©thode des moindres carr√©s, obtenant <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  .  Par cons√©quent, la solution r√©sultante ne sera pas une solution, mais elle sera plus proche que l'approximation actuelle. </li><li>  Remplacer l'approximation actuelle <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  a re√ßu la d√©cision <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  et passez √† l'√©tape 2. Donc, r√©p√©tez jusqu'√† ce que la diff√©rence entre <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  et <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  ne sera pas inf√©rieure √† une certaine valeur. </li></ol><br>  Analysons plus en d√©tail l'algorithme. <br><br>  Soit <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  - fonction de travail, <img src="https://habrastorage.org/webt/i5/uo/zz/i5uozzwwbb4_f-ivitxfs2qferi.png">  - un vecteur de valeurs de fonction pr√©c√©demment connu.  Avec la solution parfaite √† l'√©quation <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  l'√©nonc√© suivant est vrai <img src="https://habrastorage.org/webt/m-/dk/pv/m-dkpv_tnys9clufhps155qfxkq.png">  .  Mais nous n'avons que son approximation <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  .  Le vecteur d'erreur de cette approximation est alors not√©: <img src="https://habrastorage.org/webt/_v/d4/n1/_vd4n1yd6irh6smzqcnpswmmbjm.png">  .  Une erreur g√©n√©rale de la fonction sera: <img src="https://habrastorage.org/webt/8d/lf/me/8dlfmeklxb1jvlffcyk8w0vb478.png">  .  Maintenant, trouver de tels <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  √† quel <img src="https://habrastorage.org/webt/xl/um/pw/xlumpww55az0itxqrtigh2qofqg.png">  atteindra un minimum, nous obtiendrons une meilleure approximation de la solution <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  . <br>  √Ä partir de l'approche <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  nous allons l'approximer it√©rativement, en obtenant √† chaque it√©ration <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Pour ce faire, nous avons besoin de chaque it√©ration pour calculer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la matrice de Jacobi</a> pour la fonction <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  pour l'approximation actuelle, constitu√©e de d√©riv√©es de notre fonction: <br><img src="https://habrastorage.org/webt/m1/g0/g-/m1g0g-jmv04dlsbyoivbvjbwpwi.png"><br>  Et l'approximation suivante est donn√©e comme suit: <img src="https://habrastorage.org/webt/lm/xc/y4/lmxcy4rjlhtxgwz_lb8kpi1cpys.png">  . <br>  Souvent, les t√¢ches sont construites de telle mani√®re que nous avons un grand nombre de donn√©es ind√©pendantes les unes des autres (uniquement √† partir des valeurs <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  )  En cons√©quence, la matrice g√©n√©rale de Jacobi est tr√®s clairsem√©e.  Il existe un moyen d'optimiser les calculs. <br>  Supposons qu'une fonction commune soit calcul√©e √† partir d'un ensemble de points.  A partir du <i>ji√®me</i> point, nous obtenons <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  .  Au lieu de calculer la matrice de Jacobi <img src="https://habrastorage.org/webt/fu/vl/ui/fuvluirwbxatvxammyfzrbkxwug.png">  pour la fonction enti√®re, nous calculons la matrice de Jacobi sp√©cifiquement pour <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  et le d√©noter comme: <img src="https://habrastorage.org/webt/zf/al/h0/zfalh0ntw3nupwu56dhc7u0fzn0.png">  .  Ensuite, l'approximation suivante sera donn√©e comme suit: <img src="https://habrastorage.org/webt/hl/2k/d6/hl2kd6neuqqtrclxyf6efubd8by.png">  .  De plus, cette modification vous permet de parall√©liser les calculs. <br>  Il peut arriver que la valeur suivante <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  donnera une plus grosse erreur que <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Pour r√©soudre ce probl√®me, vous pouvez utiliser une modification de l'algorithme - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'algorithme de Levenberg-Marquardt</a> .  Ajouter de la valeur <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  dans notre formule: <img src="https://habrastorage.org/webt/d-/jv/hi/d-jvhiklwzbaxqihirj97fnyvg4.png">  o√π <img src="https://habrastorage.org/webt/hp/qi/1y/hpqi1yohaku8yblniy_qjap0ghe.png">  Est une matrice unitaire.  Valeur <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  s√©lectionn√©s comme suit: <br><ul><li>  tout d'abord, il a une valeur plut√¥t faible (telle que l'algorithme converge); </li><li>  alors si une erreur pour <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  plus que <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  , puis augmentez la valeur <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  et essayez de calculer l'erreur pour <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  encore. </li></ul><br>  Plus la fonction est non lin√©aire <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  plus la valeur doit √™tre √©lev√©e <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  .  Cependant, plus la valeur est √©lev√©e <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  , plus l'algorithme converge lentement. <br><br>  Nous compl√©tons l'algorithme lorsque <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  diff√©rent de <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  assez petit et prendre <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  comme solution. <br><br>  L'algorithme est assez universel et peut √™tre utilis√© pour une vari√©t√© de t√¢ches. <br><br><h5>  Mod√®le de suivi math√©matique </h5><br>  Puisque nous avons affaire √† des coordonn√©es dans l'espace, il est clair que nous devons √™tre capables de manipuler ces coordonn√©es.  Supposons que nous ayons un ensemble de points <img src="https://habrastorage.org/webt/pi/mv/hb/pimvhb7w8_hegkijjpdddui99ts.png">  .  Et nous devons les faire pivoter autour du point avec des coordonn√©es nulles.  La fa√ßon la plus simple serait probablement d'utiliser la matrice de rotation <i>R</i> , qui d√©crit la rotation n√©cessaire: <img src="https://habrastorage.org/webt/dn/qr/lf/dnqrlfvvkeyngvdbbqy8uwnbgyk.png">  .  Si nous devons d√©placer les points, il suffit d'ajouter le vecteur <i>t</i> souhait√©: <img src="https://habrastorage.org/webt/ds/qc/jc/dsqcjcik5lk13aheb3_q78x8x6s.png">  . <br>  Ainsi, vous pouvez modifier arbitrairement la position d'un objet dans l'espace.  Il s'av√®re que les coordonn√©es de l'objet sont d√©termin√©es par la matrice tridimensionnelle <i>R</i> et le vecteur tridimensionnel <i>t</i> , c'est-√†-dire  12 param√®tres.  De plus, ces param√®tres ne sont pas ind√©pendants les uns des autres, les composants de la matrice de rotation sont interconnect√©s par certaines conditions.  Par cons√©quent, du point de vue de l'utilisation de ces fonctions dans l'optimisation, ces param√®tres ne sont pas la meilleure solution.  Il y a plus de param√®tres que de degr√©s de libert√©, il y a une relation entre eux.  Il existe une autre forme de rotation - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la formule de rotation de Rodrigue</a> .  Cette rotation est sp√©cifi√©e par trois param√®tres, formant un vecteur tridimensionnel. <br><br>  Le vecteur normalis√© est l'axe de rotation, et la longueur de ce vecteur est l'angle de rotation autour de cet axe. <br><br>  Nous d√©finissons la fonction de rotation du vecteur <i>v</i> : <img src="https://habrastorage.org/webt/kl/hc/cz/klhccza_fs2fv8gmvh3uovdnzvw.png">  en utilisant les param√®tres <i>r</i> de la formule Rodrigue.  Nous obtenons la formule suivante √† partir de cela: <img src="https://habrastorage.org/webt/_s/sg/p1/_ssgp1pn5q49yx32g-zkluqkn8u.png">  . <br>  Et √† la fin, nous pouvons d√©finir les coordonn√©es de la position de l'objet avec un vecteur √† 6 dimensions: <img src="https://habrastorage.org/webt/mb/mo/dl/mbmodlujklivexjnp7zo0eyup_o.png"><br>  Nous obtenons la formule suivante: <img src="https://habrastorage.org/webt/ih/ls/hx/ihlshxts9oar5kcqw4l0a0ilj1w.png">  . <br><br><h5>  Mod√®le de cam√©ra st√©nop√© </h5><br>  Nous d√©crivons maintenant un mod√®le math√©matique simple de la cam√©ra utilis√©e dans le projet: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;vec&amp;#xA0;{p}&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;p_x&amp;#xA0;&amp;amp;&amp;#xA0;p_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T&amp;#xA0;=&amp;#xA0;cam&amp;#xA0;(\&amp;#xA0;vec&amp;#xA0;{v})&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;f_x&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_x}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_x&amp;#xA0;&amp;amp;&amp;#xA0;f_y&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_y}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ vec {p} = \ begin {pmatrix} p_x &amp; p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x &amp; f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T</font></font></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ vec {p} = \ begin {pmatrix} p_x &amp; p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x &amp; f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T</font></font></mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ vec {p} = \ begin {pmatrix} p_x & p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x & f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T </script></p>  o√π <img src="https://habrastorage.org/webt/4y/1n/eo/4y1neonrkqigjzoumocsltdvi-e.png">  - distance focale en pixels; <img src="https://habrastorage.org/webt/en/zb/z6/enzbz61iibgzcsxm0jtasbuek28.png">  - Le centre optique est √©galement en pixels.  Ce sont des param√®tres de cam√©ra individuels, appel√©s param√®tres intrins√®ques de la cam√©ra.  Typiquement, ces param√®tres sont connus √† l'avance.  Dans ce projet, ces param√®tres sont s√©lectionn√©s √† l'≈ìil nu. <br><br>  Ce mod√®le ne prend pas en compte la distorsion de l'objectif des cam√©ras ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">distorsion</a> ).  Supposons qu'ils ne le soient pas. <br><br>  Avec ce mod√®le, nous obtenons une projection centrale, dont tous les points tendent plus vers le centre optique, plus ils sont √©loign√©s de la cam√©ra.  On obtient ainsi l'effet d'un chemin de fer r√©tr√©cissant: <br><br><img src="https://habrastorage.org/webt/3c/a2/gn/3ca2gngkegajdjw25-gm6zgy3_u.jpeg"><br><br>  Dans l'espace, la cam√©ra est align√©e sur l'axe <i>z</i> , le plan image est parall√®le au plan <i>xy</i> .  Nous compl√©tons notre mod√®le avec la capacit√© de se d√©placer dans l'espace: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi></mrow><mi>j</mi></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>m</mi><mo stretchy=&quot;false&quot;>(</mo><mi>r</mi><mi>o</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>r</mi></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>v</mi></mrow><mi>j</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.654ex" height="3.021ex" viewBox="0 -832 17934.4 1300.8" role="img" focusable="false" style="vertical-align: -1.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-6A" x="712" y="-326"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-3D" x="2808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-63" x="3864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-61" x="4298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-6D" x="4827" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-28" x="5706" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-72" x="6095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-6F" x="6547" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-74" x="7032" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-28" x="7394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-76" x="8033" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-65" x="8519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-63" x="8985" y="0"></use><g transform="translate(9419,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-72" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-2C" x="10410" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-76" x="11106" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-65" x="11591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-63" x="12058" y="0"></use><g transform="translate(12491,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-6A" x="686" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-29" x="13368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-2B" x="13980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-76" x="15231" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-65" x="15716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-63" x="16183" y="0"></use><g transform="translate(16616,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMATHI-74" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhi4RF1_ic3LvQ_kh4p8klTBgWiqXw#MJMAIN-29" x="17544" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><msub><mrow class="MJX-TeXAtom-ORD"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></mi></mrow><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j</font></font></mi></msub><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></mi><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><msub><mrow class="MJX-TeXAtom-ORD"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></mi></mrow><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi></msub><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></mo><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><msub><mrow class="MJX-TeXAtom-ORD"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></mi></mrow><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j</font></font></mi></msub><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></mo><mtext>&nbsp;</mtext><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><msub><mrow class="MJX-TeXAtom-ORD"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></mi></mrow><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi></msub><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \ vec {p} _j = cam (rot (\ vec {x} _r, \ vec {v} _j) + \ vec {x} _t) </script></p><br>  Ainsi, nous avons obtenu un mod√®le avec lequel nous pouvons simuler sous forme alg√©brique la projection de points du monde ext√©rieur sur l'image de la cam√©ra (des coordonn√©es du monde √† l'√©cran).  Pour nous, les param√®tres de la position relative de la cam√©ra dans l'espace restent inconnus dans ce mod√®le. <img src="https://habrastorage.org/webt/ln/ib/-f/lnib-foisc9iu_aqy0wernf1xgu.png">  .  Ces param√®tres sont appel√©s param√®tres extrins√®ques de la cam√©ra. <br><br><h5>  Suivi </h5><br>  D√©j√† impl√©ment√© sans outils OpenCV.  Tout d'abord, nous devons obtenir la fonction d'erreur pour notre solution approximative, qui a √©t√© d√©crite ci-dessus.  Et nous √©crirons son calcul par √©tapes: <br><br><ol><li>  Nous s√©lectionnons les bords du mod√®le de suivi qui sont visibles en fonction des param√®tres de l'approximation actuelle. </li><li>  Nous transformons l'ensemble d'ar√™tes s√©lectionn√© en un ensemble fixe de points, pour simplifier les calculs.  Il est possible, par exemple, de prendre le ni√®me nombre de points de chaque bord, ou (une option plus correcte) de choisir une telle quantit√© pour qu'il y ait une distance fixe en pixels entre les points.  Nous les appellerons points de contr√¥le (dans le projet: controlPoint - points de contr√¥le et controlPixelDistance - la m√™me distance fixe en pixels). </li><li>  Nous projetons des points de contr√¥le sur l'image.  Gr√¢ce √† <i>distanceImage,</i> nous pouvons obtenir la distance de la projection du point de contr√¥le au bord de l'image.  Dans le cas id√©al, tous les points de contr√¥le doivent reposer strictement sur les bords de l'image, c'est-√†-dire  la distance √† la c√¥te doit √™tre nulle.  Sur cette base, nous obtenons une erreur pour un point de contr√¥le sp√©cifique: <img src="https://habrastorage.org/webt/aj/yl/of/ajylofx-nqzxqkzyaaxwcczmd6a.png">  . </li><li>  Nous obtenons la fonction d'erreur suivante: <img src="https://habrastorage.org/webt/o8/u-/8w/o8u-8wwvnt2jhgyulfun8kyzh6k.png"></li></ol><br>  Reste maintenant √† trouver un minimum de <i>E.</i>  Pour ce faire, nous utilisons l'algorithme de Levenberg-Marquardt d√©crit ci-dessus.  Comme nous le savons d√©j√†, l'algorithme n√©cessite le calcul de la matrice de Jacobi, c'est-√†-dire  fonctions d√©riv√©es.  Vous pouvez utiliser la recherche num√©rique des d√©riv√©s.  Vous pouvez √©galement utiliser des solutions pr√™tes √† l'emploi pour cet algorithme.  Cependant, dans ce projet, tout a √©t√© √©crit manuellement, donc je vais d√©crire la conclusion compl√®te de la solution enti√®re. <br><br>  Pour chaque point de contr√¥le, nous obtenons une √©quation ind√©pendante des autres points.  Il a d√©j√† √©t√© d√©crit ci-dessus que dans ce cas, il est possible de consid√©rer ces √©quations ind√©pendamment les unes des autres, en calculant la matrice de Jacobi sp√©cifiquement pour chacune.  Nous allons l'analyser dans l'ordre, en utilisant les r√®gles de diff√©renciation d'une fonction complexe: <br><br><img src="https://habrastorage.org/webt/qf/lm/3t/qflm3tr6vrmyirsufolpiwmlte4.png"><br><br>  Nous d√©notons <img src="https://habrastorage.org/webt/_b/_i/i1/_b_ii1eklzapugxeahtbl7wwuky.png">  alors <img src="https://habrastorage.org/webt/tr/pz/a-/trpza-t1j_sr_otvetkquuvnac8.png"><br><br><img src="https://habrastorage.org/webt/en/k3/2q/enk32qx_j0zgvqzujalzydlfxyi.png"><br><br>  D'ici: <br><br><img src="https://habrastorage.org/webt/ld/nh/s1/ldnhs1vypzpsx_mxlu6wjat4qtm.png"><br><br>  De plus, nous d√©signons <img src="https://habrastorage.org/webt/dl/2z/q0/dl2zq0jren9jpbmbpoaexelsrhw.png">  et <img src="https://habrastorage.org/webt/gb/kc/ps/gbkcpsry9q7nmsdz2kqpq-6br6y.png">  puis: <br><img src="https://habrastorage.org/webt/et/_j/ez/et_jez8fzupc2jtpk3bhteevl7y.png"><br><br>  Les d√©riv√©es de <i>distanceImage</i> sont num√©riques.  Et pour calculer des vecteurs <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  et <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  vous devrez trouver des d√©riv√©s selon la formule de rotation de Rodrigue.  J'ai trouv√© jacobien par cette formule dans la publication <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Une formule compacte pour la d√©riv√©e d'une rotation 3D dans</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">coordonn√©es exponentielles ¬ªGuillermo Gallego, Anthony Yezzi</a> : <br><br><img src="https://habrastorage.org/webt/lb/rr/cr/lbrrcr3knmrvyjbessogjsvjyos.png">  , <br>  o√π <i>R</i> est la matrice de rotation obtenue par la formule de Rodrigue √† partir du vecteur de rotation <img src="https://habrastorage.org/webt/qz/bd/pe/qzbdpe7zjfanzdyip7acfhwgwvo.png">  ; <img src="https://habrastorage.org/webt/bn/9c/-b/bn9c-blmg7tsys7l83pbu-2upny.png">  - le point sur lequel nous tournons;  <i>I</i> est la matrice d'identit√©; <img src="https://habrastorage.org/webt/lq/im/g6/lqimg6wecrfth32alae6l435sxk.png">  .  Comme nous le voyons ici, nous avons une division par la longueur du vecteur de rotation, et si le vecteur est nul, alors la formule ne fonctionne plus.  Cela est probablement d√ª au fait qu'au niveau du vecteur z√©ro, l'axe de rotation n'est pas d√©fini.  Si le vecteur de rotation est tr√®s proche de z√©ro, alors nous utilisons cette formule: <img src="https://habrastorage.org/webt/sm/hk/dc/smhkdchm-zr63paet8-nm_jftwo.png">  . <br>  Reste √† peindre <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  et <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  (ici l'index <i>j est</i> omis): <br><br><img src="https://habrastorage.org/webt/nt/xz/lf/ntxzlffpi42xgp1imuodytk2bqc.png"><img src="https://habrastorage.org/webt/hx/nz/pb/hxnzpbadbgyhlb2doqetg7f4iea.png"><br>  Ainsi, nous avons obtenu la matrice de Jacobi pour le point dont nous avons besoin et pouvons l'utiliser pour l'algorithme d'optimisation d√©crit ci-dessus. <br><br>  Il y a plusieurs probl√®mes avec cet algorithme.  Tout d'abord, la pr√©cision.  En cons√©quence, la position globale de la cam√©ra saute l√©g√®rement d'une image √† l'autre.  Vous pouvez le r√©parer un peu.  Nous avons a priori des informations selon lesquelles la position de la cam√©ra ne peut pas changer radicalement d'une image √† l'autre.  Et nous pouvons r√©duire cette gigue en ajoutant des √©quations suppl√©mentaires √† la fonction. <br><br>  Il faut rappeler que le vecteur de d√©placement <i>t n'est</i> pas dans notre cas la coordonn√©e de la position globale de la cam√©ra.  La position globale est un point local avec des coordonn√©es nulles, il peut donc √™tre d√©riv√© comme suit: <br><br><img src="https://habrastorage.org/webt/ly/zk/bk/lyzkbkk1zig1yfqu2shk9ziogbc.png"><br><br>  Nous nous souvenons de la position de l'image pr√©c√©dente dans <i>prevGlobalPosition</i> .  Maintenant, la position pr√©c√©dente devrait √™tre proche de z√©ro, c'est-√†-dire  longueur du vecteur <img src="https://habrastorage.org/webt/hv/lb/ww/hvlbwwdmw-wcymqnyxvaosx75mc.png">  devrait √™tre assez petit.  C'est-√†-dire  outre les autres valeurs de divergences, le vecteur <i>d</i> doit √©galement √™tre minimis√©.  Pour d√©terminer le degr√© d'influence de cette modification, nous introduisons la valeur <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  et multiplier le vecteur <i>d</i> en ajoutant par <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  : <img src="https://habrastorage.org/webt/pc/eo/6_/pceo6_067ezk979vii2pi4ex8k4.png">  .  C'est-√†-dire  dans l'algorithme d'optimisation, nous minimisons en outre le vecteur <i>d '</i> .  Bien s√ªr, pour cela, il sera n√©cessaire de calculer la matrice de Jacobi, qui est d√©riv√©e de la m√™me mani√®re que nous avons d√©j√† d√©riv√© ci-dessus pour la fonction d'erreur g√©n√©rale. <br><br>  Le deuxi√®me probl√®me de l'algorithme est qu'il peut rester bloqu√© dans les minima locaux.  Dans d'autres travaux, ce probl√®me est r√©solu en utilisant un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">filtre √† particules.</a>  Dans notre cas, cette option s'est av√©r√©e, en principe, suffisante. <br><br><h4>  Bonus de suivi d'un objet </h4><br>  Connaissant la position et la forme de l'objet, vous pouvez les manipuler visuellement, ce que j'ai essay√© de d√©montrer sur la vid√©o.  L'objet a √©t√© d√©form√© √† l'aide de shaders OpenGL.  A l'aide de notre mod√®le, j'ai projet√© le point de l'objet sur l'image, et ainsi re√ßu la couleur de ce point.  Ensuite, vous pouvez d√©placer ce point, obtenant des effets int√©ressants - par exemple, le morphing.  Cependant, il faut se rappeler qu'en d√©pla√ßant le point, il faut que quelque chose reste √† sa place, sinon des incoh√©rences deviendront perceptibles.  En outre, en fonction de la qualit√© de notre suivi et de la forme de l'objet, nous recevrons divers effets ind√©sirables dus aux erreurs accumul√©es, qui le seront toujours.  Il faut juste en tenir compte d'une mani√®re ou d'une autre.  Dans la vid√©o pr√©sent√©e ci-dessus, je voulais montrer que la r√©alit√© augment√©e peut √™tre utilis√©e un peu plus large que d'imposer simplement des objets virtuels √† l'image. <br><br>  Soit dit en passant, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDK Vuforia</a> impl√©mente le suivi d'un objet par sa forme, bien que je ne pense pas qu'il serait possible de mettre en ≈ìuvre ce projet avec lui, car il n'est pas possible d'utiliser des bords strictement d√©finis et ne peut pas √™tre associ√© √† l'√©clairage du b√¢timent. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454664/">https://habr.com/ru/post/fr454664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454646/index.html">@Pythonetc compilation, mai 2019</a></li>
<li><a href="../fr454648/index.html">Trucs et astuces de ma cha√Æne Telegram @pythonetc, mai 2019</a></li>
<li><a href="../fr454652/index.html">Moteur √† r√©action sur une imprimante 3D domestique</a></li>
<li><a href="../fr454658/index.html">Gadgets de beaut√© - Affaires s√©rieuses</a></li>
<li><a href="../fr454662/index.html">D√©m√©nagement prudent aux Pays-Bas avec sa femme et son hypoth√®que. Partie 1: Recherche d'emploi</a></li>
<li><a href="../fr454666/index.html">Radio d√©finie par logiciel - comment √ßa marche? Partie 7</a></li>
<li><a href="../fr454668/index.html">D√©veloppeur Cookbook: DDD Recipes (Part 5, Processes)</a></li>
<li><a href="../fr454670/index.html">La s√©rie "Tchernobyl": regardez et pensez</a></li>
<li><a href="../fr454672/index.html">La cl√© du d√©part: les meilleurs logiciels et mat√©riels pour la criminalistique informatique</a></li>
<li><a href="../fr454674/index.html">Surveillance du pauvre ou surveillance du serveur depuis la console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>