<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¶ üëßüèø ü§∫ Visualisieren und behandeln Sie Hash Match Join üíØ ü•Ç üè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Beitrag ist der dritte Teil der Reihe √ºber Join-Operatoren (lesen Sie unbedingt Teil 1 - Joins mit verschachtelten Schleifen und Teil 2 - Joins...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualisieren und behandeln Sie Hash Match Join</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/459314/"><p>  Dieser Beitrag ist der dritte Teil der Reihe √ºber Join-Operatoren (lesen Sie unbedingt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1 - Joins mit verschachtelten Schleifen</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2 - Joins zusammenf√ºhren</a> ).  Die √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"MS SQL Server Developer" erstellt</a> . </p><br><p><img src="https://habrastorage.org/webt/zb/ut/6t/zbut6thx839xzxe3p-zgtwobgoy.png"></p><br><p>  <strong>Hash Match Joins</strong> sind die zuverl√§ssigen Arbeitspferde physischer Verbindungsbetreiber. <br>  W√§hrend der Join f√ºr verschachtelte Schleifen fehlschl√§gt, wenn zu viele Daten vorhanden sind, um in den Speicher zu passen, und f√ºr den Merge-Join die Eingabe sortiert werden muss, kombiniert <strong>Hash Match</strong> alle von Ihnen √ºbermittelten Daten (sofern dies der Fall ist) F√ºr die Verbindung wird ein Gleichheitspr√§dikat ausgef√ºhrt, und in Ihrer Tempdb ist bisher gen√ºgend freier Speicherplatz vorhanden. </p><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/59C8c7p_hII" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sehen Sie sich YouTube-Videos an</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a> </p><br><p>  Der <strong>Hash-Match-</strong> Algorithmus besteht aus zwei Stufen, die wie folgt funktionieren: </p><br><p><img src="https://habrastorage.org/webt/h7/j2/sr/h7j2srrh-fso79crvhty8z3ezfy.gif"></p><br><p>  W√§hrend der ersten Erstellungsphase erstellt SQL Server aus einer der Eingabetabellen (normalerweise der kleinsten der beiden) eine Hash-Tabelle im Speicher.  Die Hashes werden basierend auf den Eingabetasten berechnet und dann zusammen mit der Zeile in der Hash-Tabelle im entsprechenden Block gespeichert.  In den meisten F√§llen gibt es in jedem Block nur eine Datenzeile, au√üer wenn: </p><br><ol><li>  Es gibt Zeilen mit doppelten Schl√ºsseln. </li><li>  Die Hash-Funktion erzeugt eine Kollision, und v√∂llig unterschiedliche Schl√ºssel erhalten denselben Hash (dies ist selten, aber m√∂glich). </li></ol><br><p>  Nach dem Erstellen der Hash-Tabelle beginnt die Phase ‚ÄûProbe‚Äú (Verifizierung).  Im zweiten Schritt berechnet SQL Server den Schl√ºssel-Hash f√ºr jede Zeile in der zweiten Eingabetabelle und pr√ºft, ob er in der im ersten Schritt erstellten Hash-Tabelle vorhanden ist.  Wenn f√ºr diesen Hash eine √úbereinstimmung vorliegt, wird gepr√ºft, ob die Schl√ºssel der Zeile (n) in der Hash-Tabelle und der Zeilen aus der zweiten Tabelle wirklich √ºbereinstimmen (diese Pr√ºfung muss aufgrund m√∂glicher Kollisionen durchgef√ºhrt werden). <br>  Eine g√§ngige Version des <strong>Hash-Match-</strong> Algorithmus tritt auf, wenn es in der Bauphase nicht m√∂glich ist, eine Hash-Tabelle zu erstellen, die vollst√§ndig im Speicher gespeichert werden kann: </p><br><p><img src="https://habrastorage.org/webt/jx/pl/ip/jxplipr_fmggvdhkz3zwzsjmcks.gif"></p><br><p>  Dies geschieht, wenn mehr Daten vorhanden sind, als im Speicher gespeichert werden k√∂nnen, oder wenn SQL Server nicht gen√ºgend Speicher f√ºr eine <strong>Hash-Match-</strong> Verbindung bereitstellt. </p><br><p>  Wenn SQL Server w√§hrend der Erstellungsphase nicht √ºber gen√ºgend Speicher verf√ºgt, um die Hash-Tabelle zu speichern, funktioniert es weiter, indem einige Bl√∂cke im Speicher gespeichert und andere Bl√∂cke in Tempdb platziert werden. <br>  In der Validierungsphase verkettet SQL Server die Datenzeilen aus der zweiten Tabelle zu Bl√∂cken aus der Erstellungsphase im Speicher.  Wenn der Block, dem diese Zeile m√∂glicherweise entspricht, derzeit nicht √ºber gen√ºgend Speicher verf√ºgt, schreibt SQL Server diese Zeile zum sp√§teren Vergleich in tempdb. </p><br><p> Wenn √úbereinstimmungen f√ºr einen Block abgeschlossen sind, l√∂scht SQL Server diese Daten aus dem Speicher und l√§dt die folgenden Bl√∂cke in den Speicher.  Anschlie√üend werden die Zeilen der zweiten Tabelle (derzeit in Tempdb) mit den neuen Bl√∂cken im Speicher verglichen. </p><br><p>  Wie bei jeder physischen Join-Anweisung in dieser Serie finden Sie Details zur <strong>Hash-Match-</strong> Anweisung in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hugo Kornelis-Hilfe zum Hash-Match</a> . </p><br><h3 id="chto-pokazyvaet-hash-match-join">  Was zeigt Hash Match Join? </h3><br><p>  Wenn wir die internen Funktionen der <strong>Hash-Match-Verkn√ºpfung kennen</strong> , k√∂nnen wir bestimmen, was der Optimierer √ºber unsere Daten und vorgelagerten Verbindungsbetreiber denkt, und uns auf die Leistungsoptimierung konzentrieren. </p><br><p>  Hier sind einige Szenarien, die Sie ber√ºcksichtigen sollten, wenn Sie das n√§chste Mal sehen, dass der <strong>Hash-Match-Join</strong> in Ihrem Ausf√ºhrungsplan verwendet wird: </p><br><ul><li>  W√§hrend der <strong>Hash-Match-Join</strong> gro√üe Datenmengen kombinieren kann, ist das Erstellen einer Hash-Tabelle aus der ersten Eingabetabelle eine Blockierungsoperation, die die Ausf√ºhrung nachfolgender Anweisungen verhindert.  In diesem Zusammenhang √ºberpr√ºfe ich immer, ob es eine einfache M√∂glichkeit gibt, <strong>Hash-√úbereinstimmungen</strong> in verschachtelte Schleifen zu konvertieren oder Verkn√ºpfungen zusammenzuf√ºhren.  Manchmal ist dies nicht m√∂glich (zu viele Zeilen f√ºr verschachtelte Schleifen oder unsortierte Daten f√ºr Zusammenf√ºhrungsverkn√ºpfungen), aber es lohnt sich immer zu pr√ºfen, ob eine einfache Index√§nderung oder verbesserte Sch√§tzungen aus der Aktualisierung der Statistiken resultieren, damit SQL Server eine nicht blockierende <strong>Hash-Match-</strong> Join-Anweisung ausw√§hlt </li><li>  <strong>Hash-Match-Joins eignen sich</strong> hervorragend f√ºr gro√üe Verbindungen, da sie an Tempdb √ºbertragen werden k√∂nnen. Dadurch k√∂nnen sie Verbindungen zu gro√üen Datasets herstellen, was zu einer fehlgeschlagenen Verbindung im Speicher mithilfe verschachtelter Schleifen oder zum Zusammenf√ºhren von Join-Anweisungen f√ºhren kann. <br><ul><li>  Wenn Sie eine <strong>Hash-Match-Join-</strong> Anweisung sehen, bedeutet dies, dass SQL Server die Eingabe f√ºr zu gro√ü h√§lt.  Wenn wir wissen, dass unsere Eingabedaten nicht so gro√ü sein sollten, sollten Sie pr√ºfen, ob Probleme mit Statistiken oder Sch√§tzungen vorliegen, aufgrund derer SQL Server den <strong>Hash-Match-Join</strong> falsch ausw√§hlt. </li></ul></li><li>  Wenn der <strong>Hash-Match-Join</strong> im Speicher ausgef√ºhrt wird, <strong>ist er</strong> ziemlich effizient.  Probleme treten auf, wenn die Erstellungsphase auf tempdb geht. <br><ul><li>  Wenn ich ein kleines gelbes Dreieck bemerke, das anzeigt, dass die Verbindung zu tempdb hergestellt wird, sehe ich, warum dies passiert ist: Wenn mehr Daten als Speicher verf√ºgbar sind, kann wenig getan werden. Wenn der zugewiesene Speicher jedoch unangemessen klein erscheint, kann dies bedeuten, dass Wir haben wahrscheinlich noch ein Problem mit Statistiken, das zu zu niedrigen Sch√§tzungen des SQL Server-Optimierers f√ºhrt. </li></ul></li></ul><br><p>  Vielen Dank f√ºr das Lesen des Artikels.  Vielleicht gef√§llt dir auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mein Twitter</a> . </p><br><p>  Wir haben dieses Thema in einer fr√ºheren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offenen Lektion behandelt</a> .  Warten auf Ihre Kommentare! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459314/">https://habr.com/ru/post/de459314/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459304/index.html">Angular Pitfall Bypass und Zeitersparnis</a></li>
<li><a href="../de459306/index.html">Server-Rendering in einer Umgebung ohne Server</a></li>
<li><a href="../de459308/index.html">SEO funktioniert 2019 nicht?</a></li>
<li><a href="../de459310/index.html">Testautomatisierungstools oder mobiler Steroidtester</a></li>
<li><a href="../de459312/index.html">Lieber Agile, ich habe es satt, so zu tun</a></li>
<li><a href="../de459316/index.html">Hydra 2019: kostenlose √úbertragung der ersten Halle und ein wenig dar√ºber, was auf der Konferenz sein wird</a></li>
<li><a href="../de459318/index.html">TypeScript und kurze Sprints. Wie wir das Variationstool f√ºr das Front-End-Interview erstellt haben</a></li>
<li><a href="../de459320/index.html">Kubernetes Operator in Python ohne Frameworks und SDKs</a></li>
<li><a href="../de459322/index.html">Herausgeber Peter. Sommerschlussverkauf</a></li>
<li><a href="../de459326/index.html">Automatische Skalierung und Ressourcenverwaltung in Kubernetes (√úberpr√ºfung und Videobericht)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>