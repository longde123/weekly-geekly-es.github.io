<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèª üë©üèø‚Äçü§ù‚Äçüë©üèº üë©üèª‚Äçü§ù‚Äçüë®üèø Perfilamos la carga de Habr o c√≥mo 189 solicitudes en la p√°gina representan influencia üë©üèº‚Äçüîß üß° üöõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace alg√∫n tiempo, me interes√© en el rendimiento del sitio web, las optimizaciones de descarga y similares. Y ahora, una vez m√°s yendo al Habr, pens√© ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perfilamos la carga de Habr o c√≥mo 189 solicitudes en la p√°gina representan influencia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454444/"><p><img src="https://habrastorage.org/webt/dg/5m/ab/dg5mabkefi6xhfiovvydhay2fkw.jpeg" alt="Toma jugo de cereza espeso"></p><br><p>  Hace alg√∫n tiempo, me interes√© en el rendimiento del sitio web, las optimizaciones de descarga y similares.  Y ahora, una vez m√°s yendo al Habr, pens√© que estaba acostumbrado a percibir una carga de recursos bastante r√°pida como algo dado, sin siquiera pensar en c√≥mo se logr√≥ esto.  Por lo tanto, decid√≠ combinar negocios con placer, para ver c√≥mo van las cosas con el rendimiento de Habr y qu√© soluciones t√©cnicas se hicieron para optimizarlo. </p><br><p>  Para aquellos que est√©n interesados ‚Äã‚Äãen saber lo que se ha hecho para que recibamos el contenido lo m√°s r√°pido posible y c√≥mo se ve la descarga del Habr de Argentina, por favor, bajo cat. </p><a name="habracut"></a><br><h2 id="podgotovka">  Preparaci√≥n </h2><br><p>  Necesitaremos una versi√≥n nueva de Chrome / Canary que funcione en modo an√≥nimo (aseg√∫rese de que todas las extensiones est√©n desactivadas).  Adem√°s, en la Consola de desarrollador (Herramientas de desarrollador - F12), en la pesta√±a de red, debe establecer el indicador de deshabilitar cach√©, porque  <strong>Solo perfilaremos el primer arranque, aunque todav√≠a no hay recursos en el cach√©.</strong> </p><br><h2 id="etap-pervyy---po-verham">  Etapa uno - "Arriba" </h2><br><p>  El objetivo principal de esta parte es familiarizarse con el sitio en su conjunto, comprender su estructura y descubrir qu√© recursos espec√≠ficos necesita. </p><br><p>  Abrimos herramientas para desarrolladores, vamos a la pesta√±a de red, abrimos el sitio y en la parte inferior de la pesta√±a miramos las estad√≠sticas sobre el uso de la red: </p><br><p><img src="https://habrastorage.org/webt/ni/fs/yb/nifsybxewz18qswerh5jubfsn1a.png" alt="Y una capa blanca de madre."></p><br><p>  Todo el sitio se carg√≥ en 2.02 segundos, lo que se ve genial (considerando la carga de Habr).  El evento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DomContentLoaded</a> (en adelante, simplemente DCL) generalmente apareci√≥ en 1.01 segundos, lo que se ve a√∫n mejor.  Con todo esto, el sitio realiza 189 solicitudes y carga 9.6MB de recursos.  Esto nos dice que o bien el equipo de Habra es un genio (puede serlo), y que el art√≠culo deber√≠a estar terminado aqu√≠ (y pedirles al equipo caf√© y galletas), o recordar que tengo un canal de 100 Mb / sy Core I7 .  Es decir  necesita acercarse un poco m√°s a la realidad y al menos limitar el ancho del canal. </p><br><p>  Activamos el modo Fast 3G y volvemos a mirar: </p><br><p><img src="https://habrastorage.org/webt/bp/ov/lk/bpovlkvte1ojvmuamwcoki4uniq.png" alt="Vierta suavemente el jugo sobre la capa -"></p><br><p>  DCL empeor√≥ a 3.48 segundos, lo que a√∫n es razonablemente aceptable.  Pero finalmente el sitio se carg√≥ en ateo 54.76 segundos.  Ahora todo es l√≥gico: no puede descargar y descargar casi 10 megabytes cuando tiene una conexi√≥n d√©bil.  Lo m√°s probable es que los chicos hicieron un buen trabajo para mostrarnos el contenido lo m√°s r√°pido posible (esto se evidencia por el hecho de que incluso en modo fast3g DCL surge lo suficientemente r√°pido), y dejaron todo lo que no era cr√≠tico para cargar en segundo plano.  Comprobaremos esto un poco m√°s tarde, y ahora veamos por qu√© cargamos tanto tiempo.  Ordenar todas las solicitudes por tiempo de carga: </p><br><p><img src="https://habrastorage.org/webt/el/jv/uc/eljvucnzbn0d83cd2konxv8ff-8.png" alt="Aparecer√° un lugar."><br>  <a href="">Clickable</a> </p><br><p>  Las im√°genes (top-7) se cargan m√°s tiempo y un archivo JavaScript es prebid.js.  Si observamos su tama√±o, podemos suponer que esta es precisamente la raz√≥n de la carga lenta. </p><br><div class="spoiler">  <b class="spoiler_title">Sobre supuestos</b> <div class="spoiler_text"><p>  Con suposiciones debes ser extremadamente cuidadoso.  Por ejemplo, una carga prolongada de un recurso puede ser causada no solo por el tama√±o del archivo, sino tambi√©n, por ejemplo, por problemas con el DNS, la carga m√°xima de almacenamiento o la cach√© del servidor en fr√≠o.  Por lo tanto, una suposici√≥n no verificada puede hacer que pierda el tiempo resolviendo un problema que ni siquiera existe. </p></div></div><br><p>  Mirando las estad√≠sticas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TTFB</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">0.610</a> ms, carga: 40 000 ms), podemos concluir que nuestra suposici√≥n es bastante probable.  Admiramos nuestro TOP 1 (png, 1560X780, 24 bits): </p><br><p><img src="https://habrastorage.org/webt/61/ts/aj/61tsajb8gnvzqjaw0cg-mqdj32e.png" alt="Ahora que no hay lugar"></p><br><p>  De hecho, los problemas con las im√°genes son principalmente problemas de nuestro tr√°fico con usted.  Las im√°genes (a diferencia de los estilos y las secuencias de comandos) no bloquean la representaci√≥n de la p√°gina web y, por lo tanto, a pesar de la presencia de esos pesos pesados ‚Äã‚Äã(puede ser peor, lo vieron), esto casi no tiene efecto en el rendimiento.  Aunque, por supuesto, la optimizaci√≥n en esta direcci√≥n (por ejemplo, la transcodificaci√≥n a jpeg2000 o webp, o la carga progresiva no ser√≠a superflua). </p><br><div class="spoiler">  <b class="spoiler_title">Sobre imagenes</b> <div class="spoiler_text"><p>  Como escrib√≠ anteriormente, las im√°genes no bloquean la representaci√≥n de la p√°gina.  Pero usan nuestro grupo de conexiones, y en http 1.x su n√∫mero es limitado, y con http 2.xy Chrome tambi√©n, no todo es tan f√°cil como escuch√©.  Por lo tanto, incluso aqu√≠ existe la posibilidad de que alguna imagen ralentice la carga de una secuencia de comandos s√≠ncrona, y que, a su vez, ya deje de mostrar la p√°gina.  Adem√°s, cargar la imagen tambi√©n puede causar un recuento del dise√±o, lo que ralentiza el renderizado.  Si observamos el marcado de Habr, casi todas las etiquetas img tienen ancho y alto.  Esto elimina la necesidad de reflujo para impactar positivamente el rendimiento de descarga.  Puedes leer m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p></div></div><br><p>  Veamos qu√© otros recursos extrae el Habr: repasaremos los tipos y los ordenaremos por tiempo de carga.  Comencemos con JavaScript </p><br><h3 id="javascript">  Javascript </h3><br><div class="spoiler">  <b class="spoiler_title">Sobre javascript</b> <div class="spoiler_text"><p>  JavaScript tiene varios problemas en t√©rminos de rendimiento del sitio.  En primer lugar (todo el mundo lo sabe desde hace mucho tiempo), js s√≠ncrono bloquea la representaci√≥n de p√°ginas adicionales.  Es decir  hasta que recibamos y ejecutemos nuestro JavaScript, el navegador esperar√° (en realidad no del todo, el navegador, especialmente Chrome, puede optimizar, pero esta es otra historia) y no mostrar√° m√°s contenido.  Usando scripts s√≠ncronos en la cabeza, posponemos el momento en que el usuario ve al menos algo (incluso texto).  Por lo tanto, todos est√°n tratando de lanzar Js al final de la p√°gina o incluso hacerlo as√≠ncrono.  Esto funciona, pero no resuelve el segundo problema que nos trae el hecho de que JavaScript sigue siendo un lenguaje de secuencias de comandos.  Por lo tanto, el navegador no es suficiente solo para descargarlo, sino que tambi√©n debe ser "entendido".  Y aqu√≠, resulta que este es un problema, porque los procesadores d√©biles (por ejemplo, en tel√©fonos o netbooks baratos, o incluso en computadoras port√°tiles buenas en modo de rendimiento limitado) lo hacen lentamente, bloqueando el hilo principal.  A continuaci√≥n se muestra un ejemplo de c√≥mo un gui√≥n publicitario as√≠ncrono entr√≥ en la secci√≥n cr√≠tica del renderizado de Habr y aunque fue un poco, pero a√∫n estrope√≥ el rendimiento.  Si alguien est√° interesado, hay un muy (muy, muy) buen art√≠culo sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este tema.</a> </p></div></div><br><p>  Las secuencias de comandos de Habr se cargan mucho: 1.1 MB (y esto ya est√° en forma comprimida) para 40 solicitudes.  Esto es francamente significativo, todav√≠a nos llega y necesitamos hacer algo al respecto.  Ordene nuestros guiones "por la cascada".  Nuestra tarea es encontrar scripts que se carguen ANTES de la l√≠nea azul, ya que son ellos (muy probablemente) los que nos impiden mostrar el sitio lo m√°s r√°pido posible. </p><br><p><img src="https://habrastorage.org/webt/0m/8g/u4/0m8gu4f9s-odx2kf7xg8jiweuke.png" alt="En la capa de mi madre"><br>  <a href="">Clickable</a> </p><br><p>  Abrimos el html que Habr nos dio (es importante mirar la respuesta, ya que el html final se ver√° diferente) y revisaremos la lista.  Como puede ver, jQuery, raven.js, advert.js y adriver.js se cargan sincr√≥nicamente directamente desde la etiqueta principal (es decir, bloquean todo).  Gpt y Publisher se cargan desde head pero ya de forma asincr√≥nica (es decir, no bloquean nada, el navegador mostrar√° la p√°gina m√°s mientras se est√° cargando).  Los proveedores, Main y Math, checklogin se cargan al final, pero sincr√≥nicamente (es decir, el texto ya est√° all√≠, podemos leerlo, pero el DCL no aparecer√° hasta que se carguen).  El resto no aparece en la respuesta inicial: se agregan din√°micamente, pero este es otro tema. </p><br><p>  Entonces, encontramos esos scripts que de alguna manera afectan la rapidez con que vemos el texto en la p√°gina.  Estos son los primeros candidatos para la optimizaci√≥n.  Idealmente, deben hacerse as√≠ncronos o colocarse lo m√°s bajo posible para permitir que el navegador muestre contenido para nosotros.  Sin embargo, el ideal no se puede lograr, ya que lo m√°s probable es que haya otros scripts en el sitio que dependan del mismo jQuery.  Tambi√©n se puede entender el deseo de descargar raven lo antes posible: una biblioteca para rastrear varios errores que ocurren en el cliente.  Pero advert.js y adriver.js ya son candidatos reales para al menos desplazarse hacia abajo en la p√°gina, y como m√°ximo tambi√©n en modo as√≠ncrono.  Una historia similar con gpt y editor.  S√≠, se cargan de forma asincr√≥nica, pero, sin embargo, pueden (e interferir√°n) con nosotros al cargar.  Por lo tanto, tambi√©n podr√≠an enviarse al final de la p√°gina.  Adem√°s, puede intentar usar los atributos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sugerencias de recursos</a> : preload / prefetch / dns-prefetch para decirle al navegador qu√© cargar por adelantado.  Por cierto, le aconsejo que lea sobre Sugerencias de recursos, una herramienta muy interesante, aunque con soporte limitado (hasta ahora). </p><br><p>  Ahora ordena la lista por tama√±o de archivo: </p><br><p><img src="https://habrastorage.org/webt/r-/om/kq/r-omkqj5qrslwffj42o5eogv_3s.png" alt="La capa debe estar metida entera"><br>  https://github.com/Drag13/articles/blob/habrformance/habrformance/scripts.PNG </p><br><p>  Vemos un script que se carga dos veces (pubads).  Tambi√©n notamos que prebid.js se carga desde la carpeta no para productos </p><br><p><img src="https://habrastorage.org/webt/4e/su/7w/4esu7wsvwdpgmbw8nscc_sqcgmo.png" alt="En espeso jugo de cereza."></p><br><p>  Para despejar nuestra conciencia, verificamos que todos los guiones est√©n minificados.  De repente, los scripts check-login.js y adriver.js no fueron minimizados.  Especialmente satisfecho con el contenido de este √∫ltimo: </p><br><p><img src="https://habrastorage.org/webt/6q/nv/q8/6qnvq8dimcd_5m3w77mr3mkjlea.png" alt="Toma una capa de cereza"></p><br><p>  Y con los scripts puedes terminar temporalmente. </p><br><h3 id="stili">  Estilos </h3><br><div class="spoiler">  <b class="spoiler_title">Sobre estilos</b> <div class="spoiler_text"><p>  Con los estilos, tampoco todo es tan simple.  En primer lugar, la carga sincr√≥nica de estilos tambi√©n bloquea el hilo principal (aunque se analizan r√°pidamente, m√°s r√°pido que JavaScript).  Y en segundo lugar, todo es un poco m√°s complicado.  ¬øPor qu√© el navegador necesita CSS?  Para construir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CSSOM</a> .  ¬øQu√© puede hacer JavaScript con CSS?  As√≠ es, cambio.  ¬øY qu√© suceder√° si CSSOM a√∫n no est√° construido y js ya est√° tratando de cambiar algo all√≠?  La respuesta es qui√©n sabe.  Por lo tanto, el navegador retrasa la ejecuci√≥n de JavaScript hasta que se calcula el CSSOM.  Como est√° escrito correctamente en otro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo muy √∫til</a> : sin CSS = sin JavaScript.  Por lo tanto, cargar CSS bloquea la ejecuci√≥n de JS. </p></div></div><br><p>  Estos son los estilos que carga Habr: </p><br><p><img src="https://habrastorage.org/webt/nm/6y/a7/nm6ya7qcp1bdqcp5sl2fiingrp8.png" alt="Y una jarra de leche."><br>  <a href="">Clickable</a> </p><br><p>  Como puede ver, solo hay tres de ellos, con el segundo y el tercero cargados en un marco separado, por lo que los ignoramos.  Pero el primer conjunto de estilos es crucial para todo el sitio.  Y lo descargamos durante mucho tiempo.  Por qu√©  En primer lugar, esperaron mucho tiempo por una respuesta del servidor (TTFB 570 ms, volveremos a ello en la tercera secci√≥n), y en segundo lugar, se cargaron 713 ms durante mucho tiempo.  ¬øQu√© se puede hacer aqu√≠?  La primera y m√°s simple es intentar agregar el atributo de precarga.  Esto har√° que el navegador comience a cargar CSS lo antes posible.  La segunda opci√≥n es resaltar CSS cr√≠tico e incrustarlo directamente en la p√°gina web, y cargar el resto sincr√≥nicamente (o incluso asincr√≥nicamente).  Esto conducir√° a un aumento en el tama√±o de la p√°gina (pero ya no es peque√±o y + 5kb no estropear√° nada) y a un posible redise√±o del dise√±o (p√©rdida de tiempo), pero puede intentarlo. </p><br><p>  Ni siquiera mostrar√© las fuentes.  Est√° all√≠ solo, aunque por alguna raz√≥n se carga directamente desde el servidor Habr en lugar de la CDN (y muy probablemente por alguna raz√≥n).  Pero dir√© gracias por el hecho de que solo hay una fuente. </p><br><p>  En esto, la parte general del an√°lisis del sitio se puede considerar completada.  Es hora de ir m√°s profundo. </p><br><h2 id="etap-vtoroy---ruchnoy-rezhim">  Etapa dos - "Modo manual" </h2><br><p>  En la √∫ltima etapa vimos <em>que</em> Habr carga.  Ahora veremos <em>c√≥mo</em> se representa esto. </p><br><p>  Vaya a la pesta√±a de perfiles.  Verificamos qu√© ralentizaci√≥n es fast3g (luego ejecutamos nuevamente sin restricciones) y ejecutamos.  En primer lugar, estamos interesados ‚Äã‚Äãen todo lo que sucede antes del evento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">First contentful paint (FCP)</a> y, por si acaso, DCL.  Seleccionamos el √°rea desde el inicio de la carga en FCP y miramos el diagrama final. </p><br><p><img src="https://habrastorage.org/webt/1s/nb/qi/1snbqidqssgm4mxoulzysms7swu.png" alt="Vierte la leche pensada -"></p><br><p>  Todo sucede bastante r√°pido: 2.161 segundos antes del FCP (fue m√°s r√°pido, pero aparentemente algo hab√≠a cambiado), pero como puede ver, la mayor√≠a de las veces el navegador estaba inactivo.  La carga √∫til solo tom√≥ el 14% del tiempo (aproximadamente 310 ms).  Idealmente, el subproceso principal del navegador se ejecuta continuamente: al analizar html, CSS, se ejecuta JS.  Y aqu√≠, nada.  Por qu√©  Porque el navegador simplemente no ten√≠a nada que hacer.  ¬øRecuerdas que redujimos el tr√°fico?  El navegador ha enviado solicitudes y ahora solo espera a que se completen.  Si abrimos el diagrama de los procesos de red (el m√°s alto) todo se aclarar√° de inmediato. </p><br><p><img src="https://habrastorage.org/webt/uf/1-/gt/uf1-gt0kx7rkdpd9tzeod3hv99o.png" alt="Aparecer√° un lugar."><br>  <a href="">Clickable</a> </p><br><p>  En 2029, el navegador vio main.bundle.css, envi√≥ una solicitud para recibirlo y comenz√≥ a esperar.  En este momento, el preescaner (smart chrome, puede ejecutarse por delante) descubri√≥ que hay scripts s√≠ncronos a continuaci√≥n y, sin esperar a que css llegue, envi√≥ una solicitud de scripts.  Luego anuncie y cargue un controlador (pero recordamos que si bien CSSOM no se crea, no puede tocar JS), por lo que el navegador los ignor√≥.  Despu√©s de eso, gpt y raven se cargaron, pero el CSS todav√≠a se estaba cargando, por lo que tambi√©n se ignoraron.  Finalmente, se carg√≥ CSS, que el navegador analiz√≥ en 12 ms e inmediatamente fue a analizar el JS incrustado en la p√°gina.  Luego, el navegador volvi√≥ a "quedarse dormido" a casi 150 ms esperando jQuery.min.js.  Y despu√©s de eso ya comenc√© a trabajar en serio: descubr√≠ el jQuery cargado (20 ms), analic√© raven.js (4 ms), analic√© casi toda la p√°gina (36 ms), volv√≠ a contar los estilos (28 ms), calcul√© el dise√±o (78 ms + 8 ms) y, finalmente, durante ~ 6 ms, pintamos la p√°gina.  Aqu√≠ tenemos FCP.  A continuaci√≥n, analizamos la p√°gina, analizamos los scripts: hola a nadie (publishertag.js, gpt.js que se meti√≥ en el hilo principal antes de DCL), jugamos un poco con los estilos (lo que caus√≥ una ligera p√©rdida de tiempo debido al rec√°lculo del dise√±o) y comenzamos a esperar a los proveedores. bundle.js.  Con el fin de esperar a los vendedores, pasamos casi inactivos otros 1100 ms.  Es cierto que, en paralelo, tambi√©n cargamos main.bundle.js (que, por cierto, arranc√≥ m√°s r√°pido), por lo que no todo es tan malo.  Entonces todo volvi√≥ a salir bien.  Analizamos los proveedores, analizamos el paquete principal, analizamos Math.Jax y finalmente analizamos la p√°gina y obtuvimos DCL.  Es cierto que alg√∫n tipo de controlador funcion√≥ all√≠, lo que en mi I7 detuvo el hilo principal a 80 ms (es decir, el sitio pareci√≥ congelarse a 80 ms).  Ahora casi no nos damos cuenta de esto, pero en un procesador d√©bil, te√≥ricamente, puede ser notable. Si ves esto despu√©s de que se muestra el contenido, esta es una ocasi√≥n para comprobar JS. </p><br><p>  Que puedo decir  De nuevo, a pesar de que se ve bastante bien.  Los principales problemas nos fueron entregados: </p><br><ul><li>  Un navegador grande y simple (incluso debido al desequilibrio artificial entre la potencia inform√°tica de la computadora y el ancho del canal, pero este tambi√©n es un escenario bastante v√°lido) </li><li>  Larga carga de CSS que retras√≥ el trabajo con js cr√≠ticos </li><li>  Carga sincr√≥nica de jQuery, proveedores y paquetes principales que detuvieron la aparici√≥n de contenido. </li></ul><br><p>  Lo que podemos hacer con esto ya lo hemos discutido: </p><br><ul><li>  Intente agregar el atributo de precarga para CSS y tal vez algo de JS </li><li>  Reducir o CSS en l√≠nea </li><li>  Intente generalmente lanzar scripts fuera de la carga s√≠ncrona (al menos algunos) </li></ul><br><p>  Ahora repitamos lo mismo sin restricciones en el ancho del canal.  La imagen ya es mucho mejor: 0.452 segundos a FMP, ¬°la m√°s simple de todas!  13 ms.  DCL - 953 ms, simple 15 ms.  As√≠ es como se ve la descarga de mis sue√±os.  Eso es exactamente lo que sucedi√≥ porque abr√≠ una nueva pesta√±a y no elimin√© el almacenamiento en cach√©.  Probemos lo mismo, pero sin un cach√©: </p><br><p><img src="https://habrastorage.org/webt/g5/ji/5q/g5ji5qscsjud50jdqkoazqoxsga.png" alt="Ahora que no hay lugar"></p><br><p>  Todo tambi√©n es bastante bueno, FCP / FMP - 1689, carga √∫til 45%.  Por cierto, ajustar la carga al 100% tambi√©n es malo, ya que las m√°quinas m√°s d√©biles se sobrecargar√°n.  Por lo tanto, es mejor tener una reserva para el tiempo de inactividad.  Pero, inesperadamente, aqu√≠ se dedic√≥ mucho tiempo a la representaci√≥n: 400 ms para FMP.  De estos, 200 ms fueron a rec√°lculo de estilos y rec√°lculo de dise√±o. </p><br><p>  Por cierto, otro punto interesante.  ¬øRecuerdas los guiones de anuncios: gpt.js y publishertag.js que se mencionaron en la primera parte?  Ahora puede ver que, a pesar de su asincron√≠a, pudieron (aunque sea un poco) arruinar nuestras estad√≠sticas.  Esto sucedi√≥ porque la ejecuci√≥n de los scripts asincr√≥nicos se realiza de acuerdo con la disponibilidad de los mismos scripts.  Es decir  Esto puede suceder en cualquier momento, incluso antes de FCP / DCL, que ocurri√≥ en 3309. </p><br><p>  Entonces, hicimos el desmontaje manual.  Es hora de descubrir la automatizaci√≥n. </p><br><h2 id="etap-tretiy---s-etogo-nado-bylo-nachinat">  Etapa tres: "Ten√≠amos que comenzar desde esto" </h2><br><div class="spoiler">  <b class="spoiler_title">Sobre la granja colectiva</b> <div class="spoiler_text"><p>  Creo que todos entienden que este estudio es muy arbitrario.  Al menos, porque todo el tiempo, mientras estaba probando nuevos art√≠culos aparec√≠an, la carga en el servidor y la carga en la red troncal cambiaban.  En el buen sentido, debe implementar un servidor dedicado en el que nadie escriba nada, emule la carga relevante con demoras relevantes y solo luego haga un perfil.  De lo contrario, puede hacer algunas suposiciones (por ejemplo, sobre la necesidad de agregar un atributo de precarga en CSS), agregarlo, implementarlo en producci√≥n, y luego resulta que la carga durante la prueba aument√≥ considerablemente y el servidor nos dio el mismo estilo 500 ms despu√©s.  Y resulta que la precarga es mala, simplemente empeor√≥ todo.  Y el autor es el √∫ltimo r√°bano en absoluto.  Adem√°s, la creaci√≥n de perfiles manualmente (como en la segunda parte), hasta que elimine todas las herramientas autom√°ticas y resuelva los problemas encontrados all√≠, tambi√©n tiene poco sentido, porque despu√©s de sus primeros cambios, la imagen cambiar√°. </p><br><p>  Por lo tanto, antes de cualquier experimento, necesitamos el entorno m√°s estable.  Esta vez  El segundo: nunca debe profundizar (por ejemplo, en la creaci√≥n de perfiles) desde el principio.  Inicie las herramientas autom√°ticas primero, deje que trabajen para usted.  Recopile informes, vea qu√© se puede hacer lo mejor posible en un tiempo m√≠nimo.  Intenta hacerlo.  Si es posible, es posible que ya tenga suficiente.  Por ejemplo, su css.bundle pesa 100kb, pero en realidad necesita 45kb (por cierto, la situaci√≥n real: tomaron todo el arranque, pero solo se necesitaba la cuadr√≠cula).  Redujeron el tama√±o de los estilos y ganaron medio segundo pr√°cticamente por nada.  Estos son dos  Siempre verifique dos veces.  Parece que los estilos est√°n en l√≠nea, todo deber√≠a mejorar, pero empeorar√°.  Por qu√©  Y porque en los estilos de 50kb de im√°genes base64, y nuestra p√°gina acaba de cargar 200kb de recursos.  Solo recuerda que no hay bala de plata y guiones universales.  Estos son tres.  Y la √∫ltima, incluso si contradice la oraci√≥n anterior.  Si no tiene un sitio complicado, solo controle TTFB (problemas del servidor), el tama√±o de los recursos descargados (hola a los logotipos por 2 MB) y no le d√© acceso al Administrador de etiquetas de Google a nadie.  Lo m√°s probable es que esto sea suficiente. </p></div></div><br><p>  No iremos muy lejos, en las mismas Herramientas para desarrolladores, abra la pesta√±a de auditor√≠a e inicie LightHouse (LH) con la siguiente configuraci√≥n: escritorio, solo rendimiento, sin limitaci√≥n, almacenamiento limpio.  Despu√©s de esperar un poco (no salga de la p√°gina en la que se realiza la auditor√≠a y no haga nada mejor) obtenemos n√∫meros fant√°sticos (incluso con el cach√© deshabilitado) </p><br><p><img src="https://habrastorage.org/webt/cg/cu/rc/cgcurczrbd7r4xhjqrtqgw-pj5s.png" alt="En la capa de mi madre"></p><br><p>  Incluso me parece que estaban especialmente dise√±ados para estas figuras. </p><br><p>  Sin embargo, LH todav√≠a se queja de: </p><br><ul><li>  Formato de imagen desactualizado (sugiere usar webp, jpeg2000, etc.) </li><li>  DOM node ‚Äì    : 2533,   1500. </li><li>    </li><li>     ‚Äî     23  </li><li>  document.write </li></ul><br><p>   .     (), DOM ‚Äî      node (-),      (  ),   document.write-  writer ( -    ) </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p>    (       )   .    ,  ,  , .  ,   ,      .       CSS, ‚Äî      ,   ,      JavaScript. ,        ,     .                       . </p></div></div><br><p>     ,       fast3g , ,      ( I7,  celeron): </p><br><p><img src="https://habrastorage.org/webt/td/ei/3j/tdei3jxtwbcvda5csqvvmgz2tua.png" alt="La capa debe estar metida entera"></p><br><p>      ( FCP   3500 ms, FMP 5.7): </p><br><ul><li>   ,   . LH    next-gen  ,  ,   ,     11   </li><li>      .       adriver.js  advertise.js  50 ,     . </li><li>    CSS    ,    5kb  45kb. </li><li>      main thread.           JavaScript ‚Äî (8.5   script evaluation   2186 ms   raven.js).   ? </li></ul><br><p>     ?         .    -    .  : </p><br><ul><li>   </li><li>   DOM </li><li>   JavaScript   </li></ul><br><p>    ,        ,         (,  raven.js). </p><br><p>  ,      ,       ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">webpagetest.org</a> </p><br><p>    ‚Äî   ,  ,  .        ‚Äî     ,      .   ,    .   ,    ,   . ,       ,      ,   ‚Äî  -. </p><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://habr.com</a> ( ru/en ). </p><br><p><img src="https://habrastorage.org/webt/qz/hb/gn/qzhbgnvpgll4xbdlvejmvfzpndm.png" alt="En una sart√©n con leche."></p><br><p> ( ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ) </p><br><p>    .     ( )    DNS (500 ms   ),     , ssl   .   ,    1150 ms    c      (    ). ,     (    habrastorage). </p><br><p>      main.bundle.css. ,     dr.habracdn.net ,     dns lookup ‚Äî 36 ms (     400 ms).  SSL negotiation 606 ms,  TTFB 601 ms,   .    .       DCL ‚Äî 4100 ms   ,   . </p><br><p>     image analysis , ,        .  -      PNG  1.4,   webp + downscaling ( ,   ) ‚Äî 17.7 KB.  ,       ,     png  154.          . ,  : </p><br><ul><li>         (   ,        , ..    ). </li><li>   .   ,    . </li><li>  TTFB (webpagetest    F  ) ‚Äî     </li><li>       ,       (         ) </li></ul><br><h2 id="vyvody">  Conclusiones </h2><br><p>      .     : </p><br><p>  : </p><br><ul><li>  TTFB   500 ms      ( <strong></strong> dns, ssl  initial connection) </li><li>  habrastorage </li></ul><br><p>  : </p><br><ul><li>    </li><li>   DOM-a </li><li>       </li></ul><br><p>  , ,      .      ,     ,    . ,   SPA,       ,    JS   ‚Äî    .     .       //,           </p><br><h2 id="poleznye-ssylki">   </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   1</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   2</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> FCP</a> </li></ul><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS. </font><font style="vertical-align: inherit;">Pido disculpas por la gran cantidad de anglicismos (especialmente por el dise√±o) y por Longrid. </font><font style="vertical-align: inherit;">Pero sin ellos, es realmente dif√≠cil, y todas estas partes 1, 2, 3, ya me cans√© del orden.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454444/">https://habr.com/ru/post/454444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454434/index.html">PDA (Pocket Travel Computer): registrador GPS de circuitos</a></li>
<li><a href="../454436/index.html">Petty Petty Joy # 1: loguru</a></li>
<li><a href="../454440/index.html">Petty Little Fun # 2: Starlette</a></li>
<li><a href="../454442/index.html">C√≥mo elegir una red proxy para su negocio: 3 consejos pr√°cticos</a></li>
<li><a href="../454446/index.html">¬øQu√© hay de nuevo en C # 8?</a></li>
<li><a href="../454450/index.html">C√≥mo Edison invent√≥ la tecnolog√≠a inal√°mbrica y no entendi√≥ nada</a></li>
<li><a href="../454452/index.html">Mostramos contenido en la imagen reconocida de acuerdo con ciertas reglas</a></li>
<li><a href="../454456/index.html">Entrenamiento Cisco 200-125 CCNA v3.0. D√≠a 7. Preguntas frecuentes</a></li>
<li><a href="../454458/index.html">Pruebas metam√≥rficas: por qu√© casi nadie sabe acerca de esta t√©cnica prometedora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>