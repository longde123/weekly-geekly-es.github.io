<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚ù§Ô∏è‚Äçüë® üåô üë©üèº‚Äçüîß Mobiler W√§chter auf Raspberry pi (h.264) üë®üèº‚Äçüíª ü•õ üôÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Themen der Verwendung von Raspberry pi zur FPV-Steuerung und √úberwachung der Bewegung in einem Frame entlang von H.264-Vektoren sind nicht neu. Di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mobiler W√§chter auf Raspberry pi (h.264)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424191/">  Die Themen der Verwendung von Raspberry pi zur FPV-Steuerung und √úberwachung der Bewegung in einem Frame entlang von H.264-Vektoren sind nicht neu.  Die Entwicklung gibt nicht vor, originell zu sein, und es wurde relativ wenig Zeit daf√ºr aufgewendet (ab Juli manchmal an Wochenenden). <br><br>  Aber vielleicht ist meine Erfahrung (und die Quelle) f√ºr jeden n√ºtzlich. <br><br>  Die Idee, dass Sie eine Video√ºberwachung in der Wohnung durchf√ºhren m√ºssen, entstand, nachdem ein Nachbar sagte, dass jemand in das T√ºrschloss eintauchte. <br><br>  Das erste, was ausgepeitscht wurde, war die Installation des ber√ºhmten Bewegungsprogramms auf dem Raspberry Pi Zero mit einer Kamera v1.3.  Im Prinzip l√∂st es das Problem.  Wenn Sie mit der Benachrichtigung per Mail und fps = 4-5 zufrieden sind. <br><br>  Das schien aber nicht interessant zu sein.  Zur Hand war eine Plattform mit R√§dern und Gurtzeug aus alten Experimenten und 18650 Batterien aus alten Laptops. <br><br>  Das Ergebnis ist eine unterhaltsame Mischung aus mobiler Video√ºberwachung und Bewegungserkennung. <br>  Da ich einen gemieteten VPS habe, gab es keine Probleme beim Zugriff von au√üen (Heimnetzwerk hinter NAT).  Die Akkulaufzeit betr√§gt ca. 4 Tage, wenn Sie die Fahrt und den Scheinwerfer nicht missbrauchen. <br><br>  Sie k√∂nnen durch die Wohnung fahren, die Kamera und die Plattform fernsteuern und sie an jedem gew√ºnschten Ort im Bewegungserkennungsmodus belassen. <br><br><img src="https://habrastorage.org/webt/fm/bz/hr/fmbzhriyrbtmqotgwhvk28uexlm.jpeg"><br><br><a name="habracut"></a><h1>  Hardware </h1><br>  Die gesamte Hardware kann in zwei Teile unterteilt werden, von denen der erste nicht vom zweiten abh√§ngt und separat verwendet werden kann: <br><br><h4>  Video√ºberwachungsmodul </h4><br><ul><li>  Himbeer pi Null </li><li>  USB WiFi Dongle </li><li>  Himbeer-Pi-Kamera v1.3 </li><li>  2x Schrittmotoren 28BYJ-48 + ULN2003 Treiber </li></ul><br><h4>  Mobile Plattform √ºber SPI aus Himbeeren verwaltet </h4><br><ul><li>  4S 16x18650 Li-Ion + 4S 30A Li-Ion 18650 (BMS) Karte + DC-DC-Aufladung mit Strom- und Spannungsstabilisierung </li><li>  DC / DC-Abw√§rtswandler (15 V -&gt; 5 V). </li><li>  stm32f103c8t6 Karte </li><li>  4x Getriebemotoren + L298N Platine </li><li>  12V LED Lampe (Scheinwerfer) + Steuerung am IRF3205 (+ smd pnp und npn) </li></ul><br>  Das Raspbian-Image wurde im schreibgesch√ºtzten Modus konfiguriert.  In einer solchen Konfiguration √ºberleben Himbeeren leicht unerwartete Abschaltungen, da sie √ºberhaupt keine SD-Karten f√ºr die Aufnahme verwenden. <br><br><h1>  Software </h1><br>  Die Software besteht aus 3 separaten Komponenten. <br><h4>  Android App (getestet auf LG6 Oreo und altem Samsung S5 Lollipop) </h4><br>  <b>FPV-Modus</b> <br><br><ul><li>  Zeigen Sie den H.264-Videostream von der Kamera in der angegebenen Aufl√∂sung und Bitrate an </li><li>  Kamera- und Plattformsteuerung </li><li>  Nehmen Sie Videos und Fotos aus dem Stream auf. </li></ul><br>  <b>Android-Servicemodus</b> <br><br><ul><li>  Host-Umfrage (mit angegebener H√§ufigkeit) </li><li>  Laden eines Ereignisfotos von ‚ÄûBewegung‚Äú in den Rahmen nach Ereignis. </li></ul><br><h4>  Himbeer-Pi-Host auf Python (Picamera + Spidev + RPi.GPIO) </h4><br>  <b>FPV-Modus</b> <br><br><ul><li>  Broadcast H.264-Stream (mit den von der Android-Anwendung angegebenen Parametern) </li><li>  Empfang von Steuerbefehlen f√ºr Schrittmotoren und deren Verwaltung. </li><li>  Broadcast-Steuerbefehle √ºber SPI (wenn der Modus aktiviert ist) </li></ul><br>  <b>Tracking-Modus Bewegung im Frame.</b> <br><br><ul><li>  Bewegungserkennung im Frame (gem√§√ü den von der Android-Anwendung angegebenen Parametern) </li><li>  Empfang von Anfragen "und ob sich im Rahmen etwas bewegt" und Hochladen von Fotos auf Anfrage </li><li>  Senden von Fotos im Rahmen (unabh√§ngig von der Anwendung) an den Host. </li></ul><br>  <b>Die einfachste Firmware auf stm32f103</b> <br><br><ul><li>  SPI-Befehle empfangen </li><li>  Steuern Sie die Drehrichtung der R√§der und PWM-Motoren. </li><li>  Scheinwerfersteuerung. </li></ul><br><h1>  Bewegungsverfolgung </h1><br>  Das Verfolgen der h.264-Vektoren erwies sich als sehr launisch und anf√§llig f√ºr falsch positive Ergebnisse.  Es gibt nur sehr wenige Bewegungserkennungsimplementierungen f√ºr H.264 im Netzwerk.  Ich habe sie alle ausprobiert. <br><br>  Die primitivste Option besteht darin, die Anzahl der Vektoren zu z√§hlen, deren L√§nge einen bestimmten Schwellenwert √ºberschreitet.  Und wenn Vektoren gr√∂√üer als der Schwellenwert sind, ist dies ein Signal daf√ºr, dass sich im Rahmen eine Bewegung befindet. <br><br>  Leider.  Diese Option ist nur zur Demonstration des Prinzips geeignet.  Es gibt zu viele Fehlalarme.  Besonders auf Oberfl√§chen mit einheitlicher Farbe und Textur. <br><br>  Alle anderen Optionen ergeben entweder zu viele Fehlalarme oder erf√ºllen einfach nicht das Leistungskriterium: ‚Äûsollten innerhalb der Frame-Zeit verarbeitet werden‚Äú. <br><br>  Infolgedessen habe ich meine Option gew√§hlt.  Obwohl es praktisch keine Fehlalarme gibt, erfordert es eine Bewegung in mehreren Frames hintereinander.  Dies ist jedoch besser als mehrmals t√§glich Fehlalarme aufgrund von Beleuchtungs√§nderungen oder allgemein aufgrund unverst√§ndlicher ‚ÄûBewegungen‚Äú im Rahmen durch die ‚ÄûEntscheidung‚Äú der Kamera.  Das Thema zuverl√§ssige Erkennungsalgorithmen f√ºr MV H.264 ist im Allgemeinen ein separates und komplexes Thema.  Algorithmen ben√∂tigen viel Zeit f√ºr das praktische Debuggen und ich habe strenge Laufzeitbeschr√§nkungen. <br><br>  Beispiel f√ºr Bewegungsvektoren (Snapshot-Dienstprogrammmodi): <br><br><img src="https://habrastorage.org/webt/ga/14/gv/ga14gvgp-rljxqu7-0cdrrhdvvw.jpeg"><br><br><img src="https://habrastorage.org/webt/ya/yz/sv/yayzsvkjptyuqafxeg3aevdyfhq.jpeg"><br><br>  Bei den Ereignissen ‚ÄûBewegung im Rahmen‚Äú werden Benachrichtigungen generiert. <br><br><img src="https://habrastorage.org/webt/7w/of/kf/7wofkfeel3yhp6k-vt4m7sw51pg.jpeg"><br><br>  F√ºr meine Zwecke stellte sich heraus, dass es im Prinzip garantiert ist, dass es ausgel√∂st wird, wenn sich eine menschliche Figur (&gt; 15% des Rahmens) mindestens 2 Sekunden lang bewegt.  Bei einer solchen Vergr√∂berung der Empfindlichkeit habe ich einfach √ºberhaupt keine falsch positiven Ergebnisse gesehen. <br><br><h3>  Bewegungssteuerung. </h3><br>  Plattformmanagement "per Traktor".  Das hei√üt,  PWM-Steuerung und Drehrichtung der linken und rechten Seite.  Bedienelemente (Streifen) unter den Daumen beider H√§nde.  Es stellte sich als das Nat√ºrlichste f√ºr mich heraus. <br><br><img src="https://habrastorage.org/webt/bk/qk/fn/bkqkfn7r2qda8cgikzkcw7a8vae.jpeg"><br><br>  Kamerasteuerung - zwei Streifen, die sich ber√ºhren, geben den Befehl, einen bestimmten Winkel zu drehen (je weiter von der Mitte des Streifens entfernt - desto gr√∂√üer der Winkel).  Die kontinuierliche Steuerung der Motoren war unangenehm (wieder subjektiv f√ºr mich). <br><br><img src="https://habrastorage.org/webt/_g/jw/bs/_gjwbsyivgtnnknnbohpoexfgqs.jpeg"><br><br><h3>  Verz√∂gerungen FPV </h3><br>  Videoverz√∂gerungen waren relativ klein (&lt;1 Sek.). <br><br>  Die Steuerung einer Plattform mit R√§dern mit einer H√∂chstgeschwindigkeit von 3-4 km / h f√ºr eine 100% ige PWM-Verz√∂gerung in 0,6 Sekunden ist ganz normal und wird fast nicht bemerkt. <br><br>  Es scheint mir jedoch, dass sogar 0,3 Sekunden Verz√∂gerung zum Beispiel f√ºr einen Quadrocopter viel sind. <br><br>  Tests haben gezeigt, dass die Implementierung der √úbersetzung in Python die Verz√∂gerung um 50-70 ms verz√∂gert, verglichen mit der Ausgabe desselben H.264-Streams √ºber Rapivid.  F√ºr mich sind diese 70ms nicht wichtig.  Aber wenn jemand das Maximum herausholen will, muss er dies ber√ºcksichtigen. <br><br>  Bei der Arbeit √ºber "lokales WLAN" (das Telefon als Zugangspunkt) betr√§gt die Verz√∂gerung 350..600 ms.  Aber nicht mehr als 0,6 Sekunden und stabil in diesem Bereich.  Obwohl 50-70 Meter in offenen Bereichen - dies ist nur zum Herumspielen.  In gr√∂√üerer Entfernung funktioniert WLAN vom Telefon nicht. <br>  Es ist erw√§hnenswert, dass dies in einer sehr "RF-lauten" Umgebung von Wohngeb√§uden mit vielen WiFi-Netzwerken in der Umgebung ist. <br><br><img src="https://habrastorage.org/webt/zw/bx/-y/zwbx-yzkmwqb0r8p2flbur5u__o.jpeg"><br><br>  Ich war √ºberrascht √ºber das Ergebnis in der Konfiguration ‚ÄûWLAN-Router -&gt; Twisted Pair-Anbieter -&gt; VPS -&gt; MTC 4G am Telefon‚Äú √ºber die Weiterleitung des SSH-Ports von Himbeeren an VPS. <br>  Eine typische Verz√∂gerung erwies sich sogar als etwas besser als √ºber lokales WLAN (!) <br>  Selbst unterwegs im Auto oder in der N√§he eines gro√üen Lag-Hypermarktes sind es nur 300ms. <br><br>  Manchmal (ziemlich selten und unvorhersehbar) betrug die Verz√∂gerung jedoch bis zu mehreren Sekunden.  Rekontext hilft.  Wahrscheinlich sind dies einige Merkmale von 4G / MTS / Anbietern in der Kette usw. <br><br><img src="https://habrastorage.org/webt/qm/bb/2v/qmbb2vsylq_qlv66rlpfz2x_d2e.jpeg"><br><br>  Nachdem alles funktioniert hatte, bestand der Wunsch, den Tonkanal in beide Richtungen anzuschlie√üen.  Technisch ist dies m√∂glich und nicht einmal sehr schwierig.  Aber ich habe keine Lust, mit einem L√∂tkolben herumzuspielen. <br><br>  Ohne das "zus√§tzliche" Rasberry Pi w√§re es einfacher, das alte Telefon als Host f√ºr die Video√ºberwachung und das Plattformmanagement zu verwenden.  Der einzige Vorteil von Himbeeren gegen√ºber einem alten Telefon ist das geringere Gewicht.  Und vielleicht weniger Stromverbrauch (nicht vergleichbar). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>Alle Quellen</b></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424191/">https://habr.com/ru/post/de424191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424177/index.html">Anschlie√üen des Grandstream GXW4104 FXO Gateway an 3CX</a></li>
<li><a href="../de424183/index.html">4. Oktober, Moskau - Backend Stories 2.0</a></li>
<li><a href="../de424185/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 331 (17. - 23. September 2018)</a></li>
<li><a href="../de424187/index.html">DEFCON-Konferenz 22. Adrian Crenshaw. Was k√∂nnen Benutzer von TOR "brennen"?</a></li>
<li><a href="../de424189/index.html">Smart Home? Oder nicht schlau ???</a></li>
<li><a href="../de424193/index.html">Internationaler Kongress f√ºr Astronautik - wie in Australien</a></li>
<li><a href="../de424197/index.html">Im Ofen von MVPs implementieren wir MVPr (Minimum Viable Prototype)</a></li>
<li><a href="../de424199/index.html">Erstellen eines einfachen GraphQL-API-Servers auf Express und NodeJS</a></li>
<li><a href="../de424201/index.html">Wie maschinelles Lernen mir geholfen hat, einige Aspekte der fr√ºhkindlichen Entwicklung zu verstehen</a></li>
<li><a href="../de424203/index.html">Prozedurale Geb√§udeerstellung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>