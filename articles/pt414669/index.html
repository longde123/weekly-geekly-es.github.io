<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåê üéß üôÑ Desenvolvimento de um novo analisador est√°tico: PVS-Studio Java üë©‚Äç‚úàÔ∏è üë¶üèº üåò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O analisador est√°tico PVS-Studio √© conhecido no mundo de C, C ++ e C # como uma ferramenta para detectar erros e poss√≠veis vulnerabilidades. No entant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de um novo analisador est√°tico: PVS-Studio Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/414669/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/ccb/b07/9c9ccbb070ea671cf64a42a257727397.png" alt="Quadro 3"></div><br>  O analisador est√°tico PVS-Studio √© conhecido no mundo de C, C ++ e C # como uma ferramenta para detectar erros e poss√≠veis vulnerabilidades.  No entanto, temos poucos clientes do setor financeiro, pois Java e IBM RPG (!) Agora est√£o sendo procurados l√°.  Mas sempre quisemos nos aproximar do mundo corporativo; portanto, depois de pensar um pouco, decidimos come√ßar a criar um analisador Java. <br><a name="habracut"></a><br><h2>  1. Introdu√ß√£o </h2><br>  Claro, havia preocupa√ß√µes.  √â f√°cil conquistar o mercado de analisadores no IBM RPG.  N√£o tenho certeza de que existem ferramentas decentes para an√°lise est√°tica dessa linguagem.  No mundo Java, as coisas s√£o completamente diferentes.  J√° existe uma linha de ferramentas para an√°lise est√°tica e, para avan√ßar, voc√™ precisa criar um analisador realmente poderoso e interessante. <br><br>  No entanto, nossa empresa teve experi√™ncia no uso de v√°rias ferramentas para an√°lise est√°tica de Java e temos certeza de que podemos fazer muitas coisas melhor. <br><br>  Al√©m disso, t√≠nhamos uma id√©ia de como usar toda a pot√™ncia do nosso analisador C ++ em um analisador Java.  Mas as primeiras coisas primeiro. <br><br><h2>  √Årvore </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc1/0e0/546/bc10e054614c4a1e6bf2d122659ef7fe.png" alt="Quadro 6"></div><br><br>  Antes de tudo, era necess√°rio decidir como obter√≠amos a √°rvore de sintaxe e o modelo sem√¢ntico. <br><br>  A √°rvore de sintaxe √© o elemento b√°sico em torno do qual o analisador √© constru√≠do.  Ao executar verifica√ß√µes, o analisador se move pela √°rvore de sintaxe e examina seus n√≥s individuais.  Sem essa √°rvore, a an√°lise est√°tica s√©ria √© praticamente imposs√≠vel.  Por exemplo, procurar erros usando express√µes regulares n√£o √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">promissor</a> . <br><br>  Vale a pena notar que apenas uma √°rvore de sintaxe n√£o √© suficiente.  O analisador tamb√©m precisa de informa√ß√µes sem√¢nticas.  Por exemplo, precisamos conhecer os tipos de todos os elementos da √°rvore, poder acessar a declara√ß√£o da vari√°vel etc. <br><br>  Examinamos v√°rias op√ß√µes para obter uma √°rvore de sintaxe e um modelo sem√¢ntico: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ANTLR</a> (com gram√°tica para Java) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JavaParser e JavaSymbolSolver</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASTParser do Eclipse a partir do Eclipse JDT</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Colher</a> </li></ul><br>  Abandonamos a id√©ia de usar o ANTLR quase imediatamente, pois isso complicaria desnecessariamente o desenvolvimento do analisador (a an√°lise sem√¢ntica teria que ser implementada por conta pr√≥pria).  No final, decidimos parar na biblioteca Spoon: <br><br><ul><li> N√£o √© apenas um analisador, mas um ecossistema inteiro - fornece n√£o apenas uma √°rvore de an√°lise, mas tamb√©m oportunidades para an√°lise sem√¢ntica, por exemplo, permite obter informa√ß√µes sobre os tipos de vari√°veis, acessar a declara√ß√£o de vari√°veis, obter informa√ß√µes sobre a classe pai e assim por diante. </li><li>  √â baseado no Eclipse JDT e √© capaz de compilar c√≥digo. </li><li>  Ele suporta a vers√£o mais recente do Java e √© constantemente atualizado. </li><li>  Boa documenta√ß√£o e API clara. </li></ul><br>  Aqui est√° um exemplo de um metamodelo fornecido pelo Spoon e com o qual trabalhamos ao criar regras de diagn√≥stico: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/aa0/794/2bdaa079486dd102f2734eec55221c6f.png" alt="Quadro 10"></div><br><br>  Esse metamodelo corresponde ao seguinte c√≥digo: <br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (a + b) * <span class="hljs-number"><span class="hljs-number">4</span></span>; System.out.println(x); } }</code> </pre> <br>  Uma das coisas boas do Spoon √© que ele simplifica a √°rvore de sintaxe (remover e adicionar n√≥s) para facilitar o trabalho.  Ao mesmo tempo, √© garantida a equival√™ncia sem√¢ntica do metamodelo simplificado do original. <br><br>  Para n√≥s, isso significa, por exemplo, que n√£o precisamos mais nos preocupar em pular colchetes extras ao atravessar uma √°rvore.  Al√©m disso, cada express√£o √© colocada em um bloco, as importa√ß√µes s√£o reveladas e outras simplifica√ß√µes semelhantes s√£o feitas. <br><br>  Por exemplo, um c√≥digo como este: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = ((<span class="hljs-number"><span class="hljs-number">0</span></span>)); (i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>); i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (((<span class="hljs-number"><span class="hljs-number">42</span></span>)));</code> </pre> <br>  ser√° apresentado da seguinte forma: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>; } }</code> </pre> <br>  Com base na √°rvore de sintaxe, √© realizada uma chamada an√°lise baseada em padr√µes.  Esta √© uma busca por erros no c√≥digo fonte de um programa usando padr√µes de c√≥digo de erro conhecidos.  No caso mais simples, o analisador procura lugares que parecem um erro na √°rvore, de acordo com as regras descritas nos diagn√≥sticos correspondentes.  O n√∫mero de tais padr√µes √© grande e sua complexidade pode variar bastante. <br><br>  O exemplo mais simples de um erro detectado pela an√°lise baseada em padr√µes √© o seguinte c√≥digo do projeto jMonkeyEngine: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p.isConnected()) { log.log(Level.FINE, <span class="hljs-string"><span class="hljs-string">"Connection closed:{0}."</span></span>, p); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { log.log(Level.FINE, <span class="hljs-string"><span class="hljs-string">"Connection closed:{0}."</span></span>, p); }</code> </pre> <br>  Os blocos <i>then</i> e <i>else</i> da <i>instru√ß√£o if</i> s√£o os mesmos; provavelmente, h√° um erro l√≥gico. <br><br>  Aqui est√° outro exemplo semelhante do projeto Hive: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Number) { <span class="hljs-comment"><span class="hljs-comment">// widening conversion return ((Number) obj).doubleValue(); } else if (obj instanceof HiveDecimal) { // &lt;= return ((HiveDecimal) obj).doubleValue(); } else if (obj instanceof String) { return Double.valueOf(obj.toString()); } else if (obj instanceof Timestamp) { return new TimestampWritable((Timestamp)obj).getDouble(); } else if (obj instanceof HiveDecimal) { // &lt;= return ((HiveDecimal) obj).doubleValue(); } else if (obj instanceof BigDecimal) { return ((BigDecimal) obj).doubleValue(); }</span></span></code> </pre> <br>  Este c√≥digo cont√©m duas condi√ß√µes id√™nticas em uma sequ√™ncia do formul√°rio <i>if (....) else if (....) else if (....)</i> .  Vale a pena verificar esta se√ß√£o do c√≥digo em busca de um erro l√≥gico ou remover o c√≥digo duplicado. <br><br><h2>  An√°lise de fluxo de dados </h2><br>  Al√©m da √°rvore de sintaxe e do modelo sem√¢ntico, o analisador precisa de um mecanismo para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">analisar o fluxo de dados</a> . <br><br>  A an√°lise do fluxo de dados permite calcular os valores v√°lidos de vari√°veis ‚Äã‚Äãe express√µes em cada ponto do programa e, gra√ßas a isso, encontrar erros.  Chamamos esses valores v√°lidos de valores virtuais. <br><br>  Os valores virtuais s√£o criados para vari√°veis, campos de classe, par√¢metros de m√©todo e outras coisas na primeira men√ß√£o.  Se essa √© uma atribui√ß√£o, o mecanismo de Fluxo de Dados calcula o valor virtual analisando a express√£o √† direita; caso contr√°rio, todo o intervalo v√°lido de valores para esse tipo de vari√°vel √© considerado o valor virtual.  Por exemplo: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// x: [-128..127] { int y = 5; // y: [5] ... }</span></span></span></span></code> </pre> <br>  Sempre que o valor de uma vari√°vel √© alterado, o mecanismo de Fluxo de Dados recalcula o valor virtual.  Por exemplo: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// x: [5] x += 7; // x: [12] ... }</span></span></code> </pre> <br>  O mecanismo de fluxo de dados tamb√©m processa instru√ß√µes de controle: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// x: [-2147483648..2147483647] { if (x &gt; 3) { // x: [4..2147483647] if (x &lt; 10) { // x: [4..9] } } else { // x: [-2147483648..3] } ... }</span></span></span></span></code> </pre> <br>  Neste exemplo, ao inserir a fun√ß√£o, n√£o h√° informa√ß√µes sobre o intervalo de valores da vari√°vel <i>x</i> , portanto, ela √© definida de acordo com o tipo da vari√°vel (de -2147483648 a 2147483647).  Ent√£o o primeiro bloco condicional imp√µe uma restri√ß√£o <i>x</i> &gt; 3, e os intervalos s√£o combinados.  Como resultado, no bloco <i>then</i> o intervalo de valores para <i>x</i> √© de 4 a 2147483647 e no bloco <i>else</i> de -2147483648 a 3. A segunda condi√ß√£o <i>x</i> &lt;10 √© processada da mesma maneira. <br><br>  Al√©m disso, voc√™ deve poder executar c√°lculos puramente simb√≥licos.  O exemplo mais simples: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c)</span></span></span><span class="hljs-function"> </span></span>{ a = c; b = c; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == b) <span class="hljs-comment"><span class="hljs-comment">// &lt;= always true .... }</span></span></code> </pre> <br>  Aqui, a vari√°vel <i>a</i> recebe o valor <i>c</i> , a vari√°vel <i>b</i> tamb√©m recebe o valor <i>c</i> , ap√≥s o qual <i>aeb s√£o</i> comparados.  Nesse caso, para encontrar o erro, lembre-se do peda√ßo de madeira correspondente ao lado direito. <br><br>  Aqui est√° um exemplo um pouco mais complexo com c√°lculos de caracteres: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a &lt; b) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; c) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; a) <span class="hljs-comment"><span class="hljs-comment">// &lt;= always false .... } } }</span></span></code> </pre> <br>  Nesses casos, j√° √© necess√°rio resolver o sistema de desigualdades de forma simb√≥lica. <br><br>  O mecanismo de fluxo de dados ajuda o analisador a encontrar erros que s√£o muito dif√≠ceis de encontrar usando a an√°lise baseada em padr√µes. <br><br>  Esses erros incluem: <br><br><ul><li>  Estouros; </li><li>  Indo para o exterior a matriz; </li><li>  Acesso por refer√™ncia nula ou potencialmente nula; </li><li>  Condi√ß√µes sem sentido (sempre verdadeiro / falso); </li><li>  Vazamentos de mem√≥ria e recursos; </li><li>  Divis√£o por 0; </li><li>  E alguns outros. </li></ul><br>  A an√°lise do fluxo de dados √© especialmente importante ao procurar vulnerabilidades.  Por exemplo, se um determinado programa recebe entrada do usu√°rio, √© prov√°vel que a entrada seja usada para causar uma nega√ß√£o de servi√ßo ou para obter o controle do sistema.  Os exemplos incluem erros que causam estouros de buffer para algumas entradas ou, por exemplo, inje√ß√µes de SQL.  Nos dois casos, para que o analisador est√°tico detecte esses erros e vulnerabilidades, √© necess√°rio monitorar o fluxo de dados e os poss√≠veis valores das vari√°veis. <br><br>  Devo dizer que o mecanismo de an√°lise de fluxo de dados √© um mecanismo complexo e extenso e, neste artigo, abordamos apenas o b√°sico. <br><br>  Vejamos alguns exemplos de erros que podem ser detectados usando o mecanismo de fluxo de dados. <br><br>  Projeto Hive: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] arg1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] arg2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len1 != len2) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= return false; } if (len1 == 0) { return true; } .... if (len1 == len2) { // &lt;= .... } }</span></span></code> </pre> <br>  A condi√ß√£o <i>len1 == len2</i> √© sempre satisfeita, pois a verifica√ß√£o oposta j√° foi realizada acima. <br><br>  Outro exemplo do mesmo projeto: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instances != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= Set&lt;String&gt; oldKeys = new HashSet&lt;&gt;(instances.keySet()); if (oldKeys.removeAll(latestKeys)) { .... } this.instances.keySet().removeAll(oldKeys); this.instances.putAll(freshInstances); } else { this.instances.putAll(freshInstances); // &lt;= }</span></span></code> </pre> <br>  Aqui, no bloco <i>else</i> , a desrefer√™ncia do ponteiro nulo √© garantida.  Nota: aqui as <i>inst√¢ncias</i> s√£o iguais a <i>this.instances</i> . <br><br>  Exemplo do projeto JMonkeyEngine: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertNewtKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key &gt;= <span class="hljs-number"><span class="hljs-number">0x10000</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> key - <span class="hljs-number"><span class="hljs-number">0x10000</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  Aqui, a vari√°vel- <i>chave</i> √© comparada com o n√∫mero 65536, no entanto, √© do tipo <i>curto</i> , e o valor m√°ximo poss√≠vel para o <i>curto</i> √© 32767. Portanto, a condi√ß√£o nunca √© atendida. <br><br>  Um exemplo do projeto Jenkins: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> R </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSomeBuildWithWorkspace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (R b = getLastBuild(); cnt &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; b ! = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; b = b.getPreviousBuild()) { FilePath ws = b.getWorkspace(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ws != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br>  A vari√°vel <i>cnt</i> foi introduzida neste c√≥digo para limitar o n√∫mero de passagens para cinco, mas esqueceu de increment√°-la, como resultado, a verifica√ß√£o √© in√∫til. <br><br><h2>  Mecanismo de anota√ß√£o </h2><br>  Al√©m disso, o analisador precisa de um mecanismo de anota√ß√£o.  Annotations √© um sistema de marca√ß√£o que fornece ao analisador informa√ß√µes adicionais sobre os m√©todos e classes usadas, al√©m do que pode ser obtido analisando sua assinatura.  A marca√ß√£o √© feita manualmente, √© um processo longo e trabalhoso, pois para obter os melhores resultados, √© necess√°rio anotar um grande n√∫mero de classes e m√©todos Java padr√£o.  Tamb√©m faz sentido anotar bibliotecas populares.  Em geral, as anota√ß√µes podem ser consideradas como a base de conhecimento do analisador sobre os contratos de m√©todos e classes padr√£o. <br><br>  Aqui est√° um pequeno exemplo de um erro que pode ser detectado usando anota√ß√µes: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.max(a, a); }</code> </pre> <br>  Neste exemplo, devido a um erro de digita√ß√£o, a mesma vari√°vel foi passada como o segundo argumento para o m√©todo <i>Math.max</i> como o primeiro argumento.  Essa express√£o √© sem sentido e suspeita. <br><br>  Sabendo que os argumentos do m√©todo <i>Math.max</i> sempre devem ser diferentes, o analisador est√°tico poder√° emitir um aviso para esse c√≥digo. <br><br>  No futuro, darei alguns exemplos de nossa marca√ß√£o de classes e m√©todos internos (c√≥digo C ++): <br><br><pre> <code class="cpp hljs">Class(<span class="hljs-string"><span class="hljs-string">"java.lang.Math"</span></span>) - Function(<span class="hljs-string"><span class="hljs-string">"abs"</span></span>, Type::Int32) .Pure() .Set(FunctionClassification::NoDiscard) .Returns(Arg1, [](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Int &amp;v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v.Abs(); }) - Function(<span class="hljs-string"><span class="hljs-string">"max"</span></span>, Type::Int32, Type::Int32) .Pure() .Set(FunctionClassification::NoDiscard) .Requires(NotEquals(Arg1, Arg2) .Returns(Arg1, Arg2, [](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Int &amp;v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Int &amp;v2) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v1.Max(v2); }) Class(<span class="hljs-string"><span class="hljs-string">"java.lang.String"</span></span>, TypeClassification::String) - Function(<span class="hljs-string"><span class="hljs-string">"split"</span></span>, Type::Pointer) .Pure() .Set(FunctionClassification::NoDiscard) .Requires(NotNull(Arg1)) .Returns(Ptr(NotNullPointer)) Class(<span class="hljs-string"><span class="hljs-string">"java.lang.Object"</span></span>) - Function(<span class="hljs-string"><span class="hljs-string">"equals"</span></span>, Type::Pointer) .Pure() .Set(FunctionClassification::NoDiscard) .Requires(NotEquals(This, Arg1)) Class(<span class="hljs-string"><span class="hljs-string">"java.lang.System"</span></span>) - Function(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>, Type::Int32) .Set(FunctionClassification::NoReturn)</code> </pre> <br>  Explica√ß√µes: <br><br><ul><li>  <i>Classe</i> - classe anotada; </li><li>  <i>Fun√ß√£o</i> - m√©todo da classe anotada; </li><li>  <i>Pura</i> - anota√ß√£o mostrando que o m√©todo √© limpo, ou seja,  determin√≠stico e sem efeitos colaterais; </li><li>  <i>Conjunto</i> - definindo um sinalizador arbitr√°rio para o m√©todo. </li><li>  <i>FunctionClassification :: NoDiscard</i> - um sinalizador que significa que o valor de retorno do m√©todo deve ser usado; </li><li>  <i>FunctionClassification :: NoReturn</i> - um sinalizador indicando que o m√©todo n√£o retorna controle; </li><li>  <i>Arg1</i> , <i>Arg2</i> , <i>...</i> , <i>ArgN</i> - argumentos para o m√©todo; </li><li>  <i>Retornos</i> - o valor de retorno do m√©todo; </li><li>  <i>Requer</i> - um contrato para o m√©todo. </li></ul><br>  Vale ressaltar que, al√©m da marca√ß√£o manual, existe outra abordagem para anota√ß√£o - sa√≠da autom√°tica de contratos com base no c√≥digo de bytes.  √â claro que essa abordagem permite exibir apenas certos tipos de contratos, mas possibilita obter informa√ß√µes adicionais em geral de todas as depend√™ncias e n√£o apenas daquelas que foram anotadas manualmente. <br><br>  A prop√≥sito, j√° existe uma ferramenta que pode exibir contratos como <i>@Nullable</i> , <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">NotNull</a></i> baseado em bytecode - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FABA</a> .  Pelo que entendi, o derivado FABA √© usado no IntelliJ IDEA. <br><br>  Agora, tamb√©m estamos considerando adicionar an√°lises de c√≥digo de c√≥digo para obter contratos para todos os m√©todos, pois esses contratos podem muito bem complementar nossas anota√ß√µes manuais. <br><br>  As regras de diagn√≥stico no trabalho geralmente se referem √†s anota√ß√µes.  Al√©m do diagn√≥stico, as anota√ß√µes usam o mecanismo de fluxo de dados.  Por exemplo, usando a anota√ß√£o do m√©todo <i>java.lang.Math.abs</i> , ele pode calcular com precis√£o o valor do m√≥dulo num√©rico.  Ao mesmo tempo, voc√™ n√£o precisa escrever nenhum c√≥digo adicional - basta marcar o m√©todo corretamente. <br><br>  Considere um exemplo de erro do projeto Hibernate que pode ser detectado atrav√©s da anota√ß√£o: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object other)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (other <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Id) { Id that = (Id) other; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> purchaseSequence.equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseSequence) &amp;&amp; that.purchaseNumber == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseNumber; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br>  Nesse c√≥digo, o m√©todo <i>equals ()</i> compara o objeto <i>purchaseSequence</i> com ele pr√≥prio.  Certamente este √© um erro de digita√ß√£o e, √† direita, deve ser <i>isso</i> . <i>Compre a Sequence</i> , n√£o <i>compre a</i> <i>Sequence</i> . <br><br><h2>  Como o Dr. Frankenstein montou um analisador a partir de pe√ßas </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/113/a6a/e05/113a6ae05b7bd0502e1d631746c26ea0.png" alt="Quadro 2"></div><br><br>  Como os mecanismos do fluxo de dados e das anota√ß√µes em si n√£o est√£o muito vinculados a uma linguagem espec√≠fica, foi decidido reutilizar esses mecanismos em nosso analisador C ++.  Isso nos permitiu obter rapidamente todo o poder do n√∫cleo do analisador C ++ em nosso analisador Java.  Al√©m disso, essa decis√£o tamb√©m foi influenciada pelo fato de que esses mecanismos foram escritos em C ++ moderno com um monte de metaprograma√ß√£o e magia de modelo e, portanto, n√£o s√£o muito adequados para a transfer√™ncia para outro idioma. <br><br>  Para associar a parte Java ao kernel C ++, decidimos usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SWIG (Simplified Wrapper and Interface Generator)</a> - uma ferramenta para gerar automaticamente inv√≥lucros e interfaces para vincular programas C e C ++ a programas escritos em outras linguagens.  Para Java, SWIG gera c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JNI (Java Native Interface)</a> . <br><br>  SWIG √© √≥timo para casos em que j√° existe uma grande quantidade de c√≥digo C ++ que precisa ser integrado a um projeto Java. <br><br>  Vou dar um exemplo m√≠nimo de trabalho com o SWIG.  Suponha que tenhamos uma classe C ++ que queremos usar em um projeto Java: <br><br>  CoolClass.h <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolClass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; CoolClass(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printMe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre> <br>  CoolClass.cpp <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include "CoolClass.h" CoolClass::CoolClass(int v) : val(v) {} void CoolClass::printMe() { std::cout &lt;&lt; "val: " &lt;&lt; val &lt;&lt; '\n'; }</span></span></span></span></code> </pre> <br>  Primeiro, voc√™ precisa criar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um arquivo de interface SWIG</a> com uma descri√ß√£o de todas as fun√ß√µes e classes exportadas.  Tamb√©m neste arquivo, se necess√°rio, s√£o feitas configura√ß√µes adicionais. <br><br>  Example.i <br><br><pre> <code class="cpp hljs">%<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> MyModule %{ <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CoolClass.h"</span></span></span><span class="hljs-meta"> %} %</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CoolClass.h"</span></span></span></span></code> </pre> <br>  Depois disso, voc√™ pode executar o SWIG: <br><br><pre> <code class="cpp hljs">$ swig -c++ -java Example.i</code> </pre> <br>  Ir√° gerar os seguintes arquivos: <br><br><ul><li>  CoolClass.java - uma classe com a qual trabalharemos diretamente em um projeto Java; </li><li>  MyModule.java - uma classe de m√≥dulo na qual todas as fun√ß√µes e vari√°veis ‚Äã‚Äãlivres s√£o colocadas; </li><li>  MyModuleJNI.java - wrappers Java; </li><li>  Example_wrap.cxx - wrappers C ++. </li></ul><br>  Agora voc√™ s√≥ precisa adicionar os arquivos .java resultantes ao projeto Java e o arquivo .cxx ao projeto C ++. <br><br>  Por fim, voc√™ precisa compilar o projeto C ++ como uma biblioteca din√¢mica e carreg√°-lo no projeto Java usando <i>System.loadLibary ()</i> : <br><br>  App.java <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibary(<span class="hljs-string"><span class="hljs-string">"example"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ CoolClass obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoolClass(<span class="hljs-number"><span class="hljs-number">42</span></span>); obj.printMe(); } }</code> </pre> <br>  Esquematicamente, isso pode ser representado da seguinte maneira: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/35f/b36/20135fb369602791a32d405f5f1231de.png" alt="Quadro 8"></div><br><br>  Obviamente, em um projeto real, nem tudo √© t√£o simples e voc√™ precisa fazer um pouco mais de esfor√ßo: <br><br><ul><li>  Para usar classes e m√©todos de modelo do C ++, eles devem ser instanciados para todos os par√¢metros de modelo aceitos usando a diretiva <i>% template</i> ; </li><li>  Em alguns casos, pode ser necess√°rio capturar exce√ß√µes lan√ßadas da parte C ++ na parte Java.  Por padr√£o, o SWIG n√£o captura exce√ß√µes do C ++ (ocorre um segfault); no entanto, √© poss√≠vel fazer isso usando a diretiva <i>% exception</i> ; </li><li>  SWIG permite estender o c√≥digo positivo no lado Java usando a diretiva <i>% extend</i> .  Por exemplo, em nosso projeto, adicionamos o <i>m√©todo toString ()</i> aos valores virtuais, para que possamos visualiz√°-los no depurador Java; </li><li>  Para emular o comportamento RAII do C ++, a interface <i>AutoClosable</i> √© implementada em todas as classes de interesse; </li><li>  O mecanismo de diretores permite o uso de polimorfismo entre idiomas; </li><li>  Para tipos que s√£o alocados apenas dentro do C ++ (em seu conjunto de mem√≥rias), construtores e finalizadores s√£o removidos para melhorar o desempenho.  O coletor de lixo ignorar√° esses tipos. </li></ul><br>  Voc√™ pode ler mais sobre todos esses mecanismos na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SWIG</a> . <br><br>  Nosso analisador √© constru√≠do usando gradle, que chama CMake, que, por sua vez, chama SWIG e compila a parte C ++.  Para os programadores, isso acontece quase imperceptivelmente, por isso n√£o experimentamos nenhum inconveniente especial durante o desenvolvimento. <br><br>  O n√∫cleo do nosso analisador C ++ √© constru√≠do no Windows, Linux, macOS, portanto o analisador Java tamb√©m funciona nesses sistemas operacionais. <br><br><h2>  O que √© uma regra de diagn√≥stico? </h2><br>  Os pr√≥prios diagn√≥sticos e o c√≥digo para an√°lise s√£o escritos em Java.  Isso ocorre devido √† intera√ß√£o pr√≥xima com o Spoon.  Cada regra de diagn√≥stico √© um visitante, cujos m√©todos est√£o sobrecarregados, nos quais os elementos de nosso interesse s√£o contornados: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a79/427/b94/a79427b9408443a75477c583be7bdd7e.png" alt="Quadro 9"></div><br>  Por exemplo, a estrutura de diagn√≥stico V6004 se parece com isso: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V6004</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PvsStudioRule</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitCtIf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CtIf ifElement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// if ifElement.thenStatement statement is equivalent to // ifElement.elseStatement statement =&gt; add warning V6004 } }</span></span></code> </pre> <br><h2>  Plugins </h2><br>  Para facilitar a integra√ß√£o do analisador est√°tico ao projeto, desenvolvemos plugins para os sistemas de montagem Maven e Gradle.  O usu√°rio pode apenas adicionar nosso plugin ao projeto. <br><br>  Para Gradle: <br><br><pre> <code class="java hljs">.... apply plugin: com.pvsstudio.PvsStudioGradlePlugin pvsstudio { outputFile = <span class="hljs-string"><span class="hljs-string">'path/to/output.json'</span></span> .... }</code> </pre> <br>  Para Maven: <br><br><pre> <code class="java hljs">.... &lt;plugin&gt; &lt;groupId&gt;com.pvsstudio&lt;/groupId&gt; &lt;artifactId&gt;pvsstudio-maven-plugin&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">0.1</span></span>&lt;/version&gt; &lt;configuration&gt; &lt;analyzer&gt; &lt;outputFile&gt;path/to/output.json&lt;/outputFile&gt; .... &lt;/analyzer&gt; &lt;/configuration&gt; &lt;/plugin&gt;</code> </pre> <br>  Depois disso, o plug-in receber√° independentemente a estrutura do projeto e iniciar√° a an√°lise. <br><br>  Al√©m disso, desenvolvemos um prot√≥tipo de plug-in para o IntelliJ IDEA. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/383/e20/908/383e209083b59831ec5cb84945704752.png" alt="Quadro 1"></div><br>  Este plugin tamb√©m funciona no Android Studio. <br><br>  Um plugin para Eclipse est√° atualmente em desenvolvimento. <br><br><h2>  An√°lise incremental </h2><br>  Fornecemos um modo de an√°lise incremental que permite verificar apenas arquivos modificados e, assim, reduzir significativamente o tempo necess√°rio para a an√°lise de c√≥digo.  Gra√ßas a isso, os desenvolvedores poder√£o executar a an√°lise quantas vezes forem necess√°rias. <br><br>  A an√°lise incremental inclui v√°rias etapas: <br><br><ul><li>  Armazenamento em cache do metamodelo da colher; </li><li>  Reconstruindo a parte alterada do metamodelo; </li><li>  An√°lise de arquivos alterados. </li></ul><br><h2>  Nosso sistema de teste </h2><br>  Para testar o analisador Java em projetos reais, escrevemos um kit de ferramentas especial que permite trabalhar com o banco de dados de projetos abertos.  Foi escrito em ^ W Python + Tkinter e √© multiplataforma. <br><br>  Funciona da seguinte maneira: <br><br><ul><li>  O projeto de teste de uma vers√£o espec√≠fica √© baixado do reposit√≥rio no GitHub; </li><li>  O projeto est√° sendo montado; </li><li>  Nosso plugin √© adicionado ao <i>pom.xml</i> ou <i>build.gradle</i> (usando git apply); </li><li>  O analisador est√°tico √© iniciado usando o plug-in; </li><li>  O relat√≥rio resultante √© comparado com a refer√™ncia deste projeto. </li></ul><br>  Essa abordagem garante que boas respostas n√£o sejam perdidas como resultado da altera√ß√£o do c√≥digo do analisador.  Abaixo est√° a interface do nosso utilit√°rio de teste. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f3/a8a/3e1/4f3a8a3e1a356cdf4df865d1e3b50417.png" alt="Quadro 11"></div><br>  Os projetos em relat√≥rios que apresentam diferen√ßas com o padr√£o s√£o marcados em vermelho.  O bot√£o Aprovar permite salvar a vers√£o atual do relat√≥rio como refer√™ncia. <br><br><h2>  Exemplos de erro </h2><br>  Por tradi√ß√£o, citarei v√°rios erros de v√°rios projetos abertos que nosso analisador Java encontrou.  No futuro, est√° planejado escrever artigos com um relat√≥rio mais detalhado sobre cada projeto. <br><br><h3>  Projeto Hibernate </h3><br>  <b>PVS-Studio Warning:</b> V6009 A fun√ß√£o 'igual' recebe argumentos √≠mpares.  Inspecione argumentos: this, 1. PurchaseRecord.java 57 <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object other)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (other <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Id) { Id that = (Id) other; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> purchaseSequence.equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseSequence) &amp;&amp; that.purchaseNumber == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseNumber; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br>  Nesse c√≥digo, o m√©todo <i>equals ()</i> compara o objeto <i>purchaseSequence</i> com ele pr√≥prio.  Provavelmente, esse √© um erro de digita√ß√£o e, √† direita, deve ser <i>isso</i> . <i>BuySequence</i> , n√£o <i>purchaseSequence</i> . <br><br>  <b>PVS-Studio Warning:</b> V6009 A fun√ß√£o 'igual' recebe argumentos √≠mpares.  Inspecione argumentos: this, 1. ListHashcodeChangeTest.java 232 <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeBook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String title)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( Iterator&lt;Book&gt; it = books.iterator(); it.hasNext(); ) { Book book = it.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( title.equals( title ) ) { it.remove(); } } }</code> </pre> <br>  Uma <i>opera√ß√£o</i> semelhante √† anterior - √† direita deve ser <i>book.title</i> , n√£o <i>title</i> . <br><br><h3>  Colmeia do projeto </h3><br>  Aviso do <b>PVS-Studio:</b> A express√£o V6007 'colOrScalar1.equals ("Column")' √© sempre falsa.  GenVectorCode.java 2768 <br><br>  Aviso do <b>PVS-Studio:</b> A express√£o V6007 'colOrScalar1.equals ("Scalar")' √© sempre falsa.  GenVectorCode.java 2774 <br><br>  Aviso do <b>PVS-Studio:</b> A express√£o V6007 'colOrScalar1.equals ("Column")' √© sempre falsa.  GenVectorCode.java 2785 <br><br><pre> <code class="java hljs">String colOrScalar1 = tdesc[<span class="hljs-number"><span class="hljs-number">4</span></span>]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Col"</span></span>) &amp;&amp; colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Column"</span></span>)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Col"</span></span>) &amp;&amp; colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Scalar"</span></span>)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Scalar"</span></span>) &amp;&amp; colOrScalar1.equals(<span class="hljs-string"><span class="hljs-string">"Column"</span></span>)) { .... }</code> </pre> <br>  Os operadores est√£o claramente confusos aqui e em vez de ' <i>||'</i>  usado ' <i>&amp;&amp;'</i> . <br><br><h3>  Projeto JavaParser </h3><br>  Aviso do <b>PVS-Studio:</b> V6001 Existem sub-express√µes id√™nticas 'tokenRange.getBegin (). GetRange (). IsPresent ()' √† esquerda e √† direita do operador '&amp;&amp;'.  Node.java 213 <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Node </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTokenRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TokenRange tokenRange)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tokenRange = tokenRange; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenRange == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !(tokenRange.getBegin().getRange().isPresent() &amp;&amp; tokenRange.getBegin().getRange().isPresent())) { range = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { range = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Range( tokenRange.getBegin().getRange().get().begin, tokenRange.getEnd().getRange().get().end); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br>  O analisador descobriu que as mesmas express√µes est√£o √† esquerda e √† direita do operador <i>&amp;&amp;</i> (enquanto todos os m√©todos da cadeia de chamadas est√£o limpos).  Provavelmente, no segundo caso, √© necess√°rio usar <i>tokenRange.getEnd ()</i> e n√£o <i>tokenRange.getBegin ()</i> . <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V6016 Acesso suspeito ao elemento do objeto 'typeDeclaration.getTypeParameters ()' por um √≠ndice constante dentro de um loop. </font><font style="vertical-align: inherit;">ResolvedReferenceType.java 265</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isRawType()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;typeDeclaration.getTypeParams().size(); i++) { typeParametersMap.add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;&gt;(typeDeclaration.getTypeParams().get(<span class="hljs-number"><span class="hljs-number">0</span></span>), typeParametersValues().get(i))); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador detectou acesso suspeito ao item de cole√ß√£o em um √≠ndice constante dentro do loop. </font><font style="vertical-align: inherit;">Pode haver um erro neste c√≥digo.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jenkins Project </font></font></h3><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do </font><b><font style="vertical-align: inherit;">PVS-Studio:</font></b><font style="vertical-align: inherit;"> A express√£o V6007 'cnt &lt;5' sempre √© verdadeira. </font><font style="vertical-align: inherit;">AbstractProject.java 557</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> R </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSomeBuildWithWorkspace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (R b = getLastBuild(); cnt &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; b ! = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; b = b.getPreviousBuild()) { FilePath ws = b.getWorkspace(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ws != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cnt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi introduzida neste c√≥digo </font><font style="vertical-align: inherit;">para limitar o n√∫mero de passagens para cinco, mas esqueceu de increment√°-la, como resultado, a verifica√ß√£o √© in√∫til.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projeto Spark </font></font></h3><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do </font><b><font style="vertical-align: inherit;">PVS-Studio:</font></b><font style="vertical-align: inherit;"> A express√£o V6007 'sparkApplications! = Null' sempre √© verdadeira. </font><font style="vertical-align: inherit;">SparkFilter.java 127</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringUtils.isNotBlank(applications)) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String[] sparkApplications = applications.split(<span class="hljs-string"><span class="hljs-string">","</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sparkApplications != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; sparkApplications.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { ... } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A verifica√ß√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultado retornado pelo m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">split</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o faz sentido, pois esse m√©todo sempre retorna uma cole√ß√£o e nunca retorna </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projeto Colher </font></font></h3><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do </font><b><font style="vertical-align: inherit;">PVS-Studio:</font></b><font style="vertical-align: inherit;"> V6001 Existem sub-express√µes id√™nticas '! M.getSimpleName (). StartsWith ("set")' √† esquerda e √† direita do operador '&amp;&amp;'. </font><font style="vertical-align: inherit;">SpoonTestHelpers.java 108</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m.getSimpleName().startsWith(<span class="hljs-string"><span class="hljs-string">"set"</span></span>) &amp;&amp; !m.getSimpleName().startsWith(<span class="hljs-string"><span class="hljs-string">"set"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse c√≥digo, as mesmas express√µes est√£o √† esquerda e √† direita do operador &amp;&amp; (todos os m√©todos na cadeia de chamadas est√£o limpos). </font><font style="vertical-align: inherit;">Provavelmente, o c√≥digo cont√©m um erro l√≥gico. </font><font style="vertical-align: inherit;">Aviso do </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A express√£o V6007 'idxOfScopeBoundTypeParam&gt; = 0' sempre √© verdadeira. </font><font style="vertical-align: inherit;">MethodTypingContext.java 243</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSameMethodFormalTypeParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idxOfScopeBoundTypeParam = getIndexOfTypeParam(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idxOfScopeBoundTypeParam &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= int idxOfSuperBoundTypeParam = getIndexOfTypeParam(....); if (idxOfScopeBoundTypeParam &gt;= 0) { // &lt;= return idxOfScopeBoundTypeParam == idxOfSuperBoundTypeParam; } } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui eles selaram na segunda condi√ß√£o e, em vez de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idxOfSuperBoundTypeParam,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreveram </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idxOfScopeBoundTypeParam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projeto de Seguran√ßa da Primavera </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V6001 Existem subexpress√µes id√™nticas √† esquerda e √† direita do '||' </font><font style="vertical-align: inherit;">operador. </font><font style="vertical-align: inherit;">Verifique as linhas: 38, 39. AnyRequestMatcher.java 38</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"deprecation"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AnyRequestMatcher || obj <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> security.web.util.matcher.AnyRequestMatcher; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A opera√ß√£o √© semelhante √† anterior - aqui o nome da mesma classe √© escrito de maneiras diferentes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V6006 O objeto foi criado, mas n√£o est√° sendo usado. </font><font style="vertical-align: inherit;">A palavra-chave 'throw' pode estar ausente. </font><font style="vertical-align: inherit;">DigestAuthenticationFilter.java 434</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!expectedNonceSignature.equals(nonceTokens[<span class="hljs-number"><span class="hljs-number">1</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BadCredentialsException( DigestAuthenticationFilter.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messages .getMessage(<span class="hljs-string"><span class="hljs-string">"DigestAuthenticationFilter.nonceCompromised"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[] { nonceAsPlainText }, <span class="hljs-string"><span class="hljs-string">"Nonce token compromised {0}"</span></span>)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse c√≥digo, eles esqueceram de adicionar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">throw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> antes da exce√ß√£o. </font><font style="vertical-align: inherit;">Como resultado, o objeto de exce√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BadCredentialsException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">lan√ßado</font></i><font style="vertical-align: inherit;"> , mas n√£o √© usado de forma alguma, ou seja, </font><font style="vertical-align: inherit;">uma exce√ß√£o n√£o √© lan√ßada. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V6030 O m√©todo localizado √† direita do '|' </font><font style="vertical-align: inherit;">operadores ser√£o chamados independentemente do valor do operando esquerdo. </font><font style="vertical-align: inherit;">Talvez seja melhor usar '||'. </font><font style="vertical-align: inherit;">RedirectUrlBuilder.java 38</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setScheme</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String scheme)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-string"><span class="hljs-string">"http"</span></span>.equals(scheme) | <span class="hljs-string"><span class="hljs-string">"https"</span></span>.equals(scheme))) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scheme = scheme; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse c√≥digo, o uso do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">injustificado, pois ao us√°-lo, o lado direito ser√° calculado mesmo se o lado esquerdo j√° for verdadeiro. </font><font style="vertical-align: inherit;">Nesse caso, isso n√£o faz sentido pr√°tico; portanto, o operador </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vale a pena substituir por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">||</font></font></i>  . <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projeto IntelliJ IDEA </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V6008 Desrefer√™ncia nula potencial de 'editor'. </font><font style="vertical-align: inherit;">IntroduceVariableBase.java:609</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PsiElement nameSuggestionContext = editor == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : file.findElementAt(...); <span class="hljs-comment"><span class="hljs-comment">// &lt;= final RefactoringSupportProvider supportProvider = LanguageRefactoringSupport.INSTANCE.forLanguage(...); final boolean isInplaceAvailableOnDataContext = supportProvider != null &amp;&amp; editor.getSettings().isVariableInplaceRenameEnabled() &amp;&amp; // &lt;= ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador detectou que nesse c√≥digo pode ocorrer desrefer√™ncia do ponteiro nulo do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vale a pena adicionar um cheque adicional. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A express√£o V6007 √© sempre falsa. </font><font style="vertical-align: inherit;">RefResolveServiceImpl.java:814</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull VirtualFile file)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> &amp; !myProjectFileIndex.isUnderSourceRootOfType(....); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â dif√≠cil para mim dizer o que o autor tinha em mente, mas esse c√≥digo parece muito suspeito. </font><font style="vertical-align: inherit;">Mesmo que de repente n√£o haja nenhum erro aqui, acho que vale a pena reescrever este local para n√£o confundir o analisador e outros programadores. </font><font style="vertical-align: inherit;">Aviso do </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A express√£o V6007 'resultado [0]' √© sempre falsa. </font><font style="vertical-align: inherit;">CopyClassesHandler.java:298</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>[] {<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>}; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Runnable command = () -&gt; { PsiDirectory target; if (targetDirectory instanceof PsiDirectory) { target = (PsiDirectory)targetDirectory; } else { target = WriteAction.compute(() -&gt; ((MoveDestination)targetDirectory).getTargetDirectory( defaultTargetDirectory)); } try { Collection&lt;PsiFile&gt; files = doCopyClasses(classes, map, copyClassName, target, project); if (files != null) { if (openInEditor) { for (PsiFile file : files) { CopyHandler.updateSelectionInActiveProjectView( file, project, selectInActivePanel); } EditorHelper.openFilesInEditor( files.toArray(PsiFile.EMPTY_ARRAY)); } } } catch (IncorrectOperationException ex) { Messages.showMessageDialog(project, ex.getMessage(), RefactoringBundle.message("error.title"), Messages.getErrorIcon()); } }; CommandProcessor processor = CommandProcessor.getInstance(); processor.executeCommand(project, command, commandName, null); if (result[0]) { // &lt;= ToolWindowManager.getInstance(project).invokeLater(() -&gt; ToolWindowManager.getInstance(project) .activateEditorComponent()); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu suspeito que aqui eles esqueceram de alguma forma alterar o valor no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resultado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por esse motivo, o analisador relata que verificar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se (resultado [0])</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© in√∫til.</font></font><br><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A dire√ß√£o do Java √© muito vers√°til - √© desktop, android, web e muito mais, por isso temos muito espa√ßo para atividades. </font><font style="vertical-align: inherit;">Antes de tudo, √© claro, vamos desenvolver as √°reas que ser√£o mais procuradas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√£o nossos planos para o futuro pr√≥ximo:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anota√ß√µes de sa√≠da baseadas em bytecode; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Integra√ß√£o em projetos no Ant (algu√©m o usa em 2018?); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plugin para Eclipse (em desenvolvimento); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainda mais diagn√≥sticos e anota√ß√µes; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Melhorando o mecanismo do fluxo de dados. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sugiro tamb√©m aqueles que desejam participar do teste da vers√£o alfa do nosso analisador Java, quando ela estiver dispon√≠vel. </font><font style="vertical-align: inherit;">Para fazer isso, escreva-nos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em suporte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Adicionaremos seu contato √† lista e escreveremos para voc√™ quando prepararmos a primeira vers√£o alfa.</font></font><br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Egor Bredikhin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvimento de um novo analisador est√°tico:</font></font></a> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ leu o artigo e tem uma pergunta?</font></font></b> <div class="spoiler_text">          .      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      PVS-Studio,  2015</a> . ,   . </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414669/">https://habr.com/ru/post/pt414669/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414655/index.html">Roteador virtual DD-WRT x86 no VirtualBox</a></li>
<li><a href="../pt414657/index.html">Protocolo AMF3 perigoso</a></li>
<li><a href="../pt414661/index.html">O ve√≠culo de lan√ßamento Soyuz-5SL funcionar√° com motores de estilo sovi√©tico</a></li>
<li><a href="../pt414663/index.html">Burnout profissional: uma palavra para especialistas</a></li>
<li><a href="../pt414667/index.html">[Tema de mini-f√£] Tabela do campeonato da FIFA no terminal</a></li>
<li><a href="../pt414673/index.html">N√£o √© mais Abibas: o milagre tecnol√≥gico da China</a></li>
<li><a href="../pt414675/index.html">Carreira de gerente de TI: da linha de comando ao trabalho em equipe</a></li>
<li><a href="../pt414677/index.html">Comandos r√°pidos do Siri</a></li>
<li><a href="../pt414679/index.html">Box-shadows.css</a></li>
<li><a href="../pt414683/index.html">A hist√≥ria da cria√ß√£o de um aplicativo m√≥vel para crian√ßas que permite que voc√™ ganhe dinheiro com sua mente. Continua√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>