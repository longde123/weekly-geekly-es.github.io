<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèª üßòüèª üåú Dart 2. Programmation asynchrone: futurs üêæ üôãüèΩ üë≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Programmation asynchrone: futurs 


 Table des mati√®res 


- Pr√©sentation 
- Quel avenir? 
- Async - attendre Gestion des erreurs Ex√©cution s√©quentiel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dart 2. Programmation asynchrone: futurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442282/"><h1 id="asinhronnoe-programmirovanie-futures">  Programmation asynchrone: futurs </h1><br><p>  <strong>Table des mati√®res</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©sentation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quel avenir?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Async - attendre</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion des erreurs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ex√©cution s√©quentielle</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Future API</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion des erreurs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Appeler plusieurs fonctions pour retourner le futur</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que lire d'autre?</a> </li></ul><br><p>  <strong>Ce qui est important:</strong> </p><br><ul><li>  Le code dans Dart s'ex√©cute dans une seule ex√©cution de thread ( <em>notez thread - thread</em> ). </li><li>  En raison du code qui prend (bloque) le thread pendant une longue p√©riode, le programme peut se bloquer. </li><li> <code>Future</code> objets <code>Future</code> ( <code>futures</code> ) repr√©sentent les r√©sultats d'op√©rations asynchrones - traitement ou E / S, qui seront termin√©es plus tard. </li><li>  Pour suspendre l'ex√©cution jusqu'√† la fin dans le futur, utilisez <code>await</code> dans la fonction asynchrone (ou <code>then()</code> lorsque vous utilisez la <code>Future</code> API). </li><li>  Pour intercepter les erreurs, utilisez la construction <code>try-catch</code> (ou <code>catchError()</code> lors de l'utilisation de l'API <code>Future</code> ) dans la fonction asynchrone. </li><li>  Pour un traitement simultan√©, cr√©ez un isolat (ou un travailleur pour l'application Web). <a name="habracut"></a></li></ul><br><p>  Le code dans Dart s'ex√©cute dans un seul thread d'ex√©cution.  Si le code est occup√© par de longs calculs ou attend une op√©ration d'E / S, l'ensemble du programme est suspendu. </p><br><p>  Les op√©rations asynchrones permettent √† votre programme d'effectuer d'autres t√¢ches en attendant la fin de l'op√©ration.  Dart utilise des <code>futures</code> pour pr√©senter les r√©sultats des op√©rations asynchrones.  Vous pouvez √©galement utiliser async et wait ou l'API Future pour travailler avec les <code>futures</code> . </p><br><p>  <em>Une note</em> </p><br><blockquote>  Tout le code est ex√©cut√© dans le contexte de l'isolat, qui poss√®de toute la m√©moire utilis√©e par le code.  Plusieurs ex√©cutions de code ne peuvent pas √™tre d√©marr√©es dans le m√™me isolat. <br><br>  Pour l'ex√©cution parall√®le de blocs de code, vous pouvez les s√©parer en isolats distincts.  (Les applications Web utilisent des travailleurs au lieu des isolats.) En g√©n√©ral, chacun des isolats s'ex√©cute sur son propre c≈ìur de processeur.  Les isolats ne partagent pas la m√©moire et la seule fa√ßon d'interagir est de s'envoyer des messages.  Pour plonger dans le sujet, consultez la documentation des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">isolats</a> ou des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">travailleurs</a> . </blockquote><br><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  Regardons un exemple de code qui peut ¬´geler¬ª l'ex√©cution du programme: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Synchronous code void printDailyNewsDigest() { var newsDigest = gatherNewsReports(); // Can take a while. print(newsDigest); } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); }</span></span></code> </pre> <br><p>  Notre programme lit les nouvelles du fichier de la journ√©e, les affiche, puis affiche les informations qui int√©ressent toujours l'utilisateur: </p><br><pre> <code class="plaintext hljs">&lt;gathered news goes here&gt; Winning lotto numbers: [23, 63, 87, 26, 2] Tomorrow's forecast: 70F, sunny. Baseball score: Red Sox 10, Yankees 0</code> </pre> <br><p>  Dans cet exemple, le probl√®me est que toutes les op√©rations apr√®s avoir appel√© <code>gatherNewsReports()</code> attendront jusqu'√† <code>gatherNewsReports()</code> que <code>gatherNewsReports()</code> renvoie le contenu du fichier, quel que soit le temps qu'il prend.  Si la lecture du fichier prend du temps, l'utilisateur sera oblig√© d'attendre les r√©sultats de la loterie, les pr√©visions m√©t√©o et le vainqueur d'une partie r√©cente. </p><br><p>  Pour maintenir la r√©activit√© des applications, les auteurs de Dart utilisent un mod√®le asynchrone pour identifier les fonctions qui effectuent des travaux potentiellement co√ªteux.  Ces fonctions renvoient leur valeur en utilisant des <code>futures</code> √† <code>futures</code> . </p><br><h2 id="chto-takoe-future">  Quel avenir? </h2><br><p>  <code>future</code> est une instance de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Future &lt;T&gt;</a> , qui est une op√©ration asynchrone qui renvoie un r√©sultat de type T. Si le r√©sultat de l'op√©ration n'est pas utilis√©, le type de <code>future</code> indiqu√© par <code>Future&lt;void&gt;</code> .  Lors de l'appel d'une fonction qui retourne <code>future</code> , deux choses se produisent: </p><br><ol><li>  La fonction est en attente d'ex√©cution et renvoie un objet <code>Future</code> incomplet. </li><li>  Plus tard, lorsque l'op√©ration est termin√©e, le <code>future</code> termine avec une valeur ou une erreur. </li></ol><br><p>  Pour √©crire du code d√©pendant du <code>future</code> , vous avez deux options: </p><br><ul><li>  Utiliser <code>async</code> - <code>await</code> </li><li>  Utiliser <code>Future</code> API </li></ul><br><h2 id="async---await">  Async - attendre </h2><br><p>  Les mots cl√©s <code>async</code> et en <code>await</code> font partie de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prise en charge</a> <code>async</code> de Dart.  Ils vous permettent d'√©crire du code asynchrone qui ressemble √† du code synchrone et n'utilise pas l'API <code>Future</code> .  <em>Une fonction asynchrone</em> est une fonction avec le mot-cl√© <code>async</code> devant son corps.  Le mot-cl√© <code>await</code> ne fonctionne que dans les fonctions asynchrones. </p><br><blockquote>  Remarque: dans Dart 1.x, les fonctions asynchrones retardent imm√©diatement l'ex√©cution.  Dans Dart 2, au lieu de s'arr√™ter imm√©diatement, les fonctions asynchrones s'ex√©cutent de mani√®re synchrone jusqu'√† la premi√®re <code>await</code> ou <code>return</code> . </blockquote><p>  Le code suivant simule la lecture de nouvelles √† partir d'un fichier en utilisant <code>async</code> - <code>await</code> .  Ouvrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DartPad avec l'application</a> , lancez et cliquez sur CONSOLE pour voir le r√©sultat. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Copyright (c) 2013, the Dart project authors. Please see the AUTHORS file // for details. All rights reserved. Use of this source code is governed by a // BSD-style license that can be found in the LICENSE file. import 'dart:async'; Future&lt;void&gt; printDailyNewsDigest() async { var newsDigest = await gatherNewsReports(); print(newsDigest); } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); } printWinningLotteryNumbers() { print('Winning lotto numbers: [23, 63, 87, 26, 2]'); } printWeatherForecast() { print("Tomorrow's forecast: 70F, sunny."); } printBaseballScore() { print('Baseball score: Red Sox 10, Yankees 0'); } const news = '&lt;gathered news goes here&gt;'; const oneSecond = Duration(seconds: 1); // Imagine that this function is more complex and slow. :) Future&lt;String&gt; gatherNewsReports() =&gt; Future.delayed(oneSecond, () =&gt; news); // Alternatively, you can get news from a server using features // from either dart:io or dart:html. For example: // // import 'dart:html'; // // Future&lt;String&gt; gatherNewsReportsFromServer() =&gt; HttpRequest.getString( // 'https://www.dartlang.org/f/dailyNewsDigest.txt', // );</span></span></code> </pre> </div></div><br><p>  Notez que nous appelons d'abord <code>printDailyNewsDigest()</code> , mais les nouvelles sont imprim√©es en dernier, m√™me si le fichier ne contient qu'une seule ligne.  Cela est d√ª au fait que le code qui lit et imprime le fichier s'ex√©cute de mani√®re asynchrone. </p><br><p>  Dans cet exemple, <code>printDailyNewsDigest()</code> effectue un appel √† <code>gatherNewsReports()</code> , qui n'est pas bloquant.  L'appel de la m√©thode <code>gatherNewsReports()</code> travail en <code>gatherNewsReports()</code> , mais n'emp√™che pas le reste du code de s'ex√©cuter.  Le programme affiche les num√©ros de loterie, les pr√©visions et le score d'un match de baseball;  Le programme imprime les nouvelles une fois la collecte de <code>gatherNewsReports()</code> .  Si <code>gatherNewsReports()</code> prend un certain temps pour terminer son travail, rien de mal ne se produit: l'utilisateur peut lire d'autres choses avant l'impression du r√©sum√© des nouvelles quotidiennes. </p><br><p>  Faites attention aux types de retour.  Le type de retour de la fonction <code>gatherNewsReports()</code> est <code>Future&lt;String&gt;</code> , ce qui signifie qu'elle renvoie un <code>future</code> qui se termine par une valeur de cha√Æne.  La fonction <code>printDailyNewsDigest()</code> , qui ne renvoie pas de valeur, a un type de retour <code>Future&lt;void&gt;</code> . </p><br><p>  Le diagramme suivant montre les √©tapes d'ex√©cution du code. </p><br><p><img src="https://habrastorage.org/webt/cs/ez/9h/csez9hgmhhk6r1fyu8c4jryuydi.png"></p><br><ol><li>  L'application d√©marre. </li><li>  La fonction <code>main()</code> est <code>printDailyNewsDigest()</code> fonction asynchrone <code>printDailyNewsDigest()</code> , qui commence √† s'ex√©cuter de mani√®re synchrone. </li><li>  <code>printDailyNewsDigest()</code> utilise <code>printDailyNewsDigest()</code> pour appeler la fonction de <code>gatherNewsReports()</code> , qui commence √† s'ex√©cuter. </li><li>  <code>gatherNewsReports()</code> renvoie un <code>future</code> inachev√© (une instance de <code>Future&lt;String&gt;</code> ). </li><li>  √âtant donn√© que <code>printDailyNewsDigest()</code> est une fonction asynchrone et attend une valeur, elle suspend l'ex√©cution et renvoie le <code>future</code> inachev√© <code>future</code> <code>main ()</code> (dans ce cas, une instance de <code>Future&lt;void&gt;</code> ). </li><li>  Les autres fonctions de sortie sont ex√©cut√©es.  Comme ils sont synchrones, chaque fonction est ex√©cut√©e compl√®tement avant de passer √† la suivante.  Par exemple, tous les num√©ros de loterie gagnants seront affich√©s avant les pr√©visions m√©t√©orologiques. </li><li>  Une fois la fonction <code>main()</code> termin√©e <code>main()</code> les fonctions asynchrones peuvent reprendre leur ex√©cution.  Tout d'abord, nous obtenons l' <code>future</code> avec des nouvelles sur l'ach√®vement de <code>gatherNewsReports()</code> .  Puis <code>printDailyNewsDigest()</code> continue son ex√©cution, affichant les nouvelles. </li><li>  √Ä la fin de l'ex√©cution de <code>printDailyNewsDigest()</code> , l' <code>future</code> initialement re√ßu <code>future</code> et l'application se ferme. </li></ol><br><p>  Notez que la fonction asynchrone d√©marre imm√©diatement (de mani√®re synchrone).  La fonction suspend l'ex√©cution et renvoie un <code>future</code> inachev√© lorsque la premi√®re occurrence de l'un des √©v√©nements suivants se produit: </p><br><ul><li>  La premi√®re expression en <code>await</code> (apr√®s que la fonction obtient l' <code>future</code> incomplet de cette expression). </li><li>  Toute <code>return</code> dans une fonction. </li><li>  La fin du corps de fonction. </li></ul><br><h3 id="obrabotka-oshibok">  Gestion des erreurs </h3><br><p>  Vous aimeriez tr√®s probablement "attraper" une erreur dans l'ex√©cution de la fonction qui retourne le <code>future</code> .  Dans les fonctions asynchrones, vous pouvez g√©rer les erreurs √† l'aide de <code>try-catch</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> async </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newsDigest = <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gatherNewsReports</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; print(newsDigest); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-comment"><span class="hljs-comment">// Handle error... } }</span></span></code> </pre> <br><p>  Un <code>try-catch</code> avec du code asynchrone se comporte de la m√™me mani√®re qu'avec le code synchrone: si le code du bloc <code>try</code> une exception, le code √† l'int√©rieur de <code>catch</code> est ex√©cut√©. </p><br><h3 id="posledovatelnoe-vypolnenie">  Ex√©cution s√©quentielle </h3><br><p>  Vous pouvez utiliser plusieurs expressions d' <code>await</code> pour vous assurer que chaque instruction se termine avant d'ex√©cuter les op√©rations suivantes: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Sequential processing using async and await. main() async { await expensiveA(); await expensiveB(); doSomethingWith(await expensiveC()); }</span></span></code> </pre> <br><p>  <code>expensiveB()</code> n'est pas ex√©cut√©e avant la fin de <code>expensiveA()</code> , etc. </p><br><h2 id="future-api">  Future API </h2><br><p>  Avant d'ajouter <code>async</code> et <code>async</code> dans Dart 1.9, vous deviez utiliser l'API <code>Future</code> .  Vous pouvez toujours voir l'utilisation de l'API <code>Future</code> dans l'ancien code et dans le code qui a besoin de plus de fonctionnalit√©s <code>async‚Äìawait</code> a √† offrir. </p><br><p>  Pour √©crire du code asynchrone √† l'aide de l'API <code>Future</code> , utilisez la m√©thode <code>then()</code> pour enregistrer le rappel.  Ce rappel fonctionnera lorsque le <code>future</code> termin√©. </p><br><p>  Le code suivant simule la lecture des actualit√©s d'un fichier √† l'aide de l'API <code>Future</code> .  Ouvrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DartPad avec l'application</a> , lancez et cliquez sur CONSOLE pour voir le r√©sultat. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Copyright (c) 2013, the Dart project authors. Please see the AUTHORS file // for details. All rights reserved. Use of this source code is governed by a // BSD-style license that can be found in the LICENSE file. import 'dart:async'; Future&lt;void&gt; printDailyNewsDigest() { final future = gatherNewsReports(); return future.then(print); // You don't *have* to return the future here. // But if you don't, callers can't await it. } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); } printWinningLotteryNumbers() { print('Winning lotto numbers: [23, 63, 87, 26, 2]'); } printWeatherForecast() { print("Tomorrow's forecast: 70F, sunny."); } printBaseballScore() { print('Baseball score: Red Sox 10, Yankees 0'); } const news = '&lt;gathered news goes here&gt;'; const oneSecond = Duration(seconds: 1); // Imagine that this function is more complex and slow. :) Future&lt;String&gt; gatherNewsReports() =&gt; Future.delayed(oneSecond, () =&gt; news); // Alternatively, you can get news from a server using features // from either dart:io or dart:html. For example: // // import 'dart:html'; // // Future&lt;String&gt; gatherNewsReportsFromServer() =&gt; HttpRequest.getString( // 'https://www.dartlang.org/f/dailyNewsDigest.txt', // );</span></span></code> </pre> </div></div><br><p>  Notez que nous appelons d'abord <code>printDailyNewsDigest()</code> , mais les nouvelles sont imprim√©es en dernier, m√™me si le fichier ne contient qu'une seule ligne.  Cela est d√ª au fait que le code qui lit et imprime le fichier s'ex√©cute de mani√®re asynchrone. </p><br><p>  Cette application s'ex√©cute comme suit: </p><br><ol><li>  L'application d√©marre. </li><li>  La fonction principale appelle <code>printDailyNewsDigest()</code> , qui ne renvoie pas le r√©sultat imm√©diatement, mais appelle d'abord la fonction <code>gatherNewsReports()</code> . </li><li>  <code>gatherNewsReports()</code> commence √† lire les nouvelles et retourne dans le <code>future</code> . </li><li>  <code>printDailyNewsDigest()</code> utilise <code>then()</code> pour enregistrer un rappel qui prendra en param√®tre la valeur obtenue √† la fin du <code>future</code> .  L'appel <code>then()</code> renvoie un nouvel <code>future</code> , qui se termine par la valeur renvoy√©e par le rappel de <code>then()</code> . </li><li>  Les autres fonctions de sortie sont ex√©cut√©es.  Comme ils sont synchrones, chaque fonction est ex√©cut√©e compl√®tement avant de passer √† la suivante.  Par exemple, tous les num√©ros de loterie gagnants seront affich√©s avant les pr√©visions m√©t√©orologiques. </li><li>  Lorsque toutes les nouvelles ont √©t√© re√ßues, l' <code>future</code> renvoy√© par la fonction <code>gatherNewsReports()</code> se termine par une cha√Æne contenant les nouvelles collect√©es. </li><li>  Le code sp√©cifi√© dans <code>then()</code> dans <code>printDailyNewsDigest()</code> est ex√©cut√© pour <code>printDailyNewsDigest()</code> nouvelles. </li><li>  L'application se ferme. </li></ol><br><blockquote>  Remarque: dans la fonction <code>printDailyNewsDigest()</code> , le code <code>future.then(print)</code> √©quivalent √† ce qui suit: <code>future.then((newsDigest) =&gt; print(newsDigest))</code> . </blockquote><p>  De plus, le code √† l'int√©rieur de <code>then()</code> peut utiliser des accolades: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> future = gatherNewsReports(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.then((newsDigest) { print(newsDigest); <span class="hljs-comment"><span class="hljs-comment">// Do something else... }); }</span></span></code> </pre> <br><p>  Vous devez sp√©cifier l'argument de rappel dans <code>then()</code> , m√™me si <code>future</code> est de type <code>Future&lt;void&gt;</code> .  Par convention, un argument inutilis√© est d√©fini via <code>_</code> (trait de soulignement). </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> future = printDailyNewsDigest(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.then((_) { <span class="hljs-comment"><span class="hljs-comment">// Code that doesn't use the `_` parameter... print('All reports printed.'); });</span></span></code> </pre> <br><h3 id="obrabotka-oshibok-1">  Gestion des erreurs </h3><br><p>  En utilisant l'API <code>Future</code> , vous pouvez intercepter l'erreur en utilisant <code>catchError()</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>=&gt; gatherNewsReports().then(print).catchError(handleError);</code> </pre> <br><p>  Si les nouvelles ne sont pas lisibles, le code ci-dessus est ex√©cut√© comme suit: </p><br><ol><li>  <code>future</code> renvoy√© par <code>gatherNewsReports()</code> √©choue. </li><li>  <code>future</code> retourn√©e par <code>then()</code> √©choue, <code>print()</code> pas appel√©. </li><li>  Le <code>catchError()</code> dans <code>catchError()</code> ( <code>handleError()</code> ) <code>handleError()</code> l'erreur, l' <code>future</code> renvoy√© par <code>catchError()</code> termine normalement et l'erreur ne se propage pas plus loin. </li></ol><br><blockquote>  La cha√Æne <code>catchError()</code> - <code>catchError()</code> est un mod√®le courant lors de l'utilisation de l'API <code>Future</code> .  Consid√©rez cette paire comme l'√©quivalent d'un <code>try-catch</code> dans l'API <code>Future</code> . </blockquote><p>  Comme then (), catchError () retourne un nouvel <code>future</code> qui se termine par la valeur de retour du rappel.  Pour plonger dans le sujet, lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Futures and Error Handling</a> . </p><br><h3 id="vyzov-neskolkih-funkciy-vozvraschayuschih-future">  Appeler plusieurs fonctions pour retourner le <code>future</code> </h3><br><p>  Consid√©rons trois fonctions: <code>expensiveA()</code> , <code>expensiveB()</code> , <code>expensiveC()</code> , qui renvoient le <code>future</code> .  Vous pouvez les appeler s√©quentiellement (une fonction d√©marre une fois la pr√©c√©dente termin√©e), ou vous pouvez toutes les ex√©cuter en m√™me temps et faire quelque chose d√®s que toutes les valeurs reviennent.  L'interface de Future est suffisamment flexible pour impl√©menter les deux cas d'utilisation. </p><br><p>  <strong>Une cha√Æne d'appels de fonction utilisant <code>then()</code></strong> <br>  Lorsque les fonctions renvoyant le <code>future</code> doivent √™tre ex√©cut√©es dans l'ordre, utilisez la cha√Æne de <code>then()</code> : </p><br><pre> <code class="java hljs">expensiveA() .then((aValue) =&gt; expensiveB()) .then((bValue) =&gt; expensiveC()) .then((cValue) =&gt; doSomethingWith(cValue));</code> </pre> <br><p>  Joindre des rappels fonctionne √©galement, mais c'est plus difficile √† lire.  ( <em>notez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://callbackhell.com/</a></em> ) </p><br><p>  <strong>Attendre la fin de plusieurs <code>futures</code> en utilisant <code>Future.wait()</code></strong> <br>  Si l'ordre d'ex√©cution des fonctions n'est pas important, vous pouvez utiliser <code>Future.wait()</code> .  Lorsque vous sp√©cifiez la liste des <code>futures</code> pour les param√®tres de la fonction Future.wait (), elle renvoie imm√©diatement le <code>future</code> .  Cet <code>future</code> ne prendra fin que lorsque tous les <code>futures</code> sp√©cifi√©s <code>futures</code> .  Cet <code>future</code> se terminera par une liste des r√©sultats de tous les <code>futures</code> indiqu√©s. </p><br><pre> <code class="java hljs">Future.wait([expensiveA(), expensiveB(), expensiveC()]) .then((List responses) =&gt; chooseBestResponse(responses, moreInfo)) .catchError(handleError);</code> </pre> <br><p>  Si un appel √† l'une des fonctions √©choue, le <code>future</code> renvoy√© par <code>Future.wait()</code> √©choue √©galement.  Utilisez <code>catchError()</code> pour intercepter cette erreur. </p><br><hr><br><h2 id="chto-esche-pochitat">  Que lire d'autre? </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dart 2. Programmation asynchrone: flux de donn√©es</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442282/">https://habr.com/ru/post/fr442282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442270/index.html">5 erreurs √† √©viter lors de la cr√©ation de mod√®les 3D pour l'impression 3D</a></li>
<li><a href="../fr442272/index.html">Aller + = versionner le package</a></li>
<li><a href="../fr442274/index.html">Dart 2. Programmation asynchrone: flux de donn√©es</a></li>
<li><a href="../fr442278/index.html">Guide de l'utilisateur Kibana. Visualisation. Partie 6</a></li>
<li><a href="../fr442280/index.html">Apprentissage automatique dans Dodo. Comment lancer une nouvelle direction si vous √™tes d√©veloppeur</a></li>
<li><a href="../fr442284/index.html">NoVerify: le linter pour PHP de l'√©quipe VKontakte est maintenant dans le domaine public</a></li>
<li><a href="../fr442286/index.html">Les ophtalmologistes russes ont parl√© de la vision bionique. La nouvelle application mobile d√©montre le travail du cyber</a></li>
<li><a href="../fr442288/index.html">Rayonnement: sources</a></li>
<li><a href="../fr442290/index.html">Cr√©ation de ST-Link V2.1 √† partir du chinois ST-Link V2</a></li>
<li><a href="../fr442292/index.html">Stage Sberseasons: Python, UX / UI, Data et bien plus encore pour les √©tudiants</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>