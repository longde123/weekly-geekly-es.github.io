<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏼 👩‍👩‍👧‍👧 🙍🏽 Principes généraux de fonctionnement de QEMU-KVM 🕒 💕 👨🏼‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ma compréhension actuelle: 

 1) KVM 
 KVM (Kernel-based Virtual Machine) - un hyperviseur (VMM - Virtual Machine Manager), fonctionnant comme un modu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Principes généraux de fonctionnement de QEMU-KVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466549/"><img src="https://habrastorage.org/webt/ot/t0/n9/ott0n9wlbvlxmct3v_cftcgzimq.png" alt="image"><br><br>  Ma compréhension actuelle: <br><br><h2>  1) KVM </h2><br>  KVM (Kernel-based Virtual Machine) - un hyperviseur (VMM - Virtual Machine Manager), fonctionnant comme un module sur le système d'exploitation Linux.  Un hyperviseur est nécessaire pour exécuter certains logiciels dans un environnement (virtuel) inexistant et en même temps, cacher à ce logiciel le véritable matériel physique sur lequel ce logiciel fonctionne.  L'hyperviseur agit comme une «bande» entre le matériel physique (hôte) et le système d'exploitation virtuel (invité). <br><br>  Puisque KVM est un module standard du noyau Linux, il reçoit du noyau tous les nishtyaki requis (travail avec mémoire, ordonnanceur, etc.).  Et en conséquence, en fin de compte, tous ces avantages vont aux invités (car les invités travaillent sur un hyperviseur qui fonctionne sur / dans le noyau Linux). <br><br>  KVM est très rapide, mais il ne suffit pas à lui seul pour exécuter un système d'exploitation virtuel, car  cela nécessite une émulation d'E / S.  Pour les E / S (processeur, lecteurs, réseau, vidéo, PCI, USB, ports série, etc.) KVM utilise QEMU. <br><a name="habracut"></a><br><h2>  2) QEMU </h2><br>  QEMU (Quick Emulator) - un émulateur de divers appareils qui vous permet d'exécuter des systèmes d'exploitation conçus pour une architecture sur une autre (par exemple, ARM -&gt; x86).  En plus du processeur, QEMU émule divers périphériques: cartes réseau, disque dur, cartes vidéo, PCI, USB, etc. <br><br>  Cela fonctionne comme ceci: <br><br>  Les instructions / code binaire (par exemple, ARM) sont convertis en un code intermédiaire indépendant de la plate-forme à l'aide du convertisseur TCG (Tiny Code Generator), puis ce code binaire indépendant de la plate-forme est converti en instructions / code cible (par exemple, x86). <br><br>  ARM -&gt; middleware -&gt; x86 <br><br>  En fait, vous pouvez exécuter des machines virtuelles sur QEMU sur n'importe quel hôte, même avec des modèles de processeur plus anciens qui ne prennent pas en charge Intel VT-x (Intel Virtualization Technology) / AMD SVM (AMD Secure Virtual Machine).  Cependant, dans ce cas, cela fonctionnera très lentement, car le binaire doit être recompilé à la volée deux fois à l'aide de TCG (TCG est un compilateur Just-in-Time). <br><br>  C'est-à-dire  QEMU lui-même est méga cool, mais il fonctionne très lentement. <br><br><h2>  3) Anneaux de protection </h2><br><img src="https://habrastorage.org/webt/q9/xd/ap/q9xdapkypgr_aglcqz9xryfm8kg.png" alt="image"><br><br>  Le code de programme binaire sur les processeurs ne fonctionne pas comme ça, mais est situé à différents niveaux (anneaux de protection) avec différents niveaux d'accès aux données, des plus privilégiés (anneau 0) aux plus limités, sur-réglementés et «avec des écrous serrés» (anneau 3 ) <br><br>  Le système d'exploitation (noyau OS) fonctionne sur Ring 0 (mode noyau) et peut faire n'importe quoi avec n'importe quelles données et périphériques.  Les applications utilisateur fonctionnent au niveau Ring 3 (mode utilisateur) et n'ont pas le droit de faire ce qu'elles veulent, mais doivent à la place demander à chaque fois l'accès pour effectuer une opération (de cette manière, les applications utilisateur n'ont accès qu'à leurs propres données et ne peuvent pas "Entrez dans" le bac à sable de quelqu'un d'autre ").  Les anneaux 1 et 2 sont destinés aux conducteurs. <br><br>  Avant l'invention d'Intel VT-x / AMD SVM, les hyperviseurs fonctionnaient sur Ring 0, et les invités travaillaient sur Ring 1. Étant donné que Ring 1 ne dispose pas de droits suffisants pour le fonctionnement normal du système d'exploitation, puis à chaque appel privilégié du système invité, l'hyperviseur devait modifier cet appel à la volée. et l'exécuter sur Ring 0 (quelque chose comme QEMU fait).  C'est-à-dire  le code binaire invité n'a <b><i>PAS</i></b> été exécuté directement sur le processeur, et à chaque vol, il y a eu plusieurs modifications intermédiaires. <br><br>  La surcharge était importante et c'était un gros problème, puis les fabricants de processeurs, indépendamment les uns des autres, ont publié un ensemble étendu d'instructions (Intel VT-x / AMD SVM) qui permettent d'exécuter le code OS invité <b><i>DIRECTEMENT</i></b> sur le processeur hôte (en évitant toutes les étapes intermédiaires coûteuses, comme c'était avant). <br><br>  Avec l'avènement d'Intel VT-x / AMD SVM, un nouveau niveau spécial Ring -1 (moins un) a été créé.  Et maintenant, l'hyperviseur y travaille, et les invités travaillent sur Ring 0 et obtiennent un accès privilégié au CPU. <br><br>  C'est-à-dire  en conséquence: <br><br><ul><li>  l'hôte s'exécute sur Ring 0 </li><li>  les clients travaillent au Ring 0 </li><li>  l'hyperviseur fonctionne sur Ring -1 </li></ul><br><h2>  4) QEMU-KVM </h2><br>  KVM fournit aux clients un accès à Ring 0 et utilise QEMU pour émuler les E / S (processeur, disques, réseau, vidéo, PCI, USB, ports série, etc. que les clients «voient» et utilisent). <br><br>  D'où le QEMU-KVM (ou KVM-QEMU) :) <br><br>  <i>CRÉDITS</i> <i><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une image pour attirer l'attention</a></i> <i><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Anneaux de protection d'image</a></i> <br><br>  <i>PS Le texte de cet article a été initialement publié dans la chaîne Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@RU_Voip</a> en réponse à la question de l'un des participants à la chaîne.</i> <i><br><br></i>  <i>Écrivez dans les commentaires dans quels endroits je ne comprends pas correctement le sujet ou s'il y a quelque chose à compléter.</i> <i><br><br></i>  <i>Je vous remercie!</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466549/">https://habr.com/ru/post/fr466549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466537/index.html">Utilisation de modules JavaScript en production: situation actuelle. Partie 1</a></li>
<li><a href="../fr466539/index.html">Utilisation de modules JavaScript en production: situation actuelle. 2e partie</a></li>
<li><a href="../fr466541/index.html">Utilisation de DbTool pour amorcer des bases de données dans des applications .NET (Core)</a></li>
<li><a href="../fr466543/index.html">Les prêts Habr Weekly # 17 / Sberbank seront approuvés par AI - effrayant, publicité dans les produits open source - douteux</a></li>
<li><a href="../fr466547/index.html">Bonne fête du programmeur</a></li>
<li><a href="../fr466551/index.html">Marionnettiste avec ES6 dans un nœud et un navigateur, ou pourquoi Zora est le meilleur framework de test dans sa niche</a></li>
<li><a href="../fr466553/index.html">6 leçons tirées de la recherche d'une solution à un problème majeur sur gitlab.com. 2e partie</a></li>
<li><a href="../fr466555/index.html">6 leçons tirées de la recherche d'une solution à un problème majeur sur gitlab.com. Partie 1</a></li>
<li><a href="../fr466557/index.html">Comment créer une mise en page pour le site et ne pas rester extrême</a></li>
<li><a href="../fr466559/index.html">Soit le nouveau Var</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>