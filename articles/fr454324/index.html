<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëô üë®üèº‚Äçüî¨ üïµüèø Pointeurs en Python: √† quoi √ßa sert? üôÖüèΩ üïù üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous avez d√©j√† travaill√© avec des langages de bas niveau comme C ou C ++, vous avez probablement entendu parler de pointeurs. Ils vous permettent d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pointeurs en Python: √† quoi √ßa sert?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454324/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/vd/cj/_ivdcjv0itamifffxs0i1i-mqh4.jpeg"></div><br>  Si vous avez d√©j√† travaill√© avec des langages de bas niveau comme C ou C ++, vous avez probablement entendu parler de pointeurs.  Ils vous permettent d'augmenter consid√©rablement l'efficacit√© de diff√©rents morceaux de code.  Mais ils peuvent √©galement d√©router les novices - et m√™me les d√©veloppeurs exp√©riment√©s - et conduire √† des bugs de gestion de la m√©moire.  Y a-t-il des pointeurs en Python, puis-je les √©muler d'une mani√®re ou d'une autre? <br><br>  Les pointeurs sont largement utilis√©s en C et C ++.  En fait, ce sont des variables qui contiennent les adresses m√©moire auxquelles se trouvent les autres variables.  Pour rafra√Æchir les pointeurs, lisez cette <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">critique</a> . <br><br>  Gr√¢ce √† cet article, vous comprendrez mieux le mod√®le objet en Python et d√©couvrirez pourquoi les pointeurs n'existent pas r√©ellement dans ce langage.  Si vous avez besoin de simuler le comportement de pointeurs, vous apprendrez √† les √©muler sans le cauchemar de gestion de la m√©moire qui l'accompagne. <br><a name="habracut"></a><br>  Avec cet article, vous: <br><br><ul><li>  D√©couvrez pourquoi Python n'a pas de pointeurs. </li><li>  Apprenez la diff√©rence entre les variables C et les noms en Python. </li><li>  Apprenez √† √©muler des pointeurs en Python. </li><li> Utilisez des <code>ctypes</code> exp√©rimenter avec de vrais pointeurs. </li></ul><br>  <b>Remarque</b> : Ici, le terme ¬´Python¬ª est appliqu√© √† l'impl√©mentation Python en C, connue sous le nom de CPython.  Toutes les discussions sur le p√©riph√©rique de langage sont valides pour CPython 3.7, mais peuvent ne pas correspondre aux it√©rations suivantes. <br><br><h2>  Pourquoi n'y a-t-il pas de pointeurs en Python? </h2><br>  Je ne sais pas.  Les pointeurs peuvent-ils exister en Python nativement?  Probablement, mais apparemment, les pointeurs contredisent le concept de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zen of Python</a> , car ils provoquent des changements implicites au lieu de changements explicites.  Les pointeurs sont souvent assez complexes, surtout pour les d√©butants.  De plus, ils vous poussent √† des d√©cisions infructueuses ou √† faire quelque chose de vraiment dangereux, comme lire dans une zone de m√©moire, o√π vous n'auriez pas d√ª le lire. <br><br>  Python essaie d'abstraire les d√©tails d'impl√©mentation de l'utilisateur, comme une adresse m√©moire.  Souvent, dans ce langage, l'accent est mis sur l'utilisabilit√© et non sur la vitesse.  Par cons√©quent, les pointeurs en Python n'ont pas beaucoup de sens.  Mais ne vous inqui√©tez pas, la langue par d√©faut vous offre certains des avantages de l'utilisation des pointeurs. <br><br>  Pour comprendre les pointeurs en Python, passons bri√®vement en revue les fonctionnalit√©s de l'impl√©mentation du langage.  En particulier, vous devez comprendre: <br><br><ol><li>  Quels sont les objets mutables et immuables. </li><li>  Comment les variables / noms sont-ils organis√©s en Python. </li></ol><br>  Accrochez-vous √† vos adresses m√©moire, c'est parti! <br><br><h2>  Objets en Python </h2><br>  Tout en Python est un objet.  Par exemple, ouvrez REPL et voyez comment <code>isinstance()</code> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>isinstance(<span class="hljs-number"><span class="hljs-number">1</span></span>, object) <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt;&gt; isinstance(list(), object) <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt;&gt; isinstance(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, object) <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> ... &gt;&gt;&gt; isinstance(foo, object) <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Ce code montre que tout en Python est en fait un objet.  Chaque objet contient au moins trois types de donn√©es: <br><br><ul><li>  Compteur de r√©f√©rence. <br></li><li>  Tapez <br></li><li>  La valeur. <br></li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un compteur de r√©f√©rence est</a> utilis√© pour g√©rer la m√©moire.  Les d√©tails sur cette gestion sont √©crits dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion de la m√©moire en Python</a> .  Le type est utilis√© au niveau CPython pour assurer la s√©curit√© du type pendant l'ex√©cution.  Et la valeur est la valeur r√©elle associ√©e √† l'objet. <br><br>  Mais tous les objets ne sont pas identiques.  Il y a une diff√©rence importante: les objets sont mutables et immuables.  Comprendre cette distinction entre les types d'objets vous aidera √† mieux comprendre la premi√®re couche de l'oignon appel√©e ¬´pointeurs en Python¬ª. <br><br><h2>  Objets mutables et immuables </h2><br>  Il existe deux types d'objets en Python: <br><br><ol><li>  Objets immuables (ne peuvent pas √™tre modifi√©s); <br></li><li>  Objets modifiables (sous r√©serve de modifications). <br></li></ol><br>  Reconna√Ætre cette diff√©rence est la premi√®re cl√© pour voyager √† travers le monde des pointeurs en Python.  Voici la caract√©ristique d'immuabilit√© de certains types populaires: <br><br><div class="scrollable-table"><table><tbody><tr><th width="400">  Tapez <br></th><th width="400">  Immuable? <br></th></tr><tr><td>  int <br></td><td>  Oui <br></td></tr><tr><td>  flotter <br></td><td>  Oui <br></td></tr><tr><td>  bool <br></td><td>  Oui <br></td></tr><tr><td>  complexe <br></td><td>  Oui <br></td></tr><tr><td>  tuple <br></td><td>  Oui <br></td></tr><tr><td>  frozenset <br></td><td>  Oui <br></td></tr><tr><td>  str <br></td><td>  Oui <br></td></tr><tr><td>  liste <br></td><td>  Non <br></td></tr><tr><td>  ensemble <br></td><td>  Non <br></td></tr><tr><td>  dicter <br></td><td>  Non <br></td></tr></tbody></table></div><br>  Comme vous pouvez le voir, la plupart des types primitifs couramment utilis√©s sont immuables.  Vous pouvez le v√©rifier en √©crivant du code Python.  Vous aurez besoin de deux outils de la biblioth√®que standard: <br><br><ol><li>  <code>id()</code> renvoie l'adresse m√©moire de l'objet; <br></li><li>  <code>is</code> renvoie <code>True</code> si et seulement si deux objets ont la m√™me adresse m√©moire. <br></li></ol><br>  Vous pouvez ex√©cuter ce code dans un environnement REPL: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">5</span></span> &gt;&gt;&gt; id(x) <span class="hljs-number"><span class="hljs-number">94529957049376</span></span></code> </pre> <br>  Ici, nous d√©finissons la variable <code>x</code> √† <code>5</code> .  Si vous essayez de modifier la valeur en utilisant l'addition, vous obtiendrez un nouvel objet: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x += <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; x <span class="hljs-number"><span class="hljs-number">6</span></span> &gt;&gt;&gt; id(x) <span class="hljs-number"><span class="hljs-number">94529957049408</span></span></code> </pre> <br>  Bien qu'il puisse sembler que ce code modifie simplement la valeur de <code>x</code> , en r√©alit√©, vous obtenez un <b>nouvel</b> objet comme r√©ponse. <br><br>  Le type <code>str</code> est √©galement immuable: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>s = <span class="hljs-string"><span class="hljs-string">"real_python"</span></span> &gt;&gt;&gt; id(s) <span class="hljs-number"><span class="hljs-number">140637819584048</span></span> &gt;&gt;&gt; s += <span class="hljs-string"><span class="hljs-string">"_rocks"</span></span> &gt;&gt;&gt; s <span class="hljs-string"><span class="hljs-string">'real_python_rocks'</span></span> &gt;&gt;&gt; id(s) <span class="hljs-number"><span class="hljs-number">140637819609424</span></span></code> </pre> <br>  Et dans ce cas, <code>s</code> apr√®s l'op√©ration <code>+=</code> obtient une adresse m√©moire <b>diff√©rente</b> . <br><br>  <b>Bonus</b> : l'op√©rateur <code>+=</code> traduit par diff√©rents appels de m√©thode. <br><br>  Pour certains objets, comme une liste, <code>+=</code> converti en <code>__iadd__()</code> (ajout local).  Il se changera et renverra le m√™me ID.  Cependant, <code>str</code> et <code>int</code> n'ont pas ces m√©thodes et par cons√©quent, <code>__add__()</code> sera appel√© √† la place de <code>__iadd__()</code> . <br><br>  Voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation du mod√®le de donn√©es</a> Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour plus de d√©tails</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">.</a> <br><br>  Lorsque nous essayons de modifier directement la valeur de cha√Æne de <code>s</code> nous obtenons une erreur: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>s[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"R"</span></span></code> </pre> <br>  Trace arri√®re (les derniers appels sont affich√©s en dernier): <br><br><pre> <code class="python hljs"> File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;mdule&gt; TypeError: <span class="hljs-string"><span class="hljs-string">'str'</span></span> object does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support item assignment</code> </pre> <br>  Le code ci-dessus se bloque et Python signale que <code>str</code> ne prend pas en charge cette modification, ce qui correspond √† la d√©finition d'immuabilit√© du type <code>str</code> . <br><br>  Comparez avec un objet mutable, par exemple, avec une liste: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>my_list = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] &gt;&gt;&gt; id(my_list) <span class="hljs-number"><span class="hljs-number">140637819575368</span></span> &gt;&gt;&gt; my_list.append(<span class="hljs-number"><span class="hljs-number">4</span></span>) &gt;&gt;&gt; my_list [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>] &gt;&gt;&gt; id(my_list) <span class="hljs-number"><span class="hljs-number">140637819575368</span></span></code> </pre> <br>  Ce code illustre la principale diff√©rence entre les deux types d'objets.  Initialement, <code>my_list</code> a un ID.  M√™me apr√®s avoir ajout√© <code>4</code> √† la liste, <code>my_list</code> toujours <b>le m√™me</b> ID.  La raison en est que la <code>list</code> types est modifiable. <br><br>  Voici une autre d√©monstration de la mutabilit√© des listes √† l'aide de l'affectation: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>my_list[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; my_list [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>] &gt;&gt;&gt; id(my_list) <span class="hljs-number"><span class="hljs-number">140637819575368</span></span></code> </pre> <br>  Dans ce code, nous avons chang√© <code>my_list</code> et l' <code>my_list</code> mis √† <code>0</code> comme premier √©l√©ment.  Cependant, la liste a conserv√© le m√™me ID apr√®s cette op√©ration.  La prochaine √©tape sur notre chemin vers l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">apprentissage de Python</a> sera d'explorer son √©cosyst√®me. <br><br><h2>  Nous traitons des variables </h2><br>  Les variables en Python sont fondamentalement diff√©rentes des variables en C et C ++.  Essentiellement, ils n'existent tout simplement pas en Python.  <b>Au lieu de variables, il y a des noms</b> . <br><br>  Cela peut sembler p√©dant, et pour la plupart c'est le cas.  Le plus souvent, vous pouvez prendre des noms en Python comme variables, mais vous devez comprendre la diff√©rence.  Ceci est particuli√®rement important lorsque vous √©tudiez un sujet aussi difficile que les pointeurs. <br><br>  Pour vous faciliter la t√¢che, voyons comment fonctionnent les variables en C, ce qu'elles repr√©sentent, puis comparons avec le travail des noms en Python. <br><br><h3>  Variables en C </h3><br>  Prenez le code qui d√©finit la variable <code>x</code> : <br><br><pre> <code class="python hljs">int x = <span class="hljs-number"><span class="hljs-number">2337</span></span>;</code> </pre> <br>  L'ex√©cution de cette ligne courte passe par plusieurs √©tapes diff√©rentes: <br><br><ol><li>  Allouer suffisamment de m√©moire pour un nombre. <br></li><li>  Affectation de <code>2337</code> √† cet emplacement m√©moire. <br></li><li>  Le mappage que <code>x</code> indique cette valeur. <br></li></ol><br>  Une m√©moire simplifi√©e pourrait ressembler √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f13/e62/d71/f13e62d71774b73aecff45931b6db57f.png"><br><br>  Ici, la variable <code>x</code> a une fausse adresse de <code>0x7f1</code> et une valeur de <code>2337</code> .  Si vous souhaitez ult√©rieurement modifier la valeur de <code>x</code> , vous pouvez le faire: <br><br><pre> <code class="python hljs">x = <span class="hljs-number"><span class="hljs-number">2338</span></span>;</code> </pre> <br>  Ce code d√©finit la variable <code>x</code> nouvelle valeur de <code>2338</code> , <code>2338</code> ainsi la valeur <b>pr√©c√©dente</b> .  Cela signifie que la variable <code>x</code> <b>mutable</b> .  Sch√©ma de m√©moire mis √† jour pour la nouvelle valeur: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/347/491/19b/34749119bcba5c4009861aa4e7c40c45.png"><br><br>  Veuillez noter que l'emplacement de <code>x</code> pas chang√©, seulement la valeur elle-m√™me.  C'est important.  Cela nous dit que <code>x</code> est <b>un lieu en m√©moire</b> , et pas seulement un nom. <br><br>  Vous pouvez √©galement consid√©rer cette question comme faisant partie du concept de propri√©t√©.  D'une part, <code>x</code> poss√®de une place en m√©moire.  Tout d'abord, <code>x</code> est une bo√Æte vide qui ne peut contenir qu'un seul entier, dans lequel les valeurs enti√®res peuvent √™tre stock√©es. <br><br>  Lorsque vous attribuez √† <code>x</code> une valeur, vous placez la valeur dans une bo√Æte qui appartient √† <code>x</code> .  Si vous souhaitez introduire une nouvelle variable <code>y</code> , vous pouvez ajouter cette ligne: <br><br><pre> <code class="python hljs">int y = x;</code> </pre> <br>  Ce code cr√©e une nouvelle bo√Æte appel√©e <code>y</code> et copie la valeur de <code>x</code> dedans.  Maintenant, le circuit m√©moire ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/caa/74d/ed3/caa74ded301b1f527e1b94516f1b1196.png"><br><br>  Notez le nouvel emplacement <code>y</code> - <code>0x7f5</code> .  Bien que la valeur <code>x</code> √©t√© copi√©e dans <code>x</code> , la variable <code>y</code> poss√®de une nouvelle adresse en m√©moire.  Par cons√©quent, vous pouvez remplacer la valeur de <code>y</code> sans affecter <code>x</code> : <br><br><pre> <code class="python hljs">y = <span class="hljs-number"><span class="hljs-number">2339</span></span>;</code> </pre> <br>  Maintenant, le circuit m√©moire ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcf/f8d/ed4/fcff8ded49647ad0053a45f0773cb4bb.png"><br><br>  Je le r√©p√®te: vous avez chang√© la valeur de <code>y</code> , mais pas l'emplacement.  De plus, vous n'avez pas affect√© la variable d'origine <code>x</code> . <br><br>  Avec des noms en Python, la situation est compl√®tement diff√©rente. <br><br><h3>  Noms en Python </h3><br>  Il n'y a pas de variables en Python, des noms √† la place.  Vous pouvez utiliser le terme ¬´variables¬ª √† votre discr√©tion, mais il est important de conna√Ætre la diff√©rence entre les variables et les noms. <br><br>  Prenons le code √©quivalent de l'exemple C ci-dessus et √©crivons-le en Python: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">2337</span></span></code> </pre> <br>  Comme en C, le code passe par plusieurs √©tapes distinctes lors de l'ex√©cution de ceci: <br><br><ol><li>  PyObject est cr√©√©. <br></li><li>  Le num√©ro de PyObject se voit attribuer un code de type. <br></li><li>  <code>2337</code> re√ßoit une valeur pour PyObject. <br></li><li>  Le nom <code>x</code> est cr√©√©. </li><li>  <code>x</code> pointe vers le nouveau PyObject. </li><li>  Le nombre de r√©f√©rences de PyObject est incr√©ment√© de 1. <br></li></ol><br>  <b>Remarque</b> : <a href="">PyObject</a> n'est pas identique √† un objet en Python, cette entit√© est sp√©cifique √† CPython et repr√©sente la structure de base de tous les objets Python. <br><br>  PyObject est d√©fini comme une structure C, donc si vous vous demandez pourquoi vous ne pouvez pas appeler directement le code de type ou le compteur de r√©f√©rence, la raison en est que vous n'avez pas d'acc√®s direct aux structures.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'appel de</a> m√©thodes comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sys.getrefcount ()</a> peut aider √† obtenir une sorte de substance interne. <br><br>  Si nous parlons de m√©moire, cela peut ressembler √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d9/ad7/932/9d9ad79327405315461e3880fe3db256.png"><br><br>  Ici, le circuit de m√©moire est tr√®s diff√©rent du circuit en C montr√© ci-dessus.  Au lieu d'avoir <code>x</code> poss√©der un bloc de m√©moire qui stocke la valeur <code>2337</code> , un objet Python fra√Æchement cr√©√© poss√®de la m√©moire dans laquelle <code>2337</code> vit.  Le nom Python <code>x</code> ne poss√®de directement <b>aucune</b> adresse en m√©moire, tout comme une variable C poss√®de une cellule statique. <br><br>  Si vous souhaitez attribuer √† <code>x</code> nouvelle valeur, essayez ce code: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">2338</span></span></code> </pre> <br>  Le comportement du syst√®me sera diff√©rent de ce qui se passe en C, mais il ne diff√©rera pas trop de la liaison d'origine en Python. <br><br>  Dans ce code: <br><br><ul><li>  Un nouveau PyObject est cr√©√©. <br></li><li>  Le num√©ro de PyObject se voit attribuer un code de type. <br></li><li>  <code>2</code> re√ßoit une valeur pour PyObject. <br></li><li>  <code>x</code> pointe vers le nouveau PyObject. <br></li><li>  Le compte de r√©f√©rence du nouveau PyObject est incr√©ment√© de 1. <br></li><li>  Le compte de r√©f√©rence de l'ancien PyObject est r√©duit de 1. <br></li></ul><br>  Maintenant, le circuit m√©moire ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/712/860/996/712860996aa37da34fdb69a466cdf5de.png"><br><br>  Cette illustration montre que <code>x</code> pointe vers une r√©f√©rence √† un objet et ne poss√®de pas la zone m√©moire comme auparavant.  Vous voyez √©galement que la commande <code>x = 2338</code> n'est pas une affectation, mais plut√¥t une liaison du nom <code>x</code> au lien. <br><br>  De plus, l'objet pr√©c√©dent (contenant la valeur <code>2337</code> ) est maintenant en m√©moire avec un d√©compte de r√©f√©rence de 0 et sera supprim√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par le garbage collector</a> . <br><br>  Vous pouvez saisir un nouveau nom <code>y</code> , comme dans l'exemple C: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>y = x</code> </pre> <br>  Un nouveau nom appara√Ætra en m√©moire, mais pas n√©cessairement un nouvel objet: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/958/adc/410/958adc41013bb5483f0526689a48a871.png"><br><br>  Vous voyez maintenant qu'un nouvel objet Python n'a <b>pas √©t√©</b> cr√©√©, seul un nouveau nom a <b>√©t√©</b> cr√©√© qui pointe vers le m√™me objet.  De plus, le compteur de r√©f√©rences d'objets a augment√© de 1. Vous pouvez v√©rifier l'√©quivalence de l'identit√© des objets pour confirmer leur identit√©: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>y <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Ce code montre que <code>x</code> et <code>y</code> sont un seul objet.  Mais ne vous y trompez pas: <code>y</code> est toujours immuable.  Par exemple, vous pouvez effectuer une op√©ration d'addition avec <code>y</code> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>y += <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; y <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Une fois l'ajout appel√©, vous retournerez un nouvel objet Python.  Maintenant, la m√©moire ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bd/abc/3e7/8bdabc3e7576ab86b00ba9c2b43b57b4.png"><br><br>  Un nouvel objet a √©t√© cr√©√© et <code>y</code> pointe maintenant vers lui.  Il est curieux que nous obtenions exactement le m√™me √©tat final si nous relions directement <code>y</code> √† <code>2339</code> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>y = <span class="hljs-number"><span class="hljs-number">2339</span></span></code> </pre> <br>  Apr√®s cette expression, nous obtenons un tel √©tat final de la m√©moire, comme dans l'op√©ration d'addition.  Permettez-moi de vous rappeler qu'en Python, vous n'affectez pas de variables, mais liez des noms √† des liens. <br><br><h3>  √Ä propos des stagiaires en Python </h3><br>  Vous comprenez maintenant comment de nouveaux objets sont cr√©√©s en Python et comment les noms y sont attach√©s.  Il est temps de parler des objets intern√©s. <br><br>  Nous avons ce code Python: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">1000</span></span> &gt;&gt;&gt; y = <span class="hljs-number"><span class="hljs-number">1000</span></span> &gt;&gt;&gt; x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Comme pr√©c√©demment, <code>x</code> et <code>y</code> sont des noms pointant vers le m√™me objet Python.  Mais cet objet contenant la valeur <code>1000</code> ne peut pas toujours avoir la m√™me adresse m√©moire.  Par exemple, si vous additionnez deux nombres et obtenez 1000, vous obtiendrez une autre adresse: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">1000</span></span> &gt;&gt;&gt; y = <span class="hljs-number"><span class="hljs-number">499</span></span> + <span class="hljs-number"><span class="hljs-number">501</span></span> &gt;&gt;&gt; x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Cette fois, la cha√Æne <code>x is y</code> renvoie <code>False</code> .  Si vous √™tes g√™n√©, ne vous inqui√©tez pas.  Voici ce qui se passe lorsque ce code est ex√©cut√©: <br><br><ol><li>  Un objet Python est cr√©√© ( <code>1000</code> ). <br></li><li>  On lui donne le nom <code>x</code> . <br></li><li>  Un objet Python est cr√©√© ( <code>499</code> ). <br></li><li>  Un objet Python est cr√©√© ( <code>501</code> ). <br></li><li>  Ces deux objets s'additionnent. <br></li><li>  Un nouvel objet Python est cr√©√© ( <code>1000</code> ). <br></li><li>  On lui donne le nom <code>y</code> . <br></li></ol><br>  <b>Explications techniques</b> : Les √©tapes d√©crites n'ont lieu que lorsque ce code est ex√©cut√© dans le REPL.  Si vous prenez l'exemple ci-dessus, collez-le dans le fichier et ex√©cutez-le, puis la ligne <code>x is y</code> retournera <code>True</code> . <br><br>  La raison en est l'esprit rapide du compilateur CPython, qui essaie d'effectuer des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">optimisations de judas</a> qui aident √† enregistrer autant que possible les √©tapes d'ex√©cution du code.  Les d√©tails peuvent √™tre trouv√©s dans le <a href="">code source de l'optimiseur de judas CPython</a> . <br><br>  Mais n'est-ce pas du gaspillage?  Eh bien, oui, mais vous payez ce prix pour tous les grands avantages de Python.  Vous n'avez pas besoin de penser √† supprimer de tels objets interm√©diaires, et vous n'avez m√™me pas besoin de conna√Ætre leur existence!  La plaisanterie est que ces op√©rations sont effectu√©es assez rapidement et que vous ne les connaissez pas avant ce moment. <br><br>  Les cr√©ateurs de Python ont sagement remarqu√© cette surcharge et ont d√©cid√© de faire plusieurs optimisations.  Leur r√©sultat est un comportement qui peut surprendre les d√©butants: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = <span class="hljs-number"><span class="hljs-number">20</span></span> &gt;&gt;&gt; y = <span class="hljs-number"><span class="hljs-number">19</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Dans cet exemple, le code est presque le m√™me que ci-dessus, sauf que nous obtenons <code>True</code> .  Tout tourne autour des objets intern√©s.  Python pr√©-cr√©e un sous-ensemble sp√©cifique d'objets en m√©moire et les stocke dans l'espace de noms global pour une utilisation quotidienne. <br><br>  Quels objets d√©pendent de l'impl√©mentation Python?  Dans CPython 3.7, les intern√©s sont: <br><br><ol><li>  Entiers allant de <code>-5</code> √† <code>256</code> . <br></li><li>  Cha√Ænes contenant uniquement des lettres, des chiffres ou des traits de soulignement ASCII. <br></li></ol><br>  En effet, ces variables sont tr√®s souvent utilis√©es dans de nombreux programmes.  En internant, Python emp√™che l'allocation de m√©moire pour les objets persistants. <br><br>  Les lignes de moins de 20 caract√®res et contenant des lettres ASCII, des chiffres ou des traits de soulignement seront intern√©es car elles sont cens√©es √™tre utilis√©es comme identifiants: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>s1 = <span class="hljs-string"><span class="hljs-string">"realpython"</span></span> &gt;&gt;&gt; id(s1) <span class="hljs-number"><span class="hljs-number">140696485006960</span></span> &gt;&gt;&gt; s2 = <span class="hljs-string"><span class="hljs-string">"realpython"</span></span> &gt;&gt;&gt; id(s2) <span class="hljs-number"><span class="hljs-number">140696485006960</span></span> &gt;&gt;&gt; s1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> s2 <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Ici, <code>s1</code> et <code>s2</code> pointent vers la m√™me adresse en m√©moire.  Si nous n'ins√©rions pas de lettre, de chiffre ou de soulignement ASCII, nous obtiendrions un r√©sultat diff√©rent: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>s1 = <span class="hljs-string"><span class="hljs-string">"Real Python!"</span></span> &gt;&gt;&gt; s2 = <span class="hljs-string"><span class="hljs-string">"Real Python!"</span></span> &gt;&gt;&gt; s1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> s2 <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Cet exemple utilise un point d'exclamation, donc les cha√Ænes ne sont pas internes et sont diff√©rents objets en m√©moire. <br><br>  <b>Bonus</b> : si vous voulez que ces objets se r√©f√®rent au m√™me objet intern√©, vous pouvez utiliser <code>sys.intern()</code> .  Une fa√ßon d'utiliser cette fonctionnalit√© est d√©crite dans la documentation: <br><br><blockquote>  L'internement de cha√Ænes est utile pour une l√©g√®re augmentation des performances de recherche de dictionnaire: si les cl√©s du dictionnaire et la cl√© √† rechercher sont intern√©es, des comparaisons de cl√©s (apr√®s hachage) peuvent √™tre effectu√©es en comparant des pointeurs plut√¥t que des cha√Ænes.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a> ) </blockquote><br>  Les intern√©s confondent souvent les programmeurs.  N'oubliez pas que si vous commencez √† douter, vous pouvez toujours utiliser <code>id()</code> et <code>is</code> pour d√©terminer l'√©quivalence des objets. <br><br><h2>  √âmulation de pointeur Python </h2><br>  Le fait que les pointeurs soient absents nativement en Python ne signifie pas que vous ne pouvez pas profiter des pointeurs.  Il existe en fait plusieurs fa√ßons d'√©muler des pointeurs en Python.  Ici, nous regardons deux d'entre eux: <br><br><ol><li>  Utilisez-les comme pointeurs vers des types mutables. <br></li><li>  Utilisation d'objets Python sp√©cialement pr√©par√©s. <br></li></ol><br><h3>  Utiliser comme pointeurs de type mutable </h3><br>  Vous savez d√©j√† ce que sont les types mutables.  C'est gr√¢ce √† leur mutabilit√© que nous pouvons √©muler le comportement des pointeurs.  Disons que vous devez r√©pliquer ce code: <br><br><pre> <code class="python hljs">void add_one(int *x) { *x += <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br>  Ce code prend un pointeur sur un nombre ( <code>*x</code> ) et incr√©mente la valeur de 1. Voici la fonction principale pour ex√©cuter le code: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#include &lt;stdi.h&gt; int main(void) { int y = 2337; printf("y = %d\n", y); add_one(&amp;y); printf("y = %d\n", y); return 0; }</span></span></code> </pre> <br>  Dans le fragment ci-dessus, nous avons attribu√© <code>y</code> √† <code>2337</code> , affich√© la valeur actuelle, augment√© de 1, puis affich√© une nouvelle valeur.  L'√©cran suivant appara√Æt √† l'√©cran: <br><br><pre> <code class="python hljs">y = <span class="hljs-number"><span class="hljs-number">2337</span></span> y = <span class="hljs-number"><span class="hljs-number">2338</span></span></code> </pre> <br>  Une fa√ßon de reproduire ce comportement en Python consiste √† utiliser un type mutable.  Par exemple, appliquez une liste et modifiez le premier √©l√©ment: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_one</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> ... x[<span class="hljs-number"><span class="hljs-number">0</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span> ... &gt;&gt;&gt; y = [<span class="hljs-number"><span class="hljs-number">2337</span></span>] &gt;&gt;&gt; add_one(y) &gt;&gt;&gt; y[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">2338</span></span></code> </pre> <br>  Ici, <code>add_one(x)</code> fait r√©f√©rence au premier √©l√©ment et augmente sa valeur de 1. L'utilisation de la liste signifie qu'en cons√©quence, nous obtenons la valeur modifi√©e.  Il y a donc des pointeurs en Python?  Non.  Le comportement d√©crit est devenu possible car la liste est un type mutable.  Si vous essayez d'utiliser un tuple, vous obtenez une erreur: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>z = (<span class="hljs-number"><span class="hljs-number">2337</span></span>,) &gt;&gt;&gt; add_one(z)</code> </pre> <br>  Trace arri√®re (les derniers appels passent en dernier): <br><br><pre> <code class="python hljs"> File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> add_one TypeError: <span class="hljs-string"><span class="hljs-string">'tuple'</span></span> object does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support item assignment</code> </pre> <br>  Ce code d√©montre l'immuabilit√© du tuple, il ne prend donc pas en charge l'attribution d'√©l√©ment. <br><br>  <code>list</code> pas le seul type mutable; les pointeurs partiels sont √©galement √©mul√©s √† l'aide de <code>dict</code> . <br><br>  Supposons que vous ayez une application qui devrait suivre l'occurrence d'√©v√©nements int√©ressants.  Cela peut √™tre fait en cr√©ant un dictionnaire et en utilisant l'un de ses √©l√©ments comme compteur: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>counters = {<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>} &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... counters[<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span> ... &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... counters[<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span> ... bar() ... &gt;&gt;&gt; foo() &gt;&gt;&gt; counters[<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>] <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Dans cet exemple, le dictionnaire utilise des compteurs pour suivre le nombre d'appels de fonction.  Apr√®s avoir appel√© <code>foo()</code> compteur a augment√© de 2, comme pr√©vu.  Et tout cela gr√¢ce √† la <code>dict</code> . <br><br>  N'oubliez pas, ce n'est qu'une <b>√©mulation</b> du comportement d'un pointeur, cela n'a rien √† voir avec de vrais pointeurs en C et C ++.  On peut dire que ces op√©rations sont plus ch√®res que si elles √©taient effectu√©es en C ou C ++. <br><br><h3>  Utilisation d'objets Python </h3><br>  <code>dict</code> est un excellent moyen d'√©muler des pointeurs en Python, mais il est parfois fastidieux de se souvenir du nom de cl√© que vous avez utilis√©.  Surtout si vous utilisez le dictionnaire dans diff√©rentes parties de l'application.  Une classe Python personnalis√©e peut vous aider ici. <br><br>  Imaginons que vous ayez besoin de suivre les mesures dans une application.  Un excellent moyen d'ignorer les d√©tails ennuyeux est de cr√©er une classe: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Metrics</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._metrics = { <span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"cat_pictures_served"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, }</code> </pre> <br>  Ce code d√©finit la classe <code>Metrics</code> .  Il utilise toujours le dictionnaire pour stocker des donn√©es √† jour qui se trouvent dans la <code>_metrics</code> membre <code>_metrics</code> .  Cela vous donnera la mutabilit√© requise.  Il ne vous reste plus qu'√† acc√©der √† ces valeurs.  Vous pouvez le faire en utilisant les propri√©t√©s: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Metrics</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... @property def func_calls(self): return self._metrics["func_calls"] @property def cat_pictures_served(self): return self._metrics["cat_pictures_served"]</span></span></code> </pre> <br>  Ici, nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@property</a> .  Si vous d√©butez avec les d√©corateurs, lisez l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Primer on Python Decorators</a> .  Dans ce cas, le d√©corateur <code>@property</code> vous permet d'acc√©der √† <code>func_calls</code> et <code>cat_pictures_served</code> , comme s'il s'agissait d'attributs: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>metrics = Metrics() &gt;&gt;&gt; metrics.func_calls <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; metrics.cat_pictures_served <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Le fait que vous puissiez faire r√©f√©rence √† ces noms en tant qu'attributs signifie que vous √™tes √©loign√© du fait que ces valeurs sont stock√©es dans le dictionnaire.  De plus, vous rendez les noms d'attributs plus explicites.  Bien s√ªr, vous devriez pouvoir augmenter les valeurs: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Metrics</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def inc_func_calls(self): self._metrics["func_calls"] += 1 def inc_cat_pics(self): self._metrics["cat_pictures_served"] += 1</span></span></code> </pre> <br>     : <br><br><ol><li> <code>inc_func_calls()</code> </li> <li> <code>inc_cat_pics()</code> </li> </ol><br>      <code>metrics</code> .     ,     ,   : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>metrics = Metrics() &gt;&gt;&gt; metrics.inc_func_calls() &gt;&gt;&gt; metrics.inc_func_calls() &gt;&gt;&gt; metrics.func_calls <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>     <code>func_calls</code>   <code>inc_func_calls()</code>         Python.    ,     -  <code>metrics</code> ,          . <br><br> <b></b> :   ,   <code>inc_func_calls()</code>  <code>inc_cat_pics()</code>   <code>@property.setter</code>        <code>int</code> ,     . <br><br>      <code>Metrics</code> : <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Metrics</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._metrics = { <span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"cat_pictures_served"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, } @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func_calls</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._metrics[<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>] @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cat_pictures_served</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._metrics[<span class="hljs-string"><span class="hljs-string">"cat_pictures_served"</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc_func_calls</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._metrics[<span class="hljs-string"><span class="hljs-string">"func_calls"</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc_cat_pics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._metrics[<span class="hljs-string"><span class="hljs-string">"cat_pictures_served"</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><h2>     ctypes </h2><br>  , -    Python,   CPython?     ctypes    ,   C.      ctypes,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Extending Python With C Libraries and the ¬´ctypes¬ª Module</a> . <br><br>       ,     ,   .     - <code>add_one()</code> : <br><br><pre> <code class="python hljs">void add_one(int *x) { *x += <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br> ,      <code>x</code>  1.   ,      (shared) .  ,      <code>add.c</code> ,      gcc: <br><br><pre> <code class="python hljs">$ gcc -c -Wall -Werror -fpic add.c $ gcc -shared -o libadd1.so add.o</code> </pre> <br>      C   <code>add.o</code> .           <code>libadd1.so</code> . <br><br> <code>libadd1.so</code>      .    ctypes    Python: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ctypes &gt;&gt;&gt; add_lib = ctypes.CDLL(<span class="hljs-string"><span class="hljs-string">"./libadd1.so"</span></span>) &gt;&gt;&gt; add_lib.add_one &lt;_FuncPtr object at <span class="hljs-number"><span class="hljs-number">0x7f9f3b8852a0</span></span>&gt;</code> </pre> <br>  ctypes.CDLL  ,     <code>libadd1</code> .      <code>add_one()</code> ,      ,        Python-.     ,    .  Python  ,      . <br><br>         , ctypes       : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>add_one = add_lib.add_one &gt;&gt;&gt; add_one.argtypes = [ctypes.POINTER(ctypes.c_int)]</code> </pre> <br>     ,    C. ,        ,       : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>add_one(<span class="hljs-number"><span class="hljs-number">1</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; ctypes.ArgumentError: argument <span class="hljs-number"><span class="hljs-number">1</span></span>: &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TypeError</span></span></span><span class="hljs-class">'&gt;:</span></span> \ expected LP_c_int instance instead of int</code> </pre> <br> Python    ,  <code>add_one()</code>   ,     .  ,  ctypes      .       : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = ctypes.c_int() &gt;&gt;&gt; x c_int(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>      <code>x</code>   <code>0</code> . ctypes    <code>byref()</code> ,      . <br><br> <b></b> :  <b> </b>     <b> </b> . <br><br>          ,       .         ,        . <br><br>   <code>add_one()</code>    : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>add_one(ctypes.byref(x)) <span class="hljs-number"><span class="hljs-number">998793640</span></span> &gt;&gt;&gt; x c_int(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Super!     1. ,     Python  . <br><br><h2>  Conclusion </h2><br>        Python  .          ,              Python. <br><br>         Python: <br><br><ul><li>          . <br></li><li>   Python-   . <br></li><li>       ctypes. <br></li></ul><br>       Python       . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454324/">https://habr.com/ru/post/fr454324/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454314/index.html">10 principes de programmation orient√©e objet que chaque d√©veloppeur doit conna√Ætre</a></li>
<li><a href="../fr454316/index.html">Sur les traces du ninja industriel: nous vous invitons √† participer au concours en ligne de s√©curit√© industrielle</a></li>
<li><a href="../fr454318/index.html">Sondant le pass√©. Un guide pour les historiens sur la conversion des donn√©es en sons</a></li>
<li><a href="../fr454320/index.html">Analystes du march√© du travail et scientifiques des donn√©es</a></li>
<li><a href="../fr454322/index.html">Certains disent que la technologie DANE pour les navigateurs a √©chou√©</a></li>
<li><a href="../fr454326/index.html">En plus de Moore - qui d'autre a formul√© les lois de la mise √† l'√©chelle des syst√®mes informatiques</a></li>
<li><a href="../fr454330/index.html">10 points forts de TechTrain 2018: l'IA pour les masses, les interfaces, etc.</a></li>
<li><a href="../fr454332/index.html">Comment le bot Telegram a surmont√© la procrastination des concepteurs et contribu√© √† augmenter les revenus des agences num√©riques</a></li>
<li><a href="../fr454334/index.html">Moto. Weep AWS</a></li>
<li><a href="../fr454336/index.html">Client: - Combien co√ªte une copie de Facebook?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>