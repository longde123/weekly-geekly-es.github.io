<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¢Ô∏è üßë ‚úçüèΩ C√≥mo funciona la composici√≥n alfa üéæ üí® üß•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La transparencia puede no parecer un tema interesante. El formato GIF, que permiti√≥ que algunos p√≠xeles brillaran en el fondo, se public√≥ hace m√°s de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona la composici√≥n alfa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468067/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/bw/7x/fdbw7xdswtd_k6crz13wprtqbtm.gif" alt="imagen"></div><br>  La transparencia puede no parecer un tema interesante.  El formato GIF, que permiti√≥ que algunos p√≠xeles brillaran en el fondo, se public√≥ hace m√°s de 30 a√±os.  Casi todas las aplicaciones de dise√±o gr√°fico lanzadas en las √∫ltimas dos d√©cadas admiten la creaci√≥n de contenido transl√∫cido.  Estos conceptos han dejado de ser algo nuevo. <br><br>  En mi art√≠culo quiero mostrar que, de hecho, la transparencia en las im√°genes digitales es mucho m√°s interesante de lo que parece: en lo que damos por sentado, hay una profundidad y belleza invisibles. <br><a name="habracut"></a><br><h1>  Opacidad </h1><br>  Si alguna vez has visto a trav√©s de lentes rosas, entonces podr√≠as ver algo similar a lo que se muestra en la figura a continuaci√≥n.  [En el art√≠culo original, muchas im√°genes son interactivas.] Intente mover las gafas para ver c√≥mo afectan lo que se ve a trav√©s de ellas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tu/zo/mz/tuzomzqhbl9mcfzbxxcaneot3aq.png"></div><br>  Tales gafas funcionan de la siguiente manera: pierden mucho rojo, una cantidad decente de azul y muy poco verde.  La matem√°tica de estos puntos se puede escribir en un conjunto de tres ecuaciones.  La letra <strong>R</strong> indica el resultado de la operaci√≥n, y la letra <strong>D</strong> describe el punto que estamos viendo.  Los √≠ndices RGB indican los componentes rojo, verde y azul: <br><br><blockquote><code>R <sub>R</sub> = D <sub>R</sub> √ó 1.0 <br> R <sub>G</sub> = D <sub>G</sub> √ó 0.7 <br> R <sub>B</sub> = D <sub>B</sub> √ó 0.9</code> </blockquote> <br>  Este vitral transmite componentes rojos, verdes y azules del fondo con diferentes intensidades.  En otras palabras, la <em>transparencia de</em> las gafas <em>de</em> color rosa depende del color de la luz incidente.  En general, la transparencia puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">variar dependiendo de la longitud de onda de la luz</a> , pero en este ejemplo simplificado, solo estamos interesados ‚Äã‚Äãen c√≥mo las gafas afectan los componentes RGB cl√°sicos. <br><br>  Simular el comportamiento de las gafas de sol normales es mucho m√°s simple, por lo general solo aten√∫an la luz incidente en cierta cantidad: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qf/lq/8k/qflq8kkgpnh__pk8lpv5rx6txya.png"></div><br>  Estas gafas permiten que solo el 30% de la luz pase a trav√©s de ellas.  Su comportamiento se puede describir mediante las siguientes ecuaciones: <br><br><blockquote> <code>R <sub>R</sub> = D <sub>R</sub> √ó 0.3 <br> R <sub>G</sub> = D <sub>G</sub> √ó 0.3 <br> R <sub>B</sub> = D <sub>B</sub> √ó 0.3</code> </blockquote> <br>  Los tres componentes de color se reducen en el mismo valor: la absorci√≥n de la luz incidente es la misma.  Podemos decir que las gafas oscuras son 30% transparentes (opacas) o 70% opacas.  <em>La opacidad de un</em> objeto determina cu√°nto color bloquea.  En gr√°ficos de computadora, generalmente tratamos con un modelo simplificado en el que solo se necesita un valor para describir esta propiedad.  La opacidad puede variar espacialmente.  como, por ejemplo, una columna de humo que se hace m√°s alta y m√°s transparente. <br><br>  En el mundo real, los objetos con una opacidad del 100% son simplemente opacos y no transmiten luz en absoluto.  El mundo de las im√°genes digitales es un poco diferente.  Hay casos l√≠mite en el que incluso los objetos opacos s√≥lidos pasan una cierta cantidad de luz. <br><br><h1>  Cobertura </h1><br>  Los gr√°ficos vectoriales tratan con descripciones claras e infinitamente precisas de formas definidas utilizando puntos, segmentos de l√≠nea, curvas de Bezier y otras primitivas matem√°ticas.  Cuando necesite mostrar figuras en la pantalla de una computadora, estas entidades impecables deben rasterizarse en un mapa de bits: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebc/a01/6ed/ebca016ed191611e29f68dfca5aebe62.svg" width="492" height="202"></div><br>  <i>Rasterizaci√≥n de una forma vectorial a un mapa de bits</i> <br><br>  La forma m√°s primitiva de rasterizar es verificar d√≥nde se encuentra la muestra de p√≠xeles, dentro o fuera de la forma del vector.  En los ejemplos a continuaci√≥n, puede arrastrar el tri√°ngulo, en una vista ampliada, los movimientos ser√°n m√°s precisos.  Un contorno azul indica la geometr√≠a del vector original.  Como puede ver, la escalera en los bordes del tri√°ngulo se ve fea y parpadea mucho al mover la geometr√≠a: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mp/kn/pg/mpknpgk1lauj0ruzaobm6azr2wy.png"></div><br>  La desventaja de este enfoque es que solo realizamos una comprobaci√≥n para cada p√≠xel mostrado, y los resultados se discretizan a uno de los dos valores posibles, dentro o fuera. <br><br>  Puede muestrear la geometr√≠a del vector varias veces por p√≠xel para obtener una gran gradaci√≥n de pasos y decidir que algunos p√≠xeles solo est√©n <em>parcialmente</em> cerrados.  Una posible soluci√≥n es usar cuatro puntos de muestreo para representar cinco niveles de cobertura: 0, <sup>1</sup> ‚ÅÑ <sub>4</sub> , <sup>2</sup> ‚ÅÑ <sub>4</sub> , <sup>3</sup> ‚ÅÑ <sub>4</sub> y 1: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hi/uu/pw/hiuupwrv88cjcfjxv5_f-b1hege.png"></div><br>  La calidad de los bordes del tri√°ngulo ha mejorado, pero a menudo solo cinco niveles posibles de cobertura no son suficientes y podemos lograr f√°cilmente un resultado mucho mejor.  Aunque la vista de un p√≠xel como un peque√±o cuadrado en el mundo del procesamiento de se√±ales se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ve con desaprobaci√≥n</a> , en algunos contextos es un modelo √∫til que nos permite calcular la cobertura exacta de un p√≠xel por geometr√≠a vectorial.  La intersecci√≥n de una l√≠nea y un cuadrado siempre se puede descomponer en un <i>trapecio</i> y un <i>rect√°ngulo</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24e/b9f/494/24eb9f494ab4259257189da367efef01.svg" alt="imagen"></div><br>  <i>Un segmento de l√≠nea divide un cuadrado en un trapecio y un rect√°ngulo.</i> <br><br>  Puede calcular f√°cilmente el √°rea de ambas partes, y su suma dividida por el √°rea del cuadrado determina el porcentaje de cobertura de p√≠xeles.  Por lo tanto, la cobertura se calcula como un n√∫mero exacto con precisi√≥n arbitraria.  En la demostraci√≥n que se muestra a continuaci√≥n, este m√©todo se usa para renderizar bordes mucho mejores que permanecen suaves incluso al arrastrar un tri√°ngulo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xj/pd/fw/xjpdfwcvkdgujdwittnyzxan6ce.png"></div><br>  Cuando se trata de formas m√°s complejas, por ejemplo, elipses o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Beziers</a> , a menudo se dividen en segmentos simples de l√≠nea recta que le permiten calcular la cobertura con la precisi√≥n correcta. <br><br>  El concepto de cobertura parcial es cr√≠tico para la representaci√≥n de alta calidad de gr√°ficos vectoriales y, lo que es m√°s importante, para la representaci√≥n de texto.  Si toma una captura de pantalla de este art√≠culo y lo considera cuidadosamente, notar√° que casi todos los bordes de los glifos cubren los p√≠xeles solo parcialmente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69a/b93/1ef/69ab931ef9b9eeb4f669f29652044c0d.png" height="50%" width="50%"></div><br>  <i>La cobertura parcial se usa activamente en la representaci√≥n de texto</i> <br><br>  Teniendo la opacidad del objeto y cubri√©ndolo con p√≠xeles individuales, puede combinarlos en un solo valor. <br><br><h1>  Alfa </h1><br>  El producto de la opacidad de un objeto y su cobertura de p√≠xeles se llama <em>alfa</em> : <br><br><blockquote> <code> =  √ó </code> </blockquote> <br>  Un objeto con una opacidad del 60%, que cubre el 30% del √°rea de p√≠xeles, tiene un valor alfa del 18% en este p√≠xel.  Naturalmente, cuando el objeto es transparente o no cubre completamente el p√≠xel, entonces el valor alfa en este p√≠xel es 0. Despu√©s de la multiplicaci√≥n, las diferencias entre opacidad y recubrimiento desaparecen, lo que en cierto sentido justifica el hecho de que los conceptos de "alfa" y "opacidad" se usan como sin√≥nimos. <br><br>  Alfa a menudo se representa como un cuarto canal de una imagen de mapa de bits.  Los valores habituales de rojo, verde y azul se complementan con un valor alfa, formando cuatro valores RGBA. <br><br>  Cuando se trata de almacenar valores alfa en la memoria, existe la tentaci√≥n de usar solo unos pocos bits para esto.  En el caso de cubrir los p√≠xeles de los bordes de los objetos opacos, parece que 4 o incluso 3 bits ser√°n suficientes, dependiendo de la densidad de p√≠xeles de la pantalla: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qr/xt/pr/qrxtpr2tyhpn1znd0brdi8ehhns.png"></div><br>  Sin embargo, la opacidad tambi√©n afecta el valor alfa, por lo que una profundidad de bits baja puede ser catastr√≥fica en algunos casos de cambios suaves de transparencia.  La imagen a continuaci√≥n muestra un gradiente de negro opaco a blanco, lo que demuestra que una profundidad de bits baja produce variaciones de color muy fuertes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jm/8a/bv/jm8abvbbl5mejxely1nbhefyv8u.png"></div><br>  Obviamente, cuantos m√°s bits, mejor, y con mayor frecuencia para alfa, se utiliza una profundidad de 8 bits para igualar la precisi√≥n de los componentes de color, raz√≥n por la cual muchos buffers RGBA ocupan 32 bits por p√≠xel.  Tambi√©n vale la pena se√±alar que, a diferencia de los componentes de color, que a menudo se codifican mediante transformaci√≥n no lineal, alfa se almacena linealmente: el valor codificado de 0.5 corresponde a un valor alfa de 0.5. <br><br>  Hablando de alfa, ignoramos por completo todos los dem√°s componentes de color, pero adem√°s de bloquear el color de fondo, el p√≠xel en s√≠ mismo puede agregar un poco de color.  La idea es bastante simple: un objeto rosa transl√∫cido bloquea parte de la iluminaci√≥n de fondo entrante y emite o refleja una peque√±a luz rosa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/_w/kf/tc_wkf6dtsblbjvxx1nslytlu2u.gif"></div><br>  Tenga en cuenta que no <em>se</em> comporta como vidrieras.  El vidrio simplemente bloquea parte de la iluminaci√≥n de fondo con diferente brillo.  Si miras un objeto completamente negro a trav√©s del vidrio rosa, entonces su negrura permanecer√°, porque el objeto negro no emite y no refleja ninguna luz.  Sin embargo, el objeto rosa transl√∫cido <em>agrega</em> su propia luz.  Si lo coloca encima de un objeto negro, el resultado ser√° rosado.  Un buen an√°logo de este comportamiento es el material fino suspendido en el aire, como neblina, humo, niebla o alg√∫n polvo de color. <br><br>  Representar un canal alfa es un poco m√°s dif√≠cil: un objeto perfectamente transparente es invisible por definici√≥n, por lo que para distinguir entre los objetos, necesitamos usar dos trucos.  Un fondo de tablero de ajedrez muestra qu√© partes de la imagen son transparentes;  Este patr√≥n se usa en muchas aplicaciones gr√°ficas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b4/ff5/064/6b4ff5064b6cd9262e4d381125b406c4.svg" width="280" height="144"></div><br>  <i>El patr√≥n de ajedrez muestra piezas transparentes.</i> <br><br>  Los cuatro cuadrados peque√±os debajo de la imagen nos dicen que vemos los componentes rojo, verde, azul y alfa de la imagen.  En algunos casos, es √∫til ver directamente los valores del canal alfa, y la forma m√°s f√°cil de mostrarlos es usar tonos de gris: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9a/c12/c33/c9ac12c335263552b56dda8f3bd35262.svg" width="280" height="306"></div><br>  <i>Mostrar valores RGB y A en diferentes superficies</i> <br><br>  Cuanto m√°s brillante sea el tono de gris, mayor ser√° el valor alfa, es decir, el negro puro corresponde al 0% alfa y el blanco puro al 100% alfa.  Los cuadrados peque√±os indican que los componentes RGB y A de la imagen se dividen en dos partes. <br><br>  El componente alfa en s√≠ no es particularmente √∫til, pero se vuelve muy importante cuando hablamos de composici√≥n. <br><br><h1>  Composici√≥n simple </h1><br>  Se pueden implementar muy pocos efectos de renderizado 2D en una sola operaci√≥n, y para crear un resultado final, utilizamos un proceso de <em>composici√≥n</em> que combina varias im√°genes.  Por ejemplo, se puede crear un simple bot√≥n "Cancelar" al componer cinco elementos separados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd5/2d1/80f/cd52d180f6aba101c8fd2bf95bd721fe.svg" width="318" height="328"></div><br>  <i>Elementos de composici√≥n para el bot√≥n Cancelar</i> <br><br>  La composici√≥n a menudo se realiza en varias etapas, en cada una de las cuales se combinan dos im√°genes.  La imagen de primer plano utilizada en la composici√≥n se denomina com√∫nmente <em>fuente</em> .  La imagen de fondo utilizada en la composici√≥n, en la que se superpone la fuente, generalmente se denomina <em>destino</em> . <br><br>  Comenzaremos componiendo en un fondo opaco, porque este es un caso muy com√∫n.  Todo lo que ves en la pantalla se superpone en √∫ltima instancia al componer en un destino opaco. <br><br>  Cuando el valor alfa de la fuente es 100%, la fuente es opaca y debe cubrir completamente el destino.  Si el valor alfa es 0%, el origen es completamente transparente y no afecta el destino de ninguna manera.  Un valor alfa del 25% permite que el objeto emita el 25% de su luz y pasa el 75% de la luz del fondo, y as√≠ sucesivamente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/985/719/921/985719921b6dc06496caba46db08a5c5.svg" width="520" height="248"></div><br>  <i>Composici√≥n de fuente p√∫rpura con diferentes valores alfa a destino amarillo</i> <br><br>  Ya puedes entender lo que va a pasar todo, un simple caso de composici√≥n alfa en un fondo opaco, es solo una interpolaci√≥n lineal entre el destino y los colores de origen.  En el gr√°fico a continuaci√≥n, el control deslizante controla el valor alfa de la fuente, y los gr√°ficos rojo, verde y azul muestran los valores de los componentes RGB.  El resultado de <strong>R</strong> es solo una mezcla entre la fuente <strong>S</strong> y el destino <strong>D</strong> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/bw/7x/fdbw7xdswtd_k6crz13wprtqbtm.gif"></div><br>  Lo que sucede aqu√≠ puede describirse mediante las ecuaciones que se muestran a continuaci√≥n.  Como antes, el √≠ndice denota el componente, es decir, S <sub>A</sub> es el valor alfa en la fuente y D <sub>G</sub> es el valor verde en el destino: <br><br><blockquote> <code>R <sub>R</sub> = S <sub>R</sub> √ó S <sub>A</sub> + D <sub>R</sub> √ó (1 ‚àí S <sub>A</sub> ) <br> <br> R <sub>G</sub> = S <sub>G</sub> √ó S <sub>A</sub> + D <sub>G</sub> √ó (1 ‚àí S <sub>A</sub> ) <br> <br> R <sub>B</sub> = S <sub>B</sub> √ó S <sub>A</sub> + D <sub>B</sub> √ó (1 ‚àí S <sub>A</sub> )</code> </blockquote> <br>  Las ecuaciones para los componentes rojo, verde y azul tienen la misma apariencia, por lo que simplemente puede usar el √≠ndice <sub>RGB</sub> y combinarlos en una l√≠nea: <br><br><blockquote> <code>R <sub>RGB</sub> = S <sub>RGB</sub> √ó S <sub>A</sub> + D <sub>RGB</sub> √ó (1 ‚àí S <sub>A</sub> )</code> </blockquote> <br>  Adem√°s, dado que el destino es opaco y ya bloquea toda la luz de fondo, sabemos que el valor alfa del resultado siempre es 1: <br><br><blockquote> <code>R <sub>A</sub> = 1</code> </blockquote> <br>  La composici√≥n en un fondo opaco es simple, pero tiene capacidades bastante limitadas.  En muchos casos, se requiere una soluci√≥n m√°s confiable. <br><br><h1>  Tampones intermedios </h1><br>  La imagen a continuaci√≥n muestra el proceso de dos pasos de composici√≥n de tres capas diferentes, etiquetadas A, B y C. El s√≠mbolo ‚á® significar√° "superpuesto por composici√≥n en": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a9/fb8/ca5/6a9fb8ca58b71a7327785e10b54ef8da.svg" width="620" height="310"></div><br>  <i>El resultado de la composici√≥n en dos etapas de tres capas.</i> <br><br>  Primero superponemos B con C componiendo, y luego superponemos A con ellos para obtener la imagen final.  En el siguiente ejemplo, haremos las cosas un poco diferentes.  Primero, conectaremos las dos capas superiores mediante la composici√≥n, y luego superpondremos el resultado en el √∫ltimo destino: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a99/a10/e40/a99a10e409562f903fa7e66b4a363706.svg" width="620" height="310"></div><br>  <i>El resultado de la composici√≥n en dos etapas de tres capas en un orden diferente</i> <br><br>  Probablemente se est√© preguntando si tal situaci√≥n surge en la pr√°ctica, pero de hecho es muy com√∫n.  Muchas operaciones de composici√≥n no triviales y efectos de renderizado, como el enmascaramiento y el desenfoque, requieren pasar a trav√©s de un b√∫fer intermedio que contiene solo resultados de composici√≥n parciales.  Este concepto tiene diferentes nombres: pases fuera de pantalla, capas de transparencia o buffers laterales, pero generalmente se basan en la misma idea. <br><br>  Lo que es m√°s importante para nosotros es que casi <em>cualquier</em> imagen con transparencia se puede percibir como un resultado parcial de alguna representaci√≥n, que luego se superpondr√° al componer en el √∫ltimo destino: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/862/2cc/804/8622cc804d280c508244ccfc60c0e461.svg" width="128" height="48"></div><br>  <i>Composici√≥n parcial de un bot√≥n en un portapapeles</i> <br><br>  Necesitamos entender c√≥mo reemplazar la composici√≥n de las im√°genes transl√∫cidas A y B con una imagen (A‚á®B) que tenga el mismo color y opacidad.  Comencemos calculando el valor alfa del b√∫fer final. <br><br><h1>  Combinando valores alfa </h1><br>  Es posible que no tenga claro c√≥mo combinar la opacidad de dos objetos, pero es m√°s f√°cil hablar de esta tarea si hablamos de transparencia. <br><br>  Supongamos que una cierta cantidad de luz pasa a trav√©s del primer objeto y luego a trav√©s del segundo objeto.  Si la transparencia del primer objeto es del 80%, pasar√° el 80% de la luz incidente.  Del mismo modo, un segundo objeto con un 60% de transparencia permitir√° que el 60% de la luz pase a trav√©s de √©l, lo que nos da un 60% √ó 80% = 48% de la luz original.  Puedes experimentar con la transparencia en el art√≠culo original;  no olvide que los controles deslizantes controlan la <em>transparencia</em> y no la opacidad de los objetos en el camino de la luz: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/av/f5/lv/avf5lvv7kve1zkgnztkd_i_hylq.png"></div><br>  Naturalmente, cuando el primer o el segundo objeto es opaco, no pasa luz a trav√©s de ellos, incluso otro es completamente transparente. <br><br>  Si el objeto D tiene transparencia D <sub>T</sub> y el objeto S tiene transparencia S <sub>T</sub> , entonces la transparencia general final R <sub>T de</sub> estos dos objetos es igual a su producto: <br><br><blockquote>  R <sub>T</sub> = D <sub>T</sub> √ó S <sub>T</sub> </blockquote><br>  Sin embargo, la transparencia es solo una unidad menos alfa, por lo que la sustituci√≥n nos da lo siguiente: <br><br><blockquote>  1 - R <sub>A</sub> = (1 - D <sub>A</sub> ) √ó (1 - S <sub>A</sub> ) </blockquote><br>  Esta expresi√≥n se puede expandir a: <br><br><blockquote>  1 - R <sub>A</sub> = 1 - D <sub>A</sub> - S <sub>A</sub> + D <sub>A</sub> √ó S <sub>A</sub> </blockquote><br>  Y simplif√≠calo as√≠: <br><br><blockquote>  R <sub>A</sub> = D <sub>A</sub> + S <sub>A</sub> - D <sub>A</sub> √ó S <sub>A</sub> </blockquote><br>  Se puede reducir a uno de dos tipos similares: <br><br><blockquote>  R <sub>A</sub> = S <sub>A</sub> + D <sub>A</sub> √ó (1 - S <sub>A</sub> ) <br><br>  R <sub>A</sub> = D <sub>A</sub> + S <sub>A</sub> √ó (1 - D <sub>A</sub> ) </blockquote><br>  Pronto veremos que el segundo se usa con m√°s frecuencia.  Tambi√©n es interesante observar que el valor alfa resultante no depende del orden relativo de los objetos: la opacidad de los p√≠xeles resultantes es la misma, incluso si intercambia el origen y el destino.  Esto es muy l√≥gico.  La luz que pasa a trav√©s de dos objetos debe desvanecerse de la misma manera, desde cualquier lado de la estrella, desde el frente o desde la parte posterior. <br><br><h1>  Combinaci√≥n de colores </h1><br>  Calcular alfa no fue tan dif√≠cil, as√≠ que tratemos de entender los c√°lculos de los componentes RGB.  La imagen de origen tiene el color S <sub>RGB</sub> , pero su opacidad S <sub>A</sub> obliga solo al producto de estos dos valores a tener en cuenta en el resultado final: <br><br><blockquote>  S <sub>RGB</sub> √ó S <sub>A</sub> </blockquote><br>  La imagen de destino tiene el color D <sub>RGB</sub> , la opacidad hace que emita luz D <sub>RGB</sub> √ó D <sub>A</sub> , sin embargo, parte de la luz est√° bloqueada por la opacidad de la imagen S, por lo que toda la influencia del destino es igual a: <br><br><blockquote>  D <sub>RGB</sub> √ó D <sub>A</sub> √ó (1 - S <sub>A</sub> ) </blockquote><br>  La contribuci√≥n total de la luz de S y D es igual a su suma: <br><br><blockquote>  S <sub>RGB</sub> √ó S <sub>A</sub> + D <sub>RGB</sub> √ó D <sub>A</sub> √ó (1 - S <sub>A</sub> ) </blockquote><br>  Del mismo modo, la contribuci√≥n de las capas fusionadas es igual a su color multiplicado por su opacidad: <br><br><blockquote>  R <sub>RGB</sub> √ó R <sub>A</sub> </blockquote><br>  Queremos que estos dos valores coincidan: <br><br><blockquote>  R <sub>RGB</sub> √ó R <sub>A</sub> = S <sub>RGB</sub> √ó S <sub>A</sub> + D <sub>RGB</sub> √ó D <sub>A</sub> √ó (1 - S <sub>A</sub> ) </blockquote><br>  Lo que nos da las ecuaciones finales: <br><br><blockquote>  R <sub>A</sub> = S <sub>A</sub> + D <sub>A</sub> √ó (1 - S <sub>A</sub> ) <br><br>  R <sub>RGB</sub> = (S <sub>RGB</sub> √ó S <sub>A</sub> + D <sub>RGB</sub> √ó D <sub>A</sub> √ó (1 - S <sub>A</sub> )) / R <sub>A</sub> </blockquote><br>  ¬°Mira lo complicada que es la segunda ecuaci√≥n!  Tenga en cuenta que para obtener los valores RGB del resultado, necesitamos dividir por el valor alfa.  Sin embargo, para la siguiente etapa de la composici√≥n, se requerir√° nuevamente la multiplicaci√≥n por el valor alfa, porque el resultado de la operaci√≥n actual se convertir√° en la nueva fuente o destino de la pr√≥xima operaci√≥n.  Es simplemente feo. <br><br>  Volvamos a la forma casi final de R <sub>RGB</sub> por un segundo: <br><br><blockquote>  R <sub>RGB</sub> √ó R <sub>A</sub> = S <sub>RGB</sub> √ó S <sub>A</sub> + D <sub>RGB</sub> √ó D <sub>A</sub> √ó (1 - S <sub>A</sub> ) </blockquote><br>  El origen, el destino <em>y el</em> resultado se multiplican por sus componentes alfa.  Esto nos hace comprender que el color y el alfa del p√≠xel "gusta" para estar juntos, por lo que debemos dar un paso atr√°s y repensar la forma en que almacenamos la informaci√≥n del color. <br><br><h1>  Alfa premultiplicado </h1><br>  Recuerde que hablamos de opacidad: si el objeto es parcialmente opaco, entonces su contribuci√≥n al resultado tambi√©n ser√° parcial.  El concepto de alfa premultiplicado ("pre-multiplicaci√≥n por alfa") implementa esta idea.  Los valores de los componentes RGB, como su nombre lo indica, se multiplican previamente por el componente alfa.  Comencemos con el color sin multiplicaci√≥n preliminar: <br><br><blockquote>  (1.00, 0.80, 0.30, 0.40) </blockquote><br>  La multiplicaci√≥n preliminar por alfa nos da lo siguiente: <br><br><blockquote>  (0.40, 0.32, 0.12, 0.40) </blockquote><br>  Echemos un vistazo a varios p√≠xeles a la vez.  La siguiente figura muestra c√≥mo se almacena la informaci√≥n de color sin multiplicar primero alfa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e20/ba7/338/e20ba7338feb27cdf22f3c25d3afa697.svg" width="440" height="262"></div><br>  <i>Informaci√≥n RGB y A en la imagen sin multiplicaci√≥n previa</i> <br><br>  Tenga en cuenta que las √°reas donde alfa es 0 pueden tener valores RGB arbitrarios, como se puede ver en las fallas verdes y azules en la imagen.  En el caso de la multiplicaci√≥n preliminar por alfa, la informaci√≥n de color tambi√©n almacena valores de opacidad de p√≠xeles: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/5d9/ede/6135d9ede6ea6789bbcd979e48a2cce0.svg" width="440" height="262"></div><br>  <i>Informaci√≥n RGB y A en una imagen previamente multiplicada</i> <br><br>  El alfa premultiplicado a veces se denomina alfa asociado, y el alfa no premultiplicado a veces se denomina alfa directo o no asociado. <br><br>  Cuando el componente alfa del color es 0, la multiplicaci√≥n preliminar restablece todos los dem√°s componentes, independientemente de sus valores: <br><br><blockquote>  (0.0, 0.0, 0.0, 0.0) </blockquote><br>  En el caso del alfa premultiplicado, solo hay <em>un</em> color completamente transparente, y esto es encantador. <br><br>  Las ventajas de este procesamiento de componentes de color se har√°n evidentes gradualmente, pero antes de que volvamos al ejemplo de composici√≥n, veamos c√≥mo el alfa premultiplicado ayuda a resolver algunos otros problemas de representaci√≥n. <br><br><h2>  Filtrado </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El desenfoque gaussiano</a> es una forma popular de crear un fondo desenfocado interesante o reducir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">alta frecuencia de la</a> parte de fondo del contenido de algunos elementos de la interfaz de usuario.  Como veremos, la pre-multiplicaci√≥n alfa es cr√≠tica para crear el desenfoque de aspecto correcto. <br><br>  La imagen que analizaremos se crea rellenando el fondo con azul opaco al 1%, sobre el cual se dibuja un c√≠rculo rojo opaco.  Primero, veamos un ejemplo sin multiplicaci√≥n preliminar.  Separ√© los canales RGB del canal alfa para comprender lo que estaba sucediendo.  La flecha indica la operaci√≥n de desenfoque: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ce/0eb/7f9/1ce0eb7f9342c4d90ca7c18bb827afba.png" width="530" height="264"></div><br>  <i>Contenido borroso sin multiplicaci√≥n previa</i> <br><br>  El resultado final tiene un halo azul feo.  Sucedi√≥ porque el fondo azul se filtr√≥ sobre el √°rea roja durante el desenfoque, y solo <em>entonces</em> , durante la composici√≥n, se le agreg√≥ el peso alfa. <br><br>  Cuando los colores se multiplican previamente por alfa, el resultado es correcto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c6/9f8/aa9/2c69f8aa9cba7a689eb2094d89661576.png" width="530" height="264"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pre-multiplicado borroso Debido a la multiplicaci√≥n previa, el color azul de la imagen se reduce al 1% de su fuerza original, por lo que su efecto sobre los colores del c√≠rculo borroso es extremadamente peque√±o.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interpolaci√≥n </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderizar una imagen cuyos p√≠xeles encajan perfectamente con el destino es una tarea simple porque necesitamos realizar un mapeo trivial uno a uno entre muestras. </font><font style="vertical-align: inherit;">Un problema surge cuando no hay un mapeo simple, por ejemplo, debido a la rotaci√≥n, escala o separaci√≥n de s√≠labas. </font><font style="vertical-align: inherit;">La siguiente figura muestra que los p√≠xeles de la imagen girada indicados por el contorno rojo ya no coinciden con el destino:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7c/55c/d9d/a7c55cd9d320d2fc5b8b4dd80622b54c.svg" width="596" height="290"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orientaci√≥n relativa de la imagen y p√≠xeles de destino antes y despu√©s de la rotaci√≥n</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay muchas formas de seleccionar un color de la imagen para escribir en el p√≠xel de destino, y la m√°s simple de ellas es la llamada interpolaci√≥n del vecino m√°s cercano, en la que como el p√≠xel final, simplemente se selecciona la muestra m√°s cercana en la textura. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la demostraci√≥n a continuaci√≥n, el contorno rojo muestra la posici√≥n de la imagen en el destino. El lado derecho muestra las posiciones de las muestras desde el punto de vista de la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagen</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Al arrastrar el control deslizante (en el art√≠culo original), puede girar el cuadr√°ngulo y observar c√≥mo las muestras seleccionan los colores del mapa de bits. Destaqu√© un p√≠xel en origen y destino, para que su relaci√≥n sea m√°s clara:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/0v/if/zd0vifjvna1jjf_apdomph8bmd0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta soluci√≥n es bastante funcional y los p√≠xeles tienen un color hol√≠stico, pero la calidad es inaceptable. Ser√≠a mejor utilizar la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interpolaci√≥n bilineal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que calcula el promedio ponderado de los cuatro p√≠xeles m√°s cercanos de la imagen muestreada:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s0/fy/qi/s0fyqirq3p9cpyfb5vl4gxzsz0q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto funciona mejor, pero los bordes alrededor de los rect√°ngulos no se ven bien, el contenido de los p√≠xeles se fusiona sin multiplicaci√≥n, porque el alfa se "aplica" despu√©s de la interpolaci√≥n. A veces, la soluci√≥n recomendada para fusionar el color del contenido correcto, que se muestra en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sorprendente art√≠culo de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adrian Correger [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traducci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Habr√©], est√° lejos de ser ideal: ni un solo color en la brecha entre los rect√°ngulos rojo y azul se ver√° bien. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veamos c√≥mo se ver√° todo en la imagen con alfa premultiplicado y composici√≥n con una f√≥rmula avanzada, que pronto derivaremos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/to/ax/zy/toaxzyjkgdouyossh7kzgkgudyi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplemente perfecto: nos deshicimos de todas las fusiones de colores y los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dientes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no se ven por ning√∫n lado </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En √∫ltima instancia, los problemas asociados con el desenfoque y la interpolaci√≥n est√°n estrechamente relacionados. </font><font style="vertical-align: inherit;">Es probable que cualquier operaci√≥n que requiera cualquier combinaci√≥n de colores transl√∫cidos, sin multiplicar primero los colores por alfa, d√© resultados incorrectos.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La composici√≥n correcta </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volvamos a la composici√≥n. </font><font style="vertical-align: inherit;">Nos decidimos por una ecuaci√≥n casi derivada:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó R </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si imagina colores usando alfa premultiplicado, entonces todas estas inc√≥modas multiplicaciones desaparecer√°n, porque el alfa ya ser√° parte de los valores de color. </font><font style="vertical-align: inherit;">Luego obtenemos lo siguiente:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RGB</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Veamos la ecuaci√≥n alfa: </font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Los coeficientes para los canales rojo, verde, azul y alfa son los mismos, por lo que podemos expresar la expresi√≥n completa con una ecuaci√≥n y solo recordar que cada componente se somete a la misma operaci√≥n: </font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vea c√≥mo el alfa premultiplicado facilit√≥ las cosas. </font><font style="vertical-align: inherit;">Cuando analizamos los componentes de la ecuaci√≥n, todos est√°n en su lugar. </font><font style="vertical-align: inherit;">La operaci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enmascara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte de la luz de fondo y agrega una nueva luz:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta operaci√≥n de mezcla se llama source-over, sover o simplemente normal, y es sin duda el modo de composici√≥n m√°s com√∫n. </font><font style="vertical-align: inherit;">Casi todo lo que ves en mi sitio web se mezcla en este modo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asociatividad </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una propiedad importante de fuente sobre realizada en colores pre-alfa multiplicados es la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asociatividad de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta operaci√≥n. </font><font style="vertical-align: inherit;">Gracias a √©l, en la compleja ecuaci√≥n de mezcla, podemos colocar los corchetes de forma completamente arbitraria. </font><font style="vertical-align: inherit;">Todas las composiciones que se muestran a continuaci√≥n son equivalentes:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = (((A‚á®B) ‚á®C) ‚á®D) ‚á®E </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = (A‚á®B) ‚á® (C‚á® (D‚á®E)) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = A‚á® (B‚á® (C‚á® (D‚á®E)) )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prueba de esto es bastante simple, pero no te cargar√© con manipulaciones algebraicas. </font><font style="vertical-align: inherit;">En la pr√°ctica, esto significa que podemos representar parcialmente dibujos complejos sin temor a que la composici√≥n final se vea mal. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la gran mayor√≠a de los casos, alpha se usa solo para componer usando source-over, pero sus ventajas no terminan ah√≠. </font><font style="vertical-align: inherit;">Los valores alfa tambi√©n se pueden usar para otras operaciones de representaci√≥n √∫tiles.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Porter-Duff Compositing </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En julio de 1984, Thomas Porter y Tom Duff publicaron el art√≠culo original, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Composici√≥n de im√°genes digitales"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Los autores no solo introdujeron por primera vez el concepto de alfa premultiplicado y derivaron la ecuaci√≥n de composici√≥n fuente, sino que tambi√©n presentaron una familia completa de operaciones de composici√≥n alfa, muchas de las cuales son poco conocidas, aunque muy √∫tiles. </font><font style="vertical-align: inherit;">Las nuevas funciones tambi√©n se denominan </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operadores</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> porque, como sumar o multiplicar, realizan acciones en los valores de entrada para crear un valor de salida.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sobre </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ejemplos futuros, utilizaremos demostraciones interactivas que muestran las operaciones de varios modos de fusi√≥n. </font><font style="vertical-align: inherit;">La imagen de destino ser√° el s√≠mbolo negro "club", y la imagen de origen ser√° el s√≠mbolo rojo "gusanos". </font><font style="vertical-align: inherit;">Puede arrastrar el coraz√≥n sobre la imagen y observar c√≥mo se comportan las formas superpuestas bajo diferentes operadores de composici√≥n. </font><font style="vertical-align: inherit;">Presta atenci√≥n al peque√±o minimapa en la esquina. </font><font style="vertical-align: inherit;">Algunos modos de fusi√≥n son muy destructivos y f√°ciles de confundir. </font><font style="vertical-align: inherit;">El minimapa siempre muestra el resultado de una composici√≥n de fuente simple, lo que simplifica la comprensi√≥n:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vx/nb/n3/vxnbn3qhwfuiobes7rws0ardxtq.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó (1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) + D</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si cambia a destino de destino, inmediatamente se dar√° cuenta de que simplemente "voltea" el origen de destino: el destino y el origen se intercambian en la ecuaci√≥n y el resultado es equivalente a lo que consideraremos destino como la imagen de origen. </font><font style="vertical-align: inherit;">Aunque parece redundante, el operador de destino sobre es extremadamente √∫til porque le permite componer objetos que est√°n </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bajo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contenido existente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fuera </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las declaraciones de origen y destino son excelentes para perforar agujeros en origen o destino: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/c1/pn/ou/c1pnoudiz66kdmddiaqkmdxcyuq.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó (1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> De estos dos operadores, Destination-out es m√°s conveniente porque utiliza el canal alfa para perforar agujeros en el formulario de destino. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Los operadores de origen y destino son esencialmente operadores de enmascaramiento: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/je/jc/fxjejc-my5ewd7otz8_r2ylueas.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = D √ó S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Facilitan la creaci√≥n de intersecciones complejas de geometr√≠a no trivial sin resolver las intersecciones relativamente dif√≠ciles de calcular contornos vectoriales. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Encima </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los operadores </font></font><code>source-atop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y le </font></font><code>destination-atop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permiten superponer nuevo contenido en los existentes, mientras lo enmascaran a lo largo de la ruta de destino:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/js/f-/2o/jsf-2on9uxoowdzpk73ugiadypw.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó (1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) + D √ó S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </blockquote><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Xor </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El operador OR exclusivo ( </font></font><code>xor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) guarda </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> origen o el destino, y sus √°reas coincidentes desaparecen:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bm/i6/uo/bmi6uoidqbrytp4e4gbmy6afvck.png"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó (1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fuente, destino, claro </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los √∫ltimos tres modos de composici√≥n cl√°sicos son bastante aburridos. </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tambi√©n llamado </font></font><code>copy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, solo toma la fuente de color. </font><font style="vertical-align: inherit;">Del mismo modo, </font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignora la fuente de color y simplemente regresa </font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El operador </font></font><code>clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplemente borra todo:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/li/mo/fwlimouoegmu9ff1r1tqno-uags.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R = S </font></font></blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R = D </font></font></blockquote><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R = 0 </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La aplicabilidad de estos modos es limitada. </font><font style="vertical-align: inherit;">Al </font></font><code>clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usarlo, puede vaciar un b√∫fer lleno, pero esta operaci√≥n se puede optimizar simplemente llenando la memoria con ceros. </font><font style="vertical-align: inherit;">Adem√°s, en algunos casos </font></font><code>source</code> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√°s econ√≥mico en los c√°lculos, ya que no requiere ninguna mezcla, sino que simplemente reemplaza el contenido del b√∫fer con la informaci√≥n de origen.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Porter Duff en acci√≥n </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habiendo tratado con operadores individuales, veamos c√≥mo puede combinarlos. </font><font style="vertical-align: inherit;">En el siguiente ejemplo, dibujaremos un logotipo marino sin usar enmascaramiento o formas geom√©tricas complejas. </font><font style="vertical-align: inherit;">Los contornos azules muestran la geometr√≠a simple que se est√° creando. </font><font style="vertical-align: inherit;">Puede moverse a trav√©s de los pasos haciendo clic en el lado derecho de la imagen y regresar haciendo clic en el lado izquierdo:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qf/-l/ct/qf-lctetuaygx6y7nwxhl95breu.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por supuesto, no estamos obligados a abandonar m√°scaras y recortar contornos, pero a menudo nos olvidamos de una herramienta como los modos de composici√≥n Porter-Duff, aunque es mucho m√°s f√°cil crear algunos efectos visuales con su ayuda. </font></font><br><br><h2>  Operadores </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si observa de cerca a los operadores de Porter-Duff, notar√° que todos tienen la misma forma. </font><font style="vertical-align: inherit;">La fuente siempre se multiplica por un cierto coeficiente F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y se agrega al destino multiplicado por un coeficiente F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S √ó F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + D √ó F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></sub> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede tomar los valores 0, 1, D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pueden ser igual a 0, 1, S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o 1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No tiene sentido multiplicar el origen o el destino por su propio alfa, porque ya est√°n multiplicados previamente, y solo obtenemos el efecto elegante, pero no muy √∫til, del alfa cuadr√°tico. </font><font style="vertical-align: inherit;">Todos los operadores se pueden representar en forma de tabla:</font></font><br><br><div class="scrollable-table"><table><tbody><tr><td></td><td>  0 0 </td><td>  1 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></sub> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - D </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </td></tr><tr><td>  0 0 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> claro </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente </font></font></td></tr><tr><td>  1 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destino </font></font></td><td></td><td></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destino sobre </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destino en </font></font></td><td></td><td></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destino en la cima </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destino de salida </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente en la cima </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> xor </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Presta atenci√≥n a la simetr√≠a de los operadores en la diagonal. </font><font style="vertical-align: inherit;">Faltan los cuatro elementos centrales de la tabla y sucedi√≥ porque son diferentes del resto.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iluminaci√≥n aditiva </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En su art√≠culo, Porter y Duff presentan otro operador, en el que tanto el F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el S</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el F </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual a 1. Se conoce bajo los nombres </font></font><code>plus</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>lighter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>plus-lighter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R = S + D </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta operaci√≥n esencialmente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrega</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iluminaci√≥n de origen al destino:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2f/a9b/31c/a2fa9b31c91913bc0445b91ea8217670.png" width="488" height="226"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La iluminaci√≥n aditiva implementada con el operador</font></font><code><em>plus</em></code></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verde y rojo forman correctamente el amarillo, mientras que el verde y el azul forman cian. </font><font style="vertical-align: inherit;">El negro es la ausencia de una operaci√≥n; no cambia los valores de color de ninguna manera, porque agregar cero a un n√∫mero no cambia nada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los tres operadores restantes no recibieron nombres porque no son particularmente √∫tiles. </font><font style="vertical-align: inherit;">Son solo una combinaci√≥n de enmascaramiento y mezcla. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n vale la pena se√±alar que el alfa premultiplicado nos permite usar el operador de una </font></font><code>source-over</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manera inesperada. </font><font style="vertical-align: inherit;">Echemos un vistazo a la ecuaci√≥n nuevamente:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R = S + D √ó (1 - S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si logramos que el valor alfa en la fuente sea igual a cero, entonces si hay valores distintos de cero en los canales RGB, podemos lograr una iluminaci√≥n aditiva sin usar el operador </font></font><code>plus</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/400/42b/fbf/40042bfbf25d98ec04a5609fcf828f39.png" width="488" height="290"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iluminaci√≥n aditiva implementada utilizando el operador</font></font><code><em>source-over</em></code></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tenga en cuenta que debe tener cuidado aqu√≠: los valores ya no se multiplican por alfa correctamente. En algunos programas, puede haber una optimizaci√≥n que evite completamente mezclar colores con cero alfa, mientras que otros programas pueden revertir la multiplicaci√≥n previa por valores alfa, realizar algunas operaciones de color y luego volver a multiplicar previamente por alfa, lo que destruye completamente los canales de color. Tambi√©n puede ser dif√≠cil exportar recursos en este formato, por lo que si no tiene control total sobre la canalizaci√≥n de renderizado, entonces debe quedarse con el operador </font></font><code>plus</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los elementos que estamos discutiendo hasta ahora han sido bien combinados. </font><font style="vertical-align: inherit;">Ahora, qu√≠tese nuestras gafas de color rosa y analicemos algunos problemas que deben tenerse en cuenta al trabajar con la composici√≥n alfa.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opacidad de grupo </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Echemos un vistazo a este sencillo dibujo de p√≠ldora compuesto por solo seis primitivas: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e7/b44/c84/6e7b44c84ff94dfbe3e0f2943cd44b89.png" width="512" height="208"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dibuje una p√≠ldora usando formas simples</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si se nos pidiera que renderiz√°ramos una p√≠ldora con una opacidad del 50%, entonces podr√≠amos sentir la tentaci√≥n de dividir la opacidad en la mitad de cada operaci√≥n de dibujo, pero esto ser√≠a un error:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/63a/26b/13a63a26b176861264010a8d43aefb7a.png" width="160" height="96"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado inesperado de representar una p√≠ldora con media opacidad.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para lograr el resultado correcto, no podemos simplemente distribuir la opacidad de un objeto sobre cada uno de sus componentes individuales. </font><font style="vertical-align: inherit;">Primero tenemos que crear un objeto, convertirlo en un mapa de bits, y solo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">luego</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambiar la opacidad del mapa de bits y finalmente realizar la composici√≥n:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/798/7d0/708/7987d07084e48d8b3a51e99111c8a3ae.png" width="512" height="96"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado esperado de renderizar una pastilla con media opacidad</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este es otro caso que demuestra la utilidad del concepto de renderizar en un b√∫fer lateral.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cobertura de composici√≥n </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertir una cubierta geom√©trica en un solo valor alfa tiene consecuencias inc√≥modas. </font><font style="vertical-align: inherit;">Considere el caso cuando dos bordes idealmente coincidentes de figuras de geometr√≠a vectorial, que se muestran en la figura a continuaci√≥n con contornos naranja y azul, se representan en un mapa de bits. </font><font style="vertical-align: inherit;">En un mundo ideal, los resultados deber√≠an verse as√≠, porque cada p√≠xel est√° completamente cerrado:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45d/728/ca1/45d728ca1d4b35c64a2a3b1499930353.svg" width="555" height="255"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un resultado de renderizado ideal con la cobertura correcta.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sin embargo, si primero renderizamos la geometr√≠a naranja y luego la azul, en la imagen final todav√≠a se filtrar√° un peque√±o fondo blanco en los p√≠xeles del borde:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2f/cdd/66f/f2fcdd66f6b53504a36c5db42c17bfc5.svg" width="555" height="255"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resultado de la composici√≥n en dos etapas</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tan pronto como el recubrimiento se almacena en el canal alfa, se pierde toda su informaci√≥n geom√©trica y no podemos restaurarla de ninguna manera. La geometr√≠a azul simplemente se mezcla con </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algunos de los</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contenidos del b√∫fer, pero no sabe que la geometr√≠a representada por los p√≠xeles rojizos debe coincidir. Este problema es especialmente notable cuando las geometr√≠as se superponen con precisi√≥n entre s√≠. En la imagen a continuaci√≥n, se dibuja un c√≠rculo blanco encima de uno negro. Los bordes oscuros son notables, aunque ambos c√≠rculos tienen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactamente el mismo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> radio y posici√≥n:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a8/33f/e2c/9a833fe2c9881ed7c89ece47c0984f38.svg" width="180" height="180"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un c√≠rculo blanco dibujado encima de un c√≠rculo negro</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una forma de solucionar este problema es </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> calcular la cobertura parcial de los p√≠xeles y usar buffers significativamente m√°s grandes. Al rasterizar la geometr√≠a del vector con un revestimiento simple de entrada / salida, y luego reducir la escala del resultado al tama√±o de la imagen original, puede lograr el resultado esperado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, para una comparaci√≥n perfecta de la calidad de representaci√≥n de los bordes del canal alfa de 8 bits, los b√∫feres deber√≠an ser 256 veces m√°s grandes en </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> direcciones, es decir, el n√∫mero de p√≠xeles deber√≠a aumentar en 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiempos </font><font style="vertical-align: inherit;">Como vimos anteriormente, al reducir la profundidad de bits para los valores de cobertura, a√∫n puede obtener resultados satisfactorios, por lo que en la pr√°ctica puede usar una escala m√°s peque√±a. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n vale la pena se√±alar que tales problemas a menudo se pueden evitar con relativa facilidad sin el uso de enormes mapas de bits. </font><font style="vertical-align: inherit;">Por ejemplo, en lugar de dibujar dos c√≠rculos superpuestos, simplemente puede dibujar dos cuadrados uno encima del otro y </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">luego</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enmascarar el resultado para formar un c√≠rculo.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valores lineales </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ha actualizado su conocimiento de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los espacios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">color</font></a><font style="vertical-align: inherit;"> , puede recordar que la mayor√≠a de ellos codifican valores de color de forma no lineal, y es necesaria una linealizaci√≥n preliminar para realizar las operaciones matem√°ticas correctas. </font><font style="vertical-align: inherit;">Cuando se completa esta etapa, el resultado de la composici√≥n es el siguiente; </font><font style="vertical-align: inherit;">preste atenci√≥n al hermoso tinte amarillento de las partes superpuestas entre s√≠:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/24f/14d/bb024f14d3ede0fe13e72eb1de4a115a.png" width="280" height="300"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≠rculos rojos difusos superpuestos mediante la composici√≥n sobre un fondo verde utilizando valores lineales.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sin embargo, en la mayor√≠a de los casos, la composici√≥n </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><font style="vertical-align: inherit;">as√≠. </font><font style="vertical-align: inherit;">La forma est√°ndar para la web y la mayor√≠a de los software de gr√°ficos es mezclar directamente valores no lineales:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/245/77c/a2e/24577ca2e1dd42a2ef6c2ef1d33884d9.png" width="280" height="300"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≠rculos rojos difusos superpuestos por un compositor sobre un fondo verde usando valores no lineales</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tenga en cuenta que las √°reas donde el rojo sobre las superposiciones verdes son mucho m√°s oscuras. </font><font style="vertical-align: inherit;">Est√°n lejos de ser ideales, pero en algunos casos, las operaciones incorrectas est√°n profundamente arraigadas en la comprensi√≥n de c√≥mo percibimos el color. </font><font style="vertical-align: inherit;">Por ejemplo, el 50% de gris opaco del espacio sRGB se ve exactamente como negro puro con un 50% de opacidad mezclado con un fondo blanco:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/366/ca1/573/366ca1573d720de845ce276d7ef0d5b4.svg" width="405" height="133"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composici√≥n de dos colores sobre un fondo blanco</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sin </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linealizaci√≥n</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En la figura siguiente, los colores sRGB de las im√°genes de origen y destino se linealizan y luego se vuelven a convertir en codificaci√≥n no lineal para su visualizaci√≥n. </font><font style="vertical-align: inherit;">As√≠ es como deber√≠an verse estos colores:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ae/c74/90a/1aec7490a8fdf2a096f5e4c8f2b56cdc.svg" width="405" height="133"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composici√≥n de dos colores sobre un fondo blanco</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linealizaci√≥n.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tenemos una discrepancia que no cumple con nuestras expectativas. </font><font style="vertical-align: inherit;">La √∫nica forma de obtener uniformidad visual usando este m√©todo es seleccionar todos los colores usando valores lineales, pero esto es muy diferente de lo que todos est√°n acostumbrados. </font><font style="vertical-align: inherit;">El 50% de gris con valores lineales parece gris en el 73.5% del espacio sRGB. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, debe tener especial cuidado al trabajar con alfa premultiplicado. </font><font style="vertical-align: inherit;">La multiplicaci√≥n previa debe realizarse con </font><font style="vertical-align: inherit;">valores </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lineales</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es decir, </font><font style="vertical-align: inherit;">antes de codificar a no lineal. </font><font style="vertical-align: inherit;">Debido a esto, el paso de linealizaci√≥n finalizar√° correctamente con los valores lineales correctos, previamente multiplicados por alfa.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alfa y profundidad de bits premultiplicados </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pesar de su gran utilidad para la composici√≥n, el filtrado y la interpolaci√≥n, el alfa premultiplicado no es una "bala de plata" y tiene sus inconvenientes. </font><font style="vertical-align: inherit;">El m√°s serio de ellos es la reducci√≥n en la profundidad de bits de los colores que se pueden imaginar. </font><font style="vertical-align: inherit;">Imagine una codificaci√≥n de 8 bits con un valor de 150, que se multiplica previamente por alfa 20%. </font><font style="vertical-align: inherit;">Despu√©s de la multiplicaci√≥n preliminar por alfa, obtenemos</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redondo (150 √ó 0.2) = 30 </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si repetimos el mismo procedimiento con un valor de 151, obtenemos: </font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redondo (151 √ó 0.2) = 30 </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El valor codificado ser√° el mismo, a pesar de la diferencia en los valores iniciales. </font><font style="vertical-align: inherit;">De hecho, despu√©s de multiplicar por alfa, los valores de 148, 149, 150, 151 y 152 se codifican en 30, y la diferencia original entre estos cinco colores √∫nicos se pierde:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af3/a80/76c/af3a8076caef4fdae6146e6d503ea639.svg" width="560" height="203"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La multiplicaci√≥n previa por alfa del 20% reduce los diversos valores de 8 bits a uno.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Naturalmente, cuanto m√°s peque√±o es el alfa, m√°s destructivo es su efecto. Del rango posible de 256 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (aproximadamente 4,3 mil millones) de varias combinaciones de valores RGBA de 8 bits, despu√©s de la multiplicaci√≥n preliminar por alfa, solo el 25.2% conserva una representaci√≥n √∫nica; de hecho, perdemos casi 2 bits del rango de 32 bits.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para convertir colores entre diferentes espacios de color, a veces es necesario revertir la multiplicaci√≥n preliminar, es decir, dividir los valores por el componente alfa para obtener el brillo del color original. Este paso es necesario porque, como se mencion√≥ anteriormente, la codificaci√≥n se realiza de forma no lineal. La existencia de la multiplicaci√≥n previa reduce la precisi√≥n de la representaci√≥n del color y las conversiones entre espacios de color pueden ser imperfectas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la pr√°ctica, reducir la profundidad de bits rara vez es importante, especialmente en la composici√≥n. Cuanto m√°s bajo es el valor alfa, menos visible es el color y menos influencia tiene sobre la composici√≥n. En √∫ltima instancia, si se esfuerza por operaciones de color pedag√≥gicamente precisas, no utilizar√° su representaci√≥n de 8 bits; para este prop√≥sito, los formatos son mucho m√°s adecuados</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">punto flotante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lectura adicional </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El concepto del canal alfa fue creado por los cofundadores de Pixar Studio, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Elvy </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smith</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ed Catmell</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El art√≠culo de Smith </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Alpha and the History of Digital Compositing"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> describe la historia de la invenci√≥n y las fuentes del nombre "alpha", as√≠ como c√≥mo estos conceptos evolucionaron y reemplazaron gradualmente el concepto de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°scaras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en la producci√≥n cinematogr√°fica </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para entender el significado de alfa, le recomiendo que lea </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Interpretaci√≥n alfa" de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andrew Glassner </font><font style="vertical-align: inherit;">. Este art√≠culo proporciona una derivaci√≥n matem√°tica rigurosa pero muy accesible de alfa como medida de la interacci√≥n entre opacidad y cobertura. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se puede estudiar una discusi√≥n detallada del alfa premultiplicado en</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Las GPU prefieren la premultiplicaci√≥n" de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eric Haines. </font><font style="vertical-align: inherit;">El art√≠culo no solo proporciona una excelente visi√≥n general de los problemas causados ‚Äã‚Äãpor la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falta de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> multiplicaci√≥n preliminar, especialmente en la representaci√≥n 3D, sino que tambi√©n proporciona enlaces a muchos otros art√≠culos sobre este tema.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En conclusi√≥n </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, este art√≠culo pretend√≠a ser una explicaci√≥n de los operadores de composici√≥n de Porter-Duff, pero todos los dem√°s conceptos relacionados con la composici√≥n alfa resultaron ser tan interesantes que no pod√≠a faltarlos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que m√°s me gusta de alpha es que es solo un n√∫mero adicional que acompa√±a a los componentes RGB, pero al mismo tiempo crea muchas capacidades de renderizado √∫nicas. </font><font style="vertical-align: inherit;">Alpha literalmente cre√≥ un nuevo cambio de oportunidad en el aburrido y viejo mundo de la composici√≥n y el renderizado 2D. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pr√≥xima vez que vea los bordes suaves de las formas vectoriales o note una superposici√≥n oscura que oscurezca algunas partes de la interfaz de usuario, piense en un componente peque√±o pero poderoso que lo hizo posible.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468067/">https://habr.com/ru/post/468067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468057/index.html">Desarrollo de sistema operativo tipo Unix: multitarea y llamadas al sistema (7)</a></li>
<li><a href="../468059/index.html">Mi segunda semana con Haiku: muchos diamantes escondidos y sorpresas agradables, as√≠ como algunos problemas</a></li>
<li><a href="../468061/index.html">Cron en Linux: historia, uso y dispositivo</a></li>
<li><a href="../468063/index.html">Angulareact</a></li>
<li><a href="../468065/index.html">Modelos de gesti√≥n mental de productos para todos</a></li>
<li><a href="../468071/index.html">Eduard Medvedev, CTO de Tungsten Labs: "Hemos crecido hasta el punto en que la tecnolog√≠a puede causar da√±os masivos"</a></li>
<li><a href="../468073/index.html">Andrei Terekhov: "Puedes decir todo lo que quieras que el estadounidense es mejor, pero nuestro auto nunca se descompone"</a></li>
<li><a href="../468075/index.html">El uso de redes neuronales siamesas en la b√∫squeda</a></li>
<li><a href="../468077/index.html">Realice pruebas de manera adulta. An√°lisis espectral</a></li>
<li><a href="../468081/index.html">"Datos an√≥nimos" o lo que se planea en 152-FZ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>