<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โช๏ธ ๐คฑ๐ป โ๐ป ูููููุงู ูุงูุชูุฌูู ุนูู Mikrotik RouterOS ๐ ๐ ๐ค๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุน ุชุตุญูุญุงุช ูุฅุถุงูุงุช ูู 02/11/2020 
 ููุฏูุฉ 
 ุฅูู ุฌุงูุจ ุงูุบุฑูุฑ ุ ุฏูุนูู ุงูุชุฑุฏุฏ ุงููุญุจุท ููุฃุณุฆูุฉ ุญูู ูุฐุง ุงูููุถูุน ูู ุงููุฌููุนุงุช ุฐุงุช ุงูุตูุฉ ูู ูุฌุชูุน ุงูุจุฑููุงุช ุงููุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูููููุงู ูุงูุชูุฌูู ุนูู Mikrotik RouterOS</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463813/" style=";text-align:right;direction:rtl">  ูุน ุชุตุญูุญุงุช ูุฅุถุงูุงุช ูู 02/11/2020 <br><h4 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h4><br>  ุฅูู ุฌุงูุจ ุงูุบุฑูุฑ ุ ุฏูุนูู ุงูุชุฑุฏุฏ ุงููุญุจุท ููุฃุณุฆูุฉ ุญูู ูุฐุง ุงูููุถูุน ูู ุงููุฌููุนุงุช ุฐุงุช ุงูุตูุฉ ูู ูุฌุชูุน ุงูุจุฑููุงุช ุงููุงุทู ุจุงููุบุฉ ุงูุฑูุณูุฉ ุฅูู ุชูุงูู ุงูููุงูุฉ.  ุชูุฏู ูุฐู ุงูููุงูุฉ ุฅูู ูุณุคููู ุงููุจุชุฏุฆูู ูู Mikrotik RouterOS (ุงููุดุงุฑ ุฅูููุง ูููุง ููู ุจุงุณู ROS).  ุชุนุชุจุฑ ููุท multivan ุ ูุน ุงูุชุฑููุฒ ุนูู ุงูุชูุฌูู.  ุชุดุชูู ุงูููุงูุฃุฉ ุนูู ุฅุนุฏุงุฏุงุช ุงูุญุฏ ุงูุฃุฏูู ูุถูุงู ุงูุชุดุบูู ุงูุขูู ูุงููุฑูุญ.  ุฃููุฆู ุงูุฐูู ูุจุญุซูู ุนู ุงููุดู ุนู ุชูู ุงูุทูุงุจูุฑ ุ ูููุงุฒูุฉ ุงูุญูู ุ ูุงูุดุจูุงุช ุงููุญููุฉ ุ ูุงูุฌุณูุฑ ุ ูุงูุชุญููู ุงููุชุนูู ูุชุนุฏุฏ ุงููุฑุงุญู ูุญุงูุฉ ุงูููุงุฉ ููุง ุดุงุจู ุฐูู - ูุง ูููู ุฃู ุชุถูุน ุงูููุช ูุงูุฌูุฏ ุงููุฑุงุกุฉ. <br><a name="habracut"></a><br><h4 style=";text-align:right;direction:rtl">  ูุตุฏุฑ ุงูุจูุงูุงุช </h4><br>  ูููุถูุน ุงุฎุชุจุงุฑ ุ ุชู ุงุฎุชูุงุฑ ุฌูุงุฒ ุชูุฌูู Mikrotik ุจุฎูุณุฉ ููุงูุฐ ูุน ุฅุตุฏุงุฑ ROS 6.45+.  ุณูุชู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ ุจูู ุดุจูุชูู ูุญููุชูู (LAN1 ู LAN2) ูุซูุงุซุฉ ูููุฑู (ISP1 ู ISP2 ู ISP3).  ุชุญุชูู ุงูููุงุฉ ุฅูู ISP1 ุนูู ุนููุงู "ุฑูุงุฏู" ุซุงุจุช ุ ISP2 "ุฃุจูุถ" ุชู ุงุณุชูุงูู ุนุจุฑ DHCP ุ ISP3 "ุฃุจูุถ" ูุน ูุตุงุฏูุฉ PPPoE.  ูุธูุฑ ูุฎุทุท ุงูุงุชุตุงู ูู ุงูุดูู: <br><br><img src="https://habrastorage.org/webt/pd/di/mv/pddimv_vbwqmityow2oe2oxngam.jpeg"><br><br>  ุชุชูุซู ุงููููุฉ ูู ุชูููู ุฌูุงุฒ ุชูุฌูู MTK ุงุณุชูุงุฏูุง ุฅูู ุงููุฎุทุท ุจุญูุซ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูููุฑ ุงูุชุจุฏูู ุงูุชููุงุฆู ุฅูู ูุฒูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู.  ุงููุฒูุฏ ุงูุฑุฆูุณู ูู ISP2 ุ ูุงูุงุญุชูุงุทู ุงูุฃูู ูู ISP1 ุ ูุงูุงุญุชูุงุทู ุงูุซุงูู ูู ISP3. </li><li style=";text-align:right;direction:rtl">  ูุชูุธูู ูุตูู LAN1 ุฅูู ุงูุฅูุชุฑูุช ููุท ูู ุฎูุงู ISP1. </li><li style=";text-align:right;direction:rtl">  ุชูููุฑ ุงููุฏุฑุฉ ุนูู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุดุจูุงุช ุงููุญููุฉ ุฅูู ุงูุฅูุชุฑูุช ูู ุฎูุงู ุงููููุฑ ุงููุญุฏุฏ ุจูุงุกู ุนูู ูุงุฆูุฉ ุงูุนูุงููู. </li><li style=";text-align:right;direction:rtl">  ูุชูููุฑ ุฅููุงููุฉ ูุดุฑ ุฎุฏูุงุช ูู ุดุจูุฉ ูุญููุฉ ุฅูู ุงูุฅูุชุฑูุช (DSTNAT) </li><li style=";text-align:right;direction:rtl">  ูู ุจุชูููู ูุฑุดุญ ุฌุฏุงุฑ ุงูุญูุงูุฉ ูุชูููุฑ ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุฃูุงู ุงููุงูู ูู ุงูุฅูุชุฑูุช. </li><li style=";text-align:right;direction:rtl">  ูููู ูุฌูุงุฒ ุงูุชูุฌูู ุฅุตุฏุงุฑ ุญุฑูุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ูู ุฎูุงู ุฃู ูู ุงููููุฑูู ุงูุซูุงุซุฉ ุ ุญุณุจ ุนููุงู ุงููุตุฏุฑ ุงููุญุฏุฏ. </li><li style=";text-align:right;direction:rtl">  ุชูููุฑ ุชูุฌูู ุญุฒู ุงูุงุณุชุฌุงุจุฉ ููููุงุฉ ุงูุชู ุฃุชุช ูููุง (ุจูุง ูู ุฐูู LAN). </li></ol><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุณูููู ุจุชูููู ุฌูุงุฒ ุงูุชูุฌูู "ูู ููุทุฉ ุงูุตูุฑ" ูุถูุงู ุนุฏู ูุฌูุฏ ููุงุฌุขุช ูู ุจุฏุก ุชููููุงุช "ุฎุงุฑุฌ ุงููุฑุจุน" ุชุชุบูุฑ ูู ุฅุตุฏุงุฑ ุฅูู ุฅุตุฏุงุฑ.</i>  <i>ุชู ุงุฎุชูุงุฑ Winbox ูุฃุฏุงุฉ ููุชูููู ุ ุญูุซ ุณูุชู ุนุฑุถ ุงูุชุบููุฑุงุช ุจุตุฑููุง.</i>  <i>ุณูุชู ุชุนููู ุงูุฅุนุฏุงุฏุงุช ููุณูุง ุจูุงุณุทุฉ ุฃูุงูุฑ ูู ูุญุทุฉ Winbox.</i>  <i>ูุชู ุงูุงุชุตุงู ุงููุนูู ููุชูููู ูู ุฎูุงู ุงุชุตุงู ูุจุงุดุฑ ุจูุงุฌูุฉ Ether5.</i> <br><br><h4 style=";text-align:right;direction:rtl">  ุงููููู ูู ุงูููุงุด ุญูู ูุงููุฉ ุงูุดุงุญูุฉ ุงููุชุนุฏุฏุฉ ุ ุณูุงุก ูุงูุช ูุดููุฉ ุฃู ูุณุฌ ุฃุดุฎุงุต ุฃุฐููุงุก ุดุจูุงุช ูู ุงููุคุงูุฑุงุช ุญูู </h4><br>  ูุฏุฑู ุงููุดุฑู ุงููุถููู ูุงูููุธ ุ ุงูุฐู ูููู ุจุฅุนุฏุงุฏ ูุซู ูุฐุง ุงููุฎุทุท ุฃู ุฐุงู ุจููุฑุฏู ุ ูุฌุฃุฉ ุฃูู ูุนูู ุจุดูู ุทุจูุนู.  ูุนู ุ ูุนู ุ ุจุฏูู ูุฐู ุงูุฌุฏุงูู ุงููุฎุตุตุฉ ููุชูุฌูู ูููุงุนุฏ ุงูุชูุฌูู ุงูุฃุฎุฑู ุ ุงููููุฆุฉ ุจูุนุธู ุงูููุงูุงุช ุญูู ูุฐุง ุงูููุถูุน.  ุงูุชุญูู ูู ุฐููุ <br><br>  ูู ูููููุง ุชูููู ุนูููุฉ ุนูู ูุงุฌูุงุช ูุจูุงุจุงุช ุงูุชุฑุงุถูุฉุ  ูุนู: <br><br>  ุชู ุชุณุฌูู ุงูุนููุงู ูุงูุนุจูุงุฑุฉ ุฐุงุช <b>ุงููุณุงูุฉ = 2</b> ูุนุจูุงุฑุฉ <b>ุงูุงุฎุชูุงุฑ = ping</b> ุนูู ISP1 <b>.</b> <br>  ูู ISP2 ุ ูููู ุฅุนุฏุงุฏ dhcp ุงูุงูุชุฑุงุถู ููุนููู ุ ููููุง ูุฐูู ุ ุงููุณุงูุฉ ุชุณุงูู ูุงุญุฏูุง. <br>  ุนูู ISP3 ูู ุฅุนุฏุงุฏุงุช pppoe ููุนููู ูุน <b>add-default-route = yes</b> ุชุนููู <b>default-route-distance = 3</b> . <br><br>  ูุง ุชูุณู ุชุณุฌูู NAT ููุฅุฎุฑุงุฌ: <br><br>  <b>/ ip fire nat add action = ุณูุณูุฉ ุญููุฉ ุชููุฑูุฉ = srcnat out-interface-list = WAN</b> <br><br>  ูุชูุฌุฉ ูุฐูู ุ ูุชูุชุน ูุณุชุฎุฏูู ุดุจูุงุช LAN (LAN) ุจุฃุฎุชุงู ูุชู ุชุญููููุง ูู ุฎูุงู ูุฒูุฏ ISP2 ุงูุฑุฆูุณู ูููุฌุฏ ุญุฌุฒ ููููุงุฉ ุจุงุณุชุฎุฏุงู ุขููุฉ <b>ุจูุงุจุฉ ุงููุญุต</b> <sup>.</sup> <br><br>  ูุชู ุชูููุฐ ุงูููุทุฉ 1 ูู ุงููููุฉ.  ุฃูู ูู multivan ูุน ุนูุงูุงุชูุงุ  ูุง ... <br><br>  ูุนูุงูุฉ ุนูู ุฐูู.  ุชุญุชุงุฌ ุฅูู ุชุญุฑูุฑ ุนููุงุก ูุญุฏุฏูู ูู LAN ุนุจุฑ ISP1: <br><br>  <b>/ ip ุฌุฏุงุฑ ุงูุญูุงูุฉ mangle add action = ุณูุณูุฉ ุงููุณุงุฑ = prerouting dst-address-list =! BOGONS \</b> <b><br></b>  <b>ุงูุนุจูุฑ = yes route-dst = 100.66.66.1 src-address-list = Via_ISP1</b> <b><br></b>  <b>/ ip ุฌุฏุงุฑ ุงูุญูุงูุฉ mangle add action = ุณูุณูุฉ ุงููุณุงุฑ = prerouting dst-address-list =! BOGONS \</b> <b><br></b>  <b>ุงูุนุจูุฑ = ูุง ููุฌุฏ ูุณุงุฑ- dst = 100.66.66.1 src- ุงูุนููุงู = 192.168.88.0 / 24</b> <br><br>  ูุชู ุชูููุฐ ุงูุจูุฏูู 2 ู 3 ูู ุงููููุฉ.  ุงูุนูุงูุงุช ุ ุงูุทูุงุจุน ุ ููุงุนุฏ ุงูุทุฑูู ุ ุฃูู ุฃูุชุ! <br><br>  ูู ุชุญุชุงุฌ ุฅูู ููุญ ุญู ุงููุตูู ุฅูู ุฎุงุฏู OpenVPN ุงูููุถู ูุฏูู ุจุนููุงู 172.17.17.17 ููุนููุงุก ูู ุงูุฅูุชุฑูุชุ  ูู ูุถูู: <br><br>  <b>/ ip ูุฌููุนุฉ ุงูุณุญุงุจูุฉ ุชูููู ddns = ูุนู</b> <br><br>  ูุนุทู ูุชูุฌุฉ ุงูุฅุฎุฑุงุฌ ููุนููุงุก ูุนูุฏ: " <b>: put [ip cloud get dns-name]</b> " <br><br>  ูุณุฌู ูููุงุก ุงูุดุญู ูู ุงูุฅูุชุฑูุช: <br><br>  <b>/ ip ุฌุฏุงุฑ ุงูุญูุงูุฉ nat add action = dst-nat chain = dstnat dst-port = 1194 \</b> <b><br></b>  <b>ูู ูุงุฌูุฉ ูุงุฆูุฉ = ุจุฑูุชูููู WAN = udp ุฅูู ุนูุงููู = 172.17.17.17</b> <br><br>  ุงูููุทุฉ 4 ุฌุงูุฒุฉ. <br><br>  ููุฏ ุฃูุดุฃูุง ุฌุฏุงุฑูุง ูุงุฑููุง ูุฃูููุง ุขุฎุฑ ููููุทุฉ 5 ุ ููู ุงูููุช ููุณู ุ ูุณุนุฏูุง ุฃู ูู ุดูุก ูุนูู ูููุณุชุฎุฏููู ูุฃููู ูุชุฌููู ุฅูู ุญุงููุฉ ุชุญุชูู ุนูู ูุดุฑูุจ ููุถู ... <br>  A!  ุงูุฃููุงู ูุง ุชุฒุงู ุทู ุงููุณูุงู. <br><br>  ุงุฑุชูุน ุงูุนููู l2tp ุชูููู ูููุง ูููุงู googled ุฅูู VDS ุงูููููุฏูุฉ ุงูุญุจูุจุ  ูุนู. <br>  ุงุฑุชูุน L2TP ุฎุงุฏู ูุน IPsec ูุงูุนููุงุก ุญุณุจ ุงุณู DNS ูู IP ุงูุบููุฉ (ุงูุธุฑ ุฃุนูุงู) ุชุชุดุจุซุ  ูุนู. <br>  ุนูุฏูุง ูููู ุฅูู ุงููุฑุงุก ุ ููุฃุฎุฐ ุฑุดูุฉ ูู ุงููุดุฑูุจ ุ ูุฅููุง ููุญุต ุฎุงููุงู ุงูุจูุฏูู 6 ู 7 ูู ุงููุดููุฉ.  ูุนุชูุฏ - ูู ูุญู ูู ุญุงุฌุฉ ุฅูููุงุ  ูู ุดูุก ูุนูู ุนูู ูุฐุง ุงููููุงู ... ูุฐุง ุฅุฐุง ูู ููู ุงูุฃูุฑ ุถุฑูุฑููุง ุ ููุฐุง ูู ุดูุก.  ูููุชุงู ุชูููุฐูุง. <br><br>  <b>ูุง ูู ูุชุนุฏุฏุ</b>  <b>ูุฐุง ูู ุงุชุตุงู ุงูุนุฏูุฏ ูู ูููุงุช ุงูุฅูุชุฑูุช ุจููุฌู ูุงุญุฏ.</b> <br><br>  ูุง ููููู ูุฑุงุกุฉ ุงูููุงู ุจุดูู ุฃูุจุฑ ุ ูุฃู ูุง ุงูุฐู ูููู ุฃู ูููู ููุฌูุฏูุง ุฅูู ุฌุงูุจ ุงุณุชุนุฑุงุถ ูุงุจููุฉ ุงูุชุทุจูู ุงููุดููู ูููุงุ <br><br>  ูุน ุฃููุฆู ุงูุฐูู ูุจููู ุ ูุงูุฐูู ููุชููู ุจุงูููุทุชูู 6 ู 7 ูู ุงููููุฉ ุ ููุดุนุฑูู ุฃูุถูุง ุจุญูุฉ ุงูููุงู ุ ูุฅููุง ูุบุทุณ ุจุดูู ุฃุนูู. <br><br>  ุงููููุฉ ุงูุฃูุซุฑ ุฃูููุฉ ูุชุทุจูู multivans ูู ุงูุชูุฌูู ุงูุตุญูุญ ูุญุฑูุฉ ุงููุฑูุฑ.  ููู: ุจุบุถ ุงููุธุฑ ุนู (ุฃู ูู) <sup>ุงูุธุฑ ุงูููุงุญุธุฉ 3 ุ</sup> ุชูุธุฑ ููุงุฉ (ูููุงุช) ุงููููุฑ ุฅูู ุงููุณุงุฑ ุงูุงูุชุฑุงุถู ุนูู ุฌูุงุฒ ุงูุชูุฌูู ุงูุฎุงุต ุจูุง ุ ููุฌุจ ุฃู ุชุนูุฏ ุงูุฅุฌุงุจุฉ ุจุงูุถุจุท ุฅูู ุงูููุงุฉ ุงูุชู ุฌุงุกุช ูููุง ุงูุญุฒูุฉ.  ุงููููุฉ ูุงุถุญุฉ.  ุฃูู ุงููุดููุฉุ  ูู ุงููุงูุน ุ ูู ููุณ ุงูุดุจูุฉ ุงููุญููุฉ ุงููููุฉ ูู ููุณูุง ุ ูููู ูุง ุฃุญุฏ ูุฒุนุฌ ูุน ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ ููุง ูุดุนุฑ ุงููุชุงุนุจ.  ุงููุฑู ูู ุฃู ุฃู ุนูุฏุฉ ููุฌูุฉ ุนูู ุงูุฅูุชุฑูุช ูููู ุงููุตูู ุฅูููุง ูู ุฎูุงู ูู ูู ูููุงุชูุง ุ ูููุณ ูู ุฎูุงู ูุงุญุฏุฉ ูุญุฏุฏุฉ ุจุฏูุฉ ุ ููุง ูู ุงูุญุงู ูู ุดุจูุฉ ูุญููุฉ ุจุณูุทุฉ.  ููู "ุงููุดููุฉ" ูู ุฃูู ุฅุฐุง ุชููููุง ุทูุจูุง ููุญุตูู ุนูู ุนููุงู IP ุงูุฎุงุต ุจู ISP3 ุ ูุญููุฆุฐู ุ ุณุชูุชูู ุงูุฅุฌุงุจุฉ ุนุจุฑ ููุงุฉ ISP2 ุ ูุธุฑูุง ูุฃู ุงูุจูุงุจุฉ ุงูุงูุชุฑุงุถูุฉ ููุฌูุฉ ุฅูู ููุงู.  ุณูุบุงุฏุฑ ุงููููุฑ ููุชุฌุงููู ุจุงุนุชุจุงุฑู ุบูุฑ ุตุญูุญ.  ูุฑุฑูุง ุงููุดููุฉ.  ููููุฉ ุญููุงุ <br><br>  ูููุณู ุงูุญู ุฅูู ุซูุงุซ ูุฑุงุญู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ุงูุถุจุท ุงููุณุจู.</b>  ูู ูุฐู ุงููุฑุญูุฉ ุ ุณูุชู ุชุนููู ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ ูุฌูุงุฒ ุงูุชูุฌูู: ุงูุดุจูุฉ ุงููุญููุฉ ุ ูุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ูููุงุฆู ุงูุนูุงููู ุ NAT ุฏุจูุณ ุงูุดุนุฑ ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  <b>ูุงูุชููุงู.</b>  ูู ูุฐู ุงููุฑุญูุฉ ุ ุณูุชู ูุถุน ุนูุงูุฉ ุนูู ุงูุงุชุตุงูุงุช ุงููุงุฒูุฉ ููุฑุฒูุง ููููุง ูุฌุฏุงูู ุงูุชูุฌูู. </li><li style=";text-align:right;direction:rtl">  <b>ุงุชุตุงู ุจูุฒูุฏ ุฎุฏูุฉ ุงูุฅูุชุฑูุช.</b>  ูู ูุฐู ุงููุฑุญูุฉ ุ ุณูุชู ุชูููู ุงููุงุฌูุงุช ุงูุชู ุชููุฑ ุงุชุตุงู ุจุงูุฅูุชุฑูุช ุ ูุณูุชู ุชูุฌูู ุงูุชูุฌูู ูุขููุฉ ุญุฌุฒ ูููุงุช ุงูุฅูุชุฑูุช. </li></ol><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุชู ุงุฎุชูุงุฑ ุซูุงุซุฉ ุฃููุงุน ูุฎุชููุฉ ูู ุงูุงุชุตุงู ุจู ISP ุนูู ูุฌู ุงูุชุญุฏูุฏ ูุฅุธูุงุฑ ุฃูู ูุง ููุฌุฏ ุดูุก ุบูุฑ ูุงุจู ููุญู ูู ุฅุนุฏุงุฏ multivans ุจุนูุงููู ุฏููุงููููุฉ ูุฅุธูุงุฑ ุฃุญุฏ ุฎูุงุฑุงุช ุงูุญููู.</i> <br>  <u><b>! ุงูููู</b></u>  ูุชุจุฏูู ุงููููุงุช ููููุง ููุฎูุงุฑุฒููุฉ ุงููุญุฏุฏุฉ ุจุงุณุชุฎุฏุงู ุชูููุฉ ุทุฑู <b>ุงููุณุงูุฉ</b> ุ ูุชู ุงุณุชุฎุฏุงู ุขููุฉ <b>ุจูุงุจุฉ ุงูุชุญูู.</b>  <sup>ุงูุธุฑ ุงูููุงุญุธุฉ 1</sup> <br>  ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงููุงุฑุฏุฉ ูู ุงูููุงูุฉ ูุง ุนูุงูุฉ ููุง ุจุญุฌุฒ ุงูููุงุฉ. <br><br><h4 style=";text-align:right;direction:rtl">  1. ูุณุจูุง </h4><br>  1.1.  ูููู ุจูุณุญ ุชูููู ุฌูุงุฒ ุงูุชูุฌูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ: <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">/system reset-configuration skip-backup=yes no-defaults=yes</code> </pre> <br>  ุฃุชูู ูุน " <b>ุฎุทูุฑุฉ!</b>  <b>ุฅุนุงุฏุฉ ุชุนููู ุนูู ุฃู ุญุงูุ</b>  <b>[y / N]:</b> "ูุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู ุ ูุชุตู ุจู Winbox ุนุจุฑ MAC.  ูู ูุฐู ุงููุฑุญูุฉ ุ ูุชู ูุณุญ ุงูุชูููู ููุงุนุฏุฉ ุงููุณุชุฎุฏู. <br><br>  1.2.  ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/user add group=full name=knight password=ultrasecret comment="Not horse"</code> </pre> <br>  ุชุณุฌูู ุงูุฏุฎูู ุชุญุชูุง ูุญุฐู ุงูุงูุชุฑุงุถู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/user remove admin</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูู ุฅุฒุงูุฉ ูููุณ ุงููุทุงุน ุงููุณุชุฎุฏู ุงูุงูุชุฑุงุถู ุงูุฐู ูุนุชุจุฑู ุงููุคูู ุฃูุซุฑ ุฃููุง ูููุตู ููุงุณุชุฎุฏุงู.</i> <br><br>  1.3.  ูููู ุจุฅูุดุงุก ููุงุฆู ูุงุฌูุฉ ุฃุณุงุณูุฉ ูุชูููุฑ ุงูุฑุงุญุฉ ููุนูู ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ูุฅุนุฏุงุฏุงุช ุงูุงูุชุดุงู ูุฎูุงุฏู MAC ุงูุฃุฎุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/interface list add name=WAN comment="For Internet" /interface list add name=LAN comment="For Local Area"</code> </pre> <br>  ูุญู ูููุน ูุงุฌูุงุช ูุน ุงูุชุนูููุงุช <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/interface ethernet set ether1 comment="to ISP1" /interface ethernet set ether2 comment="to ISP2" /interface ethernet set ether3 comment="to ISP3" /interface ethernet set ether4 comment="to LAN1" /interface ethernet set ether5 comment="to LAN2"</code> </pre> <br>  ูููุก ููุงุฆู ูุงุฌูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/interface list member add interface=ether1 list=WAN comment=ISP1 /interface list member add interface=ether2 list=WAN comment=ISP2 /interface list member add interface=ether3 list=WAN comment="to ISP3" /interface list member add interface=ether4 list=LAN comment="LAN1" /interface list member add interface=ether5 list=LAN comment="LAN2"</code> </pre><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุฅู ูุชุงุจุฉ ุชุนูููุงุช ูุงุถุญุฉ ุชุณุชุญู ุงูููุช ุงูุฐู ุชูุถูู ูู ูุฐุง ุจุงูุฅุถุงูุฉ ุฅูู ุชุณููู ุนูููุฉ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง ูููููุง.</i> <i><br><br></i>  <i>ูุฑู ุงููุคูู ุฃูู ูู ุงูุถุฑูุฑู ุ ูุฃุณุจุงุจ ุฃูููุฉ ุ ุฅุถุงูุฉ ูุงุฌูุฉ ether3 ุฅูู ูุงุฆูุฉ ุงููุงุฌูุฉ "WAN" ุ ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุจุฑูุชูููู ip ูู ููุฑ ุนุจุฑู.</i> <i><br><br></i>  <i>ูุง ุชูุณู ุฃูู ุจุนุฏ ุฑูุน ูุงุฌูุฉ PPP ุนูู ether3 ุ ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅุถุงูุชูุง ุฅูู ูุงุฆูุฉ ูุงุฌูุฉ "WAN"</i> <br><br>  1.4.  ูุฎูู ุฌูุงุฒ ุงูุชูุฌูู ุนู ุงูุชุดุงู ุงููุฑุจ ูุงูุชุญูู ููู ูู ุดุจูุงุช ููุฏูู ุงูุฎุฏูุงุช ุจูุงุณุทุฉ MAC: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip neighbor discovery-settings set discover-interface-list=!WAN /tool mac-server set allowed-interface-list=LAN /tool mac-server mac-winbox set allowed-interface-list=LAN</code> </pre> <br>  1.5.  ูููู ุจุฅูุดุงุก ูุฌููุนุฉ ูุงููุฉ ูู ููุงุนุฏ ูุฑุดุญ ุฌุฏุงุฑ ุงูุญูุงูุฉ ูุญูุงูุฉ ุฌูุงุฒ ุงูุชูุฌูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="Related Established Untracked Allow" \ connection-state=established,related,untracked</code> </pre> <br>  (ุชููุฑ ุงููุงุนุฏุฉ ุฅุฐููุง ููุงุชุตุงูุงุช ุงูุชู ุชู ุชุฃุณูุณูุง ูุฐุงุช ุงูุตูุฉ ูุงูุชู ุชุจุฏุฃ ูู ูู ูู ุงูุดุจูุงุช ุงููุชุตูุฉ ูุงูููุฌู ููุณู) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="ICMP from ALL" protocol=icmp</code> </pre> <br>  (ping ูููุณ ููุท ping. ููุณูุญ ููู icmp ุจุงูุฏุฎูู. ุฅูู ูููุฏ ุฌุฏูุง ููุนุซูุฑ ุนูู ูุดุงูู ูุน MTU) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=drop chain=input comment="All other WAN Drop" \ in-interface-list=WAN</code> </pre> <br>  (ุงููุงุนุฏุฉ ุงูุชู ุชุบูู ุณูุณูุฉ ุงูุฅุฏุฎุงู ุชุญุธุฑ ุฃู ุดูุก ุขุฎุฑ ูุตู ูู ุงูุฅูุชุฑูุช) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=accept chain=forward \ comment="Established, Related, Untracked allow" \ connection-state=established,related,untracked</code> </pre> <br>  (ุชุณูุญ ุงููุงุนุฏุฉ ุจุงูุงุชุตุงูุงุช ุงููุงุฆูุฉ ูุงููุชุตูุฉ ุงูุชู ุชูุฑ ุนุจุฑ ุฌูุงุฒ ุงูุชูุฌูู) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward comment="Invalid drop" \ connection-state=invalid</code> </pre> <br>  (ุชุณูุท ุงููุงุนุฏุฉ ุงูุงุชุตุงูุงุช ุ ูุน ุญุงูุฉ ุงูุงุชุตุงู = ุบูุฑ ุตุงูุญุฉ ุ ุชูุฑ ุนุจุฑ ุฌูุงุฒ ุงูุชูุฌูู. ููุตู ุจูุง ุจุดุฏุฉ ุจูุงุณุทุฉ Mikrotik ุ ูููู ูู ุจุนุถ ุงูุญุงูุงุช ุงููุงุฏุฑุฉ ูููู ุฃู ุชููุน ุญุฑูุฉ ุงููุฑูุฑ ุงููููุฏุฉ) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward \ comment="Drop all from WAN not DSTNATed" connection-nat-state=!dstnat \ connection-state=new in-interface-list=WAN</code> </pre> <br>  (ุชุญุธุฑ ุงููุงุนุฏุฉ ุงูุญุฒู ุงูุชู ุชูุทูู ูู ุงูุฅูุชุฑูุช ููู ุชูุฑ ุจุฅุฌุฑุงุก dstnat ุนุจุฑ ุฌูุงุฒ ุงูุชูุฌูู. ูุฐุง ุณูุญูู ุงูุดุจูุงุช ุงููุญููุฉ ูู ุงููุชุทูููู ุงูุฐูู ุ ูู ููุณ ูุฌุงู ุงูุจุซ ูุน ุดุจูุงุชูุง ุงูุฎุงุฑุฌูุฉ ุ ุณูููููู ุจุชุณุฌูู ุนูุงููู IP ุงูุฎุงุฑุฌูุฉ ุงูุฎุงุตุฉ ุจูุง ูุจูุงุจุฉ ุ ูุจุงูุชุงูู ุญุงูู "ุงุณุชูุดู" ุดุจูุงุชูุง ุงููุญููุฉ.) <br><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุฏุนูุง ููุชุฑุถ ุฃู LAN1 ู LAN2 ููุง ุดุจูุชุงู ููุซููุชุงู ููุง ูุชู ุชุตููุฉ ุญุฑูุฉ ุงููุฑูุฑ ุจููููุง.</i> <br><br>  1.6.  ุฅูุดุงุก ูุงุฆูุฉ ูุน ูุงุฆูุฉ ุงูุดุจูุงุช ุบูุฑ ุงููุงุจูุฉ ููุชูุฌูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall address-list add address=0.0.0.0/8 comment="\"This\" Network" list=BOGONS add address=10.0.0.0/8 comment="Private-Use Networks" list=BOGONS add address=100.64.0.0/10 comment="Shared Address Space. RFC 6598" list=BOGONS add address=127.0.0.0/8 comment=Loopback list=BOGONS add address=169.254.0.0/16 comment="Link Local" list=BOGONS add address=172.16.0.0/12 comment="Private-Use Networks" list=BOGONS add address=192.0.0.0/24 comment="IETF Protocol Assignments" list=BOGONS add address=192.0.2.0/24 comment=TEST-NET-1 list=BOGONS add address=192.168.0.0/16 comment="Private-Use Networks" list=BOGONS add address=198.18.0.0/15 comment="Network Interconnect Device Benchmark Testing"\ list=BOGONS add address=198.51.100.0/24 comment=TEST-NET-2 list=BOGONS add address=203.0.113.0/24 comment=TEST-NET-3 list=BOGONS add address=224.0.0.0/4 comment=Multicast list=BOGONS add address=192.88.99.0/24 comment="6to4 Relay Anycast" list=BOGONS add address=240.0.0.0/4 comment="Reserved for Future Use" list=BOGONS add address=255.255.255.255 comment="Limited Broadcast" list=BOGONS</code> </pre> <br>  (ูุฐู ูุงุฆูุฉ ุจุงูุนูุงููู ูุงูุดุจูุงุช ุงูุชู ูู ูุชู ุชูุฌูููุง ุฅูู ุงูุฅูุชุฑูุช ุ ูุจุงูุชุงูู ุ ุณูุชุงุจุน ูุฐุง ุฃูุถูุง). <br><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุฏ ุชุชุบูุฑ ุงููุงุฆูุฉ ุ ูุฐูู ุฃูุตุญู ุจุงูุชุญูู ูู ูุฏู ููุงุกูุชูุง ุจุดูู ุฏูุฑู.</i> <br><br>  1.7.  ุชูููู DNS ูุฌูุงุฒ ุงูุชูุฌูู ููุณู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip dns set servers=1.1.1.1,8.8.8.8</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ูู ROS ุ ุชุฃุฎุฐ ุงูุฎูุงุฏู ุงูุญูููุฉ ุงูุฃููููุฉ ุนูู ุงูุฎูุงุฏู ุงููุญุฏุฏุฉ ุจุดูู ุซุงุจุช.</i>  <i>ูุชู ุฅุฑุณุงู ุทูุจ ุชุญููู ุงูุงุณู ุฅูู ุงูุฎุงุฏู ุงูุฃูู ุจุงูุชุฑุชูุจ ูู ุงููุงุฆูุฉ.</i>  <i>ูุญุฏุซ ุงูุงูุชูุงู ุฅูู ุงูุฎุงุฏู ุงูุชุงูู ุนูุฏูุง ูููู ุงูุฎุงุฏู ุงูุญุงูู ุบูุฑ ูุชููุฑ.</i>  <i>ูููุฉ ูุจูุฑุฉ - ุฃูุซุฑ ูู 5 ุซูุงู.</i>  <i>ูุง ูุชู ุฅุฌุฑุงุก ุงูุนูุฏุฉ ุชููุงุฆููุง ุนูุฏ ุงุณุชุฆูุงู "ุงูุฎุงุฏู ุงูุณุงูุท".</i>  <i>ูุธุฑูุง ููุฐู ุงูุฎูุงุฑุฒููุฉ ููุฌูุฏ ููููุงู ุ ููุตู ุงููุคูู ุจุนุฏู ุงุณุชุฎุฏุงู ุงูุฎูุงุฏู ุงูุชู ุฃุตุฏุฑูุง ููุฏูู ุงูุฎุฏูุฉ.</i> <br><br>  1.8.  ุชูููู ุงูุดุจูุฉ ุงููุญููุฉ. <br>  1.8.1.  ุชูููู ุนูุงููู IP ุงูุซุงุจุชุฉ ุนูู ูุงุฌูุงุช LAN: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip address add interface=ether4 address=192.168.88.254/24 comment="LAN1 IP" /ip address add interface=ether5 address=172.16.1.0/23 comment="LAN2 IP"</code> </pre> <br>  1.8.2.  ูุถุนูุง ููุงุนุฏ ูููุณุงุฑุงุช ุฅูู ุดุจูุงุชูุง ุงููุญููุฉ ูู ุฎูุงู ุฌุฏูู ุงูุชูุฌูู ุงูุฑุฆูุณู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route rule add dst-address=192.168.88.0/24 table=main comment="to LAN1" /ip route rule add dst-address=172.16.0.0/23 table=main comment="to LAN2"</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุฐู ูู ูุงุญุฏุฉ ูู ุฃุณูู ูุฃุณุฑุน ุงูุทุฑู ูููุตูู ุฅูู ุนูุงููู ุงูุดุจูุฉ ุงููุญููุฉ ูุน ุนูุงููู IP ุงูุฎุงุฑุฌูุฉ ููุงุฌูุงุช ุฌูุงุฒ ุงูุชูุฌูู ูุงูุชู ูู ุฎูุงููุง ูุง ูุฐูุจ ุงููุณุงุฑ ุงูุงูุชุฑุงุถู.</i> <br><br>  1.8.3.  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ููู ุจุชูููู Hairpin NAT ูู LAN1 ู LAN2: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN1" \ out-interface=ether4 src-address=192.168.88.0/24 to-addresses=192.168.88.254 /ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN2" \ out-interface=ether5 src-address=172.16.0.0/23 to-addresses=172.16.1.0</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุณูุญ ุฐูู ูููุณุชุฎุฏููู ูู LAN1 ู LAN2 ุจุงููุตูู ูู ุฎูุงู IP ุฎุงุฑุฌู (dstnat) ุฅูู ุงูุฎูุงุฏู ุงูููุฌูุฏุฉ ูุน ุงููุณุชุฎุฏููู ูู ููุณ ูุทุงุน ุงูุดุจูุฉ.</i> <br><br><h4 style=";text-align:right;direction:rtl">  2. ูู ุงููุงูุน ุ ูุชูููุฐ multivans ุงูุตุญูุญ </h4><br>  ูุญู ูุดููุฉ "ุงูุฅุฌุงุจุฉ ุนู ุงูููุงู ุงูุฐู ุทูุจูู" ุ ุณูู ูุณุชุฎุฏู ุฃุฏุงุชูู ROS: <b>ุนูุงูุฉ ุงูุงุชุตุงู ูุนูุงูุฉ</b> <b>ุงูุชูุฌูู</b> .  ุชุชูุญ ูู ุนูุงูุฉ ุงูุงุชุตุงู ูุถุน ุนูุงูุฉ ุนูู ุงูุงุชุตุงู ุงููุทููุจ ูููุงุตูุฉ ุงูุนูู ูุน ูุฐุง ุงูุชุตููู ูุดุฑุท ูุชุทุจูู <b>ุนูุงูุฉ ุงูุชูุฌูู</b> .  ูุจุงููุนู ูุน <b>ุนูุงูุฉ ุงูุชูุฌูู ุ</b> ูู ุงููููู ุงูุนูู ูู <b>ููุงุนุฏ ูุณุงุฑ</b> <b>IP ูุทุฑููู</b> .  ุงูุชุดููุง ุงูุฃุฏูุงุช ุ ูุงูุขู ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงูุงุชุตุงูุงุช ุงูุชู ูุฌุจ ุชุญุฏูุฏูุง - ูุงุญุฏุฉ ุ ุญูุซ ูุชู ุชุญุฏูุฏูุง ุจุงูุถุจุท - ุงุซููู. <br><br>  ูุน ุงูุฃูู ุ ูู ุดูุก ุจุณูุท - ูุฌุจ ุฃู ูุญุชูู ุนูู ุฌููุน ุงูุงุชุตุงูุงุช ุงูุชู ุชุฃุชู ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ูู ุงูุฅูุชุฑูุช ูู ุฎูุงู ุงูููุงุฉ ุงูููุงุณุจุฉ.  ูู ุญุงูุชูุง ุ ุณุชููู ูุฐู ุซูุงุซ ุนูุงูุงุช (ููููุง ูุนุฏุฏ ุงููููุงุช): "conn_isp1" ู "conn_isp2" ู "conn_isp3". <br><br>  ุงููุฑู ูู ุงูุซุงููุฉ ูู ุฃู ุงูุงุชุตุงูุงุช ุงููุงุฑุฏุฉ ุณุชููู ูู ููุนูู: ุงูุนุจูุฑ ูุชูู ุงูููุฌูุฉ ููููุฌู ููุณู.  ุชุนูู ุขููุฉ ุนูุงูุฉ ุงูุงุชุตุงู ูู ุฌุฏูู <b>mangle</b> .  ุงููุธุฑ ูู ุญุฑูุฉ ุงูุญุฒูุฉ ุนูู ูุฎุทุท ูุจุณุท ุ ูุฑุฌู ุฌูุนูุง ูู ูุจู ุงููุชุฎุตุตูู ูู ุงูููุฑุฏ mikrotik-trainings.com (ูููุณ ุงูุฅุนูุงู): <br><br><img src="https://habrastorage.org/webt/gg/yc/u4/ggycu4_z4ps93z-crahvri9pshw.jpeg"><br><br>  ุจุนุฏ ุงูุฃุณูู ุ ูุฑู ุฃู ุงูุญุฒูุฉ ุงูุชู ุชุตู ุฅูู " <b>ูุงุฌูุฉ ุงูุฅุฏุฎุงู</b> " ุชูุฑ ุนุจุฑ ุณูุณูุฉ " <b>Prerouting</b> " ูุนูุฏูุง ููุท ูุชู ุชูุณูููุง ุฅูู ุนุจูุฑ ููุญููุฉ ูู ูุชูุฉ " <b>ูุฑุงุฑ ุงูุชูุฌูู</b> ".  ูุฐูู ุ ููุชู ุนุตููุฑูู ุจุญุฌุฑ ูุงุญุฏ ุ ุงุณุชุฎุฏู <b>ุนูุงูุฉ ุงูุชูุตูู</b> ูู ุฌุฏูู <b>Mangle Prerouting</b> ูุณูุณูุฉ <b>Prerouting</b> . <br><br>  <i><b>ููุงุญุธุฉ</b> .</i>  <i>ูู ROS ุ ูุดุงุฑ ุฅูู ุชุณููุงุช "ุนูุงูุฉ ุงูุชูุฌูู" ูู ูุณู Ip / Routes / Rules ุนูู ุฃูู "ุฌุฏูู" ุ ููู ุงูุฃูุณุงู ุงููุชุจููุฉ ุจุงุณู "ุนูุงูุฉ ุงูุชูุฌูู".</i>  <i>ูุฏ ูุชุณุจุจ ูุฐุง ูู ุญุฏูุซ ุจุนุถ ุงูุงูุชุจุงุณ ูู ุงูููู ุ ููููู ูู ุงููุงูุน ูุงุญุฏ ูููุณ ุงูุดูุก ุ ููู ุชูุงุธุฑูุฉ rt_tables ูู iproute2 ุนูู ูุธุงู ุงูุชุดุบูู linux.</i> <br><br>  2.1.  ูุญุชูู ุจุงูุงุชุตุงูุงุช ุงููุงุฑุฏุฉ ูู ูู ูู ููุฏูู ุงูุฎุฏูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP1" connection-mark=no-mark in-interface=ether1 \ new-connection-mark=conn_isp1 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP2" connection-mark=no-mark in-interface=ether2 \ new-connection-mark=conn_isp2 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP3" connection-mark=no-mark in-interface=pppoe-isp3 \ new-connection-mark=conn_isp3 passthrough=no</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i> <i><br></i>  <i>ููุฑุฑ ูุคูุงุก ุงููุฑุงุก ุงูุฐูู ูุญุงูููู ุญุฑูููุง ููู ุชุฑุชูุจ ุงููุฑุงุกุฉ ุงูุฅุนุฏุงุฏ ุงูููุชุฑุญ ูู ุงูููุงูุฉ ุ ุนูุฏ ุฅุฏุฎุงู ุงูุฃูุฑ ุงูุซุงูุซ ุ ุณููุงุฌููู ุงูุฎุทุฃ: "ุงูุฅุฏุฎุงู ูุง ูุชุทุงุจู ูุน ุฃู ูููุฉ ูููุงุฌูุฉ".</i>  <i>ูุฐุง ุจุณุจุจ ุนุฏู ูุฌูุฏ ูุงุฌูุฉ "pppoe-isp3" ุ ูุงูุชู ุณูุชู ุชููุฆุชูุง ูู ุงููุณู 3.3.2.</i>  <i>ูู ูุฐู ุงููุฑุญูุฉ ุ ููููู ุฅุฏุฎุงู "ether3" ุจุฏูุงู ูู "pppoe-isp3".</i>  <i>ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูููุฑุฉ 3.3.2 ุ ูุฌุจ ุนููู ุงูุนูุฏุฉ ููุถุน ุงูุงุณู ุงูุญุงูู ูููุงุฌูุฉ.</i> <i><br><br></i>  <i>ููู ูุง ุฃุถุน ุนูุงูุฉ ุนูู ุงูุงุชุตุงูุงุช ุงูุชู ุชู ูุถุน ุนูุงูุฉ ุนูููุง ุจุงููุนู ุ ุงุณุชุฎุฏู ุนูุงูุฉ ุญุงูุฉ ุงูุงุชุตุงู = ูุง ุนูุงูุฉ ุจุฏูุงู ูู ุญุงูุฉ ุงูุงุชุตุงู = ุฌุฏูุฏุฉ.</i> <i><br><br></i>  <i>passthrough = ูุง - ูุฃูู ูู ุทุฑููุฉ ุงูุชูููุฐ ูุฐู ุ ูุชู ุงุณุชุจุนุงุฏ ุฅุนุงุฏุฉ ูุถุน ุงูุนูุงูุงุช ุ ูููุชุณุฑูุน ููููู ููุงุทุนุฉ ุชุนุฏุงุฏ ุงูููุงุนุฏ ุจุนุฏ ุงููุทุงุจูุฉ ุงูุฃููู.</i> <br><br>  ูุฌุจ ุฃู ูุคุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุฃููุง ูุง ุฒููุง ูุง ูุชุฏุฎู ูู ุงูุชูุฌูู.  ุงูุขู ููุงู ููุท ูุฑุงุญู ุงูุชุญุถูุฑ.  ุณุชููู ุงููุฑุญูุฉ ุงูุชุงููุฉ ูู ุงูุชูููุฐ ูู ูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ุงูุนุงุจุฑ ุ ูุงูุชู ูุชู ุฅุฑุฌุงุนูุง ุนุจุฑ ุงุชุตุงู ุซุงุจุช ูู ุงููุฑุณู ุฅููู ูู ุงูุดุจูุฉ ุงููุญููุฉ.  ุฃู  ุชูู ุงูุญุฒู ุงูุชู (ุงูุธุฑ ุงูุดูู) ุฐูุจุช ุนุจุฑ ุฌูุงุฒ ุงูุชูุฌูู ุนูู ุทูู ุงูุทุฑูู: <br><br>  <b>"Input Interface" =&gt; "Prerouting" =&gt; "ูุฑุงุฑ ุงูุชูุฌูู" =&gt; "ุฅุนุงุฏุฉ ุชูุฌูู" =&gt; "ูุดุฑ ุงูุชูุฌูู" =&gt; "ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ"</b> ููุตูุช ุฅูู ูุฌูุชูุง ุนูู ุงูุดุจูุฉ ุงููุญููุฉ. <br><br>  <u><b>! ุงูููู</b></u>  ูู ROS ูุง ููุฌุฏ ุชูุณูู ููุทูู ุฅูู ูุงุฌูุงุช ุฎุงุฑุฌูุฉ ูุฏุงุฎููุฉ.  ุฅุฐุง ุชุชุจุนูุง ูุณุงุฑ ุญุฒูุฉ ุงูุงุณุชุฌุงุจุฉ ูู ุงูุฑุณู ุงูุจูุงูู ุฃุฏูุงู ุ ูุณูู ูุชุจุน ููุณ ุงููุณุงุฑ ุงูููุทูู ูุซู ุงูุทูุจ: <br><br>  <b>"Input Interface" =&gt; "Prerouting" =&gt; "ูุฑุงุฑ ุงูุชูุฌูู" =&gt; "ุฅุนุงุฏุฉ ุชูุฌูู" =&gt; "ูุดุฑ ุงูุชูุฌูู" =&gt; "ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ"</b> ููุท ูุทูุจ " <b>ูุงุฌูุฉ ุงูุฅุฏุฎุงู</b> " ูุงู ููุงู ูุงุฌูุฉ ISP ุ ูููุฅุฌุงุจุฉ ูุงูุช LAN <br><br>  2.2.  ููุฌู ุญุฑูุฉ ุงููุฑูุฑ ุงูุนุงุจุฑ ุฅูู ุฌุฏุงูู ุงูุชูุฌูู ุงูููุงุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp3 passthrough=no</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i><b>in-interface-list =! WAN - ูุนูู ููุท ูุน ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุดุจูุฉ ุงููุญููุฉ ู dst-address-type =! local ุจุฏูู ุนููุงู ุงููุฌูุฉ ูุนูุงููู ูุงุฌูุฉ ุฌูุงุฒ ุงูุชูุฌูู ููุณู.</b></i> <i><b><br></b></i> <br><br>  ููุณ ุงูุดูุก ุจุงููุณุจุฉ ููุญุฒู ุงููุญููุฉ ุงูุชู ุฌุงุกุช ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ุนูู ุทูู ุงูุทุฑูู: <br><br>  <b>"ูุงุฌูุฉ ุงูุฅุฏุฎุงู" =&gt; "ุงูุชูุฌูู ุงููุณุจู" =&gt; "ูุฑุงุฑ ุงูุชูุฌูู" =&gt; "ุงูุฅุฏุฎุงู" =&gt; "ุงูุนูููุฉ ุงููุญููุฉ"</b> <br><br>  <u><b>! ุงูููู</b></u>  ุณุชุฐูุจ ุงูุฅุฌุงุจุฉ ุนูู ุงููุณุงุฑ ุงูุชุงูู: <br><br>  <b>"ุงูุนูููุฉ ุงููุญููุฉ" =&gt; "ูุฑุงุฑ ุงูุชูุฌูู" =&gt; "ุงูุฅุฎุฑุงุฌ" =&gt; "ูุดุฑ ุงูุชูุฌูู" =&gt; "ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ"</b> <b><br></b> <br>  2.3.  ููุฌู ุงุณุชุฌุงุจุฉ ุญุฑูุฉ ุงููุฑูุฑ ุงููุญููุฉ ุฅูู ุฌุฏุงูู ุงูุชูุฌูู ุงูููุงุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local new-routing-mark=to_isp3 passthrough=no</code> </pre> <br>  ูู ูุฐู ุงููุฑุญูุฉ ุ ูููู ุงุนุชุจุงุฑ ูููุฉ ุงูุชุญุถูุฑ ูุฅุฑุณุงู ุงุณุชุฌุงุจุฉ ุฅูู ููุงุฉ ุงูุฅูุชุฑูุช ุงูุชู ุฌุงุก ูููุง ุงูุทูุจ ุญููุง.  ูู ุดูุก ููุญูุธ ุ ููุญูุธ ูุฌุงูุฒ ููุชูุฌูู. <br>  ูุชูุซู ุงูุชุฃุซูุฑ "ุงูุฌุงูุจู" ุงูููุชุงุฒ ููุฐุง ุงูุชูููู ูู ุงููุฏุฑุฉ ุนูู ุฅุนุงุฏุฉ ุชูุฌูู ููุงูุฐ DSNAT ูู ููุง ูููุฑู ISP2 ู ISP3 ูู ููุณ ุงูููุช.  ูุง ุนูู ุงูุฅุทูุงู ุ ูุฃูู ูู ISP1 ููุณ ูุฏููุง ุนููุงู ูุงุจู ููุชูุฌูู.  ูุฐุง ุงูุชุฃุซูุฑ ููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ูุฎุงุฏู ุงูุจุฑูุฏ ุงูุฐู ูุดุชูู ุนูู ุฌูุงุฒู MX ููุธุฑุงู ุฅูู ูููุงุช ุงูุฅูุชุฑูุช ุงููุฎุชููุฉ. <br><br>  ูููุถุงุก ุนูู ุงููุฑูู ุงูุฏูููุฉ ูู ุงูุดุจูุงุช ุงููุญููุฉ ุงูุนุงููุฉ ูุน ุฃุฌูุฒุฉ ุชูุฌูู IP ุงูุฎุงุฑุฌูุฉ ุ ูุณุชุฎุฏู ุงูุญููู ูู ุงูููุฑุงุช.  1.8.2 ู 3.1.2.6. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููููู ุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ูุน ุนูุงูุงุช ููุญู ุงูููุฑุฉ 3 ูู ุงููุดููุฉ.  ูุทุจููุง ูุซู ูุฐุง: <br><br>  2.4.  ููุฌู ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุนููุงุก ุงููุญูููู ูู ููุงุฆู ุงูุชูุฌูู ุฅูู ุงูุฌุฏุงูู ุงูููุงุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP1" dst-address-list=!BOGONS new-routing-mark=to_isp1 \ passthrough=no src-address-list=Via_ISP1 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP2" dst-address-list=!BOGONS new-routing-mark=to_isp2 \ passthrough=no src-address-list=Via_ISP2 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP3" dst-address-list=!BOGONS new-routing-mark=to_isp3 \ passthrough=no src-address-list=Via_ISP3</code> </pre> <br>  ูุชูุฌุฉู ูุฐูู ุ ูุจุฏู ูุซู ูุฐุง (ุงูุตูุฑุฉ ูุงุจูุฉ ููููุฑ): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/jw/bt/of/jwbtofiohmdeunznqgpnamyuhrm.jpeg"></a> <br><br><h4 style=";text-align:right;direction:rtl">  3. ุชูููู ุงุชุตุงู ISP ูุชูููู ุงูุชูุฌูู ุงููุงุฆู ุนูู ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ </h4><br>  3.1.  ุชูููู ุงูุงุชุตุงู ุจู ISP1: <br>  3.1.1.  ุชูููู ุนููุงู IP ุซุงุจุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip address add interface=ether1 address=100.66.66.2/30 comment="ISP1 IP"</code> </pre> <br>  3.1.2.  ุชูููู ุงูุชูุฌูู ุงูุซุงุจุช: <br>  3.1.2.1.  ุฅุถุงูุฉ ูุณุงุฑ ุงูุทูุงุฑุฆ ุงูุงูุชุฑุงุถู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add comment="Emergency route" distance=254 type=blackhole</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุณูุญ ูุฐุง ุงููุณุงุฑ ูุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุนูููุงุช ุงููุญููุฉ ุจุงููุฑูุฑ ุนุจุฑ ูุฑุญูุฉ ูุฑุงุฑ ุงูุทุฑูู ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ูููุงุช ุฃู ูู ููุฏูู ุงูุฎุฏูุฉ.</i>  <i>ุชููู ุฃูููุฉ ุญุฑูุฉ ุงููุฑูุฑ ุงููุญููุฉ ุงูุตุงุฏุฑุฉ ูู ุฃูู ููู ุชุชุญุฑู ุงูุญุฒูุฉ ุนูู ุงูุฃูู ูู ููุงู ูุง ุ ูุฌุจ ุฃู ูููู ุงูุชูุฌูู ุงููุดุท ุฅูู ุงูุจูุงุจุฉ ุงูุงูุชุฑุงุถูุฉ ููุฌูุฏูุง ูู ุฌุฏูู ุงูุชูุฌูู ุงูุฑุฆูุณู.</i>  <i>ุฅุฐุง ูู ููู ูุฐูู ุ ูุณูุชู ุชุฏููุฑ ุงูุญุฒูุฉ ุจุจุณุงุทุฉ.</i> <br><br>  ุงูุชุฏุงุฏุงู ูุฃุฏุงุฉ <b>ุจูุงุจุฉ ุงูุชุญูู</b> ูุฅุฌุฑุงุก ุชุญููู ุฃุนูู ูุญุงูุฉ ุงูููุงุฉ ุ ุฃูุชุฑุญ ุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุชูุฌูู ุงูุนูุฏูุฉ.  ูููู ุฌููุฑ ุงูุทุฑููุฉ ูู ุฅุฎุจุงุฑ ุงูููุฌู ุจุงูุจุญุซ ุนู ุงููุณุงุฑ ุงููุคุฏู ุฅูู ุงูุจูุงุจุฉ ุงูุฎุงุตุฉ ุจู ุ ููุณ ุจุดูู ูุจุงุดุฑ ุ ูููู ูู ุฎูุงู ุจูุงุจุฉ ูุณูุทุฉ.  ุนูู ูุฐุง ุงููุญู ุ ุณูุชู ุงุฎุชูุงุฑ ุจูุงุจุงุช "ุงูุงุฎุชุจุงุฑ" ุ 4.2.2.1 ุ 4.2.2.2 ู 4.2.2.3 ูู ISP1 ู ISP2 ู ISP3 ุ ุนูู ุงูุชูุงูู. <br><br>  3.1.2.2.  ุงูุทุฑูู ุฅูู ุนููุงู "ุงูุชุญูู": <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add check-gateway=ping comment="For recursion via ISP1" \ distance=1 dst-address=4.2.2.1 gateway=100.66.66.1 scope=10</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุชู ุชูููู ูููุฉ ุงููุทุงู ุฅูู ุงูุงูุชุฑุงุถู ูู ูุทุงู ุงููุฏู ROS ุ ูู ุฃุฌู ุงุณุชุฎุฏุงู 4.2.2.1 ุฃุฎุฑู ูุจูุงุจุฉ ูุชูุฑุฑุฉ.</i>  <i>ุฃุคูุฏ: ูุฌุจ ุฃู ูููู ูุทุงู ุงููุณุงุฑ ุฅูู ุนููุงู "ุงูุชุญูู" ุฃูู ูู ุฃู ูุณุงูู ุงููุทุงู ุงููุณุชูุฏู ููุทุฑูู ุงูุฐู ุณูุดูุฑ ุฅูู ุงูุชุญูู.</i> <br><br>  3.1.2.3.  ุงููุณุงุฑ ุงูุนูุฏูุฉ ุงูุงูุชุฑุงุถู ูุญุฑูุฉ ุงููุฑูุฑ ุฏูู ุนูุงูุฉ ุชูุฌูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add check-gateway=ping comment="Unmarked via ISP1" \ distance=2 gateway=4.2.2.1</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุชู ุงุณุชุฎุฏุงู ุงููุณุงูุฉ = 2 ูุฃูู ุชู ุฅุนูุงู ISP1 ูุฃูู ูุถุน ุงุญุชูุงุทู ููููุง ูุดุฑูุท ุงููููุฉ.</i> <br><br>  3.1.2.4.  ูุณุงุฑ ุงูุนูุฏูุฉ ุงูุงูุชุฑุงุถู ูุญุฑูุฉ ุงููุฑูุฑ ูุน ุนูุงูุฉ ุงูุชูุฌูู "to_isp1": <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add comment="Marked via ISP1 Main" distance=1 gateway=4.2.2.1 \ routing-mark=to_isp1</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูู ุงููุงูุน ุ ููุฏ ุจุฏุฃูุง ุฃุฎูุฑูุง ูู ุงุณุชุฎุฏุงู ุซูุงุฑ ุงูุนูู ุงูุชุญุถูุฑู ุงูุฐู ุชู ุชูููุฐู ูู ุงูููุฑุฉ 2.</i> <i><br><br></i>  <i>ุนูู ูุฐุง ุงููุณุงุฑ ุ ุณูุชู ุชูุฌูู ูู ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชุญูู ุนูุงูุฉ "to_isp1" ุฅูู ุจูุงุจุฉ ุงููููุฑ ุงูุฃูู ุ ุจุบุถ ุงููุธุฑ ุนู ุงูุจูุงุจุฉ ุงูุงูุชุฑุงุถูุฉ ููุฌุฏูู ุงูุฑุฆูุณู ูุดุทุฉ ุญุงูููุง.</i> <br><br>  3.1.2.5.  ุฃูู ูุณุงุฑ ุนูุฏู ุงูุชุฑุงุถู ุงุญุชูุงุทู ูููุฑูุฑ ุงููุณูู ูู ูููุฑู ISP2 ู ISP3: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add comment="Marked via ISP2 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp2 /ip route add comment="Marked via ISP3 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp3</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ููุงู ุญุงุฌุฉ ุฃูุถูุง ุฅูู ูุฐู ุงููุณุงุฑุงุช ูุญุฌุฒ ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุดุจูุงุช ุงููุญููุฉ ุ ูุงูุชู ูู ุฃุนุถุงุก ูู ูุงุฆูุฉ ุงูุนูุงููู "to_isp *"</i> <br><br>  3.1.2.6.  ููุชุจ ูุณุงุฑ ุญุฑูุฉ ูุฑูุฑ ุฌูุงุฒ ุงูุชูุฌูู ุงููุญูู ุฅูู ุงูุฅูุชุฑูุช ูู ุฎูุงู ISP1: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route rule add comment="From ISP1 IP to Inet" src-address=100.66.66.2 table=to_isp1</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุจุงูุงูุชุฑุงู ูุน ุงูููุงุนุฏ ูู ุงูููุฑุฉ 1.8.2 ุ ูุชู ุชูููุฑ ุฎุฑูุฌ ุฅูู ุงูููุงุฉ ุงููุทููุจุฉ ูุน ูุตุฏุฑ ูุนูู.</i>  <i>ูุฐุง ุฃูุฑ ุจุงูุบ ุงูุฃูููุฉ ูุจูุงุก ุงูุฃููุงู ุงูุชู ูุชู ูููุง ุชุญุฏูุฏ ุนููุงู IP ููุฌุงูุจ ุงููุญูู (EoIP ุ IP-IP ุ GRE).</i>  <i>ูุธุฑูุง ูุฃูู ูุชู ุชูููุฐ ุงูููุงุนุฏ ุงูููุฌูุฏุฉ ูู ููุงุนุฏ ุชูุฌูู ip ูู ุงูุฃุนูู ุฅูู ุงูุฃุณูู ุ ุญุชู ุชุชุทุงุจู ุงูุดุฑูุท ูุฃูู ูุฑุฉ ุ ูุฌุจ ุฃู ุชููู ูุฐู ุงููุงุนุฏุฉ ุจุนุฏ ุงูููุงุนุฏ ุงููุงุฑุฏุฉ ูู ุงูููุฑุฉ 1.8.2.</i> <br><br>  3.1.3.  ููุชุจ ูุงุนุฏุฉ NAT ูุญุฑูุฉ ุงููุฑูุฑ ุงูุตุงุฏุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="NAT via ISP1" \ ipsec-policy=out,none out-interface=ether1 to-addresses=100.66.66.2</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>NAT ูู ูู ูุง ููุทุจู ุ ุจุงุณุชุซูุงุก ุฃูู ููุน ูู ุณูุงุณุงุช IPsec.</i>  <i>ุฃุญุงูู ุนุฏู ุงุณุชุฎุฏุงู ุงูุฅุฌุฑุงุก = ุญููุฉ ุชููุฑูุฉ ุฅูุง ุฅุฐุง ูุงู ุฐูู ุถุฑูุฑููุง ููุบุงูุฉ.</i>  <i>ููู ุฃุจุทุฃ ูุฃูุซุฑ ูุซุงูุฉ ูู ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ ูู src-nat ูุฃูู ูุญุณุจ ุนููุงู NAT ููู ุงุชุตุงู ุฌุฏูุฏ.</i> <br><br>  3.1.4.  ูุฑุณู ุนููุงุก ูู ุงููุงุฆูุฉ ููููุน ุนูููู ุงูุฎุฑูุฌ ูู ุฎูุงู ูุฒูุฏู ุฎุฏูุงุช ุขุฎุฑูู ูุจุงุดุฑุฉ ุฅูู ุจูุงุจุฉ ูุฒูุฏ ISP1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add action=route chain=prerouting \ comment="Address List via ISP1 only" dst-address-list=!BOGONS passthrough=no \ route-dst=100.66.66.1 src-address-list=Via_only_ISP1 place-before=0</code> </pre> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุงูุฅุฌุฑุงุก = ุงููุณุงุฑ ูู ุฃููููุฉ ุฃุนูู ููุชู ุชุทุจููู ูุณุจููุง ุนูู ููุงุนุฏ ุงูุชูุฌูู ุงูุฃุฎุฑู.</i> <i><br><br></i>  <i>ูุถุน ูุจู = 0 - ูุถุน ุญูููุง ุฃููุงู ูู ุงููุงุฆูุฉ.</i> <br><br>  3.2.  ูุญู ุชูููู ุงุชุตุงู ู ISP2. <br><br>  ูุธุฑูุง ูุฃู ูููุฑ ISP2 ูุนุทููุง ุงูุฅุนุฏุงุฏุงุช ุนุจุฑ DHCP ุ ููู ุงููุนููู ุฅุฌุฑุงุก ุงูุชุบููุฑุงุช ุงููุงุฒูุฉ ุจุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ูุตู ูุจุฏุฃ ุนูุฏ ุชุดุบูู ุนููู DHCP: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip dhcp-client add add-default-route=no disabled=no interface=ether2 script=":if (\$bound=1) do={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip route add check-gateway=ping comment=\"For recursion via ISP2\" \ distance=1 dst-address=4.2.2.2/32 gateway=\$\"gateway-address\" scope=10\r\ \n /ip route add check-gateway=ping comment=\"Unmarked via ISP2\" \ distance=1 gateway=4.2.2.2\r\ \n /ip route add comment=\"Marked via ISP2 Main\" distance=1 gateway=4.2.2.2 \ routing-mark=to_isp2\r\ \n /ip route add comment=\"Marked via ISP1 Backup1\" distance=2 \ gateway=4.2.2.2 routing-mark=to_isp1\r\ \n /ip route add comment=\"Marked via ISP3 Backup2\" distance=3 \ gateway=4.2.2.2 routing-mark=to_isp3\r\ \n /ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"lease-address\" \ comment=\"NAT via ISP2\"\r\ \n /ip route rule add comment=\"From ISP2 IP to Inet\" \ src-address=\$\"lease-address\" table=to_isp2 \r\ \n} else={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip firewall nat remove [find comment=\"NAT via ISP2\"]\r\ \n /ip route rule remove [find comment=\"From ISP2 IP to Inet\"]\r\ \n}\r\ \n" use-peer-dns=no use-peer-ntp=no</code> </pre> <br>  ุงูุจุฑูุงูุฌ ุงููุตู ููุณู ูู ูุงูุฐุฉ Winbox (ูุงุจู ููููุฑ): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/dz/_f/hh/dz_fhhyltpdet5oush5wqwpud2e.jpeg"></a> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูุชู ุชุดุบูู ุงูุฌุฒุก ุงูุฃูู ูู ุงูุจุฑูุงูุฌ ุงููุตู ุนูุฏ ุงุณุชูุงู ุนูุฏ ุงูุฅูุฌุงุฑ ุจูุฌุงุญ ุ ูุงูุฌุฒุก ุงูุซุงูู - ุจุนุฏ ุฅุตุฏุงุฑ ุนูุฏ ุงูุฅูุฌุงุฑ.</i>  <sup>ุงูุธุฑ ุงูููุงุญุธุฉ 2</sup> <br><br>  3.3.  ูุญู ุชูููู ุงูุงุชุตุงู ุจูููุฑ ISP3. <br><br>  ูุธุฑูุง ูุฃู ูุฒูุฏ ุงูุชููุฆุฉ ูุนุทููุง ุฏููุงููููุฉ ุ ููู ุงููุนููู ุฅุฌุฑุงุก ุงูุชุบููุฑุงุช ุงููุงุฒูุฉ ูุน ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูุชู ุชุจุฏุฃ ุจุนุฏ ุงูุงุฑุชูุงุน ูุจุนุฏ ุณููุท ูุงุฌูุฉ ppp. <br><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ูููู ุชุญุฏูุฏ ูุงุฌูุฉ ppp ูุจูุงุจุฉ ุจุฏูุงู ูู ุนููุงู IP.</i>  <i>ููุน ุฐูู ุ ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ูููู ุชูุดูุท ุงููุณุงุฑ ุงูุนูุฏูุฉ.</i>  <i>ูุฐูู ุ ูุญุตู ุนูู ุนููุงู IP ูุฌุงูุจ ุงููุฒูุฏ ูู ุงููุชุบูุฑ ููุณุชุฎุฏูู ุจุดูู ุฃูุจุฑ ุจููุณ ุงูุทุฑููุฉ ุงููุชุจุนุฉ ูุน ุงููููุฑูู ุงูุขุฎุฑูู</i> <br><br>  3.3.1.  ุฃููุงู ุ ูู ุจุชูููู ููู ุงูุชุนุฑูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ppp profile add comment="for PPPoE to ISP3" interface-list=WAN name=isp3_client \ on-down="/ip route remove [ find gateway=\"4.2.2.3\" ]\r\ \n/ip route remove [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip firewall nat remove [find comment=\"NAT via ISP3\"]\r\ \n/ip route rule remove [find comment=\"From ISP3 IP to Inet\"]" \ on-up="/ip route remove [ find gateway=\"4.2.2.3\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip route add check-gateway=ping comment=\"For recursion via ISP3\" distance=1 \ dst-address=4.2.2.3/32 gateway=\$\"remote-address\" scope=10\r\ \n/ip route add check-gateway=ping comment=\"Unmarked via ISP3\" distance=3 \ gateway=4.2.2.3\r\ \n/ip route add comment=\"Marked via ISP3 Main\" distance=1 gateway=4.2.2.3 \ routing-mark=to_isp3\r\ \n/ip route add comment=\"Marked via ISP1 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp1\r\ \n/ip route add comment=\"Marked via ISP2 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp2\r\ \n/ip firewall mangle set [find comment=\"Connmark in from ISP3\"] \ in-interface=\$\"interface\"\r\ \n/ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"local-address\" \ comment=\"NAT via ISP3\"\r\ \n/ip route rule add comment=\"From ISP3 IP to Inet\" \ src-address=\$\"local-address\" table=to_isp3 "</code> </pre><br>  ุงูุจุฑูุงูุฌ ุงููุตู ููุณู ูู ูุงูุฐุฉ Winbox (ูุงุจู ููููุฑ): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/oz/tz/it/oztzitzzxgl5jz0g9jxskvtf3us.jpeg"></a> <br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>ุตู</i> <i><br></i>  <i><b>/ ip firewall mangle set [find comment = "Connmark in from ISP3"] in-interface = $ "interface"ุ</b></i> <i><br></i>  <i>ูุชูุญ ูู ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุงุฌูุฉ ุจุดูู ุตุญูุญ ุ ูุฃููุง ุชุนูู ุจููุฏูุง ูููุณ ูุน ุงุณู ุงูุนุฑุถ.</i> <br><br>  3.3.2.  ุงูุขู ุ ุจุงุณุชุฎุฏุงู ููู ุงูุชุนุฑูู ุ ูู ุจุฅูุดุงุก ุงุชุตุงู ppp: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/interface pppoe-client add allow=mschap2 comment="to ISP3" disabled=no \ interface=ether3 name=pppoe-isp3 password=isp3_pass profile=isp3_client \ user=isp3_client</code> </pre> <br><br>  <i><b>ุงููุฐูุฑุฉ.</b></i>  <i>"ููุณู" ุจุนุถ ุงููููุฑูู ุฅุนุทุงุก ุงููุนููุฉ "ุนููุงู ุจุนูุฏ".</i>  <i>ูู ูุฐู ุงูุญุงูุฉ ุ ุนูุฏ ุงูุงุชุตุงู ุ ูู ูุนูู ุงูุจุฑูุงูุฌ ุงููุตู ููุชูููู ุจุดูู ุตุญูุญ ุ ููู ุงูุณุฌู ุณุชุฑู ุงูุฎุทุฃ ุงูุชุงูู:</i> <i><br></i>  <i>pppoe ุ ppp ุ info pppoe-isp3: ุชุนุฐุฑ ุชุญุฏูุฏ ุงูุนููุงู ุงูุจุนูุฏ ุ ุจุงุณุชุฎุฏุงู xxx.xxx.xxx.xxx</i> <i><br></i>  <i>ูุญู ูุฐู ุงููุดููุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุนููู ุงูุนููุงู ูุฏูููุง ูู ููู ุชุนุฑูู ppp (ุฃู ุฏููุฉ):</i> <i><br></i> <pre style=";text-align:right;direction:rtl"> <i><code class="plaintext hljs">/ppp profile set isp3_client remote-address=169.254.69.96</code></i> </pre> <i><br></i>  <i>ุตู</i> <i><br></i>  <i><b>/ ip firewall mangle set [find comment = "Connmark in from ISP3"] in-interface = $ "interface"ุ</b></i> <i><br></i>  <i>ูุชูุญ ูู ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุงุฌูุฉ ุจุดูู ุตุญูุญ ุ ูุฃููุง ุชุนูู ุจููุฏูุง ูููุณ ูุน ุงุณู ุงูุนุฑุถ.</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงููุณุฉ ุฃุฎูุฑุฉ ุ ุงุถุจุท ุงูุณุงุนุฉ: </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/system ntp client set enabled=yes \ server-dns-names=0.pool.ntp.org,1.pool.ntp.org,2.pool.ntp.org</code> </pre> <br><h4 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ููุฑุคูู ุญุชู ุงูููุงูุฉ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุทุฑููุฉ ุงูููุชุฑุญุฉ ูุชูููุฐ multivans ูู ุงูุชูุถูู ุงูุดุฎุตู ูููุคูู ูููุณุช ูู ุงูุทุฑููุฉ ุงููุญูุฏุฉ ุงูููููุฉ. </font><font style="vertical-align: inherit;">ูุฌููุนุฉ ุฃุฏูุงุช ROS ูุงุณุนุฉ ููุฑูุฉ ุ ูุงูุชู ุชุณุจุจ ูู ูุงุญูุฉ ุตุนูุจุงุช ูููุจุชุฏุฆูู ุ ูู ูุงุญูุฉ ุฃุฎุฑู - ุณุจุจ ุงูุดุนุจูุฉ. </font><font style="vertical-align: inherit;">ุงุณุชูุดู ูุญุงูู ูุงูุชุดู ุฃุฏูุงุช ูุญููู ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูุชุทุจูู ูููุนุฑูุฉ ุงูููุชุณุจุฉ ุ ูู ุงููููู ูู ูุฐุง ุงูุชุทุจูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุดุงุญูุฉ ุงููุชุนุฏุฏุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุณุชุจุฏุงู ุฃุฏุงุฉ </font><b><font style="vertical-align: inherit;">ุจูุงุจุฉ ุงููุญุต</font></b><font style="vertical-align: inherit;"> ุจุทุฑู ูุชูุฑุฑุฉ ูุน </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netwatch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุงุญุธุงุช </font></font></h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <i><b>Check-gateway</b> โ ,             .     10 ,   . ,       20-30 .       โ     <b>Netwatch</b> ,      . <br>  <b>Check-gateway</b>        . <br><br> <u><b>!</b></u>          ,    .     <b>check-gateway=ping</b>  .</i> </li><li style=";text-align:right;direction:rtl"> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏุซ ุฃู ูุญุฏุซ ุนุทู ูู ุขููุฉ ุชุดุบูู DHP ุ ูุงูุชู ุชุจุฏู ููุฃููุง ุนููู ูุนูู ูู ุญุงูุฉ ุชุฌุฏูุฏ. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ูู ูุนูู ุงูุฌุฒุก ุงูุซุงูู ูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ูููู ูู ุชุชุฃุฐู ุญุฑูุฉ ุงููุฑูุฑ ุจุดูู ุตุญูุญ ุ ูุฃู ุงูุฏููุฉ ุชุฑุงูุจ ุงููุณุงุฑ ุงูุนูุฏูุฉ ุงูููุงุจู.</font></font></i> </li><li style=";text-align:right;direction:rtl"> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECMP (ูุณุงุฑ ูุชุนุฏุฏ ุงูุชูููุฉ ูุชุณุงูู)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุชุชูุชุน ROS ุจุงููุฏุฑุฉ ุนูู ุชุญุฏูุฏ ูุณุงุฑ ูุน ุนุจูุงุฑุงุช ูุชุนุฏุฏุฉ ูุงููุณุงูุฉ ููุณูุง. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชู ุชูุฒูุน ุงูุงุชุตุงูุงุช ุนุจุฑ ุงููููุงุช ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ุฑูุจู ุงููุณุชุฏูุฑุฉ ุ ุจูุง ูุชูุงุณุจ ูุน ุนุฏุฏ ุงูุจูุงุจุงุช ุงููุญุฏุฏุฉ.</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ูุญูุฒ</font></a><font style="vertical-align: inherit;"> ุงูุฒุฎู ููุชุงุจุฉ ุงูููุงู ุ ุณุงุนุฏ ูู ุชุดููู ููููู ูุงูุชุฑููุฒ - ุจูุถู ุดุฎุตูุฉ ูู Eugene </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ jscar</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar463813/">https://habr.com/ru/post/ar463813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar463799/index.html">ูุง ูุง ูุนุฌุจูู ูู Windows 10</a></li>
<li><a href="../ar463801/index.html">3 ุงูุตูุงุช ุงูุฑุฆูุณูุฉ ููุฌุงุญ ูุฏูุฑ ุงูููุชุฌ: ุฃูุชูู Stozhko</a></li>
<li><a href="../ar463803/index.html">ูููู ุงูุฎุงูุณ ูุน ูุงููู: ููููุฐ ุจุนุถ ุงูุจุฑุงูุฌ</a></li>
<li><a href="../ar463805/index.html">ุณุจุนุฉ ูุชุจ ูุฃููุฆู ุงูุฐูู ูุฑูุฏูู ุฃู ูุตุจุญูุง ูุตูู ุฃูุนุงุจ</a></li>
<li><a href="../ar463811/index.html">ุชุญุถูุฑ ุงูุชุทุจูู ููุธุงู Android Q. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar463815/index.html">ููุงุฐุง ููุชู ุจูู ุฃุฌูุจู ุจูุตุฏุฑ ุฃููุงููุ</a></li>
<li><a href="../ar463817/index.html">20 ูุฏูุฑ ููุชุฌ ูุจููุฉ ูุตูููุฉ ูุชุนุฏุฏุฉ ุงูุฃุจุนุงุฏ ุนูู ุงูุฅุทูุงู. ูุญุงุฏุซุฉ ูุน Skyeng</a></li>
<li><a href="../ar463819/index.html">ุฃููุงู PostgreSQL: 2. ุฃููุงู ุงูุณูุณูุฉ</a></li>
<li><a href="../ar463821/index.html">AMO ุ Bitrix ุ 1C ูุบูุฑูุง: ููู ุชุฎุชุงุฑ ูู ุฃูู ุชุจุฏุฃุ</a></li>
<li><a href="../ar463823/index.html">ุงูุฅุตุฏุงุฑ 1.37.0 ูู ุงูุตุฏุฃ: ุชุญุณูู ููู ุชุนุฑูู ุงูุชูุฌูู ุ ูุงูุซูุงุจุช ุบูุฑ ุงููุณูุงุฉ ูููุฑุฏ ุงูุจุถุงุฆุน</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>