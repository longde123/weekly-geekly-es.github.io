<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíö üôéüèæ ü§≥üèæ Comment nous avons construit le stockage S3 DataLine. Exp√©riences, tests et un peu d'hippopotames ‚ÜòÔ∏è üö¥üèæ üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† nouveau, Alexey Pristavko est en contact, et ceci est la deuxi√®me partie de mon histoire sur le DataLine de stockage d'objets S3 bas√© sur Cl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons construit le stockage S3 DataLine. Exp√©riences, tests et un peu d'hippopotames</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/425973/"><img src="https://habrastorage.org/webt/0k/od/i7/0kodi796iwhoi16frktb7mytx_4.png"><br><br>  Bonjour √† nouveau, Alexey Pristavko est en contact, et ceci est la deuxi√®me partie de mon histoire sur le DataLine de stockage d'objets S3 bas√© sur Cloudian HyperStore. <br><br>  Aujourd'hui, je parlerai en d√©tail de la fa√ßon dont notre stockage S3 est organis√© et des difficult√©s que nous avons rencontr√©es lors de sa cr√©ation.  Assurez-vous d'aborder le sujet ¬´de fer¬ª et d'analyser l'√©quipement sur lequel nous avons fini par rester. <br><br>  C'est parti! <br><a name="habracut"></a><br>  Si en lecture vous avez envie de vous familiariser avec l'architecture applicative de la solution Cloudian, vous trouverez son analyse d√©taill√©e dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> .  Nous y avons discut√© en d√©tail du dispositif interne Cloudian, de la tol√©rance aux pannes et de la logique du SDS int√©gr√©. <br><br><h2>  Le sch√©ma final de l'√©quipement physique </h2><br>  Puisque plus tard nous parlerons de notre "tourment de choix", je donnerai imm√©diatement la liste d√©finitive du fer auquel nous sommes arriv√©s.  Petit avertissement: le choix de l'√©quipement r√©seau √©tait en grande partie d√ª √† sa pr√©sence dans notre entrep√¥t (soit dit en passant, tr√®s solide). <br><br>  Donc, au niveau physique du stockage, nous avons les √©quipements suivants: <br><table><tbody><tr><td>  <b>Nom</b> <br></td><td>  <b>Fonction</b> <br></td><td>  <b>La configuration</b> <br></td><td>  <b>Qt√©</b> <br></td></tr><tr><td>  Serveur Lenovo System x3650 M5 <br></td><td>  Noeud de travail <br></td><td>  1x Xeon E5-2630v4 2,2 GHz, <br>  4x 16 Go DDR4, <br>  14x 10 To 7,2 K 6 Gbit / s SATA 3,5 ", <br>  2 disques SSD de 480 Go, <br>  Intel x520 double port 10 GbE SFP +, <br>  2x750W HS PSU <br></td><td>  4 <br></td></tr><tr><td>  Serveur HP ProLiant DL360 G9 <br></td><td>  Noeud d'√©quilibrage de charge <br></td><td>  2 E5-2620 v3, <br>  128 Go de RAM, <br>  2 disques SSD de 600 Go, <br>  4 disques durs SAS, <br>  Intel x520 double port 10 GbE SFP + <br></td><td>  2 <br></td></tr><tr><td>  Commutateur Cisco C4500 <br></td><td>  Passerelle frontali√®re <br></td><td>  Catalyst WS-C4500X-16SFP + <br></td><td>  2 <br></td></tr><tr><td>  Commutateur Cisco C3750 <br></td><td>  Prolongateur de port <br></td><td>  Catalyseur WS-C3750X-24T avec C3KX-NM-10G <br></td><td>  2 <br></td></tr><tr><td>  Commutateur Cisco C2960 <br></td><td>  avion de contr√¥le <br></td><td>  Catalyseur WS-C2960 + 48PST-L <br></td><td>  1 <br></td></tr></tbody></table><br>  Pour une meilleure compr√©hension de l'architecture, nous allons examiner tour √† tour tous les √©l√©ments et parler de leurs fonctionnalit√©s et t√¢ches. <br><br>  Commen√ßons par les serveurs.  Les serveurs Lenovo ont une configuration sp√©ciale qui est impl√©ment√©e conjointement et en pleine conformit√© avec les recommandations et sp√©cifications Cloudian.  Par exemple, ils utilisent un contr√¥leur avec un acc√®s direct au disque.  √âtant donn√© que dans notre cas, le RAID est organis√© au niveau du logiciel d'application, ce mode augmente la fiabilit√© et acc√©l√®re le sous-syst√®me de disque.  Exactement, les m√™mes serveurs peuvent √™tre achet√©s en tant qu'appliance Cloudian avec toutes les licences. <br><br>  Les serveurs d'√©quilibrage de charge avec Nginx pour CentOS garantissent une r√©partition uniforme de la charge sur les n≈ìuds de travail et soustraient l'utilisateur √† l'organisation du trafic interne.  Et comme bonus agr√©able - si n√©cessaire, vous pouvez organiser un cache sur eux. <br><br>  La paire Cisco 4500X seize 10 Go SFP + sert de noyau et de fronti√®re √† notre petit mais fier r√©seau de stockage.  Bien s√ªr, le fer est un peu d√©mod√©, mais il n'est pas inf√©rieur au ¬´nouveau¬ª en termes de fiabilit√©, il a une redondance interne et sa fonctionnalit√© r√©pond √† toutes nos exigences.  Le C3750 joue le r√¥le d'extendeur d'usine, il n'est pas n√©cessaire d'ins√©rer des √©metteurs-r√©cepteurs 1G dans des emplacements 10G.  Et passer compl√®tement √† des liens de 10 Go n'a pas encore beaucoup de sens.  Comme les tests l'ont montr√©, nous avons rencontr√© le processeur et les disques plus t√¥t. <br><br>  Le diagramme ci-dessous illustre suffisamment en d√©tail l'organisation physique que j'ai d√©crite: <br><br><img src="https://habrastorage.org/webt/jj/cs/mr/jjcsmrwqvzkqrder_z9zv3pr4ca.jpeg">  <i>1. Sch√©ma d'organisation du stockage physique</i> <br><br>  Passons en revue le sch√©ma.  Comme vous pouvez le voir, la tol√©rance aux pannes au niveau physique est r√©alis√©e en dupliquant et en connectant chacun des appareils avec au moins deux liaisons optiques, une pour chaque appareil dans une paire.  Cela nous donne une garantie de maintenir la connectivit√© physique dans le circuit lors d'un accident de tout p√©riph√©rique r√©seau ou de deux p√©riph√©riques de paires diff√©rentes simultan√©ment. <br><br>  Nous allons en dessous du sch√©ma.  Les deux paires Cisco (4500/4500, 3750/3750) sont combin√©es en un seul p√©riph√©rique logique utilisant la pile et VSS.  La pile est assembl√©e avec deux c√¢bles de pile, VSS via trois liaisons optiques 10G.  Cela vous permet de vous assurer que les deux appareils de chaque paire interagissent dans leur ensemble.  Un tel clustering nous permet de travailler dans le cadre d'un segment L2 transparent √† travers les deux appareils d'une paire et de faire une agr√©gation de liens g√©n√©rale √† l'aide de LACP, car cette technologie est prise en charge de mani√®re native par le syst√®me d'exploitation du serveur et Cisco IOS.  Du c√¥t√© du serveur, il semble qu'il fonctionne avec un commutateur au lieu de deux, et au-dessus de l'application, il y a un canal agr√©g√© de double capacit√©. <br><br>  Tout l'√©quipement r√©seau passant entre lui-m√™me et les canaux entrants se fait √† l'aide de liaisons optiques 10G, l'√©quipement serveur est connect√© √† l'aide de c√¢bles Cisco Twinax 10G et de cuivre 1G. <br><br>  BGP est utilis√© pour la tol√©rance aux pannes sur le canal entrant, et Round Robin DNS est utilis√© pour √©quilibrer les adresses IP externes.  Les adresses externes elles-m√™mes sont parqu√©es sur des serveurs d'√©quilibrage de charge et, si n√©cessaire, migrent entre les n≈ìuds √† l'aide du paquet Pacemaker / Corosync. <br><br>  La surveillance et le contr√¥le via IPMI sont effectu√©s via une liaison interne directe.  Toutes les interfaces de gestion (serveurs et Cisco) sont connect√©es via des commutateurs de plan de contr√¥le s√©par√©s.  Ils sont √† leur tour inclus dans le r√©seau de contr√¥le du centre de donn√©es.  Cela nous garantit l'impossibilit√© de perdre la communication avec les √©quipements pendant le travail ou √† la suite d'un accident sur un r√©seau externe.  Pour le cas le plus extr√™me, il y a des pr√©pos√©s avec KVM. <br><br><h2>  R√©seau logique </h2><br>  Pour comprendre le fonctionnement du r√©seau logique S3 du stockage DataLine, tournons-nous vers un autre sch√©ma: <br><br><img src="https://habrastorage.org/webt/lp/zn/ub/lpznubpzqosgkhzts8tm7sp0ssi.png"><br>  <i>2. Sch√©ma du r√©seau logique de stockage</i> <br><br>  Comme vous pouvez le voir, la logique du r√©seau se compose de plusieurs segments. <br><br>  Un r√©seau externe (Q) d'une capacit√© totale de 20G est connect√© directement √† Provider Edge.  Viennent ensuite le Cisco 4500 et les √©quilibreurs. <br><br>  Le bloc logique suivant (X) est le VLAN entre les √©quilibreurs et les n≈ìuds de travail.  Les √©quilibreurs utilisent la m√™me connexion que pour le trafic entrant.  Les n≈ìuds de travail sont connect√©s via la pile 3750 avec 4 liaisons 1G (deux pour chaque 3750).  Toutes les liaisons physiques sont assembl√©es en une seule liaison logique utilisant √©galement LACP.  Ce r√©seau est utilis√© uniquement pour le traitement du trafic client. <br><br>  Toutes les connexions au sein du cluster Cloudian (Y) passent par un troisi√®me segment logique construit au-dessus de 10G.  Une telle organisation permet d'√©viter les probl√®mes sur le canal externe dus au trafic interne et vice versa.  Il s'agit d'un segment extr√™mement charg√© et important pour le fonctionnement du cluster.  C'est √† travers lui que les donn√©es et les m√©tadonn√©es sont r√©pliqu√©es, elles sont utilis√©es par toutes les proc√©dures de r√©√©quilibrage, etc., nous avons donc distingu√© son ¬´insubmersibilit√©¬ª comme une t√¢che distincte. <br><br><h2>  Un peu de beaut√© </h2><br>  Voici √† quoi tout ressemble: <br><br><img src="https://habrastorage.org/webt/_m/_1/sd/_m_1sd2pvc2h5nbt2wco5bdkl4s.png"><br>  <i>3. √âquipement r√©seau et √©quilibreurs complets</i> <br><br><img src="https://habrastorage.org/webt/xo/q0/e4/xoq0e4outgmbcgswdzb4uzs4bsg.png"><br>  <i>4. La m√™me vue arri√®re</i> <br><br>  Faites attention au changement.  Dans des articles pr√©c√©dents, mes coll√®gues ont √©crit sur l'importance des c√¢bles de marquage de couleur, mais il ne sera pas hors de propos de toucher √† ce sujet ici. <br><br>  Nous utilisons la commutation des couleurs non seulement pour le r√©seau, mais aussi pour l'alimentation.  Cela permet √† nos ing√©nieurs de naviguer rapidement dans le rack et r√©duit l'influence du facteur humain lors de la commutation. <br><br><img src="https://habrastorage.org/webt/uu/8x/tw/uu8xtwvqpdcvw45xlugyfysq5is.png"><br>  <i>5. Noeuds de travail</i> <br><br><img src="https://habrastorage.org/webt/wl/gn/5g/wlgn5gc7cttpbkra7cpmnza_pdo.png"><br>  <i>6. Vue arri√®re</i> <br><br>  Sur cette photo, vous pouvez clairement voir √† quel point les serveurs qui fonctionnent sont remplis de disques - il n'y a pratiquement aucun emplacement vide m√™me √† l'arri√®re.  Soit dit en passant, une telle organisation des c√¢bles en faisceaux compacts remplit non seulement une fonction esth√©tique, mais √©vite √©galement le chevauchement des ventilateurs des alimentations, ce qui √©vite au fer de surchauffer. <br><br><h3>  Liste blanche </h3><br>  Dans les commentaires sur le dernier article, j'ai promis de parler davantage de l'appareil de liste blanche. <br><br>  Si, pour une raison quelconque, nous avons convenu avec le client d'exclure des comptes tous les travaux avec le stockage de l'int√©rieur du centre de donn√©es ou via des canaux directs vers son √©quipement, alors nous devons organiser une connexion priv√©e au stockage. <br><br>  Rappelez-vous, dans le premier diagramme, il y avait une branche sur DIST et Cloud?  En plus du canal Internet principal de 20 Go, nous utilisons un canal agr√©g√© pour les commutateurs, auquel nous connectons tous les clients au niveau du centre de donn√©es.  Si le client veut un lien direct vers le stockage, nous pouvons configurer le VLAN du client vers notre 4500X avec la construction d'une route s√©par√©e (ou sans) et d√©marrer L3.  Apr√®s cela, la liaison au plan tarifaire est configur√©e sur les adresses du client d√©j√† dans Cloudian lui-m√™me.  Ensuite, pour tous ceux qui sont connect√©s √† ce plan tarifaire, l'utilisation de S3 √† partir d'adresses en liste blanche ne sera pas prise en compte. <br><br><img src="https://habrastorage.org/webt/mr/nc/yd/mrncyda-0oquwo4kpos3snsyp2e.png"><br>  <i>7. Et voici une interface sp√©ciale dans Cloudian.</i> <br><br>  Maintenant, nous n'avons pas un tel tarif dans le r√©seau, mais si vous le voulez vraiment, nous pouvons le fournir. <br><br><h2>  Histoire de la construction </h2><br>  Nous abordons progressivement la partie la plus int√©ressante de l'histoire - la construction d'une installation de stockage.  Il y aura de nombreuses photos, jusqu'√† trois tentatives pour organiser l'√©quilibrage du trafic et quelques mauvais conseils.  J'esp√®re que l'analyse des probl√®mes rencontr√©s sur le chemin sera utile √† ceux qui se pr√©parent √† travailler avec des vitesses 10Gb + sur le web. <br><br><h3>  Exp√©rimenter avec 10G </h3><br>  Avant de passer directement √† l'essentiel de cette section, je me permets de faire un autre petit avertissement. <br><br>  Selon une tradition √©tablie, avant d'acheter de nouveaux √©quipements auxiliaires, nous nous rendons √† l'entrep√¥t et s√©lectionnons des composants plus ou moins adapt√©s.  Cela vous permet d'effectuer rapidement des tests et de d√©cider d'une future liste de courses.  Bien s√ªr, bien que nous n'atteignions pas un r√©sultat fiable √† 100%, rien n'est d√©pens√© pour la productivit√©. <br><br>  C'√©tait donc cette fois.  Et si Cisco n'a pas lanc√© de surprise, alors avec les √©quilibreurs de charge, la ¬´cupidit√©¬ª nous a presque ruin√©s. <br><br><h4>  La premi√®re exp√©rience.  Serveurs Supermicro </h4><br>  Ici, nous avons √©t√© d√©√ßus par le d√©sir de r√©aliser un test rapide √† moindre co√ªt.  Dans l'entrep√¥t, nous avons trouv√© des serveurs Supermicro qui avaient tout bien sauf le manque d'interfaces SFP.  Nous avons d√©cid√© d'y installer notre bien-aim√© Intel 520DA2 et avons imm√©diatement fait face au premier probl√®me: les machines sont monobloc, mais il n'y a pas de contremarches.  En m√™me temps, pour une raison quelconque, notre corps n'√©tait pas dans les listes de compatibilit√©, mais il y avait beaucoup de contremarches indig√®nes. <br><br>  Sur les conseils de la directrice du d√©veloppement innovant, Misha Solovyov, nous avons tout connect√© avec des colonnes montantes flexibles pour les exploitations mini√®res.  Le r√©sultat √©tait un tel "cadavre": <br><br><img src="https://habrastorage.org/webt/lf/wx/t6/lfwxt6csco5ndrm--6qzy4kqfhi.png"><br>  <i>8. Prototype n ¬∞ 1</i> <br><br>  J'ai d√ª utiliser le fameux ruban √©lectrique bleu √† certains endroits, pour que, Dieu m'en garde, fais quoi que ce soit de court.  Oui, la ferme collective.  Oui, honteux.  Mais une telle ¬´configuration¬ª est tout √† fait acceptable pour la p√©riode de l'exp√©rience. <br><br><img src="https://habrastorage.org/webt/sp/to/af/sptoaf-lv4w_imfhvnro9i12f1y.png"><br>  <i>9. Vue arri√®re</i> <br><br>  Ce qui en est ressorti est clairement visible sur la capture d'√©cran de l'iperf: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/494/311/900/494311900ac9a09852f260ebbfb4e4b8.png"><br>  <i>10. En fait, ce n'est pas une capture d'√©cran :)</i> <br><br>  Les m√©triques sont tr√®s int√©ressantes, non?  Nous √©tions donc tristes.  Au d√©but, nous pensions aux puces d'espionnage, nous d√©montions et redressions tout. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/bb2/6ac/082bb26ac22d6de01f22f464b778314b.png"><br>  <i>11. √Ä premi√®re vue, il n'y a pas de jetons d'espionnage ici</i> <br><br>  Ils ont rappel√© le cours de physique: interf√©rences √©lectromagn√©tiques, signaux haute fr√©quence, etc ... Bien s√ªr, poursuivre l'exp√©rience avec une telle quantit√© et qualit√© de la "ferme collective" n'avait pas de sens.  Nous avons donc finalement d√©mont√© le syst√®me et remis les serveurs en place. <br><br><h4>  La deuxi√®me exp√©rience.  Citrix Netscaler MPX8005 </h4><br>  Dans le processus de retour des serveurs √† l'endroit, nous avons trouv√© de nouveaux h√©ros: Citrix Netscaler MPX8005.  C'est un merveilleux fer de marque, d'ailleurs, presque jamais utilis√©.  Ils ressemblent √† ceci: <br><br><img src="https://habrastorage.org/webt/dq/v1/va/dqv1vawcvfgpmmijwrie29ewkgy.png"><br>  <i>12. La glissi√®re du rack ne tenait pas en longueur, mais nous, visionnaires, avons d√©cid√© de la reporter √† plus tard</i> <br><br>  √âquipement plac√© dans un rack, commut√© et configur√©.  Ce sont vraiment d'excellents morceaux de fer ¬´adultes¬ª, 2 emplacements SFP pour 10 Go chacun, HA, des algorithmes avanc√©s, il y a m√™me L7.  Certes, jusqu'√† 5 gigabits sous licence, mais nous avons toujours utilis√© L3, mais il n'y a pas de telles limites. <br><br>  Croise les doigts, test.  Il n'y a pas de vitesse.  Sur les interfaces - erreurs solides sur les √©metteurs-r√©cepteurs inappropri√©s, vitesse d'environ 5 gigabits, chutes constantes.  Ils se souvenaient des √©l√©vateurs flexibles, √©taient encore tristes.  M√™me l√†, la vitesse √©tait plus √©lev√©e et moins d'erreurs.  Nous commen√ßons √† comprendre: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> channel LA/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface LA/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">802.3</span></span>ad Link <span class="hljs-keyword"><span class="hljs-keyword">Aggregate</span></span>) #<span class="hljs-number"><span class="hljs-number">10</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x4100c020</span></span> &lt;ENABLED, UP, <span class="hljs-keyword"><span class="hljs-keyword">AGGREGATE</span></span>, UP, HAMON, HEARTBEAT, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, native vlan=<span class="hljs-number"><span class="hljs-number">1</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h03m23s  Requested: media <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, speed AUTO, duplex <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">160000</span></span>  Link Redundancy Throughput <span class="hljs-number"><span class="hljs-number">80000</span></span>  Actual: throughput <span class="hljs-number"><span class="hljs-number">20000</span></span>  LLDP Mode: <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">9388</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">557582</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">1225</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10514</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">574232</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  bandwidthHigh: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec, bandwidthNormal: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec.  LA mode: AUTO &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">1</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m44s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8921</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">517626</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">585</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">9884</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">545408</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>. &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">0</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m58s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8944</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">530975</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">911</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10819</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">785347</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.</code> </pre> <br><br>  Nous avons utilis√© des √©metteurs-r√©cepteurs Cisco natifs avec lesquels, en th√©orie, aucun probl√®me ne devrait survenir.  Ils ont m√™me v√©rifi√© l'optique et, au cas o√π, ont chang√© les √©metteurs-r√©cepteurs - la m√™me image.  Notre voiture ne marche pas, et c'est tout!  Nous regardons de plus pr√®s. <br><br>  "Beaux" √©metteurs-r√©cepteurs Cisco: <br><br><pre> <code class="hljs vhdl">ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI-Express Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>xe000-<span class="hljs-number"><span class="hljs-number">0</span></span>xe01f mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf781ffff,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf7843fff irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pci1 ix1: ixgbe <span class="hljs-keyword"><span class="hljs-keyword">bus</span></span> speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> PCIe lane <span class="hljs-literal"><span class="hljs-literal">width</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CISCO-AVAGO , part number XXX , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x00 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 *** Unsupported SFP+/SFP <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>!</code> </pre> <br><br>  Les √©metteurs-r√©cepteurs ne sont pas d√©tect√©s normalement, non pris en charge! <br><br>  J'ai d√ª trouver les plus "parents" les plus: <br><br><img src="https://habrastorage.org/webt/wi/-i/sw/wi-iswj9672s8q0skvpw4s3s2xw.png"><br>  <i>13. Les √©metteurs-r√©cepteurs les plus natifs de l'ouest sauvage</i> <br><br><pre> <code class="hljs powershell">ix0: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe020<span class="hljs-literal"><span class="hljs-literal">-0xe03f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7820000<span class="hljs-literal"><span class="hljs-literal">-0xf783ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7844000<span class="hljs-literal"><span class="hljs-literal">-0xf7847fff</span></span> irq <span class="hljs-number"><span class="hljs-number">16</span></span> at device <span class="hljs-number"><span class="hljs-number">0.0</span></span> on pci1 platform: Manufacturer Citrix Inc. platform: NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> <span class="hljs-number"><span class="hljs-number">675320</span></span> (<span class="hljs-number"><span class="hljs-number">28</span></span>), manufactured at <span class="hljs-number"><span class="hljs-number">8</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> platform: serial <span class="hljs-number"><span class="hljs-number">4</span></span>NP602H7H0 platform: sysid <span class="hljs-number"><span class="hljs-number">675320</span></span> - NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> ix0: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX   , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 ix0: [<span class="hljs-type"><span class="hljs-type">ITHREAD</span></span>] <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>: Ethernet address: <span class="hljs-number"><span class="hljs-number">00</span></span>:e0:ed:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:f8 ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe000<span class="hljs-literal"><span class="hljs-literal">-0xe01f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000<span class="hljs-literal"><span class="hljs-literal">-0xf781ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000<span class="hljs-literal"><span class="hljs-literal">-0xf7843fff</span></span> irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> on pci1 ix1: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX  , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00</code> </pre> <br><br>  Ces √©metteurs-r√©cepteurs ont √©t√© d√©termin√©s sans aucun probl√®me, mais cela n'a pas sauv√© la situation.  Firmware mis √† jour - m√™me chose.  Le support Citrix a d√©cid√© de garder le silence avec tact (non, pas √† cause du pedigree de l'√©metteur-r√©cepteur). <br><br>  Nous avons pris une profonde inspiration et nous sommes enfouis dans les sp√©cifications mat√©rielles.  Il s'est av√©r√© que la r√©ponse pendant tout ce temps √©tait sous nos yeux: <i><b>vitesse du bus ixgbe = 5,0 Gbps et largeur de voie PCIe = 8.</b></i> C'est un probl√®me avec la carte.  Elle-m√™me manque de vitesse PCIe.  Notre Citrix a les performances maximales de l'emplacement PCI-e pour une carte avec des √©metteurs-r√©cepteurs de <i><b>5,0 Gbit / s,</b></i> ce qu'il nous a cri√© tout ce temps.  Comme Citrix sur MPX8015 (c'est exactement la m√™me chose en mat√©riel!) Ils voulaient distribuer 15 gigabits, ce n'est pas clair.  Mais nous avons compris pourquoi de tels √©quilibreurs "cool" se trouvaient tout le temps dans un entrep√¥t.  Ils ne peuvent pas fonctionner correctement avec les liaisons 10G en principe. <br><br><h4>  La derni√®re exp√©rience.  Nous utilisons le bon fer et le rendons beau </h4><br>  Ici, notre patience s'est termin√©e avec notre foi en l'humanit√©, et nous avons d√ª utiliser la technologie "de rechange" pour obtenir le mat√©riel normal sous la forme du HP ProLiant DL360 G9 √† partir des photos ci-dessus.  Ils n'ont pas commenc√© √† nous r√©server des surprises, ils t√©l√©chargent la 10G et ne se plaignent pas.  :) <br><br><h2>  Test de charge </h2><br>  Comme nous n'acceptons pas l'approche hujak-hujak-et-production, et nous savons par exp√©rience qu'un syst√®me non test√© apr√®s assemblage avec une garantie de presque 100% sera inutilisable, nous avons d√©cid√© de proc√©der √† des tests de charge.  De plus, avec son aide, vous pouvez effectuer certains r√©glages pour l'avenir. <br><br>  Pour g√©n√©rer la charge, l'outil habituel a √©t√© choisi - Apache Jmetr.  √Ä lui seul, c'est assez bon, comme je l'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> quelques articles en arri√®re, et c'est l'une des solutions les plus flexibles sur le march√©, m√™me si Java aime manger.  Pour travailler avec S3, nous avons utilis√© un module auto-√©crit utilisant le kit AWS SDK, √©galement en Java.  Lors des tests, nous avons pu atteindre une vitesse de 12,5 Gbit / s pour l'√©criture de fichiers de plus de 250 m√©gaoctets avec chargement parall√®le par blocs de 5 m√©gaoctets, et pour des fichiers de moins de 5 m√©gaoctets - traitant environ 3000 requ√™tes HTTP par seconde.  Lors de l'ex√©cution des deux tests en parall√®le, il s'est av√©r√© environ 11 Gigabits et 2200 requ√™tes par seconde.  Dans le m√™me temps, il est possible d'am√©liorer le travail avec une charge mixte et avec de petits objets.  Nous avons "enterr√©" dans le CPU, et le deuxi√®me socket est libre.  Sur le g√©n√©rateur de charge, des fichiers de test ont √©t√© extraits de la RAM afin d'exclure l'influence sur les r√©sultats du sous-syst√®me disque du g√©n√©rateur lui-m√™me.  Pour les tests, rappelant l'amour de Java pour la RAM et la n√©cessit√© de travailler avec un grand nombre de threads lors du chargement parall√®le, nous avons utilis√© le serveur HP DL980 g7 comme g√©n√©rateur.  Il s'agit d'un serveur de huit unit√©s avec 8 processeurs Intel E7-4870 et 512 Go de RAM √† bord. <br><br>  √Ä l'int√©rieur de l'√©quipe, le surnom affectueux Behemoth lui collait. <br><br><img src="https://habrastorage.org/webt/yl/ef/wb/ylefwbgvc4ypecxwot1jtcr7yrc.png"><br>  <i>14. Notre hippopotame.</i>  <i>C'est vrai, quelque chose de similaire?</i> <br><br><img src="https://habrastorage.org/webt/b8/ql/an/b8qlan70ud31dkucw7dt252sbxi.png"><br>  <i>15. Vue arri√®re.</i>  <i>Les c√¢bles effrayants en bas au centre sont une interconnexion du bus de pont interne</i> <br><br><img src="https://habrastorage.org/webt/6c/xe/ni/6cxeniwbbzfcuh7e06brn-ko7pe.png"><br>  <i>16. C'est l'un des deux objectifs du serveur.</i>  <i>Chacun a 4 processeurs et 16 emplacements de 16 gigaoctets de RAM</i> <br><br><img src="https://habrastorage.org/webt/wx/vt/p9/wxvtp91ap3cdeu0y0kmn9komqwo.png"><br>  <i>17. Pour utiliser confortablement Htop dans la console d'un tel serveur, vous avez besoin d'un grand moniteur :)</i> <br><br>  En pratique, un test mixte a sensiblement charg√© m√™me un serveur aussi puissant. <br>  Pour arriver aux r√©sultats de performance obtenus, nous avons d√ª transf√©rer le r√©seau interne du cluster sur des trames jumbo 9k et r√©gler l√©g√®rement la pile r√©seau des √©quilibreurs et des n≈ìuds de travail (nous utilisons CentOS Linux), ainsi qu'optimiser un certain nombre d'autres param√®tres du noyau sur les n≈ìuds de travail: <br><br><pre> <code class="hljs dos">cat /etc/sysctl.conf ‚Ä¶ kernel.printk = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> read_ahead_kb = <span class="hljs-number"><span class="hljs-number">1024</span></span> write_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> read_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> fifo_batch = <span class="hljs-number"><span class="hljs-number">128</span></span> front_merges = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.somaxconn = <span class="hljs-number"><span class="hljs-number">5120</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.netdev_max_backlog = <span class="hljs-number"><span class="hljs-number">50000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_tw_reuse = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_rmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">87380</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_wmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_slow_start_after_idle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_syn_backlog = <span class="hljs-number"><span class="hljs-number">30000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_tw_buckets = <span class="hljs-number"><span class="hljs-number">2000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fs</span></span>.file-max = <span class="hljs-number"><span class="hljs-number">196608</span></span> vm.overcommit_memory = <span class="hljs-number"><span class="hljs-number">1</span></span> vm.overcommit_ratio = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.max_map_count = <span class="hljs-number"><span class="hljs-number">65536</span></span> vm.dirty_ratio = <span class="hljs-number"><span class="hljs-number">40</span></span> vm.dirty_background_ratio = <span class="hljs-number"><span class="hljs-number">5</span></span> vm.dirty_expire_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.dirty_writeback_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_fin_timeout=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_congestion_control=htcp <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.netfilter.ip_conntrack_max=<span class="hljs-number"><span class="hljs-number">1048576</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.ip_local_port_range=<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">65535</span></span></code> </pre> <br><br>  Les principaux param√®tres qui ont subi un r√©glage sont la taille des tampons, le nombre de connexions r√©seau, le nombre de connexions au port et les connexions surveill√©es par les pare-feu, ainsi que les d√©lais d'expiration. <br><br>  <b>Cisco C3750 + LACP = douleur</b> <br>  Un autre √©cueil dans les performances du r√©seau est l'√©quilibrage de charge lors de l'utilisation de LACP / LAGp.  Malheureusement, les Cisco 3750 ne peuvent pas √©quilibrer la charge entre les ports, uniquement aux adresses source et de destination.  Pour obtenir un √©quilibrage du trafic correct, j'ai d√ª suspendre 12 adresses IP sur les interfaces de liaison des n≈ìuds de travail, en "regardant" vers les clients.  Conditionnellement, 3 pour chaque lien physique.  Avec cette configuration, il √©tait possible de se passer de LACP sur les interfaces "externes" des n≈ìuds de travail, puisque toutes les adresses sont sp√©cifi√©es dans la configuration Nginx, mais alors si le lien √©tait perdu, nous r√©duirions automatiquement le poids du n≈ìud dans l'√©quilibrage.  Avec le ¬´dump¬ª, le lien LACP vous permet de maintenir une accessibilit√© totale √† toutes les adresses. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2390824140</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">frame</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:947068357</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">carrier</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">collisions</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">txqueuelen</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18794424755066</span></span> (17<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TiB</span></span>)  <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:246433289523</span></span> (229<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">GiB</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XXMask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span></code> </pre> <br><br><br><h2>  Test fonctionnel </h2><br>  Apr√®s avoir termin√© le travail sur le r√©f√©rentiel, nous avons rencontr√© le service flexify.io.  Ils aident √† faciliter la migration entre diff√©rents magasins d'objets.  Mais pour devenir partenaire Flexify, vous devez passer des tests s√©rieux.  "Pourquoi pas?"  - nous avons pens√©.  Les tests tiers sont toujours une exp√©rience enrichissante. <br><br>  La t√¢che principale des tests est de v√©rifier le fonctionnement des m√©thodes du protocole S3 √† travers leurs proxys par rapport √† diverses configurations, parmi lesquelles il peut y avoir n'importe quel ensemble de compartiments compatibles S3 pris en charge par le fournisseur de services. <br><br>  Tout d'abord, les m√©thodes qui fonctionnent avec des objets dans le compartiment sont v√©rifi√©es.  Notre stockage a √©t√© test√© en utilisant un large √©ventail de donn√©es de test, le comportement des m√©thodes a √©t√© test√© pour des objets de diff√©rentes tailles et contenus, pour des cl√©s contenant toutes sortes de combinaisons de caract√®res Unicode. <br><br>  Lors de tests n√©gatifs, ils ont essay√© de transf√©rer des donn√©es invalides dans la mesure du possible.  Une attention particuli√®re a √©t√© accord√©e √† la s√©curit√© des donn√©es dans le processus. <br><br>  Des m√©thodes de travail avec des godets ont √©galement √©t√© test√©es, mais principalement dans des sc√©narios positifs.  L'objectif de ces tests √©tait de v√©rifier que l'utilisation de m√©thodes via un proxy n'entra√Æne pas de probl√®mes graves, par exemple une corruption des donn√©es ou des plantages. <br><br>  L'√©tendue de la couverture peut √™tre jug√©e par les tests qui ont √©t√© utilis√©s √† la fois par le biais de procurations et directement.  La plupart des tests, en particulier ceux qui fonctionnent avec des objets, sont param√©tr√©s et testent un grand nombre d'objets, de plages, etc. diff√©rents. <br><br><div class="spoiler">  <b class="spoiler_title">Tests impl√©ment√©s pour les objets</b> <div class="spoiler_text">  <i>Demande d'objet GET sans param√®tres facultatifs</i> <i><br></i>  <i>GET Objet multithread de demande</i> <i><br></i>  <i>Demande d'objet GET √† un objet chiffr√© avec les param√®tres sse fournis</i> <i><br></i>  <i>Demande d'objet GET √† un objet chiffr√© sans param√®tres sse fournis</i> <i><br></i>  <i>Demande d'objet GET avec une plage qui coupe la plage d'octets du fichier</i> <i><br></i>  <i>GET Requ√™te d'objet avec plage hors plage de plage d'octets du fichier</i> <i><br></i>  <i>Demande d'objet GET avec un param√®tre de plage de suffixe</i> <i><br></i>  <i>Demande d'objet GET avec un param√®tre de plage de suffixe hors de la plage d'octets du fichier</i> <i><br></i>  <i>GET Object request with invalid range parameter</i> <i><br></i>  <i>Demande d'objet principal √† un objet existant</i> <i><br></i>  <i>Demande d'objet principal √† un objet r√©cemment supprim√©</i> <i><br></i>  <i>Demande d'objet principal avec une cl√© qui n'a jamais exist√© dans un compartiment</i> <i><br></i>  <i>Demande d'objet principal √† un objet chiffr√© avec les param√®tres sse fournis</i> <i><br></i>  <i>Demande d'objet principal √† un objet chiffr√© sans param√®tres sse fournis</i> <i><br></i>  <i>Liste des demandes d'objets</i> <i><br></i>  <i>Liste des objets v2</i> <i><br></i>  <i>Liste des requ√™tes d'objets avec le param√®tre Marker fourni</i> <i><br></i>  <i>Liste des objets avec le param√®tre Prefix fourni</i> <i><br></i>  <i>Lister la demande d'objets avec les param√®tres de marqueur et de pr√©fixe fournis</i> <i><br></i>  <i>Recevez tous les objets sur le noeud final avec List Objects avec les param√®tres Marker et Prefix fournis</i> <i><br></i>  <i>Lister la demande d'objets avec le param√®tre Delimiter ignor√©</i> <i><br></i>  <i>Lister la demande d'objets avec le param√®tre Marker pass√©, mais avec le param√®tre Delimiter ignor√©</i> <i><br></i>  <i>Liste des objets avec le pr√©fixe non existant transmis</i> <i><br></i>  <i>Lister la demande d'objets avec un marqueur inexistant pass√©</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties avec la m√©thode native upload_file ()</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties avec la m√©thode native upload_fileobj ()</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties avec m√©thode personnalis√©e</i> <i><br></i>  <i>Arr√™t du t√©l√©chargement en plusieurs parties avec la m√©thode abort_multipart_upload ()</i> <i><br></i>  <i>Ex√©cution de la m√©thode abort_multipart_upload () avec uploadId incorrect</i> <i><br></i>  <i>Ex√©cution de la m√©thode abort_multipart_upload () avec une cl√© et un uploadId incorrects</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties de 2 fichiers avec la m√™me cl√© simultan√©ment.</i>  <i>2e fichier t√©l√©charg√© avant le 1er</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties de 2 fichiers avec la m√™me cl√© simultan√©ment.</i>  <i>1er fichier t√©l√©charg√© avant le 2√®me</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties de 2 fichiers avec des cl√©s diff√©rentes simultan√©ment.</i>  <i>1er fichier t√©l√©charg√© avant le 2√®me</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties avec une taille de pi√®ce de 512 Ko</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties avec une taille de pi√®ce sup√©rieure √† la taille maximale autoris√©e</i> <i><br></i>  <i>T√©l√©chargement en plusieurs parties d'un fichier avec des pi√®ces de tailles diff√©rentes</i> <i><br></i>  <i>R√©pertorier la demande de t√©l√©chargement en plusieurs parties</i> <i><br></i>  <i>PUT Object ACL request to an object with provided grantee id</i> <i><br></i>  <i>GET Object ACL request √† un objet avec des autorisations d'acc√®s suppl√©mentaires accord√©es</i> <i><br></i>  <i>M√©thode d'√©tiquetage d'objets PUT</i> <i><br></i>  <i>M√©thode de marquage d'objet GET</i> <i><br></i>  <i>DELETE Object Tagging, m√©thode</i> <i><br></i>  <i>PUT demande d'objet sans param√®tres facultatifs</i> <i><br></i>  <i>PUT Object demande un multithread</i> <i><br></i>  <i>PUT Object demandes avec des param√®tres de chiffrement facultatifs pass√©s</i> <i><br></i>  <i>PUT Object demandes avec param√®tre Body vide pass√©</i> <i><br></i>  <i>GET Object avec la m√©thode native download_file ()</i> <i><br></i>  <i>GET Object avec la m√©thode native download_fileobj ()</i> <i><br></i>  <i>GET Object avec une m√©thode personnalis√©e utilisant des plages</i> <i><br></i>  <i>GET Object avec pr√©fixe avec la m√©thode native download_file ()</i> <i><br></i>  <i>GET Object avec pr√©fixe avec la m√©thode native download_fileobj ()</i> <i><br></i>  <i>GET Object avec pr√©fixe avec m√©thode personnalis√©e utilisant des plages</i> <i><br></i>  <i>SUPPRIMER Demande d'objet √† un objet existant</i> <i><br></i>  <i>SUPPRIMER Demande d'objet √† un objet non existant</i> <i><br></i>  <i>SUPPRIMER Demande d'objets √† un groupe avec des objets existants</i> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Tests r√©alis√©s pour le godet</b> <div class="spoiler_text">  <i>Mettez le chiffrement du compartiment</i> <i><br></i>  <i>GET Bucket Encryption</i> <i><br></i>  <i>DELETE Bucket Encryption</i> <i><br></i>  <i>PUT Bucket Policy request</i> <i><br></i>  <i>GET Bucket Policy request to a bucket with Policy</i> <i><br></i>  <i>DELETE Bucket Policy request to a bucket with Policy</i> <i><br></i>  <i>GET Bucket Policy request to a bucket with no Policy</i> <i><br></i>  <i>DELETE Bucket Policy request to a bucket with no Policy</i> <i><br></i>  <i>Mettre le marquage du godet</i> <i><br></i>  <i>Obtenir le balisage du compartiment</i> <i><br></i>  <i>DELETE Bucket Tagging</i> <i><br></i>  <i>Cr√©er une demande de compartiment avec le nom de compartiment existant</i> <i><br></i>  <i>Cr√©er une demande de compartiment avec un nom de compartiment unique</i> <i><br></i>  <i>Supprimer la demande de compartiment avec le nom de compartiment existant</i> <i><br></i>  <i>Supprimer la demande de compartiment avec un nom de compartiment unique</i> <i><br></i>  <i>PUT Bucket ACL request to a bucket with provided grantee id</i> <i><br></i>  <i>GET Object ACL request √† un objet avec des autorisations d'acc√®s suppl√©mentaires accord√©es</i> <br></div></div><br><br>  Comme vous pouvez le deviner, il s'agit d'un test assez difficile, mais nous l'avons g√©n√©ralement r√©ussi de mani√®re positive.  Certains probl√®mes sont survenus en raison du manque de prise en charge de l'ESS et des petites √©coles avec prise en charge Unicode √† l'√©poque: <br><br>  √âchec du t√©l√©chargement avec des cl√©s contenant: <br><br><ul><li>  U + 0000-U + 001F - les 32 premiers caract√®res de contr√¥le illisibles.  Sur Amazon, par exemple, seul le premier U + 0000 n'est pas vers√© directement. <br></li></ul><br><ul><li>  Et aussi U + 18D7C, U + 18DA8, U + 18DB4, U + 18DBA, U + 18DC4, U + 18DCE.  Ce sont √©galement des caract√®res illisibles, mais Amazon les accepte comme cl√©s.  Il n'y a eu aucun probl√®me avec tous les autres personnages. <br></li></ul><br>  Lors de la lecture du contenu du compartiment, il y a un probl√®me sur la cl√© 66 675, qui contient le symbole U + FFFE.  Il n'est pas possible d'obtenir une liste compl√®te de cl√©s dans un compartiment contenant un objet avec une telle cl√©. <br><br>  Sinon, les tests ont r√©ussi, et fin septembre nous sommes apparus dans la liste des fournisseurs disponibles! <br><br><h2>  Une courte postface et un bonus pour les lecteurs </h2><br>  Plus t√¥t, j'ai √©crit que Cloudian HyperStore, malgr√© ses nombreux avantages, n'est pratiquement pas couvert dans le segment russophone d'Internet. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le premier article</a> portait sur les bases du travail avec Cloudian.  Nous avons d√©mont√© sa structure interne, ses nuances architecturales et lu la traduction de la documentation officielle. <br><br>  Aujourd'hui, j'ai racont√© comment nous avons construit notre propre stockage et quelles nuances et pi√®ges nous avons rencontr√©s. <br><br>  Ceux d'entre vous qui veulent toucher avec des stylos ce dont nous parlons 2 articles d'affil√©e peuvent utiliser le formulaire de r√©troaction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur cette page</a> et d√©couvrir personnellement ce qu'est le sel.  En standard, nous donnons 15 Go pendant 2 semaines gratuitement, bien s√ªr, avec un acc√®s utilisateur.  Si vous souhaitez partager vos impressions de travailler avec le r√©f√©rentiel, √©crivez-moi en PM.  :) <br><br>  Et pour ceux qui n'ont pas assez de 15 Go pendant 2 semaines, nous avons une <b>petite qu√™te!</b>  Dans les photographies de l'article, nous avons plac√© trois hippopotames.  Les 50 premi√®res personnes qui les trouveront recevront 30 Go pendant 4 semaines.  Pour obtenir un test agrandi, √©crivez dans les commentaires les num√©ros des photos o√π les hippopotames se sont cach√©s et demandez le lien ci-dessus.  N'oubliez pas d'inclure un lien vers votre commentaire dans l'application. <br><br>  Par tradition, si vous avez des questions, posez-les dans les commentaires. <br>  Je serai ravi d'y r√©pondre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425973/">https://habr.com/ru/post/fr425973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425963/index.html">Station m√©t√©o sur Arduino de A √† Z. Partie 4</a></li>
<li><a href="../fr425965/index.html">SAP Data Management Suite comme un complexe pour travailler avec le Big Data dans les entreprises</a></li>
<li><a href="../fr425967/index.html">Massacre √† la tron√ßonneuse au silicium</a></li>
<li><a href="../fr425969/index.html">Comment vais-je devenir d√©veloppeur web ... et le serai-je?</a></li>
<li><a href="../fr425971/index.html">Il existe des preuves de la pr√©sence de puces d'espionnage dans les serveurs Supermicro</a></li>
<li><a href="../fr425975/index.html">Convertir des mots et des phrases en anagramme</a></li>
<li><a href="../fr425977/index.html">Flexbox: quelle est la taille de cette bo√Æte flexible?</a></li>
<li><a href="../fr425981/index.html">Carri√®re de d√©butant √† LK: des bonds en avant pour progresser lentement</a></li>
<li><a href="../fr425983/index.html">S√©curit√© des vols</a></li>
<li><a href="../fr425985/index.html">Ex√©cution de code personnalis√© sur GO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>