<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçè üñäÔ∏è üïú Notes du fournisseur IoT. Activation et s√©curit√© dans LoraWAN üßîüèª üê¢ üôãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour chers amoureux de l'Internet des objets. Notes de continuation Fournisseur IoT. 
 La premi√®re partie > || > Deuxi√®me partie > || > Troisi√®me p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notes du fournisseur IoT. Activation et s√©curit√© dans LoraWAN</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413105/"><p>  Bonjour chers amoureux de l'Internet des objets.  Notes de continuation Fournisseur IoT. </p><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La premi√®re partie</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Deuxi√®me partie</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Troisi√®me partie</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La quatri√®me partie</a> <br><br><p>  Aujourd'hui, il est temps de parler de s√©curit√© chez LoRaWAN.  Il existe de nombreuses rumeurs et l√©gendes.  Nous allons essayer de comprendre comment cela fonctionne et quels sont les risques. <br><br>  Pour passer au sujet de la s√©curit√©, vous devrez faire une petite introduction et parler de l'initialisation initiale du module radio sur le r√©seau.  Ce processus dans LoRaWAN est appel√© activation. </p><br><p>  Par souci de concision, je vais √©num√©rer ci-dessous les termes dont nous avons besoin.  Si vous √™tes un peu confus, vous pouvez revenir ici et v√©rifier.  Vous devez probablement revenir, car  les abr√©viations de nombreux termes sont tr√®s similaires.  De plus, dans cette description, je donnerai des analogies afin que vous compreniez √† peu pr√®s √† quoi tel ou tel terme peut √™tre compar√©.  Il n'est pas toujours possible de s√©lectionner des analogies exactes, veuillez donc ne pas juger cette colonne trop strictement. </p><br><img src="https://habrastorage.org/webt/z4/v-/68/z4v-68a8ov1o-2rz2chxuprmpto.png"><br><a name="habracut"></a><p>  Ainsi, l'activation dans LoRaWAN peut se faire par voie a√©rienne (OTAA), ou par pr√©r√©glage (ABP). </p><br><h2>  OTAA (activation en direct) </h2><br><p>  En cas d'activation par air, trois param√®tres doivent √™tre r√©gl√©s sur notre module radio.  Son identifiant unique (DevEUI), son identifiant de serveur (AppEUI) et sa cl√© de serveur (AppKey). </p><br><p>  C√¥t√© serveur, l'identifiant du module radio, l'identifiant du serveur et la cl√© doivent √©galement √™tre enregistr√©s.  C'est-√†-dire  le serveur doit d'abord conna√Ætre le p√©riph√©rique qui tentera de le rejoindre.  Si nous connaissons les identifiants et les cl√©s du serveur, mais que notre DevEUI n'est pas enregistr√© dans sa base de donn√©es, la connexion √©chouera. </p><br><p>  Lors de la mise sous tension initiale, la radio envoie le paquet join_request en ondes √† l'une des trois fr√©quences de jonction pr√©d√©finies.  Avec ce forfait, il demande s'il existe un r√©seau √† proximit√© qui le ¬´reconna√Ætra¬ª.  Voici la composition du package join_request.  Comme vous pouvez le voir, il contient les tr√®s DevEUI et AppEUI, ainsi que DevNonce. </p><br><img src="https://habrastorage.org/webt/6p/gh/kd/6pghkd5kbylskdzbcasmwylqdnq.png"><br><p>  DevNonce est une variable al√©atoire.  Le serveur le stocke en m√©moire pendant un certain temps et si join_request arrive avec le m√™me DevNonce que l'un des pr√©c√©dents, le serveur ignorera cette demande.  Il s'agit de se prot√©ger contre une attaque r√©p√©t√©e lorsqu'un attaquant peut √©crire une demande d'activation puis la r√©p√©ter depuis son appareil.  Soit dit en passant, toutes les normes IoT ne peuvent pas se vanter d'une protection contre cette attaque. </p><br><p>  AppKey n'est pas directement utilis√© dans ce message, mais √† travers lui, la somme de contr√¥le MIC √† la fin de la trame est consid√©r√©e. <br>  Nous aurons besoin de cette cl√© un peu plus loin, dans le message de r√©ponse du serveur join_accept. </p><br><p>  Join_request est transmise non chiffr√©e. </p><br><p>  Join_accept sera re√ßu si le serveur conna√Æt AppEUI et DevEUI, ainsi qu'il n'y a pas de correspondance dans le champ DevNonce et qu'il n'y a aucun probl√®me avec le MIC.  Sinon, il n'y aura pas de r√©ponse. Si toutes les v√©rifications sont r√©ussies, le serveur g√©n√®re un message de r√©ponse join_accept.  Sa composition est montr√©e dans l'image ci-dessous. </p><br><img src="https://habrastorage.org/webt/w7/tv/j7/w7tvj7iwfjeynonywqmtqlrwmac.png"><br><p>  En fait, deux cl√©s de session sont g√©n√©r√©es - le serveur r√©seau (NwkSKey) et le serveur d'applications (AppSKey).  Ces cl√©s ainsi que d'autres informations sont crypt√©es par AppKey et envoy√©es au module radio.  De plus, tous les messages se produisent avec un double chiffrement avec des cl√©s de session (√† l'exception des paquets avec des commandes MAC, ils ne sont pas chiffr√©s avec la cl√© du serveur d'applications).  NwkSKey ne participe pas au chiffrement de paquets uniquement avec des donn√©es (sans commandes), mais une somme de contr√¥le est consid√©r√©e √† travers elle. <br>  NwkSkey et AppSKey sont uniques √† chaque module radio individuel. </p><br><p>  Deux cl√©s sont utilis√©es pour une protection suppl√©mentaire des informations.  Chaque fois qu'un paquet du module radio arrive dans notre syst√®me, il sera partiellement chiffr√© pour le serveur r√©seau et partiellement pour le serveur d'applications.  C'est-√†-dire  le serveur r√©seau ne pourra d√©crypter que les messages qui lui sont adress√©s (divers messages de service).  Le serveur d'applications ne verra que le composant utile des paquets (en fait, les donn√©es transmises).  Cela est n√©cessaire car le serveur r√©seau avec une probabilit√© de 99% sera chez le fournisseur.  Mais le serveur d'applications peut tr√®s bien √™tre h√©berg√© par le client.  Le double chiffrement rend difficile pour le fournisseur de d√©couvrir le contenu du paquet. </p><br><p>  En plus des deux cl√©s, il y a une autre chose importante √† join_accept sur OTAA - la liste de fr√©quences √©tendue (CFList).  Permettez-moi de vous rappeler qu'au d√©part, un module radio ne conna√Æt que trois fr√©quences auxquelles il peut fonctionner.  Apr√®s l'activation, des fr√©quences suppl√©mentaires sont enregistr√©es pour qu'il puisse communiquer. <br><br>  C'est tr√®s pratique si on ne sait pas exactement dans quel r√©seau l'appareil fonctionnera.  Nous pouvons convenir que dans tous les r√©seaux, 3 fr√©quences (+ RX2) co√Øncideront toujours, et les cinq autres sont √† la discr√©tion du fournisseur. <br><br>  De plus, pour l'avenir, pour travailler avec un grand nombre d'appareils CFList peut √™tre utilis√© pour le clustering <br><br>  C'est lorsque vous divisez le r√©seau en grappes et qu'au sein des grappes, il y a une planification des fr√©quences.  Disons que notre module radio conna√Æt les trois fr√©quences F1, F2 et F3.  Il s'active √† l'une des fr√©quences et s'il se trouve dans le cluster1, il re√ßoit alors une table de fr√©quences suppl√©mentaire sous la forme de F4-1, F5-1 et F6-1.  Pour le cluster 2, il obtiendra des F4-2, F5-2, F6-2 compl√®tement diff√©rents.  En m√™me temps, nous pouvons configurer tous les modules radio de la m√™me mani√®re et ne pas vraiment penser lequel tombera dans quel cluster.  Et dans les grappes voisines, la probabilit√© de collisions diminuera fortement. </p><br><h2>  ABP (Activation par personnalisation) </h2><br><p>  Une proc√©dure simplifi√©e lorsque les cl√©s de session sont imm√©diatement c√¢bl√©es dans le module radio et sont initialement enregistr√©es c√¥t√© serveur.  Pratique dans la mesure o√π vous n'avez pas besoin d'activer, le module radio est imm√©diatement pr√™t √† l'emploi.  Rien de plus pratique, car  la s√©curit√© dans ce cas est moyenne.  De plus, vous ne pouvez pas extraire les fr√©quences du serveur.  Je n'ai jamais vu de cas d'utilisation r√©elle.  Nous n'en tiendrons pas compte et tout ce qui suit concerne l'OTAA. </p><br><h2>  Et la s√©curit√©? </h2><br><p>  Donc, en substance, nous avons la charge de chiffrement principale sur les cl√©s de session du serveur r√©seau et du serveur d'applications. <br><br>  Consid√©rez-les un peu plus attentivement. </p><br><p>  La principale plainte des critiques de la norme LoRaWAN est que lorsque l'appareil est activ√© sur le r√©seau, nous avons deux cl√©s, qui peuvent ensuite rester inchang√©es pendant des mois.  Plus pr√©cis√©ment, ils peuvent ne pas changer pendant des ann√©es jusqu'√† ce que l'appareil soit r√©activ√©.  Dans des conditions normales, nous avons activ√© et oubli√© le module radio, donc une dur√©e de vie cl√© de trois √† quatre ans est une perspective tr√®s r√©aliste.  En fait, de l'installation √† laisser la batterie √† z√©ro. <br>  Quelle est la fiabilit√© de nos cl√©s? </p><br><p>  La sp√©cification indique qu'ils sont conformes √† la myst√©rieuse RFC4493. <br>  Qu'est ce que c'est  Il s'agit d'un algorithme de chiffrement, mieux connu sous le nom d'AES-CMAC. <br><br>  Ne rampons pas dans les d√©cors de la cryptographie et limitons-nous √† une compr√©hension commune de l'image.  Il est pr√©sent√© dans la figure ci-dessous. </p><br><img src="https://habrastorage.org/webt/kv/zs/7k/kvzs7k4joixbwltc1wkfxkpmotw.png"><br><p>  Le principe d'AES-CMAC est approximativement le suivant: le message chiffr√© est divis√© en blocs de 128 bits.  Chaque bloc est chiffr√© s√©par√©ment avec une cl√© AES.  De plus, lors du chiffrement du deuxi√®me bloc, en plus de la cl√©, le r√©sultat de chiffrement du premier est utilis√©.  Et lors du cryptage du troisi√®me - le r√©sultat du second et (indirectement) du premier.  Une telle cha√Æne de complications. </p><br><p>  Quelle est la fiabilit√© de ce principe? </p><br><p>  Tr√®s fiable.  L'algorithme est sorti il ‚Äã‚Äãy a plus de dix ans.  Depuis lors, il a √©t√© attaqu√© par de nombreuses attaques diff√©rentes, et finalement, en th√©orie, elles ont prouv√© qu'il peut √™tre pirat√©. Le probl√®me est qu'un grand √©chantillon de paquets, plusieurs milliers, sera n√©cessaire pour le casser.  Ensuite, il est possible de comprendre ce qui se trouve √† l'int√©rieur des blocs crypt√©s. </p><br><p>  Un attaquant disposant des connaissances n√©cessaires peut-il obtenir cet exemple si nous parlons d'intercepter des paquets LoRaWAN?  Estimons.  Laissez les colis partir une fois par heure.  Dans un mois, 720 paquets iront du module radio.  Pas assez. <br><br>  Pour une menace r√©elle, nous avons besoin d'un patient tr√®s patient qui r√©digera des colis pendant des mois.  Et ce n'est pas un fait qu'il peut encore casser l'algorithme et obtenir les cl√©s pr√©cieuses.  N'oubliez pas qu'une telle patience devra √™tre d√©montr√©e pour chaque module radio s√©par√©ment.  Et rappelez-vous que l'envoi de paquets une fois par heure est TR√àS souvent.  Dans la pratique, les intervalles sont beaucoup plus longs - six heures, voire une journ√©e. </p><br><p>  Mais m√™me cette opportunit√© fantomatique est d√©sormais ferm√©e apr√®s la publication de la sp√©cification 1.1, o√π les commandes de r√©activation et de connexion au serveur sont impl√©ment√©es.  Parlons en quelque sorte de cette sp√©cification.  Pour l'instant, je me souviens de ma pens√©e de l'article pr√©c√©dent: lorsque le standard est ouvert et qu'il a une communaut√©, tous ses trous sont visibles.  Pendant la mise √† niveau, les d√©veloppeurs savent exactement quoi regarder en premier. </p><br><p>  En cons√©quence, nous comprenons que la menace pour la s√©curit√© est plut√¥t illusoire.  Quelque part dans la th√©orie profonde, le piratage peut √™tre fait, mais dans la pratique, il n'est pratiquement pas r√©aliste.  Maintenant, multipliez par la valeur des informations re√ßues.  Notre attaquant va-t-il commencer √† √©crire des paquets pendant des mois pour trouver le compteur?  Peu probable. <br><br>  LoRaWAN r√©pond √† ce rapport qualit√©-prix raisonnable.  Nous comprenons que la protection peut √™tre am√©lior√©e.  Mais c'est la puissance de calcul de la fin, c'est une charge suppl√©mentaire sur la batterie, il est possible d'augmenter la taille des paquets ou de r√©duire la charge utile. <br><br>  Pour moi, c‚Äôest plus qu‚Äôune t√¢che de t√©l√©m√©trie. </p><br><p>  Dans les commentaires, je serai heureux d'entendre mes adversaires et partisans.  N'oubliez pas que le sujet de la s√©curit√© n√©cessite toujours une discussion et ne doit jamais reposer sur l'opinion d'une seule personne. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413105/">https://habr.com/ru/post/fr413105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413095/index.html">Application des technologies de r√©seau neuronal: d√©veloppement de logiciels</a></li>
<li><a href="../fr413097/index.html">Bas√© sur un logiciel de niveau entreprise, test√© des millions de fois: openSUSE Leap 15 est sorti</a></li>
<li><a href="../fr413099/index.html">Ram de downclocking sur macbook</a></li>
<li><a href="../fr413101/index.html">Carte de d√©bogage STM32F4 dans le facteur de forme Raspberry Pi</a></li>
<li><a href="../fr413103/index.html">3CX v15.5 Update 5 Int√©gration b√™ta et REST avec AmoCRM publi√©</a></li>
<li><a href="../fr413107/index.html">Traduction du wiki du projet Svelto.ECS. Cadre ECS pour Unity3D</a></li>
<li><a href="../fr413109/index.html">Comment cr√©er une plate-forme d'int√©gration de produits SaaS: exp√©rience de v√©rification d'affiches</a></li>
<li><a href="../fr413111/index.html">STM32 + NetBeans =?</a></li>
<li><a href="../fr413113/index.html">Prise en charge de la s√©rialisation JavaScript de classe JavaScript</a></li>
<li><a href="../fr413117/index.html">Comment programmer en toute s√©curit√© dans bash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>