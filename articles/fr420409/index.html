<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßë‚Äçü§ù‚Äçüßë üö± üò∑ Apprenez OpenGL. Le√ßon 5.7 - HDR üñ±Ô∏è üç° ‚ûï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de l'√©criture dans le tampon d'image, les valeurs de la luminosit√© des couleurs sont r√©duites √† l'intervalle de 0,0 √† 1,0. Pour cette raison, √† p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprenez OpenGL. Le√ßon 5.7 - HDR</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420409/"><img src="https://habrastorage.org/getpro/habr/post_images/20f/e6a/5f3/20fe6a5f38cfacad9ea8355ca097e8f4.png" width="200" align="left"><br><p>  Lors de l'√©criture dans le tampon d'image, les valeurs de la luminosit√© des couleurs sont r√©duites √† l'intervalle de 0,0 √† 1,0.  Pour cette raison, √† premi√®re vue inoffensif, nous devons toujours choisir des valeurs d'√©clairage et de couleurs qui correspondent √† cette restriction.  Cette approche fonctionne et donne des r√©sultats d√©cents, mais que se passe-t-il si nous rencontrons une zone particuli√®rement lumineuse avec beaucoup de sources de lumi√®re vive et que la luminosit√© totale d√©passe 1,0?  Par cons√©quent, toutes les valeurs sup√©rieures √† 1,0 seront converties en 1,0, ce qui n'est pas tr√®s joli: </p><br><p><img src="https://habrastorage.org/webt/cd/0m/ir/cd0mir8t9qcbakfwldnjibj3ay0.png"></p><br><p>  √âtant donn√© que les valeurs de couleur sont r√©duites √† 1,0 pour un grand nombre de fragments, de grandes zones de l'image sont remplies de la m√™me couleur blanche, un nombre important de d√©tails de l'image sont perdus et l'image elle-m√™me commence √† para√Ætre anormale. </p><br><p>  La solution √† ce probl√®me peut √™tre de r√©duire la luminosit√© des sources lumineuses afin qu'il n'y ait pas de fragments plus lumineux que 1.0 sur la sc√®ne: ce n'est pas la meilleure solution, ce qui oblige √† utiliser des valeurs d'√©clairage irr√©alistes.  La meilleure approche consiste √† permettre aux valeurs de luminosit√© de d√©passer temporairement la luminosit√© de 1,0 et √† l'√©tape finale de changer les couleurs afin que la luminosit√© revienne dans la plage de 0,0 √† 1,0, mais sans perte de d√©tails de l'image. </p><br><p>  L'√©cran de l'ordinateur est capable d'afficher des couleurs avec une luminosit√© allant de 0,0 √† 1,0, mais nous n'avons pas une telle limitation lors du calcul de l'√©clairage.  En permettant aux couleurs du fragment d'√™tre plus lumineuses que l'unit√©, nous obtenons une plage de luminosit√© beaucoup plus √©lev√©e pour le travail - HDR <em>(plage dynamique √©lev√©e)</em> .  Avec hdr, les choses brillantes paraissent brillantes, les choses sombres peuvent √™tre vraiment sombres, et ce faisant, nous verrons les d√©tails. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><p>  Partie 1. Pour commencer <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Opengl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ation de fen√™tres</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bonjour fen√™tre</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bonjour triangle</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Shaders</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Textures</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transformations</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Syst√®mes de coordonn√©es</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Appareil photo</a> </li></ol><br><p>  Partie 2. √âclairage de base <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les couleurs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bases d'√©clairage</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mat√©riaux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cartes de texture</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources lumineuses</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources d'√©clairage multiples</a> </li></ol><br><p>  Partie 3. T√©l√©charger des mod√®les 3D <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Biblioth√®que Assimp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Classe de polygone de maillage</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Classe de mod√®le 3D</a> </li></ol><br><p>  Partie 4. Fonctionnalit√©s avanc√©es d'OpenGL <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Test de profondeur</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Test au pochoir</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">M√©lange de couleurs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Couper les visages</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tampon de trame</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cartes cubiques</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Traitement avanc√© des donn√©es</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GLSL avanc√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Shader g√©om√©trique</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instanciation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lissage</a> </li></ol><br><p>  Partie 5. √âclairage avanc√© <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âclairage avanc√©.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mod√®le Blinn-Fong.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Correction gamma</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cartes fant√¥mes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cartes ombr√©es omnidirectionnelles</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cartographie normale</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mappage de parallaxe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HDR</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bloom</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rendu diff√©r√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSAO</a> </li></ol><br><p>  Partie 6. PBR <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Th√©orie</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources de lumi√®re analytiques</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Irradiation diffuse.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exposition miroir.</a> </li></ol></div></div><br><p>  Initialement, une plage dynamique √©lev√©e √©tait utilis√©e en photographie: le photographe a pris plusieurs photographies identiques de la sc√®ne avec diff√©rentes expositions, capturant des couleurs de presque n'importe quelle luminosit√©.  La combinaison de ces photos forme une image hdr dans laquelle la plupart des d√©tails deviennent visibles en raison de la combinaison d'images avec diff√©rentes pertes d'exposition.  Par exemple, ci-dessous sur l'image de gauche, des fragments fortement √©clair√©s de l'image sont clairement visibles (regardez la fen√™tre), mais ces d√©tails disparaissent lorsque vous utilisez une exposition √©lev√©e.  Cependant, l'exposition √©lev√©e rend les d√©tails sur les zones sombres de l'image qui n'√©taient pas visibles auparavant. </p><br><p><img src="https://habrastorage.org/webt/hh/-0/0h/hh-00hpoeday-yolbntasroul14.png"></p><br><p>  Ceci est similaire au fonctionnement de l'≈ìil humain.  Avec un manque de lumi√®re, l'≈ìil s'adapte, de sorte que les d√©tails sombres deviennent clairement visibles, et de m√™me pour les zones claires.  On peut dire que l'≈ìil humain dispose d'un contr√¥le d'exposition automatique, en fonction de la luminosit√© de la sc√®ne. </p><br><p>  Le rendu HDR fonctionne de la m√™me mani√®re.  Nous autorisons lors du rendu √† utiliser une large plage de valeurs de luminosit√© pour collecter des informations sur les d√©tails clairs et sombres de la sc√®ne, et √† la fin, nous reconvertirons les valeurs de la plage HDR en LDR (faible plage dynamique, plage de 0 √† 1).  Cette transformation est appel√©e <em>cartographie des tons</em> , il existe un grand nombre d'algorithmes visant √† conserver la plupart des d√©tails de l'image lors de la conversion en LDR.  Ces algorithmes ont souvent un param√®tre d'exposition qui leur permet de mieux montrer les zones claires ou sombres de l'image. </p><br><p>  L'utilisation du HDR lors du rendu nous permet non seulement de d√©passer la plage LDR de 0 √† 1 et d'enregistrer plus de d√©tails sur l'image, mais permet √©galement d'indiquer la luminosit√© r√©elle des sources lumineuses.  Par exemple, le soleil a une luminosit√© beaucoup plus grande que quelque chose comme une lampe de poche, alors pourquoi ne pas r√©gler le soleil sur cela (par exemple, lui donner une luminosit√© de 10,0)?  Cela nous permettra de mieux r√©gler l'√©clairage de la sc√®ne avec des param√®tres de luminosit√© plus r√©alistes, ce qui serait impossible avec un rendu LDR et une plage de luminosit√© de 0 √† 1. </p><br><p>  √âtant donn√© que l'affichage n'affiche une luminosit√© que de 0 √† 1, nous sommes oblig√©s de reconvertir la plage de valeurs HDR utilis√©e en plage du moniteur.  Une simple mise √† l'√©chelle de la plage ne sera pas une bonne solution, car les zones claires commenceront √† dominer l'image.  Cependant, nous pouvons utiliser diverses √©quations ou courbes pour convertir les valeurs HDR en LDR, ce qui nous donnera un contr√¥le total sur la luminosit√© de la sc√®ne.  Cette transformation est appel√©e <em>mappage des tons</em> et est la derni√®re √©tape du rendu HDR. </p><br><h3 id="freymbufery-s-plavayuschey-tochkoy">  Tampons de cadre √† virgule flottante </h3><br><p>  Pour impl√©menter le rendu HDR, nous avons besoin d'un moyen d'emp√™cher les valeurs d'√™tre port√©es √† une plage de 0 √† 1 √† partir du shader de fragment.  Si le tampon d'images utilise le format √† virgule fixe normalis√© (GL_RGB) pour les tampons de couleurs, OpenGL limite automatiquement les valeurs avant de les enregistrer dans le tampon d'images.  Cette restriction s'applique √† la plupart des formats de tampon d'image, √† l'exception des formats √† virgule flottante. </p><br><p> Pour stocker des valeurs qui se trouvent en dehors de la plage [0.0..1.0], nous pouvons utiliser un tampon de couleur avec les formats suivants: <code>GL_RGB16F, GL_RGBA16F, GL_RGB32F or GL_RGBA32F</code> .  C'est g√©nial pour le rendu hdr.  Un tel tampon sera appel√© tampon de trame √† virgule flottante. </p><br><p>  La cr√©ation d'un tampon √† virgule flottante diff√®re d'un tampon standard uniquement en ce qu'il utilise un format interne diff√©rent: </p><br><pre> <code class="plaintext hljs">glBindTexture(GL_TEXTURE_2D, colorBuffer); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA16F, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGBA, GL_FLOAT, NULL);</code> </pre> <br><p>  Le framebuffer OpenGL utilise par d√©faut seulement 8 bits pour stocker chaque couleur.  Dans le tampon d' <code>GL_RGB32F</code> √† <code>GL_RGB32F</code> <code>GL_RGBA32F</code> formats <code>GL_RGB32F</code> ou <code>GL_RGBA32F</code> , 32 bits sont utilis√©s pour stocker chaque couleur - 4 fois plus.  Si une pr√©cision tr√®s √©lev√©e n'est pas requise, le format <code>GL_RGBA16F</code> sera tout √† fait suffisant. </p><br><p>  Si un tampon √† virgule flottante est attach√© au tampon de trame pour la couleur, nous pouvons y rendre la sc√®ne en tenant compte du fait que les valeurs de couleur ne seront pas limit√©es √† la plage de 0 √† 1. Dans le code de cet article, nous rendons d'abord la sc√®ne au tampon de trame √† virgule flottante, puis afficher le contenu tampons de couleur sur un rectangle demi-√©cran.  Cela ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">glBindFramebuffer(GL_FRAMEBUFFER, hdrFBO); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // [...]    hdr glBindFramebuffer(GL_FRAMEBUFFER, 0); //  hdr    2     hdrShader.use(); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_2D, hdrColorBufferTexture); RenderQuad();</code> </pre> <br><p>  Ici, les valeurs de couleur contenues dans le tampon de couleur peuvent √™tre sup√©rieures √† 1. Pour cet article, une sc√®ne a √©t√© cr√©√©e avec un grand cube allong√© qui ressemble √† un tunnel avec quatre sources lumineuses ponctuelles, l'une d'entre elles est situ√©e √† l'extr√©mit√© du tunnel et a une grande luminosit√©. </p><br><pre> <code class="plaintext hljs">std::vector&lt;glm::vec3&gt; lightColors; lightColors.push_back(glm::vec3(200.0f, 200.0f, 200.0f)); lightColors.push_back(glm::vec3(0.1f, 0.0f, 0.0f)); lightColors.push_back(glm::vec3(0.0f, 0.0f, 0.2f)); lightColors.push_back(glm::vec3(0.0f, 0.1f, 0.0f));</code> </pre> <br><p>  Le rendu dans le tampon √† virgule flottante est exactement le m√™me que si nous rendions la sc√®ne dans un tampon d'images normal.  La seule nouveaut√© est le shader hdr fragment√©, qui traite de l'ombrage simple d'un rectangle plein √©cran avec les valeurs d'une texture, qui est un tampon de couleurs √† virgule flottante.  Pour commencer, √©crivons un shader simple qui transf√®re les donn√©es d'entr√©e inchang√©es: </p><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec2 TexCoords; uniform sampler2D hdrBuffer; void main() { vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; FragColor = vec4(hdrColor, 1.0); }</code> </pre> <br><p>  Nous prenons l'entr√©e de la virgule flottante du tampon de couleur et nous l'utilisons comme valeur de sortie du shader.  Cependant, √©tant donn√© que le rectangle 2D est rendu dans le framebuffer par d√©faut, les valeurs de sortie du shader seront limit√©es √† un intervalle de 0 √† 1, malgr√© le fait qu'√† certains endroits, les valeurs sont sup√©rieures √† 1. </p><br><p><img src="https://habrastorage.org/webt/rw/mb/ds/rwmbdsi_qc8fjdssulhqwwzk3rg.png"></p><br><p>  Il devient √©vident que des valeurs de couleur trop grandes √† la fin du tunnel sont limit√©es √† l'unit√©, car une partie importante de l'image est compl√®tement blanche et nous perdons des d√©tails d'image plus brillants que l'unit√©.  Puisque nous utilisons les valeurs HDR directement en tant que LDR, cela √©quivaut √† ne pas avoir de HDR.  Pour r√©soudre ce probl√®me, nous devons afficher les diff√©rentes valeurs de couleur dans la plage de 0 √† 1 sans perdre aucun d√©tail dans l'image.  Pour ce faire, appliquez une compression tonale. </p><br><h3 id="tonalnaya-kompressiya">  Compression de tonalit√© </h3><br><p>  La compression des tons est la conversion des valeurs de couleur pour les adapter dans la plage de 0 √† 1 sans perdre les d√©tails de l'image, souvent en combinaison avec donner √† l'image la balance des blancs souhait√©e. </p><br><p>  L'algorithme de <em>mappage de tons le</em> plus simple est connu sous le nom d'algorithme de <em>mappage de tons Reinhard</em> .  Il affiche toutes les valeurs HDR dans la plage LDR.  Ajoutez cet algorithme au shader de fragment pr√©c√©dent et appliquez √©galement la correction gamma (et l'utilisation de textures SRGB). </p><br><pre> <code class="plaintext hljs">void main() { const float gamma = 2.2; vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; //   vec3 mapped = hdrColor / (hdrColor + vec3(1.0)); // - mapped = pow(mapped, vec3(1.0 / gamma)); FragColor = vec4(mapped, 1.0); }</code> </pre> <br><blockquote>  Remarque  trans.  - pour les petites valeurs de x, la fonction x / (1 + x) se comporte approximativement comme x, pour les grands x elle tend vers l'unit√©.  Graphique de fonction: </blockquote><p><img src="https://habrastorage.org/webt/sz/oq/ao/szoqaojobtfzh5_m5htgu_nh2_y.png"></p><br><p>  Avec la compression de tonalit√© Reinhardt, nous ne perdons plus de d√©tails dans les zones claires de l'image.  L'algorithme pr√©f√®re les zones claires, rendant les zones sombres moins distinctes. </p><br><p><img src="https://habrastorage.org/webt/jm/um/3c/jmum3cplqvaaqwhh96nzrrlhuc4.png"></p><br><p>  Ici, vous pouvez √† nouveau voir les d√©tails √† la fin de l'image, tels que la texture du bois.  Avec cet algorithme relativement simple, nous pouvons voir clairement toutes les couleurs de la gamme HDR et pouvons contr√¥ler l'√©clairage de la sc√®ne sans perdre les d√©tails de l'image. </p><br><blockquote>  Il convient de noter que nous pouvons utiliser la compression tonale directement √† la fin de notre shader pour calculer l'√©clairage, et nous n'avons alors pas du tout besoin d'un tampon de trame √† virgule flottante.  Cependant, dans les sc√®nes plus complexes, vous rencontrerez souvent la n√©cessit√© de stocker des valeurs HDR interm√©diaires dans des tampons √† virgule flottante, donc cela vous sera utile. </blockquote><p>  Une autre caract√©ristique int√©ressante de la compression de tonalit√© est l'utilisation d'un param√®tre d'exposition.  Vous vous souvenez peut-√™tre que dans les images au d√©but de l'article, divers d√©tails √©taient visibles √† diff√©rentes valeurs d'exposition.  Si nous avons une sc√®ne dans laquelle le jour et la nuit changent, il est logique d'utiliser une faible exposition pendant la journ√©e et haute la nuit, ce qui est similaire √† l'adaptation de l'≈ìil humain.  Avec ce param√®tre d'exposition, nous pouvons configurer des param√®tres d'√©clairage qui fonctionneront jour et nuit dans diff√©rentes conditions d'√©clairage. </p><br><p>  Un algorithme de compression tonale relativement simple avec exposition ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">uniform float exposure; void main() { const float gamma = 2.2; vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; //     vec3 mapped = vec3(1.0) - exp(-hdrColor * exposure); // - mapped = pow(mapped, vec3(1.0 / gamma)); FragColor = vec4(mapped, 1.0); }</code> </pre> <br><blockquote>  Remarque  par: ajouter un graphique pour cette fonction avec les expositions 1 et 2: </blockquote><p><img src="https://habrastorage.org/webt/3j/fj/zi/3jfjzibpldumgonxyhin6ydi-ao.png"></p><br><p>  Ici, nous avons d√©fini une variable pour l'exposition, qui est 1 par d√©faut et nous permet de choisir plus pr√©cis√©ment l'√©quilibre entre la qualit√© d'affichage des zones sombres et lumineuses de l'image.  Par exemple, avec une grande exposition, nous voyons beaucoup plus de d√©tails dans les zones sombres de l'image.  √Ä l'inverse, une faible exposition rend les zones sombres indiscernables, mais vous permet de mieux voir les zones claires de l'image.  Ci-dessous sont des images d'un tunnel avec diff√©rents niveaux d'exposition. </p><br><p><img src="https://habrastorage.org/webt/ae/kx/vf/aekxvfxdggv34kzeqcoxy9tjdps.png"></p><br><p>  Ces images montrent clairement les avantages du rendu hdr.  √Ä mesure que le niveau d'exposition change, nous voyons plus de d√©tails de la sc√®ne qui seraient perdus dans le rendu normal.  Prenons l'exemple du bout du tunnel - avec une exposition normale, la texture de l'arbre est √† peine visible, mais avec une exposition faible, la texture est parfaitement visible.  De m√™me, √† forte exposition, les d√©tails dans les zones sombres sont tr√®s clairement visibles. </p><br><p>  Le code source de la d√©mo est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici.</a> </p><br><h3 id="bolshe-hdr">  Plus de HDR </h3><br><p>  Ces deux algorithmes de compression de tonalit√© qui ont √©t√© montr√©s ne sont qu'une petite partie parmi un grand nombre d'algorithmes plus avanc√©s, chacun ayant ses propres forces et faiblesses.  Certains algorithmes mettent mieux en valeur certaines couleurs / luminosit√©s, certains algorithmes montrent des zones sombres et lumineuses en m√™me temps, donnant des images plus color√©es et plus d√©taill√©es.  Il existe √©galement de nombreuses m√©thodes connues sous le nom <em>d'ajustement automatique de l'exposition</em> ou d' <em>adaptation oculaire</em> .  Ils d√©terminent la luminosit√© de la sc√®ne dans l'image pr√©c√©dente et modifient (lentement) le param√®tre d'exposition, de sorte que la sc√®ne sombre devient lentement plus lumineuse et la lumi√®re - plus sombre: semblable √† l'habituation de l'≈ìil humain. </p><br><p>  Les avantages r√©els du HDR sont mieux visibles sur les sc√®nes grandes et complexes avec des algorithmes d'√©clairage s√©rieux.  √Ä des fins de formation, cet article a utilis√© la sc√®ne la plus simple possible, car la cr√©ation d'une grande sc√®ne peut √™tre difficile.  Malgr√© la simplicit√© de la sc√®ne, certains avantages du rendu hdr sont visibles: dans les zones sombres et lumineuses de l'image, les d√©tails ne sont pas perdus, car ils sont enregistr√©s √† l'aide de la compression des tons, l'ajout de plusieurs sources de lumi√®re n'entra√Æne pas l'apparition de zones blanches et les valeurs n'ont pas √† tenir dans LDR gamme. </p><br><p>  De plus, le rendu HDR rend √©galement certains effets int√©ressants plus cr√©dibles et r√©alistes.  L'un de ces effets est la floraison, dont nous parlerons dans un prochain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> . </p><br><h3 id="dopolnitelnye-resursy">  Ressources suppl√©mentaires: </h3><br><ul><li>  Une question d'√©change de pile avec une tr√®s longue r√©ponse qui d√©crit certains des avantages du rendu HDR: le rendu HDR a- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t-il des avantages si la floraison n'est pas appliqu√©e?</a> </li><li>  Une autre r√©ponse int√©ressante avec de bonnes images comme exemples de compression tonale.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que le mappage de tons?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment est-ce li√© au HDR?</a> </li></ul><br><p>  <strong>PS</strong> Nous avons un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©gramme conf</a> pour la coordination des transferts.  Si vous avez un s√©rieux d√©sir d'aider √† la traduction, alors vous √™tes les bienvenus! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420409/">https://habr.com/ru/post/fr420409/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420393/index.html">PHP, YII2 et la formation de gros fichiers Excel</a></li>
<li><a href="../fr420395/index.html">Tablettes "gratuites" pour les d√©tenus - pas du tout gratuites</a></li>
<li><a href="../fr420397/index.html">Les scientifiques ont trouv√© un moyen d'inverser le processus de vieillissement des cellules</a></li>
<li><a href="../fr420405/index.html">Recherche sur le processus de vente informatique</a></li>
<li><a href="../fr420407/index.html">C n'est pas un langage de bas niveau</a></li>
<li><a href="../fr420413/index.html">SQLite et NW.js - instructions pas √† pas pour cr√©er des amiti√©s solides</a></li>
<li><a href="../fr420415/index.html">Tout ce que vous vouliez savoir sur les tests d'adaptateurs Wi-Fi, mais aviez peur de demander</a></li>
<li><a href="../fr420419/index.html">Coureurs pour ceux qui aiment l'humiliation ou comment nous avons chang√© et modifi√© PixJam</a></li>
<li><a href="../fr420423/index.html">Probl√®mes d'interface avec le passage au sol</a></li>
<li><a href="../fr420425/index.html">Th√©orie et pratique de l'utilisation de HBase</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>