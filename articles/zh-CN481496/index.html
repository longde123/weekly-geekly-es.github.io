<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍳 👨 📯 通过社交工程进行DDoS攻击 🎑 🎅🏾 🛌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR攻击者将源IP替换为服务器的地址并触发自动滥用。 结果，客户端被禁止进行不存在的恶意活动。 

 由vdsina.ru评论： 
 这篇文章是由我们的客户撰写的，在DDoS攻击后，他从一个大型托管商那里传递给我们，并同意分享这个故事。 
 我将告诉您有关DDoS攻击的一种令人难以置信的阴险...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>通过社交工程进行DDoS攻击</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/481496/"><img src="https://habrastorage.org/webt/i6/x7/om/i6x7omrejaehro4mws5isygnptk.jpeg"><br><br>  <b>TL; DR攻击者将源IP替换为服务器的地址并触发自动滥用。</b>  <b>结果，客户端被禁止进行不存在的恶意活动。</b> <br><br><blockquote>  <b>由<a href="https://vdsina.ru/%3Fpartner%3Dhabr2">vdsina.ru</a>评论：</b> <br>  <i>这篇文章是由我们的客户撰写的，在DDoS攻击后，他从一个大型托管商那里传递给我们，并同意分享这个故事。</i> </blockquote><br> 我将告诉您有关DDoS攻击的一种令人难以置信的阴险方式，这是我以前从未遇到过的。 阴险的是，不会对受害者的服务器本身进行攻击。 取而代之的是，攻击者激发了第三方攻击检测系统的运行，从而迫使对服务器产生完全真实的投诉（在普通人中为“滥用”）。 <br><br> 从托管者的角度来看，您似乎正在从事恶意活动，尽管实际上并非如此。 事实证明，许多大型托管服务提供商尚未准备好深入了解问题的原因，而宁愿只是禁止您违反规则。 <br><br> 本文详细介绍了这种攻击。 <br><a name="habracut"></a><br><h2> 时间表 </h2><br> 我在一台知名主机上的VPS服务器上保留了几个个人项目。 我收到他的来信后： <br><br><blockquote>  <b>＃9042382：违反ToS-恶意活动</b> <br> 你好 <br><br> 我们收到了来自您的服务器XXXX的恶意活动的报告。 我们要求您尽快对此事进行调查。 完成调查后，请对此票提供以下问题的答案： <br>  ... <br><pre><code class="plaintext hljs">Reported-From: abuse-out@checkdomain.de Category: info Report-Type: info Service: different services Version: 0.1 User-Agent: Checkdomain Express 0.19 Date: Fri, 26 May 2018 19:25:19 +0200 Source-Type: ipv4 Source: my-server-ip-xx-xxx Port: dif. Report-ID: dih3cefnp@checkdomain.de Schema-URL: http://www.blocklist.de/downloads/schema/info_0.1.1.json Attachment: text/plain DETAILS ZU DEN ATTACKEN/STÖRUNGEN | DETAILS OF THE ATTACKS (letzten 60 Tage / max. 100 St.) | (last 60 days / max. 100 hits) portflood: syn | | standby.checkdomain.de | VORHERIGE SPERREN DER IP-NUMMER | BANNED HISTORY OF THIS IP-NUMBER my-server-ip-xxx-xxx-xxx: this ip-number was never banned before AUZUG AUS SERVERLOGDATEI | EXCERPT FROM SERVER LOGFILE tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:41667 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:46208 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:13000 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:39104 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:55348 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:37266 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:60684 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:63878 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:50445 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:56215 SYNRECV -</code> </pre> <br></blockquote><br> 其中<b>my-server-ip-xx-xxx</b>是服务器IP地址。 <br><br> 在其中，托管人向我发送了关于其滥用@邮箱的投诉，并紧急要求停止恶意活动，否则我将被阻止。 随附的日志显示了处于SYN RECEIVED状态的到80（HTTP）端口的TCP连接的列表。 也就是说，从我的服务器到某人的Web服务器有SYN泛洪。 <br><br> 我的第一个想法是，他们入侵了我，SYN Flood来自我的服务器。 在Linux上，使用普通用户权限管理套接字有限制，并且只能使用root特权仅发送SYN数据包（不建立完整的TCP连接）。 这意味着它们已经完全破裂。 <br><br> 慌乱中，我跑到服务器寻找恶意进程。 我检查top，ss，lsof，但没有发现可疑之处。 主要结论是：“ <i>可怕的是，他们可能充斥了如此酷的rootkit，它在所有系统实用程序的内核级别都隐藏了该病毒！</i> ”。 在研究过程中，事实证明服务器上的负载没有改变，根据主机面板中的图表，接口上的流量保持不变。 <br><br> 在此之前，我使用显示出站流量的过滤器启动了<b>tcpdump</b> ，并且没有发现任何可疑的内容。 绝望的是，我决定查看到服务器的所有流量。 我在合法流量中发现了来自奇怪服务器的稀有RST数据包。 <br><br> 看起来像这样，其中<b>my-server-ip-xx-xxx是</b>我的服务器<b>的</b>地址： <br><br><pre> <code class="plaintext hljs">IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R]</code> </pre><br> 很明显，这是一个异常，因为与这些服务器之间不再进行任何交换，并且为什么它们发送了数据包以关闭连接，所以我不清楚。 <br> 此时，经验丰富的管理员会立即了解所有内容，但我们会尽一切努力 <br><br><h2> 如何运作 </h2><br> 传入的RST数据包是对尝试建立到专用端口的TCP连接的响应。 同时，没有从我的服务器到发送RST的服务器的传出流量。 这意味着攻击者用我的替换出站地址，并产生类似于DDoS攻击的流量。 但是，由于攻击者唯一能做的就是发送传出数据包，因此来自服务器的所有响应都将到达我的服务器。 <br><br><img src="https://habrastorage.org/webt/nd/g7/a-/ndg7a-fdzrxswv3sjvd8jwvykym.png"><br>  <font color="999999"><sup>只有假请求的答案才能到达受害者的服务器</sup></font> <br><blockquote> 通常，当攻击者代表受害者发送小的请求，而受害者收到他未请求的大响应时，此类攻击将用于<a href="https://www.cloudflare.com/learning/ddos/dns-amplification-ddos-attack/">DNS放大</a> 。 这是经典的信道耗尽攻击机制。 </blockquote> 就我而言，攻击者并未着手耗尽受害者服务器的通道。 其活动在渠道的消费图表上是完全看不见的。 它的主要目的是激发网络攻击的自动通知系统，该系统会发送一封信，抱怨在我的提供商的whois子网中指定的滥用地址。 诸如<a href="https://www.snort.org/">Snort</a>和<a href="https://suricata-ids.org/">Suricata之</a>类的<a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BE%25D0%25B1%25D0%25BD%25D0%25B0%25D1%2580%25D1%2583%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">侵入式预防/检测系统</a> <a href="https://suricata-ids.org/">可以做到这一点</a> 。 <br><br> 结果，托管人收到了来自合法公司的绝对真实的信件，其中包含有关我的恶意活动甚至真实日志的投诉。 同时，攻击者不需要大的通道，因为他可以预先知道安装IDS / IPS系统的服务器的地址以及自动投诉工作所需的最小数据包数量。 <br><br> 攻击者的唯一困难是找到一个服务器，该服务器允许替换数据包中的传出IP地址。 所有普通主机都阻止此类数据包。 托管只有两种类型，允许客户端替换传出的IP：配置非常不熟练，或者是专门为网络犯罪创建的。 <br><br><h2> 检查IP地址欺骗的可能性 </h2><br> 我建议您检查主机是否有替换外发IP的可能性。 这将需要两台服务器，一台用于接收流量，另一台用于发送。 <br><br> 在接收服务器端，我们将开始记录传入流量。 我们将指定一个稀有端口作为过滤器，正常情况下该端口上不应有流量： <br><br><pre> <code class="plaintext hljs">tcpdump -i any port 9912</code> </pre><br> 在我们正在测试的服务器上，我们将生成一个包，其中将传出IP地址替换为指向端口9912的<b>1.1.1.1</b> 。为此，我们使用了来自nmap开发人员的酷实用程序<a href="https://nmap.org/nping/">nping</a> 。 它允许您在L2和L3级别生成任何非标准软件包。 <br><br><pre> <code class="plaintext hljs">nping --tcp -p 9912 -S 1.1.1.1 receiver-server.com</code> </pre><br>  <b>receiver</b> -server.com-运行tcpdump的侦听服务器的地址 <br>  <b>1.1.1.1-</b>替代外发地址 <br>  <b>9912-</b>远程端口 <br><br> 如果在receive-server.com的一侧看到代表1.1.1.1的数据包，则您的提供程序允许您替换传出IP地址。 这是一个向他通报设置网络设备问题的机会。 通常，此问题会受到家庭Internet服务提供商的影响。 <br><br><h2> 愚蠢的技术支持 </h2><br><br> 在找出投诉的原因之后，我向主持人详细介绍了所有内容： <br><blockquote> 你好 <br> 我终于明白发生了什么事。 <br><br> 他们使用我的地址作为源地址来欺骗我的IP地址和DDoS随机主机。 因此，受害者会向我的托管服务提供商生成自动的滥用报告。 <br><br> 您可以在滥用日志上看到连接仅处于SYN_RECV状态（未建立完整的TCP连接），因为它们只能使用欺骗性IP发送一个数据包，并且无法完成TCP握手。 <br> 我可以证明这一点。 现在有许多TCP RST传入数据包从从未发送过任何数据包的主机发送到我的服务器。 <br><br> 您可以通过运行以下命令立即检查它： <br><br>  tcpdump -i eth0“ tcp [tcpflags]＆（tcp-rst）！= 0” <br><br> 您将看到许多RST数据包来自从未向其发送任何数据的主机。 <br> 这证明攻击者欺骗了我的IP地址，以危害我并造成滥用。 <br></blockquote><br> 然后在我看来，任何合格的技术支持工程师都将了解情况，并且问题将被解决。 但是，相反，他们要求我使用防病毒软件检查服务器或完全重新安装操作系统。 在我们获得技术支持的情况下，滥用行为继续蔓延，并在一天之内被禁止。 <br><br> 竟然被我陷害了，这真是侮辱。 这种情况说明了脆弱的人是多么脆弱，他们不加理understanding地遵循脚本。 从那时起，当有关为重要项目选择托管的辩论出现时，我经常以这个案例为例。 不幸的是，许多托管公司根本无法将大量时间花在处理非标准的小型客户上，而且禁止您比解决问题还容易。 <br><br> <a href="https://vdsina.ru/%3Fpartner%3D7d159c89hz"><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3> 订阅我们的Instagram开发人员 </h3><br> <a href="http://bit.ly/34w4T9B"><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN481496/">https://habr.com/ru/post/zh-CN481496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN481484/index.html">人工智能试图避免问题学习复杂行为</a></li>
<li><a href="../zh-CN481486/index.html">“保持活力，保持活力”：新协议将使Wi-Fi可能使用的半径增加60米</a></li>
<li><a href="../zh-CN481488/index.html">莫斯科地区官员如何衡量空气污染</a></li>
<li><a href="../zh-CN481490/index.html">维生素D.短途旅行</a></li>
<li><a href="../zh-CN481492/index.html">我们收集新年的彩色音乐</a></li>
<li><a href="../zh-CN481500/index.html">狂热的程序员。 摘要第3部分+摘要表。 规划和卵石在一桶水</a></li>
<li><a href="../zh-CN481502/index.html">GitHub动作简介</a></li>
<li><a href="../zh-CN481506/index.html">＃327移动开发人员的有趣材料摘要（12月16日至22日）</a></li>
<li><a href="../zh-CN481510/index.html">Unity的优化：场景的层次结构如何窃取您</a></li>
<li><a href="../zh-CN481514/index.html">使用真实示例使用Newtonsoft.Json库。 第一部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>