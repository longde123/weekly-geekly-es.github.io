<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🎤 👨🏿‍⚕️ ☝🏿 Bangun Caffe di Google Colaboratory: Kartu Grafis Gratis di Awan 🍎 👨‍✈️ 🌍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google Colaboratory adalah layanan cloud yang baru diluncurkan yang bertujuan menyederhanakan penelitian dalam pembelajaran mesin dan pembelajaran men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bangun Caffe di Google Colaboratory: Kartu Grafis Gratis di Awan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413229/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Google Colaboratory</a> adalah layanan cloud yang baru diluncurkan yang bertujuan menyederhanakan penelitian dalam pembelajaran mesin dan pembelajaran mendalam.  Menggunakan Colaboratory, Anda bisa mendapatkan akses jarak jauh ke mesin dengan kartu video yang terhubung, dan sepenuhnya gratis, yang sangat menyederhanakan kehidupan ketika Anda harus melatih jaringan saraf yang dalam.  Kita dapat mengatakan bahwa ini adalah analog dari dokumen Google untuk Notebook Jupyter. <br><br>  Colaboratory memiliki Tensorflow yang sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diinstal sebelumnya</a> dan hampir semua pustaka Python diperlukan untuk bekerja.  Jika suatu paket tidak ada, ia dengan mudah dipasang saat bepergian melalui <code>pip</code> atau <code>apt-get</code> .  Tetapi bagaimana jika Anda perlu membangun proyek dari sumber dan terhubung ke GPU?  Ternyata ini mungkin tidak sesederhana yang saya temukan selama pembuatan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SSD-Caffe</a> .  Dalam publikasi ini saya akan memberikan deskripsi singkat tentang Kolaboratori, menjelaskan kesulitan yang dihadapi dan bagaimana menyelesaikannya, serta memberikan beberapa trik yang bermanfaat. <br><br>  Semua kode tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">Notebook Kolaboratif</a> saya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b0/fv/v8/b0fvv8egfxlwczpdifnoyazgfng.png"></div><a name="habracut"></a><br><h2>  Secara singkat tentang Kolaborasi </h2><br>  Secara kasar, Colaboratory memungkinkan Anda menjalankan Jupyter Notebook pada mesin jarak jauh.  File kolaborasi adalah .ipynb "laptop" biasa dan disimpan di disk Google.  Ada juga serangkaian fungsi yang memungkinkan Anda untuk mengunggah file dari mesin jarak jauh ke Google disk dan sebaliknya.  Anda juga dapat berbagi file ini dengan orang lain, Anda dapat menulis komentar pada mereka, seperti pada dokumen Google. <br><br>  Di Kolaborator, Anda dapat menggunakan GPU, yaitu Tesla K80.  Untuk melakukan ini, hubungkan di pengaturan: Runtime <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> \ rightarrow </script>  Ubah jenis runtime <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgvprLKJv5kJ6mdzdEltehTFszRaQ#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ rightarrow </script>  Akselerator perangkat keras.  Perlu dicatat bahwa GPU tidak selalu tersedia, dan kemudian Colaboratory akan menawarkan untuk memulai mesin tanpa itu. <br><br>  Tampaknya tidak ada yang bisa dimulai kecuali Jupyter Notebook itu sendiri, tetapi ada akses tidak langsung ke terminal: untuk ini Anda perlu menambahkan tanda seru di depan perintah terminal, misalnya <code>!mkdir images</code> .  Secara umum, kita dapat berasumsi bahwa kita berhadapan dengan mesin biasa yang sempurna di mana Ubuntu 17.10 diinstal (pada saat penulisan), tetapi terhubung dari jarak jauh.  Oleh karena itu segala sesuatu yang dapat dilakukan melalui terminal (tidak secara interaktif) dapat dilakukan di atasnya, termasuk: <br><br><ul><li>  repositori clone menggunakan <code>git clone</code> , </li><li>  memuat data menggunakan <code>wget</code> (omong-omong, bahkan file besar dimuat hampir secara instan dari disk Google), </li><li>  gunakan <code>make</code> (dan kemungkinan besar <code>cmake</code> ) </li><li>  instal alat dan pustaka menggunakan <code>apt-get</code> dan <code>pip</code> </li></ul><br>  Beberapa komentar lagi tentang Kolaborasi: <br><br><ul><li>  Tampaknya pengguna memiliki akses tanpa batas ke semua file dalam sistem (perintah apa pun perlu ditulis tanpa <code>sudo</code> ); </li><li>  Status terminal tidak ditransfer antar tim, bahkan jika mereka berada di sel yang sama (misalnya, <code>cd dir</code> jika perlu, Anda harus menulis di awal setiap perintah); </li><li>  Jika Anda memutuskan sambungan dari Kolaborator untuk waktu yang lama, semua perubahan dalam mesin virtual akan dihapus, termasuk semua paket yang diinstal dan file yang diunduh, oleh karena itu, disarankan agar instalasi paket disertakan dalam Jupyter Notebook; </li><li>  Setelah 12 jam penggunaan terus menerus, mesin mati secara otomatis, tetapi kemudian dapat dinyalakan kembali (secara teori, dalam praktiknya, GPU mungkin tidak tersedia). </li></ul><br><h2>  SSD-Caffe Build </h2><br>  Saya ingin mencoba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Single Shot Detector (SSD)</a> , yaitu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penerapan Caffe</a> -nya di Google Colaboratory, tetapi untuk ini, proyek perlu dirakit dari sumber. <br><br>  Ngomong-ngomong, jika ada versi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Caffe</a> yang cocok untuk Anda, ada cara yang jauh lebih mudah (bahkan berfungsi, meskipun saya belum mencoba menjalankan apa pun): <br><br><pre> <code class="bash hljs">!apt install caffe-cuda</code> </pre> <br>  Merakit SSD-Caffe dari sumber adalah pencarian yang cukup panjang dari beberapa langkah, yang hanya bisa dilakukan dengan tongkat penyangga. <br><br>  <b>Langkah 1: menginstal dependensi</b> <br><br>  Di sini kita harus mengunduh semua dependensi untuk Caffe menggunakan <code>apt</code> .  Namun, sebelum melakukan ini, Anda harus mengizinkan <code>apt</code> untuk mengunduh kode sumber ketergantungan.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panduan instalasi Caffe</a> mengatakan bahwa ini memerlukan "baris deb-src di file sources.list".  Sayangnya, tidak ada detail di sana, jadi saya hanya membatalkan komentar semua baris <code>deb-src</code> di file <code>/etc/apt/sources.list</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'# deb-src'</span></span>,<span class="hljs-string"><span class="hljs-string">'deb-src'</span></span>))</code> </pre><br>  Dan itu berhasil.  Tetap hanya mengunduh dependensi: <br><br><pre> <code class="bash hljs">!apt update !apt build-dep caffe-cuda</code> </pre><br>  <b>Langkah 2: perlu kompiler lain</b> <br><br>  Di sini masalahnya adalah ini: <code>g++-7</code> , yang merupakan default secara default, untuk beberapa alasan tidak kompatibel dengan kompiler CUDA <code>nvcc</code> , jadi Anda harus menggunakan sesuatu yang lain.  Saya mengunduh <code>g++-5</code> dan menjadikannya kompiler default: <br><br><pre> <code class="bash hljs">!apt install g++-5 !update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 20 !update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 20</code> </pre><br>  <b>Langkah 3: harus membangun dorongan</b> <br><br>  Jika Anda mencoba membuat Caffe pada tahap ini, masalah akan muncul ketika Anda mencoba menghubungkan boost, karena itu dibangun oleh kompiler lain, jadi Anda harus mengunduh sumbernya dan juga membangun menggunakan <code>g++-5</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih lanjut di situs boost</a> ): <br><br><pre> <code class="bash hljs">!wget https://dl.bintray.com/boostorg/release/1.67.0/<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>/boost_1_67_0.tar.bz2 !tar --bzip2 -xf boost_1_67_0.tar.bz2 !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./bootstrap.sh --<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>-prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> --with-libraries=system,filesystem,regex,thread,python --with-python-version=2.7 --with-python-root=/usr !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./b2 install</code> </pre><br>  <b>Langkah 4: Konfigurasikan Makefile</b> <br><br>  Clone Caffe dengan GitHub: <br><br><pre> <code class="bash hljs">!git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/weiliu89/caffe.git &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; git checkout ssd</code> </pre><br>  Dan kami mengubah bidang yang diperlukan di Makefile.config - Saya mengubah jalur ke CUDA, mengubah opsi BLAS, mengubah versi OpenCV ke yang ketiga, menambahkan lapisan Python, dan juga menambahkan semua jalur ke perpustakaan yang diinstal, tetapi untuk beberapa alasan tidak ditemukan (semua ini nyaman) selesai menggunakan Python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile.config.example'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: config = f.read() comment = [<span class="hljs-string"><span class="hljs-string">'CUDA_DIR := /usr/local/cuda'</span></span>, <span class="hljs-string"><span class="hljs-string">'BLAS := open'</span></span>] uncomment = [<span class="hljs-string"><span class="hljs-string">'# CUDA_DIR := /usr'</span></span>, <span class="hljs-string"><span class="hljs-string">'# BLAS := atlas'</span></span>, <span class="hljs-string"><span class="hljs-string">'# OPENCV_VERSION := 3'</span></span>, <span class="hljs-string"><span class="hljs-string">'# WITH_PYTHON_LAYER := 1'</span></span>] <span class="hljs-comment"><span class="hljs-comment"># replace = [('INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include', 'INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial /usr/local/lib/python2.7/dist-packages/numpy/core/include/'), ('LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib', 'LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu/hdf5/serial')] for c in uncomment: config = config.replace(c, c[2:]) for c in comment: config = config.replace(c, '# '+c) for c1,c2 in replace: config = config.replace(c1, c2) with open('caffe/Makefile.config', 'w') as f: f.write(config)</span></span></code> </pre><br>  Juga, di Makefile sendiri, saya harus mengganti semua tag <code>-isystem</code> dengan <code>-I</code> : keduanya bertanggung jawab untuk menemukan header, tetapi mereka diproses sedikit berbeda, dan tanpa masalah penggantian ini sudah terjadi ketika stdlib terhubung ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih detail di sini</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: mfile = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(mfile.replace(<span class="hljs-string"><span class="hljs-string">'-isystem'</span></span>,<span class="hljs-string"><span class="hljs-string">'-I'</span></span>))</code> </pre><br>  <b>Langkah 5: Bangun</b> <br><br>  Ada satu kruk terakhir yang tersisa - untuk memperbaiki file <code>c++config.h</code> , jika tidak ada masalah dengan tipe nan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">selengkapnya</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */'</span></span>, <span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */\n#define _GLIBCXX_USE_C99_MATH 1'</span></span>))</code> </pre><br>  Sekarang, sebenarnya, Anda dapat membuat Caffe: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; make -j8 &amp;&amp; make pycaffe &amp;&amp; make <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -j8 &amp;&amp; make distribute !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /content/caffe/distribute/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig</code> </pre><br>  Dua baris terakhir menambahkan jalur perpustakaan, yaitu boost dan Caffe. <br><br>  Sekarang Caffe dapat digunakan (Anda hanya perlu menentukan jalurnya di PYTHONPATH): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys caffe_path = !cd caffe/python &amp;&amp; pwd sys.path.insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, caffe_path[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> caffe</code> </pre><br>  Untuk mengujinya, saya menguji proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mobilenet-SSD</a> : kodenya juga ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">Colaboratory Notebook</a> saya. <br><br>  Secara khusus, saya mengukur waktu prediksi untuk satu gambar, dan akselerasi pada GPU sekitar 3,8. <br><br><h2>  Bonus: beberapa trik yang bermanfaat </h2><br>  Ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tutorial hebat</a> tentang Medium di Google Colaboratory.  Juga di Kolaborasi itu sendiri ada file dengan contoh hampir semua yang mungkin dibutuhkan. <br><br>  Pasang disk Google di sistem file mesin virtual: <br><br><pre> <code class="bash hljs">!apt-get install -y -qq software-properties-common python-software-properties module-init-tools !add-apt-repository -y ppa:alessandro-strada/ppa 2&gt;&amp;1 &gt; /dev/null !apt-get update -qq 2&gt;&amp;1 &gt; /dev/null !apt-get -y install -qq google-drive-ocamlfuse fuse from google.colab import auth auth.authenticate_user() from oauth2client.client import GoogleCredentials creds = GoogleCredentials.get_application_default() import getpass !google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret} &lt; /dev/null 2&gt;&amp;1 | grep URL vcode = getpass.getpass() !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> {vcode} | google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret}</code> </pre><br>  Kode ini akan mengembalikan tautan dan memberikan jendela input.  Anda harus mengikuti tautan, menyalin kode dan memasukkannya ke jendela.  Untuk beberapa alasan saya harus melakukan ini dua kali.  Selanjutnya: <br><br><pre> <code class="bash hljs">!mkdir -p drive !google-drive-ocamlfuse drive</code> </pre><br>  Setelah itu, Anda dapat menggunakan disk Google sebagai direktori biasa.  Selain itu, semua perubahan dalam direktori ini secara otomatis disinkronkan dengan Google-drive. <br><br>  Instalasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Keras</a> : <br><br><pre> <code class="python hljs">!pip install -q keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras</code> </pre><br>  Pasang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PyTorch</a> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wheel.pep425tags <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_abbr_impl, get_impl_ver, get_abi_tag platform = <span class="hljs-string"><span class="hljs-string">'{}{}-{}'</span></span>.format(get_abbr_impl(), get_impl_ver(), get_abi_tag()) accelerator = <span class="hljs-string"><span class="hljs-string">'cu80'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.exists(<span class="hljs-string"><span class="hljs-string">'/opt/bin/nvidia-smi'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> !pip install -q http://download.pytorch.org/whl/{accelerator}/torch<span class="hljs-number"><span class="hljs-number">-0.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.post4-{platform}-linux_x86_64.whl torchvision <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch</code> </pre><br>  Ubah direktori kerja: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os os.chdir(<span class="hljs-string"><span class="hljs-string">"/path/to/wdir"</span></span>)</code> </pre><br>  Hapus semua perubahan dan mulai ulang mesin: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -9 -1</code> </pre> <br>  Unggah file ke mesin lokal: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files files.download(<span class="hljs-string"><span class="hljs-string">'file.ext'</span></span>)</code> </pre><br>  Dapatkan kamus dari file yang diunggah ke disk Google: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files uploaded = files.upload()</code> </pre><br>  Bisukan output perintah terminal (redirect ke variabel): <br><br><pre> <code class="python hljs">lines_list = !pwd</code> </pre><br>  Secara umum, Google Colaboratory memberikan peluang yang baik untuk melakukan pelatihan jaringan saraf di cloud.  Benar, ini mungkin tidak cukup untuk grid yang sangat besar.  Kelebihan lainnya adalah kemampuan untuk menjalankan kode secara independen dari sistem operasi lokal (yang baik untuk reproduksibilitas), dan juga bekerja sama pada proyek yang sama.  Sebagai gantinya, GPU mungkin tidak tersedia, termasuk untuk waktu yang lama. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413229/">https://habr.com/ru/post/id413229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413219/index.html">Selamat datang di SuperJob QA-meetup</a></li>
<li><a href="../id413221/index.html">Bakteri bertahan hidup di "ruang bersih" selama perakitan pesawat ruang angkasa, memakan produk pembersih</a></li>
<li><a href="../id413223/index.html">Kamus Habra. Bagian 1</a></li>
<li><a href="../id413225/index.html">Security Week 20: serangan cyber nontrivial</a></li>
<li><a href="../id413227/index.html">Apa itu tuhan di bawah pakaian</a></li>
<li><a href="../id413231/index.html">Pengantar Kontrak Cerdas</a></li>
<li><a href="../id413233/index.html">Layanan uLogin mengirimkan data dari formulir (surat, telepon) ke situs pihak ketiga dan tidak menghiraukannya</a></li>
<li><a href="../id413235/index.html">Bertaruh pada Prediksi yang Lebih Baik: Matematika Baru Prakiraan Cuaca</a></li>
<li><a href="../id413237/index.html">Facebook membantah produsen perangkat mengirimkan data yang sama dengan pengembang Alexander Kogan</a></li>
<li><a href="../id413239/index.html">Cara membuat smartphone sedikit bodoh</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>