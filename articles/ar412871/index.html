<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛥️ ♦️ 🎧 Eclair - مكتبة التسجيل الربيعي جافا 🤳🏽 🧘🏻 🐠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="هناك الكثير من الأسئلة حول عمل الخدمات في مراحل التطوير والاختبار والدعم ، وكلها للوهلة الأولى على عكس: "ماذا حدث؟" "هل كان هناك طلب؟" ، "ما هو تنسيق ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eclair - مكتبة التسجيل الربيعي جافا</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/412871/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/c5/hp/zh/c5hpzhb2lfd56lwayott-mqlusi.jpeg"><br><br>  هناك الكثير من الأسئلة حول عمل الخدمات في مراحل التطوير والاختبار والدعم ، وكلها للوهلة الأولى على عكس: <i>"ماذا حدث؟"</i>  <i>"هل كان هناك طلب؟"</i>  ، <i>"ما هو تنسيق التاريخ؟"</i>  ، <i>"لماذا لا تستجيب الخدمة؟"</i>  الخ. <br><br>  سيتمكن السجل الذي تم تجميعه بشكل صحيح من الإجابة بالتفصيل على هذه الأسئلة والعديد من الأسئلة الأخرى بشكل مستقل تمامًا دون مشاركة المطورين.  سعيًا لتحقيق هذا الهدف المغري ، ولدت مكتبة تسجيل Eclair ، المصممة للدخول في حوار مع جميع المشاركين في العملية دون سحب الكثير من البطانيات. <br><br>  حول بطانية وميزات الحل - أدناه. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ما هي مشكلة التسجيل </h2><br><blockquote style=";text-align:right;direction:rtl">  إذا لم تكن مهتمًا جدًا بفهم المبنى ، يمكنك المتابعة فورًا إلى وصف <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">حلنا</a> . </blockquote><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  سجل التطبيق هو غيابه. <br>  في معظم الأحيان ، هو الوحيد الذي يمكنه إثبات نجاح التطبيق.  لا توجد حالة في الخدمات المصغرة ؛ الأنظمة المجاورة متحركة ومتحركة.  "كرر" ، "أعيد إنشاء" ، "فحص مزدوج" - كل هذا صعب و / أو مستحيل.  يجب أن يكون السجل بالمعلومات الكافية للإجابة على السؤال: <i>"ماذا حدث؟"</i> في أي وقت <i>.</i>  .  يجب أن يكون السجل واضحًا للجميع: المطور ، والاختبار ، وأحيانًا المحلل ، وأحيانًا المسؤول ، وأحيانًا السطر الأول من الدعم - يحدث أي شيء. </li><li style=";text-align:right;direction:rtl">  الخدمات الدقيقة تدور حول تعدد الخيوط. <br>  غالبًا ما تتم معالجة الطلبات الواردة إلى الخدمة (أو البيانات التي تطلبها الخدمة) من خلال عدة سلاسل رسائل.  عادة ما يتم خلط سجل كافة مؤشرات الترابط.  هل تريد التمييز بين الخيوط المتوازية والتمييز بين الخيوط "المتسلسلة"؟  يتم إعادة استخدام الدفق نفسه للمعالجة التسلسلية للطلبات ، مرارًا وتكرارًا تنفيذ منطقه الخاص لمجموعات البيانات المختلفة.  هذه التدفقات "المتسلسلة" تتدفق من مستوى آخر ، لكن حدودها يجب أن تكون واضحة للقارئ. </li><li style=";text-align:right;direction:rtl">  يجب أن يحفظ السجل تنسيق البيانات الأصلي. <br>  إذا تم تبادل الخدمات في الواقع بواسطة XML ، فيجب على السجل المقابل تخزين XML.  إنه ليس مضغوطًا دائمًا وليس جميلًا دائمًا (ولكنه مريح).  من السهل أن ترى النجاح ، أسهل في تحليل الفشل.  في بعض الحالات ، يمكن استخدام السجل لتشغيل الطلب أو إعادة معالجته يدويًا. </li><li style=";text-align:right;direction:rtl">  يتطلب جزء من البيانات في السجل علاقة خاصة. <br>  غالبًا ما يلزم تخزين البيانات الواردة (الطلبات) والبيانات الصادرة (الإجابات) والطلبات المقدمة إلى أنظمة الجهات الخارجية والاستجابات منها بشكل منفصل.  تخضع لمتطلبات خاصة: من خلال مدة الصلاحية أو الموثوقية.  بالإضافة إلى ذلك ، يمكن أن تحتوي هذه البيانات على مبلغ مثير للإعجاب مقارنة بخط سجل نموذجي. </li><li style=";text-align:right;direction:rtl">  جزء من البيانات ليس للسجل. <br>  يجب استبعاد ما يلي عادة من السجل العادي: البيانات الثنائية (صفائف البايت ، base64 ، ..) ، البيانات الشخصية للعملاء / الشركاء / الأفراد الآخرين والكيانات القانونية.  إنها دائمًا قصة فردية ، ولكنها منهجية ولا تخضع للتحكم اليدوي. </li></ul><br><h2 style=";text-align:right;direction:rtl">  لماذا لا اليدين </h2><br>  خذ <code>org.slf4j.Logger</code> (قم <code>org.slf4j.Logger</code> إليه مع مقدمي الطلبات من أي مجموعة) واكتب كل ما هو مطلوب إلى السجل.  مداخل الطرق الرئيسية ، مخارج ، إذا لزم الأمر ، تعكس أخطاء اشتعلت ، بعض البيانات.  هل هذا ضروري؟  نعم ولكن: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  كمية التعليمات البرمجية تنمو بشكل غير معقول (بشكل غير عادي).  في البداية ، هذا ليس مدهشًا جدًا ، إذا قمت بتسجيل الدخول الأساسي فقط (الدعم الناجح ، بالمناسبة ، مع هذا النهج). </li><li style=";text-align:right;direction:rtl">  استدعاء المسجل بيديك يصبح كسولًا بسرعة.  الإعلان عن حقل <code>static</code> باستخدام جهاز تسجيل كسول للغاية (حسنًا ، يمكن أن يفعل لومبوك هذا لنا).  نحن المطورين كسالى.  ونحن نستمع إلى كسلنا ، هذا كسل نبيل: إنه يغير العالم باستمرار للأفضل. </li><li style=";text-align:right;direction:rtl">  الخدمات الدقيقة ليست جيدة من جميع الجهات.  نعم ، إنها صغيرة وجميلة ، ولكن هناك جانب آخر: هناك الكثير!  غالبًا ما يكتب تطبيق واحد من البداية إلى النهاية بواسطة مطور واحد.  الإرث لا يلوح أمام عينيه.  سعيد ، غير مثقل بالقواعد المفروضة ، يعتبر المطور أنه من واجب اختراع تنسيق السجل الخاص به ، ومبدأه وقواعده الخاصة.  ثم ينفذ الاختراع ببراعة.  كل فئة مختلفة.  هل هذه مشكلة؟  ضخم. </li><li style=";text-align:right;direction:rtl">  سيعيد تحطيم السجل الخاص بك.  حتى الفكرة القادرة لن تنقذه.  تحديث السجل مستحيل مثل تحديث Javadoc.  في نفس الوقت ، على الأقل يقرأ Javadoc فقط من قبل المطورين (لا ، لا يقرأ أحد) ، لكن جمهور السجلات أوسع بكثير وفريق التطوير غير محدود. </li><li style=";text-align:right;direction:rtl">  يعد MDC (سياق التشخيص المعين) جزءًا لا يتجزأ من تطبيق متعدد الخيوط.  يتطلب الملء اليدوي لـ MDC التنظيف في الوقت المناسب في نهاية العمل في التيار.  وإلا ، فإنك تخاطر بربط <code>ThreadLocal</code> غير ذات صلة.  اليدين والعيون للسيطرة على هذا ، أجرؤ على القول ، أمر مستحيل. </li></ul><br>  وبهذه الطريقة نحل هذه المشاكل في تطبيقاتنا. <br><a name="eclair-decision"></a><br><h2 style=";text-align:right;direction:rtl">  ما هو Eclair وماذا يمكنه أن يفعل </h2><br>  Eclair هي أداة تبسط كتابة التعليمات البرمجية المسجلة.  يساعد على جمع المعلومات الوصفية اللازمة حول شفرة المصدر ، وربطها بالبيانات التي تحلق في التطبيق في وقت التشغيل وإرسالها إلى مستودع السجل المعتاد ، مع توليد الحد الأدنى من التعليمات البرمجية. <br><br>  الهدف الرئيسي هو جعل السجل واضحًا لجميع المشاركين في عملية التطوير.  لذلك ، راحة كتابة التعليمات البرمجية ، لا تنتهي فوائد Eclair ، ولكنها تبدأ فقط. <br><br>  تسجل Eclair الطرق والمعلمات المشروحة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يسجل إدخال / خروج الأسلوب من الأسلوب / الاستثناءات / الوسيطات / القيم التي أرجعتها الطريقة </li><li style=";text-align:right;direction:rtl">  تصفية الاستثناءات لتسجيلها على وجه التحديد إلى الأنواع: <i>فقط عند الضرورة</i> </li><li style=";text-align:right;direction:rtl">  يغير "تفاصيل" السجل ، استنادًا إلى إعدادات التطبيق للموقع الحالي: <i>على سبيل المثال ، في الحالة الأكثر تفصيلاً ، يطبع قيم الوسيطات (كلها أو بعضها) ، في أقصر نسخة - فقط حقيقة إدخال الطريقة</i> </li><li style=";text-align:right;direction:rtl">  يطبع البيانات بتنسيق JSON / XML / بأي تنسيق آخر (جاهز للعمل مع جاكسون ، JAXB خارج الصندوق): <i>يفهم التنسيق الأكثر ملاءمة لمعلمة معينة</i> </li><li style=";text-align:right;direction:rtl">  يفهم SpEL (لغة تعبير الربيع) للتثبيت التعريفي والتنظيف التلقائي MDC </li><li style=";text-align:right;direction:rtl">  يكتب إلى N loggers ، "المسجل" في فهم Eclair هو حبة فول في السياق الذي يطبق واجهة <code>EclairLogger</code> : يمكنك <i>تحديد المسجل الذي يجب أن يعالج التعليق التوضيحي بالاسم أو بالاسم المستعار أو بشكل افتراضي</i> </li><li style=";text-align:right;direction:rtl">  يخبر المبرمج عن بعض الأخطاء في استخدام التعليقات التوضيحية: <i>على سبيل المثال ، يعرف Eclair أنه يعمل على الوكلاء الديناميكيين (مع جميع الميزات التالية) ، لذلك ، يمكن أن يشير إلى أن التعليق التوضيحي على الطريقة <code>private</code> لن يعمل أبدًا</i> </li><li style=";text-align:right;direction:rtl">  يقبل التعليقات التوضيحية الوصفية (كما يطلق عليها الربيع): <i>يمكنك تحديد التعليقات التوضيحية الخاصة بك لتسجيل الدخول باستخدام بعض التعليقات التوضيحية الأساسية - لتقليل الشفرة</i> </li><li style=";text-align:right;direction:rtl">  قادرة على إخفاء البيانات "الحساسة" عند الطباعة: <i>من خارج منطقة الجزاء - تدريع XMLath</i> </li><li style=";text-align:right;direction:rtl">  يكتب سجلاً في الوضع "اليدوي" ، ويعرف المستثمر و "يوسع" الحجج التي تنفذ <code>Supplier</code> : <i>إعطاء الفرصة لتهيئة الحجج "كسول"</i> </li></ul><br><h2 style=";text-align:right;direction:rtl">  كيفية توصيل Eclair </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يتم نشر شفرة المصدر على GitHub</a> بموجب ترخيص Apache 2.0. <br><br>  للاتصال ، تحتاج إلى Java 8 و Maven و Spring Boot 1.5+.  قطعة أثرية استضافها مستودع Maven المركزي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>ru.tinkoff<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>eclair-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.8.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  يحتوي المبتدئ على تنفيذ قياسي لـ <code>EclairLogger</code> ، والذي يستخدم نظام تسجيل تمت تهيئته بواسطة Spring Boot مع مجموعة من الإعدادات التي تم التحقق منها. <br><br><h2 style=";text-align:right;direction:rtl">  أمثلة </h2><br>  فيما يلي بعض الأمثلة على الاستخدام النموذجي للمكتبة.  أولاً ، يتم إعطاء جزء من الكود ، ثم السجل المقابل ، اعتمادًا على توفر مستوى معين من التسجيل.  يمكن العثور على مجموعة أكثر اكتمالاً من الأمثلة في ويكي المشروع في قسم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الأمثلة</a> . <br><br><h3 style=";text-align:right;direction:rtl">  أبسط مثال </h3><br>  المستوى الافتراضي هو DEBUG. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simple</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  إذا كان المستوى متاحًا </th><th>  ... ثم سيكون السجل هكذا </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.simple &gt; <br> DEBUG [] rteeExample.simple &lt;</code> </td> </tr><tr><td> <code>INFO <br> WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3 style=";text-align:right;direction:rtl">  تعتمد تفاصيل السجل على مستوى التسجيل المتاح. </h3><br>  يؤثر مستوى التسجيل المتاح في الموقع الحالي على تفاصيل السجل.  كلما انخفض المستوى المتاح (أي أقرب إلى TRACE) ، كلما كان السجل أكثر تفصيلاً. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>(INFO) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verbose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, Integer i, Double d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  المستوى </th><th>  سجل </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>INFO [] rteeExample.verbose &gt; s="s", i=4, d=5.6 <br> INFO [] rteeExample.verbose &lt; false</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.verbose &gt; <br> INFO [] rteeExample.verbose &lt;</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3 style=";text-align:right;direction:rtl">  صقل تسجيل الاستثناءات </h3><br>  يمكن تصفية أنواع الاستثناءات المسجلة.  سيتم التعهد باستثناءات مختارة وذريتهم.  في هذا المثال ، سيتم تسجيل <code>NullPointerException</code> على مستوى WARN ، <code>Exception</code> على مستوى الخطأ (افتراضيًا) ، ولن يتم تسجيل <code>Error</code> على الإطلاق (لأنه لم <code>Error</code> تضمين <code>Error</code> في فلتر التعليق التوضيحي الأول <code>@Log.error</code> ويتم استبعاده بشكل صريح من فلتر التعليق التوضيحي الثاني). <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.error(level = WARN, ofType = {NullPointerException.class, IndexOutOfBoundsException.class}) <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.error(exclude = Error.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable throwable)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> throwable; } <span class="hljs-comment"><span class="hljs-comment">//       filterErrors(new NullPointerException()); filterErrors(new Exception()); filterErrors(new Error());</span></span></code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  المستوى </th><th>  سجل </th></tr><tr><td> <code>TRACE <br> DEBUG <br> INFO <br> WARN</code> </td> <td> <code>WARN  [] rteeExample.filterErrors ! java.lang.NullPointerException <br> java.lang.NullPointerException: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> .. <br> ERROR [] rteeExample.filterErrors ! java.lang.Exception <br> java.lang.Exception: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> .. <br></code> </td></tr><tr><td> <code>ERROR</code> </td> <td> <code>ERROR [] rteeExample.filterErrors ! java.lang.Exception <br> java.lang.Exception: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> ..</code> </td> </tr></tbody></table><h3 style=";text-align:right;direction:rtl">  قم بتعيين كل معلمة على حدة </h3><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.in(INFO) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parameterLevels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Log(INFO)</span></span></span><span class="hljs-function"> Double d, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DEBUG)</span></span></span><span class="hljs-function"> String s, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TRACE)</span></span></span><span class="hljs-function"> Integer i) </span></span>{ }</code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  المستوى </th><th>  سجل </th></tr><tr><td> <code>TRACE</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; d=9.4, s="v", i=7</code> </td> </tr><tr><td> <code>DEBUG</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; d=9.4, s="v"</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; 9.4</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3 style=";text-align:right;direction:rtl">  حدد وتخصيص تنسيق الطباعة </h3><br>  يمكن تكوين "الطابعات" المسؤولة عن تنسيق الطباعة بواسطة معالجات ما قبل وما بعد.  في المثال أعلاه ، <code>maskJaxb2Printer</code> تكوين <code>maskJaxb2Printer</code> بحيث <code>maskJaxb2Printer</code> العناصر التي تطابق تعبير XPath <code>"//s"</code> باستخدام <code>"********"</code> .  في نفس الوقت ، تطبع <code>jacksonPrinter</code> "كما هي". <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.out(printer = <span class="hljs-string"><span class="hljs-string">"maskJaxb2Printer"</span></span>) <span class="hljs-function"><span class="hljs-function">Dto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Log(printer = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"maskJaxb2Printer"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto xml, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(printer = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"jacksonPrinter"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto json, Integer i) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> xml; }</code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  المستوى </th><th>  سجل </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.printers &gt; <br> xml=&lt;dto&gt;&lt;i&gt;5&lt;/i&gt;&lt;s&gt;********&lt;/s&gt;&lt;/dto&gt;, json={"i":5,"s":"password"} <br> DEBUG [] rteeExample.printers &lt; <br> &lt;dto&gt;&lt;i&gt;5&lt;/i&gt;&lt;s&gt;********&lt;/s&gt;&lt;/dto&gt;</code> </td> </tr><tr><td> <code>INFO <br> WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3 style=";text-align:right;direction:rtl">  مسجلات متعددة في السياق </h3><br>  يتم تسجيل الطريقة باستخدام عدة برامج تسجيل في نفس الوقت: عن طريق المسجل الافتراضي (المشروح باستخدام <code>@Primary</code> ) <code>auditLogger</code> AuditLogger.  يمكنك تحديد عدة برامج تسجيل إذا كنت تريد فصل الأحداث المسجلة ليس فقط حسب المستوى (TRACE - ERROR) ، ولكن أيضًا إرسالها إلى مخازن مختلفة.  على سبيل المثال ، يمكن للمسجل الرئيسي كتابة سجل إلى ملف على القرص باستخدام slf4j ، ويمكن لـ <code>auditLogger</code> كتابة شريحة بيانات خاصة إلى تخزين ممتاز (على سبيل المثال ، في Kafka) بتنسيقه الخاص. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>(logger = <span class="hljs-string"><span class="hljs-string">"auditLogger"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twoLoggers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br><h3 style=";text-align:right;direction:rtl">  إدارة MDC </h3><br>  يتم حذف MDCs التي تم تعيينها باستخدام التعليق التوضيحي تلقائيًا بعد الخروج من الطريقة المُعلَّقة.  يمكن حساب قيمة سجل MDC ديناميكيًا باستخدام SpEL.  فيما يلي أمثلة: سلسلة ثابتة تدرك بواسطة ثابت ، تقييم التعبير <code>1 + 1</code> ، استدعاء <code>jacksonPrinter</code> ، استدعاء الأسلوب <code>static</code> <code>randomUUID</code> . <br>  لا يتم حذف MDCs مع السمة <code>global = true</code> بعد الخروج من الطريقة: كما ترى ، فإن السجل الوحيد المتبقي في MDC حتى نهاية السجل هو <code>sum</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ self.mdc(); } <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"static"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"string"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"sum"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"1 + 1"</span></span>, global = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"beanReference"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"@jacksonPrinter.print(new ru.tinkoff.eclair.example.Dto())"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"staticMethod"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"T(java.util.UUID).randomUUID()"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mdc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ self.inner(); } <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.<span class="hljs-function"><span class="hljs-function">in </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br>  سجل عند تنفيذ الرمز أعلاه: <br> <code>DEBUG [] rteeExample.outer &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.mdc &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.inner &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.mdc &lt; <br> DEBUG [sum=2] rteeExample.outer &lt;</code> <br> <br><h3 style=";text-align:right;direction:rtl">  تثبيت MDC على أساس المعلمات </h3><br>  إذا قمت بتحديد MDC باستخدام التعليق التوضيحي على المعلمة ، فإن المعلمة التي تم التعليق عليها متاحة ككائن الجذر لسياق التقييم.  هنا <code>"s"</code> هو حقل من الفئة <code>Dto</code> بنوع <code>String</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.<span class="hljs-function"><span class="hljs-function">in </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mdcByArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Mdc(key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"dto"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"#this"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Mdc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"length"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"s.length()"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto dto) </span></span>{ }</code> </pre><br>  سجل عند تنفيذ الرمز أعلاه: <br> <code>DEBUG [length=8, dto=Dto{i=12, s='password'}] rteeExample.mdcByArgument &gt; dto=Dto{i=12, s='password'}</code> <br> <br><h3 style=";text-align:right;direction:rtl">  تسجيل يدوي </h3><br>  بالنسبة للتسجيل "اليدوي" ، يكفي تنفيذ تطبيق <code>ManualLogger</code> .  الحجج التي تم تمريرها والتي تنفذ <code>Supplier</code> الواجهة سيتم "توسيعها" فقط إذا لزم الأمر. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ManualLogger logger; <span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">manual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ logger.info(<span class="hljs-string"><span class="hljs-string">"Eager logging: {}"</span></span>, Math.PI); logger.debug(<span class="hljs-string"><span class="hljs-string">"Lazy logging: {}"</span></span>, (Supplier) () -&gt; Math.PI); }</code> </pre><table style=";text-align:right;direction:rtl"><tbody><tr><th>  المستوى </th><th>  سجل </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.manual &gt; <br> INFO  [] rteeExample.manual - Eager logging: 3.141592653589793 <br> DEBUG [] rteeExample.manual - Lazy logging: 3.141592653589793 <br> DEBUG [] rteeExample.manual &lt;</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.manual - Eager logging: 3.141592653589793</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h2 style=";text-align:right;direction:rtl">  ماذا لا تفعل ايكلير </h2><br>  لا تعرف Eclair المكان الذي ستخزن فيه سجلاتك ، إلى متى وإلى التفاصيل.  لا تعرف Eclair كيف تخطط لاستخدام السجل الخاص بك.  يستخرج Eclair بعناية من تطبيقك جميع المعلومات التي تحتاجها ويعيد توجيهها إلى التخزين الذي قمت بتكوينه. <br><br>  مثال على تهيئة <code>EclairLogger</code> لتوجيه سجل إلى مسجل Logback مع ملحق معين: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> EclairLogger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eclairLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ LoggerFacadeFactory factory = loggerName -&gt; { ch.qos.logback.classic.LoggerContext context = (LoggerContext) LoggerFactory.getILoggerFactory(); ch.qos.logback.classic.Logger logger = context.getLogger(loggerName); <span class="hljs-comment"><span class="hljs-comment">// Appender&lt;ILoggingEvent&gt; appender = ? // logger.addAppender(appender); return new Slf4JLoggerFacade(logger); }; return new SimpleLogger(factory, LoggingSystem.get(SimpleLogger.class.getClassLoader())); }</span></span></code> </pre><br><h2 style=";text-align:right;direction:rtl">  هذا الحل ليس للجميع. </h2><br>  قبل البدء في استخدام Eclair كأداة رئيسية للتسجيل ، يجب أن تتعرف على عدد من ميزات هذا الحل.  ترجع هذه "الميزات" إلى حقيقة أن Eclair يعتمد على آلية الوكيل القياسية لـ Spring. <br><br>  - إن سرعة تنفيذ الكود الملفوف في البروكسي التالي غير مهمة ، لكنها ستنخفض.  بالنسبة لنا ، نادرا ما تكون هذه الخسائر كبيرة.  إذا ظهر السؤال المتعلق بتقليل المهلة الزمنية ، فهناك العديد من إجراءات التحسين الفعالة.  يمكن اعتبار رفض سجل إعلامي مناسب كأحد الإجراءات ، ولكن ليس في المقام الأول. <br><br>  - StackTrace "منتفخ" أكثر قليلاً.  إذا لم تكن معتادًا على المكدس الطويل من وكلاء الربيع ، فقد يكون هذا مصدر إزعاج لك.  لسبب واضح بنفس القدر ، سيكون تصحيح الطبقات بالوكالة أمرًا صعبًا. <br><br>  - <b>لا يمكن ربط كل فئة وكل طريقة: لا يمكن إجراء بروكسي</b> للطرق <code>private</code> ، ستحتاج إلى تسجيل الدخول في سلسلة الطرق في حبة واحدة ، ولا يمكنك استخدام وكيل أي شيء غير حبة ، وما إلى ذلك. <br><br><h2 style=";text-align:right;direction:rtl">  في النهاية </h2><br>  من الواضح تمامًا أنه يجب استخدام هذه الأداة ، مثل أي أداة أخرى ، للاستفادة منها.  وهذه المادة تضيء بشكل سطحي فقط الجانب الذي قررنا فيه التحرك بحثًا عن الحل المثالي. <br><br>  النقد والأفكار والتلميحات والروابط - أرحب بحرارة بأي من مشاركتك في حياة المشروع!  سأكون سعيدًا إذا وجدت Eclair مفيدًا لمشاريعك. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar412871/">https://habr.com/ru/post/ar412871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar412861/index.html">إنشاء خريطة مسار مستخدم للدمى</a></li>
<li><a href="../ar412863/index.html">Dialogflower - Google Dialogflow لـ Yandex Alice</a></li>
<li><a href="../ar412865/index.html">كيفية تصوير كاميرا Motion Eye في Sony Xperia XZ2</a></li>
<li><a href="../ar412867/index.html">كيفية ترجمة ملف COM DOS من قبل المترجم GCC</a></li>
<li><a href="../ar412869/index.html">مقابلة مع خبير في هندسة الأنسجة والطب التجديدي ، البروفيسور تل تل دفير</a></li>
<li><a href="../ar412873/index.html">تتلف الأقراص الصلبة الصوت الصادر عن مكبرات الصوت المحمولة العادية</a></li>
<li><a href="../ar412877/index.html">الروثينيوم (Ru) - العنصر الرابع ذو الخصائص المغناطيسية في درجة حرارة الغرفة</a></li>
<li><a href="../ar412879/index.html">المسألة رقم 24: التدريب على تكنولوجيا المعلومات - القضايا والتحديات الحالية من الشركات الرائدة</a></li>
<li><a href="../ar412881/index.html">Björn Straustrup: مشكلة في البرمجة</a></li>
<li><a href="../ar412885/index.html">علم الباثولوجي</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>