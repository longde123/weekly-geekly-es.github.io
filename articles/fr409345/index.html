<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåê üòé üìø Comprendre le code g√©n√©tique de la cryptocotte ‚õ¥Ô∏è üë®üèæ‚Äçü§ù‚Äçüë®üèª ‚ôåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... et apprenez √† travailler avec les outils de d√©veloppement Ethereum √† l'aide d'un exemple concret. 

 Partie z√©ro: l'objet est apparu 
 Je viens de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comprendre le code g√©n√©tique de la cryptocotte</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/409345/">  ... et apprenez √† travailler avec les outils de d√©veloppement Ethereum √† l'aide d'un exemple concret. <br><br><h3>  Partie z√©ro: l'objet est apparu </h3><br>  Je viens de terminer mes conf√©rences sur le cours complet de d√©veloppement d'applications d√©centralis√©es bas√©es sur Ethereum dans Solidity en chinois.  Je l'ai donn√© dans mon temps libre afin d'augmenter le niveau de connaissances sur la blockchain et les contrats intelligents parmi la communaut√© chinoise des d√©veloppeurs.  Pendant mon travail, je me suis li√© d'amiti√© avec quelques √©tudiants. <br><br>  Et juste √† la fin du cours, nous nous sommes soudain retrouv√©s entour√©s de ces cr√©atures: <br><br><img src="https://habrastorage.org/webt/ev/e-/ov/eve-ovga3bt6vx11ichn6jmkufm.png"><br><br>  <i>Image de cryptokitties.co</i> <br><br>  Comme la plupart des gens qui ont rencontr√© ce ph√©nom√®ne, nous n'avons pas pu, eux non plus, r√©sister √† ces cryptocr√©ations mignonnes et nous sommes rapidement devenus accro au jeu.  Nous aimions sortir de nouveaux chats et nous avons m√™me remplac√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la m√©thode du caneton par la m√©thode du chat crypto</a> .  Je crois que la d√©pendance aux jeux est mauvaise, mais pas dans ce cas, car la passion pour l'√©levage de chatons nous a rapidement conduit √† la question: <br><br><h3>  Comment certains chats crypto obtiennent-ils leur ensemble de g√®nes? </h3><br>  Nous avons d√©cid√© de consacrer samedi soir √† y trouver la r√©ponse, et nous pensons avoir r√©ussi √† faire quelques progr√®s dans le d√©veloppement de logiciels qui nous permettent de d√©terminer la mutation g√©n√©tique des chatons crypt√©s nouveau-n√©s avant leur naissance.  En d'autres termes, ce programme peut vous aider √† v√©rifier et √† d√©terminer le moment appropri√© pour la f√©condation de la m√®re chat, et ainsi obtenir la plus int√©ressante des mutations possibles. <br><br>  Nous publions ce mat√©riel dans l'espoir qu'il servira √† tout le monde comme article d'introduction pour se familiariser avec les outils de d√©veloppement Ethereum tr√®s utiles, tout comme les crypto-chatons eux-m√™mes ont permis √† de nombreuses personnes peu familiaris√©es avec la blockchain de rejoindre les rangs des utilisateurs de crypto-monnaie. <a name="habracut"></a><br><br><h3>  Premi√®re partie: la logique de haut niveau de la g√©n√©ration de petits chatons </h3><br>  Pour commencer, nous nous sommes demand√©: comment se passe la naissance des crypto chatons? <br><br>  Pour r√©pondre √† cette question, nous avons utilis√© l'excellent conducteur Etherscan blockchain, qui nous permet de faire bien plus que simplement ¬´√©tudier les param√®tres et le contenu des blocs¬ª.  Nous avons donc d√©couvert le code source du contrat CryptoKittiesCore: <br><br><img src="https://habrastorage.org/webt/co/od/v1/coodv1ao8ns32llhof2bhbpp3h8.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code</a> <br><br>  Veuillez noter que le contrat √©tendu est en fait l√©g√®rement diff√©rent de celui utilis√© dans le programme de primes.  Selon ce code, un b√©b√© chaton est form√© en deux √©tapes: 1) la m√®re chat est f√©cond√©e par le chat;  2) un peu plus tard, lorsque la p√©riode de maturation du f≈ìtus prend fin, la fonction giveBirth est appel√©e.  Cette fonction est g√©n√©ralement appel√©e par un certain d√©mon de processus, mais, comme vous le verrez plus tard, pour obtenir des mutations int√©ressantes, vous devrez s√©lectionner correctement le bloc dans lequel votre chaton est n√©. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">giveBirth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 _matronId)</span></span></span><span class="hljs-function"> external whenNotPaused </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{ Kitty storage matron = kitties[_matronId]; <span class="hljs-comment"><span class="hljs-comment">// ,  - . require(matron.birthTime != 0); // ,       ! require(_isReadyToGiveBirth(matron)); //      -. uint256 sireId = matron.siringWithId; Kitty storage sire = kitties[sireId]; // ,         uint16 parentGen = matron.generation; if (sire.generation &gt; matron.generation) { parentGen = sire.generation; } //     . uint256 childGenes = geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock - 1);</span></span></code> </pre> <br>  Dans le code ci-dessus, vous pouvez clairement voir que les g√®nes d'un chaton nouveau-n√© sont d√©termin√©s d√®s la naissance en appelant la fonction mixGenes √† partir du contrat intelligent externe de geneScience.  Cette fonction prend trois param√®tres: le g√®ne m√®re, le g√®ne p√®re et le num√©ro de bloc dans lequel le chat sera pr√™t √† accoucher. <br><br>  Vous aurez probablement une question logique, pourquoi les g√®nes ne sont pas d√©termin√©s au moment de la conception, comme c'est le cas dans le monde r√©el?  Comme vous le verrez au cours du r√©cit suivant, cela vous permet de vous d√©fendre assez √©l√©gamment contre les tentatives de pr√©dire et de d√©chiffrer les g√®nes.  Cette approche √©limine la possibilit√© d'une pr√©diction pr√©cise √† 100% des g√®nes de chaton avant que le fait de la grossesse chat-m√®re ne soit enregistr√© dans la blockchain.  Et m√™me si vous pouviez trouver le code exact responsable du m√©lange des g√®nes, cela ne vous donnerait aucun avantage. <br><br>  Quoi qu'il en soit, au d√©but, nous ne le savions pas encore, alors continuons.  Maintenant, nous devons trouver l'adresse du contrat geneScience.  Pour ce faire, utilisez MyEtherWallet: <br><br> <a href=""><img src="https://habrastorage.org/webt/nf/fa/yl/nffaylnytgmybdkavya0so0ugmi.png"></a> <br><br>  <i>Adresse du contrat GeneScience</i> <br><br>  Voici √† quoi ressemble le bytecode du contrat: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">0x60606040526004361061006c5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630d9f5aed81146100715780631597ee441461009f57806354c15b82146100ee57806361a769001461011557806377a74a201461017e575b600080fd5b341561007c57600080fd5b61008d6004356024356044356101cd565b604051908152602001604051809</span></span>........</code> </pre> <br>  Par son apparence, on ne peut pas dire qu'en cons√©quence, quelque chose d'aussi mignon qu'un chaton appara√Æt sur tout, mais nous sommes tr√®s chanceux que ce soit une adresse publique, et nous n'avons pas besoin de la chercher dans le r√©f√©rentiel).  En fait, nous pensons qu'il ne devrait pas √™tre rendu aussi facilement accessible.  Si les d√©veloppeurs voulaient vraiment s'assurer que l'adresse du contrat √©tait correcte, ils devraient utiliser la fonction checkScienceAddress, mais cela ne nous d√©rangera pas. <br><br><h3>  Deuxi√®me partie: l'effondrement d'une hypoth√®se simple </h3><br>  Alors, que voulons-nous r√©aliser √† la fin?  Il faut comprendre que nous ne nous fixons pas pour objectif de compiler enti√®rement le bytecode, en le transformant en un code de solidit√© lisible par l'homme.  Nous avons besoin d'une m√©thode bon march√© (sans avoir √† payer pour les transactions dans la blockchain de combat) pour d√©terminer les g√®nes des chaton, √† condition que nous sachions qui sont ses parents.  Voil√† ce que nous allons faire. <br><br>  Pour commencer, utilisons l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil d'opcode</a> Etherscan pour une analyse rapide.  Cela ressemble √† ceci: <br><br> <a href=""><img src="https://habrastorage.org/webt/m6/nt/72/m6nt72740bwhn4qz6dlkz0pc6qi.png"></a> <br><br>  <i>Beaucoup plus clair</i> <br><br>  Nous suivons la r√®gle d'or du d√©codage du code assembleur: nous partons d'une hypoth√®se simple et audacieuse sur le comportement du programme et, au lieu d'essayer de comprendre son travail dans son ensemble, nous nous concentrons sur la confirmation de l'hypoth√®se formul√©e.  Nous allons parcourir le bytecode pour r√©pondre √† quelques questions: <br><br><ol><li>  Utilise-t-il des horodatages?  Non, car l'opcode TIMESTAMP est manquant.  S'il y a un simple accident, sa source est certainement un autre opcode. </li><li>  Un hachage de bloc est-il utilis√©?  Oui, BLOCKHASH se produit deux fois.  Par cons√©quent, le hasard, le cas √©ch√©ant, peut provenir de leurs opcodes, mais nous n'en sommes pas encore s√ªrs. </li><li>  Des hachages sont-ils utilis√©s?  Oui, il y a SHA3.  Il n'est pas clair, cependant, ce qu'il fait. </li><li>  Est-ce que msg.sender est utilis√©?  Non, car l'opcode CALLER est manquant.  Par cons√©quent, aucun contr√¥le d'acc√®s n'est appliqu√© au contrat. </li><li>  Un contrat externe est-il utilis√©?  Non, il n'y a pas d'opcode CALL. </li><li>  COINBASE est-il utilis√©?  Non, et donc nous excluons une autre source possible de hasard. </li></ol><br>  Ayant re√ßu la r√©ponse √† ces questions, nous avons avanc√© et entendons tester une hypoth√®se simple: le r√©sultat de mixGene est d√©termin√© par trois et seulement trois param√®tres d'entr√©e de cette fonction.  Si c'est le cas, nous pourrions simplement d√©ployer ce contrat localement, continuer √† appeler cette fonction avec les param√®tres qui nous int√©ressent, puis, peut-√™tre, nous pourrions obtenir un kit de g√®nes de chaton avant m√™me que la m√®re-chat ne soit f√©cond√©e. <br><br>  Pour v√©rifier cette hypoth√®se, nous appelons la fonction mixGene sur le r√©seau principal avec trois param√®tres al√©atoires: 1111115, 80, 40 et obtenons un r√©sultat X. Ensuite, d√©ployez ce bytecode en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">truffle et testrpc</a> .  Notre paresse a donc conduit √† une mani√®re quelque peu non standard d'utiliser la truffe. <br><br><pre> <code class="java hljs">contract GeneScienceSkeleton { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mixGenes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 genes1, uint256 genes2, uint256 targetBlock)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{} }</code> </pre> <br>  Nous commen√ßons par le squelette du contrat, le mettons dans la structure de dossiers du framework truffle et ex√©cutons la compilation de truffes.  Cependant, au lieu de migrer directement ce contrat vide vers testrpc, nous rempla√ßons le bytecode du contrat dans le dossier de construction par le bytecode √©tendu r√©el et le bytecode du contrat geneScience.  C'est un moyen atypique mais rapide si vous souhaitez d√©ployer un contrat avec uniquement du bytecode et une interface ouverte limit√©e pour les tests locaux.  Apr√®s cela, nous appelons directement Mixgenes avec les param√®tres 1111115, 80, 40, et malheureusement nous obtenons une erreur avec la r√©ponse revenir en r√©ponse.  Ok, regardez plus profond√©ment.  Comme nous le savons, la signature des fonctions mixGene est 0x0d9f5aed, nous prenons donc un stylo et du papier et suivons l'ex√©cution du bytecode, √† partir du point d'entr√©e de cette fonction pour tenir compte des changements dans la pile et le stockage.  Apr√®s quelques sauts, on se retrouve ici: <br><br><pre> <code class="java hljs">[<span class="hljs-number"><span class="hljs-number">497</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">498</span></span>] NUMBER [<span class="hljs-number"><span class="hljs-number">499</span></span>] DUP14 [<span class="hljs-number"><span class="hljs-number">500</span></span>] SWAP1 [<span class="hljs-number"><span class="hljs-number">501</span></span>] GT [<span class="hljs-number"><span class="hljs-number">504</span></span>] PUSH2 <span class="hljs-number"><span class="hljs-number">0x01fe</span></span> [<span class="hljs-number"><span class="hljs-number">505</span></span>] JUMPI [<span class="hljs-number"><span class="hljs-number">507</span></span>] PUSH1 <span class="hljs-number"><span class="hljs-number">0x00</span></span> [<span class="hljs-number"><span class="hljs-number">508</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">509</span></span>] <span class="hljs-string"><span class="hljs-string">'fd'</span></span>(Unknown Opcode)</code> </pre> <br>  A en juger par le contenu de ces lignes, si le num√©ro du bloc courant est inf√©rieur au troisi√®me param√®tre, revert () est appel√©.  Eh bien, c'est un comportement tout √† fait raisonnable: appeler une fonction r√©elle dans un jeu avec un num√©ro de bloc du futur est impossible et c'est logique. <br><br>  Cette v√©rification d'entr√©e est facile √† contourner: nous extrayons juste quelques blocs sur testrpc et appelons √† nouveau la fonction.  Cette fois, la fonction renvoie avec succ√®s Y. <br><br>  Mais malheureusement X! = Y <br><br>  Dommage.  Cela signifie que le r√©sultat de l'ex√©cution de la fonction d√©pend non seulement des param√®tres d'entr√©e, mais √©galement de l'√©tat de la blockchain du r√©seau principal, qui, bien s√ªr, diff√®re de l'√©tat de la fausse blockchain testrpc. <br><br><h3>  Troisi√®me partie: retrousser nos manches et creuser dans la pile </h3><br>  D'accord.  Il est donc temps de retrousser vos manches.  Le papier n'est plus adapt√© au suivi de l'√©tat de la pile.  Donc, pour un travail plus s√©rieux, nous allons lancer un d√©sassembleur EVM tr√®s utile appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">evmdis</a> . <br><br>  Compar√© au papier et au stylo, il s'agit d'une avanc√©e tangible.  Continuons avec ce √† quoi nous nous sommes arr√™t√©s dans le dernier chapitre.  Ce qui suit est une conclusion encourageante avec evmdis: <br><br><pre> <code class="java hljs">............. :label22 # Stack: [@<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1EB</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1ED</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EE</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EF</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F0</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F1</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F3</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x1F9</span></span> JUMPI(:label23, NUMBER() &gt; POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FA</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1FC</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1FD</span></span> REVERT() :label23 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FF</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x200</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x201</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x202</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x203</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x209</span></span> JUMPI(:label25, !!POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x20C</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x213</span></span> PUSH((NUMBER() &amp; ~<span class="hljs-number"><span class="hljs-number">0xFF</span></span>) + (POP() &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span>)) <span class="hljs-number"><span class="hljs-number">0x214</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x215</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x217</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x21E</span></span> JUMPI(:label24, !!(POP() &lt; NUMBER())) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x213</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x222</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x223</span></span> PUSH(POP() - <span class="hljs-number"><span class="hljs-number">0x100</span></span>) <span class="hljs-number"><span class="hljs-number">0x224</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x225</span></span> POP() :label24 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x227</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x228</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x229</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x22A</span></span> POP() :label25 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x200</span></span> | @<span class="hljs-number"><span class="hljs-number">0x228</span></span>] <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x88</span></span> | @<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x22C</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x22D</span></span> DUP16 <span class="hljs-number"><span class="hljs-number">0x22E</span></span> DUP16 ...........</code> </pre> <br>  Ce que evmdis est vraiment bon, c'est son utilit√© pour analyser JUMPDEST dans les bonnes √©tiquettes, qui ne peuvent pas √™tre surestim√©es. <br><br>  Donc, apr√®s avoir pass√© l'exigence initiale, nous nous retrouvons sur l'√©tiquette 23. Nous voyons DUP13 et rappelons du chapitre pr√©c√©dent que le nombre 13 sur la pile est notre troisi√®me param√®tre.  Nous essayons donc d'obtenir le BLOCKHASH de notre troisi√®me param√®tre.  Cependant, l'action de BLOCKHASH est limit√©e √† 256 blocs.  C'est pourquoi il est suivi de JUMPI (il s'agit d'une construction if).  Si nous traduisons la logique des opcodes dans le langage du pseudo-code, nous obtenons quelque chose comme ceci: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentBlockNumber - p &lt; <span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash(p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bhash = blockhash(thrid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bhash == <span class="hljs-number"><span class="hljs-number">0</span></span>) { thirdProjection = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (thridParam &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (thirdProjection &gt; currentBlockNumber) { thirdProjection -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } thirdParam = thirdProjection; bhash = blockhash(thirdProjection); } label <span class="hljs-number"><span class="hljs-number">25</span></span> and beyond ..... some more stuff related to thirdParam and bhash</code> </pre> <br>  un peu plus de trucs li√©s √† thirdParam et bhash - autre code li√© √† thirdParam et block hash <br><br>  Nous pensons maintenant que nous avons trouv√© une raison pour laquelle nos r√©sultats diff√®rent de ceux que nous observons dans le r√©seau principal.  Plus important encore, nous avons apparemment r√©ussi √† d√©couvrir la source du hasard.  A savoir: le hachage de bloc est calcul√© en fonction du troisi√®me param√®tre ou de la <i>pr√©vision du</i> troisi√®me param√®tre.  Il est important de noter que dans la pile, le troisi√®me param√®tre est √©galement remplac√© par ce num√©ro de bloc pr√©vu. <br><br>  √âvidemment, lors d'une ex√©cution locale en dehors du r√©seau principal, nous n'avons pas d'option simple pour imposer un retour BLOCKHASH qui correspond aux valeurs du r√©seau principal.  Quoi qu'il en soit, puisque nous connaissons les trois param√®tres, nous pouvons facilement surveiller le r√©seau principal et obtenir le hachage du bloc H pour le troisi√®me param√®tre, ainsi que le hachage du bloc pr√©vu. <br><br>  Ensuite, nous pouvons ins√©rer ce hachage directement dans le code d'octet dans notre environnement de test local, et si tout se passe comme pr√©vu, nous obtiendrons enfin le bon ensemble de g√®nes. <br><br>  Mais il y a un hic: DUP13 et BLOCKHASH ne sont que 2 octets dans le code, et si nous les rempla√ßons simplement par 33 octets PUSH32 0x * hash *, le compteur de programme changera compl√®tement et nous devrons corriger chaque JUMP et JUMPI.  Ou nous devrons faire JUMP √† la fin du code et remplacer les instructions pour le code d√©ploy√©, et ainsi de suite. <br><br>  Eh bien, puisque nous sommes arriv√©s si loin, nous allons renifler un peu plus.  Puisque nous poussons le hachage non nul de 32 octets dans la branche if, la condition sera toujours vraie et par cons√©quent, tout ce qui est √©crit dans la partie else peut √™tre simplement jet√© pour faire de la place pour notre hachage de 32 octets.  Eh bien, en g√©n√©ral, c'est ce que nous avons fait: <br><br> <a href=""><img src="https://habrastorage.org/webt/n1/xx/-x/n1xx-xl6ew1nlx-xjwzkgtk90cs.png"></a> <br><br>  Le point cl√© est que puisque nous avons abandonn√© la partie restante de la condition, nous devons remplacer le troisi√®me param√®tre d'entr√©e de la fonction mixGene par la pr√©vision du troisi√®me param√®tre avant de l'appeler. <br><br>  C'est au point que si vous essayez d'obtenir le r√©sultat d'une op√©ration <br>  mixGene (X, Y, Z), o√π currentBlockNumber est Z &lt;256, il vous suffit de remplacer le hachage PUSH32 par le hachage du bloc Z. <br>  Cependant, si vous avez l‚Äôintention de faire ce qui suit <br>  mixGene (X, Y, Z), o√π currentBlockNumber est Z ‚â• 256, vous devrez remplacer le hachage PUSH32 par le hachage du bloc proj_Z, o√π proj_Z est d√©fini comme suit: <br><br><pre> <code class="java hljs">proj_Z = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (Z &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (proj_Z &gt; currentBlockNumber) { proj_Z -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } &lt;b&gt;    Z  proj_Z   ,   mixGene(X, Y, proj_Z).&lt;/b&gt;</code> </pre> <br>  Notez que proj_Z restera inchang√© dans une certaine plage de blocs.  Par exemple, si Z &amp; 0xff = 128, alors proj_Z change uniquement sur chaque bloc z√©ro et 128e. <br><br>  Pour confirmer cette hypoth√®se et v√©rifier s'il y a des pi√®ges √† venir, nous avons chang√© le bytecode et utilis√© un autre utilitaire cool appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hevm</a> . <br><br> <a href=""><img src="https://habrastorage.org/webt/ey/d5/cx/eyd5cxlyauklees28j70widdisg.png"></a> <br><br>  Si vous n'avez jamais utilis√© hevm, je vous recommande de l'essayer.  L'outil est disponible avec son propre framework, mais surtout dans son ensemble, il convient de noter une chose indispensable comme un d√©bogueur de pile interactif. <br><br><pre> <code class="java hljs">Usage: hevm exec --code TEXT [--calldata TEXT] [--address ADDR] [--caller ADDR] [--origin ADDR] [--coinbase ADDR] [--value W256] [--gas W256] [--number W256] [--timestamp W256] [--gaslimit W256] [--gasprice W256] [--difficulty W256] [--debug] [--state STRING] Available options: -h,--help</code> </pre> <br>  Ci-dessus, les options de lancement.  L'utilitaire vous permet de sp√©cifier une vari√©t√© de param√®tres.  Parmi eux, --debug, qui vous donne la possibilit√© de d√©boguer de mani√®re interactive. <br><br>  Nous avons donc ici pass√© plusieurs appels au contrat geneScience d√©ploy√© sur la blockchain du r√©seau principal et enregistr√© les r√©sultats.  Ensuite, nous avons utilis√© hevm pour ex√©cuter notre bytecode cass√© avec des donn√©es pr√©par√©es en tenant compte des r√®gles d√©crites ci-dessus et ... <br><br>  Les r√©sultats sont les m√™mes! <br><br><h3>  Le dernier chapitre: conclusion et poursuite des travaux (?) </h3><br>  Alors, qu'avons-nous pu r√©aliser? <br><br>  En utilisant notre logiciel de piratage, vous pouvez 100% de chances de pr√©dire un g√®ne 256 bits pour un chaton nouveau-n√© s'il est n√© dans la plage de blocs [coolDownEndBlock (lorsque le b√©b√© est pr√™t √† appara√Ætre), le bloc actuel est + 256 (environ)].  Vous pouvez raisonner de cette fa√ßon: lorsque le b√©b√© est dans l'ut√©rus de la m√®re chat, ses g√®nes mutent au fil du temps, en raison de la source d'entropie sous la forme d'un hachage du bloc coolDownEndBlock pr√©vu, qui change √©galement avec le temps.  Par cons√©quent, vous pouvez utiliser ce programme pour v√©rifier √† quoi ressemblera le g√®ne du b√©b√© s'il est n√© maintenant.  Et si vous n'aimez pas ce g√®ne, vous pouvez attendre environ 256 blocs suppl√©mentaires (en moyenne) et v√©rifier le nouveau g√®ne. <br><br>  Quelqu'un peut dire que cela ne suffit pas, car seule une pr√©cision de pr√©diction de 100% peut √™tre consid√©r√©e comme un piratage id√©al avant m√™me la grossesse d'une m√®re-chat.  Cependant, cela n'est pas possible, car le g√®ne du chaton est d√©termin√© non seulement par les g√®nes de ses parents, mais aussi par le hachage pr√©dit du bloc comme facteur de mutation, qui ne peut tout simplement pas √™tre connu avant la f√©condation. <br><br>  Qu'est-ce qui peut √™tre am√©lior√© et quelles sont les nuances ici? <br><br>  Nous avons rapidement pass√© en revue les changements qui se produisent sur la pile dans la vraie partie logique du contrat intelligent (√©tiquette 25 et tout ce qui suit) et nous pensons que cette partie pr√©visible du code mixGene est assez soumise √† l'analyse et √† l'√©tude.  Nous esp√©rons que le hachage de bloc en tant que facteur de mutation a √©galement une certaine signification physique, aidant, par exemple, √† d√©terminer quel g√®ne doit √™tre mut√©.  Si nous parvenons √† comprendre cela, nous obtiendrons le g√®ne d'origine, sans mutations.  C'est utile car si vous n'avez pas un bon g√®ne source, alors m√™me la meilleure mutation peut ne pas suffire. <br><br>  Nous n'avons pas non plus mesur√© la corr√©lation entre le g√®ne 256 bits et les traits de chaton (couleur des yeux, type de queue, etc.), mais nous pensons que cela est tout √† fait possible √† l'aide d'un bot hautes performances et d'un simple classificateur. <br><br>  Et en g√©n√©ral, nous comprenons parfaitement l'intention de l'√©quipe de d√©veloppement de CryptoKitties de stabiliser la mutation sur une courte p√©riode de temps.  Mais le revers de cette approche est la possibilit√© d'effectuer une analyse comme nous l'avons fait. <br><br>  Nous tenons √©galement √† remercier la merveilleuse communaut√© ethereum pour le d√©veloppement d'outils tels que Etherscan, hevm, evmdis, truffle, testrpc, myetherwallet et Solidity.  C'est une communaut√© tr√®s cool et nous sommes heureux d'en faire partie. <br><br>  Et enfin, le code modifi√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/modong/GeneScienceCracked/</a> <br><br>  N'oubliez pas de remplacer $ CONSTBLOCKHASH $ par le hachage du bloc pr√©dit. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="image"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr409345/">https://habr.com/ru/post/fr409345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr409335/index.html">Des scientifiques de Cambridge ont cr√©√© un mod pour Civilization V avec la mise en ≈ìuvre du sc√©nario pour le d√©veloppement d'une IA forte</a></li>
<li><a href="../fr409337/index.html">Utilisation de VR, AR et MR dans les simulations et la formation</a></li>
<li><a href="../fr409339/index.html">Vue d'ensemble du DVR avec GPS-informateur AdvoCam-FD Black-II GPS + GLONASS</a></li>
<li><a href="../fr409341/index.html">D√©veloppement d'une unit√© de contr√¥le √©lectronique pour la machine √† laver Oriole</a></li>
<li><a href="../fr409343/index.html">Cadeaux du Nouvel An, troisi√®me partie: si nous nous sommes bien comport√©s</a></li>
<li><a href="../fr409347/index.html">L'application Android Haven d'Edward Snowden prot√®ge les objets physiques</a></li>
<li><a href="../fr409349/index.html">Avez-vous besoin d'une tasse ¬´intelligente¬ª ou d'une tasse assez ordinaire, ou √† quelle vitesse le caf√© refroidit</a></li>
<li><a href="../fr409351/index.html">L'espace russe va-t-il exploser en 2018?</a></li>
<li><a href="../fr409355/index.html">Combien devrait co√ªter Bitcoin?</a></li>
<li><a href="../fr409357/index.html">Stations de travail Dell: pour des t√¢ches cr√©atives et une productivit√© extr√™me</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>