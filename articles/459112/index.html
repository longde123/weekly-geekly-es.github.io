<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù£Ô∏è üêö üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Comprender las caracter√≠sticas de Google Chrome Convertir HTML a PDF üèä üêÑ üåá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, en una startup, resolv√≠ el problema de generar tickets en formato PDF. En ese momento, un sitio web con una pila establecida de tecnolo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comprender las caracter√≠sticas de Google Chrome Convertir HTML a PDF</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459112/"><p><img src="https://habrastorage.org/webt/nl/zz/on/nlzzon_ar_4p3nuhes4p4cgq2ey.jpeg"></p><br><p>  Recientemente, en una startup, resolv√≠ el problema de generar tickets en formato PDF.  En ese momento, un sitio web con una pila establecida de tecnolog√≠as ya estaba listo, por lo que estaba buscando un enfoque que no requiriera el uso de herramientas adicionales.  Al final, propuse crear tickets en formato HTML primero, y luego convertirlos a PDF usando el navegador Chrome.  Al final result√≥ que, de esta manera, puede generar no solo tickets ricamente decorados con CSS, sino tambi√©n una variedad de informes con gr√°ficos en JavaScript.  En este art√≠culo, hablar√© sobre c√≥mo iniciar Chrome para estos fines, dar√© algunos consejos para personalizar CSS y tambi√©n discutir√© las desventajas de esta soluci√≥n. </p><a name="habracut"></a><br><p>  Las opciones alternativas no se discutir√°n aqu√≠, porque ya se ha escrito lo suficiente sobre ellas, son f√°ciles de encontrar y son herramientas listas para usar, informaci√≥n sobre la cual es mejor buscar en las fuentes principales, en la documentaci√≥n de los sitios web oficiales.  El m√©todo propuesto no es una herramienta independiente y se parece m√°s a un subproducto del desarrollo de varias tecnolog√≠as.  En el segmento de Internet en ruso, hay poca informaci√≥n recopilada, as√≠ que decid√≠ llenar el vac√≠o. </p><br><h2 id="pochemu-vybran-imenno-etot-variant">  ¬øPor qu√© se elige esta opci√≥n? </h2><br><p>  La mayor ventaja es que Chrome no necesita expandir la pila de tecnolog√≠a para generar archivos PDF.  Los desarrolladores frontend crean HTML con herramientas de desarrollo familiares e inmediatamente ven los resultados intermedios del trabajo en el navegador.  Al mismo tiempo, Chrome probablemente est√© girando en las pruebas y transferirlo al backend no es dif√≠cil.  Tambi√©n debe tenerse en cuenta que el codificador puede acceder a todo el arsenal de propiedades css, incluidos Flexbox y Grid. <br>  Hablar√© sobre las deficiencias y las formas de sortearlas durante el transcurso del art√≠culo. </p><br><h2 id="reshaem-zadachu-odnoy-strokoy">  Resolvemos el problema en una sola l√≠nea. </h2><br><p>  En la l√≠nea de comando, llamamos a Chrome en modo sin cabeza con guardar la p√°gina en pdf: </p><br><pre><code class="bash hljs">chrome --headless --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-gpu --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-to-pdf https://google.com</code> </pre> <br><p>  Los usuarios de Linux pueden necesitar ejecutar <code>chrome</code> <code>chromium-browser</code> lugar de <code>chrome</code> . <br>  Los usuarios de MAC pueden encontrar √∫til crear previamente un alias: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> chrome=<span class="hljs-string"><span class="hljs-string">"/Applications/Google\\ \\Chrome.app/Contents/MacOS/Google\\ \\Chrome"</span></span></code> </pre> <br><p>  ACTUALIZACI√ìN: Los comentarios aclararon que los usuarios de Windows deben establecer expl√≠citamente el nombre del archivo PDF <code>--print-to-pdf=output.pdf</code> </p><br><p>  Si ya tiene un generador de documentos HTML, en lugar de <code>https://google.com</code> especifique la URL para recibir este documento. </p><br><p>  Abra el archivo <code>output.pdf</code> en el directorio local y mire el resultado. <br>  Lo primero que llama la atenci√≥n es la presencia de un encabezado con una fecha de impresi√≥n y un pie de p√°gina con una URL y paginaci√≥n.  Para eliminarlos, debe agregar algunas reglas CSS.  Es poco probable que se agreguen estas reglas a <code>google.com</code> , por lo que para un trabajo posterior es mejor crear su propio documento HTML. </p><br><h2 id="dobavlyaem-css">  Agregar CSS </h2><br><p>  CSS tiene una consulta especial de medios <code>@page</code> , que se usa para imprimir; configuraremos una sangr√≠a para que el Encabezado y el Pie de p√°gina simplemente no encajen: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">size</span></span>: A4; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0mm</span></span>; }</code> </pre> <br><p>  Este m√©todo solo funcionar√° para documentos de una sola p√°gina, al imprimir dos o m√°s p√°ginas, el pie de p√°gina con la URL y la numeraci√≥n de la p√°gina permanecer√°n en la parte inferior inferior.  Puede solicitar expl√≠citamente a Chrome que desactive la visualizaci√≥n de Encabezado y Pie de p√°gina configurando el par√°metro de impresi√≥n <code>displayHeaderFooter = False</code> , pero en este momento no se mueve a la interfaz de l√≠nea de comandos.  Para lograrlo, necesitar√° herramientas para automatizar el trabajo con el navegador: Selenium o titiritero.  A continuaci√≥n, considerar√© la primera opci√≥n, porque mi proyecto us√≥ Python. </p><br><h2 id="zapuskaem-chrome-cherez-selenium">  Inicie Chrome a trav√©s de Selenium </h2><br><p>  Por lo tanto, instale Selenium con el comando <code>pip install selenium</code> , descargue el controlador de Chrome que coincida con su versi√≥n de Chrome desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://chromedriver.chromium.org/</a> y use la funci√≥n <code>get_pdf_from_html</code> del siguiente ejemplo: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.chrome.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json, base64 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pdf_from_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, chromedriver=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'./chromedriver'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, print_options = {})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Chrome webdriver_options = Options() webdriver_options.add_argument('--headless') webdriver_options.add_argument('--disable-gpu') driver = webdriver.Chrome(chromedriver, options=webdriver_options) #   url driver.get(path) #    calculated_print_options = { 'landscape': False, 'displayHeaderFooter': False, 'printBackground': True, 'preferCSSPageSize': True, } calculated_print_options.update(print_options) #    pdf  result = send_devtools(driver, "Page.printToPDF", calculated_print_options) driver.quit() #    base64 -  return base64.b64decode(result['data']) def send_devtools(driver, cmd, params={}): resource = "/session/%s/chromium/send_command_and_get_result" % driver.session_id url = driver.command_executor._url + resource body = json.dumps({'cmd': cmd, 'params': params}) response = driver.command_executor._request('POST', url, body) if response['status']: raise Exception(response.get('value')) return response.get('value') if __name__ == "__main__": if len(sys.argv) != 3: print ("usage: converter.py &lt;html_page_sourse&gt; &lt;filename_to_save&gt;") exit() result = get_pdf_from_html(sys.argv[1]) with open(sys.argv[2], 'wb') as file: file.write(result)</span></span></code> </pre><br><p>  Para obtener un archivo PDF, puede ejecutar este ejemplo desde la l√≠nea de comando que especifica la url y el nombre del archivo para guardar el PDF, o llamar a la funci√≥n <code>get_pdf_from_html</code> y pasarle tres argumentos: </p><br><ol><li>  ruta - url del documento html; </li><li>  chromedriver: la ruta en la m√°quina local al controlador de Chrome (de manera predeterminada, debe estar en el directorio local); </li><li>  opciones_impresi√≥n: atributos de impresi√≥n adicionales. </li></ol><br><p>  Cabe se√±alar que Selenium no tiene una interfaz est√°ndar para imprimir una p√°gina en PDF, y solo Chrome puede hacer esto, por lo que debe llamar directamente a <code>driver.command_executor._request</code> . </p><br><p>  Ahora veamos qu√© herramientas est√°n disponibles para controlar la ubicaci√≥n del contenido en documentos de varias p√°ginas. </p><br><h2 id="tipografika-v-css">  Tipograf√≠a CSS </h2><br><p>  Al imprimir a doble cara, puede establecer diferentes m√°rgenes desde el borde para las p√°ginas derecha e izquierda individualmente si planea unirlas en el futuro: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:left</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; }</code> </pre> <br><p>  Para la primera p√°gina, puede especificar su propio dise√±o, por ejemplo, una sangr√≠a aumentada desde el borde superior: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:first</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10cm</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Top margin on first page 10cm */</span></span> }</code> </pre> <br><p>  Es posible establecer el salto de p√°gina antes del encabezado de primer nivel para que comience en una p√°gina impar: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before </span></span>: right }</code> </pre> <br><p>  Usando la propiedad de <code>page-break-after</code> , puede evitar un salto de p√°gina inmediatamente despu√©s de alg√∫n elemento, por ejemplo, un encabezado de segundo nivel: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-after </span></span>: avoid }</code> </pre> <br><p>  La propiedad de <code>page-break-inside</code> ayuda a evitar saltos de p√°gina donde no es deseable hacer esto, por ejemplo, en el medio de una tabla </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside </span></span>: avoid }</code> </pre> <br><p>  Los <code>orphans</code> y las <code>orphans</code> ayudar√°n a evitar los saltos de p√°gina al principio y al final de un p√°rrafo: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">orphans</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">widows</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="chto-s-proizvoditelnostyu">  ¬øQu√© pasa con el rendimiento? </h2><br><p>  En un Core i5-8600K 3600MHz en un flujo, una simple conversi√≥n de documentos lleva 0.6 segundos.  En mi m√°quina de escribir port√°til de finales de 2013, 2,4 GHz - 1,5 segundos. <br>  Obviamente, los principales recursos se gastan en iniciar el navegador.  Puede reducir el tiempo de conversi√≥n para una gran cantidad de archivos si ejecuta Chrome una vez como microservicio y le env√≠a una URL para la conversi√≥n.  La implementaci√≥n de este m√©todo est√° m√°s all√° del alcance de este art√≠culo. </p><br><h2 id="chto-esche-ne-tak">  ¬øQu√© m√°s est√° mal? </h2><br><p>  Veo dos problemas principales: </p><br><ol><li>  La imposibilidad de simplemente determinar la posici√≥n de los elementos en un documento.  Esto dificulta la creaci√≥n de una tabla de contenido con indicaci√≥n autom√°tica de los n√∫meros de p√°gina, especialmente si el tama√±o del contenido no se conoce de antemano. </li><li>  La conversi√≥n de Chrome es el producto de Google, que recopila una variedad de informaci√≥n sobre los usuarios.  Si la fuga de datos del documento es inaceptable, debe tener cuidado con la soluci√≥n propuesta: cierre el navegador con acceso a recursos externos o incluso busque otra soluci√≥n.  El uso de c√≥digo abierto Chromium no resuelve el problema: ya se han encontrado errores de Google. </li></ol><br><h2 id="vyvody">  Conclusiones </h2><br><p>  Propongo sacar conclusiones sobre la admisibilidad de utilizar este enfoque por mi cuenta.  Cada proyecto es √∫nico a su manera.  Si este m√©todo es adecuado en su proyecto, depende de usted. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459112/">https://habr.com/ru/post/459112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459100/index.html">GitHub Package Registry admitir√° paquetes Swift</a></li>
<li><a href="../459102/index.html">Plato de regalo o m√∫sica gratis para los amantes de la cola y desayunos preparados.</a></li>
<li><a href="../459104/index.html">C # o Java? ¬øTypeScript o JavaScript? La clasificaci√≥n de los lenguajes de programaci√≥n basados ‚Äã‚Äãen el aprendizaje autom√°tico.</a></li>
<li><a href="../459108/index.html">Tesla presentar√° varias sorpresas a la vez en la segunda mitad de este a√±o</a></li>
<li><a href="../459110/index.html">Estamos escribiendo un bot de pesca en el juego Albion Online en Python</a></li>
<li><a href="../459114/index.html">14 mejores plugins de WordPress SEO en 2019</a></li>
<li><a href="../459116/index.html">Un paso m√°s cerca de la reparaci√≥n del timo</a></li>
<li><a href="../459118/index.html">C√≥mo dise√±amos e implementamos la nueva red en Huawei en la oficina de Mosc√∫, parte 2</a></li>
<li><a href="../459120/index.html">Computadoras modulares integradas de la serie UNO-1000/2000</a></li>
<li><a href="../459122/index.html">Aleksey Savvateev: Premio Nobel de Jean Tyrol por analizar mercados imperfectos (2014) y reputaci√≥n colectiva</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>