<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕟 👩🏽‍🤝‍👨🏻 🐂 NLog: القواعد والمرشحات 🤫 ▶️ 🤷🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="NLog: القواعد والمرشحات 


 في confirmit ، نستخدم مكتبة NLog للتسجيل في تطبيقات .NET الخاصة بنا. على الرغم من وجود وثائق لهذه المكتبة ، إلا أنه كان من...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NLog: القواعد والمرشحات</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450728/" style=";text-align:right;direction:rtl"><h1 id="nlog-pravila-i-filtry" style=";text-align:right;direction:rtl">  NLog: القواعد والمرشحات </h1><br><p style=";text-align:right;direction:rtl">  في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">confirmit</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">،</a> نستخدم مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">NLog</a> للتسجيل في تطبيقات .NET الخاصة بنا.  على الرغم من وجود وثائق لهذه المكتبة ، إلا أنه كان من الصعب علي أن أفهم كيف تعمل كل شيء.  في هذه المقالة ، سأحاول شرح كيفية تطبيق القواعد والمرشحات في NLog.  لنبدأ. </p><a name="habracut"></a><br><h2 id="kak-konfigurirovat-nlog" style=";text-align:right;direction:rtl">  كيفية تكوين NLog </h2><br><p style=";text-align:right;direction:rtl">  وسنبدأ بتذكير قليل بما يمكننا القيام به من خلال تكوين NLog.  في أبسط الحالات ، يكون هذا التكوين ملف XML (على سبيل المثال ، NLog.config): </p><br><pre style=";text-align:right;direction:rtl"><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nlog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.nlog-project.org/schemas/NLog.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ColoredConsole"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Access Log|${level:uppercase=true}|${logger}|${message}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">highlight-row</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foregroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ColoredConsole"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common Log|${level:uppercase=true}|${logger}|${message}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">highlight-row</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foregroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"green"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ColoredConsole"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Yellow Log|${level:uppercase=true}|${logger}|${message}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">highlight-row</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">foregroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yellow"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1,target2,target3"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nlog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكنك تنزيل هذا الملف بسطر واحد من التعليمات البرمجية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">LogManager.Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlLoggingConfiguration(<span class="hljs-string"><span class="hljs-string">"NLog.config"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ماذا يمكننا أن نفعل به؟  يمكننا ضبط عدة أجهزة استقبال للرسائل (الهدف) على القاعدة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1,target2,target3"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكننا تحديد مستويات تسجيل هذه القاعدة المطبقة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">levels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Debug,Warn,Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكننا تعيين مرشحات لكل قاعدة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filters</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'Log'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">when</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"contains('${message}','Common')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Ignore"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filters</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  وأخيراً ، يمكننا تحديد القواعد المتداخلة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  حان الوقت لمعرفة كيف يعمل كل شيء. </p><br><h2 id="sozdanie-konfiguracii-loggera" style=";text-align:right;direction:rtl">  إنشاء تكوين مسجل </h2><br><p style=";text-align:right;direction:rtl">  عندما تطلب مثيل المسجل ، </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commonLogger = LogManager.GetLogger(<span class="hljs-string"><span class="hljs-string">"Common"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  NLog إما يأخذ واحدة موجودة من ذاكرة التخزين المؤقت أو يخلق واحدة جديدة (انظر <a href="">هنا</a> ).  في الحالة الأخيرة ، يتم أيضًا تكوين تهيئة للمسجل بالاسم المحدد.  دعونا ننظر في عملية إنشائه. </p><br><p style=";text-align:right;direction:rtl">  باختصار ، تكوين المسجل عبارة عن سلسلة منفصلة من المستقبلات والفلاتر المقابلة لكل مستوى تسجيل ( <code>Trace</code> ، <code>Debug</code> ، <code>Info</code> ، <code>Warn</code> ، <code>Error</code> ، <code>Fatal</code> ) (انظر <a href="">هنا</a> ).  الآن سأريكم كيف بنيت هذه السلاسل. </p><br><p style=";text-align:right;direction:rtl">  الطريقة الرئيسية المسؤولة عن إنشاء هذه السلاسل هي <a href="">GetTargetsByLevelForLogger</a> للفئة <a href="">LogFactory</a> .  هذه هي الطريقة التي يعمل بها.  يتم تحديد جميع القواعد المحددة في تكوين NLog بدوره.  أولاً ، يتم التحقق لمعرفة ما إذا كان اسم القاعدة يطابق اسم المسجل.  يمكن أن تحتوي أسماء القواعد على أحرف بدل ، مثل تلك التي نستخدمها لكائنات نظام الملفات: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>*</code> - تسلسل تعسفي من الشخصيات </li><li style=";text-align:right;direction:rtl"> <code>?</code>  - أي شخصية واحدة </li></ul><br><p style=";text-align:right;direction:rtl">  وبالتالي ، يطابق اسم القاعدة " <code>*</code> " أي اسم مسجل ، ويطابق "عام <code>Common*</code> " جميع أدوات التسجيل التي تبدأ أسماؤها بـ "عام". </p><br><p style=";text-align:right;direction:rtl">  إذا كان اسم القاعدة لا يتطابق مع اسم المسجل ، فسيتم تجاهل هذه القاعدة مع جميع القواعد المضمنة فيه.  وإلا ، فإن أسلوب <code>GetTargetsByLevelForLogger</code> يحصل على جميع مستويات التسجيل التي تم تمكين هذه القاعدة لها.  لكل مستوى من هذه المستويات ، يضيف NLog جميع مستقبلات الرسائل المحددة في القاعدة إلى سلاسل المستقبل المقابلة مع عوامل التصفية لهذه القاعدة. </p><br><p style=";text-align:right;direction:rtl">  هناك ميزة أخرى مهمة في بناء سلاسل الاستقبال.  إذا تم وضع علامة على القاعدة الحالية بشكل <code>final</code> ويتطابق اسمها مع اسم المسجل ، فإن NLog يكمل إنشاء سلاسل لجميع مستويات التسجيل المضمنة في هذه القاعدة.  هذا يعني أنه لا القواعد المتداخلة أو القواعد اللاحقة تضيف أي شيء إلى سلاسل المتلقي هذه.  اكتمال إنشائها بالكامل ولن يتغيروا.  يتبع ذلك أنه لا معنى لكتابة شيء مثل هذا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">final</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لن تصل أي رسائل إلى <code>target2</code> .  لكن من الممكن كتابة شيء مثل هذا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Warn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">final</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نظرًا لعدم تمكين القاعدة الخارجية لمستوى <code>Info</code> ، فلن تنتهي سلسلة المستقبلات لهذا المستوى بالقاعدة الخارجية.  لذلك ، سوف تنقسم جميع الرسائل ذات مستوى <code>Info</code> إلى <code>target2</code> . </p><br><p style=";text-align:right;direction:rtl">  بعد إضافة جميع المستقبلات من هذه القاعدة إلى السلاسل المقابلة ، تعالج الطريقة بشكل متكرر جميع القواعد المتداخلة في القاعدة الحالية وفقًا لنفس الخوارزمية.  يحدث هذا بغض النظر عن مستويات التسجيل الممكّنة للقاعدة الأصل. </p><br><p style=";text-align:right;direction:rtl">  في المجموع ، التكوين للمسجل جاهز.  أنه يحتوي على سلاسل من أجهزة الاستقبال مع مرشحات لكل مستوى ممكن من قطع الأشجار: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/w7/d9/xg/w7d9xg4zr42cablrpx_euxbnria.png" alt="سلسلة الاستقبال"></p><br><p style=";text-align:right;direction:rtl">  حان الوقت لنرى كيف يتم استخدام هذا التكوين. </p><br><h2 id="ispolzovanie-konfiguracii-loggera" style=";text-align:right;direction:rtl">  باستخدام التكوين المسجل </h2><br><p style=";text-align:right;direction:rtl">  لنبدأ بأشياء بسيطة.  فئة <code>Logger</code> لها أسلوب <code>IsXXXEnabled</code> وخصائص <code>IsXXXEnabled</code> المقترنة ( <code>IsDebugEnabled</code> ، <code>IsInfoEnabled</code> ، ...).  كيف تعمل؟  في الواقع ، يقومون ببساطة بالتحقق مما إذا كانت سلاسل المستقبل لمستوى معين من التسجيل تحتوي على رابط واحد على الأقل (انظر <a href="">هنا</a> ).  هذا يعني أن المرشحات لا تؤثر أبدًا على قيم هذه الخصائص. </p><br><p style=";text-align:right;direction:rtl">  بعد ذلك ، اسمحوا لي أن أشرح ما يحدث عندما تحاول تأمين رسالة.  كما كنت قد خمنت ، يأخذ المسجل سلسلة من أجهزة الاستقبال لمستوى تسجيل هذه الرسالة.  ثم يبدأ في معالجة روابط هذه السلسلة واحدة تلو الأخرى.  لكل رابط ، يقرر المسجل ما إذا كان سيتم كتابة الرسالة إلى جهاز الاستقبال المحدد في الارتباط ، وما إذا كان سيستمر في معالجة السلسلة بعد ذلك.  يتم اتخاذ هذه القرارات باستخدام المرشحات.  اسمحوا لي أن أريك كيف تعمل المرشحات في NLog. </p><br><p style=";text-align:right;direction:rtl">  إليك كيفية تكوين المرشحات: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minlevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">writeTo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filters</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'Log'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">when</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"contains('${message}','Common')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Ignore"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filters</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  عادة ما يحتوي المرشح على بعض الحالات المنطقية.  هنا يمكنك أن تقرر ما إذا كان عامل التصفية إرجاع <code>true</code> أو <code>false</code> لكل رسالة.  لكن هذا ليس كذلك.  نتيجة عملهم هي قيمة النوع <a href=""><code>FilterResult</code></a> .  إذا تم إرجاع شرط التصفية إلى <code>true</code> ، تصبح نتيجة التصفية هي القيمة المحددة في سمة <code>action</code> (في مثالنا ، هذا هو <code>Ignore</code> ).  إذا عادت الحالة <code>false</code> ، فستكون نتيجة المرشح <code>Neutral</code> .  هذا يعني أن المرشح لا يريد أن يقرر ما يجب فعله بالرسالة. </p><br><p style=";text-align:right;direction:rtl">  يمكنك أن ترى كيف تتم معالجة سلسلة المتلقي <a href="">هنا</a> .  لكل مستقبل ، يتم حساب نتيجة عوامل التصفية المقابلة في أسلوب <a href=""><code>GetFilterResult</code></a> .  إنه يساوي نتيجة التصفية الأولى التي لم يتم إرجاعها.  هذا يعني أنه إذا كانت بعض المرشحات تُرجع قيمة غير <code>Neutral</code> ، فلن يتم تنفيذ جميع المرشحات التالية. </p><br><p style=";text-align:right;direction:rtl">  ولكن ماذا يحدث إذا عادت جميع المرشحات <code>Neutral</code> ؟  في هذه الحالة ، سيتم استخدام القيمة الافتراضية.  يتم تعيين هذه القيمة باستخدام سمة <code>defaultAction</code> لعنصر <code>filters</code> للقاعدة.  ما رأيك هي القيمة الافتراضية ل <code>defaultAction</code> ؟  أنت محق إذا كنت تعتقد أن هذا <code>Neutral</code> .  وهذا هو ، يمكن أن سلسلة التصفية بأكملها إرجاع <code>Neutral</code> نتيجة لذلك.  في هذه الحالة ، يتصرف NLog بنفس طريقة تلقي <code>Log</code> .  سيتم كتابة الرسالة إلى المتلقي (انظر <a href="">هنا</a> ). </p><br><p style=";text-align:right;direction:rtl">  كما قد تكون خمنت ، إذا <code>IgnoreFinal</code> عامل التصفية <code>Ignore</code> أو <code>Ignore</code> <code>IgnoreFinal</code> ، فلن تتم كتابة الرسالة إلى المتلقي.  إذا كانت نتيجة المرشح هي <code>Log</code> أو <code>LogFinal</code> ، فسيتم تسجيل الرسالة.  ولكن ما هو الفرق بين <code>Ignore</code> و <code>IgnoreFinal</code> وبين <code>Log</code> أو <code>LogFinal</code> ؟  انها بسيطة.  في حالة <code>IgnoreFinal</code> و <code>LogFinal</code> يتوقف NLog عن معالجة سلسلة المستقبل ولا يكتب أي شيء إلى المستقبلات الموجودة في الروابط التالية. </p><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  استنتاج </h2><br><p style=";text-align:right;direction:rtl">  ساعدني تحليل رمز NLog في فهم كيفية عمل القواعد والمرشحات.  آمل أن تكون هذه المقالة مفيدة لك.  حظا سعيدا </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar450728/">https://habr.com/ru/post/ar450728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar450716/index.html">الإعلان عن مهارات رؤية Windows (معاينة)</a></li>
<li><a href="../ar450718/index.html">ما هو الجديد في RxJS v6.5</a></li>
<li><a href="../ar450720/index.html">كيفية تطوير تطبيق سهل الاستعمال</a></li>
<li><a href="../ar450724/index.html">تقديم بيثون للرفاق الذين يتفوقون على "اللغة ضد الخامس" اللغة ب "وغيرها من التحيزات</a></li>
<li><a href="../ar450726/index.html">إنشاء أداة لكتابة autotests بسرعة وكفاءة على السيلينيوم</a></li>
<li><a href="../ar450730/index.html">ok.tech: الواجهة الأمامية ميتوب</a></li>
<li><a href="../ar450732/index.html">أرى ، هذا يعني أنني موجود: مراجعة للتعلم العميق في رؤية الكمبيوتر (الجزء 1)</a></li>
<li><a href="../ar450734/index.html">الانصهار خطوة مهمة في التنمية الآمنة</a></li>
<li><a href="../ar450736/index.html">"عزل الإنترنت أسهل وأرخص بكثير من تزويده بحجب خارجي."</a></li>
<li><a href="../ar450738/index.html">الروبوتات في مركز البيانات: كيف يمكن للذكاء الاصطناعي أن يكون مفيدًا؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>