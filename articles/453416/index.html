<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÇ üëâ üêè C√≥mo funciona la configuraci√≥n en .NET Core üèñÔ∏è üß¢ üë®üèø‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dejemos de hablar sobre DDD y la reflexi√≥n por un tiempo. Propongo hablar sobre lo simple, sobre la organizaci√≥n de la configuraci√≥n de la aplicaci√≥n....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona la configuraci√≥n en .NET Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453416/"><p>  Dejemos de hablar sobre DDD y la reflexi√≥n por un tiempo.  Propongo hablar sobre lo simple, sobre la organizaci√≥n de la configuraci√≥n de la aplicaci√≥n. </p><br><p>  Despu√©s de que mis colegas y yo decidimos cambiarnos a .NET Core, surgi√≥ la pregunta de c√≥mo organizar los archivos de configuraci√≥n, c√≥mo realizar transformaciones, etc. en el nuevo entorno.  El siguiente c√≥digo se encuentra en muchos ejemplos, y muchos lo han utilizado con √©xito. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {   Environment = environment;   Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Pero veamos c√≥mo funciona la configuraci√≥n, y en qu√© casos usar este enfoque, y en qu√© confiar en los desarrolladores de .NET Core.  Pido gato. </p><a name="habracut"></a><br><h2 id="kak-bylo-ranshe">  Como era antes </h2><br><p>  Como cualquier historia, este art√≠culo tiene un comienzo.  Uno de los primeros problemas despu√©s de cambiar a ASP.NET Core fue la transformaci√≥n de los archivos de configuraci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">Recuerde c√≥mo era antes con web.config</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/28/rh/tx/28rhtxxm6uw-67utmgjas0oh0ii.png"></p><br><p>  La configuraci√≥n consisti√≥ en varios archivos.  El archivo principal era <i>web.config</i> , y las transformaciones ( <em>web.Development.config</em> , etc.) ya se le aplicaron, seg√∫n la configuraci√≥n del ensamblado.  Al mismo tiempo, los atributos <em>xml</em> se utilizaron activamente para buscar y transformar la secci√≥n del documento <em>xml</em> . </p></div></div><br><p>  Pero como sabemos en ASP.NET Core, el <em>archivo web.config ha sido</em> reemplazado por <em>appsettings.json</em> y ya no existe el mecanismo de transformaci√≥n habitual. </p><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© nos dice google?</b> <div class="spoiler_text"><p>  El resultado de b√∫squeda para "Transformar en ASP.NET Core" en <em>Google</em> result√≥ en el siguiente c√≥digo: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  En el constructor de la clase <em>Startup</em> , creamos un objeto de configuraci√≥n usando <em>ConfigurationBuilder</em> .  En este caso, indicamos expl√≠citamente qu√© fuentes de configuraci√≥n queremos usar. </p><br><p>  Y tal: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Dependiendo de la variable de entorno, se selecciona una u otra fuente de configuraci√≥n. </p></div></div><br><p>  Estas respuestas a menudo se encuentran en <abbr title="Stackoverflow">SO</abbr> y otros recursos menos populares.  Pero el sentimiento no se fue.  que nos vamos mal  ¬øQu√© sucede si quiero usar variables de entorno o argumentos de l√≠nea de comando en la configuraci√≥n?  ¬øPor qu√© necesito escribir este c√≥digo en cada proyecto? </p><br><p>  En busca de la verdad, tuve que profundizar en la documentaci√≥n y el c√≥digo fuente.  Y quiero compartir el conocimiento adquirido en este art√≠culo. </p><br><p>  Veamos c√≥mo funciona la configuraci√≥n en .NET Core. </p><br><h2 id="konfiguraciya">  Configuracion </h2><br><p>  La configuraci√≥n en .NET Core est√° representada por un <em>objeto de</em> interfaz <em>IConfiguration</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> key] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }  <span class="hljs-function"><span class="hljs-function">IConfigurationSection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;IConfigurationSection&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><ul><li>  indexador <strong>[clave de cadena]</strong> , que permite obtener el valor del par√°metro de configuraci√≥n por clave </li><li>  <strong>GetSection (cadena clave)</strong> devuelve la secci√≥n de configuraci√≥n que corresponde a la tecla <em>clave</em> </li><li>  <strong>GetChildren ()</strong> devuelve un conjunto de subsecciones de la secci√≥n de configuraci√≥n actual </li><li>  <strong>GetReloadToken ()</strong> devuelve una instancia de <em>IChangeToken</em> que se puede usar para recibir notificaciones cuando los cambios de configuraci√≥n </li></ul><br><p>  Una configuraci√≥n es una colecci√≥n de pares clave-valor.  Al leer desde una fuente de configuraci√≥n (archivo, variables de entorno), los datos jer√°rquicos se reducen a una estructura plana.  Por ejemplo, <em>json es un</em> objeto de la forma </p><br><pre> <code class="plaintext hljs">{ "Settings": { "Key": "I am options" } }</code> </pre> <br><p>  se reducir√° a una vista plana: </p><br><pre> <code class="plaintext hljs">Settings:Key = I am options</code> </pre> <br><p>  Aqu√≠, la clave es <em>Configuraci√≥n: Clave</em> , y el valor es <em>I am options</em> . <br>  Los proveedores de configuraci√≥n se utilizan para completar la configuraci√≥n. </p><br><h2 id="provaydery-konfiguracii">  Proveedores de configuraci√≥n </h2><br><p>  Un objeto de interfaz es responsable de leer los datos de la fuente de configuraci√≥n. <br>  <em>IConfigurationProvider</em> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationProvider</span></span> {  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildKeys</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; earlierKeys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parentPath</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><ul><li>  <strong>TryGet (clave de cadena, valor de cadena de salida)</strong> permite obtener el valor del par√°metro de configuraci√≥n por clave </li><li>  <strong>Set (clave de cadena, valor de cadena) se</strong> utiliza para establecer el valor del par√°metro de configuraci√≥n </li><li>  <strong>GetReloadToken ()</strong> devuelve una instancia de <em>IChangeToken</em> que se puede usar para recibir notificaciones cuando cambia una fuente de configuraci√≥n </li><li>  M√©todo <strong>Load ()</strong> que se encarga de leer la fuente de configuraci√≥n </li><li>  <strong>GetChildKeys (IEnumerable &lt;string&gt; previousKeys, string parentPath) le</strong> permite obtener una lista de todas las claves que proporciona este proveedor de configuraci√≥n </li></ul><br><p>  Los siguientes proveedores est√°n disponibles en la caja: </p><br><ul><li>  Json </li><li>  Ini </li><li>  Xml </li><li>  Variables de entorno </li><li>  Memoria </li><li>  Azur </li><li>  Proveedor de configuraci√≥n personalizada </li></ul><br><p>  Se aceptan las siguientes convenciones para usar proveedores de configuraci√≥n. </p><br><ol><li>  Las fuentes de configuraci√≥n se leen en el orden en que se especificaron. </li><li>  Si las mismas claves est√°n presentes en diferentes fuentes de configuraci√≥n (la comparaci√≥n no distingue entre may√∫sculas y min√∫sculas), entonces se utiliza el √∫ltimo valor agregado. </li></ol><br><p>  Si creamos una instancia de un servidor <em>web</em> utilizando <em>CreateDefaultBuilder</em> , los siguientes proveedores de configuraci√≥n est√°n conectados de forma predeterminada: </p><br><p><img src="https://habrastorage.org/webt/pq/0l/5q/pq0l5qp3qultg9xhtg1kvpimj_y.png"></p><br><ul><li>  <strong>ChainedConfigurationProvider a</strong> trav√©s de este proveedor puede obtener valores y claves de configuraci√≥n que otros proveedores de configuraci√≥n han agregado </li><li>  <strong>JsonConfigurationProvider</strong> utiliza archivos <em>json</em> como fuente de configuraci√≥n.  Como puede ver, se agregan tres proveedores de este tipo a la lista de proveedores.  El primero usa <em>appsettings.json</em> como fuente, el segundo <em>usa appsettings. {Environment} .json</em> .  El tercero lee datos de <em>secrets.json</em> .  Si crea la aplicaci√≥n en la configuraci√≥n de <em>lanzamiento</em> , el tercer proveedor no estar√° conectado, ya que no se recomienda usar secretos en el entorno de <em>producci√≥n</em> </li><li>  <strong>EnvironmentVariablesConfigurationProvider</strong> recupera los par√°metros de configuraci√≥n de las variables de entorno </li><li>  <strong>CommandLineConfigurationProvider</strong> permite agregar argumentos de l√≠nea de comando a la configuraci√≥n </li></ul><br><p>  Dado que la configuraci√≥n se almacena como un diccionario, es necesario garantizar la unicidad de las claves.  Por defecto, esto funciona as√≠. </p><br><p>  Si el proveedor <em>CommandLineConfigurationProvider</em> tiene un elemento con la clave clave y el proveedor <em>JsonConfigurationProvider</em> tiene un elemento con la clave clave, el elemento de <em>JsonConfigurationProvider</em> ser√° reemplazado por el elemento de <em>CommandLineConfigurationProvider,</em> ya que est√° registrado en √∫ltimo lugar y tiene una prioridad m√°s alta. </p><br><div class="spoiler">  <b class="spoiler_title">Recordemos un ejemplo desde el principio del art√≠culo.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  No necesitamos crear <em>IConfiguration nosotros mismos</em> para transformar los archivos de configuraci√≥n, ya que esto est√° habilitado de forma predeterminada.  Este enfoque es necesario cuando queremos limitar el n√∫mero de fuentes de configuraci√≥n. </p></div></div><br><h2 id="kastomnyy-provayder-konfiguracii">  Proveedor de configuraci√≥n personalizada </h2><br><p>  Para escribir su proveedor de configuraci√≥n, debe implementar las <em>interfaces</em> <em>IConfigurationProvider</em> e <em>IConfigurationSource</em> .  <em>IConfigurationSource es una</em> nueva interfaz que a√∫n no hemos considerado en este art√≠culo. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-function">IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  La interfaz consta de un √∫nico m√©todo de <em>compilaci√≥n</em> que toma <em>IConfigurationBuilder</em> como par√°metro y devuelve una nueva instancia de <em>IConfigurationProvider</em> . </p><br><p>  Para implementar nuestros proveedores de configuraci√≥n, las clases abstractas <em>ConfigurationProvider</em> y <em>FileConfigurationProvider</em> est√°n disponibles para nosotros.  En estas clases, la l√≥gica de los <em>m√©todos TryGet</em> , <em>Set</em> , <em>GetReloadToken</em> , <em>GetChildKeys</em> ya est√° implementada y queda por implementar solo el m√©todo <em>Load</em> . </p><br><p>  Veamos un ejemplo.  Es necesario implementar la lectura de la configuraci√≥n del archivo <em>yaml</em> , y tambi√©n es necesario que podamos cambiar la configuraci√≥n sin reiniciar nuestra aplicaci√≥n. </p><br><p>  Cree la clase <em>YamlConfigurationProvider</em> y <em>convi√©rtala</em> en heredera de <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre> <br><p>  En el fragmento de c√≥digo anterior, puede observar algunas caracter√≠sticas de la clase <em>FileConfigurationProvider</em> .  El constructor acepta una instancia de <em>FileConfigurationSource</em> , que contiene <em>IFileProvider</em> .  <em>IFileProvider se</em> utiliza para leer un archivo y suscribirse a un evento de cambio de archivo.  Tambi√©n puede observar que el m√©todo <em>Load</em> acepta una <em>secuencia</em> en la que el archivo de configuraci√≥n est√° abierto para lectura.  Este es un m√©todo de la clase <em>FileConfigurationProvider</em> y no est√° en la interfaz <em>IConfigurationProvider</em> . </p><br><p>  Agregue una implementaci√≥n simple que nos permita leer el archivo <em>yaml</em> .  Para leer el archivo, <em>usar√© el</em> paquete <em>YamlDotNet</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Implementaci√≥n YamlConfigurationProvider</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stream.CanSeek) { stream.Seek(<span class="hljs-number"><span class="hljs-number">0L</span></span>, SeekOrigin.Begin); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader streamReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileContent = streamReader.ReadToEnd(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yamlObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DeserializerBuilder() .Build() .Deserialize(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringReader(fileContent)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;; Data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> yamlObject) { FillData(String.Empty, pair); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> prefix, KeyValuePair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; pair</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = String.IsNullOrEmpty(prefix) ? pair.Key.ToString() : <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{prefix}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{pair.Key}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (pair.Value) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: Data.Add(key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; section: { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sectionPair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> section) FillData(pair.Key.ToString(), sectionPair); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> </div></div><br><p>  Para crear una instancia de nuestro proveedor de configuraci√≥n, debe implementar <em>FileConfigurationSource</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Implementaci√≥n de YamlConfigurationSource</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationSource</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationSource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; ReloadOnChange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EnsureDefaults(builder); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationProvider(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p>  Es importante tener en cuenta aqu√≠ que para inicializar las propiedades de la clase base, debe llamar al <em>m√©todo this.EnsureDefaults (constructor)</em> . </p></div></div><br><p>  Para registrar un proveedor de configuraci√≥n personalizado en la aplicaci√≥n, debe agregar la instancia del proveedor a <em>IConfigurationBuilder</em> .  Puede llamar al m√©todo <em>Add</em> desde <em>IConfigurationBuilder</em> , pero inmediatamente <em>sacar√© la l√≥gica de</em> inicializaci√≥n <em>YamlConfigurationProvider</em> en el m√©todo de <em>extensi√≥n</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Implemente YamlConfigurationExtensions</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IConfigurationBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddYaml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IConfigurationBuilder builder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filePath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (builder == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(builder)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(filePath)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(filePath)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder .Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationSource(filePath)); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Llame al m√©todo AddYaml</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { CreateWebHostBuilder(args).Build().Run(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IWebHostBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateWebHostBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> =&gt; WebHost.CreateDefaultBuilder(args) .ConfigureAppConfiguration((context, builder) =&gt; { builder.AddYaml(<span class="hljs-string"><span class="hljs-string">"appsettings.yaml"</span></span>); }) .UseStartup&lt;Startup&gt;(); }</code> </pre> </div></div><br><h2 id="otslezhivanie-izmeneniy">  Seguimiento de cambios </h2><br><p>  En la nueva configuraci√≥n de la <em>API</em> , se hizo posible volver a leer la fuente de configuraci√≥n cuando se cambia.  Al mismo tiempo, la aplicaci√≥n no se reinicia. <br>  C√≥mo funciona </p><br><ul><li>  El proveedor de configuraci√≥n supervisa los cambios en la fuente de configuraci√≥n </li><li>  Si se produce un cambio de configuraci√≥n, se crea un nuevo <em>IChangeToken.</em> </li><li>  Cuando se <em>cambia IChangeToken</em> , se llama una recarga de configuraci√≥n </li></ul><br><p>  Veamos c√≥mo se implementa el seguimiento de cambios en <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs">ChangeToken.OnChange( <span class="hljs-comment"><span class="hljs-comment">//producer () =&gt; Source.FileProvider.Watch(Source.Path), //consumer () =&gt; { Thread.Sleep(Source.ReloadDelay); Load(reload: true); });</span></span></code> </pre> <br><p>  Se pasan dos par√°metros al m√©todo <em>OnChange</em> de la clase est√°tica <em>ChangeToken</em> .  El primer par√°metro es una funci√≥n que devuelve un nuevo <em>IChangeToken</em> cuando <em>cambia</em> la fuente de configuraci√≥n (en este caso el archivo), este es el llamado <em>productor</em> .  El segundo par√°metro es la funci√≥n de <em>devoluci√≥n de llamada</em> (o <em>consumidor</em> ), que se llamar√° cuando se cambie la fuente de configuraci√≥n. <br>  Obtenga m√°s informaci√≥n sobre la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ChangeToken</a> . </p><br><p>  No todos los proveedores de configuraci√≥n implementan el seguimiento de cambios.  Este mecanismo est√° disponible para los descendientes de <em>FileConfigurationProvider</em> y <em>AzureKeyVaultConfigurationProvider</em> . </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  En .NET Core, tenemos un mecanismo f√°cil y conveniente para administrar la configuraci√≥n de la aplicaci√≥n.  Muchos complementos est√°n disponibles de f√°brica, muchas cosas se usan de forma predeterminada. <br>  Por supuesto, cada persona decide de qu√© manera usarlo, pero estoy de acuerdo con el hecho de que las personas conocen sus herramientas. </p><br><p>  Este art√≠culo solo cubre los conceptos b√°sicos.  Adem√°s de lo b√°sico, IOptions, scripts posteriores a la configuraci√≥n, validaci√≥n de configuraciones y mucho m√°s est√°n disponibles para nosotros.  Pero esa es otra historia. </p><br><p>  Puede encontrar el proyecto de aplicaci√≥n con ejemplos de este art√≠culo en el repositorio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> . <br>  Comparta en los comentarios qui√©n usa qu√© enfoques de gesti√≥n de configuraci√≥n. <br>  Gracias por su atencion </p><br><p>  <strong>upd</strong> .: como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">AdAbsurdum</a> sugiri√≥ correctamente, cuando se trabaja con matrices, los elementos no siempre se reemplazar√°n al fusionar una configuraci√≥n de dos fuentes. <br>  Considera un ejemplo.  Al leer una matriz de <em>appsettings.json</em> obtenemos esta vista plana: </p><br><pre> <code class="plaintext hljs">array:0=valueA</code> </pre> <br><p>  Al leer desde <em>appsettings.Development.json</em> : </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  Como resultado, la configuraci√≥n ser√°: </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  Todos los elementos con √≠ndices √∫nicos ( <em>matriz: 1</em> en el ejemplo) se agregar√°n a la matriz resultante.  Los elementos de diferentes fuentes de configuraci√≥n, pero que tengan el mismo √≠ndice ( <em>matriz: 0</em> en el ejemplo) se fusionar√°n, y se utilizar√° el elemento que se agreg√≥ por √∫ltima vez. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453416/">https://habr.com/ru/post/453416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453406/index.html">Bater√≠as modernas para reproductores Sony Discman</a></li>
<li><a href="../453408/index.html">Caja de herramientas para investigadores - Segunda edici√≥n: una colecci√≥n de 15 bancos de datos tem√°ticos</a></li>
<li><a href="../453410/index.html">No arroje bombillas inteligentes a la basura, o el peligro de IoT</a></li>
<li><a href="../453412/index.html">Top 3D Shop se convierte en el distribuidor exclusivo de UFactory</a></li>
<li><a href="../453414/index.html">El auge y la ca√≠da de IEO, todo lo que necesita saber sobre la nueva ola de recaudaci√≥n de fondos</a></li>
<li><a href="../453418/index.html">Lo que necesita saber antes de pasar a Akka toolkit para implementar Event Sourcing y CQRS</a></li>
<li><a href="../453422/index.html">Presentaci√≥n de ITSM: 10 habratopiks y materiales expertos para "inmersi√≥n r√°pida" en el tema</a></li>
<li><a href="../453428/index.html">Aumento de la legibilidad del c√≥digo en el desarrollo de iOS</a></li>
<li><a href="../453430/index.html">Mientras escrib√≠a mi monitoreo</a></li>
<li><a href="../453432/index.html">De la cr√≠tica a los algoritmos: la voz que se desvanece de las √©lites en el mundo de la m√∫sica.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>