<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüé® üëè üë∂üèø Noise Mapping mit KSQL, Raspberry Pi und Radio üßëüèæ‚Äçü§ù‚Äçüßëüèº üêõ üí•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auf den ersten Blick hat diese Geschichte alles, um sich am Vorabend des 8. M√§rz den Status eines romantischen Postens zu verdienen: Flugzeuge, Liebe,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Noise Mapping mit KSQL, Raspberry Pi und Radio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/442876/"><img src="https://habrastorage.org/webt/8h/e_/jp/8he_jpuc-mgf_sarxdvkm3n6xsg.png"><br><br>  Auf den ersten Blick hat diese Geschichte alles, um sich am Vorabend des 8. M√§rz den Status eines romantischen Postens zu verdienen: Flugzeuge, Liebe, ein wenig Spionage und schlie√ülich eine Katze (genauer gesagt eine Katze).  Es ist kaum vorstellbar, dass all dies in direktem Zusammenhang mit Kafka, KSQL und dem Experiment ‚ÄûWie man die lautesten Flugzeuge mithilfe der Heiminformationstechnologie findet‚Äú steht.  Es ist schwierig, aber notwendig: Es war ein solches Experiment, das Simon Obury durchgef√ºhrt hat, und wir haben einen Artikel seiner Urheberschaft mit einer Beschreibung aller Details des Prozesses √ºbersetzt. <br><a name="habracut"></a><br>  Unsere neue Katze namens Snowflake wacht fr√ºh auf.  Die Ger√§usche von Flugzeugen, die √ºber unser Haus fliegen, wecken sie.  Aber was ist, wenn ich mit Apache Kafka, KSQL und Raspberry Pi feststellen kann, welches Flugzeug meine Katze wach h√§lt?  Es w√§re sch√∂n, ein unterhaltsames Tracking-Panel zu erstellen, auf das die Katze ihre Aufmerksamkeit lenken k√∂nnte - und mir etwas mehr Schlaf geben k√∂nnte. <br><br><h3>  Im Allgemeinen </h3> <br><img src="https://habrastorage.org/webt/f8/df/kg/f8dfkgmmkghrnfhtjecrthwx8j8.png"><br>  <i>Mit Kafka und KSQL √ºbertragen wir Flugzeuge vom Himmel auf Grafiken</i> <br><br>  Flugzeuge bestimmen ihren Standort mithilfe von GPS-Empf√§ngern.  Der Bordsender meldet regelm√§√üig den Standort, die Identifikationsnummer, die H√∂he und die Geschwindigkeit des Schiffes mithilfe kurzer Funk√ºbertragungen.  Diese Sendungen der automatischen abh√§ngigen Rundfunk√ºberwachung ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AZN-V</a> ) sind im Wesentlichen Datenpakete, die f√ºr den Zugriff von Bodenstationen offen sind. <br><br>  Ein Mikrocomputer wie der Raspberry Pi und mehrere Zusatzkomponenten sind alles, was ben√∂tigt wird, um Nachrichten von den Bordsendern des Flugzeugs zu empfangen, die √ºber mein Haus huschen. <br><br>  Die Signale des Flugzeugs in der Luft sehen aus wie ein Wirrwarr von Nachrichten und m√ºssen systematisiert werden.  Das Erkennen dieser chaotischen Datenstr√∂me ist wie das Abh√∂ren eines Gespr√§chs auf einer lauten Party.  Um ein Flugzeug zu finden, das meine Katze beunruhigt, habe ich mich f√ºr eine Kombination aus Kafka und KSQL entschieden. <br><br><img src="https://habrastorage.org/webt/om/2c/o0/om2co03tws9dxaml4hsmwrgqzsg.png"><br>  <i>Erwachte Katze und Himbeer-Pi</i> <br><br><h3>  Sammlung von AZN-B-Messwerten mit dem Raspberry Pi </h3><br>  Zum Sammeln von On-Board-√úbertragungen habe ich den Raspberry Pi und RTL2832U verwendet, ein USB-Modem, das urspr√ºnglich als Ger√§t zum Ansehen von digitalem Fernsehen auf einem Computer verkauft wurde.  Auf Raspberry Pi habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dump1090</a> installiert - ein Programm, das mit einer kleinen Antenne Daten von AZN-V √ºber RTL2832U empf√§ngt. <br><br><img src="https://habrastorage.org/webt/_u/dx/rd/_udxrdhg_e8cvqomnkbfkiuvvgm.png"><br>  <i>Mein Software-Radio von Raspberry Pi und RTL2832U</i> <br><br><h3>  Konvertieren Sie AZN-B-Signale in Kafka-Themen </h3><br>  Nachdem ich einen Strom von rohen AZN-B-Signalen erhalten habe, sollten wir auf den Verkehr achten.  Raspberry Pi hat nicht genug Leistung f√ºr ernsthafte Computer, daher musste ich die Datenverarbeitung auf meinen lokalen Cluster auf Kafka √ºbertragen. <br><br><img src="https://habrastorage.org/webt/ar/27/xb/ar27xbolmidgiscrmspvto0vgnk.png"><br><br>  Empfangene Nachrichten werden entweder in <i>Standortnachrichten</i> oder <i>Nachrichten √ºber die Identifizierung der Karte unterteilt</i> .  Der Standort sieht aus wie eine Nachricht der Form: <i>"Das 7c6db8-Board fliegt in einer H√∂he von 6.250 Fu√ü an der Koordinate -33,8,151,0</i> . <i>"</i>  Informationen zur Identifizierung <i>der Karte</i> sehen folgenderma√üen aus: <i>"Die Karte 7c451c fliegt entlang der Route QJE1726."</i> <br><br>  Ein kleines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python-Skript</a> f√ºr meinen Raspberry Pi teilt alle eingehenden AZN-B-Nachrichten.  Ich habe den Confluent Rest Proxy-Proxy verwendet, um Daten vom Raspberry Pi an die Themen " <b>Standortthema"</b> und " <b>Ident-Thema"</b> in Kafka zu verteilen.  Der Proxyserver bietet eine RESTful-Schnittstelle f√ºr den Kafka-Cluster, mit der Nachrichten mithilfe eines einfachen REST-Aufrufs auf Pi einfach erstellt werden k√∂nnen. <br><br><img src="https://habrastorage.org/webt/6d/ox/35/6dox35w1d-qrzyaiowi80kxtglk.png"><br><br>  Ich wollte verstehen, welche Flugzeuge √ºber mein Dach fliegen und welche Routen.  Mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenFlights-</a> Datenbank k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie</a> den von der Internationalen Zivilluftfahrt-Organisation (ICAO) zugewiesenen Flughafencode, beispielsweise 7C6DB8, mit dem Flugzeugtyp vergleichen - in unserem Fall der Boeing 737.  Ich habe meine Kartendaten in das Thema <b>icao-to-Flugzeug</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hochgeladen</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">KSQL</a> bietet eine ‚ÄûSQL-Engine‚Äú, mit der Sie Daten zu Apache Kafka-Themen in Echtzeit verarbeiten k√∂nnen.  Um beispielsweise den integrierten Code 7C6DB8 zu finden, k√∂nnen wir die folgende Abfrage schreiben: <br><br><pre><code class="plaintext hljs">CREATE TABLE icao_to_aircraft WITH (KAFKA_TOPIC='ICAO_TO_AIRCRAFT_REKEY', VALUE_FORMAT='AVRO', KEY='ICAO'); ksql&gt; SELECT manufacturer, aircraft, registration \ FROM icao_to_aircraft \ WHERE icao = '7C6DB8'; Boeing | B738 | VH-VYI</code> </pre> <br>  In √§hnlicher Weise habe ich im Thema Rufzeichendetails die Rufzeichen hochgeladen (d. H. QFA563, dies ist Qantas 'Flug von Brisbane nach Sydney). <br><br><pre> <code class="plaintext hljs">CREATE TABLE callsign_details WITH (KAFKA_TOPIC='CALLSIGN_DETAILS_REKEY', VALUE_FORMAT='AVRO', KEY='CALLSIGN'); ksql&gt; SELECT operatorname, fromairport, toairport \ FROM callsign_details \ WHERE callsign = 'QFA563'; Qantas | Brisbane | Sydney</code> </pre> <br>  Schauen wir uns nun den Datenstrom zum <b>Standortthema an</b> .  Hier k√∂nnen wir einen konstanten Strom eingehender Nachrichten √ºber den Standort eines fliegenden Flugzeugs beobachten. <br><br><pre> <code class="plaintext hljs">kafka-avro-console-consumer --bootstrap-server localhost:9092 --property --topic location-topic {"ico":"7C6DB8","height":"6250","location":"-33.807724,151.091495"}</code> </pre> <br>  Die KSQL-Abfrage sieht folgenderma√üen aus: <br><pre> <code class="plaintext hljs">ksql&gt; SELECT TIMESTAMPTOSTRING(rowtime, 'yyyy-MM-dd HH:mm:ss'), \ ico, height, location \ FROM location_stream \ WHERE ico = '7C6DB8'; 2018-09-19 07:13:33 | 7C6DB8 | 6250.0 | -33.807724,151.091495</code> </pre> <br><h3>  KSQL: Stream Harmonisierung ... </h3><br>  Der wahre Wert von KSQL liegt in der F√§higkeit, eingehende Str√∂me von Standortdaten mit den Quelldaten von Themen zu kombinieren (siehe <a href="">03_ksql.sql</a> ), <a href="">dh</a> n√ºtzliche Informationen zum Rohdatenstrom hinzuzuf√ºgen.  Dies ist einem "Left Join" in einer herk√∂mmlichen Datenbank sehr √§hnlich.  Das Ergebnis ist ein weiteres Kafka-Thema, das ohne eine einzige Zeile Java-Code erstellt wurde! <br><br>  source&gt; CREATE STREAM location_and_details_stream AS \ <br>  SELECT l.ico, l.height, l.location, t.aircraft \ <br>  FROM location_stream l \ <br>  LEFT JOIN icao_to_aircraft t ON l.ico = t.icao; <br>  Zus√§tzlich erhalten Sie eine KSQL-Abfrage.  Der Datenstrom sieht folgenderma√üen aus: <br><br><pre> <code class="plaintext hljs">ksql&gt; SELECT TIMESTAMPTOSTRING(rowtime, 'yy-MM-dd HH:mm:ss') \ , manufacturer \ , aircraft \ , registration \ , height \ , location \ FROM location_and_details_stream; 18-09-27 09:53:28 | Boeing | B738 | VH-YIA | 7225 | -33.821,151.052 18-09-27 09:53:31 | Boeing | B738 | VH-YIA | 7375 | -33.819,151.049 18-09-27 09:53:32 | Boeing | B738 | VH-YIA | 7425 | -33.818,151.048</code> </pre> <br>  Dar√ºber hinaus k√∂nnen wir den <b>Rufzeichen-</b> Eingabestream mit dem festen Thema <b>Rufzeichen_details</b> kombinieren: <br><br><pre> <code class="plaintext hljs">CREATE STREAM ident_callsign_stream AS \ SELECT i.ico \ , c.operatorname \ , c.callsign \ , c.fromairport \ , c.toairport \ FROM ident_stream i \ LEFT JOIN callsign_details c ON i.indentification = c.callsign; ksql&gt; SELECT TIMESTAMPTOSTRING(rowtime, 'yy-MM-dd HH:mm:ss') \ , operatorname \ , callsign \ , fromairport \ , toairport \ FROM ident_callsign_stream ; 18-09-27 13:33:19 | Qantas | QFA926 | Sydney | Cairns 18-09-27 13:44:11 | China Eastern | CES777 | Kunming | Sydney 18-09-27 14:00:54 | Air New Zealand | ANZ110 | Sydney | Auckland</code> </pre> <br>  Jetzt haben wir zwei informative Themen: <br><br><ol><li>  <b>location_and_details_stream</b> , der einen Strom aktualisierter Informationen √ºber den Standort und die Geschwindigkeit des Flugzeugs bereitstellt; </li><li>  <b>ident_callsign_stream</b> , das die Details des Fluges beschreibt, einschlie√ülich der Fluggesellschaft und des Ziels. </li></ol><br>  Mit diesen st√§ndig aktualisierten Themen k√∂nnen wir einige gro√üartige √úbersichtsfenster erstellen.  Ich habe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kafka Connect verwendet</a> , um von KSQL aufgef√ºllte Kafka-Themen in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elasticsearch</a> hochzuladen (vollst√§ndige Skripte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ). <br><br><h3>  Kibana Dashboard </h3><br>  Hier ist ein Beispiel eines √úbersichtsfensters, das den Standort eines Flugzeugs auf einer Karte zeigt.  Dar√ºber hinaus k√∂nnen Sie eine Karte nach Fluggesellschaft, eine Grafik der Flugh√∂he und Wortwolken nach Hauptziel anzeigen.  Die W√§rmekarte zeigt die Bereiche, in denen Flugzeuge konzentriert sind, dh die Bereiche mit dem h√∂chsten Ger√§uschpegel. <br><br><img src="https://habrastorage.org/webt/mh/fz/sy/mhfzsyskws6uoe5s1-b6m9sudzc.gif"><br><br><h3>  Zur√ºck zur Katze </h3><br>  Heute hat mich die Katze gegen 6 Uhr morgens geweckt.  Kann KSQL mir helfen, das Flugzeug zu finden, das zu diesem Zeitpunkt √ºber meinem Haus in einer H√∂he von weniger als 3.500 Fu√ü geflogen ist? <br><br><pre> <code class="plaintext hljs">select timestamptostring(rowtime, 'yyyy-MM-dd HH:mm:ss') , manufacturer , aircraft , registration , height from location_and_details_stream where height &lt; 3500 and rowtime &gt; stringtotimestamp('18-09-27 06:10', 'yy-MM-dd HH:mm') and rowtime &lt; stringtotimestamp('18-09-27 06:20', 'yy-MM-dd HH:mm'); 2018-09-27 06:15:39 | Airbus | A388 | A6-EOD | 2100.0 2018-09-27 06:15:58 | Airbus | A388 | A6-EOD | 3050.0</code> </pre> <br>  Super!  Ich kann um 6:15 Uhr ein Flugzeug √ºber meinem Dach erkennen.  Es stellt sich heraus, dass Snowflake vom Airbus A380 (√ºbrigens ein riesiger Liner) geweckt wurde, der nach Dubai flog. <br><br>  Nur ein paar Tage frei, und Sie haben ein Streaming-Verarbeitungssystem mit KSQL.  So k√∂nnen Sie au√üerdem schnell interessante Datenereignisse finden.  Obwohl Snowflake skeptisch gegen√ºber ihnen sein kann. <br><br><img src="https://habrastorage.org/webt/vs/vf/yp/vsvfypatv-grib-_dstwrco_r2y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442876/">https://habr.com/ru/post/de442876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442864/index.html">Wie alt ist dein Herr?</a></li>
<li><a href="../de442866/index.html">KI, die aus jahrzehntelangen kulinarischen Experimenten trainiert wurde, kreiert neue Gerichte</a></li>
<li><a href="../de442868/index.html">Ein kurzer Ausflug in die K√ºhlsysteme des Rechenzentrums. Vorteile und Nachteile</a></li>
<li><a href="../de442870/index.html">Das Beste der Welt von Angular f√ºr die Woche - Digest Nr. 2 (26. Januar - 7. M√§rz)</a></li>
<li><a href="../de442872/index.html">Wie ich das Osterei im Android-Schutz gefunden habe und keinen Job bei Google bekommen habe</a></li>
<li><a href="../de442880/index.html">Virtuelle Pr√ºfpunkte: Checkliste einrichten</a></li>
<li><a href="../de442882/index.html">[Video] "Piems werden nicht ben√∂tigt" und drei weitere Projektmanagement-Ideen</a></li>
<li><a href="../de442884/index.html">Dank der Technologie k√∂nnen Sie bereits als Person mit dem Auto sprechen</a></li>
<li><a href="../de442886/index.html">Sketch + Node.js: Generieren Sie Symbole f√ºr viele Plattformen und Marken. Teil 2</a></li>
<li><a href="../de442888/index.html">Passen Sie die Auswahl auf reinem CSS an</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>