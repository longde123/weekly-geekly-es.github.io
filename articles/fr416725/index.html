<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§± üìá üö∑ Kotlin DSL: Th√©orie et pratique üëü üë©‚Äçüî¨ üì•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√©velopper des tests d'application n'est pas une exp√©rience agr√©able. Ce processus prend beaucoup de temps, n√©cessite beaucoup de concentration et est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kotlin DSL: Th√©orie et pratique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416725/">  D√©velopper des tests d'application n'est pas une exp√©rience agr√©able.  Ce processus prend beaucoup de temps, n√©cessite beaucoup de concentration et est extr√™mement demand√©.  Le langage Kotlin fournit un ensemble d'outils qui facilite la cr√©ation de votre propre langage orient√© probl√®me (DSL).  Il y a de l'exp√©rience lorsque Kotlin DSL a remplac√© les constructeurs et les m√©thodes statiques pour tester le module de planification des ressources, ce qui a fait de l'ajout de nouveaux tests et de la prise en charge des anciens d'une routine un processus amusant. <br><br>  Au cours de l'article, nous analyserons tous les principaux outils de l'arsenal du d√©veloppeur et comment ils peuvent √™tre combin√©s pour r√©soudre des probl√®mes de test.  Nous irons de la conception du test id√©al au lancement du test le plus approximatif, le plus propre et le plus compr√©hensible pour le syst√®me de planification des ressources bas√© sur Kotlin. <br><br>  L'article sera utile aux ing√©nieurs praticiens, √† ceux qui consid√®rent Kotlin comme un langage pour √©crire confortablement des tests compacts et √† ceux qui souhaitent am√©liorer le processus de test dans leur projet. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q_UM1EY2S5g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Cet article est bas√© sur une pr√©sentation d'Ivan Osipov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">i_osipov</a> ) √† la conf√©rence JPoint.  Une narration suppl√©mentaire est men√©e en son nom.  Ivan travaille comme programmeur √† Haulmont.  Le principal produit de l'entreprise est CUBA, une plate-forme de d√©veloppement d'entreprise et de diverses applications Web.  En particulier, des projets d'impartition sont en cours sur cette plate-forme, parmi lesquels il y a eu r√©cemment un projet dans le domaine de l'√©ducation, dans lequel Ivan s'est engag√© √† √©tablir un calendrier pour un √©tablissement d'enseignement.  Il se trouve que depuis trois ans, Ivan travaille avec les planificateurs d'une mani√®re ou d'une autre, et sp√©cifiquement √† Haulmont, ils testent ce planificateur depuis un an. <br><a name="habracut"></a><br>  Pour ceux qui veulent ex√©cuter des exemples - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gardez un lien vers GitHub</a> .  Sous le lien, vous trouverez tout le code que nous allons analyser, ex√©cuter et √©crire aujourd'hui.  Ouvrez le code et c'est parti! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec3/fa3/670/ec3fa3670fd1c8a3cf7222f7e746933c.jpg"><br><br>  Aujourd'hui, nous discuterons: <br><br><ul><li>  quelles sont les langues ax√©es sur les probl√®mes; <br></li><li>  langages int√©gr√©s ax√©s sur les probl√®mes; <br></li><li>  √©tablir un horaire pour un √©tablissement d'enseignement; <br></li><li>  comment tout est test√© avec Kotlin. <br></li></ul><br>  Aujourd'hui, je vais parler en d√©tail des outils que nous avons dans la langue, vous montrer quelques d√©mos, et nous √©crirons tout le test du d√©but √† la fin.  Dans le m√™me temps, je voudrais √™tre plus objectif, je vais donc parler de certains des inconv√©nients que je me suis identifi√©s lors du d√©veloppement. <br><br>  Commen√ßons par parler du module de cr√©ation de planning.  Ainsi, la construction du planning se d√©roule en plusieurs √©tapes.  Chacune de ces √©tapes doit √™tre test√©e s√©par√©ment.  Vous devez comprendre que malgr√© le fait que les √©tapes sont diff√©rentes, nous avons un mod√®le de donn√©es commun. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/031/be4/27d/031be427d58c5073a3bc619cbed65792.jpg"><br><br>  Ce processus peut √™tre repr√©sent√© comme suit: √† l'entr√©e, il y a des donn√©es avec un mod√®le commun, √† la sortie, il y a un calendrier.  Les donn√©es sont valid√©es, filtr√©es, puis des groupes de formation sont cr√©√©s.  Il s'agit de la mati√®re de l'horaire de l'√©tablissement d'enseignement.  Sur la base des groupes construits et sur la base d'autres donn√©es, nous pla√ßons la le√ßon.  Aujourd'hui, nous ne parlerons que de la derni√®re √©tape - du placement des classes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f64/032/4b1/f640324b1a2ff556a4da892822847a9c.jpg"><br><br>  Un peu sur le test du planificateur. <br><br>  Tout d'abord, comme vous l'avez d√©j√† compris, les diff√©rentes √©tapes doivent √™tre test√©es s√©par√©ment.  On peut distinguer un processus de test plus ou moins standard: il y a l'initialisation des donn√©es, il y a un lancement du planificateur, il y a une v√©rification des r√©sultats de ce planificateur lui-m√™me.  Il existe un grand nombre d'analyses de rentabilisation diff√©rentes qui doivent √™tre couvertes et diff√©rentes situations qui doivent √™tre prises en compte afin que lors de la cr√©ation d'un calendrier, ces situations persistent √©galement. <br><br>  Un mod√®le peut parfois √™tre lourd, et pour cr√©er une seule entit√©, il est n√©cessaire d'initialiser cinq entit√©s suppl√©mentaires, voire plus.  Ainsi, au total, une grande quantit√© de code est obtenue, que nous √©crivons encore et encore pour chaque test.  La prise en charge de ces tests prend beaucoup de temps.  Si vous souhaitez mettre √† jour le mod√®le, et cela se produit parfois, l'√©chelle des modifications affecte les tests. <br><br>  √âcrivons un test: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fda/0f5/94d/fda0f594d14b8043054bcae7fe3315ad.jpg"><br><br>  √âcrivons le test le plus simple pour que vous compreniez g√©n√©ralement l'image. <br>  Qu'est-ce qui vous vient √† l'esprit lorsque vous pensez aux tests?  Ce sont peut-√™tre des tests primitifs de ce type: vous cr√©ez une classe, cr√©ez une m√©thode dedans, marquez-la avec le <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">test d'</a></i> annotation.  En cons√©quence, nous utilisons les capacit√©s de JUnit, et initialisons certaines donn√©es, valeurs par d√©faut, puis valeurs sp√©cifiques aux tests, faisons de m√™me pour le reste du mod√®le, et enfin cr√©ons un objet ordonnanceur, transf√©rez-y nos donn√©es, nous commen√ßons, nous recevons des r√©sultats et nous les v√©rifions.  Processus plus ou moins standard.  Mais il y a √©videmment duplication de code.  La premi√®re chose qui me vient √† l'esprit est la possibilit√© de tout mettre en m√©thodes statiques.  Puisqu'il y a un tas de valeurs par d√©faut, pourquoi ne pas le cacher? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/521/543/590/521543590a00c6101abd4fcefd345e04.jpg"><br><br>  C'est une bonne premi√®re √©tape vers la r√©duction de la duplication. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7f/c57/11c/c7fc5711ccf2a4e9dfb626ea64cffb9b.jpg"><br><br>  En regardant cela, vous comprenez que je voudrais garder le mod√®le plus compact.  Ici, nous avons un mod√®le de g√©n√©rateur dans lequel, quelque part sous le capot, la valeur par d√©faut est initialis√©e et les valeurs sp√©cifiques au test sont initialis√©es juste l√†.  Cela va mieux, cependant, nous √©crivons toujours le code passe-partout, et nous le r√©√©crivons √† chaque fois.  Imaginez 200 tests - vous devez √©crire ces trois lignes 200 fois.  √âvidemment, je voudrais me d√©barrasser de cela d'une mani√®re ou d'une autre.  En d√©veloppant l'id√©e, nous arrivons √† une certaine limite.  Ainsi, par exemple, nous pouvons cr√©er un g√©n√©rateur de mod√®les en g√©n√©ral pour tout. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/259/e9b/7a3/259e9b7a39e84a41466572b38afc280d.jpg"><br><br>  Vous pouvez cr√©er un planificateur de A √† Z jusqu'√† la fin, d√©finir toutes les valeurs dont nous avons besoin, commencer la planification et tout est super.  Si vous regardez cet exemple en d√©tail et l'analysez en d√©tail, il s'av√®re que beaucoup de code inutile est en cours d'√©criture.  Je voudrais rendre les tests plus lisibles afin que vous puissiez y jeter un coup d'≈ìil et les comprendre imm√©diatement, sans plonger dans les sch√©mas, etc. <br><br>  Donc, nous avons du code inutile.  Les math√©matiques simples sugg√®rent qu'il y a 55% de lettres de plus que ce dont nous avons besoin, et je voudrais en quelque sorte m'en √©loigner. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d55/610/ef7/d55610ef71d368b8d16c1fdef35cd2c5.jpg"><br><br>  Apr√®s un certain temps, la prise en charge de nos tests s'av√®re plus co√ªteuse, car vous devez prendre en charge plus de code.  Parfois, si nous ne faisons aucun effort, la lisibilit√© laisse beaucoup √† d√©sirer, ou elle s'av√®re acceptable, mais nous aimerions encore mieux.  Peut-√™tre que plus tard, nous commencerons √† ajouter une sorte de frameworks, biblioth√®ques, pour rendre les tests plus faciles √† √©crire.  Pour cette raison, nous augmentons le niveau d'entr√©e dans le test de notre application.  Ici, nous avons une application d√©j√† compliqu√©e, le niveau d'entr√©e dans ses tests est important et nous l'augmentons encore plus. <br><br><h2>  Test parfait </h2><br>  C'est g√©nial de dire √† quel point tout est mauvais, mais r√©fl√©chissons √† la fa√ßon dont ce serait tr√®s bien.  Un exemple id√©al que nous aimerions obtenir en cons√©quence: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2b/7c5/f48/e2b7c5f48dbd065e95b1617ad10622ba.jpg"><br><br>  Imaginez qu'il y ait une d√©claration dans laquelle nous disons que c'est un test avec un nom sp√©cifique, et nous voulons utiliser un espace pour s√©parer les mots dans le nom, pas CamelCase.  Nous construisons un calendrier, nous avons des donn√©es et les r√©sultats du planificateur sont v√©rifi√©s.  √âtant donn√© que nous travaillons principalement avec Java et que tout le code de l'application principale est √©crit dans ce langage, j'aimerais avoir des capacit√©s de test compatibles.  Je voudrais initialiser les donn√©es aussi clairement que possible pour le lecteur.  Je veux initialiser certaines donn√©es communes et une partie du mod√®le dont nous avons besoin.  Par exemple, cr√©ez des √©l√®ves, des enseignants et d√©crivez quand ils sont disponibles.  Ceci est notre parfait exemple. <br><br><h2>  Langue sp√©cifique au domaine </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/f81/c79/0a9/f81c790a921e43d645fc7380607cf8ea.jpg"><br><br>  En regardant tout cela, il commence √† ressembler √† une sorte de langage orient√© vers les probl√®mes.  Vous devez comprendre ce que c'est et quelle est la diff√©rence.  Les langues peuvent √™tre divis√©es en deux types: les langues √† usage g√©n√©ral (ce que nous √©crivons constamment, r√©solvent absolument toutes les t√¢ches et font face √† absolument tout) et les langues ax√©es sur les probl√®mes.  Ainsi, par exemple, SQL nous aide √† extraire parfaitement les donn√©es de la base de donn√©es, et certains autres langages aident √©galement √† r√©soudre d'autres probl√®mes sp√©cifiques. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f8/e45/2f6/2f8e452f62f39f0f56a2c73e355dddcb.jpg"><br><br>  Une fa√ßon d'impl√©menter des langages orient√©s probl√®me est les langages int√©gr√©s, ou internes.  Ces langues sont impl√©ment√©es sur la base d'une langue √† usage g√©n√©ral.  Autrement dit, plusieurs constructions de notre langage polyvalent forment quelque chose comme une base - c'est ce que nous utilisons lorsque nous travaillons avec un langage orient√© probl√®me.  Dans ce cas, bien s√ªr, une opportunit√© se pr√©sente dans un langage ax√© sur les probl√®mes pour utiliser toutes les fonctionnalit√©s et fonctionnalit√©s qui proviennent d'un langage √† usage g√©n√©ral. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07f/4cb/57f/07f4cb57f84ba884bd558ee8e97202a2.jpg"><br><br>  Encore une fois, jetez un ≈ìil √† notre exemple parfait et pensez √† la langue √† choisir.  Nous avons trois options. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d1d/b21/4b3/d1db214b39b5620875350b382622e662.jpg"><br><br>  La premi√®re option est Groovy.  Un langage merveilleux et dynamique qui a fait ses preuves dans la cr√©ation de langages orient√©s probl√®mes.  Encore une fois, vous pouvez donner un exemple de fichier de construction dans Gradle, que beaucoup d'entre nous utilisent.  Il y a aussi Scala, qui offre un grand nombre de possibilit√©s pour la mise en ≈ìuvre de quelque chose qui leur est propre.  Et enfin, il y a Kotlin, qui nous aide √©galement √† construire un langage orient√© probl√®me, et aujourd'hui il sera discut√©.  Je ne voudrais pas multiplier les guerres et comparer Kotlin √† autre chose, mais cela reste dans votre conscience.  Aujourd'hui, je vais vous montrer ce que Kotlin a pour d√©velopper des langages orient√©s probl√®mes.  Lorsque vous souhaitez comparer cela et dire qu'une langue est meilleure, vous pouvez revenir √† cet article et voir facilement la diff√©rence. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/050/2e7/29e/0502e729ebf030ea5e4d9f038a4b7cc6.jpg"><br><br>  Que nous apporte Kotlin pour d√©velopper un langage orient√© probl√®me? <br><br>  Tout d'abord, c'est un typage statique, et tout ce qui en d√©coule.  Au stade de la compilation, un grand nombre de probl√®mes sont d√©tect√©s, ce qui √©conomise consid√©rablement, en particulier dans le cas o√π vous ne souhaitez pas rencontrer de probl√®mes li√©s √† la syntaxe et √† l'√©criture dans les tests. <br>  Ensuite, il existe un grand syst√®me d'inf√©rence de type qui vient de Kotlin.  C'est merveilleux, car il n'est pas n√©cessaire d'√©crire des types encore et encore, tout est affich√© par le compilateur avec un bang. <br><br>  Troisi√®mement, il existe un excellent support pour l'environnement de d√©veloppement, et cela n'est pas surprenant, car la m√™me soci√©t√© cr√©e l'environnement de d√©veloppement principal pour aujourd'hui, et c'est le cas de Kotlin. <br>  Enfin, √† l'int√©rieur de DSL, nous pouvons √©videmment utiliser Kotlin.  √Ä mon avis, la prise en charge DSL est beaucoup plus facile que la prise en charge des classes utilitaires.  Comme vous le verrez plus tard, la lisibilit√© est l√©g√®rement meilleure que celle des constructeurs.  Ce que j'entends par ¬´mieux¬ª: vous obtenez un peu moins de syntaxe que vous devez √©crire - quelqu'un qui lit votre langage orient√© probl√®me le prendra plus rapidement.  Enfin, √©crire votre v√©lo est beaucoup plus amusant!  Mais en fait, l'impl√©mentation d'un langage ax√© sur les probl√®mes est beaucoup plus facile que l'apprentissage d'un nouveau cadre. <br><br>  Je rappellerai une fois de plus le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers GitHub</a> , si vous voulez √©crire des d√©mos plus loin, alors vous pouvez aller chercher le code sur le lien. <br><br><h2>  Concevoir l'id√©al sur Kotlin </h2><br>  Passons √† la conception de notre id√©al, mais d√©j√† chez Kotlin.  Jetez un ≈ìil √† notre exemple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e3/695/850/5e3695850435a204b9cbb3b94f6f7635.png"><br><br>  Et par √©tapes, nous commencerons √† le reconstruire. <br><br>  Nous avons un test qui se transforme en fonction dans Kotlin, qui peut √™tre nomm√© en utilisant des espaces. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/03d/699/a71/03d699a71ecf86e0e5c03b7a6de57995.png"><br><br>  Nous le marquerons avec l'annotation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Test</a> , qui est disponible pour nous depuis JUnit.  Dans Kotlin, vous pouvez utiliser la forme abr√©g√©e pour √©crire des fonctions et, gr√¢ce √† <i>=,</i> vous d√©barrasser des accolades suppl√©mentaires pour la fonction elle-m√™me. <br><br>  Horaire que nous transformons en bloc.  La m√™me chose se produit avec de nombreux mod√®les, car nous travaillons toujours chez Kotlin. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7b/db9/656/a7bdb965641ca434f1eba5e7781b9b53.png"><br><br>  Passons au reste.  Les accolades apparaissent √† nouveau, nous ne nous en d√©barrasserons pas, mais essayez au moins de nous rapprocher de notre exemple.  En construisant des constructions avec des espaces, nous pourrions en quelque sorte nous affiner et les rendre quelque peu diff√©rents, mais il me semble qu'il vaut mieux faire les m√©thodes habituelles qui encapsuleront le traitement, mais en g√©n√©ral cela sera √©vident pour l'utilisateur . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/378/6e6/eaf/3786e6eafdb8ebd14c344af30698df56.png"><br><br>  Notre √©tudiant se transforme en un bloc dans lequel nous travaillons avec des propri√©t√©s, avec des m√©thodes, et nous continuerons √† analyser cela avec vous. <br><br><img width="600" src="https://habrastorage.org/getpro/habr/post_images/76b/a76/554/76ba76554585689a4c2562167fd26833.png"><br><br>  Enfin, les enseignants.  Ici, nous avons quelques blocs imbriqu√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/deb/a5d/f0a/deba5df0a67a08566e07370bf2f70bc0.png"><br><br>  Dans le code ci-dessous, nous passons aux contr√¥les.  Nous avons besoin de v√©rifier la compatibilit√© avec les langages Java - et oui, Kotlin est compatible avec Java. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8aa/09d/a05/8aa09da05c7c48282e01b0ea409e0f3c.png"><br><br><h2>  Arsenal de d√©veloppement DSL √† Kotlin </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/5f6/113/6ef/5f61136ef41733e6fb88c5ff17d6975f.jpg"><br><br>  Passons √† la liste des outils dont nous disposons.  Ici, j'ai apport√© une tablette, elle r√©pertorie peut-√™tre tout ce qui est n√©cessaire pour d√©velopper des langages ax√©s sur les probl√®mes dans Kotlin.  Vous pouvez lui revenir de temps en temps et lui rafra√Æchir la m√©moire. <br><br>  Le tableau pr√©sente une comparaison de la syntaxe orient√©e probl√®me et de la syntaxe habituelle disponible dans la langue. <br><br><h2>  Lambdas √† Kotlin </h2><br> <code>val lambda: () -&gt; Unit = { }</code> <br> <br>  Commen√ßons par la brique la plus √©l√©mentaire que nous ayons dans Kotlin - ce sont des lambdas. <br>  Aujourd'hui, par type lambda, je veux dire juste un type fonctionnel.  Les lambdas sont d√©not√©s comme suit: <code>( ) -&gt;  </code> . <br><br>  Nous initialisons le lambda √† l'aide d'accolades, √† l'int√©rieur, nous pouvons √©crire du code qui sera appel√©.  Autrement dit, un lambda, en fait, cache simplement ce code en lui-m√™me.  L'ex√©cution d'un tel lambda ressemble √† un appel de fonction, juste des parenth√®ses. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a48/f4d/d49/a48f4dd497c8aa6b93ab2043e014ca02.jpg"><br><br>  Si nous voulons passer une sorte de param√®tre, premi√®rement, nous devons le d√©crire dans le type. <br>  Deuxi√®mement, nous avons acc√®s √† l'identifiant par d√©faut, que nous pouvons utiliser, cependant, si cela ne nous convient pas, nous pouvons d√©finir notre propre nom de param√®tre et les utiliser. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/194/fab/626/194fab62612fb71e6a5f148193ec1ff9.jpg"><br><br>  Dans le m√™me temps, nous pouvons ignorer l'utilisation de ce param√®tre et utiliser le trait de soulignement afin de ne pas produire d'identifiants.  Dans ce cas, pour ignorer l'identifiant, il serait possible de ne rien √©crire du tout, mais dans le cas g√©n√©ral pour plusieurs param√®tres il y a le "_" mentionn√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ff/80e/de2/1ff80ede232393839186b9345065700c.jpg"><br><br>  Si nous voulons passer plus d'un param√®tre, nous devons d√©finir explicitement leurs identifiants. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8d/d2b/952/c8dd2b952caa82b67157f41dc79535b0.jpg"><br><br>  Enfin, que se passera-t-il si nous essayons de passer le lambda √† une fonction et de l'ex√©cuter l√†-bas.  Il ressemble √† l'approximation initiale comme suit: nous avons une fonction √† laquelle nous passons lambda entre accolades, et si dans Kotlin lambda est √©crit comme dernier param√®tre, nous pouvons en quelque sorte le mettre hors de ces accolades. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b80/d7c/0d8/b80d7c0d814f3c51a91f2c224707a2d5.jpg"><br><br>  S'il ne reste plus rien entre crochets, nous pouvons supprimer les crochets.  Ceux qui connaissent Groovy devraient le savoir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74b/5dd/a95/74b5dda953b1df973a8d893f7a615195.jpg"><br><br>  O√π cela s'applique-t-il?  Absolument partout.  Autrement dit, les accolades tr√®s boucl√©s dont nous avons d√©j√† parl√©, nous les utilisons, ce sont les lambdas m√™mes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69e/4bd/781/69e4bd781897ef0515384f81367899cc.jpg"><br><br>  Maintenant, regardons une des vari√©t√©s de lambdas, je les appelle lambdas avec contexte.  Vous trouverez d'autres noms, par exemple, lambda avec r√©cepteur, et ils diff√®rent des lambdas ordinaires lors de la d√©claration d'un type comme suit: √† gauche, nous ajoutons une classe de contexte, il peut s'agir de n'importe quelle classe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bd/375/5b1/8bd3755b1085f3049a7ea32c7cc41f79.jpg"><br><br>  √Ä quoi √ßa sert?  Ceci est n√©cessaire pour qu'√† l'int√©rieur du lambda nous ayons acc√®s au mot-cl√© this - c'est le mot-cl√© lui-m√™me, il nous indique notre contexte, c'est-√†-dire √† un objet que nous avons li√© √† notre lambda.  Ainsi, par exemple, nous pouvons cr√©er un lambda qui produira une cha√Æne, naturellement, nous utiliserons la classe de cha√Æne pour d√©clarer un contexte et l'appel d'un tel lambda ressemblera √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d80/552/181/d80552181518f155fc596c1bb3ddf2aa.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/788/63d/b17/78863db1732d9b92bff62bf82060771a.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/770/a1b/038/770a1b0388cd2380c491cdf5ca8c344c.jpg"><br><br>  Si vous souhaitez passer un contexte en tant que param√®tre, vous pouvez √©galement le faire.  Cependant, nous ne pouvons pas transmettre compl√®tement le contexte, c'est-√†-dire qu'une lambda avec un contexte n√©cessite une attention!  - le contexte, oui.  Que se passe-t-il si nous commen√ßons √† passer un lambda avec un contexte √† une m√©thode?  Ici, nous regardons √† nouveau notre m√©thode exec: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/15b/f36/3d9/15bf363d94919f7c73d775c5d28c6c53.jpg"><br><br>  Renommez-le en m√©thode √©tudiant - rien n'a chang√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e12/4cc/e3b/e124cce3bd7bdb776c3e946edf8ec52c.jpg"><br><br>  Nous passons donc progressivement √† notre construction, la construction √©tudiante, qui sous les accolades cache toute l'initialisation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eba/286/8b3/eba2868b306f476c35df51d8af500335.jpg"><br><br>  Voyons cela.  Nous avons une sorte de fonction √©tudiant qui prend un lambda avec le contexte √©tudiant. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3f/954/e2a/d3f954e2a7016ecf31a081559674d01f.jpg"><br><br>  De toute √©vidence, nous avons besoin de contexte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/4d8/3be/3624d83be81ee01223ad758e9e81c94d.jpg"><br><br>  Ici, nous cr√©ons un objet et ex√©cutons ce lambda dessus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cab/d4a/940/cabd4a940deacfcdcb680c4916b29eae.jpg"><br><br>  Par cons√©quent, nous pouvons √©galement initialiser certaines valeurs par d√©faut avant de lancer le lambda, nous encapsulons donc tout ce dont nous avons besoin pour la fonction. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b4/572/421/0b457242103fc70de806c9de62234135.jpg"><br><br>  Pour cette raison, √† l'int√©rieur du lambda, nous avons acc√®s au mot-cl√© this - c'est pourquoi, probablement, il y a des lambdas avec contexte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1b/819/fdb/b1b819fdb7488092550b2ac72265cd72.jpg"><br><br>  Naturellement, nous pouvons nous d√©barrasser de ce mot-cl√© et nous avons la possibilit√© d'√©crire de telles constructions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50d/dbc/492/50ddbc4920ffb871918ce7c063a874a2.jpg"><br><br>  Encore une fois, si nous avons non seulement des m√©thodes propri√©taires, mais aussi certaines m√©thodes, nous pouvons √©galement les appeler, cela semble assez naturel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b72/155/316/b72155316d99a7e4816d1234644b761b.jpg"><br><br><h2>  Candidature </h2><br>  Tous ces lambdas dans le code sont des lambdas de contexte.  Il existe un grand nombre de contextes, ils se recoupent d'une mani√®re ou d'une autre et nous permettent de construire notre langage orient√© probl√®me. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/83a/f30/2ff/83af302ff3c0a85db220c70f0d567743.jpg"><br><br>  R√©sumant les lambdas - nous avons des lambdas ordinaires, il y en a avec le contexte, et ceux-ci et d'autres peuvent √™tre utilis√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcc/1ac/dfc/fcc1acdfc43284500c38884d88212877.jpg"><br><br><h2>  Les op√©rateurs </h2><br>  Kotlin dispose d'un ensemble limit√© d'op√©rateurs que vous pouvez remplacer √† l'aide des conventions et du mot cl√© operator. <br><br>  Regardons l'enseignant et son accessibilit√©.  Supposons que nous disons que l'enseignant travaille le lundi √† partir de 8 heures du matin pendant 1 heure.  Nous voulons √©galement dire que, en plus de cette heure, cela fonctionne √† partir de 13h00 pendant 1 heure.  Je voudrais exprimer cela en utilisant l'op√©rateur <b>+</b> .  Comment cela peut-il se faire? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/17b/360/9ab/17b3609ab2ebd28cf27f906934536e05.jpg"><br><br>  Il existe une m√©thode de disponibilit√© qui accepte un lambda avec un contexte <code>AvailabilityTable</code> .  Cela signifie qu'il existe une classe qui s'appelle ainsi et que la m√©thode du lundi est d√©clar√©e dans cette classe.  Cette m√©thode renvoie <code>DayPointer</code> depuis  vous devez attacher notre op√©rateur √† quelque chose. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/721/aea/73d/721aea73d36a41cf3dbecd328b1f5ab5.jpg"><br><br>  Voyons ce qu'est DayPointer.  Ceci est un pointeur vers le tableau de disponibilit√© de certains enseignants, et la journ√©e est √† son horaire.  Nous avons √©galement une fonction temporelle qui transformera en quelque sorte certaines lignes en indices entiers: dans Kotlin, nous avons une classe <code>IntRange</code> pour cela. <br><br>  √Ä gauche se trouve <code>DayPointer</code> , √† droite se trouve le temps, et nous aimerions les combiner avec l'op√©rateur <b>+</b> .  Pour ce faire, vous pouvez cr√©er notre op√©rateur dans la classe <code>DayPointer</code> .  Il faudra une plage de valeurs de type Int et retourner <code>DayPointer</code> pour que nous puissions encha√Æner notre DSL encore et encore. <br>  Maintenant, jetons un coup d'≈ìil √† la conception cl√© par laquelle tout commence, par laquelle commence notre DSL.  Sa mise en ≈ìuvre est l√©g√®rement diff√©rente, et maintenant nous allons le d√©couvrir. <br>  Kotlin a un concept singleton int√©gr√© √† la langue.  Pour ce faire, au lieu du mot-cl√© class, le mot-cl√© <code>object</code> est utilis√©.  Si nous cr√©ons une m√©thode √† l'int√©rieur d'un singleton, nous pouvons y acc√©der de telle mani√®re qu'il n'est pas n√©cessaire de recr√©er une instance de cette classe.  Nous nous y r√©f√©rons simplement comme une m√©thode statique dans une classe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3d/226/065/d3d2260651fc4049ec8d3e6878a0cc51.jpg"><br><br>  Si vous regardez le r√©sultat de la d√©compilation (c'est-√†-dire, dans l'environnement de d√©veloppement, cliquez sur Outils -&gt; Kotlin -&gt; Afficher le bytecode Kotlin -&gt; D√©compiler), vous pouvez voir l'impl√©mentation singleton suivante: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/8c9/577/3c68c957760612b06a5b008c734ddb33.jpg"><br><br>  C'est juste une classe ordinaire, et rien de surnaturel ne se passe ici. <br>  Un autre outil int√©ressant est l'instruction <code>invoke</code> .  Imaginez que nous avons une classe A, nous avons son instance, et nous aimerions ex√©cuter cette instance, c'est-√†-dire appeler des parenth√®ses sur un objet de cette classe, et nous pouvons le faire gr√¢ce √† l'op√©rateur <code>invoke</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25f/3a1/f95/25f3a1f95c8c61dcb4937822bd9578e6.jpg"><br><br>  En fait, les parenth√®ses nous permettent d'appeler la m√©thode invoke et ont un modificateur d'op√©rateur.  Si nous passons un lambda avec contexte √† cet op√©rateur, alors nous obtenons une telle construction. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6b/61d/675/b6b61d67518cb1dc730bce8e309ae0dc.jpg"><br><br>  La cr√©ation d'instances √† chaque fois est une autre activit√©, nous pouvons donc combiner les connaissances ant√©rieures et actuelles. <br><br>  Faisons un singleton, appelons-le planning, √† l'int√©rieur de celui-ci nous d√©clarerons l'op√©rateur invoke, √† l'int√©rieur nous cr√©erons un contexte, et il acceptera un lambda avec le contexte que nous cr√©ons ici.  Il s'av√®re qu'un seul point d'entr√©e dans notre DSL, et, par cons√©quent, nous obtenons la m√™me construction - calendrier avec des accolades boucl√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53a/41f/7d8/53a41f7d8e9067b6ce850045e745fb4f.jpg"><br><br>  Eh bien, nous avons parl√© de calendrier, jetons un ≈ìil √† nos ch√®ques. <br>  Nous avons des professeurs, nous avons construit une sorte d'horaire, et nous voulons v√©rifier que dans l'horaire de cet enseignant un certain jour dans une certaine le√ßon, il y a un objet avec lequel nous allons travailler. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22d/0e3/9ef/22d0e39ef38ceb43fd60654de876691b.jpg"><br><br>  Je voudrais utiliser des crochets et acc√©der √† notre calendrier d'une mani√®re qui ressemble visuellement √† l'acc√®s aux tableaux. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/895/b9e/1e6895b9ed089ed99d4c2639e6e1f578.jpg"><br><br>  Cela peut √™tre fait en utilisant l'op√©rateur: get / set: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/815/9f5/a86/8159f5a8628b6c5bb21d219e395ea32b.jpg"><br><br>  Ici, nous ne faisons rien de nouveau, suivez simplement les conventions.  Dans le cas de l'op√©rateur set, nous devons √©galement transmettre les valeurs √† notre m√©thode: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c8/03d/2f2/4c803d2f20ed8b7f79e308d47b734bd9.jpg"><br><br>  Ainsi, les crochets pour la lecture se transforment en get, et les crochets √† travers lesquels nous attribuons se transforment en set. <br><br><h2>  D√©mo: objet, op√©rateurs </h2><br>  Vous pouvez lire un texte suppl√©mentaire ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">regarder la vid√©o ici</a> .  La vid√©o a une heure de d√©but claire, mais aucune heure de fin n'est sp√©cifi√©e - en principe, une fois d√©marr√©e, vous pouvez la regarder avant la fin de l'article. <br><br>  Pour plus de commodit√©, je d√©crirai bri√®vement l'essence de la vid√©o directement dans le texte. <br><br>  √âcrivons un test.  Nous avons un objet de planification, et si nous allons √† son impl√©mentation via ctrl + b, nous verrons tout ce dont j'ai parl√© auparavant. <br><br><img src="https://habrastorage.org/webt/uk/pg/0d/ukpg0djbwn_hfyq4a7g9usa65aa.png"><br><br>  √Ä l'int√©rieur de l'objet de planification, nous voulons initialiser les donn√©es, puis effectuer quelques v√©rifications, et dans les donn√©es, nous aimerions dire que: <br><br><ul><li>  notre √©cole est ouverte √† partir de 8 heures du matin; <br></li><li>  il y a un certain ensemble d'articles pour lesquels nous allons construire un calendrier; <br></li><li>  il y a des enseignants qui ont d√©crit une sorte d'accessibilit√©; <br></li><li>  avoir un √©tudiant; <br></li><li>  en principe, pour un √©tudiant, il suffit de dire qu'il √©tudie une mati√®re sp√©cifique. <br></li></ul><br><img src="https://habrastorage.org/webt/v_/mq/ia/v_mqia50010hyrqza7zubejj62e.png"><br><br>  Et ici, l'un des inconv√©nients de Kotlin et des langages orient√©s probl√®me se manifeste en principe: il est assez difficile de traiter certains objets que nous avons cr√©√©s plus t√¥t.  Dans cette d√©mo, je vais tout indiquer comme des indices, c'est-√†-dire que rus est l'indice 0, les math√©matiques est l'indice 2. Et l'enseignant dirige naturellement quelque chose.  Il ne va pas seulement au travail, mais il est engag√© dans quelque chose.  Pour les lecteurs de cet article, je voudrais offrir une autre option pour l'adressage, vous pouvez cr√©er des balises uniques et y stocker des entit√©s dans Map, et lorsque vous devez acc√©der √† l'une d'entre elles, vous pouvez toujours la trouver par balise.  Continuez √† d√©monter la DSL. <br><br>  Ici, ce qu'il faut noter: tout d'abord, nous avons l'op√©rateur +, √† la mise en ≈ìuvre duquel nous pouvons √©galement aller et voir que nous avons effectivement la classe DayPointer, qui nous aide √† lier tout cela avec l'aide de l'op√©rateur. <br><br>  Et gr√¢ce au fait que nous avons acc√®s au contexte, l'environnement de d√©veloppement nous dit que dans notre contexte √† travers le mot-cl√© this, nous avons acc√®s √† une collection, et nous allons l'utiliser. <br><br><img src="https://habrastorage.org/webt/l_/3q/uw/l_3quwu2xaqlxikn71jhpnnero4.png"><br><br>  Autrement dit, nous avons une collection d'√©v√©nements.  L'√©v√©nement encapsule un ensemble de propri√©t√©s, par exemple: qu'il y a un √©tudiant, un enseignant, quel jour ils se rencontrent √† quelle le√ßon. <br><br><img src="https://habrastorage.org/webt/fn/1f/xa/fn1fxa5legi4mwszf5xbudchoi0.png"><br><br>  Nous continuons √† √©crire le test plus loin. <br><br><img src="https://habrastorage.org/webt/vj/bt/s9/vjbts9wb6fely-atqa-kr88i9qm.png"><br><br>  Ici encore, nous utilisons l'op√©rateur get; ce n'est pas si facile d'acc√©der √† son impl√©mentation, mais nous pouvons le faire. <br><br><img src="https://habrastorage.org/webt/iz/gd/dv/izgddvy3bomaqjp_6yvbfrbcgpe.png"><br><br>  En fait, nous suivons simplement l'accord, nous avons donc acc√®s √† cette conception. <br>  Revenons √† la pr√©sentation et continuons la conversation sur Kotlin.  Nous voulions que les contr√¥les soient mis en ≈ìuvre sur Kotlin, et nous avons v√©cu ces √©v√©nements: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4f/f23/a77/b4ff23a77974a299ecac5c1c3b5d984f.jpg"><br><br>  Un √©v√©nement est essentiellement un ensemble encapsul√© de 4 propri√©t√©s.  Je voudrais d√©composer cet √©v√©nement en un ensemble de propri√©t√©s, comme un tuple.  En russe, une telle construction est appel√©e <i>multi-d√©claration</i> (je n'ai trouv√© qu'une telle traduction), ou <i>d√©claration de d√©structuration</i> , et elle fonctionne comme suit: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2c/185/5f1/f2c1855f1ee98b51a4bda6ce9cc0b0a8.jpg"><br><br>  Si l'un d'entre vous n'est pas familier avec cette fonctionnalit√©, cela fonctionne comme ceci: vous pouvez prendre l'√©v√©nement, et √† l'endroit o√π il est utilis√©, √† l'aide de parenth√®ses, le d√©composer en un ensemble de propri√©t√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/444/95f/0a3/44495f0a381b71a20578736f0cb491af.jpg"><br><br>  Cela fonctionne parce que nous avons une m√©thode componentN, c'est-√†-dire que c'est une m√©thode qui est g√©n√©r√©e par le compilateur gr√¢ce au modificateur de donn√©es que nous √©crivons avant la classe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/126/db9/d78/126db9d789acf9b3482f314d5a53261f.jpg"><br><br>  Parall√®lement √† cela, un grand nombre d'autres m√©thodes nous parviennent.  Nous nous int√©ressons √† la m√©thode componentN, qui est g√©n√©r√©e √† partir des propri√©t√©s list√©es dans la liste des param√®tres du constructeur primaire. <br><br><img src="https://habrastorage.org/webt/hd/nf/ou/hdnfoutg14046a351gjyhodfprc.png"><br><br>  Si nous n'avions pas de modificateur de donn√©es, il faudrait √©crire manuellement un op√©rateur qui fera la m√™me chose. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2b/37f/a2f/e2b37fa2fad7cd8e201987c32fbf572b.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e59/bc7/479/e59bc7479e66cd96c4d0d5093ef33608.jpg"><br><br>  Donc, nous avons quelques m√©thodes componentN, et elles se d√©composent en un tel appel: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96a/cae/aa9/96acaeaa91222d55c4a77b70c9b02903.jpg"><br><br>  En substance, c'est du sucre syntaxique qui fait appel √† plusieurs m√©thodes. <br><br>  Nous avons d√©j√† parl√© d'un tableau de disponibilit√© et, en fait, je vous ai tromp√©.  √áa arrive.  Aucune <code>avaiabilityTable</code> n'existe, elle n'est pas dans la nature, mais il existe une matrice de valeurs bool√©ennes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/393/d7d/5d7/393d7d5d739ea9cecedadff695ca6874.jpg"><br><br>  Aucune classe suppl√©mentaire n'est n√©cessaire: vous pouvez prendre la matrice des valeurs bool√©ennes et la renommer pour plus de nettet√©.  Cela peut √™tre fait en utilisant les soi-disant <i>typealias</i> ou <i>alias de type</i> .  Malheureusement, nous n'obtenons aucun bonus suppl√©mentaire, c'est juste un changement de nom.  Si vous prenez la disponibilit√© et la renommez √† la matrice des valeurs bool√©ennes, rien ne changera du tout.  Le code a fonctionn√© et fonctionnera. <br><br>  Jetons un ≈ìil au professeur, c'est exactement cette accessibilit√©, et parlons de lui: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/521/031/f59/521031f59a8e7b222c2614b32ba88abd.jpg"><br><br>  Nous avons un professeur, et la m√©thode de disponibilit√© est appel√©e (n'avez-vous pas encore perdu le fil du raisonnement? :-).  D'o√π venait-il?  Autrement dit, un enseignant est une sorte d'entit√© qui a une classe, et c'est un code d'entreprise.  Et il ne peut y avoir de m√©thode suppl√©mentaire. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54e/044/683/54e0446838b2360d695b45e5bacec69d.jpg"><br><br>  Cette m√©thode appara√Æt en raison des fonctions d'extension.  Nous prenons et attachons √† notre classe une autre fonction que nous pouvons ex√©cuter sur les objets de cette classe. <br>  Si nous passons du lambda √† cette fonction, puis l'ex√©cutons sur une propri√©t√© existante, alors tout va bien - la m√©thode de disponibilit√© dans son impl√©mentation initialise la propri√©t√© de disponibilit√©.  Vous pouvez vous en d√©barrasser.  Nous connaissons d√©j√† l'op√©rateur invoke, qui peut √™tre attach√© √† un type, et en m√™me temps √™tre une fonction d'extension.  Si vous passez un lambda √† cet op√©rateur, alors l√†, sur le mot-cl√© this, nous pouvons ex√©cuter ce lambda.  Par cons√©quent, lorsque nous travaillons avec un enseignant, l'accessibilit√© est une propri√©t√© de l'enseignant, et non une m√©thode suppl√©mentaire, et aucun rassynchronisme ne se produit ici. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d6/1af/f71/4d61aff7169c403c75493790720c0e6e.jpg"><br><br>  En prime, des fonctions d'extension peuvent √™tre cr√©√©es pour les types nullables.  C'est bien, car s'il existe une variable avec un type nullable contenant une valeur nulle, notre fonction est d√©j√† pr√™te pour cela et ne tombera pas de NullPointer.  Dans cette fonction, cela peut √™tre nul et cela doit √™tre g√©r√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59a/e33/1c5/59ae331c58bcd16003f51f870b89549e.jpg"><br><br>  R√©sum√© des fonctions d'extension: vous devez comprendre qu'il n'y a acc√®s qu'√† l'API publique de la classe et que la classe elle-m√™me n'est en aucune fa√ßon modifi√©e.  Une fonction d'extension est d√©termin√©e par le type de la variable et non par le type r√©el.  De plus, un membre de la classe avec la m√™me signature sera prioris√©.  Vous pouvez cr√©er une fonction d'extension pour une classe, mais l'√©crire dans une classe compl√®tement diff√©rente, et √† l'int√©rieur de cette fonction d'extension, vous aurez acc√®s √† deux contextes simultan√©ment.  Il s'av√®re que l'intersection des contextes.  Et enfin, c'est une excellente occasion de prendre et de fixer les op√©rateurs en g√©n√©ral √† n'importe quel endroit o√π nous voulons. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a04/1e8/610/a041e86102be21acf2c3170cf941d064.jpg"><br><br>  L'outil suivant est les fonctions d'infixation.  Un autre marteau dangereux entre les mains du d√©veloppeur.  Pourquoi dangereux?  Ce que vous voyez, c'est du code.  Un tel code peut √™tre √©crit en Kotlin, et ne le faites pas!  Veuillez ne pas le faire.  N√©anmoins, l'approche est bonne.  Gr√¢ce √† cela, il est possible de se d√©barrasser des points, des crochets - de toute cette syntaxe bruyante, dont nous essayons de nous √©loigner le plus possible et de rendre notre code un peu plus propre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/909/8c3/4a0/9098c34a06b09bac0597004c6fbf6b1a.jpg"><br><br>  Comment √ßa marche?  Prenons un exemple plus simple - une variable enti√®re.  Cr√©ons une fonction d'extension pour cela, appelons-la shouldBeEqual, cela fera quelque chose, mais ce n'est pas int√©ressant.  Si nous ajoutons le modificateur infixe √† sa gauche, cela suffit.  Vous pouvez vous d√©barrasser des points et des crochets, mais il y a quelques nuances. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/39e/fc2/31f/39efc231fb88cee1ef014a36fcb6cc73.jpg"><br><br>  Sur cette base, seule la construction de donn√©es et d'assertions est impl√©ment√©e, attach√©e ensemble. <br><img src="https://habrastorage.org/getpro/habr/post_images/80f/6dd/126/80f6dd126255196fc538026ea28656c1.jpg"><br><br>  Voyons cela.  Nous avons un SchedulingContext - le contexte g√©n√©ral de la planification du d√©marrage.  Il existe une fonction de donn√©es qui renvoie le r√©sultat de cette planification.  En m√™me temps, nous cr√©ons une fonction d'extension et en m√™me temps les assertions de la fonction infixe, ce qui lancera un lambda qui v√©rifie nos valeurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/449/74c/fe5/44974cfe559d94d17e6435557757af80.jpg"><br><br>  Il y a un sujet, un objet et une action, et vous devez en quelque sorte les connecter.  Dans ce cas, le r√©sultat de l'ex√©cution des donn√©es avec des accolades est le sujet.  La lambda que nous transmettons √† la m√©thode des assertions est un objet, et la m√©thode des assertions elle-m√™me est une action.  Tout cela semble se coller. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/aac/4e9/518aac4e9d92ca84a79e6cdb09fea773.jpg"><br><br>  En parlant d'infixe de fonction, il est important de comprendre qu'il s'agit d'une √©tape pour se d√©barrasser de la syntaxe bruyante.  Cependant, nous devons avoir un sujet et un objet de cette action, et nous devons utiliser le modificateur infixe.  Il peut y avoir exactement un param√®tre - c'est-√†-dire, z√©ro param√®tre ne peut pas √™tre, deux ne peuvent pas √™tre, trois - eh bien, vous comprenez.  Vous pouvez passer, par exemple, des lambdas √† cette fonction, et de cette mani√®re, des constructions que vous n'avez pas vues auparavant sont obtenues. <br><br>  Passons √† la prochaine d√©mo.  Il vaut mieux regarder la vid√©o et ne pas lire le texte. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q_UM1EY2S5g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Maintenant, tout semble pr√™t: l'infixe de fonction que vous avez vu, l'extension de la fonction que vous avez vue, la d√©claration de d√©structuration est pr√™te. <br><br>  Revenons √† notre pr√©sentation, et ici nous allons passer √† un point assez important lors de la construction de langages orient√©s probl√®me - ce √† quoi vous devriez penser est le contr√¥le de contexte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/0d3/57a/9ff0d357a3e39d01bcb3d5d07d81d71e.jpg"><br><br>  Il y a des situations o√π nous pouvons prendre DSL et le r√©utiliser directement √† l'int√©rieur, mais nous ne voulons pas le faire.  Notre utilisateur (peut-√™tre un utilisateur inexp√©riment√©) √©crit des donn√©es dans des donn√©es, et cela n'a aucun sens.  Nous voudrions en quelque sorte lui interdire de le faire. <br><br>  Avant Kotlin version 1.1, nous devions faire ce qui suit: en r√©ponse au fait que nous avons une m√©thode de donn√©es dans <code>SchedulingContext</code> , nous avons d√ª cr√©er une autre m√©thode de donn√©es dans <code>DataContext</code> , dans laquelle nous acceptons un lambda (bien que sans impl√©mentation), nous devons marquer cette m√©thode annotation <code>@Deprecated</code> et dire au compilateur de ne pas le compiler.  Vous voyez que cette m√©thode d√©marre - ne compilez pas.  En utilisant cette approche, nous obtenons m√™me un message significatif lorsque nous √©crivons du code sans signification. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dfb/7a7/0b4/dfb7a70b4fba1c5cb0bf37715a4fe1bd.jpg"><br><br>  Apr√®s la version Kotlin 1.1, une merveilleuse annotation <code>@DslMarker</code> .  Cette annotation est n√©cessaire pour signaler les annotations d√©riv√©es.  Avec eux, √† notre tour, nous d√©limiterons les langages ax√©s sur les probl√®mes.  Pour chaque langue orient√©e probl√®me, vous pouvez cr√©er une annotation que vous marquez <code>@DslMarker</code> et la suspendre √† chaque contexte n√©cessaire.  Il n'est plus n√©cessaire d'√©crire des m√©thodes suppl√©mentaires dont la compilation doit √™tre interdite - tout fonctionne simplement.  Non compil√©. <br><br>  Cependant, il existe un tel cas particulier lorsque nous travaillons avec notre mod√®le commercial.  Il est g√©n√©ralement √©crit en Java.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un contexte, il y a une annotation qui doit √™tre marqu√©e comme contexte. </font><font style="vertical-align: inherit;">Selon vous, quel est le contexte de l'√©l√®ve dans la m√©thode? </font><font style="vertical-align: inherit;">Classe </font></font><code>Student</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ceci fait partie de notre mod√®le √©conomique, Kotlin n'est pas l√†. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c6/111/c5c/4c6111c5c80ab5c4856e68c06880ed4a.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc3/572/a05/cc3572a054dabbe4e32362d845b30cf8.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous aimerions √©galement contr√¥ler cette situation, car dans ce cas, il y a acc√®s au design suivant: cr√©er un √©tudiant √† l'int√©rieur des √©tudiants. </font><font style="vertical-align: inherit;">Je ne veux pas vous amener √† faire des associations incorrectes, mais nous voulons l'interdire, c'est faux. </font></font><br><br><img width="100%" src="https://habrastorage.org/getpro/habr/post_images/2fd/77d/125/2fd77d1250c0677a24c1c9c358f11663.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons trois options.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez tout un contexte responsable pour notre √©l√®ve. </font><font style="vertical-align: inherit;">Appelons cela StudentContext. </font><font style="vertical-align: inherit;">Nous d√©crivons toutes les propri√©t√©s l√†-bas, puis nous allons cr√©er un √©tudiant sur la base de celui-ci. </font><font style="vertical-align: inherit;">Une sorte de folie - un tas de code est en cours d'√©criture, probablement plus que pour la production.</font></font><br></li><li>   ‚Äì      ,    ,     .        .  StudentContext  ,      IStudent       .  ,       Student,        IStudent  StudentContext.   DslMarker  ,  . <br></li><li>  :   deprecated     .   ,   .       ,   .       extension-,     .       . <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/9ea/10d/d6a/9ea10dd6af4495be38653339010e0a46.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, m√™me √† ce niveau, vous pouvez contr√¥ler le contexte, mais avec certaines limitations qui doivent √™tre contourn√©es. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d7/9f9/53f/1d79f953fc755000013d44d15f56fb73.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sum√© sur le contr√¥le de contexte. </font><font style="vertical-align: inherit;">Prot√©gez vos utilisateurs contre les erreurs. </font><font style="vertical-align: inherit;">Il est clair que les utilisateurs ne commettront pas d'erreurs, car cela est √©vident, mais il est toujours souhaitable de le contr√¥ler. </font><font style="vertical-align: inherit;">De plus, la mise en place d'un tel contr√¥le ne prend pas autant de temps et d'argent. </font><font style="vertical-align: inherit;">Utilisez l'annotation @DslMarker avec laquelle vous marquez vos propres annotations. </font><font style="vertical-align: inherit;">Dans les situations o√π vous ne pouvez pas utiliser l'annotation @DslMarker, utilisez l'annotation @Deprecated, cela vous aidera √† contourner les cas qui ne fonctionnent pas encore. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, la d√©mo de contr√¥le de contexte:</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/q_UM1EY2S5g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><img src="https://habrastorage.org/getpro/habr/post_images/16c/690/f58/16c690f589bf90cc1547edc1ee985ae0.jpg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inconv√©nients et probl√®mes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, la r√©utilisation de pi√®ces DSL. Aujourd'hui, vous avez d√©j√† vu que l'adressage d'entit√©s cr√©√©es en utilisant DSL peut √™tre probl√©matique. Il existe des moyens de contourner cela, mais il est conseill√© d'y penser √† l'avance afin d'avoir un plan pour cela.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imaginez que vous ayez un morceau de code et que vous vouliez simplement le r√©p√©ter, par exemple, dans un cycle pour pouvoir cr√©er des √©tudiants, plusieurs, plusieurs fois les m√™mes √©tudiants ou toute autre entit√©. Comment faire Vous pouvez utiliser la boucle for - pas la meilleure option. Vous pouvez cr√©er une m√©thode suppl√©mentaire √† l'int√©rieur de votre DSL, et ce sera une meilleure solution, cependant, vous devrez r√©soudre ces probl√®mes directement au niveau DSL. Attention au mot-cl√© this et √† la d√©nomination par d√©faut du param√®tre it. Heureusement, avec la version Kotlin du plugin 1.2.20, nous avons des indices qui sont visibles directement dans l'environnement de d√©veloppement. Le code gris nous indique dans quel contexte nous travaillons ou de quoi il s'agit.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'imbrication peut √™tre un probl√®me. Vous avez construit une belle DSL, mais l'initialisation du mod√®le va plus loin, plus profond√©ment, plus profond√©ment et, par cons√©quent, vous utilisez souvent un d√©filement horizontal plut√¥t que vertical. Il est conseill√© de masquer les valeurs par d√©faut sous l'impl√©mentation par d√©faut. Un utilisateur qui a juste besoin d'un √©tudiant ne veut rien savoir d'un programme de formation, ni rien d'autre, il veut juste cr√©er un √©tudiant sans d√©tails, ne veut m√™me pas indiquer de nom. Essayez de raccourcir la syntaxe. Par exemple, sp√©cifiez des valeurs par d√©faut, passez un lambda vide, etc.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, la documentation. √Ä mon avis subjectif, la meilleure documentation pour votre langue orient√©e probl√®me est plus que le nombre d'exemples de cette DSL. Super quand vous avez des quais Kotlin, c'est un bon bonus. Cependant, si l'utilisateur DSL n'a aucune id√©e des mod√®les disponibles, lui et les quais Kotlin n'ont nulle part o√π aller. Avez-vous d√©j√† ressenti cela? Lorsque vous venez d'√©crire un fichier Gradle au tout d√©but, vous ne comprenez pas ce qu'il contient et vous avez besoin d'exemples. Vous ne vous souciez pas des contextes, vous voulez des exemples, et c'est la meilleure documentation qui peut √™tre utilis√©e par les nouveaux utilisateurs de votre DSL.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/13e/4e0/05a/13e4e005af12def0ee687b008ffc41ac.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne mettez pas DSL dans toutes les fissures, s'il vous pla√Æt. Je veux vraiment le faire lorsque vous poss√©dez cet outil. Je veux dire, cr√©ons une DSL ici, peut-√™tre ici et ici. Premi√®rement, c'est un travail ingrat. Deuxi√®mement, il est toujours souhaitable de l'appliquer √† destination. O√π cela vous aide vraiment √† r√©soudre un probl√®me. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, apprenez Kotlin. Explorez les possibilit√©s offertes par ce langage, de nouvelles fonctions, pour que votre code soit plus propre, plus court, plus compact, il sera beaucoup plus facile √† lire. Et lorsque vous revenez aux tests (par exemple, vous avez ajout√© quelque chose, vous devez faire un test pour cela), vous serez beaucoup plus heureux de le faire car DSL est aussi compact et confortable que possible, et vous n'avez aucun probl√®me √† en cr√©er une douzaine √©tudiants. En quelques lignes, cela se fait.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entra√Ænez-vous sur les "chats" en tant que h√©ros d'un film c√©l√®bre. √Ä mon avis, au d√©but, il est plus facile d'amener Kotlin √† votre projet en tant que test. C'est une bonne occasion de v√©rifier la langue, de l'essayer, de regarder ses fonctionnalit√©s. C'est un tel champ de bataille o√π m√™me si rien ne fonctionne, √ßa va, vous pouvez toujours l'utiliser.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, pr√©configurez la DSL. Aujourd'hui, j'ai montr√© un exemple parfait et nous avons march√© par √©tapes pour cr√©er un langage ax√© sur les probl√®mes. Si vous pr√©-concevez le DSL, ce sera finalement beaucoup plus facile, vous ne le remodelerez pas 10 fois, vous ne vous inqui√©tez pas que les contextes se chevauchent en quelque sorte et sont logiquement fortement connect√©s. Pr√©-concevez simplement la DSL - il est assez facile de le faire sur un morceau de papier lorsque vous connaissez l'ensemble des dessins que je vous ai dit aujourd'hui. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et enfin, des contacts pour la communication. Je m'appelle Ivan Osipov, t√©l√©gramme: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ivan_osipov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Twitter: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@_osipov_</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Habr: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i_osipov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . J'attendrai vos commentaires.</font></font><br><br><blockquote>  Minute de publicit√©.        <b>JPoint</b> ‚Äî  ,  19-20   -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joker 2018</a> ‚Äî    Java-.       .    ,         . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416725/">https://habr.com/ru/post/fr416725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416711/index.html">Pages de l'histoire d'Intel. Incendie de l'usine de Penang</a></li>
<li><a href="../fr416713/index.html">Rapport du Club de Rome 2018, chapitre 3.14: ¬´Pas un seul PIB ...¬ª</a></li>
<li><a href="../fr416719/index.html">Extension PHP et Kotlin Native. Deuxi√®me partie, consciente</a></li>
<li><a href="../fr416721/index.html">DIY House: maisons de poup√©es pour adultes</a></li>
<li><a href="../fr416723/index.html">Accessibilit√© API: interfaces en langage naturel</a></li>
<li><a href="../fr416727/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 2: ¬´Contr√¥le des attaques de pirates¬ª, partie 3</a></li>
<li><a href="../fr416729/index.html">Le programme PYCON RUSSIA est pr√™t: 25 rapports et 3 ateliers de conf√©renciers de Google, Red Hat, Yelp, Yandex</a></li>
<li><a href="../fr416731/index.html">Frost on glass: comment fabriquer du plastique metglass robuste</a></li>
<li><a href="../fr416737/index.html">Un * algorithme de recherche de chemin dans un jeu Voxel 3d Unity</a></li>
<li><a href="../fr416739/index.html">Nouvel ASUS au Computex 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>