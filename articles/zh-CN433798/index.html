<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ğŸ¤²ğŸ» ğŸ¦‡ HomeKitå’ŒioBrokerè®©æˆ‘ä»¬åœ¨å®¶äº¤æœ‹å‹ ğŸ” ğŸ˜© ğŸ‘¨ğŸ¿â€âš–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ¯«æ— ç–‘é—®ï¼ŒApple iOSä»ç„¶æ˜¯æœ€å—æ¬¢è¿çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿä¹‹ä¸€ï¼Œè¿™æ„å‘³ç€ç°ä»£è‡ªåŠ¨åŒ–ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿé›†æˆåˆ°è¯¥ç”Ÿæ€ç³»ç»Ÿä¸­å¹¶æä¾›äº’æ“ä½œæ€§ã€‚ è¿™æ­£æ˜¯Homekitæ¡†æ¶çš„è®¾è®¡ç›®çš„ï¼Œå®ƒä½¿æ‚¨å¯ä»¥ä½¿ç”¨iPhone / iPad / iWatchå±å¹•ä»¥åŠæœ€è¿‘çš„Macï¼ˆmacOS Mojaveï¼‰ä¸­çš„æ™ºèƒ½è®¾å¤‡ã€‚ 


 å¤§å¤šæ•°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HomeKitå’ŒioBrokerè®©æˆ‘ä»¬åœ¨å®¶äº¤æœ‹å‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/433798/"><p><img src="https://habrastorage.org/webt/r6/5c/kp/r65ckpg2b-xatrgqefbyo7lflxa.png"></p><br><p> æ¯«æ— ç–‘é—®ï¼ŒApple iOSä»ç„¶æ˜¯æœ€å—æ¬¢è¿çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿä¹‹ä¸€ï¼Œè¿™æ„å‘³ç€ç°ä»£è‡ªåŠ¨åŒ–ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿé›†æˆåˆ°è¯¥ç”Ÿæ€ç³»ç»Ÿä¸­å¹¶æä¾›äº’æ“ä½œæ€§ã€‚ è¿™æ­£æ˜¯Homekitæ¡†æ¶çš„è®¾è®¡ç›®çš„ï¼Œå®ƒä½¿æ‚¨å¯ä»¥ä½¿ç”¨iPhone / iPad / iWatchå±å¹•ä»¥åŠæœ€è¿‘çš„Macï¼ˆmacOS Mojaveï¼‰ä¸­çš„æ™ºèƒ½è®¾å¤‡ã€‚ </p><br><p> å¤§å¤šæ•°è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼ˆæˆ‘ä¸å–œæ¬¢å¸‚åœºåç§°â€œ smart homeâ€ï¼‰æ—©å·²åŒ…å«ç”¨äºä¸Homekité›†æˆçš„æ¨¡å—ï¼Œä½†æ˜¯å³ä½¿æ˜¯å—è¿‡åŸ¹è®­çš„ç”¨æˆ·ä¹Ÿä¸èƒ½æ€»æ˜¯åªæƒ³å‡ºå¦‚ä½•åœ¨Homeï¼ˆæˆ–Eveï¼‰åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å…¶è®¾å¤‡çš„æ–¹æ³•ã€‚ </p><br><p> ä»Šå¤©ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•åœ¨ioBrokerç³»ç»Ÿï¼ˆè¿™æ˜¯ä¸€ä¸ªå¼€æ”¾å’Œå…è´¹çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼‰ä¸­è¿›è¡Œè¿™äº›æ“ä½œã€‚ ä½†æ˜¯ä¸ºäº†ä¸æ„šè ¢åœ°ç»™å‡ºæ‰€æœ‰è®¸å¤šè®¾å¤‡ç¤ºä¾‹ï¼Œæˆ‘æƒ³è§£é‡Šä¸€äº›åŸç†å¹¶å±•ç¤ºæ–¹æ³•ï¼ŒçŸ¥é“å“ªç§æ–¹æ³•åï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°å…¶ä»–ç¤ºä¾‹ã€‚ </p><br><p>  <em>â€œçŸ¥é“ä¸€äº›åŸåˆ™å¾ˆå®¹æ˜“å¼¥è¡¥å¯¹æŸäº›äº‹å®çš„æ— çŸ¥ã€‚â€</em> <em><br></em>  <em>å…‹åŠ³å¾·Â·é˜¿å¾·é‡Œå®‰Â·èµ«å°”ç»´è’‚ä¹Œæ–¯</em> </p><a name="habracut"></a><br><h3 id="iobroker-drayvery-ustroystva-i-sostoyaniya">  ioBrokerã€‚ é©±åŠ¨ç¨‹åºï¼Œè®¾å¤‡å’ŒçŠ¶æ€ </h3><br><p> é¦–å…ˆï¼Œæˆ‘æƒ³è§£é‡Šä¸€ä¸‹ioBrokerç³»ç»Ÿä¸­çš„è®¾å¤‡åŠå…¶æ˜¾ç¤ºæ–¹å¼ã€‚ </p><br><p> è®©æˆ‘æé†’æ‚¨ï¼ŒioBrokerç³»ç»Ÿæ˜¯æ¨¡å—åŒ–çš„ï¼Œæ‰©å±•æ¨¡å—ç§°ä¸ºé©±åŠ¨ç¨‹åºï¼ˆæˆ–é€‚é…å™¨ï¼‰ã€‚ é©±åŠ¨ç¨‹åºæ˜¯å…·æœ‰æŸäº›è®¾å¤‡æˆ–ä¸€ç»„è®¾å¤‡çš„é›†æˆæ¨¡å—ï¼Œç”±ä¸€ä¸ªå…±åŒçš„åŠŸèƒ½ï¼Œåè®®æˆ–åˆ¶é€ å•†è”åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªè®¾å¤‡â€œæ‹–åŠ¨â€åˆ°ioBrokerç³»ç»Ÿä¸­ã€‚ å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯èƒ½å¤Ÿåˆ›å»ºåŒä¸€é©±åŠ¨ç¨‹åºçš„å¤šä¸ªå®ä¾‹ï¼Œä½†åœ¨ä»»ä½•è®¾ç½®ä¸Šéƒ½ä¸åŒã€‚ </p><br><p> ä½†æ˜¯æ¯ç§è®¾å¤‡éƒ½æ˜¯ç‹¬ç‰¹è€Œç‹¬ç‰¹çš„ï¼Œå…·æœ‰ä¸åŒçš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ åŸºäºæ­¤ï¼ŒioBrokerä¸»è¦ä¸å…³æ³¨è®¾å¤‡æœ¬èº«ï¼Œè€Œæ˜¯å…³æ³¨å…¶çŠ¶æ€è¡¨ç¤ºçš„ç‰¹å¾ã€‚  <strong>çŠ¶æ€</strong>æ˜¯ä¸€ä¸ªå†…éƒ¨ioBrokerå¯¹è±¡ï¼Œå®ƒæ¥å—å¹¶å­˜å‚¨ä¸€ä¸ªå€¼ã€‚ å¯ä»¥è€ƒè™‘çŠ¶æ€çš„åŒä¹‰è¯ï¼šç¬¦å·ï¼Œå±æ€§ï¼Œç‰¹å¾ï¼Œç‰¹æ€§ï¼Œäº‹ä»¶ã€‚ æ¡ä»¶çš„ç¤ºä¾‹ï¼šâ€œæ¸©åº¦â€ï¼Œâ€œäº®åº¦çº§åˆ«â€ï¼Œâ€œç”µæ± çº§åˆ«â€ï¼Œâ€œå¼€æœºæ ‡å¿—â€ï¼Œâ€œé”™è¯¯æ ‡å¿—â€ï¼Œâ€œæŒ‰ä¸‹æ ‡å¿—â€ï¼Œâ€œä¸¤æ¬¡æŒ‰ä¸‹æ ‡å¿—â€ç­‰ã€‚ å› æ­¤ï¼Œæ¯ä¸ªè®¾å¤‡ç”±è®¸å¤šä¸åŒçš„çŠ¶æ€è¡¨ç¤ºã€‚ </p><br><p><img src="https://habrastorage.org/webt/oc/mn/q_/ocmnq_d-zdyhjj7bflfxaa3dxb8.png" alt="å¯¹è±¡ç»“æ„" title="å¯¹è±¡ç»“æ„"></p><br><p> çŠ¶æ€å¯ä»¥åˆ†ä¸ºä¿¡æ¯æ€§çŠ¶æ€ï¼ˆæ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯ï¼‰å’Œå¯å˜çŠ¶æ€ï¼ˆçŠ¶æ€å¯ä»¥ç”±ç”¨æˆ·æˆ–è„šæœ¬æ›´æ”¹ï¼‰å¹¶å°†è¿™äº›æ›´æ”¹å‘é€åˆ°è®¾å¤‡ã€‚ å› æ­¤ï¼Œå½“è®¾å¤‡ä¸Šå‘ç”ŸæŸäº›æ›´æ”¹æ—¶ï¼ˆè¯¥æ•°æ®ä»¥çŠ¶æ€æ˜¾ç¤ºï¼Œå¹¶ä¸”çŠ¶æ€ä»ioBrokeræ›´æ”¹ï¼ˆç”±ç”¨æˆ·æˆ–è„šæœ¬ï¼‰æ›´æ”¹ï¼‰ï¼Œè¯¥è®¾å¤‡ä¼šæ”¶åˆ°æœ‰å…³æ›´æ”¹çš„ä¿¡å·ï¼Œå¹¶ä¸”å¿…é¡»åšå‡ºç›¸åº”çš„å“åº”ï¼ˆå–å†³äºè®¾å¤‡æœ¬èº«å’Œé©±åŠ¨ç¨‹åºï¼‰ä½œå“ï¼‰ã€‚ </p><br><p> æ‰€æœ‰è®¾å¤‡çŠ¶æ€éƒ½ç»„åˆæˆä¸€ä¸ªçŠ¶æ€æ ‘ï¼ˆæ³¨å†Œè¡¨ï¼‰ã€‚ å®ƒä»¬é¦–å…ˆæŒ‰è®¾å¤‡åˆ†ç»„ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»ä½¿ç”¨é€šé“ï¼‰ï¼Œç„¶åæŒ‰é©±åŠ¨ç¨‹åºå®ä¾‹åˆ†ç»„ã€‚ </p><br><p>  MQTTåè®®ä¸»é¢˜çš„æ¦‚å¿µå¾ˆå®¹æ˜“é€‚åˆè¿™ç§çŠ¶æ€æ ‘ã€‚ è¿™æ ·ï¼Œæ‚¨å¯ä»¥è¿æ¥æ”¯æŒMQTTåè®®çš„å…¶ä»–è®¾å¤‡æˆ–ç¬¬ä¸‰æ–¹ç³»ç»Ÿã€‚ å®‰è£…MQTTé©±åŠ¨ç¨‹åºå°±è¶³å¤Ÿäº†-ç›¸åº”çš„åˆ†æ”¯å°†å‡ºç°åœ¨çŠ¶æ€æ ‘ä¸­ã€‚ </p><br><p> å¹¶ä¸”æœ‰å„ç§å„æ ·çš„åœ¨çº¿æœåŠ¡å¯ä»¥æä¾›æœ‰ç”¨çš„ä¿¡æ¯å’Œ/æˆ–æ§åˆ¶å…¶ä»–è®¾å¤‡ï¼ˆä¾‹å¦‚æ±½è½¦è­¦æŠ¥å™¨ï¼‰ã€‚ ä¸è¿™äº›æœåŠ¡äº¤äº’çš„ç»“æœä¹Ÿè¡¨ç¤ºä¸ºä¸€ç»„çŠ¶æ€ã€‚ </p><br><p><img src="https://habrastorage.org/webt/xi/qk/ay/xiqkay8bgotkcb7qjhouj5-zln4.png" alt="çŠ¶æ€æ ‘" title="çŠ¶æ€æ ‘"></p><br><p> æ€»ä½“è€Œè¨€ï¼ŒioBrokerä¸­çš„è®¾å¤‡ç”±è¡¨å¾è®¾å¤‡å¹¶å…è®¸ä¸å…¶äº¤äº’çš„ä¸€ç»„çŠ¶æ€è¡¨ç¤ºã€‚ </p><br><h3 id="homekit-aksessuary-servisy-i-harakteristiki"> å®¶åº­å¥—ä»¶ é…ä»¶ï¼ŒæœåŠ¡å’Œè§„æ ¼ </h3><br><p> ç°åœ¨è½¬åˆ°Homekitã€‚ åœ¨æ­¤åº”ç”¨è®¾å¤‡çš„åˆ†ç±»ï¼Œå…¶åŠŸèƒ½å’Œç‰¹æ€§ã€‚ </p><br><p><img src="https://habrastorage.org/webt/xk/ch/8m/xkch8mdj6gv4zxw5g-kapazvuyy.png" alt="Homekitè®¾å¤‡ç±»åˆ«" title="Homekitè®¾å¤‡ç±»åˆ«"></p><br><p>  <strong>é™„ä»¶</strong>ç›¸å½“äºç‰©ç†è®¾å¤‡ã€‚ é™„ä»¶å…·æœ‰ç”¨äºå°†å…¶åˆ†é…ç»™ç‰¹å®šç»„çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç±»åˆ«</a> ã€‚ </p><br><p>  <strong>æœåŠ¡</strong>ç­‰åŒäºé™„ä»¶å…·æœ‰çš„åŠŸèƒ½ã€‚ ä¸€ä¸ªé…ä»¶å¯ä»¥æä¾›å¤šç§æœåŠ¡ã€‚ </p><br><p> æœåŠ¡è¡¨æ˜è®¾å¤‡çš„åŠŸèƒ½ï¼šç¯ï¼Œç”µæ± ï¼ŒæŒ‰é’®ï¼Œç©ºæ°”è´¨é‡ä¼ æ„Ÿå™¨ï¼Œé—¨ï¼Œç©ºæ°”æ»¤æ¸…å™¨ï¼Œç…§ç›¸æœº.. </p><br><p> æœåŠ¡å†³å®šæ˜¾ç¤ºå™¨ï¼Œè®¾å¤‡çš„è¡Œä¸ºå’Œç‰¹æ€§é›†ã€‚ </p><br><p>  <strong>ç‰¹å¾</strong>ç­‰åŒäºè¡¨å¾æœåŠ¡çš„å±æ€§ã€‚ è¿™äº›ç‰¹æ€§å†³å®šäº†è®¾å¤‡æ˜¯å¦å·²å¼€å¯ï¼Œç¯æ³¡çš„äº®åº¦çº§åˆ«æˆ–æŒ‰é’®è¢«æŒ‰ä¸‹äº†å¤šå°‘æ¬¡ã€‚ ä¸€é¡¹æœåŠ¡å¯ä»¥å…·æœ‰è®¸å¤šç‰¹å¾ã€‚ </p><br><p><img src="https://habrastorage.org/webt/2f/rl/io/2frliotkqesh2zanlhpfiaskmaq.png" alt="å¯¹è±¡ç»“æ„" title="å¯¹è±¡ç»“æ„"></p><br><p> ä½¿ç”¨Homekitçš„åº”ç”¨ç¨‹åºä¼šè¯»å–é™„ä»¶çš„æœåŠ¡å’Œç‰¹å¾ï¼Œç„¶åæ˜¾ç¤ºå¹¶å…è®¸æ‚¨é€šè¿‡ç”¨æˆ·ç•Œé¢æ›´æ”¹ç‰¹å¾ä¸­çš„å€¼ã€‚ æ›´æ”¹åçš„å€¼è¢«å‘é€åˆ°Homekitè®¾å¤‡ä»¥åº”ç”¨å®ƒä»¬ï¼Œå¹¶ä¸”åˆ†åˆ«ä»Homekitè®¾å¤‡å‘é€ç‰¹æ€§å€¼ï¼Œå¹¶ä»è®¾å¤‡ä¾§é¢å‘é€ä¸€äº›æ›´æ”¹ã€‚ </p><br><p> æ€»ä½“è€Œè¨€ï¼ŒHomeKitä¸­çš„è®¾å¤‡ä¼¼ä¹æ˜¯å…·æœ‰ä¸€ç³»åˆ—æœåŠ¡å’ŒåŠŸèƒ½çš„é™„ä»¶ã€‚ </p><br><h3 id="yahka-stykuem-koncepcii"> è€¶å¡ æˆ‘ä»¬åŠ å…¥æ¦‚å¿µ </h3><br><p> è¦ä½¿ç”¨Homekitï¼ŒioBrokerä½¿ç”¨Yahkaé©±åŠ¨ç¨‹åºï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…</a>å‰å¿…é¡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…å…¶ä»–æ¨¡å—</a> ï¼‰-çŸ¥ååº“çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é™„åŠ ç»„ä»¶</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/KhaosT/HAP-NodeJS</a> ï¼Œå®ƒè¿˜æ„å»ºäº†æµè¡Œçš„HomeBridgeé¡¹ç›®ã€‚ è¯¥åº“æ—¨åœ¨åˆ›å»ºè™šæ‹Ÿç½‘å…³/ç½‘æ¡¥ï¼Œä»¥åœ¨HomeKitä¸­æä¾›ä¸€ç»„è™šæ‹Ÿè®¾å¤‡ã€‚ ç›¸åº”åœ°é…ç½®è™šæ‹Ÿè®¾å¤‡å’ŒæœåŠ¡ï¼Œè®¾ç½®ç‰¹å¾å€¼ï¼Œæˆ‘ä»¬å°†åœ¨Homekitå’ŒHomeåº”ç”¨ç¨‹åºä¸­è·å¾—å®Œæˆçš„è®¾å¤‡ï¼Œè¿˜å¯ä»¥è¦æ±‚Siriå¯¹å…¶è¿›è¡Œç®¡ç†ã€‚ </p><br><p>  Yahkaé©±åŠ¨ç¨‹åºä»…ç”¨äºé…ç½®é™„ä»¶ï¼Œå‘å…¶ä¸­æ·»åŠ æœåŠ¡å¹¶æŒ‡ç¤ºç‰¹æ€§ï¼ˆHomeKitï¼‰å’Œæ¡ä»¶ï¼ˆioBrokerï¼‰çš„ç¬¦åˆæ€§ã€‚ </p><br><p> ä½†æ˜¯é¦–å…ˆï¼Œåœ¨å®‰è£…åï¼Œæ‚¨éœ€è¦é…ç½®ç½‘å…³å¹¶å°†å…¶æ”¾å…¥Homeåº”ç”¨ç¨‹åºã€‚ é…ç½®å®Œæˆåï¼Œæ·»åŠ åˆ°ç½‘å…³çš„æ‰€æœ‰è®¾å¤‡å°†è‡ªåŠ¨æ·»åŠ åˆ°å®¶åº­ã€‚ ä¸ºæ­¤ï¼Œè¯·æŒ‡å®šâ€œè®¾å¤‡åç§°â€ï¼ˆæœ€å¥½ä»…æŒ‡å®šæ‹‰ä¸å­—æ¯ï¼‰å¹¶è®°ä½å¯†ç ï¼ˆæˆ–è®¾ç½®æ‚¨è‡ªå·±çš„å¯†ç ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/mj/b9/lf/mjb9lfsfvknvbjjmec9x0nexnns.png" alt="ç½‘å…³è®¾ç½®" title="ç½‘å…³è®¾ç½®"></p><br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬è½¬åˆ°Homeåº”ç”¨ç¨‹åºå¹¶æ·»åŠ ä¸€ä¸ªæ–°é™„ä»¶ã€‚</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/5k/m1/hr/5km1hrkrxh6whzmb8dn5zcvqtm4.png"><br><img src="https://habrastorage.org/webt/fo/p-/oz/fop-oz-o99nnegmciq7drkxjdyu.png"></p></div></div><br><p> ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹è®¨è®ºè®¾å¤‡ã€‚ å¦‚æœioBrokerä¸­è®¾å¤‡çš„çŠ¶æ€é›†æ˜¾ç„¶ä¸HomeKitä¸­çš„æœåŠ¡å’ŒåŠŸèƒ½é›†ç›¸å¯¹åº”ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½ä¼šå¾ˆå¥½ã€‚ å¦‚æœçŠ¶æ€ä¸­çš„å€¼é€‚åˆäºç‰¹æ€§çš„å€¼ï¼Œé‚£å°±æ›´å¥½äº†ã€‚ ä½†æ˜¯é€šå¸¸æƒ…å†µå¹¶éå¦‚æ­¤ï¼Œæ‚¨å¿…é¡»æå‡ºä¸åŒå¯»å¸¸çš„å¯¹æ¥æ–¹å¼ã€‚ æˆ‘å°†åœ¨ä¸‹é¢è®¨è®ºå…¶ä¸­çš„ä¸€äº›é€‰é¡¹ï¼Œæ‚¨å°†ä¸å¾—ä¸è‡ªå·±å®ç°æ‰€æœ‰å…¶ä»–é€‰é¡¹ï¼Œâ€œä»¥å›¾åƒå’Œæ ·å¼â€ã€‚ </p><br><p> ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºäº†ä¸€ä¸ªæ–‡æ¡£</a> ï¼Œå…¶ä¸­åŒ…å«æœåŠ¡å’Œç±»å‹çš„è½¬æ¢ä»¥åŠç‰¹å¾çš„å¯èƒ½å€¼ã€‚ ä½¿ç”¨çš„æ‰€æœ‰ç±»å‹å’ŒæœåŠ¡éƒ½å¯¹åº”äº<a href="">HAP-NodeJSåº“</a> ã€‚ </p><br><h3 id="datchik-temperatury"> æ¸©åº¦ä¼ æ„Ÿå™¨ </h3><br> è¿™æ˜¯æœ€ç®€å•çš„ç¤ºä¾‹-æ‚¨æ‰€è¦åšçš„å°±æ˜¯è®©ä¸€ä¸ªçŠ¶æ€åŒ…å«æ¸©åº¦çš„æ•°å€¼ã€‚ å®ƒå¯ä»¥ä»ä»»ä½•åœ°æ–¹è·å–ï¼šä¼ æ„Ÿå™¨æˆ–InternetæœåŠ¡ï¼ˆå¤©æ°”ï¼‰ã€‚ <br><p> æ‚¨éœ€è¦æ·»åŠ â€œä¼ æ„Ÿå™¨â€ç±»åˆ«çš„è®¾å¤‡ï¼Œå¹¶å°†â€œæ¸©åº¦ä¼ æ„Ÿå™¨â€æœåŠ¡æ·»åŠ åˆ°è¯¥è®¾å¤‡ï¼Œå¹¶ä¸ºæ­¤æœåŠ¡å‘½åã€‚ æ­¤æœåŠ¡å…·æœ‰5ä¸ªç‰¹å¾ï¼Œå…¶ä¸­å¯¹æˆ‘ä»¬è€Œè¨€æœ€é‡è¦çš„æ˜¯CurrentTemperatureã€‚ </p><br><p><img src="https://habrastorage.org/webt/xn/yr/k7/xnyrk7hwwcmtwhiy_kcbub-nlms.png" alt="é…ä»¶æ¸©åº¦è®¡" title="é…ä»¶æ¸©åº¦è®¡"></p><br><p><img src="https://habrastorage.org/webt/j4/bj/bn/j4bjbnuijam7qadtoq9r9eh16ns.png" alt="æ¸©åº¦ä¼ æ„Ÿå™¨æœåŠ¡" title="æ¸©åº¦ä¼ æ„Ÿå™¨æœåŠ¡"></p><br><p> åœ¨CurrentTemperatureç‰¹æ€§ä¸­æŒ‡ç¤ºä¸æ¸©åº¦ç›¸å¯¹åº”çš„çŠ¶æ€åç§°å°±è¶³å¤Ÿäº†ã€‚ </p><br><p> ä¹Ÿå¯ä»¥åœ¨æ­¤å¤„æ·»åŠ HumiditySensoræ¹¿åº¦æœåŠ¡ï¼Œå¹¶ä¸”å°†åœ¨Homekitä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é™„ä»¶å›¾æ ‡ã€‚ </p><br><p><img src="https://habrastorage.org/webt/ag/na/90/agna90qhvaz84v3qutrvu4dltei.png" alt="æ¹¿åº¦ä¼ æ„Ÿå™¨æœåŠ¡" title="æ¹¿åº¦ä¼ æ„Ÿå™¨æœåŠ¡"></p><br><p> ä¿å­˜ï¼Œå°±å®Œæˆäº†ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥è½¬åˆ°Siriï¼Œå¹¶è¯¢é—®å¥¹æœ‰å…³æ¸©åº¦å’Œæ¹¿åº¦çš„ä¿¡æ¯ã€‚ </p><br><p><img src="https://habrastorage.org/webt/s4/cx/kg/s4cxkg72-7ycfuaentktjrhpdjy.png"></p><br><div class="spoiler">  <b class="spoiler_title">ä¸Siriå¯¹è¯</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ff/p9/tt/ffp9ttfpcj3_wcbt4ztgisnwxzi.png"><br><img src="https://habrastorage.org/webt/ax/7z/1i/ax7z1ioiynurem96c3gof_2gnha.png"></p></div></div><br><h3 id="batareyka"> ç”µç“¶ </h3><br><p> å¦ä¸€ä¸ªç®€å•çš„æœåŠ¡ã€‚ å®ƒçš„è¯€çªæ˜¯å¯ä»¥å°†å…¶æ·»åŠ åˆ°å‡ ä¹æ‰€æœ‰é™„ä»¶ä¸­ã€‚ æ·»åŠ BatteryServiceæœåŠ¡ï¼Œå¹¶åœ¨BatteryLevelç‰¹æ€§ä¸­æŒ‡ç¤ºåŒ…å«ç”µæ± ç”µé‡ç™¾åˆ†æ¯”çš„çŠ¶æ€ã€‚ ä¹‹åï¼Œè´¹ç”¨æ•°æ®å°†å‡ºç°åœ¨æœ‰å…³è®¾å¤‡çš„å…¶ä»–æ•°æ®ä¸­ã€‚ </p><br><p><img src="https://habrastorage.org/webt/pd/4p/ib/pd4pibwilwjymthk2g30ldqneey.png" alt="ç”µæ± æœåŠ¡" title="ç”µæ± æœåŠ¡"></p><br><p> æ‚¨å¯ä»¥ç«‹å³è®¾ç½®â€œä½ç”µé‡â€çš„æ ‡å¿—ï¼ˆç‰¹å¾StatusLowBatteryï¼‰ï¼Œå¦‚æœæŒ‡å®šçŠ¶æ€çš„å€¼ç­‰äº1ï¼Œåˆ™ç›¸åº”çš„å›¾æ ‡å°†æ˜¾ç¤ºåœ¨è®¾å¤‡å›¾åƒä¸Šã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æ²¡æœ‰è¿™ç§çŠ¶æ€ï¼Œä½†æƒ³æŸ¥çœ‹ä½ç”µé‡å›¾æ ‡ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ æ‚¨éœ€è¦æ‰‹åŠ¨æˆ–ä½¿ç”¨è„šæœ¬åˆ›å»ºæ­¤çŠ¶æ€ï¼Œå¹¶åœ¨ç‰¹å¾ä¸­æŒ‡ç¤ºåˆ›å»ºçš„çŠ¶æ€ã€‚ </p><br><p> ç°åœ¨åªå‰©ä¸‹åœ¨æ­¤çŠ¶æ€ä¸‹æ­£ç¡®è®¾ç½®å€¼ä¸ºtrueäº†ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è„šæœ¬-å½“ç”µæ± ç”µé‡è¾¾åˆ°30ï¼…æ—¶ï¼Œå®ƒå°†è®¾ç½®ä¸ºtrueã€‚ </p><br><pre><code class="javascript hljs">createState(<span class="hljs-string"><span class="hljs-string">""</span></span>); on({<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"zigbee.0.00158d0001f41725.battery"</span></span>, <span class="hljs-attr"><span class="hljs-attr">change</span></span>: <span class="hljs-string"><span class="hljs-string">"ne"</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value = obj.state.val; setState(<span class="hljs-string"><span class="hljs-string">"javascript.0."</span></span>, (value &lt;= <span class="hljs-number"><span class="hljs-number">30</span></span>)); });</code> </pre> <br><p> ç¬¬ä¸€æ¬¡è¿è¡Œåï¼Œè„šæœ¬å°†åˆ›å»ºä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç‰¹å¾ä¸­é€‰æ‹©å®ƒã€‚ </p><br><p><img src="https://habrastorage.org/webt/tx/2z/6r/tx2z6r4deofbbram-k_muwaxut0.png"></p><br><p> æ­¤æ ‡å¿—å°†æ˜¾ç¤ºåœ¨é™„ä»¶çš„å›¾åƒä¸Š </p><br><p><img src="https://habrastorage.org/webt/9o/nu/it/9onuitzmxs8exjofr7cfkwtwrqi.png"></p><br><div class="spoiler">  <b class="spoiler_title">å’Œè®¾å¤‡è¯¦ç»†ä¿¡æ¯</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fx/jg/av/fxjgavhu-spu27lskbzkmvb_dh8.png"></p></div></div><br><h3 id="lampy"> å°ç¯ </h3><br><p> ç¯æ³¡ä¸åŒ-æ˜äº®ï¼Œæ¸©æš–ï¼Œçº¢è‰²ã€‚ æœ‰4ç§æƒ…å†µï¼š </p><br><ul><li> ç®€å•-ç”±å¼€å’Œå…³æ§åˆ¶ </li><li> å¯è°ƒå…‰-ä¹Ÿç”±äº®åº¦çº§åˆ«æ§åˆ¶ </li><li> é€šè¿‡æ¸©åº¦-å¯ä»¥æ§åˆ¶å‘å…‰çš„æ¸©åº¦ </li><li> é¢œè‰²-æ‚¨å¯ä»¥æ§åˆ¶å‘å…‰çš„é¢œè‰² </li></ul><br><p> å¯¹äºæ¯ç§æƒ…å†µï¼Œç¯æ³¡æœåŠ¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç‰¹å¾ï¼š </p><br><ul><li> å¼€-å¼€/å…³ </li><li> äº®åº¦-äº®åº¦ç­‰çº§ </li><li> è‰²ç›¸-é˜´å½± </li><li> é¥±å’Œåº¦-é¥±å’Œåº¦ </li><li>  ColorTemperature-è‰²æ¸© </li></ul><br><p> åœ¨ç®€å•çš„æƒ…å†µä¸‹ï¼Œåœ¨â€œæ‰“å¼€â€ç‰¹æ€§ä¸­ï¼Œæˆ‘ä»¬æŒ‡ç¤ºè´Ÿè´£æ‰“å¼€å’Œå…³é—­çš„çŠ¶æ€ã€‚ </p><br><p><img src="https://habrastorage.org/webt/7p/2j/l2/7p2jl2cqi7q8rbw98d_ytedxwke.png"></p><br><p> å¦‚æœç¯æ³¡æ˜¯å¯è°ƒå…‰çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜ä¼šç”¨äº®åº¦çº§åˆ«æŒ‡ç¤ºçŠ¶æ€ã€‚ </p><br><p><img src="https://habrastorage.org/webt/b6/da/n1/b6dan1fjltcn8sry8doex2hl6ck.png"></p><br><p> é™¤äº†åˆ†é…æ­£ç¡®çš„çŠ¶æ€å¤–ï¼Œè§‚å¯Ÿå¯æ¥å—å€¼çš„é—´éš”ä¹Ÿå¾ˆé‡è¦ï¼ </p><br><p> ä¾‹å¦‚ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè´Ÿè´£ç¯æ³¡äº®åº¦çš„çŠ¶æ€å¯ä»¥é‡‡ç”¨0åˆ°255ä¹‹é—´çš„å€¼ï¼Œä½†æ˜¯åœ¨Homekitä¸­ï¼Œè¿™äº›å€¼é™åˆ¶ä¸º0åˆ°100ä¹‹é—´çš„é—´éš”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Yahkaé©±åŠ¨ç¨‹åº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è½¬æ¢å‡½æ•°</a> ã€‚ å‡½æ•°â€œ level255â€ä»…å°†å€¼0..255çš„é—´éš”è½¬æ¢ä¸ºé—´éš”0..100ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ </p><br><p> å¦‚æœæ‚¨çš„ç¯æ˜¯å½©è‰²çš„ï¼Œä½†ä½¿ç”¨çš„é¢œè‰²æ˜¯RGBï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹å›°éš¾ã€‚ å®ƒå¯ä»¥æ˜¯ä¸‰ç§ä¸åŒçš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆæˆ–å­—ç¬¦ä¸²ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å°†éœ€è¦ä»ä¸€ç§RGBé¢œè‰²ç©ºé—´è½¬æ¢ä¸ºå¦ä¸€ç§XYBç©ºé—´ï¼ˆHomeKitä½¿ç”¨æ­¤ç©ºé—´ï¼‰æˆ–XYå¹³é¢ã€‚ </p><br><p> ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åˆ›å»º2ä¸ªæ–°çŠ¶æ€ï¼ˆè‰²ç›¸å’Œé¥±å’Œåº¦ï¼‰ï¼Œç„¶åå°†RGBçŠ¶æ€çš„å€¼è½¬æ¢ä¸º2ä¸ªçŠ¶æ€ï¼Œåä¹‹äº¦ç„¶ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">é¢œè‰²çš„ç»“æœè„šæœ¬æ˜¯</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       createState("Hue"); createState("Sat"); //      RGB- on({id: "Hue", ack: false, change: 'any'}, function (obj) {  var hue = parseInt(obj.state.val);  var sat = parseInt(getState('Sat').val);  var res = hsvToRgb(hue, sat, 100);  setRGB(parseInt(res[0]), parseInt(res[1]), parseInt(res[2])); }); //    RGB- function setRGB(r, g, b){  var val = ('00'+r.toString(16)).slice(-2)+('00'+g.toString(16)).slice(-2)+('00'+b.toString(16)).slice(-2);  // RGB-   setState('zigbee.0.00124b0014d016ab.color', val, false); } //   HSV   RGB function hsvToRgb(h, s, v) {  var r, g, b;  var i;  var f, p, q, t;   h = Math.max(0, Math.min(360, h));  s = Math.max(0, Math.min(100, s));  v = Math.max(0, Math.min(100, v));  s /= 100;  v /= 100;   if(s == 0) {      r = g = b = v;      return [          Math.round(r * 255),          Math.round(g * 255),          Math.round(b * 255)      ];  }   h /= 60;  i = Math.floor(h);  f = h - i;  p = v * (1 - s);  q = v * (1 - s * f);  t = v * (1 - s * (1 - f));   switch(i) {      case 0:          r = v;          g = t;          b = p;          break;       case 1:          r = q;          g = v;          b = p;          break;       case 2:          r = p;          g = v;          b = t;          break;       case 3:          r = p;          g = q;          b = v;          break;       case 4:          r = t;          g = p;          b = v;          break;       default: // case 5:          r = v;          g = p;          b = q;  }   return [      Math.round(r * 255),      Math.round(g * 255),      Math.round(b * 255)  ]; }</span></span></code> </pre> </div></div><br><p> è‰²æ¸©å¯ä»¥æ›´è½»æ¾åœ°å®Œæˆ-å¦‚æœå·²çŸ¥ç¯æ³¡å¯ç”¨å€¼çš„èŒƒå›´ï¼Œåˆ™å¯ä»¥å°†å…¶è½¬æ¢ä¸ºHomeKitå¯ç”¨çš„é—´éš”ï¼ˆé€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">scaleInt</a>å‡½æ•°ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/f0/vm/xh/f0vmxhpcndendf_efjf9xrmjxke.png" alt="ç¯æ³¡æœåŠ¡" title="ç¯æ³¡æœåŠ¡"></p><br><p><img src="https://habrastorage.org/webt/et/sp/fg/etspfg0idwn5v-cun2hh2y9xmm0.png"></p><br><div class="spoiler">  <b class="spoiler_title">æ›´æ·±çš„ç¯</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/w_/q8/8p/w_q88pboeca8hl0fygtssrjegim.png"><br><img src="https://habrastorage.org/webt/bt/5c/bc/bt5cbc59jttu8ibjev1hfnnwkdm.png"></p></div></div><br><h3 id="termostat"> æ¸©æ§å™¨ </h3><br><p> æ¸©æ§å™¨-ç»´æŒè®¾å®šæ¸©åº¦çš„è®¾å¤‡ï¼ˆThermostatæœåŠ¡ï¼‰ã€‚ å› æ­¤ï¼Œæ’æ¸©å™¨çš„ä¸»è¦ç‰¹æ€§æ˜¯æ‰€éœ€æ¸©åº¦ï¼ˆç›®æ ‡æ¸©åº¦ï¼‰ã€‚ é™¤äº†è®¾å®šæ¸©åº¦å¤–ï¼Œè¿˜å¯ä»¥æŒ‡ç¤ºå½“å‰æ¸©åº¦ï¼ˆCurrentTemperatureï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¿¡æ¯æ€§çš„ï¼ˆå› ä¸ºè®¾å¤‡ä»…ä»ä¼ æ„Ÿå™¨è¯»å–æ¸©åº¦ï¼‰ã€‚ </p><br><p> ä»Homeåº”ç”¨ç¨‹åºä¸­ï¼Œå¯åœ¨æ’æ¸©å™¨ä¸­è®¾ç½®ç›®æ ‡æ¸©åº¦å¹¶ç›‘è§†å½“å‰æ¸©åº¦ã€‚ åœ¨æˆ‘çš„æ’æ¸©å™¨ï¼ˆZontï¼‰ä¸­ï¼Œåªæœ‰è¿™ä¸¤ç§çŠ¶æ€-å®ƒä»¬å¯ä»¥é€šè¿‡æœåŠ¡äº‘APIè·å¾—ã€‚ </p><br><p> ä¸ºäº†åœ¨HomeKitä¸­æ˜¾ç¤ºè®¾å¤‡çš„ç¾è§‚ï¼Œæˆ‘å¿…é¡»æ·»åŠ å‡ ä¸ªå¸¸æ•°ï¼šå½“å‰åŠ çƒ­çŠ¶æ€ä¸ºæ´»åŠ¨ï¼ˆ1ï¼‰ï¼Œç›®æ ‡åŠ çƒ­çŠ¶æ€ä¸ºè‡ªåŠ¨ï¼ˆ3ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/vn/dd/ey/vnddeyypjlofn2jkxrqwe5ybwuw.png" alt="æ’æ¸©å™¨æœåŠ¡" title="æ’æ¸©å™¨æœåŠ¡"></p><br><p><img src="https://habrastorage.org/webt/pk/9u/k3/pk9uk3vfurepl1kfgow5lrp66dc.png"></p><br><div class="spoiler">  <b class="spoiler_title">æ¸©åº¦é€‰æ‹©</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/_4/g8/co/_4g8coln1rlsodscr8sah8p_h9o.png"></p></div></div><br><h3 id="vorota"> ç›–èŒ¨ </h3><br><p> æœ‰äº†è½¦åº“é—¨ï¼ˆGarageDoorOpeneræœåŠ¡ï¼‰ï¼Œä¸€åˆ‡éƒ½æ¯”ä½¿ç”¨æ¸©æ§å™¨æ£˜æ‰‹ã€‚ </p><br><p> åœ¨å¯ç”¨ç‰¹å¾ä¸­ï¼Œé—¨å…·æœ‰ç›®æ ‡çŠ¶æ€ï¼ˆTargetDoorStateï¼‰ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬å¸Œæœ›é—¨â€œæ‰“å¼€â€æˆ–â€œå…³é—­â€ã€‚ ä½†æ˜¯ï¼Œæ‚¨è¿˜éœ€è¦æ­£ç¡®æ˜¾ç¤ºé—¨çš„å½“å‰çŠ¶æ€ï¼ˆCurrentDoorStateï¼‰ï¼šå®ƒä»¬æ˜¯æ‰“å¼€è¿˜æ˜¯å…³é—­ï¼Œæˆ–è€…å®ƒä»¬æ˜¯æ‰“å¼€è¿˜æ˜¯å…³é—­ï¼Ÿ </p><br><p> åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ioBrokerä¸­çš„mqttæ‰“å¼€äº†å…·æœ‰å¤šä¸ªä¿¡æ¯çŠ¶æ€çš„é—¨ï¼š </p><br><ul><li> é—¨æ‰“å¼€çš„è¿¹è±¡ï¼ˆOBï¼‰ </li><li> é—¨ç§»åŠ¨çš„è¿¹è±¡ï¼ˆå·¦ï¼‰ </li></ul><br><p><img src="https://habrastorage.org/webt/aw/b3/ip/awb3ipo5vz8qrn8jawhcfunuouc.png" alt="è½¦åº“é—¨æ§åˆ¶çŠ¶æ€" title="è½¦åº“é—¨æ§åˆ¶çŠ¶æ€"></p><br><p> ç”±äºè¿™äº›çŠ¶æ€ï¼Œæ‚¨å¯ä»¥è®¡ç®—é—¨çš„å½“å‰çŠ¶æ€ï¼š </p><br><ul><li> å¦‚æœæ²¡æœ‰OBå’ŒDVï¼Œåˆ™é—¨å…³é—­ </li><li> å¦‚æœæ²¡æœ‰OBï¼Œä½†æ˜¯æœ‰DVï¼Œåˆ™é—¨ä¼šæ‰“å¼€ </li><li> å¦‚æœæœ‰ä¸€ä¸ªOBè€Œæ²¡æœ‰DVï¼Œåˆ™é—¨æ˜¯æ‰“å¼€çš„ </li><li> å¦‚æœæœ‰ä¸€ä¸ªOBå’Œä¸€ä¸ªDVï¼Œåˆ™é—¨å…³é—­ </li></ul><br><p> è¦å‘é€ä¿¡å·ä»¥æ‰“å¼€å’Œå…³é—­é—¨ï¼Œæˆ‘æœ‰ä¸¤ä¸ªå•ç‹¬çš„çŠ¶æ€ï¼ˆå¯ä»¥ç”¨ä¸€ä¸ªçŠ¶æ€è¿›è¡Œç®¡ç†ï¼Œä½†æˆ‘æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼‰ï¼Œå®ƒä»¬é€šè¿‡mqttå‘é—¨æ§åˆ¶æ§åˆ¶å™¨å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š </p><br><ul><li> å¼€å¯ä¿¡å· </li><li> å…³é—­ä¿¡å· </li></ul><br><p> è¦å‘é€ä¿¡å·ï¼Œæ‚¨éœ€è¦æ¨¡æ‹Ÿä¸€ä¸ªâ€œå•å‡»â€æŒ‰é’®ï¼šå°†å€¼è®¾ç½®ä¸ºtrueï¼Œä¸ä¹…åå°†å…¶é‡ç½®ä¸ºfalseã€‚ åœ¨è¿™æ–¹é¢ï¼Œä¸ºäº†ä¸HomeKité›†æˆï¼Œå¿…é¡»åˆ›å»ºå¦ä¸€ä¸ªçŠ¶æ€-â€œé—¨çš„ç›®æ ‡çŠ¶æ€â€ï¼Œå½“æ›´æ”¹æ—¶ï¼Œå°†å‘é€ç›¸åº”çš„ä¿¡å·ã€‚ </p><br><p> å¯ä»¥é€šè¿‡ç›®æ ‡çŠ¶æ€ï¼ˆå³ç›®æ ‡å°†è¦è¾¾åˆ°çš„ç›®æ ‡ï¼‰æ¥ä»£æ›¿æ‰“å¼€é—¨çš„æ ‡å¿—ï¼š </p><br><ul><li> å¦‚æœCAæ˜¯â€œå…³é—­çš„â€å¹¶ä¸”æ²¡æœ‰DVï¼Œåˆ™é—¨æ˜¯å…³é—­çš„ </li><li> å¦‚æœCAè¢«â€œå…³é—­â€å¹¶ä¸”æœ‰DVï¼Œåˆ™é—¨å°†æ‰“å¼€ </li><li> å¦‚æœCAæ˜¯â€œå¼€æ”¾çš„â€å¹¶ä¸”æ²¡æœ‰DVï¼Œåˆ™é—¨æ˜¯å¼€æ”¾çš„ </li><li> å¦‚æœCAâ€œæ‰“å¼€â€å¹¶ä¸”æœ‰DVï¼Œåˆ™é—¨å…³é—­ </li></ul><br><p> æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çŠ¶æ€â€œå½“å‰é—¨çŠ¶æ€â€ï¼Œå¹¶æ ¹æ®ç¬¦å·çš„å€¼å’Œç›®æ ‡çŠ¶æ€å°†å…¶å¡«å……åˆ°è„šæœ¬ä¸­ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">è½¦åº“é—¨çš„çŠ¶æ€æ›´æ”¹è„šæœ¬</b> <div class="spoiler_text"><pre> <code class="javascript hljs">createState(<span class="hljs-string"><span class="hljs-string">"gate_0.current"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   createState("gate_0.target"); //   //    0,   300 on({id: "mqtt.0.gate.gpio.13", ack: false, val: 1}, function (obj) {  setStateDelayed("mqtt.0.gate.gpio.13", 0,  300); }); on({id: "mqtt.0.gate.gpio.12", ack: false, val: 1}, function (obj) {  setStateDelayed("mqtt.0.gate.gpio.12", 0,  300); }); //     on({id: "mqtt.0.gate.is_open", ack: false, val: 1}, function (obj) {  // ""  setState("javascript.0.gate_0.current", 0, true); }); on({id: "mqtt.0.gate.is_open", ack: false, val: 0}, function (obj) {  // ""  setState("javascript.0.gate_0.current", 1, true); }); //    - ,      on({id: "javascript.0.gate_0.target", ack: false, val: 0}, function (obj) {  setState("mqtt.0.gate.gpio.12", 1); }); //    - ,      on({id: "javascript.0.gate_0.target", ack: false, val: 1}, function (obj) {  setState("mqtt.0.gate.gpio.13", 1); }); on({id: "mqtt.0.gate.in_progress", ack: true, change: 'any'}, function (obj) {  //    " ",      if (obj.state.val === 1) {      //    "",         const target = getState("javascript.0.gate_0.target");      if (target.val === 0) {          // ""          setState("javascript.0.gate_0.current", 2, true);      } else {          // ""          setState("javascript.0.gate_0.current", 3, true);      }  }  //    " ",      if (obj.state.val === 0) {      //    "",         const target = getState("javascript.0.gate_0.target");      if (target.val === 0) {          // ""          setState("javascript.0.gate_0.current", 0, true);      } else {          // ""          setState("javascript.0.gate_0.current", 1, true);      }  } });</span></span></code> </pre> </div></div><br><p> è¿è¡Œè„šæœ¬åï¼Œæ‚¨å¯ä»¥é…ç½®è½¦åº“é—¨æœåŠ¡çš„ç‰¹å¾ï¼š </p><br><p><img src="https://habrastorage.org/webt/lb/cm/t5/lbcmt51du7vnivrjbj2o_h_u28u.png" alt="GarageDoorOpeneræœåŠ¡" title="GarageDoorOpeneræœåŠ¡"></p><br><p><img src="https://habrastorage.org/webt/pg/rh/ey/pgrhey_qs-cxm8rg6yj_lufgmgs.png"></p><br><h3 id="kamera"> æ‘„å½±æœº </h3><br><p> è¦å°†ç›¸æœºæ·»åŠ åˆ°HomeKitï¼Œå°†ä½¿ç”¨â€œç»å…¸â€æ–¹æ³•ã€‚ é€šè¿‡ffmpegæ¨¡å—ä»æ‘„åƒæœºå¹¿æ’­å›¾åƒæ˜¯æœ‰ç»„ç»‡çš„ã€‚ é€šè¿‡å®ƒï¼Œè¾“å…¥æµå°†è¢«ç¼–ç ï¼ŒåŠ å¯†å¹¶æä¾›ç»™Homekitã€‚ </p><br><p> é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨ioBrokeræ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šå®‰è£…ffmpegã€‚ </p><br><p> å¯¹äºæ¯ä¸ªå¹³å°ï¼Œå®ƒä»¥ä¸åŒçš„æ–¹å¼å®‰è£…ï¼Œæ‚¨å¯ä»¥ä»æºä»£ç è¿›è¡Œç»„è£…ï¼Œæˆ–è€…æœç´¢ç°æˆçš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.johnvansickle.com/ffmpeg/</a>å¿…é¡»å…·æœ‰libx264ç¼–ç å™¨ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨å®‰è£…ffmpegä¹‹åæ£€æŸ¥ç¼–ç å™¨ï¼š </p><br><pre> <code class="plaintext hljs">ffmpeg -codecs | grep 264</code> </pre> <br><p> ç»“æœåº”åŒ…å«ä»¥ä¸‹å½¢å¼çš„ä¸€è¡Œï¼š </p><br><pre> <code class="plaintext hljs">DEV.LS h264                 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (decoders: h264 h264_v4l2m2m h264_vdpau ) (encoders: libx264 libx264rgb h264_v4l2m2m )</code> </pre> <br><p> å¯¹äºRaspberry Pi 3ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="">ç°æˆçš„ç¨‹åºé›†</a> ï¼Œè¯¥<a href="">ç¨‹åºé›†</a>çš„ç¼–è§£ç å™¨æ”¯æŒGPUç¡¬ä»¶ç¼–ç ï¼ˆh264_omxï¼Œæ¶ˆè€—æ›´å°‘çš„èµ„æºï¼‰ã€‚ è¿™æ ·è¯´ï¼š </p><br><pre> <code class="plaintext hljs">wget https://github.com/legotheboss/YouTube-files/raw/master/ffmpeg_3.1.4-1_armhf.deb sudo dpkg -i ffmpeg_3.1.4-1_armhf.deb</code> </pre> <br><p> è¿™ä¸¤ä¸ªç¼–è§£ç å™¨éƒ½å­˜åœ¨äºæ­¤ç¨‹åºé›†ä¸­ï¼šlibx264å’Œh264_omx </p><br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦è·å–éœ€è¦å¹¿æ’­çš„æ‘„åƒæœºæµçš„åœ°å€ï¼ˆæ­¤æ­¥éª¤è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°æˆçš„å…¬å…±æµ</a> ã€‚ </p><br><p> ç°åœ¨å°†æ‘„åƒæœºæ·»åŠ åˆ°Yahkaï¼ŒæŒ‡ç¤ºæµçš„åœ°å€ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ›´æ”¹ç¼–è§£ç å™¨ï¼Œå›¾åƒå¤§å°å’Œå¸§é€Ÿç‡çš„å‚æ•°ã€‚ </p><br><p>  <strong>é‡è¦ï¼šå‚æ•°ç»„åˆå¯¹äºåœ¨Homekitä¸­æ­£ç¡®æ˜¾ç¤ºæ‘„åƒæœºéå¸¸é‡è¦ï¼Œå¹¶ä¸”å–å†³äºæ‘„åƒæœºå’Œæµã€‚</strong>  <strong>å®ƒè¿˜ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå› ä¸º</strong>  <strong>ffmpegçš„è¿è¡Œè¿‡ç¨‹æ¶ˆè€—å¤§é‡èµ„æºã€‚</strong> </p><br><p><img src="https://habrastorage.org/webt/zh/uj/6g/zhuj6gv7alolh2nfvmpyxgmnoju.png" alt="æ·»åŠ ç›¸æœº" title="æ·»åŠ ç›¸æœº"></p><br><p><img src="https://habrastorage.org/webt/w7/_z/pl/w7_zplfretbtbw0v66nb9ip9ira.png" alt="æµè®¾ç½®" title="æµè®¾ç½®"></p><br><div class="spoiler">  <b class="spoiler_title">æ‘„åƒæœºæ˜¯ä½œä¸ºå•ç‹¬çš„è®¾å¤‡æ·»åŠ åˆ°ç½‘å…³å¤–éƒ¨çš„ï¼Œå®ƒä»¬çš„æ·»åŠ æ–¹å¼å¿…é¡»ä¸ç½‘å…³ç›¸åŒ</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ib/8v/s9/ib8vs9ksuw5mk4ese_-gg6rnrv4.png"></p></div></div><br><p><img src="https://habrastorage.org/webt/0d/hp/qd/0dhpqdbfe_hgez4u7x2edcu92za.png" alt="ç›¸æœºç¼©ç•¥å›¾" title="ç›¸æœºé•œå¤´"></p><br><p><img src="https://habrastorage.org/webt/ue/tj/o4/uetjo4rqvi-fsae2rlkt56cmaji.png" alt="ä»ç›¸æœºæ’­æ”¾" title="ä»ç›¸æœºæ’­æ”¾"></p><br><h3 id="bonus"> çº¢åˆ© </h3><br><p> ä½œä¸ºå¥–åŠ±ï¼Œæˆ‘å°†è®¨è®ºæ‘„åƒæœºå¹¿æ’­çš„ç‰¹æ®Šç”¨æ³•ã€‚ </p><br><p> ä½¿ç”¨ç›¸åŒçš„ffmpegï¼Œè€Œä¸æ˜¯ç›¸æœºï¼Œæ‚¨å¯ä»¥å°è¯•å¹¿æ’­å›¾åƒï¼Œä»»ä½•å›¾ç‰‡ã€‚ è¿™äº›å›¾ç‰‡ä¹Ÿå¯ä»¥ä¸è§†é¢‘æµç»„åˆã€‚ æ‚¨å¯ä»¥åœ¨å›¾ç‰‡ä¸Šæ˜¾ç¤ºæ–‡æœ¬ï¼Œå›¾å½¢å’Œå…¶ä»–ä¿¡æ¯ã€‚ </p><br><p><img src="https://habrastorage.org/webt/sg/cl/f7/sgclf7ssws1pkm_rlf3qy_avmhi.png" alt="æ–‡å­—å åŠ è½¬æ¢" title="æ–‡å­—åˆå¹¶è½¬æ¢"></p><br><p> ç»“æœï¼Œæ‚¨å¯ä»¥è·å¾—ä¸€ä¸ªæœ‰è¶£çš„ä»ªè¡¨æ¿ã€‚ è€Œä¸”ï¼Œå¦‚æœæ‚¨å®šæœŸæ›´æ–°å›¾ç‰‡ï¼Œåˆ™ä¼šè·å¾—åŠ¨æ€æ•°æ®ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæˆ‘ä»¥å›¾ç‰‡ï¼ˆç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼‰çš„å½¢å¼ç»˜åˆ¶äº†ä¸€äº›æŒ‡æ ‡çš„å˜åŒ–å›¾ã€‚ è¯¥å›¾æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œå¹¶è¦†ç›–æ–‡ä»¶ä¸­çš„å›¾åƒã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ï¼ˆå‡½æ•°createImage1ï¼ŒcreateImage2ï¼Œå›¾å½¢çš„å½¢æˆå’Œåœ¨å›¾ç‰‡ä¸Šçš„æ–‡å­—æ‹¼åˆè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†æˆ‘ä¼šç»™å‡ºæç¤ºï¼‰</b> <div class="spoiler_text"><p> æˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•è·å–å›¾ç‰‡å½¢å¼çš„å›¾å½¢ã€‚ </p><br><p>  IoBrokerå…·æœ‰æ„å»ºå›¾å½¢çš„æ ‡å‡†æ–¹æ³•-Floté©±åŠ¨ç¨‹åºã€‚ è¯¥é©±åŠ¨ç¨‹åºä¸Webé©±åŠ¨ç¨‹åºé…å¯¹ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºç»“æœã€‚ ä½†æ˜¯ï¼Œä¸ºäº†åœ¨æœåŠ¡å™¨ä¸Šï¼ˆåœ¨è„šæœ¬ä¸­ï¼‰å°†åˆ›å»ºçš„å›¾å½¢ä½œä¸ºå›¾åƒè·å–ï¼Œéœ€è¦é¢å¤–çš„PhantomJSé©±åŠ¨ç¨‹åºï¼Œè¯¥é©±åŠ¨ç¨‹åºéœ€è¦é¡µé¢çš„â€œå±å¹•æˆªå›¾â€ï¼ˆæˆ‘ä»¬å°†åœ¨è¯¥å±å¹•ä¸Šç»˜åˆ¶Flotå›¾ï¼‰ã€‚ </p><br><p> ä½†æ˜¯ï¼Œæˆ‘å°†è®¨è®ºåœ¨è„šæœ¬ä¸­åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºå›¾å½¢çš„å¦ä¸€ç§æ–¹æ³•ã€‚ </p><br><p> æœ‰ä¸€ä¸ªChart.jsåº“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://www.chartjs.org/</a> ï¼Œå¯è®©æ‚¨åœ¨æµè§ˆå™¨ä¸­ç»˜åˆ¶æ¼‚äº®çš„å›¾å½¢ï¼ˆä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://www.chartjs.org/samples/latest/</a> ï¼‰ã€‚ </p><br><p> å¯¹äºç»˜å›¾ï¼Œå®ƒä½¿ç”¨æµè§ˆå™¨çš„â€œç”»å¸ƒâ€ï¼ˆç”»å¸ƒï¼Œç”»å¸ƒï¼‰ã€‚ å› æ­¤ï¼Œè¦åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨æ­¤åº“è¿›è¡Œç»˜åˆ¶ï¼Œæ‚¨éœ€è¦ä½¿ç”¨â€œç”»å¸ƒâ€å’ŒDOMå¯¹è±¡çš„â€œæœåŠ¡å™¨â€ç‰ˆæœ¬ã€‚ è¿™å°±æ˜¯chartjs-nodeè½¯ä»¶åŒ…çš„åŠŸèƒ½ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/vmpowerio/chartjs-node</a> ï¼‰ã€‚ </p><br><p> è¯¥ç¨‹åºåŒ…çš„ä¸»è¦ä¾èµ–é¡¹æ˜¯canvasç¨‹åºåŒ…ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/Automattic/node-canvas</a> ï¼‰ï¼Œè¯¥ç¨‹åºåŒ…åº”å…¨å±€å®‰è£…ï¼ˆæˆ–å®‰è£…åœ¨iobrokeræ–‡ä»¶å¤¹ä¸­ï¼‰ã€‚ é‡è¦çš„æ˜¯ä¸ºæ”¾ç½®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/Automattic/node-canvas#compiling</a>çš„å¹³å°å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ã€‚ </p><br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥åœ¨javascripté©±åŠ¨ç¨‹åºè®¾ç½®ä¸­æ·»åŠ chart.jsï¼Œchartjs-nodeæ¨¡å—ã€‚ å®ƒä»¬åº”è¯¥æ­£ç¡®å®‰è£…ï¼Œæ²¡æœ‰é”™è¯¯ã€‚ å¦åˆ™ï¼Œè¯·å¤„ç†å¹¶è§£å†³é”™è¯¯ã€‚ </p><br><p> ç„¶åï¼Œæ‚¨å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬ã€‚ </p><br><p> ä¸‹é¢æ˜¯ä¸€ä¸ªè„šæœ¬ç¤ºä¾‹ï¼Œå¦‚ä¸‹ å®ƒåŒ…æ‹¬ä½¿ç”¨å†å²è®°å½•é©±åŠ¨ç¨‹åºå¹¶ä½¿ç”¨ç‰¹å®šçš„çŠ¶æ€åç§°ã€‚ </p><br><p> æ³¨æ„ï¼ å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¯¥è„šæœ¬å…·æœ‰å¤æ‚çš„ç»“æ„-Promiseã€‚ è¿™æ˜¯ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å›è°ƒç¼–å†™å‡½æ•°ï¼Œè€Œæ˜¯åˆ¶ä½œæ­¥éª¤é“¾ã€‚ å› æ­¤ï¼Œä¾‹å¦‚ï¼Œè¿™æ ·åšå¾ˆæ–¹ä¾¿ï¼Œå¯ä»¥ä»çŠ¶æ€å†å²ä¸­è·å–æ•°æ®ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ChartjsNode = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'chartjs-node'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/** *  sendTo  Promise,      */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToPromise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">adapter, cmd, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { sendTo(adapter, cmd, params, (result) =&gt; { resolve(result); }); }); } <span class="hljs-comment"><span class="hljs-comment">//    const chartColors = { black: 'rgb(0, 0, 0)', red: 'rgb(255, 99, 132)', orange: 'rgb(255, 159, 64)', yellow: 'rgb(255, 205, 86)', green: 'rgb(75, 192, 192)', blue: 'rgb(54, 162, 235)', purple: 'rgb(153, 102, 255)', grey: 'rgb(201, 203, 207)' }; /** *        * : * @param config -     * @param filename -     * : * @param Promise -    */ function doDraw(config, filename) { //     640x480  var chartNode = new ChartjsNode(640, 480); return chartNode.drawChart(config) .then(() =&gt; { //     return chartNode.writeImageToFile('image/png', filename); }); } /** *     ChartJS. * : * @param Promise -    */ function prepareDraw0(){ // ,    var ; //  Promise     return new Promise((resolve, reject)=&gt;{resolve()}) //       ,      .then(()=&gt;{ //  ,   ,      = [ {"val":3,"ack":1,"ts":1539063874301}, {"val":5,"ack":1,"ts":1539063884299}, {"val":5.3,"ack":1,"ts":1539063894299}, {"val":3.39,"ack":1,"ts":1539063904301}, {"val":5.6,"ack":1,"ts":1539063914300}, {"val":-1.3,"ack":1,"ts":1539063924300}, {"val":-6.3,"ack":1,"ts":1539063934302}, {"val":1.23,"ack":1,"ts":1539063944301}, ]; }) //   -    .then(()=&gt;{ const chartJsOptions = { //   -  type: 'line', data: { //    datasets: [ { //   label: '', //  backgroundColor: chartColors.black, borderColor: chartColors.black, //   pointRadius: 3, //    borderWidth: 3, //     ''        data: .map((item) =&gt; { return {y: item.val, t: new Date(item.ts)} }), //   -  fill: false, } ] }, options: { //   legend: { labels: { //   fontSize: 20, }, }, //   scales: { //  X xAxes: [{ //  -   type: 'time', display: true, //   scaleLabel: { display: true, labelString: '' }, }], //  Y yAxes: [{ //  -  type: 'linear', display: true, //   scaleLabel: { display: true, labelString: '' }, }] } } }; return chartJsOptions; }); } /** *     ChartJS. *         , *     . * * : * @param hours -  ,     * : * @param Promise -    */ function prepareDraw1(hours){ //   ,      const end = new Date().getTime(), start = end - 3600000*(hours || 1); // 1 =   //  ,       //   var , 2, 1, 2, 2; //  Promise     return new Promise((resolve, reject)=&gt;{resolve()}) //       'mqtt.0.ESP_Easy..Temperature' .then(() =&gt; { return sendToPromise('history.0', 'getHistory', { id: 'mqtt.0.ESP_Easy..Temperature', options: { start: start, end: end, aggregate: 'onchange' } } ).then((result) =&gt; { //     ''  = result.result; }); }) //       'sonoff.0.chicken2.DS18B20_Temperature' .then(() =&gt; { return sendToPromise('history.0', 'getHistory', { id: 'sonoff.0.chicken2.DS18B20_Temperature', options: { start: start, end: end, aggregate: 'onchange' } }).then((result)=&gt;{ //     '2' 2 = result.result; }); }) .then(() =&gt; { return sendToPromise('history.0', 'getHistory', { id: 'sonoff.0.sonoff_chicken_vent.DS18B20_Temperature', options: { start: start, end: end, aggregate: 'onchange' } }).then((result)=&gt;{ 1 = result.result; }); }) .then(() =&gt; { return sendToPromise('history.0', 'getHistory', { id: 'sonoff.0.chicken2.POWER1', options: { start: start, end: end, aggregate: 'onchange' } }).then((result)=&gt;{ 2 = result.result; }); }) .then(() =&gt; { return sendToPromise('history.0', 'getHistory', { id: 'sonoff.0.chicken2.POWER2', options: { start: start, end: end, aggregate: 'onchange' } }).then((result)=&gt;{ 2 = result.result; }); }) //   -    .then(()=&gt;{ const chartJsOptions = { //   -  type: 'line', data: { //    datasets: [ { //           label: ' ('+[.length - 1].val+')', //  backgroundColor: chartColors.blue, borderColor: chartColors.blue, //  . 0 -   pointRadius: 0, //    borderWidth: 3, //     ''        data: .map((item) =&gt; { return {y: item.val, t: new Date(item.ts)} }), //   -  fill: false, //   Y yAxisID: 'y-axis-1', },{ label: ' 1 ('+1[1.length - 1].val+')', backgroundColor: chartColors.green, borderColor: chartColors.green, pointRadius: 0, borderWidth: 3, data: 1.map((item) =&gt; { return {y: item.val, t: new Date(item.ts)} }), fill: false, yAxisID: 'y-axis-1', },{ label: ' 2 ('+2[2.length - 1].val+')', backgroundColor: chartColors.red, borderColor: chartColors.red, pointRadius: 0, borderWidth: 3, data: 2.map((item) =&gt; { return {y: item.val, t: new Date(item.ts)} }), fill: false, yAxisID: 'y-axis-1', },{ label: ' 2  ('+2[2.length - 1].val+')', backgroundColor: chartColors.yellow, borderColor: chartColors.yellow, pointRadius: 0, borderWidth: 1, data: 2.map((item) =&gt; { return {y: (item.val) ? 1 : 0, t: new Date(item.ts)} }), fill: true, lineTension: 0, steppedLine: true, yAxisID: 'y-axis-2', },{ label: ' 2  ('+2[2.length - 1].val+')', backgroundColor: chartColors.grey, borderColor: chartColors.grey, pointRadius: 0, borderWidth: 1, data: 2.map((item) =&gt; { return {y: (item.val) ? -1 : 0, t: new Date(item.ts)} }), fill: true, lineTension: 0, steppedLine: true, yAxisID: 'y-axis-2', } ] }, options: { //   legend: { labels: { //   fontSize: 20, }, }, //   scales: { //  X xAxes: [{ //  -   type: 'time', display: true, //   scaleLabel: { display: true, labelString: '' }, //    () time: { unit: 'minute', displayFormats: { minute: 'HH:mm' } }, }], //  Y yAxes: [{ //  -  type: 'linear', display: true, //   scaleLabel: { display: true, labelString: '' }, //   -  position: 'left', //   id: 'y-axis-1', },{ type: 'linear', display: true, scaleLabel: { display: true, labelString: '  ' }, ticks: { min: -4, max: 2 }, //   -  position: 'right', id: 'y-axis-2', }] } } }; return chartJsOptions; }); } function createImage(filename, callback){ // filename -  ,       //    prepareDraw1(2) //     .then((result) =&gt; { //        return doDraw(result, filename); }) .then(()=&gt;{ if (callback) callback(); }) .catch((err)=&gt;{ console.error(err); }); }</span></span></code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/4c/d5/bs/4cd5bslfzniznrd16qfmqu0tuly.png" alt="å¹¿æ’­å›¾åƒè€Œä¸æ˜¯æµ" title="å¹¿æ’­å›¾åƒè€Œä¸æ˜¯æµ"></p><br><p> ç¼©ç•¥å›¾å¤§çº¦æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬å°†å›¾åƒè®¾ç½®ä¸ºæ¯10ç§’æ›´æ–°ä¸€æ¬¡ï¼š </p><br><pre> <code class="plaintext hljs">var fs = require('fs'); //  10    schedule("*/10 * * * * *", () =&gt; {  createImage1('/tmp/1_new.jpg', ()=&gt; {      fs.renameSync('/tmp/1_new.jpg', '/tmp/1.jpg');  });  createImage2('/tmp/2_new.jpg', ()=&gt; {      fs.renameSync('/tmp/2_new.jpg', '/tmp/2.jpg');  }); });</code> </pre> <br><p> ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œåœ¨å¹¿æ’­å›¾åƒçš„è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»è¶³å¤Ÿå¿«åœ°æ›¿æ¢å›¾ç‰‡ï¼Œä»¥å…ffmpegå´©æºƒï¼š)å› æ­¤ï¼Œå›¾ç‰‡é¦–å…ˆå½¢æˆä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶é‡å‘½åä¸ºç”¨äºç¿»è¯‘çš„æ–‡ä»¶ã€‚ </p><br><p> ç°åœ¨ï¼Œåœ¨æ‘„åƒæœºè®¾ç½®ä¸­ï¼ŒæŒ‡å®šç”Ÿæˆæ–‡ä»¶çš„åç§°è€Œä¸æ˜¯æµåœ°å€ï¼Œå¹¶æ·»åŠ â€œå›¾ç‰‡å·²æ›´æ–°â€çš„è®¾ç½®ï¼ˆå‚æ•°â€œ -loop 1â€ï¼‰ã€‚ è¿™æ˜¯åœ¨æ‘„åƒæœºçš„é«˜çº§å±æ€§ä¸­é…ç½®çš„ã€‚ è¿™äº›å±æ€§ä»…æ˜¯è¿è¡Œffmpegçš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚ å› æ­¤ï¼Œåº”åœ¨ffmpegæ–‡æ¡£å’Œç¤ºä¾‹ä¸­æ‰¾åˆ°å‚æ•°çš„ç»„åˆã€‚ </p><br><p> è¿™äº›å±æ€§åˆ†ä¸ºä¸¤ç§ï¼šç”¨äºæ¥æ”¶â€œé¢„è§ˆâ€ï¼ˆæ‘„åƒæœºçš„å°å›¾åƒï¼‰å’Œç”¨äºå¹¿æ’­ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸åŒçš„å›¾åƒæºæ–‡ä»¶ï¼Œä¾‹å¦‚å…·æœ‰ä¸åŒçš„è¯¦ç»†ä¿¡æ¯ã€‚ </p><br><p><img src="https://habrastorage.org/webt/zy/30/b4/zy30b4wc2zud54wr-px_ezovdgu.png" alt="ffmpegå¯åŠ¨é€‰é¡¹" title="ffmpegå¯åŠ¨é€‰é¡¹"></p><br><p><img src="https://habrastorage.org/webt/mk/l5/qi/mkl5qizqb41if_youa62qrgm9hc.png" alt="ç›´æ’­å½±åƒ" title="ç›´æ’­å½±åƒ"></p><br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p>         ioBroker     .       ,       . ,   ,        . </p><br><p>  ,    Yahka       ,      Material.           ,            HomeKit. </p><br><p>       Yahka,    HomeKit     â€”  Ham,     HomeBridge         .       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433798/">https://habr.com/ru/post/zh-CN433798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433786/index.html">Fintech Digestï¼šåŠ å¯†è´§å¸æ˜¯è´¢äº§ï¼Œä¿„ç½—æ–¯è”é‚¦å·²ç»å‘è¡Œäº†åˆ›çºªå½•æ•°é‡çš„ä¿¡ç”¨å¡</a></li>
<li><a href="../zh-CN433788/index.html">å®‰å…¨äº¤æ˜“å’Œæ–°è‡ªç”±èŒä¸šè€…è¯„è®º</a></li>
<li><a href="../zh-CN433790/index.html">å…ˆè¿›çš„å¤šé˜¶æ®µæ„å»ºæ¨¡æ¿</a></li>
<li><a href="../zh-CN433792/index.html">Ansibleä¸­çš„Shellè„šæœ¬</a></li>
<li><a href="../zh-CN433796/index.html">æ™ºäººå¦‚ä½•å¾æœä¸–ç•Œã€‚ æ²Ÿé€šå’Œè°ˆåˆ¤æŠ€å·§</a></li>
<li><a href="../zh-CN433800/index.html">ä½¿ç”¨èµ›æ™®æ‹‰æ–¯çš„UDB PSoCæ§åˆ¶å™¨å‡å°‘3Dæ‰“å°æœºä¸­çš„ä¸­æ–­</a></li>
<li><a href="../zh-CN433802/index.html">æˆ‘ä»¬å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆåœ¨Urban Tech Challenge Hackathonèµ¢å¾—å¤§æ•°æ®èµ›é“</a></li>
<li><a href="../zh-CN433804/index.html">æ··åˆç‰©å¯†åº¦ç½‘ç»œ</a></li>
<li><a href="../zh-CN433806/index.html">å½“åœ¨çº¿æ¡£æ¡ˆå¿˜è®°äº†</a></li>
<li><a href="../zh-CN433808/index.html">ç¨‹åºå‘˜åœ¨é¢è¯•ä¸­çŠ¯çš„5ä¸ªæœ€å¸¸è§çš„é”™è¯¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>