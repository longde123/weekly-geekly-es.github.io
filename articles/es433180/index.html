<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∑ üëÜüèº üßëüèæ Resolver problemas de tipo de datos en Ruby o hacer que los datos sean confiables nuevamente üëãüèø üíè üàπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, me gustar√≠a hablar sobre qu√© problemas con los tipos de datos est√°n en Ruby, qu√© problemas he encontrado, c√≥mo se pueden resolver y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Resolver problemas de tipo de datos en Ruby o hacer que los datos sean confiables nuevamente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433180/">  En este art√≠culo, me gustar√≠a hablar sobre qu√© problemas con los tipos de datos est√°n en Ruby, qu√© problemas he encontrado, c√≥mo se pueden resolver y c√≥mo asegurarse de que se pueda confiar en los datos con los que trabajamos. <br><br><img src="https://habrastorage.org/webt/re/27/5n/re275nqouf3ucrd8gxrmv0cvboq.png" alt="imagen"><br><a name="habracut"></a><br>  Primero debe decidir qu√© tipos de datos son.  Veo una definici√≥n muy exitosa del t√©rmino, que se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HaskellWiki</a> . <br><blockquote>  Los tipos son c√≥mo describe los datos con los que trabajar√° su programa. </blockquote>  Pero, ¬øqu√© hay de malo con los tipos de datos en Ruby?  Para describir el problema de manera integral, me gustar√≠a destacar varias razones. <br><br><h4>  Motivo 1. Problemas del propio Ruby </h4><br>  Como sabes, Ruby usa <b>una mecanograf√≠a din√°mica estricta con soporte para los llamados.</b>  <b>pato escribiendo</b> .  ¬øQu√© significa esto? <br><br>  La escritura fuerte requiere una conversi√≥n expl√≠cita y no produce esta conversi√≥n por s√≠ sola, como es el caso, por ejemplo, en JavaScript.  Por lo tanto, la siguiente lista de c√≥digos en Ruby fallar√°: <br><br><pre><code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-string"><span class="hljs-string">'1'</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> #=&gt; <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> can<span class="hljs-string"><span class="hljs-string">'t be coerced into Integer)</span></span></code> </pre> <br>  En la escritura din√°mica, la verificaci√≥n de tipos se realiza en tiempo de ejecuci√≥n, lo que nos permite no especificar los tipos de variables y usar la misma variable para almacenar valores de diferentes tipos: <br><br><pre> <code class="javascript hljs">x = <span class="hljs-number"><span class="hljs-number">123</span></span> x = <span class="hljs-string"><span class="hljs-string">"123"</span></span> x = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre><br>  La siguiente declaraci√≥n generalmente se da como una explicaci√≥n del t√©rmino ‚Äútipear patos‚Äù: si parece un pato, nada como un pato y grazna como un pato, entonces es muy probable que sea un pato.  Es decir  La escritura de pato, que se basa en el comportamiento de los objetos, nos proporciona flexibilidad adicional para escribir nuestros sistemas.  Por ejemplo, en el ejemplo a continuaci√≥n, el valor para nosotros no es el tipo de argumento de <code>collection</code> , sino su capacidad de responder a mensajes en <code>blank?</code>  y <code>map</code> : <br><br><pre> <code class="javascript hljs">def process(collection) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> collection.blank? collection.map { |item| do_something_with(item) } end</code> </pre><br>  La capacidad de crear tales "patos" es una herramienta muy poderosa.  Sin embargo, como cualquier otra herramienta poderosa, requiere mucho cuidado cuando se usa.  Esto se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">verificar mediante la investigaci√≥n de Rollbar</a> , donde analizaron m√°s de 1000 aplicaciones de Rail e identificaron los errores m√°s comunes.  Y 2 de los 10 errores m√°s comunes est√°n relacionados precisamente con el hecho de que el objeto no puede responder a un mensaje espec√≠fico.  Y, por lo tanto, verificar el comportamiento del objeto que nos da la escritura de pato en muchos casos puede no ser suficiente. <br><br>  Podemos observar c√≥mo se agrega la verificaci√≥n de tipos a los lenguajes din√°micos de una forma u otra: <br><br><ul><li>  TypeScript lleva la verificaci√≥n de tipos a los desarrolladores de JavaScript </li><li>  Se agregaron sugerencias de tipo en Python 3 </li><li>  Dialyzer hace un buen trabajo de verificaci√≥n de tipos para Erlang / Elixir </li><li>  Steep y Sorbet agregan verificaci√≥n de tipo en Ruby 2.x </li></ul><br>  Sin embargo, antes de hablar sobre otra herramienta para trabajar con tipos de manera m√°s eficiente en Ruby, veamos dos problemas m√°s para los cuales me gustar√≠a encontrar una soluci√≥n. <br><br><h4>  Raz√≥n 2. El problema general de los desarrolladores en varios lenguajes de programaci√≥n. </h4><br>  Recordemos la definici√≥n de tipos de datos que di al principio del art√≠culo: <blockquote>  Los tipos son c√≥mo describe los datos con los que trabajar√° su programa. </blockquote>  Es decir  los tipos est√°n dise√±ados para ayudarnos a describir datos de nuestra √°rea tem√°tica en la que operan nuestros sistemas.  Sin embargo, a menudo en lugar de operar con los tipos de datos que creamos a partir de nuestra √°rea tem√°tica, usamos tipos primitivos, como n√∫meros, cadenas, matrices, etc., que no dicen nada sobre nuestra √°rea tem√°tica.  Este problema generalmente se clasifica como obsesi√≥n primitiva (obsesi√≥n con los primitivos). <br><br>  Aqu√≠ hay un ejemplo t√≠pico de obsesi√≥n primitiva: <br><br><pre> <code class="javascript hljs">price = <span class="hljs-number"><span class="hljs-number">9.99</span></span> # vs Money = Struct.new(:amount_cents, :currency) price = Money.new(<span class="hljs-number"><span class="hljs-number">9</span></span>_99, <span class="hljs-string"><span class="hljs-string">'USD'</span></span>)</code> </pre><br>  En lugar de describir el tipo de datos para trabajar con dinero, a menudo se usan n√∫meros regulares.  Y este n√∫mero, como cualquier otro tipo primitivo, no dice nada sobre nuestra √°rea tem√°tica.  En mi opini√≥n, este es el mayor problema de usar primitivas en lugar de crear su propio sistema de tipos, donde estos tipos describir√°n datos de nuestra √°rea tem√°tica.  Nosotros mismos rechazamos las ventajas que podemos obtener con el uso de tipos. <br><br>  Hablar√© sobre estas ventajas inmediatamente despu√©s de cubrir otro tema que nuestro marco favorito de Ruby on Rails nos ha ense√±ado, gracias a lo cual, estoy seguro, la mayor√≠a de los que est√°n aqu√≠ han venido a Ruby. <br><br><h4>  Motivo 3. El problema al que el marco de Ruby on Rails nos acostumbr√≥ </h4><br>  Ruby on Rails, o m√°s bien el marco <code>ActiveRecord</code> ORM integrado en √©l, nos ense√±√≥ que los objetos que est√°n en un estado no v√°lido son normales.  En mi opini√≥n, esto est√° lejos de ser la mejor idea.  Y tratar√© de explicarlo. <br><br>  Toma este ejemplo: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">presence</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> </span></span>= App.new app.valid? # =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  No es dif√≠cil entender que el objeto de la <code>app</code> tendr√° un estado no v√°lido: la validaci√≥n del modelo de la <code>App</code> requiere que los objetos de este modelo tengan un atributo de <code>platform</code> , y nuestro objeto tiene este atributo vac√≠o. <br><br>  Ahora, intentemos pasar este objeto en un estado no v√°lido a un servicio que espera el objeto de la <code>App</code> como argumento y realiza algunas acciones dependiendo del atributo de <code>platform</code> de este objeto: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class"> # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">param</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> # # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">) # </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  En este caso, incluso la verificaci√≥n de tipo pasar√≠a.  Sin embargo, dado que este atributo est√° vac√≠o para el objeto, no est√° claro c√≥mo manejar√° este caso el servicio.  En cualquier caso, al tener la capacidad de crear objetos en un estado no v√°lido, nos condenamos a la necesidad de manejar constantemente los casos en que un estado no v√°lido se haya filtrado en nuestro sistema. <br><br>  Pero pensemos en un problema m√°s profundo.  En general, ¬øpor qu√© verificamos la validez de los datos?  Como regla general, para asegurarnos de que un estado no v√°lido no se filtre en nuestros sistemas.  Si es tan importante asegurarse de que no se permite un estado no v√°lido, ¬øpor qu√© permitimos que se creen objetos con un estado no v√°lido?  Especialmente cuando se trata de objetos tan importantes como el modelo ActiveRecord, que a menudo se refiere a la l√≥gica empresarial ra√≠z.  En mi opini√≥n, esto suena como una muy mala idea. <br><br>  Entonces, resumiendo todo lo anterior, tenemos los siguientes problemas al trabajar con datos en Ruby / Rails: <br><br><ul><li>  el lenguaje en s√≠ tiene un mecanismo para verificar el comportamiento, pero no datos </li><li>  nosotros, como los desarrolladores en otros idiomas, tendemos a usar tipos de datos primitivos en lugar de crear un sistema de tipos para nuestra √°rea tem√°tica </li><li>  Rails nos acostumbr√≥ al hecho de que la presencia de objetos en un estado no v√°lido es normal, aunque tal soluci√≥n parece una muy mala idea. </li></ul><br><h4>  ¬øC√≥mo se pueden resolver estos problemas? </h4><br>  Me gustar√≠a considerar una de las soluciones a los problemas descritos anteriormente, usando un ejemplo de implementaci√≥n de caracter√≠sticas reales en Appodeal.  En el proceso de recopilaci√≥n de estad√≠sticas sobre las estad√≠sticas de Usuarios activos diarios (en adelante DAU) para aplicaciones que utilizan Appodeal para monetizar, llegamos aproximadamente a la siguiente estructura de datos que necesitamos recopilar: <br><br><pre> <code class="javascript hljs">DailyActiveUsersData = Struct.new( :app_id, :country_id, :user_id, :ad_type, :platform_id, :ad_id, :first_request_date, <span class="hljs-attr"><span class="hljs-attr">keyword_init</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> )</code> </pre><br>  Esta estructura tiene los mismos problemas que escrib√≠ anteriormente: <br><br><ul><li>  cualquier tipo de verificaci√≥n est√° completamente ausente, lo que deja en claro qu√© valores pueden tomar los atributos de esta estructura </li><li>  no hay una descripci√≥n de los datos utilizados en esta estructura, y en lugar de los tipos espec√≠ficos de nuestro dominio, se utilizan primitivas </li><li>  la estructura puede existir en un estado no v√°lido </li></ul><br>  Para resolver estos problemas, decidimos usar las bibliotecas de <code>dry-types</code> <code>dry-struct</code> .  <code>dry-types</code> es un sistema de <code>dry-types</code> simple y extensible para Ruby, √∫til para lanzar, aplicar diversas restricciones, definir estructuras complejas, etc. <code>dry-struct</code> es una biblioteca construida sobre <code>dry-types</code> que proporciona un DSL conveniente para definir estructuras con tipo / clases <br><br>  Para describir los datos de nuestra √°rea tem√°tica utilizada en la estructura para recopilar DAU, se cre√≥ el siguiente sistema de tipos: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> Types include Dry::Types.module AdTypeId = Types::Strict::Integer.enum(AD_TYPES.invert) EntityId = Types::Strict::Integer.constrained(gt: <span class="hljs-number"><span class="hljs-number">0</span></span>) PlatformId = Types::Strict::Integer.enum(PLATFORMS.invert) Uuid = Types::Strict::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.constrained(format: UUID_REGEX) Zero = Types.Constant(<span class="hljs-number"><span class="hljs-number">0</span></span>) end</code> </pre><br>  Ahora hemos recibido una descripci√≥n de los datos que se usan en nuestro sistema y que podemos usar en la estructura.  Como puede ver, los tipos <code>EntityId</code> y <code>EntityId</code> tienen algunas limitaciones, y los tipos enumerables <code>AdTypeId</code> y <code>PlatformId</code> solo pueden tener valores de un conjunto espec√≠fico.  ¬øC√≥mo trabajar con estos tipos?  Considere <code>PlatformId</code> como ejemplo: <br><br><pre> <code class="javascript hljs">#     enumerable- PLATFORMS = { <span class="hljs-string"><span class="hljs-string">'android'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'fire_os'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> }.freeze #       , #     Types::PlatformId[<span class="hljs-number"><span class="hljs-number">1</span></span>] == Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'android'</span></span>] #    ,    #   ,     Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'fire_os'</span></span>] # =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> #     ,   Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>] # =&gt; Dry::Types::ConstraintError</code> </pre><br>  Entonces, usando los tipos mismos descubiertos.  Ahora apliqu√©moslos a nuestra estructura.  Como resultado, obtuvimos esto: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DailyActiveUsersData</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dry</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">country_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_type</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdTypeId</span></span></span><span class="hljs-class"> «Ä </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zero</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlarformId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Uuid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first_request_date</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Strict</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  ¬øQu√© vemos ahora en la estructura de datos para DAU?  Al usar <code>dry-types</code> <code>dry-struct</code> eliminamos los problemas asociados con la falta de verificaci√≥n del tipo de datos y la falta de descripci√≥n de los datos.  Ahora, cualquier persona que haya examinado esta estructura y la descripci√≥n de los tipos utilizados en ella, puede comprender qu√© valores puede tomar cada atributo. <br><br>  En cuanto al problema con los objetos en estado no v√°lido, <code>dry-struct</code> nos salva de esto: si intentamos inicializar la estructura con valores no v√°lidos, obtendremos un error.  Y para aquellos casos en los que la exactitud de los datos es esencial (y en el caso de la recopilaci√≥n de DAU, este es el caso con nosotros), en mi opini√≥n, obtener una excepci√≥n es mucho mejor que tratar de tratar datos no v√°lidos m√°s adelante.  Adem√°s, si el proceso de prueba est√° bien establecido para usted (y este es exactamente el caso con nosotros), entonces con una alta probabilidad, el c√≥digo que genera tales errores simplemente no llegar√° al entorno de producci√≥n. <br><br>  Y adem√°s de la incapacidad de inicializar objetos en un estado no v√°lido, <code>dry-struct</code> tampoco permite cambiar objetos despu√©s de la inicializaci√≥n.  Gracias a estos dos factores, tenemos la garant√≠a de que los objetos de tales estructuras estar√°n en un estado v√°lido y usted puede confiar en estos datos de manera segura en cualquier parte de su sistema. <br><br><h4>  Resumen </h4><br>  En este art√≠culo trat√© de describir los problemas que puede encontrar al trabajar con datos en Ruby, as√≠ como hablar sobre las herramientas que utilizamos para resolver estos problemas.  Y gracias a la implementaci√≥n de estas herramientas, dej√© de preocuparme por la exactitud de los datos con los que estamos trabajando.  ¬øNo es eso perfecto?  ¬øNo es este el prop√≥sito de alg√∫n instrumento: facilitar nuestra vida en alg√∫n aspecto?  ¬°Y en mi opini√≥n, <code>dry-types</code> <code>dry-struct</code> y <code>dry-struct</code> su trabajo perfectamente! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433180/">https://habr.com/ru/post/es433180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433170/index.html">C√≥mo no pudimos rehacer la arquitectura de la empresa</a></li>
<li><a href="../es433172/index.html">Fijamos el modo multijugador al juego m√≥vil "Hacer palabras a partir de palabras" en iOS y Android, escrito en C ++</a></li>
<li><a href="../es433174/index.html">No todos los parches son igualmente √∫tiles.</a></li>
<li><a href="../es433176/index.html">Certificado de Docker Remote API de autenticaci√≥n con verificaci√≥n de revocaci√≥n</a></li>
<li><a href="../es433178/index.html">C√≥mo restauramos un archivo .wav da√±ado</a></li>
<li><a href="../es433182/index.html">¬øEs posible capacitar a un agente para negociar en el mercado de valores con refuerzos? Implementaci√≥n de lenguaje R</a></li>
<li><a href="../es433184/index.html">ASP.NET Core 2.2 lanzado. Que hay de nuevo (2 de 3)</a></li>
<li><a href="../es433186/index.html">No es suficiente contar pol√≠gonos para optimizar modelos 3D</a></li>
<li><a href="../es433188/index.html">La Duma del Estado present√≥ un proyecto de ley sobre el trabajo aut√≥nomo de Runet</a></li>
<li><a href="../es433192/index.html">Kubernetes: una soluci√≥n de proyecto personal incre√≠blemente asequible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>