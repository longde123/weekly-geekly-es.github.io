<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèº ‚ôçÔ∏è ü§πüèª Warum schreiben wir Gesch√§ftslogik in Lua? üö° üëéüèø üçï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr. In diesem Beitrag m√∂chten wir dar√ºber sprechen, wie und warum wir bei IPONWEB eine Programmiersprache mit dem sch√∂nen Namen Lua verwenden....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Warum schreiben wir Gesch√§ftslogik in Lua?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iponweb/blog/469049/">  Hallo Habr.  In diesem Beitrag m√∂chten wir dar√ºber sprechen, wie und warum wir bei IPONWEB eine Programmiersprache mit dem sch√∂nen Namen Lua verwenden. <br><br>  Lua ist eine skriptbasierte eingebettete Programmiersprache mit einem freien Interpreter und Open Source in C. Sie wurde 1993 in Brasilien in der Tecgraf-Abteilung der Katholischen Universit√§t von Rio de Janeiro entwickelt. Ihre Vorfahren waren DEL (Data-Entry Language) und SOL (Simple Object Language) dort fr√ºher entwickelt.  Einer der Vorfahren, die SOL-Sprache, nahm indirekt an der "Taufe" des Neugeborenen teil - "Sol" wird aus dem Portugiesischen als "Sonne" √ºbersetzt, und die neue Sprache wurde "Lua", "Mond" genannt. <br><br>  Die einfache Einbettung von Lua in Engines, die in ‚ÄûSystemsprachen‚Äú geschrieben sind, hat es zu einer beliebten Skriptsprache f√ºr Videospiele gemacht.  Zum Beispiel werden Skripte in Lua in Grim Fandango und Baldur's Gate geschrieben.  Diejenigen, die World of Warcraft spielen, haben wahrscheinlich auch mehr als ein- oder zweimal von Lua geh√∂rt - dort werden Add-Ons f√ºr das Spiel geschrieben, die Hardcore-Spielern, Gelegenheitsfans, Fans das Messen ihrer Effektivit√§t und anderen Bewohnern der Spielwelt das Leben erleichtern.  Au√üerhalb von Gamedev wird Lua als Skriptsprache f√ºr eingebettete Systeme (Fernseher, Drucker, Autotafeln) sowie f√ºr Anwendungen wie den VLC Media Player verwendet.  Lua verwendet Tools wie Tarantool, Redis und OpenResty als eingebettete Sprache.  Lua wurde auch als Erweiterungssprache f√ºr Fortran-Berechnungscodes verwendet, die das thermomechanische Verhalten von Kernbrennstoffen simulieren. <br><br><h3>  Warum Lua? </h3><br><a name="habracut"></a>  IPONWEB ist Entwickler hoch geladener Plattformen f√ºr Unternehmen, die im Bereich Online-Werbung t√§tig sind: DSP, SSP, Werbeagenturen und Werbetreibende.  Wir haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in diesem Artikel</a> ausf√ºhrlich √ºber unsere Arbeit gesprochen.  Zuerst haben wir die Gesch√§ftslogik unserer Plattformen in C ++ entwickelt, aber schnell erkannt, dass dies nicht die beste Wahl ist.  Um die Kosten zu minimieren, sind die Leistung der Plattform sowie die Entwicklungsgeschwindigkeit wichtig. Die C ++ - Entwicklung erwies sich f√ºr uns als zu langsam, und die Komplexit√§t des Hinzuf√ºgens von Funktionen wurde ebenfalls beeinflusst.  Wir beschlossen, die Interpretation der Gesch√§ftslogik vom Servercode auf niedriger Ebene zu isolieren, suchten nach einer geeigneten Sprache daf√ºr und entschieden uns f√ºr Lua.  Es war im Jahr 2008, JavaScript-Implementierungen, die f√ºr uns geeignet waren, gab es noch nicht, Perl, Python und Ruby waren zu langsam und nicht einfach einzubetten.  Und es gab die Lua-Sprache, die nicht sehr ber√ºhmt, aber bei Spielentwicklern beliebt war, und was wir wollten, √§hnelte den Anforderungen von Spieleentwicklern - wir brauchten eine schnelle Engine f√ºr Operationen auf niedriger Ebene und eine einfach zu erstellende schnelle Sprache f√ºr Gesch√§ftslogik. <br><br>  Lua ist wirklich eine sehr schnelle Sprache.  Eine zus√§tzliche Geschwindigkeitssteigerung kann mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LuaJIT erreicht</a> werden, der Laufzeitumgebung f√ºr Lua 5.1, die einen Tracing-JIT-Compiler enth√§lt (wir verwenden unseren eigenen Fork, √ºber den wir bereits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geschrieben haben</a> ).  Da wir Gesch√§ftslogik f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTB-</a> Systeme schreiben, ist die Geschwindigkeit f√ºr uns entscheidend: In RTB sind durchschnittlich 120 Millisekunden erforderlich, um jede eingehende Anforderung zu verarbeiten.  Gleichzeitig werden nur 10 bis 15 Millisekunden f√ºr die Codeausf√ºhrung zugewiesen, und der Rest der Zeit wartet auf eine Antwort von anderen Diensten.  Wenn ein Benutzer beispielsweise beim Laden eines Standorts im Netzwerk nicht einmal eine Verz√∂gerung von einer halben Sekunde bemerkt, sind diese 500 Millisekunden f√ºr RTB eine enorme Zeitspanne.  Die Antwort auf die Frage, wie schnell Lua ist, ist, dass es schnell genug ist, damit wir viele Jahre lang Gesch√§ftslogik darauf schreiben und im RTB-Gesch√§ft bleiben k√∂nnen.  Wenn die Sprache, die wir gew√§hlt haben, nicht schnell genug w√§re, h√§tten wir niemanden, f√ºr den wir die Plattform schreiben k√∂nnten.  Bedeutet dies, dass RTB nicht in anderen Sprachen geschrieben werden kann?  Bedeutet nicht.  Aber wir schreiben RTB in Lua und bew√§ltigen erfolgreich unsere und die Gesch√§ftsaufgaben unserer Kunden.  Ein gutes Beispiel f√ºr die Geschwindigkeit von Lua auf dem Server ist dieser OpenResty- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Benchmark</a> . <br><br>  Lua als eingebettete Sprache hat viele Vorteile: Es ist minimalistisch, kompakt und verf√ºgt √ºber eine sehr kleine Standardbibliothek.  Die Funktionalit√§t ist in C vollst√§ndig dupliziert, was eine einfache und ‚Äûnahtlose‚Äú Interaktion zwischen Lua und C erm√∂glicht. Lua hat im Vergleich zu vielen anderen Sprachen einen relativ niedrigen Anmeldeschwellenwert: Die meisten Programmierer, die in IPONWEB arbeiten, haben noch nie an Lua geschrieben, aber sie haben genug mehrere Tage, um sich voll auf die Arbeit einzulassen. <br><br>  Hier ist ein einfaches Beispiel f√ºr die Ausrichtung auf ein Werbepublikum. <br><br><pre><code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- deal: ,  ,      --     ( ,    ..) -- imp:   (impression opportunity),  --       local function can_be_shown(deal, imp) local targeting = deal.targeting --    if not targeting then return true end --         -- (,    ,   ): if targeting.media_type then if not passes_targeting(targeting.media_type, imp.details.media_type) then return false end end --        : if targeting.size then if not passes_targeting(targeting.size, imp.details.sizes) then return false end end return true end</span></span></code> </pre> <br>  Und so sieht ein einfacher Handler (Event-Handler) aus. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> adm_cache = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'modules.adm_cache'</span></span> <span class="hljs-comment"><span class="hljs-comment">-- adm = "ad markup" local config = require 'modules.config' local util = require 'modules.util' local AbstractHandler = require 'handlers.abstract' local ImpRenderHandler = AbstractHandler:new({is_server_request = false}) local IMP_RENDER_TEMPLATE = config.get('imp_render_template') local IMP_RENDER_BILLING = {name = 'free', type = 'in'} --   ,  . --   ( ,   ) . --          . function ImpRenderHandler:handle(params) local user_id = self.uuid local cache_id = get_param('id') if not cache_id or cache_id == '' then return self:process_bad_request({reason = '"id" parameter is expected', user_id = user_id}) end local adm = adm_cache.get(cache_id) if not adm then return self:process_bad_request({reason = 'No adm in cache', user_id = user_id}) end update_billing(IMP_RENDER_BILLING) self:log_request('imp_render', {adm = adm, user_id = user_id, cache_id = cache_id}) local content = util.expand_macro(IMP_RENDER_TEMPLATE, {ADM = adm}) return {200, content = content} end return ImpRenderHandler</span></span></code> </pre> <br>  Die Einfachheit von Lua erm√∂glicht nicht nur eine schnelle Entwicklung, sondern erm√∂glicht es Ihnen auch, viel Arbeit mit wenig Aufwand zu erledigen.  Die IPONWEB-Plattform ist eine allgemeine L√∂sung, die auf die Bed√ºrfnisse eines bestimmten Kunden zugeschnitten ist, w√§hrend ein Entwickler und ein Manager das Projekt durchf√ºhren k√∂nnen.  Lesen Sie den Code auf Lua k√∂nnen nicht nur die Entwickler selbst, sondern auch Projektmanager und manchmal Kunden.  Gemeinsam entdecken wir schnell das Problem, finden seine Ursache und L√∂sung.  Oft informiert der Projektmanager den Entwickler √ºber das Problem und schl√§gt sofort eine L√∂sung vor. <br><br>  Gleichzeitig kann die Einfachheit von Lua t√§uschen, w√§hrend Minimalismus und Kompaktheit einen Nachteil haben.  Wenn der Code beispielsweise in Perl oder Python geschrieben ist, verf√ºgt der Entwickler √ºber riesige Repositorys mit vorgefertigten Modulen, Ruby √ºber RubyGems und viele andere Sprachen √ºber umfangreiche Repositorys.  Und Lua hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LuaRocks</a> und die dreitausend Module, die dort liegen.  Selbst wenn LuaRocks √ºber das richtige Modul verf√ºgt, ist es sehr wahrscheinlich, dass Sie hart arbeiten m√ºssen, um es in einem bestimmten Unternehmen zu verwenden.  Lua bietet gute Tools zum Erstellen einer sicheren Umgebung f√ºr die Ausf√ºhrung von Code (Sandboxen). Bei der Arbeit in Sandboxen k√∂nnen einige Funktionen deaktiviert werden.  Dies bedeutet, dass LuaRocks-Module m√∂glicherweise nicht funktionieren, wenn sie Funktionen verwenden, die von der sicheren Umgebung des Unternehmens blockiert werden.  Dies ist der Preis f√ºr Kompaktheit und Einbettbarkeit, aber es ist den Preis wert - Sprachen mit Batterien wie beispielsweise Python sind nicht komplizierter als Lua. <br><br><h3>  Wie funktioniert es </h3><br>  Die Basis unserer Plattform ist ein anpassbarer HTTP-Server mit einer praktischen und erweiterbaren API, die dem Lua-Entwickler eine Reihe von Funktionen bietet und auf die Aufgaben des Werbemarkts zugeschnitten ist.  Dieser Server verarbeitet Hunderte Millionen Anfragen und schreibt Terabyte an Protokollen pro Tag.  Eingehende Anforderungen werden gleichm√§√üig auf die Systemthreads verteilt, und innerhalb der Systemthreads befinden sich Sandboxen. <br><br><img src="https://habrastorage.org/webt/ee/bx/sn/eebxsntveokgzzaz2ffyplaconc.png" alt="Bild"><br><br>  Wenn eine Anforderung auf dem Server eintrifft, wird in der Sandbox, in die diese Anforderung gefallen ist, eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Coroutine</a> erstellt, die die Anforderung verarbeitet.  Coroutinen arbeiten unabh√§ngig voneinander. Jede erstellte Coroutine wird zur Ausf√ºhrung in die Warteschlange gestellt.  Die Lebensdauer jeder Coroutine (die Gesamtverarbeitungszeit der Anforderung unter Ber√ºcksichtigung der erwarteten Antwort der beteiligten Dienste: Datenbank, Metriken, Budgetserver) sollte 120 Millisekunden nicht √ºberschreiten. <br><br><img src="https://habrastorage.org/webt/cz/sk/d3/czskd3si2n2k2mott6inf7f9qtk.png"><br><br>  Kurz gesagt kann der Anforderungsverarbeitungsprozess wie folgt beschrieben werden: <br><br><ol><li>  Jede empfangene Anfrage wird analysiert und besteht eine Standardpr√ºfung auf Richtigkeit. </li><li>  Corutin wird gestartet, das f√ºr die Bearbeitung dieser Anfrage verantwortlich ist.  In jedem Sandkasten befinden sich viele Coroutinen in unterschiedlichen Zust√§nden. </li><li>  Die Anforderungsverarbeitung beginnt, was zwei Ergebnisse haben kann: <br><ul><li>  Verarbeitung erfolgreich abgeschlossen. </li><li>  Corutin √ºbertr√§gt die Kontrolle auf den Server.  Dies geschieht normalerweise, wenn Coroutine auf eine Antwort von anderen Diensten wartet.  In solchen F√§llen wird die Arbeit des Corutins ausgesetzt, bis eine Antwort eintrifft oder die Wartezeit abl√§uft.  Beim √úbertragen der Steuerung beginnt der Server mit der Verarbeitung der n√§chsten Anforderung.  Dies kann entweder eine neue Anforderung oder eine Anforderung sein, die eine Antwort von allen beteiligten Diensten erh√§lt und bereit ist, den Code weiter auszuf√ºhren.  Die Reihenfolge der Verarbeitungsanforderungen wird durch die Anforderungen der Gesch√§ftslogik bestimmt. </li></ul></li></ol><br><img src="https://habrastorage.org/webt/bp/jv/gg/bpjvgg7pkb_394aojxgg2ykskqg.png"><br>  Die Verwendung von Corutin ist ein weiteres interessantes Thema, das eine ausf√ºhrliche Diskussion verdient.  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Artikel wird</a> beispielsweise erl√§utert, wie Corutins zum Erstellen von Zwischensequenzen in Videospielen verwendet werden k√∂nnen.  Und die Coroutinen auf dem Anwendungsserver sollten einen separaten Artikel widmen, und vielleicht werden wir es in Zukunft tun. <br><br><h3>  Was weiter? </h3><br>  Und dann wird vielleicht die Verwendung von Lua in IPONWEB erweitert.  Wir haben Ideen, wie Sie Lua noch in unserem Gesch√§ft einsetzen k√∂nnen, und wenn diese Ideen umgesetzt werden, werden wir auf jeden Fall neue Erfahrungen teilen.  Der Komfort und die F√§higkeiten von Lua als eingebettete Skriptsprache k√∂nnen uns insbesondere dabei helfen, die Verarbeitung von Kundendaten zu beschleunigen.  Dies ist jedoch immer noch aus dem Bereich der Pl√§ne und Perspektiven. <br><br>  Zusammenfassend k√∂nnen wir sagen, dass sich unsere vor 11 Jahren getroffene Wahl der Sprache der Gesch√§ftslogik weiterhin rechtfertigt, sodass wir unsere eigenen Gesch√§ftsaufgaben erfolgreich bew√§ltigen und uns bei der L√∂sung der Probleme unserer Kunden helfen k√∂nnen.  Leicht zu lesen, leicht zu integrieren, schnell und leicht zu erlernen, war und ist Lua eine der besten Skriptsprachen, deren Umfang keineswegs auf die Spieleentwicklung beschr√§nkt ist.  Die darauf geschriebene IPONWEB-Gesch√§ftslogik ist nur ein Beispiel daf√ºr. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469049/">https://habr.com/ru/post/de469049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469037/index.html">Industrielle Steuerung. Datenerfassungssystem. ACS</a></li>
<li><a href="../de469039/index.html">Mehr als ein Spiel: Mahjong mit KI und maschinellem Lernen meistern</a></li>
<li><a href="../de469041/index.html">Wie sch√ºtzen Sie Ihr ERP-System?</a></li>
<li><a href="../de469043/index.html">C / C ++ von Python (C API)</a></li>
<li><a href="../de469045/index.html">Python in Visual Studio Code - Ver√∂ffentlichung im September 2019</a></li>
<li><a href="../de469051/index.html">Der Azure Cloud Shell Connector im Windows-Terminal</a></li>
<li><a href="../de469053/index.html">Eine neue Videoserie f√ºr Anf√§nger zum Erlernen der Python-Programmierung</a></li>
<li><a href="../de469055/index.html">Zen-Praxis im offenen Raum</a></li>
<li><a href="../de469059/index.html">Was ist neu in ML.NET und Model Builder?</a></li>
<li><a href="../de469061/index.html">Rust 1.38.0 Release: Pipeline-Kompilierung, # [veraltet] f√ºr Makros und std :: any :: type_name</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>