<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯС░ЁЯП╛ ЁЯПШя╕П ЁЯда рдЦрд░реЛрдВрдЪ рд╕реЗ рдПрдХ рдЖрдзреБрдирд┐рдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдирд╛ тМЫя╕П ЁЯЩБ ЁЯСйЁЯП┐тАНЁЯдЭтАНЁЯСиЁЯП╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрд╕рд▓рд┐рдП, рдЖрдкрдиреЗ рдПрдХ рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред рдФрд░ рдпрд╣ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИред рдПрдХ рдореВрд▓ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдмрдирд╛рдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧреЗрдЧрд╛? рдпрд╣ рдХрд┐рддрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЦрд░реЛрдВрдЪ рд╕реЗ рдПрдХ рдЖрдзреБрдирд┐рдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444446/"> рдЗрд╕рд▓рд┐рдП, рдЖрдкрдиреЗ рдПрдХ рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред  рдФрд░ рдпрд╣ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИред  рдПрдХ рдореВрд▓ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдмрдирд╛рдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧреЗрдЧрд╛?  рдпрд╣ рдХрд┐рддрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ?  рдПрдХ рдЖрдзреБрдирд┐рдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЛ рд╢реБрд░реБрдЖрдд рд╕реЗ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП? <br><br>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдмреЙрдпрд▓рд░рдкреНрд▓реЗрдЯ рдХреЛ рд░реЗрдЦрд╛рдВрдХрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗ: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><img src="https://habrastorage.org/webt/ul/ne/9v/ulne9vljujdrtxnf-qeqrrux7da.png"></a> </div><br>  рд╣рдо рдХреНрдпрд╛ рдХрд╡рд░ рдХрд░реЗрдВрдЧреЗ: <br><br><ul><li>  рдбреЙрдХ-рдХрдВрдкреЛрдЬрд╝ рдореЗрдВ рджреЗрд╡ рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рд╕реНрдерд╛рдкрдирд╛ред </li><li>  рдлреНрд▓рд╛рд╕реНрдХ рдкрд░ рдмреИрдХреЗрдВрдб рдирд┐рд░реНрдорд╛рдгред </li><li>  рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдкрд░ рдПрдХ рджреГрд╢реНрдп рдмрдирд╛рдирд╛ред </li><li>  рд╡реЗрдмрдкреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ JS рдмрдирд╛рдПрдБред </li><li>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, Redux рдФрд░ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд░реЗрдВрдбрд░рд┐рдВрдЧред </li><li>  RQ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдХрддрд╛рд░ред </li></ul><a name="habracut"></a><br><h2>  рдкрд░рд┐рдЪрдп </h2><br>  рд╡рд┐рдХрд╛рд╕ рд╕реЗ рдкрд╣рд▓реЗ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХреНрдпрд╛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ!  рдЗрд╕ рд▓реЗрдЦ рдХреЗ рд▓рд┐рдП рдПрдХ рдореЙрдбрд▓ рдЖрд╡реЗрджрди рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВрдиреЗ рдПрдХ рдЖрджрд┐рдо рд╡рд┐рдХреА рдЗрдВрдЬрди рдмрдирд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдорд╛рд░реНрдХрдбрд╛рдЙрди рдореЗрдВ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдб рд╣реЛрдВрдЧреЗ;  рдЙрдиреНрд╣реЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ (рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдХрднреА-рдХрднреА) рд╕рдВрдкрд╛рджрди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рд╕рдм рд╣рдо рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд░реЗрдВрдбрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдПрдХ-рдкреЗрдЬ рдХреЗ рдЖрд╡реЗрджрди рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░реЗрдВрдЧреЗ (рдЬреЛ рдХрд┐ рд╣рдорд╛рд░реЗ рднрд╡рд┐рд╖реНрдп рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдЯреЗрд░рд╛рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд┐рд▓реНрдХреБрд▓ рдЖрд╡рд╢реНрдпрдХ рд╣реИ)ред <br><br>  рдЖрдЗрдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдШрдЯрдХреЛрдВ рдкрд░ рдереЛрдбрд╝рд╛ рдФрд░ рд╡рд┐рд╕реНрддреГрдд рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br><ul><li>  <b>рдХреНрд▓рд╛рдЗрдВрдЯред</b>  рдЖрдЗрдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░рд┐рдПрдХреНрдЯ</a> + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реЗрдбрдХреНрд╕</a> рдмрдВрдбрд▓ рдкрд░ рдПрдХ рдкреЗрдЬ рдХрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВ (рдпрд╛рдиреА рдкреЗрдЬ рдЯреНрд░рд╛рдВрд╕рдХреНрд╢рди рдХреЗ рд╕рд╛рде AJAX рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ), рдЬреЛ рдлреНрд░рдВрдЯ-рдПрдВрдб рд╡рд░реНрд▓реНрдб рдореЗрдВ рдмрд╣реБрдд рд╣реА рд╕рд╛рдорд╛рдиреНрдп рд╣реИред </li><li>  <b>рдЖрдЧреЗ рдХрд╛ рднрд╛рдЧ</b> ред  рдЖрдЗрдП рдПрдХ рд╕рд░рд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХреНрд╕рдкреНрд░реЗрд╕</a> рд╕рд░реНрд╡рд░ рдмрдирд╛рдПрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рд░рд┐рдПрдХреНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдЧрд╛ (рдмреИрдХрдПрдВрдб рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдХреЛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реБрдП) рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЬрд╛рд░реА рдХрд░реЗрдЧрд╛ред </li><li>  <b>рдмреИрдХреЗрдВрдб</b> ред  рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдХреЗ рдорд╛рд╕реНрдЯрд░, рд╣рдорд╛рд░реЗ рдмреИрдХрдПрдВрдб рдПрдХ рдЫреЛрдЯрд╛ рдлреНрд▓рд╛рд╕реНрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реЛрдЧрд╛ред  рд╣рдо рд▓реЛрдХрдкреНрд░рд┐рдп <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">MongoDB</a> рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рднрдВрдбрд╛рд░ рдореЗрдВ рдбреЗрдЯрд╛ (рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдб) рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдХрд╛рд░реНрдп рдХрддрд╛рд░ рдХреЗ рд▓рд┐рдП рдФрд░, рд╕рдВрднрд╡рддрдГ, рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдХреИрд╢рд┐рдВрдЧ рдореЗрдВ, рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Redis рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </li><li>  <b>рдХрд╛рдо рдХрд░рдиреЗрд╡рд╛рд▓рд╛</b> ред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрд░рдХреНрдпреВ</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рджреНрд╡рд╛рд░рд╛ рднрд╛рд░реА рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдХрдВрдЯреЗрдирд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </li></ul><br><h2>  рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░: рдЧрд┐рдЯ </h2><br>  рд╢рд╛рдпрдж, рд╣рдо рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рд▓реЗрдХрд┐рди, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╣рдо рдЧрд┐рдЯ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд╡рд┐рдХрд╛рд╕ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░реЗрдВрдЧреЗред <br><br><pre><code class="bash hljs">git init git remote add origin git@github.com:Saluev/habr-app-demo.git git commit --allow-empty -m <span class="hljs-string"><span class="hljs-string">"Initial commit"</span></span> git push</code> </pre> <br>  (рдпрд╣рд╛рдВ рдЖрдкрдХреЛ рддреБрд░рдВрдд <code>.gitignore</code> рднрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред) <br><br>  рдЕрдВрддрд┐рдо рдбреНрд░рд╛рдлреНрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрд┐рддреБрдм рдкрд░</a> рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдЦ рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рднрд╛рдЧ рдПрдХ рдкреНрд░рддрд┐рдмрджреНрдз рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ (рдореИрдВрдиреЗ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдзрд┐рдХ рдкреБрдирд░реНрдЬрдиреНрдо рдХрд┐рдпрд╛!)ред <br><br><h2>  рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░: docker- рд░рдЪрдирд╛ </h2><br>  рдЖрдЗрдП рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВред  рдШрдЯрдХреЛрдВ рдХреА рдкреНрд░рдЪреБрд░рддрд╛ рдХреЗ рд╕рд╛рде рдЬреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣реИ, рдмрд╣реБрдд рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рдХрд╛рд╕ рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП docker-compose рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдирд┐рдореНрди рд╕рд╛рдордЧреНрд░реА рдХреЗ <code>docker-compose.yml</code> рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ <code>docker-compose.yml</code> рдлрд╝рд╛рдЗрд▓ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs">version: '3' services: mongo: image: "mongo:latest" redis: image: "redis:alpine" backend: build: context: . dockerfile: ./docker/backend/Dockerfile environment: - APP_ENV=dev depends_on: - mongo - redis ports: - "40001:40001" volumes: - .:/code frontend: build: context: . dockerfile: ./docker/frontend/Dockerfile environment: - APP_ENV=dev - APP_BACKEND_URL=backend:40001 - APP_FRONTEND_PORT=40002 depends_on: - backend ports: - "40002:40002" volumes: - ./frontend:/app/src worker: build: context: . dockerfile: ./docker/worker/Dockerfile environment: - APP_ENV=dev depends_on: - mongo - redis volumes: - .:/code</code> </pre><br>  рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВред <br><br><ul><li>  рдПрдХ MongoDB рдХрдВрдЯреЗрдирд░ рдФрд░ рдПрдХ рд░реЗрдбрд┐рд╕ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рд╣рдорд╛рд░реЗ рдмреИрдХрдПрдВрдб рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬрд┐рд╕рдХрд╛ рд╣рдо рдиреАрдЪреЗ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ)ред  рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ APP_ENV = рджреЗрд╡ рдЗрд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рд╣рдо рдЗрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдлреНрд▓рд╛рд╕реНрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдХреНрдпрд╛ рд▓реЛрдб рдХрд░рдирд╛ рд╣реИ), рдФрд░ рдЗрд╕рдХрд╛ рдкреЛрд░реНрдЯ 40001 рдмрд╛рд╣рд░ рдЦреБрд▓реЗрдЧрд╛ (рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд╛рд░рд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдкреАрдЖрдИ рдкрд░ рдЬрд╛рдПрдЧрд╛)ред </li><li>  рд╣рдорд╛рд░реЗ рдлреНрд░рдВрдЯреЗрдВрдб рдХрд╛ рдПрдХ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рднреА рдЗрд╕рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдмрд╛рдж рдореЗрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдВрдЧреЗ, рдФрд░ рдкреЛрд░реНрдЯ 40002 рдЦреБрд▓рддрд╛ рд╣реИред рдпрд╣ рд╣рдорд╛рд░реЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдореБрдЦреНрдп рдкреЛрд░реНрдЯ рд╣реИ: рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">http: // localhost: 40002 рдкрд░</a> рдЬрд╛рдПрдВрдЧреЗред </li><li>  рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХрд╛ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрд╕реЗ рдмрд╛рд╣рд░реА рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдХреЗрд╡рд▓ MongoDB рдФрд░ Redis рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </li></ul><br>  рдЕрдм dockerfiles рдмрдирд╛рддреЗ рд╣реИрдВред  рдЕрднреА, рдбреЙрдХрд░ рдХреЗ рдмрд╛рд░реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдВ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрддреНрдХреГрд╖реНрдЯ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦреЛрдВ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЗ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдиреБрд╡рд╛рдж рдХреА</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╢реНрд░реГрдВрдЦрд▓рд╛</a> рд╣реИрдмреЗрд░рд╛ рдореЗрдВ рдЖ рд░рд╣реА рд╣реИ - рдЖрдк рд╕рднреА рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╡рд╣рд╛рдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЪрд▓реЛ рдмреИрдХрдПрдВрдб рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="plaintext hljs"># docker/backend/Dockerfile FROM python:stretch COPY requirements.txt /tmp/ RUN pip install -r /tmp/requirements.txt ADD . /code WORKDIR /code CMD gunicorn -w 1 -b 0.0.0.0:40001 --worker-class gevent backend.server:app</code> </pre><br>  рдпрд╣ рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╣рдо gunicorn рдлреНрд▓рд╛рд╕реНрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдмреИрдХрдПрдВрдб.рд╕рд░реНрд╡рд░ рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдирд╛рдо <code>app</code> рдиреАрдЪреЗ рдЫрд┐рдкрд╛ рд╣реИред <br><br>  рдХреЛрдИ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг <code>docker/backend/.dockerignore</code> : <br><br><pre> <code class="plaintext hljs">.git .idea .logs .pytest_cache frontend tests venv *.pyc *.pyo</code> </pre><br>  рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдЖрдо рддреМрд░ рдкрд░ рдмреИрдХрдПрдВрдб рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдЕрдВрдЧрд░рдЦрд╛ рдХреЗ рдмрдЬрд╛рдп рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдкрд┐рдЯ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рдХреНрд╖реЗрдкрдг рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs"># docker/worker/Dockerfile FROM python:stretch COPY requirements.txt /tmp/ RUN pip install -r /tmp/requirements.txt ADD . /code WORKDIR /code CMD python -m worker</code> </pre><br>  рд╣рдо рд╕рднреА рдХрд╛рд░реНрдп <code>worker/__main__.py</code> ред <br><br>  <code>.dockerignore</code> рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ <code>.dockerignore</code> рдмреИрдХрдПрдВрдб рдХреЗ рд╕рдорд╛рди рд╣реИред <br><br>  рдЕрдВрдд рдореЗрдВ, рджреГрд╢реНрдпред  рд╣реИрдмреЗ рдкрд░ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд▓рдЧ рд▓реЗрдЦ рд╣реИ</a> , рд▓реЗрдХрд┐рди рд╕реНрдЯреИрдХрдУрд╡рд░рдлреНрд▓реЛ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реНрдпрд╛рдкрдХ рдЪрд░реНрдЪрд╛</a> рдФрд░ "рджреЛрд╕реНрддреЛрдВ рдХреА рднрд╛рд╡рдирд╛ рдореЗрдВ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рд╕реЗ рджреЗрдЦрддреЗ рд╣реБрдП, рдХреНрдпрд╛ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 2018 рд╣реИ, рдХреНрдпрд╛ рдЕрднреА рднреА рдХреЛрдИ рд╕рд╛рдорд╛рдиреНрдп рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ?"  рд╡рд╣рд╛рдВ рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИред  рдореИрдВ рдбреЙрдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдмрд╕ рдЧрдпрд╛ред <br><br><pre> <code class="plaintext hljs"># docker/frontend/Dockerfile FROM node:carbon WORKDIR /app #  package.json  package-lock.json   npm install,   . COPY frontend/package*.json ./ RUN npm install #       , #     PATH. ENV PATH /app/node_modules/.bin:$PATH #      . ADD frontend /app/src WORKDIR /app/src RUN npm run build CMD npm run start</code> </pre><br>  рдкреЗрд╢реЗрд╡рд░реЛрдВ: <br><br><ul><li>  рд╕рдм рдХреБрдЫ рдЕрдкреЗрдХреНрд╖рд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреИрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдиреАрдЪреЗ рдХреА рдкрд░рдд рдкрд░ - рдирд┐рд░реНрднрд░рддрд╛рдПрдВ, рд╢реАрд░реНрд╖ рдкрд░ - рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдХрд╛ рдирд┐рд░реНрдорд╛рдг); </li><li>  <code>docker-compose exec frontend npm install --save newDependency</code> рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╣рдорд╛рд░реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ <code>docker-compose exec frontend npm install --save newDependency</code> рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ (рдЬреЛ рдХрд┐ рдЕрдЧрд░ рд╣рдо COPY рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ, рддреЛ рдмрд╣реБрдд рд╕реЗ рд▓реЛрдЧ рд╕реБрдЭрд╛рд╡ рджреЗрддреЗ рд╣реИрдВ)ред  рд╡реИрд╕реЗ рднреА <code>npm install --save newDependency</code> рдХреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдмрд╛рд╣рд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рд╡рд╛рдВрдЫрдиреАрдп рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдирдП рдкреИрдХреЗрдЬ рдХреА рдХреБрдЫ рдирд┐рд░реНрднрд░рддрд╛рдПрдВ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЕрд▓рдЧ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рддрд╣рдд рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (docker рдХреЗ рдЕрдВрджрд░ рдПрдХ рдФрд░ рд╣рдорд╛рд░реЗ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ macbook рдХреЗ рддрд╣рдд рдирд╣реАрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП ), рдФрд░ рдлрд┐рд░ рднреА рд╣рдо рдЖрдо рддреМрд░ рдкрд░ рд╡рд┐рдХрд╛рд╕ рдорд╢реАрди рдкрд░ рдиреЛрдб рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдПрдХ рдбреЙрдХрд░ рдЙрди рд╕рднреА рдкрд░ рд░рд╛рдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП! </li></ul><br>  рдЦреИрд░ рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ <code>docker/frontend/.dockerignore</code> : <br><br><pre> <code class="plaintext hljs">.git .idea .logs .pytest_cache backend worker tools node_modules npm-debug tests venv</code> </pre><br>  рддреЛ, рд╣рдорд╛рд░рд╛ рдХрдВрдЯреЗрдирд░ рдлреНрд░реЗрдо рддреИрдпрд╛рд░ рд╣реИ рдФрд░ рдЖрдк рдЗрд╕реЗ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рднрд░ рд╕рдХрддреЗ рд╣реИрдВ! <br><br><h2>  рдмреИрдХрдПрдВрдб: рдлреНрд▓рд╛рд╕реНрдХ рдлреНрд░реЗрдорд╡рд░реНрдХ </h2><br>  рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП <code>flask</code> , <code>flask-cors</code> , <code>gunicorn</code> рдФрд░ <code>gunicorn</code> рдЬреЛрдбрд╝реЗрдВред <code>gunicorn</code> рдФрд░ <code>backend/server.py</code> <code>gunicorn</code> рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдлреНрд▓рд╛рд╕реНрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВред <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/server.py import os.path import flask import flask_cors class HabrAppDemo(flask.Flask): def __init__(self, *args, **kwargs): super().__init__(*args, **kwargs) # CORS        #    ,      # (  Access-Control-Origin  ). #   - . flask_cors.CORS(self) app = HabrAppDemo("habr-app-demo") env = os.environ.get("APP_ENV", "dev") print(f"Starting application in {env} mode") app.config.from_object(f"backend.{env}_settings")</span></span></code> </pre><br>  рд╣рдордиреЗ рдлреНрд▓рд╛рд╕реНрдХ рдХреЛ <code>backend.{env}_settings</code> рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ <code>backend.{env}_settings</code> , рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдореЗрдВ рд╣рд░ рдЪреАрдЬрд╝ рдХреЛ <code>backend/dev_settings.py</code> рд▓рд┐рдП рдПрдХ (рдХрдо рд╕реЗ рдХрдо рдЦрд╛рд▓реА) рдлрд╝рд╛рдЗрд▓ <code>backend/dev_settings.py</code> рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br>  рдЕрдм рд╣рдо рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рддреМрд░ рдкрд░ рд╣рдорд╛рд░реЗ рдмреИрдХрдПрдВрдб рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ! <br><br><pre> <code class="plaintext hljs">habr-app-demo$ docker-compose up backend ... backend_1 | [2019-02-23 10:09:03 +0000] [6] [INFO] Starting gunicorn 19.9.0 backend_1 | [2019-02-23 10:09:03 +0000] [6] [INFO] Listening at: http://0.0.0.0:40001 (6) backend_1 | [2019-02-23 10:09:03 +0000] [6] [INFO] Using worker: gevent backend_1 | [2019-02-23 10:09:03 +0000] [9] [INFO] Booting worker with pid: 9</code> </pre><br>  рд╣рдо рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред <br><br><h2>  рд╕реАрдорд╛рд╡рд░реНрддреА: рдПрдХреНрд╕рдкреНрд░реЗрд╕ рд░реВрдкрд░реЗрдЦрд╛ </h2><br>  рдЖрдЗрдП рдкреИрдХреЗрдЬ рдмрдирд╛рдХрд░ рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВред  рдлреНрд░рдВрдЯрдПрдВрдб рдлреЛрд▓реНрдбрд░ <code>npm init</code> рдФрд░ рдЙрд╕рдореЗрдВ <code>npm init</code> рдЪрд▓рд╛рдХрд░, рдХреБрдЫ рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рддреИрдпрд╛рд░ рдкреИрдХреЗрдЬ рдорд┐рд▓рддрд╛ рд╣реИред рдЖрддреНрдорд╛ рдореЗрдВ рдЯреИрдЧ рдХрд░реЗрдВ <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"habr-app-demo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is an app demo for Habr article."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"repository"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"git"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"git+https://github.com/Saluev/habr-app-demo.git"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tigran Saluev &lt;tigran@saluev.com&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bugs"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://github.com/Saluev/habr-app-demo/issues"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"homepage"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://github.com/Saluev/habr-app-demo#readme"</span></span> }</code> </pre><br>  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рд╣рдореЗрдВ рдбреЗрд╡рд▓рдкрд░ рдХреА рдорд╢реАрди рдкрд░ Node.js рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдо рдЕрднреА рднреА рдЪрдХрдорд╛ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЙрдХрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <code>npm init</code> рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдУрд╣ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ)ред <br><br>  <code>Dockerfile</code> рд╣рдордиреЗ <code>Dockerfile</code> <code>npm run build</code> рдФрд░ <code>npm run start</code> <code>npm run build</code> рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ - рдЖрдкрдХреЛ <code>package.json</code> рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рдХрдорд╛рдВрдб рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <code>Dockerfile</code> : <br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/frontend/package.json +++ b/frontend/package.json @@ -4,6 +4,8 @@ "description": "This is an app demo for Habr article.", "main": "index.js", "scripts": { + "build": "echo 'build'", + "start": "node index.js", "test": "echo \"Error: no test specified\" &amp;&amp; exit 1" }, "repository": {</span></span></code> </pre><br>  <code>build</code> рдХрдорд╛рдВрдб рдЕрднреА рддрдХ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрднреА рднреА рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХреНрд╕рдкреНрд░реЗрд╕</a> рдирд┐рд░реНрднрд░рддрд╛ рдЬреЛрдбрд╝реЗрдВ рдФрд░ <code>index.js</code> рдореЗрдВ рдПрдХ рд╕рд░рд▓ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/frontend/package.json +++ b/frontend/package.json @@ -17,5 +17,8 @@ "bugs": { "url": "https://github.com/Saluev/habr-app-demo/issues" }, - "homepage": "https://github.com/Saluev/habr-app-demo#readme" + "homepage": "https://github.com/Saluev/habr-app-demo#readme", + "dependencies": { + "express": "^4.16.3" + } }</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/index.js const express = require("express"); app = express(); app.listen(process.env.APP_FRONTEND_PORT); app.get("*", (req, res) =&gt; { res.send("Hello, world!") });</span></span></code> </pre><br>  рдЕрдм <code>docker-compose up frontend</code> рд╣рдорд╛рд░реЗ рд╕реАрдиреНрд╕ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИ!  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">http: // localhost: 40002 рдкрд░</a> , рдХреНрд▓рд╛рд╕рд┐рдХ "рд╣реИрд▓реЛ, рджреБрдирд┐рдпрд╛" рдкрд╣рд▓реЗ рд╣реА рджрд┐рдЦрд╛рд╡рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><h2>  рд╕реАрдорд╛: рд╡реЗрдмрдкреИрдХ рдФрд░ рд░рд┐рдПрдХреНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдирд┐рд░реНрдорд╛рдг </h2><br>  рдпрд╣ рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ рд╕рд╛рджреЗ рдкрд╛рда рд╕реЗ рдЕрдзрд┐рдХ рдХреБрдЫ рдЪрд┐рддреНрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред  рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ, рд╣рдо <code>App</code> рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд░рд┐рдПрдХреНрдЯ рдШрдЯрдХ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдФрд░ рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗред <br><br>  рдЬрдм рд░рд┐рдПрдХреНрдЯ рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдлреЙрд░реНрдо рдХреЗ рд╕рд┐рдВрдЯреИрдХреНрдЯрд┐рдХ рдХрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдПрдХ рдмреЛрд▓реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">JSX</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ <br><br><pre> <code class="javascript hljs">render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MyButton</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"blue"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.props.caption}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MyButton</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; }</code> </pre><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬрди рдЗрд╕реЗ рдирд╣реАрдВ рд╕рдордЭрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдорддреМрд░ рдкрд░ рдмрд┐рд▓реНрдб рдЪрд░рдг рдХреЛ рдлреНрд░рдВрдЯреЗрдВрдб рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡рд┐рд╢реЗрд╖ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрдХрд▓рдХ (рд╣рд╛рдБ-рд╣рд╛рдБ) рдмрджрд▓реА рд╣реБрдИ рдХреНрд▓рд╛рд╕рд┐рдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рд╕рд┐рдВрдЯреИрдХреНрдЯрд┐рдХ рдЪреАрдиреА рдХреЛ рдЪрд╛рд▓реВ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдпрд╛рддреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рддреЗ рд╣реИрдВ, рдЫреЛрдЯрд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реА рддрд░рд╣ред <br><br><img src="https://habrastorage.org/webt/f1/rl/0j/f1rl0jer0cxs_ll69yagvwm_0gc.jpeg"><br><br>  <i>2014 рд╕рд╛рд▓ред</i>  <i>apt-cache search рдЬрд╛рд╡рд╛</i> <br><br>  рддреЛ, рд╕рдмрд╕реЗ рд╕рд░рд▓ рд░рд┐рдПрдХреНрдЯ рдШрдЯрдХ рдмрд╣реБрдд рд╕рд░рд▓ рджрд┐рдЦрддрд╛ рд╣реИред <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/app.js import React, {Component} from 'react' class App extends Component { render() { return &lt;h1&gt;Hello, world!&lt;/h1&gt; } } export default App</span></span></code> </pre><br>  рд╡рд╣ рдмрд╕ рдПрдХ рдЕрдзрд┐рдХ рдареЛрд╕ рдкрд┐рди рдХреЗ рд╕рд╛рде рд╣рдорд╛рд░реЗ рдЕрднрд┐рд╡рд╛рджрди рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред <br><br>  рд╣рдорд╛рд░реЗ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреА рдиреНрдпреВрдирддрдо HTML рд░реВрдкрд░реЗрдЦрд╛ рдпреБрдХреНрдд рдлрд╝рд╛рдЗрд▓ <code>frontend/src/template.js</code> рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/template.js export default function template(title) { let page = ` &lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;${title}&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="app"&gt;&lt;/div&gt; &lt;script src="/dist/client.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; `; return page; }</span></span></code> </pre><br>  рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдмрд┐рдВрджреБ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/client.js import React from 'react' import {render} from 'react-dom' import App from './components/app' render( &lt;App/&gt;, document.querySelector('#app') );</span></span></code> </pre><br>  рдЗрд╕ рд╕рднреА рд╕реБрдВрджрд░рддрд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЪрд╛рд╣рд┐рдП: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реЗрдмрдкреИрдХ</a> рдЬреЗрдПрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдлреИрд╢рдиреЗрдмрд▓ рдпреБрд╡рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд┐рд▓реНрдбрд░</a> рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореИрдВрдиреЗ рддреАрди рдШрдВрдЯреЗ рдХреЗ рд▓рд┐рдП рджреГрд╢реНрдпрдкрдЯрд▓ рдкрд░ рд▓реЗрдЦ рдирд╣реАрдВ рдкрдврд╝рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдлреИрд╢рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд╢реНрдЪрд┐рдд рдирд╣реАрдВ рд╣реВрдВ); <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреЗрдПрд╕рдПрдХреНрд╕</a> рдЬреИрд╕реЗ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓реЛрд╢рди рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреИрдмрд▓</a> рдПрдХ рдХрдВрдкрд╛рдЗрд▓рд░ рд╣реИ, рдФрд░ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рд╕рднреА IE рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрд▓реАрдлрд╝рд┐рд▓ рдкреНрд░рджрд╛рддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рдлреНрд░рдВрдЯрдПрдВрдб рдХрд╛ рдкрд┐рдЫрд▓рд╛ рдЪрд▓рдирд╛ рдЕрднреА рднреА рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдмрд╕ рдЗрддрдирд╛ рдХрд░рдирд╛ рд╣реИ <br><br><pre> <code class="bash hljs">docker-compose <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> frontend npm install --save \ react \ react-dom docker-compose <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> frontend npm install --save-dev \ webpack \ webpack-cli \ babel-loader \ @babel/core \ @babel/polyfill \ @babel/preset-env \ @babel/preset-react</code> </pre><br>  рдирдИ рдирд┐рд░реНрднрд░рддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рдЕрдм рд╡реЗрдмрдкреИрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/webpack.config.js const path = require("path"); //  . clientConfig = { mode: "development", entry: { client: ["./src/client.js", "@babel/polyfill"] }, output: { path: path.resolve(__dirname, "../dist"), filename: "[name].js" }, module: { rules: [ { test: /\.js$/, exclude: /node_modules/, loader: "babel-loader" } ] } }; //  .     : // 1. target: "node" -      import path. // 2.   ..,    ../dist --   //    ,   ! serverConfig = { mode: "development", target: "node", entry: { server: ["./index.js", "@babel/polyfill"] }, output: { path: path.resolve(__dirname, ".."), filename: "[name].js" }, module: { rules: [ { test: /\.js$/, exclude: /node_modules/, loader: "babel-loader" } ] } }; module.exports = [clientConfig, serverConfig];</span></span></code> </pre><br>  <code>frontend/.babelrc</code> рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ <code>frontend/.babelrc</code> рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"presets"</span></span>: [<span class="hljs-string"><span class="hljs-string">"@babel/env"</span></span>, <span class="hljs-string"><span class="hljs-string">"@babel/react"</span></span>] }</code> </pre><br>  рдЕрдВрдд рдореЗрдВ, рд╣рдорд╛рд░реЗ <code>npm run build</code> рдХрдорд╛рдВрдб рдХреЛ рд╕рд╛рд░реНрдердХ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="json hljs">// frontend/package.json ... <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"node /app/server.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span> }, ...</code> </pre><br>  рдЕрдм рд╣рдорд╛рд░рд╛ рдореБрд╡рдХреНрдХрд┐рд▓, рдкреЙрд▓реАрдлрд╝рд┐рд▓реНрд╕ рдФрд░ рдЙрд╕рдХреЗ рд╕рднреА рдЖрд╢реНрд░рд┐рддреЛрдВ рдХреЗ рдПрдХ рдмрдВрдбрд▓ рдХреЗ рд╕рд╛рде, рдмреЗрдмрд▓, <code>../dist/client.js</code> рдФрд░ рд╕рд┐рд▓рд╡рдЯреЛрдВ рдХреЛ рдПрдХ рдЕрдЦрдВрдб <code>../dist/client.js</code> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ <code>../dist/client.js</code> ред  рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рд╕реНрдерд┐рд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝реЗрдВ, рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рд░реНрдЧ рдореЗрдВ рд╣рдо рдЕрдкрдирд╛ HTML рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрдВрдЧреЗ: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/index.js // ,    , //  - . import express from 'express' import template from './src/template' let app = express(); app.use('/dist', express.static('../dist')); app.get("*", (req, res) =&gt; { res.send(template("Habr demo app")); }); app.listen(process.env.APP_FRONTEND_PORT);</span></span></code> </pre><br>  рд╕рдлрд▓рддрд╛!  рдЕрдм, рдпрджрд┐ рд╣рдо <code>docker-compose up --build frontend</code> рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо "рд╣реЗрд▓реЛ, рд╡рд░реНрд▓реНрдб!" рджреЗрдЦреЗрдВрдЧреЗред  рдПрдХ рдирдП, рдЪрдордХрджрд╛рд░ рдЖрд╡рд░рдг рдореЗрдВ, рдФрд░ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ React Developer Tools рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реИ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Chrome</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Firefox</a> ), рддреЛ рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓ рдореЗрдВ рдПрдХ React рдШрдЯрдХ рдЯреНрд░реА рднреА рд╣реИ: <br><br><img src="https://habrastorage.org/webt/q1/it/gu/q1itgukw2k0ko60pghlwwkfqfn0.png"><br><br><h2>  рдмреИрдХрдПрдВрдб: MongoDB рдореЗрдВ рдбреЗрдЯрд╛ </h2><br>  рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ рдЬреАрд╡рди рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдиреЗ рдФрд░ рд╕рд╛рдБрд╕ рд▓реЗрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдЗрд╕реЗ рдмреИрдХрдПрдВрдб рдореЗрдВ рд╕рд╛рдБрд╕ рд▓реЗрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдорд╛рд░реНрдХрдбрд╛рдЙрди рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдб рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рдереЗ - рдпрд╣ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред <br><br>  рдЬрдмрдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЬрдЧрд░ рдореЗрдВ MongoDB рдХреЗ рд▓рд┐рдП рдУрдЖрд░рдПрдо рд╣реИрдВ</a> , рдореИрдВ рдУрдЖрд░рдПрдо рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рд╢рд╛рддрд┐рд░ рдорд╛рдирддрд╛ рд╣реВрдВ рдФрд░ рдореИрдВ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реВрдВред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдХрд╛рд░реНрдб рдФрд░ рд╕рд╛рде рд╡рд╛рд▓реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреАрдПрдУ рдХреЗ</a> рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╡рд░реНрдЧ рдмрдирд╛рдПрдВрдЧреЗ: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/storage/card.py import abc from typing import Iterable class Card(object): def __init__(self, id: str = None, slug: str = None, name: str = None, markdown: str = None, html: str = None): self.id = id self.slug = slug #    self.name = name self.markdown = markdown self.html = html class CardDAO(object, metaclass=abc.ABCMeta): @abc.abstractmethod def create(self, card: Card) -&gt; Card: pass @abc.abstractmethod def update(self, card: Card) -&gt; Card: pass @abc.abstractmethod def get_all(self) -&gt; Iterable[Card]: pass @abc.abstractmethod def get_by_id(self, card_id: str) -&gt; Card: pass @abc.abstractmethod def get_by_slug(self, slug: str) -&gt; Card: pass class CardNotFound(Exception): pass</span></span></code> </pre><br>  (рдпрджрд┐ рдЖрдк рдЕрднреА рднреА рдкрд╛рдпрдерди рдореЗрдВ рдЯрд╛рдЗрдк рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрди</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦреЛрдВ</a> рдХреЛ рдЕрд╡рд╢реНрдп рджреЗрдЦреЗрдВ!) <br><br>  рдЕрдм рдЪрд▓рд┐рдП <code>CardDAO</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреЛ <code>pymongo</code> рд╕реЗ <code>Database</code> рдСрдмреНрдЬреЗрдХреНрдЯ рд▓реЗрддрд╛ рд╣реИ (рд╣рд╛рдБ, <code>pymongo</code> рдХреЛ <code>requirements.txt</code> рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордпред <code>pymongo</code> ): <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/storage/card_impl.py from typing import Iterable import bson import bson.errors from pymongo.collection import Collection from pymongo.database import Database from backend.storage.card import Card, CardDAO, CardNotFound class MongoCardDAO(CardDAO): def __init__(self, mongo_database: Database): self.mongo_database = mongo_database # , slug   . self.collection.create_index("slug", unique=True) @property def collection(self) -&gt; Collection: return self.mongo_database["cards"] @classmethod def to_bson(cls, card: Card): # MongoDB     BSON.  #       BSON- #  ,      . result = { k: v for k, v in card.__dict__.items() if v is not None } if "id" in result: result["_id"] = bson.ObjectId(result.pop("id")) return result @classmethod def from_bson(cls, document) -&gt; Card: #   ,     #     ,     #  .    id    # ,   -   . document["id"] = str(document.pop("_id")) return Card(**document) def create(self, card: Card) -&gt; Card: card.id = str(self.collection.insert_one(self.to_bson(card)).inserted_id) return card def update(self, card: Card) -&gt; Card: card_id = bson.ObjectId(card.id) self.collection.update_one({"_id": card_id}, {"$set": self.to_bson(card)}) return card def get_all(self) -&gt; Iterable[Card]: for document in self.collection.find(): yield self.from_bson(document) def get_by_id(self, card_id: str) -&gt; Card: return self._get_by_query({"_id": bson.ObjectId(card_id)}) def get_by_slug(self, slug: str) -&gt; Card: return self._get_by_query({"slug": slug}) def _get_by_query(self, query) -&gt; Card: document = self.collection.find_one(query) if document is None: raise CardNotFound() return self.from_bson(document)</span></span></code> </pre><br>  рдмреИрдХрдПрдВрдб рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдореЛрдВрдЧрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордпред  рд╣рдордиреЗ рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд░ рдХрд╛ рдирд╛рдо рдореЛрдВрдЧреЛ <code>mongo</code> рд╕рд╛рде рд░рдЦрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП <code>MONGO_HOST = "mongo"</code> <br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/backend/dev_settings.py +++ b/backend/dev_settings.py @@ -0,0 +1,3 @@ +MONGO_HOST = "mongo" +MONGO_PORT = 27017 +MONGO_DATABASE = "core"</span></span></code> </pre><br>  рдЕрдм рд╣рдореЗрдВ <code>MongoCardDAO</code> рдмрдирд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рдлреНрд▓рд╛рд╕реНрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд╣рд╛рд▓рд╛рдБрдХрд┐ рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ (рд╕реЗрдЯрд┐рдВрдЧреНрд╕ тЖТ pymongo рдХреНрд▓рд╛рдЗрдВрдЯ тЖТ pymongo рдбреЗрдЯрд╛рдмреЗрд╕ тЖТ <code>MongoCardDAO</code> ) рдХреА рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдкрджрд╛рдиреБрдХреНрд░рдо рд╣реИ, рдЪрд▓реЛ рддреБрд░рдВрдд рдПрдХ рдХреЗрдВрджреНрд░реАрдХреГрдд рд░рд╛рдЬрд╛ рдШрдЯрдХ рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рд░реНрднрд░рддрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди</a> рдХрд░рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> (рдпрд╣ рдлрд┐рд░ рд╕реЗ рдХрд╛рдо рдореЗрдВ рдЖрдПрдЧрд╛ рдЬрдм рд╣рдо рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдФрд░ рдЯреВрд▓ рдХрд░рддреЗ рд╣реИрдВ)ред <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/wiring.py import os from pymongo import MongoClient from pymongo.database import Database import backend.dev_settings from backend.storage.card import CardDAO from backend.storage.card_impl import MongoCardDAO class Wiring(object): def __init__(self, env=None): if env is None: env = os.environ.get("APP_ENV", "dev") self.settings = { "dev": backend.dev_settings, # (    # ,   !) }[env] #        . #        DI,  . self.mongo_client: MongoClient = MongoClient( host=self.settings.MONGO_HOST, port=self.settings.MONGO_PORT) self.mongo_database: Database = self.mongo_client[self.settings.MONGO_DATABASE] self.card_dao: CardDAO = MongoCardDAO(self.mongo_database)</span></span></code> </pre><br><br>  рдлреНрд▓рд╛рд╕реНрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдирдпрд╛ рдорд╛рд░реНрдЧ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рджреГрд╢реНрдп рдХрд╛ рдЖрдирдВрдж рд▓реЗрдиреЗ рдХрд╛ рд╕рдордп! <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/server.py import os.path import flask import flask_cors from backend.storage.card import CardNotFound from backend.wiring import Wiring env = os.environ.get("APP_ENV", "dev") print(f"Starting application in {env} mode") class HabrAppDemo(flask.Flask): def __init__(self, *args, **kwargs): super().__init__(*args, **kwargs) flask_cors.CORS(self) self.wiring = Wiring(env) self.route("/api/v1/card/&lt;card_id_or_slug&gt;")(self.card) def card(self, card_id_or_slug): try: card = self.wiring.card_dao.get_by_slug(card_id_or_slug) except CardNotFound: try: card = self.wiring.card_dao.get_by_id(card_id_or_slug) except (CardNotFound, ValueError): return flask.abort(404) return flask.jsonify({ k: v for k, v in card.__dict__.items() if v is not None }) app = HabrAppDemo("habr-app-demo") app.config.from_object(f"backend.{env}_settings")</span></span></code> </pre><br>  <code>docker-compose up --build backend</code> рд╕рд╛рде рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░реЗрдВ: <br><br><img src="https://habrastorage.org/webt/ts/_a/1l/ts_a1ljldp9jztjvlupm4z6f29i.png"><br><br>  рдЙрдлрд╝тАж рдУрд╣, рдмрд┐рд▓реНрдХреБрд▓ред  рд╣рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ!  рд╣рдо рдЯреВрд▓ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдЦреЛрд▓реЗрдВрдЧреЗ рдФрд░ рдЙрд╕рдореЗрдВ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЯреЗрд╕реНрдЯ рдХрд╛рд░реНрдб рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># tools/add_test_content.py from backend.storage.card import Card from backend.wiring import Wiring wiring = Wiring() wiring.card_dao.create(Card( slug="helloworld", name="Hello, world!", markdown=""" This is a hello-world page. """))</span></span></code> </pre><br>  <code>docker-compose exec backend python -m tools.add_test_content</code> рд╣рдорд╛рд░реЗ рдореЛрдВрдЧрд╛ рдХреЛ <code>docker-compose exec backend python -m tools.add_test_content</code> рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕реЗ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рднрд░ <code>docker-compose exec backend python -m tools.add_test_content</code> ред <br><br><img src="https://habrastorage.org/webt/em/n2/la/emn2laspljezpnoc66oeccj42l4.png"><br><br>  рд╕рдлрд▓рддрд╛!  рдЕрдм рд╕рд╛рдордиреЗ рдХреЗ рдЫреЛрд░ рдкрд░ рдЗрд╕рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред <br><br><h2>  рд╕реАрдорд╛рд╡рд░реНрддреА: Redux </h2><br>  рдЕрдм рд╣рдо рд░реВрдЯ <code>/card/:id_or_slug</code> рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╣рдорд╛рд░рд╛ рд░рд┐рдПрдХреНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЦреБрд▓ рдЬрд╛рдПрдЧрд╛, рдПрдкреАрдЖрдИ рд╕реЗ рдХрд╛рд░реНрдб рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рддрд░рд╣ рджрд┐рдЦрд╛рдПрдВред  рдФрд░ рдпрд╣рд╛рдВ, рд╢рд╛рдпрдж, рд╕рдмрд╕реЗ рдХрдард┐рди рд╣рд┐рд╕реНрд╕рд╛ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рд╕рд░реНрд╡рд░ рддреБрд░рдВрдд рд╣рдореЗрдВ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде HTML рджреЗ, рдЕрдиреБрдХреНрд░рдордг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ, рдЬрдм рдЖрд╡реЗрджрди рдХрд╛рд░реНрдб рдХреЗ рдмреАрдЪ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдкреАрдЖрдИ рд╕реЗ JSON рдХреЗ рд░реВрдк рдореЗрдВ рд╕рднреА рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдкреГрд╖реНрда рдЕрдзрд┐рднрд╛рд░ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рдФрд░ рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╕рдм - рдмрд┐рдирд╛ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХреЗ! <br><br>  Redux рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  Redux рд░рд╛рдЬреНрдп рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИред  рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдЬрд╛рд░ рдирд┐рд╣рд┐рдд рдХреЗ рдмрдЬрд╛рдп рдпрд╣ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдФрд░ рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рдШрдЯрдирд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди рдЖрдкрдХреЗ рдШрдЯрдХ рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рдХреЗрдВрджреНрд░реАрдХреГрдд рд╕реНрдерд┐рддрд┐ рд╣реЛрддреА рд╣реИ, рдФрд░ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░реАрдХреГрдд рддрдВрддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЛрдИ рднреА рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдкрд╣рд▓реЗ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рд▓рд┐рдП рд╣рдо рдкрд╣рд▓реЗ рд▓реЛрдбрд┐рдВрдЧ GIF рдХреЛ рдЪрд╛рд▓реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдордиреЗ AJAX рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдФрд░, рдЖрдЦрд┐рд░рдХрд╛рд░, рд╕рдлрд▓рддрд╛ рдХреЙрд▓рдмреИрдХ рдореЗрдВ, рд╣рдордиреЗ рдкреГрд╖реНрда рдХреЗ рдЖрд╡рд╢реНрдпрдХ рднрд╛рдЧреЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛, рдлрд┐рд░ Redux рдкреНрд░рддрд┐рдорд╛рди рдореЗрдВ рд╣рдореЗрдВ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдПрдиреАрдореЗрд╢рди рдХреЗ рд╕рд╛рде рдЬреАрдЖрдИрдПрдл рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, " рд╡реИрд╢реНрд╡рд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓ рджреЗрдЧрд╛ рддрд╛рдХрд┐ рдЖрдкрдХрд╛ рдПрдХ рдШрдЯрдХ рдкрд┐рдЫрд▓реА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓ рджреЗ рдФрд░ рдПрдиреАрдореЗрд╢рди рдбрд╛рд▓ рджреЗ, рдлрд┐рд░ рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ, рдФрд░ рдЗрд╕рдХреА рд╕рдлрд▓рддрд╛ рдХреЗ рдХреЙрд▓рдмреИрдХ рдореЗрдВ рдПрдХ рдФрд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рднреЗрдЬреЗрдВ, "рд╕рд╛рдордЧреНрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓реЗрдВ"ред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдЕрдм рд╣рдо рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рджреЗрдЦреЗрдВрдЧреЗред <br><br>  рдЪрд▓реЛ рд╣рдорд╛рд░реЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдирдИ рдирд┐рд░реНрднрд░рддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">docker-compose <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> frontend npm install --save \ redux \ react-redux \ redux-thunk \ redux-devtools-extension</code> </pre><br>  рдкрд╣рд▓рд╛, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, Redux рд╣реИ, рджреВрд╕рд░рд╛ рд░рд┐рдПрдХреНрдЯ рдФрд░ Redux (рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦрд┐рдд) рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИ, рддреАрд╕рд░рд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рдЖрд╡рд╢реНрдпрдХ рдЪреАрдЬ рд╣реИ, рдЬрд┐рд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕рдХреЗ README</a> рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЙрдЪрд┐рдд рд╣реИ, рдФрд░, рдЖрдЦрд┐рд░рдХрд╛рд░, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Redux DevTools</a> рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЪреМрдереА рд╣реИред <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рд╕реНрддрд╛рд░</a> ред <br><br>  рдЪрд▓реЛ рдмреЙрдпрд▓рд░рдкреНрд▓реЗрдЯ Redux рдХреЛрдб рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ: рдПрдХ reducer рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреЛ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд░рд╛рдЬреНрдп рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/reducers.js export default function root(state = {}, action) { return state; }</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/configureStore.js import {createStore, applyMiddleware} from "redux"; import thunkMiddleware from "redux-thunk"; import {composeWithDevTools} from "redux-devtools-extension"; import rootReducer from "./reducers"; export default function configureStore(initialState) { return createStore( rootReducer, initialState, composeWithDevTools(applyMiddleware(thunkMiddleware)), ); }</span></span></code> </pre><br>  рд╣рдорд╛рд░рд╛ рдЧреНрд░рд╛рд╣рдХ рдереЛрдбрд╝рд╛ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ, Redux рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирд╕рд┐рдХ рд░реВрдк рд╕реЗ рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/client.js import React from 'react' import {render} from 'react-dom' import {Provider} from 'react-redux' import App from './components/app' import configureStore from './redux/configureStore' //      ... const store = configureStore(); render( // ...      , //     &lt;Provider store={store}&gt; &lt;App/&gt; &lt;/Provider&gt;, document.querySelector('#app') );</span></span></code> </pre><br>  рдЕрдм рд╣рдо рдбреЙрдХрдЯрд░-рдХрдВрдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреЛрдИ рднреА рдЪреАрдЬрд╝ рдЯреВрдЯреА рдирд╣реАрдВ рд╣реИ, рдФрд░ рд╣рдорд╛рд░реА рдЖрджрд┐рдо рд╕реНрдерд┐рддрд┐ Redux DevTools рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ: <br><br><img src="https://habrastorage.org/webt/x0/hr/_e/x0hr_empfso4poji4s8egshlcye.png"><br><br><h2>  рдлреНрд░рдВрдЯреЗрдВрдб: рдХрд╛рд░реНрдб рдкреЗрдЬ </h2><br>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдПрд╕рдПрд╕рдЖрд░ рдХреЗ рд╕рд╛рде рдкреЗрдЬ рдмрдирд╛ рд╕рдХреЗрдВ, рдЖрдкрдХреЛ рдПрд╕рдПрд╕рдЖрд░ рдХреЗ рдмрд┐рдирд╛ рдкреЗрдЬ рдмрдирд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ!  рдЪрд▓реЛ рдЕрдВрдд рдореЗрдВ рдХрд╛рд░реНрдб рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рд╕рд░рд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рд╕рд╛рдордиреЗ рдХреЗ рдЫреЛрд░ рдкрд░ рдХрд╛рд░реНрдб рдкреЗрдЬ рдмрдирд╛рдПрдВред <br><br>  рдмреБрджреНрдзрд┐рдорддреНрддрд╛ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдФрд░ рд╣рдорд╛рд░реА рд░рд╛рдЬреНрдп рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдирдпрд╛ рд╕реНрд╡рд░реВрдк рджреЗрдиреЗ рдХрд╛ рд╕рдордпред  рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ <a href="">рдмрд╣реБрдд рд╕рд╛рд░реА</a> рд╕рд╛рдордЧреНрд░рд┐рдпрд╛рдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдмреБрджреНрдзрд┐рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рди рдХрд░реЗрдВ рдФрд░ рд╕рд░рд▓ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"page"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"card"</span></span>, //     //       type=card: <span class="hljs-string"><span class="hljs-string">"cardSlug"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>, //     <span class="hljs-attr"><span class="hljs-attr">"isFetching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, //      API <span class="hljs-attr"><span class="hljs-attr">"cardData"</span></span>: {...}, //   (  ) // ... }, // ... }</code> </pre><br>  рдЖрдЗрдП "рдХрд╛рд░реНрдб" рдШрдЯрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ, рдЬреЛ рдХрд╛рд░реНрдбрдбреИрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкреНрд░реЙрдкреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрддрд╛ рд╣реИ (рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд░реВрдк рдореЗрдВ рд╣реИ): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/card.js import React, {Component} from 'react'; class Card extends Component { componentDidMount() { document.title = this.props.name } render() { const {name, html} = this.props; return ( &lt;div&gt; &lt;h1&gt;{name}&lt;/h1&gt; &lt;!---,  HTML  React  - !--&gt; &lt;div dangerouslySetInnerHTML={{__html: html}}/&gt; &lt;/div&gt; ); } } export default Card;</span></span></code> </pre><br>  рдЕрдм рдЪрд▓реЛ рдХрд╛рд░реНрдб рдХреЗ рд╕рд╛рде рдкреВрд░реЗ рдкреГрд╖реНрда рдХреЗ рд▓рд┐рдП рдПрдХ рдШрдЯрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред  рд╡рд╣ рдПрдкреАрдЖрдИ рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рдХрд╛рд░реНрдб рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрдЧрд╛ред  рдФрд░ рд╣рдо React-Redux рддрд░реАрдХреЗ рд╕реЗ рдбреЗрдЯрд╛ рд▓рд╛рдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдлрд╝рд╛рдЗрд▓ <code>frontend/src/redux/actions.js</code> рдмрдирд╛рдПрдВ рдФрд░ рдПрдХ рдПрдХреНрд╢рди рдмрдирд╛рдПрдВ, рдЬреЛ рдПрдкреАрдЖрдИ рд╕реЗ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ, рдпрджрд┐ рдкрд╣рд▓реЗ рд╕реЗ рдирд╣реАрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchCardIfNeeded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = getState().page; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.cardData === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || state.cardData.slug !== state.cardSlug) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dispatch(fetchCard()); } }; }</code> </pre><br>  <code>fetchCard</code> рдХреНрд░рд┐рдпрд╛, рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ <code>fetchCard</code> рдмрдирд╛рддреА рд╣реИ, рдереЛрдбрд╝рд╛ рдФрд░ рдЬрдЯрд┐рд▓: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchCard</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ,    . //     , , //    . dispatch(startFetchingCard()); //    API. let url = apiPath() + "/card/" + getState().page.cardSlug; // , ,   ,  //    . , ,  //    . return fetch(url) .then(response =&gt; response.json()) .then(json =&gt; dispatch(finishFetchingCard(json))); }; // ,  redux-thunk   //     . } function startFetchingCard() { return { type: START_FETCHING_CARD }; } function finishFetchingCard(json) { return { type: FINISH_FETCHING_CARD, cardData: json }; } function apiPath() { //    .    server-side // rendering,   API     -  //         localhost, //   backend. return "http://localhost:40001/api/v1"; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдУрд╣, рд╣рдореЗрдВ рдПрдХ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдорд┐рд▓реА рд╣реИ рдХрд┐ рдЬреЛ рдХреБрдЫ рдХрд░рддрд╛ рд╣реИ! </font><font style="vertical-align: inherit;">рдпрд╣ reducer рдореЗрдВ рд╕рдорд░реНрдерд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/reducers.js import { START_FETCHING_CARD, FINISH_FETCHING_CARD } from "./actions"; export default function root(state = {}, action) { switch (action.type) { case START_FETCHING_CARD: return { ...state, page: { ...state.page, isFetching: true } }; case FINISH_FETCHING_CARD: return { ...state, page: { ...state.page, isFetching: false, cardData: action.cardData } } } return state; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдмрджрд▓рддреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рд╡рд╕реНрддреБ рдХреЛ рдХреНрд▓реЛрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреНрд░реЗрдВрдбреА рд╕рд┐рдВрдЯреИрдХреНрд╕ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╕рднреА рддрд░реНрдХ Redux рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдШрдЯрдХ рд╕реНрд╡рдпрдВ рд╣реА </font></font><code>CardPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рд░рд▓ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/cardPage.js import React, {Component} from 'react'; import {connect} from 'react-redux' import {fetchCardIfNeeded} from '../redux/actions' import Card from './card' class CardPage extends Component { componentWillMount() { //   ,  React  //   .      //   ,    " // "   ,    //  - .    -   //       HTML  // renderToString,      SSR. this.props.dispatch(fetchCardIfNeeded()) } render() { const {isFetching, cardData} = this.props; return ( &lt;div&gt; {isFetching &amp;&amp; &lt;h2&gt;Loading...&lt;/h2&gt;} {cardData &amp;&amp; &lt;Card {...cardData}/&gt;} &lt;/div&gt; ); } } //       ,   //  .        //  react-redux.   page    //  dispatch,   . function mapStateToProps(state) { const {page} = state; return page; } export default connect(mapStateToProps)(CardPage);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдорд╛рд░реЗ рд░реВрдЯ рдРрдк рдШрдЯрдХ рдореЗрдВ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкреЗрдЬ рдЯрд╛рдЗрдк рдХрд░реЗрдВред </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/app.js import React, {Component} from 'react' import {connect} from "react-redux"; import CardPage from "./cardPage" class App extends Component { render() { const {pageType} = this.props; return ( &lt;div&gt; {pageType === "card" &amp;&amp; &lt;CardPage/&gt;} &lt;/div&gt; ); } } function mapStateToProps(state) { const {page} = state; const {type} = page; return { pageType: type }; } export default connect(mapStateToProps)(App);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдм, рдПрдХ рдЕрдВрддрд┐рдо рдмрд╛рдд - рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ </font></font><code>page.type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>page.cardSlug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреВрдЖрд░рдПрд▓ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЕрднреА рднреА рдХрдИ рдЦрдВрдб рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдо рдЕрднреА рдПрдХ рдЙрдЪреНрдЪ-рдЧреБрдгрд╡рддреНрддрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЕрдм рдХреЗ рд▓рд┐рдП рдмреЗрд╡рдХреВрдл рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмреЗрд╡рдХреВрдл рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрд╡реЗрджрди рдХреЛ рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдПрдХ рдирд┐рдпрдорд┐рдд!</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/client.js import React from 'react' import {render} from 'react-dom' import {Provider} from 'react-redux' import App from './components/app' import configureStore from './redux/configureStore' let initialState = { page: { type: "home" } }; const m = /^\/card\/([^\/]+)$/.exec(location.pathname); if (m !== null) { initialState = { page: { type: "card", cardSlug: m[1] }, } } const store = configureStore(initialState); render( &lt;Provider store={store}&gt; &lt;App/&gt; &lt;/Provider&gt;, document.querySelector('#app') );</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>docker-compose up --build frontend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдХрд╛рд░реНрдб рдХрд╛ рдЖрдирдВрдж рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдлреНрд░рдВрдЯрдПрдВрдб рдХрд╛ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>helloworld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/vj/qi/iu/vjqiiu9iu3c0ieigltqbu35smfw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╕реЗрдХрдВрдб рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ ... рдФрд░ рд╣рдорд╛рд░реА рд╕рд╛рдордЧреНрд░реА рдХрд╣рд╛рдВ рд╣реИ? </font><font style="vertical-align: inherit;">рдУрд╣, рд╣рдо рдорд╛рд░реНрдХрдбрд╛рдЙрди рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рднреВрд▓ рдЧрдП!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд░реНрдпрдХрд░реНрддрд╛: рдЖрд░рдХреНрдпреВ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рд░реНрдХрд╛рдбрд╛рдЙрди рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрд╕реАрдорд┐рдд рдЖрдХрд╛рд░ рдХреЗ рдХрд╛рд░реНрдб рдХреЗ рд▓рд┐рдП HTML рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ "рднрд╛рд░реА" рдХрд╛рд░реНрдп рд╣реИ, рдЬреЛ рдмрджрд▓рд╛рд╡реЛрдВ рдХреЛ рд╕рд╣реЗрдЬрддреЗ рд╕рдордп рдмреИрдХрдПрдВрдб рдкрд░ рд╕реАрдзреЗ рд╣рд▓ рд╣реЛрдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдорддреМрд░ рдкрд░ рдХрддрд╛рд░рдмрджреНрдз рдФрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реА рдорд╢реАрдиреЛрдВ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдХрддрд╛рд░реЛрдВ рдХреЗ рдХрдИ рдЦреБрд▓реЗ рд╕реНрд░реЛрдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИрдВ; </font><font style="vertical-align: inherit;">рд╣рдо рд░реЗрдбрд┐рд╕ рдФрд░ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкреБрд╕реНрддрдХрд╛рд▓рдп </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд░рдХреНрдпреВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рд░реЗрдбрд┐рд╕ рдХреНрдпреВ) </font><font style="vertical-align: inherit;">рд▓реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">, рдЬреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЪрд╛рд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдФрд░ рд╣рдореЗрдВ рдЙрдирдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╕реНрдкреЙрдирд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдЖрдпреЛрдЬрди рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореВрд▓реА, рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдФрд░ рд╡рд╛рдпрд░рд┐рдВрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рд╕рдордп!</font></font><br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/requirements.txt +++ b/requirements.txt @@ -3,3 +3,5 @@ flask-cors gevent gunicorn pymongo +redis +rq --- a/backend/dev_settings.py +++ b/backend/dev_settings.py @@ -1,3 +1,7 @@ MONGO_HOST = "mongo" MONGO_PORT = 27017 MONGO_DATABASE = "core" +REDIS_HOST = "redis" +REDIS_PORT = 6379 +REDIS_DB = 0 +TASK_QUEUE_NAME = "tasks" --- a/backend/wiring.py +++ b/backend/wiring.py @@ -2,6 +2,8 @@ import os from pymongo import MongoClient from pymongo.database import Database +import redis +import rq import backend.dev_settings from backend.storage.card import CardDAO @@ -21,3 +23,11 @@ class Wiring(object): port=self.settings.MONGO_PORT) self.mongo_database: Database = self.mongo_client[self.settings.MONGO_DATABASE] self.card_dao: CardDAO = MongoCardDAO(self.mongo_database) + + self.redis: redis.Redis = redis.StrictRedis( + host=self.settings.REDIS_HOST, + port=self.settings.REDIS_PORT, + db=self.settings.REDIS_DB) + self.task_queue: rq.Queue = rq.Queue( + name=self.settings.TASK_QUEUE_NAME, + connection=self.redis)</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдмреЙрдпрд▓рд░ рдХреЛрдб рдХрд╛ рдПрдХ рд╕рд╛ред </font></font><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># worker/__main__.py import argparse import uuid import rq import backend.wiring parser = argparse.ArgumentParser(description="Run worker.") #   ,      #  .  ,       rq. parser.add_argument( "--burst", action="store_const", const=True, default=False, help="enable burst mode") args = parser.parse_args() #       Redis. wiring = backend.wiring.Wiring() with rq.Connection(wiring.redis): w = rq.Worker( queues=[wiring.settings.TASK_QUEUE_NAME], #         # ,    . name=uuid.uuid4().hex) w.work(burst=args.burst)</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рд╕реНрдЯреНрдпреВрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдлрд╝рдВрдХреНрд╢рди рд▓рд┐рдЦреЗрдВ:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/tasks/parse.py import mistune from backend.storage.card import CardDAO def parse_card_markup(card_dao: CardDAO, card_id: str): card = card_dao.get_by_id(card_id) card.html = _parse_markdown(card.markdown) card_dao.update(card) _parse_markdown = mistune.Markdown(escape=True, hard_wrap=False)</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рд░реНрдХрд┐рдХ рд░реВрдк рд╕реЗ: рд╣рдореЗрдВ </font></font><code>CardDAO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдб рдХрд╛ рд╕реНрд░реЛрдд рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдмрдЪрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдмрд╛рд╣рд░реА рднрдВрдбрд╛рд░рдг рд╕реЗ рд╕рдВрдмрдВрдз рд░рдЦрдиреЗ рд╡рд╛рд▓реА рд╡рд╕реНрддреБ рдХреЛ рдЕрдЪрд╛рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд░рдордмрджреНрдз рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрд╣ рдХрд╛рд░реНрдп рддреБрд░рдВрдд рдирд╣реАрдВ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЖрд░рдХреНрдпреВ рджреНрд╡рд╛рд░рд╛ рдкрдВрдХреНрддрд┐рдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдЕрдЪреНрдЫреЗ рддрд░реАрдХреЗ рд╕реЗ, рд╣рдореЗрдВ </font></font><code>Wiring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдХреНрд╖ рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ </font><font style="vertical-align: inherit;">рдмрдирд╛рдиреЗ </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рд╣рд░ рддрд░рд╣ рд╕реЗ рдлреЗрдВрдХрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ ... рдЖрдЗрдП рдЗрд╕реЗ рдХрд░реЗрдВ:</font></font><br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/worker/__main__.py +++ b/worker/__main__.py @@ -2,6 +2,7 @@ import argparse import uuid import rq +from rq.job import Job import backend.wiring @@ -16,8 +17,23 @@ args = parser.parse_args() wiring = backend.wiring.Wiring() + +class JobWithWiring(Job): + + @property + def kwargs(self): + result = dict(super().kwargs) + result["wiring"] = backend.wiring.Wiring() + return result + + @kwargs.setter + def kwargs(self, value): + super().kwargs = value + + with rq.Connection(wiring.redis): w = rq.Worker( queues=[wiring.settings.TASK_QUEUE_NAME], - name=uuid.uuid4().hex) + name=uuid.uuid4().hex, + job_class=JobWithWiring) w.work(burst=args.burst)</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдЕрдкрдиреА рдиреМрдХрд░рд┐рдпреЛрдВ рдХреА рд╢реНрд░реЗрдгреА рдШреЛрд╖рд┐рдд рдХреА, рд╡рд╛рдпрд░рд┐рдВрдЧ рдХреЛ рд╕рднреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд kwargs рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдлреЗрдВрдХ рджрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">(рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд╣рд░ рдмрд╛рд░ рдПрдХ рдирдИ рд╡рд╛рдпрд░рд┐рдВрдЧ рдмрдирд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛рд░реНрдп рд╢реБрд░реВ рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЖрд░рдХреНрдпреВ рдХреЗ рдЕрдВрджрд░ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рдВрдЯреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд╣реАрдВ рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред) рддрд╛рдХрд┐ рд╣рдорд╛рд░реЗ рд╕рднреА рдХрд╛рд░реНрдп рд╡рд╛рдпрд░рд┐рдВрдЧ рдкрд░ рдирд┐рд░реНрднрд░ рди рд╣реЛрдВ - рдЕрд░реНрдерд╛рдд, рд╣рдорд╛рд░реА рд╕рднреА рд╡рд╕реНрддреБрдУрдВ рдкрд░ - рдЪрд▓реЛ рдЖрдЗрдП рдПрдХ рдРрд╕рд╛ рдбреЗрдХреЛрд░реЗрдЯрд░ рдмрдирд╛рдПрдВ рдЬреЛ рд╡рд╛рдпрд░рд┐рдВрдЧ рд╕реЗ рдХреЗрд╡рд▓ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># backend/tasks/task.py import functools from typing import Callable from backend.wiring import Wiring def task(func: Callable): #    : varnames = func.__code__.co_varnames @functools.wraps(func) def result(*args, **kwargs): #  .  .pop(),     # ,        . wiring: Wiring = kwargs.pop("wiring") wired_objects_by_name = wiring.__dict__ for arg_name in varnames: if arg_name in wired_objects_by_name: kwargs[arg_name] = wired_objects_by_name[arg_name] #          #   ,  -   . return func(*args, **kwargs) return result</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдп рдореЗрдВ рдПрдХ рдбреЗрдХреЛрд░реЗрдЯрд░ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЬреАрд╡рди рдХрд╛ рдЖрдирдВрдж рд▓реЗрдВ: </font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mistune <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> backend.storage.card <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CardDAO <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> backend.tasks.task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> task @task <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_card_markup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card_dao: CardDAO, card_id: str)</span></span></span><span class="hljs-function">:</span></span> card = card_dao.get_by_id(card_id) card.html = _parse_markdown(card.markdown) card_dao.update(card) _parse_markdown = mistune.Markdown(escape=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, hard_wrap=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреАрд╡рди рдХрд╛ рдЖрдирдВрдж рд▓реЗрдВ? </font><font style="vertical-align: inherit;">рдК, рдореИрдВ рдХрд╣рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд╣рдо рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="plaintext hljs">$ docker-compose up worker ... Creating habr-app-demo_worker_1 ... done Attaching to habr-app-demo_worker_1 worker_1 | 17:21:03 RQ worker 'rq:worker:49a25686acc34cdfa322feb88a780f00' started, version 0.13.0 worker_1 | 17:21:03 *** Listening on tasks... worker_1 | 17:21:03 Cleaning registries for queue: tasks</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">III ... рд╡рд╣ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ! </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдПрдХ рднреА рдХрд╛рд░реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдерд╛! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рд╣рдорд╛рд░реЗ рдЯреВрд▓ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВ, рдЬреЛ рдПрдХ рдЯреЗрд╕реНрдЯ рдХрд╛рд░реНрдб рдмрдирд╛рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдпрд╣: рдХ) рдХрд╛рд░реНрдб рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрдирд╛ рд╣реБрдЖ рдирд╣реАрдВ рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реИ); </font><font style="vertical-align: inherit;">b) рдорд╛рд░реНрдХрд╛рдбрд╛рдЙрди рдХреЗ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдкрд░ рдХрд╛рд░реНрдп рдХрд░рдирд╛ред</font></font><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># tools/add_test_content.py from backend.storage.card import Card, CardNotFound from backend.tasks.parse import parse_card_markup from backend.wiring import Wiring wiring = Wiring() try: card = wiring.card_dao.get_by_slug("helloworld") except CardNotFound: card = wiring.card_dao.create(Card( slug="helloworld", name="Hello, world!", markdown=""" This is a hello-world page. """)) # ,   card_dao.get_or_create,  #      ! wiring.task_queue.enqueue_call( parse_card_markup, kwargs={"card_id": card.id})</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдХрд░рдг рдЕрдм рди рдХреЗрд╡рд▓ рдмреИрдХрдПрдВрдб рдкрд░, рдмрд▓реНрдХрд┐ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдкрд░ рднреА рдЪрд▓рд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЕрдм рд╣рдореЗрдВ рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>docker-compose exec worker python -m tools.add_test_content</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЯрд░реНрдорд┐рдирд▓ рдХреЗ рдПрдХ рдкрдбрд╝реЛрд╕реА рдЯреИрдм рдореЗрдВ рд╣рдореЗрдВ рдПрдХ рдЪрдорддреНрдХрд╛рд░ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ - рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЗ SOMETHING рдХрд┐рдпрд╛!</font></font><br><br><pre> <code class="plaintext hljs">worker_1 | 17:34:26 tasks: backend.tasks.parse.parse_card_markup(card_id='5c715dd1e201ce000c6a89fa') (613b53b1-726b-47a4-9c7b-97cad26da1a5) worker_1 | 17:34:27 tasks: Job OK (613b53b1-726b-47a4-9c7b-97cad26da1a5) worker_1 | 17:34:27 Result is kept for 500 seconds</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреИрдХрдПрдВрдб рдХреЗ рд╕рд╛рде рдХрдВрдЯреЗрдирд░ рдХреЗ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдВрдд рдореЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдЕрдкрдиреЗ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: </font></font><br><br><img src="https://habrastorage.org/webt/ii/5f/zb/ii5fzb_nh2p4-hbv7obhjmxr5kk.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реАрдорд╛рдВрдд рдиреЗрд╡рд┐рдЧреЗрд╢рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо SSR рдкрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВ, рд╣рдореЗрдВ рдЕрдкрдиреЗ рд╕рднреА React рдЙрдкрджреНрд░рд╡ рдХреЛ рдереЛрдбрд╝рд╛ рд╕рд╛рд░реНрдердХ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рд╣рдорд╛рд░реЗ рдПрдХрд▓ рдкреГрд╖реНрда рдХреЗ рдЖрд╡реЗрджрди рдХреЛ рд╕рд╣реА рдорд╛рдпрдиреЗ рдореЗрдВ рдПрдХ рд╣реА рдкреГрд╖реНрда рдмрдирд╛рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рджреЛ (рдПрдХ рдирд╣реАрдВ, рдФрд░ рджреЛ!) рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдЯреВрд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ, I рдЕрдм рдмрд┐рдЧ рдбреЗрдЯ рдбреЗрд╡рд▓рдкрд░!) рдХрд╛рд░реНрдб рдЬреЛ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рд▓рд┐рдВрдХ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рд╣рдо рдЙрдирдХреЗ рдмреАрдЪ рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╕реЗ рдирд┐рдкрдЯреЗрдВрдЧреЗред</font></font><br><br><div class="spoiler">  <b class="spoiler_title">рдЫрд┐рдкрд╛ рд╣реБрдЖ рдкрд╛рда</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># tools/add_test_content.py def create_or_update(card): try: card.id = wiring.card_dao.get_by_slug(card.slug).id card = wiring.card_dao.update(card) except CardNotFound: card = wiring.card_dao.create(card) wiring.task_queue.enqueue_call( parse_card_markup, kwargs={"card_id": card.id}) create_or_update(Card( slug="helloworld", name="Hello, world!", markdown=""" This is a hello-world page. It can't really compete with the [demo page](demo). """)) create_or_update(Card( slug="demo", name="Demo Card!", markdown=""" Hi there, habrovchanin. You've probably got here from the awkward ["Hello, world" card](helloworld). Well, **good news**! Finally you are looking at a **really cool card**! """ ))</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд▓рд┐рдВрдХ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЪрд┐рдВрддрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рд░ рдмрд╛рд░ рд╣рдорд╛рд░рд╛ рдЕрджреНрднреБрдд рдЖрд╡реЗрджрди рдХреИрд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд░реЛрдХреЛ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдкрд░ рдЕрдкрдирд╛ рд╣реИрдВрдбрд▓рд░ рд▓рдЧрд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд▓рд┐рдВрдХ рд╡рд╛рд▓реЗ HTML рдмреИрдХрдПрдВрдб рд╕реЗ рдЖрддреЗ рд╣реИрдВ, рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд░рд┐рдПрдХреНрдЯ рдХреЗ рд╕рд╛рде рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдереЛрдбрд╝рд╛ рд░рд┐рдПрдХреНрдЯ-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлреЛрдХрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/card.js class Card extends Component { componentDidMount() { document.title = this.props.name } navigate(event) { //       .  //      ,    . if (event.target.tagName === 'A' &amp;&amp; event.target.hostname === window.location.hostname) { //     event.preventDefault(); //      this.props.dispatch(navigate(event.target)); } } render() { const {name, html} = this.props; return ( &lt;div&gt; &lt;h1&gt;{name}&lt;/h1&gt; &lt;div dangerouslySetInnerHTML={{__html: html}} onClick={event =&gt; this.navigate(event)} /&gt; &lt;/div&gt; ); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдШрдЯрдХ рдореЗрдВ рдХрд╛рд░реНрдб рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рд╕рднреА рддрд░реНрдХ </font></font><code>CardPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рд╣реА (рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ!), рдХреЛрдИ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">navigate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">link</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: NAVIGATE, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: link.pathname } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореВрд░реНрдЦ reducer рдЬреЛрдбрд╝реЗрдВ: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/reducers.js import { START_FETCHING_CARD, FINISH_FETCHING_CARD, NAVIGATE } from "./actions"; function navigate(state, path) { //     react-router,    ! // (       SSR.) let m = /^\/card\/([^/]+)$/.exec(path); if (m !== null) { return { ...state, page: { type: "card", cardSlug: m[1], isFetching: true } }; } return state } export default function root(state = {}, action) { switch (action.type) { case START_FETCHING_CARD: return { ...state, page: { ...state.page, isFetching: true } }; case FINISH_FETCHING_CARD: return { ...state, page: { ...state.page, isFetching: false, cardData: action.cardData } }; case NAVIGATE: return navigate(state, action.path) } return state; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЕрдм рд╣рдорд╛рд░реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╕реНрдерд┐рддрд┐ рдмрджрд▓ рд╕рдХрддреА рд╣реИ, </font></font><code>CardPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП </font></font><code>componentDidUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдЬреЛрдбрд╝реЗ рдЧрдП </font><font style="vertical-align: inherit;">рддрд░реАрдХреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд╕рдорд╛рди </font><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>componentWillMount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдм, рдЧреБрдгреЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж </font></font><code>CardPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, </font></font><code>cardSlug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рджреМрд░рд╛рди </font><font style="vertical-align: inherit;">рдЧреБрдг </font><font style="vertical-align: inherit;">), рдмреИрдХрдПрдВрдб рд╕реЗ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рднреА рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдпрд╣ </font></font><code>componentWillMount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рддрдм рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬрдм рдШрдЯрдХ рдЖрд░рдВрднреАрдХреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдареАрдХ рд╣реИ, </font></font><code>docker-compose up --build frontend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╣реИ! </font></font><br><br><img src="https://habrastorage.org/webt/4l/ov/b_/4lovb_vai0fxv0tjx6zfcmwb8y8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЪреМрдХрд╕ рдкрд╛рдардХ рдпрд╣ рдиреЛрдЯ рдХрд░реЗрдЧрд╛ рдХрд┐ рдХрд╛рд░реНрдб рдХреЗ рдмреАрдЪ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рддреЗ рд╕рдордп рдкреГрд╖реНрда рдХрд╛ URL рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ - рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рд╣рдо рд╣реИрд▓реЛ, рдбреЗрдореЛ-рдХрд╛рд░реНрдб рдХреЗ рдкрддреЗ рдкрд░ рд╡рд┐рд╢реНрд╡-рдХрд╛рд░реНрдб рджреЗрдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рддрджрдиреБрд╕рд╛рд░, рдЖрдЧреЗ-рдкреАрдЫреЗ рдХрд╛ рдиреЗрд╡рд┐рдЧреЗрд╢рди рднреА рдмрдВрдж рд╣реЛ рдЧрдпрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрддрд┐рд╣рд╛рд╕ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдХрд╛рд▓рд╛ рдЬрд╛рджреВ рдЬреЛрдбрд╝реЗрдВ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рд╕рд░рд▓ рдмрд╛рдд рдЬреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ред</font></font><code>navigate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЪреБрдиреМрддреА </font></font><code>history.pushState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">navigate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">link</span></span></span><span class="hljs-function">) </span></span>{ history.pushState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, link.href); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: NAVIGATE, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: link.pathname } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм, рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдкрд░, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдПрдбреНрд░реЗрд╕ рдмрд╛рд░ рдореЗрдВ URL рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдмреИрдХ рдмрдЯрди </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреВрдЯ рдЬрд╛рдПрдЧрд╛</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>popstate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдмреНрдЬреЗрдХреНрдЯ </font><font style="vertical-align: inherit;">рдХреА рдШрдЯрдирд╛ рдХреЛ рд╕реБрдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдЧрд░ рдЗрд╕ рдШрдЯрдирд╛ рдореЗрдВ рд╣рдо рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЛ рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ (рдпрд╛рдиреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ </font></font><code>dispatch(navigate(...))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ </font></font><code>navigate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рд╢реЗрд╖ </font></font><code>pushState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font><font style="vertical-align: inherit;">рдбреЛрдВрдЯ </font><font style="vertical-align: inherit;">" </font><font style="vertical-align: inherit;">рдлреНрд▓реИрдЧ рдЬреЛрдбрд╝рдирд╛ </font><font style="vertical-align: inherit;">рд╣реЛрдЧрд╛ (рдЕрдиреНрдпрдерд╛ рд╕рдм рдХреБрдЫ рдФрд░ рднреА рдЕрдзрд┐рдХ рдЯреВрдЯ рдЬрд╛рдПрдЧрд╛!)ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, "рд╣рдорд╛рд░реЗ" рд░рд╛рдЬреНрдпреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>pushState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ рдмрдЪрд╛рдиреЗ </font><font style="vertical-align: inherit;">рдХреА рдХреНрд╖рдорддрд╛ </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдмрд╣реБрдд рд╕рд╛рд░рд╛ рдЬрд╛рджреВ рдФрд░ рдбрд┐рдмрдЧ рд╣реИ, рддреЛ рдЪрд▓реЛ рдХреЛрдб рдХреЛ рд╕рд╣реА рдХрд░реЗрдВ! </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдРрдк рдХреИрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/components/app.js class App extends Component { componentDidMount() { //     --   //      "". history.replaceState({ pathname: location.pathname, href: location.href }, ""); //     . window.addEventListener("popstate", event =&gt; this.navigate(event)); } navigate(event) { //    "" ,   //        ,    //   (or is it a good thing?..) if (event.state &amp;&amp; event.state.pathname) { event.preventDefault(); event.stopPropagation(); //      "  pushState". this.props.dispatch(navigate(event.state, true)); } } render() { // ... } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдпрд╣рд╛рдБ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╣реИ: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/actions.js export function navigate(link, dontPushState) { if (!dontPushState) { history.pushState({ pathname: link.pathname, href: link.href }, "", link.href); } return { type: NAVIGATE, path: link.pathname } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдХрд╣рд╛рдиреА рдХрд╛рдо рдХрд░реЗрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреИрд░, рдЕрдВрддрд┐рдо рд╕реНрдкрд░реНрд╢: рдЪреВрдВрдХрд┐ рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╣реИ </font></font><code>navigate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрд╕ рдХреНрд▓рд╛рдЗрдВрдЯ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛрдб рдХреНрдпреЛрдВ рдирд╣реАрдВ рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рд╣рдо рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">--- a/frontend/src/client.js +++ b/frontend/src/client.js @@ -3,23 +3,16 @@ import {render} from 'react-dom' import {Provider} from 'react-redux' import App from './components/app' import configureStore from './redux/configureStore' +import {navigate} from "./redux/actions"; let initialState = { page: { type: "home" } }; -const m = /^\/card\/([^\/]+)$/.exec(location.pathname); -if (m !== null) { - initialState = { - page: { - type: "card", - cardSlug: m[1] - }, - } -} const store = configureStore(initialState); +store.dispatch(navigate(location));</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдирд╖реНрдЯ! </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝реНрд░рдВрдЯреЗрдВрдб: рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд░реЗрдВрдбрд░рд┐рдВрдЧ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рдорд╛рд░реЗ рдореБрдЦреНрдп (рдореЗрд░реА рд░рд╛рдп рдореЗрдВ) рдЪрд┐рдкреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдордп рд╣реИ - рдПрд╕рдИрдУ-рдорд┐рддреНрд░рддрд╛ред рддрд╛рдХрд┐ рдЦреЛрдЬ рдЗрдВрдЬрди рд╣рдорд╛рд░реА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЕрдиреБрдХреНрд░рдордгрд┐рдд рдХрд░ рд╕рдХреЗрдВ, рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛-рдШрдЯрдХреЛрдВ рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдиреЗ рдХреЗ рдкрд░рд┐рдгрд╛рдо рджреЗрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рднреА рд╕реАрдЦреЗрдВ рдХрд┐ рдЗрд╕ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдлрд┐рд░ рд╕реЗ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдпреЛрдЬрдирд╛ рд╕рд░рд▓ рд╣реИред рдкрд╣рд▓рд╛: рд╣рдореЗрдВ рдЕрдкрдиреЗ рд░рд┐рдПрдХреНрдЯ рдШрдЯрдХ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди HTML рдХреЛ рд╣рдорд╛рд░реЗ HTML рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>App</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрд╣ HTML рд╕рд░реНрдЪ рдЗрдВрдЬрди (рдФрд░ рдЬреЗрдПрд╕ рдмрдВрдж рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рд╕рд╛рде, рд╣реЗрд╣реЗ) рджреНрд╡рд╛рд░рд╛ рджреЗрдЦрд╛ рдЬрд╛рдПрдЧрд╛ред рджреВрд╕рд░рд╛: рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдПрдХ рдЯреИрдЧ рдЬреЛрдбрд╝реЗрдВ рдЬреЛ </font></font><code>&lt;script&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╣реАрдВ рдмрдЪрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) рдПрдХ рд░рд╛рдЬреНрдп рдбрдВрдк рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдпрд╣ HTML рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдлрд┐рд░ рд╣рдо рддреБрд░рдВрдд рдЗрд╕ рд░рд╛рдЬреНрдп рдХреЗ рд╕рд╛рде рдЧреНрд░рд╛рд╣рдХ рдкрдХреНрд╖ рдкрд░ рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджрд┐рдЦрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЬрд░реВрд░рдд рд╣реИ (рд╣рдо </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╣рд╛рдЗрдбреНрд░реЗрдЯ рдХрд╛</font></a><font style="vertical-align: inherit;"> рдЙрдкрдпреЛрдЧ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯ рдХрд┐рдП рдЧрдП HTML рдореЗрдВ, рддрд╛рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ DOM рдЯреНрд░реА рдХреЛ рдлрд┐рд░ рд╕реЗ рди рдмрдирд╛рдпрд╛ рдЬрд╛рдП)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд▓рд┐рдЦрдХрд░ рд╢реБрд░реВ рдХрд░реЗрдВ рдЬреЛ HTML рдФрд░ рдЕрдВрддрд┐рдо рд╕реНрдерд┐рддрд┐ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/server.js import "@babel/polyfill" import React from 'react' import {renderToString} from 'react-dom/server' import {Provider} from 'react-redux' import App from './components/app' import {navigate} from "./redux/actions"; import configureStore from "./redux/configureStore"; export default function render(initialState, url) { //  store,    . const store = configureStore(initialState); store.dispatch(navigate(url)); let app = ( &lt;Provider store={store}&gt; &lt;App/&gt; &lt;/Provider&gt; ); // ,        ! // ,         ? let content = renderToString(app); let preloadedState = store.getState(); return {content, preloadedState}; };</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдорд╛рд░реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдирдП рддрд░реНрдХ рдФрд░ рддрд░реНрдХ рдЬреЛрдбрд╝реЗрдВ, рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдордиреЗ рдКрдкрд░ рдмрддрд╛рдпрд╛ рд╣реИ: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/template.js function template(title, initialState, content) { let page = ` &lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;${title}&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="app"&gt;${content}&lt;/div&gt; &lt;script&gt; window.__STATE__ = ${JSON.stringify(initialState)} &lt;/script&gt; &lt;script src="/dist/client.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; `; return page; } module.exports = template;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдкреНрд░реЗрд╕ рд╕рд░реНрд╡рд░ рдереЛрдбрд╝рд╛ рдФрд░ рдЬрдЯрд┐рд▓ рд╣реЛ рдЧрдпрд╛ рд╣реИ: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/index.js app.get("*", (req, res) =&gt; { const initialState = { page: { type: "home" } }; const {content, preloadedState} = render(initialState, {pathname: req.url}); res.send(template("Habr demo app", preloadedState, content)); });</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗрдХрд┐рди рдЧреНрд░рд╛рд╣рдХ рдЖрд╕рд╛рди рд╣реИ: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/client.js import React from 'react' import {hydrate} from 'react-dom' import {Provider} from 'react-redux' import App from './components/app' import configureStore from './redux/configureStore' import {navigate} from "./redux/actions"; //         ! const store = configureStore(window.__STATE__); // render   hydrate. hydrate    // DOM tree,       . hydrate( &lt;Provider store={store}&gt; &lt;App/&gt; &lt;/Provider&gt;, document.querySelector('#app') );</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, рдЖрдкрдХреЛ "рдЗрддрд┐рд╣рд╛рд╕ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реИ" рдЬреИрд╕реЗ рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕рд░рд▓ (рдЕрдм рддрдХ) рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд╣реАрдВ рдкрд░ рдЬреЛрдбрд╝реЗрдВ </font></font><code>utility.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/utility.js export function isServerSide() { //   ,      process, //     -   . return process.env.APP_ENV !== undefined; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рджрд┐рдирдЪрд░реНрдпрд╛ рдореЗрдВ рдмрджрд▓рд╛рд╡ рд╣реЛрдВрдЧреЗ рдЬреЛ рдореИрдВ рдпрд╣рд╛рдВ рдирд╣реАрдВ рд▓рд╛рдКрдВрдЧрд╛ (рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдЗрд╕рдХреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрд░реВрдк рдкреНрд░рддрд┐рдмрджреНрдз</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">)ред </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдорд╛рд░рд╛ рд░рд┐рдПрдХреНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдФрд░ рд╕рд░реНрд╡рд░ рджреЛрдиреЛрдВ рдореЗрдВ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред</font></font><br><br>  рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡рд╣рд╛рдБ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рдПрдХ рдЪреЗрддрд╛рд╡рдиреА ... </font></font><br><br><img src="https://habrastorage.org/webt/gd/ac/ut/gdacut18knqjvzftjhkkuhnzxgk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ? рдореЗрд░реА рд╕реБрдкрд░-рдХреВрд▓ рдлреИрд╢рди рд╕реЗрд╡рд╛ рдкрд░ Google рдЬреЛ рджреЗрдЦ рд░рд╣рд╛ рд╣реИ рд╡рд╣ рд╕рднреА LO LOING рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреИрд░, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рд╕рднреА рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХрддрд╛ рд╣рдорд╛рд░реЗ рдЦрд┐рд▓рд╛рдл рдЦреЗрд▓реЗ рд╣реИрдВред рдЕрдм рд╣рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХрд╛рд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдмреИрдХрдПрдВрдб рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдФрд░ рдпрд╣ рд╡рд╛рдВрдЫрдиреАрдп рд╣реИ рдХрд┐ рдпрд╣ рд╡рд┐рдзрд┐ рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рд╣реЛред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдИ рд╕рдорд╛рдзрд╛рди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдПрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡рд░реНрдгрди рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдкрде рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЖрд╡реЗрджрди ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдЦ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдРрд╕рд╛ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред рдЗрд╕ рдШреЛрд▓ рдХреЗ рдХрдИ рдлрд╛рдпрджреЗ рд╣реИрдВред рдпрд╣ рд╕рд░рд▓ рд╣реИ, рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ, рдФрд░ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдкреНрд░рдпреЛрдЧ рдХреЗ рд░реВрдк рдореЗрдВ (рдореВрд▓ рд╕рд╛рдордЧреНрд░реА рдХрдо рд╕реЗ рдХрдо рдХрд╣реАрдВ рд▓реЗрдЦ рдореЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП!) рдореИрдВ рдПрдХ рдФрд░ рдпреЛрдЬрдирд╛ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реВрдВред </font><font style="vertical-align: inherit;">рд╣рд░ рдмрд╛рд░ рдЬрдм рд╣рдо рдХреБрдЫ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рд╣рдореЗрдВ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рддреЛ рдЙрдкрдпреБрдХреНрдд рд╡рд╛рджрд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреЛ рд╡рд╛рдкрд╕ рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЛ рд╣рдорд╛рд░реЗ рд░рд╛рдЬреНрдп рдореЗрдВ рдХрд╣реАрдВ рди рдХрд╣реАрдВ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЬрдЧрд╣ рд╣реЛрдЧреА рдЬрд╣рд╛рдВ рдЖрдк рд╣рдореЗрд╢рд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╕рдм рдХреБрдЫ рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЪреБрдХрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдирдИ рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/actions.js function addPromise(promise) { return { type: ADD_PROMISE, promise: promise }; } function removePromise(promise) { return { type: REMOVE_PROMISE, promise: promise, }; }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рднреНрд░реВрдг рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд╣рд▓реЗ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рджреВрд╕рд░рд╛ - рдЗрд╕рдХреЗ рдЕрдВрдд рдореЗрдВ </font></font><code>.then()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЙрдирдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ reducer рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/reducers.js export default function root(state = {}, action) { switch (action.type) { case ADD_PROMISE: return { ...state, promises: [...state.promises, action.promise] }; case REMOVE_PROMISE: return { ...state, promises: state.promises.filter(p =&gt; p !== action.promise) }; ...</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВрдЧреЗ </font></font><code>fetchCard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/redux/actions.js function fetchCard() { return (dispatch, getState) =&gt; { dispatch(startFetchingCard()); let url = apiPath() + "/card/" + getState().page.cardSlug; let promise = fetch(url) .then(response =&gt; response.json()) .then(json =&gt; { dispatch(finishFetchingCard(json)); // " ,  " dispatch(removePromise(promise)); }); // "  ,  " return dispatch(addPromise(promise)); }; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ </font></font><code>initialState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦрд╛рд▓реА рд╕рд░рдгреА рдореЗрдВ рд╡рд╛рджреЛрдВ </font><font style="vertical-align: inherit;">рдХреЛ рдЬреЛрдбрд╝рдиреЗ </font><font style="vertical-align: inherit;">рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдЙрди рд╕рднреА рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдмрдиреА рд╣реБрдИ рд╣реИ </font><font style="vertical-align: inherit;">! </font><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдлрд╝рдВрдХреНрд╢рди рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдирд┐рдореНрди рд░реВрдк рд▓реЗрддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/src/server.js function hasPromises(state) { return state.promises.length &gt; 0 } export default async function render(initialState, url) { const store = configureStore(initialState); store.dispatch(navigate(url)); let app = ( &lt;Provider store={store}&gt; &lt;App/&gt; &lt;/Provider&gt; ); //  renderToString     // (  ). CardPage     . renderToString(app); // ,   !    - //    (  // , ),     //    . let preloadedState = store.getState(); while (hasPromises(preloadedState)) { await preloadedState.promises[0]; preloadedState = store.getState() } //  renderToString.    HTML. let content = renderToString(app); return {content, preloadedState}; };</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдЧреНрд░рд╣реАрдд </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХрддрд╛ рдХреЗ </font><font style="vertical-align: inherit;">рдХрд╛рд░рдг </font><font style="vertical-align: inherit;">, рдЕрдиреБрд░реЛрдз рд╣реИрдВрдбрд▓рд░ рднреА рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/index.js app.get("*", (req, res) =&gt; { const initialState = { page: { type: "home" }, promises: [] }; render(initialState, {pathname: req.url}).then(result =&gt; { const {content, preloadedState} = result; const response = template("Habr demo app", preloadedState, content); res.send(response); }, (reason) =&gt; { console.log(reason); res.status(500).send("Server side rendering failed!"); }); });</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et voil├а! </font></font><br><br><img src="https://habrastorage.org/webt/vt/ed/uj/vteduj-6tnshnodaw0setd3b0wu.png"><br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рд╛рдИ-рдЯреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдирд╛ рдЗрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрддрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ! </font><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдЖрд╡реЗрджрди </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд┐рддреБрдм рдкрд░ рднрдВрдбрд╛рд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рд╣реИ </font><font style="vertical-align: inherit;">рдФрд░, рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ, рдЖрдкрдХреЛ рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдбреЙрдХрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд▓реЗрдЦ рдорд╛рдВрдЧ рдореЗрдВ рд╣реИ, рддреЛ рдЗрд╕ рднрдВрдбрд╛рд░ рдХреЛ рднреА рдирд╣реАрдВ рдЫреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛! </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдЕрдиреНрдп рдЬреНрдЮрд╛рди рд╕реЗ рдХреБрдЫ рдХреЗ рд╕рд╛рде рджреЗрдЦ рдкрд╛рдПрдВрдЧреЗ рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЙрдЧрд┐рдВрдЧ, рдирд┐рдЧрд░рд╛рдиреА, тАЛтАЛрд▓реЛрдб рдкрд░реАрдХреНрд╖рдгред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░реАрдХреНрд╖рдг, рд╕реАрдЖрдИ, рд╕реАрдбреАред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреВрд▓рд░ рдореЗрдВ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдпрд╛ рдкреВрд░реНрдг-рдкрд╛рда рдЦреЛрдЬ рдЬреИрд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд╕реЗрдЯрдЕрдк рдФрд░ рд╡рд┐рдХрд╛рд╕ред </font></font></li></ul><br>  рдЖрдкрдХрд╛ рдзреНрдпрд╛рди рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi444446/">https://habr.com/ru/post/hi444446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi444434/index.html">рдЬрд╛рд╡рд╛ 12 рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИ! рдЧрд░реНрдо JEPs рдХреА рд╕рдореАрдХреНрд╖рд╛</a></li>
<li><a href="../hi444436/index.html">рдорд┐рд░рд╛рдИ рдмреЙрдЯрдиреЗрдЯ рдХреНрдпрд╛ рд╣реИ, рдФрд░ рдореИрдВ рдЕрдкрдиреЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреИрд╕реЗ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?</a></li>
<li><a href="../hi444438/index.html">рдореБрдХреНрдд рд╕реНрд░реЛрдд рдХрд╛ рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЗрддрд┐рд╣рд╛рд╕ - рдХреИрд╕реЗ рдореБрдХреНрдд рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдорд╛рд▓рд┐рдХрд╛рдирд╛ рдХреЗ рд╕рд╛рде рд▓рдбрд╝реЗ</a></li>
<li><a href="../hi444442/index.html">рдЬреЗрдЯрд╕рди рдиреИрдиреЛ: рдПрдирд╡реАрдбрд┐рдпрд╛ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рд╕рд┐рдВрдЧрд▓ рдмреЛрд░реНрдб</a></li>
<li><a href="../hi444444/index.html">рд╣рдорд╛рд░реЗ рд╕рдореНрдореЗрд▓рдиреЛрдВ (рдЬреЛрдХрд░, JPoint, DotNext, Mobius, TechTrain рдФрд░ рдЗрддрдиреЗ рдкрд░) рдХреА рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдЕрд╕рдлрд▓рддрд╛рдПрдБ</a></li>
<li><a href="../hi444448/index.html">рдорд┐рд░рд╛рдИ рдХреНрд▓реЛрди рд▓рдХреНрд╖рд┐рдд рдЙрджреНрдпрдо IoT рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдбреЛрдЬреЗрди рдирдИ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдЬреЛрдбрд╝рддрд╛ рд╣реИ</a></li>
<li><a href="../hi444456/index.html">рдЕрдЯрд╛рд░реА 65XE - USB рдХреАрдмреЛрд░реНрдб</a></li>
<li><a href="../hi444460/index.html">рдкрд╛рдпрдерди рдерд┐рдПрдЯрд░ рдХреЗ рдкреЛрд╕реНрдЯрд░ рд╕реЗ рд▓реЗрдХрд░ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдмреЙрдЯ рддрдХред рднрд╛рдЧ 1</a></li>
<li><a href="../hi444462/index.html">рд╕реИрдорд╕рдВрдЧ рдЧреИрд▓реЗрдХреНрд╕реА S10 рдХреА рдЯреЗрд╕реНрдЯрд┐рдВрдЧ - рд╕реНрдорд╛рд░реНрдЯрдлреЛрди рдХреИрдорд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрдм рдкрдХрдбрд╝реЗрдВрдЧреЗ?</a></li>
<li><a href="../hi444464/index.html">Std :: thread рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдкреИрд░ рдХреЛ рд╢реВрдЯ рдХрд░рдиреЗ рдХрд╛ рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>