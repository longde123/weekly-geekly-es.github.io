<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤖 🗜️ 👊🏻 Klien uji TON (Telegram Open Network) dan bahasa Fift baru untuk kontrak pintar 🏛️ 💠 🤵🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lebih dari setahun yang lalu, diketahui tentang rencana messenger Telegram untuk merilis jaringan terdesentralisasi Telegram Open Network . Kemudian d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Klien uji TON (Telegram Open Network) dan bahasa Fift baru untuk kontrak pintar</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453714/"><p>  Lebih dari setahun yang lalu, diketahui tentang rencana messenger Telegram untuk merilis jaringan terdesentralisasi <strong>Telegram Open Network</strong> .  Kemudian dokumen teknis yang banyak tersedia, yang, mungkin, ditulis oleh Nikolai Durov dan menggambarkan struktur jaringan masa depan.  Bagi mereka yang ketinggalan, saya sarankan Anda membiasakan diri dengan pencabutan kembali dokumen ini ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 2</a> ; bagian ketiga, sayangnya, masih mengumpulkan debu dalam konsep). </p><br><p> Sejak itu, tidak ada berita penting tentang status pengembangan TON, sampai beberapa hari yang lalu (di salah satu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saluran tidak resmi</a> ) sebuah tautan muncul di halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://test.ton.org/download.html</a> , di mana: </p><br><p>  ◦ <a href="">ton-test-liteclient-full.tar.xz</a> - kode sumber klien ringan untuk jaringan uji TON; <br>  ◦ <a href="">ton-lite-client-test1.config.json</a> - file konfigurasi untuk menghubungkan ke jaringan uji; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">README</a> - informasi tentang membangun dan memulai klien; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HOWTO</a> - petunjuk langkah demi langkah tentang cara membuat kontrak pintar menggunakan klien; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ton.pdf</a> - dokumen yang diperbarui (tanggal 2 Maret 2019) dengan tinjauan teknis jaringan TON; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tvm.pdf</a> - deskripsi teknis TVM (TON Virtual Machine, TON virtual machine); <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tblkch.pdf</a> - deskripsi teknis dari blockchain TON; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fiftybase.pdf</a> - deskripsi bahasa Fift baru, yang dirancang untuk membuat kontrak pintar dalam TON. </p><br><p>  Saya ulangi, tidak ada konfirmasi resmi halaman dan semua dokumen ini oleh Telegram, tetapi volume materi ini membuatnya cukup masuk akal.  Jalankan klien yang diterbitkan <strong>dengan risiko Anda sendiri</strong> . </p><a name="habracut"></a><br><h2 id="sborka-testovogo-klienta">  Uji membangun klien </h2><br><p>  Pertama, mari kita coba membangun dan menjalankan klien uji - untungnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">README</a> menjelaskan proses sederhana ini secara terperinci.  Saya akan melakukan ini dengan menggunakan contoh macOS 10.14.5, saya tidak dapat menjamin keberhasilan perakitan pada sistem lain. </p><br><ol><li><p>  Unduh dan buka paket <a href="">arsip dengan kode sumber</a> .  Penting untuk mengunduh versi terbaru, karena kompatibilitas ke belakang tidak dijamin pada tahap ini. </p><br></li><li><p>  Kami memastikan bahwa versi terbaru dari make, cmake (versi 3.0.2 atau lebih tinggi), OpenSSL (termasuk file header C), g ++ atau dentang dipasang pada sistem.  Saya tidak perlu menginstal ulang apa pun, semuanya langsung terkumpul. </p><br></li><li><p> Misalkan sumber dibongkar ke folder <code>~/lite-client</code> .  Secara terpisah, kami membuat folder kosong untuk proyek yang dirakit (misalnya, <code>~/liteclient-build</code> ), dan darinya ( <code>cd ~/liteclient-build</code> ) kami <code>cd ~/liteclient-build</code> perintah: </p><br><pre> <code class="bash hljs">cmake ~/lite-client cmake --build . --target <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-lite-client</code> </pre> <br><p><img src="https://habrastorage.org/webt/sr/lx/j8/srlxj8au48yus3uuddlpenvika0.png" alt="Membangun pelanggan yang sukses"><br><br>  Untuk membangun juru bahasa Fift untuk kontrak pintar (lihat di bawah), kami juga menelepon </p><br><pre> <code class="plaintext hljs">cmake --build . --target fift</code> </pre> <br></li><li><p>  Unduh <a href="">file konfigurasi</a> saat ini untuk terhubung ke jaringan tes dan meletakkannya di folder dengan klien yang berkumpul. </p><br></li><li><p>  <strong>Selesai</strong> , Anda dapat memulai klien: </p><br><pre> <code class="plaintext hljs">./test-lite-client -C ton-lite-client-test1.config.json</code> </pre> <br></li></ol><br><p>  Jika semuanya dilakukan dengan benar, maka Anda akan melihat sesuatu seperti ini: </p><br><p><img src="https://habrastorage.org/webt/gl/gg/d3/glggd35dzg4vwogf9woibu43zrk.png" alt="Pelunuran klien"></p><br><p>  Seperti yang Anda lihat, ada beberapa perintah yang tersedia: </p><br><p>  ◦ <strong><code>help</code></strong> - tampilkan daftar perintah ini; <br>  ◦ <strong><code>quit</code></strong> - keluar; <br>  ◦ <strong><code>time</code></strong> - menunjukkan waktu saat ini di server; <br>  ◦ <strong><code>status</code></strong> - menunjukkan status koneksi dan database lokal; <br>  ◦ <strong><code>last</code></strong> - perbarui status blockchain (muat blok terakhir).  Penting untuk mengeksekusi perintah ini sebelum permintaan apa pun untuk memastikan bahwa Anda melihat kondisi jaringan saat ini. <br>  ◦ <strong><code>sendfile</code></strong> <code>&lt;filename&gt;</code> - unggah file lokal ke jaringan TON.  Ini adalah interaksi dengan jaringan - termasuk, misalnya, pembuatan kontrak pintar baru dan permintaan untuk mentransfer dana antar akun; <br>  ◦ <strong><code>getaccount</code></strong> <code>&lt;address&gt;</code> - menunjukkan status akun saat ini (pada saat perintah <strong><code>last</code></strong> dijalankan) dengan alamat yang ditentukan; <br>  ◦ <strong><code>privkey</code></strong> <code>&lt;filename&gt;</code> - memuat kunci pribadi dari file lokal. </p><br><p>  Jika pada saat peluncuran klien, Anda meneruskan folder ke sana menggunakan opsi <code>-D</code> , maka itu akan menambahkan blok terakhir dari rantai induk ke dalamnya: </p><br><pre> <code class="bash hljs">./<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-lite-client -C ton-lite-client-test1.config.json -D ~/ton-db-dir</code> </pre> <br><p>  Sekarang kita dapat beralih ke hal-hal yang lebih menarik - mempelajari bahasa Fift, mencoba menyusun kontrak pintar (misalnya, membuat dompet uji), mengunggahnya ke jaringan dan mencoba mentransfer dana antar akun. </p><br><h2 id="yazyk-fift">  Lima bahasa </h2><br><p>  Dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">limabase.pdf,</a> Anda dapat mengetahui bahwa untuk membuat kontrak yang cerdas, tim Telegram menciptakan bahasa tumpukan baru <strong>Fift</strong> (tampaknya, dari angka <em>kelima</em> , dengan analogi dengan Forth - bahasa yang digunakan Fift untuk memiliki banyak kesamaan). </p><br><p>  Dokumen ini cukup banyak, dengan 87 halaman, dan saya tidak akan menceritakan kembali isinya secara rinci dalam kerangka artikel ini (setidaknya karena saya sendiri tidak selesai membacanya :).  Saya akan membahas poin utama dan memberikan beberapa contoh kode dalam bahasa ini. </p><br><p>  Pada tingkat dasar, sintaks Fift cukup sederhana: kodenya terdiri dari <em>kata</em> - <em>kata</em> , biasanya dipisahkan oleh spasi atau jeda baris (kasus khusus: beberapa kata tidak memerlukan pembatas setelah dirinya sendiri).  <em>Kata</em> apa <em>pun</em> adalah urutan karakter yang peka terhadap huruf besar-kecil yang sesuai dengan beberapa <em>definisi</em> (secara kasar, apa yang harus dilakukan penerjemah ketika menemukan kata ini).  Jika tidak ada definisi kata, penerjemah akan mencoba menguraikannya sebagai angka dan meletakkannya di tumpukan.  By the way, angka-angka di sini tiba-tiba bilangan bulat 257-bit, tetapi tidak ada bilangan pecahan sama sekali - lebih tepatnya, mereka segera berubah menjadi sepasang bilangan bulat, membentuk pembilang dan penyebut dari pecahan rasional. </p><br><p>  Kata-kata biasanya berinteraksi dengan makna di bagian atas tumpukan.  Jenis kata yang terpisah - <em>awalan</em> - tidak menggunakan tumpukan, tetapi karakter berikutnya dari file sumber.  Misalnya, string literal diimplementasikan dengan cara ini - karakter "tanda kutip" ( <code>"</code> ) adalah kata awalan yang mencari tanda kutip (penutup) berikutnya dan menempatkan string di antara mereka di tumpukan. Single-line ( <code>//</code> ) dan multi-line ( <code>/*</code> ) berperilaku dengan cara yang sama. komentar. </p><br><p>  Tentang ini, hampir seluruh struktur internal bahasa berakhir.  Segala sesuatu yang lain (termasuk struktur kontrol) didefinisikan sebagai kata-kata (baik internal, seperti operasi aritmatika dan definisi kata-kata baru, atau didefinisikan dalam "perpustakaan standar" <code>Fift.fif</code> , yang terletak di <code>crypto/fift</code> di sumber). </p><br><p>  Contoh sederhana program Fift: </p><br><pre> <code class="plaintext hljs">{ dup =: x dup * =: y } : setxy 3 setxy x . y . xy + . 7 setxy x . y . xy + .</code> </pre> <br><p>  Baris pertama mendefinisikan <code>setxy</code> kata baru (perhatikan awalan <code>{</code> , yang membuat blok sebelum penutup <code>}</code> dan awalan <code>setxy</code> yang sebenarnya mendefinisikan kata).  <code>setxy</code> mengambil angka dari atas tumpukan, mendefinisikan (atau mendefinisikan ulang) sebagai <em>konstanta</em> global <code>x</code> , dan kuadrat dari angka ini sebagai konstanta <code>y</code> (mengingat bahwa nilai-nilai konstanta dapat didefinisikan ulang, saya lebih suka memanggil mereka variabel, tetapi saya mengikuti penamaannya dalam bahasa). </p><br><p>  Dalam dua baris berikutnya, nomor diletakkan di stack, <code>setxy</code> , maka nilai konstanta <code>x</code> , <code>y</code> output (kata tersebut digunakan untuk output <code>.</code> ), Kedua konstanta diletakkan di stack, dijumlahkan dan hasilnya juga ditampilkan.  Sebagai hasilnya, kita akan melihat: </p><br><pre> <code class="plaintext hljs">3 9 12 ok 7 49 56 ok</code> </pre> <br><p>  (Interpreter mencetak garis "ok" ketika selesai memproses garis saat ini dalam mode input interaktif) </p><br><p>  Nah, contoh kode lengkap: </p><br><pre> <code class="plaintext hljs">"Asm.fif" include -1 constant wc // create a wallet in workchain -1 (masterchain) // Create new simple wallet &lt;{ SETCP0 DUP IFNOTRET INC 32 THROWIF // return if recv_internal, fail unless recv_external 512 INT LDSLICEX DUP 32 PLDU // sign cs cnt c4 PUSHCTR CTOS 32 LDU 256 LDU ENDS // sign cs cnt cnt' pubk s1 s2 XCPU // sign cs cnt pubk cnt' cnt EQUAL 33 THROWIFNOT // ( seqno mismatch? ) s2 PUSH HASHSU // sign cs cnt pubk hash s0 s4 s4 XC2PU // pubk cs cnt hash sign pubk CHKSIGNU // pubk cs cnt ? 34 THROWIFNOT // signature mismatch ACCEPT SWAP 32 LDU NIP DUP SREFS IF:&lt;{ 8 LDU LDREF // pubk cnt mode msg cs s0 s2 XCHG SENDRAWMSG // pubk cnt cs ; ( message sent ) }&gt; ENDS INC NEWC 32 STU 256 STU ENDC c4 POPCTR }&gt;c // code &lt;b 0 32 u, newkeypair swap dup constant wallet_pk "new-wallet.pk" B&gt;file B, b&gt; // data // no libraries &lt;bb{00110} s, rot ref, swap ref, b&gt; // create StateInit dup ."StateInit: " &lt;s csr. cr dup hash dup constant wallet_addr ."new wallet address = " wc . .": " dup x. cr wc over 7 smca&gt;$ type cr 256 u&gt;B "new-wallet.addr" B&gt;file &lt;b 0 32 u, b&gt; dup ."signing message: " &lt;s csr. cr dup hash wallet_pk ed25519_sign_uint rot &lt;bb{1000100} s, wc 8 i, wallet_addr 256 u, b{000010} s, swap &lt;ss, b{0} s, swap B, swap &lt;ss, b&gt; dup ."External message for initialization is " &lt;s csr. cr 2 boc+&gt;B dup Bx. cr "new-wallet-query.boc" tuck B&gt;file ."(Saved to file " type .")" cr</code> </pre> <br><p>  File yang tampak menakutkan ini dirancang untuk membuat kontrak yang cerdas - file itu akan ditempatkan di file <code>new-wallet-query.boc</code> setelah eksekusi.  Harap dicatat bahwa di sini digunakan bahasa rakitan lain untuk Mesin Virtual TON (saya tidak akan membahasnya secara rinci), instruksi yang akan ditempatkan di blockchain. </p><br><p>  Dengan demikian, assembler untuk TVM ditulis dalam Fift - sumber assembler ini ada di file <code>crypto/fift/Asm.fif</code> dan terhubung pada awal potongan kode di atas. </p><br><p>  Apa yang bisa saya katakan, ternyata, Nikolai Durov hanya suka membuat bahasa pemrograman baru :) </p><br><h2 id="sozdanie-smart-kontrakta-i-vzaimodeystvie-s-ton">  Membuat kontrak yang cerdas dan berinteraksi dengan TON </h2><br><p>  Jadi, misalkan kita mengumpulkan klien TON dan juru bahasa Fift, seperti yang dijelaskan di atas, dan menjadi terbiasa dengan bahasa tersebut.  Bagaimana cara membuat kontrak pintar sekarang?  Ini dijelaskan dalam file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HOWTO yang</a> dilampirkan pada sumbernya. </p><br><h3 id="akkaunty-v-ton">  Akun TON </h3><br><p>  Seperti yang saya jelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ulasan TON</a> , jaringan ini mengandung lebih dari satu blockchain - ada satu yang umum, yang disebut  "Rantai induk", serta sejumlah tambahan "rantai kerja" tambahan yang diidentifikasi oleh nomor 32-bit.  Rantai master memiliki pengidentifikasi -1, selain itu, rantai kerja "dasar" dengan pengidentifikasi 0 juga dapat digunakan. Setiap rantai kerja dapat memiliki konfigurasi sendiri.  Secara internal, setiap kelompok kerja dibagi menjadi shardchains, tetapi ini sudah merupakan detail dari implementasi, yang tidak harus diingat. </p><br><p>  Banyak akun disimpan dalam satu rantai kerja, yang memiliki pengidentifikasi akun_id mereka sendiri.  Untuk rantai master dan rantai kerja nol, mereka memiliki panjang 256 bit.  Jadi, pengenal akun ditulis, misalnya, seperti ini: </p><br><pre> <code class="plaintext hljs">-1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Ini adalah format "mentah": pertama, pengidentifikasi workchain, lalu titik dua, dan pengidentifikasi akun dalam notasi heksadesimal. </p><br><p>  Selain itu, ada format singkat - nomor workchain dan alamat akun dikodekan dalam bentuk biner, sebuah checksum ditambahkan ke dalamnya dan semua ini dikodekan di Base64: </p><br><pre> <code class="plaintext hljs">Ef+BVndbeTJeXWLnQtm5bDC2UVpc0vH2TF2ksZPAPwcODSkb</code> </pre> <br><p>  Mengetahui format rekaman ini, kami dapat meminta status akun saat ini melalui klien uji menggunakan perintah </p><br><pre> <code class="plaintext hljs">getaccount -1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Kami mendapat jawaban seperti ini: </p><br><pre> <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> -client.cpp: <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> untuk -1: 8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D sehubungan dengan blok (-1,8000000000000000,72355): F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296: 1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F dan <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> </pre> <br><p>  Kami melihat struktur yang disimpan dalam DHT dari workchain yang ditentukan.  Misalnya, dalam bidang <code>storage.balance</code> adalah saldo akun saat ini, di <code>storage.state.code</code> adalah kode kontrak pintar, dan di <code>storage.state.data</code> adalah data saat ini.  Perhatikan bahwa penyimpanan data TON - Sel, sel - adalah pohon, setiap sel dapat memiliki data sendiri, serta sel anak.  Ini ditampilkan sebagai lekukan di baris terakhir. </p><br><h3 id="sborka-smart-kontrakta">  Perakitan kontrak yang cerdas </h3><br><p>  Sekarang mari kita buat struktur seperti itu sendiri (disebut BOC - <em>kantong sel</em> ) menggunakan bahasa Fift.  Untungnya, Anda tidak perlu menulis sendiri kontrak pintar - di folder <code>crypto/block</code> dari arsip sumber ada file <code>new-wallet.fif</code> yang akan membantu kami membuat dompet baru.  Salin ke folder dengan klien rakitan ( <code>~/liteclient-build</code> , jika Anda <code>~/liteclient-build</code> instruksi di atas).  Saya mengutip isinya di atas sebagai contoh kode pada Fift. </p><br><p>  Kami menjalankan file ini sebagai berikut: </p><br><pre> <code class="plaintext hljs">./crypto/fift -I"&lt;source-directory&gt;/crypto/fift" new-wallet.fif</code> </pre> <br><p>  Di sini <code>&lt;source-directory&gt;</code> harus diganti dengan path ke sumber yang tidak dibongkar (simbol "~" tidak dapat digunakan di sini, sayangnya, Anda memerlukan path lengkap).  Alih-alih menggunakan <code>-I</code> Anda bisa mendefinisikan <code>FIFTPATH</code> lingkungan <code>FIFTPATH</code> dan memasukkan path ini ke dalamnya. </p><br><p>  Karena kami meluncurkan Fift dengan nama file <code>new-wallet.fif</code> , itu akan mengeksekusinya dan menyelesaikannya.  Jika Anda menghilangkan nama file, Anda dapat bermain dengan penerjemah dalam mode interaktif. </p><br><p>  Setelah eksekusi, sesuatu seperti ini harus ditampilkan di konsol: </p><br><pre> <code class="plaintext hljs">StateInit: x{34_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} new wallet address = -1 : 4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ signing message: x{00000000} External message for initialization is x{89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} B5EE9C724104030100000000D60002CF89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001001020084FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED5400480000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B6290698B (Saved to file new-wallet-query.boc)</code> } <code class="plaintext hljs">StateInit: x{34_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} new wallet address = -1 : 4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ signing message: x{00000000} External message for initialization is x{89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} B5EE9C724104030100000000D60002CF89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001001020084FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED5400480000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B6290698B (Saved to file new-wallet-query.boc)</code> </pre> <br><p>  Ini berarti bahwa dompet dengan pengidentifikasi <code>-1:4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2</code> (atau, yang merupakan hal yang sama, <code>0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ</code>  Kode yang sesuai dengannya akan <code>new-wallet-query.boc</code> dalam file <code>new-wallet-query.boc</code> , alamatnya di <code>new-wallet.addr</code> , dan kunci pribadi di <code>new-wallet.pk</code> (hati-hati - memulai ulang skrip akan menimpa file-file ini). </p><br><p>  Tentu saja, jaringan TON belum tahu tentang dompet ini, hanya disimpan dalam bentuk file-file ini.  Sekarang Anda perlu mengunggahnya ke jaringan.  Benar, masalahnya adalah untuk membuat kontrak pintar Anda perlu membayar komisi, dan saldo akun Anda masih nol. </p><br><p>  Dalam mode kerja, masalah ini akan diselesaikan dengan membeli gram di bursa (atau dengan mentransfer dari dompet lain).  Nah, dalam mode tes saat ini, kontrak pintar khusus telah dilembagakan, dari mana Anda dapat meminta hingga 20 gram begitu saja. </p><br><h3 id="formirovanie-zaprosa-k-chuzhomu-smart-kontraktu">  Pembentukan permintaan untuk kontrak pintar orang lain </h3><br><p>  Minta kontrak yang cerdas, bagikan gram ke kiri dan kanan, lakukanlah.  Dalam folder <code>crypto/block</code> sama kita temukan file <code>testgiver.fif</code> : </p><br><pre> <code class="plaintext hljs">// "testgiver.addr" file&gt;B 256 B&gt;u@ 0x8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d dup constant wallet_addr ."Test giver address = " x. cr 0x4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 constant dest_addr -1 constant wc 0x00000011 constant seqno 1000000000 constant Gram { Gram swap */ } : Gram*/ 6.666 Gram*/ constant amount // bx --&gt; b' ( serializes a Gram amount ) { -1 { 1+ 2dup 8 * ufits } until rot over 4 u, -rot 8 * u, } : Gram, // create a message (NB: 01b00.., b = bounce) &lt;bb{010000100} s, wc 8 i, dest_addr 256 u, amount Gram, 0 9 64 32 + + 1+ 1+ u, "GIFT" $, b&gt; &lt;b seqno 32 u, 1 8 u, swap ref, b&gt; dup ."enveloping message: " &lt;s csr. cr &lt;bb{1000100} s, wc 8 i, wallet_addr 256 u, 0 Gram, b{00} s, swap &lt;ss, b&gt; dup ."resulting external message: " &lt;s csr. cr 2 boc+&gt;B dup Bx. cr "wallet-query.boc" B&gt;file</code> </pre> <br><p>  Kami juga menyimpannya di folder dengan klien yang dirakit, tetapi perbaiki baris kelima - sebelum baris " <code>constant dest_addr</code> ".  Ganti dengan alamat dompet yang Anda buat sebelumnya (penuh, tidak disingkat).  "-1:" Anda tidak perlu menulis di awal, alih-alih tulis "0x" di awal. </p><br><p>  Anda juga dapat mengubah baris <code>6.666 Gram*/ constant amount</code> - ini adalah jumlah gram yang Anda minta (tidak lebih dari 20).  Bahkan jika Anda menentukan bilangan bulat, tinggalkan titik desimal. </p><br><p>  Akhirnya, Anda perlu memperbaiki garis <code>0x00000011 constant seqno</code> .  Nomor pertama di sini adalah nomor urut saat ini, yang disimpan dalam akun yang mengeluarkan gram.  Darimana mendapatkannya?  Seperti yang disebutkan di atas, mulai klien dan jalankan: </p><br><pre> <code class="plaintext hljs">last getaccount -1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Di bagian paling akhir dalam data kontrak pintar akan </p><br><pre> <code class="plaintext hljs">... x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> </pre> <br><p>  Nomor 0000000D (Anda akan memiliki lebih banyak) adalah nomor urut, yang harus diganti di <code>testgiver.fif</code> . </p><br><p>  Itu saja, simpan file dan jalankan ( <code>./crypto/fift testgiver.fif</code> ).  Outputnya akan menjadi file <code>wallet-query.boc</code> .  Ini adalah <em>pesan yang</em> dibentuk untuk kontrak pintar orang lain - permintaannya adalah "mentransfer begitu banyak gram ke akun ini dan itu." </p><br><p>  Menggunakan klien, kami mengunggahnya ke jaringan: </p><br><pre> <code class="plaintext hljs">&gt; sendfile wallet-query.boc [ 1][t 1][1558747399.456575155][test-lite-client.cpp:577][!testnode] sending query from file wallet-query.boc [ 3][t 2][1558747399.500236034][test-lite-client.cpp:587][!query] external message status is 1</code> </pre> <br><p>  Jika sekarang kita panggil <code>last</code> , dan lagi-lagi meminta status akun dari mana kita meminta gram, maka kita akan melihat bahwa nomor urutnya telah bertambah satu - ini berarti ia mengirim uang ke akun kita. </p><br><p>  Langkah terakhir tetap - kita memuat kode dompet kita (saldo sudah diisi ulang, tetapi tanpa kode kontrak pintar kita tidak akan bisa mengelolanya).  <code>sendfile new-wallet-query.boc</code> - dan hanya itu, Anda memiliki dompet Anda sendiri di jaringan TON (meskipun untuk saat ini hanya yang uji). </p><br><h3 id="sozdanie-ishodyaschih-tranzakciy">  Buat Transaksi Keluar </h3><br><p>  Untuk mentransfer uang dari saldo akun yang dibuat, ada file <code>crypto/block/wallet.fif</code> , yang juga perlu ditempatkan di folder bersama klien yang terkumpul. </p><br><p>  Mirip dengan langkah-langkah sebelumnya, Anda perlu menyesuaikan jumlah yang Anda transfer, alamat penerima (dest_addr), dan seqno dompet Anda (1 setelah dompet diinisialisasi dan bertambah 1 setelah setiap transaksi keluar - Anda dapat melihatnya dengan meminta status akun Anda) .  Untuk tes, Anda dapat menggunakan, misalnya, dompet saya - <code>0x4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2</code> . </p><br><p>  Ketika Anda menjalankan ( <code>./crypto/fift wallet.fif</code> ), skrip akan mengambil alamat dompet Anda (dari mana Anda mentransfer) dan kunci privatnya dari file <code>new-wallet.addr</code> dan <code>new-wallet.pk</code> , dan menulis pesan yang diterima ke <code>new-wallet-query.boc</code> . </p><br><p>  Seperti sebelumnya, untuk langsung melakukan transaksi, kami memanggil <code>sendfile new-wallet-query.boc</code> di klien.  Setelah itu, jangan lupa memperbarui status blockchain ( <code>last</code> ) dan periksa apakah saldo dan seqno dompet kita telah berubah ( <code>getaccount &lt;account_id&gt;</code> ). </p><br><p><img src="https://habrastorage.org/webt/fp/d1/is/fpd1is8dlh4_iz9rdbakflyeq5s.png" alt="Deskripsi akun"></p><br><p>  Itu saja, sekarang kita bisa membuat kontrak pintar dalam TON dan mengirim permintaan kepada mereka.  Seperti yang Anda lihat, fungsi saat ini sudah cukup untuk, misalnya, membuat dompet yang lebih ramah dengan antarmuka grafis (namun, diharapkan akan tersedia sebagai bagian dari messenger). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453714/">https://habr.com/ru/post/id453714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453700/index.html">Pelajaran tentang SDL 2: Pelajaran 1 - Halo, SDL 2</a></li>
<li><a href="../id453706/index.html">Bagaimana Saya Lulus dari Ujian Sertifikasi Insinyur Data Google Cloud Professional</a></li>
<li><a href="../id453708/index.html">OS real-time AQUA RTOS untuk MK AVR di lingkungan BASCOM AVR</a></li>
<li><a href="../id453710/index.html">Praktik pengembangan dalam proyek-proyek besar: mitp SberPractice iOS # 1</a></li>
<li><a href="../id453712/index.html">Bagaimana eBay melakukan pemindai barcode di WebAssembly</a></li>
<li><a href="../id453716/index.html">Rekan kerja negara untuk keluarga orang IT - adakah orang?</a></li>
<li><a href="../id453720/index.html">Subtleties dari Ekspresi Lambda di C #</a></li>
<li><a href="../id453722/index.html">Tentang penelitian proses non-stasioner</a></li>
<li><a href="../id453728/index.html">Pertempuran Hyperstars</a></li>
<li><a href="../id453730/index.html">Kedokteran gigi modern: implantasi gigi simultan dan perluasan tulang rahang melalui mata direktur teknis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>