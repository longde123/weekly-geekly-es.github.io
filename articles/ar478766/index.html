<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💨 ‼️ 👩🏾‍✈️ تخصيص تعيين الربيع MVC تحكم 🤓 🎅🏽 👨🏿‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مقدمة 


 لقد واجهت مؤخرًا مهمة تطبيق وحدة تحكم تتعامل مع المواقف بطرق مختلفة حيث توجد معلمات طلب وحيث لا توجد. تفاقمت المشكلة من خلال حقيقة أن هناك ح...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تخصيص تعيين الربيع MVC تحكم</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478766/" style=";text-align:right;direction:rtl"><h2 id="vvedenie" style=";text-align:right;direction:rtl">  مقدمة </h2><br><p style=";text-align:right;direction:rtl">  لقد واجهت مؤخرًا مهمة تطبيق وحدة تحكم تتعامل مع المواقف بطرق مختلفة حيث توجد معلمات طلب وحيث لا توجد.  تفاقمت المشكلة من خلال حقيقة أن هناك حاجة لطريقتين مختلفتين في وحدة التحكم.  الميزات القياسية لـ Spring MVC لم تسمح بذلك.  اضطررت لحفر أعمق قليلا.  من يهتم - مرحبا بكم في القط. </p><a name="habracut"></a><br><h2 id="chto-my-hotim" style=";text-align:right;direction:rtl">  ماذا نريد </h2><br><p style=";text-align:right;direction:rtl">  إليك اختبار قصير يصف جوهر المهمة. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">TestControllerTest.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitWebConfig</span></span>(WebConfig.class) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestControllerTest</span></span></span><span class="hljs-class"> </span></span>{     <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>     WebApplicationContext webApplicationContext;     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITHOUT_PARAMS, result.getResponse().getContentAsString()));     }     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders                 .get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>)                 .param(<span class="hljs-string"><span class="hljs-string">"someparam"</span></span>, <span class="hljs-string"><span class="hljs-string">"somevalue"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITH_PARAMS, result.getResponse().getContentAsString()));     } }</code> </pre> </div></div><br><h2 id="nadeemsya-chto-vse-razreshitsya-samo-soboy" style=";text-align:right;direction:rtl">  نأمل أن يتم حل كل شيء بمفرده </h2><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ومع ذلك ، لم يكن Spring صديقًا كما هو متوقع ، وكان الناتج: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">java.lang.IllegalStateException: Ambiguous mapping. Cannot map 'getTestController' method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithoutParams() to {GET /test}: There is already 'getTestController' bean method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithParams(ru.pchurzin.spring.customannotations.SearchQuery) mapped.`</code> </pre> <br><h2 id="ne-sdaemsya" style=";text-align:right;direction:rtl">  لا تستسلم </h2><br><p style=";text-align:right;direction:rtl">  بذلت محاولات لفصل تعيين هذه الأساليب عن طريق <code>@RequestMapping(params = "some condition")</code> ، لكن لسوء الحظ ، في الإصدار المستخدم من Spring 5.1.8 لا توجد طريقة لتعيين الشرط لطلب احتواء <strong>أي</strong> معلمات.  يمكنك تحديد وجود معلمات بأسماء محددة أو عدم وجود معلمات بأسماء محددة.  لا أحد ولا الآخر كان مناسبًا ، لأن  المعلمات يمكن أن تكون مختلفة في كل طلب.  أود أن أكتب شيئًا <code>@RequestMapping(params = "*")</code> للإشارة إلى أن الطلب يجب أن يحتوي على بعض المعلمات أوRequestMapping (params = "! *") `للإشارة إلى ما لا ينبغي أن يكون في الطلب أن لا توجد معلمات. </p><br><h2 id="a-chto-v-dokumentacii" style=";text-align:right;direction:rtl">  وما هو في الوثائق؟ </h2><br><p style=";text-align:right;direction:rtl">  بعد تدخين الوثائق ، تم العثور على قسم <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">CustomAnnotations</a> ، والذي نرى فيه: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Spring MVC also supports custom request-mapping attributes with custom request-matching logic.</code> </pre> <br><p style=";text-align:right;direction:rtl">  تقرر تقديم تعليق توضيحي ، مما سمح لي بتحديد الشروط التي أحتاجها لتوافر معلمات الاستعلام. <br></p><br><h2 id="cel" style=";text-align:right;direction:rtl">  هدف </h2><br><p style=";text-align:right;direction:rtl">  أريد إضافة تعليق توضيحي <code>@NoRequestParams</code> إلى الطريقة ، مع الإشارة إلى أن هذه الطريقة تعالج الطلبات بدون معلمات. </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.METHOD) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> NoRequestParams { }</code> </pre> <br><p style=";text-align:right;direction:rtl">  المراقب المالي مع الشرح لدينا: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">TestContoller.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public String handleRequestWithoutParams() {        return HANDLE_REQUEST_WITHOUT_PARAMS;    } }</span></span></code> </pre> </div></div><br><h2 id="pristupim" style=";text-align:right;direction:rtl">  لنبدأ </h2><br><p style=";text-align:right;direction:rtl">  يتم وصف التكوين Spring-MVC القياسي ، الذي يتم تنشيطه بواسطة التعليق التوضيحي <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/EnableWebMvc.html">EnableWebMvc</a> ، في فئة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurationSupport.html">WebMvcConfigurationSupport</a> .  إنشاء مثيل <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html">لقول</a> لفئة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html">RequestMappingHandlerMapping</a> ، والتي تنفذ التعيين باستخدام كائنات فئة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfo.html">RequestMappingInfo</a> ، والتي بدورها تقوم بتغليف المعلومات حول تعيين طلبات الطريقة.  يتم تقديم هذه المعلومات في شكل شروط - كائنات فئة تنفذ واجهة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition.</a>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">الربيع لديه 6 تطبيقات جاهزة:</a> <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html"><br><br></a> <br></p><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/PatternsRequestCondition.html">PatternsRequestCondition</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestMethodsRequestCondition.html">RequestMethodsRequestCondition</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ParamsRequestCondition.html">ParamsRequestCondition</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/HeadersRequestCondition.html">HeadersRequestCondition</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ConsumesRequestCondition.html">ConsumesRequestCondition</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ProducesRequestCondition.html">ProducesRequestCondition</a> </li></ul><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى هذه التطبيقات ، يمكننا تحديد الخاصة بنا.  للقيام بذلك ، نحتاج إلى تطبيق واجهة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition</a> ، واستخدام هذا التطبيق لتلبية احتياجاتنا.  يمكنك تطبيق الواجهة مباشرة أو استخدام فئة مجردة <br>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/AbstractRequestCondition.html">AbstractRequestCondition</a> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">NoRequestParamsCondition.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractRequestCondition</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class">&gt; </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NoRequestParamsCondition NO_PARAMS_CONDITION = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoRequestParamsCondition();    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Collection&lt;?&gt; getContent() {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.singleton(<span class="hljs-string"><span class="hljs-string">"no params"</span></span>);    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getToStringInfix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMatchingCondition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.getParameterMap().isEmpty()) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;        }        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other, HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;    } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  يتم استخدام أول طريقتين لسلسلة تمثل حالتنا. </p><br><p style=";text-align:right;direction:rtl">  هناك حاجة لطريقة <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">T combine (T other)</a> لدمج الشروط ، على سبيل المثال ، إذا كان هناك تعليق توضيحي على الطريقة والفئة.  في هذه الحالة ، يتم استخدام طريقة الجمع لدمج.  لا يعني التعليق التوضيحي الخاص بنا تركيبة - وبالتالي ، فإننا ببساطة نعيد حالة الحالة الحالية الخاصة بنا. </p><br><p style=";text-align:right;direction:rtl">  يتم استخدام الأسلوب <a href="&amp;xid=17259,15700021,15700186,15700190,15700259,15700271&amp;usg=ALkJrhhXeMWzqxY57sULqJecYTwt3FBiBA#compareTo-T-javax.servlet.">int comparTo (T other ، طلب HttpServletRequest)</a> لمقارنة الشروط في سياق طلب معين.  أي  إذا كانت هناك عدة شروط من نفس النوع للطلب ، فسيكتشف أي منها هو الأكثر تحديدًا.  ولكن مرة أخرى ، حالتنا هي الحالة الوحيدة الممكنة ، وبالتالي فإننا ببساطة نعيد 0 ، أي  جميع شروطنا متساوية. </p><br><p style=";text-align:right;direction:rtl">  ويرد المنطق الأساسي للعمل في أسلوب <a href="&amp;xid=17259,15700021,15700186,15700190,15700259,15700271&amp;usg=ALkJrhhXeMWzqxY57sULqJecYTwt3FBiBA#getMatchingCondition-javax.servlet.">T getMatchingCondition (طلب HttpServletRequest)</a> .  في هذه الطريقة ، يجب أن نقرر الاستعلام عما إذا كانت حالتنا تنطبق عليها أم لا.  إذا كان الأمر كذلك ، فأعد كائن الشرط.  إن لم يكن ، والعودة <code>null</code> .  في حالتنا ، نرجع كائن شرط إذا كان الطلب لا يحتوي على أي معلمات. </p><br><p style=";text-align:right;direction:rtl">  الآن نحن بحاجة إلى تضمين حالتنا في عملية رسم الخرائط.  للقيام بذلك ، سوف نرث من التطبيق القياسي لـ <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfoHandlerMapping.html">RequestMappingHandlerMapping</a> <br>  وإعادة تعريف <code>getCustomMethodCondition(Method method)</code> ، والتي يتم إنشاؤها للتو من أجل إضافة الشروط المخصصة الخاصة بك.  علاوة على ذلك ، يتم استخدام هذه الطريقة لتحديد شروط <strong>أساليب</strong> التحكم.  هناك أيضًا طريقة <code>getCustomTypeCondition(Class&lt;?&gt; handlerType)</code> ، والتي يمكن استخدامها لتحديد الشروط بناءً على معلومات حول فئة وحدة التحكم.  في حالتنا ، نحن لسنا في حاجة إليها. </p><br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، لدينا التنفيذ التالي: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">CustomRequestMappingHandlerMapping.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomRequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RequestCondition&lt;?&gt; getCustomMethodCondition(Method method) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.isAnnotationPresent(NoRequestParams.class) ? NO_PARAMS_CONDITION : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  المنطق ليس معقدًا - فنحن نتحقق من وجود تعليقاتنا التوضيحية ، وإذا كان موجودًا ، نرجع كائن حالتنا. </p><br><p style=";text-align:right;direction:rtl">  لتمكين تطبيق التعيين لدينا ، سنقوم بتوسيع تهيئة Spring MVC القياسية: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">WebConfig.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebMvcConfigurationSupport</span></span></span><span class="hljs-class"> </span></span>{       <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> RequestMappingHandlerMapping </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRequestMappingHandlerMapping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomRequestMappingHandlerMapping();    }    <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TestController </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTestController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestController();    } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  أضف تعليقنا التوضيحي إلى وحدة التحكم: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  وتحقق من النتيجة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.851 s - in ru.pchurzin.spring.customannotations.TestControllerTest Results: Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</code> </pre> <br><p style=";text-align:right;direction:rtl">  وبالتالي ، يمكننا تغيير منطق التعيين وفقًا لاحتياجاتنا والتوصل إلى شروطنا الخاصة.  على سبيل المثال ، الشروط على عنوان IP أو المستخدم المستخدم.  قد تكون هناك حلول أبسط ، ولكن على أي حال ، فإن تجميع دراجتك مفيد أيضًا في بعض الأحيان. </p><br><p style=";text-align:right;direction:rtl">  شكرا لاهتمامكم </p><br><p style=";text-align:right;direction:rtl">  <a href="https://github.com/pchurzin/spring-mvc-custom-annotatations">جيثب رمز المثال</a> </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar478766/">https://habr.com/ru/post/ar478766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar478750/index.html">مكتبات تصوير البيانات الفعلية للمطورين رد فعل</a></li>
<li><a href="../ar478752/index.html">تاريخ نظم التحكم في الإصدار</a></li>
<li><a href="../ar478758/index.html">دليل العلامات UTM العظيم: كيفية معرفة من أين يأتي المستخدمون</a></li>
<li><a href="../ar478760/index.html">"الصفر" الجحيم وكيفية الخروج منه</a></li>
<li><a href="../ar478764/index.html">أخطاء جافا سكريبت: إصلاح ، عملية ، إصلاح</a></li>
<li><a href="../ar478772/index.html">نسيج تلافيفي</a></li>
<li><a href="../ar478774/index.html">مزاج العام الجديد من اردوينو والعصي</a></li>
<li><a href="../ar478778/index.html">هبرا المباحث والمزاج الاحتفالي</a></li>
<li><a href="../ar478782/index.html">الحصول على إذن الطيران بدون طيار (BVS ، UAV) في الاتحاد الروسي</a></li>
<li><a href="../ar478788/index.html">في مملكة معينة ، وليس في حالة "نابضة". تقرير ياندكس</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>