<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÖ üßúüèæ üîì GitLab Shell Runner. Peluncuran kompetitif layanan pengujian menggunakan Docker Compose üë©üèª‚Äçü§ù‚Äçüë®üèΩ üèúÔ∏è ‚õπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan menarik bagi penguji dan pengembang, tetapi lebih ditujukan untuk automators yang dihadapkan dengan masalah konfigurasi GitLab CI / C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GitLab Shell Runner. Peluncuran kompetitif layanan pengujian menggunakan Docker Compose</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449910/"><p> <a href=""><img src="https://habrastorage.org/webt/ub/dc/bf/ubdcbfrlztg3eqofpqbs6w1u9sw.png"></a> </p><br><p> Artikel ini akan menarik bagi penguji dan pengembang, tetapi lebih ditujukan untuk automators yang dihadapkan dengan masalah konfigurasi GitLab CI / CD untuk pengujian integrasi dalam kondisi sumber daya infrastruktur yang tidak mencukupi dan / atau kurangnya platform untuk orkestrasi wadah.  Saya akan memberi tahu Anda cara mengonfigurasikan penyebaran lingkungan pengujian menggunakan docker yang disusun pada pelari shell GitLab tunggal dan agar saat menggunakan beberapa lingkungan, layanan yang diluncurkan tidak saling mengganggu. </p><a name="habracut"></a><br><a name="toc"></a><br><h2 id="soderzhanie">  Isi </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Latar belakang</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gitlab shell runner</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mempersiapkan docker-compose.yml</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Persiapan Makefile</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mempersiapkan .gitlab-ci.yml</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jalankan tes integrasi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pembersihan Pelari</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hasil</a> </li></ul><br><a name="prerequisites"></a><br><h2 id="predposylki">  Latar belakang </h2><br><ol><li><p>  Dalam praktik saya, sering terjadi pengujian integrasi "sembuh" pada proyek.  Dan seringkali masalah pertama dan paling signifikan adalah pipa CI, di mana pengujian integrasi dari layanan yang <strong>dikembangkan</strong> dilakukan di lingkungan pengembang / tahap.  Ini menyebabkan beberapa masalah: </p><br><ul><li>  Karena cacat pada layanan tertentu selama pengujian integrasi, rangkaian pengujian dapat rusak oleh data yang rusak.  Ada kasus ketika mengirim permintaan dengan format JSON rusak tergantung layanan, yang membuat stand sepenuhnya beroperasi. </li><li>  Memperlambat loop tes dengan pertumbuhan data uji.  Saya pikir tidak masuk akal untuk menggambarkan contoh dengan membersihkan / mengembalikan basis data.  Dalam praktik saya, saya belum melihat proyek di mana prosedur ini berjalan dengan lancar. </li><li>  Risiko mengganggu kinerja sirkuit uji saat menguji pengaturan sistem umum.  Misalnya, kebijakan pengguna / grup / kata sandi / aplikasi. </li><li>  Data uji dari autotest mencegah penguji manual hidup. </li></ul><br><p>  Seseorang akan mengatakan bahwa autotest yang baik harus membersihkan data sendiri.  Saya memiliki argumen yang menentang: </p><br><ul><li>  Dudukan dinamis sangat nyaman digunakan. </li><li>  Tidak setiap objek dapat dihapus dari sistem melalui API.  Misalnya, panggilan untuk menghapus objek tidak diterapkan, karena bertentangan dengan logika bisnis. </li><li>  Saat membuat objek melalui API, sejumlah besar metadata dapat dibuat, yang bermasalah untuk dihapus. </li><li>  Jika tes saling tergantung, maka proses pembersihan data setelah tes selesai berubah menjadi sakit kepala. </li><li>  Panggilan tambahan (dan, menurut saya, tidak dibenarkan) ke API. </li><li>  Dan argumen utama: ketika data uji mulai membersihkan langsung dari database.  Itu berubah menjadi sirkus PK / FK nyata!  Dari pengembang itu terdengar: "Saya hanya menambahkan / menghapus / mengganti nama papan nama, mengapa 100500 tes integrasi gagal?" </li></ul><br><p>  Menurut pendapat saya, solusi paling optimal adalah lingkungan yang dinamis. </p><br></li><li>  Banyak orang menggunakan docker-compose untuk menjalankan lingkungan pengujian, tetapi sedikit yang menggunakan docker-compose saat melakukan pengujian integrasi dalam CI / CD.  Dan di sini saya tidak memperhitungkan kubernetes, gerombolan dan platform orkestrasi wadah lainnya.  Tidak semua perusahaan memilikinya.  Akan lebih baik jika docker-compose.yml bersifat universal. </li><li>  Bahkan jika kita memiliki pelari QA kita sendiri, bagaimana kita dapat memastikan bahwa layanan yang diluncurkan melalui docker-compose tidak saling mengganggu? </li><li>  Bagaimana cara mengumpulkan log layanan yang diuji? </li><li>  Bagaimana cara membersihkan pelari? </li></ol><br><p>  Saya memiliki pelari GitLab saya sendiri untuk proyek-proyek saya dan saya menemukan masalah ini ketika mengembangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">klien Java</a> untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TestRail</a> .  Atau lebih tepatnya, ketika menjalankan tes integrasi.  Selanjutnya, kami akan menyelesaikan masalah ini dengan contoh-contoh dari proyek ini. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="gitlab_shell_runner"></a><br><h3 id="gitlab-shell-runner">  Gitlab shell runner </h3><br><p>  Untuk pelari, saya merekomendasikan mesin virtual Linux dengan 4 vCPU, 4 GB RAM, 50 GB HDD. <br>  Di Internet, banyak informasi tentang konfigurasi gitlab-runner, jadi singkat: </p><br><ul><li>  Kami pergi ke mesin di SSH </li><li><p>  Jika Anda memiliki RAM kurang dari 8 GB, maka saya sarankan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">melakukan swap 10 GB</a> sehingga pembunuh OOM tidak datang dan tidak membunuh kami karena kekurangan RAM.  Ini bisa terjadi ketika lebih dari 5 tugas dimulai secara bersamaan.  Tugas akan lebih lambat, tetapi stabil. </p><br><div class="spoiler">  <b class="spoiler_title">Contoh pembunuh OOM</b> <div class="spoiler_text"><p> Jika Anda melihat <code>bash: line 82: 26474 Killed</code> dalam log tugas, kemudian jalankan <code>sudo dmesg | grep 26474</code> <code>sudo dmesg | grep 26474</code> </p><br><pre> <code class="plaintext hljs">[26474] 1002 26474 1061935 123806 339 0 0 java Out of memory: Kill process 26474 (java) score 127 or sacrifice child Killed process 26474 (java) total-vm:4247740kB, anon-rss:495224kB, file-rss:0kB, shmem-rss:0kB</code> </pre> <br><p>  Dan jika gambar terlihat seperti ini, maka tambahkan swap atau drop RAM. </p><br></div></div><br></li></ul><br><ul><li>  Instal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gitlab-runner</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">docker</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">docker-compose</a> , make. </li><li>  Tambahkan pengguna <code>gitlab-runner</code> ke grup <code>docker</code> <br><pre> <code class="bash hljs">sudo groupadd docker sudo usermod -aG docker gitlab-runner</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Daftarkan</a> gitlab-runner. </li><li><p>  Buka untuk mengedit <code>/etc/gitlab-runner/config.toml</code> dan tambahkan </p><br><pre> <code class="plaintext hljs">concurrent=20 [[runners]] request_concurrency = 10</code> </pre> <br><p>  Ini akan memungkinkan Anda untuk menjalankan tugas paralel pada satu pelari.  Baca lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br>  Jika mesin Anda lebih kuat, misalnya, 8 vCPU, 16 GB RAM, maka angka-angka ini dapat dibuat setidaknya 2 kali lebih besar.  Tapi itu semua tergantung pada apa yang sebenarnya akan diluncurkan pada pelari ini dan berapa jumlahnya. </p><br></li></ul><br><p>  Cukup. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="docker_compose_yml_preparation"></a><br><h2 id="podgotovka-docker-composeyml">  Mempersiapkan docker-compose.yml </h2><br><p>  Tugas utama adalah docker-compose.yml, yang akan digunakan secara lokal dan dalam pipa CI. </p><br><p>  Variabel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">COMPOSE_PROJECT_NAME</a> akan digunakan untuk memulai beberapa contoh lingkungan (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">makefile</a> ). </p><br><p>  Contoh dari docker-compose.yml saya </p><br><pre> <code class="plaintext hljs">version: "3" #    web (php)  fmt , #      . #   ,   /var/www/testrail volumes: static-content: services: db: image: mysql:5.7.22 environment: MYSQL_HOST: db MYSQL_DATABASE: mydb MYSQL_ROOT_PASSWORD: 1234 SKIP_GRANT_TABLES: 1 SKIP_NETWORKING: 1 SERVICE_TAGS: dev SERVICE_NAME: mysql migration: image: registry.gitlab.com/touchbit/image/testrail/migration:latest links: - db depends_on: - db fpm: image: registry.gitlab.com/touchbit/image/testrail/fpm:latest container_name: "testrail-fpm-${CI_JOB_ID:-local}" volumes: - static-content:/var/www/testrail links: - db web: image: registry.gitlab.com/touchbit/image/testrail/web:latest #   TR_HTTP_PORT  TR_HTTPS_PORTS  , #     80  443  . ports: - ${TR_HTTP_PORT:-80}:80 - ${TR_HTTPS_PORT:-443}:443 volumes: - static-content:/var/www/testrail links: - db - fpm</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="makefile_preparation"></a><br><h2 id="podgotovka-makefile">  Persiapan Makefile </h2><br><p>  Saya menggunakan Makefile, karena sangat nyaman untuk manajemen lingkungan lokal dan CI. </p><br><p>  Komentar lebih lanjut sebaris </p><br><pre> <code class="plaintext hljs">#           `.indirect`, #     `docker-compose.yml` #  bash   pipefail # pipefail -   ,      SHELL=/bin/bash -o pipefail #   CI_JOB_ID   ifeq ($(CI_JOB_ID),) #   local CI_JOB_ID := local endif #    export COMPOSE_PROJECT_NAME = $(CI_JOB_ID)-testrail #    , , volumes docker-down: docker-compose -f .indirect/docker-compose.yml down #   docker-down () docker-up: docker-down #     docker-registry docker-compose -f .indirect/docker-compose.yml pull #   # force-recreate -    # renew-anon-volumes -   volumes   docker-compose -f .indirect/docker-compose.yml up --force-recreate --renew-anon-volumes -d #  ,   ,           docker ps #    docker-logs: mkdir -p ./logs docker logs $${COMPOSE_PROJECT_NAME}_web_1 &gt;&amp; logs/testrail-web.log || true docker logs $${COMPOSE_PROJECT_NAME}_fpm_1 &gt;&amp; logs/testrail-fpm.log || true docker logs $${COMPOSE_PROJECT_NAME}_migration_1 &gt;&amp; logs/testrail-migration.log || true docker logs $${COMPOSE_PROJECT_NAME}_db_1 &gt;&amp; logs/testrail-mysql.log || true #   docker-clean: @echo   testrail- docker kill $$(docker ps --filter=name=testrail -q) || true @echo    docker rm -f $$(docker ps -a -f --filter=name=testrail status=exited -q) || true @echo  dangling  docker rmi -f $$(docker images -f "dangling=true" -q) || true @echo  testrail  docker rmi -f $$(docker images --filter=reference='registry.gitlab.com/touchbit/image/testrail/*' -q) || true @echo    volume docker volume rm -f $$(docker volume ls -q) || true @echo   testrail  docker network rm $(docker network ls --filter=name=testrail -q) || true docker ps</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Periksa peluncuran lokal</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ make docker-up docker-compose -f .indirect/docker-compose.yml pull Pulling db ... done Pulling migration ... done Pulling fpm ... done Pulling web ... done docker-compose -f .indirect/docker-compose.yml up --force-recreate --renew-anon-volumes -d Creating network "local-testrail_default" with the default driver Recreating local-testrail_db_1 ... done Recreating local-testrail_migration_1 ... done Recreating local-testrail_fpm_1 ... done Recreating local-testrail_web_1 ... done docker ps CONTAINER ID NAMES 3b8f9d4af29c local-testrail_web_1 5622c7d742d5 local-testrail_fpm_1 b580e3392038 local-testrail_migration_1 e467630bd3a5 local-testrail_db_1</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Memeriksa Peluncuran CI</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ export CI_JOB_ID=123456789 $ make docker-up docker-compose -f .indirect/docker-compose.yml pull Pulling db ... done Pulling migration ... done Pulling fpm ... done Pulling web ... done docker-compose -f .indirect/docker-compose.yml up --force-recreate --renew-anon-volumes -d Creating network "123456789-testrail_default" with the default driver Creating volume "123456789-testrail_static-content" with default driver Creating 123456789-testrail_db_1 ... done Creating 123456789-testrail_fpm_1 ... done Creating 123456789-testrail_migration_1 ... done Creating 123456789-testrail_web_1 ... done docker ps CONTAINER ID NAMES ccf1ad33d0e8 123456789-testrail_web_1 bc079964f681 123456789-testrail_fpm_1 10dc9d4d8f2a 123456789-testrail_migration_1 fe98d43c380e 123456789-testrail_db_1</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Periksa koleksi log</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ make docker-logs mkdir -p ./logs docker logs ${COMPOSE_PROJECT_NAME}_web_1 &gt;&amp; logs/testrail-web.log || true docker logs ${COMPOSE_PROJECT_NAME}_fpm_1 &gt;&amp; logs/testrail-fpm.log || true docker logs ${COMPOSE_PROJECT_NAME}_migration_1 &gt;&amp; logs/testrail-migration.log || true docker logs ${COMPOSE_PROJECT_NAME}_db_1 &gt;&amp; logs/testrail-mysql.log || true</code> </pre> <br><p><img src="https://habrastorage.org/webt/e0/jx/a2/e0jxa2mkfygvn7kn5fpu3xlcnl0.png"></p></div></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="gitlab_ci_yml_preparation"></a><br><h2 id="podgotovka-gitlab-ciyml">  Mempersiapkan .gitlab-ci.yml </h2><br><a name="integration_tests_run"></a><br><h3 id="zapusk-integracionnyh-testov">  Jalankan tes integrasi </h3><br><pre> <code class="plaintext hljs">Integration: stage: test tags: - my-shell-runner before_script: #   registry - docker login -u gitlab-ci-token -p ${CI_JOB_TOKEN} ${CI_REGISTRY} #   TR_HTTP_PORT  TR_HTTPS_PORT - export TR_HTTP_PORT=$(shuf -i10000-60000 -n1) - export TR_HTTPS_PORT=$(shuf -i10000-60000 -n1) script: #    - make docker-up #    jar (  ) - java -jar itest.jar --http-port ${TR_HTTP_PORT} --https-port ${TR_HTTPS_PORT} #    - docker run --network=testrail-network-${CI_JOB_ID:-local} --rm itest after_script: #   - make docker-logs #   - make docker-down artifacts: #   when: always paths: - logs expire_in: 30 days</code> </pre> <br><p>  Sebagai hasil dari peluncuran tugas seperti itu dalam artefak, direktori log akan berisi log layanan dan tes.  Yang sangat nyaman jika terjadi kesalahan.  Bagi saya, setiap tes secara paralel menulis lognya sendiri, tetapi saya akan membicarakannya secara terpisah. </p><br><p><img src="https://habrastorage.org/webt/xh/s2/yj/xhs2yjdigikkpaoxxi49ocdhink.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="clean_runner"></a><br><h3 id="ochistka-rannera">  Pembersihan Pelari </h3><br><p>  Tugas hanya akan berjalan sesuai jadwal. </p><br><pre> <code class="plaintext hljs">stages: - clean - build - test Clean runner: stage: clean only: - schedules tags: - my-shell-runner script: - make docker-clean</code> </pre> <br><p>  Selanjutnya, buka proyek GitLab kami -&gt; CI / CD -&gt; Jadwal -&gt; Jadwal Baru dan tambahkan jadwal baru </p><br><p> <a href=""><img src="https://habrastorage.org/webt/md/40/9y/md409yjzjctken7qcjh5gkj0u4y.png"></a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p><br><a name="result"></a><br><h3 id="rezultat">  Hasil </h3><br><p>  Jalankan 4 tugas di GitLab CI <br> <a href=""><img src="https://habrastorage.org/webt/2t/yt/nt/2tytntlg2we6ikmh4ef3p6noxwe.png"></a> </p><br><p>  Dalam log tugas terakhir dengan tes integrasi, kami melihat kontainer dari tugas yang berbeda </p><br><pre> <code class="plaintext hljs">CONTAINER ID NAMES c6b76f9135ed 204645172-testrail-web_1 01d303262d8e 204645172-testrail-fpm_1 2cdab1edbf6a 204645172-testrail-migration_1 826aaf7c0a29 204645172-testrail-mysql_1 6dbb3fae0322 204645084-testrail-web_1 3540f8d448ce 204645084-testrail-fpm_1 70fea72aa10d 204645084-testrail-mysql_1 d8aa24b2892d 204644881-testrail-web_1 6d4ccd910fad 204644881-testrail-fpm_1 685d8023a3ec 204644881-testrail-mysql_1 1cdfc692003a 204644793-testrail-web_1 6f26dfb2683e 204644793-testrail-fpm_1 029e16b26201 204644793-testrail-mysql_1 c10443222ac6 204567103-testrail-web_1 04339229397e 204567103-testrail-fpm_1 6ae0accab28d 204567103-testrail-mysql_1 b66b60d79e43 204553690-testrail-web_1 033b1f46afa9 204553690-testrail-fpm_1 a8879c5ef941 204553690-testrail-mysql_1 069954ba6010 204553539-testrail-web_1 ed6b17d911a5 204553539-testrail-fpm_1 1a1eed057ea0 204553539-testrail-mysql_1</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Log lebih detail</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ docker login -u gitlab-ci-token -p ${CI_JOB_TOKEN} ${CI_REGISTRY} WARNING! Using --password via the CLI is insecure. Use --password-stdin. WARNING! Your password will be stored unencrypted in /home/gitlab-runner/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded $ export TR_HTTP_PORT=$(shuf -i10000-60000 -n1) $ export TR_HTTPS_PORT=$(shuf -i10000-60000 -n1) $ mkdir ${CI_JOB_ID} $ cp .indirect/docker-compose.yml ${CI_JOB_ID}/docker-compose.yml $ make docker-up docker-compose -f ${CI_JOB_ID:-.indirect}/docker-compose.yml kill docker network rm testrail-network-${CI_JOB_ID:-local} || true Error: No such network: testrail-network-204645172 docker network create testrail-network-${CI_JOB_ID:-local} 0a59552b4464b8ab484de6ae5054f3d5752902910bacb0a7b5eca698766d0331 docker-compose -f ${CI_JOB_ID:-.indirect}/docker-compose.yml pull Pulling web ... done Pulling fpm ... done Pulling migration ... done Pulling db ... done docker-compose -f ${CI_JOB_ID:-.indirect}/docker-compose.yml up --force-recreate --renew-anon-volumes -d Creating volume "204645172-testrail_static-content" with default driver Creating 204645172-testrail-mysql_1 ... Creating 204645172-testrail-mysql_1 ... done Creating 204645172-testrail-migration_1 ... done Creating 204645172-testrail-fpm_1 ... done Creating 204645172-testrail-web_1 ... done docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c6b76f9135ed registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" 13 seconds ago Up 1 second 0.0.0.0:51148-&gt;80/tcp, 0.0.0.0:25426-&gt;443/tcp 204645172-testrail-web_1 01d303262d8e registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" 16 seconds ago Up 13 seconds 9000/tcp 204645172-testrail-fpm_1 2cdab1edbf6a registry.gitlab.com/touchbit/image/testrail/migration:latest "docker-entrypoint.s‚Ä¶" 16 seconds ago Up 13 seconds 3306/tcp, 33060/tcp 204645172-testrail-migration_1 826aaf7c0a29 mysql:5.7.22 "docker-entrypoint.s‚Ä¶" 18 seconds ago Up 16 seconds 3306/tcp 204645172-testrail-mysql_1 6dbb3fae0322 registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" 36 seconds ago Up 22 seconds 0.0.0.0:44202-&gt;80/tcp, 0.0.0.0:20151-&gt;443/tcp 204645084-testrail-web_1 3540f8d448ce registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" 38 seconds ago Up 35 seconds 9000/tcp 204645084-testrail-fpm_1 70fea72aa10d mysql:5.7.22 "docker-entrypoint.s‚Ä¶" 40 seconds ago Up 37 seconds 3306/tcp 204645084-testrail-mysql_1 d8aa24b2892d registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" About a minute ago Up 53 seconds 0.0.0.0:31103-&gt;80/tcp, 0.0.0.0:43872-&gt;443/tcp 204644881-testrail-web_1 6d4ccd910fad registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" About a minute ago Up About a minute 9000/tcp 204644881-testrail-fpm_1 685d8023a3ec mysql:5.7.22 "docker-entrypoint.s‚Ä¶" About a minute ago Up About a minute 3306/tcp 204644881-testrail-mysql_1 1cdfc692003a registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" About a minute ago Up About a minute 0.0.0.0:44752-&gt;80/tcp, 0.0.0.0:23540-&gt;443/tcp 204644793-testrail-web_1 6f26dfb2683e registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" About a minute ago Up About a minute 9000/tcp 204644793-testrail-fpm_1 029e16b26201 mysql:5.7.22 "docker-entrypoint.s‚Ä¶" About a minute ago Up About a minute 3306/tcp 204644793-testrail-mysql_1 c10443222ac6 registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" 5 hours ago Up 5 hours 0.0.0.0:57123-&gt;80/tcp, 0.0.0.0:31657-&gt;443/tcp 204567103-testrail-web_1 04339229397e registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" 5 hours ago Up 5 hours 9000/tcp 204567103-testrail-fpm_1 6ae0accab28d mysql:5.7.22 "docker-entrypoint.s‚Ä¶" 5 hours ago Up 5 hours 3306/tcp 204567103-testrail-mysql_1 b66b60d79e43 registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" 5 hours ago Up 5 hours 0.0.0.0:56321-&gt;80/tcp, 0.0.0.0:58749-&gt;443/tcp 204553690-testrail-web_1 033b1f46afa9 registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" 5 hours ago Up 5 hours 9000/tcp 204553690-testrail-fpm_1 a8879c5ef941 mysql:5.7.22 "docker-entrypoint.s‚Ä¶" 5 hours ago Up 5 hours 3306/tcp 204553690-testrail-mysql_1 069954ba6010 registry.gitlab.com/touchbit/image/testrail/web:latest "nginx -g 'daemon of‚Ä¶" 5 hours ago Up 5 hours 0.0.0.0:32869-&gt;80/tcp, 0.0.0.0:16066-&gt;443/tcp 204553539-testrail-web_1 ed6b17d911a5 registry.gitlab.com/touchbit/image/testrail/fpm:latest "docker-php-entrypoi‚Ä¶" 5 hours ago Up 5 hours 9000/tcp 204553539-testrail-fpm_1 1a1eed057ea0 mysql:5.7.22 "docker-entrypoint.s‚Ä¶" 5 hours ago Up 5 hours 3306/tcp 204553539-testrail-mysql_1</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Semua tugas selesai dengan sukses</b> <div class="spoiler_text"><p>  Artefak tugas berisi log layanan dan uji <br> <a href=""><img src="https://habrastorage.org/webt/xu/gp/kh/xugpkhzugu-9olo8bz5qyorlbdc.png"></a> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/1h/cr/b8/1hcrb8n8awyjugdbbhvyn9axiv8.png"></a> </p></div></div><br><p>  Tampaknya semuanya indah, tetapi ada nuansa.  Pipa dapat dibatalkan secara paksa selama pelaksanaan tes integrasi, dalam hal ini wadah yang berjalan tidak akan dihentikan.  Dari waktu ke waktu Anda perlu membersihkan pelari.  Sayangnya, tugas revisi di GitLab CE masih dalam status <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Open</a> </p><br><p>  Tetapi kami telah menambahkan peluncuran tugas yang dijadwalkan, dan tidak ada yang melarang kami untuk memulai secara manual. <br>  Buka proyek kami -&gt; CI / CD -&gt; Jadwal dan jalankan tugas <code>Clean runner</code> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sg/ia/nv/sgianvitqqnsknbmmgupakud62k.png"></a> </p><br><p>  Total: </p><br><ul><li>  Kami memiliki satu pelari shell. </li><li>  Tidak ada konflik antara tugas dan lingkungan. </li><li>  Kami memiliki peluncuran tugas paralel dengan tes integrasi. </li><li>  Anda dapat menjalankan tes integrasi baik secara lokal maupun di dalam wadah. </li><li>  Log layanan dan tes dikumpulkan dan dilampirkan pada tugas perpipaan. </li><li>  Dimungkinkan untuk membersihkan pelari dari gambar buruh pelabuhan tua. </li></ul><br><p>  Waktu setup ~ 2 jam. <br>  Faktanya, itu saja.  Saya akan dengan senang hati memberikan umpan balik. </p><br><p>  PS <br>  Terima kasih khusus kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">freeseacher</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">vvasilenok</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ivanych</a> .  Komentar Anda sangat berharga dalam konteks publikasi. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk konten</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id449910/">https://habr.com/ru/post/id449910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id449898/index.html">Berita dalam-luar</a></li>
<li><a href="../id449902/index.html">Jaringan TV kabel untuk yang terkecil. Bagian 2: Komposisi dan bentuk gelombang</a></li>
<li><a href="../id449904/index.html">Membuat dll proxy untuk membajak operasi dll memeriksa</a></li>
<li><a href="../id449906/index.html">Mendokumentasikan server REST (Node.JS, TypeScript, Koa, Joi, Swagger)</a></li>
<li><a href="../id449908/index.html">DDR3 atau DDR4? Mengapa kami menawarkan Dell R420 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps seharga $ 99 di Belanda?</a></li>
<li><a href="../id449916/index.html">5 cara untuk menggunakan kode PHP dalam kondisi beban tinggi</a></li>
<li><a href="../id449918/index.html">Termometer inframerah dengan sensor MLX90614</a></li>
<li><a href="../id449920/index.html">10 cara non-standar untuk melukai SEO saat mengubah CMS (+1 bonus)</a></li>
<li><a href="../id449922/index.html">Test drive nanoCAD SPDS Metalwork 1.2. Bagian 3</a></li>
<li><a href="../id449926/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 362 (22 - 28 April 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>