<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤩 👨🏿‍🎓 🤱 Création de Discord - bot sur .NET Core avec déploiement sur serveur VPS 👲🏼 🔥 🤟🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Khabrovchans! 

 Aujourd'hui, vous lirez un article qui vous expliquera comment créer un bot à l'aide de C # sur .NET Core et comment l'obten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Création de Discord - bot sur .NET Core avec déploiement sur serveur VPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479180/"><img src="https://habrastorage.org/webt/4w/ke/1l/4wke1lscvblbtnjbp5xuoziadhe.jpeg"><br><br>  Bonjour, Khabrovchans! <br><br>  Aujourd'hui, vous lirez un article qui vous expliquera comment créer un bot à l'aide de C # sur .NET Core et comment l'obtenir sur un serveur distant. <br><br>  L'article consistera en un arrière-plan, une étape préparatoire, une logique d'écriture et le transfert d'un bot vers un serveur distant. <br><br>  J'espère que cet article aidera de nombreux débutants. <br><a name="habracut"></a><br><h2>  Contexte </h2><br>  Tout a commencé par une nuit d'automne sans sommeil que j'ai passée sur le serveur Discord.  Depuis que je l'ai rejoint relativement récemment, j'ai commencé à l'étudier de haut en bas.  Ayant trouvé la chaîne de texte "Jobs", je me suis intéressée, l'ai ouverte, et ai trouvé parmi les propositions qui ne m'intéressaient pas, ceci: <br><br>  <i>"Programmeur (développeur bot)</i> <i><br></i>  <i><b>Prérequis:</b></i> <i><br><br></i> <ul><li>  <i>connaissance des langages de programmation;</i> </li><li>  <i>capacité d'auto-apprentissage.</i> </li></ul> <i><br></i>  <i>Souhaits:</i> <i><br><br></i> <ul><li>  <i>capacité à comprendre le code de quelqu'un d'autre;</i> </li><li>  <i>connaissance des fonctionnalités de DISCORD.</i> </li></ul> <i><br></i>  <i><b>Tâches:</b></i> <i><br><br></i> <ul><li>  <i>développement de bots;</i> </li><li>  <i>support et maintenance du bot.</i> </li></ul> <i><br></i>  <i><b>Votre avantage:</b></i> <i><br><br></i> <ul><li>  <i>La capacité de soutenir et d'influencer le projet que vous aimez;</i> </li><li>  <i>Acquérir une expérience de travail d'équipe;</i> </li><li>  <i>Une occasion de démontrer et d'améliorer les compétences existantes. »</i> </li></ul> <i><br></i> <br>  Cela m'a immédiatement intéressé.  Oui, ils n’ont pas payé pour ce travail, mais ils n’ont exigé aucune obligation de votre part, et cela ne sera pas superflu dans le portefeuille.  J'ai donc écrit l'administrateur du serveur, et il m'a demandé d'écrire un bot qui affichera les statistiques des joueurs dans World of Tanks. <br><br><h2>  Phase préparatoire </h2><br><img src="https://habrastorage.org/webt/vq/ff/5x/vqff5x8bux4bpoyns8pqaemchyk.jpeg"><br>  <b>Discrod</b> <br>  Avant de commencer à écrire notre bot, vous devez le créer pour Discord.  Vous devez: <br><br><ol><li>  Connectez-vous au compte Discord <a href="https://discordapp.com/developers/applications/">à</a> </li><li>  Dans l'onglet «Applications», cliquez sur le bouton «Nouvelle application» et nommez le bot </li><li>  Obtenez le jeton de bot en vous connectant à votre bot et en trouvant l'onglet "Bot" dans la liste "Paramètres" </li><li>  Enregistrer le jeton quelque part </li></ol><br>  <b>Wargaming</b> <br><br>  Vous devez également créer une application dans Wargaming pour accéder à l'API Wargaming.  Ici aussi, tout est simple: <br><br><ol><li>  Nous allons sur le compte Wargaming <a href="https://developers.wargaming.net/">à ce lien</a> </li><li>  Allez dans «Mes applications» et cliquez sur le bouton «Ajouter une nouvelle application», en donnant le nom de l'application et en sélectionnant son type </li><li>  Enregistrer l'ID d'application </li></ol><br>  <b>Logiciels</b> <br><br>  Il y a déjà une liberté de choix.  Quelqu'un utilise Visual Studio, quelqu'un Rider, quelqu'un est généralement puissant et écrit du code dans Vim (encore, les vrais programmeurs n'utilisent que le clavier, non?).  Cependant, afin de ne pas implémenter l'API Discord, vous pouvez utiliser la bibliothèque C # non officielle «DSharpPlus».  Il peut être installé à partir de NuGet ou en collectant vous-même la source du référentiel. <br><br><div class="spoiler">  <b class="spoiler_title">Pour ceux qui ne savent pas ou ont oublié comment installer des applications à partir de NuGet.</b> <div class="spoiler_text">  <b>Instructions pour Visual Studio</b> <br><br><ol><li>  Accédez à l'onglet Projet - NuGet Package Management; </li><li>  Cliquez sur la revue et entrez «DSharpPlus» dans le champ de recherche; </li><li>  Nous sélectionnons et installons le framework; </li><li>  PROFIT! </li></ol><br></div></div><br>  La phase préparatoire est terminée, vous pouvez procéder à la rédaction du bot. <br><br><h2>  Logique d'orthographe </h2><br><img src="https://habrastorage.org/webt/zp/3o/ul/zp3oulxjmfdxgw3mxatiw6eqq1u.png"><br><br>  Nous ne considérerons pas toute la logique de l'application, je montrerai seulement comment travailler avec l'interception de messages par le bot, et comment travailler avec l'API Wargaming. <br><br>  Le travail avec le bot Discord s'effectue via la fonction async statique Task MainTask (string [] args); <br>  Pour appeler cette fonction, dans Main il faut s'inscrire <br><br><pre><code class="plaintext hljs">MainTask(args).ConfigureAwait(false).GetAwaiter().GetResult();</code> </pre> <br>  Ensuite, vous devez initialiser votre bot: <br><br><pre> <code class="cs hljs">discord = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DiscordClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DiscordConfiguration { Token = token, TokenType = TokenType.Bot, UseInternalLogHandler = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, LogLevel = LogLevel.Debug });</code> </pre> <br>  Où le jeton est le jeton de votre bot. <br>  Ensuite, à travers le lambda, nous écrivons les commandes nécessaires que le bot devrait exécuter: <br><pre> <code class="cs hljs">discord.MessageCreated += <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> e =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> message = e.Message.Content; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message.StartsWith(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> e.Message.RespondAsync(“Hello, ” + e.Author.Username); } };</code> </pre><br>  Où e.Author.Username - obtenir le surnom de l'utilisateur. <br><br>  Ainsi, lorsque vous envoyez un message commençant par &amp;, le bot vous accueille. <br><br>  À la fin de cette fonction, vous devez vous enregistrer en attendant discord.ConnectAsync ();  et attendre Task.Delay (-1); <br><br>  Cela vous permettra d'exécuter des commandes en arrière-plan sans occuper le thread principal. <br><br>  Vous devez maintenant gérer l'API Wargaming.  Tout est simple ici - écrivez des requêtes CURL, obtenez la réponse sous la forme de chaînes JSON, extrayez les données nécessaires à partir de là et faites des manipulations dessus. <br><br><div class="spoiler">  <b class="spoiler_title">Un exemple de travail avec WargamingAPI</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Player </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindPlayer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> searchNickname</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//https://api.worldoftanks.ru/wot/account/list/?application_id=y0ur_a@@_id_h3r3search=nickname urlRequest = resourceMan.GetString("url_find_player") + appID + "&amp;search=" + searchNickname; Player player = null; string resultResponse = GetResponse(urlRequest); dynamic parsed = JsonConvert.DeserializeObject(resultResponse); string status = parsed.status; if (status == "ok") { int count = parsed.meta.count; if (count &gt; 0) { player = new Player { Nickname = parsed.data[0].nickname, Id = parsed.data[0].account_id }; } else { throw new PlayerNotFound("  "); } } else { string error = parsed.error.message; if (error == "NOT_ENOUGH_SEARCH_LENGTH") { throw new PlayerNotFound("   "); } else if (error == "INVALID_SEARCH") { throw new PlayerNotFound(" "); } else if (error == "SEARCH_NOT_SPECIFIED") { throw new PlayerNotFound(" "); } else { throw new Exception("Something went wrong."); } } return player; }</span></span></code> </pre><br></div></div><br>  Attention!  Il est strictement déconseillé de stocker tous les jetons et les ID d'application en texte clair!  Au minimum - Discord interdit ces jetons lorsqu'ils arrivent sur le réseau mondial, au maximum - le bot commence à utiliser des cybercriminels. <br><br><h2>  Déployer sur un serveur VPS </h2><br><img src="https://habrastorage.org/webt/yq/k3/6g/yqk36gjlwxnrbo_ssc422vejtyi.jpeg"><br><br>  Une fois que vous avez terminé avec le bot, vous devez le placer sur un serveur qui fonctionne constamment 24/7.  Cela est dû au fait que lorsque votre application fonctionne, le bot fonctionne également.  Dès que vous désactivez l'application, votre bot s'endort. <br><br>  De nombreux serveurs VPS existent dans ce monde, à la fois sur Windows et Linux, mais dans la plupart des cas, Linux est plusieurs fois moins cher à héberger. <br><br>  Sur le serveur Discord, j'ai été conseillé par vscale.io, et j'ai immédiatement créé un serveur virtuel sur Ubuntu et téléchargé le bot.  Je ne décrirai pas comment ce site fonctionne, mais je procéderai immédiatement aux paramètres du bot. <br><br>  Tout d'abord, vous devez installer le logiciel nécessaire qui exécutera notre bot écrit en .NET Core.  <a href="https://docs.microsoft.com/ru-ru/dotnet/core/install/linux-package-manager-ubuntu-1804">La procédure à suivre est décrite ici</a> . <br><br>  Ensuite, vous devez télécharger le bot sur le service Git, comme GitHub et similaires, et le cloner sur le serveur VPS, ou, d'une autre manière, télécharger votre bot.  Notez que vous n'aurez qu'une console, il n'y aura pas d'interface graphique.  Absolument. <br><br>  Après avoir téléchargé votre bot, vous devez l'exécuter.  Pour ce faire, vous devez: <br><br><ul><li>  Restaurer toutes les dépendances: restauration dotnet </li><li>  Build Application: dotnet build name_project.sln -c Release </li><li>  Accédez à la DLL intégrée; </li><li>  dotnet name_of_file.dll </li></ul><br>  Félicitations!  Votre bot fonctionne.  Cependant, le bot occupe malheureusement la console et il ne sera pas facile de quitter le serveur VPS.  De plus, en cas de redémarrage du serveur, vous devrez redémarrer le bot.  Il y a deux façons de sortir de la situation.  Tous sont liés au démarrage au démarrage du serveur: <br><br><ul><li>  Ajouter un script exécuté à /etc/init.d </li><li>  Créez un service qui démarrera au démarrage. </li></ul><br>  Je ne vois pas l'intérêt de les détailler, tout est décrit de manière suffisamment détaillée sur Internet. <br><br><h2>  Conclusions </h2><br>  Je suis heureux d'avoir accepté cette mission.  Ce fut ma première expérience de développement de bot, et je suis heureux d'avoir acquis de nouvelles connaissances en C # et de travailler avec Linux. <br><br>  Lien vers Discord - serveur.  <a href="https://discord.gg/yprre9">Pour ceux qui jouent aux jeux Wargaming.</a> <br>  <a href="https://github.com/hunterlan/WargamingStatistics">Lien vers le référentiel où se trouve le bot Discord.</a> <br>  <a href="https://github.com/DSharpPlus/DSharpPlus">Lien vers le référentiel DSharpPlus.</a> <br>  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479180/">https://habr.com/ru/post/fr479180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479166/index.html">Écrire votre module d'expiration plafonné pour tarantool</a></li>
<li><a href="../fr479168/index.html">Comment créer une API RESTful sur la plate-forme Symfony 5 + API pour un projet MODX</a></li>
<li><a href="../fr479170/index.html">Lecture de fin de semaine: résumé audio des services de streaming et de l'industrie musicale</a></li>
<li><a href="../fr479176/index.html">Modders a passé 15 ans à réparer les Chevaliers de l'Ancienne République 2</a></li>
<li><a href="../fr479178/index.html">Dénonymisation des transactions de jeux de données elliptiques</a></li>
<li><a href="../fr479182/index.html">La pratique de la préparation de mots étrangers avec voix agissant pour la mémorisation dans le programme Anki</a></li>
<li><a href="../fr479184/index.html">Résolution de problèmes avec pwnable.kr 26 - ascii_easy. Nous traitons les gadgets ROP à partir de zéro une fois pour toutes</a></li>
<li><a href="../fr479186/index.html">Sur la structure du calcul parallèle ou les arguments contre l'opérateur «Go»</a></li>
<li><a href="../fr479188/index.html">La somme de tous les nombres naturels: 1 + 2 + 3 + 4 + .... 2e partie</a></li>
<li><a href="../fr479192/index.html">Hyperviseur de stéroïdes: FreeBSD + ZFS + cbsd</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>