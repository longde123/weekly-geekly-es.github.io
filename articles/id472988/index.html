<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👐🏿 👨🏽‍💻 🍸 Kami menganalisis nada suara dari teks menggunakan Fast.ai 👩🏽‍🤝‍👩🏻 👨‍🔬 😧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan membahas klasifikasi nada suara dari pesan teks dalam bahasa Rusia (dan pada dasarnya setiap klasifikasi teks menggunakan teknologi y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami menganalisis nada suara dari teks menggunakan Fast.ai</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472988/">  Artikel ini akan membahas klasifikasi nada suara dari pesan teks dalam bahasa Rusia (dan pada dasarnya setiap klasifikasi teks menggunakan teknologi yang sama).  Kami akan mengambil artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> sebagai dasar, di mana klasifikasi nada suara pada arsitektur CNN menggunakan model Word2vec dipertimbangkan.  Dalam contoh kami, kami akan memecahkan masalah yang sama dengan memisahkan tweet menjadi positif dan negatif pada dataset yang sama menggunakan model <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ULMFit</a> .  Hasil dari artikel (rata-rata skor F1 = 0,78142) akan diterima sebagai garis dasar. <a name="habracut"></a><br><br><h4>  Pendahuluan </h4><br>  Model ULMFIT diperkenalkan oleh pengembang fast.ai (Jeremy Howard, Sebastian Ruder) pada tahun 2018.  Inti dari pendekatan ini adalah menggunakan pembelajaran transfer dalam tugas-tugas NLP ketika Anda menggunakan model pra-terlatih, mengurangi waktu untuk melatih model Anda dan mengurangi persyaratan untuk ukuran sampel uji berlabel. <br><br>  Skema pelatihan dalam kasus kami akan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/qx/pm/yh/qxpmyh8a6woo8qw72dvgzbqjiec.png"><br><br>  Arti model bahasa adalah untuk dapat memprediksi kata berikutnya secara berurutan.  Memang bermasalah untuk mendapatkan teks yang lama terhubung dengan cara ini, namun demikian, model bahasa dapat menangkap sifat-sifat bahasa, memahami konteks penggunaan kata-kata, oleh karena itu model bahasa (dan bukan, misalnya tampilan vektor kata-kata) yang merupakan dasar teknologi.  Untuk tugas pemodelan bahasa, ULMFit menggunakan arsitektur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AWD-LSTM</a> , yang melibatkan penggunaan aktif dropout sedapat mungkin dan masuk akal.  Jenis pelatihan model bahasa kadang-kadang disebut pembelajaran semi-diawasi, karena label di sini adalah kata berikutnya dan Anda tidak perlu menandai apa pun dengan tangan Anda. <br><br>  Sebagai model bahasa pra-terlatih, kami akan menggunakan hampir satu-satunya yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia untuk</a> umum. <br>  Mari kita telusuri algoritma pembelajaran dari awal. <br><br>  Kami memuat perpustakaan (kami memeriksa versi Fast.ai jika ada ketidaksesuaian): <br><br><pre><code class="python hljs">%load_ext autoreload %autoreload <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> statistics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fastai print(<span class="hljs-string"><span class="hljs-string">'fast.ai version is:'</span></span>, fastai.__version__) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fastai <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fastai.text <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split path = <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fast.ai</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function">: 1.0.58</span></span></code> </pre> <br><h4>  Kami menyiapkan data untuk pelatihan </h4><br>  Dengan analogi, kami akan melakukan pelatihan tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">teks singkat RuTweetCorp oleh Yulia Rubtsova</a> , yang dibentuk berdasarkan pesan-pesan berbahasa Rusia dari Twitter.  Tubuh berisi 114.991 tweet positif dan 111.923 tweet negatif dalam format CSV.  Selain itu, ada database tweet yang tidak terisi dengan volume 17 639 674 catatan dalam format SQL.  Tugas classifier kami adalah menentukan apakah tweet itu positif atau negatif. <br><br>  Karena <s>itu adalah waktu yang lama untuk melatih kembali model bahasa pada 17 juta tweet dan</s> tugas menunjukkan pembelajaran transfer adalah <s>kemalasan</s> , kami akan melatih model bahasa pada selembar teks dari set data pelatihan, sama sekali mengabaikan basis tweet yang tidak terisi.  Mungkin, dengan menggunakan basis ini untuk "mengasah" model bahasa, Anda dapat meningkatkan hasil keseluruhan. <br><br>  Kami membentuk kumpulan data untuk pelatihan dan pengujian dengan pengolah kata pendahuluan.  Kami mengambil kode dari artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">asli</a> : <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   n = ['id', 'date', 'name', 'text', 'typr', 'rep', 'rtw', 'faw', 'stcount', 'foll', 'frien', 'listcount'] data_positive = pd.read_csv('data/positive.csv', sep=';', error_bad_lines=False, names=n, usecols=['text']) data_negative = pd.read_csv('data/negative.csv', sep=';', error_bad_lines=False, names=n, usecols=['text']) #    sample_size = min(data_positive.shape[0], data_negative.shape[0]) raw_data = np.concatenate((data_positive['text'].values[:sample_size], data_negative['text'].values[:sample_size]), axis=0) labels = [1] * sample_size + [0] * sample_size</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preprocess_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> text = text.lower().replace(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) text = re.sub(<span class="hljs-string"><span class="hljs-string">'((www\.[^\s]+)|(https?://[^\s]+))'</span></span>, <span class="hljs-string"><span class="hljs-string">'URL'</span></span>, text) text = re.sub(<span class="hljs-string"><span class="hljs-string">'@[^\s]+'</span></span>, <span class="hljs-string"><span class="hljs-string">'USER'</span></span>, text) text = re.sub(<span class="hljs-string"><span class="hljs-string">'[^a-zA-Z--1-9]+'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, text) text = re.sub(<span class="hljs-string"><span class="hljs-string">' +'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text.strip() data = [preprocess_text(t) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> raw_data]</code> </pre> <br><pre> <code class="python hljs">df_train=pd.DataFrame(columns=[<span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'Label'</span></span>]) df_test=pd.DataFrame(columns=[<span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'Label'</span></span>]) df_train[<span class="hljs-string"><span class="hljs-string">'Text'</span></span>], df_test[<span class="hljs-string"><span class="hljs-string">'Text'</span></span>], df_train[<span class="hljs-string"><span class="hljs-string">'Label'</span></span>], df_test[<span class="hljs-string"><span class="hljs-string">'Label'</span></span>] = train_test_split(data, labels, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><pre> <code class="python hljs">df_val=pd.DataFrame(columns=[<span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'Label'</span></span>]) df_train, df_val = train_test_split(df_train, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Kami melihat apa yang terjadi: <br><br><pre> <code class="python hljs">df_train.groupby(<span class="hljs-string"><span class="hljs-string">'Label'</span></span>).count()</code> </pre> <br><img src="https://habrastorage.org/webt/52/mj/2h/52mj2hhy5_l76e3ac5-wqedflw8.png"><br><br><pre> <code class="python hljs">df_val.groupby(<span class="hljs-string"><span class="hljs-string">'Label'</span></span>).count()</code> </pre> <br><img src="https://habrastorage.org/webt/wh/ub/cb/whubcbjiw1lqkzdw9-r_xiet1gk.png"><br><br><pre> <code class="python hljs">df_test.groupby(<span class="hljs-string"><span class="hljs-string">'Label'</span></span>).count()</code> </pre> <br><img src="https://habrastorage.org/webt/kn/4i/ps/kn4ipsrgguvkzr8lrwc5pwcyti0.png"><br><br><h4>  Belajar model bahasa </h4><br>  Memuat data: <br><br><pre> <code class="python hljs">tokenizer=Tokenizer(lang=<span class="hljs-string"><span class="hljs-string">'xx'</span></span>) data_lm = TextLMDataBunch.from_df(path, tokenizer=tokenizer, bs=<span class="hljs-number"><span class="hljs-number">16</span></span>, train_df=df_train, valid_df=df_val, text_cols=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Kami melihat isinya: <br><br><pre> <code class="python hljs">data_lm.show_batch()</code> </pre> <br><img src="https://habrastorage.org/webt/xc/da/fo/xcdafozibrlzriutj9jt3d4hdp0.png"><br><br>  Kami menyediakan tautan ke bobot tersimpan dari model yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sudah dilatih sebelumnya</a> dan kamus: <br><br><pre> <code class="python hljs">weights_pretrained = <span class="hljs-string"><span class="hljs-string">'ULMFit/lm_5_ep_lr2-3_5_stlr'</span></span> itos_pretrained = <span class="hljs-string"><span class="hljs-string">'ULMFit/itos'</span></span> pretained_data = (weights_pretrained, itos_pretrained)</code> </pre> <br>  Kami membuat pelajar, tetapi sebelum itu - satu kruk untuk fast.ai.  Model pra-terlatih dilatih pada versi perpustakaan yang lebih lama, jadi Anda perlu menyesuaikan jumlah node di lapisan tersembunyi dari jaringan saraf. <br><br><pre> <code class="python hljs">config = awd_lstm_lm_config.copy() config[<span class="hljs-string"><span class="hljs-string">'n_hid'</span></span>] = <span class="hljs-number"><span class="hljs-number">1150</span></span> learn_lm = language_model_learner(data_lm, AWD_LSTM, config=config, pretrained_fnames=pretained_data, drop_mult=<span class="hljs-number"><span class="hljs-number">0.3</span></span>) learn_lm.freeze()</code> </pre> <br>  Kami mencari tingkat pembelajaran yang optimal: <br><br><pre> <code class="python hljs">learn_lm.lr_find() learn_lm.recorder.plot()</code> </pre> <br><img src="https://habrastorage.org/webt/ra/zd/tu/razdtu4ybrn60knvib8mq9fgyzc.png"><br>  Kami melatih model era ke-3 (dalam model, hanya kelompok lapisan terakhir yang tidak dibekukan). <br><br><pre> <code class="python hljs">learn_lm.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1e-2</span></span>, moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/an/fb/rg/anfbrgrfrwbuwboj_zbizaqznps.png"><br>  Mencairkan model, mengajar 5 era lagi dengan tingkat belajar yang lebih rendah: <br><br><pre> <code class="python hljs">learn_lm.unfreeze() learn_lm.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1e-3</span></span>, moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/a2/qy/cl/a2qyclrnexjry_gxqecltoyctle.png"><br><br><pre> <code class="python hljs">learn_lm.save(<span class="hljs-string"><span class="hljs-string">'lm_ft'</span></span>)</code> </pre><br>  Kami mencoba membuat teks pada model yang terlatih. <br><br><pre> <code class="python hljs">learn_lm.predict(<span class="hljs-string"><span class="hljs-string">"  "</span></span>, n_words=<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out: '       '</span></span></code> </pre> <br><pre> <code class="python hljs">learn_lm.predict(<span class="hljs-string"><span class="hljs-string">",  "</span></span>, n_words=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out: ',      '</span></span></code> </pre> <br>  Kami melihat - sesuatu yang dilakukan model.  Tetapi tugas utama kami adalah klasifikasi, dan untuk solusinya kami akan mengambil encoder dari model. <br><br><pre> <code class="python hljs">learn_lm.save_encoder(<span class="hljs-string"><span class="hljs-string">'ft_enc'</span></span>)</code> </pre><br><h4>  Kami melatih penggolongnya </h4><br>  Unduh data untuk pelatihan <br><br><pre> <code class="python hljs">data_clas = TextClasDataBunch.from_df(path, vocab=data_lm.train_ds.vocab, bs=<span class="hljs-number"><span class="hljs-number">32</span></span>, train_df=df_train, valid_df=df_val, text_cols=<span class="hljs-number"><span class="hljs-number">0</span></span>, label_cols=<span class="hljs-number"><span class="hljs-number">1</span></span>, tokenizer=tokenizer)</code> </pre> <br>  Mari kita lihat data, kita melihat bahwa label berhasil dihitung (0 berarti negatif, dan 1 berarti komentar positif): <br><br><pre> <code class="python hljs">data_clas.show_batch()</code> </pre> <br><img src="https://habrastorage.org/webt/gi/vd/4v/givd4vcr8dw_kuqypq4cmlvs8yi.png"><br><br>  Buat pelajar dengan kruk yang serupa: <br><br><pre> <code class="python hljs">config = awd_lstm_clas_config.copy() config[<span class="hljs-string"><span class="hljs-string">'n_hid'</span></span>] = <span class="hljs-number"><span class="hljs-number">1150</span></span> learn = text_classifier_learner(data_clas, AWD_LSTM, config=config, drop_mult=<span class="hljs-number"><span class="hljs-number">0.5</span></span>)</code> </pre> <br>  Kami memuat encoder yang dilatih pada tahap sebelumnya dan membekukan model, kecuali untuk kelompok bobot terakhir: <br><pre> <code class="python hljs">learn.load_encoder(<span class="hljs-string"><span class="hljs-string">'ft_enc'</span></span>) learn.freeze()</code> </pre> <br>  Kami mencari tingkat pembelajaran yang optimal: <br><br><pre> <code class="python hljs">learn.lr_find() learn.recorder.plot(skip_start=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/dq/d0/by/dqd0bylpp_8mgn78zbaxrn_ssfe.png"><br>  Kami melatih model dengan pencairan lapisan secara bertahap. <br><br><pre> <code class="python hljs">learn.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2e-2</span></span>, moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/uv/zo/qg/uvzoqgzdislgxbirp3cnwu5fg4u.png"><br><br><pre> <code class="python hljs">learn.freeze_to(<span class="hljs-number"><span class="hljs-number">-2</span></span>) learn.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">3</span></span>, slice(<span class="hljs-number"><span class="hljs-number">1e-2</span></span>/(<span class="hljs-number"><span class="hljs-number">2.6</span></span>**<span class="hljs-number"><span class="hljs-number">4</span></span>),<span class="hljs-number"><span class="hljs-number">1e-2</span></span>), moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/bx/pz/xq/bxpzxqpr7d7qqs1ays0dmgl3r-w.png"><br><br><pre> <code class="python hljs">learn.freeze_to(<span class="hljs-number"><span class="hljs-number">-3</span></span>) learn.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">2</span></span>, slice(<span class="hljs-number"><span class="hljs-number">5e-3</span></span>/(<span class="hljs-number"><span class="hljs-number">2.6</span></span>**<span class="hljs-number"><span class="hljs-number">4</span></span>),<span class="hljs-number"><span class="hljs-number">5e-3</span></span>), moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/3b/7t/gj/3b7tgjzickijejuevvgsoy3xe6o.png"><br><br><pre> <code class="python hljs">learn.unfreeze() learn.fit_one_cycle(<span class="hljs-number"><span class="hljs-number">2</span></span>, slice(<span class="hljs-number"><span class="hljs-number">1e-3</span></span>/(<span class="hljs-number"><span class="hljs-number">2.6</span></span>**<span class="hljs-number"><span class="hljs-number">4</span></span>),<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), moms=(<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>))</code> </pre> <br><img src="https://habrastorage.org/webt/t9/6o/3k/t96o3k72yvcmzq5es58pb-tiqo4.png"><br><br><pre> <code class="python hljs">learn.save(<span class="hljs-string"><span class="hljs-string">'tweet-0801'</span></span>)</code> </pre> <br>  Kami melihat bahwa pada sampel validasi mereka mencapai akurasi = 80,1%. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Kami akan menguji</a> model pada komentar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ZlodeiBaal</a> pada artikel saya sebelumnya: <br><br><pre> <code class="python hljs">learn.predict(<span class="hljs-string"><span class="hljs-string">'        — ?'</span></span>)</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out: (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Category</span></span></span><span class="hljs-function"> 0, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tensor</span></span></span><span class="hljs-function">(0), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tensor</span></span></span><span class="hljs-function">([0.6283, 0.3717]))</span></span></code> </pre> <br>  Kami melihat bahwa model mengaitkan komentar ini dengan negatif :-) <br><br><h4>  Memeriksa model pada sampel uji </h4><br>  Tugas utama pada tahap ini adalah menguji model untuk kemampuan generalisasi.  Untuk melakukan ini, kami memvalidasi model pada dataset yang disimpan dalam DataFrame df_test, yang sampai saat itu tidak tersedia untuk model bahasa atau untuk pengklasifikasi. <br><br><pre> <code class="python hljs">data_test_clas = TextClasDataBunch.from_df(path, vocab=data_lm.train_ds.vocab, bs=<span class="hljs-number"><span class="hljs-number">32</span></span>, train_df=df_train, valid_df=df_test, text_cols=<span class="hljs-number"><span class="hljs-number">0</span></span>, label_cols=<span class="hljs-number"><span class="hljs-number">1</span></span>, tokenizer=tokenizer)</code> </pre> <br><pre> <code class="python hljs">config = awd_lstm_clas_config.copy() config[<span class="hljs-string"><span class="hljs-string">'n_hid'</span></span>] = <span class="hljs-number"><span class="hljs-number">1150</span></span> learn_test = text_classifier_learner(data_test_clas, AWD_LSTM, config=config, drop_mult=<span class="hljs-number"><span class="hljs-number">0.5</span></span>)</code> </pre> <br><pre> <code class="python hljs">learn_test.load_encoder(<span class="hljs-string"><span class="hljs-string">'ft_enc'</span></span>) learn_test.load(<span class="hljs-string"><span class="hljs-string">'tweet-0801'</span></span>)</code> </pre> <br><pre> <code class="python hljs">learn_test.validate()</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out: [0.4391682, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tensor</span></span></span><span class="hljs-function">(0.7973)]</span></span></code> </pre> <br>  Kami melihat bahwa akurasi pada sampel uji ternyata 79,7%. <br><br>  Lihatlah Confusion Matrix: <br><br><pre> <code class="python hljs">interp = ClassificationInterpretation.from_learner(learn) interp.plot_confusion_matrix()</code> </pre> <br><img src="https://habrastorage.org/webt/em/8g/3t/em8g3tjcki4tueqv-mrc9jmf3t8.png"><br><br>  Kami menghitung parameter skor precision, recall, dan f1. <br><br><pre> <code class="python hljs">neg_precision = interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] / (interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] + interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) neg_recall = interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] / (interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] + interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]) pos_precision = interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] / (interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] + interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]) pos_recall = interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] / (interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] + interp.confusion_matrix()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) neg_f1score = <span class="hljs-number"><span class="hljs-number">2</span></span> * (neg_precision * neg_recall) / (neg_precision + neg_recall) pos_f1score = <span class="hljs-number"><span class="hljs-number">2</span></span> * (pos_precision * pos_recall) / (pos_precision + pos_recall)</code> </pre> <br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">'    F1-score'</span></span>) print(<span class="hljs-string"><span class="hljs-string">' Negative {0:1.5f} {1:1.5f} {2:1.5f}'</span></span>.format(neg_precision, neg_recall, neg_f1score)) print(<span class="hljs-string"><span class="hljs-string">' Positive {0:1.5f} {1:1.5f} {2:1.5f}'</span></span>.format(pos_precision, pos_recall, pos_f1score)) print(<span class="hljs-string"><span class="hljs-string">' Average {0:1.5f} {1:1.5f} {2:1.5f}'</span></span>.format(statistics.mean([neg_precision, pos_precision]), statistics.mean([neg_recall, pos_recall]), statistics.mean([neg_f1score, pos_f1score])))</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">Out:     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F1</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">score</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Negative</span></span></span><span class="hljs-function"> 0.79989 0.80451 0.80219 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Positive</span></span></span><span class="hljs-function"> 0.80142 0.79675 0.79908 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Average</span></span></span><span class="hljs-function"> 0.80066 0.80063 0.80064</span></span></code> </pre> <br>  Hasil yang ditunjukkan dalam sampel uji rata-rata skor-F1 = 0,80064. <br><br>  Bobot model yang disimpan dapat diambil di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472988/">https://habr.com/ru/post/id472988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472972/index.html">Kami bekerja dengan cookie sebagai kelas javascript</a></li>
<li><a href="../id472978/index.html">Arduino menulis kursus untuk putranya sendiri</a></li>
<li><a href="../id472980/index.html">Celana pendek Belokamentseva</a></li>
<li><a href="../id472982/index.html">"Dengarkan untuk menemukan gangguan": rekaman audio dari mesin industri yang gagal diterbitkan</a></li>
<li><a href="../id472984/index.html">Troli truk ROS. Bagian 7. Lokalisasi robot: gmapping, AMCL, titik referensi pada peta kamar</a></li>
<li><a href="../id472994/index.html">Apa yang kita lakukan salah dengan Spring</a></li>
<li><a href="../id472996/index.html">Pentagon mengembangkan teknologi kontrol drone dengan pikiran tentara</a></li>
<li><a href="../id473000/index.html">Panduan matematika singkat untuk orang asing</a></li>
<li><a href="../id473002/index.html">Penjelasan paradoks Fermi dalam kerangka sosiologi ruang Liu Qixin</a></li>
<li><a href="../id473008/index.html">Hukum Pengembalian yang Dipercepat (Bagian 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>