<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèæ üèµÔ∏è üç® Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 3: Desbordamientos del b√∫fer: exploits y protecci√≥n, parte 2 üò∑ üë®üèª‚Äçüé§ üìπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instituto de Tecnolog√≠a de Massachusetts. Conferencia Curso # 6.858. "Seguridad de los sistemas inform√°ticos". Nikolai Zeldovich, James Mickens. A√±o 2...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 3: Desbordamientos del b√∫fer: exploits y protecci√≥n, parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418093/"><h3>  Instituto de Tecnolog√≠a de Massachusetts.  Conferencia Curso # 6.858.  "Seguridad de los sistemas inform√°ticos".  Nikolai Zeldovich, James Mickens.  A√±o 2014 </h3><br>  Computer Systems Security es un curso sobre el desarrollo e implementaci√≥n de sistemas inform√°ticos seguros.  Las conferencias cubren modelos de amenazas, ataques que comprometen la seguridad y t√©cnicas de seguridad basadas en trabajos cient√≠ficos recientes.  Los temas incluyen seguridad del sistema operativo (SO), caracter√≠sticas, gesti√≥n del flujo de informaci√≥n, seguridad del idioma, protocolos de red, seguridad de hardware y seguridad de aplicaciones web. <br><br>  Lecci√≥n 1: "Introducci√≥n: modelos de amenaza" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <br>  Lecci√≥n 2: "Control de ataques de hackers" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <br>  Lecci√≥n 3: ‚ÄúDesbordamientos del b√∫fer: exploits y protecci√≥n‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <a name="habracut"></a><br><br>  Curiosamente, un atacante no puede saltar a una direcci√≥n espec√≠fica, a pesar del hecho de que usamos principalmente direcciones codificadas.  Lo que hace se llama un "ataque de mont√≥n", y si eres una mala persona, ser√° muy divertido para ti.  Con tal ataque, un hacker comienza a asignar din√°micamente toneladas de c√≥digo shell y simplemente lo ingresa aleatoriamente en la memoria.  Esto es especialmente efectivo si usa lenguajes din√°micamente de alto nivel como JavaScript.  Por lo tanto, el lector de etiquetas est√° en un bucle estrecho y simplemente genera una gran cantidad de l√≠neas de c√≥digo de shell y luego llena un mont√≥n de ellas. <br><br>  El atacante no puede determinar la ubicaci√≥n exacta de las l√≠neas, simplemente selecciona l√≠neas de c√≥digo de shell de 10 MB y realiza un salto arbitrario.  Y si de alguna manera puede controlar uno de los punteros de <b>ret</b> , existe la posibilidad de que "aterrice" en el c√≥digo de shell. <br><br><img src="https://habrastorage.org/webt/jl/7-/8x/jl7-8xckq3eq6z_wf2_m2alslzg.jpeg"><br><br>  Puede usar un truco llamado <b>NOP slide</b> , <b>NOP sled</b> o <b>NOP ramp</b> , donde <b>NOP</b> son <b>instrucciones de no operaci√≥n</b> , o comandos vac√≠os, inactivos.  Esto significa que el flujo de ejecuci√≥n del comando del procesador "se desliza" a su destino final deseado cuando el programa va a la direcci√≥n de memoria en cualquier lugar de la diapositiva. <br><br>  Imagine que si tiene una l√≠nea de c√≥digo de shell y va a un lugar aleatorio en esa l√≠nea, esto puede no funcionar, ya que no le permite desplegar el ataque de la manera correcta. <br><br>  Pero tal vez lo que pones en el mont√≥n es b√°sicamente solo una tonelada de <b>NOP</b> , y al final, tienes un c√≥digo de shell.  Esto es bastante inteligente, porque significa que ahora puedes llegar al lugar correcto donde est√°s saltando.  Porque si saltas a uno de estos <b>NOPs</b> , simplemente sucede "boom, boom, boom, boom, boom, boom, boom", y luego entras en el c√≥digo de shell. <br><br>  Parece que a la gente se le ocurre esto, lo que probablemente veas en nuestro equipo.  Inventan algo as√≠, y ese es el problema.  Entonces, esta es otra forma de sortear algunas cosas aleatorias simplemente haciendo robusta la aleatorizaci√≥n de sus c√≥digos, si eso tiene sentido. <br><br>  Entonces, hemos discutido algunos tipos de aleatoriedad que puede usar.  Hay algunas ideas est√∫pidas que tambi√©n surgieron en las personas.  Entonces, ahora sabe que cuando desea realizar una llamada al sistema, por ejemplo, utilizando la funci√≥n <b>syscall libc</b> , b√°sicamente pasa cualquier n√∫mero √∫nico que represente la llamada al sistema que desea realizar.  Entonces, tal vez la funci√≥n <b>tenedor</b> es 7, el <b>sue√±o</b> es 8, o algo as√≠. <br><br>  Esto significa que si un atacante puede averiguar la direcci√≥n de esta instrucci√≥n <b>syscall</b> y obtenerla de alguna manera, puede sustituir el n√∫mero de llamada del sistema que desea usar directamente.  Puede imaginar que cada vez que se ejecuta el programa, en realidad crea una asignaci√≥n din√°mica de n√∫meros de <b>syscall a</b> <b>syscalls</b> v√°lidas, para complicar la captura del atacante. <br><br><img src="https://habrastorage.org/webt/nq/l6/ob/nql6obzl82-6vvdgdkt6iuhzs8g.jpeg"><br><br>  Incluso hay algunas sugerencias de vanguardia para cambiar el hardware para que el equipo contenga la clave de cifrado <b>xor</b> , que se utiliza para las funciones din√°micas <b>xor</b> .  Imagine que cada vez que compila un programa, todos los c√≥digos de instrucciones obtienen una determinada clave <b>xor</b> .  Esta clave se almacena en el registro del equipo cuando descarga inicialmente el programa, y ‚Äã‚Äãdespu√©s de eso, cada vez que ejecuta la instrucci√≥n, el equipo realiza autom√°ticamente su operaci√≥n antes de continuar con esta instrucci√≥n.  Lo bueno de este enfoque es que ahora, incluso si un atacante puede generar c√≥digo shell, no reconocer√° esta clave.  Por lo tanto, ser√° muy dif√≠cil para √©l descubrir qu√© es exactamente lo que debe guardarse en la memoria. <br><br>  <b>P√∫blico:</b> pero si puede obtener el c√≥digo, tambi√©n puede usar <b>xor</b> para volver a convertir el c√≥digo en una instrucci√≥n. <br><br>  <b>Profesor:</b> s√≠, ese es el problema can√≥nico, cierto.  Esto es algo similar a lo que sucede durante los ataques <b>BROP</b> , cuando parecemos aleatorizar la ubicaci√≥n del c√≥digo, pero el atacante puede "sentirlo" y descubrir qu√© est√° sucediendo.  Uno puede imaginar que, por ejemplo, si un atacante conoce alguna subsecuencia de c√≥digo que espera encontrar en un archivo binario, intentar√° usar la operaci√≥n <b>xor</b> para este archivo para extraer la clave. <br><br>  Esencialmente, discutimos todo tipo de ataques de aleatorizaci√≥n que quer√≠a contarles hoy.  Antes de pasar a la programaci√≥n, vale la pena discutir cu√°les de estos m√©todos de protecci√≥n se utilizan en la pr√°ctica.  Resulta que tanto <b>GCC</b> como Visual Studio incluyen el enfoque de <b>canarios de pila</b> de <b>forma predeterminada</b> .  Esta es una comunidad muy popular y muy famosa.  Si observa Linux y Windows, tambi√©n aprovechan cosas como la memoria no ejecutable y la aleatorizaci√≥n del espacio de direcciones.  Es cierto que el sistema de <b>l√≠mites holgados</b> no es tan popular entre ellos, probablemente debido al costo de la memoria, el procesador, las falsas alarmas, etc., de los que ya hemos hablado.  B√°sicamente, hemos examinado c√≥mo van a evitar las cosas el problema de desbordamiento del b√∫fer. <br><br>  Ahora hablaremos sobre <b>ROP</b> , programaci√≥n orientada hacia atr√°s.  Hoy ya te dije lo que representa en t√©rminos de aleatorizar el espacio de direcciones y evitar que los datos se ejecuten: leer, escribir y ejecutar.  Estas son en realidad cosas muy poderosas.  Porque la aleatorizaci√≥n evita la posibilidad de que un atacante entienda d√≥nde est√°n nuestras direcciones codificadas.  Y la capacidad de evitar la ejecuci√≥n de datos garantiza que incluso si coloca el c√≥digo de shell en la pila, un atacante no puede simplemente saltar y ejecutarlo. <br><br>  Todo esto parece bastante progresivo, pero los hackers est√°n constantemente desarrollando m√©todos de ataque contra tales soluciones de defensa progresivas. <br><br>  Entonces, ¬øcu√°l es la esencia de la programaci√≥n orientada hacia atr√°s? <br><br>  ¬øQu√© pasa si, en lugar de simplemente crear un nuevo c√≥digo durante un ataque, un atacante podr√≠a combinar los fragmentos de c√≥digo existentes y luego combinarlos de manera anormal?  Despu√©s de todo, sabemos que el programa contiene toneladas de dicho c√≥digo. <br><br><img src="https://habrastorage.org/webt/fd/76/08/fd7608uferkfub0zyknpa6w1vfk.jpeg"><br><br>  Entonces, afortunadamente, o desafortunadamente, todo depende de qu√© lado est√©s.  Si puede encontrar algunos fragmentos de c√≥digo interesantes y combinarlos, puede obtener algo como el lenguaje <b>Turing</b> , donde el atacante puede hacer esencialmente lo que quiera. <br><br>  Veamos un ejemplo muy simple que le parecer√° familiar al principio, pero luego se convertir√° r√°pidamente en algo loco. <br><br>  Digamos que tenemos el siguiente programa.  Entonces, tengamos alg√∫n tipo de funci√≥n y, lo cual es conveniente para el atacante, aqu√≠ est√° esta agradable funci√≥n de <b>ejecuci√≥n de shell</b> .  Entonces, esto es solo una llamada al sistema, ejecutar√° el comando <b>bin / bash</b> y finalizar√°.  A continuaci√≥n, tenemos un proceso de desbordamiento de b√∫fer can√≥nico o, lo siento, una funci√≥n que anunciar√° la creaci√≥n de un b√∫fer y luego usar√° una de estas funciones inseguras para llenar el b√∫fer con bytes. <br><br><img src="https://habrastorage.org/webt/7r/os/et/7rosetpoais8blpdvc_-7mfkg7u.jpeg"><br><br>  Entonces, sabemos que aqu√≠ el desbordamiento del b√∫fer ocurre sin problemas.  Pero lo interesante es que tenemos esta funci√≥n de <b>ejecuci√≥n de shell</b> , pero es dif√≠cil llegar a ella de manera basada en desbordamientos de b√∫fer.  ¬øC√≥mo puede un atacante invocar este comando de <b>ejecuci√≥n de shell</b> ? <br><br>  En primer lugar, el atacante puede desmontar el programa, iniciar <b>GDB</b> y averiguar la direcci√≥n de esta cosa en el archivo ejecutable.  Probablemente est√© familiarizado con estos m√©todos de trabajo de laboratorio.  Luego, durante un desbordamiento del b√∫fer, un atacante puede tomar esta direcci√≥n, ponerla en el desbordamiento del b√∫fer generado y verificar que la funci√≥n regrese al <b>shell de ejecuci√≥n</b> . <br><br>  Para que quede claro, lo dibujar√©.  Entonces, tiene una pila que se ve as√≠: en la parte inferior hay un b√∫fer desbordado, arriba hay un indicador de espacio guardado, arriba est√° la direcci√≥n de retorno de <b>prosess_msg</b> .  Abajo a la izquierda tenemos un nuevo puntero de pila que inicia la funci√≥n, encima de √©l un nuevo puntero de ruptura, luego el puntero de pila que se usar√°, y a√∫n m√°s alto es el puntero de ruptura del cuadro anterior.  Todo parece bastante familiar. <br><br><img src="https://habrastorage.org/webt/qf/ee/vg/qfeevg9_wr3ctwybpgx8acjcpeq.jpeg"><br><br>  Como dije, durante el ataque, <b>GDB se</b> us√≥ para averiguar cu√°l es la direcci√≥n del <b>shell de ejecuci√≥n</b> .  Por lo tanto, cuando el b√∫fer se desborda, simplemente podemos poner la direcci√≥n del <b>shell de ejecuci√≥n</b> aqu√≠ a la derecha.  Esta es en realidad una extensi√≥n bastante simple de lo que ya sabemos c√≥mo hacer.  Esencialmente, esto significa que si tenemos un comando que inicia el shell, y si podemos desmontar el archivo binario para averiguar d√≥nde est√° esta direcci√≥n, simplemente podemos ponerlo en esta matriz de desbordamiento ubicada en la parte inferior de la pila.  Es bastante simple <br><br>  Entonces, este fue un ejemplo extremadamente fr√≠volo, porque el programador, por alguna loca raz√≥n, puso esta funci√≥n aqu√≠, presentando as√≠ al atacante un verdadero regalo. <br>  Ahora suponga que en lugar de llamar a esto <b>run_shell</b> , lo llamaremos <b>run_boring</b> , y luego simplemente ejecuta el <b>comando / bin / ls</b> .  Sin embargo, no perdimos nada, porque tendremos la cadena <b>char * bash_path en la parte superior</b> , que nos indicar√° la ruta a este <b>bin / bash</b> . <br><br><img src="https://habrastorage.org/webt/1d/u1/a2/1du1a2wtfwbzgtyul4bknzikpti.jpeg"><br><br>  Entonces, lo m√°s interesante de esto es que un atacante que quiere ejecutar <b>ls</b> puede "analizar" el programa y encontrar la ubicaci√≥n de <b>run_boring</b> , y esto no es nada divertido.  Pero, de hecho, tenemos una l√≠nea en la memoria que apunta a la ruta del shell, adem√°s, sabemos algo m√°s interesante.  Esto es que incluso si el programa no llama al sistema con el argumento <b>/ bin / ls</b> , todav√≠a hace alg√∫n tipo de llamada. <br><br>  Entonces, sabemos que el sistema debe estar conectado de alguna manera con este programa - <b>sistema ("/ bin / ls")</b> .  Por lo tanto, podemos usar estas dos operaciones <b>nulas</b> para asociar realmente el sistema con este <b>argumento char * bash_path</b> .  Lo primero que hacemos es ir a <b>GDB</b> y descubrir d√≥nde se encuentra este <b>sistema ("/ bin / ls")</b> en la imagen del proceso binario.  Entonces, simplemente vaya a <b>GDB</b> , simplemente escriba <b>print_system</b> y obtenga informaci√≥n sobre su desplazamiento.  Esto es bastante simple, y puede hacer lo mismo para <b>bash_path</b> .  Es decir, simplemente usa <b>GDB</b> para averiguar d√≥nde vive esta cosa. <br><br>  Una vez que lo haya hecho, debe hacer otra cosa.  Porque ahora realmente necesitamos descubrir de alguna manera c√≥mo invocar el sistema usando el argumento que elegimos.  Y la forma en que hacemos esto consiste esencialmente en falsificar el marco de llamada para el sistema.  Si recuerda, un marco es lo que usan tanto el compilador como el hardware para implementar la llamada de pila. <br><br>  Queremos organizar en la pila algo como lo que describ√≠ en esta figura.  De hecho, vamos a falsificar un sistema que deber√≠a haber estado en la pila, pero justo antes de que realmente ejecute su c√≥digo. <br><br>  Entonces, aqu√≠ tenemos el argumento del sistema, esta es la l√≠nea que queremos ejecutar.  En la parte inferior tenemos una l√≠nea donde el sistema deber√≠a regresar cuando se complete la l√≠nea con el argumento.  El sistema espera que la pila se vea de esa manera justo antes de que comience la ejecuci√≥n. <br><br><img src="https://habrastorage.org/webt/7r/ik/vp/7rikvpe59gsq0xdlubuhbew1juu.jpeg"><br><br>  Sol√≠amos suponer que no hay argumentos cuando pasa la funci√≥n, pero ahora se ve un poco diferente.  Solo necesitamos asegurarnos de que el <b>argumento</b> est√© en el c√≥digo de desbordamiento que estamos creando.  Solo tenemos que asegurarnos de que este <b>marco de llamada</b> falso est√© en esta matriz.  Por lo tanto, nuestro trabajo ser√° el siguiente.  Recuerde que el desbordamiento de la pila va de abajo hacia arriba. <br><br><img src="https://habrastorage.org/webt/kh/by/g7/khbyg7us4ir4ydv6ossc2-bbnd0.jpeg"><br><br>  Primero, vamos a poner la direcci√≥n del sistema aqu√≠.  Y encima <b>colocaremos</b> alguna <b>direcci√≥n de devoluci√≥n de basura</b> .  Este es el lugar donde el sistema volver√° una vez que finalice.  Esta direcci√≥n ser√° un conjunto aleatorio de bytes.  Encima pondremos la direcci√≥n <b>bash_path</b> .  ¬øQu√© sucede cuando el b√∫fer se desborda ahora? <br><br>  Despu√©s de que <b>prosess_msg</b> llegue a la l√≠nea de meta, dir√°: "OK, ¬°este es el lugar al que deber√≠a regresar"!  El c√≥digo del sistema contin√∫a ejecut√°ndose, se mueve m√°s alto y ve el marco de llamada falso que creamos.  Para el sistema, no ocurrir√° nada sorprendente, dir√°: "s√≠, aqu√≠ est√°, el argumento que quiero ejecutar es <b>bin / bash</b> ", lo ejecuta y est√° listo: ¬°el atacante ha capturado el shell! <br><br>  ¬øQu√© hemos hecho ahora?  Aprovechamos el conocimiento de la <b>convenci√≥n de llamadas</b> , la <b>convenci√≥n de llamadas</b> , como una plataforma para crear marcos de pila falsos o nombres de marcos falsos, dir√≠a yo.  Usando estos <b>marcos de llamada</b> falsos, podemos realizar cualquier funci√≥n a la que se haga referencia y que ya est√© definida por la aplicaci√≥n. <br><br>  La siguiente pregunta que debemos hacernos es: ¬øqu√© sucede si el programa no tiene esta l√≠nea <b>char * bash_path</b> ?  Observo que esta l√≠nea casi siempre est√° presente en el programa.  Sin embargo, supongamos que vivimos en un mundo invertido, y todav√≠a no est√° all√≠.  Entonces, ¬øqu√© podr√≠amos hacer para poner esta l√≠nea en un programa? <br><br>  Lo primero que puede hacer para esto es especificar la direcci√≥n correcta para <b>bash_path</b> , coloc√°ndola m√°s arriba, aqu√≠ en este compartimento de nuestra pila, insertando all√≠ tres elementos, cada uno de los cuales tiene un tama√±o de 4 bytes: <br><br>  <b>/ 0</b> <b><br></b>  <b>/ pat</b> <b><br></b>  <b>/ bin</b> <br><br><img src="https://habrastorage.org/webt/7y/ko/bo/7ykobou1yi5jzfppu2w0ok6b0zs.jpeg"><br><br>  Pero en cualquier caso, nuestro puntero viene aqu√≠ y ... ¬°boom!  - La cosa est√° hecha.  De esa manera, ahora puede invocar argumentos simplemente coloc√°ndolos en su c√≥digo de shell.  Aterrador, ¬øno es as√≠?  Y todo esto se construye antes de un ataque <b>BROP</b> completo.  Pero antes de se√±alar un ataque <b>BROP</b> completo, debe comprender c√≥mo simplemente encadena las cosas que ya est√°n dentro del c√≥digo.  Cuando tengo esta direcci√≥n de retorno volcada aqu√≠, solo queremos acceder al shell.  Pero si eres un atacante, entonces podr√≠as dirigir esta direcci√≥n de retorno, o direcci√≥n de retorno, a algo que realmente podr√≠a usarse.  Y si hiciste esto, entonces podr√≠as encadenar varias funciones en una fila, varios signos de una funci√≥n en una fila.  Esta es de hecho una opci√≥n muy poderosa. <br><br>  Porque si simplemente establecemos la direcci√≥n de retorno para el salto, entonces el programa generalmente se bloquea, lo que tal vez no queremos.  Por lo tanto, vale la pena vincular algunas de estas cosas para hacer cosas m√°s interesantes con el programa. <br><br>  Supongamos que nuestro objetivo es llamar al sistema un n√∫mero arbitrario de veces.  No solo queremos hacer esto una vez, lo haremos un n√∫mero arbitrario de veces.  Entonces, ¬øc√≥mo se puede hacer esto? <br><br>  Para hacer esto, usamos dos piezas de informaci√≥n que ya sabemos c√≥mo obtener.  Sabemos c√≥mo obtener la direcci√≥n del sistema; solo tiene que buscar en <b>GDB</b> y encontrarlo all√≠.  Tambi√©n sabemos c√≥mo encontrar la direcci√≥n de esta l√≠nea, <b>bin / bash</b> .  Ahora, para iniciar este ataque usando m√∫ltiples llamadas al sistema, necesitamos usar gadgets.  Esto nos acerca a lo que sucede en <b>BROP</b> . <br><br>  Entonces, lo que necesitamos ahora es encontrar la direcci√≥n de estas dos operaciones de c√≥digo: <b>pop% eax</b> y <b>ret</b> .  El primero elimina la parte superior de la pila y lo coloca en el registro <b>eax</b> , y el segundo lo coloca en el <b>puntero de</b> instrucci√≥n <b>eip</b> .  Esto es lo que llamamos el gadget.  Parece un peque√±o conjunto de instrucciones de ensamblaje que un atacante puede usar para construir ataques m√°s ambiciosos. <br><br><img src="https://habrastorage.org/webt/r4/nw/c6/r4nwc61pbprp8gv2gof8kxdj0uw.jpeg"><br><br>  Estos gadgets son herramientas est√°ndar que los hackers usan para encontrar cosas como archivos binarios.  Tambi√©n es f√°cil encontrar uno de estos gadgets, suponiendo que tenga una copia del binario, y no nos molest√≥ la aleatorizaci√≥n.  Estas cosas son muy f√°ciles de encontrar, as√≠ como tambi√©n es muy f√°cil encontrar la direcci√≥n del sistema, etc. <br><br>  Entonces, si tenemos uno de estos gadgets, ¬øpor qu√© podemos usarlo?  ¬°Por supuesto, hacer el mal!  Para hacer esto, puede hacer lo siguiente. <br><br>  Supongamos que cambiamos nuestra pila para que se vea as√≠, el exploit, como antes, se dirige de abajo hacia arriba.  Lo primero que hacemos es colocar la direcci√≥n del sistema aqu√≠, y encima colocamos la direcci√≥n del gadget <b>pop / ret</b> .  A√∫n m√°s alto, colocamos la direcci√≥n de <b>bash_path</b> , y luego repetimos todo: desde arriba colocamos nuevamente la direcci√≥n del sistema, la direcci√≥n del gadget <b>pop / ret</b> y la direcci√≥n de <b>bash_path</b> . <br><br><img src="https://habrastorage.org/webt/f6/ti/zh/f6tizhirkpxkzrwjeavzjc6uulc.jpeg"><br><br>  ¬øQu√© pasar√° aqu√≠ ahora?  Ser√° un poco complicado, por lo que las notas de esta conferencia est√°n disponibles en Internet, y por ahora puedes escuchar lo que est√° sucediendo aqu√≠, pero cuando entend√≠ esto por primera vez, ¬°fue como entender que Santa Claus no exist√≠a! <br><br>  Comenzaremos desde el lugar donde se encuentra la entrada de <b>entrada</b> , de regreso al sistema donde la declaraci√≥n <b>ret</b> eliminar√° el elemento de la pila usando el comando <b>pop</b> , por lo que ahora la parte superior del puntero de la pila est√° aqu√≠.  Entonces, eliminamos el elemento usando <b>pop</b> , luego devolvemos el procedimiento <b>ret</b> , que transfiere el control a la direcci√≥n de retorno seleccionada de la pila, y esta direcci√≥n de retorno se coloca all√≠ con el comando de <b>llamada</b> .  Entonces, nuevamente hacemos una llamada al sistema, y ‚Äã‚Äãeste proceso puede repetirse una y otra vez. <br><br><img src="https://habrastorage.org/webt/js/mz/oz/jsmzoz4p8_mrqlskie75rmdgcnu.jpeg"><br><br>  Est√° claro que podemos relacionar esta secuencia para realizar un n√∫mero arbitrario de cosas.  Esencialmente, el n√∫cleo obtiene lo que se llama programaci√≥n orientada hacia atr√°s.  Tenga en cuenta que no realizamos nada en esta pila.  Hicimos lo que nos permiti√≥ evitar la ejecuci√≥n de datos sin destruir nada.  Acabamos de hacer un salto inesperado para hacer lo que queremos.  En realidad es muy, muy, muy inteligente. <br><br>  Y lo interesante es que a un alto nivel hemos identificado este nuevo modelo para la inform√°tica.  ,   ,     ,       .     ,  ,    .  , -       .     ,       ,   .          ,       .         .  ,        .  ,    ,     <b>stack canaries.</b> <br><br>   ,  ¬´¬ª  ,      .  ,  ,  ¬´¬ª    <b>ret address</b>   <b>saved %ebp</b> ,    -   ,   ¬´¬ª.  ,        <b>ret</b> ,   ,       ¬´¬ª,  ,    - .    <b>stack canaries</b> . <br><br>  ,    ¬´¬ª.         ,   . ,     ¬´¬ª? <br><br> ,    ,  ,      . <br> ,   ,  ,   ¬´¬ª  ,    ¬´¬ª  ¬´¬ª. <br><br>  ,    ,  ,    ¬´¬ª     ,   ,    . <br>   ,    -  ,     ¬´¬ª         ,         .    ,   ?           ? <br>   ,       <b>fork</b>    .   , <b>fork</b>     .    ,   ,    ,      <b>fork</b> ,      ,  ,       ,       ¬´¬ª   .     ,       <b>stack canaries</b> . <br><br>       ¬´¬ª?      .  ,    ,     ,   ¬´¬ª.  ¬´¬ª    .                . <br><br><img src="https://habrastorage.org/webt/ql/h1/ol/qlh1olpcbsug9nbtozpjevlll7u.jpeg"><br><br> ,    ,     ‚Äì    ,      ¬´¬ª.         , ,      0.    ,  ¬´¬ª,      .    ,  : <br><br> ¬´,      ¬´¬ª!     ,      0.  ¬´¬ª!  1 ‚Äì  ¬´¬ª,  2 ‚Äì   . ,    2- .  ,     ,  ¬´¬ª. <br><br><img src="https://habrastorage.org/webt/tx/xp/rc/txxprcve2i3lgkwslbdrluiv-sk.jpeg"><br><br>    ,   ,      ,     . <br><br>      ¬´¬ª,   ,    ,     .     ,          ,      ¬´¬ª. <br><br> 57:10  <br><br> : <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Curso MIT "Seguridad de sistemas inform√°ticos".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecci√≥n 3: Desbordamientos del b√∫fer: exploits y protecci√≥n, Parte 3</font></font></a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xSQxaie_h1o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La versi√≥n completa del curso est√° disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  Gracias por quedarte con nosotros.  ¬øTe gustan nuestros art√≠culos?  ¬øQuieres ver m√°s materiales interesantes?  <b>Ap√≥yenos</b> haciendo un pedido o recomend√°ndolo a sus amigos, un <b>descuento del 30% para los usuarios de Habr en un an√°logo √∫nico de servidores de nivel de entrada que inventamos para usted:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">toda la verdad sobre VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de $ 20 o c√≥mo dividir el servidor?</a>  (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). <br><br>  <b>Dell R730xd 2 veces m√°s barato?</b>  ¬°Solo tenemos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV desde $ 249</a> en los Pa√≠ses Bajos y los Estados Unidos!</b>  Lea sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo construir un edificio de infraestructura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clase utilizando servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418093/">https://habr.com/ru/post/es418093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418083/index.html">Servidor simple con GraphQL en lugar de REST, implementaci√≥n en java</a></li>
<li><a href="../es418085/index.html">Usando promesas en JavaScript</a></li>
<li><a href="../es418087/index.html">El 80% de los pagos de autoservicio est√°n en riesgo</a></li>
<li><a href="../es418089/index.html">Descripci√≥n general de la fresadora CNC SolidCraft</a></li>
<li><a href="../es418091/index.html">Lista de art√≠culos y literatura sobre NAS</a></li>
<li><a href="../es418095/index.html">Acerca del dispositivo de funcionalidad de prueba incorporada en Rust (traducci√≥n)</a></li>
<li><a href="../es418099/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 3: Desbordamientos del b√∫fer: exploits y protecci√≥n, Parte 3</a></li>
<li><a href="../es418101/index.html">Etimolog√≠a de los t√©rminos de TI</a></li>
<li><a href="../es418103/index.html">El jefe de Roscosmos record√≥ su primer cohete y comparti√≥ planes para el futuro.</a></li>
<li><a href="../es418105/index.html">¬øPor qu√© abrir YouTube en Firefox o Edge puede tardar 5 veces m√°s que en Google Chrome?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>