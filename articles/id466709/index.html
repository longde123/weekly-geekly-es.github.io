<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÉ ü§∞üèΩ üß† Mengembangkan OS seperti Unix monolitik - Perpustakaan C (2) ü§¶ üé§ üôáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel sebelumnya, kami belajar cara menjalankan kernel Hello World dan menulis beberapa fungsi untuk bekerja dengan string. Sekarang saatnya u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengembangkan OS seperti Unix monolitik - Perpustakaan C (2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466709/"> Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya,</a> kami belajar cara menjalankan kernel Hello World dan menulis beberapa fungsi untuk bekerja dengan string.  Sekarang saatnya untuk memperluas pustaka C sehingga Anda dapat mengimplementasikan kprintf dan fungsi-fungsi lain yang diperlukan.  Ayo pergi! <br><a name="habracut"></a><br><h4>  Daftar isi </h4><br><ol><li>  Membangun sistem (make, gcc, gas).  Boot awal (multiboot).  Luncurkan (qemu).  Pustaka C (strcpy, memcpy, strext). </li><li>  Pustaka C (sprintf, strcpy, strcmp, strtok, va_list ...).  Membangun perpustakaan dalam mode kernel dan mode aplikasi pengguna. </li><li>  Log sistem kernel.  Memori video  Output ke terminal (kprintf, kpanic, kassert). </li><li>  Memori dinamis, tumpukan (kmalloc, kfree). </li><li>  Organisasi memori dan penanganan interupsi (GDT, IDT, PIC, syscall).  Pengecualian </li><li>  Memori virtual (direktori halaman dan tabel halaman). </li><li>  Proses  Perencana  Multitasking.  Panggilan sistem (bunuh, keluar, ps). </li><li>  Sistem file kernel (initrd), elf, dan internalnya.  Panggilan sistem (exec). </li><li>  Driver perangkat karakter.  Panggilan sistem (ioctl, fopen, fread, fwrite).  Pustaka C (fopen, fclose, fprintf, fscanf). </li><li>  Shell sebagai program lengkap untuk kernel. </li><li>  Mode perlindungan pengguna (ring3).  Segmen Status Tugas (tss). </li></ol><br><h4>  Perpustakaan C </h4><br>  Pertama, Anda perlu menerapkan tipe dengan dimensi eksplisit. <br><br>  Karena kami akan mengumpulkan di bawah satu platform, sampai definisi dan implementasi kami benar.  Ini tidak universal, tetapi itu sebabnya itu mudah dibaca dan sederhana.  Saya berpegang pada pendekatan bahwa kadang-kadang lebih baik melakukan sesuatu yang tidak universal, tetapi memenuhi persyaratan saat ini, karena sangat sulit untuk mempertahankan solusi universal. <br><br><pre><code class="plaintext hljs">typedef unsigned char u8; typedef unsigned short u16; typedef unsigned int u32; typedef unsigned char u_char; typedef unsigned short u_short; typedef unsigned int u_int; typedef unsigned int u_long;</code> </pre> <br>  Tidak ada salahnya untuk memperkenalkan tipe Boolean. <br><br><pre> <code class="plaintext hljs">#pragma once /* types */ typedef int bool; #define true 1 #define false 0 #define null 0</code> </pre><br>  Juga, beberapa makro untuk bekerja dengan byte tidak akan merugikan kita. <br><br><pre> <code class="plaintext hljs">typedef unsigned long size_t; #define HIGH_WORD(addr) ((addr &amp; 0xffff0000) &gt;&gt; 16) #define LOW_WORD(addr) ((addr &amp; 0xffff)) #define LOW_BYTE(addr) ((addr &amp; 0x00ff)) #define HIGH_BYTE(addr) ((addr &amp; 0xff00) &gt;&gt; 8)</code> </pre><br>  Makro berikut diperlukan untuk bekerja dengan sejumlah variabel argumen.  Pendekatan ini hanya berfungsi jika fungsi mengikuti konvensi pemanggilan bahasa C, di mana argumen fungsi dilewatkan melalui tumpukan mulai dari yang terakhir. <br><br><pre> <code class="plaintext hljs">typedef size_t* va_list; #define va_start(l, a) (l = (void*)((size_t)&amp;a) + sizeof(a)) #define va_end(l) (l = (void*)0) #define va_arg(l, s) (*(s*)(l++))</code> </pre><br>  Tentu saja, orang bisa pergi ke arah lain.  Alih-alih mendefinisikan fungsi Anda sendiri, coba gunakan perpustakaan bawaan dan ganti fungsi yang akan mengakses kernel melalui LD_PRELOAD.  Tapi saya suka mengontrol proses sepenuhnya, jadi mari kita tinggalkan opsi ini sebagai ide bagi mereka yang mulai menulis OS mereka di tutorial ini. <br><br>  Selanjutnya, dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tutorial video,</a> kami akan mempertimbangkan implementasi fungsi pustaka berikut.  Implementasinya tidak mengklaim sebagai optimalitas dan kelengkapan, tetapi saya pikir itu mengklaim kesederhanaan dan keterbacaan.  Saya hanya mencatat bahwa kita menggunakan implementasi fungsi strtok yang aman, yang disebut strtok_r.  Dan kami menemukan fungsi strinv dan strext dalam pelajaran terakhir.  Jika Anda terbiasa dengan C, saya pikir Anda akan terbiasa dengan hampir semua fungsi yang tercantum di bawah ini. <br><br><pre> <code class="plaintext hljs">extern int strlen(const char* s); extern char* strcpy(char* s1, const char* s2); extern char* strncpy(char* s1, const char* s2, u_int n); extern void* memcpy(void* buf1, const void* buf2, u_int bytes); extern void* memset(void* buf1, u8 value, u_int bytes); extern int strcmp(const char* s1, const char* s2); extern int strncmp(const char* s1, const char* s2, u_int n); extern char* strcat(char* s1, const char* s2); extern char* strext(char* buf, const char* str, char sym); extern int strspn(char* str, const char* accept); extern int strcspn(char* str, const char* rejected); char* strchr(const char* str, char ch); extern char* strtok_r(char* str, const char* delims, char** save_ptr); extern char* memext(void* buff_dst, u_int n, const void* buff_src, char sym); extern char* itoa(unsigned int value, char* str, unsigned int base); extern unsigned int atou(char* str); extern char* strinv(char* str); extern unsigned int sprintf(char* s1, const char* s2, ...); extern unsigned int snprintf(char* s1, u_int n, const char* s2, ...); extern unsigned int vsprintf(char* s1, const char* s2, va_list list); extern unsigned int vsnprintf(char* s1, unsigned int n, const char* s2, va_list list);</code> </pre><br>  Rutinitas selesai dengan.  Akhir kode boilerplate.  Pelajaran selanjutnya akan jauh lebih rumit dan menarik.  Jika Anda ingin mensponsori suatu proyek, Anda dapat menawarkan implementasi fungsi perpustakaan yang optimal. <br><br><h4>  Referensi </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengembangkan OS Seperti Unix-Monolitik - Memulai</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video tutorial untuk artikel ini</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode sumber (Anda membutuhkan cabang lesson2)</a> <br><br><h4>  Referensi </h4><br><ol><li>  James Molloy.  Gulung mainan Anda sendiri UNIX-clone OS. </li><li>  Zubkov.  Assembler untuk DOS, Windows, Unix </li><li>  Kalashnikov.  Assembler mudah! </li><li>  Tanenbaum.  Sistem operasi.  Implementasi dan pengembangan. </li><li>  Robert Love.  Kernel Linux  Deskripsi proses pengembangan. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id466709/">https://habr.com/ru/post/id466709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id466693/index.html">Jika Anda masuk bukan di IT</a></li>
<li><a href="../id466697/index.html">Monad di Erlang</a></li>
<li><a href="../id466699/index.html">Menjinakkan protokol kepercayaan - OAuth otentikasi dengan InterSystems IRIS</a></li>
<li><a href="../id466701/index.html">Let's Encrypt melayani hampir 30% domain</a></li>
<li><a href="../id466705/index.html">Vivaldi Beta untuk Android - Browser Asli</a></li>
<li><a href="../id466711/index.html">Kerentanan DaOffice diizinkan untuk menghapus pengguna mana pun dari jejaring sosial</a></li>
<li><a href="../id466713/index.html">Apakah mungkin dalam 1C untuk tidak mengamati teknologi komponen eksternal? Atau Bagaimana cara memberi selamat kepada kolega menggunakan 1C?</a></li>
<li><a href="../id466719/index.html">Profil kecepatan superlight: teori dan praktik. Bagian 1</a></li>
<li><a href="../id466721/index.html">[Yekaterinburg, pengumuman] java.ural.Meetup @ 3 - pengumuman laporan video mitap + Java ketiga dari java.ural.Meetup @ 2</a></li>
<li><a href="../id466723/index.html">Siaran Teks Apple - 10 September 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>