<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🌾 👁️ 🧑🏽‍🤝‍🧑🏻 Système de ventilation de la pièce basé sur «framboise» et «détecteur de CO2» 🤱🏾 🧚 🏊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La mode des maisons intelligentes a balayé tout Internet, tout le monde veut maintenant fabriquer une ampoule qui peut s'éteindre via Internet ou allu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Système de ventilation de la pièce basé sur «framboise» et «détecteur de CO2»</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dadget/blog/390859/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mode des maisons intelligentes a balayé tout Internet, tout le monde veut maintenant fabriquer une ampoule qui peut s'éteindre via Internet ou allumer un ventilateur dans les toilettes. </font><font style="vertical-align: inherit;">Mon expérience était assez simple: je voulais faire un système qui puisse ventiler automatiquement une pièce, ni plus, ni moins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir examiné le principe du système, je suis parvenu à quelques conclusions, que j'ai décidé de mettre en œuvre. </font><font style="vertical-align: inherit;">Comme prévu, l'ensemble des fonctionnalités du système est divisé en trois composants: les "cerveaux" qui contrôlent tout, le système de ventilation pour ouvrir la fenêtre / ou allumer le ventilateur, et le capteur lui-même qui surveille la qualité de l'air dans la pièce. </font><font style="vertical-align: inherit;">Ci-après, je vais parler du capteur de qualité de l'air, plus une petite touche sur le sujet de son intégration avec le "cerveau" d'une maison intelligente.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Présentation de l'appareil</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai décidé de contrôler la qualité de la «fraîcheur» de l'air par la concentration de dioxyde de carbone. Les plans futurs comprennent le lancement de capteurs pour l'ammoniac, le propane / butane (fuites de gaz), les concentrations de poussière dans l'air, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a été décidé de placer le système de ventilation dans un salon où une personne passe autant de temps que possible. Probablement, une telle pièce est une chambre à coucher, et c'est là qu'un système de ventilation automatique sera très utile pendant une nuit de sommeil. </font></font><br>
<br>
<img src="https://habrastorage.org/files/a25/543/468/a25543468c9b46439f7f570577cddd2b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est un secret pour personne que la concentration de dioxyde de carbone dans l'air affecte fortement non seulement la productivité du cerveau humain, les performances humaines, mais également la capacité de prendre un bon repos. Plus la concentration de CO2 est élevée, pire c'est.</font></font><br>
 <br>
 <img src="https://habrastorage.org/files/609/2dc/c2f/6092dcc2ff3340eea4c0727347a8f234.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le détecteur de dioxyde de carbone de la société Dadget a été utilisé comme appareil de mesure de la concentration de dioxyde de carbone. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet appareil peut être alimenté par le port USB d'un ordinateur ou d'un ordinateur portable. </font><font style="vertical-align: inherit;">Sur le panneau avant - Indicateur LCD, qui affiche des informations sur la concentration de dioxyde de carbone et la température ambiante. </font><font style="vertical-align: inherit;">Il y a également 3 LED qui donnent à l'utilisateur une représentation visuelle du contenu. </font><font style="vertical-align: inherit;">Tout est assez simple - allumez l'appareil. </font><font style="vertical-align: inherit;">Et tout fonctionne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai été attiré par le fait qu'il existe des logiciels qui fonctionnent avec cet appareil. </font><font style="vertical-align: inherit;">Il existe des logiciels pour Windows et Linux. </font><font style="vertical-align: inherit;">Le code source du programme pour Linux est sur github et semble avoir été écrit par notre compatriote. </font><font style="vertical-align: inherit;">Et si vous avez le code source, vous pouvez penser à quelque chose, le modifier, "affiner" le programme par vous-même.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Présentation du workflow</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme l'ont montré la pratique et Google, l'appareil est considéré par l'ordinateur comme un appareil HID. Par conséquent, dans le programme pour Windows, il existe une DLL appelée HIDApi. Pour travailler avec Linux, vous avez besoin de la bibliothèque HIDApi du même nom. J'ai finalisé le code source du logiciel Linux et j'ai écrit un petit cri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est clair que l'utilisation d'un ordinateur Linux pour lire les données du capteur et les transférer quelque part vers un contrôleur de maison intelligente est un blasphème. Par conséquent, il a été décidé d'utiliser Raspbery pi avec Debian pur installé. À l'avenir, il est prévu de tout faire sur Arduino et de transmettre via des canaux sans fil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma de mon complexe matériel-logiciel est le suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/files/c83/600/997/c836009971eb43578523742643ed8002.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un lecteur averti et un connaisseur passionné pourraient penser qu'il n'est pas très sportif d'utiliser HUB dans ce schéma. C'est vrai, vous pouvez directement connecter un moniteur de CO2 et profiter de la vie. En utilisant un tel schéma, je résous plusieurs problèmes à la fois: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● le plus souvent, le cerveau d'une maison intelligente n'est pas là où se trouve le capteur; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● l'utilisation de raspberry pi permet de connecter des capteurs supplémentaires; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● en plaçant le capteur séparément, nous obtenons deux méthodes d'indication, la première sur l'écran du capteur, la seconde sur le téléphone ou via une page web, puisque les données sont transmises au contrôleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un appareil MicasaVerde est utilisé comme un contrôleur domestique intelligent, l'appareil peut collecter des données à partir de capteurs et prendre des décisions en fonction d'un programme donné, qui sont appelés «scènes» dans sa terminologie.</font></font><br>
<br>
<img src="https://habrastorage.org/files/963/588/075/963588075d534090bab5100c83c1dfa7.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'appareil, vous pouvez créer des capteurs virtuels et mettre à jour leurs informations à l'aide de requêtes http, ce que j'ai fait avec Raspberry Pi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple de demande: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip_address</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3480 / data_request? Id = variableset &amp; DeviceNum = 6 &amp; serviceId = urn: micasaverde-com: serviceId: DoorLock1 &amp; Variable = Status &amp; Value = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, Malinka lit les données du détecteur de dioxyde de carbone, puis transmet la requête http de données à Vera. </font><font style="vertical-align: inherit;">Le schéma est simple mais fonctionne.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Révision du logiciel</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a donc une «framboise», quelle que soit la version, l'essentiel est qu'elle dispose d'une interface réseau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez installer la prise en charge des périphériques cachés. Cette bibliothèque provient de git, donc git doit être installé sur le "malink": </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, téléchargez et </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installez la bibliothèque de clonage mkdir hidapi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git clone</font></font><a href=""><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elle-même </font><i><a href=""><font style="vertical-align: inherit;">github.com/signal11/hidapi.git</font></a></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bibliothèques supplémentaires </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo apt-get install libudev-dev libusb-1.0-0-dev libfox-1.6-dev autotools-dev autoconf automake libtool </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./bootstrap </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./configure </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo make installer</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, téléchargez le code source du programme de surveillance du CO2 </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkdir co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git clone </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dmage/co2mon.git</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, j'ai </font><i><a href=""><font style="vertical-align: inherit;">légèrement</font></a></i><font style="vertical-align: inherit;"> modifié le code du programme, dans la version initiale, il lit deux paramètres (température et co2) et l'envoie à la console dans une boucle sans fin . Cette option ne me convenait pas, l'objectif était de l'exécuter une fois et d'obtenir la valeur une fois, j'ai donc changé deux lignes dans le main.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous recherchons des lignes </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("CntR \ t% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et changez pour </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
exit (1);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première ligne est responsable de la sortie de la valeur, après le changement, seul le chiffre sera affiché, et après la sortie, le programme se fermera, la ligne de sortie (1) répondra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compiler </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ensuite, nous avons écrit un script simple qui lance le programme, attribue les valeurs de sortie du programme compilé ci-dessus à une variable, puis transmet cette valeur en utilisant curl à MicasaVerde. Après cela, ajoutez la règle udev pour que le système ait accès au capteur sans root. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOUS-SYSTÈME == "usb", ATTR {idVendor} == "04d9", ATTR {idProduct} == "a052", MODE = "0666" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ajoutez le script d'interrogation et de transmission à cron, chaque minute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crontab -e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ajoutez la ligne </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * * * /home/pi/co2sender.sh </font></font><br>
<br>
<img src="https://habrastorage.org/files/2cb/23c/1b2/2cb23c1b202f4aa5aad89c8c70c69148.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le résultat du script</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, vous devez toujours configurer les fichiers MicasaVerde pour qu'il y ait des enregistrements adéquats partout. </font><font style="vertical-align: inherit;">Mais cela fonctionne, rapidement et facilement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous avons un système basé sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">détecteur de CO2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui fonctionne comme d'habitude, analyse et rapporte les changements de concentration de dioxyde de carbone. </font><font style="vertical-align: inherit;">En même temps, Malinka lit les données du capteur une fois par minute et les transfère au contrôleur de la maison intelligente, qui peut activer le système de ventilation si nécessaire.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr390859/">https://habr.com/ru/post/fr390859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr390845/index.html">Examen de la tablette "thermonucléaire" 8 pouces bb-mobile Topol 'LTE</a></li>
<li><a href="../fr390849/index.html">Les fonctionnaires des douanes américaines commencent à prendre la biométrie des personnes qui franchissent la frontière américaine</a></li>
<li><a href="../fr390851/index.html">Utilisation pratique de ROS sur le Raspberry Pi - Partie 3</a></li>
<li><a href="../fr390853/index.html">Le plus souvent, les managers ont tenté de voler des informations confidentielles à leur propre entreprise en 2015</a></li>
<li><a href="../fr390855/index.html">La Voie lactée a été étudiée dans la gamme submillimétrique. Projet ATLASGAL terminé</a></li>
<li><a href="../fr390863/index.html">Vidéo: diffusion de la mise à jour de la gamme Samsung Galaxy</a></li>
<li><a href="../fr390865/index.html">SpaceX reporte le lancement de SES-9 une deuxième fois (mise à jour: Lancé à partir de la 5e fois, l'atterrissage a échoué)</a></li>
<li><a href="../fr390867/index.html">Homéopathie: l'industrie du placebo d'un milliard de dollars</a></li>
<li><a href="../fr390869/index.html">ASU Cast One - Le projecteur de montre intelligente doit être mis en vente en été</a></li>
<li><a href="../fr390871/index.html">Courte critique du PC portable Asus Zenbook Pro UX501VW</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>