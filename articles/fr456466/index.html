<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèø üß° üèê G√©n√©riques PHP aujourd'hui (enfin, presque) üïµÔ∏è üï¥Ô∏è üö±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous demandez aux d√©veloppeurs PHP quel genre d'opportunit√© ils veulent voir en PHP, la plupart appellent des g√©n√©riques. 


 Un support g√©n√©rique ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>G√©n√©riques PHP aujourd'hui (enfin, presque)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456466/"><p>  Si vous demandez aux d√©veloppeurs PHP quel genre d'opportunit√© ils veulent voir en PHP, la plupart appellent des g√©n√©riques. </p><br><p>  Un support g√©n√©rique au niveau linguistique serait la meilleure solution.  Mais, les r√©aliser est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">difficile</a> .  Nous esp√©rons qu'un jour, le support natif fera partie de la langue, mais il faudra probablement plusieurs ann√©es pour attendre. </p><br><p>  Cet article montrera comment, en utilisant les outils existants, dans certains cas avec des modifications minimes, nous pouvons obtenir la puissance des g√©n√©riques en PHP d√®s maintenant. </p><a name="habracut"></a><br><blockquote>  De la part d'un traducteur: j'utilise d√©lib√©r√©ment du papier calque des "g√©n√©riques" anglais, car  Je n'ai jamais entendu dans la communication que quelqu'un l'appelait ¬´programmation g√©n√©ralis√©e¬ª. </blockquote><br><h2 id="soderzhanie">  Contenu: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quels sont les g√©n√©riques</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment impl√©menter des g√©n√©riques sans prise en charge linguistique</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Normalisation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Support d'outils</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prise en charge de code tiers</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Etapes suppl√©mentaires</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Limitations</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pourquoi ne pas simplement ajouter des g√©n√©riques √† la langue?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Et si je n'ai pas besoin de g√©n√©riques?</a> </li></ul><br><h2 id="anchorwhat-are-genericsanchorchto-takoe-dzheneriki"><a name="what-are-generics"></a>  Quels sont les g√©n√©riques </h2><br><p>  Cette section couvre une br√®ve introduction aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">g√©n√©riques</a> . </p><br><p>  Liens de lecture: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">RFC</a> pour l'ajout de g√©n√©riques PHP </li><li>  Prise en charge g√©n√©rique dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Phan</a> </li><li>  G√©n√©riques et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">mod√®les de</a> psaume </li></ul><br><h3 id="prosteyshiy-primer">  Exemple le plus simple </h3><br><p>  Puisqu'il n'est actuellement pas possible de d√©finir des g√©n√©riques au niveau de la langue, nous devrons utiliser une autre grande opportunit√© - les d√©finir dans les blocs de dock. </p><br><p>  Nous utilisons d√©j√† cette option dans de nombreux projets.  Jetez un ≈ìil √† cet exemple: </p><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string[] $names * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> User[] */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterable $names)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><p>  Dans le code ci-dessus, nous faisons ce qui est possible au niveau de la langue.  Nous avons d√©fini le param√®tre <code>$names</code> comme quelque chose qui pourrait √™tre r√©pertori√©.  Nous avons √©galement indiqu√© que la fonction retournera un tableau.  PHP <code>TypeError</code> une <code>TypeError</code> si les types de param√®tres et la valeur de retour ne correspondent pas. </p><br><p>  Docblock am√©liore la compr√©hension du code.  <code>$names</code> doivent √™tre des cha√Ænes et la fonction doit renvoyer un tableau d'objets <code>User</code> .  PHP lui-m√™me ne fait pas de telles v√©rifications.  Mais les IDE tels que PhpStorm comprennent cette notation et avertissent le d√©veloppeur que le contrat suppl√©mentaire n'a pas √©t√© respect√©.  En plus de cela, des outils d'analyse statique tels que Psaume, PHPStan et Phan peuvent valider l'exactitude des donn√©es transf√©r√©es vers et depuis la fonction. </p><br><h3 id="dzheneriki-dlya-opredeleniya-klyuchey-i-znacheniy-perechislyaemyh-tipov">  G√©n√©riques pour d√©terminer les cl√©s et les valeurs des types √©num√©r√©s </h3><br><p>  Ci-dessus est l'exemple le plus simple d'un g√©n√©rique.  Des m√©thodes plus complexes incluent la possibilit√© de sp√©cifier le type de ses cl√©s, ainsi que le type de valeurs.  Voici une fa√ßon de d√©crire cela: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array&lt;string, User&gt; */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><p>  Il indique ici que le tableau renvoy√© par <code>getUsers</code> a des cl√©s de cha√Æne et des valeurs de type <code>User</code> . </p><br><p>  Les analyseurs statiques tels que Psaume, PHPStan et Phan comprennent cette annotation et en tiennent compte lors de la v√©rification. </p><br><p>  Consid√©rez le code suivant: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array&lt;string, User&gt; */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showAge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $age)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(getUsers() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name =&gt; $user) { showAge($name); }</code> </pre> <br><p>  Les analyseurs statiques lancent un avertissement sur l'appel <code>showAge</code> avec une erreur, comme ceci: L' <code>Argument 1 of showAge expects int, string provided</code> . </p><br><p>  Malheureusement, au moment de la r√©daction, PhpStorm ne sait pas comment. </p><br><h3 id="bolee-slozhnye-dzheneriki">  G√©n√©riques plus sophistiqu√©s </h3><br><p>  Nous continuons √† approfondir le sujet des g√©n√©riques.  Consid√©rons un objet qui est une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">pile</a> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stack</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br><p>  La pile peut accepter tout type d'objet.  Mais que se passe-t-il si nous voulons restreindre la pile aux seuls objets de type <code>User</code> ? </p><br><p>  Psaume et Phan prennent en charge les annotations suivantes: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@template</span></span></span><span class="hljs-comment"> T */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stack</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> T $item */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> T */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  Le docblock est utilis√© pour transmettre des informations de type suppl√©mentaires, par exemple: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Stack&lt;User&gt; $userStack */</span></span> $stack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack(); Means that $userStack must only contain Users.</code> </pre> <br><p>  Psaume, lors de l'analyse du code suivant: </p><br><pre> <code class="php hljs">$userStack-&gt;push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User()); $userStack-&gt;push(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>);</code> </pre> <br><p>  Se plaindra de la ligne 2 avec l'erreur <code>Argument 1 of Stack::push expects User, string(hello) provided.</code> </p><br><p>  PhpStorm ne prend actuellement pas en charge cette annotation. </p><br><p>  En fait, nous n'avons couvert qu'une partie des informations sur les g√©n√©riques, mais pour le moment, cela suffit. </p><br><h2 id="anchorhow-to-implement-generics-without-language-level-supportanchorkak-vnedrit-dzheneriki-bez-podderzhki-yazyka"><a name="how-to-implement-generics-without-language-level-support"></a>  Comment impl√©menter des g√©n√©riques sans prise en charge linguistique </h2><br><p>  Vous devez effectuer les √©tapes suivantes: </p><br><ul><li>  Au niveau de la communaut√©, d√©finissez des normes g√©n√©riques dans les blocs de quai (par exemple, un nouveau PSR ou revenez au PSR-5) </li><li>  Ajoutez des annotations de dockblock √† votre code </li><li>  Utilisez des IDE qui comprennent ces conventions pour effectuer une analyse statique en temps r√©el afin de trouver des incoh√©rences. </li><li>  Utilisez des outils d'analyse statique (tels que Psaume) comme l'une des √©tapes de CI pour d√©tecter les erreurs. </li><li>  D√©finissez une m√©thode pour transmettre des informations de type √† des biblioth√®ques tierces. </li></ul><br><h2 id="anchoragreeing-on-a-standardanchorstandartizaciya"><a name="agreeing-on-a-standard"></a>  Normalisation </h2><br><p>  Pour le moment, la communaut√© PHP a adopt√© officieusement ce format g√©n√©rique (ils sont pris en charge par la plupart des outils et leur signification est claire pour la plupart): </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> User[] */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><p>  Cependant, nous avons des probl√®mes avec des exemples simples comme celui-ci: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array&lt;string, User&gt; */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><p>  Le psaume le comprend et sait de quel type est la cl√© et les valeurs du tableau retourn√©. </p><br><p>  Au moment de la r√©daction, PhpStorm ne comprend pas cela.  En utilisant cette entr√©e, je manque la puissance de l'analyse statique en temps r√©el offerte par PhpStorm. </p><br><p>  Consid√©rez le code ci-dessous.  PhpStorm ne comprend pas que <code>$user</code> est de type <code>User</code> et <code>$name</code> est de type cha√Æne: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(getUsers() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name =&gt; $user) { ... }</code> </pre> <br><p>  Si je choisis Psaume comme outil d'analyse statique, je pourrais √©crire ce qui suit: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> User[] * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@psalm</span></span></span><span class="hljs-comment">-return array&lt;string, User&gt; */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><p>  Le Psaume comprend tout cela. </p><br><p>  PhpStorm sait que la variable <code>$user</code> est de type <code>User</code> .  Mais, il ne comprend toujours pas que la cl√© du tableau fait r√©f√©rence √† une cha√Æne.  Phan et PHPStan ne comprennent pas les annotations sp√©cifiques du psaume.  Le maximum qu'ils comprennent dans ce code est le m√™me que dans PhpStorm: le type de <code>$user</code> </p><br><p>  Vous pourriez faire valoir que PhpStorm devrait simplement accepter le <code>array&lt;keyType, valueType&gt;</code> accord <code>array&lt;keyType, valueType&gt;</code> .  Je ne suis pas d'accord avec vous, car  Je crois que cette dict√©e des normes est la t√¢che de la langue et de la communaut√©, et les outils ne devraient que les suivre. </p><br><p>  Je suppose que l'accord d√©crit ci-dessus sera chaleureusement re√ßu par la plupart de la communaut√© PHP.  Celui qui s'int√©resse aux g√©n√©riques.  Cependant, les choses deviennent beaucoup plus compliqu√©es en ce qui concerne les mod√®les.  Ni PHPStan ni PhpStorm ne prennent actuellement en charge les mod√®les.  Contrairement au Psaume et √† Phan.  Leur objectif est similaire, mais si vous creusez plus profond√©ment, vous vous rendrez compte que les impl√©mentations sont l√©g√®rement diff√©rentes. </p><br><p>  Chacune des options pr√©sent√©es est une sorte de compromis. </p><br><p>  Autrement dit, il faut un accord sur le format d'enregistrement g√©n√©rique: </p><br><ul><li>  Ils am√©liorent la vie des d√©veloppeurs.  Les d√©veloppeurs peuvent ajouter des g√©n√©riques √† leur code et en b√©n√©ficier. </li><li>  Les d√©veloppeurs peuvent utiliser les outils qu'ils pr√©f√®rent et basculer entre eux (outils) si n√©cessaire. </li><li>  Les cr√©ateurs d'outils peuvent cr√©er ces m√™mes outils, en comprenant les avantages pour la communaut√© et sans craindre que quelque chose ne change ou qu'ils soient accus√©s d'une ¬´mauvaise approche¬ª. </li></ul><br><h2 id="anchortool-supportanchorpodderzhka-instrumentami"><a name="tool-support"></a>  Support d'outils </h2><br><p>  Le psaume poss√®de toutes les fonctionnalit√©s n√©cessaires pour v√©rifier les g√©n√©riques.  Phan aime aussi √ßa. </p><br><p>  Je suis s√ªr que PhpStorm introduira des g√©n√©riques d√®s que la communaut√© proposera un accord de format unique. </p><br><h2 id="anchorthird-party-code-supportanchorpodderzhka-storonnego-koda"><a name="third-party-code-support"></a>  Prise en charge de code tiers </h2><br><p>  La derni√®re partie du puzzle g√©n√©rique consiste √† ajouter la prise en charge des biblioth√®ques tierces. </p><br><p>  Avec un peu de chance, d√®s que la norme de d√©finition g√©n√©rique appara√Ætra, la plupart des biblioth√®ques l'impl√©menteront.  Cependant, cela ne se produira pas imm√©diatement.  Certaines biblioth√®ques sont utilis√©es, mais n'ont pas de support actif.  Lorsque vous utilisez des analyseurs statiques pour valider des types dans des g√©n√©riques, il est important que toutes les fonctions que ces g√©n√©riques acceptent ou retournent soient d√©finies. </p><br><p>  Que se passe-t-il si votre projet repose sur des biblioth√®ques tierces qui n'ont pas de support g√©n√©rique? </p><br><p>  Heureusement, ce probl√®me a d√©j√† √©t√© r√©solu et les fonctions de remplacement sont la solution.  Psaume, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Phan</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PhpStorm</a> prennent en charge les talons. </p><br><p>  Les stubs sont des fichiers ordinaires qui contiennent des signatures de fonctions et de m√©thodes, mais ne les impl√©mentent pas.  En ajoutant des blocs d'ancrage aux stubs, les outils d'analyse statique obtiennent les informations suppl√©mentaires dont ils ont besoin.  Par exemple, si vous avez une classe de pile sans conseils de type et g√©n√©riques comme celui-ci. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stack</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* some implementation */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* some implementation */</span></span> } }</code> </pre> <br><p>  Vous pouvez cr√©er un fichier de raccord qui a des m√©thodes identiques, mais avec l'ajout de blocs d'ancrage et sans impl√©mentation de fonctions. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@template</span></span></span><span class="hljs-comment"> T */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stack</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> T $item * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> T */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  Lorsque l'analyseur statique voit la classe de pile, il prend les informations de type du stub, pas du code r√©el. </p><br><p>  La possibilit√© de partager simplement le code des stubs (par exemple, via le compositeur) serait extr√™mement utile, car  permettrait de partager le travail accompli. </p><br><h2 id="anchornext-stepsanchordalneyshie-shagi"><a name="next-steps"></a>  Etapes suppl√©mentaires </h2><br><p>  La communaut√© doit s'√©loigner des accords et √©tablir des normes. </p><br><p>  Peut-√™tre que la meilleure option serait un PSR g√©n√©rique? </p><br><p>  Ou peut-√™tre que les cr√©ateurs des principaux analyseurs statiques, PhpStorm, d'autres IDE et toutes les personnes impliqu√©es dans le d√©veloppement de PHP (pour le contr√¥le) pourraient d√©velopper une norme que tout le monde utiliserait. </p><br><p>  D√®s que la norme appara√Ætra, tout le monde pourra aider √† l'ajout de g√©n√©riques aux biblioth√®ques et projets existants, en cr√©ant des demandes d'extraction.  Et lorsque cela n'est pas possible, les d√©veloppeurs peuvent √©crire et partager des talons. </p><br><p>  Lorsque tout est termin√©, nous pouvons utiliser des outils comme PhpStorm pour v√©rifier les g√©n√©riques en temps r√©el pendant que nous √©crivons le code.  Nous pouvons utiliser des outils d'analyse statique dans le cadre de notre CI comme garantie de s√©curit√©. </p><br><p>  Les g√©n√©riques peuvent √©galement √™tre impl√©ment√©s en PHP (enfin, presque). </p><br><h2 id="anchorlimitationsanchorogranicheniya"><a name="limitations"></a>  Limitations </h2><br><p>  Il existe un certain nombre de limitations.  PHP est un langage dynamique qui vous permet de faire beaucoup de choses "magiques", comme celles- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">ci</a> .  Si vous utilisez trop de magie PHP, il peut arriver que les analyseurs statiques ne puissent pas extraire avec pr√©cision tous les types du syst√®me.  Si certains types sont inconnus, les outils ne pourront pas utiliser correctement les g√©n√©riques dans tous les cas. </p><br><p>  Cependant, l'application principale de cette analyse est de valider votre logique m√©tier.  Si vous √©crivez du code propre, vous ne devez pas utiliser trop de magie. </p><br><h2 id="anchorwhy-dont-you-just-add-generics-to-the-languageanchorpochemu-by-vam-prosto-ne-dobavit-dzheneriki-v-yazyk"><a name="why-dont-you-just-add-generics-to-the-language"></a>  Pourquoi ne pas simplement ajouter des g√©n√©riques √† la langue? </h2><br><p>  Ce serait la meilleure option.  PHP a du code open source, et personne ne vous d√©range pour cloner les sources et impl√©menter les g√©n√©riques! </p><br><h2 id="anchorwhat-if-i-dont-want-genericsanchorchto-esli-mne-ne-nuzhny-dzheneriki"><a name="what-if-i-dont-want-generics"></a>  Et si je n'ai pas besoin de g√©n√©riques? </h2><br><p>  Ignorez simplement tout ce qui pr√©c√®de.  L'un des principaux avantages de PHP est qu'il est flexible dans le choix du niveau appropri√© de complexit√© d'impl√©mentation en fonction de ce que vous cr√©ez.  Avec un code √† usage unique, vous n'avez pas besoin de penser √† des choses comme la dactylographie.  Mais dans les grands projets, il vaut la peine d'utiliser ces opportunit√©s. </p><br><blockquote>  Merci √† tous ceux qui ont lu cet endroit.  Je serai heureux de vos commentaires dans le PM. <br><br>  <strong>UPD</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ghost404</a> dans les commentaires a not√© que <em>PHPStan de la version 0.12.x comprend les annotations de psaume et prend en charge les g√©n√©riques</em> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456466/">https://habr.com/ru/post/fr456466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456446/index.html">Ceph - de ¬´√† genoux¬ª √† ¬´production¬ª</a></li>
<li><a href="../fr456448/index.html">R√®gles pour choisir un framework JS</a></li>
<li><a href="../fr456450/index.html">DO-RA.Avia pour la surveillance du rayonnement cosmique dans l'aviation</a></li>
<li><a href="../fr456452/index.html">Exemples de code C ++ avant et apr√®s les plages</a></li>
<li><a href="../fr456462/index.html">Assemblage d'une biblioth√®que de composants angulaires en tant que composants Web</a></li>
<li><a href="../fr456470/index.html">Pi√®ges de WSUS Package Publisher</a></li>
<li><a href="../fr456472/index.html">Pr√©sentation de Go et du framework Mggo</a></li>
<li><a href="../fr456474/index.html">Tic Tac Toe Partie 0: Comparaison de Svelte et React</a></li>
<li><a href="../fr456476/index.html">Modifications de la pile Bluetooth pour am√©liorer la qualit√© audio des √©couteurs sans codecs AAC, aptX ou LDAC</a></li>
<li><a href="../fr456486/index.html">Interface et choix (2014)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>