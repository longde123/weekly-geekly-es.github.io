<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฆ ๐ ๐ฌ ุฑุฏ ูุนู ุงููุตุงุฏูุฉ ๐ฉ๐ฟโ๐คโ๐จ๐ผ ๐ฝ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุดููุฉ 


 ูุนุฏ ุงูุชุฎููู ุฃุญุฏ ุงููุดููุงุช ุงูุฃููู ุงูุชู ููุงุฌููุง ุงููุทูุฑูู ุนูุฏ ุจุฏุก ูุดุฑูุน ุฌุฏูุฏ. ูุฃุญุฏ ุฃูุซุฑ ุฃููุงุน ุงูุชุฎููู ุดููุนูุง (ูู ุชุฌุฑุจุชู) ูู ุงูุชุฎููู ุงููุณุชูุฏ ุฅูู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฑุฏ ูุนู ุงููุตุงุฏูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485764/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/v-/ss/kz/v-sskznfybocplele4iiabbdl44.png"></p><br><h2 id="problem" style=";text-align:right;direction:rtl">  ูุดููุฉ </h2><br><p style=";text-align:right;direction:rtl"> ูุนุฏ ุงูุชุฎููู ุฃุญุฏ ุงููุดููุงุช ุงูุฃููู ุงูุชู ููุงุฌููุง ุงููุทูุฑูู ุนูุฏ ุจุฏุก ูุดุฑูุน ุฌุฏูุฏ.  ูุฃุญุฏ ุฃูุซุฑ ุฃููุงุน ุงูุชุฎููู ุดููุนูุง (ูู ุชุฌุฑุจุชู) ูู ุงูุชุฎููู ุงููุณุชูุฏ ุฅูู ุงูุฑูุฒ (ุนุงุฏุฉู ูุง ูุณุชุฎุฏู JWT). </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฌูุฉ ูุธุฑู ุ ูุจุฏู ูุฐุง ุงูููุงู "ูุง ุฃุฑุฏุช ุฃู ุฃูุฑุฃู ูุจู ุฃุณุจูุนูู".  ูุงู ูุฏูู ูู ูุชุงุจุฉ ุฑูุฒ ุจุณูุท ููุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู ูุน ูุงุฌูุฉ ูุธููุฉ ููุจุงุดุฑุฉ.  ูุงู ูุฏู ุงููุชุทูุจุงุช ุงูุชุงููุฉ ูุชูููุฐ ุนููู ูุฅุฏุงุฑุฉ ุงููุตุงุฏูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุชู ุชุฎุฒูู ุงูุฑููุฒ ูู ุงูุชุฎุฒูู ุงููุญูู </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุงุณุชุนุงุฏุฉ ุงูุฑููุฒ ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุชู ุชูุฑูุฑ ุฑูุฒ ุงููุตูู ูู ุทูุจุงุช ุงูุดุจูุฉ </li><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุฒ ุงููููุฒ ุ ูุฌุจ ุชุญุฏูุซ ุงูุฑูุฒ ุงููููุฒ ููุชุญุฏูุซ ูู ุญุงูุฉ ุชูุฏูู ุงูุฑูุฒ ุงูุฃุฎูุฑ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุชูุชุน ููููุงุช React ุจุงููุตูู ุฅูู ูุนูููุงุช ุงููุตุงุฏูุฉ ูุชูุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูููุงุณุจุฉ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูููู ุงูุญู ูุน React ุงูููู (ุจุฏูู Redux ุ thunk ุ ุฅูุฎ.) </li></ul><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูู ูุงู ุฃุญุฏ ุฃูุซุฑ ุงูุฃุณุฆูุฉ ุชุญุฏูุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูุงุญุชูุงุธ ุจูุฒุงููุฉ ุญุงูุฉ ููููุงุช React ูุจูุงูุงุช ุงูุชุฎุฒูู ุงููุญููุฉุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ุฏุงุฎู ุงูุฌูุจ ุฏูู ุชูุฑูุฑู ุนุจุฑ ุดุฌุฑุฉ ุงูุนูุงุตุฑ ุจุฃููููุง (ุฎุงุตุฉู ุฅุฐุง ููุง ูุฑูุฏ ุงุณุชุฎุฏุงู ูุฐุง ุงูุฌูุจ ูู ุฅุฌุฑุงุกุงุช thunk ูุงุญููุง ุนูู ุณุจูู ุงููุซุงู) </li></ul><br><p style=";text-align:right;direction:rtl"> ูููู ุฏุนูุง ูุญู ุงููุดููุงุช ุฎุทูุฉ ุจุฎุทูุฉ.  ุฃููุงู ุ ุณูููู ุจุฅูุดุงุก <code>token provider</code> ูุชุฎุฒูู ุงูุฑููุฒ ูุชูููุฑ ุฅููุงููุฉ ุงูุงุณุชูุงุน ุฅูู ุงูุชุบููุฑุงุช.  ุจุนุฏ ุฐูู ุ ุณูููู ุจุฅูุดุงุก <code>auth provider</code> ุ ูุงูุชูุงู ูุนูู ุญูู <code>token provider</code> ูุฅูุดุงุก ุฑูุงุจุท ูููููุงุช React ุ ูุฌูุจ ุงูููุดุทุงุช ูุจุนุถ ุงูุทุฑู ุงูุฅุถุงููุฉ.  ููู ุงูููุงูุฉ ุ ุณููุธุฑ ูู ููููุฉ ุงุณุชุฎุฏุงู ูุฐุง ุงูุญู ูู ุงููุดุฑูุน. </p><br><h2 id="i-just-wanna-npm-install--and-go-production" style=";text-align:right;direction:rtl">  ุฃุฑูุฏ ููุท <code>npm install ...</code> ุงูุฅูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">  ุฌูุนุช ุจุงููุนู ุงูุญุฒูุฉ ุงูุชู ุชุญุชูู ุนูู ูู ูุง ูู ููุถุญ ุฃุฏูุงู (ูุฃูุซุฑ ููููุงู).  ุชุญุชุงุฌ ููุท ุฅูู ุชุซุจูุชู ุจูุงุณุทุฉ ุงูุฃูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm install react-token-auth</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุชุจุน ุงูุฃูุซูุฉ ูู ูุณุชูุฏุน GitHub <a href="https://github.com/obabichev/react-token-auth" rel="nofollow">ููุฑุฏ</a> ุงูุชูุงุนูู. </p><br><h2 id="solution" style=";text-align:right;direction:rtl">  ุญู </h2><br><p style=";text-align:right;direction:rtl">  ูุจู ุญู ุงููุดููุฉ ุ ุณุฃูุชุฑุถ ุฃู ูุฏููุง ูุงุฌูุฉ ุฎูููุฉ ุชููู ุจุฅุฑุฌุงุน ูุงุฆู ูู ุญู ุงููุตูู ูุชุญุฏูุซ ุงูุฑููุฒ.  ูู ุฑูุฒ ูููุฒ ูู ุชูุณูู <code>JWT</code> .  ูุฏ ูุจุฏู ูุซู ูุฐุง ุงููุงุฆู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"accessToken"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"refreshToken"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูููู ุงููุงุฆู ุงูุฑููุฒ ููุณุช ุญุฑุฌุฉ ุจุงููุณุจุฉ ููุง.  ูู ุฃุจุณุท ุงูุญุงูุงุช ุ ูุฏ ุชููู ุณูุณูุฉ ุฐุงุช ุฑูุฒ ูุตูู ูุงููุงุฆู.  ููููุง ูุฑูุฏ ุฃู ููุธุฑ ูู ููููุฉ ุฅุฏุงุฑุฉ ูููู ูุง ุนูุฏูุง ูููู ูุฏููุง ุฑูุฒุงู ุ ุฃุญุฏููุง ูุฏ ุชูุชูู ุตูุงุญูุชู ุ ูุงูุซุงูู ูุฏ ูุชู ุงุณุชุฎุฏุงูู ูุชุญุฏูุซ ุงูุฃูู. </p><br><h3 id="jwt" style=";text-align:right;direction:rtl">  JWT </h3><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ูุง ุชุนุฑู ูุง ูู ุฑูุฒ JWT ุ ูุฅู ุงูุฎูุงุฑ ุงูุฃูุถู ูู ุงูุงูุชูุงู ุฅูู <a href="https://jwt.io/" rel="nofollow">jwt.io</a> ูุฅููุงุก ูุธุฑุฉ ุนูู ููููุฉ ุนููู.  ูู ุงูููู ุงูุขู ุฃู ูุญุชูู ุงูุฑูุฒ ุงููููุฒ ูู JWT ุนูู ูุนูููุงุช ูุดูุฑุฉ (ุจุชูุณูู <code>Base64</code> ) ุญูู ุงููุณุชุฎุฏู ุชุชูุญ ูู ุงููุตุงุฏูุฉ ุนูู ุงูุฎุงุฏู. </p><br><p style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ูุง ูุดุชูู ุงูุฑูุฒ ุงููููุฒ JWT ุนูู 3 ุฃุฌุฒุงุก ููุณููุฉ ุนูู ุงูููุงุท ููุจุฏู ุฃูู: </p><br><p style=";text-align:right;direction:rtl"> <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiSm9obiBEb2UiLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTUxNjIzOTAyMn0.yOZC0rjfSopcpJ-d3BWE8-BkoLR_SCqPdJpq8Wn-1Mc</code> </p> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูููุง ุจูู ุชุดููุฑ ุงูุฌุฒุก ุงูุฃูุณุท ( <code>eyJu...Mn0</code> ) ูู ูุฐุง ุงูุฑูุฒ ุงููููุฒ ุ <code>eyJu...Mn0</code> ุนูู JSON ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iat"</span></span>: <span class="hljs-number"><span class="hljs-number">1516239022</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exp"</span></span>: <span class="hljs-number"><span class="hljs-number">1516239022</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุฐู ุงููุนูููุงุช ุ ุณูุชููู ูู ุงูุญุตูู ุนูู ุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุฒ ุงููููุฒ. </p><br><h3 id="token-provider" style=";text-align:right;direction:rtl">  ูุฒูุฏ ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  ููุง ุฐูุฑุช ูู ูุจู ุ ูุฅู ุฎุทูุชูุง ุงูุฃููู ูู ุฅูุดุงุก ูููุฑ ุงูุฑูุฒ ุงููููุฒ.  ุณูุนูู ูููุฑ ุงูุฑูุฒ ุงููููุฒ ูุจุงุดุฑุฉ ูุน ุงูุชุฎุฒูู ุงููุญูู ูุฌููุน ุชุบููุฑุงุช ุงูุฑูุฒ ุงููููุฒ ุงูุชู ุณููุนููุง ูู ุฎูุงูู.  ุณูุชูุญ ููุง ุงูุงุณุชูุงุน ุฅูู ุงูุชุบููุฑุงุช ูู ุฃู ููุงู ูุฅุฎุทุงุฑ ุงููุณุชูุนูู ุนูู ุงูููุฑ ุจุงูุชุบููุฑุงุช (ูููู ุจุนุฏ ุฐูู ุจูููู).  ุณูููู ูุฏู ูุงุฌูุฉ ุงููููุฑ ุงูุทุฑู ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>getToken()</code> ููุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ุงูุญุงูู (ุณูุชู ุงุณุชุฎุฏุงูู ูู ุฌูุจ) </li><li style=";text-align:right;direction:rtl">  <code>setToken()</code> ูุถุจุท ุงูุฑูุฒ ุงููููุฒ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุฃู ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุงูุชุณุฌูู </li><li style=";text-align:right;direction:rtl">  <code>isLoggedIn()</code> ููุชุญูู ูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู </li><li style=";text-align:right;direction:rtl">  <code>subscribe()</code> ูุฅุนุทุงุก ุงููููุฑ ูุธููุฉ ูุฌุจ ุงุณุชุฏุนุงุคูุง ุจุนุฏ ุฃู ุชุบููุฑ ุฑูุฒู </li><li style=";text-align:right;direction:rtl">  <code>unsubscribe()</code> ูุฅุฒุงูุฉ ุงููุดุชุฑู </li></ul><br><p style=";text-align:right;direction:rtl">  ุชููู ุฏุงูุฉ <code>createTokenProvider()</code> ุจุฅูุดุงุก ูุซูู ููููุฑ ุงูุฑูุฒ ุงููููุฒ ูุน ุงููุงุฌูุฉ ุงูููุตููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createTokenProvider = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Implementation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { getToken, isLoggedIn, setToken, subscribe, unsubscribe, }; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ ุฏุงุฎู ุงูุฏุงูุฉ createTokenProvider. </p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุฅูุดุงุก ูุชุบูุฑ ูุชุฎุฒูู ุงูุฑููุฒ ูุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ูู ุงูุชุฎุฒูู ุงููุญูู (ููุชุฃูุฏ ูู ุฃู ุงูุฌูุณุฉ ูู ุชุถูุน ุจุนุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _token: { <span class="hljs-attr"><span class="hljs-attr">accessToken</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">refreshToken</span></span>: string } = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'REACT_TOKEN_AUTH'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>) || <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุงูุขู ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ุจุนุถ ุงููุธุงุฆู ุงูุฅุถุงููุฉ ููุนูู ูุน ุงูุฑููุฒ JWT.  ูู ุงูููุช ุงูุญุงูู ุ ูุจุฏู ุงูุฑูุฒ ุงููููุฒ ูู JWT ุจูุซุงุจุฉ ุณูุณูุฉ ุณุญุฑูุฉ ุ ููู ููุณ ูู ุงูููู ุชุญููููุง ููุญุงููุฉ ุงุณุชุฎุฑุงุฌ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ.  <code>getExpirationDate()</code> ุงูุฏุงูุฉ <code>getExpirationDate()</code> ุฑูุฒูุง ูููุฒูุง ูู JWT ููุนููุฉ ูุฅุฑุฌุงุน ุงูุทุงุจุน ุงูุฒููู ูุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุนูุฏ ุงููุฌุงุญ (ุฃู <code>null</code> ุนูุฏ ุงููุดู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getExpirationDate = (jwtToken?: string): number | <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">null</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!jwtToken) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jwt = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(atob(jwtToken.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-comment"><span class="hljs-comment">// multiply by 1000 to convert seconds into milliseconds return jwt &amp;&amp; jwt.exp &amp;&amp; jwt.exp * 1000 || null; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุญุฏ ุฃูุซุฑ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ <code>isExpired()</code> ููุชุญูู ูู ุงูุชูุช ุตูุงุญูุฉ ุงูุทุงุจุน ุงูุฒููู.  ุชูุฑุฌุน ูุฐู ุงูุฏุงูุฉ true ุฅุฐุง ูุงู ุงูุทุงุจุน ุงูุฒููู ูุงูุชูุงุก ุงูุตูุงุญูุฉ <code>Date.now()</code> ูุฅุฐุง ูุงู ุฃูู ูู <code>Date.now()</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isExpired = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp?: number</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!exp) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() &gt; exp; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูููุช ูุฅูุดุงุก ุฃูู ูุธููุฉ ููุงุฌูุฉ ูููุฑ ุงูุฑูุฒ ุงููููุฒ.  ูุฌุจ ุฃู ุชุฑุฌุน ุงูุฏุงูุฉ <code>getToken()</code> ุงูุฑูุฒ ุงููููุฒ ูุชุญุฏูุซู ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ูุฌุจ ุฃู ุชููู ูุฐู ุงููุธููุฉ ุบูุฑ <code>async</code> ูุฃููุง ูุฏ ุชูุฏู ุทูุจ ุดุจูุฉ ูุชุญุฏูุซ ุงูุฑูุฒ ุงููููุฒ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุฏุงูุงุช ุณุงุจูุฉ ุชู ุฅูุดุงุคูุง ุ ูููููุง ุงูุชุญูู ูู ุฃู ุฑููุฒ ุงููุตูู ููุชููุฉ ุงูุตูุงุญูุฉ ุฃู ูุง ( <code>isExpired(getExpirationDate(_token.accessToken))</code> ).  ููู ุงูุญุงูุฉ ุงูุฃููู ูุชูุฏูู ุทูุจ ูุชุญุฏูุซ ุงูุฑูุฒ ุงููููุฒ.  ุจุนุฏ ุฐูู ุ ูููููุง ุญูุธ ุงูุฑููุฒ ุงููููุฒุฉ (ูุน ุงูุฏุงูุฉ <code>setToken()</code> ูู ูุชู ุชูููุฐูุง ุจุนุฏ).  ูุฃุฎูุฑุงู ุ ูููููุง ุฅุฑุฌุงุน ุฑูุฒ ุงููุตูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getToken = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_token) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isExpired(getExpirationDate(_token.accessToken))) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> updatedToken = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">'/update-token'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: _token.refreshToken }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.json()); setToken(updatedToken); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _token &amp;&amp; _token.accessToken; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>isLoggedIn()</code> ุงููุธููุฉ <code>isLoggedIn()</code> ุจุณูุทุฉ: ุณุชุนูุฏ ุจุดูู ุตุญูุญ ุฅุฐุง ูู ููู <code>_tokens</code> <code>null</code> ููู ูุชุญูู ูู ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุฒ ุงููููุฒ ูููุตูู (ูู ูุฐู ุงูุญุงูุฉ ุ ูู ูุนุฑู ุนู ุฑูุฒ ูุตูู ุตูุงุญูุฉ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุญุชู ููุดู ูู ุงูุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ุ ูููู ุนุงุฏุฉู ูุง ูููู ุฐูู ูุงูููุง ุ ูุฏุนูุง ูุญุงูุธ ุนูู ูุธููุฉ isLoggedIn ูุชุฒุงูู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isLoggedIn = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!_token; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุนุชูุฏ ุฃูู ููุช ููุงุณุจ ูุฅูุดุงุก ูุธุงุฆู ูุฅุฏุงุฑุฉ ุงููุฑุงูุจูู.  ุณูู ูููุฐ ุดูุฆูุง ููุงุซูุงู <a href="https://en.wikipedia.org/wiki/Observer_pattern" rel="nofollow">ููููุฐุฌ Observer</a> ุ ููุจู ูู ุดูุก ุ ุณููุดุฆ ูุฌููุนุฉ ูุชุฎุฒูู ุฌููุน ุงููุฑุงูุจูู ูุฏููุง.  ูุชููุน ุฃู ูููู ูู ุนูุตุฑ ูู ูุฐู ุงููุฌููุนุฉ ูู ุงููุธููุฉ ุงูุชู ูุฌุจ ุฃู ูุณูููุง ุจุนุฏ ูู ุชุบููุฑ ููุฑููุฒ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> observers: <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isLogged: boolean</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; = [];</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุฅูุดุงุก ุทุฑู <code>subscribe()</code> <code>unsubscribe()</code> .  ุฃูู ูุงุญุฏ ุณูุถูู ูุฑุงูุจูุง ุฌุฏูุฏูุง ุฅูู ุงููุตูููุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุณุงุจููุง ููููุงู ุ ูุงูุซุงูู ุณูุฒูู ูุฑุงูุจูุง ูู ุงููุงุฆูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observer: (isLogged: boolean</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) =&gt; { observers.push(observer); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> unsubscribe = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observer: (isLogged: boolean</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) =&gt; { observers = observers.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_observer</span></span></span><span class="hljs-function"> =&gt;</span></span> _observer !== observer); };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุจุงููุนู ุฃู ุชุฑู ูู ูุงุฌูุฉ ูุธุงุฆู <code>subscribe()</code> <code>unsubscribe()</code> ุฃููุง ุณูุฑุณู ูููุฑุงูุจูู ููุท ุญูููุฉ ุฃู ุงููุณุชุฎุฏู ูุงู ุจุชุณุฌูู ุงูุฏุฎูู.  ูููู ุจุดูู ุนุงู ุ ููููู ุฅุฑุณุงู ูู ูุง ุชุฑูุฏู (ุงูุฑูุฒ ุงููููุฒ ุจุงููุงูู ุ ููุช ุงูุชูุงุก ุงูุตูุงุญูุฉ ุ ุฅูุฎ ...).  ูููู ูุฃุบุฑุงุถูุง ุ ูููู ุฅุฑุณุงู ุนูู ููุทูู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ููุดุฆ ูุธููุฉ ุงุณุชุฎุฏุงู ุตุบูุฑุฉ <code>notify()</code> ุณุชุฃุฎุฐ ูุฐู ุงูุนูุงูุฉ ูุชุฑุณููุง ุฅูู ุฌููุน ุงููุฑุงูุจูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notify = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isLogged = isLoggedIn(); observers.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observer</span></span></span><span class="hljs-function"> =&gt;</span></span> observer(isLogged)); };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ูููุณ ุขุฎุฑูุง ุ ูุง ูุญุชุงุฌ ุฅูู ุชุทุจููู ูู <code>setToken()</code> .  ุงูุบุฑุถ ูู ูุฐู ุงููุธููุฉ ูู ุญูุธ ุงูุฑููุฒ ุงููููุฒุฉ ูู ุงูุชุฎุฒูู ุงููุญูู (ุฃู ุชูุธูู ุงูุชุฎุฒูู ุงููุญูู ุฅุฐุง ูุงู ุงูุฑูุฒ ูุงุฑุบูุง) ูุฅุฎุทุงุฑ ุงููุฑุงูุจูู ุจุงูุชุบููุฑุงุช.  ูุฐูู ุ ุฃุฑู ุงููุฏู ุ ุฃุฐูุจ ุฅูู ุงููุฏู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setToken = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _token</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (token) { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'REACT_TOKEN_AUTH'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(token)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'REACT_TOKEN_AUTH'</span></span>); } _token = token; notify(); };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฃูุฏ ูู ุฃูู ุฅุฐุง ูุตูุช ุฅูู ูุฐู ุงูููุทุฉ ูู ุงูููุงูุฉ ููุฌุฏุชูุง ูููุฏุฉ ุ ูุฃูุช ุจุงููุนู ุฃุณุนุฏุชูู.  ููุง ููุชูู ูุน ูููุฑ ุงูุฑูุฒ ุงููููุฒ.  ููููู ุฅููุงุก ูุธุฑุฉ ุนูู ุงูููุฏ ูุงููุนุจ ุจูุง ูุงูุชุญูู ูู ุฃููุง ุชุนูู.  ูู ุงูุฌุฒุก ุงูุชุงูู ุฃุนูุงู ุ ุณูููู ุจุฅูุดุงุก ุงููุฒูุฏ ูู ุงููุธุงุฆู ุงููุฌุฑุฏุฉ ุงูุชู ุณุชููู ูููุฏุฉ ุจุงููุนู ูู ุฃู ุชุทุจูู React. </p><br><h3 id="auth-provider" style=";text-align:right;direction:rtl">  ูุฒูุฏ ุงููุตุงุฏูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุก ูุฆุฉ ุฌุฏูุฏุฉ ูู ุงููุงุฆูุงุช ุงูุชู ุณูู ูุณูููุง ููููุฑ ูุตุงุฏูุฉ.  ุณุชุญุชูู ุงููุงุฌูุฉ ุนูู 4 ุทุฑู: ุฑุจุท <code>useAuth()</code> ููุญุตูู ุนูู ุญุงูุฉ ุฌุฏูุฏุฉ ูู <code>authFetch()</code> component ุ <code>authFetch()</code> ูุชูุฏูู ุทูุจุงุช ุฅูู ุงูุดุจูุฉ ุจุงุณุชุฎุฏุงู ุงูุฑูุฒ ุงููููุฒ ุงููุนูู ูุทุฑู <code>login()</code> ุ <code>logout()</code> ุงูุชู ุณูู ุชุณุชุฏุนู ุงูููุงููุงุช ุฅูู ุงูุฃุณููุจ <code>setToken()</code> ูู ูููุฑ ุงูุฑูุฒ ุงููููุฒ (ูู ูุฐู ุงูุญุงูุฉ ุ ุณูููู ูุฏููุง ููุทุฉ ุฅุฏุฎุงู ูุงุญุฏุฉ ููุท ูููุธููุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุจุงููุงูู ุ ููู ูุชูุฌุจ ุนูู ุจููุฉ ุงูููุฏ ูุนุฑูุฉ ูุฌูุฏ ูููุฑ ุงูุฑูุฒ ุงููููุฒ).  ููุง ูุงู ูู ูุจู ุณูุจุฏุฃ ูู ูููุดุฆ ุงููุธุงุฆู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createAuthProvider = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Implementation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { useAuth, authFetch, login, logout } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฅุฐุง ุฃุฑุฏูุง ุงุณุชุฎุฏุงู ูููุฑ ุงูุฑูุฒ ุงููููุฒ ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ูุซูู ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tokenProvider = createTokenProvider();</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุทุฑู <code>login()</code> ู <code>logout()</code> ุจุจุณุงุทุฉ ุชูุฑูุฑ ุงูุฑูุฒ ุงููููุฒ ุฅูู ูููุฑ ุงูุฑูุฒ ุงููููุฒ.  ููุฏ ูุตูุช ูุฐู ุงูุทุฑู ููุท ุนู ุงููุนูู ุงูุตุฑูุญ (ุชูุฑูุฑ ุฑูุฒ ูููุฒ ูุงุฑุบ / ูุงุฑุบ ุจุงููุนู ูุฒูู ุงูุจูุงูุงุช ูู ุงูุชุฎุฒูู ุงููุญูู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> login: <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> tokenProvider.setToken = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newTokens</span></span></span><span class="hljs-function">) =&gt;</span></span> { tokenProvider.setToken(newTokens); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> logout = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { tokenProvider.setToken(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ูุธููุฉ ุงูุฌูุจ.  ููููุง ูููุฑุชู ุ ูุฌุจ ุฃู ุชุญุชูู ูุฐู ุงููุธููุฉ ุนูู ููุณ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฃุตูู ุชูุงููุง ูุฃู ุชุนูุฏ ุงูุชูุณูู ููุณู ูููู ูุฌุจ ุฃู ุชุญูู ุฑูุฒ ูุตูู ููู ุทูุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุฃุฎุฐ ุฏุงูุฉ ุงูุฌูุจ ูุณูุทูู: ูุนูููุงุช ุงูุทูุจ (ุนุงุฏุฉู URL) ูุทูุจ init (ูุงุฆู ูุน ุงูุฃุณููุจ ุ ุงููุต ุงูุฃุณุงุณู. ุงูุฑุคูุณ ูููุฐุง) ุ  ูุฅุฑุฌุงุน ุงููุนุฏ ููุงุณุชุฌุงุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> authFetch = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (input: RequestInfo, init?: RequestInit): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;Response&gt; =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> token = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> tokenProvider.getToken(); init = init || {}; init.headers = { ...init.headers, <span class="hljs-attr"><span class="hljs-attr">Authorization</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(input, init); };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฏุงุฎู ุงููุธููุฉ ูููุง ุจุนูู ุดูุฆูู: ุฃุฎุฐูุง ุฑูุฒูุง ูููุฒูุง ูู ูููุฑ ุงูุฑูุฒ ุงููููุฒ ุจุจูุงู <code>await tokenProvider.getToken();</code>  (ูุญุชูู <code>getToken</code> ุจุงููุนู ุนูู ููุทู ุชุญุฏูุซ ุงูุฑูุฒ ุงููููุฒ ุจุนุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ) ูุญูู ูุฐุง ุงูุฑูุฒ ุงููููุฒ ูู ุฑุฃุณ <code>Authorization</code> ุจูุงุณุทุฉ ุณุทุฑ <code>Authorization: 'Bearer ${token}'</code> .  ุจุนุฏ ุฐูู ุ ูุนูุฏ ุจุจุณุงุทุฉ ุจุฌูุจ ุงูุญุฌุฌ ุงููุญุฏุซุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูููููุง ุจุงููุนู ุงุณุชุฎุฏุงู ูุฒูุฏ ุงููุตุงุฏูุฉ ูุญูุธ ุงูุฑููุฒ ูุงุณุชุฎุฏุงููุง ูู ุงูุฌูุจ.  ุงููุดููุฉ ุงูุฃุฎูุฑุฉ ูู ุฃูู ูุง ูููููุง ุงูุฑุฏ ุนูู ุงูุชุบููุฑุงุช ุงูุฑูุฒูุฉ ูู ููููุงุชูุง.  ุงูููุช ูุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ูู ูุจู ุ <code>useAuth()</code> ููู <code>useAuth()</code> ูุณุชุฎุฏู ูุชูููุฑ ูุนูููุงุช ูููููู ูู ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุชุณุฌูู ุงูุฏุฎูู ุฃู ูุง.  ูุชููู ูุงุฏุฑูุง ุนูู ุงูููุงู ุจุฐูู ุ ุณูุณุชุฎุฏู ุฎุทุงู <code>useState()</code> ููุงุญุชูุงุธ ุจูุฐู ุงููุนูููุงุช.  ุฅูู ูููุฏ ูุฃู ุฃู ุชุบููุฑุงุช ูู ูุฐู ุงูุญุงูุฉ ุณูู ุชุชุณุจุจ ูู ุฅุนุงุฏุฉ ุชูุฏูู ุงูููููุงุช ุงูุชู ุชุณุชุฎุฏู ูุฐุง ุงูุฎุทุงู. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุฃุนุฏุฏูุง ุจุงููุนู ูู ุดูุก ูุชุชููู ูู ุงูุงุณุชูุงุน ุฅูู ุงูุชุบููุฑุงุช ูู ุงูุชุฎุฒูู ุงููุญูู.  ููุงู ุทุฑููุฉ ุดุงุฆุนุฉ ููุงุณุชูุงุน ุฅูู ุฃู ุชุบููุฑุงุช ูู ุงููุธุงู ูุน ุงูุณูุงููุฑ ุชุณุชุฎุฏู <code>useEffect()</code> .  ูุณุชุบุฑู ูุฐุง ุงูุฎุทุงู ูุณูุทูู: ุงููุธููุฉ ููุงุฆูุฉ ุงูุชุจุนูุงุช.  ุณูุชู ุชุดุบูู ุงููุธููุฉ ุจุนุฏ ุฃูู ุงุณุชุฏุนุงุก <code>useEffect</code> ุซู ุฅุนุงุฏุฉ ุชุดุบูููุง ุจุนุฏ ุฃู ุชุบููุฑุงุช ูู ูุงุฆูุฉ ุงูุชุจุนูุงุช.  ูู ูุฐู ุงููุธููุฉ ุ ูููููุง ุงูุจุฏุก ูู ุงูุงุณุชูุงุน ุฅูู ุงูุชุบููุฑุงุช ูู ุงูุชุฎุฒูู ุงููุญูู.  ูููู ูู ุงูููู ุฃู ูุนูุฏ ูู ูุฐู ุงููุธููุฉ ... ูุธููุฉ ุฌุฏูุฏุฉ ุ ูุณูุชู ุฅุทูุงู ูุฐู ุงููุธููุฉ ุงูุฌุฏูุฏุฉ ุฅูุง ูุจู ุฅุนุงุฏุฉ ุชุดุบูู ุฃูู ูุธููุฉ ุฃู ุจุนุฏ ุฅูุบุงุก ุชุซุจูุช ุงููููู.  ูู ุงููุธููุฉ ุงูุฌุฏูุฏุฉ ุ ูููููุง ุงูุชููู ุนู ุงูุงุณุชูุงุน ุฅูู ุงูุชุบููุฑุงุช ูุถูุงูุงุช React ุ ูุงูุชู ุณูุชู ุฅุทูุงููุง (ุนูู ุงูุฃูู ูู ุญุงูุฉ ุนุฏู ุญุฏูุซ ุงุณุชุซูุงุก ุฃุซูุงุก ูุฐู ุงูุนูููุฉ).  ูุจุฏู ูุนูุฏุง ุจุนุถ ุงูุดูุก ูููู ูุฌุฑุฏ ุฅููุงุก ูุธุฑุฉ ุนูู ุงูููุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useAuth = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [isLogged, setIsLogged] = useState(tokenProvider.isLoggedIn()); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> listener = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newIsLogged: boolean</span></span></span><span class="hljs-function">) =&gt;</span></span> { setIsLogged(newIsLogged); }; tokenProvider.subscribe(listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { tokenProvider.unsubscribe(listener); }; }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [isLogged] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> isLogged]; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู ุดูุก.  ููุฏ ุฃูุดุฃูุง ููุชู ุชุฎุฒูู ูุตุงุฏูุฉ ุฑูุฒูุฉ ูุถุบูุทุฉ ููุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุงุถุญุฉ.  ูู ุงูุฌุฒุก ุงูุชุงูู ุ ุณููุธุฑ ูู ุจุนุถ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู. </p><br><h2 id="usage" style=";text-align:right;direction:rtl">  ุงุณุชุนูุงู </h2><br><p style=";text-align:right;direction:rtl">  ูุจุฏุก ุงุณุชุฎุฏุงู ูุง ูููุง ุจุชุทุจููู ุฃุนูุงู ุ ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุซูู ููููุฑ ุงููุตุงุฏูุฉ.  ุณูู ูุชูุญ ููุง ุงููุตูู ุฅูู ูุธุงุฆู <code>useAuth()</code> ุ <code>authFetch()</code> ุ <code>login()</code> ุ <code>logout()</code> ุงููุชุนููุฉ ุจููุณ ุงูุฑูุฒ ุงููููุฒ ูู ุงูุชุฎุฒูู ุงููุญูู (ุจุดูู ุนุงู ุ ูุง ุดูุก ูููุนู ูู ุฅูุดุงุก ูุซููุงุช ูุฎุชููุฉ ููููุฑ ุงููุตุงุฏูุฉ ูุฑููุฒ ูุฎุชููุฉ ุ ููู ุณุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงูููุชุงุญ ุงูุฐู ุชุณุชุฎุฏูู ูุชุฎุฒูู ุงูุจูุงูุงุช ูู ุงูุชุฎุฒูู ุงููุญูู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {useAuth, authFetch, login, logout} = createAuthProvider();</code> </pre> <br><h3 id="login-form" style=";text-align:right;direction:rtl">  ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู </h3><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุงูุจุฏุก ูู ุงุณุชุฎุฏุงู ุงููุธุงุฆู ุงูุชู ุญุตููุง ุนูููุง.  ููุจุฏุฃ ุจูููู ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู.  ูุฌุจ ุฃู ูููุฑ ูุฐุง ุงููููู ูุฏุฎูุงุช ูุจูุงูุงุช ุงุนุชูุงุฏ ุงููุณุชุฎุฏู ูุญูุธู ูู ุงูุญุงูุฉ ุงูุฏุงุฎููุฉ.  ุนูุฏ ุงูุฅุฑุณุงู ุ ูุญุชุงุฌ ุฅูู ุฅุฑุณุงู ุทูุจ ูุน ุจูุงูุงุช ุงูุงุนุชูุงุฏ ููุญุตูู ุนูู ุงูุฑููุฒ ุงููููุฒุฉ ุ ูููุง ูููููุง ุงุณุชุฎุฏุงู ูุธููุฉ <code>login()</code> ูุชุฎุฒูู ุงูุฑููุฒ ุงููุณุชููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LoginComponent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [credentials, setCredentials] = useState({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{target: {name, value}}: ChangeEvent&lt;HTMLInputElement&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> { setCredentials({...credentials, [name]: value}) }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onSubmit = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event?: React.FormEvent</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event) { event.preventDefault(); } fetch(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(credentials) }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function"> =&gt;</span></span> login(token)) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;form onSubmit={onSubmit}&gt; &lt;input name="name" value={credentials.name} onChange={onChange}/&gt; &lt;input name="password" value={credentials.password} onChange={onChange}/&gt; &lt;/form&gt; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู ุดูุก ุ ุฅูู ูู ูุง ูุญุชุงุฌู ูุชุฎุฒูู ุงูุฑูุฒ.  ุจุนุฏ ุฐูู ุ ุนูุฏูุง ูุชู ุชููู ุฑูุฒ ูููุฒ ุ ูู ูุญุชุงุฌ ุฅูู ุจุฐู ุฌูุฏ ุฅุถุงูู ูุฌูุจู ุฅูู ุฌูุจ ุฃู ูู ููููุงุช ุ ูุฃูู ูุฏ ุชู ุชุทุจููู ุจุงููุนู ุฏุงุฎู ูููุฑ ุงููุตุงุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููุฐุฌ ุงูุชุณุฌูู ูุดุงุจู ุ ูููุงู ุงุฎุชูุงูุงุช ููุท ูู ุนุฏุฏ ุฃุณูุงุก ุงูุญููู ุงููุฏุฎูุฉ ูุฃุณูุงุกูุง ุ ูุฐูู ุณุฃุญุฐููุง ููุง. </p><br><h3 id="router" style=";text-align:right;direction:rtl">  ุฑุงูุชุฑ </h3><br><p style=";text-align:right;direction:rtl">  ุฃูุถุง ุ ูููููุง ุชูููุฐ ุงูุชูุฌูู ุจุงุณุชุฎุฏุงู ูุฒูุฏ ุงููุตุงุฏูุฉ.  ูููุชุฑุถ ุฃู ูุฏููุง ูุฌููุนุชูู ูู ุงูุทุฑู: ูุงุญุฏุฉ ูููุณุชุฎุฏู ุงููุณุฌู ูุงูุขุฎุฑ ูุบูุฑ ุงููุณุฌููู.  <code>useAuth()</code> ูุญุชุงุฌ ุฅูู ุงูุชุญูู ุ ูู ูุฏููุง ุฑูุฒ ูููุฒ ูู ุงูุชุฎุฒูู ุงููุญูู ุฃู ูุง ุ ูููุง ูููููุง ุงุณุชุฎุฏุงู hook <code>useAuth()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Router = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [logged] = useAuth(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;BrowserRouter&gt; &lt;Switch&gt; {!logged &amp;&amp; &lt;&gt; &lt;Route path="/register" component={Register}/&gt; &lt;Route path="/login" component={Login}/&gt; &lt;Redirect to="/login"/&gt; &lt;/&gt;} {logged &amp;&amp; &lt;&gt; &lt;Route path="/dashboard" component={Dashboard} exact/&gt; &lt;Redirect to="/dashboard"/&gt; &lt;/&gt;} &lt;/Switch&gt; &lt;/BrowserRouter&gt;; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุดูุก ุงูุฌููู ุฃูู ุณูุชู ุฅุนุงุฏุฉ ุชูุฏููู ุจุนุฏ ุฃู ุชุบููุฑุงุช ูู ุงูุชุฎุฒูู ุงููุญูู ุ ุจุณุจุจ <code>useAuth</code> ูุฏูู ุงุดุชุฑุงู ูู ูุฐู ุงูุชุบููุฑุงุช. </p><br><h3 id="fetch-requests" style=";text-align:right;direction:rtl">  ุฌูุจ ุทูุจุงุช </h3><br><p style=";text-align:right;direction:rtl">  ููู ุซู ูููููุง ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงููุญููุฉ ุจูุงุณุทุฉ ุงูุฑูุฒ ุงููููุฒ ุจุงุณุชุฎุฏุงู <code>authFetch</code> .  ูู ููุณ ูุงุฌูุฉ ุงูุฌูุจ ุ ูุฐูู ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุฌูุจ ุจุงููุนู ูู ุงูููุฏ ุ ููููู ุจุจุณุงุทุฉ ุงุณุชุจุฏุงูู ุจู <code>authFetch</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Dashboard = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [posts, setPosts] = useState([]); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { authFetch(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_posts</span></span></span><span class="hljs-function"> =&gt;</span></span> setPosts(_posts)) }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {posts.map(post =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{post.id}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {post.message} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> };</code> </pre> <br><h2 id="summary" style=";text-align:right;direction:rtl">  ููุฎุต </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุนููุง ุฐูู.  ููุฏ ูุงูุช ุฑุญูุฉ ูุซูุฑุฉ ููุงูุชูุงู ุ ูููู ูุฏููุง ุฃูุถูุง ุงูููุงูุฉ (ุฑุจูุง ุณุนูุฏุฉ). </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุจุฏุฃูุง ุจููู ูุดุงูู ุชุฎุฒูู ุงูุฑููุฒ ุงููููุฒุฉ.  ุจุนุฏ ุฐูู ูููุง ุจุชุทุจูู ุญู ููุธุฑูุง ุฃุฎูุฑูุง ูู ุฃูุซูุฉ ุญูู ููููุฉ ุงุณุชุฎุฏุงูู ูู ุชุทุจูู React. </p><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ูู ูุจู ุ ููููู ุฃู ุชุฌุฏ ุชุทุจููู ุนูู ุฌูุซุจ ูู ุงูููุชุจุฉ.  ูุญู ูุดููุฉ ุนุงูุฉ ุฃูุซุฑ ููููุงู ููุง ูุถุน ุงูุชุฑุงุถุงุช ุญูู ุจููุฉ ุงููุงุฆู ูุน ุงูุฑููุฒ ุงููููุฒุฉ ุฃู ููููุฉ ุชุญุฏูุซ ุงูุฑูุฒ ุงููููุฒ ุ ูุฐูู ุณุชุญุชุงุฌ ุฅูู ุชูุฏูู ุจุนุถ ุงููุณุงุฆุท ุงูุฅุถุงููุฉ.  ููู ููุฑุฉ ุงูุญู ูู ููุณูุง ููุญุชูู ุงููุณุชูุฏุน ุฃูุถูุง ุนูู ุฅุฑุดุงุฏุงุช ุญูู ููููุฉ ุงุณุชุฎุฏุงูู. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุฃุณุชุทูุน ุฃู ุฃููู ุดูุฑุง ูู ุนูู ูุฑุงุกุฉ ุงูููุงู ูุขูู ุฃู ูููู ูููุฏุง ูู. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar485764/">https://habr.com/ru/post/ar485764/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar485746/index.html">ููุตุฉ 4 ุชุบุงุฏุฑ ูู ุงูุฎุงุฏู ุงููุณุชุฎุฏู</a></li>
<li><a href="../ar485748/index.html">ุชุณูุณู ุงุฎุชูุงุฑู ุ ุงุชุญุงุฏ ูุน null ุ ูููู ูุบูุฑูู ููุฌูุง ูู ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ</a></li>
<li><a href="../ar485750/index.html">ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชุณุชุญู ุงูุชุฑููุฉ ูู ุงูููุงูุฉ ูู Java 8. Part 1</a></li>
<li><a href="../ar485758/index.html">ุนููุงู ูุญุฏุงุช ูุน ุงูุชุญูู ุนุจุฑ ุงูุฅูุชุฑูุช ุ ููุฐูู ููุญุงุช ุงูููุงุชูุญ ุงููุณูุฌ ูุงูููุณูุฌุงุช ุฌู ุจุงุฑุงุฏูุณู</a></li>
<li><a href="../ar485760/index.html">ููุญูุงุช ูู Kotlin. atavism ุงูุฎุทุฑุฉ ุฃู ุฃุฏุงุฉ ูููุฏุฉุ</a></li>
<li><a href="../ar485766/index.html">ููุงุนุฏ ุงูุชุบุฐูุฉ</a></li>
<li><a href="../ar485768/index.html">2020 ุงุชุฌุงูุงุช ุงูููุจ ุชุณุชุญู ุงููุญุงููุฉ</a></li>
<li><a href="../ar485770/index.html">ุฌุฏูู ุบูุฑ ุตุญูุญ</a></li>
<li><a href="../ar485772/index.html">ูู ุณุทุญ ุงูููุชุจ ุฅูู ูุฑูุฒ ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถู - ููู ุฐูุจูุง ุฅูู ุงูุงูุชุฑุงุถูุฉ</a></li>
<li><a href="../ar485784/index.html">ุฌุนู ุฃู ุนูููุฉ ุชุนูู ูุน ูุธุงู NTFS ูููุนุงููุงุช: ุฎุทูุชู ุงูุฃููู ูุฅูุดุงุก ุตูุฏูู ุญูุงูุฉ ููุธุงู Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>