<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§± üë∏üèΩ üë¶üèª Zabbix: surveillez tout de suite (sur l'exemple de Redis) üîè üôÜüèª üë©üèª‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zabbix est un excellent produit pour les administrateurs de gros syst√®mes logiciels et mat√©riels. Il est si bon qu'il peut √™tre utilis√© non seulement ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix: surveillez tout de suite (sur l'exemple de Redis)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485538/"><p> <a href="https://www.zabbix.com/ru/" rel="nofollow">Zabbix</a> est un excellent produit pour les administrateurs de gros syst√®mes logiciels et mat√©riels.  Il est si bon qu'il peut √™tre utilis√© non seulement par les grandes entreprises, mais aussi par les petites et moyennes entreprises, et m√™me dans un projet pour <code>pet</code> .  En g√©n√©ral, j'ai peu d'exp√©rience avec Zabbix et je peux recommander son utilisation en toute s√©curit√©. </p><br><p>  Certes, je ne peux pas dire que je comprends la ¬´ <em>philosophie de Zabbix</em> ¬ª.  Malgr√© la vaste documentation d√©taill√©e en russe, il m'a √©t√© difficile de me plonger dans le monde de Zabbix - j'avais l'impression que les d√©veloppeurs et moi appelions les m√™mes choses sous des noms diff√©rents.  Peut-√™tre parce que Zabbix a √©t√© cr√©√© par des administrateurs pour des administrateurs, mais je suis toujours plus d√©veloppeur et utilisateur. </p><br><p>  Cependant, pour ex√©cuter Zabbix et surveiller les principaux param√®tres des syst√®mes informatiques (processeur, m√©moire, etc.), les comp√©tences d'un utilisateur Linux r√©gulier suffisent.  Il existe un grand nombre de plug-ins de d√©veloppeurs tiers qui √©tendent les capacit√©s de Zabbix.  Pour mes besoins, j'avais besoin de configurer la surveillance du serveur Redis.  J'ai fouill√© un peu dans le code des plug-ins disponibles et, √† l'aide de leur exemple, j'ai d√©couvert que l'architecture de Zabbix vous permet de simplement connecter tous les param√®tres du syst√®me d'information qui peuvent √™tre exprim√©s sous forme num√©rique √† la surveillance. </p><br><p>  Sous le chat - un exemple de plugin Zabbix avec mon explication de la terminologie Zabbix.  Pour certains, cet exemple semblera na√Øf, mais pour certains, il sera plus facile de se familiariser avec les concepts.  Dans tous les cas, Zabbix <a href="http://irinagold.pro/na-kogo-pohozh-slon-pritcha/" rel="nofollow">est suffisamment grand pour</a> le ressentir sous diff√©rents angles. </p><a name="habracut"></a><br><h1 id="bazovye-ponyatiya">  Concepts de base </h1><br><p>  En bref sur certains des concepts utilis√©s dans Zabbix: <em>agents</em> , <em>√©l√©ments</em> , <em>d√©clencheurs</em> , <em>actions</em> , <em>notifications</em> , <em>mod√®les</em> . </p><br><h2 id="server-i-agenty">  Serveur et agents </h2><br><p>  Du point de vue de l'utilisateur, Zabbix est divis√© en deux grandes parties: serveur et agents.  Le serveur est situ√© sur une machine, qui collecte et stocke des donn√©es statistiques, et des agents sur les machines √† partir desquelles les donn√©es sont collect√©es: </p><br><p><img src="https://habrastorage.org/webt/22/cc/y2/22ccy2szuqjhs0eprqqxkn29-2e.png" alt="Serveur et agents Zabbix"></p><br><h2 id="parametry-monitoringa">  Options de surveillance </h2><br><p>  Toute quantit√© qui peut √™tre exprim√©e sous forme num√©rique ou cha√Æne est appel√©e dans la terminologie de Zabbix - un √©l√©ment de donn√©es (√©l√©ment).  Chaque √©l√©ment est associ√© √† une <a href="https://www.zabbix.com/documentation/current/ru/manual/config/items/item/key" rel="nofollow">cl√©</a> unique (nom).  Voici des exemples d'√©l√©ments de donn√©es: </p><br><ul><li>  <strong>system.cpu.load [percpu, avg1]</strong> : 0.1167 </li><li>  <strong>system.uname</strong> : "Linux supru 4.15.0-50-generic # 54-Ubuntu SMP lun 6 mai 18:46:08 UTC 2019 x86_64" </li></ul><br><p>  Les valeurs de ces √©l√©ments de donn√©es (param√®tres de surveillance) sont attach√©es au temps; l'historique des valeurs des param√®tres est stock√© dans la base de donn√©es du serveur. </p><br><h2 id="sobytiya">  Les √©v√©nements </h2><br><p>  Lorsqu'un √©v√©nement se produit dans Zabbix, un d√©clencheur se d√©clenche.  Par exemple </p><br><ul><li>  <strong>{system.cpu.load [percpu, avg1] .avg (5m)}&gt; 10</strong> - la valeur moyenne du param√®tre au cours des 5 derni√®res minutes a d√©pass√© "10" </li><li>  <strong>{system.uname.diff (0)}&gt; 0</strong> - la valeur actuelle du param√®tre n'est pas √©gale √† la valeur pr√©c√©dente </li></ul><br><p>  En fait, les d√©clencheurs sont des formules dans lesquelles les param√®tres de surveillance (actuels et enregistr√©s) agissent comme des variables et qui produisent <code>true</code> / <code>false</code> en sortie. </p><br><h2 id="deystviya-i-opovescheniya">  Actions et alertes </h2><br><p>  En cas d'√©v√©nement (d√©clencheur), le serveur peut effectuer une action.  Par exemple, envoyez une alerte par e-mail √† une adresse donn√©e (" <em>Probl√®me: l'h√¥te est inaccessible pendant 5 minutes</em> ").  En outre, une action peut √™tre effectu√©e si le d√©clencheur revient √† son √©tat d'origine (¬´ <em>R√©solu: l'h√¥te est inaccessible pendant 5 minutes</em> ¬ª).  Tous les √©v√©nements (d√©clenchement de commutation) sont enregistr√©s c√¥t√© serveur. </p><br><h2 id="shablony">  Patterns </h2><br><p>  Zabbix permet de configurer des r√®gles de surveillance pour un h√¥te individuel, ainsi que de cr√©er un mod√®le de r√®gle (mod√®le) qui peut √™tre appliqu√© √† diff√©rents h√¥tes: </p><br><p><img src="https://habrastorage.org/webt/4t/yt/qw/4tytqw7tog1do4nsqoizzxjbglw.png" alt="mod√®les zabbix"></p><br><p>  L'exemple montre que le mod√®le ¬´Template App SSH Service¬ª d√©crit une application (Applications), un param√®tre de surveillance (Items), un d√©clencheur (Triggers).  Des descriptions de graphiques, d'√©crans, de r√®gles de d√©couverte et de scripts Web sont √©galement disponibles. </p><br><h1 id="postanovka-zadachi-dlya-plagina">  D√©finition de la t√¢che pour le plugin </h1><br><h2 id="nachalnoe-polozhenie">  Position de d√©part </h2><br><p>  Zabbix lui-m√™me propose son <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">propre plugin</a> pour surveiller l'√©tat de Redis, mais sur ma version du serveur (4.2.8) je n'ai pas pu l'utiliser (plugin pour la version 4.4 et sup√©rieure).  <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">Des solutions de tiers</a> sont √©galement propos√©es (une dizaine d'options pour diff√©rentes versions de Zabbix, il n'y a que les trois premi√®res dans l'image): </p><br><p><img src="https://habrastorage.org/webt/bv/pt/tk/bvpttkxf9lkxqn2thcnwwacutyw.png" alt="Plugins redis pour zabbix"></p><br><p>  Chacun d'eux avait ses propres avantages et inconv√©nients, devait regarder √† l'int√©rieur pour choisir.  Le meilleur, √† mon avis, √©tait le <a href="https://github.com/Shakeeljaveed/zabbix-redis-userparamaters" rel="nofollow">plugin Shakeeljaveed / zabbix-redis-userparamaters</a> , qui comprenait deux fichiers: </p><br><ul><li>  README.md </li><li>  redis-userparameter.conf </li></ul><br><p>  Je devais travailler un peu "stylos", mais sur son exemple, il est devenu un peu plus clair comment les donn√©es de l'agent vont au serveur.  √Ä la suggestion de l'auteur <a href="https://github.com/Shakeeljaveed" rel="nofollow">Javeed Shakeel, l'</a> √©tat <a href="https://github.com/Shakeeljaveed" rel="nofollow">de Redis a</a> √©t√© r√©initialis√© toutes les 2 minutes par la couronne dans le <code>/tmp/redismetric</code> : </p><br><pre> <code class="plaintext hljs">*/2 * * * * /usr/bin/redis-cli info &gt; /tmp/redismetric</code> </pre> <br><p>  Ensuite, chaque param√®tre de surveillance a √©t√© extrait par l'agent du <code>/tmp/redismetric</code> √† l'aide des outils du syst√®me d'exploitation lui-m√™me.  Des instructions ont √©t√© plac√©es dans la configuration de l'agent Zabbix <code>/etc/zabbix/zabbix_agent.conf.d/userparameter_redis.conf</code> .  Par exemple, <code>used_memory</code> l'instruction de r√©cup√©ration du param√®tre <code>used_memory</code> (utilisation de la m√©moire par le serveur Redis): </p><br><pre> <code class="plaintext hljs">UserParameter=used_memory,grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Autrement dit, dans le <code>/tmp/redismetric</code> avec la sortie de <code>redis-cli INFO</code> , la cha√Æne ( <code>grep -w ...</code> ) est recherch√©e par la cl√© <code>used_memory</code> </p><br><pre> <code class="plaintext hljs">used_memory:7153216</code> </pre> <br><p>  qui est ensuite divis√© en colonnes par le s√©parateur ":" ( <code>cut -d: -f2</code> ).  En sortie, l'agent re√ßoit le num√©ro <code>7153216</code> et l'affecte au param√®tre <code>used_memory</code> . </p><br><p>  Il reste √† configurer le serveur via l'interface Web afin qu'il envoie p√©riodiquement des demandes √† l'agent pour recevoir des donn√©es en utilisant le param√®tre <code>used_memory</code> , apr√®s quoi les donn√©es commencent √† √™tre <code>used_memory</code> sur le serveur, stock√©es dans la base de donn√©es, vous pouvez l'utiliser pour construire des graphiques et cr√©er des d√©clencheurs qui r√©pondent aux modifications de ce param√®tre. </p><br><h2 id="cel">  But </h2><br><p>  La t√¢che de surveiller l'√©tat de tout syst√®me n'est pas seulement la collecte de statistiques, mais aussi un avertissement sur la survenance de situations n√©cessitant une intervention humaine.  Comme je travaille avec Redis en tant qu'utilisateur tr√®s novice, j'ai d√ª chercher des informations sur les param√®tres de "sant√©" auxquels pr√™ter attention et ce qu'ils signifient.  L'article le plus digne √©tait " <a href="https://scalegrid.io/blog/6-crucial-redis-monitoring-metrics/" rel="nofollow">6 mesures de surveillance Crucial Redis que vous devez surveiller</a> ".  Apr√®s l'avoir analys√©, je suis arriv√© √† la conclusion que ¬´pour un bonheur complet¬ª, je dois collecter des donn√©es pour d√©tecter les √©v√©nements suivants: </p><br><ul><li>  Fragmentation de la m√©moire: used_memory_rss / used_memory&gt; 1.5 </li><li>  Faible taux d'acc√®s au cache: (keyspace_hits) / (keyspace_hits + keyspace_misses) &lt;0,8 </li><li>  Connexions rejet√©es: rejet√©_connexions&gt; 0 </li><li>  Cl√©s expuls√©es: evicted_keys&gt; 0 </li></ul><br><p>  Je souhaitais √©galement collecter des statistiques sur des param√®tres suppl√©mentaires (version Redis, disponibilit√©, etc.).  En g√©n√©ral, ayant une id√©e g√©n√©rale de la fa√ßon dont les donn√©es sont collect√©es par l'agent et transmises au serveur, la liste de souhaits peut √™tre consid√©rablement limit√©e.  En cons√©quence, nous avons obtenu une liste de param√®tres pour la surveillance √† partir de 12 positions. </p><br><h1 id="sozdanie-sobstvennogo-plagina">  Cr√©ez votre propre plugin </h1><br><h2 id="parametry-monitoringa-1">  Options de surveillance </h2><br><p>  Le plugin que j'ai analys√© a suppos√© l'ex√©cution d'une commande distincte pour obtenir un param√®tre distinct (√©l√©ment de donn√©es, √©l√©ment): </p><br><pre> <code class="plaintext hljs">grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Autrement dit, pour obtenir des donn√©es sur 12 param√®tres, l'agent devra ex√©cuter diff√©rents ensembles de commandes 12 fois.  Et si j'ai besoin de surveiller des param√®tres difficiles √† extraire par une cha√Æne de commandes et que je dois √©crire un script shell s√©par√© ou un programme √† part enti√®re?  Pour une telle "liste de souhaits", Zabbix propose une variante avec des √©l√©ments de donn√©es d√©pendants.  Son essence est que du c√¥t√© de l'agent, le script forme un ensemble de donn√©es (par exemple, au format JSON), qui est transmis au serveur en tant que param√®tre de cha√Æne.  Ensuite, c√¥t√© serveur, les donn√©es re√ßues sont analys√©es et des param√®tres √©l√©mentaires individuels en sont extraits. </p><br><h3 id="osnovnoy-element-dannyh">  √âl√©ment de donn√©es principal </h3><br><p>  J'ai d√©crit l' <code>redis.info</code> donn√©es principal <code>redis.info</code> type de cha√Æne avec une p√©riode de mise √† jour de 1 min, sans enregistrer l'historique des modifications: </p><br><p><img src="https://habrastorage.org/webt/hz/_m/tn/hz_mtnfj7n2uqzbssnnsdhtpgq4.png" alt="article de base"></p><br><p>  Vraisemblablement, le JSON suivant devrait √™tre g√©n√©r√© c√¥t√© agent: </p><br><pre> <code class="plaintext hljs">{ "version": "4.0.9", "uptime": 1897336, "used_memory": 1054943416, "used_memory_rss": 1138159616, "keyspace_hits": 75810274, "keyspace_misses": 13545949, "connected_clients": 15, "rdb_last_save_time": 1580126954, "total_connections_received": 1258614, "rejected_connections": 0, "expired_keys": 60270, "evicted_keys": 0 }</code> </pre> <br><p>  apr√®s quoi ce texte doit √™tre <code>redis.info</code> au serveur en tant <code>redis.info</code> donn√©es <code>redis.info</code> , mais pas enregistr√©, mais servir de base √† d'autres √©l√©ments de donn√©es (param√®tres de surveillance). </p><br><h3 id="zavisimyy-element-dannyh">  √âl√©ment de donn√©es d√©pendant </h3><br><p>  Le param√®tre de test <code>redis.info.version</code> d√©pend de <code>redis.info</code> et stocke ses valeurs dans la base de donn√©es pendant 90 jours.  La fr√©quence de surveillance des param√®tres d√©pend de l'√©l√©ment de base ( <code>redis.info</code> ): </p><br><p><img src="https://habrastorage.org/webt/eu/3u/jy/eu3ujyhzzyful-jrh8ceyqxsoz4.png" alt="article d√©pendant (base)"></p><br><p>  La <code>redis.info.version</code> param√®tre <code>redis.info.version</code> est extraite de la valeur redis.info √† l'aide des instructions JSONPath: </p><br><p><img src="https://habrastorage.org/webt/pn/3j/ad/pn3jad7k78sxnpq7pl1ubne9btk.png" alt="article d√©pendant (pr√©traitement)"></p><br><p>  Un sch√©ma similaire d√©crit les √©l√©ments de donn√©es d√©pendants restants (param√®tres de surveillance), qui sont transmis sous forme de JSON.  Voici un exemple de la description du param√®tre num√©rique <code>redis.info.used_memory</code> : </p><br><p><img src="https://habrastorage.org/webt/rh/_t/d8/rh_td8dczrfqa2ejsihinaobiho.png" alt="poste de num√©ro d√©pendant (base)"></p><br><p>  Tout est assez transparent, √† l'exception des <code>Units</code> et <code>Trend storage period</code> .  Je n'ai pas compris le deuxi√®me point, je l'ai laiss√© par d√©faut, et les unit√©s de mesure sont expliqu√©es dans la <a href="https://www.zabbix.com/documentation/current/ru/manual/appendix/suffixes" rel="nofollow">documentation</a> .  Dans ce cas, la valeur de <code>redis.info.used_memory</code> est mesur√©e en octets et r√©duite √† kilo / mega / giga /...- octets dans l'interface Web. </p><br><p>  La formule pour extraire une valeur de JSON est: <code>JSONPath = $.used_memory</code> </p><br><h3 id="vychislyaemyy-element-dannyh">  √âl√©ment de donn√©es calcul√© </h3><br><p>  Pour calculer la fragmentation de la m√©moire, la relation <code>used_memory_rss</code> / <code>used_memory</code> est utilis√©e et, sur sa base, un d√©clencheur est d√©termin√© qui se d√©clenche lorsque le rapport d√©passe 1,5.  Zabbix a un type d'√©l√©ment de donn√©es calcul√©: </p><br><p><img src="https://habrastorage.org/webt/iy/sd/4g/iysd4g2bqofdmwrvp9cpbguzvzo.png" alt="√©l√©ment calc"></p><br><p>  La valeur du param√®tre <code>redis.info.used_memory_ratio</code> calcul√©e toutes les minutes sur la base des derni√®res valeurs de deux autres param√®tres ( <code>redis.info.used_memory_rss</code> et <code>redis.info.used_memory</code> ), est stock√©e dans la base de donn√©es pendant 90 jours, etc. </p><br><h2 id="triggery">  D√©clencheurs </h2><br><p>  Voici un exemple de d√©clencheur qui se d√©clenche lorsque la m√©moire est trop fragment√©e: </p><br><p><img src="https://habrastorage.org/webt/bl/81/oj/bl81ojowbfvanebjn9nefzoh29w.png"></p><br><p>  Rien d'inhabituel, √† l'exception du format d'expression utilis√© dans la formule de changement d'√©tat du d√©clencheur.  Zabbix a un concepteur de formulaire, vous pouvez l'utiliser ou vous r√©f√©rer √† la <a href="https://www.zabbix.com/documentation/current/ru/manual/config/triggers/expression" rel="nofollow">documentation</a> / exemples (la liste des d√©clencheurs est disponible via l'interface web √† " <em>Configuration / Templates / $ {TemplateName} / Triggers</em> "). </p><br><p>  Un d√©clencheur peut √™tre bas√© sur tous les √©l√©ments de donn√©es (√©l√©ment), quel que soit leur type (principal, d√©pendant, calcul√©). </p><br><h2 id="nastroyka-agenta">  Configuration de l'agent </h2><br><h3 id="generaciya-jsona">  G√©n√©ration JSON </h3><br><p>  Pour obtenir les valeurs des param√®tres de surveillance et la formation de JSON, j'utilise ce script shell: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ## =========================================================================== # Script to generate Redis monitoring data in JSON format # for 'zabbix-agent'. ## =========================================================================== # collect working variables/data BIN_REDIS=$(whereis -b redis-cli | cut -d" " -f2) # /usr/bin/redis-cli DATA_INFO=$(${BIN_REDIS} INFO | tr -d '\r') # get info and remove trailing '\r' from output ## # Extract stats and save it into env. vars. ## # find lines with 'grep', cut second field after ":" and put it into env. variable: ITEM_VERSION=$(grep "^redis_version:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_UPTIME=$(grep "^uptime_in_seconds:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY=$(grep "^used_memory:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY_RSS=$(grep "^used_memory_rss:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_HITS=$(grep "^keyspace_hits:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_MISSES=$(grep "^keyspace_misses:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_CONNECTED_CLIENTS=$(grep "^connected_clients:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_RDB_LAST_SAVE_TIME=$(grep "^rdb_last_save_time:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_TOTAL_CONNECTIONS_RECEIVED=$(grep "^total_connections_received:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_REJECTED_CONNECTIONS=$(grep "^rejected_connections:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EXPIRED_KEYS=$(grep "^expired_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EVICTED_KEYS=$(grep "^evicted_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) # compose output JSON for Zabbix server: echo -n "{" echo -n "\"version\": \"${ITEM_VERSION}\"," echo -n "\"uptime\": ${ITEM_UPTIME}," echo -n "\"used_memory\": ${ITEM_USED_MEMORY}," echo -n "\"used_memory_rss\": ${ITEM_USED_MEMORY_RSS}," echo -n "\"keyspace_hits\": ${ITEM_KEYSPACE_HITS}," echo -n "\"keyspace_misses\": ${ITEM_KEYSPACE_MISSES}," echo -n "\"connected_clients\": ${ITEM_CONNECTED_CLIENTS}," echo -n "\"rdb_last_save_time\": ${ITEM_RDB_LAST_SAVE_TIME}," echo -n "\"total_connections_received\": ${ITEM_TOTAL_CONNECTIONS_RECEIVED}," echo -n "\"rejected_connections\": ${ITEM_REJECTED_CONNECTIONS}," echo -n "\"expired_keys\": ${ITEM_EXPIRED_KEYS}," echo -n "\"evicted_keys\": ${ITEM_EVICTED_KEYS}" echo -n "}"</span></span></code> </pre> <br><p>  J'ai plac√© ce script dans le fichier <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> sur le serveur avec Redis, sur lequel l'agent Zabbix est d√©j√† install√©.  L'utilisateur sous lequel l'agent Zabbix est <code>zabbix</code> (g√©n√©ralement <code>zabbix</code> ) doit avoir l'autorisation d'ex√©cuter le fichier <code>get_info.sh</code> . </p><br><h2 id="fayl-userparameter_xxxconf">  Fichier <code>userparameter_XXX.conf</code> </h2><br><p>  C√¥t√© agent, des param√®tres de surveillance suppl√©mentaires sont <code>userparameter_*.conf</code> dans les <code>userparameter_*.conf</code> du r√©pertoire <code>userparameter_*.conf</code> .  Par cons√©quent, afin que l'agent d√©couvre comment il doit collecter des donn√©es sur le param√®tre <code>redis.info</code> , j'ai cr√©√© le fichier <code>/etc/zabbix/zabbix_agentd.d/userparameter_redis.conf</code> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">UserParameter=redis.info,/var/lib/zabbix/user_parameter/redis/get_info.sh</code> </pre> <br><p>  Autrement dit, pour obtenir des donn√©es sur le param√®tre <code>redis.info</code> agent doit ex√©cuter le script <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> et transf√©rer le r√©sultat de l'ex√©cution sur le serveur. </p><br><p>  Apr√®s avoir red√©marr√© l'agent Zabbix ( <code>sudo service zabbix-agent restart</code> ), il devient possible de collecter des donn√©es pour le param√®tre <code>redis.info</code> et de les envoyer au serveur. </p><br><h1 id="rezyume">  R√©sum√© </h1><br><p>  Comprendre Zabbix m'est venu (et vient toujours) assez dur.  N√©anmoins, je le consid√®re comme un excellent outil, surtout apr√®s que la simplicit√© d'ajouter mes propres param√®tres de surveillance (√©l√©ments de donn√©es) s'est ouverte pour moi.  Dans l'ensemble, il suffit d'ajouter un fichier au serveur avec l'agent ( <code>userparameter_XXX.conf</code> ) avec une commande shell pour collecter des donn√©es et configurer le serveur Zabbix pour recevoir ces donn√©es via l'interface Web.  Et c'est tout - vous pouvez accumuler des donn√©es, cr√©er des graphiques, analyser les changements et cr√©er un d√©clencheur qui r√©pond √† ces changements. </p><br><p>  Le code du mod√®le, le fichier <code>userparameter_redis.conf</code> et le script <code>get_info.sh</code> peuvent √™tre consult√©s dans le <a href="https://github.com/flancer32/zabbix_plugin_redis/tree/habr" rel="nofollow">projet flancer32 / zabbix_plugin_redis</a> . </p><br><p>  Merci √† tous ceux qui ont lu jusqu'√† la fin, et surtout √† ceux qui ont trouv√© quelque chose d'utile dans la publication. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485538/">https://habr.com/ru/post/fr485538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485528/index.html">Comment conclure un projet de d√©veloppement logiciel de la bonne fa√ßon</a></li>
<li><a href="../fr485530/index.html">Apprentissage guid√©</a></li>
<li><a href="../fr485532/index.html">Guide d'entrevue pour les programmeurs qui ne les comprennent pas</a></li>
<li><a href="../fr485534/index.html">HighLoad ++, Mikhail Makurov (Intersvyaz): exp√©rience dans la cr√©ation d'une sauvegarde et d'un service Zabbix en cluster</a></li>
<li><a href="../fr485536/index.html">Est-il possible de pirater un avion - 2</a></li>
<li><a href="../fr485542/index.html">Ajouter des graphiques √† Notion</a></li>
<li><a href="../fr485544/index.html">Les √©checs comme syst√®me dynamique</a></li>
<li><a href="../fr485546/index.html">L'apocalypse arrive</a></li>
<li><a href="../fr485548/index.html">SwiftUI sur les √©tag√®res</a></li>
<li><a href="../fr485550/index.html">Y a-t-il de la vie au-del√† du p√©riph√©rique de Moscou? Comment nous recherchons et pr√©parons les d√©veloppeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>