<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé´ üßôüèø üêí R√©tro-ing√©nierie du firmware de l'appareil en utilisant l'exemple d'un ¬´rhinoc√©ros¬ª clignotant. 2e partie üë©‚Äçüé§ ‚ú≥Ô∏è üöÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous pr√©sentons √† votre attention la deuxi√®me partie de l'article sur la r√©tro-ing√©nierie du firmware du dispositif Flashing Rhino bas√© sur un atelier...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©tro-ing√©nierie du firmware de l'appareil en utilisant l'exemple d'un ¬´rhinoc√©ros¬ª clignotant. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inforion/blog/412561/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ny/yo/jz/nyyojzktr_-hcfv4j7ygq_eaiuu.png"></div><br>  Nous pr√©sentons √† votre attention la deuxi√®me partie de l'article sur la r√©tro-ing√©nierie du firmware du dispositif Flashing Rhino bas√© sur un atelier √† la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SMARTRHINO-2018</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans la premi√®re partie de l'</a> article, le micrologiciel du p√©riph√©rique a √©t√© charg√© dans le d√©sassembleur IDA et une analyse initiale des commandes de protocole du p√©riph√©rique a √©t√© effectu√©e.  Les commandes individuelles ont √©t√© test√©es sur un appareil fonctionnel. <br><br>  Dans la deuxi√®me partie, une analyse des t√¢ches restantes du firmware sera effectu√©e. <br><br>  Permettez-moi de vous rappeler qu'apr√®s avoir analys√© la t√¢che Bluetooth en termes de contr√¥le des LED, il a √©t√© d√©cid√© de passer √† la t√¢che LED, car la t√¢che initiale consiste √† cr√©er une application pour contr√¥ler les LED, et pour cela une compr√©hension d√©taill√©e du fonctionnement du firmware est n√©cessaire. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le fichier du firmware</a> est disponible pour √©tude ind√©pendante. <br><br>  <i>Toutes les informations sont fournies √† des fins √©ducatives uniquement.</i> <br><br>  Sous le chat, il y a beaucoup de rhinoc√©ros clignotants. <br><a name="habracut"></a><br><h2>  T√¢che LED </h2><br>  <i>En bref: une analyse compl√®te de la t√¢che responsable de la commutation des LED.</i>  <i>Analyse des types de donn√©es et des variables globales.</i> <br><br>  La t√¢che LED est repr√©sent√©e par la fonction <b>x_leds_task</b> , situ√©e √† <code>0x08005A08</code> . <br><br>  En plus des √©tranges lignes ¬´J'ai une super puissance ...¬ª dans la fonction principale de la t√¢che LED, vous pouvez faire attention √† la ligne <b>¬´teinte&gt; max: changer l'√©clat \ r \ n¬ª</b> . <br><br><img src="https://habrastorage.org/webt/6j/7u/qv/6j7uqvcupizmfsbqca81as5dwlw.png"><br><br>  En m√™me temps, nous voyons une situation famili√®re - (WORD *) (v26 + 4).  Dans le menu contextuel de la variable v26, s√©lectionnez l'√©l√©ment "Convertir en struct *", puis indiquez la structure cr√©√©e pr√©c√©demment: <br><br><img src="https://habrastorage.org/webt/6a/2i/jv/6a2ijvqm631yl3ce5z6uom02znw.png"><br><br>  √âtant donn√© que <code>v5 = v26</code> , nous r√©p√©tons l'op√©ration <i>¬´Convertir en struct *¬ª</i> pour la variable v5. <br><br>  Nous continuons de structurer le code et les donn√©es.  D√©finissez la repr√©sentation hexad√©cimale partout.  Renommer: <br><br><ul><li>  v5 - <b>led</b> ; </li><li>  v6 - <b>idx</b> ; </li><li>  v8 - <b>hue_1</b> ; </li><li>  v9 - <b>hue_2</b> ; </li><li>  v26 - <b>_led</b> ; </li></ul><br>  Le code s'am√©liore.  Mais certaines variables font toujours mal √† l'≈ìil, par exemple, la variable v23: <br><br><img src="https://habrastorage.org/webt/pz/cp/ch/pzcpchfjgrlwgwwtbun85x6weve.png"><br><br><img src="https://habrastorage.org/webt/k1/4k/fi/k14kfil99uzjgtwdpimtjcrl-ye.png"><br><br><div class="spoiler">  <b class="spoiler_title">Apparemment, la v23 est un tableau de 4 octets.</b> <div class="spoiler_text">  idx est l'indice de la LED;  cet index est ajout√© √† l'adresse de base;  de cette fa√ßon, l'acc√®s est fait aux √©l√©ments avec les m√™mes d√©placements - c'est ainsi que se comportent les tableaux. <br></div></div><br>  On assigne le type <code>char v23[4]</code> et on le renomme <b>leds_smth</b> , le code devient plus joli: <br><br><img src="https://habrastorage.org/webt/3a/zp/vv/3azpvvasy-8oabd8be6tshcy6z8.png"><br><br>  Vous pouvez √©galement noter que le r√©sultat de la fonction x_queue_recv est retourn√© √† la variable v25: <br><br><pre> <code class="cpp hljs">x_queue_recv(&amp;v25, leds_queue, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre> <br>  Mais il se peut que la fa√ßon dont les donn√©es dont vous avez besoin se <i>trouvent</i> dans la structure <i>_led</i> ne soit pas claire.  Le fait est que les variables v25 et _led <b><i>sont situ√©es √† proximit√© de la pile</i></b> - cela peut √™tre compris par le fait que dans la d√©compilation, elles sont √©crites sur des lignes adjacentes.  L'emplacement des variables sur la pile peut √™tre vu dans une fen√™tre s√©par√©e si vous double-cliquez sur la variable: <br><br><img src="https://habrastorage.org/webt/gm/1z/qs/gm1zqsoxvvppvneguj76arsppdu.png"><br><br>  Il s'agit probablement d'une structure, ou le compilateur a effectu√© une optimisation.  Ainsi, on peut affirmer que les donn√©es de la t√¢che Bluetooth sont transmises √† la t√¢che LED.  Pour le savoir plus pr√©cis√©ment, je vais v√©rifier sur l'appareil - pour la LED z√©ro via Bluetooth j'enverrai les valeurs <b>0x208</b> , <b>0x2D0</b> , <b>0x398</b> , <b>0x3E9</b> , qui pourraient √™tre remarqu√©es dans le code: <br><br><img src="https://habrastorage.org/webt/f-/1k/ds/f-1kdsphlzdbhuc4q6dwtfk6zge.png"><br><br>  Les r√©sultats de la v√©rification de la valeur de teinte sur l'appareil: <br><br><ul><li>  0x208 - les LED ont cess√© de commuter en douceur et ont √©t√© r√©gl√©es dans les couleurs: rouge, vert, bleu, violet; </li><li>  0x2D0 - les LED ont recommenc√© √† commuter; </li><li>  0x398 - rien n'a chang√©; </li><li>  0x3E9 - rien n'a chang√©. </li></ul><br>  Si vous regardez √† nouveau le code, vous pouvez voir que la valeur 0x398 peut √™tre associ√©e logiquement √† une valeur inf√©rieure √† 0x167 (diff√©rentes valeurs sont d√©finies pour l'√©l√©ment de tableau <i>leds_smth</i> ).  Par cons√©quent, je vais effectuer cette v√©rification: d'abord, je vais mettre la premi√®re LED sur vert (teinte = 0x78, <code>LED 010078FF20</code> ), tandis que les trois autres LED continuent de changer de couleur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5h/mp/dc/5hmpdckwscpkhlgvth05w1xvmuy.gif"></div><br>  Maintenant, je vais <code>LED 010398FFFF</code> protocole Bluetooth <code>LED 010398FFFF</code> - apr√®s cela, la premi√®re LED est pass√©e en mode de commutation de couleur g√©n√©rale. <br><br>  Ainsi, la valeur de teinte de 0x398 r√©initialise la valeur de couleur statique, ce qui signifie que le tableau leds_smth contient des drapeaux (0 ou 1) pour les LED √† occuper: <br><br><ul><li>  0 - la LED n'est pas occup√©e, participe √† une commutation de couleur fluide ( <b>teinte = 0x398</b> ); </li><li>  1 - la LED est occup√©e, l'utilisateur a d√©fini une couleur statique ( <b>teinte &lt;= 0x167</b> ). </li></ul><br>  Renommez leds_smth en <b>leds_busy</b> . <br><br>  Le but du bloc de code suivant devrait maintenant devenir clair: <br><br><img src="https://habrastorage.org/webt/sb/x8/mf/sbx8mfnnah6gziclrsqmgdcmpu0.png"><br><br>  Le cycle des lignes 83-101 effectue une mosa√Øque de couleurs lisse avec une √©tape de changement de couleur de 5: <code>v12 += 5</code> .  Si la LED a une couleur statique allum√©e, alors cette LED ne participe pas √† la mosa√Øque.  Apr√®s le cycle, il y a des lignes d'inclusion √† court terme de toutes les LED. <br><br>  Renommer: <br><br><ul><li>  sub_800678A - <b>x_led_set_hsv</b> ; </li><li>  v12 - <b>hue_step</b> ; </li><li>  v13, v17, v18, v19 - <b>led0_busy</b> , <b>led1_busy</b> , <b>led2_busy</b> , <b>led3_busy</b> ; </li><li>  v11, v20, v21, v22 - <b>teinte0</b> , <b>teinte1</b> , <b>teinte2</b> , <b>teinte3</b> ; </li><li>  dword_200004C4 - <b>led_control</b> . </li></ul><br>  La fonction sub_80039FE effectue vraisemblablement un timeout (sinon les LED n'ont pas commut√© en douceur, mais instantan√©ment), appelons-la <b>x_sleep</b> , et la variable v16 est <b>led_timeout</b> . <br><br>  Le but de la fonction sub_8006934 n'est pas encore √©vident, mais il est utilis√© partout apr√®s avoir d√©fini la couleur sur les LED - vous pouvez l'appeler <b>x_led_fix_color</b> . <br><br>  Apr√®s ces renommages, il est facile de comprendre la fonction <b>sub_8006944</b> (appel√©e dans la branche hue &lt;= 0x167): <br><br><img src="https://habrastorage.org/webt/nf/8a/j-/nf8aj-jzfsk9livqh_zxpwtojgq.png"><br><br>  Il effectue simplement une v√©rification suppl√©mentaire pour d√©terminer la couleur de la LED.  Renommez la fonction sub_8006944 en <b>x_led_set_hsv_wrap</b> (suffixe <i>_wrap</i> - une explication qu'il s'agit d'un ¬´wrapper¬ª sur une autre fonction) et d√©finissez-lui le prototype suivant: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x_led_set_hsv_wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> led_control, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">signed</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val)</span></span></span></span></code> </pre> <br>  Revenons d'un niveau √† la fonction x_leds_task.  Une fois de plus en regardant le code, vous pouvez constater que la branche "teinte&gt; 0x3E8" a commenc√© √† ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/sh/tm/5j/shtm5jrmecd3quimykrcgognngs.png"><br><br>  En d'autres termes, une valeur de teinte sup√©rieure √† 0x3E8 devrait modifier le d√©lai d'expiration de la mosa√Øque color√©e.  Je v√©rifierai en envoyant certaines valeurs √† l'appareil: <br><br><ul><li>  teinte = 0x3E9 - les LED ont commenc√© √† basculer rapidement: <br><br><img src="https://habrastorage.org/webt/1z/an/to/1zantozqcbgf0ho69jmgbvdd8v8.gif"><br></li><li>  hue = 0xFFFF - les LED ont commenc√© √† basculer tr√®s lentement: <br><br><img src="https://habrastorage.org/webt/jr/ty/sn/jrtysngekw8_1ise6uwd0kikrhc.gif"><br></li></ul><br>  Lorsque vous quittez le cycle principal de la t√¢che LED, la fonction <b>sub_8003C44</b> est <b>utilis√©e</b> , qui est √©galement utilis√©e dans la fonction sub_8005070: <br><br><img src="https://habrastorage.org/webt/ow/ws/ql/owwsqly9wu0bhmwzhu3r7buky5s.png"><br><br>  Renommer: <br><br><ul><li>  sub_8005070 - <b>x_freeMsg</b> ; </li><li>  sub_8003C44 - <b>x_free_queue</b> . </li></ul><br>  Plus loin dans la t√¢che LED, la branche suivante ne peut qu'attirer l'attention: <br><br><img src="https://habrastorage.org/webt/iu/q6/rr/iuq6rrf54hzoupmpslmnp0r8pcu.png"><br><br>  Vous pouvez essayer d'ex√©cuter la commande <code>LED B816D8D90000FFFF</code> .  Mais si vous vous souvenez que seuls 2 caract√®res sont pris comme index LED, une tentative pour atteindre ce code sera √©videmment infructueuse.  Laissez ce fil pour plus tard.  Renommez la fonction sub_8004AE8 en <b>x_mad_blinking</b> , et il est temps de corriger la signature de la fonction <b>x_printf</b> (la derni√®re fois que j'ai √©crit la mauvaise signature): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x_printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *format, ...)</span></span></span></span></code> </pre> <br>  Le cycle principal de la t√¢che LED a √©t√© d√©mont√©, mais il y a toujours un code au tout d√©but de la t√¢che. <br><br>  Regardons le code: <br><br><img src="https://habrastorage.org/webt/kt/xx/wn/ktxxwnzjvx9eqkkuiydzlro3vz4.png"><br><br>  √Ä la ligne 49, il est tr√®s probable que les LED soient v√©rifi√©es pour la disponibilit√© et, en cas d'erreur, un appel est effectu√© vers la fonction sub_8004BBC, qui d√©sactive les interruptions et d√©marre une boucle infinie dans laquelle la ligne ¬´../Drivers/STM32F0xx_HAL_Driver/Src/stm32f0xx_hal_gpio.c¬ª est utilis√©e.  Il s'agit tr√®s probablement d'une fonction d' <b>affirmation</b> ou similaire. <br><br>  Renommer: <br><br><ul><li>  sub_8004BBC - <b>x_gpio_assert</b> ; </li><li>  sub_800698C - <b>x_check_gpio</b> . </li></ul><br>  Le but de la fonction <b>sub_8006968</b> deviendra clair si vous regardez attentivement l'appareil lorsqu'il est allum√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/ap/t4/i8apt4kjg6rrbu73wzya5noyx6m.gif"></div><br>  Les quatre LED s'allument ensemble en premier rouge, puis vert, puis bleu.  Apr√®s cela, ils sont d√©finis par couleur: 0-rouge, 1-vert, 2-bleu, 3-violet.  Et c'est seulement alors qu'ils commencent √† changer de mosa√Øque. <br><br>  √âtant donn√© que la mosa√Øque commence dans le cycle de t√¢ches principal, il est logique que les lignes 58-61 avant le cycle principal soient responsables de l'inclusion √† court terme de diff√©rentes couleurs sur les LED, et les lignes 52-56 sont charg√©es de d√©finir le rouge-vert-bleu sur toutes les LED √† la fois.  Renommez la fonction sub_8006968 en <b>x_led_all_set_rgb</b> (RGB - purement sur une intuition, selon les arguments pass√©s). <br><br><h2>  Curiosit√©s dans la t√¢che LED </h2><br>  <i>En bref: d√©finir la fonctionnalit√© du code contenant des lignes √©tranges.</i>  <i>G√©n√©ration d'un mot de passe pour l'appareil.</i> <br><br>  Passons maintenant au tout d√©but de la fonction x_leds_task: <br><br><img src="https://habrastorage.org/webt/k1/64/2j/k1642jmvbxu5d0a7vs5lrtd3pru.png"><br><br>  <b>"Eraze"</b> , <b>"gen"</b> , <b>"flash"</b> , <b>"reset"</b> - pourquoi tout cela ??? <br><br>  Essayons de le comprendre. <br><br>  Soit sub_80066BC <b>x_leds_task_init</b> . <br><br>  Regardons sub_8006B38: <br><br><img src="https://habrastorage.org/webt/qa/80/ez/qa80ezojcnsyo_vz_q1hru7whz8.png"><br><br>  Memset d'eau pure, d'accord? <br><br><img src="https://habrastorage.org/webt/pf/oa/tf/pfoatfwwwasjk338b3lphqiiya4.png"><br><br>  Retour √† x_leds_task.  Quelque chose ne va pas avec le type de variable v24: <br><br><img src="https://habrastorage.org/webt/vg/ag/8u/vgag8ujkoylag2iryzujjvjldfu.png"><br><br>  L'IDA a fait une petite erreur avec le type, mais un commentaire avec une marque de pile nous aide.  Entre les variables v24 et v25 jusqu'√† 12 octets (0x44 - 0x38).  Par cons√©quent, nous renommons v24 en <b>buf</b> et attribuons le type <code>unsigned __int8 buf[12]</code> (Ida avertira que le nouveau type de donn√©es est plus grand que l'ancien - nous sommes d'accord). <br><br>  Ensuite.  Fonction sub_8004CE4: <br><br><img src="https://habrastorage.org/webt/sc/qg/tw/scqgtwrqr1vzlaubtsqstydsqmu.png"><br><br>  Renommez <i>a1</i> en <b>buf</b> , <i>v1</i> en <b>_buf</b> . <br><br>  Fonction sub_8006B26: <br><br><img src="https://habrastorage.org/webt/gs/du/ff/gsduffmdls272wqpmmv6_klqxdm.png"><br><br>  L'avez-vous reconnue? <br><br><div class="spoiler">  <b class="spoiler_title">Et si sans maquillage?</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8k/1d/p9/8k1dp9nmxkl0xjktjtsk_cp2vem.png"><br>  Bien s√ªr, <b>memcpy</b> .  Renommer. <br></div></div><br>  Le but de la fonction sub_8004CE4 est alors d'obtenir des donn√©es √† l'adresse <b>0x08007C00</b> .  Soit dit en passant, cette adresse est dans la plage d'adresses de la m√©moire flash du microcontr√¥leur (et du firmware, en particulier).  Renommez sub_8004CE4 en <b>x_read_data_0x08007C00</b> . <br><br>  Ligne de fonction X_leds_task 36: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-number"><span class="hljs-number">65</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0x19</span></span> )</code> </pre> <br>  Modifiez l'affichage des donn√©es (touche R sur le num√©ro 65, touche H sur le num√©ro 0x19): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-string"><span class="hljs-string">'A'</span></span> &gt; <span class="hljs-number"><span class="hljs-number">25</span></span> )</code> </pre> <br>  Apr√®s un peu de r√©flexion, vous pouvez comprendre qu'il s'agit d'un tel test de la gamme de l'alphabet latin AZ. <br><br>  Ensuite, en utilisant les invites sous forme de cha√Ænes de format, renommez: <br><br><ul><li>  sub_8004C10 - <b>x_erase</b> ; </li><li>  sub_80059C8 - <b>x_gen</b> ; </li><li>  sub_8004C84 - <b>x_flash</b> . </li></ul><br>  La fonction sub_8003C66 ne fait rien de remarquable - elle n'augmente que certaines variables globales - renommez sub_8003C66 en <b>x_smth_inc</b> . <br><br>  La fonction <b>x_erase</b> n'accepte aucun argument - cela peut √™tre v√©rifi√© dans le d√©sassembleur: <br><br><img src="https://habrastorage.org/webt/rv/p3/_i/rvp3_iqmhzsegjqyi3mugvpxnis.png"><br><br>  Dans x_erase, l'adresse famili√®re 0x08007C00 est utilis√©e et trois fonctions inconnues sont accessibles: <br><br><img src="https://habrastorage.org/webt/ys/nb/_b/ysnb_bfgd19htkrnmbyo5hudr0m.png"><br><br>  Un <b>rapide coup d'≈ìil</b> sur ces trois fonctions, nous voyons qu'elles acc√®dent √† des adresses dans la plage <b>0x40022000 - 0x400223FF</b> .  La documentation du microcontr√¥leur indique clairement qu'il s'agit de la gamme <b>¬´FLASH Interface¬ª</b> .  Autrement dit, la fonction x_erase efface un morceau de m√©moire flash - g√©nial! <br><br>  Apparemment, la fonction x_flash √©crit dans la m√©moire flash, apr√®s avoir v√©rifi√© la longueur de la ligne √† √©crire (au fait, les arguments a2 et a3 sont superflus ici - nous allons aider Idea): <br><br><img src="https://habrastorage.org/webt/ki/di/zi/kidizigfv5lb6bwg24aspkgvxmw.png"><br><br>  Et tout cela se passe dans le "dispositif d'√©clairage" ??? <br><br>  Et la fonction <b>x_gen</b> ?  Apr√®s un rapide coup d'≈ìil et en renommant les variables, cela ressemblera √† ceci: <br><br><img src="https://habrastorage.org/webt/v3/js/nb/v3jsnb8jb36wstn3obcln2c3pvk.png"><br><br>  La fonction <b>sub_8006CB4</b> ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/ub/h1/rk/ubh1rki0ikjrygsiqcx9vuwylxc.png"><br><br>  Et <b>sub_8006D10</b> - comme ceci: <br><br><img src="https://habrastorage.org/webt/gp/qy/oc/gpqyocts_ubcd4u3ep9koyrcb0o.png"><br><br>  Ne retenez pas le d√©sir de rechercher sur Internet ces constantes ind√©cemment belles: <b>0xABCD</b> , <b>0x1234</b> , <b>0xE66D</b> , <b>0xDEEC</b> , <b>0x4C957F2D</b> et <b>0x5851F42D</b> .  Si Internet n'est pas encore compl√®tement banni, vous trouverez probablement ces constantes dans la source <b>des fonctions al√©atoires</b> .  Pas √©tonnant que la fonction parent s'appelle x_gen. <br><br>  C'est aussi une situation tr√®s typique: appelez srand () avant la boucle, et appelez random () dans la boucle, alors renommez-le: <br><br><ul><li>  sub_8006D10 - x_rand; </li><li>  sub_8006CB4 - x_srand. </li></ul><br>  Un lecteur curieux, en examinant la fonction <b>sub_8005098</b> , peut d√©couvrir d' <i>o√π vient la graine</i> pour la fonction srand. <br><br>  Ainsi, la fonction x_gen g√©n√®re <b>une cha√Æne al√©atoire de la taille sp√©cifi√©e</b> . <br><br>  Une fois la ligne g√©n√©r√©e √©crite dans la m√©moire flash, l'appareil red√©marre: <br><br><img src="https://habrastorage.org/webt/a9/ta/rr/a9tarrhqqc-jj7g-e-dplvr67py.png"><br><br>  Cela ressemble √† une sorte de red√©marrage bizarre.  Mais si nous regardons la liste des t√¢ches de cet appareil, nous trouverons ¬´watchdogTask¬ª parmi eux.  √âvidemment, s'il y a une "t√¢che bloqu√©e", le chien de garde red√©marre. <br><br>  La t√¢che LED √† l'exception du mode MadBlinking peut √™tre consid√©r√©e comme analys√©e. <br><br>  Regardons √† travers les lignes quelles sont les autres t√¢ches du syst√®me: <br><br><img src="https://habrastorage.org/webt/fz/yj/yk/fzyjykt6djuq8v20hjpuw5l0xow.png"><br><br>  Apr√®s avoir restaur√© les liens vers les cha√Ænes dans le code, vous pouvez voir cette image: <br><br><img src="https://habrastorage.org/webt/ha/bl/ks/hablksetvyb0rskx6veqrxbt_z0.png"><br><br>  Tout d'abord, il existe un lien vers une cha√Æne avec le nom de t√¢che, puis un lien vers la fonction de t√¢che principale.  Et ils sont utilis√©s dans la fonction <b>principale</b> , o√π ces t√¢ches sont lanc√©es: <br><br><img src="https://habrastorage.org/webt/oc/ah/qd/ocahqdn8usagpkr-isbabunuwms.png"><br><br>  Ex√©cutons les renommages manquants: <br><br><ul><li>  sub_80050FC - <b>x_sensor_task</b> ; </li><li>  sub_8004AAC - <b>x_watchdogTask</b> ; </li><li>  sub_8005440 - <b>x_uartRxTask</b> . </li></ul><br><h2>  T√¢che de surveillance </h2><br>  Le chien de garde des t√¢ches ne fait rien de particuli√®rement int√©ressant: <br><br><img src="https://habrastorage.org/webt/m-/65/5w/m-655wpo6oboqmrob1tonwaoska.png"><br><br>  Renommer: <br><br><ul><li>  dword_200003F8 - <b>wd_variable</b> ; </li><li>  sub_8001050 - <b>x_update_wd_var</b> . </li></ul><br><h2>  T√¢che UART </h2><br>  <i>En bref: recherchez des donn√©es et des fonctions qui ont des liens √† partir de diff√©rentes fonctions.</i>  <i>D√©termination de leur objet.</i> <br><br>  Un rapide coup d'≈ìil √† la t√¢che UART vous permet de d√©tecter l'envoi de donn√©es vers une file d'attente inconnue d√©finie par la variable <b>unk_200003EC</b> : <br><br><img src="https://habrastorage.org/webt/8j/ei/zz/8jeizzxpvgu5opijgopamebser0.png"><br><br>  Apr√®s avoir restaur√© les liens vers cette variable via la recherche binaire, nous verrons qu'en plus de x_uartRxTask, elle est utilis√©e dans le principal (l√†, la file d'attente est cr√©√©e, apparemment) et dans la fonction inconnue jusqu'ici <b>sub_80051EC</b> : <br><br><img src="https://habrastorage.org/webt/g2/md/sg/g2mdsgx9wwhzpklgcacelye8rb8.png"><br><br>  Renommer: <br><br><ul><li>  sub_80051EC - <b>x_recvMsg_uart_queue</b> ; </li><li>  unk_200003EC - <b>uart_queue</b> . </li></ul><br>  Voir les r√©f√©rences crois√©es √† x_recvMsg_uart_queue: <br><br><ul><li>  sub_8005250; </li><li>  x_bluetooth_task. </li></ul><br>  Tout d'abord, consultez la fonction <b>sub_8005250</b> : <br><br><img src="https://habrastorage.org/webt/z1/8z/yj/z18zyj09grly6nwhuycpftjbrcu.png"><br><br>  Apr√®s r√©flexion, renommez: <br><br><ul><li>  unk_2000034C - <b>cmd_count</b> ; </li><li>  a1 - <b>cmd</b> ; </li><li>  v4 - <b>_cmd</b> ; </li><li>  v6 est <b>rsp</b> ; </li><li>  sub_8005250 - <b>x_bluetooth_cmd</b> . </li></ul><br>  Voyons maintenant o√π x_bluetooth_cmd est toujours utilis√©.  Tous les liens suppl√©mentaires uniquement √† partir de la t√¢che Bluetooth, il est temps d'y revenir. <br><br><h2>  Retour √† la t√¢che Bluetooth </h2><br>  <i>En bref: l'analyse finale de la t√¢che Bluetooth.</i>  <i>Recherchez une autorisation sans mot de passe.</i> <br><br><img src="https://habrastorage.org/webt/mb/2b/-e/mb2b-eatekfev7dil5vfk3_s-es.png"><br><br>  Si vous regardez les endroits o√π la fonction <b>sub_8006A84</b> est <b>utilis√©e</b> , et que vous n'√™tes pas trop paresseux et que vous regardez dans ses entrailles, il n'y aura aucun doute - c'est <b>calloc</b> .  C'est logique - pour recevoir des donn√©es dans le tampon, vous devez d'abord cr√©er ce tampon. <br><br>  Maintenant <b>sub_8006DBC</b> .  Regardons-le (les variables ont d√©j√† √©t√© renomm√©es): <br><br><img src="https://habrastorage.org/webt/kt/hw/31/kthw31aeqzwyae4jvnoqf5u6yl4.png"><br><br>  En rappelant les fonctions de la biblioth√®que C standard pour travailler avec des cha√Ænes, nous verrons <b>strstr</b> (rechercher une sous-cha√Æne) ici et la renommer hardiment. <br><br>  Passons en revue le code de la fonction x_bluetooth_task - <i>peut</i> - <i>√™tre que quelque chose a chang√© ici depuis la derni√®re visite</i> .  Dans le processus, nous nommons les variables: <br><br><ul><li>  v2 - <b>_state</b> ; </li><li>  v3 - <b>data_len</b> . </li></ul><br>  Il y a une fonction <b>sub_80052E2 juste √†</b> c√¥t√©.  Par analogie avec les fonctions qui tirent des nombres d'une commande Bluetooth, il extrait une cha√Æne d'une longueur sp√©cifi√©e - appelons-la <b>x_get_str</b> . <br><br>  Nous continuons: <br><br><ul><li>  <b>v26</b> - <b>isEcho</b> ; </li><li>  v6 - <b>meow_str</b> ; </li><li>  v10 - <b>uart_cmd_byte</b> ; </li><li>  v11 - <b>uart_cmd_str</b> ; </li><li>  v12 - <b>str_0</b> ; </li><li>  v13 - <b>str_1</b> ; </li><li>  v14 - <b>format_str</b> ; </li><li>  sub_8000F5C - <b>x_blink_small_led</b> . </li></ul><br>  Terminez avec un changement de nom rapide: <br><br><ul><li>  v19 - <b>mot de passe</b> ;  (car il y a des lignes sur l'autorisation et le mot de passe √† c√¥t√©) </li><li>  sub_8004CC0 - <b>x_check_password</b> ; </li><li>  sub_8006AF4 - <b>x_free</b> (puisque mot de passe, cmd et bt_args sont des pointeurs vers des objets dynamiques (v√©rifiez cela!), la m√©moire doit √™tre lib√©r√©e apr√®s leur utilisation); </li><li>  sub_8006DAC - <b>x_strcpy</b> (v√©rifiez-le!). </li></ul><br>  <b>Explorez</b> maintenant les branches <b>READ</b> , <b>WRIT</b> , <b>AUTP</b> , <b>SETP</b> . <br><br>  Comme l'a montr√© un test sur un appareil en cours d'ex√©cution, une autorisation est requise pour les commandes READ, WRIT, SETP.  Une tentative d'autorisation avec la commande AUTP nous am√®ne √† la fonction <b>x_check_password</b> pour v√©rifier le mot de passe: <br><br><img src="https://habrastorage.org/webt/vt/pw/6b/vtpw6b3h64bivcvzdlalldoo45k.png"><br><br>  Il s'av√®re que la longueur du mot de passe doit √™tre de 8 caract√®res et le mot de passe est compar√© (dans la fonction sub_8006B08) avec des octets √† l'adresse <b>0x08007C00</b> - o√π la cha√Æne g√©n√©r√©e de caract√®res al√©atoires AZ est stock√©e. <br><br>  Il s'av√®re que, sans conna√Ætre le mot de passe, nous ne pouvons pas nous connecter √† l'appareil.  Eh bien, ou presque ne peut pas ... <br><br>  Faites attention √† l'endroit o√π la variable <b>auth_flag</b> est <b>utilis√©e</b> : <br><br><img src="https://habrastorage.org/webt/8h/ng/l0/8hngl0dqritcx8yzk1jbvkqpq34.png"><br><br>  Il s'av√®re qu'il est utilis√© non seulement dans la t√¢che Bluetooth.  Et ici, nous n'avons tout simplement pas encore regard√© la t√¢che Sensor.  On y va. <br><br><h2>  T√¢che du capteur </h2><br>  <i>En bref: que fait le bouton tactile?</i> <br><br>  Conform√©ment aux meilleures pratiques de programmation, l'ensemble de la t√¢che Capteur tient dans un seul √©cran IDA.  Et cela ne peut que se r√©jouir: <br><br><img src="https://habrastorage.org/webt/mq/13/3v/mq133vs_uxqmyldfhmicajpxiak.png"><br><br>  Ligne √† ligne ... <br><br><ul><li>  "TSC% d \ r \ n" - cette ligne devrait vous faire penser au contr√¥leur de d√©tection tactile pour les microcontr√¥leurs STM32; </li><li>  "AUTH BTN \ r \ n" - bouton d'autorisation ??? </li><li>  "SET AUTH% d \ r \ n" - d√©finir l'indicateur d'autorisation? </li></ul><br>  Voyons comment l'appareil se comportera si vous appuyez sur le bouton tactile (avez-vous r√©alis√© que le rhinoc√©ros sur la jambe a un bouton tactile?): <br><br><img src="https://habrastorage.org/webt/0p/ig/bp/0pigbpj4pj5gdrn1onololc_zfk.gif"><br><br>  En appuyant bri√®vement, la petite LED rouge s'allume.  Avec une pression longue, cette LED s'allume pendant longtemps. <br><br>  Si nous corr√©lons cela avec le code, nous pouvons supposer que la fonction <b>sub_8000708</b> est une fonction pour obtenir l'heure actuelle.  Ensuite, si la diff√©rence entre l'heure actuelle et le d√©but du toucher du capteur est sup√©rieure √† 1000 (1 seconde), la LED s'allume pendant <b>0xEA60</b> millisecondes (1 minute).  Mais la variable auth_flag est d'un grand int√©r√™t, qui est mise √† 1 avec un appui long sur le bouton tactile, donnant √† l' <s>attaquant l'</s> acc√®s √† l'administrateur du "luminaire" l'acc√®s √† des fonctions privil√©gi√©es. <br><br>  Ainsi, apr√®s autorisation ¬´par bouton¬ª, vous pouvez lire le mot de passe stock√© dans l'appareil (commande READ), √©crire dans la RAM (fonction WRIT) ou d√©finir un nouveau mot de passe (SETP). <br><br><h2>  Clignotement fou </h2><br>  <i>En bref: une √©trange branche de code Mad Blinking peut-elle √™tre ex√©cut√©e?</i> <br><br>  Revenons √† la t√¢che Bluetooth et faisons un nouveau changement de nom. <br><br><ul><li>  v21 - <b>vip_smth</b> (on ne sait pas encore ce qu'il y a); </li><li>  v22 - <b>vip_str</b> (cha√Æne de taille inconnue, extraite des arguments); </li><li>  v23 - <b>mad_led</b> - attribuez "Convertir en struct *" et sp√©cifiez <i>struct_LED</i> . </li></ul><br>  Et ici, nous voyons le num√©ro <b>0xB816D8D9</b> (il a √©t√© trouv√© dans la premi√®re partie de l'article dans la t√¢che Bluetooth) comme index de la LED.  Ce code sera ex√©cut√© si la v√©rification est effectu√©e: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sub_8005520(vip_str, vip_smth) == <span class="hljs-number"><span class="hljs-number">0x46F70674</span></span> )</code> </pre> <br>  Renommez sub_8005520 en <b>x_vip_check</b> et jetez-y un ≈ìil: <br><br><img src="https://habrastorage.org/webt/dl/h9/tx/dlh9txqyu5n1t4orgprpptbk8oc.png"><br><br>  √âtant donn√© que le premier argument est une cha√Æne (au moins la cha√Æne est pass√©e √† cette fonction), ce code montre que le deuxi√®me argument est la longueur de cette cha√Æne (ou la longueur qui doit √™tre trait√©e).  Renommer: <br><br><ul><li>  a1 - <b>str</b> ; </li><li>  a2 - <b>len</b> . </li></ul><br>  Regardons la fonction <b>sub_8000254</b> : <br><br><img src="https://habrastorage.org/webt/y-/ql/js/y-qljsey4clq4lowsdbrblnkyf8.png"><br><br>  Regardez maintenant <b>sub_8000148</b> .  Voici son d√©but: <br><br><img src="https://habrastorage.org/webt/l7/xz/cr/l7xzcrdgjq0n5a82enkalsukqse.png"><br><br>  Ce n'est qu'un tiers de la fonction ... Mmmm ... Miam!  Un creuseur exp√©riment√© verra facilement ici ... <br><br><div class="spoiler">  <b class="spoiler_title">Quoi?</b> <div class="spoiler_text">  op√©ration de division enti√®re. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comment le d√©nicher?</b> <div class="spoiler_text">  Si vous faites un effort, vous pouvez acc√©der √† <b>x_printf</b> √† partir de la fonction <b>sub_8000254</b> (via plusieurs autres fonctions).  Un point important √† souligner √† ce stade est que g√©n√©ralement toutes <i>les fonctions standard sont assez standard</i> .  Cela signifie que vous pouvez essayer de trouver dans le domaine public au moins du code source de la fonction √©tudi√©e, afin que l'√©tude soit plus productive. <br><br>  Donc, nous prenons la source de printf, puis nous regardons <b>vfprintf</b> , en le comparant avec le code du firmware √©tudi√©.  <b>En utilisant le</b> code source, nous <b>sortons de la</b> fonction <b>itoa</b> et concluons que la fonction <b>sub_8000254</b> est l'op√©rateur <b>op√©rateur%</b> (en prenant le reste de la division), et cette terrible fonction longue n'est rien de plus que de prendre la partie enti√®re de la division (op√©ration div). <br></div></div><br>  Une question l√©gitime peut se poser - pourquoi?  Le fait est qu'il ne peut pas y avoir d'op√©rations DIV, MOD dans un microcontr√¥leur particulier, par cons√©quent, le compilateur substitue l'appel de fonctions individuelles √† la place de ces op√©rateurs.  Au fait, voici quelques autres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions math√©matiques</a> . <br><br>  N'oubliez pas de renommer en creusant. <br><br>  Ainsi, la fonction <b>x_vip_check</b> , calcule ... Et ce sera votre <b><i>devoir</i></b> . <br><br>  Soit dit en passant, si vous ex√©cutez la commande <b>VIP</b> correcte, nous obtenons un ¬´rhinoc√©ros dans la discoth√®que¬ª: <br><br><img src="https://habrastorage.org/webt/ah/ty/sc/ahtyscents-3j77aqcxfa0_hrtq.gif"><br><br><h2>  Bref rapport sur le firmware </h2><br>  Le firmware de l'appareil est bas√© sur le syst√®me d'exploitation en temps r√©el FreeRTOS.  Le syst√®me a les t√¢ches suivantes: <br><br><ol><li>  <b>T√¢che Bluetooth</b> .  Traite les commandes qui se pr√©sentent sous forme de texte via Bluetooth. </li><li>  <b>T√¢che LED</b> .  Contr√¥le les LED de couleur en fonction des commandes Bluetooth. </li><li>  <b>T√¢che du capteur</b> .  Allume la LED rouge, permet une autorisation √† court terme sans mot de passe sur l'appareil. </li><li>  <b>T√¢che UART</b> .  Vous permet d'interagir avec le module Bluetooth via le port UART interne (utilis√© pour initialiser Bluetooth). </li><li>  <b>T√¢che de surveillance</b> .  Garde la trace des gels. </li></ol><br>  L'√©tude n'a pas pris en compte la possibilit√© de lire les donn√©es du port UART (contacts Tx / GND). <br><br><h2>  R√©sum√© </h2><br>  Lors de la master class lors de la conf√©rence, seule la fonctionnalit√© principale de contr√¥le des LED a √©t√© d√©mont√©e.  Les participants les plus actifs ont √©t√© pr√©sent√©s avec leurs ¬´rhinoc√©ros¬ª exp√©rimentaux. <br><br>  √Ä mon avis, les ¬´rhinoc√©ros¬ª ont produit un plan d√©cent pour un cours de formation sur l'ing√©nierie inverse et la recherche de vuln√©rabilit√©.  Une caract√©ristique de la disposition peut √™tre la possibilit√© de changer le firmware autant de fois que vous le souhaitez, chaque cours a son propre firmware.  Contrairement √† l'analyse d'un fichier ex√©cutable, le firmware invers√© vous permet de mieux comprendre: <br><br><ul><li>  comment travailler avec l'IDA; </li><li>  principes d'interaction entre le firmware et l'appareil; </li><li>  Principes de fonctionnement du RTOS. </li></ul><br>  Un grand merci √† tous ceux qui ont lu jusqu'√† la fin! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412561/">https://habr.com/ru/post/fr412561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412551/index.html">Copiez le texte du presse-papiers sur les appareils Android via ADB</a></li>
<li><a href="../fr412553/index.html">Le condens√© des √©v√©nements pour les professionnels des RH dans le domaine des TI pour juin 2018</a></li>
<li><a href="../fr412555/index.html">Engrenage magn√©tique pour moteur sans balais</a></li>
<li><a href="../fr412557/index.html">Comment cr√©er votre propre bot sans comp√©tences en programmation et le connecter √† Yandex.Alice</a></li>
<li><a href="../fr412559/index.html">Le contrat intelligent comme menace pour la s√©curit√© du d√©marrage de la blockchain</a></li>
<li><a href="../fr412565/index.html">BD sur les administrateurs syst√®me: toute la vie a d√©fil√© devant mes yeux</a></li>
<li><a href="../fr412571/index.html">Histoires de r√©ussite de Kubernetes en production. Partie 9: Clusters CERN et 210 K8s</a></li>
<li><a href="../fr412573/index.html">Ce qui ne va pas avec le retour des Geektimes √† Habr</a></li>
<li><a href="../fr412575/index.html">Chaque ann√©e, la musique pop devient de plus en plus monotone, car les m√™mes personnes la composent</a></li>
<li><a href="../fr412579/index.html">Marvel: Infinity War ou Comment collecter des donn√©es pour votre projet en quelques minutes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>