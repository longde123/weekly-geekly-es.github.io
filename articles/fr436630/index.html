<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêô üë©‚Äç‚öïÔ∏è üòú Microservices. L'unification et pourquoi c'est si important. Partie 1 - Configuration üíä üß• üöÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 Bonne journ√©e √† tous. Je suis d√©veloppeur Python dans une entreprise qui s'occupe de solutions complexes pour automatiser les processus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microservices. L'unification et pourquoi c'est si important. Partie 1 - Configuration</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436630/"><img src="https://habrastorage.org/webt/-0/t1/l0/-0t1l0j7yjj4y-ysaqxqu5no3my.png"><br><br><h2>  Pr√©sentation </h2><br>  Bonne journ√©e √† tous.  Je suis d√©veloppeur Python dans une entreprise qui s'occupe de solutions complexes pour automatiser les processus m√©tier, d√©velopper pour r√©soudre des t√¢ches uniques, des analyses et du conseil.  Mes responsabilit√©s incluent le d√©veloppement et la maintenance d'une architecture de microservices.  Et aujourd'hui, je voudrais dire comment nous luttons avec les microservices et pourquoi l'unification est si importante pour eux. <br><br>  Ce n'est un secret pour personne que cette approche du d√©veloppement de produits s√©duit de plus en plus le march√©.  Et plus on s'y plonge, plus il faut ne pas oublier les r√®gles de base pour travailler avec eux.  Afin de structurer notre exp√©rience dans l'√©criture de produits de microservices, il a √©t√© d√©cid√© d'√©crire une s√©rie d'articles sur la mani√®re de g√©n√©raliser certains aspects du d√©veloppement √† tous les services. <br><br>  L'une de ces r√®gles est l'unification.  Dans notre entreprise, la plupart des produits se composent d'un tas de langages et de technologies h√©t√©roclites.  Dans tout ce stand, vous devez r√©fl√©chir √† la fa√ßon de g√©n√©raliser les principes de base √† tous les microservices pour leur support, leur configuration et leur d√©veloppement pratiques.  Ceci sera discut√© dans la s√©rie de ces articles. <br><br>  Je demande √† tout le monde int√©ress√© par cat. <br><a name="habracut"></a><br><h3>  Le probl√®me </h3><br>  La premi√®re chose que vous rencontrez lors du d√©veloppement d'un service est peut-√™tre ses m√©thodes de configuration.  Dans l'architecture de microservices, ce probl√®me devient encore plus aigu. <br><br>  Imaginez que vous disposez de deux douzaines de services et que vous devez modifier un param√®tre dans chacun.  Par exemple, d√©sactivez l'utilisation de CORS.  √âtant donn√© que le syst√®me est multicomposant et construit sur des microservices, pour une gestion pratique, il est pr√©f√©rable d'utiliser une approche uniforme de la configuration de tous les modules.  Par cons√©quent, vous devez utiliser la m√™me approche lors de la configuration de chaque module. <br><br>  Vous pouvez dire que le d√©veloppeur de chaque service devrait le faire, mais que se passe-t-il si toutes vos configurations sont stock√©es dans le m√™me Kubernetes, o√π ne peut-on pas donner √† tous les d√©veloppeurs?  Les pauvres DevOps seront oblig√©s de passer beaucoup de temps √† apprendre les services et leurs m√©thodes de configuration.  Et cette proc√©dure sera r√©p√©t√©e avec la mise √† jour des services, surtout si quelqu'un veut essayer quelque chose de nouveau dans les param√®tres de service.  Avec cette approche, l'√©quipe passera constamment une partie du temps √† travailler avec les configurations, sans d√©velopper de nouvelles fonctionnalit√©s, corriger les bugs, etc. <br><br>  Juste pour ce cas, une m√©thode de configuration g√©n√©rale est requise qui ne sera pas li√©e √† un langage ou une technologie sp√©cifique et vous permettra de configurer tous les services avec des diff√©rences minimales dans la structure g√©n√©rale de la configuration.  Pour cette t√¢che, nous avons d√©velopp√© un syst√®me de mise en place de ¬´modules¬ª (services) √† l'aide de fichiers yaml, la possibilit√© de stocker des configurations pour diff√©rentes √©tapes (dev / prod / local etc.) et de diviser le tout en diff√©rents blocs li√©s √† certaines choses. <br><br><h2>  Sp√©cification </h2><br>  Vous pouvez parler beaucoup de l'endroit et de la fa√ßon de l'utiliser, mais je propose d'aller directement aux sp√©cifications de cette m√©thode de configuration.  Comme on dit, la th√©orie est bonne et la pratique est encore meilleure. <br><br><h3>  Configuration requise </h3><br>  Commen√ßons par d√©finir notre syst√®me et ses exigences. <br><ul><li>  <b>Chaque</b> module est un composant ind√©pendant du conteneur </li><li>  Nous pouvons passer des variables d'environnement au conteneur </li><li>  Nous ne pouvons pas modifier la configuration √† la vol√©e sans red√©marrer le service (cr√©ation d'un nouveau conteneur). </li><li>  Toutes les actions de secours (comme le basculement vers la base de donn√©es de sauvegarde) sont <b>effectu√©es en dehors du composant</b> et lui sont transparentes. </li></ul><br><br><h3>  Configuration requise pour la m√©thode de configuration </h3><br>  D√©cidons maintenant ce que nous voulons voir de notre m√©thode de configuration afin de satisfaire toutes les exigences. <br><br><ol><li>  Le type du fichier de configuration est le YAML de la structure sp√©cifi√©e.  YAML a √©t√© choisi par nous pour plusieurs raisons: <br><ul><li>  Possibilit√© d'√©crire des commentaires et une structure pratique, contrairement √† JSON </li><li>  Capacit√© √† d√©crire des tableaux contrairement √† ENV </li><li>  Hors de la bo√Æte peut √™tre utilis√© pour l'inclusion de values.yaml dans la barre (Kubernetes) </li></ul><br></li><li>  Les fichiers de configuration doivent fusionner dans l'arborescence de configuration </li><li>  La configuration doit √™tre sp√©cifique √† l'√©tape.  Chaque √©tape a son propre ensemble complet.  Ici, il convient de faire quelques r√©serves pour clarifier: <br><ul><li>  Vous <b>ne pouvez pas</b> r√©utiliser les valeurs des variables d'une autre √©tape <b>, √† l'exception de l'√©tape par d√©faut</b> , qui est r√©serv√©e aux valeurs par d√©faut. <br></li><li>  Lors du chargement de la configuration, vous devez effectuer une fusion r√©cursive de la couche de configuration √† partir de l'√©tape sp√©cifi√©e <b>au-dessus des valeurs par d√©faut avec la priorit√© de couche de l'√©tape sp√©cifi√©e.</b>  <b>Les valeurs (tableaux, etc.) ne doivent pas √™tre combin√©es.</b> </li><li>  S'il existe plusieurs fichiers de configuration pour une √©tape, les cl√©s qu'ils contiennent doivent √™tre fusionn√©es et, par cons√©quent, <b>doivent √™tre uniques les unes par rapport aux autres.</b> </li></ul><br></li><li>  L'√©tape actuelle utilis√©e doit √™tre d√©termin√©e par la valeur de la variable d'environnement ¬´STAGE¬ª.  La modification d'une variable dans une instance en cours d'ex√©cution d'un service n'est pas pr√©vue. </li><li>  Le chemin absolu vers le r√©pertoire de configuration doit √™tre d√©termin√© par la valeur de la variable d'environnement "CONFIG_PATH".  Pour plus de commodit√©, un repli est possible s'il n'y a pas de variable dans un certain chemin par d√©faut, ce qui devrait √™tre indiqu√© dans la documentation du module.  Dans ce cas, le chemin sp√©cifi√© doit √™tre relatif √† la racine du r√©pertoire d'application. </li></ol><br><br><h2>  Exemples de configuration </h2><br>  Supposons que nous ayons un service qui doit stocker les param√®tres de connexion √† Postgres, ainsi que certaines informations sur nous-m√™mes <br><br>  Vous devez d'abord d√©finir une configuration pour STAGE = defaults.  Nous y d√©crirons la structure g√©n√©rale et rendrons les donn√©es ind√©pendantes du stade. <br><br><h4>  par d√©faut </h4><br><pre><code class="javascript hljs"># configuration/defaults/service.yaml defaults: version: <span class="hljs-number"><span class="hljs-number">1.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> name: <span class="hljs-string"><span class="hljs-string">"config-example"</span></span> # configuration/defaults/redis.yaml defaults: redis: host: <span class="hljs-string"><span class="hljs-string">"host"</span></span> db: <span class="hljs-number"><span class="hljs-number">0</span></span> port: <span class="hljs-number"><span class="hljs-number">6379</span></span> password: <span class="hljs-string"><span class="hljs-string">"password"</span></span></code> </pre> <br><br><h4>  dev </h4><br><pre> <code class="javascript hljs"># configuration/dev/redis.yaml dev: redis: host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> password: <span class="hljs-string"><span class="hljs-string">"hard_pwd"</span></span></code> </pre><br><br><h4>  Configuration r√©sultante </h4><br><pre> <code class="javascript hljs">version: <span class="hljs-number"><span class="hljs-number">1.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> name: <span class="hljs-string"><span class="hljs-string">"config-example"</span></span> redis: host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> db: <span class="hljs-number"><span class="hljs-number">0</span></span> port: <span class="hljs-number"><span class="hljs-number">6379</span></span> password: <span class="hljs-string"><span class="hljs-string">"hard_pwd"</span></span></code> </pre><br><br><h2>  Conclusions </h2><br><br>  D'une mani√®re si astucieuse, nous avons r√©solu le probl√®me de la configuration des services dans notre zoo et avons tout mis en commun.  Cet exemple n'est qu'un point de d√©part et peut √™tre modifi√© selon les sp√©cificit√©s de votre projet. <br><br>  Pour ceux qui sont int√©ress√©s par cette m√©thode de configuration sous une forme ¬´nue¬ª: <br><div class="spoiler">  <b class="spoiler_title">Nos packages pour diff√©rents langages de programmation</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aller</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">php</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">js</a> </li></ul><br></div></div><br><br>  Pour l'aide √† l'√©criture devenir un merci sp√©cial √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Roque</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">SMGladkovskiy</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436630/">https://habr.com/ru/post/fr436630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436620/index.html">Une approche int√©gr√©e pour visualiser les √©v√©nements de s√©curit√© et mesurer son efficacit√©</a></li>
<li><a href="../fr436622/index.html">Botovodstvo</a></li>
<li><a href="../fr436624/index.html">√âtude: la plupart des utilisateurs ne comprennent pas comment Facebook g√®re leurs donn√©es.</a></li>
<li><a href="../fr436626/index.html">Python devient le langage de programmation le plus populaire au monde.</a></li>
<li><a href="../fr436628/index.html">Am√©lioration de l'agent Q-Learning bas√© sur les actions en ajoutant la r√©currence et les r√©compenses</a></li>
<li><a href="../fr436632/index.html">Comment nous construisons un syst√®me de traitement, de stockage et d'analyse des donn√©es dans SIBUR</a></li>
<li><a href="../fr436634/index.html">√Ä propos des param√®tres internes et externes pour l'application dans Unity3D</a></li>
<li><a href="../fr436636/index.html">Comment cr√©er un service de recommandation communautaire VKontakte</a></li>
<li><a href="../fr436638/index.html">Redistribution des fen√™tres entre les moniteurs apr√®s s'√™tre r√©veill√© du mode veille</a></li>
<li><a href="../fr436640/index.html">Mon exp√©rience de la publicit√© et du d√©veloppement d'applications Android et iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>