<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÄ üë©‚Äçüíª üñçÔ∏è Anwendungsf√§lle oder welche Load Balancer fehlen üíç üëÇüèæ üåÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor ein paar Jahren habe ich ein Migrationsprojekt im Netzwerk eines unserer Kunden abgeschlossen. Die Aufgabe bestand darin, die Plattform zu √§ndern,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anwendungsf√§lle oder welche Load Balancer fehlen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424115/">  Vor ein paar Jahren habe ich ein Migrationsprojekt im Netzwerk eines unserer Kunden abgeschlossen. Die Aufgabe bestand darin, die Plattform zu √§ndern, die die Last auf die Server verteilt.  Das Service-Provisioning-Schema dieses Clients hat sich in fast 10 Jahren zusammen mit neuen Entwicklungen in der Rechenzentrumsbranche weiterentwickelt. Daher erwartete der ‚Äûw√§hlerische‚Äú Kunde im besten Sinne eine L√∂sung, die nicht nur die Fehlertoleranzanforderungen von Netzwerkger√§ten, Load Balancern und Servern erf√ºllt , w√ºrde aber auch Eigenschaften wie Skalierbarkeit, Flexibilit√§t, Mobilit√§t und Einfachheit besitzen.  In diesem Artikel werde ich versuchen, die Hauptbeispiele f√ºr die Verwendung von Load Balancern ohne Bezugnahme auf den Hersteller, ihre Funktionen und Methoden zur Kopplung mit dem Datenlieferungsnetzwerk konsequent von einfach bis komplex darzulegen. <br><a name="habracut"></a><br>  Load Balancer werden zunehmend als Application Delivery Controller (ADCs) bezeichnet.  Aber wenn die Anwendungen auf dem Server ausgef√ºhrt werden, warum sollten sie irgendwo bereitgestellt werden?  Aus Gr√ºnden der Fehlertoleranz oder Skalierung kann die Anwendung auf mehr als einem Server ausgef√ºhrt werden. In diesem Fall ben√∂tigen Sie eine Art Reverse-Proxy-Server, der die interne Komplexit√§t vor den Verbrauchern verbirgt, den gew√ºnschten Server ausw√§hlt, eine Anforderung an ihn sendet und sicherstellt, dass der Server den richtigen zur√ºckgibt Aus Sicht des Protokolls wird das Ergebnis andernfalls ein anderer Server ausgew√§hlt und dort eine Anfrage gesendet.  Um diese Funktionen zu implementieren, muss der ADC die Semantik des Anwendungsschichtprotokolls verstehen, mit dem er arbeitet. Auf diese Weise k√∂nnen Sie anwendungsspezifische Regeln f√ºr die Verkehrs√ºbermittlung, die Analyse des Ergebnisses und die √úberpr√ºfung des Serverstatus konfigurieren.  Ein Verst√§ndnis der Semantik von HTTP erm√∂glicht beispielsweise die Konfiguration bei HTTP-Anforderungen <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /docs/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: www.company.com Accept-<span class="hljs-keyword"><span class="hljs-keyword">Language</span></span>: en-us Accept-<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>: gzip, deflate</code> </pre> <br>  werden an eine Gruppe von Servern gesendet, mit anschlie√üender Komprimierung der Ergebnisse und Zwischenspeicherung sowie Anforderungen <br><br><pre> <code class="hljs pgsql">POST /api/<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>-put HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> HOST: b2b.company.com X-Auth: <span class="hljs-number"><span class="hljs-number">76</span></span>GDjgtgdfsugs893Hhdjfpsj Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: application/<span class="hljs-type"><span class="hljs-type">json</span></span></code> </pre><br>  nach v√∂llig anderen Regeln verarbeitet. <br><br>  Wenn Sie die Semantik des Protokolls kennen, k√∂nnen Sie Sitzungen auf der Ebene der Objekte des Anwendungsprotokolls organisieren, z. B. mithilfe von HTTP-Headern, RDP-Cookies oder Multiplex-Anforderungen, um eine Transportsitzung mit vielen Benutzeranforderungen zu f√ºllen, sofern die Anwendungsebene des Protokolls dies zul√§sst. <br>  Der Anwendungsbereich von ADC wird manchmal nur durch die Bereitstellung von HTTP-Verkehr unangemessen vorgestellt. Tats√§chlich ist die Liste der unterst√ºtzten Protokolle f√ºr die meisten Hersteller viel umfangreicher.  Selbst wenn ADC nicht die Semantik des Anwendungsschichtprotokolls versteht, kann es n√ºtzlich sein, um verschiedene Aufgaben zu l√∂sen. Ich habe beispielsweise am Aufbau einer autarken virtuellen Farm von SMTP-Servern teilgenommen. W√§hrend der Spam-Angriffe nimmt die Anzahl der Instanzen mithilfe der Feedback-Steuerung √ºber die L√§nge der Nachrichtenwarteschlange zu eine zufriedenstellende Zeit f√ºr das √úberpr√ºfen von Nachrichten mit ressourcenintensiven Algorithmen bereitzustellen.  W√§hrend der Aktivierung hat sich der Server bei ADC registriert und seinen Teil der neuen TCP-Sitzungen erhalten.  Im Fall von SMTP war ein solches Betriebsschema aufgrund der hohen Entropie der Verbindungen auf Netzwerk- und Transportebene gerechtfertigt. F√ºr eine gleichm√§√üige Lastverteilung bei ADC-Spam-Angriffen ist nur TCP-Unterst√ºtzung erforderlich.  Ein √§hnliches Schema kann verwendet werden, um eine Farm aus Datenbankservern, hoch geladenen DNS-, DHCP-, AAA- oder RAS-Serverclustern zu erstellen, wenn die Server in der Dom√§ne als gleichwertig angesehen werden k√∂nnen und wenn sich ihre Leistungsmerkmale nicht zu stark voneinander unterscheiden.  Ich werde nicht weiter auf das Thema Protokollfunktionen eingehen. Dieser Aspekt ist zu umfangreich, um in der Einleitung dargelegt zu werden. Wenn etwas interessant erscheint - schreiben Sie, vielleicht ist dies eine Gelegenheit f√ºr einen Artikel mit einer tieferen Darstellung einer Anwendung, und jetzt kommen wir zum Punkt. <br><br>  In den meisten F√§llen schlie√üt ADC die Transportschicht, sodass die End-to-End-TCP-Sitzung zwischen dem Verbraucher und dem Server zusammengesetzt wird. Der Verbraucher richtet eine Sitzung mit ADC und ADC mit einem der Server ein. <br><br><img src="https://habrastorage.org/webt/qi/_9/vg/qi_9vglsdqfiqbtzbrsh-egpvwk.png" alt="Bild"><br>  <i>Abb. 1</i> <br><br>  Die Netzwerkkonfigurations- und Adressierungseinstellungen sollten einen solchen Verkehrsfortschritt erm√∂glichen, damit zwei Teile der TCP-Sitzung den ADC durchlaufen.  Die einfachste M√∂glichkeit, den Datenverkehr des ersten Teils zum ADC zu bringen, besteht darin, einer der ADC-Schnittstellenadressen eine Dienstadresse zuzuweisen. Im zweiten Teil sind die folgenden Optionen m√∂glich: <br><br><ol><li>  ADC als Standard-Gateway f√ºr das Servernetzwerk; </li><li>  Broadcast an ADC-Verbraucheradressen in einer seiner Schnittstellenadressen. </li></ol><br>  Tats√§chlich sieht eine etwas realistischere Ansicht des ersten Anwendungsschemas so aus. Dies ist die Grundlage, von der aus wir ausgehen werden: <br><br><img src="https://habrastorage.org/webt/6z/y8/5y/6zy85y1fcajgfndoybabz9geikk.png" alt="Bild"><br>  <i>Abb.2</i> <br><br>  Die zweite Gruppe von Servern kann Datenbanken, Anwendungs-Back-End, Netzwerkspeicher oder Front-End f√ºr einen anderen Satz von Diensten sein, wenn eine klassische Anwendung in Mikrodienste zerlegt wird.  Diese Gruppe von Servern kann eine separate Routingdom√§ne mit eigenen Richtlinien sein, die sich in einem anderen Rechenzentrum befindet, oder aus Sicherheitsgr√ºnden vollst√§ndig isoliert sein.  Server befinden sich selten im selben Segment, h√§ufiger werden sie f√ºr den beabsichtigten Zweck mit klar geregelten Zugriffsrichtlinien in Segmenten platziert. Die Abbildung zeigt dies als Firewall. <br><br>  Studien zeigen, dass moderne mehrschichtige Anwendungen mehr West-Ost-Verkehr erzeugen und es unwahrscheinlich ist, dass der gesamte Intra-Code- / Inter-Segment-Verkehr durch den ADC geleitet wird.  Die Switches in Abbildung 2 sind nicht unbedingt physisch. Routing-Dom√§nen k√∂nnen mithilfe virtueller Entit√§ten implementiert werden, die als Virtual-Router, VRF, VR, VPN-Instanz oder virtuelle Routing-Tabelle f√ºr verschiedene Hersteller bezeichnet werden. <br><br>  √úbrigens gibt es eine Variante der Kopplung mit dem Netzwerk, ohne dass eine Symmetrie der Verkehrsstr√∂me vom Verbraucher zum ADC und vom ADC zu den Servern erforderlich ist. Sie ist bei langlebigen Sitzungen gefragt, bei denen eine sehr gro√üe Menge an Verkehr in eine Richtung √ºbertragen wird, z. B. Streaming oder Videoinhalte senden.  In diesem Fall sieht der ADC nur den Stream vom Client zu den Servern. Dieser Stream wird an die ADC-Schnittstellenadresse gesendet. Nach einer einfachen Verarbeitung, die darin besteht, die MAC-Adresse durch die Schnittstellen-MAC eines der Server zu ersetzen, wird die Anforderung an den Server gesendet, auf dem die Dienstadresse einer der logischen Schnittstellen zugewiesen ist.  Der umgekehrte Verkehr vom Server zum Verbraucher umgeht den ADC gem√§√ü der Server-Routing-Tabelle.  Die Unterst√ºtzung einer einzelnen Broadcast-Dom√§ne f√ºr das gesamte Front-End kann sehr schwierig sein. Dar√ºber hinaus ist die F√§higkeit von ADC, Antworten zu analysieren und die Sitzungsf√§higkeit zu unterst√ºtzen, in diesem Fall sehr eingeschr√§nkt. Tats√§chlich handelt es sich nur um einen Wechsel. Daher wird diese Option nicht weiter betrachtet, obwohl einige eng sind Aufgaben k√∂nnen verwendet werden. <br><br><img src="https://habrastorage.org/webt/hm/xb/vs/hmxbvspqknpgsvws5uqbycydaps.png" alt="Bild"><br>  <i>Abb.3</i> <br><br>  Wir haben also ein Basisdatenzentrum (siehe Abbildung 2). Lassen Sie uns √ºberlegen, welche Probleme das Basisdatenzentrum zur Evolution f√ºhren k√∂nnen. Ich sehe zwei Themen f√ºr die Analyse: <br><br><ol><li>  Angenommen, das Switching-Subsystem ist vollst√§ndig reserviert. Denken wir nicht dar√ºber nach, wie oder warum das Thema zu umfangreich ist.  Anwendungen werden auf mehreren Servern ausgef√ºhrt und mit ADC gesichert. Wie reserviere ich den ADC selbst? </li><li>  Wenn die Analyse zeigt, dass die n√§chste saisonale Spitzenlast die F√§higkeiten von ADC √ºberschreiten kann, denken Sie nat√ºrlich an die Skalierbarkeit. </li></ol><br>  Diese Aufgaben sind insofern √§hnlich, als die Anzahl der ADC-Instanzen beim L√∂sen sicherlich zunimmt.  Gleichzeitig kann die Fehlertoleranz nach dem Schema Aktiv / Sicherung und Aktiv / Aktiv organisiert werden, und die Skalierung kann nur nach dem Schema Aktiv / Aktiv durchgef√ºhrt werden.  Versuchen wir, sie einzeln zu l√∂sen und herauszufinden, welche Eigenschaften verschiedene L√∂sungen haben. <br><br>  Die ADCs vieler Hersteller k√∂nnen als Elemente einer Netzwerkinfrastruktur, RIP, OSPF, BGP betrachtet werden - all dies ist vorhanden, was bedeutet, dass Sie ein triviales Aktiv / Backup-Sicherungsschema erstellen k√∂nnen.  Der aktive ADC √ºbergibt die Dienstpr√§fixe an den Upstream-Router und empf√§ngt von ihm die Standardroute, um seine Tabelle auszuf√ºllen und zum Rechenzentrum an die entsprechende virtuelle Routing-Tabelle zu √ºbertragen.  Der Backup-ADC macht dasselbe, generiert jedoch unter Verwendung der Semantik des ausgew√§hlten Routing-Protokolls weniger attraktive Ansagen.  Bei diesem Ansatz k√∂nnen Server die tats√§chliche IP-Adresse des Verbrauchers anzeigen, da kein Grund f√ºr die Adress√ºbersetzung besteht.  Dieses Schema funktioniert auch ordnungsgem√§√ü, wenn mehr als ein Upstream-Router vorhanden ist. Um jedoch eine Situation zu vermeiden, in der der aktive ADC die Standardeinstellung und die Konnektivit√§t mit dem Router verliert, w√§hrend er weiterhin die Standardeinstellung vom Sicherungs-ADC erh√§lt und diese weiterhin gegen√ºber dem Rechenzentrum ank√ºndigt, versuchen Sie, die N√§he zwischen diesen zu vermeiden ADC und die Verwendung statischer Routen. <br><br><img src="https://habrastorage.org/webt/l8/bw/di/l8bwdie61pvk2wibngd9jwgcco4.png" alt="Bild"><br>  <i>Abb. 4</i> <br><br>  Wenn die Server nicht mit echten Consumer-IP-Adressen arbeiten m√ºssen oder das Anwendungsschichtprotokoll das Einbetten in Header wie HTTP erm√∂glicht, wird das Schema in Active / Active umgewandelt, wobei die Leistung nahezu linear von der Anzahl der ADCs abh√§ngt.  Bei mehr als einem Upstream-Router muss darauf geachtet werden, dass der eingehende Datenverkehr in mehr oder weniger einheitlichen Abschnitten eintrifft.  Diese Aufgabe kann leicht gel√∂st werden, wenn in der ECMP-Routingdom√§ne die √úbertragung zu diesen Routern beginnt, wenn dies schwierig ist oder wenn die Routingdom√§ne nicht von Ihnen bedient wird. Sie k√∂nnen Vollnetzverbindungen zwischen ADX und den Routern verwenden, sodass die ECMP-√úbertragung direkt zu diesen Routern beginnt. <br><br><img src="https://habrastorage.org/webt/z3/wr/bu/z3wrbuedtvq62eabsourkdgxkvy.png" alt="Bild"><br>  <i>Abb.5</i> <br><br>  Zu Beginn dieses Teils habe ich geschrieben, dass Fehlertoleranz und Skalierung zwei gro√üe Unterschiede sind.  L√∂sungen f√ºr diese Probleme haben eine andere Ressourcennutzung. Wenn Sie ein Aktiv / Standby-Schema entwerfen, m√ºssen Sie sich damit abfinden, dass die H√§lfte der Ressourcen inaktiv ist.  Und wenn es so kommt, dass Sie den n√§chsten quantitativen Schritt unternehmen m√ºssen, sollten Sie darauf vorbereitet sein, die erforderlichen Ressourcen in Zukunft mit zwei weiteren zu multiplizieren. <br><br>  Die Vorteile von Aktiv / Aktiv zeigen sich, wenn Sie mit mehr als zwei Ger√§ten arbeiten.  Angenommen, Sie m√ºssen die Leistung von 8 beliebigen Einheiten (8.000 Verbindungen pro Sekunde oder 8 Millionen gleichzeitige Sitzungen) sicherstellen und ein Szenario mit einem einzelnen Ger√§tefehler bereitstellen. In der Active / Active-Version ben√∂tigen Sie im Fall von Active / Standby nur drei ADC-Instanzen mit einer Kapazit√§t von 4 -. zwei mal 8. Wenn Sie diese Zahlen in Ressourcen √ºbersetzen, die nicht genutzt werden, erhalten Sie ein Drittel bis eine H√§lfte.  Das gleiche Berechnungsprinzip kann verwendet werden, um den Anteil unterbrochener Verbindungen w√§hrend einer Teilausfallperiode abzusch√§tzen.  Mit zunehmender Anzahl von Aktiv / Aktiv-Instanzen wird die Mathematik noch angenehmer, und das System erh√§lt die M√∂glichkeit, die Produktivit√§t schrittweise zu steigern, anstatt schrittweise Aktiv / Standby. <br><br>  Es ist richtig, eine andere Art von Aktiv / Aktiv- oder Aktiv / Standby-Arbeitsschemata zu erw√§hnen - Clustering.  Aber es wird nicht sehr richtig sein, viel Zeit darauf zu verwenden, da ich versucht habe, √ºber Ans√§tze und nicht √ºber die Merkmale von Herstellern zu schreiben.  Bei der Auswahl dieser L√∂sung m√ºssen Sie die folgenden Dinge klar verstehen: <br><br><ol><li>  Die Cluster-Architektur schr√§nkt diese oder jene Funktionalit√§t manchmal ein. In einigen Projekten ist dies von grundlegender Bedeutung. In einigen Projekten kann dies in Zukunft wichtig werden. Alles h√§ngt vom Hersteller ab und jede L√∂sung muss einzeln ausgearbeitet werden. </li><li>  Der Cluster ist h√§ufig eine Fehlerdom√§ne, und es treten Fehler in der Software auf. </li><li>  Der Cluster ist leicht zu montieren, aber sehr schwer zu zerlegen.  Technologie ist weniger mobil - Sie k√∂nnen keine Teile des Systems steuern. </li><li>  Sie fallen in die z√§he Umarmung Ihres Herstellers. </li></ol><br>  Trotzdem gibt es positive Dinge: <br><br><ol><li>  Der Cluster ist einfach zu installieren und zu bedienen. </li><li>  Manchmal k√∂nnen Sie eine nahezu optimale Ressourcennutzung erwarten. </li></ol><br>  Unser Rechenzentrum aus Abbildung 5 w√§chst also weiter. Die Aufgabe, die Sie m√∂glicherweise l√∂sen m√ºssen, besteht darin, die Anzahl der Server zu erh√∂hen.  Dies ist in einem vorhandenen Rechenzentrum nicht immer m√∂glich. Nehmen wir also an, dass ein neuer ger√§umiger Standort mit zus√§tzlichen Servern angezeigt wurde. <br><br><img src="https://habrastorage.org/webt/o5/kq/fo/o5kqfoeksqpzk09cfrlmdluxts8.png" alt="Bild"><br>  <i>Abb.6</i> <br><br>  Eine neue Site ist m√∂glicherweise nicht sehr weit entfernt. Dann k√∂nnen Sie das Problem erfolgreich l√∂sen, indem Sie die Routing-Dom√§nen erneuern.  Ein allgemeinerer Fall, der das Erscheinungsbild der Site in einer anderen Stadt oder in einem anderen Land nicht ausschlie√üt, stellt das Rechenzentrum vor neue Herausforderungen: <br><br><ol><li>  Nutzung von Kan√§len zwischen Standorten; </li><li>  Der Unterschied in der Verarbeitungszeit f√ºr Anforderungen, die ADC zur Verarbeitung an nahe und entfernte Server gesendet hat. </li></ol><br>  Die Aufrechterhaltung eines breiten Kanals zwischen Standorten kann ein sehr kostspieliges Unterfangen sein, und die Auswahl eines Standorts ist keine triviale Aufgabe mehr - ein √ºberlasteter Standort mit kurzer Reaktionszeit oder kostenlos mit einem gro√üen Standort.  Wenn Sie dar√ºber nachdenken, m√ºssen Sie eine geografisch verteilte Rechenzentrumskonfiguration erstellen.  Diese Konfiguration ist einerseits verbraucherfreundlich, da Sie damit Dienste an einem Punkt in Ihrer N√§he empfangen k√∂nnen, andererseits k√∂nnen die Anforderungen an das Kanalband zwischen Standorten erheblich reduziert werden. <br><br>  F√ºr den Fall, dass echte IP-Adressen f√ºr die Server nicht zug√§nglich sein m√ºssen oder wenn das Anwendungsschichtprotokoll die √úbertragung in den Headern erm√∂glicht, unterscheidet sich das Ger√§t eines geografisch verteilten Rechenzentrums nicht wesentlich von dem, was ich als Basisdatenzentrum bezeichnet habe.  ADC kann an jedem Standort Verarbeitungsanforderungen an lokale Server senden oder diese zur Verarbeitung an einen benachbarten Server senden. Die √úbertragung der Verbraucheradresse macht dies m√∂glich.  Es sollte ein gewisses Augenmerk auf die √úberwachung des eingehenden Verkehrsvolumens gelegt werden, um die ADC-Menge innerhalb des Standorts so zu halten, dass sie dem Anteil des Verkehrs entspricht, den der Standort empf√§ngt.  Mit der √úbersetzung von Verbraucheradressen k√∂nnen Sie die Anzahl der ADCs erh√∂hen / verringern oder sogar Instanzen zwischen Standorten entsprechend den √Ñnderungen in der Matrix f√ºr eingehenden Datenverkehr oder w√§hrend der Migration / des Starts verschieben.  Trotz seiner Einfachheit ist das Schema sehr flexibel, weist angenehme Betriebseigenschaften auf und l√§sst sich leicht f√ºr mehr als zwei Standorte replizieren. <br><br><img src="https://habrastorage.org/webt/4f/3k/e0/4f3ke0imkvzickwdmswg76qo8ts.png" alt="Bild"><br>  <i>Abb. 7</i> <br><br>  Wenn Sie mit einem Protokoll arbeiten, das Weiterleitungsanforderungen erm√∂glicht, wie im Fall der HTTP-Umleitung, kann diese Funktion als zus√§tzlicher Hebel zur Steuerung der Kanallast zwischen Standorten, als Mechanismus f√ºr die routinem√§√üige Wartung auf Servern oder als Methode zum Erstellen von Active / Backup-Serverfarmen auf verschiedenen Servern verwendet werden Websites.  Zum erforderlichen Zeitpunkt, automatisch oder nach einigen Ausl√∂seereignissen, kann ADC Datenverkehr von lokalen Servern entfernen und Verbraucher an einen benachbarten Standort verschieben.  Es lohnt sich, der Entwicklung dieses Algorithmus besondere Aufmerksamkeit zu widmen, damit die koordinierte Arbeit von ADC die M√∂glichkeit der gegenseitigen Weiterleitung von Anfragen oder Resonanz ausschlie√üt. <br><br>  Von besonderem Interesse ist der Fall, wenn die Server echte IP-Adressen von Verbrauchern ben√∂tigen und das Protokoll der Anwendungsschicht nicht in der Lage ist, zus√§tzliche Header zu √ºbertragen, oder wenn ADCs arbeiten, ohne die Semantik des Protokolls der Anwendungsschicht zu verstehen.  In diesem Fall ist es nicht m√∂glich, eine konsistente Verbindung zwischen TCP-Sitzungssegmenten herzustellen, indem einfach eine Route im ADC-Standard deklariert wird.  Wenn Sie dies tun, verwenden die Server des ersten Standorts den lokalen ADC als Standardgateway f√ºr die Sitzungen, die vom zweiten Standort stammen. In diesem Fall wird die TCP-Sitzung nicht eingerichtet, da der ADC des ersten Standorts nur eine Schulter der Sitzung sieht. <br><br><img src="https://habrastorage.org/webt/bh/zs/sg/bhzssgahst0iwxcsj_-rzpnzy4k.png" alt="Bild"><br>  <i>Abb. 8</i> <br><br>  Es gibt einen kleinen Trick, mit dem Sie Active / Active ADC weiterhin in Kombination mit Active / Active-Serverfarmen an verschiedenen Standorten ausf√ºhren k√∂nnen (ich betrachte den Fall von Active / Backup an zwei Standorten nicht, eine sorgf√§ltige Lekt√ºre der obigen Informationen erm√∂glicht es Ihnen, dieses Problem ohne weitere Diskussion zu l√∂sen).  Der Trick besteht darin, auf dem ADC des zweiten Standorts nicht die Serverschnittstellenadressen zu verwenden, sondern die logische ADC-Adresse, die der Serverfarm am ersten Standort entspricht.  Gleichzeitig empfangen die Server Datenverkehr wie vom lokalen ADC und verwenden das lokale Standardgateway.  Um diesen Betriebsmodus auf dem ADC beizubehalten, m√ºssen Sie die Speicherfunktion der Schnittstelle aktivieren, von der das erste Paket zum Einrichten der TCP-Sitzung stammt.  Verschiedene Hersteller nennen diese Funktion unterschiedlich, aber das Wesentliche ist dasselbe - merken Sie sich die Schnittstelle in der Sitzungsstatustabelle und verwenden Sie sie f√ºr den Antwortverkehr, ohne auf die Routing-Tabelle zu achten.  Das Schema ist voll funktionsf√§hig und erm√∂glicht es Ihnen, die Last flexibel auf alle verf√ºgbaren Server zu verteilen, wo immer sie sich befinden.  Bei zwei oder mehr Standorten wirkt sich der Ausfall eines ADC nicht auf die Verf√ºgbarkeit des gesamten Dienstes aus, schlie√üt jedoch die M√∂glichkeit der Verarbeitung von Datenverkehr auf Standortservern mit ausgefallenen ADCs vollst√§ndig aus. Dies sollte bei der Vorhersage des Verhaltens und der Auslastung bei Teilausf√§llen ber√ºcksichtigt werden. <br><br><img src="https://habrastorage.org/webt/j8/c5/n0/j8c5n0oqpzijkfiz3dbyrrxeaww.png" alt="Bild"><br>  <i>Abb. 9</i> <br><br>  Die Dienste unseres Kunden funktionierten ungef√§hr genauso, als ich anfing, an einem Migrationsprojekt zur neuen ADC-Plattform zu arbeiten.  Es war nicht schwierig, das Verhalten der Ger√§te der alten Plattform auf der neuen Plattform im Rahmen eines bew√§hrten und kundenfreundlichen Schemas einfach nachzubilden. Dies haben sie von uns erwartet. <br><br>  Aber sehen Sie sich noch einmal Abbildung 9 an. Sehen Sie, was dort optimiert werden kann? <br>  Der Hauptnachteil der Arbeit mit der ADC-Kette besteht darin, dass sie die Ressourcen von zwei ADCs verbraucht, um einen Teil der Sitzungen zu verarbeiten.  Bei diesem Client war die Auswahl absolut bewusst, da dies auf die Besonderheiten der Anwendungen und die Notwendigkeit zur√ºckzuf√ºhren war, die Last sehr schnell (von 20 bis 50 Sekunden) auf Server verschiedener Standorte umverteilen zu k√∂nnen.  Zu verschiedenen Zeitpunkten beanspruchte die Doppelverarbeitung durchschnittlich 15 bis 30 Prozent der ADC-Ressourcen, was ausreicht, um √ºber eine Optimierung nachzudenken.  Nachdem wir diesen Punkt mit den Ingenieuren des Clients besprochen hatten, schlugen wir vor, die Unterst√ºtzung f√ºr die ADC-Sitzungstabelle durch Schnittstellenbindung durch Quellrouting auf Servern zu ersetzen, die PBR auf dem Linux-IP-Stack verwenden.  Als Schl√ºssel haben wir folgende Optionen in Betracht gezogen: <br><br><ol><li>  zus√§tzliche IP-Adresse auf Servern auf einer gemeinsamen Schnittstelle f√ºr jeden ADC; </li><li>  Schnittstellen-IP-Adresse auf Servern auf einem separaten 802.1q f√ºr jeden ADC; </li><li>  Separates Overlay-Tunnelnetzwerk auf Servern f√ºr jeden ADC. </li></ol><br>  Die erste und die zweite Option w√ºrden sich irgendwie auf das gesamte Netzwerk auswirken.  Unter den Nebenwirkungen von Option 1 schien es uns inakzeptabel, dass eine Erh√∂hung, die ein Vielfaches der Anzahl von ADC-, ARP-Tabellen auf den Switches und der zweiten Option war, eine Erh√∂hung der Anzahl von End-to-End-Broadcast-Dom√§nen zwischen Standorten oder einzelnen Instanzen von virtuellen Routing-Tabellen erfordern w√ºrde.  Die lokale Natur der dritten Option schien uns sehr attraktiv zu sein, und wir machten uns an die Arbeit, was zu einem einfachen Controller f√ºhrte, der die Konfiguration von Tunneln auf Servern und ADC sowie die PBR-Konfiguration auf dem IP-Stack von Linux-Servern automatisiert. <br><br><img src="https://habrastorage.org/webt/6a/io/9_/6aio9_jovjmxyo2n2qtuamfzlji.png" alt="Bild"><br>  <i>Abb. 10</i> <br><br>  Wie ich schrieb, war die Migration abgeschlossen, der Client bekam, was er wollte - eine neue Plattform, Einfachheit, Flexibilit√§t, Skalierbarkeit und als Ergebnis des Wechsels zu einem Overlay die Vereinfachung der Konfiguration von Netzwerkger√§ten im Rahmen der Wartung dieser Dienste - anstelle mehrerer Kopien von virtuellen Tabellen und gro√üen Broadcast-Dom√§nen -   IP . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kollegen, die mit ADC-Herstellern zusammenarbeiten, dieser Absatz konzentriert sich mehr auf Sie. Einige Ihrer Produkte sind gut, aber achten Sie auf eine engere Integration mit Anwendungen auf Servern, die Automatisierung ihrer Einstellungen und die Orchestrierung des gesamten Entwicklungs- und Betriebsprozesses. Dies scheint mir in Form einer klassischen Controller-Agent-Interaktion zu sein, bei der √Ñnderungen am ADC vorgenommen werden. Der Benutzer leitet die Berufung des Controllers an registrierte Agenten ein. Dies haben wir mit dem Client getan, aber "out of the box".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus ist es f√ºr einige Kunden m√∂glicherweise bequem, von einem PULL-Modell f√ºr die Interaktion mit Servern zu einem PUSH-Modell zu wechseln. Die Anwendungsfunktionen auf den Servern sind sehr umfangreich, sodass es manchmal einfacher ist, eine ernsthafte anwendungsspezifische √úberpr√ºfung des Dienstes auf dem Agenten selbst zu organisieren. Wenn die Pr√ºfung ein positives Ergebnis liefert, √ºbertr√§gt der Agent Informationen, beispielsweise in einer Form √§hnlich der BGP-Kostengemeinschaft, zur Verwendung in gewichteten Berechnungsalgorithmen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√§ufig f√ºhren verschiedene Abteilungen einer Organisation eine Server- und ADC-Wartung durch. Der Wechsel zu einem PUSH-Interaktionsmodell kann interessant sein, da bei diesem Modell keine Koordination zwischen Abteilungen √ºber eine Mensch-Person-Schnittstelle erforderlich ist. Dienste, an denen der Server teilnimmt, k√∂nnen in Form einer √§hnlichen Funktion wie die erweiterte BGP Flow-Spec direkt vom Agenten an den ADC √ºbertragen werden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt noch viel mehr zu schreiben. Warum bin ich das alles? Da wir die freie Wahl haben, entscheiden wir uns f√ºr eine bequemere, geeignetere oder f√ºr eine Option, die das Zeitfenster erweitert, um unsere Risiken zu minimieren. Gro√üe Akteure in der Internetbranche erfinden etwas v√∂llig Innovatives, um ihre Probleme zu l√∂sen, was morgen vorgeschrieben ist. Kleinere Akteure und Unternehmen mit Erfahrung in der Softwareentwicklung verwenden zunehmend Technologien und Produkte, die eine tiefgreifende Anpassung f√ºr sich selbst erm√∂glichen. Viele Hersteller von Load Balancern stellen einen R√ºckgang der Nachfrage nach ihren Produkten fest. Mit anderen Worten, die Server und Anwendungen, die vor einiger Zeit auf ihnen, Switches und Routern ausgef√ºhrt wurden, haben sich bereits qualitativ ver√§ndert und sind in die SDN-√Ñra eingetreten. Die Balancer sind an der SchwelleF√ºhren Sie diesen Schritt bei ge√∂ffneter T√ºr aus, da Sie sonst den Wettbewerbsvorteil verlieren und an die Peripherie wechseln k√∂nnen.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424115/">https://habr.com/ru/post/de424115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424105/index.html">Die NASA wei√ü, wie man den Mars wieder gr√ºn macht</a></li>
<li><a href="../de424107/index.html">Es ist ein Jahr seit der L√ºcke im My Cloud-Heimnetzwerkspeicher von WD vergangen</a></li>
<li><a href="../de424109/index.html">VSCE # 2: Podcast f√ºr Medienunternehmer</a></li>
<li><a href="../de424111/index.html">Smart Contracts Waves. Erste Erfahrung</a></li>
<li><a href="../de424113/index.html">Designprozess, Forschung und Jobsuche</a></li>
<li><a href="../de424121/index.html">Erstellen einer Triggerfunktion in pgModeler</a></li>
<li><a href="../de424127/index.html">Wie man Freunde findet Ovirt und Let's Encrypt</a></li>
<li><a href="../de424129/index.html">Android-Entwicklung. Ein bisschen √ºber die schnelle Arbeit mit Listen</a></li>
<li><a href="../de424131/index.html">Manifest f√ºr Entwickler intelligenter Systeme: 15 Prinzipien</a></li>
<li><a href="../de424133/index.html">Virtualisierung von Arbeitspl√§tzen f√ºr das Architekturb√ºro aus geisteswissenschaftlicher Sicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>