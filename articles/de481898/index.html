<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ìÇÔ∏è üßê üíáüèº Einfacher Webserver f√ºr SPA / PWA in 5 Minuten üè∏ üëÉüèº üßîüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So erstellen Sie einen einfachen Webserver mithilfe der Anweisungen f√ºr Standardknoten 


 Oft wird ein einfacher Webserver ben√∂tigt, um MPA / SPA / P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einfacher Webserver f√ºr SPA / PWA in 5 Minuten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481898/"><h1 id="kak-sozdat-prostoy-veb-server-ispolzuya-tolko-standartnye-instrukcii-nodejs">  So erstellen Sie einen einfachen Webserver mithilfe der Anweisungen f√ºr Standardknoten </h1><br><p> Oft wird ein einfacher Webserver ben√∂tigt, um MPA / SPA / PWA-Anwendungen zu entwickeln.  Einmal sagte ich bei einer gro√üen Kundgebung auf die Frage: ‚ÄûWas haben Sie getan?‚Äú, Dass ich einen Webserver f√ºr das Hosten einer PWA-Anwendung aufstellte.  Wir haben alle lange gelacht und ja, PWA ist √ºbrigens kein Klebstoff.  Wie SPA ist es kein Sch√∂nheitssalon.  Dies sind alle Arten von Webanwendungen.  Und SSR ist kein Land :-).  Wenn Sie eine solche Anwendung einfach durch √ñffnen der Startseite von index.html √ºber einen Browser starten, funktioniert sie nicht ordnungsgem√§√ü. Im besten Fall erhalten Sie eine Offline-Version.  Ich liebe JavaScript und werde das Problem sozusagen mit den mir zur Verf√ºgung stehenden Mitteln l√∂sen. </p><a name="habracut"></a><br><p>  Beginnen wir mit dem Plan: </p><br><ol><li>  Wenn kein <a href="https://nodejs.org/dist/">NodeJS</a> vorhanden ist <a href="https://nodejs.org/dist/">,</a> laden Sie LTS herunter, installieren Sie, √§ndern Sie die Einstellungen nicht, und klicken Sie auf <a href="https://nodejs.org/dist/">Weiter</a> </li><li>  Erstellen Sie an unserem abgelegenen Ort, an dem alle Projekte gesammelt werden, den Ordner <strong>simple-web-server</strong> </li><li>  F√ºhren Sie im Projektordner den Befehl npm init --yes // without --yes aus. Der Initialisierer stellt viele Fragen </li><li>  <strong>F√ºgen Sie</strong> in der Datei <strong>package.json</strong> im Abschnitt <strong>scripts</strong> die Eigenschaft und ihren Wert <strong>"main": "index.js" hinzu,</strong> damit wir unseren Server mit dem Befehl npm run schnell starten k√∂nnen </li><li>  Erstellen eines <strong>lib-</strong> Ordners Es wird empfohlen, den gesamten Code darin abzulegen, was keine Assemblierung und zus√§tzliche Schritte f√ºr den Betrieb erfordert </li><li>  Erstellen Sie eine <strong>index.js-</strong> Datei im Ordner <strong>lib</strong> <strong>.</strong> Dies ist unser zuk√ºnftiger Server. </li><li>  Erstellen Sie einen <strong>dist-</strong> Ordner - dies ist der Ordner, in dem √∂ffentlich zug√§ngliche Dateien gespeichert werden, einschlie√ülich index.html, dh die statische Aufladung, die unser Server verteilt </li><li>  √ñffnen Sie die Datei /index.js </li><li>  Schreiben Sie einen Code </li></ol><br><p>  Was wissen wir also dar√ºber, was unser Server tun soll? </p><br><ol><li>  Anfragen bearbeiten </li><li>  Dateien lesen </li><li>  Auf Anfrage mit Dateiinhalt antworten </li></ol><br><p>  Erstellen Sie zuerst unseren Server und importieren Sie ihn in die Datei <strong>idex.js</strong> </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createServer} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>);</code> </pre> <br><p>  Diese Anweisung zerst√∂rt das Objekt des <a href="http.html"><strong>http-</strong></a> Moduls und weist dem Variablenbezeichner <a href="http_createserver.asp"><strong>createServer</strong></a> einen Ausdruck, die Funktion <a href="http_createserver.asp"><strong>createServer</strong></a> , zu. </p><br><p>  Erstellen Sie einen neuen Server mit der folgenden Anweisung </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = createServer();</code> </pre> <br><p>  Wenn Sie zum ersten Mal zum Server-Host wechseln, sendet der Browser eine Anforderung zum Empfang des Dokuments.  Um dieses Ereignis verarbeiten zu k√∂nnen, m√ºssen wir daher auf solche Anfragen h√∂ren.  Der von uns erstellte Server hat eine <strong>Listen-</strong> Methode, als Parameter √ºbergeben wir die Portnummer 3000. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eventsEmitter = server.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre> <br><p>  Der Ausdruck dieser Methode ist ein <a href="https://nodejs.org/api/events.html"><strong>EventEmitter-</strong></a> Objekt, das in einer Variablen mit dem Bezeichner <strong>eventsEmitter gespeichert wird</strong> .  Dieses Objekt ist beobachtbar.  Wir abonnieren seine Ereignisse mithilfe des Methodenaufrufs <a href="https://nodejs.org/api/events.html"><strong>on / addEventListener</strong></a> mit zwei erforderlichen <a href="https://nodejs.org/api/events.html"><strong>Stringfunktionsparametern</strong></a> .  Der erste Parameter gibt an, welche Ereignisse f√ºr uns von Interesse sind, <a href="&amp;xid=17259,15700022,15700043,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhiBbozLJiaKS2e-qQGNzDQTiEnE4g#"><strong>der</strong></a> zweite Parameter ist eine Funktion, die dieses Ereignis verarbeitet. </p><br><pre> <code class="javascript hljs"> eventsEmitter.on(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span>; });</code> </pre> <br><p>  √ñffnen Sie den <a href="http://localhost:3000/">Link</a> im Browser </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ad7/533/9ab/ad75339aba986a5e052325240422696c.png" alt="Bild"></p><br><p>  Also haben wir uns auf die Anweisungen f√ºr den Debugger geeinigt.  Wir sehen, dass wir als Parameter zwei Objekte vom Typ <a href="&amp;xid=17259,15700022,15700043,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhiBbozLJiaKS2e-qQGNzDQTiEnE4g#http_class_"><strong>req</strong></a> , <a href="&amp;xid=17259,15700022,15700043,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhiBbozLJiaKS2e-qQGNzDQTiEnE4g#http_class_"><strong>res erhalten</strong></a> . Diese Objekte sind Instanzen von Objekten vom Typ <a href="https://nodejs.org/api/stream.html">stream,</a> daher ist <a href="https://nodejs.org/api/stream.html"><strong>req</strong></a> der <a href="https://nodejs.org/api/stream.html"><strong>Lesestream</strong></a> und <a href="https://nodejs.org/api/stream.html"><strong>res</strong></a> der Schreibestream. </p><br><p>  Wir haben die Anfrage bearbeitet und k√∂nnen sagen, dass "die Sache im Hut ist".  Jetzt m√ºssen Sie nur noch die Datei lesen und zur√ºckgeben.  Zuerst m√ºssen Sie verstehen, welche Art von Datei wir ben√∂tigen.  Nachdem ich im Debugger alle Eigenschaften des <strong>req-</strong> Parameters untersucht hatte, sah ich, dass er die <strong>url-</strong> Eigenschaft hat.  Aber es gibt nichts <strong>Vergleichbares</strong> wie <strong>index.html</strong> . </p><br><p>  Schauen wir uns noch einmal unseren Browser an: Wir sehen, dass wir dies nicht explizit angegeben haben.  Versuchen wir es noch einmal, aber wir geben <a href="http://localhost:3000/index.html">index.html</a> bereits explizit an. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b98/ff2/fb4/b98ff2fb48f53fd0e89b94103a2802b7.png" alt="Bild"></p><br><p>  Jetzt ist klar, dass der Dateiname in der Anfrage in der <strong>url-</strong> Eigenschaft enthalten ist und nichts weiter als dies. Wir m√ºssen die Datei nicht aus der Anfrage lesen.  Wir zerlegen es in geschweifte Klammern, geben den Namen der <strong>URL-</strong> Eigenschaft an und setzen √ºber den Operator <strong>:</strong> einen beliebigen Namen unter Verwendung einer g√ºltigen Variablenkennung, in meinem Fall <strong>requestUrl</strong> . </p><br><pre> <code class="javascript hljs"> eventsEmitter.addListener(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, ({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: requestUrl}, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span> });</code> </pre> <br><p>  Gro√üartig, was kommt als n√§chstes?  In Wahrheit mag ich die Tatsache, dass index.html immer explizit angegeben werden muss, nicht wirklich, also lasst uns dieses Problem sofort l√∂sen.  Ich entschied, dass der einfachste Weg dies zu tun ist, die standardm√§√üige <a href="https://nodejs.org/api/path.html"><strong>extname-</strong></a> Funktion zu verwenden <a href="https://nodejs.org/api/path.html"><strong>,</strong></a> die im Standardpaket enthalten ist <br>  NodeJS des Pfadmoduls importieren wir mit der folgenden Anweisung. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Sie k√∂nnen es jetzt aufrufen, indem Sie den requestUrl-Bezeichnerausdruck als Parameter √ºbergeben und den Ausdruck f√ºr die Zeichenfolge im ungef√§hren Format <code>'.extension'</code> .  Wenn die Anforderung keine Datei explizit angibt, wird eine leere Zeichenfolge zur√ºckgegeben.  Nach diesem Prinzip f√ºgen wir den Standardwert <strong>'index.html' hinzu</strong> .  Wir schreiben die folgende Anweisung </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = extname(requestUrl) === <span class="hljs-string"><span class="hljs-string">''</span></span> ? DEFAULT_FILE_NAME : requestUrl;</code> </pre> <br><p>  Ich bin sicher, dass der Serverbenutzer diesen Namen √ºberschreiben und mit der folgenden Anweisung auch eine Umgebungsvariable einrichten m√∂chte </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>}} = process;<span class="hljs-string"><span class="hljs-string">`</span></span></code> </pre> <br><p>  In der globalen Variablen <a href="https://nodejs.org/api/process.html"><strong>verarbeiten</strong></a> viele n√ºtzliche Informationen, ich begrabe nur einen Teil davon, insbesondere die <a href="https://nodejs.org/api/process.html"><strong>env-</strong></a> Eigenschaft, die alle Eigenschaften der Benutzerumgebung enth√§lt, und wir werden bereits nach <strong>DEFAULT_FILE_NAME</strong> suchen, wenn der Benutzer sie nicht angibt. Wir verwenden standardm√§√üig index.html. </p><br><blockquote>  WICHTIG: Wenn der Wert der Umgebungseigenschaft DEFAULT_FILE_NAME alles andere als undefiniert ist, funktioniert das Zuweisen eines Standardwerts nicht.  Das ist es wert, in Erinnerung zu bleiben, aber jetzt tun wir alles auf ein Minimum :-) </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/0db/3cf/e97/0db3cfe97b528ef15c02994bad3781f3.png" alt="Bild"></p><br><p>  Da wir nun einen relativen Link zur Datei haben, m√ºssen wir den absoluten Pfad zur Datei im Dateisystem unseres Servers ermitteln.  Wir haben beschlossen, dass alle √∂ffentlichen Dateien im Ordner <strong>dist</strong> gespeichert werden. Um den <strong>absoluten Pfad zu der Datei zu ermitteln</strong> , verwenden wir eine andere <a href="https://nodejs.org/api/path.html"><strong>Aufl√∂sungsfunktion</strong></a> aus dem Modul, das wir bereits kennen <br>  <a href="https://nodejs.org/api/path.html"><strong>Pfad</strong></a> einfach in der zuvor erstellten Anweisung in Zeile 5 angeben </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {resolve, extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Als n√§chstes schreiben wir in Zeile 10 eine Anweisung, die den <strong>absoluten Pfad zur</strong> <strong>filePath-</strong> Variablen empf√§ngt und speichert <strong>.</strong> Ich habe auch im Voraus ‚Äûgewartet‚Äú, dass der Name dieses Ordners aus <strong>Gr√ºnden der</strong> Flexibilit√§t neu definiert werden kann.  Daher erweitere ich die Anweisung in Zeile 6 und f√ºge den Namen hinzu <br>  Umgebungsvariable <strong>DIST_FOLDER</strong> ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/128/919/e1f/128919e1ffb4aed7911e31764414ee4b.png" alt="Bild"></p><br><p>  Jetzt ist alles bereit, um die Datei zu lesen.  Sie k√∂nnen eine Datei auf verschiedene Arten asynchron oder synchron lesen oder <a href="https://nodejs.org/api/stream.html">Streams verwenden</a> .  Ich werde Streams verwenden :-) Es ist sch√∂n und effektiver, aus der Sicht der verbrauchten Ressourcen.  Erstellen Sie zun√§chst eine Testdatei im Ordner <strong>dist,</strong> damit Sie etwas zu lesen haben :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Jetzt ben√∂tigen wir eine Funktion, die einen Dateilesestream erstellt. Sie ist auch in der Standard-NodeJS-Distribution enthalten. Wir extrahieren sie aus dem <a href="https://nodejs.org/api/fs.html"><strong>fs-</strong></a> Modul mithilfe der folgenden Anweisung </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createReadStream} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p>  und in Zeile 12 im Hauptteil des Anforderungsprozessors verwenden wir die folgende Anweisung </p><br><pre> <code class="javascript hljs"> createReadStream(filePath)</code> </pre> <br><p>  Infolgedessen wird die Instanz des Read-Stream-Objekts mit diesem Objekt zur√ºckgegeben <br>  Wir k√∂nnen die gelesenen Streams auf den schreibenden Stream umschalten, wir k√∂nnen die Streams auch transformieren und viele andere n√ºtzliche Dinge.  Der Parameter <strong>res</strong> ist also ein Lesestream, oder? </p><br><p>  Lassen Sie uns versuchen, den Dateilesestream, den wir erstellt haben, sofort in den <strong>res</strong> write-Stream f√ºr zu <strong>√§ndern</strong> <br>  In Zeile 12 setzen wir den Befehl durch Aufrufen der <strong>Pipe-</strong> Methode fort und √ºbergeben als Parameter unseren Write-Stream <strong>res</strong> </p><br><pre> <code class="javascript hljs"> createReadStream(filePath).pipe(res);</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/412/712/851/412712851c4ce2bcc2bf4a2bcb36ef86.png" alt="Bild"></p><br><p>  Ist das alles  Nein.  Und wer wird die Fehler behandeln?  Was f√ºr Fehler?  Versuchen wir, die CSS-Datei in die Datei index.html hochzuladen, aber wir werden sie nicht erstellen und sehen, was passiert :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index1.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/487/052/185/487052185b1c4adc32a05f658c7dafb6.jpg" alt="Bild"></p><br><p>  Erwartet, aber der Server ist abgest√ºrzt!  Dies ist √ºberhaupt nicht der Fall.  Tatsache ist, dass Fehler standardm√§√üig nicht in Streams abgefangen werden und Sie dies selbst tun m√ºssen :-) <strong>createReadStream</strong> gibt den Stream zur√ºck, in dem der Fehler auftritt.  Aus diesem Grund f√ºgen wir einen Fehlerbehandler hinzu.  Aufruf der Methode <strong>on</strong> . Angabe des Namens des <strong>Fehlerereignisses</strong> und des Handlers einer Funktion.  Der gelesene Lesestream wird mit einem 404-Antwortcode beendet. </p><br><pre> <code class="javascript hljs"> createReadStream(filePath) .on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, error =&gt; res.writeHead(<span class="hljs-number"><span class="hljs-number">404</span></span>).end()) .pipe(res);</code> </pre> <br><p>  √ºberpr√ºfen! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/747/29e/584/74729e584b652a032a34c5a82d754a2d.jpg" alt="Bild"></p><br><p>  Eine andere Sache.  Der Server ist √ºbrigens noch nicht bereit und wenn wir versuchen, ihn in einem anderen Browser zu √∂ffnen, funktioniert die Seite nicht richtig :-) Wer hat es erraten, bitte schreiben Sie in die Kommentare, was haben Sie vergessen zu tun?  Tatsache ist, dass, wenn ein Server die Anfrage eines Servers mit einer Datei beantwortet, eine Erweiterung nicht ausreicht, damit der Browser den Dateityp und die anderen Browser verstehen kann: Weder Chrome noch √§ltere Versionen funktionieren mit heruntergeladenen Dateien, ohne den Antwortheader f√ºr den Inhaltstyp anzugeben. Bei der Verarbeitung der Datei muss unser Server unter anderem den <a href="https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME-Typ</a> angeben <a href="https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types">.</a> Dazu erstellen wir eine separate Variable mit allen g√§ngigen Typen.  Wir bieten auch die M√∂glichkeit, sie durch √úbergabe als Umgebungsvariable zu erweitern </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>, DIST_FOLDER = <span class="hljs-string"><span class="hljs-string">'dist'</span></span>, DEFAULT_MIME_TYPES = <span class="hljs-string"><span class="hljs-string">'{}'</span></span>}} = process; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {text} = mimeTypes = { <span class="hljs-string"><span class="hljs-string">'html'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'png'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>, <span class="hljs-string"><span class="hljs-string">'js'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>, <span class="hljs-string"><span class="hljs-string">'css'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/css'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'plain/text'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, ...JSON.parse(DEFAULT_MIME_TYPES) };</code> </pre> <br><p>  Nun m√ºssen Sie den MIME-Typ irgendwie angeben, bevor Sie den Lesestream auf den Schreibstream umschalten.  Ich habe die Dateierweiterungsnamen als Schl√ºssel verwendet, daher erhalten wir die Dateierweiterung mit der bekannten Funktion <strong>extname</strong> </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileExtension = extname(url).split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).pop();</code> </pre> <br><p>  und mit Hilfe des <strong>Pipe-</strong> Event-Handlers stellen wir den gew√ºnschten MIME-Typ ein </p><br><pre> <code class="plaintext hljs">res.on('pipe', () =&gt; res.setHeader(contentType, mimeTypes[fileExtension] || text));</code> </pre> <br><p>  √úberpr√ºfen Sie </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9e/bad/f34/b9ebadf34d25b2fa8991387d880bc331.jpg" alt="Bild"></p><br><p>  Das ist alles - der Server ist bereit.  Es ist nat√ºrlich nicht perfekt, aber f√ºr den schnellen Einstieg ist es das Richtige.  Wenn Sie an der Entwicklung dieser Idee interessiert sind, schreiben Sie bitte in die Kommentare :-) </p><br><p>  <a href="http-server">Vollst√§ndiger Projektcode</a> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5YhIxvbMLp8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TssbLe5I2Ec" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481898/">https://habr.com/ru/post/de481898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481886/index.html">So erstellen Sie schnell ein Anwesenheitsjournal</a></li>
<li><a href="../de481890/index.html">Import von deutschen Uranschw√§nzen nach Russland. Teil 2. Anreicherung</a></li>
<li><a href="../de481892/index.html">Qubits statt Bits: Welche Zukunft haben Quantencomputer f√ºr uns?</a></li>
<li><a href="../de481894/index.html">Wie das russische Biotech-Start-up zur Krebsbek√§mpfung beitr√§gt</a></li>
<li><a href="../de481896/index.html">PHP gegen ASP.NET: Wie man das rechte w√§hlt?</a></li>
<li><a href="../de481902/index.html">Modellierung des Betriebs eines realen W√§rmekraftwerks zur Optimierung der Modi: Dampf und Mathematik</a></li>
<li><a href="../de481904/index.html">Vladimir Marshinin aka mavl: "Mit dem Aufruf" Keine anderen Karten kopieren "k√∂nnen Sie OpenStreetMap-Lizenzprobleme vermeiden"</a></li>
<li><a href="../de481906/index.html">Chinesisches Gehirn oder zur Verteidigung des Fr√ºhlings</a></li>
<li><a href="../de481910/index.html">Flexible VerticalSwipeBehavior schreiben</a></li>
<li><a href="../de481912/index.html">Ich war eine Woche lang Praktikant bei SRE-engineer. Beobachten Sie mit den Augen eines Software-Ingenieurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>