<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ผโ๐ซ ๐ถ๐ผ ๐ System.IO.Pipelines - ุฃุฏุงุฉ ุบูุฑ ูุนุฑููุฉ ููุญุจู ุงูุฃุฏุงุก ุงูุนุงูู ๐ฆ ๐คพ๐ผ ๐จ๐ปโ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุงููุงุฑุฆ. ููุฏ ูุฑ ุงููุซูุฑ ูู ุงูููุช ููุฐ ุฅุตุฏุงุฑ .NET Core 2.1. ููุฏ ุชู ุจุงููุนู ุงููุธุฑ ูู ุงุจุชูุงุฑุงุช ุฑุงุฆุนุฉ ูุซู Span and Memory ุนูู ูุทุงู ูุงุณุน ุ ููููู ูุฑุงุกุชูุง ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>System.IO.Pipelines - ุฃุฏุงุฉ ุบูุฑ ูุนุฑููุฉ ููุญุจู ุงูุฃุฏุงุก ุงูุนุงูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464921/" style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุงููุงุฑุฆ.  ููุฏ ูุฑ ุงููุซูุฑ ูู ุงูููุช ููุฐ ุฅุตุฏุงุฑ .NET Core 2.1.  ููุฏ ุชู ุจุงููุนู ุงููุธุฑ ูู ุงุจุชูุงุฑุงุช ุฑุงุฆุนุฉ ูุซู Span and Memory ุนูู ูุทุงู ูุงุณุน ุ ููููู ูุฑุงุกุชูุง ูุฑุคูุชูุง ูุณูุงุน ุงููุซูุฑ ุนููุง.  ููุน ุฐูู ุ ูุณูุก ุงูุญุธ ุ ูู ุชุชูู ููุชุจุฉ ุชุณูู System.IO.Pipelines ููุณ ุงูุงูุชูุงู.  ุฅู ูู ุดูุก ุชูุฑูุจูุง ุญูู ูุฐุง ุงูููุถูุน ูู ุงูููุดูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุญูุฏ</a> ุงูุฐู ุชุฑุฌูู ูุซูุฑูู ููุดุฑูู ูู ุงูููุฒู.  ูุฌุจ ุฃู ูููู ููุงู ุจุงูุชุฃููุฏ ูุฒูุฏ ูู ุงููุนูููุงุช ุญุชู ูุชููู ุงูููุชููู ูู ุฅููุงุก ูุธุฑุฉ ุนูู ุงูุชูููููุฌูุง ูู ุฒูุงูุง ูุฎุชููุฉ. <br><br><img src="https://habrastorage.org/webt/fe/ff/_q/feff_q0xj_lqisaxmeji-eomyne.jpeg"><br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br>  ูุฐูู ุ ุชูุฏู ูุฐู ุงูููุชุจุฉ ุฅูู ุชุณุฑูุน ุงูุนูู ูุน ูุนุงูุฌุฉ ุชุฏูู ุงูุจูุงูุงุช.  ุชู ุฅูุดุงุคู ูุงุณุชุฎุฏุงูู ูู ุงูุฃุตู ุจูุงุณุทุฉ ูุฑูู ุงูุชุทููุฑ ูู Kestrel (ุฎุงุฏู ููุจ ูุดุชุฑู ุนุจุฑ ุงููุธุงู ุงูุฃุณุงุณู ูู ASP.NET Core) ุ ูููู ูุชู ุชูููุฑู ุญุงูููุง ูู ุฎูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฒูุฉ nuget</a> ูููุตูุฉ. <br>  ูุจู ุงูุฎูุถ ูู ุงูููุถูุน ุ ูููููุง ุฃู ูุชุฎูู ุขููุฉ ุงูููุชุจุฉ ูุชูุงุซู ูุญุณูู ูู MemoryStream.  ุงููุดููุฉ ูู MemoryStream ุงูุฃุตูู ูู ุนุฏุฏ ูุจูุฑ ูู ุงููุณุฎ ุ ููู ุฃูุฑ ูุงุถุญ ุฅุฐุง ููุช ุชุชุฐูุฑ ุฃูู ูุชู ุงุณุชุฎุฏุงู ุตููู ุจุงูุช ุฎุงุต ุฏุงุฎู ุงููุฎุฒู ุงููุคูุช.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฃุณุงููุจ <a href="">ุงููุฑุงุกุฉ</a> <a href="">ูุงููุชุงุจุฉ</a> ุ ูููู ุงููุณุฎ ูุฑุฆููุง ุจูุถูุญ.  ูุจุงูุชุงูู ุ ุจุงููุณุจุฉ ูููุงุฆู ุงูุฐู ูุฑูุฏ ุงููุชุงุจุฉ ุฅููู ุ ุณูุชู ุฅูุดุงุก ูุณุฎุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุฏุงุฎูู ุ ูุฎูุงู ุงููุฑุงุกุฉ ุ ุณูุชู ุชุณููู ูุณุฎุฉ ูู ุงููุณุฎุฉ ุงูุฏุงุฎููุฉ ุฅูู ุงููุณุชููู.  ูุจุฏู ุฃูู ููุณ ุงูุงุณุชุฎุฏุงู ุงูุฃูุซุฑ ุนููุงููุฉ ูููุถุงุก. <br>  ูุง ุชูุฏู System.IO.Pipelines ุฅูู ุงุณุชุจุฏุงู ุฌููุน ุงูุชุฏููุงุช ุ ุจู ูู ุฃุฏุงุฉ ุฅุถุงููุฉ ูู ุชุฑุณุงูุฉ ูุทูุฑ ูููู ุจูุชุงุจุฉ ููุฏ ุนุงูู ุงูุฃุฏุงุก.  ุฃูุชุฑุญ ุนููู ุฃู ุชุชุนุฑู ุนูู ุงูุฃุณุงููุจ ูุงููุตูู ุงูุฃุณุงุณูุฉ ุ ูุงูุธุฑ ููู ูุชู ุชุฑุชูุจูุง ูู ุงูุฏุงุฎู ุ ูุชุญููู ุงูุฃูุซูุฉ ุงูุฃุณุงุณูุฉ. <br><br>  ููุจุฏุฃ ุจุงูุฌูุงุฒ ุงูุฏุงุฎูู ุ ููู ููุณ ุงูููุช ูุชูุญุต ุดุธุงูุง ุงูููุฏ ุงูุจุณูุท.  ุจุนุฏ ุฐูู ุ ุณูู ูุตุจุญ ูู ุงููุงุถุญ ูุงุฐุง ูููู ูุนูู ุ ูููู ููุจุบู ุงุณุชุฎุฏุงูู.  ุนูุฏ ุงูุนูู ูุน System.IO.Pipelines ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงูููููู ุงูุฃุณุงุณู ูู ุฃู ุฌููุน ุนูููุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ูุฌุจ ุฃู ุชุชู ุฏูู ุชุฎุตูุตุงุช ุฅุถุงููุฉ.  ููู ุจุนุถ ุงูุฃุณุงููุจ ุงูุฌุฐุงุจุฉ ูููููุฉ ุงูุฃููู ุชุชูุงูุถ ูุน ูุฐู ุงููุงุนุฏุฉ.  ููููุง ูุฐูู ุ ูุจุฏุฃ ุงูููุฏ ุงูุฐู ุชุญุงูู ุชุณุฑูุนู ูู ุชุฎุตูุต ุฐุงูุฑุฉ ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูุงูุฌุฏูุฏุฉ ุ ูุชุญููู ุฃุฏุงุฉ ุชุฌููุน ูุฌูุนู ุงูุจูุงูุงุช ุงูููููุฉ. <br><br>  ุชุณุชุฎุฏู ุงูููุชุจุฉ ุงูุฏุงุฎููุฉ ููููุชุจุฉ ุฃูุณุน ุฅููุงููุงุช ูุฃุญุฏุซ ุฅุตุฏุงุฑุงุช ุงููุบุฉ ูุงูููุช - Span ุ Memory ุ ุชุฌูุนุงุช ุงููุงุฆูุงุช ุ ValueTask ุ ุฅูุฎ.  ูุฌุฏุฑ ุงูุจุญุซ ุนูู ุงูุฃูู ุนู ูุซุงู ุฑุงุฆุน ูุงุณุชุฎุฏุงู ูุฐู ุงูููุฒุงุช ูู ุงูุฅูุชุงุฌ. <br>  ูู ููุช ูุงุญุฏ ุ ูุงู ุงูุจุนุถ ุบูุฑ ุฑุงุถู ุนู ุชูููุฐ ุงูุชุฏููุงุช ูู C # ุ ูุฃูู ุชู ุงุณุชุฎุฏุงู ูุตู ูุงุญุฏ ูููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ููู ุ ููุง ูููููู ุ ูุง ููููู ุฑูู ุงูุฃุณุงููุจ ุฎุงุฑุฌ ุงููุตู.  ุญุชู ุฅุฐุง ูู ููู ุงูุฏูู ูุฏุนู ุงููุฑุงุกุฉ / ุงููุชุงุจุฉ / ุชุญุฑูู ุงููุคุดุฑ ุ ูุฅู ุฎุตุงุฆุต CanRead ู CanWrite ู CanSeek ุณุงุฑูุฉ ุงูููุนูู ุ ูุงูุชู ุจุฏุช ููุฃููุง ุนูุงุฒ ุตุบูุฑ.  ููุง ุงูุฃููุฑ ูุฎุชููุฉ. <br>  ููุนูู ูุน ุงูุฃูุงุจูุจ ุ ูุชู ุงุณุชุฎุฏุงู <a href="">ูุฆุชูู</a> : <a href="">PipeWriter</a> ู <a href="">PipeReader</a> .  ุชุญุชูู ูุฐู ุงููุฆุงุช ุนูู ุญูุงูู 50 ุณุทุฑูุง ููู ูููุง ููู ุนุจุงุฑุฉ ุนู ูุงุฌูุงุช ุฒุงุฆูุฉ (ูููุณ ุงูุชุฌุณูุฏ ุงูุฃูุซุฑ ููุงุณูููุฉ ุ ูุธุฑูุง ููุฌูุฏ ูุฆุฉ ูุงุญุฏุฉ ูุฎุจุฃุฉ ุฎูููุง ุ ูููุณ ูุซูุฑูุง) ููุฆุฉ <a href="">Pipe</a> ุ ูุงูุชู ุชุญุชูู ุนูู ูู ุงูููุทู ุงูุฃุณุงุณู ููุนูู ูุน ุงูุจูุงูุงุช.  ูู ุจูู ุงูุฃุนุถุงุก ุงูุนูููููู - ูููุดุฆูู ุ ูุฎุงุตูุชูู ููุท ููุญุตูู ุนูู - ุงููุงุฑุฆ ูุงููุงุชุจ ุ ุทุฑููุฉ ุฅุนุงุฏุฉ ุงูุชุนููู () ุ ุงูุชู ุชุนูุฏ ุชุนููู ุงูุญููู ุงูุฏุงุฎููุฉ ุฅูู ุญุงูุชูุง ุงูุฃูููุฉ ุจุญูุซ ูููู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุฆุฉ  ุชุณูู ุฃุณุงููุจ ุงูุนูู ุงูุฃุฎุฑู ุจุงุณุชุฎุฏุงู ูุงุฌูุงุช ุฒุงุฆูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุชุจุฏุฃ ูู ูุฆุฉ ุงูุฃูุงุจูุจ </h2><br>  ูุดุบู ูุซูู ุงููุฆุฉ 320 ุจุงูุช ุ ููู ูุซูุฑ ุฌุฏูุง (ุซูุซ ููููุจุงูุช ุชูุฑูุจูุง ุ ูุง ูููู ุงุญุชูุงุก 2 ูู ูุฐู ุงููุงุฆูุงุช ูู ุฐุงูุฑุฉ Manchester Mark I).  ูุฐูู ูุชุฎุตูุตู ุจูููุงุช ูุจูุฑุฉ ูู ููุฑุฉ ุณูุฆุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ูุนูู ุงููุงุฆู ูุฎุตุต ููุงุณุชุฎุฏุงู ุทููู ุงูุฃุฌู.  ุงุณุชุฎุฏุงู ุชุฌูุนุงุช ูุฌุนู ุญุฌุฉ ููุฐุง ุงูุจูุงู ุฃูุถุง.  ุจุนุฏ ูู ุดูุก ุ ุณุชุนูุด ุงููุงุฆูุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุชุฌูุน ุฅูู ุงูุฃุจุฏ (ูู ุฃู ุญุงู ุ ูู ุงููุนูุงุฑ). <br>  ูุงุญุธ ุฃูู ุชู ูุถุน ุนูุงูุฉ ุนูู ุงููุตู ุนูู ุฃูู ูุฎุชูู ูุฃูู ุขูู ููุฎูุท - ูุงููุซูุฑ ูู ุฃูุณุงู ุงูููุฏ ูู ูุณู ุญุฑุฌ ููุชู ูููุง ุจุฃููุงู. <br>  ููุจุฏุก ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุซูู ููุฆุฉ Pipe ูุงูุญุตูู ุนูู ูุงุฆูุงุช PipeReader ู PipeWriter ุจุงุณุชุฎุฏุงู ุงูุฎุตุงุฆุต ุงููุฐููุฑุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณูููุฉ ุงูุชููุฆุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); PipeWriter pipeWriter = pipe.Writer; PipeReader pipeReader = pipe.Reader;</code> </pre> <br></div></div><br>  ุงููุธุฑ ูู ุฃุณุงููุจ ุงูุนูู ูุน ุงูุฃูุงุจูุจ: <br>  ููุชุณุฌูู ุนุจุฑ PipeWriter - WriteAsync ุ GetMemory / GetSpan ุ Advance ุ FlushAsync ุ Complete ุ CancelPendingFlush ุ OnReaderCompleted. <br>  ูููุฑุงุกุฉ ูู ุฎูุงู PipeReader - AdvanceTo ุ ReadAsync ุ TryRead ุ Complete ุ CancelPendingRead ุ OnWriterCompleted. <br><br>  ููุง ูู ูุฐููุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุดูุฑ</a> ุ ูุณุชุฎุฏู ุงููุตู ูุงุฆูุฉ ููุฑุฏุฉ ูุฑุชุจุทุฉ ูู ุงููุฎุงุฒู ุงููุคูุชุฉ.  ูููู ูู ุงููุงุถุญ ุฃูู ูุง ูุชู ุชูุฑูุฑูุง ุจูู PipeReader ู PipeWriter - ูู ุงูููุทู ูู ูุฆุฉ ูุงุญุฏุฉ.  ุชุณุชุฎุฏู ูุฐู ุงููุงุฆูุฉ ูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุชู ุชู ุฅุฑุฌุงุนูุง ูู ูุฐู ุงููุงุฆูุฉ. <br>  ููุงู ุฃูุถูุง ูุงุฆูุงุช ุชุดูุฑ ุฅูู ุจุฏุงูุฉ ุงูุจูุงูุงุช ุงููุฑุงุฏ ูุฑุงุกุชูุง (ReadHead ู index) ุ ูููุงูุฉ ุงูุจูุงูุงุช ุงููุฑุงุฏ ูุฑุงุกุชูุง (ReadTail ู index) ูุจุฏุงูุฉ ููุงู ุงููุชุงุจุฉ (WriteHead ูุนุฏุฏ ูุญุฏุงุช ุงูุจุงูุช ุงููุฎุฒูุฉ ูุคูุชูุง ุงูููุชูุจุฉ).  ูุนุฏ ReadHead ู ReadTail ู WriteHead ุฌุฒุกูุง ูุญุฏุฏูุง ูู ุงููุงุฆูุฉ ุ ููุดูุฑ ุงูููุฑุณ ุฅูู ููุถุน ูุนูู ุฏุงุฎู ุงููุทุงุน.  ูุจุงูุชุงูู ุ ูููู ุฃู ูุจุฏุฃ ุงูุชุณุฌูู ูู ููุชุตู ููุทุน ูุง ุ ูููุชูุท ุงูุฌุฒุก ุงูุชุงูู ุจุฃูููู ูููุชูู ูู ููุชุตู ุงูุฌุฒุก ุงูุซุงูุซ.  ูุฐู ุงููุคุดุฑุงุช ุชุชุญุฑู ุจุทุฑู ูุฎุชููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุดุฑูุน ูู ุงูุนูู ูุน ุฃุณุงููุจ PipeWriter </h2><br><h3 style=";text-align:right;direction:rtl">  # 1 <a href="">ValueTask &lt;FlushResult&gt; WriteAsync (ReadOnlyMemory &lt;byte&gt; sourceุ CancellationToken cancellationToken)</a> </h3><br>  ููุท ุชูู ุงูุทุฑููุฉ ุงููุบุฑูุฉ.  ูุฏูู ุชูููุน ููุงุณุจ ููุบุงูุฉ ูุนุตุฑู - ููุจู ReadOnlyMemory ุ ุบูุฑ ูุชุฒุงูู.  ููุฏ ูุชู ุฅุบุฑุงุก ุงููุซูุฑ ูููู ุ ุฎุงุตุฉู ุชุฐูุฑ ุฃู Span and Memory ุณุฑูุนุงู ูุจุงุฑุฏุงู.  ูููู ูุง ุชููู ููุณู.  ูู ูุง ุชูุนูู ูุฐู ุงูุทุฑููุฉ ูู ูุณุฎ ReadOnlyMemory ุงูุฐู ุชู ุชูุฑูุฑู ุฅูููุง ูู ุงููุงุฆูุฉ ุงูุฏุงุฎููุฉ.  ู "copy" ุชุนูู ุฏุนูุฉ ุฅูู ุงูุฃุณููุจ CopyTo ุ ูููุณ ูุณุฎ ุงููุงุฆู ููุณู.  ุฃู ุ ุณูุชู ูุณุฎ ุฌููุน ุงูุจูุงูุงุช ุงูุชู ูุฑูุฏ ุชุณุฌูููุง ุ ูุจุงูุชุงูู ุชุญููู ุงูุฐุงูุฑุฉ.  ูุฌุจ ุฏุฑุงุณุฉ ูุฐู ุงูุทุฑููุฉ ููุท ููุชุฃูุฏ ูู ุฃูู ูู ุงูุฃูุถู ุนุฏู ุงุณุชุฎุฏุงููุง.  ุญุณููุง ุ ูุฑุจูุง ูููู ูุฐุง ุงูุณููู ููุงุณุจูุง ูุจุนุถ ุงูููุงูู ุงููุงุฏุฑุฉ. <br>  ุฌุณู ูุฐู ุงูุทุฑููุฉ ูู ูุณู ุญุฑุฌ ุ ุชุชู ูุฒุงููุฉ ุงููุตูู ุฅูููุง ูู ุฎูุงู ุดุงุดุฉ. <br><br>  ุซู ูุฏ ูุทุฑุญ ุงูุณุคุงู ุ ููู ุชูุชุจ ุดูุฆูุง ูุง ุ ุฅู ูู ููู ูู ุฎูุงู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ูุถูุญูุง ูุงูุฃูุซุฑ ููุงุฆูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  # 2 <a href="">ุงูุฐุงูุฑุฉ &lt;ุจุงูุช&gt; GetMemory (int sizeHint)</a> </h3><br>  ุชุฃุฎุฐ ุงูุทุฑููุฉ ูุนููุฉ ูุงุญุฏุฉ ูู ููุน ุตุญูุญ.  ูุฌุจ ุฃู ูุดูุฑ ููู ุฅูู ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ูุฑุบุจ ูู ูุชุงุจุชูุง (ุฃู ุฃูุซุฑ ุ ูููู ููุณ ุจุฃู ุญุงู ุฃูู).  ูุชุญูู ูุฐุง ุงูุฃุณููุจ ููุง ุฅุฐุง ูุงูุช ููุงู ูุณุงุญุฉ ูุงููุฉ ูููุชุงุจุฉ ูู ุงูุฌุฒุก ุงูุญุงูู ูู ุงูุฐุงูุฑุฉ ุงููุฎุฒูุฉ ูู _writingHeadMemory.  ุฅุฐุง ูุงูุช ูุงููุฉ ุ ูุชู ุฅุฑุฌุงุน _writingHeadMemory ูุฐุงูุฑุฉ.  ุฅุฐุง ูู ููู ูุฐูู ุ ูุจุงููุณุจุฉ ููุจูุงูุงุช ุงูููุชูุจุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช ุ ูููู ูู ูุชู ุงุณุชุฏุนุงุก ุทุฑููุฉ FlushAsync ุงูุฎุงุตุฉ ุจูุง ุ ูุชู ุงุณุชุฏุนุงุคูุง ููุชู ุชุญุฏูุฏ BufferSegment ุขุฎุฑ ุ ููู ูุชุตู ุจุงููุงุญุฏุฉ ุงูุณุงุจูุฉ (ูููุง ููู ุงููุงุฆูุฉ).  ูู ุบูุงุจ _writingHeadMemory ุ ุชุชู ุชููุฆุชู ุจุงุณุชุฎุฏุงู BufferSegment ุฌุฏูุฏ.  ูุชุฎุตูุต ุงููุฎุฒู ุงููุคูุช ุงูุชุงูู ูู ูุณู ุญุงุณู ููุชู ุชุญุช ุงูููู. <br>  ุฃูุชุฑุญ ูุธุฑุฉ ุนูู ูุฐุง ุงููุซุงู.  ูููููุฉ ุงูุฃููู ุ ูุฏ ูุจุฏู ุฃู ุงููุชุฑุฌู (ุฃู ููุช ุงูุชุดุบูู) ุฃูุณุฏ ุงูุดูุทุงู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุญุดูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipeNoOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); Memory&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt; memoryOne = pipeNoOptions.Writer.GetMemory(<span class="hljs-number"><span class="hljs-number">2</span></span>); Console.WriteLine(memoryOne.Length); <span class="hljs-comment"><span class="hljs-comment">//2048  4096 var pipeWithOptions = new Pipe(new PipeOptions(minimumSegmentSize: 5)); Memory&lt;byte&gt; memoryTwo = pipeWithOptions.Writer.GetMemory(2); Console.WriteLine(memoryTwo.Length); //16</span></span></code> </pre><br></div></div><br>  ููู ูู ุดูุก ูู ูุฐุง ุงููุซุงู ููููู ูุจุณูุท. <br>  ุนูุฏ ุฅูุดุงุก ูุซูู Pipe ุ ูููููุง ุชูุฑูุฑ ูุงุฆู <a href="">PipeOptions</a> ูุน ุฎูุงุฑุงุช <a href="">ูุฅูุดุงุฆู</a> ุฅูู ุงููููุดุฆ. <br><br>  ูุญุชูู PipeOptions ุนูู ุญูู ุญุฌู ูุทุนุฉ ุงูุญุฏ ุงูุฃุฏูู ุงูุงูุชุฑุงุถู.  ููุฐ ููุช ููุณ ุจุจุนูุฏ ูุงู ุนุงู 2048 ุ ููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง ุงูุงูุชุฒุงู</a> ุบูุฑ ูู ุดูุก ุ ุงูุขู 4096. ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูุงูุช ุงููุณุฎุฉ ุงูุชู ุชุญุชูู ุนูู 4096 ุนุจุงุฑุฉ ุนู ุญุฒูุฉ ุชุฌุฑูุจูุฉ ุ ููู ุขุฎุฑ ุฅุตุฏุงุฑ ูุงู ุงูุฅุตุฏุงุฑ 2048. ููุฐุง ูุง ููุณุฑ ุณููู ุงููุซุงู ุงูุฃูู.  ุฅุฐุง ููุช ุชูุชูุฏ ุงุณุชุฎุฏุงู ุญุฌู ุฃุตุบุฑ ูููุฎุฒู ุงููุคูุช ุงูููุงุณู ุ ููููู ุชุญุฏูุฏู ูู ูุซูู ููุน PipeOptions. <br><br>  ูููู ูู ุงููุซุงู ุงูุซุงูู ุ ุญูุซ ูุดุงุฑ ุฅูู ุงูุญุฏ ุงูุฃุฏูู ููุญุฌู ุ ูุฅู ุงูุทูู ูุง ูุทุงุจูู ุนูู ุฃู ุญุงู.  ููุฐุง ูุญุฏุซ ุจุงููุนู ูุฃู ุฅูุดุงุก BufferSegment ุฌุฏูุฏ ูุญุฏุซ ุจุงุณุชุฎุฏุงู ุชุฌูุนุงุช.  ุฃุญุฏ ุงูุฎูุงุฑุงุช ูู PipeOptions ูู ุชุฌูุน ุงูุฐุงูุฑุฉ.  ุจุนุฏ ุฐูู ุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุชุฌูุน ุงููุญุฏุฏ ูุฅูุดุงุก ุดุฑูุญุฉ ุฌุฏูุฏุฉ.  ุฅุฐุง ูู ุชุญุฏุฏ ุชุฌูุน ุงูุฐุงูุฑุฉ ุงูุฎุงุต ุจู ุ ูุณูุชู ุงุณุชุฎุฏุงู ArrayPool ุงูููุงุณู ุ ูุงูุฐู ุ ููุง ุชุนูููู ุ ูุญุชูู ุนูู ุนุฏุฉ ุฏูุงุก ูุฃุญุฌุงู ูุฎุชููุฉ ูู ุงููุตูููุงุช (ูู ูุงุญุฏุฉ ุชุงููุฉ ุฃูุจุฑ ูุฑุชูู ูู ุงูุณุงุจูุฉ) ูุนูุฏ ุงูุจุญุซ ุนู ุญุฌู ูุญุฏุฏ ุ ูุฅููุง ุชุจุญุซ ุนู ุฏูู ูุน ุตูุงุฆู ุฐุงุช ุญุฌู ููุงุณุจ (ุซู ููุงู ุฃูุฑุจ ุฃูุจุฑ ุฃู ูุณุงูู).  ููููุง ูุฐูู ุ ุณูููู ุงููุฎุฒู ุงููุคูุช ุงูุฌุฏูุฏ ุฃูุจุฑ ุชูุฑูุจูุง ููุง ุทูุจุชู.  ุงูุญุฏ ุงูุฃุฏูู ูุญุฌู ุงูุตููู ูู ArrayPool ุงูููุงุณู (System.Buffers.TlsOverPerCoreLockedStacksArrayPool) ูู 16. ููู ูุง ุชููู ุ ูุฃู ูุฐุง ูู ูุฌููุนุฉ ูู ุงูุตูุงุฆู.  ููููุง ูุฐูู ุ ูู ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุงูุญุงูุงุช ุ ูุง ุชุถุน ุงูุตููู ุถุบุทูุง ุนูู ุฌุงูุน ุงูุจูุงูุงุช ุงูููููุฉ ูุณูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง. <br><br><h3 style=";text-align:right;direction:rtl">  # 2.5 <a href="">Span &lt;byte&gt; GetSpan (int sizeHint)</a> </h3><br>  ูุนูู ุจุดูู ูุดุงุจู ุ ูุน ุฅุนุทุงุก ุณุจุงู ูู ุงูุฐุงูุฑุฉ. <br><br>  ูุจุงูุชุงูู GetMemory () ุฃู GetSpan () ูู ุงูุทุฑู ุงูุฑุฆูุณูุฉ ูููุชุงุจุฉ.  ูุนุทูููุง ูุงุฆููุง ูููููุง ุงููุชุงุจุฉ ุฅููู.  ููููุงู ุจุฐูู ุ ูุง ูุญุชุงุฌ ุฅูู ุชุฎุตูุต ุฐุงูุฑุฉ ููุตูููุงุช ุฌุฏูุฏุฉ ูู ุงูููู ุ ูููููุง ุงููุชุงุจุฉ ูุจุงุดุฑุฉ ุฅูู ุงููููู ุงูุฏุงุฎูู.  ุฃู ูุงุญุฏ ูุงุณุชุฎุฏุงูู ูุนุชูุฏ ุจุดูู ุฃุณุงุณู ุนูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชุณุชุฎุฏููุง ูุงูุฃุณููุจ ุบูุฑ ุงููุชุฒุงูู.  ููุน ุฐูู ุ ูู ุถูุก ูุง ุณุจู ุ ูุทุฑุญ ุณุคุงู.  ููู ุณูุนุฑู ุงููุงุฑุฆ ูู ูุชุจูุงุ  ุฅุฐุง ุงุณุชุฎุฏููุง ุฏุงุฆููุง ุชุทุจูููุง ูุญุฏุฏูุง ููุชุฌูุน ุ ูุงูุฐู ูุนุทู ุตููููุง ุจููุณ ุงูุญุฌู ุงููุทููุจ ุชูุงููุง ุ ุนูุฏุฆุฐู ูููู ูููุงุฑุฆ ูุฑุงุกุฉ ุงููุฎุฒู ุงููุคูุช ุจุงููุงูู ูุฑุฉ ูุงุญุฏุฉ.  ููุน ุฐูู ุ ููุง ูููุง ุจุงููุนู ุ ูุชู ุชุฎุตูุต ูุฎุฒู ูุคูุช ูุฏููุง ูุน ูุฌูุฏ ุงุญุชูุงู ูุจูุฑ ุจุญุฌู ุฃูุจุฑ.  ูุฐุง ูุคุฏู ุฅูู ุงูุทุฑููุฉ ุงูุชุงููุฉ ุงููุทููุจุฉ ููุชุดุบูู. <br><br><h3 style=";text-align:right;direction:rtl">  # 3 <a href="">void Advance (int bytes)</a> </h3><br>  ุทุฑููุฉ ุจุณูุทุฉ ุฑููุจุฉ.  ูุณุชุบุฑู ุนุฏุฏ ุงูุจุงูุชุงุช ุงูููุชูุจุฉ ููุณูุทุฉ.  ูููููู ุจุฒูุงุฏุฉ ุงูุนุฏุงุฏุงุช ุงูุฏุงุฎููุฉ - _unflushedBytes ู _writingHeadBytesBuffered ุ ุงูุฐูู ุชุชุญุฏุซ ุฃุณูุงุคูู ุนู ุฃููุณูู.  ูููู ุฃูุถูุง ุจุงูุชุทุงุน _writingHeadMemory ุชูุงููุง ูุนุฏุฏ ุงูุจุงูุชุงุช ุงูููุชูุจุฉ (ุจุงุณุชุฎุฏุงู ุทุฑููุฉ Slice).  ูุฐูู ุ ุจุนุฏ ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ุ ุชุญุชุงุฌ ุฅูู ุทูุจ ูุชูุฉ ุฐุงูุฑุฉ ุฌุฏูุฏุฉ ูู ุดูู Memory ุฃู Span ุ ูุง ููููู ุงููุชุงุจุฉ ุฅูู ุงูุณุงุจูุฉ.  ูุงูุฌุณู ููู ูู ุงูุทุฑููุฉ ูู ูุณู ุญุงุณู ููุนูู ุชุญุช ููู. <br><br>  ูุจุฏู ุฃูู ุจุนุฏ ูุฐุง ูููู ูููุงุฑุฆ ุชููู ุงูุจูุงูุงุช.  ูููู ููุงู ุญุงุฌุฉ ุฅูู ุฎุทูุฉ ุฃุฎุฑู. <br><br><h3 style=";text-align:right;direction:rtl">  # 4 <a href="">ValueTask &lt;FlushResult&gt; FlushAsync (CancellationToken cancellationToken)</a> </h3><br>  ุชุณูู ูุฐู ุงูุทุฑููุฉ ุจุนุฏ ุฃู ููุชุจ ุงูุจูุงูุงุช ุงููุงุฒูุฉ ุฅูู ุงูุฐุงูุฑุฉ ุงููุณุชููุฉ ููุดูุฑ ุฅูู ููุฏุงุฑ ูุง ูุชุจูุง ููุงู.  ุชููู ุงูุทุฑููุฉ ุจุฅุฑุฌุงุน ValueTask ุ ููุน ุฐูู ููู ุบูุฑ ูุชุฒุงููุฉ (ุนูู ุนูุณ StreamPipeWriter ุงูุฎุงุต ุจู).  ุชุนุฏ ValueTask ููุนูุง ุฎุงุตูุง (ุจููุฉ ูููุฑุงุกุฉ ููุท) ููุณุชุฎุฏู ูู ุงูุญุงูุฉ ุงูุชู ูู ุชุณุชุฎุฏู ูููุง ูุนุธู ุงูููุงููุงุช ุบูุฑ ูุชุฒุงูู ุ ุฃู ุฃู ุฌููุน ุงูุจูุงูุงุช ุงููุงุฒูุฉ ุณุชููู ูุชุงุญุฉ ูู ููุช ุงูุงุชุตุงู ูุณุชูุชูู ุงูุทุฑููุฉ ุจุดูู ูุชุฒุงูู.  ูู ุงูุฏุงุฎู ุ ูุญุชูู ุนูู ุจูุงูุงุช ุฃู ูููุฉ (ูู ุญุงูุฉ ุนุฏู ุชุดุบูููุง ุจุดูู ูุชุฒุงูู).  ูุนุชูุฏ ุฐูู ุนูู ุญุงูุฉ ุงูุฎุงุตูุฉ _writerAwaitable.IsCompleted.  ุฅุฐุง ุจุญุซูุง ุนู ุงูุชุบููุฑุงุช ุงูุชู ุทุฑุฃุช ุนูู ุญุงูุฉ ูุงุฆู ุงูุงูุชุธุงุฑ ูุฐุง ุ ูุณูุฑู ุฃู ูุฐุง ูุญุฏุซ ุจุดุฑุท ุฃู ุชููู ูููุฉ ุงูุจูุงูุงุช ุบูุฑ ุงููุนุงูุฌุฉ (ุบูุฑ ุงููุณุชูููุฉ) (ูุฐู ููุณุช ุจุงูุถุจุท ููุณ ุงูุจูุงูุงุช ุบูุฑ ุงูููุฑูุกุฉ (ูู ูุชู ูุญุตูุง) ุ ูุงูุชู ุณูุชู ุดุฑุญูุง ูุงุญููุง) ุชุชุฌุงูุฒ ุญุฏูุง ูุนูููุง (_pauseWriterThreshold).  ุงูุงูุชุฑุงุถู ูู 16 ูุทุนุฉ ุงูุฃุญุฌุงู.  ุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ูููู ุชุบููุฑ ุงููููุฉ ูู PipeOptions.  ุฃูุถูุง ุ ุชุจุฏุฃ ูุฐู ุงูุทุฑููุฉ ูู ูุชุงุจุนุฉ ุฃุณููุจ ReadAsync ุ ุฅุฐุง ุชู ุญุธุฑู. <br><br>  ุฅุฑุฌุงุน FlushResult ูุญุชูู ุนูู 2 ุฎุตุงุฆุต - IsCanceled ู IsCompleted.  ูุดูุฑ IsCanceled ุฅูู ูุง ุฅุฐุง ูุงู Flush ูุฏ ุชู ุฅูุบุงุคู (ุงุณุชุฏุนุงุก CancelPendingFlush).  ูุดูุฑ IsCompleted ุฅูู ูุง ุฅุฐุง ูุงู ุชู ุฅููุงู PipeReader (ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุฃุณุงููุจ Complete () ุฃู CompleteAsync ()). <br>  ูุชู ุชูููุฐ ุงูุฌุฒุก ุงูุฑุฆูุณู ูู ูุฐู ุงูุทุฑููุฉ ุชุญุช ููู ุณูุงู ูููุฑ. <br><br>  ุงูุฃุณุงููุจ ุงูุฃุฎุฑู ูู PipeWriter ูุง ุชูู ูู ูุฌูุฉ ูุธุฑ ุงูุชูููุฐ ููุชู ุงุณุชุฎุฏุงููุง ุจุดูู ุฃูู ูุซูุฑูุง ุ ูุฐูู ุณูุชู ุชูุฏูู ูุตู ููุฌุฒ ููุท. <br><br><h3 style=";text-align:right;direction:rtl">  # 5 ุจุงุทูุฉ ูุงููุฉ (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ุฎุงููุฉ) ุฃู ValueTask CompleteAsync (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ูุงุฑุบ) </h3><br>  ุนูุงูุงุช ุฃูุจูุจ ูุบููุฉ ูููุชุงุจุฉ.  ุนูุฏ ุงูุงูุชูุงุก ุ ุณูุชู ุทุฑุญ ุงุณุชุซูุงุก ุนูุฏ ูุญุงููุฉ ุงุณุชุฎุฏุงู ุทุฑู ุงููุชุงุจุฉ.  ุฅุฐุง ุชู ุฅููุงู PipeReader ุจุงููุนู ุ ูุณูุชู ุฃูุถูุง ุฅููุงู ูุซูู ุชูุฌูู ุงูุฅุฎุฑุงุฌ ุจุงููุงูู.  ูุชู ูุนุธู ุงูุนูู ุชุญุช ุงูููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 6 ุจุงุทูุฉ CancelPendingFlush () </h3><br>  ููุง ููุญู ุงูุงุณู ุ ูุฅูู ูููู ุนูููุฉ FlushAsync () ุงูุญุงููุฉ.  ููุงู ููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 7 void OnReaderCompleted (ุฑุฏ ุงููุนู &lt;ุงูุงุณุชุซูุงุก ุ ุงููุงุฆู&gt; ุฑุฏ ุงูุงุชุตุงู ุ ุญุงูุฉ ุงููุงุฆู) </h3><br>  ูููุฐ ุงููููุถ ุงููููุถ ุนูุฏ ุงูุชูุงู ุงููุงุฑุฆ.  ููุงู ุฃูุถุง ููู. <br>  ุชุดูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ุญุงูููุง ุฅูู ุฃูู ูุฏ ูุง ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ุนูู ุจุนุถ ุฃุญูุงุฏ PipeWriter ูุณูุชู ุฅุฒุงูุชูุง ูู ุงููุณุชูุจู.  ูุฐูู ุ ูุฌุจ ุฃู ูุง ุชุฑุจุท ุงูููุทู ุจูุฐู ุงูุทุฑู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชูู ุฅูู PipeReader </h2><br><h3 style=";text-align:right;direction:rtl">  # 1 <a href="">ValueTask &lt;ReadResult&gt; ReadAsync (ุฅูุบุงุก ุฑูุฒ ูููุฒ)</a> </h3><br>  ููุง ุ ูุซู FlushAsync ุ ูุชู ุฅุฑุฌุงุน ValueTask ุ ููุง ูุดูุฑ ุฅูู ุฃู ุงูุทุฑููุฉ ูุชุฒุงููุฉ ูู ุงูุบุงูุจ ุ ูููู ููุณ ุฏุงุฆููุง.  ูุนุชูุฏ ุนูู ุญุงูุฉ _readerAwaitable.  ููุง ูู ุงูุญุงู ูุน FlushAsync ุ ุชุญุชุงุฌ ุฅูู ุงูุจุญุซ ุนู ููุช ุถุจุท _readerAwaitable ุนูู ุนุฏู ุงูุชูุงูู.  ูุญุฏุซ ูุฐุง ุนูุฏูุง ููุฑุฃ PipeReader ูู ุดูุก ูู ุงููุงุฆูุฉ (ุฃู ุฃูู ูุญุชูู ุนูู ุจูุงูุงุช ุชู ุชุนููููุง ุนูู ุฃููุง ุชู ูุญุตูุง ูุชุญุชุงุฌ ุฅูู ูุฒูุฏ ูู ุงูุจูุงูุงุช ูููุชุงุจุนุฉ).  ููู ูู ุงููุงูุน ููุทูู.  ููููุง ูุฐูู ุ ูููููุง ุฃู ูุณุชูุชุฌ ุฃูู ูู ุงููุณุชุญุณู ุถุจุท ุชูุฌููุงุช ุงูุฅุฎุฑุงุฌ ุฅูู ุนููู ุ ูุชุนููู ุฌููุน ุฎูุงุฑุงุชู ุจุนูุงูุฉ ุ ุงุณุชูุงุฏูุง ุฅูู ุฅุญุตุงุฆูุงุช ูุญุฏุฏุฉ ุชุฌุฑูุจูุงู.  ุณูู ูููู ุงูุชูููู ุงูุตุญูุญ ูู ุงุญุชูุงู ูุฌูุฏ ูุฑุน ุชูููุฐ ุบูุฑ ูุชุฒุงูู ููุณูุญ ุจูุนุงูุฌุฉ ุฃูุซุฑ ููุงุกุฉ ููุจูุงูุงุช.  ุชูุฑูุจุง ุงูุฃุณููุจ ุจุฃูููู ูุญุงุท ุจููู. <br><br>  ุฅุฑุฌุงุน ุจุนุถ <a href="">ุงููุฑุงุกุฉ</a> ุงูุบุงูุถุฉ.  ูู ุงููุงูุน ุ ุฅููุง ูุฌุฑุฏ ุนูุงูุฉ + ุนุงุฒูุฉ ุชูุถุญ ุญุงูุฉ ุงูุนูููุฉ (IsCanceled - ูุง ุฅุฐุง ูุงู ReadAsync ูุฏ ุชู ุฅูุบุงุคู ู IsCompleted ูุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงู PipeWriter ูุบูููุง).  ูู ูุฐู ุงูุญุงูุฉ ุ IsCompleted ูู ูููุฉ ุชุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงู ุชู ุงุณุชุฏุนุงุก ุฃุณุงููุจ PipeWriter Complete () ุฃู CompleteAsync ().  ุฅุฐุง ุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุฃุณุงููุจ ูุน ุงุณุชุซูุงุก ุ ูุณูุชู ุทุฑุญูุง ุนูุฏ ูุญุงููุฉ ุงููุฑุงุกุฉ. <br><br>  ูุญุชูู ุงููุฎุฒู ุงููุคูุช ูุฑุฉ ุฃุฎุฑู ุนูู ููุน ุบุงูุถ - <a href="">ReadOnlySequence</a> .  ูุฐุง ุ ุจุฏูุฑู ุ ูู ูุงุฆู ูุงุญุชูุงุก <a href="">ุงูููุงุทุน (ReadOnlySequenceSegment) ูู</a> ูุคุดุฑุงุช ุงูุจุฏุงูุฉ ูุงูููุงูุฉ + ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ุฏุงุฎู ุงูุฃุฌุฒุงุก ุงูููุงุจูุฉ.  ุงูุฐู ูุดุจู ูู ุงููุงูุน ูููู ูุฆุฉ ุงูุฃูุงุจูุจ ููุณูุง.  ุจุงูููุงุณุจุฉ ุ BufferSegment ูู ุงูุฎูู ูู ReadOnlySequenceSegment ุ ููุง ูุดูุฑ ุฅูู ุฃูู ูุชู ุงุณุชุฎุฏุงูู ููุงู.  ุจูุถู ูุฐุง ุ ููููู ููุท ุงูุชุฎูุต ูู ุชุฎุตูุตุงุช ุงูุฐุงูุฑุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ ูููู ุงูุจูุงูุงุช ูู ูุงุชุจ ุฅูู ูุงุฑุฆ. <br>  ูููู ุงูุญุตูู ุนูู ReadOnlySpan ูู ุงููุฎุฒู ุงููุคูุช ููุฒูุฏ ูู ุงููุนุงูุฌุฉ.  ูุฅููุงู ุงูุตูุฑุฉ ุ ููููู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุฎุฒู ุงููุคูุช ูุญุชูู ุนูู ReadOnlySpan ูุงุญุฏ.  ุฅุฐุง ูุงูุช ุชุญุชูู ุนูู ุ ููู ูุญุชุงุฌ ุฅูู ุงูุชูุฑุงุฑ ุนูู ุงููุฌููุนุฉ ูู ุนูุตุฑ ูุงุญุฏ ููููููุง ุงูุญุตูู ุนูููุง ุจุงุณุชุฎุฏุงู ุงูุฎุงุตูุฉ ุงูุฃููู.  ูุฅูุง ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุชุฌุงูุฒ ูุงูุฉ ุงูุฃุฌุฒุงุก ุงูููุฌูุฏุฉ ูู ุงููุฎุฒู ุงููุคูุช ููุนุงูุฌุฉ ูู ReadOnlySpan. <br><br>  ููุถูุน ุงูููุงูุดุฉ - ูู ูุฆุฉ ReadOnlySequence ุ ูุชู ุงุณุชุฎุฏุงู ุฃููุงุน ุงููุฑุงุฌุน ุงููุงุฑุบุฉ ุจุดูู ูุดุท ูููุงู goto (ูููุณ ููุฎุฑูุฌ ูู ุงูุชุฏุงุฎู ูููุณ ูู ุงูููุฏ ุงูุฐู ุชู ุฅูุดุงุคู) - ุนูู ูุฌู ุงูุฎุตูุต ุ <a href="">ููุง</a> <br><br>  ุจุนุฏ ุงููุนุงูุฌุฉ ุ ูุฌุจ ุฃู ุชูุถุญ ููุซูู ุงูุฅุฎุฑุงุฌ ุฃููุง ูุฏ ูุฑุฃูุง ุงูุจูุงูุงุช. <br><br><h3 style=";text-align:right;direction:rtl">  # 2 <a href="">bool TryRead (ุฎุงุฑุฌ ูุชูุฌุฉ ReadResult)</a> </h3><br>  ุฅุตุฏุงุฑ ูุชุฒุงูู.  ูุชูุญ ูู ุงูุญุตูู ุนูู ุงููุชูุฌุฉ ุฅุฐุง ูุงูุช ูุฐูู.  ุฅุฐุง ูู ููู ููุฌูุฏูุง ุจุงููุนู ุ ูุฎูุงููุง ูู ReadAsync ุ ูุง ูุชู ุญุธุฑู ุ ููููู ููุฑุฌุน ุงูุฎุทุฃ.  ุฃูุถุง ูู ุงูููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 3 <a href="">ุจุงุทูุฉ AdvanceTo (SequencePosition ุงููุณุชูููุฉ ุ SequencePosition ูุญุต)</a> </h3><br>  ูู ูุฐู ุงูุทุฑููุฉ ุ ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ููุฑุฃูุง ูุนุฏุฏ ุงููููุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง.  ุณูุชู ุฅุฑุฌุงุน ุงูุจูุงูุงุช ุงูุชู ุชูุช ูุฑุงุกุชูุง ูููู ูู ุชุชู ูุนุงูุฌุชูุง ูู ุงููุฑุฉ ุงูุชุงููุฉ ุงูุชู ุชุชู ูุฑุงุกุชูุง.  ูุฏ ุชุจุฏู ูุฐู ุงูููุฒุฉ ุบุฑูุจุฉ ูููููุฉ ุงูุฃููู ุ ูููู ุนูุฏ ูุนุงูุฌุฉ ุฏูู ูู ุงูุจุงูุชุงุช ุ ูุงุฏุฑุงู ูุง ูููู ูู ุงูุถุฑูุฑู ูุนุงูุฌุฉ ูู ุจุงูุช ุนูู ุญุฏุฉ.  ุนุงุฏุฉ ุ ูุชู ุชุจุงุฏู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุฑุณุงุฆู.  ูุฏ ููุดุฃ ูููู ุฃู ุงููุงุฑุฆ ุ ุนูุฏ ุงููุฑุงุกุฉ ุ ุชููู ุฑุณุงูุฉ ูุงุญุฏุฉ ูุงููุฉ ูุฌุฒุกูุง ูู ุงูุซุงููุฉ.  ูุฌุจ ูุนุงูุฌุฉ ุงููู ุ ููุฌุจ ุชุฑู ุฌุฒุก ูู ุงูุซุงููุฉ ูู ุงููุฑุฉ ุงูุชุงููุฉ ุญุชู ูุฃุชู ูุน ุงูุฌุฒุก ุงููุชุจูู.  ุชูุจู ุทุฑููุฉ AdvanceTo SequencePosition ุ ููู ูู ุงููุงูุน ููุฑุณ + ูุทุนุฉ ููู.  ุนูุฏ ูุนุงูุฌุฉ ูู ูุง ูุฑุฃู ReadAsync ุ ููููู ุชุญุฏูุฏ ุงููุฎุฒู ุงููุคูุช.  ูุฅูุง ุ ูุณูุชุนูู ุนููู ุฅูุดุงุก ููุถุน ุจุดูู ุตุฑูุญ ุ ูุน ุงูุฅุดุงุฑุฉ ุฅูู ุงููุทุงุน ูุงูููุฑุณ ุงููุฐูู ุชูููุช ุนูุฏููุง ุงููุนุงูุฌุฉ.  ุชุญุช ุบุทุงุก ูุญุฑู ุงูุณูุงุฑุฉ ููู. <br>  ุฃูุถูุง ุ ุฅุฐุง ูุงูุช ูููุฉ ุงููุนูููุงุช ุงูุฃูููุฉ ุฃูู ูู ุงูุนูุจ ุงูุฐู ุชู ุชุซุจูุชู (_resumeWriterThreshold) ุ ูุฅูู ูุจุฏุฃ ูู ูุชุงุจุนุฉ PipeWriter ุฅุฐุง ุชู ุญุธุฑู.  ุจุดูู ุงูุชุฑุงุถู ุ ุชููู ูุฐู ุงูุนุชุจุฉ ุนุจุงุฑุฉ ุนู 8 ูุฌูุฏุงุช ูุทุนุฉ (ูุตู ุนุชุจุฉ ุงูุญุธุฑ). <br><br><h3 style=";text-align:right;direction:rtl">  # 4 ุงููุฑุงุบ ููุชูู (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ูุงุฑุบ) </h3><br>  ุงูุชูุงู PipeReader.  ุฅุฐุง ูุงู PipeWriter ููุชูููุง ูู ูุฐู ุงููุฑุญูุฉ ุ ูุณูุชู ุฅููุงุก ูุซูู ุชูุฌูู ุงูุฅุฎุฑุงุฌ ุจุฃูููู.  ููู ูู ุงูุฏุงุฎู. <br><br><h3 style=";text-align:right;direction:rtl">  # 5 ุจุงุทูุฉ CancelPendingRead () </h3><br>  ูุณูุญ ูู ุจุฅูุบุงุก ุงููุฑุงุกุฉ ุงููุชููุนุฉ ุญุงูููุง.  ุงูููุถุน. <br><br><h3 style=";text-align:right;direction:rtl">  # 6 ุจุงุทู OnWriterCompleted (ุฑุฏ ุงููุนู &lt;ุงูุงุณุชุซูุงุก ุ ุงููุงุฆู&gt; ุฑุฏ ุงูุงุชุตุงู ุ ุญุงูุฉ ุงููุงุฆู) </h3><br>  ูุณูุญ ูู ุจุชุญุฏูุฏ ุงููููุถ ููุชูููุฐ ุนูุฏ ุงูุชูุงู PipeWriter. <br>  ูุซู ุงูุทุฑููุฉ ุงูููุงุซูุฉ ูู PipeWriter ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุชูู ุงููุซุงุฆู</a> ุนูู ููุณ ุงูููุงุญุธุฉ ุงูุชู ุณูุชู ุฅุฒุงูุชูุง.  ููู ุชุญุช ุบุทุงุก ูุญุฑู ุงูุณูุงุฑุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู </h2><br><br>  ุชูุถุญ ุงููุงุฆูุฉ ุฃุฏูุงู ูุซุงููุง ุนูู ุงูุนูู ูุน ุงูุฃูุงุจูุจ. <br>  ููุฐ ุฅุฏุฎุงู .NET Core Span ู Memory ุ ุชู ุงุณุชููุงู ุงูุนุฏูุฏ ูู ุงููุฆุงุช ููุนูู ูุน ุงูุจูุงูุงุช ุจูุงุณุทุฉ ุงูุฃุญูุงู ุงูุฒุงุฆุฏุฉ ุจุงุณุชุฎุฏุงู ูุฐู ุงูุฃููุงุน.  ูุจุงูุชุงูู ูุฅู ูุฎุทุท ุงูุชูุงุนู ุงูุนุงู ุณูููู ูู ููุณู ุชูุฑูุจุง.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ุงุณุชุฎุฏูุช ุฎุทูุท ุงูุฃูุงุจูุจ ููุนูู ูุน ุงูุฃูุงุจูุจ (ุฃุญุจ ุงููููุงุช ุงูุฌุฐุฑูุฉ) ุ ุฃู  ุงููููุงุช - ูุงุฆูุงุช ูุธุงู ุงูุชุดุบูู ููุงุชุตุงู ุจูู ุงูุนูููุงุช.  ุชู ุชูุณูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูููุงุฉ ููููุง ูุฐูู ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู Span ู Memory.  ูุณุชุฎุฏู ุงูุฅุตุฏุงุฑ ุบูุฑ ุงููุชุฒุงูู ุงูุฐุงูุฑุฉ ุ ูุธุฑูุง ูุฃู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุณูุชู ุชุญููููุง ุฅูู ุทุฑููุฉ ูุงูุจ ุจุงุณุชุฎุฏุงู ุขููุฉ ุงูุญุงูุฉ ุงููุญุฏูุฏุฉ ุงููููุฏุฉ ุชููุงุฆููุง ุ ุญูุซ ูุชู ุชุฎุฒูู ุฌููุน ุงููุชุบูุฑุงุช ุงููุญููุฉ ููุนููุงุช ุงูุทุฑููุฉ ุ ูุญูุซ ุฃู Span ูุชู ุฅุนุงุฏุฉ ููููุฉ ูููุฑุงุกุฉ ููุท ุ ููุง ูููู ุฃู ุชููู ุนูู ุงููููุฉ ุ ุนูู ุงูุชูุงูู ุ ุจุงุณุชุฎุฏุงู Span ุจุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ุบูุฑ ูููู.  ูููู ููุงู ุฃูุถูุง ุฅุตุฏุงุฑ ูุชุฒุงูู ููุทุฑููุฉ ุงูุชู ุชุณูุญ ูู ุจุงุณุชุฎุฏุงู Span.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ุฌุฑุจุช ูููููุง ูุงุชุถุญ ุฃู ุงูุฅุตุฏุงุฑ ุงููุชุฒุงูู ูู ูุฐุง ุงููููู ูุธูุฑ ููุณู ุจุดูู ุฃูุถู.  ุนูุฏ ุงุณุชุฎุฏุงูู ุ ูุญุฏุซ ุชุฌููุน ุฃูู ููููุงูุฉ ุ ูุชููู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุฃุณุฑุน.  ูููู ูุฐุง ูุงู ููุท ูุฃูู ูุงู ููุงู ุงููุซูุฑ ูู ุงูุจูุงูุงุช.  ูู ุญุงูุฉ ุงุญุชูุงู ุญุฏูุซ ุญุงูุฉ ุนุฏู ูุฌูุฏ ุจูุงูุงุช ูู ููุช ุงูุชูุฏูู ููุฏููุนุฉ ุงูุชุงููุฉ ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ ุบูุฑ ุงููุชุฒุงูู ุญุชู ูุง ูุฌูุฏ ุฎููู ุงููุนุงูุฌ. <br>  ุงููุซุงู ูู ุชุนูููุงุช ุชุดุฑุญ ุจุนุถ ุงูููุงุท.  ุฃูุฏ ุฃู ุฃููุช ุงูุชุจุงููู ุฅูู ุญูููุฉ ุฃูู ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุดุธุงูุง ุงูุจุฑูุงูุฌ ุงููุณุคูู ุนู ุงููุฑุงุกุฉ ูู ุงูุฃูุจูุจ ูุงููุนุงูุฌุฉ ููุตููุฉ ุ ุนูุฏ ุงููุชุงุจุฉ ุฅูู ููู ุ ุชุชู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุจุงูุถุจุท ูู ุงูููุงู ุงูุฐู ุชุชู ูุชุงุจุชู ููู ุนูุฏ ุงููุฑุงุกุฉ ูู ุงูุฃูุจูุจ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณููุงุช ูู ุงูุชุทูุฑ ูู ุฃุฌู ููุฒุฉ ูููุฉ - ููู ุบูุฑ ูุชุฒุงูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PipeDataWriter(pipe.Writer, <span class="hljs-string"><span class="hljs-string">"testpipe"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataProcessor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataProcessor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleBytesProcessor(), pipe.Reader); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CancellationTokenSource(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.WhenAll(dataWriter.ReadFromPipeAsync(cts.Token), dataProcessor.StartProcessingDataAsync(cts.Token)); } }</code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">PipeDataWriter</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PipeDataWriter</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> NamedPipeClientStream _namedPipe; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PipeWriter _pipeWriter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Servername = <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PipeDataWriter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PipeWriter pipeWriter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pipeName</span></span></span><span class="hljs-function">)</span></span> { _pipeWriter = pipeWriter ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(pipeWriter)); _namedPipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NamedPipeClientStream(Servername, pipeName, PipeDirection.In); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadFromPipeAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CancellationToken token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _namedPipe.ConnectAsync(token); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { token.ThrowIfCancellationRequested(); <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/       Memory</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> //Memory</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;byte&gt;</span></span></span><span class="hljs-comment"> buffer = _pipeWriter.GetMemory(); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/       Memory</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/         -       . //int readBytes = await _namedPipe.ReadAsync(buffer, token); //         PipeWriter Span //         -       . int readBytes = _namedPipe.Read(_pipeWriter.GetSpan()); //      ,        //         if (readBytes == 0) { await Task.Delay(500, token); continue; } // ,       _pipeWriter.Advance(readBytes); //  ,      PipeReader FlushResult result = await _pipeWriter.FlushAsync(token); //  PipeReader  ,       //        ,      if (result.IsCompleted) { break; } } //  _pipeWriter     Pipe _pipeWriter.Complete(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">DataProcessor</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataProcessor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IBytesProcessor _bytesProcessor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PipeReader _pipeReader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IBytesProcessor bytesProcessor, PipeReader pipeReader</span></span></span><span class="hljs-function">)</span></span> { _bytesProcessor = bytesProcessor ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(bytesProcessor)); _pipeReader = pipeReader ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(pipeReader)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartProcessingDataAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CancellationToken token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { token.ThrowIfCancellationRequested(); <span class="hljs-comment"><span class="hljs-comment">//     Pipe ReadResult result = await _pipeReader.ReadAsync(token); ReadOnlySequence&lt;byte&gt; buffer = result.Buffer; //      await _bytesProcessor.ProcessBytesAsync(buffer, token); // ,      .       ,   //  ,               //    IBytesProcessor.ProcessBytesAsync   ,    _pipeReader.AdvanceTo(buffer.End); //  PipeWriter  ,      //      ,      if (result.IsCompleted) { break; } } //  _pipeReader     Pipe _pipeReader.Complete(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">BytesProcessor</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IBytesProcessor</span></span> { <span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessBytesAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReadOnlySequence&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; bytesSequence, CancellationToken token</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConsoleBytesProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IBytesProcessor</span></span> { <span class="hljs-comment"><span class="hljs-comment">//,         IDisposable readonly FileStream _fileStream = new FileStream("buffer", FileMode.Create); public Task ProcessBytesAsync(ReadOnlySequence&lt;byte&gt; bytesSequence, CancellationToken token) { if (bytesSequence.IsSingleSegment) { ProcessSingle(bytesSequence.First.Span); } else { foreach (var segment in bytesSequence) { ProcessSingle(segment.Span); } } return Task.CompletedTask; } private void ProcessSingle(ReadOnlySpan&lt;byte&gt; span) { _fileStream.Write(span); } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar464921/">https://habr.com/ru/post/ar464921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar464909/index.html">"ุฅููู ูุฑุงูุจูููุง": ูุง ุงูุฐู ูููู ุฃู ูุญุฏุซ ูู ุญุงููุฉ ุตุบูุฑุฉ ุบูุฑ ูุงุถุญุฉ ุฃุณูู ูุงูุฐุชู</a></li>
<li><a href="../ar464913/index.html">"ุงุนุฑู ูุงูุฒู": ูุง ูู ูุฐู ุงูููุณูุฉ ูุชุญุณูู ุนูููุงุช ุงูุฅูุชุงุฌ</a></li>
<li><a href="../ar464915/index.html">ุฌุงูุง ุณูุฑูุจุช ุงูุฐูู ุงูุนูุฏูุฉ ุงูุฃูุซู</a></li>
<li><a href="../ar464917/index.html">ุจุนุฏ cyberpunk: ูุง ุชุญุชุงุฌ ููุนุฑูุชู ุญูู ุงูุฃููุงุน ุงูุญุงููุฉ ูู ุงูุฎูุงู ุงูุนููู ุงูุญุฏูุซ</a></li>
<li><a href="../ar464919/index.html">ุงููุฏูุฌ ูู ูุฑุงูุจุฉ ุงูููุงุฑุฏ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุณุชุฎุฏูุฉ ูู ุงูุชุทุจูู</a></li>
<li><a href="../ar464925/index.html">ุฏููู ุตูุช UX: ุงูููุงูู ูุงูุฃููุงุท ูุงูุฃุฏูุงุช (ููููููุง ูู ุงูุฏุนู ุงููุนููู)</a></li>
<li><a href="../ar464927/index.html">ุฃุณูู ูููุฑ ูู ุฌูุฉ ุซุงููุฉ: ุงููุฎุงุทุฑ ูุงูุชุญูู ูุชุฌุฏูุฏ ุงูุฃุณูุงู</a></li>
<li><a href="../ar464929/index.html">ูุณูู ุชุญููู ุตูุฑุฉ ุงููุชุตูุญ (ุชุญููู ุงูุณูุฉ)</a></li>
<li><a href="../ar464931/index.html">ุงููุฌูุน ูุฏุฑุฌ ... ูู C #ุ</a></li>
<li><a href="../ar464933/index.html">ุชุทุจููุงุช ุงููุชุจ ุงูุฅููุชุฑูููุฉ ุนูู ูุธุงู ุงูุชุดุบูู Android. ุงูุฌุฒุก 4. ุงูุฃูุนุงุจ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>