<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥡 🆚 🎑 Yandex.Alice dan Telegram bot dalam PHP dengan fungsi tunggal 🍱 🙆🏼 🧑🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang 

 Ada banyak artikel tentang topik bot Telegram, tetapi sedikit yang menulis tentang keterampilan untuk Alice, dan saya tidak menemukan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex.Alice dan Telegram bot dalam PHP dengan fungsi tunggal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446174/"> Selamat siang <br><br>  Ada banyak artikel tentang topik bot Telegram, tetapi sedikit yang menulis tentang keterampilan untuk Alice, dan saya tidak menemukan informasi tentang cara membuat bot tunggal, jadi saya memutuskan untuk berbagi pengalaman tentang cara membuat bot Telegram sederhana dan Yandex. Keahlian bagus untuk situs tersebut memiliki fungsional tunggal. <br><a name="habracut"></a><br>  Jadi, saya tidak akan memberi tahu Anda cara menaikkan server web dan mendapatkan sertifikat ssl, sudah cukup banyak yang ditulis tentangnya. <br><br><h3>  Membuat bot Telegram </h3><br>  Pertama, buat bot Telegram, untuk ini, buka Telegram dan temukan bot BotFather di sana. <br><br><img src="https://habrastorage.org/webt/oy/pz/xz/oypzxzl7wglwoazflc7cunlx2ey.png"><br><br><img src="https://habrastorage.org/webt/s1/zh/db/s1zhdboioofnm0w5mrou68icrby.png"><br><br>  Pilih / newbot <br><br><img src="https://habrastorage.org/webt/uc/yp/dn/ucypdnlpunkagywcuu4dakacvx4.png"><br><br>  Kami memasukkan nama bot yang akan ditanggapi, kemudian kami memasukkan nama bot, sebagai tanggapan kami mendapatkan token untuk mengendalikan bot, kami menulis kunci ini, ini akan berguna bagi kami di masa depan. <br><br><img src="https://habrastorage.org/webt/fq/uh/b5/fquhb5uxlmp5wnsch2bjdkvq9wy.png"><br><br>  Langkah selanjutnya adalah memberi tahu server Telegram ke server mana untuk mengirim data dari bot ke.  Untuk melakukan ini, buat tautan berupa: <br><br><pre><code class="bash hljs">https: //api.telegram.org/bot______/setWebhook?url=https://_________</code> </pre> <br>  ___ TOKEN ___ ganti dengan token bot kami yang diterima sebelumnya <br><br>  ____ PATH_DO_SCRIPT ___ diganti dengan alamat skrip di server kami tempat data akan diproses (misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.my_server.ru/webhook_telegram.php</a> ). <br><br>  Ada masalah, server api.telegram.org terkunci, tetapi Anda dapat melakukan ini: sewa server termurah di mana tidak ada batasan dan berikan perintah dari konsol server ini <br><br><pre> <code class="bash hljs">wget _______</code> </pre><br>  Itu saja, bot Telegram dibuat dan terhubung ke server Anda. <br><br><h3>  Menciptakan keterampilan untuk Yandex.Alice </h3><br>  Mari kita beralih ke menciptakan keterampilan untuk Yandex.Alice. <br><br>  Untuk membuat skill, Anda harus pergi ke halaman pengembang Yandex.Dialogs, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman</a> pengembang Yandex.Dialogs, klik "Buat dialog" dan pilih "Skill in Alice." <br><br><img src="https://habrastorage.org/webt/9q/zj/fz/9qzjfzum4bblzejmjbo2b0cue58.png"><br><br>  Dialog pengaturan keterampilan terbuka. <br><br><img src="https://habrastorage.org/webt/8z/ci/19/8zci19iuqdojsuqrzaocbokqdxq.png"><br><br>  Kami mulai memasuki pengaturan keterampilan. <br><br>  Masukkan nama keahlian Anda. <br><br><img src="https://habrastorage.org/webt/h1/n1/64/h1n164cmxhwn5rehafsvxms4ado.png"><br><br>  Nama aktivasi harus dipilih dengan sangat hati-hati sehingga Alice memahaminya dengan benar, dari nuansa - aplikasi seluler dengan Alice dan kolom seperti Yandex.Station atau Irbis A dapat memahami kata-kata dengan cara yang berbeda. <br><br>  Kami memasukkan jalur ke skrip di server kami dengan cara yang sama seperti untuk Telegram, tetapi itu akan menjadi skrip khusus untuk Alice, misalnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.my_server.ru/webhook_alice.php</a> . <br><br><img src="https://habrastorage.org/webt/n2/q3/ri/n2q3ri-d-tne6xn1gmdaejuznua.png"><br><br>  Kami memilih suara yang keterampilannya akan berbicara, saya lebih suka suara Alice. <br><br><img src="https://habrastorage.org/webt/qk/in/dm/qkindmxmqxgh7v0ffwxzzxciqzg.png"><br><br>  Jika Anda berencana untuk bekerja hanya di perangkat seluler atau di peramban, lalu pilih "Butuh perangkat dengan layar." <br><br>  Selanjutnya, masukkan pengaturan untuk katalog skill Alice.  Jika Anda berencana untuk menggunakan kata merek untuk aktivasi, Anda harus melalui verifikasi situs web merek di layanan webmaster.yandex.ru. <br><br><img src="https://habrastorage.org/webt/po/m0/tq/pom0tqpnvsr2q6dg56xmnxbwysm.png"><br><br>  Dengan pengaturan, buka skrip. <br><br><h3>  Skrip bot telegram </h3><br>  Mari kita mulai dengan skrip untuk Telegram. <br><br>  Kami menghubungkan perpustakaan tempat pesan dari bot dan Alice akan diproses: <br><br><pre> <code class="cpp hljs">include_once <span class="hljs-string"><span class="hljs-string">'webhook_parse.php'</span></span>;</code> </pre><br>  Kami menetapkan token bot kami: <br><br><pre> <code class="cpp hljs">$tg_bot_token = <span class="hljs-string"><span class="hljs-string">"_____YOUR_BOT_TOKEN_____"</span></span>;</code> </pre><br>  Kami mendapatkan data: <br><br><pre> <code class="cpp hljs">$request = file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>); $request = json_decode($request, TRUE);</code> </pre><br>  Kami mengurai data ke dalam variabel: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$request) { die(); <span class="hljs-comment"><span class="hljs-comment">// Some Error output (request is not valid JSON) } else if (!isset($request['update_id']) || !isset($request['message'])) { die(); // Some Error output (request has not message) } else { $user_id = $request['message']['from']['id']; $msg_user_name = $request['message']['from']['first_name']; $msg_user_last_name = $request['message']['from']['last_name']; $msg_user_nick_name = $request['message']['from']['username']; $msg_chat_id = $request['message']['chat']['id']; $msg_text = $request['message']['text']; $msg_text = mb_strtolower($msg_text, 'UTF-8'); $tokens = explode(" ", $msg_text); }</span></span></code> </pre><br>  Sekarang Anda dapat bekerja dengan variabel: <br><br>  $ token - sekarang semua kata yang dimasukkan pengguna di sini <br><br>  $ user_id - ini adalah id pengguna <br><br>  $ msg_chat_id - obrolan di mana bot menerima perintah <br><br>  $ msg_user_name - nama pengguna <br><br>  Selanjutnya, kita memanggil fungsi Parse_Tokens untuk diproses: <br><br><pre> <code class="cpp hljs">$Out_Str = Parse_Tokens($tokens);</code> </pre><br>  Dan kami mengirim jawabannya: <br><br><pre> <code class="cpp hljs">Send_Out($user_id, $Out_Str);</code> </pre><br>  fungsi Send_Out sederhana dan terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Send_Out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($user_id, $text, $is_end = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ global $tg_bot_token; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>($user_id) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>($text) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;} $json = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://api.telegram.org/bot'</span></span> . $tg_bot_token . <span class="hljs-string"><span class="hljs-string">'/sendMessage?chat_id='</span></span> . $user_id . <span class="hljs-string"><span class="hljs-string">'&amp;text='</span></span> . $text); }</code> </pre><br><h3>  Skill keterampilan untuk Yandex.Alice </h3><br>  Sekarang mari kita beralih ke script untuk Alice, itu hampir sama dengan Telegram. <br><br>  Kami juga menghubungkan perpustakaan tempat pesan dari bot dan Alice akan diproses, ditambah perpustakaan dengan kelas untuk Alice: <br><br><pre> <code class="cpp hljs">include_once <span class="hljs-string"><span class="hljs-string">'classes_alice.php'</span></span>; include_once <span class="hljs-string"><span class="hljs-string">'webhook_parse.php'</span></span>;</code> </pre><br>  Kami mendapatkan data: <br><br><pre> <code class="cpp hljs">$data = json_decode(trim(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>)), <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br>  Kami mengurai data ke dalam variabel: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isset($data[<span class="hljs-string"><span class="hljs-string">'request'</span></span>])) { <span class="hljs-comment"><span class="hljs-comment">//original_utterance if (isset($data['meta'])) { $data_meta = $data['meta']; if (isset($data_meta['client_id'])) {$client_id = $data_meta['client_id'];} } if (isset($data['request'])) { $data_req = $data['request']; if (isset($data_req['original_utterance'])) { $original_utterance = $data_req['original_utterance']; } if (isset($data_req['command'])) {$data_msg = $data_req['command'];} if (isset($data_req['nlu'])) { $data_nlu = $data_req['nlu']; if (isset($data_nlu['tokens'])) {$tokens = $data_nlu['tokens'];} // $data_token_count = count($data_tokens); } } if (isset($data['session'])) { $data_session = $data['session']; if (isset($data_session['new'])) {$data_msg_new = $data_session['new'];} if (isset($data_session['message_id'])) {$data_msg_id = $data_session['message_id'];} if (isset($data_session['session_id'])) {$data_msg_sess_id = $data_session['session_id'];} if (isset($data_session['skill_id'])) {$skill_id = $data_session['skill_id'];} if (isset($data_session['user_id'])) {$user_id = $data_session['user_id'];} } }</span></span></code> </pre><br>  Di sini variabel yang diperlukan sedikit kurang: <br><br>  $ token - sekarang semua kata yang dimasukkan pengguna di sini <br><br>  $ user_id - ini adalah id pengguna <br><br>  Yandex terus-menerus memunculkan keterampilan yang dipublikasikan, dan saya menambahkan baris untuk segera keluar dari skrip tanpa memulai pemrosesan pesan lengkap: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strpos($tokens[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) {Send_Out(<span class="hljs-string"><span class="hljs-string">"pong"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);}</code> </pre><br>  Kami memanggil fungsi Parse_Tokens untuk diproses, sama seperti Telegram: <br><br><pre> <code class="cpp hljs">$Out_Str = Parse_Tokens($tokens);</code> </pre><br>  Dan kami mengirim jawabannya: <br><br><pre> <code class="cpp hljs">Send_Out($user_id, $Out_Str);</code> </pre><br>  Fungsi Send_Out lebih rumit di sini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Send_Out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($user_id, $out_text, $out_tts = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $is_end = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ global $data_msg_sess_id, $user_id; <span class="hljs-comment"><span class="hljs-comment">///// GENERATE BASE OF OUT ////// $Data_Out = new Alice_Data_Out(); $Data_Out-&gt;response = new Alice_Response(); $Data_Out-&gt;session = new Alice_Session(); ///// GENERATE BASE OF OUT End ////// ///// OUT MSG GENERATE ///// $Data_Out-&gt;session-&gt;session_id = $data_msg_sess_id;; $Data_Out-&gt;session-&gt;user_id = $user_id; $Data_Out-&gt;response-&gt;text = $out_text; $Data_Out-&gt;response-&gt;tts = $out_tts; if (strlen($out_tts) &lt; 1) {$Data_Out-&gt;response-&gt;tts = $out_text;} $Data_Out-&gt;response-&gt;end_session = $is_end; header('Content-Type: application/json'); print(json_encode($Data_Out, JSON_HEX_TAG | JSON_HEX_AMP | JSON_HEX_APOS | JSON_HEX_QUOT)); die(); }</span></span></code> </pre><br>  Menyelesaikan skrip untuk Alice. <br><br>  Script pemrosesan Parse_Tokens sendiri dilakukan murni misalnya, Anda dapat melakukan pemeriksaan dan pemrosesan di sana. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parse_Tokens</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($tokens)</span></span></span><span class="hljs-function"> </span></span>{ $out = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-comment"><span class="hljs-comment">// do something with tokens // $out = "Your eneter " . count($tokens) . " words: " . implode($tokens, " "); return $out; }</span></span></code> </pre><br>  Jika Anda perlu berkomunikasi dengan pengguna dengan bentuk yang lebih kompleks daripada tanya jawab, Anda perlu menyimpan dalam database (misalnya mysql) $ user_id dari pengguna dan data yang sudah diterima dari pengguna dan menganalisisnya dalam fungsi Parse_Tokens. <br><br>  Sebenarnya, ini hampir semuanya, jika semuanya dilakukan dengan benar, maka bot Telegram sudah tersedia, keterampilan Alice dapat diperiksa dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dialogs.yandex.ru/developer</a> , pergi ke keahlian baru Anda pada tab pengujian. <br><br><img src="https://habrastorage.org/webt/oh/u8/6h/ohu86hi-xtgcj-huw2x7ha15ody.png"><br><br>  Jika semuanya berfungsi dengan benar, Anda dapat mengirim keterampilan ke moderasi dengan mengklik tombol "Moderasi". <br><br>  Sekarang Anda memiliki dua bot untuk platform berbeda yang bekerja dengan cara yang sama. <br><br>  Dokumentasi layanan Yandex.Dialog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> <br><br>  Skrip lengkap diposting di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">unduhan</a> github. <br><br>  Perbarui: bungkus semuanya dalam kelas dan perbarui repositori di github </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446174/">https://habr.com/ru/post/id446174/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446150/index.html">Pembelajaran mesin tanpa Python, Anaconda dan reptil lainnya</a></li>
<li><a href="../id446152/index.html">Commando VM - Kali Linux Alternatif untuk Windows</a></li>
<li><a href="../id446162/index.html">Bagaimana menjadi "junior yang cerdas." Pengalaman pribadi</a></li>
<li><a href="../id446166/index.html">Codec ASN1 sprintf sederhana</a></li>
<li><a href="../id446172/index.html">Batasi Pesan API VK - apa yang harus dilakukan</a></li>
<li><a href="../id446176/index.html">Pengenalan tangki dalam aliran video menggunakan metode pembelajaran mesin (+2 video di platform Elbrus dan Baikal)</a></li>
<li><a href="../id446180/index.html">Apakah MongoDB pilihan yang tepat?</a></li>
<li><a href="../id446184/index.html">Aplikasi TDD pada Spring Boot: menyelaraskan tes dan bekerja dengan konteksnya</a></li>
<li><a href="../id446186/index.html">Bagaimana Elon Musk mencoba menghancurkan informan di jajaran Tesla, dan apa yang terjadi</a></li>
<li><a href="../id446188/index.html">Apakah sudah waktunya untuk URL emoji?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>