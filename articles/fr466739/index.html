<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåö üßíüèª ‚ûó Le meilleur est l'ennemi du bien üöò üëäüèø üìè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article raconte comment nous avons d√©cid√© d'am√©liorer notre outil SelfTester interne que nous appliquons pour tester la qualit√© de l'analyseur PVS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le meilleur est l'ennemi du bien</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/466739/"><p><img src="https://habrastorage.org/getpro/habr/post_images/982/355/890/982355890903cccb9e35a693d48d72cf.png" alt="Image 6" align="left"></p>  Cet article raconte comment nous avons d√©cid√© d'am√©liorer notre outil SelfTester interne que nous appliquons pour tester la qualit√© de l'analyseur PVS-Studio.  L'am√©lioration √©tait simple et semblait utile, mais nous a caus√© des ennuis.  Plus tard, il s'est av√©r√© que nous ferions mieux d'abandonner l'id√©e. <br><a name="habracut"></a><br><h2>  Selftester </h2><br>  Nous d√©veloppons et promouvons l'analyseur de code statique PVS-Studio pour C, C ++, C # et Java.  Pour tester la qualit√© de notre analyseur, nous utilisons des outils internes, g√©n√©riquement appel√©s SelfTester.  Nous avons cr√©√© une version SelfTester distincte pour chaque langue prise en charge.  Cela est d√ª aux sp√©cificit√©s des tests, et c'est juste plus pratique.  Ainsi, nous avons actuellement trois outils internes SelfTester dans notre entreprise pour C \ C ++, C # et Java, respectivement.  De plus, je vais vous parler de la version Windows de SelfTester pour les projets Visual Studio C \ C ++, en l'appelant simplement SelfTester.  Ce testeur a √©t√© le premier d'une gamme d'outils internes similaires, c'est le plus avanc√© et le plus complexe de tous. <br><br>  Comment fonctionne SelfTester?  L'id√©e est simple: prendre un pool de projets de test (nous utilisons de vrais projets open source) et les analyser √† l'aide de PVS-Studio.  Par cons√©quent, un journal d'analyseur est g√©n√©r√© pour chaque projet.  Ce journal est compar√© au journal de <i>r√©f√©rence</i> du m√™me projet.  Lors de la comparaison des journaux, SelfTester cr√©e un <i>r√©sum√©</i> des journaux comparant d'une mani√®re conviviale pour les d√©veloppeurs. <br><br>  Apr√®s avoir √©tudi√© le r√©sum√©, un d√©veloppeur conclut sur les changements dans le comportement de l'analyseur en fonction du nombre et du type d'avertissements, de la vitesse de travail, des erreurs internes de l'analyseur, etc.  Toutes ces informations sont tr√®s importantes: elles vous permettent de savoir comment l'analyseur g√®re son travail. <br><br>  Sur la base du r√©sum√© de la comparaison des journaux, un d√©veloppeur introduit des modifications dans le c≈ìur de l'analyseur (par exemple, lors de la cr√©ation d'une nouvelle r√®gle de diagnostic) et contr√¥le imm√©diatement le r√©sultat de ses modifications.  Si un d√©veloppeur n'a plus de probl√®me avec la comparaison d'un journal normal, il cr√©e une <i>r√©f√©rence de</i> journal d'avertissements en cours pour un projet.  Sinon, le travail continue. <br><br>  Ainsi, la t√¢che de SelfTester est de travailler avec un pool de projets de test (en passant, il y en a plus de 120 pour C / C ++).  Les projets du pool sont s√©lectionn√©s sous forme de solutions Visual Studio.  Cela est fait afin de v√©rifier en outre le travail de l'analyseur sur diff√©rentes versions de Visual Studio, qui prennent en charge l'analyseur (√† ce stade de Visual Studio 2010 √† Visual Studio 2019). <br><br>  <i>Remarque:</i> plus loin, je s√©parerai les concepts <i>solution</i> et <i>projet</i> , en consid√©rant un projet comme faisant partie d'une solution. <br><br>  L'interface de SelfTester se pr√©sente comme suit: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d0/627/355/1d0627355eb338938aa789d33aedec83.png" alt="Image 3"></div><br>  Sur la gauche, il y a une liste de solutions, sur la droite - les r√©sultats d'une v√©rification pour chaque version de Visual Studio. <br><br>  Les √©tiquettes grises "Non pris en charge" indiquent qu'une solution ne prend pas en charge une version choisie de Visual Studio ou qu'elle n'a pas √©t√© convertie pour cette version.  Certaines solutions ont une configuration dans un pool, qui indique une version sp√©cifique de Visual Studio pour une v√©rification.  Si aucune version n'est sp√©cifi√©e, une solution sera mise √† jour pour toutes les versions ult√©rieures de Visual Studio.  Un exemple d'une telle solution se trouve sur la capture d'√©cran - "smart_ptr_check.sln" (une v√©rification est effectu√©e pour toutes les versions de Visual Studio). <br><br>  Une √©tiquette verte "OK" indique qu'une v√©rification r√©guli√®re n'a pas d√©tect√© de diff√©rences avec le journal de r√©f√©rence.  Une √©tiquette rouge "Diff" indique les diff√©rences.  Ces √©tiquettes doivent faire l'objet d'une attention particuli√®re.  Apr√®s avoir cliqu√© deux fois sur l'√©tiquette requise, la solution choisie sera ouverte dans une version Visual Studio associ√©e.  Une fen√™tre avec un journal des avertissements y sera √©galement ouverte.  Les boutons de contr√¥le en bas vous permettent de relancer l'analyse de la solution s√©lectionn√©e ou de toutes les solutions, de faire r√©f√©rence au journal choisi (ou en une seule fois), etc. <br><br>  Les r√©sultats de SelfTester sont toujours dupliqu√©s dans le rapport html (rapport diffs) <br><br>  En plus de l'interface graphique, SelfTester dispose √©galement de modes automatis√©s pour les ex√©cutions de construction de nuit.  Cependant, le mod√®le d'utilisation habituel r√©p√©t√© par le d√©veloppeur s'ex√©cute par un d√©veloppeur pendant la journ√©e de travail.  Par cons√©quent, l'une des caract√©ristiques les plus importantes de SelfTester est la vitesse de travail. <br><br>  Pourquoi la vitesse est importante: <br><br><ol><li> Les performances de chaque √©tape sont assez cruciales en termes de tests de nuit.  De toute √©vidence, plus les tests r√©ussissent rapidement, mieux c'est.  √Ä l'heure actuelle, le temps de performance moyen de SelfTester d√©passe 2 heures; </li><li>  Lors de l'ex√©cution de SelfTester pendant la journ√©e, un d√©veloppeur doit attendre moins le r√©sultat, ce qui augmente la productivit√© de sa main-d'≈ìuvre. </li></ol><br>  C'est l'acc√©l√©ration des performances qui est devenue la raison des am√©liorations cette fois. <br><br><h2>  Multi-threading dans SelfTester </h2><br>  SelfTester a √©t√© initialement cr√©√© comme une application multithread avec la possibilit√© de tester simultan√©ment plusieurs solutions.  La seule limitation √©tait que vous ne pouviez pas v√©rifier simultan√©ment la m√™me solution pour diff√©rentes versions de Visual Studio, car de nombreuses solutions doivent √™tre mises √† jour vers certaines versions de Visual Studio avant de tester.  Au cours de celui-ci, des modifications sont introduites directement dans les fichiers des projets <i>.vcxproj</i> , ce qui entra√Æne des erreurs lors de l'ex√©cution parall√®le. <br><br>  Afin de rendre le travail plus efficace, SelfTester utilise un planificateur de t√¢ches intelligent pour d√©finir une valeur strictement limit√©e de threads parall√®les et la maintenir. <br><br>  Le planificateur est utilis√© sur deux niveaux.  Le premier est le niveau des <i>solutions</i> , il est utilis√© pour commencer √† tester la solution <i>.sln</i> √† l'aide de l'utilitaire <i>PVS-Studio_Cmd.exe</i> .  Le m√™me ordonnanceur, mais avec un autre param√®tre de <i>degr√©</i> de <i>parall√©lisme</i> , est utilis√© dans <i>PVS-Studio_Cmd.exe</i> (au niveau du test des <i>fichiers</i> source). <br><br>  Le degr√© de parall√©lisme est un param√®tre qui indique combien de threads parall√®les doivent √™tre ex√©cut√©s simultan√©ment.  <i>Quatre</i> et <i>huit</i> valeurs par d√©faut ont √©t√© choisies pour le degr√© de parall√©lisme des solutions et du niveau des fichiers, respectivement.  Ainsi, le nombre de threads parall√®les dans cette impl√©mentation doit √™tre de 32 (4 solutions test√©es simultan√©ment et 8 fichiers).  Ce param√®tre nous semble optimal pour le travail de l'analyseur sur un processeur √† huit c≈ìurs. <br><br>  Un d√©veloppeur peut d√©finir lui-m√™me d'autres valeurs du degr√© de parall√©lisme en fonction des performances de son ordinateur ou des t√¢ches en cours.  Si un d√©veloppeur ne sp√©cifie pas ce param√®tre, le nombre de processeurs de syst√®me logique sera choisi par d√©faut. <br><br>  <i>Remarque:</i> supposons en outre que nous traitons du degr√© de parall√©lisme par d√©faut. <br><br>  Le planificateur <i>LimitedConcurrencyLevelTaskScheduler</i> est h√©rit√© de <i>System.Threading.Tasks.TaskScheduler</i> et affin√© pour fournir le niveau de parall√©lisme maximal lors de l'utilisation de <i>ThreadPool</i> .  Hi√©rarchie d'h√©ritage: <br><br><pre><code class="cs hljs">LimitedConcurrencyLevelTaskScheduler : PausableTaskScheduler { .... } PausableTaskScheduler: TaskScheduler { .... }</code> </pre> <br>  <i>PausableTaskScheduler</i> vous permet de suspendre les performances des t√¢ches et, en plus de cela, <i>LimitedConcurrencyLevelTaskScheduler</i> fournit un contr√¥le intellectuel de la file d'attente des t√¢ches et la planification de leurs performances, en tenant compte du degr√© de parall√©lisme, de l'√©tendue des t√¢ches planifi√©es et d'autres facteurs.  Un planificateur est utilis√© lors de l'ex√©cution des t√¢ches <i>LimitedConcurrencyLevelTaskScheduler</i> . <br><br><h2>  Raisons des am√©liorations </h2><br>  Le proc√©d√© d√©crit ci-dessus pr√©sente un inconv√©nient: il n'est pas optimal lorsqu'il s'agit de solutions de tailles diff√©rentes.  Et la taille des solutions dans le pool de tests est <i>tr√®s</i> vari√©e: de 8 Ko √† 4 Go - la taille d'un dossier avec une solution et de 1 √† plusieurs milliers de fichiers de code source dans chacun. <br><br>  Le planificateur place les solutions dans la file d'attente les unes apr√®s les autres, sans aucun composant intelligent.  Permettez-moi de vous rappeler que par d√©faut, pas plus de quatre solutions peuvent √™tre test√©es simultan√©ment.  Si quatre grandes solutions sont actuellement test√©es (le nombre de fichiers dans chacune est sup√©rieur √† huit), il est suppos√© que nous travaillons efficacement car nous utilisons autant de threads que possible (32). <br><br>  Mais imaginons une situation assez fr√©quente, lorsque plusieurs petites solutions sont test√©es.  Par exemple, une solution est volumineuse et contient 50 fichiers (le nombre maximum de threads sera utilis√©), tandis que les trois autres solutions contiennent trois, quatre, cinq fichiers chacune.  Dans ce cas, nous n'utiliserons que 20 threads (8 + 3 + 4 + 5).  Nous obtenons une sous-utilisation du temps du processeur et des performances globales r√©duites. <br><br>  <i>Remarque</i> : en fait, le goulot d'√©tranglement est g√©n√©ralement le sous-syst√®me de disque, pas le processeur. <br><br><h2>  Am√©liorations </h2><br>  L'am√©lioration qui va de soi dans ce cas est le classement de la liste des solutions test√©es.  Nous devons obtenir une utilisation optimale du nombre d√©fini de threads ex√©cut√©s simultan√©ment (32), en passant √† tester des projets avec le nombre correct de fichiers. <br><br>  Reprenons notre exemple de test de quatre solutions avec le nombre de fichiers suivant dans chacune: 50, 3, 4 et 5. La t√¢che qui v√©rifie une solution de <i>trois</i> fichiers est susceptible de fonctionner le plus rapidement.  Il serait pr√©f√©rable d'ajouter une solution avec huit fichiers ou plus au lieu de celle-ci (afin d'utiliser au maximum les threads disponibles pour cette solution).  De cette fa√ßon, nous utiliserons 25 threads √† la fois (8 + <b>8</b> + 4 + 5).  Pas mal.  Cependant, sept threads ne sont toujours pas impliqu√©s.  Et voici l'id√©e d'un autre raffinement, qui consiste √† supprimer la limite de quatre threads sur les solutions de test.  Parce que nous pouvons maintenant ajouter non pas une, mais plusieurs solutions, en utilisant 32 threads.  Imaginons que nous ayons deux autres solutions de trois et quatre fichiers chacune.  L'ajout de ces t√¢ches comblera compl√®tement le "vide" des threads inutilis√©s et il y en aura 32 (8 + 8 + 4 + 5 + <b>3</b> + <b>4</b> ). <br><br>  J'esp√®re que l'id√©e est claire.  En fait, la mise en ≈ìuvre de ces am√©liorations n'a pas non plus exig√© beaucoup d'efforts.  Tout a √©t√© fait en une journ√©e. <br><br>  Nous avions besoin de retravailler la classe de t√¢ches: h√©ritant de <i>System.Threading.Tasks.Task</i> et affectation du champ "weight".  Nous utilisons un algorithme simple pour d√©finir le poids d'une solution: si le nombre de fichiers est inf√©rieur √† huit, le poids est √©gal √† ce nombre (par exemple, 5).  Si le nombre est sup√©rieur ou √©gal √† huit, le poids sera √©gal √† huit. <br><br>  Nous avons √©galement d√ª √©laborer l'ordonnanceur: lui apprendre √† choisir les solutions avec le poids n√©cessaire afin d'atteindre la valeur maximale de 32 threads.  Nous avons √©galement d√ª autoriser plus de quatre threads pour les tests de solutions simultan√©s. <br><br>  Enfin, nous avions besoin d'une √©tape pr√©liminaire pour analyser toutes les solutions du pool (√©valuation √† l'aide de l'API MSBuild) pour √©valuer et d√©finir le poids des solutions (obtenir le nombre de fichiers avec le code source). <br><br><h2>  R√©sultat </h2><br>  Je pense qu'apr√®s une si longue introduction, vous avez d√©j√† devin√© que rien n'en est sorti. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/91c/6c1/fca/91c6c1fca4017036c0fca83fd2113474.png" alt="Image 12"></div><br>  C'est bien que les am√©liorations aient √©t√© simples et rapides. <br><br>  Voici la partie de l'article o√π je vais vous parler de ce qui nous a ¬´caus√© de nombreux ennuis¬ª et de tout ce qui s'y rapporte. <br><br><h2>  Effets secondaires </h2><br>  Ainsi, un r√©sultat n√©gatif est √©galement un r√©sultat.  Il s'est av√©r√© que le nombre de grandes solutions dans le pool <i>d√©passe de loin</i> le nombre de petites (moins de huit fichiers).  Dans ce cas, ces am√©liorations n'ont pas d'effet tr√®s notable, car elles sont presque invisibles: tester de petits projets prend tr√®s peu de temps par rapport au temps, n√©cessaire pour les grands projets. <br><br>  Cependant, nous avons d√©cid√© de laisser le nouveau raffinement comme "non d√©rangeant" et potentiellement utile.  En outre, le pool de solutions de test est constamment renouvel√©, donc √† l'avenir, la situation changera peut-√™tre. <br><br>  Et puis ... <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdf/906/0ea/bdf9060ea6b9d1ce17ed820acc1468c7.png" alt="Image 5"></div><br>  L'un des d√©veloppeurs s'est plaint du crash du SelfTester.  Eh bien, la vie arrive.  Pour √©viter que cette erreur ne soit perdue, nous avons cr√©√© un incident interne (ticket) avec le nom "Exception lors de l'utilisation de SelfTester".  L'erreur s'est produite lors de l'√©valuation du projet.  Bien qu'un grand nombre de fen√™tres avec des erreurs aient indiqu√© le probl√®me dans le gestionnaire d'erreurs.  Mais cela a √©t√© rapidement √©limin√© et au cours de la semaine suivante, rien ne s'est √©cras√©.  Soudain, un autre utilisateur s'est plaint de SelfTester.  Encore une fois, l'erreur d'une √©valuation de projet: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fa/1f3/bd5/0fa1f3bd596a2a4bdbbc0f9ace32664c.png" alt="Image 8"></div><br>  Cette fois, la pile contenait beaucoup d'informations utiles - l'erreur √©tait au format xml.  Il est probable que lors de la manipulation du fichier du projet <i>Proto_IRC.vcxproj</i> (sa repr√©sentation xml), quelque chose soit arriv√© au fichier lui-m√™me, c'est pourquoi <i>XmlTextReader</i> n'a pas pu le g√©rer. <br><br>  Le fait d'avoir deux erreurs en un laps de temps assez court nous a fait examiner de plus pr√®s le probl√®me.  De plus, comme je l'ai dit plus haut, SelfTester est tr√®s activement utilis√© par les d√©veloppeurs. <br><br>  Pour commencer, nous avons analys√© le dernier crash.  Malheureusement, nous n'avons rien trouv√© de suspect.  Juste au cas o√π nous aurions demand√© aux d√©veloppeurs (utilisateurs SelfTester) de garder un ≈ìil et de signaler les erreurs possibles. <br><br>  Point important: le code erron√© a √©t√© r√©utilis√© dans SelfTester.  Il √©tait √† l'origine utilis√© pour √©valuer des projets dans l'analyseur lui <i>-</i> m√™me ( <i>PVS-Studio_Cmd.exe</i> ).  C'est pourquoi l'attention port√©e au probl√®me a augment√©.  Cependant, il n'y a pas eu de tels plantages dans l'analyseur. <br><br>  Pendant ce temps, le ticket sur les probl√®mes avec SelfTester a √©t√© compl√©t√© par de nouvelles erreurs: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b49/15a/0ae/b4915a0aecc426246419f4a26e62a233.png" alt="Image 9"></div><br>  <i>XmlException √†</i> nouveau.  De toute √©vidence, il existe des threads concurrents quelque part qui fonctionnent avec la lecture et l'√©criture des fichiers de projet.  SelfTester fonctionne avec des projets dans les cas suivants: <br><br><ol><li>  √âvaluation des projets au cours du calcul pr√©liminaire des poids des solutions: une nouvelle √©tape qui a d'abord suscit√© la suspicion; </li><li>  La mise √† jour des projets vers les versions de Visual Studio n√©cessaires: est effectu√©e juste avant le test (les projets n'interf√®rent pas) et ne doit pas affecter le processus de travail. </li><li>  √âvaluation des projets pendant les tests: un m√©canisme thread-safe bien √©tabli, r√©utilis√© √† partir de <i>PVS-Studio_Cmd.exe</i> ; </li><li>  Restauration des fichiers de projet (remplacement des fichiers <i>.vcxproj</i> modifi√©s <i>par des</i> fichiers de r√©f√©rence initiaux) lors de la fermeture de SelfTester, car les fichiers de projet peuvent se mettre √† jour vers les versions de Visual Studio n√©cessaires pendant le travail.  C'est une derni√®re √©tape, qui n'a aucun impact sur les autres m√©canismes. </li></ol><br>  Les soup√ßons sont tomb√©s sur le nouveau code ajout√© pour l'optimisation (calcul du poids).  Mais son enqu√™te sur le code a montr√© que si un utilisateur ex√©cute l'analyse juste apr√®s le d√©marrage de SelfTester, le testeur attend toujours correctement jusqu'√† la fin de la pr√©-√©valuation.  Cet endroit avait l'air s√ªr. <br><br>  Encore une fois, nous n'avons pas pu identifier la source du probl√®me. <br><br><h2>  La douleur </h2><br>  Tout le mois suivant, SelfTester a continu√© de planter.  Le ticket continuait de se remplir de donn√©es, mais il n'√©tait pas clair que faire de ces donn√©es.  La plupart des plantages √©taient avec la m√™me <i>exception XmlException.</i>  Parfois, il y avait autre chose, mais sur le m√™me code r√©utilis√© de <i>PVS-Studio_Cmd.exe</i> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c31/fbe/c11/c31fbec1152210e397b6d9d1ffdb5aa6.png" alt="Image 1"></div><br>  Traditionnellement, les outils internes ne sont pas soumis √† des exigences tr√®s √©lev√©es, nous avons donc continu√© √† d√©router les erreurs de SelfTester sur un principe r√©siduel.  De temps en temps, diff√©rentes personnes se sont impliqu√©es (pendant tout l'incident, six personnes ont travaill√© sur le probl√®me, dont deux internes).  Cependant, nous avons d√ª nous laisser distraire par cette t√¢che. <br><br>  <i>Notre premi√®re erreur.</i>  En fait, √† ce stade, nous aurions pu r√©soudre ce probl√®me une fois pour toutes.  Comment?  Il √©tait clair que l'erreur √©tait due √† une nouvelle optimisation.  Apr√®s tout, avant que tout fonctionne bien, et le code r√©utilis√© ne peut clairement pas √™tre si mauvais.  De plus, cette optimisation n'avait apport√© aucun avantage.  Alors, que fallait-il faire?  <i>Supprimez cette optimisation.</i>  Comme vous le comprenez probablement, cela n'a pas √©t√© fait.  Nous avons continu√© √† travailler sur le probl√®me, que nous avons cr√©√© nous-m√™mes.  Nous avons continu√© √† chercher la r√©ponse: "COMMENT ???"  Comment √ßa plante?  Il semblait √™tre √©crit correctement. <br><br>  <i>Notre deuxi√®me erreur.</i>  <i>D'autres personnes se sont impliqu√©es</i> dans la r√©solution du probl√®me <i>.</i>  C'est une tr√®s, tr√®s grosse erreur.  Non seulement le probl√®me n'a pas √©t√© r√©solu, mais il a √©galement n√©cessit√© des ressources suppl√©mentaires inutiles.  Oui, de nouvelles personnes ont apport√© de nouvelles id√©es, mais il a fallu beaucoup de temps pour mettre en ≈ìuvre (pour rien) ces id√©es.  √Ä un moment donn√©, nos stagiaires ont √©crit des programmes de test √©mulant l'√©valuation d'un seul et m√™me projet dans diff√©rents threads avec modification parall√®le d'un projet dans un autre projet.  √áa n'a pas aid√©.  Nous avons seulement d√©couvert que l'API MSBuild √©tait thread-safe √† l'int√©rieur, ce que nous connaissions d√©j√†.  Nous avons √©galement ajout√© l'enregistrement automatique de mini vidage lorsque l'exception <i>XmlException</i> se produit.  Nous avions quelqu'un qui d√©boguait tout cela.  Pauvre gars!  Il y a eu des discussions, nous avons fait d'autres choses inutiles. <br><br>  <i>Enfin, troisi√®me erreur.</i>  Savez-vous combien de temps s'est √©coul√© entre le moment o√π le probl√®me SelfTester s'est produit et celui o√π il a √©t√© r√©solu?  Eh bien, vous pouvez vous compter.  Le billet a √©t√© cr√©√© le 17/09/2018 et ferm√© le 20/02/2019.  Il y a eu plus de 40 commentaires!  Les gars, c'est beaucoup de temps!  Nous <i>nous</i> sommes <i>permis</i> d'√™tre occup√©s pendant cinq mois avec CECI.  Dans le m√™me temps, nous √©tions occup√©s √† prendre en charge Visual Studio 2019, √† ajouter le support du langage Java, √† introduire la norme MISRA C / C ++, √† am√©liorer l'analyseur C #, √† participer activement aux conf√©rences, √† r√©diger un tas d'articles, etc.  Toutes ces activit√©s ont re√ßu moins de temps de la part des d√©veloppeurs en raison d'une erreur stupide dans SelfTester. <br><br>  Mes amis, apprenez de nos erreurs et ne faites jamais √ßa.  Nous non plus. <br><br>  √áa y est, j'ai fini. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/a29/f94/3a8a29f94aeed35ddeaec17222a4f990.png" alt="Image 15"></div><br>  D'accord, c'√©tait une blague, je vais vous dire quel √©tait le probl√®me avec SelfTester :) <br><br><h2>  Bingo! </h2><br>  Heureusement, il y avait une personne parmi nous qui avait les yeux clairs (mon coll√®gue Sergey Vasiliev), qui vient de regarder le probl√®me sous un angle tr√®s diff√©rent (et aussi - il a eu un peu de chance).  Et si tout va bien √† l'int√©rieur du SelfTester, mais que quelque chose de l'ext√©rieur bloque les projets?  Habituellement, nous n'avions rien lanc√© avec SelfTester, dans certains cas, nous contr√¥lions strictement l'environnement d'ex√©cution.  Dans ce cas, ce "quelque chose" pourrait √™tre SelfTester lui-m√™me, mais une instance diff√©rente. <br><br>  Lorsque vous quittez SelfTester, le thread qui restaure les fichiers de projet √† partir des r√©f√©rences continue de fonctionner pendant un certain temps.  √Ä ce stade, le testeur peut √™tre relanc√©.  La protection contre les ex√©cutions simultan√©es de plusieurs instances SelfTester a √©t√© ajout√©e <i>ult√©rieurement</i> et se pr√©sente d√©sormais comme suit: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a3/7bf/437/0a37bf4373e3beb9bbfe2542afb258a0.png" alt="Image 16"></div><br>  Mais √† ce moment-l√†, nous ne l'avions pas. <br><br>  Des noix, mais c'est vrai - pendant pr√®s de six mois de tourments, personne n'y a pr√™t√© attention.  La restauration de projets √† partir de r√©f√©rences est une proc√©dure d'arri√®re-plan assez rapide, mais malheureusement pas assez rapide pour ne pas interf√©rer avec la relance de SelfTester.  Et que se passe-t-il lorsque nous le lan√ßons?  C'est vrai, calculer le poids des solutions.  Un processus r√©√©crit les fichiers <i>.vcxproj</i> tandis qu'un autre essaie de les lire.  Dites bonjour √† <i>XmlException</i> . <br><br>  Sergey a d√©couvert tout cela en ajoutant au testeur la possibilit√© de passer √† un autre ensemble de journaux de r√©f√©rence.  Cela est devenu n√©cessaire apr√®s l'ajout d'un ensemble de r√®gles MISRA dans l'analyseur.  Vous pouvez basculer directement dans l'interface, pendant que l'utilisateur voit cette fen√™tre: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/9b0/87d/0a59b087d0e13688ab41a690ed490a3f.png" alt="Image 14"></div><br>  Apr√®s cela, <i>SelfTester</i> red√©marre.  Et plus t√¥t, apparemment, les utilisateurs ont eux-m√™mes √©mul√© le probl√®me, ex√©cutant √† nouveau le testeur. <br><br><h2>  Blamestorming et conclusions </h2><br>  Bien s√ªr, nous avons supprim√© (c'est-√†-dire d√©sactiv√©) l'optimisation cr√©√©e pr√©c√©demment.  De plus, c'√©tait beaucoup plus facile que d'effectuer une sorte de synchronisation entre les red√©marrages du testeur par lui-m√™me.  Et tout a commenc√© √† fonctionner parfaitement, comme avant.  Et comme mesure suppl√©mentaire, nous avons ajout√© la protection ci-dessus contre le lancement simultan√© du testeur. <br><br>  J'ai d√©j√† √©crit ci-dessus sur nos principales erreurs lors de la recherche du probl√®me, donc assez d'auto-flagellation.  Nous sommes des √™tres humains, donc nous pourrions nous tromper.  Il est important d'apprendre de ses propres erreurs et de tirer des conclusions.  Les conclusions de ce cas sont assez simples: <br><br><ul><li>  Nous devons surveiller et estimer la complexit√© des t√¢ches; </li><li>  Parfois, nous devons nous arr√™ter √† un moment donn√©; </li><li>  Essayez de regarder le probl√®me plus largement.  Au fil du temps, on peut obtenir une vision tunnel de l'affaire alors qu'elle n√©cessite une nouvelle perspective. </li><li>  N'ayez pas peur de supprimer le code ancien ou inutile. </li></ul><br>  Voil√†, cette fois, j'ai d√©finitivement termin√©.  Merci d'avoir lu jusqu'√† la fin.  Je vous souhaite du code sans code! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466739/">https://habr.com/ru/post/fr466739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466729/index.html">Le livre "Data mining. R√©cup√©ration d'informations sur Facebook, Twitter, LinkedIn, Instagram, GitHub ¬ª</a></li>
<li><a href="../fr466731/index.html">Extravagance. Septembre se l√®ve</a></li>
<li><a href="../fr466733/index.html">Bienvenue √† DINS Java EVENING le 18 septembre</a></li>
<li><a href="../fr466735/index.html">Un moyen simple de cr√©er une alerte vocale dans le syst√®me domotique (¬´Smart Home¬ª)</a></li>
<li><a href="../fr466737/index.html">Pourquoi le r√©seau social Google+ a √©chou√©</a></li>
<li><a href="../fr466741/index.html">Le meilleur est l'ennemi du bien</a></li>
<li><a href="../fr466745/index.html">Le premier lieu de travail ou comment commencer √† d√©velopper une API sur Node.js</a></li>
<li><a href="../fr466747/index.html">D√©veloppeurs Mitap iOS chez Redmadrobot</a></li>
<li><a href="../fr466753/index.html">Administration r√©seau rapide et efficace - Network MACMonitor</a></li>
<li><a href="../fr466755/index.html">L'ordinateur vous rendra savoureux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>