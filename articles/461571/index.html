<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游뱦 游볷 游뱇 SVG en la vida real. Informe Yandex 游땡 游븼游낕 游</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, mi nombre es Artyom, soy el jefe de uno de los grupos de desarrollo de interfaces en Yandex. Hace una semana en Ya. Subbotnik Dije c칩mo usamos S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SVG en la vida real. Informe Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/461571/"> Hola, mi nombre es Artyom, soy el jefe de uno de los grupos de desarrollo de interfaces en Yandex.  Hace una semana en Ya. Subbotnik Dije c칩mo usamos SVG para crear un calendario interno.  Esta es una transcripci칩n de mi informe, varias historias de la implementaci칩n del widget de calendario: escala, relleno de patrones, m치scaras, s칤mbolos y caracter칤sticas de formato. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/af/hj/b2/afhjb2fysygwu1kqxtxppwd181k.jpeg"></a> <br><br>  - Hay muchas personas trabajando en Yandex, todas en diferentes ciudades, en diferentes zonas horarias, y debe comprender cu치ndo est치n ocupados sus colegas y cu치ndo puede reunirse y hablar con ellos.  Decidimos dise침ar un calendario que ayudar치 a descubrirlo. <br><br><a name="habracut"></a>  Comenzamos, por supuesto, con un dise침o.  Se ve칤a as칤: <br><br><img src="https://habrastorage.org/webt/sv/5u/y0/sv5uy0sn1jwdgsv06nnvxzs2nqu.jpeg"><br><br>  Muestra eventos pares e impares con diferentes rellenos.  Los eventos que se superponen a otros eventos, es decir, est치n en la segunda capa, otro relleno.  Los eventos que duran todo el d칤a pintan todo el d칤a.  La hora actual se muestra a continuaci칩n.  Ese era el objetivo. <br><br><img src="https://habrastorage.org/webt/98/xk/b3/98xkb3ij0xigknbxr2cuh_ceazw.jpeg"><br><br>  Comenzamos a elegir en qu칠 lo haremos.  Hizo varios prototipos diferentes.  Comenzamos con el lienzo, pero hab칤a mucho c칩digo, escalando manualmente para escribir.  Tuvimos la idea de que el calendario ocupa tanto espacio como sea necesario, en diferentes dise침os tiene diferentes formas y tama침os.  Y para el lienzo fue complicado. <br><br>  Hubo un prototipo genial cuando generamos esta imagen completa con gradientes lineales, pero se movi칩 al escalar y al cambiar a la retina.  Por lo tanto, al final, llegamos a SVG.  Por qu칠  En primer lugar, hay un sistema de coordenadas completamente independiente del documento, por lo que puede colocar completamente todo dentro, y esto no se romper치 independientemente de nada.  Tambi칠n hay un trabajo normal con el escalado.  Incluso si hace zoom en el navegador, si abre la retina o estira el calendario de alguna manera, cambiar치 de tama침o como una imagen y, en cualquier caso, se ver치 normal.  Tuvimos un relleno de celda en el dise침o, y es muy bueno que SVG tenga un relleno de patr칩n. <br><br><img src="https://habrastorage.org/webt/2k/fr/gg/2kfrgg1wo76nrglcb5porf-rx88.jpeg"><br><br>  Para dibujar un calendario, necesita algunos datos.  Para dibujar el que est치 en el dise침o, debe saber en qu칠 fecha comienza, generalmente el actual, para saber cu치ntos d칤as deben ser horizontales, cu치ntas horas deben mostrarse verticalmente y qu칠 hora comienza el d칤a en el calendario.  Necesitamos de alguna manera obtener eventos. <br><br>  Como tenemos muchas oficinas en diferentes zonas horarias, decidimos que los eventos siempre llegar치n a UTC, y ya los mostraremos en el cliente para los usuarios, ya que es necesario mirar el calendario de nuestra zona horaria y de la zona horaria de la persona, de qui칠n es el calendario que est치s mirando, para entender que ahora es de noche y que es mejor no hacer una cita.  Lo que est치 resaltado en rojo se usar치 m치s adelante. <br><br><img src="https://habrastorage.org/webt/ve/zu/lf/vezulfk7ebhp9tbicgmjrahsagc.jpeg"><br><br>  Comencemos con lo b치sico.  SVG es un plano de coordenadas gigante en el que los gr치ficos vectoriales se pueden colocar arbitrariamente.  Al mismo tiempo, la parte del 치rea que vemos est치 determinada por viewBox, y lo que est치 detr치s de sus bordes es un desbordamiento oculto en los esteroides.  Sea lo que sea, no ser치 visible.  Decidimos que, para simplificar los c치lculos, haremos que un p칤xel en el calendario sea igual a un minuto.  Por lo tanto, una hora ocupar치 exactamente 60 p칤xeles.  Para hacerlo a칰n m치s simple, decidimos que el d칤a en ancho tambi칠n ser칤a de 60 p칤xeles, de modo que todo fuera cuadrado, como en el ej칠rcito.  Y comenzaron a componer. <br><br>  Viewbox est치 configurado por cuatro par치metros.  Los dos primeros son el punto superior izquierdo en el sistema de coordenadas, desde el cual se considera viewBox, para nosotros es 0.0.  El ancho es 60 * para la cantidad de d칤as y la altura es 60 * para la cantidad de horas. <br><br>  Es v치lido insertar otros documentos SVG dentro del SVG, que tendr치 su propio sistema de coordenadas dentro.  Y para que los eventos en el d칤a pudieran posicionarse solo a lo largo del eje vertical, decidimos que para cada d칤a tendremos un SVG separado, y simplemente los cambiaremos horizontalmente por 60 * a la posici칩n del d칤a en el calendario.  Entonces, todos los eventos se pueden configurar simplemente verticalmente en Y, ser치 muy conveniente.  Y dentro de cada SVG, que es un d칤a, colocamos un rect치ngulo que mostrar치 el relleno del d칤a. <br><br>  Este rect치ngulo, dado que no se especifica color de relleno, heredar치 la propiedad de relleno de SVG.  En este caso, este d칤a est치 funcionando y dos d칤as a la semana libres, por lo que est치n inundados de luz.  Esto solo est치 determinado por las clases. <br><br><img src="https://habrastorage.org/webt/81/n0/nm/81n0nmbffb0doxecq1gvx7wcc5s.jpeg"><br><br>  Hay un espacio en blanco.  Ahora necesita agregar la cuadr칤cula.  Como quer칤amos cambiar el tama침o del calendario, y las l칤neas de la cuadr칤cula siempre deber칤an ser de un solo p칤xel, utilizamos el atributo vector-effect = non-scaling-stroke.  Esto lleva al hecho de que no importa c칩mo cambiemos el tama침o o el zoom, siempre habr치 una cuadr칤cula de un solo p칤xel.  Es suficiente agregar la cantidad correcta de l칤neas horizontales y verticales, y habr치 una grilla de este tipo. <br><br><img src="https://habrastorage.org/webt/yw/ok/hg/ywokhgezdap7lon0dmcuisktia8.jpeg"><br><br>  Hemos descubierto la base, pasemos a los eventos de todo el d칤a.  Esto es algo muy complicado.  Not칩 que hay eventos en los calendarios y hay una marca de verificaci칩n "todo el d칤a".  Estos eventos son diferentes en el sentido de que pasan todo el d칤a, sin importar la zona horaria que est칠 viendo.  Por lo tanto, si en alg칰n lugar al comienzo de las zonas horarias en Alaska el evento comienza temprano en la ma침ana, entonces en alg칰n lugar dentro de las 48 horas en el extremo opuesto del globo continuar치.  Suena complicado, pero es m치s f치cil de implementar: solo compare la fecha con la fecha del d칤a mostrado.  Si golpea, significa un evento en ese d칤a.  Si dos eventos para todo el d칤a caen en el d칤a, entonces se muestra el que comenz칩 m치s tarde.  As칤 que llena los eventos de espect치culos para todo el d칤a. <br><br><img src="https://habrastorage.org/webt/7m/rz/wv/7mrzwvwwi6clluc6jdh4gqkfyiu.jpeg"><br><br>  Con otros eventos es un poco m치s dif칤cil.  Hay, digamos, una reuni칩n.  Est치 lleno de azul, todo es simple.  Sin embargo, si dos reuniones se llevan a cabo en una fila, de acuerdo con nuestro dise침o, las llenamos con diferentes colores, son pares e impares. <br><br>  Si una reuni칩n se cruza con otra, se encuentra m치s arriba, debe mostrarla de alguna manera.  Si hay intersecciones con las reuniones, se vierten completamente por separado, en celdas.  Y para hacernos a칰n m치s divertidos, no solo tenemos reuniones, sino tambi칠n ausencias, conferencias y mucho m치s.  No quer칤a codificar todo esto en el dise침o, as칤 que decidimos averiguar c칩mo es m치s o menos entre navegadores y conveniente para configurar en CSS. <br><br><img src="https://habrastorage.org/webt/5g/tr/tk/5gtrtkzwlyddpnutc-pifopjssq.jpeg"><br><br>  Ahora habr치 el ejemplo m치s dif칤cil de todo el informe, sea paciente y est칠 atento, habr치 tres pasos, luego ser치 m치s f치cil. <br><br>  Comencemos en orden.  SVG tiene una etiqueta &lt;defs&gt;, le permite declarar elementos dentro de ella que no se muestran, pero puede usarlos por referencia, refiri칠ndose a ellos.  Lo primero que haremos es declarar &lt;defs&gt; y crear un patr칩n en 칠l.  &lt;patr칩n&gt; es una etiqueta que le permite declarar un patr칩n que puede usar para llenar un elemento particular con un patr칩n particular. <br><br>  Necesitamos hacer c칠lulas en este patr칩n.  Tenemos 60 por 60 p칤xeles, las celdas deben ser de 6 por 6, por lo que declaramos un patr칩n de 12 por 12 y dibujamos un &lt;path&gt; dentro de 칠l, como en el diagrama de la izquierda.  Tiene un atributo d, que indica exactamente c칩mo se mueve la l칤nea.  Comienza desde el punto 0,0, y luego las coordenadas muestran a las flechas c칩mo se dibuja.  Si lo llenamos de blanco, obtenemos el siguiente patr칩n: lo que no est치 inundado de blanco, est치 inundado de negro. <br><br><img src="https://habrastorage.org/webt/vg/sw/fu/vgswfu88zuzfiawxscejq7ral5o.jpeg"><br><br>  Vaya al siguiente paso, ahora declare la m치scara.  &lt;mask&gt; es un elemento en SVG que le permite agregar un canal alfa a otros elementos.  Lo que se dibuja en negro en la m치scara, en ese elemento al que se aplica la m치scara, es invisible, transparente.  Lo que est치 pintado en blanco es opaco.  Lo que es gris es transl칰cido.  Tenemos un patr칩n en blanco y negro, agregaremos un rect치ngulo dentro de la m치scara y lo rellenaremos con este patr칩n.  Ahora tenemos una m치scara. <br><br>  El siguiente paso es &lt;symbol&gt;.  Esta es una etiqueta en SVG, que le permite declarar gr치ficos reutilizables.  Muy a menudo, los s칤mbolos se usan, por ejemplo, para iconos.  Y aqu칤 declaramos un s칤mbolo, dentro del cual ponemos dos rect치ngulos.  Uno no se llena con nada para que herede la propiedad de relleno del SVG principal, y el otro se llenar치 con currentColor y le aplicar치 una m치scara.  Ahora tendremos dos rect치ngulos: uno con agujeros y relleno con currentColor, y el otro sin agujeros y relleno con relleno.  Y est치n acostados uno encima del otro.  Si establecemos estos colores de la misma manera, tendremos un relleno s칩lido.  Y si es diferente - c칠lulas.  Todo esto fue.  Ahora puede usar CSS y, a trav칠s de clases, establecer un relleno arbitrario de dos colores para todos los eventos. <br><br><img src="https://habrastorage.org/webt/lj/pp/la/ljpplaevfwydccmgwqm3zs0bhmq.jpeg"><br><br>  Ahora debe determinar exactamente qu칠 eventos deben incluirse en el calendario en un d칤a determinado.  Tenemos una zona horaria de +3, en la que todos nos sentamos, tiene una escala de 9 a 20 horas.  Tambi칠n hay una persona que se sienta en Orenburg condicional, tiene una zona horaria de +5, su escala se compensa con dos horas en relaci칩n con nosotros.  Haremos una proyecci칩n en UTC, y veremos que en UTC este intervalo de arriba a abajo debe mostrarse en la parte inferior para que el usuario pueda, cambiando entre zonas horarias, ver los eventos que caen en su calendario y el calendario de la persona que est치 mirando. . <br><br>  Recuerde estos n칰meros, que est치n en desplazamiento, porque es m치s f치cil colocar los eventos que llegan en UTC en el mismo UTC.  Para hacer esto, tomamos la etiqueta &lt;g&gt;, que denota un grupo en SVG, y colocamos todos los eventos all칤 absolutamente por UTC, y cambiaremos &lt;g&gt; por la cantidad de p칤xeles que necesitamos para mostrar una u otra zona horaria. <br><br><img src="https://habrastorage.org/webt/0l/yu/jk/0lyujkyfu18dmb5kpimya6fio2w.jpeg"><br><br>  Resumiendo este estudio, obtenemos que tenemos un s칤mbolo al que nos referimos, hay un tipo de evento, nivel, paridad, hay -120 minutos desde el comienzo del d칤a en UTC y una duraci칩n de 30 minutos.  Al agregar todos los eventos, obtenemos esa imagen. <br><br><img src="https://habrastorage.org/webt/ov/bi/6s/ovbi6sas81myfk1z4f2s9xlxb-4.jpeg"><br><br>  El tiempo actual tambi칠n se realiza de manera simple, ser치 una l칤nea con el mismo efecto de trazo sin escala, de modo que siempre sea de un solo p칤xel.  As칤 es como se muestra. <br><br>  El tiempo no se detiene y es necesario que la flecha se mueva.  La forma m치s genial que se nos ocurri칩 es la animaci칩n.  Decidimos que har칤amos una animaci칩n que desplazar칤a la flecha por la cantidad de minutos en un d칤a y lo har칤a en un d칤a.  Y para que no se mueva constantemente lentamente, es decir, marcando una vez por minuto, utilizamos los pasos ().  Y tan pronto como lo agregamos, el tiempo comenz칩 a moverse.  Al mismo tiempo, de hecho, dado que la animaci칩n no garantiza que se mover치 constantemente, se queda atr치s u otra cosa.  Pero nuestros eventos en el calendario se actualizan de vez en cuando, y en alg칰n lugar cada dos o tres minutos o cuando el usuario ha dejado la pesta침a y regresado, se vuelve a dibujar todo el calendario y se actualiza la hora.  Por lo tanto, la animaci칩n es visible solo cuando est치s sentado y observando atentamente si est치 marcando o no. <br><br><img src="https://habrastorage.org/webt/ui/82/pq/ui82pqjamllc_ee-1ng6d0ujbh4.jpeg"><br><br>  Hay un problema  Aqu칤 hice un calendario m치s ancho para que se pareciera m치s al que est치 en producci칩n.  Qued칩 claro que las celdas ya no son cuadradas.  Esto se debe a que las proporciones no se conservan, y si estiramos o cambiamos la relaci칩n de aspecto f칤sicamente, entonces cambia como en la imagen.  Para evitar esto, necesitas escribir un peque침o JS.  Existe la relaci칩n de aspecto viewBox, que estaba en nuestro SVG original, y la relaci칩n de aspecto real, que se usa en nuestro dise침o.  Si encuentra la proporci칩n de estas proporciones y luego la coloca en la transformaci칩n del patr칩n, las celdas se volver치n cuadradas.  Y tambi칠n este coeficiente, que obtuvimos aqu칤, se puede usar si queremos entender d칩nde hizo clic el usuario.  Como tenemos un minuto en el SVG original igual a un p칤xel, por las coordenadas del clic multiplicado por este coeficiente, podemos entender a qu칠 hora tiene el usuario. <br><br><img src="https://habrastorage.org/webt/e2/oz/gh/e2ozghfj0zoqbzcfz57anw9ycba.jpeg"><br><br>  Queda por agregar HTML para que haya letras y n칰meros en la parte superior.  Obt칠n un calendario. <br><br><img src="https://habrastorage.org/webt/pu/xh/o9/puxho9vkcjuawtkaa9mpf0kadzi.jpeg" width="350"><img src="https://habrastorage.org/webt/sq/bl/cc/sqblcctralj1csyh_putsqfszh4.jpeg" width="394"><br><br>  As칤 que esto se ve en producci칩n a trav칠s de los ojos de un usuario que se sienta en la zona horaria +5.  A continuaci칩n se muestra un interruptor de palanca que mi colega presiona, y el calendario se mueve en zonas horarias.  Luego hace clic en el evento y ve que el s치bado en la zona horaria +5, es decir, en este momento, mi informe est치 activado. <br><br><img src="https://habrastorage.org/webt/jt/bz/x9/jtbzx9epd4it3m5fbys7yf0waew.jpeg"><br><br>  Unos cuantos ejemplos m치s.  Aqu칤 est치 el calendario del desarrollador, 칠l tiene stand-ups, varias reuniones regulares y eso es todo.  Aqu칤 est치 el calendario del gerente.  Y aqu칤 est치 el dise침ador. <br><br>  Usa CSS, usa SVG.  Gracias </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461571/">https://habr.com/ru/post/461571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461561/index.html">Temporizador Arduino</a></li>
<li><a href="../461563/index.html">Sable l치ser de vapor de cobre casero - Parte 3 Final</a></li>
<li><a href="../461565/index.html">Los 5 mandamientos del desarrollador de TypeScript</a></li>
<li><a href="../461567/index.html">SQL Rompecabezas entretenidos</a></li>
<li><a href="../461569/index.html">Nota para el front-end: qu칠 verificar antes de probar</a></li>
<li><a href="../461575/index.html">Creaci칩n de una PBX basada en la nube 3CX en cualquier alojamiento compatible con Openstack</a></li>
<li><a href="../461577/index.html">Parte 5/2 Edif. 1: Crossroads of RocketChip Avenue y pista de instrumentaci칩n resbaladiza</a></li>
<li><a href="../461579/index.html">WebMoney presenta nuevas billeteras WMP y cambia las reglas del juego</a></li>
<li><a href="../461583/index.html">Python para ayudar a probar productos estructurales</a></li>
<li><a href="../461587/index.html">Localizaci칩n de la aplicaci칩n en 10 pasos.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>