<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÑ üïí ‚ÜòÔ∏è Sistema de prote√ß√£o contra vazamentos üåÜ ü§û üÜî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quero compartilhar minha experi√™ncia na cria√ß√£o de um dispositivo que n√£o foi apenas interessante de implementar, mas tamb√©m pode ser ben√©fico. Talvez...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de prote√ß√£o contra vazamentos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382065/"><img src="https://habrastorage.org/files/055/477/b38/055477b3811b49e2b9123bdccca872f1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero compartilhar minha experi√™ncia na cria√ß√£o de um dispositivo que n√£o foi apenas interessante de implementar, mas tamb√©m pode ser ben√©fico. </font><font style="vertical-align: inherit;">Talvez algu√©m diga que foi poss√≠vel fazer algo mais simples, mas esse n√£o √© o nosso caminho ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo come√ßou com o fato de que, ap√≥s o reparo do apartamento, um problema em potencial foi descoberto. </font><font style="vertical-align: inherit;">Em caso de vazamento em algum lugar, n√£o funcionar√° para os guindastes entrarem no apartamento sem um certo esfor√ßo f√≠sico e destreza, pois a escotilha que fecha os guindastes n√£o est√° muito bem instalada. </font><font style="vertical-align: inherit;">Portanto, em caso de necessidade urgente (acidente) de fechar as torneiras rapidamente, n√£o funcionar√°. </font><font style="vertical-align: inherit;">Era necess√°rio fazer algo com isso, e uma solu√ß√£o apareceu - para realizar a oportunidade remotamente, ou seja, </font><font style="vertical-align: inherit;">sem abrir a escotilha, interrompa o fornecimento de √°gua. </font><font style="vertical-align: inherit;">E, como b√¥nus, implementar tudo o mais que possa ser confi√°vel com a eletr√¥nica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que o dispositivo fica. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9fa/6a7/137/9fa6a713753a403ab27be8f6c4ffe0da.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caracter√≠sticas principais:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desligue o abastecimento de √°gua de forma independente em caso de vazamento</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desligue o abastecimento de √°gua "no modo manual" - no painel frontal h√° um "bot√£o vermelho" e um interruptor de duas posi√ß√µes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibir leituras do medidor no pr√≥prio visor</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibir outras informa√ß√µes √∫teis no visor</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o pode, mas planeja:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhe a partir de uma fonte de energia de backup. </font><font style="vertical-align: inherit;">Agora, no caso de falta de energia - o dispositivo √© in√∫til</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com sensores de vazamento sem fio</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limpe torneiras voc√™ mesmo. </font><font style="vertical-align: inherit;">Para n√£o se tornar √°cido, √© aconselh√°vel abrir / fech√°-las uma vez por m√™s</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notificar sobre eventos em um smartphone e ser controlado por "ar"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o pode (e n√£o importa o qu√£o necess√°rio):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possui v√°rios canais para leitura de diferentes sensores de vazamento com fio, agora todos os sensores (5 unid.) Est√£o conectados em paralelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerencie guindastes individualmente. </font><font style="vertical-align: inherit;">Existem dois deles (um na √°gua quente, o segundo na √°gua fria), e eles s√£o conectados em paralelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle de quebra de sensores</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, √© apresentada uma descri√ß√£o dos componentes e sua finalidade (pre√ßos em julho de 2015).</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    1/2 " DN15 DC5V</a> ( CR02,  ,     ) ‚Äî 3080   </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maple Mini (  stm32f103c8t6)</a>    ‚Äî 233 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SPI TFT LCD  ILI9341</a> ‚Äî 302 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Ds3231 + AT24C32</a>   ,  ,   ‚Äî 4  EEPROM ‚Äî 38 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ULN2003 DIP-16</a> ‚Äî    ‚Äî 123 /10  ( )</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> ‚Äî 239 /10  (  )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>     ‚Äî 164 /5  ( )</li>
<li>  ,  : ,  (    ), ,  , </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, eu tamb√©m precisava de um programador / emulador, usei este: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulador de ARM, suporta ARM7, ARM9, ARM11, n√∫cleo Cortex-M3, ADS, IAR, STM32, interface JTAG, vers√£o V8 com buffer duplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Entre os recursos, √© poss√≠vel mencionar que, al√©m dos </font><font style="vertical-align: inherit;">fios </font><font style="vertical-align: inherit;">padr√£o para a </font><font style="vertical-align: inherit;">programa√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eu tive que aplicar a tens√£o de alimenta√ß√£o atual do chip program√°vel a ele, 3,3 volts no meu caso. </font><font style="vertical-align: inherit;">√â necess√°rio que o programador entenda os n√≠veis de tens√£o dos valores l√≥gicos. </font><font style="vertical-align: inherit;">Sem isso, o chip program√°vel n√£o queria ser detectado. </font><font style="vertical-align: inherit;">Al√©m disso, este programador tem a capacidade de alimentar um dispositivo program√°vel, um pino √© fornecido para isso, a tens√£o √© ativada / desativada pelo utilit√°rio JLink.exe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais sobre ferro</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrolador</font></font></h3><img src="https://habrastorage.org/files/73d/47b/3b3/73d47b3b3ca9476dafadf503b3162931.jpg" width="300" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√©rebro de todo o sistema √© um microcontrolador de 32 bits da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuidadosamente soldado por trabalhadores chineses em f√°bricas chinesas a uma placa que √© "compat√≠vel" com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaf Maple Mini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o Leaf Maple Mini</font></font></b><div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como notado  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">eta4ever</a> <blockquote>  ,  </blockquote>        ¬´¬ª     ,    ‚Ä¶<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tem 48 conclus√µes. </font><font style="vertical-align: inherit;">O n√∫cleo √© executado em 72MHz, integrou SRAM - 20KB e Flash - 128KB. </font><font style="vertical-align: inherit;">Mais detalhes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esses par√¢metros definitivamente encorajam o uso de ferramentas e ferramentas de alto n√≠vel, ou seja, </font><font style="vertical-align: inherit;">s√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeRTOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , display gr√°fico colorido, C ++, etc. </font><font style="vertical-align: inherit;">(e n√£o dois LEDs e montador). </font><font style="vertical-align: inherit;">Em geral, n√£o se negue nada ... exceto C ++, mas isso n√£o √© um problema de chip.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por qu√™?</font></font></b><div class="spoiler_text">       C++ ,  ,     ,     . ,     C++      ,   ,  ,   , ..      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">STM32CubeMX</a>      ,   FreeRTOS.     ,      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando as conclus√µes do microcontrolador. </font><font style="vertical-align: inherit;">A partir daqui, voc√™ pode adivinhar o que est√° conectado.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/173/70e/067/17370e0676c64b75b9ddf7ec11a1ae29.png"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibi√ß√£o</font></font></h3><br>
<img src="https://habrastorage.org/files/c09/361/5b6/c093615b66774fb7969845db6584ee70.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√≥dulo com uma tela TFT de 320x240 pixels constru√≠da em um controlador compat√≠vel com ILI9341 √© respons√°vel pela exibi√ß√£o de informa√ß√µes; ele funciona pela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na frequ√™ncia m√°xima poss√≠vel para este pacote (18MHz). </font><font style="vertical-align: inherit;">O SPI √© conectado ao microcontrolador apenas em uma dire√ß√£o, a sa√≠da para leitura de dados do m√≥dulo de exibi√ß√£o permanece suspensa no ar, porque </font><font style="vertical-align: inherit;">N√£o criei essa funcionalidade, mas salvei-a nas pernas livres do microcontrolador. </font><font style="vertical-align: inherit;">A transfer√™ncia de dados funciona em </font></font><abbr title="DMA, ou acesso direto √† mem√≥ria - tecnologia de acesso direto √† mem√≥ria, ignorando o processador central"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um conector para conectar um cart√£o SD √© soldado ao m√≥dulo na parte traseira, n√£o testei o trabalho com um cart√£o SD e o conector n√£o est√° envolvido neste projeto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo RTC e EEPROM</font></font></h3><br>
<img src="https://habrastorage.org/files/527/406/51e/52740651ee344478a84c0a15f43c3c51.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rel√≥gio no m√≥dulo √© implementado com um chip DS3231. N√£o causei problemas especiais, o √∫nico inconveniente foi que todos os valores (data, hora) s√£o armazenados em registradores no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato BCD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , quando dois d√≠gitos decimais s√£o refletidos em um byte (nos quatro bits superiores - o d√≠gito mais significativo, no mais baixo - o d√≠gito menos significativo) . Por exemplo, o valor "38 minutos" √© armazenado como o valor decimal 56 (este √© "38" na nota√ß√£o hexadecimal). N√£o foi poss√≠vel descobrir se √© poss√≠vel mudar para o formato bin√°rio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√≥dulo possui bateria pr√≥pria; portanto, toda vez que voc√™ perde energia, n√£o precisa definir a hora e a data. Al√©m disso, o microcircuito AT24C32 √© soldado na placa do m√≥dulo, tendo 32768 bits EEPROM! Simplificando, s√£o 4 Kbytes de mem√≥ria n√£o vol√°til. O rel√≥gio e a mem√≥ria ficam no mesmo barramento I2C. No momento, a mem√≥ria √© usada apenas para armazenar as configura√ß√µes do dispositivo, o valor atual das leituras dos contadores e outras coisas. eventualmente ocupado ... 25 bytes. Posteriormente, ele ser√° usado para manter registros de v√°rios eventos e possivelmente para manter estat√≠sticas de consumo (n√£o sei por que, mas haver√° uma ocasi√£o para programar a exibi√ß√£o de gr√°ficos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m dos contatos e da alimenta√ß√£o do barramento I2C, h√° mais dois no quadro. </font><font style="vertical-align: inherit;">"SQW" √© o sinal do despertador que pode ser programado atrav√©s dos registros e "32K" √© a frequ√™ncia gerada pelo DS3231 para outros dispositivos. </font><font style="vertical-align: inherit;">Este projeto n√£o se aplica.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo com sensor de umidade</font></font></h3><br>
<img src="https://habrastorage.org/files/6a9/b19/bc1/6a9b19bc17f64a42bc008a3c5a3fe058.jpg" align="right" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â usado como um buffer entre o mundo externo e o microcontrolador. </font><font style="vertical-align: inherit;">Os fios que v√£o para as sondas no total t√™m um comprimento de cerca de 10 metros, sem uma tela. </font><font style="vertical-align: inherit;">Fios telef√¥nicos convencionais de dois fios. </font><font style="vertical-align: inherit;">No caso de um golpe est√°tico, espero que apenas este m√≥dulo morra, mas n√£o o microcontrolador. </font><font style="vertical-align: inherit;">√â capaz de medir a resist√™ncia entre dois eletrodos e fornecer essas informa√ß√µes na forma anal√≥gica (tens√£o de 0 √† tens√£o de alimenta√ß√£o) e digital (0/1, o m√≥dulo possui um resistor vari√°vel que pode ser ajustado ao limite de opera√ß√£o).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houve pequenos problemas com este m√≥dulo. Ao aplicar e remover a tens√£o de alimenta√ß√£o, o m√≥dulo na sa√≠da digital sinalizou um disparo, isso pode ser visto pelo LED piscando por uma fra√ß√£o de segundo (na placa do m√≥dulo, um LED √© instalado em paralelo com a sa√≠da digital). O microcontrolador conseguiu ler um sinal anormal quando a energia do sistema foi aplicada / reiniciada (problema n¬∫ 1). A solu√ß√£o foi implementada pulando pulsos de opera√ß√£o curtos, antecipando uma condi√ß√£o fixada por um tempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resistor vari√°vel possui um √¢ngulo de ajuste muito pequeno, no qual n√£o consegui encontrar o limite entre a aus√™ncia de falsos positivos e a boa sensibilidade (problema n¬∫ 2). Mais tarde, foi implementado a leitura do sinal anal√≥gico atrav√©s do microcontrolador ADC. Ao mesmo tempo, tornou-se poss√≠vel definir o limite de resposta nas configura√ß√µes do dispositivo como par√¢metro. A capacidade de ajustar o n√≠vel de resposta agora √© considerada sup√©rflua e provavelmente √© melhor codificar o valor limite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Percebeu-se que ap√≥s v√°rios minutos de opera√ß√£o (aquecimento?), O m√≥dulo repentinamente come√ßou a sinalizar opera√ß√£o espont√¢nea (problema n√∫mero 3, quantos deles?!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na fronteira das respostas anormais, a intensidade do brilho do LED (no m√≥dulo) aumenta ou diminui gradualmente, como se controlado por um gerador PWM, √© claro que isso √© ru√≠do e √© de alta frequ√™ncia, o mesmo poderia ser esperado na sa√≠da "digital" do m√≥dulo (problema no. 4 ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esclarecerei que todos esses problemas foram resolvidos ao implementar o sinal anal√≥gico do m√≥dulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As sondas (partes de sensores localizadas diretamente em locais de acumula√ß√£o de √°gua em caso de acidente) s√£o feitas de meios improvisados. Trata-se de estanho (a√ßo) e uma pequena caixa de deriva√ß√£o redonda, modificada mecanicamente para o tipo desejado e com fios soldados no interior. Quando a √°gua entra entre os pares de eletrodos, a resist√™ncia diminui e √© considerada pelo controlador como um ‚Äúvazamento‚Äù.</font></font><br>
<br>
<img src="https://habrastorage.org/files/bc7/366/3ad/bc73663ad6f048079b0ca835a353a0b6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testes de laborat√≥rio mostraram que o produto desempenha bem sua fun√ß√£o e n√£o √© um elo fraco do sistema.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutri√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o sistema funciona com o carregamento do telefone - 5 volts, 2A (aqui com uma margem). </font><font style="vertical-align: inherit;">Na placa Maple Mini, um regulador de tens√£o de 3,3 volts √© instalado, a tens√£o de entrada pode ser de at√© 12 volts, as caracter√≠sticas do estabilizador permitem, mas uma voltagem t√£o grande n√£o √© conveniente de usar, mais sobre isso abaixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com um estabilizador, 3,3 volts tamb√©m v√£o para a pot√™ncia dos m√≥dulos RTC, TFT e para o m√≥dulo de medi√ß√£o de umidade. </font><font style="vertical-align: inherit;">Os guindastes s√£o conectados atrav√©s do conjunto do interruptor de energia ULN2003AN, diretamente da fonte de alimenta√ß√£o, ou seja, </font><font style="vertical-align: inherit;">trabalhar a partir de 5 volts, menos a queda nas teclas. </font><font style="vertical-align: inherit;">O ULN2003AN usa apenas dois dos sete canais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, √© aconselh√°vel substituir a fonte de alimenta√ß√£o por outra, com uma voltagem um pouco mais alta, porque √Äs vezes, ao fechar os guindastes, um deles, em uma posi√ß√£o quase extrema devido √† opera√ß√£o de seu pr√≥prio reboque (duas pe√ßas s√£o instaladas no corpo da v√°lvula, para trabalhar nas posi√ß√µes extremas), p√°ra por uma fra√ß√£o de segundo e ocorre uma ‚Äúrecupera√ß√£o‚Äù (devido √† folga nas engrenagens da caixa de engrenagens ), depois uma tentativa repetida de apertar a v√°lvula de esfera e assim por diante at√© que o controlador remova a tens√£o de alimenta√ß√£o do servoconversor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O vendedor no site tem informa√ß√µes de que os guindastes devem funcionar a partir de 5 volts; nesse caso, a tens√£o √© fornecida menos. </font><font style="vertical-align: inherit;">O software √© desenvolvido para que, para abrir e fechar as torneiras, a tens√£o seja fornecida apenas por um determinado per√≠odo de tempo (6 segundos), per√≠odo durante o qual as torneiras devem ter tempo para abrir ou fechar. </font><font style="vertical-align: inherit;">Vale ressaltar que esse efeito n√£o afeta o fechamento incompleto da torneira, pois </font><font style="vertical-align: inherit;">esse momento chega depois que a torneira interrompe completamente o fluxo de √°gua. </font><font style="vertical-align: inherit;">Tamb√©m se pode mencionar que muita voltagem nos servos (aplicada 9 volts no experimento) os faz avan√ßar ainda mais por in√©rcia (depois que o interruptor de limite √© acionado) e se encostam na posi√ß√£o extrema com o som caracter√≠stico de um impacto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°lvulas de esfera servo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As v√°lvulas de fechamento parecem confi√°veis, mas a parte eletr√¥nica teve que ser finalizada. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b73/ca0/7bb/b73ca07bb94e48278a4de7c54d6056bb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ observar o circuito de controle do guindaste, notar√° que eles s√£o controlados por tens√£o positiva. </font><font style="vertical-align: inherit;">O geral "menos" e dois fios de pot√™ncia de sinal "mais", um para fechar e outro para abrir. </font><font style="vertical-align: inherit;">Mas o ULN2003AN n√£o pode funcionar nesse modo; nele, quando a chave √© aberta, a sa√≠da gerenciada √© conectada ao menos. </font><font style="vertical-align: inherit;">A solu√ß√£o √© alterar a polaridade de controle do pr√≥prio guindaste. </font><font style="vertical-align: inherit;">Para fazer isso, tive que trocar os sinais do "trailer", porque </font><font style="vertical-align: inherit;">devido a uma mudan√ßa de polaridade, o motor el√©trico girou na dire√ß√£o oposta (em compara√ß√£o com o circuito de estoque), enquanto as posi√ß√µes extremas est√£o agora em dire√ß√µes opostas. </font><font style="vertical-align: inherit;">Como resultado, temos um guindaste com um ‚Äúplus‚Äù comum e dois ‚Äúmenos‚Äù de controle. </font><font style="vertical-align: inherit;">Exatamente o que √© necess√°rio!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guindastes com servos em condi√ß√µes de "combate".</font></font><br>
<br>
<img src="https://habrastorage.org/files/7b0/9c1/7ae/7b09c17aebf74188a522f485fc6361fe.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leituras do medidor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, nenhum dado √© armazenado no pr√≥prio contador, que pode ser lido por dois fios removidos dele. </font><font style="vertical-align: inherit;">Esta √© apenas uma corrente com um interruptor de palheta e um √≠m√£ localizado em um impulsor rotativo. </font><font style="vertical-align: inherit;">As medi√ß√µes com um mult√≠metro n√£o mostraram a presen√ßa de nenhuma resist√™ncia ou capacit√¢ncia el√©trica no circuito. </font><font style="vertical-align: inherit;">Nos meus contadores, o circuito (com abertura subsequente) do interruptor reed ocorre a uma vaz√£o de um litro de √°gua. </font><font style="vertical-align: inherit;">Em algum lugar havia informa√ß√µes sobre os medidores, cujo sinal √© formado a cada 10 litros. </font><font style="vertical-align: inherit;">Essa. </font><font style="vertical-align: inherit;">Eles s√£o diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O microcontrolador √© necess√°rio para ler esses pulsos. </font><font style="vertical-align: inherit;">A interface do usu√°rio do dispositivo, √© claro, fornece o valor inicial.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De problemas existentes: na aus√™ncia de eletricidade, o consumo de √°gua n√£o ser√° levado em considera√ß√£o. H√° um defeito de hardware, √© necess√°rio consert√°-lo - fa√ßa backup das baterias, isso tamb√©m √© necess√°rio para as principais fun√ß√µes do dispositivo, caso contr√°rio, o dispositivo n√£o poder√° desligar as torneiras, se necess√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir daqui, as duas tarefas a seguir surgem:</font></font><br>
<ol>
<li>      . , ,    ¬´ ¬ª,     ,     () /     .      ,           (  ),       ¬´¬ª,   ,    (,        ),   ,      FreeRTOS.</li>
<li>        ,           ,          ¬´ ¬ª.<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feche as torneiras?</font></font></b><div class="spoiler_text">,   , , ,       , 11  ,    ,  ¬´¬ª ,          ,      ¬´¬ª  , !<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controles</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codificador</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Localizado ao lado da tela e projetado para navegar no menu. </font><font style="vertical-align: inherit;">Rota√ß√£o - v√° para o item de menu seguinte / anterior, pressione - selecione / ative um item de menu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bot√£o vermelho"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de desligar as torneiras √© pressionar o bot√£o vermelho. </font><font style="vertical-align: inherit;">Embora n√£o deva ser √∫til, porque </font><font style="vertical-align: inherit;">algum tempo antes, o pr√≥prio dispositivo tinha que fazer tudo. </font><font style="vertical-align: inherit;">Mas por precau√ß√£o, o bot√£o existe. </font><font style="vertical-align: inherit;">Pressione repetidamente, mantenha pressionado, clique duas vezes etc. </font><font style="vertical-align: inherit;">n√£o contado, apenas a primeira imprensa e √© isso. </font><font style="vertical-align: inherit;">O modo "emerg√™ncia" est√° ativado, s√≥ pode ser desativado atrav√©s de um item de menu especial.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interruptor On / Off</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles tamb√©m podem ser desativados por toques, mas tamb√©m podem ser abertos, √© claro, se o sistema n√£o estiver no modo "travar". </font><font style="vertical-align: inherit;">Pode ser √∫til para o desligamento tempor√°rio do suprimento de √°gua.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED tricolor</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo aqui tamb√©m √© simples. </font><font style="vertical-align: inherit;">Para indicar o modo atual: verde - tudo est√° em ordem, vermelho - nem tudo est√° em ordem, toques em azul s√£o bloqueados usando a chave seletora (veja o par√°grafo acima). </font><font style="vertical-align: inherit;">A mistura de cores n√£o √© usada, tr√™s foram suficientes. </font><font style="vertical-align: inherit;">Mas aqui surgiu um problema. </font><font style="vertical-align: inherit;">O brilho √© t√£o forte que brilha quando voc√™ olha para a tela. </font><font style="vertical-align: inherit;">470 ohms para cada cor n√£o foram suficientes. </font><font style="vertical-align: inherit;">Corrigido programaticamente. </font><font style="vertical-align: inherit;">Quando o monitor est√° em um estado ativo (e fica ativo enquanto voc√™ usa os controles e por um tempo), esse LED est√° apagado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo est√° funcionando, testes peri√≥dicos mostram que est√° funcionando corretamente. </font><font style="vertical-align: inherit;">N√£o congela, n√£o √© de buggy. </font><font style="vertical-align: inherit;">Embora eu saiba onde h√° erros potenciais, mas n√£o cr√≠ticos, no c√≥digo, isso n√£o √© discutido neste artigo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes, projeto Keil uVision 5, arquivo de projeto para STM32CubeMX</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt382065/">https://habr.com/ru/post/pt382065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt382051/index.html">Por que declarar encomendas pochta.fi na alf√¢ndega finlandesa?</a></li>
<li><a href="../pt382053/index.html">DNA investigado de coelho retorcido</a></li>
<li><a href="../pt382057/index.html">Maus conselhos a um guia para helic√≥pteros iniciantes. Parte 2</a></li>
<li><a href="../pt382059/index.html">[Post de informa√ß√µes] Sistemas de arquivos para drives USB e cart√µes de mem√≥ria</a></li>
<li><a href="../pt382063/index.html">√ìrg√£os sensoriais do carro</a></li>
<li><a href="../pt382067/index.html">A letra de uma rede neural finge ser a letra de uma pessoa</a></li>
<li><a href="../pt382071/index.html">Pela primeira vez, um programa melhor do que uma pessoa lida com o reconhecimento de padr√µes</a></li>
<li><a href="../pt382073/index.html">Resgate do afogamento - o trabalho dos rob√¥s</a></li>
<li><a href="../pt382075/index.html">A hist√≥ria de como eu trouxe o NAO para a R√∫ssia</a></li>
<li><a href="../pt382077/index.html">Jimmy Wales lan√ßa operador de rede social e telefone para ajudar as pessoas a doar para institui√ß√µes de caridade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>