<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋🏾 🌏 👨🏽‍✈️ Sofortiges Design 😓 🤴 ☝🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Menschen lernen Architektur aus alten Büchern, die für Java geschrieben wurden. Die Bücher sind gut, aber sie bieten eine Lösung für die Probleme dies...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sofortiges Design</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/447308/">  Menschen lernen Architektur aus alten Büchern, die für Java geschrieben wurden.  Die Bücher sind gut, aber sie bieten eine Lösung für die Probleme dieser Zeit mit Instrumenten dieser Zeit.  Die Zeit hat sich geändert, C # ähnelt eher Light Scala als Java, und es gibt nur wenige neue gute Bücher. <br><br>  In diesem Artikel untersuchen wir die Kriterien für guten und schlechten Code, wie und was zu messen ist.  Wir werden einen Überblick über typische Aufgaben und Ansätze sehen, wir werden die Vor- und Nachteile analysieren.  Am Ende finden Sie Empfehlungen und Best Practices für das Entwerfen von Webanwendungen. <br><br>  Dieser Artikel ist eine Abschrift meines Berichts von der DotNext 2018-Konferenz in Moskau.  Neben dem Text gibt es ein Video und einen Link zu den Folien unter dem Schnitt. <br><br><img src="https://habrastorage.org/webt/qu/ur/ih/quurihchxowghlgnkanhvmb5o7e.jpeg"><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qJPwSvDLmQE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>Folien</b></a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Berichtsseite auf der Site</a> . </blockquote>  Kurz über mich: Ich komme aus Kasan und arbeite für die High Tech Group.  Wir entwickeln Software für Unternehmen.  Vor kurzem habe ich an der Kasaner Bundesuniversität einen Kurs namens Corporate Software Development unterrichtet.  Von Zeit zu Zeit schreibe ich immer noch Artikel über Habr über technische Praktiken, über die Entwicklung von Unternehmenssoftware. <br><br>  Wie Sie wahrscheinlich vermutet haben, werde ich heute über die Entwicklung von Unternehmenssoftware sprechen, nämlich über die Strukturierung moderner Webanwendungen: <br><br><ul><li>  die Kriterien </li><li>  eine kurze Geschichte der Entwicklung des architektonischen Denkens (was war, was ist geworden, welche Probleme sind); </li><li>  Überblick über die Mängel der klassischen Puff-Architektur </li><li>  die Entscheidung </li><li>  Schritt-für-Schritt-Analyse der Implementierung, ohne auf Details einzugehen </li><li>  Ergebnisse. </li></ul><br><h1>  Kriterien </h1><br>  Wir formulieren die Kriterien.  Ich mag es wirklich nicht, wenn über Design im Stil von „Mein Kung Fu ist stärker als dein Kung Fu“ gesprochen wird.  Ein Unternehmen hat im Prinzip ein bestimmtes Kriterium, das Geld genannt wird.  Jeder weiß, dass Zeit Geld ist, daher sind diese beiden Komponenten meistens die wichtigsten. <br><br><img src="https://habrastorage.org/webt/pu/2e/fh/pu2efhyhoibrcu9lav6fzdg48da.jpeg"><br><br>  Also die Kriterien.  Im Prinzip fordert uns das Unternehmen am häufigsten auf, „so viele Funktionen wie möglich pro Zeiteinheit“ zu verwenden, aber mit einer Einschränkung: Diese Funktionen sollten funktionieren.  Und der erste Schritt, bei dem es zu Problemen kommen kann, ist die Codeüberprüfung.  Das heißt, es scheint, dass der Programmierer sagte: "Ich werde es in drei Stunden tun."  Drei Stunden vergingen, die Überprüfung kam in den Code und der Teamleiter sagte: "Oh, nein, wiederholen Sie es."  Es gibt drei weitere - und wie viele Iterationen die Codeüberprüfung bestanden hat, so viel, dass Sie drei Stunden multiplizieren müssen. <br><br>  Der nächste Punkt ist die Rückkehr aus der Phase des Abnahmetests.  Das selbe.  Wenn die Funktion nicht funktioniert, wird sie nicht ausgeführt. Diese drei Stunden dauern eine Woche, zwei - wie üblich.  Das letzte Kriterium ist die Anzahl der Regressionen und Fehler, die trotz Tests und Akzeptanz die Produktion durchlaufen haben.  Das ist auch sehr schlecht.  Bei diesem Kriterium gibt es ein Problem.  Es ist schwierig zu verfolgen, da der Zusammenhang zwischen der Tatsache, dass wir etwas in das Repository verschieben, und der Tatsache, dass nach zwei Wochen etwas kaputt gegangen ist, schwierig zu verfolgen sein kann.  Aber es ist trotzdem möglich. <br><br><h1>  Architekturentwicklung </h1><br>  Es war einmal, als Programmierer gerade anfingen, Programme zu schreiben, gab es noch keine Architektur, und jeder tat alles, was er wollte. <br><br><img src="https://habrastorage.org/webt/27/l7/oq/27l7oqmpgjyxndbw-4trowmrmem.jpeg"><br><br>  Deshalb haben wir so einen architektonischen Stil.  Dies wird hier als "Nudelcode" bezeichnet, im Ausland heißt es "Spaghetti-Code".  Alles ist mit allem verbunden: Wir ändern etwas an Punkt A - es bricht an Punkt B, es ist völlig unmöglich zu verstehen, was mit was verbunden ist.  Natürlich erkannten die Programmierer schnell, dass dies nicht funktionieren würde und eine gewisse Struktur erforderlich war, und beschlossen, dass einige Ebenen uns helfen würden.  Wenn Sie sich vorstellen, dass Hackfleisch Code ist und Lasagne solche Schichten, finden Sie hier eine Illustration der Schichtarchitektur.  Das Hackfleisch blieb gehackt, aber jetzt kann das Hackfleisch aus Schicht Nr. 1 nicht einfach mit dem Hackfleisch aus Schicht Nr. 2 sprechen. Wir haben dem Code eine Form gegeben: Selbst auf dem Bild können Sie sehen, dass das Klettern mehr gerahmt ist. <br><br><img src="https://habrastorage.org/webt/yx/_j/cu/yx_jcumnfvnensrmrbjwi9lyyqa.jpeg"><br><br>  Jeder ist wahrscheinlich mit der <b>klassischen</b> Schichtarchitektur vertraut: Es gibt eine Benutzeroberfläche, eine Geschäftslogik und eine Datenzugriffsschicht.  Es gibt immer noch alle Arten von Dienstleistungen, Fassaden und Schichten, die nach dem Architekten benannt sind, der das Unternehmen verlassen hat. Es kann eine unbegrenzte Anzahl von ihnen geben. <br><br><img src="https://habrastorage.org/webt/dd/28/qj/dd28qjfaycsftyr71tczg5ykxjo.jpeg"><br><br>  Die nächste Stufe war die sogenannte <b>Zwiebelarchitektur</b> .  Es scheint, dass es einen großen Unterschied gibt: Vorher gab es ein kleines Quadrat, und hier gab es Kreise.  Es scheint ganz anders zu sein. <br><br><img src="https://habrastorage.org/webt/pe/8r/rx/pe8rrxifll2tswmz63paezukklq.jpeg"><br><br>  Nicht wirklich.  Der ganze Unterschied besteht darin, dass irgendwann um diese Zeit die Prinzipien von SOLID formuliert wurden und sich herausstellte, dass es bei der klassischen Zwiebel ein Problem mit der Abhängigkeitsinversion gibt, da der abstrakte Domänencode aus irgendeinem Grund von der Implementierung und dem Datenzugriff abhängt. Daher haben wir uns für die Bereitstellung von Datenzugriff entschieden und haben Datenzugriff abhängig von der Domäne. <br><br><img src="https://habrastorage.org/webt/8o/eb/we/8oebwed-cag1f-zvake5t9lmhl8.jpeg"><br><br>  Hier habe ich das Zeichnen geübt und die Zwiebelarchitektur gezeichnet, aber nicht klassisch mit den „Ringen“.  Ich habe etwas zwischen einem Polygon und Kreisen.  Ich habe dies nur getan, um zu zeigen, dass wenn Sie auf die Wörter "Zwiebel", "sechseckig" oder "Ports und Adapter" stoßen - es ist alles das Gleiche.  Der Punkt ist, dass sich die Domäne in der Mitte befindet, in Dienste eingeschlossen ist, es können Domänen- oder Anwendungsdienste sein, wie Sie möchten.  Und die Außenwelt in Form von Benutzeroberfläche, Tests und Infrastruktur, in die DAL umgezogen ist - sie kommunizieren über diese Serviceschicht mit der Domäne. <br><br><h2>  Ein einfaches Beispiel.  E-Mail-Update </h2><br>  Mal sehen, wie ein einfacher Anwendungsfall in einem solchen Paradigma aussehen würde - Aktualisieren der E-Mail-Adresse des Benutzers. <br><br><img src="https://habrastorage.org/webt/ta/fg/x-/tafgx-5pwfraeofdjg323ewoova.jpeg"><br><br>  Wir müssen eine Anfrage senden, validieren, den Wert in der Datenbank aktualisieren, eine Benachrichtigung an eine neue E-Mail senden: "Alles ist in Ordnung, Sie haben Ihre E-Mail geändert, wir wissen, dass alles in Ordnung ist" und auf den Browser "200" antworten - alles ist in Ordnung. <br><br><img src="https://habrastorage.org/webt/xs/vm/0f/xsvm0f4b6zhpypwnixjazbv3ufi.jpeg"><br><br>  Der Code könnte ungefähr so ​​aussehen.  Hier haben wir die Standard- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASP.NET-</a> MVC-Validierung, es gibt ORM zum Lesen und Aktualisieren der Daten und es gibt eine Art E-Mail-Absender, der eine Benachrichtigung sendet.  Es scheint, als wäre alles gut, oder?  Eine Einschränkung - in einer idealen Welt. <br><br>  In der realen Welt ist die Situation etwas anders.  Es geht darum, Autorisierung, Fehlerprüfung, Formatierung, Protokollierung und Profilerstellung hinzuzufügen.  Dies alles hat nichts mit unserem Anwendungsfall zu tun, aber es sollte alles sein.  Und dieses kleine Stück Code wurde groß und beängstigend: mit viel Verschachtelung, mit viel Code, mit der Tatsache, dass es schwer zu lesen ist und vor allem, dass es mehr Infrastrukturcode als Domänencode gibt. <br><br><img src="https://habrastorage.org/webt/lh/xr/xd/lhxrxdbyaacgxsxrjcsoinbq-c8.jpeg"><br><br>  "Wo sind die Dienstleistungen?"  - Du sagst.  Ich habe die gesamte Logik an die Controller geschrieben.  Natürlich ist dies ein Problem, jetzt werde ich Dienste hinzufügen und alles wird gut. <br><br><img src="https://habrastorage.org/webt/c6/nd/ca/c6ndcaxmuebeyawelqctgsh19ig.jpeg"><br><br>  Wir fügen Dienste hinzu, und es wird wirklich besser, weil wir anstelle eines großen Fußtuchs eine kleine schöne Linie haben. <br><br>  Ist es besser geworden?  Es ist geworden!  Und jetzt können wir diese Methode in verschiedenen Controllern wiederverwenden.  Das Ergebnis ist offensichtlich.  Schauen wir uns die Implementierung dieser Methode an. <br><br><img src="https://habrastorage.org/webt/up/xx/rx/upxxrx8d_fc-5qmzbk-d0afuht4.jpeg"><br><br>  Aber hier ist nicht alles so gut.  Dieser Code ist noch hier.  Wir haben gerade das Gleiche auf die Dienste übertragen.  Wir haben beschlossen, das Problem nicht zu lösen, sondern es einfach zu verschleiern und an einen anderen Ort zu übertragen.  Das ist alles. <br><br><img src="https://habrastorage.org/webt/m0/bo/fj/m0bofjvz471nmxub7ubqhshqwgi.jpeg"><br><br>  Darüber hinaus stellen sich einige andere Fragen.  Sollten wir die Validierung im Controller oder hier durchführen?  Na ja, irgendwie im Controller.  Und wenn Sie in die Datenbank gehen müssen, um zu sehen, dass es eine solche ID gibt oder dass es keinen anderen Benutzer mit einer solchen E-Mail gibt?  Hmm, na dann im Service.  Aber Fehlerbehandlung hier?  Diese Fehlerbehandlung ist wahrscheinlich hier und die Fehlerbehandlung, die auf den Browser in der Steuerung reagiert.  Und die SaveChanges-Methode, ist sie im Dienst oder müssen Sie sie auf den Controller übertragen?  Es kann so und so sein, denn wenn ein Dienst aufgerufen wird, ist es logischer, den Dienst aufzurufen, und wenn Sie drei Methoden von Diensten im Controller haben, die aufgerufen werden müssen, müssen Sie ihn außerhalb dieser Dienste aufrufen, damit die Transaktion eine ist.  Diese Überlegungen legen nahe, dass die Schichten möglicherweise keine Probleme lösen. <br><br><img src="https://habrastorage.org/webt/9d/s6/gd/9ds6gdwecmtqyjjv3rko5l-rccg.jpeg"><br><br>  Und diese Idee kam mehr als einer Person in den Sinn.  Wenn Sie googeln, schreiben mindestens drei dieser angesehenen Ehemänner über dasselbe.  Von oben nach unten: Stephen .NET Junkie (leider kenne ich seinen Nachnamen nicht, da sie nirgendwo im Internet erscheint), der Autor des IoC-Containers von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Simple Injector</a> .  Als nächstes ist Jimmy Bogard der Autor von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AutoMapper</a> .  Und unten ist Scott Vlashin, Autor von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">F # für Spaß und Profit</a> . <br><br><img src="https://habrastorage.org/webt/pu/lt/rz/pultrzyz_24mf5fycqif--zcbpe.jpeg"><br><br>  Alle diese Leute sprechen über dasselbe und schlagen vor, Anwendungen nicht auf der Grundlage von Ebenen zu erstellen, sondern auf der Grundlage von Anwendungsfällen, dh den Anforderungen, nach denen das Unternehmen uns fragt.  Dementsprechend kann der Anwendungsfall in C # unter Verwendung der IHandler-Schnittstelle bestimmt werden.  Es hat Eingabewerte, es gibt Ausgabewerte und es gibt eine Methode selbst, die diesen Anwendungsfall tatsächlich ausführt. <br><br><img src="https://habrastorage.org/webt/9m/lj/hw/9mljhwhphjkuckh2r5tvegoyzg0.jpeg"><br><br>  Und innerhalb dieser Methode kann es entweder ein Domänenmodell oder ein denormalisiertes Modell zum Lesen geben, möglicherweise mit Dapper oder mit Elastic Search, wenn Sie nach etwas suchen müssen und möglicherweise über Legacy verfügen -System mit gespeicherten Prozeduren - kein Problem sowie Netzwerkanforderungen - im Allgemeinen alles, was Sie dort benötigen könnten.  Aber was tun, wenn keine Schichten vorhanden sind? <br><br><img src="https://habrastorage.org/webt/lg/iw/se/lgiwseqpyf9krjfkv4j9ciluxri.jpeg"><br><br>  Lassen Sie uns zunächst UserService loswerden.  Wir entfernen die Methode und erstellen eine Klasse.  Und wir werden es entfernen und wir werden es wieder entfernen.  Und dann nimm die Klasse und entferne sie. <br><br><img src="https://habrastorage.org/webt/xx/tv/z1/xxtvz10bmxyzpefudhd2cw7892y.jpeg"><br><br>  Denken wir mal, sind diese Klassen gleichwertig oder nicht?  Die GetUser-Klasse gibt Daten zurück und ändert nichts auf dem Server.  Dies betrifft beispielsweise die Anfrage "Geben Sie mir die Benutzer-ID".  Die Klassen UpdateEmail und BanUser geben das Ergebnis der Operation zurück und ändern den Status.  Wenn wir dem Server beispielsweise mitteilen: "Bitte ändern Sie den Status, Sie müssen etwas ändern." <br><br><img src="https://habrastorage.org/webt/yj/qs/tn/yjqstnlgzw9lwrk8s1nr0j2s47u.jpeg"><br><br>  Schauen wir uns das HTTP-Protokoll an.  Es gibt eine GET-Methode, die gemäß der Spezifikation des HTTP-Protokolls Daten zurückgeben und den Status des Servers nicht ändern soll. <br><br><img src="https://habrastorage.org/webt/uq/ql/7i/uqql7icixrsmjce88qwxwuxouss.jpeg"><br><br>  Es gibt auch andere Methoden, die den Status des Servers ändern und das Ergebnis der Operation zurückgeben können. <br><br><img src="https://habrastorage.org/webt/zu/u3/l6/zuu3l6-bulai-mgo4fozlyru8ci.jpeg"><br><br>  Das CQRS-Paradigma scheint speziell für das HTTP-Protokoll entwickelt worden zu sein.  Abfragen sind GET-Operationen und Befehle sind PUT, POST, DELETE - Sie müssen nichts erfinden. <br><br><img src="https://habrastorage.org/webt/2t/wk/yp/2twkypfgr9s5xxslujdjfelkkx4.jpeg"><br><br>  Wir definieren unseren Handler neu und definieren zusätzliche Schnittstellen.  IQueryHandler, der sich nur dadurch unterscheidet, dass wir die Einschränkung aufgehängt haben, dass der Typ der Eingabewerte IQuery ist.  IQuery ist eine Markierungsschnittstelle, es gibt nichts außer dieser generischen.  Wir benötigen das Generikum, um Einschränkungen in den QueryHandler einzufügen, und jetzt, da wir QueryHandler deklarieren, können wir dort keine Abfrage übergeben, aber wenn wir das Query-Objekt dort übergeben, kennen wir seinen Rückgabewert.  Dies ist praktisch, wenn Sie nur eine Schnittstelle haben, sodass Sie nicht nach deren Implementierung im Code suchen müssen, um nicht durcheinander zu kommen.  Sie schreiben IQueryHandler, schreiben dort eine Implementierung und können in TOut keinen anderen Typ von Rückgabewert ersetzen.  Es wird einfach nicht kompiliert.  So können Sie sofort sehen, welche Eingabewerte welchen Eingabedaten entsprechen. <br><br><img src="https://habrastorage.org/webt/e5/k9/pd/e5k9pdmjpohmvppi9j5mco2lpz8.jpeg"><br><br>  Die Situation ist für CommandHandler mit einer Ausnahme völlig ähnlich: Dieses Generikum wird für einen weiteren Trick benötigt, den wir etwas weiter unten sehen werden. <br><br><h3>  Handler-Implementierung </h3><br>  Handler, haben wir angekündigt, was ist ihre Implementierung? <br><br><img src="https://habrastorage.org/webt/xb/ye/no/xbyeno8s7xry4tv5n1t2sgig4fk.jpeg"><br><br>  Gibt es ein Problem, ja?  Etwas scheint gescheitert zu sein. <br><br><h3>  Dekorateure eilen zur Rettung </h3> <br>  Aber es hat nicht geholfen, da wir uns noch mitten auf der Straße befinden, müssen wir noch ein wenig finalisieren, und dieses Mal müssen wir das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dekorationsmuster verwenden</a> , nämlich die wunderbare Layoutfunktion.  Der Dekorateur kann in einen Dekorateur, in einen Dekorateur oder in einen Dekorateur eingewickelt werden - fahren Sie fort, bis Sie sich langweilen. <br><br><img src="https://habrastorage.org/webt/pj/oj/m2/pjojm2jkr9q2q3of-rgouuydrjc.jpeg"><br><br>  Dann sieht alles so aus: Es gibt eine Eingabe Dto, sie gibt den ersten Dekorator ein, den zweiten, dritten, dann gehen wir in den Handler und beenden ihn auch, gehen alle Dekoratoren durch und geben Dto im Browser zurück.  Wir deklarieren eine abstrakte Basisklasse, um sie später zu erben. Der Body des Handlers wird an den Konstruktor übergeben, und wir deklarieren die abstrakte Handle-Methode, in der zusätzliche Dekoratorlogik aufgehängt wird. <br><br><img src="https://habrastorage.org/webt/4k/df/ha/4kdfha-rrtuvomibpp8tuadhcrw.jpeg"><br><br>  Jetzt können Sie mit Hilfe von Dekorateuren eine ganze Pipeline bauen.  Beginnen wir mit den Teams.  Was hatten wir?  Eingabewerte, Validierung, Überprüfung der Zugriffsrechte, die Logik selbst, einige Ereignisse, die als Ergebnis dieser Logik auftreten, und Rückgabewerte. <br><br><img src="https://habrastorage.org/webt/zp/yw/3i/zpyw3iastzi8ggkluwnk_dhdes0.jpeg"><br><br>  Beginnen wir mit der Validierung.  Wir erklären einen Dekorateur.  IEnumerable von Typ T-Validatoren kommt in den Konstruktor dieses Dekorators. Wir führen sie alle aus, prüfen, ob die Validierung fehlschlägt und der Rückgabetyp <code>IEnumerable&lt;validationresult&gt;</code> , und können ihn zurückgeben, da die Typen übereinstimmen.  Und wenn es sich um einen anderen Hander handelt, müssen Sie eine Ausnahme auslösen, da hier kein Ergebnis angezeigt wird, der Typ eines anderen Rückgabewerts. <br><br><img src="https://habrastorage.org/webt/wp/pi/bp/wppibp3w6wzoylmbhx8nsop6lda.jpeg"><br><br>  Der nächste Schritt ist Sicherheit.  Wir deklarieren auch den Dekorateur, machen die CheckPermission-Methode und überprüfen.  Wenn plötzlich etwas schief gelaufen ist, fahren wir nicht fort.  Nachdem wir alle Überprüfungen abgeschlossen haben und sicher sind, dass alles in Ordnung ist, können wir unsere Logik erfüllen. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Besessenheit mit Primitiven</a> </h3><br>  Bevor ich die Implementierung der Logik zeige, möchte ich etwas früher beginnen, nämlich mit den Eingabewerten, die dort ankommen. <br><br><img src="https://habrastorage.org/webt/gl/y5/ro/gly5roxocvdausjqf9dztn69jjk.jpeg"><br><br>  Wenn wir eine solche Klasse herausgreifen, sieht sie meistens so aus.  Zumindest der Code, den ich in der täglichen Arbeit sehe. <br><br><img src="https://habrastorage.org/webt/is/e4/6r/ise46rxpz-gsrqeqpqjwac-ir58.jpeg"><br><br>  Damit die Validierung funktioniert, fügen wir hier einige Attribute hinzu, die Ihnen sagen, um welche Art von Validierung es sich handelt.  Dies ist aus Sicht der Datenstruktur hilfreich, hilft jedoch nicht bei der Validierung wie der Überprüfung von Werten in der Datenbank.  Es ist nur EmailAddress. Es ist nicht klar, wie und wo überprüft werden soll, wie diese Attribute verwendet werden, um zur Datenbank zu gelangen.  Anstelle von Attributen können Sie zu speziellen Typen wechseln, dann wird dieses Problem gelöst. <br><br><img src="https://habrastorage.org/webt/oq/6b/3x/oq6b3xuwdmc5xh_04v71g02jkmo.jpeg"><br><br>  Anstelle des <code>int</code> Grundelements deklarieren wir einen ID-Typ mit dem generischen Namen, dass es sich um eine bestimmte Entität mit einem int-Schlüssel handelt.  Und wir übergeben diese Entität entweder an den Konstruktor oder übergeben ihre ID, aber gleichzeitig müssen wir eine Funktion übergeben, die von Id übernommen und zurückgegeben werden kann, und prüfen, ob sie dort null ist oder nicht. <br><br><img src="https://habrastorage.org/webt/tt/fk/ut/ttfkutansz1nzthl3x5adtxftde.jpeg"><br><br>  Wir machen das gleiche mit E-Mail.  Konvertieren Sie alle E-Mails in das Endergebnis, damit für uns alles gleich aussieht.  Als Nächstes nehmen wir das E-Mail-Attribut, deklarieren es aus Gründen der Kompatibilität mit der ASP.NET-Validierung als statisch und nennen es hier einfach.  Das heißt, dies kann auch getan werden.  Damit die ASP.NET-Infrastruktur all dies abfängt, müssen Sie die Serialisierung und / oder ModelBinding geringfügig ändern.  Es gibt dort nicht viel Code, es ist relativ einfach, also werde ich hier nicht aufhören. <br><br><img src="https://habrastorage.org/webt/md/5k/zi/md5kzigojhdaybdbizxrvby2p5w.jpeg"><br><br>  Nach diesen Änderungen werden hier anstelle primitiver Typen spezielle Typen angezeigt: ID und E-Mail.  Und nachdem dieser ModelBinder und der aktualisierte Deserializer ausgearbeitet haben, wissen wir sicher, dass diese Werte korrekt sind, einschließlich der Tatsache, dass sich diese Werte in der Datenbank befinden.  "Invarianten" <br><br><img src="https://habrastorage.org/webt/hu/ew/ul/huewulf5m8-mwkha62fbu3dm5sy.jpeg"><br><br>  Der nächste Punkt, auf den ich näher eingehen möchte, ist der Zustand der Invarianten in der Klasse, da häufig ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">anämisches Modell</a> verwendet wird, in dem es nur eine Klasse gibt, viele Getter-Setter. Es ist völlig unklar, wie sie zusammenarbeiten sollen.  Wir arbeiten mit komplexer Geschäftslogik, daher ist es für uns wichtig, dass sich der Code selbst dokumentiert.  Stattdessen ist es besser, den realen Konstruktor zusammen mit leer für ORM zu deklarieren. Er kann als geschützt deklariert werden, damit Programmierer in ihrem Anwendungscode ihn nicht aufrufen können und ORM.  Hier übergeben wir nicht den primitiven Typ, sondern den E-Mail-Typ, er ist bereits korrekt korrekt. Wenn er null ist, lösen wir immer noch eine Ausnahme aus.  Sie können Fody, PostSharp, verwenden, aber C # 8 wird bald verfügbar sein. Dementsprechend wird es einen Referenztyp geben, der nicht nullbar ist, und es ist besser, auf die Unterstützung in der Sprache zu warten.  Wenn wir im nächsten Moment den Vor- und Nachnamen ändern möchten, möchten wir sie höchstwahrscheinlich gemeinsam ändern. Daher muss es eine geeignete öffentliche Methode geben, die sie gemeinsam ändert. <br><br><img src="https://habrastorage.org/webt/p8/ze/vw/p8zevw3bkth4ialnrabvlsk3hru.jpeg"><br><br>  Bei dieser öffentlichen Methode überprüfen wir auch, ob die Länge dieser Zeilen mit der in der Datenbank verwendeten übereinstimmt.  Und wenn etwas nicht stimmt, stoppen Sie die Ausführung.  Hier benutze ich den gleichen Trick.  Ich deklariere ein spezielles Attribut und rufe es einfach im Anwendungscode auf. <br><br><img src="https://habrastorage.org/webt/tj/ae/mi/tjaemirkcgpbgkmknl9acjkhioa.jpeg"><br><br>  Darüber hinaus können solche Attribute in Dto wiederverwendet werden.  Wenn ich nun den Vor- und Nachnamen ändern möchte, habe ich möglicherweise einen solchen Änderungsbefehl.  Lohnt es sich, hier einen speziellen Konstruktor hinzuzufügen?  Es scheint sich zu lohnen.  Es wird besser werden, niemand wird diese Werte ändern, sie nicht brechen, sie werden genau richtig sein. <br><br><img src="https://habrastorage.org/webt/lt/hq/r1/lthqr1w63fzepclzgrcl6ykwaik.jpeg"><br><br>  Eigentlich nicht wirklich.  Tatsache ist, dass Dto überhaupt keine Objekte sind.  Dies ist ein solches Wörterbuch, in das wir deserialisierte Daten einfügen.  Das heißt, sie geben natürlich vor, Objekte zu sein, aber sie haben nur eine Verantwortung - sie müssen serialisiert und deserialisiert werden.  Wenn wir versuchen, diese Struktur zu bekämpfen, werden wir einige ModelBinders mit Designern bekannt geben. So etwas zu tun ist unglaublich anstrengend und vor allem wird es mit neuen Versionen neuer Frameworks brechen.  All dies wurde von Mark Simon in dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"An den Grenzen des Programms sind nicht objektorientiert" gut beschrieben</a> . Wenn es interessant ist, ist es besser, seinen Beitrag zu lesen, dort wird er ausführlich beschrieben. <br><br><img src="https://habrastorage.org/webt/mf/bw/he/mfbwhegqg7nbmsw4iwj0y8w99c0.jpeg"><br><br>  Kurz gesagt, wir haben eine schmutzige Außenwelt, wir überprüfen den Eingang, konvertieren ihn in unser sauberes Modell und übertragen ihn dann wieder in die Serialisierung, in den Browser und wieder in die schmutzige Außenwelt. <br><br><h3>  Handler </h3><br>  Wie wird der Hander nach all diesen Änderungen hier aussehen? <br><br><img src="https://habrastorage.org/webt/o-/ov/wl/o-ovwlxyrkjuv2murrbk4ifttr4.jpeg"><br><br>  Ich habe hier zwei Zeilen geschrieben, um das Lesen zu vereinfachen, aber im Allgemeinen kann es in einer geschrieben werden.  Die Daten sind genau korrekt, da wir ein Typsystem haben, es gibt eine Validierung, dh die Daten sind Stahlbeton, Sie müssen sie nicht erneut überprüfen.  Ein solcher Benutzer existiert auch, es gibt keinen anderen Benutzer mit einer so geschäftigen E-Mail, alles kann getan werden.  Es gibt jedoch immer noch keinen Aufruf der SaveChanges-Methode, es gibt keine Benachrichtigung und es gibt keine Protokolle und Profiler, oder?  Wir gehen weiter. <br><a name="events"></a><br><h3>  Ereignisse </h3><br>  Domänenereignisse. <br><br><img src="https://habrastorage.org/webt/fo/s8/tq/fos8tqpb3kq5ealyvsm3qu9ayhm.jpeg"><br><br>  Wahrscheinlich das erste Mal, dass dieses Konzept von Udi Dahan in seinem Beitrag <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Domain Events - Salvation“</a> populär gemacht wurde.  Dort schlägt er vor, einfach eine statische Klasse mit der Raise-Methode zu deklarieren und solche Ereignisse auszulösen.  Wenig später schlug Jimmy Bogard eine bessere Implementierung vor, die als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Ein besseres Muster für Domänenereignisse" bezeichnet wird</a> . <br><br><img src="https://habrastorage.org/webt/lq/e_/hq/lqe_hqerzlvb_vi4less4xr6lg4.jpeg"><br><br>  Ich werde die Serialisierung von Bogard mit einer kleinen, aber wichtigen Änderung zeigen.  Anstatt Ereignisse auszulösen, können wir eine Liste deklarieren und an den Stellen, an denen eine Reaktion stattfinden sollte, direkt innerhalb der Entität, um diese Ereignisse zu speichern.  In diesem Fall ist dieser <code>email</code> Getter auch eine Benutzerklasse, und diese Klasse gibt nicht vor, eine Eigenschaft mit automatischen Gettern und Setzern zu sein, sondern fügt dem wirklich etwas hinzu.  Das heißt, dies ist eine echte Verkapselung, keine Obszönität.  Beim Ändern überprüfen wir, ob die E-Mail anders ist, und lösen ein Ereignis aus.  Dieses Ereignis hat noch nirgendwo erreicht, wir haben es nur in der internen Liste der Entitäten. <br><br><img src="https://habrastorage.org/webt/ge/4c/nd/ge4cndzro2vbjuhb4qeujuot1qq.jpeg"><br><br>  In dem Moment, in dem wir die SaveChanges-Methode aufrufen, nehmen wir ChangeTracker und prüfen, ob es Entitäten gibt, die die Schnittstelle implementieren, ob sie Domänenereignisse haben.  Wenn dies der Fall ist, nehmen wir alle diese Domänenereignisse und senden sie an einen Dispatcher, der weiß, was mit ihnen zu tun ist. <br><br>  Die Implementierung dieses Dispatchers ist ein Thema für eine weitere Diskussion. Es gibt einige Schwierigkeiten beim Mehrfachversand in C #, dies wird jedoch auch durchgeführt.  Bei diesem Ansatz gibt es einen weiteren nicht offensichtlichen Vorteil.  Wenn wir jetzt zwei Entwickler haben, kann einer Code schreiben, der diese E-Mail ändert, und der andere kann ein Benachrichtigungsmodul ausführen.  Sie sind absolut nicht miteinander verbunden, sie schreiben unterschiedlichen Code, sie sind nur auf der Ebene dieses Domänenereignisses einer Dto-Klasse verbunden.  Der erste Entwickler wirft diese Klasse einfach irgendwann weg, der zweite antwortet darauf und weiß, dass sie per E-Mail, SMS, Push-Benachrichtigungen an das Telefon und alle anderen Millionen Benachrichtigungen gesendet werden muss, wobei alle normalerweise auftretenden Benutzereinstellungen berücksichtigt werden. <br><br><img src="https://habrastorage.org/webt/pb/-r/op/pb-ropw5rupxtrrbdfes8_lvp6q.jpeg"><br><br>  Hier ist der kleinste, aber wichtige Punkt.  Jimmys Artikel verwendet eine Überladung der SaveChanges-Methode, und es ist am besten, dies nicht zu tun.  Und es ist besser, dies im Dekorator zu tun, denn wenn wir die SaveChanges-Methode überladen und dbContext in Handler benötigen, erhalten wir zirkuläre Abhängigkeiten.  Sie können damit arbeiten, aber die Lösungen sind etwas weniger bequem und etwas weniger schön.  Wenn die Pipeline auf Dekorateuren basiert, sehe ich keinen Grund, dies anders zu machen. <br><br><h3>  Protokollierung und Profilerstellung </h3><br><img src="https://habrastorage.org/webt/bg/nq/m_/bgnqm_jchmmhwbbl7bsvb-binni.jpeg"><br><br>  Die Verschachtelung des Codes blieb erhalten, aber im ersten Beispiel hatten wir zuerst MiniProfiler verwendet, dann Catch und dann If.  Insgesamt gab es drei Verschachtelungsebenen, jetzt befindet sich jede dieser Verschachtelungsebenen in einem eigenen Dekorateur.  Und innerhalb des Dekorateurs, der für die Profilerstellung verantwortlich ist, haben wir nur eine Verschachtelungsebene, der Code wird perfekt gelesen.  Darüber hinaus ist klar, dass es bei diesen Dekorateuren nur eine Verantwortung gibt.  Wenn der Dekorateur für die Protokollierung verantwortlich ist, protokolliert er nur, wenn für die Profilerstellung bzw. nur das Profil alles andere an anderen Orten ist. <br><br><h3>  Antwort </h3><br>  Nachdem die gesamte Pipeline funktioniert hat, können wir nur Dto nehmen und weiter an den Browser senden und JSON serialisieren. <br><br><img src="https://habrastorage.org/webt/wc/tt/0h/wctt0hneqcetsw0pjtya_s5p5eg.jpeg"><br><br>  Aber noch eine kleine Sache, die manchmal vergessen wird: In jeder Phase kann hier eine Ausnahme passieren, und tatsächlich muss man irgendwie damit umgehen. <br><br><img src="https://habrastorage.org/webt/rh/ns/lh/rhnslhowdccmndavybt1a9pyfmy.jpeg"><br><br>  Ich kann Scott Vlashin und seinen Bericht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Eisenbahnorientierte Programmierung“</a> hier noch einmal erwähnen.  Warum?  Der ursprüngliche Bericht widmet sich ausschließlich der Arbeit mit Fehlern in der F # -Sprache, der etwas anderen Organisation des Ablaufs und der Frage, warum ein solcher Ansatz der Verwendung von Exception'ov vorzuziehen ist.  In F # funktioniert dies wirklich sehr gut, da F # eine funktionale Sprache ist und Scott die Funktionalität einer funktionalen Sprache verwendet. <br><br><img src="https://habrastorage.org/webt/wd/-7/gg/wd-7ggf6-mg0y1orcgz-2si45ci.jpeg"><br><br>  Da wahrscheinlich die meisten von Ihnen immer noch in C # schreiben, sieht dieser Ansatz ungefähr so ​​aus, wenn Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Analogon in C #</a> schreiben.  Anstatt Ausnahmen auszulösen, deklarieren wir eine Ergebnisklasse mit einem erfolgreichen und einem nicht erfolgreichen Zweig.  Dementsprechend zwei Designer.  Eine Klasse kann sich nur in einem Zustand befinden.  Diese Klasse ist ein Sonderfall vom Typ Union, der von F # unterschieden wird, jedoch in C # neu geschrieben wurde, da in C # keine integrierte Unterstützung vorhanden ist. <br><br><img src="https://habrastorage.org/webt/jo/xu/p2/joxup2i8w_uziwqyawnwp6cty8e.jpeg"><br><br>  Anstatt öffentliche Getter zu deklarieren, dass jemand im Code möglicherweise nicht auf Null prüft, wird Pattern Matching verwendet.  Wiederum wäre es in F # eine integrierte Pattern Matching-Sprache. In C # müssen wir eine separate Methode schreiben, in die wir eine Funktion übergeben, die weiß, was mit dem erfolgreichen Ergebnis der Operation zu tun ist, wie sie weiter unten in der Kette konvertiert wird und die mit einem Fehler.  Das heißt, egal welcher Zweig für uns gearbeitet hat, wir müssen dies auf ein einziges zurückgegebenes Ergebnis umstellen.  In F # funktioniert das alles sehr gut, weil es eine funktionale Komposition gibt, und alles andere, was ich bereits aufgelistet habe.  In .NET funktioniert dies etwas schlechter, da sobald Sie mehr als ein Ergebnis haben, aber viele - und fast jede Methode kann aus dem einen oder anderen Grund fehlschlagen - fast alle resultierenden Funktionstypen zu Ergebnistypen werden und Sie sie als benötigen etwas kombinieren. <br><br><img src="https://habrastorage.org/webt/vb/s8/wd/vbs8wdzd81uocge3l2louammnwa.jpeg"><br><br>  Der einfachste Weg, sie zu kombinieren, ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwendung von LINQ</a> , da LINQ tatsächlich nicht nur mit IEnumerable funktioniert. Wenn Sie die Methoden SelectMany und Select richtig neu definieren, erkennt der C # -Compiler, dass Sie die LINQ-Syntax für diese Typen verwenden können.  Im Allgemeinen stellt sich heraus, dass Transparentpapier mit Haskell-Notation oder mit denselben Berechnungsausdrücken in F # erstellt wurde.  Wie soll das gelesen werden?  Hier haben wir drei Ergebnisse der Operation, und wenn dort in allen drei Fällen alles in Ordnung ist, nehmen Sie diese Ergebnisse r1 + r2 + r3 und fügen Sie sie hinzu.  Der Typ des resultierenden Werts ist ebenfalls Ergebnis, aber das neue Ergebnis, das wir in Select deklarieren.  Im Allgemeinen ist dies sogar ein funktionierender Ansatz, wenn nicht einer, aber. <br><br><img src="https://habrastorage.org/webt/ez/8d/lw/ez8dlwqtpilfzqbpsp_8zg1udvw.jpeg"><br><br>  Für alle anderen Entwickler sieht es so aus, sobald Sie anfangen, solchen Code in C # zu schreiben.  „Das sind böse beängstigende Ausnahmen, schreib sie nicht!  Sie sind böse!  Schreiben Sie besser Code, den niemand versteht und der nicht debuggen kann! “ <br><br><img src="https://habrastorage.org/webt/v4/v4/vd/v4v4vdhq2reierp3a0diyhtm-ws.jpeg"><br><br>  C # ist nicht F #, es ist etwas anders, es gibt keine unterschiedlichen Konzepte, auf deren Grundlage dies getan wird, und wenn wir versuchen, eine Eule auf den Globus zu ziehen, stellt sich heraus, gelinde gesagt, ungewöhnlich. <br><br><img src="https://habrastorage.org/webt/ns/w3/q7/nsw3q7lbpx2xqiewao1619j-t1s.jpeg"><br><br>  Stattdessen können Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">integrierten normalen Tools verwenden</a> , die dokumentiert sind, die jeder kennt und die bei Entwicklern keine kognitiven Dissonanzen verursachen.  ASP.NET hat eine globale Handler-Ausnahme. <br><br><img src="https://habrastorage.org/webt/i8/9i/vk/i89ivkfdyr5w8xmemg2by9qz0zs.jpeg"><br><br>  Wir wissen, dass Sie bei Problemen mit der Validierung den Code 400 oder 422 (Unprocessable Entity) zurückgeben müssen.  Wenn bei der Authentifizierung und Autorisierung ein Problem auftritt, gibt es 401 und 403. Wenn ein Fehler aufgetreten ist, ist ein Fehler aufgetreten.  Und wenn etwas schief gelaufen ist und Sie dem Benutzer genau mitteilen möchten, was ist, definieren Sie Ihren Ausnahmetyp, sagen Sie, dass es sich um IHasUserMessage handelt, deklarieren Sie einen Nachrichten-Getter in dieser Schnittstelle und überprüfen Sie einfach: Wenn diese Schnittstelle implementiert ist, können Sie eine Nachricht entgegennehmen von Ausnahme und übergeben Sie es in JSON an den Benutzer.  Wenn diese Schnittstelle nicht implementiert ist, liegt ein Systemfehler vor, und wir teilen den Benutzern einfach mit, dass ein Fehler aufgetreten ist. Wir alle tun dies bereits, wir alle wissen - wie immer. <br><br><h3>  Abfrage-Pipeline </h3><br>  Wir schließen dies mit den Teams ab und schauen uns an, was wir im Read-Stack haben.  Was die Anfrage, Validierung und direkte Antwort betrifft - dies ist ungefähr dasselbe, wir werden nicht separat aufhören.  Möglicherweise gibt es noch einen zusätzlichen Cache, aber im Allgemeinen gibt es auch keine großen Probleme mit dem Cache. <br><br><h3>  Sicherheit </h3><br>  Schauen wir uns eine Sicherheitsüberprüfung genauer an.  Möglicherweise gibt es auch denselben Sicherheitsdekorateur, der prüft, ob diese Anforderung gestellt werden kann oder nicht: <br><br><img src="https://habrastorage.org/webt/9k/y7/dr/9ky7drwhf3o5tk_r6wcapy4nqaw.jpeg"><br><br>  Es gibt jedoch einen anderen Fall, in dem wir mehr als einen Datensatz und eine Liste anzeigen. Für einige Benutzer müssen wir eine vollständige Liste anzeigen (z. B. für einige Superadministratoren), und für andere Benutzer müssen wir begrenzte Listen auflisten, dritte - begrenzte Nun, und wie es in Unternehmensanwendungen häufig der Fall ist, können Zugriffsrechte äußerst komplex sein. Sie müssen also sicherstellen, dass Daten, die nicht auf diese Benutzer abzielen, nicht in diese Listen aufgenommen werden. <br><br>  Das Problem ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ganz einfach</a> gelöst.  Wir können die Schnittstelle (IPermissionFilter) neu definieren, in die das ursprüngliche abfragbare Element eintrifft und das abfragbare zurückgibt.  Der Unterschied besteht darin, dass wir für die Rückgabe, die zurückgibt, bereits zusätzliche Bedingungen festgelegt haben, bei denen der aktuelle Benutzer überprüft und gesagt wurde: "Hier nur diese Daten an diesen Benutzer zurückgeben ..." - und dann Ihre gesamte Logik, die sich auf Berechtigungen bezieht .  Wenn Sie zwei Programmierer haben, schreibt ein Programmierer Berechtigungen. Er weiß, dass er nur viele Berechtigungsfilter schreiben und überprüfen muss, ob sie für alle Entitäten ordnungsgemäß funktionieren.  Und andere Programmierer wissen nichts über Berechtigungen, in ihrer Liste werden einfach immer die richtigen Daten übergeben, das ist alles.  Weil sie an der Eingabe nicht mehr das ursprünglich von dbContext abfragbare empfangen, sondern auf Filter beschränkt sind.  Ein solcher Berechtigungsfilter hat auch eine Layout-Eigenschaft. Wir können alle Berechtigungsfilter hinzufügen und anwenden.  Als Ergebnis erhalten wir den resultierenden Berechtigungsfilter, der die Datenauswahl unter Berücksichtigung aller für diese Entität geeigneten Bedingungen auf das Maximum einschränkt. <br><br><img src="https://habrastorage.org/webt/25/2o/xj/252oxjpxf1p7zd_aq3nt55cenyi.jpeg"><br><br>  Warum nicht mit integrierten ORM-Tools, z. B. globalen Filtern in einem Entitätsframework?  Auch hier, um keine zyklischen Abhängigkeiten für sich selbst herzustellen und keine zusätzliche Geschichte über Ihre Geschäftsschicht in den Kontext zu ziehen. <br><br><h3>  Abfrage-Pipeline.  Modell lesen </h3><br>  Es bleibt das Lesemodell zu betrachten.  Das CQRS-Paradigma verwendet nicht das Domänenmodell im Lesestapel, sondern erstellt sofort das Dto, das der Browser gerade benötigt. <br><br><img src="https://habrastorage.org/webt/2s/kc/0y/2skc0ygq4rmh9rs6cyg5czxa5rm.jpeg"><br><br>  Wenn wir in C # schreiben, verwenden wir höchstwahrscheinlich LINQ, wenn es nicht nur ungeheure Leistungsanforderungen gibt und wenn es welche gibt, haben Sie möglicherweise keine Unternehmensanwendung.  Im Allgemeinen kann dieses Problem mit einem solchen LinqQueryHandler ein für alle Mal gelöst werden.  Hier ist eine ziemlich beängstigende Einschränkung für das Generikum: Dies ist Query, das eine Liste von Projektionen zurückgibt und diese Projektionen weiterhin filtern und diese Projektionen sortieren kann.  Sie arbeitet auch nur mit einigen Arten von Entitäten und weiß, wie diese Entitäten in Projektionen konvertiert und die Liste solcher Projektionen in Form von Dto an den Browser zurückgegeben werden. <br><br><img src="https://habrastorage.org/webt/8e/vz/ax/8evzaxkzbhqx0mgxfadxacpek24.jpeg"><br><br>  Die Implementierung der Handle-Methode kann recht einfach sein.  Überprüfen Sie für alle Fälle, ob dieser TQuery-Filter für die ursprüngliche Entität implementiert ist.  Weiter machen wir eine Projektion, es ist abfragbare Erweiterung AutoMapper'a.  Wenn jemand es immer noch nicht weiß, kann AutoMapper Projektionen in LINQ erstellen, dh solche, die die Select-Methode erstellen und nicht im Speicher zuordnen. <br><br>  Dann wenden wir Filterung, Sortierung an und zeigen alles im Browser an.     ,      DotNext,     ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ,  , , ,     expression' ,            . <br><br><h3>     <s></s>   SQL </h3><br>  .  ,       DotNext', —      SQL.    Select , ,      ,  queryable-   . <br><br><img src="https://habrastorage.org/webt/3j/ns/3b/3jns3bzz_ebriubturd0ewzzwqg.jpeg"><br><br>      ,    .     ,    Title,  Title      ,     .      ,  .        SubTitle,      ,   ,     -      ,    queryable-   .    ,        . <br><br>      ,    .  ,    ,     .    ,   , .     «JsonIgnore»,     .    ,   ,  Dto.    ,     ,      .       JSON,  ,  Created  LastUpdated   ,  SubTitle —   ,   .    ,   ,        ,   , ,       .          ,  -     . <br><br><img src="https://habrastorage.org/webt/uy/el/go/uyelgoxsnf7dzhsv6arfq0q16ly.jpeg"><br><br>      . ,  -,      ,    .    ,  pipeline,     .      —      , ,  . ,      SaveChanges,   Query    SaveChanges.      ,    ,          ,   NuGet,         . <br><br>         .     ,    -  ,     ,     .   , ,   , , ,       —   . ,  ,      : «    », —   .  . <br><br><h2>   </h2><br>    ,    ? <br><br><img src="https://habrastorage.org/webt/rj/px/0i/rjpx0ig2zyqa7d9g47vibhbeccy.jpeg"><br><br>    -  .   . <br><br><img src="https://habrastorage.org/webt/d6/ag/p7/d6agp7a_t3m2ppxscq9vb7piagq.jpeg"><br><br>  , ,    ,     .   MediatR  ,         . ,    ,    — ,    MediatR   pipeline behaviour.    ,      Request/Response, RequestHandler'      .    Simple Injector,    —    . <br><br><img src="https://habrastorage.org/webt/qd/et/4g/qdet4g_b9ezljfr1mx9moe_m18y.jpeg"><br><br>       , ,  ,       ,  TIn: ICommand. <br><br><img src="https://habrastorage.org/webt/su/nb/vn/sunbvndlkmxley6clq7hs4hj70s.jpeg"><br><br>   Simple Injector'      constraint' .     ,    , ,     constraint',        Handler',     constraint. ,     constraint ICommand,      SaveChanges   constraint'  ICommand,  Simple Injector  ,    constraint' ,         Handler'. ,      ,          ,     . <br><br>  ? Simple Injector  MeriatR —  ,       ,    Autofac', -,          ,    ,  .  , . <br><br><h2>   ,    </h2><br>          ,   «». <br><br><img src="https://habrastorage.org/webt/8m/1l/lj/8m1lljzfrx2amaidftyjnthd3yc.jpeg"><br><br>   ,   «Clean architecture».             . <br><br><img src="https://habrastorage.org/webt/ch/gm/jq/chgmjq7gihsvthnvinnydngrtcw.jpeg"><br><br>  - -     ,   MVC,   ,    . <br><br><img src="https://habrastorage.org/webt/g8/70/wz/g870wzkcrbvqeplit3m_i69uru4.jpeg"><br><br>  ,   ,   ,     Angular, ,       ,      ,    .  ,  : « — MVC-»,  : «    Features,    :     ,    Blog     - Import,    -  ». <br><br>  , , ,  ,   MVC-,  ,   -  , .    MVC  .    ,   ,      —     .       . <br><br><img src="https://habrastorage.org/webt/ix/8v/qo/ix8vqotanjad8uljd2rfz17xygg.jpeg"><br><br><img src="https://habrastorage.org/webt/xq/lj/bv/xqljbvd8zk59n6pdn1-q-x4czhc.jpeg"><br><br>    -     ,  -   -,        . <br><br> -,     ,   .            ,   .   ,          -   ,         User Service,   pull request',     ,       User Service    ,   .    ,      - ,     -  , . -       ,             . <br><br>  .         ,          .  ,    ,             ,   . , ,  ,  ,   ,     ,    ,     -   .    ,      (    ,    ),     ,    «Delete»:   ,      ,  .  . <br><br>          —  «», ,   ,       ,   .          ,    :   ,    ,     ,      .           ,   .      ,    ,   .      ,      ,      . <br><br>   :        .    « »,        :     ,     ,         . ,    ,    ,       , ,    ,  ,   .        ,   .  ,   - pull request    ,    —  ,    — -   ,    .          VCS    :     -  ,    ?       ,    -  ,         ,    . <br><br><img src="https://habrastorage.org/webt/ie/g2/i6/ieg2i6gpy-mp6nsmrvdvxot3x6o.jpeg"><br><br>   , ,    ,   .  :     .        ,     .  ,    ,      ,  ,   .    , ,    ,      . ,  , .    « »,        ,     .  ,   ,      —  ,      ,   . <br><br>      :    , - , .           .  -      ,    ,  ,   ,  .       -        ,  -        ,      , ,      ,    .    . <br><br><img src="https://habrastorage.org/webt/8g/7g/3h/8g7g3htn43hhoprdfj2thj86wre.jpeg"><br><br> .         ,       IHandler     .    . <br><br>   IHandler    ICommandHandler  IQueryHandler  ,    .    ,     ,       .  ,   CommandHandler,      CommandHandler',       . <br><br>  Warum so?      ,    Query   ,   Query —   .      ,     ,  ,    Hander,    CommandHandler  QueryHandler,   -  use case,     . <br><br>  —     ,      ,  ,    ,     :  ,  . <br><br>      ,  .         ,    .    ,       -. <br><br>      C# 8,   nullable reference type      .  , , ,     ,  . <br><br>         ChangeTracker' ORM. <br><br>  Exception' —     ,     F#,     C#.  ,   -     ,    -   , .        ,   ,      Exception', ,      LINQ,   ,  ,    ,     ,    , Dapper  - , ,  ,   .NET. <br><br>          ,  LINQ,  , permission' —   . ,    ,   - ,    ,       .      ,     —   . <br><br>        .  : <br><br><hr><br><ul><li> Vertical Slices <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.youtube.com/watch?v=SUiWfhAhgQw</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.cuttingedge.it/blogs/steven/pivot/entry.php?id=91</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cuttingedge.it/blogs/steven/pivot/entry.php?id=92</a> </li></ul></li><li>   <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/266937</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/205088</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/205108</a> </li></ul></li><li> Domain Events <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">udidahan.com/2009/06/14/domain-events-salvation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lostechies.com/jimmybogard/2014/05/13/a-better-domain-events-pattern</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">enterprisecraftsmanship.com/2017/10/03/domain-events-simple-and-reliable-solution</a> </li></ul></li><li> DDD <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/334126</a> </li></ul></li><li> ROP <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fsharpforfunandprofit.com/rop</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/339606</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/347284</a> </li></ul></li><li> LINQ  Expressions: <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/company/jugru/blog/423891</a> </li></ul></li><li> Clean Architecture <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.youtube.com/watch?v=JEeEic-c0D4</a> </li></ul></li></ul><br><img src="https://habrastorage.org/webt/fm/ik/wu/fmikwu49krcbqw7xbefe1vm6tsq.jpeg"><br><br>   —   .      .   —     «Domain Modeling Made Functional»,   F#,          F#,      ,     ,     ,        ,      .       C# ,    ,         Exception'. <br><br>  ,  ,   —  «Entity Framework Core In Action».      ,    Entity Framework,         ,     DDD  ORM,   ,   ORM      DDD    . <br><br><blockquote>  Minute der Werbung. 15-16  2019  .NET- DotNext Piter,      .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447308/">https://habr.com/ru/post/de447308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447298/index.html">Wissensmanagement durch Kompetenzmodelle</a></li>
<li><a href="../de447300/index.html">Erstellen von VirtualBox für Windows</a></li>
<li><a href="../de447302/index.html">Wochenendbetriebssystem</a></li>
<li><a href="../de447304/index.html">Avaricious zahlt nicht zweimal - wir richten Speicher auf der AMD B450-Plattform ein und erhalten kostenlose Leistung</a></li>
<li><a href="../de447306/index.html">Tesla Transformer auf einem Quadratzoll Board</a></li>
<li><a href="../de447310/index.html">Wie wir von der Webentwicklung zur Spieleentwicklung gekommen sind</a></li>
<li><a href="../de447314/index.html">Was ich über den Aufbau eines Unternehmens verstanden habe, nachdem ich sieben Jahre bei Airbnb gearbeitet habe</a></li>
<li><a href="../de447318/index.html">Gadgets von einem Flohmarkt: Warum einen 20 Jahre alten Packard Bell Laptop für 10 Euro kaufen?</a></li>
<li><a href="../de447322/index.html">Prinzipien zum Erstellen einer REST-JSON-API</a></li>
<li><a href="../de447324/index.html">Wie der Computer in Hayabusa-2 funktioniert, der eine Bombe auf Ryuga abgeworfen hat. Und Fotos seiner Entwickler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>