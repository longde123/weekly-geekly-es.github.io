<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚¨áÔ∏è üí™ üéé Retour GOTO üë©üèæ‚Äçüé§ üé´ üö∂üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintenant, tout le monde comprend que l'utilisation de l'op√©rateur GOTO n'est pas seulement une mauvaise, mais une terrible pratique. Le d√©bat sur so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Retour GOTO</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484840/"><p> Maintenant, tout le monde comprend que l'utilisation de l'op√©rateur GOTO n'est pas seulement une mauvaise, mais une terrible pratique.  Le d√©bat sur son utilisation a pris fin dans les ann√©es 80 du XXe si√®cle et il a √©t√© exclu de la plupart des langages de programmation modernes.  Mais, comme il sied √† un vrai mal, il a r√©ussi √† se d√©guiser et √† ressusciter au 21e si√®cle sous couvert d'exceptions. </p><a name="habracut"></a><br><p>  Les exceptions, d'une part, sont un concept assez simple dans les langages de programmation modernes.  En revanche, ils sont souvent mal utilis√©s.  Il existe une r√®gle simple et bien connue - les exceptions ne concernent que la gestion des dommages.  Et c'est tout simplement une interpr√©tation trop vague du concept de ¬´panne¬ª qui entra√Æne tous les probl√®mes li√©s √† l'utilisation de GOTO. </p><br><h2 id="teoreticheskiy-primer">  Exemple th√©orique </h2><br><p>  La diff√©rence entre les pannes et les sc√©narios commerciaux n√©gatifs est clairement visible sur la fen√™tre de connexion avec un cas d'utilisation tr√®s simple: </p><br><ol><li>  L'utilisateur entre l'identifiant / mot de passe. </li><li>  L'utilisateur clique sur le bouton "Connexion". </li><li>  L'application cliente envoie une requ√™te au serveur. </li><li>  Le serveur v√©rifie avec succ√®s le nom d'utilisateur / mot de passe (consid√®re la pr√©sence de la paire correspondante comme un succ√®s). </li><li>  Le serveur envoie des informations au client indiquant que l'authentification a r√©ussi et un lien vers la page de transition. </li><li>  Le client acc√®de √† la page sp√©cifi√©e. </li></ol><br><p>  Et une extension n√©gative: </p><br><p>  4.1.  Le serveur n'a pas trouv√© la paire login / mot de passe correspondant et envoie une notification au client √† ce sujet. </p><br><p>  Consid√©rer que le sc√©nario 4.1 est un ¬´probl√®me¬ª et qu'il doit donc √™tre impl√©ment√© √† l'aide d'une exception est une erreur assez courante.  Ce n'est en fait pas le cas.  Les incoh√©rences de connexion et de mot de passe font partie de notre exp√©rience utilisateur standard telle que fournie par la logique m√©tier du script.  Nos clients commerciaux attendent cette √©volution.  Par cons√©quent, ce n'est pas une panne et vous ne pouvez pas utiliser d'exceptions ici. </p><br><p>  Les pannes sont: d√©connexion de la connexion entre le client et le nord, inaccessibilit√© du SGBD, sch√©ma incorrect dans la base de donn√©es.  Et un million de raisons suppl√©mentaires qui cassent nos applications et n'ont rien √† voir avec la logique m√©tier de l'utilisateur. </p><br><p>  Dans l'un des projets, au d√©veloppement duquel j'ai particip√©, il y avait une logique de connexion plus complexe.  En entrant le mauvais mot de passe 3 fois de suite, l'utilisateur a √©t√© temporairement bloqu√© pendant 15 minutes.  Obtenu 3 fois de suite dans une serrure temporaire, l'utilisateur a re√ßu une serrure permanente.  Il y avait √©galement des r√®gles suppl√©mentaires selon le type d'utilisateur.  La mise en ≈ìuvre d'exceptions a rendu extr√™mement difficile l'introduction de nouvelles r√®gles. </p><br><p>  Il serait int√©ressant de consid√©rer cet exemple, mais il est trop grand et peu visuel.  Comment la confusion du code avec la logique m√©tier sur les exceptions devient claire et concise, je vais vous montrer dans un autre exemple. </p><br><h2 id="primer-zagruzka-svoystv">  Exemple de propri√©t√©s de chargement </h2><br><p>  Essayez de regarder ce code et de comprendre clairement ce qu'il fait.  La proc√©dure n'est pas grande avec une logique assez simple.  Avec un bon style de programmation, la compr√©hension de son essence ne devrait pas d√©passer 2 √† 3 minutes (je ne me souviens pas du temps qu'il m'a fallu pour bien comprendre ce code, mais certainement plus de 15 minutes). </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">//These mappings will replace any mappings that this hashtable had for any of the //keys currently in the specified map. getProperties().putAll( loadedProperties ); //     loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH, false); if (loadedProperties != null){ getProperties().putAll( loadedProperties ); } System.out.println("Loaded properties:" + getProperties()); } /** *  ,    . * @param filepath * @param throwIfNotFound -  FileNotFoundException,     * @return    null,      !throwIfNotFound * @throws FileNotFoundException throwIfNotFound        * @throws IOException     */ private Properties readPropertiesFromFile(String filepath, boolean throwIfNotExists){ Properties loadedProperties = new Properties(); System.out.println("Try loading workspace properties" + filepath); InputStream is = null; InputStreamReader isr = null; try{ int loadingTryLeft = 3; String relativePath = ""; while (loadingTryLeft &gt; 0){ try{ File file = new File(relativePath + filepath); is = new FileInputStream(file); isr = new InputStreamReader( is, "UTF-8"); loadedProperties.load(isr); loadingTryLeft = 0; } catch( FileNotFoundException e) { loadingTryLeft -= 1; if (loadingTryLeft &gt; 0) relativePath += "../"; else throw e; } finally { if (is != null) is.close(); if (isr != null) isr.close(); } } System.out.println("Found file " + filepath); } catch( FileNotFoundException e) { System.out.println("File not found " + filepath); if (throwIfNotExists) throw new RuntimeException("Can`t load workspace properties." + filepath + " not found", e ); }catch (IOException e){ throw new RuntimeException("Can`t read " + filepath, e); } return loadedProperties; }</span></span></code> </pre> <br><p>  Alors, r√©v√©lons le secret - ce qui se passe ici.  Les propri√©t√©s de deux fichiers sont <code>WORK_PROPERTIES</code> - les <code>WORK_PROPERTIES</code> requises et les <code>MY_WORK_PROPERTIES</code> suppl√©mentaires, s'ajoutant au magasin de propri√©t√©s g√©n√©ral.  Il y a une nuance - nous ne savons pas exactement o√π se trouve le fichier de propri√©t√©s sp√©cifique - il peut se trouver √† la fois dans le r√©pertoire actuel et dans les r√©pertoires anc√™tres (jusqu'√† trois niveaux plus haut). </p><br><p>  Au moins deux choses <code>throwIfNotExists</code> confusion ici: le param√®tre <code>throwIfNotExists</code> et le grand bloc logique dans <code>catch FileNotFoundException</code> .  Tout cela sugg√®re de mani√®re opaque - les exceptions sont utilis√©es pour impl√©menter la logique m√©tier (mais comment expliquer autrement que dans un sc√©nario, lever une exception est un √©chec, et dans l'autre non?). </p><br><h2 id="delaem-pravilnyy-kontrakt">  Faire le bon contrat </h2><br><p>  Commen√ßons d'abord par <code>throwIfNotExists</code> .  Lorsque vous travaillez avec des exceptions, il est tr√®s important de comprendre o√π exactement il doit √™tre trait√© en termes de cas d'utilisation.  Dans ce cas, il est √©vident que la m√©thode <code>readPropertiesFromFile</code> ne peut pas d√©cider quand l'absence d'un fichier est "mauvaise" et quand elle est "bonne".  Une telle d√©cision est prise au moment de son appel.  Les commentaires montrent que nous d√©cidons si ce fichier doit exister ou non.  Mais en fait, nous ne nous int√©ressons pas au fichier lui-m√™me, mais aux param√®tres qu'il contient.  Malheureusement, cela ne d√©coule pas du code. </p><br><p>  Nous corrigeons ces deux lacunes: </p><br><pre> <code class="java hljs">Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll( loadedProperties );</code> </pre> <br><p>  Maintenant, la s√©mantique est clairement montr√©e - <br>  <code>WORK_PROPERTIES</code> doit √™tre sp√©cifi√©, mais <code>MY_WORK_PROPERTIES</code> ne <code>MY_WORK_PROPERTIES</code> pas l'√™tre.  De plus, lors de la refactorisation, j'ai remarqu√© que <code>readPropertiesFromFile</code> ne pouvait jamais retourner <code>null</code> et en ai profit√© lors de la lecture de <code>MY_WORK_PROPERTIES</code> . </p><br><h2 id="proveryaem-ne-lomaya">  Nous v√©rifions sans casser </h2><br><p>  Le refactoring pr√©c√©dent a √©galement affect√© la mise en ≈ìuvre, mais pas de mani√®re significative.  Je viens de supprimer le <code>throwIfNotExists</code> traitement <code>throwIfNotExists</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (throwIfNotExists) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(‚Ä¶);</code> </pre> <br><p>  Apr√®s avoir examin√© l'impl√©mentation de plus pr√®s, nous commen√ßons √† comprendre la logique de l'auteur du code pour rechercher un fichier.  Tout d'abord, il est v√©rifi√© que le fichier se trouve dans le r√©pertoire courant, s'il n'est pas trouv√©, nous v√©rifions √† un niveau sup√©rieur, etc.  C'est-√†-dire  il devient clair que l'algorithme pr√©voit l'absence de fichier.  Dans ce cas, la v√©rification est effectu√©e √† l'aide d'une exception.  C'est-√†-dire  le principe est viol√© - l'exception n'est pas per√ßue comme ¬´quelque chose a cass√©¬ª, mais comme faisant partie de la logique m√©tier. </p><br><p>  Il existe une fonction pour v√©rifier la disponibilit√© d'un fichier pour lire <code>File.canRead()</code> .  En l'utilisant, vous pouvez vous d√©barrasser de la logique m√©tier dans un <code>catch</code> </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader( is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( FileNotFoundException e) { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } }</code> </pre> <br><p>  En changeant le code, nous obtenons ce qui suit: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } } } System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"File not found "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  J'ai √©galement r√©duit le niveau des variables ( <code>is</code> , <code>isr</code> ) au minimum autoris√©. </p><br><p>  Une telle refactorisation simple am√©liore consid√©rablement la lisibilit√© du code.  Le code affiche directement l'algorithme (si le fichier existe, alors nous le lisons, sinon nous r√©duisons le nombre de tentatives et regardons dans le r√©pertoire ci-dessus). </p><br><h2 id="vyyavlyaem-goto">  R√©v√©ler GOTO </h2><br><p>  Consid√©rez en d√©tail ce qui se passe dans une situation si le fichier est introuvable: </p><br><pre> <code class="java hljs">} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } }</code> </pre> <br><p>  On peut voir qu'ici, l'exception est utilis√©e pour interrompre le cycle d'ex√©cution et r√©ellement ex√©cuter la fonction GOTO. </p><br><p>  Pour les sceptiques, nous ferons un autre changement.  Au lieu d'utiliser une petite b√©quille sous la forme <code>loadingTryLeft = 0</code> (b√©quille, car en fait une tentative r√©ussie ne <code>loadingTryLeft = 0</code> pas <code>loadingTryLeft = 0</code> nombre de tentatives restantes), nous indiquons explicitement que la lecture du fichier conduit √† la sortie de la fonction (sans oublier d'√©crire un message): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> {</code> </pre> <br><p>  Cela nous permet de remplacer la condition <code>while (loadingTryLeft &gt; 0)</code> par <code>while(true)</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); <span class="hljs-comment"><span class="hljs-comment">// GOTO: FFN } } } } catch (FileNotFoundException e) { // LABEL: FFN System.out.println("File not found " + filepath); } catch (IOException e) { throw new RuntimeException("Can`t read " + filepath, e); }</span></span></code> </pre> <br><p>  Afin de se d√©barrasser de l'odeur naus√©abonde √©vidente, <code>throw new FileNotFoundException</code> , vous devez vous rappeler le contrat de fonction.  Dans tous les cas, la fonction renvoie un ensemble de propri√©t√©s, si elles ne pouvaient pas lire le fichier, nous le renvoyons vide.  Par cons√©quent, il n'y a aucune raison de lever une exception et de l'attraper.  La condition <code>while (loadingTryLeft &gt; 0)</code> habituelle <code>while (loadingTryLeft &gt; 0)</code> suffit: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  En principe, du point de vue du travail correct avec des exceptions, tout est l√†.  Il y a un doute sur la n√©cessit√© de lancer une RuntimeException en cas de probl√®mes IOException, mais nous la laisserons telle quelle pour des raisons de compatibilit√©. </p><br><h2 id="navodim-losk">  Apportez du brillant </h2><br><p>  Il reste quelques petites choses que nous pouvons rendre le code encore plus flexible et compr√©hensible: </p><br><ul><li>  Le nom de la m√©thode readPropertiesFromFile expose son impl√©mentation (en passant, et l√®ve FileNotFoundException).  Mieux vaut l'appeler plus neutre et concis - loadProperties (...) </li><li>  La m√©thode recherche et lit simultan√©ment.  Pour moi, ce sont deux responsabilit√©s diff√©rentes qui peuvent √™tre divis√©es en diff√©rentes m√©thodes. </li><li>  Le code a √©t√© √©crit √† l'origine sous Java 6, mais est maintenant utilis√© dans Java 7. Cela permet l'utilisation de ressources pouvant √™tre ferm√©es. </li><li>  Je sais par exp√©rience que lors de l'affichage d'informations sur un fichier trouv√© ou introuvable, il est pr√©f√©rable d'utiliser le chemin d'acc√®s complet au fichier plut√¥t que relatif. </li><li> <code>if (loadingTryLeft &gt; 0) relativePath += "../";</code>  - si vous regardez attentivement le code, vous pouvez voir - cette v√©rification est inutile, car  si la limite de recherche est √©puis√©e, la nouvelle valeur ne sera pas utilis√©e de toute fa√ßon.  Et s'il y a quelque chose de superflu dans le code, ce sont des ordures qui devraient √™tre supprim√©es. </li></ul><br><p>  La version finale du code source: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (defaultInstance != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(); Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } getProperties().putAll(loadedProperties); loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll(loadedProperties); System.out.println(<span class="hljs-string"><span class="hljs-string">"Loaded properties:"</span></span> + getProperties()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read(file); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + file.getAbsolutePath()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } }</code> </pre> <br><h2 id="rezyume">  R√©sum√© </h2><br><p>  L'exemple analys√© illustre clairement √† quoi conduit une manipulation imprudente du code source.  Au lieu d'utiliser une exception pour g√©rer la panne, il a √©t√© d√©cid√© de l'utiliser pour impl√©menter la logique m√©tier.  Cela a imm√©diatement conduit √† la complexit√© de son soutien, qui s'est refl√©t√© dans son d√©veloppement ult√©rieur pour r√©pondre aux nouvelles exigences et, par cons√©quent, √† une d√©rogation aux principes de la programmation structurelle.  L'utilisation d'une r√®gle simple - des exceptions uniquement pour les pannes - vous aidera √† √©viter de retourner dans l'√®re GOTO et √† garder votre code propre, compr√©hensible et extensible. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484840/">https://habr.com/ru/post/fr484840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484824/index.html">La guerre pour √©teindre les lumi√®res</a></li>
<li><a href="../fr484826/index.html">L'intelligence artificielle aggrave encore plus la mauvaise m√©decine</a></li>
<li><a href="../fr484834/index.html">Comment construire une strat√©gie d'entreprise pour la formation et le d√©veloppement</a></li>
<li><a href="../fr484836/index.html">Calcul de la rentabilit√© du tarif vert en 2020, Ukraine</a></li>
<li><a href="../fr484838/index.html">13 exemples de configuration de r√®gles dans Google Ads [instruction]</a></li>
<li><a href="../fr484846/index.html">Ma relation avec l'open source</a></li>
<li><a href="../fr484854/index.html">Ex√©cutez le jeu en C # sur MS-DOS</a></li>
<li><a href="../fr484860/index.html">Nom de l'impl√©mentation et nom du r√©sultat</a></li>
<li><a href="../fr484862/index.html">Migration d'AngularJS vers Angular7 via une application hybride</a></li>
<li><a href="../fr484866/index.html">Utilisation d'Astra Linux sur un ordinateur embarqu√© ARM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>