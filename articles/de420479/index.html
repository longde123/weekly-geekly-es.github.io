<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💔 👩🏿‍🍳 🌎 Abhängigkeitsinjektion im Apache Ignite.NET-Dienst 🤚🏼 ✡️ 🕜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei der Entwicklung verschiedener Anwendungen, die die beliebte Castle Windsor- Bibliothek zum Einfügen von Abhängigkeiten und Apache Ignite.NET als „...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Abhängigkeitsinjektion im Apache Ignite.NET-Dienst</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420479/"> Bei der Entwicklung verschiedener Anwendungen, die die beliebte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Castle Windsor-</a> Bibliothek zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einfügen von</a> Abhängigkeiten und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache Ignite.NET</a> als „Schlüssel“ verwenden, der die Tür zum Cloud-Computing öffnet, stieß ich auf eine leichte Unannehmlichkeit: Ich hatte keine Möglichkeit, die Abhängigkeit in den gestarteten Dienst einzufügen über das sogenannte Service Grid. <br><br>  Der Grund dafür ist ziemlich alltäglich.  Apache Ignite.NET serialisiert den Dienst und sendet ihn an einen der verfügbaren Server, wo er deserialisiert und gestartet wird.  Da dieser Prozess in keiner Weise eine Ahnung von Castle Windsor hat, bekommen wir, was wir bekommen. <br><br>  Um dieses Problem zu lösen, müssen wir ein Plug-In für Apache Ignite.NET erstellen, das einen Container erhält, der für die Implementierung von Abhängigkeiten verantwortlich ist, und dem Dienst die Möglichkeit bietet, darauf zuzugreifen, um ein Objekt zu empfangen. <a name="habracut"></a><br><br>  Zunächst werden wir eine zusätzliche Abstraktionsebene für den Container einführen, die die Abhängigkeitsinjektion ermöglicht, damit wir in Zukunft die Implementierung problemlos auf eine andere ändern können: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IContainer</span></span> { T Resolve&lt;T&gt;(); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DependencyInjectionContainer</span></span> : <span class="hljs-title"><span class="hljs-title">IContainer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IKernel Kernel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DependencyInjectionContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IKernel kernel</span></span></span><span class="hljs-function">)</span></span> { Kernel = kernel; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Resolve&lt;T&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Kernel.Resolve&lt;T&gt;(); } }</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DependencyInjectionInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">IWindsorInstaller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Install</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWindsorContainer container, IConfigurationStore store</span></span></span><span class="hljs-function">)</span></span> { container.Register( Component .For&lt;IContainer&gt;() .ImplementedBy&lt;DependencyInjectionContainer&gt;() ); } }</code> </pre><br>  Um ein Plug-In zu erstellen, müssen drei Klassen erstellt werden: die Klasse, die für die Plug-In-Konfiguration verantwortlich ist, der Plug-In-Anbieter und direkt das Plug-In selbst. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DependencyInjectionPlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IContainer Container { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Resolve&lt;T&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Container.Resolve&lt;T&gt;(); } }</code> </pre><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">PluginProviderType(typeof(DependencyInjectionPluginProvider))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DependencyInjectionPluginConfiguration</span></span> : <span class="hljs-title"><span class="hljs-title">IPluginConfiguration</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteBinary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IBinaryRawWriter writer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// No-op } public int? PluginConfigurationClosureFactoryId { get; } = null; // No Java part }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DependencyInjectionPluginProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IPluginProvider</span></span>&lt;<span class="hljs-title"><span class="hljs-title">DependencyInjectionPluginConfiguration</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-string"><span class="hljs-string">"DependencyInjection"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Copyright { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> DependencyInjectionPlugin DependencyInjectionPlugin { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T GetPlugin&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DependencyInjectionPlugin <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IPluginContext&lt;DependencyInjectionPluginConfiguration&gt; context</span></span></span><span class="hljs-function">)</span></span> { DependencyInjectionPlugin = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DependencyInjectionPlugin(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cancel</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnIgniteStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnIgniteStop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cancel</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre><br>  Großartig, es bleibt das Plugin in Apache Ignite.NET zu laden. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IgniteInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">IWindsorInstaller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Install</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWindsorContainer container, IConfigurationStore store</span></span></span><span class="hljs-function">)</span></span> { container.Register( Component .For&lt;IIgnite&gt;() .UsingFactoryMethod(() =&gt; Ignition.Start(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteConfiguration { PluginConfigurations = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DependencyInjectionPluginConfiguration()} })) ); } }</code> </pre><br>  Wenn die Anwendung gestartet wird, initialisieren wir wie gewohnt den Abhängigkeitsinjektionscontainer, aber jetzt können wir ihn an das gerade geschriebene Plugin übergeben: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Done = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ManualResetEventSlim(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Build Windsor container using (var container = new WindsorContainer()) { // Install DI abstraction layer container.Install(new DependencyInjectionInstaller()); // Install cluster abstraction layer container.Install(new IgniteInstaller()); // Attach DI container to cluster plugin container .Resolve&lt;IIgnite&gt;() .GetPlugin&lt;DependencyInjectionPlugin&gt;("DependencyInjection") .Container = container.Resolve&lt;IContainer&gt;(); // Wait Done.Wait(); }</span></span></code> </pre><br>  Herzlichen Glückwunsch, wenn Sie bis zum Ende gelesen haben, können Sie jede Abhängigkeit von Ihrem Container innerhalb des Dienstes erhalten.  Es sieht so aus: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClientConnectionService</span></span> : <span class="hljs-title"><span class="hljs-title">IClientConnectionService</span></span>, <span class="hljs-title"><span class="hljs-title">IService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> NLog.Logger Logger = NLog.LogManager.GetCurrentClassLogger(); [InstanceResource] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IIgnite Ignite { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceContext context</span></span></span><span class="hljs-function">)</span></span> { Logger.Debug(<span class="hljs-string"><span class="hljs-string">"Initialized"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> plugin = Ignite.GetPlugin&lt;DependencyInjectionPlugin&gt;(<span class="hljs-string"><span class="hljs-string">"DependencyInjection"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> whatever = plugin.Resolve&lt;IWhatever&gt;(); whatever.DoSomething(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cancel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceContext context</span></span></span><span class="hljs-function">)</span></span> { Logger.Debug(<span class="hljs-string"><span class="hljs-string">"Canceled"</span></span>); } }</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420479/">https://habr.com/ru/post/de420479/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420469/index.html">Merkmale der Verwendung von Druiden am Beispiel von Klassenkameraden</a></li>
<li><a href="../de420471/index.html">Drei technische Berichte zur RIT 2018 von Plesk</a></li>
<li><a href="../de420473/index.html">Bücher für Anfänger oder warum es so wichtig ist zu lesen</a></li>
<li><a href="../de420475/index.html">Vergleich von Raylogic 11G- und Raylogic V12-Laserschneidmaschinen</a></li>
<li><a href="../de420477/index.html">HyperX Cloud Stinger Core-Test: Ein leichtes und robustes Charakter-Headset</a></li>
<li><a href="../de420487/index.html">Unternehmen bitten um das Recht auf personenbezogene Daten der Nutzer</a></li>
<li><a href="../de420489/index.html">Neue ARM-Prozessoren können mit Core i5 konkurrieren</a></li>
<li><a href="../de420491/index.html">Mein Weg als Krieger oder wie ich einen Antrag für das Leben in Sailfish vorbereitet habe</a></li>
<li><a href="../de420493/index.html">Kann der amerikanische Bestellservice für Lebensmittel zu Amazon in der Welt der Restaurants werden?</a></li>
<li><a href="../de420495/index.html">Bildschirm Wasser Rendering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>