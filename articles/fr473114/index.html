<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏻 🖕 ♥️ Laravel: nous analysons les concepts de base. Troisième partie: la finale 🎅 🙄 🛌🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il reste quelques jours avant le début d'un nouveau cours d'OTUS - «Framework Laravel» . En prévision du début du cours, nous partageons la dernière p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Laravel: nous analysons les concepts de base. Troisième partie: la finale</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/473114/">  <i>Il reste quelques jours avant le début d'un nouveau cours d'OTUS - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Framework Laravel»</a> .</i>  <i>En prévision du début du cours, nous partageons la dernière partie de la publication de l'auteur sur les concepts de base de Laravel.</i>  <i><b>Important: cette série de publications n'est pas liée au programme éducatif du cours et est un peu utile pour les débutants</b> .</i>  <i>Le programme du cours peut être trouvé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</i> <br><br><img src="https://habrastorage.org/webt/yx/1u/tr/yx1utrpgu8ucbkhazc8ktkfww7w.png"><br><hr><br>  Dans le dernier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article,</a> nous avons commencé à écrire une galerie dans laquelle un utilisateur peut se connecter et s'inscrire, créer des albums avec une description, une couverture et un titre.  Dans l'application créée, il y a la valeur principale de notre <code>view</code> et maintenant il est nécessaire de l'étendre un peu. <a name="habracut"></a><br>  De plus, le code existant mérite une petite amélioration: <br><br>  Nous avons déjà deux contrôleurs - <code>AlbumController</code> et <code>ImageController</code> .  Ajoutez l'importation d'une classe supplémentaire chargée de travailler avec les chaînes: <br><br><pre> <code class="plaintext hljs"> use Illuminate\Support\Str;</code> </pre><br>  Et changez la ligne qui est responsable de générer un nom d'image aléatoire dans notre base de données: <br><br><pre> <code class="plaintext hljs"> $random_name = Str::random(8);</code> </pre><br>  De plus, il vaut maintenant la peine de changer un peu le code de migration pour augmenter la fiabilité de notre application, car l'utilisateur doit avoir le droit de laisser notre champ de <code>description</code> vide (sinon Laravel avec dynamite nous signalera une erreur).  Passons à la migration associée à la table d'images, et corrigeons-y la ligne liée à la description de l'image à celle-ci: <br><br><pre> <code class="php hljs"> $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'description'</span></span>)-&gt;nullable();</code> </pre><br>  Eh bien, le "refactoring" de l'application est terminé.  Ensuite, vous devez terminer l'apparence de notre application.  Créez un formulaire dans lequel l'utilisateur pourra créer ses albums: <br><br>  fichier <code>addimage.blade.php</code> <br><br><pre> <code class="php hljs"> @<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'includes.header'</span></span>) &lt;body&gt; @<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'includes.nav'</span></span>) &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">style</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">align</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">center</span></span></span><span class="hljs-class">;"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span4</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">style</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">display</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inline</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">block</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">margin</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">top</span></span></span><span class="hljs-class">:100</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">px</span></span></span><span class="hljs-class">;"&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isset</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">) &amp;&amp; $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has</span></span></span><span class="hljs-class">('')) &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alert</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alert</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">block</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alert</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fade</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class">"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">block</span></span></span><span class="hljs-class">"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messages</span></span></span><span class="hljs-class"> = $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all</span></span></span><span class="hljs-class">('&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class">&gt;:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class">&gt;'); ?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">close</span></span></span><span class="hljs-class">"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dismiss</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alert</span></span></span><span class="hljs-class">"&gt;×&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h4</span></span></span><span class="hljs-class">&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Warning</span></span></span><span class="hljs-class">!&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h4</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ul</span></span></span><span class="hljs-class">&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foreach</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messages</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">as</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">) </span></span>{{$message}} @<span class="hljs-keyword"><span class="hljs-keyword">endforeach</span></span> &lt;/ul&gt; &lt;/div&gt; @<span class="hljs-keyword"><span class="hljs-keyword">endif</span></span> &lt;form name=<span class="hljs-string"><span class="hljs-string">"createnewalbum"</span></span> method=<span class="hljs-string"><span class="hljs-string">"POST"</span></span>action=<span class="hljs-string"><span class="hljs-string">"{{route('create_album')}}"</span></span> enctype=<span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span>&gt; {{ csrf_field() }} &lt;fieldset&gt; &lt;legend&gt; &lt;/legend&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">=" " </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">="</span></span>{{old(<span class="hljs-string"><span class="hljs-string">'name'</span></span>)}}<span class="hljs-string"><span class="hljs-string">"&gt; &lt;/div&gt; &lt;div class="</span></span>form-group<span class="hljs-string"><span class="hljs-string">"&gt; &lt;label for="</span></span>description<span class="hljs-string"><span class="hljs-string">"&gt; &lt;/label&gt; &lt;textarea name="</span></span>description<span class="hljs-string"><span class="hljs-string">" type="</span></span>text<span class="hljs-string"><span class="hljs-string">"class="</span></span>form-control<span class="hljs-string"><span class="hljs-string">" placeholder="</span></span> <span class="hljs-string"><span class="hljs-string">"&gt;{{old('descrption')}}&lt;/textarea&gt; &lt;/div&gt; &lt;div class="</span></span>form-group<span class="hljs-string"><span class="hljs-string">"&gt; &lt;label for="</span></span>cover_image<span class="hljs-string"><span class="hljs-string">"&gt;   &lt;/label&gt; {{Form::file('cover_image')}} &lt;/div&gt; &lt;button type="</span></span>submit<span class="hljs-string"><span class="hljs-string">" class=«btn btn-default"</span></span>&gt;!&lt;/button&gt; &lt;/fieldset&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"</span></span>&gt;&lt;/script&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/js/bootstrap.min.js"</span></span>&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Permettez-moi de vous rappeler que, dans le haut de la page, nous avons la navigation et les bibliothèques utilisées, qui ont été décrites dans la dernière partie. <br><br>  De plus, nous devons ajouter le look de <code>album.blade.php</code> <br><br><pre> <code class="plaintext hljs"> @include('includes.header') &lt;body&gt; @include('includes.nav') &lt;div class="container"&gt; &lt;div class="starter-template"&gt; &lt;div class="media"&gt; &lt;img class="media-object pull-left"alt="{{$album-&gt;name}}" src="/albums/{{$album-&gt;cover_image}}" width="350px"&gt; &lt;div class="media-body"&gt; &lt;h2 class="media-heading" style="font-size: 26px;"&gt; :&lt;/h2&gt; &lt;p&gt;{{$album-&gt;name}}&lt;/p&gt; &lt;div class="media"&gt; &lt;h2 class="media-heading" style="font-size: 26px;"&gt;  :&lt;/h2&gt; &lt;p&gt;{{$album-&gt;description}}&lt;p&gt; &lt;a href="{{route('add_image',array('id'=&gt;$album-&gt;id))}}"&gt;&lt;button type="button"class="btn btn-primary btn-large"&gt;    &lt;/button&gt;&lt;/a&gt; &lt;a href="{{route('delete_album',array('id'=&gt;$album-&gt;id))}}" onclick="return confirm(' ?')"&gt;&lt;button type="button"class="btn btn-danger btn-large"&gt; &lt;/button&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="row"&gt; @foreach($album-&gt;Photos as $photo) &lt;div class="col-lg-3"&gt; &lt;div class="thumbnail" style="max-height: 350px;min-height: 350px;"&gt; &lt;img alt="{{$album-&gt;name}}" src="/albums/{{$photo-&gt;image}}"&gt; &lt;div class="caption"&gt; &lt;p&gt;{{$photo-&gt;description}}&lt;/p&gt; &lt;p&gt; : {{ date("d FY",strtotime($photo-&gt;created_at)) }}at {{ date("g:ha",strtotime($photo-&gt;created_at)) }}&lt;/p&gt; &lt;a href="{{route('delete_image',array('id'=&gt;$photo-&gt;id))}}" onclick="returnconfirm(' ?')"&gt;&lt;button type="button"class="btn btn-danger btn-small"&gt; &lt;/button&gt;&lt;/a&gt; &lt;p&gt;     :&lt;/p&gt; &lt;form name="movephoto" method="POST"action="{{route('move_image')}}"&gt; {{ csrf_field() }} &lt;select name="new_album"&gt; @foreach($albums as $others) &lt;option value="{{$others-&gt;id}}"&gt;{{$others-&gt;name}}&lt;/option&gt; @endforeach &lt;/select&gt; &lt;input type="hidden" name="photo"value="{{$photo-&gt;id}}" /&gt; &lt;button type="submit" class="btn btn-smallbtn-info" onclick="return confirm(' ?')"&gt; &lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; @endforeach &lt;/div&gt; &lt;/div&gt; &lt;script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/js/bootstrap.min.js"&gt;&lt;/script&gt; &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  De plus, nous pouvons légèrement mettre à jour notre routage, par exemple dans <code>nav.blade.php</code> : <br><br><pre> <code class="plaintext hljs"> &lt;li&gt;&lt;a href="{{URL::route('create_album_form')}}"&gt;  &lt;/a&gt;&lt;/li&gt;</code> </pre><br>  Vers une option plus récente et plus à la mode: <br><br><pre> <code class="plaintext hljs"> &lt;li&gt;&lt;a href="{{route('create_album_form')}}"&gt;  &lt;/a&gt;&lt;/li&gt;</code> </pre><br>  En revanche, la version précédente fonctionnait sur 6 Laravel.  Donc, nous avons déjà un formulaire dans lequel l'utilisateur peut ajouter des photos à l'album, et il y a la <code>view</code> principale <code>view</code> notre album.  Ensuite, nous devons ajouter un contrôleur qui sera responsable du traitement d'une seule photo. <br><br>  Nous créons donc un contrôleur chargé de travailler avec les photos individuelles: <br><br><pre> <code class="plaintext hljs"> php artisan make:controller ImageController</code> </pre><br>  Alors, ce qui devrait être en nous: <br><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Support</span></span>\<span class="hljs-title"><span class="hljs-title">MessageBag</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Validator</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       use App\Album; use App\Image; use Illuminate\Support\Str; class ImageController extends Controller { public function getForm($id) { $album = Album::find($id); return view('addimage') -&gt;with('album',$album); //  ,          } public function postAdd(Request $request) { //    ,       $rules = [ 'album_id' =&gt; 'required|numeric|exists:albums,id', 'image'=&gt;'required|image' ]; $input = ['album_id' =&gt; null]; $validator = Validator::make($request-&gt;all(), $rules); if($validator-&gt;fails()){ return redirect()-&gt;route('add_image', ['id' =&gt; $request-&gt;get('album_id')])-&gt;withErrors($validator)-&gt;withInput(); } $file = $request-&gt;file('image'); //   $random_name = Str::random(8); //  $destinationPath = 'albums/'; $extension = $file-&gt;getClientOriginalExtension(); $filename=$random_name.'_album_image.'.$extension; $uploadSuccess = $request-&gt;file('image')-&gt;move($destinationPath, $filename); Image::create(array( 'description' =&gt; $request-&gt;get('description'), //   'image' =&gt; $filename, //   'album_id'=&gt; $request-&gt;get('album_id') //         )); return redirect()-&gt;route('show_album',['id'=&gt;$request-&gt;get('album_id')]); } public function getDelete($id) //       { $image = Image::find($id); $image-&gt;delete(); return redirect()-&gt;route('show_album',['id'=&gt;$image-&gt;album_id]); } //       public function postMove(Request $request) { $rules = array( 'new_album' =&gt; 'required|numeric|exists:albums,id', 'photo'=&gt;'required|numeric|exists:images,id' ); //    $validator = Validator::make($request-&gt;all(), $rules); if($validator-&gt;fails()){ return redirect()-&gt;route('index'); } $image = Image::find($request-&gt;get('photo')); $image-&gt;album_id = $request-&gt;get('new_album'); $image-&gt;save(); return redirect()-&gt;route('show_album', ['id'=&gt;$request-&gt;get('new_album')]); } }</span></span></code> </pre><br><img src="https://habrastorage.org/webt/jp/0h/e_/jp0he_0gbimkbbxjcwm83x39pfs.png"><br><br><h3>  Enregistrement et autorisation </h3><br>  Pour le moment, notre application est presque prête.  Cependant, nous devons encore resserrer la possibilité de s'inscrire dans notre application, de se déconnecter et de se connecter à un compte existant. <br><br>  Dans la dernière partie, nous avons déjà montré à quoi ressemble notre <code>includes/nav.blade.php</code> .  Parce que  nous voulons que les boutons de <b>connexion</b> et d' <code></code> apparaissent lorsque l'utilisateur ne s'est pas encore inscrit, et le bouton de déconnexion lorsqu'il est enregistré avec nous. <br><br>  Donc, <code>includes/nav.blade.php</code> comment nous regardons maintenant la liste dans <code>includes/nav.blade.php</code> : <br><br><pre> <code class="plaintext hljs"> &lt;ul class="nav navbar-nav"&gt; @if (Auth::check()) &lt;li&gt; &lt;button type="button" class="btn btn-primary"&gt; &lt;!--   ,  -&gt;   --&gt; {{{ Auth::user()-&gt;name}}} &lt;/button&gt; &lt;/li&gt; &lt;li&gt;&lt;a href="{{route('create_album_form')}}"&gt;  &lt;/a&gt;&lt;/li&gt; @else &lt;!--    --&gt; &lt;li&gt;&lt;a href="{{route('register')}}"&gt;&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="{{route('login')}}"&gt;&lt;/a&gt;&lt;/li&gt; @endif @if (Auth::check()) &lt;!--  ,       --&gt; &lt;!--      --&gt; &lt;li&gt; &lt;a href="{{url('/logout') }}" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"&gt;  &lt;/a&gt; &lt;form id="logout-form" action="{{ url('/logout') }}" method="POST" style="display: none;"&gt; {{ csrf_field() }} &lt;/form&gt; &lt;/li&gt; @endif &lt;/ul&gt;</code> </pre><br>  En utilisant la construction <code>Auth::check</code> et élémentaire <code>if else</code> , nous pouvons construire des changements dans notre <code>view</code> , selon que notre utilisateur est enregistré ou non. <br><br>  Cependant, avec des modifications apportées à la <code>view</code> avant de créer le modèle et le contrôleur, nous avons un peu d'avance sur le moteur.  Afin de faire notre authentification, nous utiliserons toutes les solutions prêtes à l'emploi et rapides qui se trouvent dans Laravel 6. <br><br>  Donc, à propos du modèle <i>utilisateur</i> - nous utiliserons celui qui vient dans la boîte.  D'une part, ce n'est clairement pas suffisant pour une application à part entière, d'autre part - je ne veux pas me limiter à la portée d'une application spécifique.  Quel genre de galerie voulez-vous?  Où un utilisateur peut-il créer ses propres albums privés qui ne sont accessibles à personne?  Ou où tout le monde partage ses photos?  Nous n'aurons pas de limites dans notre application - je pense que le lecteur pourra les finir sans aucun problème à son goût et sa couleur. <br><br>  Ainsi, dans Laravel 6, la création de l'authentification est devenue encore plus facile.  Nous allons sur la ligne de commande de notre application: <br><br><pre> <code class="plaintext hljs"> composer require laravel/ui —dev</code> </pre><br>  Ce qui nous donne les packages nécessaires.  Créez maintenant: <br><br><pre> <code class="plaintext hljs"> php artisan ui:auth</code> </pre><br>  Que nous apporte cette équipe?  Premièrement, nous avons un nouveau dossier d' <code>auth</code> dans les <code>resources/views</code> , dans lequel nous avons toutes les <code>views</code> qui peuvent être nécessaires pour autoriser un utilisateur et l'enregistrer: <code>login</code> , <code>register</code> et <code>verify</code> .  Il existe également un sous-dossier de <code>passwords</code> dédié à la réinitialisation et à la récupération des mots de passe.  Dans le dossier <code>Http/Controllers</code> , nous avons <code>HomeController</code> , qui est nécessaire pour rediriger vers la page d'accueil après l'enregistrement de l'utilisateur.  Nous aurons également une <code>layouts</code> sous-dossiers, qui contiendra <code>app.blade.php</code> , que nous <code>app.blade.php</code> pas aujourd'hui, mais cela peut être une excellente base pour une application créée à partir de zéro. <br><br>  Les modèles de lame générés ont déjà une disposition initiale adaptée à <code>Bootstrap</code> .  Nous l'avons déjà connecté dans <code>header.blade.php</code> . <br>  De plus, nous avons mis à jour un peu de routage dans <code>routes/web.php</code> .  Les lignes suivantes ont été ajoutées: <br><br><pre> <code class="plaintext hljs"> Auth::routes(); Route::get('/home', 'HomeController@index')-&gt;name('home'); Route::post('/logout', 'Auth\LoginController@logout')-&gt;name('logout');</code> </pre><br>  Le chemin vers la <code>home</code> généré automatiquement et j'ai fait la redirection pour me <code>logout</code> moi-même. <br><br>  Pour que votre mise en page fonctionne sur les modèles générés, nous allons leur connecter notre <code>nav</code> et notre en- <code>header</code> : <br><br><pre> <code class="plaintext hljs"> @include('includes.header') &lt;body&gt; @include('includes.nav') @extends('layouts.app')</code> </pre><br>  Génial, maintenant tout est prêt.  Essayez de vous inscrire.  La confirmation du mot de passe devrait également fonctionner: <br><br><img src="https://habrastorage.org/webt/6n/h6/0l/6nh60lmhlkzsm1wqrvhcrhkqf9k.png"><br><br><img src="https://habrastorage.org/webt/2q/zu/z0/2qzuz0pqdygk5cdkvph9dh2m9d0.png"><br><br>  À l'avenir, l'utilisateur peut choisir vers quelle page du service il veut aller (ou le lecteur peut faire lui-même une redirection, ce n'est pas très difficile)  Il suffit de fixer un petit détail: faire en sorte que seuls les utilisateurs enregistrés et autorisés puissent voir nos précieux albums. <br><br>  Pour ce faire, nous ajoutons une condition à notre routage afin que l'utilisateur se connecte pour accéder aux albums. <br><br>  Mise à jour de notre <code>web.php</code> : <br><br><pre> <code class="plaintext hljs"> Route::get('/', array('as' =&gt; 'index','uses' =&gt; 'AlbumsController@getList')) -&gt;middleware('auth');; //middleware     http    Route::get('/createalbum', array('as' =&gt; 'create_album_form','uses' =&gt; 'AlbumsController@getForm')) -&gt;middleware('auth');; //    Route::post('/createalbum', array('as' =&gt; 'create_album','uses' =&gt; 'AlbumsController@postCreate')) -&gt;middleware('auth');; //   Route::get('/deletealbum/{id}', array('as' =&gt; 'delete_album','uses' =&gt; 'AlbumsController@getDelete')) -&gt;middleware('auth');; //   Route::get('/album/{id}', array('as' =&gt; 'show_album','uses' =&gt; 'AlbumsController@getAlbum')) -&gt;middleware('auth');; //  </code> </pre><br>  Fondamentalement, à ce stade, nous pouvons déjà terminer.  Je laisse au lecteur le choix de l'application qu'il souhaite faire: avec des albums privés ou avec des albums publics.  En théorie, l'application peut déjà être utilisée si vous avez vu la possibilité de vous inscrire et de créer un utilisateur séparément directement dans la base de données - par exemple, si vous et vos collègues allez organiser vos albums privés et que pour une raison quelconque vous ne souhaitez pas utiliser d'autres services. <br><br>  Merci à tous pour votre attention!  Comme toujours, des liens utiles: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À propos de la création d'une autorisation dans Laravel 6</a> </li><li>  <a href="">Bibliothèque cool, si vous avez besoin de solutions d'autorisation encore plus prêtes à l'emploi dans l'application</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473114/">https://habr.com/ru/post/fr473114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473088/index.html">Le mythe de la liquidité sur le marché du pétrole et de l'or des utilisateurs du sous-sol</a></li>
<li><a href="../fr473090/index.html">PocketBook 632 et 632 Aqua Review - Petits lecteurs phares de 6 pouces avec encre E</a></li>
<li><a href="../fr473092/index.html">AMA avec Habr, # 13: nouvelles importantes pour les utilisateurs et les entreprises</a></li>
<li><a href="../fr473096/index.html">Structures de données avancées. Première partie: graphique acyclique directionnel</a></li>
<li><a href="../fr473108/index.html">Composants agulaires en angulaire</a></li>
<li><a href="../fr473118/index.html">Le logiciel Siemens Digital Industries redéfinit la conception électrique</a></li>
<li><a href="../fr473120/index.html">Le développeur veut aller au démarrage. Que faire à l'employeur?</a></li>
<li><a href="../fr473124/index.html">Comment nous utilisons les chaînes de Markov pour évaluer les solutions et trouver des bogues. Avec le script Python</a></li>
<li><a href="../fr473128/index.html">FutureVSReal - à # X5TechFutureNight</a></li>
<li><a href="../fr473130/index.html">Histoire des processeurs vidéo: 1976 - 1995</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>