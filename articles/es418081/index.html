<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê† üèôÔ∏è ü§õüèΩ Organizaci√≥n de pruebas seguras en producci√≥n. Parte 1 ‚òÄÔ∏è ü§≥üèΩ üëπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo analiza varios tipos de pruebas en producci√≥n y las condiciones bajo las cuales cada una de ellas es m√°s √∫til, y tambi√©n describe c√≥mo o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organizaci√≥n de pruebas seguras en producci√≥n. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418081/"><img src="https://habrastorage.org/webt/0q/az/yt/0qazyteu8a-cel_dnpcbmyckzsk.jpeg"><br><br>  Este art√≠culo analiza varios tipos de pruebas en producci√≥n y las condiciones bajo las cuales cada una de ellas es m√°s √∫til, y tambi√©n describe c√≥mo organizar pruebas seguras de varios servicios en producci√≥n. <a name="habracut"></a><br><br>  Vale la pena se√±alar que el contenido de este art√≠culo se aplica solo a esos <b>servicios</b> , cuya implementaci√≥n est√° controlada por los desarrolladores.  Adem√°s, debe advertir de inmediato que el uso de cualquiera de los tipos de pruebas descritos aqu√≠ no es una tarea f√°cil, que a menudo requiere cambios serios en el dise√±o, desarrollo y prueba de los sistemas.  Y, a pesar del t√≠tulo del art√≠culo, no creo que ninguno de los tipos de pruebas en producci√≥n sea absolutamente confiable.  Solo existe la opini√≥n de que tales pruebas pueden reducir significativamente el nivel de riesgos en el futuro, y los costos de inversi√≥n estar√°n justificados. <br><br>  <i><b>(Nota: como el art√≠culo original es Longrid, para comodidad de los lectores, est√° dividido en dos partes).</b></i> <br><br><h2>  ¬øPor qu√© es necesario realizar pruebas en producci√≥n si se puede realizar en etapas? </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="974530841190608897"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  La importancia del grupo de etapas (o entorno de etapas) por diferentes personas se percibe de manera diferente.  Para muchas empresas, la implementaci√≥n y prueba de un producto en etapas es una etapa integral que precede a su lanzamiento final. <br><br>  Muchas organizaciones conocidas perciben la puesta en escena como una copia en miniatura del entorno de trabajo.  En tales casos, es necesario garantizar su m√°xima sincronizaci√≥n.  En este caso, generalmente es necesario garantizar el funcionamiento de diferentes instancias de sistemas con estado, como bases de datos, y sincronizar regularmente los datos del entorno de producci√≥n con la preparaci√≥n.  La excepci√≥n es solo informaci√≥n confidencial que le permite establecer la identidad del usuario (esto es necesario para cumplir con los requisitos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GDPR</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PCI</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HIPAA</a> y otras regulaciones). <br><br>  El problema con este enfoque (en mi experiencia) es que la diferencia no est√° solo en el uso de una instancia separada de la base de datos que contiene los datos reales del entorno de producci√≥n.  A menudo, la diferencia se extiende a los siguientes aspectos: <br><br><ul><li>  El tama√±o del cl√∫ster provisional (si puede llamarlo "cl√∫ster", a veces es solo un servidor disfrazado de cl√∫ster); </li><li>  El hecho de que la puesta en escena normalmente usa un cl√∫ster mucho m√°s peque√±o tambi√©n significa que las configuraciones de configuraci√≥n para casi <i>todos los</i> servicios variar√°n.  Esto se aplica a configuraciones de equilibradores de carga, bases de datos y colas, por ejemplo, el n√∫mero de descriptores de archivo abiertos, el n√∫mero de conexiones de bases de datos abiertas, el tama√±o del grupo de subprocesos, etc. Si la configuraci√≥n se almacena en una base de datos o en un almacenamiento de datos de valores clave (por ejemplo, Zookeeper o Consul), estos sistemas auxiliares tambi√©n deben estar presentes en el entorno de ensayo; </li><li>  El n√∫mero de conexiones en l√≠nea procesadas por el servicio sin estado, o el m√©todo de reutilizaci√≥n de conexiones TCP por un servidor proxy (si este procedimiento se realiza en absoluto); </li><li>  Falta de monitoreo en la puesta en escena.  Pero incluso si se lleva a cabo la supervisi√≥n, algunas se√±ales pueden resultar completamente inexactas, ya que se supervisa un entorno distinto del que funciona.  Por ejemplo, incluso si monitorea la latencia de consulta o el tiempo de respuesta de MySQL, es dif√≠cil determinar si el nuevo c√≥digo contiene una consulta que puede iniciar un escaneo completo de la tabla en MySQL, ya que es <i>mucho</i> m√°s r√°pido (y a veces incluso preferible) realizar un escaneo completo de la peque√±a tabla utilizada en la prueba una base de datos en lugar de una base de datos de producci√≥n, donde una consulta puede tener un perfil de rendimiento completamente diferente. </li></ul><br>  Aunque es justo suponer que todas las diferencias anteriores no son argumentos serios contra el uso de la puesta en escena como tal, a diferencia de los antipatrones que deber√≠an evitarse.  Al mismo tiempo, el deseo de hacer todo bien a menudo requiere los enormes costos de mano de obra de los ingenieros en un intento por garantizar un entorno coherente.  La producci√≥n cambia constantemente y est√° influenciada por varios factores, por lo que tratar de lograr este partido es como ir a ninguna parte. <br><br>  Adem√°s, incluso si las condiciones en la puesta en escena ser√°n lo m√°s similares posible al entorno de trabajo, existen otros tipos de pruebas que son mejores para usar en funci√≥n de la informaci√≥n de producci√≥n real.  Un buen ejemplo ser√≠a la prueba de remojo, en la que la confiabilidad y la estabilidad de un servicio se prueban durante un per√≠odo prolongado de tiempo en niveles reales de multitarea y carga.  Se utiliza para detectar p√©rdidas de memoria, determinar la duraci√≥n de las pausas en el GC, el nivel de carga del procesador y otros indicadores durante un cierto per√≠odo de tiempo. <br><br>  Nada de lo anterior sugiere que la puesta en escena sea <i>completamente</i> in√∫til (esto se har√° evidente despu√©s de leer la secci√≥n sobre duplicaci√≥n de datos en la sombra cuando se prueban los servicios).  Esto solo indica que a menudo conf√≠an en la puesta en escena en mayor medida de lo necesario, y en muchas organizaciones sigue siendo el <i>√∫nico</i> tipo de prueba realizada antes del lanzamiento completo del producto. <br><br><h2>  El arte de probar en producci√≥n </h2><br>  Sucedi√≥ hist√≥ricamente que el concepto de "prueba en producci√≥n" est√° asociado con ciertos estereotipos y connotaciones negativas ("programaci√≥n guerrillera", falta o ausencia de pruebas de unidad e integraci√≥n, negligencia o falta de atenci√≥n a la percepci√≥n del producto por parte del usuario final). <br><br>  Las pruebas en producci√≥n ciertamente merecer√°n tal reputaci√≥n si se realizan descuidadamente y mal.  De ninguna manera <i>reemplaza las</i> pruebas en la etapa de preproducci√≥n y bajo ninguna circunstancia es una <i>tarea simple</i> .  Adem√°s, sostengo que las pruebas <i>exitosas</i> y <i>seguras</i> en producci√≥n requieren un nivel significativo de automatizaci√≥n, una buena comprensi√≥n de las pr√°cticas establecidas y el dise√±o de sistemas con una orientaci√≥n inicial para este tipo de pruebas. <br><br>  Para organizar un proceso integral y seguro de pruebas efectivas de servicios en producci√≥n, es importante no considerarlo como un t√©rmino general que denota un conjunto de diferentes herramientas y t√©cnicas.  Desafortunadamente, tambi√©n comet√≠ este error: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en mi art√≠culo anterior</a> no se present√≥ una clasificaci√≥n cient√≠fica de los m√©todos de prueba, y en la secci√≥n "Pruebas en producci√≥n" se agruparon una variedad de metodolog√≠as y herramientas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2h/bo/od/2hboodum_vrej99d2xm911ifecw.png"></div><br>  <i>De la nota Testing Microservices, la forma sensata ("Un enfoque inteligente para probar microservicios")</i> <br><br>  Desde la publicaci√≥n de la nota a fines de diciembre de 2017, he estado discutiendo su contenido y, en general, el tema de las pruebas en producci√≥n con varias personas. <br><br>  En el curso de estas discusiones, y tambi√©n despu√©s de una serie de conversaciones separadas, me qued√≥ claro que el tema de las pruebas en producci√≥n no puede reducirse a varios puntos mencionados anteriormente. <br><br>  El concepto de "prueba en producci√≥n" incluye una amplia gama de t√©cnicas aplicadas <i>en tres etapas diferentes</i> .  ¬øCu√°les? Vamos a entender. <br><br><img src="https://habrastorage.org/webt/6a/wc/5-/6awc5-yiregc_-2pzrk4i7gjxx0.jpeg"><br><br><h2>  Tres etapas de producci√≥n </h2><br>  Por lo general, las discusiones sobre producci√≥n se llevan a cabo solo en el contexto de la implementaci√≥n de c√≥digo en producci√≥n, monitoreo o en situaciones de emergencia cuando algo sali√≥ mal. <br><br>  Yo mismo he usado hasta ahora t√©rminos como "despliegue", "lanzamiento", "entrega", etc., como sin√≥nimos, sin pensar mucho en su significado.  Hace unos meses, todos los intentos de distinguir entre estos t√©rminos ser√≠an rechazados por m√≠ como algo insignificante. <br>  Despu√©s de pensar en esto, llegu√© a la idea de que <i>existe una</i> necesidad real de distinguir entre las diversas etapas de producci√≥n. <br><br><h3>  Etapa 1. Despliegue </h3><br>  Cuando las pruebas (incluso en producci√≥n) son una verificaci√≥n del logro de los <i>mejores indicadores posibles</i> , la precisi√≥n de las pruebas (y de hecho de cualquier verificaci√≥n) se garantiza solo con la condici√≥n de que el m√©todo de realizar las pruebas sea lo m√°s cercano posible a la forma en que el servicio se usa realmente en la producci√≥n. <br><br>  En otras palabras, las pruebas deben ejecutarse en un entorno que <i>simule mejor un entorno de trabajo</i> . <br><br>  Y la <i>mejor imitaci√≥n del</i> entorno laboral es ... el entorno laboral en s√≠.  Para realizar el m√°ximo n√∫mero posible de pruebas en un entorno de producci√≥n, es necesario que el resultado fallido de cualquiera de ellas no afecte al usuario final. <br><br>  Esto, a su vez, solo es posible si, <b>al implementar el servicio en un entorno de producci√≥n, los usuarios no obtienen acceso directo a este servicio</b> . <br><br>  En este art√≠culo, decid√≠ usar la terminolog√≠a del art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Deploy! = Release</a> escrito por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Turbine Labs</a> .  Define el t√©rmino "despliegue" de la siguiente manera: <br><br>  ‚ÄúLa implementaci√≥n es la instalaci√≥n por un grupo de trabajo de una nueva versi√≥n del c√≥digo del programa de servicio en la infraestructura de producci√≥n.  Cuando decimos que se ha <b>implementado</b> una nueva versi√≥n del software, queremos decir que se ejecuta en alg√∫n lugar dentro del marco de la infraestructura de trabajo.  Esta puede ser una nueva instancia de EC2 en AWS o un contenedor Docker que se ejecuta en el coraz√≥n de un cl√∫ster de Kubernetes.  El servicio se inici√≥ con √©xito, pas√≥ una comprobaci√≥n de estado y est√° listo (¬°lo espera!) Para procesar datos del entorno de producci√≥n, pero en realidad puede no recibir datos.  Este es un punto importante, lo enfatizo nuevamente: <b>para la implementaci√≥n no es necesario que los usuarios tengan acceso a la nueva versi√≥n de su servicio</b> .  Dada esta definici√≥n, la implementaci√≥n puede llamarse un proceso con un riesgo casi nulo ". <br><br>  Las palabras "proceso de riesgo cero" son simplemente un b√°lsamo para el alma de muchas personas que han sufrido despliegues sin √©xito.  La capacidad de instalar software <i>en un entorno real</i> sin permitir que los usuarios tengan una serie de ventajas cuando se trata de pruebas. <br>  En primer lugar, la necesidad de mantener entornos separados para el desarrollo, las pruebas y la puesta en escena, que inevitablemente deben sincronizarse con la producci√≥n, se minimiza (e incluso puede desaparecer por completo). <br><br>  Adem√°s, en la etapa de dise√±o de servicios, se hace necesario aislarlos unos de otros para que el hecho de no probar una instancia espec√≠fica del servicio en producci√≥n <i>no</i> conduzca a la cascada o afecte a los usuarios de la falla de otros servicios.  Una soluci√≥n a esto puede ser el dise√±o de un modelo de datos y un esquema de base de datos en el que las consultas no idempotentes (principalmente <i>operaciones de escritura</i> ) puedan: <br><br><ul><li>  Se realizar√° en relaci√≥n con la base de datos del entorno de producci√≥n durante cualquier lanzamiento de prueba del servicio en producci√≥n (prefiero este enfoque); </li><li>  Ser rechazado de forma segura en el nivel de aplicaci√≥n hasta que alcancen el nivel de escritura o guardado; </li><li>  Ser asignado o aislado en el nivel de registro o guardado de alguna manera (por ejemplo, almacenando metadatos adicionales). </li></ul><br><h3>  Etapa 2. Lanzamiento </h3><br>  Note <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Deploy! = Release</a> define el t√©rmino lanzamiento de la siguiente manera: <br><br>  ‚ÄúCuando decimos que se <b>lanz√≥</b> la <b>versi√≥n del</b> servicio, queremos decir que proporciona procesamiento de datos en el entorno de producci√≥n.  En otras palabras, un <b>lanzamiento</b> es un proceso que dirige los datos del entorno de producci√≥n a una nueva versi√≥n de software.  Con esta definici√≥n en mente, todos los riesgos que asociamos con el env√≠o de nuevos flujos de datos (interrupciones, insatisfacci√≥n del cliente, notas venenosas en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The Register</a> ) se relacionan con el <b>lanzamiento de un</b> nuevo software y no con su implementaci√≥n (en algunas compa√±√≠as, esta etapa tambi√©n se llama <b>lanzamiento)</b> . En este art√≠culo usaremos el t√©rmino <b>lanzamiento</b> ) ". <br><br>  En el libro de Google sobre SRE, el t√©rmino "lanzamiento" se utiliza en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cap√≠tulo sobre la organizaci√≥n de un lanzamiento de software para describirlo</a> . <br><br>  ‚ÄúUn <b>problema es un elemento l√≥gico de trabajo que consiste en una o m√°s tareas separadas.</b>  <b>Nuestro objetivo es coordinar el proceso de implementaci√≥n con el perfil de riesgo de este servicio</b> . <br><br>  En entornos de desarrollo o preproducci√≥n, podemos construir cada hora y distribuir autom√°ticamente las versiones despu√©s de pasar todas las pruebas.  Para los grandes servicios orientados al usuario, podemos comenzar el lanzamiento con un cl√∫ster y luego aumentar su escala hasta que actualicemos todos los cl√∫steres.  <b>Para elementos de infraestructura importantes, podemos extender el per√≠odo de implementaci√≥n a varios d√≠as y ejecutarlo a su vez en diferentes regiones geogr√°ficas ‚Äù.</b> <br><br>  En esta terminolog√≠a, las palabras "liberar" y "liberar" significan lo que el vocabulario general se refiere a "despliegue", y los t√©rminos que se usan a menudo para describir diversas estrategias de <i>despliegue</i> (por ejemplo, despliegue azul-verde o canario) se refieren al <i>lanzamiento de un</i> nuevo software <br><br>  Adem√°s, un <i>lanzamiento</i> fallido <i>de</i> aplicaciones puede causar interrupciones parciales o significativas en el trabajo.  En esta etapa, tambi√©n se realiza una <i>reversi√≥n</i> o <i>revisi√≥n</i> si resulta que la nueva versi√≥n <i>lanzada</i> del servicio es inestable. <br><br>  El proceso de <i>lanzamiento</i> funciona mejor cuando est√° automatizado y se ejecuta de forma <i>incremental</i> .  Del mismo modo, una <i>reversi√≥n</i> o <i>revisi√≥n de un</i> servicio es m√°s √∫til cuando la tasa de error y la frecuencia de solicitud se correlacionan autom√°ticamente con la l√≠nea de base. <br><br><h3>  Etapa 3. Despu√©s del lanzamiento </h3><br>  Si el lanzamiento se <i>realiz√≥ sin problemas</i> y la nueva versi√≥n del servicio procesa los datos del entorno de producci√≥n sin problemas obvios, podemos considerarlo exitoso.  Un lanzamiento exitoso es seguido por una etapa que se puede llamar "despu√©s del lanzamiento". <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="961811607759159296"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Cualquier sistema suficientemente complejo <i>siempre</i> estar√° en un estado de p√©rdida gradual de rendimiento.  Esto no significa que <i>se requiera</i> una <i>reversi√≥n</i> o <i>revisi√≥n</i> .  En cambio, es necesario controlar dicho deterioro (para diversos fines operativos y operativos) y depurar si es necesario.  Por esta raz√≥n, las pruebas despu√©s del lanzamiento ya no son m√°s como rutinas, sino <i>depuraci√≥n</i> o recopilaci√≥n de datos anal√≠ticos. <br><br>  En general, creo que todos los componentes del sistema deben crearse teniendo en cuenta el hecho de que ning√∫n sistema grande funciona perfectamente al 100% y que los fallos deben reconocerse y tenerse en cuenta en las etapas de dise√±o, desarrollo, prueba, implementaci√≥n y monitoreo del software. proporcionando. <br><br><hr><br>  Ahora que hemos identificado las tres etapas de producci√≥n, veamos los diversos mecanismos de prueba disponibles en cada una de ellas.  No todos tienen la oportunidad de trabajar en nuevos proyectos o reescribir c√≥digo desde cero.  En este art√≠culo, trat√© de identificar claramente los m√©todos que funcionar√°n mejor al desarrollar nuevos proyectos, as√≠ como hablar sobre qu√© m√°s podemos hacer para aprovechar los m√©todos propuestos sin realizar cambios significativos en los proyectos de trabajo. <br><br><h2>  Prueba de implementaci√≥n </h2><br>  Separamos las etapas de implementaci√≥n y lanzamiento, y ahora consideraremos algunos tipos de pruebas que se pueden aplicar despu√©s de implementar el c√≥digo en el entorno de producci√≥n. <br><br><h3>  Pruebas de integraci√≥n </h3><br>  Normalmente, las pruebas de integraci√≥n las realiza un servidor de integraci√≥n continua en un entorno de prueba aislado para cada rama de Git.  Se implementa una copia de <i>toda la</i> topolog√≠a del servicio (incluidas bases de datos, colas, servidores proxy, etc.) para los conjuntos de pruebas de <i>todos los</i> servicios que funcionar√°n juntos. <br><br>  Creo que esto no es particularmente efectivo por varias razones.  En primer lugar, el entorno de prueba, como el entorno de ensayo, no se puede implementar de tal manera que sea <i>id√©ntico al</i> entorno de producci√≥n real, <i>incluso si las</i> pruebas se ejecutan en el mismo contenedor Docker que se utilizar√° en la producci√≥n.  Esto es especialmente cierto cuando lo <i>√∫nico</i> que se ejecuta en un entorno de prueba son las pruebas mismas. <br><br>  Independientemente de si la prueba se ejecuta como un contenedor Docker o un proceso POSIX, lo m√°s probable es que realice <i>una</i> o m√°s conexiones a un servicio superior, base de datos o cach√©, lo cual es raro si el servicio se encuentra en un entorno de producci√≥n donde puede simult√°neamente procesar m√∫ltiples conexiones concurrentes, a menudo reutilizando conexiones TCP inactivas (esto se llama reutilizar conexiones HTTP). <br><br>  Adem√°s, el problema es causado por el hecho de que la mayor√≠a de las pruebas en cada inicio crean una nueva tabla de base de datos o espacio de clave de cach√© en <i>el mismo nodo</i> donde se realiza esta prueba (de esta manera, las pruebas est√°n aisladas de fallas de la red).  Este tipo de prueba en el mejor de los casos puede mostrar que el sistema funciona correctamente con una solicitud muy espec√≠fica.  Rara vez es eficaz para simular fallas graves y bien distribuidas, sin mencionar los diferentes tipos de fallas parciales.  Existen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estudios</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">exhaustivos</a> que confirman que los sistemas distribuidos a menudo exhiben <i>un comportamiento impredecible</i> que no puede preverse mediante un an√°lisis realizado de manera diferente que para todo el sistema. <br><br>  Pero esto no significa que las pruebas de integraci√≥n sean <i>en principio</i> in√∫tiles.  Solo podemos decir que, por regla general, la implementaci√≥n de pruebas de integraci√≥n en un <i>entorno artificial completamente aislado</i> no tiene sentido.  Las pruebas de integraci√≥n a√∫n deben realizarse para verificar que la nueva versi√≥n del servicio: <br><br><ul><li>  No interfiere con la interacci√≥n con los servicios ascendentes o descendentes; </li><li>  No afecta negativamente las metas y objetivos de los servicios superiores o inferiores. </li></ul><br>  El primero se puede proporcionar hasta cierto punto a trav√©s de pruebas de contrato.  <i>Debido</i> al hecho de que las <i>interfaces</i> entre los servicios funcionan correctamente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">las pruebas de contrato</a> son un m√©todo eficaz para desarrollar y probar servicios individuales en <i>la etapa de preproducci√≥n</i> , que no requiere el despliegue de toda la topolog√≠a de servicios. <br><br>  Las plataformas de prueba de contratos orientadas al cliente, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pact</a> , actualmente solo admiten la interoperabilidad entre servicios a trav√©s de RESTful JSON RPC, aunque es probable que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se est√© trabajando para admitir la interacci√≥n asincr√≥nica a trav√©s de sockets web, aplicaciones que no son del servidor y colas de mensajes</a> .  Es probable que en el futuro se agregue soporte para los protocolos gRPC y GraphQL, pero ahora a√∫n no est√° disponible. <br><br>  Sin embargo, antes del <i>lanzamiento de una</i> nueva versi√≥n, puede ser necesario verificar no solo el correcto funcionamiento de las <i>interfaces</i> . , , ,   RPC-            .    ,       , ,       . <br><br>  ,     <i></i> ,   ‚Äî ,       <i>,  </i>    (  ,    ). <br>      :  <i></i>     ? <br><br>     .    ‚Äì ,       :    -   - ( C)   MySQL ( D)       memcache ( B). <br><br>   ,      (    ),  stateful-  stateless-        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xl/nc/4e/xlnc4eni3elyx3huaw3trxs5uyc.jpeg"></div><br>  <i></i>  <i></i> ,     <i></i>      . <br><br>  service discovery        <i></i> ( ),      <i></i>  <i></i>        .         <i></i>   . <br><br> ,   <i></i>    C  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ze/8y/yp/ze8yypuxevqszd_krd3cls4hrqc.jpeg"></div><br>  ,  <i></i>   ,        ,       .      ,       ,       .  ,     <i></i> ,        . <br><br>   Google     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Just Say No to More End-to-End Tests</a> (¬´      ¬ª),      : <br><br> ¬´ <i>       ( )      .       ,    ?           ,      </i> . <b>     ,     ,      ,     ¬ª.</b> <br><br>    ,          :       <i></i>       .               ,       A        . <br><br>     ,     <i></i>   C     MySQL,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/c4/bu/qc/c4buqc8zz2dt4e3pyr6svjnyguc.jpeg"></div><br>  <i> </i>       (   ,   ,         ¬´¬ª ,  <i></i> ).     <i></i>   MySQL   ,    ,      . <br><br>   ‚Äî        -.      ,      .              -,          . <br><br>    ,   -     <i></i>     ,   /: <br><br><ul><li>       C     /   ; </li><li>         ,   ¬´¬ª   . </li></ul><br>       <i>  </i>    ,             (,   ). <br><br>           ,    ,   <i></i>  .      IP- ,   ,    ,    ,       , ,  ,    ,    . <br><br> ,   ,     ,    ,       .      .     Facebook,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kraken</a> ,  : <br><br> ¬´ <i>   ‚Äî     ,         .   -      ,    .        ,        .</i> <b>           -     ,     ,     ,       ¬ª.</b> <br><br>   ,      ,       ,     ,         ,  . <br><br>     -     .    service mesh             .        -.        -,  ,  ,    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uk/kv/cj/ukkvcjxlzn3hdcpt-mxsep3pojm.jpeg"></div><br>  Si probamos el servicio B, su servidor proxy saliente se puede configurar para agregar un encabezado especial <code>X-ServiceB-Test</code> a cada solicitud de prueba.  En este caso, el servidor proxy entrante del servicio superior C podr√°: <br><br><ul><li>  Detecta este encabezado y env√≠a una respuesta est√°ndar al servicio B; </li><li>  D√≠gale al Servicio C que la solicitud es una <i>prueba</i> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3s/mr/-n/3smr-n7k-_87j3jjpirb02hkaja.jpeg"></div><br>  <i>Pruebas de integraci√≥n de la interacci√≥n de la versi√≥n implementada del servicio B con la versi√≥n lanzada del servicio C, donde las operaciones de escritura nunca llegan a la base de datos</i> <br><br>  Realizar pruebas de integraci√≥n de esta manera tambi√©n permite probar la interacci√≥n del servicio B con servicios superiores <i>cuando procesan datos normales del entorno de producci√≥n</i> ; esta es probablemente una imitaci√≥n m√°s cercana de c√≥mo se comportar√° el servicio B cuando se <i>lance</i> a producci√≥n. <br><br>  Tambi√©n ser√≠a bueno que cada servicio en esta arquitectura admitiera llamadas API reales en modo de prueba o simulacro, lo que le permite probar la ejecuci√≥n de contratos de servicio con servicios posteriores sin cambiar los datos reales.  Esto equivaldr√≠a a pruebas de contrato, pero a nivel de red. <br><br><h3>  Duplicaci√≥n de datos sombra (prueba de flujo de datos oscuros o reflejo) </h3><br>  La duplicaci√≥n de sombras (en el art√≠culo en el blog de Google se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzamiento oscuro</a> , y el t√©rmino <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reflejo</a> se usa en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Istio</a> ) en muchos casos tiene m√°s ventajas que las pruebas de integraci√≥n. <br><br>  Los <a href="http://">Principios de la Ingenier√≠a del Caos</a> establece lo siguiente: <br><br>  ‚ÄúLos <i>sistemas se comportan de manera diferente seg√∫n el entorno y el esquema de transferencia de datos.</i>  <i>Dado que el modo de uso puede cambiar en cualquier momento</i> , el <b>muestreo de datos reales es la √∫nica forma confiable de arreglar la ruta de solicitud ".</b> <br><br>  La duplicaci√≥n de datos en la sombra es un m√©todo mediante el cual el flujo de datos del entorno de producci√≥n que ingresa a un servicio determinado se captura y reproduce en una nueva versi√≥n <i>implementada</i> del servicio.  Este proceso se puede realizar en tiempo real, cuando el flujo de datos entrantes se divide y se env√≠a a las versiones <i>lanzadas</i> y <i>desplegadas</i> del servicio, o de forma as√≠ncrona, cuando se reproduce una copia de los datos capturados previamente en el servicio <i>desplegado</i> . <br><br>  Cuando trabaj√© en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">imgix</a> (una startup con un equipo de 7 ingenieros, de los cuales solo cuatro eran ingenieros de sistemas), se utilizaron flujos de datos oscuros para probar los cambios en nuestra infraestructura de visualizaci√≥n de im√°genes.  Registramos un cierto porcentaje de todas las solicitudes entrantes y las enviamos al cl√∫ster de Kafka: pasamos los registros de acceso de HAProxy a la tuber√≠a de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">heka</a> , que a su vez pas√≥ el flujo de solicitud analizado al cl√∫ster de Kafka.  Antes de la etapa de <i>lanzamiento,</i> se prob√≥ <i>una</i> nueva versi√≥n de nuestra aplicaci√≥n de procesamiento de im√°genes en un flujo de datos oscuros capturados, lo que permiti√≥ verificar que las solicitudes se procesaron correctamente.  Sin embargo, nuestro sistema de visualizaci√≥n de im√°genes era en general un servicio sin estado que era particularmente adecuado para este tipo de pruebas. <br><br>  Algunas compa√±√≠as prefieren capturar no una parte del flujo de datos, pero transmiten una <i>copia completa de</i> este flujo a la nueva versi√≥n de la aplicaci√≥n.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">McRouter de Facebook</a> (proxy memcached) es compatible con este tipo de duplicaci√≥n oculta del flujo de datos de memcache. <br><br>  ‚Äú <i>Al probar una nueva instalaci√≥n para el cach√©, nos pareci√≥ muy conveniente poder redirigir una copia completa del flujo de datos desde los clientes.</i>  <i>McRouter admite configuraciones flexibles de duplicaci√≥n de sombras.</i>  <i>Es posible realizar la duplicaci√≥n de sombra de un grupo de varios tama√±os (volviendo a almacenar en cach√© el espacio clave), copiar solo una parte del espacio clave o cambiar din√°micamente los par√°metros durante la operaci√≥n</i> . <br><br>  El aspecto negativo de la duplicaci√≥n en la sombra de todo el flujo de datos para un servicio <i>implementado</i> en un entorno de producci√≥n es que si se ejecuta en el momento de la m√°xima intensidad de transferencia de datos, puede requerir el doble de potencia. <br>  Los proxies como Envoy admiten la duplicaci√≥n oculta del flujo de datos a otro cl√∫ster en modo disparar y olvidar.  Su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> dice: <br><br>  ‚Äú <i>Un enrutador puede realizar duplicaciones ocultas del flujo de datos de un cl√∫ster a otro.</i>  <i>Actualmente, se implementa el modo disparar y olvidar, en el que el servidor proxy Envoy no espera una respuesta del cl√∫ster sombra antes de devolver una respuesta del cl√∫ster principal.</i>  <i>Para el cl√∫ster de sombra, se recopilan todas las estad√≠sticas habituales, lo que es √∫til para fines de prueba.</i>  <i>Con la duplicaci√≥n de sombra, la opci√≥n <code>-shadow</code> se agrega al <code>-shadow</code> host / autoridad.</i>  <i>Esto es √∫til para iniciar sesi√≥n.</i>  <i>Por ejemplo, <code>cluster1</code> convierte en <code>cluster1-shadow</code></i> ". <br><br>  Sin embargo, a menudo es poco pr√°ctico o imposible crear una r√©plica de un cl√∫ster sincronizado con la producci√≥n para la prueba (por la misma raz√≥n que es problem√°tico organizar un cl√∫ster de etapas sincronizado).  Si la duplicaci√≥n de sombra se usa para probar un nuevo servicio <i>implementado</i> que tiene muchas dependencias, puede iniciar cambios imprevistos en el estado de los servicios de nivel superior con respecto al probado.  La duplicaci√≥n en la sombra del volumen diario de registros de usuarios en la versi√≥n <i>implementada</i> del servicio con registro en la base de datos de producci√≥n puede conducir a un aumento en la tasa de error de hasta el 100% debido al hecho de que el flujo de datos en la sombra se percibir√° como intentos repetidos de registrarse y rechazarse. <br><br>  Mi experiencia personal sugiere que la duplicaci√≥n de sombra es m√°s adecuada para probar solicitudes no idempotentes o servicios sin estado con ap√©ndices del lado del servidor.  En este caso, la duplicaci√≥n oculta de datos se usa con mayor frecuencia para probar la carga, la estabilidad y las configuraciones.  Al mismo tiempo, con la ayuda de pruebas o etapas de integraci√≥n, puede probar c√≥mo interact√∫a el servicio con un servidor con estado cuando se trabaja con solicitudes no idempotentes. <br><br><h3>  Comparaci√≥n TAP </h3><br>  La √∫nica menci√≥n de este t√©rmino se encuentra en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> del blog de Twitter dedicado al lanzamiento de servicios con un alto nivel de calidad de servicio. <br><br>  <i>‚ÄúPara verificar la exactitud de la nueva implementaci√≥n del sistema existente, utilizamos un m√©todo llamado <b>comparaci√≥n de tomas</b> .</i>  <i>Nuestra herramienta de comparaci√≥n de tomas reproduce los datos de producci√≥n de muestra en el nuevo sistema y compara las respuestas recibidas con los resultados del anterior.</i>  <i>Los resultados obtenidos nos ayudaron a encontrar y corregir errores en el sistema incluso antes de que los usuarios finales los encontraran ‚Äù.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otra</a> publicaci√≥n de blog de Twitter define las comparaciones de tap de la siguiente manera: <br><br>  <i>"Env√≠o de solicitudes a instancias de servicio tanto en producci√≥n como en entornos de ensayo con la <b>comprobaci√≥n de los resultados</b> y la evaluaci√≥n de las caracter√≠sticas de rendimiento".</i> <br><br>  La diferencia entre la comparaci√≥n de tomas y la duplicaci√≥n oculta es que, en el primer caso, la respuesta devuelta por la versi√≥n <i>lanzada</i> se compara con la respuesta devuelta por la versi√≥n <i>implementada</i> , y en el segundo, la solicitud se duplica a la versi√≥n <i>implementada</i> en modo fuera de l√≠nea como disparar y olvidar. <br><br>  Otra herramienta para trabajar en esta √°rea es la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cient√≠fica</a> , disponible en GitHub.  Esta herramienta fue desarrollada para probar el c√≥digo Ruby, pero luego fue portada a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">varios otros idiomas</a> .  Es √∫til para algunos tipos de pruebas, pero tiene varios problemas sin resolver.  Esto es lo que escribi√≥ un desarrollador de GitHub en una comunidad Slack profesional: <br><br>  <i>‚ÄúEsta herramienta simplemente ejecuta dos ramas de c√≥digo y compara los resultados.</i>  <i>Debe tener cuidado con el c√≥digo de estas ramas.</i>  <i>Es necesario asegurarse de que las consultas de la base de datos no se dupliquen si esto genera problemas.</i>  <i>Creo que esto se aplica no solo a un cient√≠fico, sino tambi√©n a cualquier situaci√≥n en la que hagas algo dos veces y luego compares los resultados.</i>  <i>La herramienta cient√≠fica fue creada para verificar que el nuevo sistema de permisos funciona igual que el anterior, y en ciertos momentos se utiliz√≥ para comparar los datos que son t√≠picos para pr√°cticamente todas las solicitudes de Rails.</i>  <i>Creo que el proceso llevar√° m√°s tiempo, ya que el procesamiento se realiza de forma secuencial, pero este es un problema de Ruby en el que no se utilizan hilos.</i> <i><br><br></i>  <i>En la mayor√≠a de los casos que conozco, la herramienta cient√≠fica se utiliz√≥ para trabajar con operaciones de lectura en lugar de escritura, por ejemplo, para averiguar si las nuevas consultas mejoradas y los esquemas de permisos reciben la misma respuesta que los anteriores.</i>  <i>Ambas opciones se ejecutan en un entorno de producci√≥n (en r√©plicas).</i>  <i>Si los recursos probados tienen efectos secundarios, creo que las pruebas tendr√°n que hacerse a nivel de aplicaci√≥n ".</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Diffy</a> es una herramienta de c√≥digo abierto escrita en Scala presentada por Twitter en 2015.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un art√≠culo</a> del blog de Twitter titulado <b>Pruebas sin escribir Pruebas</b> es probablemente el mejor recurso para comprender c√≥mo funcionan las comparaciones de tomas en la pr√°ctica. <br><br>  <i>‚ÄúDiffy detecta posibles errores en el servicio al lanzar simult√°neamente una versi√≥n nueva y antigua del c√≥digo.</i>  <i>Esta herramienta funciona como un servidor proxy y env√≠a todas las solicitudes recibidas a cada una de las instancias en ejecuci√≥n.</i>  <i>Luego compara las respuestas de las instancias e informa todas las desviaciones encontradas durante la comparaci√≥n.</i>  <i>Diffy se basa en la siguiente idea:</i> <b>si dos implementaciones de un servicio devuelven las mismas respuestas con un conjunto de solicitudes suficientemente grande y variado, entonces estas dos implementaciones pueden considerarse equivalentes, y las m√°s nuevas sin degradaci√≥n del rendimiento.</b>  <i>La innovadora t√©cnica de reducci√≥n de ruido de Diffy lo distingue de otras herramientas comparativas de an√°lisis de regresi√≥n ".</i> <br><br>  La comparaci√≥n de tap es excelente cuando necesita verificar si dos versiones dan los mismos resultados.  De acuerdo con Mark McBride, <br><br>  <i>‚ÄúLa herramienta Diffy a menudo se usaba en el redise√±o de sistemas.</i>  <i>En nuestro caso, dividimos la base del c√≥digo fuente de Rails en varios servicios creados usando Scala, y una gran cantidad de clientes API utilizaron funciones de manera diferente a lo que esper√°bamos.</i>  <i>Funciones como el formato de fecha eran especialmente peligrosas ".</i> <br><br>  La comparaci√≥n de tomas no es la mejor opci√≥n para probar la actividad del usuario o la identidad del comportamiento de dos versiones del servicio con la carga m√°xima.  Al igual que con la duplicaci√≥n de sombra, los efectos secundarios siguen siendo un problema no resuelto, especialmente cuando tanto la versi√≥n implementada como la versi√≥n de producci√≥n escriben datos en la misma base de datos.  Al igual que con las pruebas de integraci√≥n, una forma de evitar este problema es usar pruebas de comparaci√≥n de tap con solo un conjunto limitado de cuentas. <br><br><h3>  Prueba de carga </h3><br>  Para aquellos que no est√°n familiarizados con las pruebas de estr√©s, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este art√≠culo</a> puede servir como un buen punto de partida.  No hay escasez de herramientas y plataformas para pruebas de carga de c√≥digo abierto.  Los m√°s populares son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">Apache Bench</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gatling</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wrk2</a> , <a href="http://">Tsung</a> , escritos en Erlang, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siege</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Iago</a> de Twitter, escritos en Scala (que reproduce los registros de un servidor HTTP, servidor proxy o analizador de paquetes de red en una instancia de prueba).  Algunos expertos creen que la mejor herramienta para generar carga es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mzbench</a> , que admite una variedad de protocolos, incluidos MySQL, Postgres, Cassandra, MongoDB, TCP, etc. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NDBench</a> de Netflix es otra herramienta de c√≥digo abierto para almacenes de datos de prueba de carga. , que admite la mayor√≠a de los protocolos conocidos. <br><br>  El blog oficial de Twitter de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Iago</a> describe con m√°s detalle qu√© caracter√≠sticas debe tener un buen generador de carga: <br><br>  <i>‚ÄúLas solicitudes sin bloqueo se generan a una frecuencia dada en funci√≥n de una distribuci√≥n estad√≠stica personalizada interna ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el proceso de Poisson se</a> modela de manera predeterminada).</i>  <i>La frecuencia de las solicitudes se puede cambiar seg√∫n sea necesario, por ejemplo, para preparar el cach√© antes de trabajar a plena carga.</i> <i><br><br></i>  <i>En general, la atenci√≥n principal se presta a la frecuencia de las solicitudes de acuerdo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la ley de Little</a> , y no al n√∫mero de usuarios concurrentes, que pueden variar seg√∫n la cantidad de retraso inherente a este servicio.</i>  <i>Debido a esto, aparecen nuevas oportunidades para comparar los resultados de varias pruebas y prevenir el deterioro del servicio, lo que ralentiza el funcionamiento del generador de carga.</i> <i><br><br></i>  <i>En otras palabras, la herramienta Iago busca simular un sistema en el que se reciben solicitudes independientemente de la capacidad de su servicio para procesarlas.</i>  <i>En esto, difiere de los generadores de carga que simulan sistemas cerrados en los que los usuarios trabajar√°n pacientemente con el retraso existente.</i>  <i>Esta diferencia nos permite modelar con bastante precisi√≥n los modos de falla que se pueden encontrar en la producci√≥n ".</i> <br><br>  Otro tipo de prueba de carga es la prueba de esfuerzo redistribuyendo el flujo de datos.  Su esencia es la siguiente: todo el flujo de datos del entorno de producci√≥n se dirige a un cl√∫ster m√°s peque√±o que el preparado para el servicio;  Si hay problemas, la secuencia de datos se transfiere nuevamente al cl√∫ster m√°s grande.  Facebook utiliza esta t√©cnica, como se describe en uno de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culos de su blog oficial</a> : <br><br>  <i>‚ÄúRedirigimos espec√≠ficamente un mayor flujo de datos a grupos o nodos individuales, medimos el consumo de recursos en estos nodos y determinamos los l√≠mites de la estabilidad del servicio.</i>  <i>Este tipo de prueba, en particular, es √∫til para determinar los recursos de CPU necesarios para admitir la cantidad m√°xima de transmisiones simult√°neas de Facebook Live ".</i> <br><br>  Esto es lo que escribe un ex ingeniero de LinkedIn en la comunidad profesional de Slack: <br><br>  <i>"LinkedIn tambi√©n utiliz√≥ pruebas de l√≠nea roja en la producci√≥n: los servidores se eliminaron del equilibrador de carga hasta que la carga alcanz√≥ los valores umbral o comenzaron a producirse errores".</i> <br><br>  De hecho, una b√∫squeda en Google proporciona un enlace a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documento t√©cnico completo</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo de</a> blog de LinkedIn sobre este tema: <br><br>  <i>‚ÄúLa soluci√≥n Redliner para mediciones utiliza un flujo de datos real del entorno de producci√≥n, lo que evita errores que impiden mediciones precisas del rendimiento en el laboratorio.</i> <i><br><br></i>  <i>Redliner redirige parte del flujo de datos al servicio bajo prueba y analiza en tiempo real su rendimiento.</i>  <i>Esta soluci√≥n se ha implementado en cientos de servicios internos de LinkedIn y se usa diariamente para varios tipos de an√°lisis de rendimiento.</i> <i><br><br></i>  <i>Redliner admite la ejecuci√≥n de pruebas paralelas para instancias canarias y de producci√≥n.</i>  <b>Esto permite a los ingenieros transferir la misma cantidad de datos a dos instancias de servicio diferentes: 1) una instancia de servicio que contiene innovaciones, como nuevas configuraciones, propiedades o nuevo c√≥digo;</b>  <b>2) una instancia de servicio de la versi√≥n de trabajo actual.</b> <br><br>  <i>"Los resultados de las pruebas de carga se tienen en cuenta al tomar decisiones y ayudan a prevenir la implementaci√≥n del c√≥digo, lo que puede conducir a un bajo rendimiento".</i> <br><br>  Facebook llev√≥ las pruebas de carga utilizando flujos de datos reales a un nivel completamente nuevo gracias al sistema Kraken, y tambi√©n vale la pena leer su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci√≥n</a> . <br>  Las pruebas se implementan redistribuyendo el flujo de datos al cambiar los valores de peso (le√≠dos del almac√©n de configuraci√≥n distribuida) para dispositivos fronterizos y cl√∫steres en la configuraci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proxygen</a> (balanceador de carga de Facebook).  Estos valores determinan el volumen de datos reales enviados, respectivamente, a cada grupo y regi√≥n en un punto de presencia dado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wk/0e/by/wk0ebyvdpznpgdgqcc_6zbu1g6g.png"></div><br>  <i>Datos del libro blanco de Kraken</i> <br><br>  El sistema de monitoreo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gorilla</a> ) muestra indicadores de varios servicios (como se muestra en la tabla anterior).  En funci√≥n de los datos y los umbrales de monitoreo, se toma la decisi√≥n de enviar m√°s datos de acuerdo con los valores de peso, o si es necesario reducir o incluso detener por completo la transferencia de datos a un grupo espec√≠fico. <br><br><h2>  Pruebas de configuraci√≥n </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-2" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="916383043933192192"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Una nueva ola de herramientas de infraestructura de c√≥digo abierto ha hecho que la captura de todos los cambios en la infraestructura en forma de c√≥digo no solo sea posible, sino tambi√©n relativamente <i>f√°cil</i> .  Tambi√©n es posible <i>probar</i> estos cambios en diversos grados, aunque la mayor√≠a de las pruebas de infraestructura como c√≥digo en la etapa de preproducci√≥n solo pueden confirmar las especificaciones y la sintaxis correctas. <br><br>  Adem√°s, la negativa a probar la nueva configuraci√≥n antes de la <i>publicaci√≥n del</i> c√≥digo se convirti√≥ en la causa de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">n√∫mero significativo de interrupciones</a> . <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-3" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="963093541575581696"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Para las pruebas hol√≠sticas de los cambios de configuraci√≥n, es importante distinguir entre diferentes tipos de configuraciones.  Fred Hebert una vez sugiri√≥ usar el siguiente cuadrante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/fi/4i/yvfi4ioub6pkvt1mtzxvz2xuvnk.png"></div><br>  Esta opci√≥n, por supuesto, no es universal, pero esta distinci√≥n le permite decidir c√≥mo probar mejor cada una de las configuraciones y en qu√© etapa hacerlo.  La configuraci√≥n del tiempo de compilaci√≥n tiene sentido si puede garantizar la verdadera repetibilidad de los ensamblajes.  No todas las configuraciones son est√°ticas, pero en las plataformas modernas es inevitable un cambio din√°mico de configuraci√≥n (incluso si se trata de una "infraestructura permanente"). <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-4" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1005924617981005824"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>       ,   ,       blue-green ,        .   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jamie Wilkinson</a> ),  Google  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> : <br><br> <i>¬´        ,   ,   ,  -     .    .</i> <b>    -  ,         ‚Äî  ,       ,   .        .</b> <br><br> <i>            ,  .     ,    , ‚Äî    ¬ª.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  Facebook</a>             : <br><br> <i>¬´           .    ‚Äî  ,              .             .        ,      .</i> <br><br><ul><li> <b>   </b> <br><br>             .  Facebook ,          .             ,     . </li><li> <b>   </b> <br><br>         (,  JSON).           ,           .          . <br><br>   (,  Facebook  Thrift)      .   ,           . </li><li> <b> </b> <br><br>         ,     ,    - .       .   ‚Äî A/B-,        1 % .     A/B-,        .      A/B-    . ,  ,                 ,       ,     .  , A/B-    .      ,    A/B-.     Facebook        . <br><br> ,     A/B-  1% ,   1%     ,          (   ¬´  ¬ª).          ,         .               ,      . </li><li> <b>  </b> <br><br>   Facebook            .       ,        .    ,              ,     .   ,  ,           . </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cancelaci√≥n de cambios simple y conveniente</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En algunos casos, a pesar de todas las medidas preventivas, se realiza el despliegue de una configuraci√≥n inoperativa. </font><font style="vertical-align: inherit;">Encontrar y revertir r√°pidamente los cambios es fundamental para abordar este problema. </font><font style="vertical-align: inherit;">"Las herramientas de control de versiones est√°n disponibles en nuestro sistema de configuraci√≥n que hacen que sea mucho m√°s f√°cil deshacer los cambios".</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Continuar√°! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: continu√≥ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418081/">https://habr.com/ru/post/es418081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418069/index.html">Resolver crucigramas japoneses a la velocidad de la luz</a></li>
<li><a href="../es418071/index.html">Industria de TI para la gente: Festival TechTrain en San Petersburgo</a></li>
<li><a href="../es418075/index.html">TOP 5 cosas que se pueden imprimir en una impresora 3D [video]</a></li>
<li><a href="../es418077/index.html">Accidentes de "no mirar": una justificaci√≥n estad√≠stica para el modo operativo de soporte t√©cnico 24/7</a></li>
<li><a href="../es418079/index.html">Los lenguajes de programaci√≥n m√°s populares - 2018</a></li>
<li><a href="../es418083/index.html">Servidor simple con GraphQL en lugar de REST, implementaci√≥n en java</a></li>
<li><a href="../es418085/index.html">Usando promesas en JavaScript</a></li>
<li><a href="../es418087/index.html">El 80% de los pagos de autoservicio est√°n en riesgo</a></li>
<li><a href="../es418089/index.html">Descripci√≥n general de la fresadora CNC SolidCraft</a></li>
<li><a href="../es418091/index.html">Lista de art√≠culos y literatura sobre NAS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>