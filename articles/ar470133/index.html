<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฝ ๐๏ธ ๐ ููููุฉ ุฌูุน ุงูููุงููุณ ุงูุชู ูุง ุชุดูููุง ุงูุฅุดุงุฑุฉ ุงูุฒูููุฉ ูุน ุจุฑูููุซููุณ ๐ฉ๐พโ๐จ ๐ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุชููู ุงูุนุฏูุฏ ูู ุชุทุจููุงุช ุงูุดุจูุงุช ูู ุฎุงุฏู ููุจ ูููู ุจูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูููุช ุงููุนูู ููุนุงูุฌ ุฅุถุงูู ูุชู ุชุดุบููู ูู ุงูุฎูููุฉ ุจุดูู ุบูุฑ ูุชุฒุงูู. ููุงู ุงูุนุฏูุฏ ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุฌูุน ุงูููุงููุณ ุงูุชู ูุง ุชุดูููุง ุงูุฅุดุงุฑุฉ ุงูุฒูููุฉ ูุน ุจุฑูููุซููุณ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/470133/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/-6/xs/ee/-6xseehi1ojmkxmb_phq6tr3h_a.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงูุนุฏูุฏ ูู ุชุทุจููุงุช ุงูุดุจูุงุช ูู ุฎุงุฏู ููุจ ูููู ุจูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูููุช ุงููุนูู ููุนุงูุฌ ุฅุถุงูู ูุชู ุชุดุบููู ูู ุงูุฎูููุฉ ุจุดูู ุบูุฑ ูุชุฒุงูู.  ููุงู ุงูุนุฏูุฏ ูู ุงููุตุงุฆุญ ุงูุฑุงุฆุนุฉ ููุชุญูู ูู ุญุงูุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ููุง ูุชููู ุงููุฌุชูุน ุนู ุชุทููุฑ ุฃุฏูุงุช ูุซู Prometheus ุงูุชู ุชุณุงุนุฏ ูู ุงูุชูููู.  ููู ูู ุจุนุถ ุงูุฃุญูุงู ูุง ุชูู ุฃูููุฉ ุงููุนุงูุฌุงุช - ุจู ูุงูุฃูุซุฑ ุฃูููุฉ -.  ููุง ุฃููู ุจุญุงุฌุฉ ุฅูู ุงูุงูุชูุงู ูุงูุชูููู ุ ูููู ููุงู ุงููููู ูู ุงูุฅุฑุดุงุฏุงุช ุญูู ููููุฉ ุงูููุงู ุจุฐูู ูุน ุชุฌูุจ ุงููุฒุงูู ุงูุดุงุฆุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชู ุชุฎุตูุต ูุฐู ุงูููุงูุฉ ูููุฎุงุฎ ุงูุฃูุซุฑ ุดููุนูุง ูู ุนูููุฉ ุชูููู ุงููุนุงูุฌุงุช ุบูุฑ ุงููุชุฒุงููุฉ ุ ูุฐูู ุจุงุณุชุฎุฏุงู ูุซุงู ูุญุงุฏุซ ููุน ูู ุจูุฆุฉ ุฅูุชุงุฌ ุ ุญูุซ ูุงู ูู ุงููุณุชุญูู ุ ุญุชู ูุน ุงูููุงููุณ ุ ุชุญุฏูุฏ ูุง ุงูุฐู ูุงู ูููู ุจู ุงููุนุงูุฌูู ุจุงูุถุจุท.  ุฅู ุงุณุชุฎุฏุงู ุงูููุงููุณ ูุฏ ุญููู ุงูุชุฑููุฒ ุฅูู ุฏุฑุฌุฉ ุฃู ุงูููุงููุณ ููุณูุง ูุฐุจุช ุนูุงููุฉ ุ ููุง ูููููู ุ ูุนุงูุฌุงุชู ุฅูู ุงูุฌุญูู. </p><br><p style=";text-align:right;direction:rtl"> ุณูุฑู ููููุฉ ุงุณุชุฎุฏุงู ุงูููุงููุณ ุจุทุฑููุฉ ุชููุฑ ุชูุฏูุฑูุง ุฏููููุง ุ ููู ุงูุฎุชุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณูุจูู</a> ุงูุชูููุฐ ุงููุฑุฌุนู ูุจุฑูุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">prometheus-client-tracer</a> ููุชูุญ ุงููุตุฏุฑ ุ ูุงูุฐู ููููู ุงุณุชุฎุฏุงูู ูู ุชุทุจููุงุชู. </p><a name="habracut"></a><br><h3 id="incident" style=";text-align:right;direction:rtl">  ุญุงุฏุซ </h3><br><p style=";text-align:right;direction:rtl">  ูุตูุช ุงูุชูุจููุงุช ุจุณุฑุนุฉ ูุฏูุน ุฑุดุงุด: ุฒุงุฏ ุนุฏุฏ ุฃุฎุทุงุก HTTP ุจุดูู ุญุงุฏ ุ ูุฃูุฏุช ููุญุงุช ุงูุชุญูู ุฃู ููุงุฆู ุงูุชุธุงุฑ ุงูุทูุจ ุขุฎุฐุฉ ูู ุงูุงุฒุฏูุงุฏ ุ ูููุงุฏ ููุช ุงูุงุณุชุฌุงุจุฉ.  ุจุนุฏ ุญูุงูู ุฏูููุชูู ุ ุชู ูุณุญ ููุงุฆู ุงูุงูุชุธุงุฑ ุ ูุนุงุฏ ูู ุดูุก ุฅูู ุทุจูุนุชู. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงููุญุต ุงูุฏููู ุ ุงุชุถุญ ุฃู ุฎูุงุฏู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) ุงูุฎุงุตุฉ ุจูุง ูุฏ ูููุช ูู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ DB ุ ููุง ุชุณุจุจ ูู ุชููููุง ููุฌุฃุฉ ุนู ุงูููุงู ุจุฌููุน ุงูุฃูุดุทุฉ.  ูุนูุฏูุง ุชููุฑ ูู ุฃู ุงูุญูู ุงูุฃุซูู ููุน ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุนูู ูุณุชูู ุงููุนุงูุฌุงุช ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุฏ ุฃุตุจุญูุง ุงููุดุชุจู ุจูู ุงูุฑุฆูุณููู.  ูุงู ุงูุณุคุงู ุงูููุทูู ูู: ูุงุฐุง ููุนููู ููุงู ุนูู ุงูุฅุทูุงูุ! </p><br><p style=";text-align:right;direction:rtl">  ููุถุญ ูููุงุณ ุจุฑูููุซููุณ ูุง ุชุณุชุบุฑูู ุงูุนูููุฉ ูู ููุช ุ ููู ููุง: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs"># HELP job_worked_seconds_total Sum of the time spent processing each job class # TYPE job_worked_seconds_total counter job_worked_seconds_total{job}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฎูุงู ุชุชุจุน ุฅุฌูุงูู ููุช ุงูุชูููุฐ ููู ูููุฉ ููุชูุฑุฉ ุชุบููุฑ ุงููููุงุณ ุ ุณููุชุดู ููุฏุงุฑ ููุช ุงูุนูู ุงูุฐู ุชู ุฅููุงูู.  ุฅุฐุง ููุฏุฉ 15 ุซุงููุฉ.  ุฒุงุฏ ุงูุนุฏุฏ ุจููุฏุงุฑ 15 ุ ููุฐุง ูุนูู ูุฌูุฏ ูุนุงูุฌ ูุดุบูู (ุซุงููุฉ ูุงุญุฏุฉ ููู ุซุงููุฉ ุณุงุจูุฉ) ุ ุจูููุง ุชุนูู ุงูุฒูุงุฏุฉ 30 ูุนุงูุฌูู ุ ุฅูุฎ. </p><br><p style=";text-align:right;direction:rtl">  ุณูู ููุถุญ ุฌุฏูู ุงูุนูู ุฎูุงู ุงูุญุงุฏุซ ูุง ููุงุฌูู.  ุงููุชุงุฆุฌ ูุฎูุจุฉ ููุขูุงู.  ูุชููุฒ ููุช ุงูุญุงุฏุซ (16: 02-16: 04) ุจุฎุท ุฃุญูุฑ ูููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/33/1u/bc/331ubcimex4xb4hm_zdondnxcnw.png"><br>  <em>ูุดุงุท ุงููุนุงูุฌ ุฃุซูุงุก ุงูุญุงุฏุซ: ูุฌูุฏ ูุฌูุฉ ููุญูุธุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุงู ุงูุฃูุฑ ูุคูููุง ุจุงููุณุจุฉ ูู ุ ูุดุฎุต ูุงู ูุนูู ุนูู ุชุตุญูุญ ุงูุฃุฎุทุงุก ุจุนุฏ ูุฐุง ุงููุงุจูุณ ุ ูุฃุฑู ุฃู ููุญูู ุงููุดุงุท ูุงู ูู ุฃุณููู ุชูุงููุง ุฃุซูุงุก ุงูุญุงุฏุซ.  ูุฐุง ูู ุงูููุช ุงูููุงุณุจ ููุนูู ูุน ุฎุทุงูุงุช ุงูููุจ ุ ุญูุซ ููุฌุฏ ูุฏููุง 20 ูุนุงูุฌ ูุฎุตุต.  ูู ุงูุณุฌูุงุช ุ ุฃุนูู ุฃููู ูุงููุง ุฌููุนูู ูู ุงูุนูู ุ ูุฃุชููุน ุฃู ูููู ุงูููุญูู ูู ุญูุงูู 20 ุซุงููุฉ ุ ูุฑุฃูุช ุฎุทูุง ูุณุชููููุง ุชูุฑูุจูุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ุชุฑู ูุฐู ุงูููุฉ ุงูุฒุฑูุงุก ุงููุจูุฑุฉ ูู ุงูุณุงุนุฉ 16:05ุ  ุงุณุชูุงุฏุง ุฅูู ุงูุฌุฏูู ุงูุฒููู ุ ุฃูุถู 20 ูู ุงููุนุงูุฌุงุช ุฃุญุงุฏูุฉ ุงูุฎููุท 45 ุซุงููุฉ.  ููู ุซุงููุฉ ูู ุงููุดุงุท ุ ูููู ูู ูุฐุง ููููุ! </p><br><h3 id="gde-i-chto-poshlo-ne-tak" style=";text-align:right;direction:rtl">  ุฃูู ููุง ุงูุฎุทุฃ ุงูุฐู ุญุฏุซุ </h3><br><p style=";text-align:right;direction:rtl">  ุงูุฌุฏูู ุงูุฒููู ููุญุงุฏุซ ููุฐุจ: ุฅูู ูุฎูู ูุดุงุท ุงูุนูู ููุธูุฑ ูู ุงูููุช ููุณู ูุง ูุง ูุฒูู ูู - ููุฐุง ูุชููู ุนูู ููุงู ุงูููุงุณ.  ููุนุฑูุฉ ุณุจุจ ุญุฏูุซ ุฐูู ุ ูุฌุจ ุฃู ุชุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุชูููุฐ ุชุชุจุน ุงูููุงููุณ ูููููุฉ ุชูุงุนููุง ูุน ููุงุณุงุช ุฌูุน Prometheus. </p><br><p style=";text-align:right;direction:rtl">  ุจุฏุกูุง ูู ููููุฉ ููุงู ุงููุนุงูุฌุงุช ุจุฌูุน ุงูููุงููุณ ุ ููููู ูุถุน ูุฎุทุท ุชูุฑูุจู ูุชุทุจูู ุณูุฑ ุงูุนูู (ุงูุธุฑ ุฃุฏูุงู).  ููุงุญุธุฉ: ูููู ุงููุนุงูุฌูู ุจุชุญุฏูุซ ุงูููุงููุณ <em>ููุท ุนูุฏ ุงูุงูุชูุงุก ูู ุงููููุฉ</em> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">class Worker JobWorkedSecondsTotal = Prometheus::Client::Counter.new(...) def work job = acquire_job start = Time.monotonic_now job.run ensure # run after our main method block duration = Time.monotonic_now - start JobWorkedSecondsTotal.increment(by: duration, labels: { job: job.class }) end end</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ุจุฑูููุซููุณ (ูุน ููุณูุชูุง ูู ุงุณุชุฎุฑุงุฌ ุงูููุงููุณ) ุจุฅุฑุณุงู ุทูุจ GET ุฅูู ูู ูุนุงูุฌ ูู 15 ุซุงููุฉ ุ ูุน ุชุณุฌูู ููู ุงูููุงููุณ ูู ููุช ุงูุทูุจ.  ูููู ุงููุนุงูุฌูู ุจุงุณุชูุฑุงุฑ ุจุชุญุฏูุซ ููุงููุณ ุงูููุงู ุงูููุชููุฉ ุ ูุจูุฑูุฑ ุงูููุช ูููููุง ุนุฑุถ ุฏููุงููููุงุช ุงูุชุบููุฑุงุช ูู ุงูููู ุจูุงููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุชุจุฏุฃ ูุดููุฉ ููุต ุงููููุฉ ูุฅุนุงุฏุฉ ุงูุชูููู ูู ุงูุธููุฑ ูููุง ุชุฌุงูุฒ ุงูููุช ุงููุณุชุบุฑู ูุฅููุงู ุงููููุฉ ููุช ุงูุชุธุงุฑ ุทูุจ ูุตู ูู 15 ุซุงููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุชุจุฏุฃ ุงููููุฉ ูุจู 5 ุซูุงูู ูู ุงูุทูุจ ูุชูุชูู ุจุนุฏ ุซุงููุฉ ูุงุญุฏุฉ.  ุจุดูู ุนุงู ูุนููููุง ุ ุชุณุชุบุฑู 6 ุซูุงูู ุ ููู ูุฐู ุงููุฑุฉ ุชููู ูุฑุฆูุฉ ููุท ุนูุฏ ุชูุฏูุฑ ุชูุงููู ุงูููุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง ุจุนุฏ ุงูุทูุจ ุ ูู ุญูู ุชู ุฅููุงู 5 ูู ูุฐู ุงูุซูุงูู ุงูุณุช ูุจู ุงูุทูุจ. </p><br><p style=";text-align:right;direction:rtl">  ุชุธู ุงููุคุดุฑุงุช ุฃูุซุฑ ุฅููุงููุง ุฅุฐุง ุงุณุชุบุฑูุช ุงูููุงู ููุชูุง ุฃุทูู ูู ูุชุฑุฉ ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ (15 ุซุงููุฉ) ุ ูุฎูุงู ุชูููุฐ ุงููููุฉ ููุฏุฉ ุฏูููุฉ ูุงุญุฏุฉ ุ ุณูููู ูุฏู ุจุฑูููุซููุณ ุงูููุช ูุฅุฑุณุงู 4 ุทูุจุงุช ุฅูู ุงููุนุงูุฌุงุช ุ ูููู ุณูุชู ุชุญุฏูุซ ุงููููุงุณ ููุท ุจุนุฏ ุงูุฑุงุจุน. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฑุณู ุฌุฏูู ุฒููู ููุดุงุท ุงูุนูู ุ ุณูุฑู ููู ุชุคุซุฑ ุงููุญุธุฉ ุงูุชู ูุชู ูููุง ุชุญุฏูุซ ุงููููุงุณ ุนูู ูุง ูุฑุงู Prometheus.  ูู ุงูุฑุณู ุงูุจูุงูู ุฃุฏูุงู ุ ูููู ุจุชูุณูู ุงูุฌุฏูู ุงูุฒููู ูุนุงูููู ุฅูู ุนุฏุฉ ูุทุงุนุงุช ุชุนุฑุถ ููุงู ุจูุฏุฏ ูุฎุชููุฉ.  ุชุดูุฑ ุงูุนูุงูุงุช ุงูุญูุฑุงุก (15 ุซุงููุฉ) ูุงูุฃุฒุฑู (30 ุซุงููุฉ) ุฅูู ุนููุชูู ูู ุจูุงูุงุช ุจุฑูููุซููุณ ุ  ูุชู ุชูููุฒ ุงูููุงู ุงูุชู ูุงูุช ุจูุซุงุจุฉ ูุตุฏุฑ ุจูุงูุงุช ููุชูููู ุจุงูุฃููุงู ุ ุนูู ุงูุชูุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ph/lc/z6/phlcz67lq7o3tpar3vgibp71h9o.png"></p><br><p style=";text-align:right;direction:rtl">  ุจุบุถ ุงููุธุฑ ุนู ูุง ูููู ุจู ุงููุงุฆููู ุนูู ุงูุชุญููู ุจูุงูู ุทุงูุชูู ุ ุณูููููู ุจุนูู 30 ุซุงููุฉ ูู ูุงุตู ุฒููู ูุฏุชู 15 ุซุงููุฉ.  ูุธุฑูุง ูุฃู Prometheus ูุง ุชุฑู ุงูุนูู ุญุชู ูุชู ุงูุงูุชูุงุก ููู ุ ุจูุงุกู ุนูู ุงูููุงููุณ ุ ุชู ุฅููุงู 14 ุซุงููุฉ ูู ุงูุนูู ูู ุงููุชุฑุฉ ุงูุฒูููุฉ ุงูุฃููู ู 42 ุซุงููุฉ ูู ุงูุซุงููุฉ.  ุฅุฐุง ุชููู ูู ูุนุงูุฌ ูููุฉ ุถุฎูุฉ ุ ุญุชู ุจุนุฏ ูุฑูุฑ ุจุถุน ุณุงุนุงุช ุ ูุญุชู ุงูููุงูุฉ ุ ููู ูุฑู ุชูุงุฑูุฑ ุชููุฏ ุจุฃู ุงูุนูู ูุณุชูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุฅุซุจุงุช ูุฐุง ุงูุชุฃุซูุฑ ุ ุฃุฌุฑูุช ุชุฌุฑุจุฉ ูุน ุนุดุฑุฉ ููุงููู ุงูุนูู ูู ููุงู ูุฎุชููุฉ ุทูููุง ูุชูุฒุน ุดุจู ุทุจูุนูุฉ ุจูู 0.1 ุซุงููุฉ ููููุฉ ุฃุนูู ููููุงู (ุงูุธุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงู ุงูุนุดูุงุฆูุฉ</a> ).  ูููุง ููู 3 ุฑุณูู ุจูุงููุฉ ุชุตูุฑ ูุดุงุท ุงูุนูู ุ  ูุธูุฑ ุทูู ูู ุงูููุช ูู ุชุฑุชูุจ ูุชุฒุงูุฏ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6o/bx/jh/6obxjhklfq8sxwhdbjrzpnsgcmm.png"><br>  <em>ููุงู ุชุฏูู ุญุชู 1 ุซุงููุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ููุถุญ ุงูุฑุณู ุงูุจูุงูู ุงูุฃูู ุฃู ูู ูุนุงูุฌ ููู ุจุญูุงูู ุซุงููุฉ ูุงุญุฏุฉ ูู ุงูุนูู ูู ูู ุซุงููุฉ ูู ุงูููุช - ููุฐุง ูุฑุฆู ุนูู ุงูุฎุทูุท ุงููุณุทุญุฉ ุ ูููุฏุงุฑ ุฅุฌูุงูู ุงูุนูู ูุณุงูู ููุฏุฑุงุชูุง (10 ูู ูุนุงูุฌูู ูุนุทูู ุซุงููุฉ ูู ุงูุนูู ูู ุงูุซุงููุฉ ูู ุงูููุช).  ูู ุงููุงูุน ุ ูุฐุง ุ ุจุตุฑู ุงููุธุฑ ุนู ุทูู ุงููููุฉ ุ ูุชููุนู: ุนูู ุงููุซูุฑ ูู ุงูููุงู ุงููุตูุฑุฉ ูุงูุทูููุฉ ุ ููุจุบู ุฅุนุทุงุก ุงููุนุงูุฌุงุช ุฐุงุช ุงูุฃุญูุงู ุงูุซุงุจุชุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/x-/lj/zp/x-ljzpfv-jdybqpk-osmcfd3rui.png"><br>  <em>ููุงู ุชุฏูู ุญุชู 15 ุซุงููุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ุชุฒุฏุงุฏ ูุฏุฉ ุงูููุงู ุ ูุชุธูุฑ ููุถู ูู ุงูุฌุฏูู: ูุง ูุฒุงู ูุฏููุง 10 ูุนุงูุฌุงุช ุ ูููุง ูุดุบููุฉ ุจุงููุงูู ุ ููู ุฅุฌูุงูู ุนุฏุฏ ุนูููุงุช ุชุฎุทู ุงูุนูู - ุฅูุง ุฃูู ุฃู ุฃุนูู ูู ุญุฏูุฏ ุงูุณุนุฉ ุงููููุฏุฉ (10 ุซูุงูู). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/uo/cc/mh/uoccmht2erjrgjywbvlo7sn6-tk.png"><br>  <em>ููุงู ุชุฏูู ุญุชู 30 ุซุงููุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ุชูููู ุงูุฃุนูุงู ุงูุชู ุชุฏูู ุญุชู 30 ุซุงููุฉ ุฃูุฑ ูุซูุฑ ููุณุฎุฑูุฉ ุจูู ุจุณุงุทุฉ.  ููุธูุฑ ุงููููุงุณ ุงููุฑุชุจุท ุฒูููุงู ุฃู ูุดุงุท ุตูุฑู ูุฃุทูู ุงูููุงู ุ ูููุท ุนูุฏ ุงูุชูุงู ุงูููุงู ุ ูุฑุณููุง ููู ุงููุดุงุท. </p><br><h3 id="vosstanovim-doverie" style=";text-align:right;direction:rtl">  ุงุณุชุนุงุฏุฉ ุงูุซูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ููู ูุงููุงู ุจุงููุณุจุฉ ููุง ุ ูุฐูู ููุงู ูุดููุฉ ุฃุฎุฑู ุฃูุซุฑ ุบุฏุฑุงู ูุน ูุฐู ุงูููุงู ุงูุทูููุฉ ุงูุฃุฌู ุงูุชู ุชูุณุฏ ููุงุณุงุชูุง.  ุนูุฏูุง ูุชู ุฅููุงู ูููุฉ ุทูููุฉ ุงูุฃุฌู - ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช Kubernetes ุจุฅููุงุก ุฌุฑุงุจ ูู ูุฌููุนุฉ ุ ุฃู ุนูุฏ ููุงุฉ ุนูุฏุฉ - ููุง ุงูุฐู ูุญุฏุซ ููููุงููุณุ  ูุฌุฏุฑ ุชุญุฏูุซูุง ููุฑ ุงูุงูุชูุงุก ูู ุงููููุฉ ุ ูุฃููุง ุชุธูุฑ <strong>ุฃููุง ูู ุชูู</strong> ุจุงูุนูู <strong>ุนูู ุงูุฅุทูุงู</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุง ุชูุฐุจ ุงูููุงููุณ.  ุงูููุจููุชุฑ ุงููุญููู ูุนูู ุจุดูู ูุง ูุตุฏู ุ ููุง ุชุณุจุจ ูู ุฑุนุจ ูุฌูุฏู ุ ูุฃุฏูุงุช ุงููุฑุงูุจุฉ ุงูุชู ุชุดูู ุตูุฑุฉ ุงูุนุงูู ูู ูุฎ ูุบูุฑ ููุงุณุจุฉ ููุนูู. </p><br><p style=";text-align:right;direction:rtl">  ูุญุณู ุงูุญุธ ุ ุงูุฃูุฑ ูุงุจู ููุชุซุจูุช.  ูุญุฏุซ ุชุดููู ุงูุจูุงูุงุช ูุฃู Prometheus ูุฃุฎุฐ ุงูููุงุณุงุช ุจุบุถ ุงููุธุฑ ุนู ููุช ุชุญุฏูุซ ุงููุนุงูุฌุงุช ููููุงุณุงุช.  ุฅุฐุง ุทูุจูุง ูู ุงููุนุงูุฌุงุช ุชุญุฏูุซ ุงูููุงููุณ ุนูุฏูุง ูุฑุณู ุจุฑูููุซููุณ ุงูุทูุจุงุช ุ ูุณูุฑู ุฃู ุจุฑูููุซููุณ ูู ุชุนุฏ ููุชููุฉ ููุธูุฑ ุงููุดุงุท ุงูุญุงูู. </p><br><h3 id="predstavlyaem-tracer" style=";text-align:right;direction:rtl">  ุชูุฏูู ... ุงูุชุชุจุน </h3><br><p style=";text-align:right;direction:rtl">  ุฃุญุฏ ุงูุญููู ููุดููุฉ ุงูููุงููุณ ุงููุดููุฉ ูู <code>Tracer</code> ุ ููู ุญู ุชู ุชุตูููู ุจุดูู ุชุฌุฑูุฏู ูููู ุจุชูููู ุงููุดุงุท ูู ุงูููุงู ุงูุทูููุฉ ุงูุฃูุฏ ูู ุฎูุงู ุชุญุฏูุซ ุงูููุงููุณ ุงููุชุนููุฉ ุจุฑูููุซููุณ ุจุดูู ุชุฏุฑูุฌู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">class Tracer def trace(metric, labels, &amp;block) ... end def collect(traces = @traces) ... end end</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููุฑ ุฃุฏูุงุช ุงูุชุชุจุน ุทุฑููุฉ ุชุชุจุน ุชุฃุฎุฐ ููุงููุณ Prometheus ููููุฉ ุงูุชุชุจุน.  ุณูููู ุฃูุฑ <code>trace</code> ุจุชูููุฐ ุงููุชูุฉ ุงููุนุทุงุฉ (ูุธุงุฆู Ruby ุงููุฌูููุฉ) ููุถูู ุฃู ุทูุจุงุช <code>tracer.collect</code> ุฃุซูุงุก ุงูุชูููุฐ ุณุชููู ุจุชุญุฏูุซ ุงูููุงููุณ ุฐุงุช ุงูุตูุฉ ุจุดูู ูุชุฒุงูุฏ ุ ุจุบุถ ุงููุธุฑ ุนู ููุฏุงุฑ ุงูููุช ุงูุฐู ุงููุถู ููุฐ ุขุฎุฑ ุทูุจ <code>collect</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฅูู ุชูุตูู ุฌูุงุฒ <code>tracer</code> ูู ุฃุฌู ุชุชุจุน ูุฏุฉ ุงููููุฉ ูููุทุฉ ุงูููุงูุฉ ุงูุชู ุชุฎุฏู ุทูุจุงุช ููุงุณ Prometheus.  ูุจุฏุฃ ูุน ุงููุนุงูุฌุงุช ุ ูุจุฏุฃ ูู ุฅุนุฏุงุฏ ุชุชุจุน ุฌุฏูุฏ ููุทูุจ ููู ุชุชุจุน <code>acquire_job.run</code> ุงูุชูููุฐ ูู <code>acquire_job.run</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">class Worker def initialize @tracer = Tracer.new(self) end def work @tracer.trace(JobWorkedSecondsTotal, labels) { acquire_job.run } end # Tell the tracer to flush (incremental) trace progress to metrics def collect @tracer.collect end end</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ุณูููู ุจุฑูุงูุฌ ุงูุชุชุจุน ููุท ุจุชุญุฏูุซ ุงูููุงููุณ ุจุงูุซูุงูู ุงูุชู ุชู ุฅููุงููุง ุนูู ุงููููุฉ ุงูููุชููุฉ - ููุง ูุนููุง ูู ุงูุชูููุฐ ุงูุฃููู ููููุงููุณ.  ูุฌุจ ุฃู ูุทูุจ ูู tracer ุชุญุฏูุซ ููุงููุณูุง ูุจู ุชูููุฐ ุทูุจ ูู Prometheus.  ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุฅุนุฏุงุฏ ุงูุฑู ุงููุณูุทุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># config.ru # https://rack.github.io/ class WorkerCollector def initialize(@app, workers: @workers); end def call(env) workers.each(&amp;:collect) @app.call(env) # call Prometheus::Exporter end end # Rack middleware DSL workers = start_workers # Array[Worker] # Run the collector before serving metrics use WorkerCollector, workers: workers use Prometheus::Middleware::Exporter</code> </pre> <br><p style=";text-align:right;direction:rtl">  Rack ูู ูุงุฌูุฉ ูุฎูุงุฏู ุงูููุจ ูู Ruby ุชุชูุญ ูู ุงูุฌูุน ุจูู ูุนุงูุฌุงุช Rack ูุชุนุฏุฏุฉ ูู ููุทุฉ ููุงูุฉ ูุงุญุฏุฉ.  <code>config.ru</code> ุงูุฃูุฑ <code>config.ru</code> ุฃู ุชุทุจูู Rack - ุนูุฏูุง ูุชููู ุงูุทูุจ - ูุฑุณู ุฃูุฑ ุงูุชุฌููุน ุฅูู ูุนุงูุฌุงุช ุฃููุงู ุ ูุนูุฏูุง ููุท ูุฎุจุฑ ุนููู Prometheus ุจุฑุณู ูุชุงุฆุฌ ุงููุฌููุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู ุงูุฑุณู ุงูุจูุงูู ูุฏููุง ุ ูููู ุจุชุญุฏูุซ ุงูููุงููุณ ูููุง ุงูุชููุช ุงููููุฉ ุฃู ุนูุฏูุง ูุชููู ุทูุจูุง ููููุงููุณ.  ุชููู ุงูููุงู ุงูุชู ููุง ุนุฏุฉ ุงุณุชุนูุงูุงุช ุจุฅุฑุณุงู ุงูุจูุงูุงุช ุนูู ูุฏู ุงููุณุงูุงุฉ ุนูู ุฌููุน ุงููุทุงุนุงุช: ููุง ูู ููุถุญ ุจุงูููุงู ุงูุชู ุชู ุชูุณูู ูุฏุชูุง ุฅูู ููุงุตู ุฒูููุฉ ูุฏุชูุง 15 ุซุงููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/v3/p-/ve/v3p-vekym_g0w_cnamhqxfsaaya.png"></p><br><h3 id="luchshe-li-eto" style=";text-align:right;direction:rtl">  ูู ูู ุฃูุถูุ </h3><br><p style=";text-align:right;direction:rtl">  ูุคุซุฑ ุงุณุชุฎุฏุงู ุงูุชุชุจุน ุนูู ูุฏุงุฑ 24 ุณุงุนุฉ ูููููุง ูู ููููุฉ ุชุณุฌูู ุงููุดุงุท.  ุนูู ุนูุณ ุงูููุงุณุงุช ุงูุฃูููุฉ ุ ุงูุชู ุฃุธูุฑุช "ููุดุงุฑูุง" ุ ุนูุฏูุง ุชุฌุงูุฒ ุนุฏุฏ ุงูููู ุนุฏุฏ ุงููุนุงูุฌุงุช ููุฏ ุงูุชุดุบูู ููุชุฑุงุช ุงูุตูุช ุงูุจุงูุช ุ ุชููุฑ ุงูุชุฌุฑุจุฉ ูุน ุนุดุฑุฉ ูุนุงูุฌุงุช ุฑุณููุง ุจูุงูููุง ููุถุญ ุจูุถูุญ ุฃู ูู ูุนุงูุฌ ูุถูู ูู ุงูุนูู ุงูุฐู ุชุชู ูุฑุงูุจุชู ุจุงูุชุณุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/a5/ng/lj/a5ngljwtmc1ppqxlpwjqdx98_eu.png"><br>  <em>ุงูููุงููุณ ูุจููุฉ ุนูู ุงูููุงุฑูุฉ (ูุณุงุฑ) ูุงูุชุญูู ูููุง ุจูุงุณุทุฉ ุงูุชุชุจุน (ูููู) ุ ูุฃุฎูุฐุฉ ูู ุชุฌุฑุจุฉ ุนูู ูุงุญุฏุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ููุงุฑูุฉ ุจุงูุฌุฏูู ุงูุฒููู ุบูุฑ ุงูุฏููู ูุงูููุถูู ููููุงุณุงุช ุงูุฃูููุฉ ุ ูุฅู ุงูููุงููุณ ุงูุชู ุชู ุฌูุนูุง ุจูุงุณุทุฉ ุงูุชุชุจุน ูุชุฌุงูุณุฉ ููุชุณูุฉ.  ูุญู ุงูุขู ูุง ูุฑุจุท ุงูุนูู ุจุฏูุฉ ุจูู ุทูุจ ููุงุณ ุ ููููุง ุฃูุถูุง ูุง ูุฎุดู ุงูููุช ุงูููุงุฌุฆ ูุฃู ูู ุงููุนุงูุฌูู: ุชููู ุจุฑูููุซููุณ ุจุชุณุฌูู ุงูููุงููุณ ุญุชู ูุฎุชูู ุงููุนุงูุฌ ุ ูุชูููู ูู ุฃุนูุงูู. </p><br><h3 id="mozhno-li-eto-ispolzovat" style=";text-align:right;direction:rtl">  ูู ูููู ุงุณุชุฎุฏุงู ูุฐุงุ </h3><br><p style=";text-align:right;direction:rtl">  ูุนู!  ููุฏ ุฃุซุจุชุช ูุงุฌูุฉ <code>Tracer</code> ุฃููุง ูููุฏุฉ ุจุงููุณุจุฉ ูู ูู ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน ุ ูุฐุง ููู ุฌููุฑุฉ Ruby ูููุตูุฉ ุ ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">prometheus-tracer</a> .  ุฅุฐุง ููุช ุชุณุชุฎุฏู ุนููู Prometheus ูู ุชุทุจููุงุช Ruby ุงูุฎุงุตุฉ ุจู ุ ููุง ุนููู ุณูู ุฅุถุงูุฉ <code>prometheus-client-tracer</code> ุฅูู Gemfile: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">require "prometheus/client" require "prometheus/client/tracer" JobWorkedSecondsTotal = Prometheus::Client::Counter.new(...) Prometheus::Client.trace(JobWorkedSecondsTotal) do sleep(long_time) end</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฐุง ูููุฏูุง ูู ูุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูุธูุฑ ุนููู Prometheus Ruby ุงูุฑุณูู ูู <code>Tracer</code> ุ ูุงุชุฑู ูุฑุงุฌุนุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">client_ruby # 135</a> . </p><br><h3 id="nu-i-naposledok-koe-kakie-mysli" style=";text-align:right;direction:rtl">  ูุฃุฎูุฑุง ุ ุจุนุถ ุงูุฃููุงุฑ </h3><br><p style=";text-align:right;direction:rtl">  ุขูู ุฃู ูุณุงุนุฏ ุฐูู ุงูุขุฎุฑูู ูู ุฌูุน ุงูููุงููุณ ุจูุนู ุฃูุซุฑ ููููุงู ุจุงูููุงู ุงูุทูููุฉ ุงูุฃูุฏ ูุญู ุฅุญุฏู ุงููุดุงูู ุงูุดุงุฆุนุฉ.  ูุง ุชุฎุทุฆ ุ ููู ูุฑุชุจุท ููุณ ููุท ุจุงููุนุงูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ: ุฅุฐุง ุชู ุฅุจุทุงุก ุทูุจุงุช HTTP ุงูุฎุงุตุฉ ุจู ุ ูุณูู ุชุณุชููุฏ ุฃูุถูุง ูู ุงุณุชุฎุฏุงู ุงูุชุชุจุน ุนูุฏ ุชูููู ุงูููุช ุงูุฐู ุชุณุชุบุฑูู ุงููุนุงูุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุนุงุฏุฉ ุ ุฃู ุชุนูููุงุช ูุชุตุญูุญุงุช ูู ููุถุน ุชุฑุญูุจ: ุงููุชุงุจุฉ ุฅูู ุชููุชุฑ ุฃู <a href="">ูุชุญ ุงูุนูุงูุงุช ุงูุนุงูุฉ</a> .  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงููุณุงููุฉ ูู ุฌููุฑุฉ ุงูุชุชุจุน ุ ูุฅู ุงูููุฏ ุงููุตุฏุฑู ููุฌูุฏ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">prometheus-client-tracer-ruby</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar470133/">https://habr.com/ru/post/ar470133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar470121/index.html">ุดุฑูุฉ ูุฏุงุฑุณ ุงูุจุฑูุฌุฉ ุฃู ููููุฉ ุฅุฏุฎุงู ุชูููููุฌูุง ุงููุนูููุงุช</a></li>
<li><a href="../ar470123/index.html">Yandex.Money ูุฎ ูุงูู</a></li>
<li><a href="../ar470125/index.html">ูุง ุชุญูู ุนูู ุฑูุฒ ุดุฎุต ุขุฎุฑ ุจุฏูุฉ</a></li>
<li><a href="../ar470127/index.html">ููุญู ูุน ุฐุงูุฑุฉ ุทูููุฉ ุงูุฃุฌู</a></li>
<li><a href="../ar470129/index.html">ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ุงูุชุนุฑููู</a></li>
<li><a href="../ar470139/index.html">2 ุงุฎุชุฑุงู ุงูุญูุงุฉ: ุจุฏุงุฆู ููุจุญุซ ุงูููุงุณููู ูู Microsoft SQL Server</a></li>
<li><a href="../ar470145/index.html">"ุงุญุฐุฑ ุ FAS!": ููุงุฐุง ุชุนุชุจุฑ ุงูุชุฐุงูุฑ ุงูุนุณูุฑูุฉ ุฎุทุฑุฉ ูู ุงูุฅุนูุงู ุ ููุงุฐุง ูู ุงูููู ูุนุฑูุฉ ุงูุฑูุงุถูุงุช ููุง ุฅุฐุง ูุงูุช ููุงู ุญุงุฌุฉ ุฏุงุฆููุง ุฅูู ุงูุญูููุฉ ุงููุฌุฑุฏุฉ</a></li>
<li><a href="../ar470149/index.html">ูู ุชููู ููุงู ูุฌููุนุงุช ุซุงุจุชุฉ ูู Java - ูุง ุงูุขู ููุง ุนูู ุงูุฅุทูุงู</a></li>
<li><a href="../ar470153/index.html">ูุงููุณ ูููุฐุฌ ุงูุจูุงูุงุช</a></li>
<li><a href="../ar470155/index.html">ููุฒุงุช ุงูุชุนุฑู ุนูู ุงูุฃููุงุท ุงููุทููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>