<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ”¬ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ‘ ååº”ï¼šæå‡çŠ¶æ€å°†æ€æ­»æ‚¨çš„åº”ç”¨ç¨‹åº ğŸ§šğŸ¼ ğŸ“« ğŸ‘©ğŸ¼â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ‚¨å¬è¯´è¿‡â€œæèµ·å›½å®¶â€å—ï¼Ÿ æˆ‘æƒ³ä½ æœ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åœ¨è¿™é‡Œã€‚ Reactå®˜æ–¹æ–‡æ¡£ä¸­åˆ—å‡ºçš„12ä¸ªä¸»è¦æ¦‚å¿µä¹‹ä¸€å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™å—ï¼Ÿ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å®é™…æƒ…å†µã€‚ 
 æ­¥éª¤1ï¼šæèµ· 


 æˆ‘å»ºè®®æ‚¨åˆ›å»ºä¸€ä¸ªç®€å•çš„äº•å­—æ¸¸æˆã€‚ å¯¹äºæ¸¸æˆï¼Œæˆ‘ä»¬éœ€è¦ï¼š 


- ä¸€äº›æ¸¸æˆçŠ¶æ€ã€‚ æ²¡æœ‰çœŸæ­£çš„æ¸¸æˆé€»è¾‘æ¥æ‰¾å‡ºæˆ‘ä»¬æ˜¯è¾“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ååº”ï¼šæå‡çŠ¶æ€å°†æ€æ­»æ‚¨çš„åº”ç”¨ç¨‹åº</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471300/"><p><img src="https://habrastorage.org/webt/gd/9i/zn/gd9iznyftdnoffeagz18yy8aqeu.jpeg" alt="å°é¢"></p><br><p> æ‚¨å¬è¯´è¿‡â€œæèµ·å›½å®¶â€å—ï¼Ÿ æˆ‘æƒ³ä½ æœ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åœ¨è¿™é‡Œã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reactå®˜æ–¹æ–‡æ¡£ä¸­åˆ—å‡ºçš„12ä¸ªä¸»è¦æ¦‚å¿µä¹‹ä¸€</a>å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™å—ï¼Ÿ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å®é™…æƒ…å†µã€‚ </p><a name="habracut"></a><br><h2 id="step-1-lift-it-up"> æ­¥éª¤1ï¼šæèµ· </h2><br><p> æˆ‘å»ºè®®æ‚¨åˆ›å»ºä¸€ä¸ªç®€å•çš„äº•å­—æ¸¸æˆã€‚ å¯¹äºæ¸¸æˆï¼Œæˆ‘ä»¬éœ€è¦ï¼š </p><br><ul><li><p>ä¸€äº›æ¸¸æˆçŠ¶æ€ã€‚ æ²¡æœ‰çœŸæ­£çš„æ¸¸æˆé€»è¾‘æ¥æ‰¾å‡ºæˆ‘ä»¬æ˜¯è¾“æ˜¯èµ¢ã€‚ åªæ˜¯ä¸€ä¸ªç®€å•çš„äºŒç»´æ•°ç»„ï¼Œå…¶ä¸­å¡«å……äº†<code>undefined</code> ï¼Œ <code>"x"</code>æˆ–<code>"0".</code> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> size = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">// Two-dimensional array (size * size) filled with `undefined`. Represents an empty field. const initialField = new Array(size).fill(new Array(size).fill(undefined))</span></span></code> </pre> <br></li><li><p> ä¸€ä¸ªçˆ¶å®¹å™¨æ¥æ‰˜ç®¡æˆ‘ä»¬çš„æ¸¸â€‹â€‹æˆçŠ¶æ€ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [field, setField] = useState(initialField) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; {field.map((row, rowI</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {row.map((cell, cellI) =&gt; ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cell}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">setContent</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Update</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">single</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cell</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">two-dimensional</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">array</span></span></span></span><span class="xml"><span class="hljs-tag"> // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">and</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">new</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">two</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dimensional</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">array</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">newContent</span></span></span></span><span class="xml"><span class="hljs-tag">) =&gt;</span></span></span><span class="xml"> setField([ // Copy rows before our target row ...field.slice(0, rowI), [ // Copy cells before our target cell ...field[rowI].slice(0, cellI), newContent, // Copy cells after our target cell ...field[rowI].slice(cellI + 1), ], // Copy rows after our target row ...field.slice(rowI + 1), ]) } /&gt; ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) }</code> </pre> <br></li><li><p> æ˜¾ç¤ºå•ä¸ªå•å…ƒæ ¼çŠ¶æ€çš„å­ç»„ä»¶ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> randomContent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? <span class="hljs-string"><span class="hljs-string">'x'</span></span> : <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ content, setContent }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> setContent(randomContent())}&gt;{content}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> )</code> </pre> <br></li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ1</a> </p><br><p> åˆ°ç›®å‰ä¸ºæ­¢çœ‹èµ·æ¥è¿˜ä¸é”™ã€‚ æ‚¨å¯ä»¥ä»¥å…‰é€Ÿäº¤äº’çš„å®Œç¾ååº”åœºï¼š)è®©æˆ‘ä»¬å¢å¤§å°ºå¯¸ã€‚ å‡è®¾æ˜¯100ã€‚æ˜¯çš„ï¼Œæ˜¯æ—¶å€™å•å‡»è¯¥æ¼”ç¤ºé“¾æ¥å¹¶åœ¨æœ€é¡¶éƒ¨æ›´æ”¹<code>size</code>å˜é‡äº†ã€‚ è¿˜æ˜¯ä¸ºæ‚¨å¿«é€Ÿï¼Ÿ å°è¯•200æˆ–ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Chromeå†…ç½®çš„CPUèŠ‚æµ</a> ã€‚ æ‚¨ç°åœ¨çœ‹åˆ°å•å‡»å•å…ƒæ ¼çš„æ—¶é—´å’Œå…¶å†…å®¹æ›´æ”¹çš„æ—¶é—´ä¹‹é—´æœ‰å¾ˆå¤§çš„æ»åå—ï¼Ÿ </p><br><p> è®©æˆ‘ä»¬å°†<code>size</code>æ›´æ”¹å›10ï¼Œå¹¶æ·»åŠ ä¸€äº›é…ç½®æ–‡ä»¶ä»¥è°ƒæŸ¥åŸå› ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ content, setContent }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell rendered'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> setContent(randomContent())}&gt;{content}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ2</a> </p><br><p> æ˜¯çš„ï¼Œå°±æ˜¯è¿™æ ·ã€‚ åªè¦åœ¨æ¯ä¸ªæ¸²æŸ“å™¨ä¸Šè¿è¡Œï¼Œç®€å•çš„<code>console.log</code>å°±è¶³å¤Ÿäº†ã€‚ </p><br><p> é‚£æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ æ ¹æ®æ§åˆ¶å°ä¸­â€œå•å…ƒæ ¼æ¸²æŸ“â€è¯­å¥çš„æ•°é‡ï¼ˆå¯¹äº<code>size</code> = Nï¼Œåº”ä¸ºNï¼‰ï¼Œä¼¼ä¹æ¯æ¬¡å•ä¸ªå•å…ƒæ ¼æ›´æ”¹æ—¶éƒ½ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ªå­—æ®µã€‚ </p><br><p> æœ€æ˜æ˜¾çš„äº‹æƒ…æ˜¯æŒ‰ç…§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reactæ–‡æ¡£çš„å»ºè®®</a>æ·»åŠ ä¸€äº›å¯†é’¥ã€‚ </p><br><pre> <code class="javascript hljs">&lt;div&gt; {field.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">row, rowI</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{rowI}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {row.map((cell, cellI) =&gt; ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">row</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rowI</span></span></span></span><span class="xml"><span class="hljs-tag">}</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cell</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellI</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cell}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">setContent</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(newContent)</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> setField([ ...field.slice(0, rowI), [ ...field[rowI].slice(0, cellI), newContent, ...field[rowI].slice(cellI + 1), ], ...field.slice(rowI + 1), ]) } /&gt; ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ3</a> </p><br><p> ä½†æ˜¯ï¼Œå†æ¬¡å¢å¤§<code>size</code>åï¼Œæˆ‘ä»¬å‘ç°è¯¥é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚ åªè¦èƒ½çœ‹æ¸…ä¸ºä»€ä¹ˆè¦æ¸²æŸ“ä»»ä½•ç»„ä»¶â€¦â€¦å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æƒŠäººçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">React DevToolsçš„</a>å¸®åŠ©ä¸‹è·å¾—å¸®åŠ©ã€‚ å®ƒèƒ½å¤Ÿè®°å½•ä¸ºä»€ä¹ˆæ¸²æŸ“ç»„ä»¶ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨å¯ç”¨å®ƒã€‚ </p><br><p><img src="https://habrastorage.org/webt/36/ms/b4/36msb4eskbqe6txnqv5j3phjfda.png" alt="React DevToolsè®¾ç½®"></p><br><p> å¯ç”¨åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰å•å…ƒéƒ½è¢«é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºå®ƒä»¬çš„é“å…·å‘ç”Ÿäº†å˜åŒ–ï¼Œç‰¹åˆ«æ˜¯<code>setContent</code>é“å…·ã€‚ </p><br><p><img src="https://habrastorage.org/webt/nv/3o/on/nv3oon4uvu6om8oea4fnnaun8m4.png" alt="React DevToolsæŠ¥å‘Šï¼ƒ1"></p><br><p> æ¯ä¸ªå•å…ƒéƒ½æœ‰ä¸¤ä¸ªé“å…·ï¼š <code>content</code>å’Œ<code>setContent</code> ã€‚ å¦‚æœå•å…ƒæ ¼[0] [0]æ›´æ”¹ï¼Œåˆ™å•å…ƒæ ¼[0] [1]çš„å†…å®¹ä¸å˜ã€‚ å¦ä¸€æ–¹é¢ï¼Œ <code>setContent</code>åœ¨å…¶é—­åŒ…ä¸­æ•è·<code>field</code> ï¼Œ <code>cellI</code>å’Œ<code>rowI</code> ã€‚  <code>cellI</code>å’Œ<code>rowI</code>ä¿æŒä¸å˜ï¼Œä½†æ˜¯<code>field</code>éšä»»ä½•å•å…ƒæ ¼çš„æ¯æ¬¡æ›´æ”¹è€Œæ”¹å˜ã€‚ </p><br><p> è®©æˆ‘ä»¬é‡æ„æˆ‘ä»¬çš„ä»£ç ï¼Œå¹¶ä¿æŒ<code>setContent</code>ä¸å˜ã€‚ </p><br><p> ä¸ºäº†ä½¿å¯¹<code>setContent</code>çš„å¼•ç”¨ç›¸åŒï¼Œæˆ‘ä»¬åº”è¯¥åˆ é™¤é—­åŒ…ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿<code>Cell</code>æ˜¾å¼åœ°å°†<code>cellI</code>å’Œ<code>rowI</code>ä¼ é€’ç»™<code>setContent</code>æ¥æ¶ˆé™¤<code>cellI</code>å’Œ<code>rowI</code>é—­åŒ…ã€‚ å¯¹äº<code>field</code> ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>setState</code>çš„ç®€æ´åŠŸèƒ½- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®ƒæ¥å—å›è°ƒ</a> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [field, setField] = useState(initialField) <span class="hljs-comment"><span class="hljs-comment">// `useCallback` keeps reference to `setCell` the same. const setCell = useCallback( (rowI, cellI, newContent) =&gt; setField((oldField) =&gt; [ ...oldField.slice(0, rowI), [ ...oldField[rowI].slice(0, cellI), newContent, ...oldField[rowI].slice(cellI + 1), ], ...oldField.slice(rowI + 1), ]), [], )</span></span></code> </pre> <br><p> è¿™ä½¿å¾—<code>App</code>çœ‹èµ·æ¥åƒè¿™æ · </p><br><pre> <code class="javascript hljs">&lt;div&gt; {field.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">row, rowI</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{rowI}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {row.map((cell, cellI) =&gt; ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">row</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rowI</span></span></span></span><span class="xml"><span class="hljs-tag">}</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cell</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellI</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cell}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rowI</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{rowI}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellI</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cellI}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">setContent</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{setCell}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p> ç°åœ¨ï¼Œ <code>Cell</code>å¿…é¡»å°†<code>cellI</code>å’Œ<code>rowI</code>ä¼ é€’ç»™<code>setContent</code> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ content, rowI, cellI, setContent }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> setContent(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ4</a> </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹DevToolsæŠ¥å‘Šã€‚ </p><br><p><img src="https://habrastorage.org/webt/63/i5/po/63i5poiao3t3rt62mr_zubgycjw.png" alt="React DevToolsæŠ¥å‘Šï¼ƒ2"></p><br><p> ä»€ä¹ˆ ä¸ºä»€ä¹ˆè¯´â€œçˆ¶æ¯çš„é“å…·å˜äº†â€ï¼Ÿ æ‰€ä»¥äº‹æƒ…æ˜¯ï¼Œæ¯æ¬¡æˆ‘ä»¬çš„é¢†åŸŸæ›´æ–°æ—¶ï¼Œ <code>App</code>éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚ å› æ­¤ï¼Œå…¶å­ç»„ä»¶å°†è¢«é‡æ–°æ¸²æŸ“ã€‚ å¥½å•¦  stackoverflowæ˜¯å¦è¯´äº†ä¸€äº›æœ‰å…³Reactæ€§èƒ½ä¼˜åŒ–çš„æœ‰ç”¨ä¿¡æ¯ï¼Ÿ  Internetå»ºè®®ä½¿ç”¨<code>shouldComponentUpdate</code>æˆ–å…¶è¿‘äº²ï¼š <code>PureComponent</code>å’Œ<code>memo</code> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = memo(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ content, rowI, cellI, setContent }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> setContent(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) })</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ5</a> </p><br><p> è€¶ ç°åœ¨ï¼Œä¸€æ—¦å…¶å†…å®¹æ›´æ”¹ï¼Œä»…ä¸€ä¸ªå•å…ƒä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚ ä½†æ˜¯ç­‰ç­‰...æœ‰ä»€ä¹ˆæƒŠå–œå—ï¼Ÿ æˆ‘ä»¬éµå¾ªæœ€ä½³å®è·µï¼Œå¹¶è·å¾—äº†é¢„æœŸçš„ç»“æœã€‚ </p><br><p> æœ¬æ¥åº”è¯¥æœ‰ä¸€ä¸ªé‚ªæ¶çš„ç¬‘å£°ã€‚ ç”±äºæˆ‘ä¸åœ¨æ‚¨èº«è¾¹ï¼Œè¯·å°½é‡å°è¯•æƒ³è±¡ä¸€ä¸‹ã€‚ ç»§ç»­å¹¶åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Live demoï¼ƒ5ä¸­</a>å¢åŠ <code>size</code> ã€‚ è¿™æ¬¡ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨æ›´å¤§çš„æ•°å­—ã€‚ ä½†æ˜¯ï¼Œæ»åä»ç„¶å­˜åœ¨ã€‚ ä¸ºä»€ä¹ˆ??? </p><br><p> è®©æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹DebToolsæŠ¥å‘Šã€‚ </p><br><p><img src="https://habrastorage.org/webt/ls/w8/gs/lsw8gsgvp_bnjvnxjramglhrnng.png" alt="React DevToolsæŠ¥å‘Šï¼ƒ3"></p><br><p> åªæœ‰ä¸€ä¸ª<code>Cell</code>æ¸²æŸ“ï¼Œè€Œä¸”é€Ÿåº¦ç›¸å½“å¿«ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ª<code>App</code>æ¸²æŸ“ï¼Œè¿™èŠ±è´¹äº†å¾ˆå¤šæ—¶é—´ã€‚ é—®é¢˜æ˜¯ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“<code>App</code>æ¯ä¸ª<code>Cell</code>éƒ½å¿…é¡»å°†å…¶æ–°é“å…·ä¸ä»¥å‰çš„é“å…·è¿›è¡Œæ¯”è¾ƒã€‚ å³ä½¿å†³å®šä¸æ¸²æŸ“ï¼ˆè¿™æ­£æ˜¯æˆ‘ä»¬çš„æƒ…å†µï¼‰ï¼Œè¯¥æ¯”è¾ƒä»ç„¶éœ€è¦æ—¶é—´ã€‚  Oï¼ˆ1ï¼‰ï¼Œä½†æ˜¯Oï¼ˆ1ï¼‰å‡ºç°<code>size</code> *å¤§å°ä¹˜ä»¥ï¼ </p><br><h2 id="step-2-move-it-down"> æ­¥éª¤2ï¼šå°†å…¶å‘ä¸‹ç§» </h2><br><p> æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆæ¥è§£å†³å‘¢ï¼Ÿ å¦‚æœæ¸²æŸ“<code>App</code>èŠ±è´¹å¤ªå¤šï¼Œæˆ‘ä»¬å¿…é¡»åœæ­¢æ¸²æŸ“<code>App</code> ã€‚ å¦‚æœç»§ç»­ä½¿ç”¨<code>useState</code>åœ¨<code>App</code>æ‰˜ç®¡æˆ‘ä»¬çš„çŠ¶æ€æ˜¯<code>useState</code> ï¼Œå› ä¸ºè¿™æ­£æ˜¯è§¦å‘é‡æ–°æ¸²æŸ“çš„åŸå› ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å‘ä¸‹ç§»åŠ¨çŠ¶æ€ï¼Œå¹¶è®©æ¯ä¸ª<code>Cell</code>è‡ªå·±è®¢é˜…è¯¥çŠ¶æ€ã€‚ </p><br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„ç±»ï¼Œè¯¥ç±»å°†æˆä¸ºæˆ‘ä»¬çŠ¶æ€çš„å®¹å™¨ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(fieldSize) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size = fieldSize <span class="hljs-comment"><span class="hljs-comment">// Copy-paste from `initialState` this.data = new Array(this.size).fill(new Array(this.size).fill(undefined)) } cellContent(rowI, cellI) { return this.data[rowI][cellI] } // Copy-paste from old `setCell` setCell(rowI, cellI, newContent) { console.log('setCell') this.data = [ ...this.data.slice(0, rowI), [ ...this.data[rowI].slice(0, cellI), newContent, ...this.data[rowI].slice(cellI + 1), ], ...this.data.slice(rowI + 1), ] } map(cb) { return this.data.map(cb) } } const field = new Field(size)</span></span></code> </pre> <br><p> ç„¶åæˆ‘ä»¬çš„<code>App</code>å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; {</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">//</span></span></span></span><span class="hljs-function"><span class="hljs-params"> As you can see we still need to iterate over our state to get indexes. field.map((row, rowI</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{rowI}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {row.map((cell, cellI) =&gt; ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">row</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rowI</span></span></span></span><span class="xml"><span class="hljs-tag">}</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cell</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellI</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rowI</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{rowI}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellI</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cellI}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) }</code> </pre> <br><p> å¹¶ä¸”æˆ‘ä»¬çš„<code>Cell</code>å¯ä»¥è‡ªè¡Œæ˜¾ç¤º<code>field</code>çš„å†…å®¹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ rowI, cellI }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = field.cellContent(rowI, cellI) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> field.setCell(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ6</a> </p><br><p> è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­£åœ¨æ¸²æŸ“çš„å­—æ®µã€‚ ä½†æ˜¯ï¼Œå¦‚æœå•å‡»å•å…ƒæ ¼ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ åœ¨æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯æ¬¡ç‚¹å‡»éƒ½æ˜¾ç¤ºâ€œ setCellâ€ï¼Œä½†æ˜¯è¯¥å•å…ƒæ ¼ä¿æŒç©ºç™½ã€‚ è¿™é‡Œçš„åŸå› æ˜¯æ²¡æœ‰ä»»ä½•å†…å®¹å‘Šè¯‰å•å…ƒé‡æ–°æ¸²æŸ“ã€‚  Reactä¹‹å¤–çš„çŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯Reactå¯¹æ­¤ä¸€æ— æ‰€çŸ¥ã€‚ é‚£å¿…é¡»æ”¹å˜ã€‚ </p><br><p> æˆ‘ä»¬å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼è§¦å‘æ¸²æŸ“ï¼Ÿ </p><br><p> å¯¹äºç±»ï¼Œæˆ‘ä»¬å…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">forceUpdate</a> ã€‚ è¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å°†ä»£ç é‡æ–°ç¼–å†™ä¸ºç±»ï¼Ÿ ä¸å®Œå…¨æ˜¯ æˆ‘ä»¬å¯ä»¥å¯¹åŠŸèƒ½ç»„ä»¶æ‰§è¡Œçš„æ“ä½œæ˜¯å¼•å…¥ä¸€äº›è™šæ‹ŸçŠ¶æ€ï¼Œæˆ‘ä»¬ä»…å¯¹å…¶è¿›è¡Œæ›´æ”¹ä»¥è¿«ä½¿æˆ‘ä»¬çš„ç»„ä»¶é‡æ–°å‘ˆç°ã€‚ </p><br><p> è¿™æ˜¯æˆ‘ä»¬å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æŒ‚é’©ä»¥å¼ºåˆ¶é‡æ–°æ¸²æŸ“çš„æ–¹æ³•ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useForceRender = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [, setDummy] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> forceRender = useCallback(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> setDummy(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">oldVal</span></span></span><span class="hljs-function">) =&gt;</span></span> oldVal + <span class="hljs-number"><span class="hljs-number">1</span></span>), []) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> forceRender }</code> </pre> <br><p> è¦åœ¨å­—æ®µæ›´æ–°æ—¶è§¦å‘é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“å®ƒä½•æ—¶æ›´æ–°ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»èƒ½å¤Ÿä»¥æŸç§æ–¹å¼è®¢é˜…ç°åœºæ›´æ–°ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(fieldSize) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size = fieldSize <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size).fill(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size).fill(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscribers = {} } _cellSubscriberId(rowI, cellI) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`row</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${rowI}</span></span></span><span class="hljs-string">cell</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${cellI}</span></span></span><span class="hljs-string">`</span></span> } cellContent(rowI, cellI) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[rowI][cellI] } setCell(rowI, cellI, newContent) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'setCell'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = [ ...this.data.slice(<span class="hljs-number"><span class="hljs-number">0</span></span>, rowI), [ ...this.data[rowI].slice(<span class="hljs-number"><span class="hljs-number">0</span></span>, cellI), newContent, ...this.data[rowI].slice(cellI + <span class="hljs-number"><span class="hljs-number">1</span></span>), ], ...this.data.slice(rowI + <span class="hljs-number"><span class="hljs-number">1</span></span>), ] <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cellSubscriber = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscribers[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._cellSubscriberId(rowI, cellI)] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellSubscriber) { cellSubscriber() } } map(cb) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.map(cb) } <span class="hljs-comment"><span class="hljs-comment">// Note that we subscribe not to updates of the whole filed, but to updates of one cell only subscribeCellUpdates(rowI, cellI, onSetCellCallback) { this.subscribers[this._cellSubscriberId(rowI, cellI)] = onSetCellCallback } }</span></span></code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¢é˜…ç°åœºæ›´æ–°ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ rowI, cellI }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> forceRender = useForceRender() useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> field.subscribeCellUpdates(rowI, cellI, forceRender), [ forceRender, ]) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = field.cellContent(rowI, cellI) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> field.setCell(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ7</a> </p><br><p> è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå®ç°çš„<code>size</code> ã€‚ å°è¯•å°†å…¶å¢åŠ åˆ°ä»¥å‰æ„Ÿè§‰å¾ˆè½åçš„å€¼ã€‚ è€Œä¸”...æ˜¯æ—¶å€™æ‰“å¼€ä¸€ç“¶å¥½é¦™æ§Ÿäº†ï¼ æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªä»…å½“ä¸€ä¸ªå•å…ƒæ ¼çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰æ¸²æŸ“ä¸€ä¸ªå•å…ƒæ ¼å’Œä¸€ä¸ªå•å…ƒæ ¼çš„åº”ç”¨ç¨‹åºï¼ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹DevToolsæŠ¥å‘Šã€‚ </p><br><p><img src="https://habrastorage.org/webt/qm/yw/3y/qmyw3yetdbimipruhngx5pa_chu.png" alt="React DevToolsæŠ¥å‘Šï¼ƒ4"></p><br><p> æ­£å¦‚æˆ‘ä»¬ç°åœ¨æ‰€çœ‹åˆ°çš„ï¼Œåªæœ‰<code>Cell</code>ä¼šè¢«æ¸²æŸ“ï¼Œè€Œä¸”å¾ˆå¿«å°±ç–¯ç‹‚äº†ã€‚ </p><br><p> å¦‚æœè¯´ç°åœ¨æˆ‘ä»¬çš„<code>Cell</code>ä»£ç æ˜¯å†…å­˜æ³„æ¼çš„æ½œåœ¨åŸå› æ€ä¹ˆåŠï¼Ÿ å¦‚æ‚¨æ‰€è§ï¼Œåœ¨<code>useEffect</code>æˆ‘ä»¬è®¢é˜…äº†å•å…ƒæ ¼æ›´æ–°ï¼Œä½†æˆ‘ä»¬ä»æœªå–æ¶ˆè®¢é˜…ã€‚ è¿™æ„å‘³ç€ï¼Œå³ä½¿<code>Cell</code>è¢«é”€æ¯ï¼Œå…¶è®¢é˜…ä»ç„¶æœ‰æ•ˆã€‚ è®©æˆ‘ä»¬æ”¹å˜å®ƒã€‚ </p><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰<code>Field</code>é€€è®¢çš„å«ä¹‰ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... unsubscribeCellUpdates(rowI, cellI) { delete this.subscribers[this._cellSubscriberId(rowI, cellI)] } }</span></span></code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†<code>unsubscribeCellUpdates</code>åº”ç”¨äºæˆ‘ä»¬çš„<code>Cell</code> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ rowI, cellI }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> forceRender = useForceRender() useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { field.subscribeCellUpdates(rowI, cellI, forceRender) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> field.unsubscribeCellUpdates(rowI, cellI) }, [forceRender]) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = field.cellContent(rowI, cellI) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> field.setCell(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ8</a> </p><br><p> é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆæ•™è®­ï¼Ÿ ä»€ä¹ˆæ—¶å€™åœ¨ç»„ä»¶æ ‘ä¸­å‘ä¸‹ç§»åŠ¨çŠ¶æ€ï¼Ÿ æ°¸ä¸ï¼ å¥½å§ï¼Œä¸æ˜¯çœŸçš„:)åšæŒæœ€ä½³å®è·µï¼Œç›´åˆ°å®ƒä»¬å¤±è´¥å¹¶ä¸”ä¸åšä»»ä½•è¿‡æ—©çš„ä¼˜åŒ–ã€‚ å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢è€ƒè™‘çš„æƒ…å†µæœ‰äº›ç‰¹å®šï¼Œä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦æ˜¾ç¤ºéå¸¸å¤§çš„åˆ—è¡¨ï¼Œå¸Œæœ›æ‚¨èƒ½é‡æ–°æ”¶é›†å®ƒã€‚ </p><br><h2 id="bonus-step-real-world-refactoring"> å¥–åŠ±æ­¥éª¤ï¼šçœŸå®ä¸–ç•Œä¸­çš„é‡æ„ </h2><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ8ä¸­ï¼Œ</a>æˆ‘ä»¬ä½¿ç”¨äº†global <code>field</code> ï¼Œåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä¸æ˜¯è¿™ç§æƒ…å†µã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>App</code>æ‰˜ç®¡<code>field</code> ï¼Œç„¶åä½¿ç”¨[context]ï¼ˆï¼‰å°†å…¶ä¼ é€’åˆ°æ ‘ä¸Šã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AppContext = createContext() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Note how we used a factory to initialize our state here. // Field creation could be quite expensive for big fields. // So we don't want to create it each time we render and block the event loop. const [field] = useState(() =&gt; new Field(size)) return ( &lt;AppContext.Provider value={field}&gt; &lt;div&gt; {field.map((row, rowI) =&gt; ( &lt;div key={rowI}&gt; {row.map((cell, cellI) =&gt; ( &lt;Cell key={`row${rowI}cell${cellI}`} rowI={rowI} cellI={cellI} /&gt; ))} &lt;/div&gt; ))} &lt;/div&gt; &lt;/AppContext.Provider&gt; ) }</span></span></code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»<code>Cell</code>çš„ä¸Šä¸‹æ–‡ä¸­æ¶ˆè´¹<code>field</code> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cell = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ rowI, cellI }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'cell render'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> forceRender = useForceRender() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> field = useContext(AppContext) useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { field.subscribeCellUpdates(rowI, cellI, forceRender) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> field.unsubscribeCellUpdates(rowI, cellI) }, [forceRender]) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = field.cellContent(rowI, cellI) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> field.setCell(rowI, cellI, randomContent())}&gt; {content} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ) }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœºæ¼”ç¤ºï¼ƒ9</a> </p><br><p> å¸Œæœ›æ‚¨å·²ç»æ‰¾åˆ°äº†å¯¹æ‚¨çš„é¡¹ç›®æœ‰ç”¨çš„ä¸œè¥¿ã€‚ éšæ—¶å‘æˆ‘ä¼ è¾¾æ‚¨çš„åé¦ˆï¼ æˆ‘éå¸¸æ„Ÿè°¢ä»»ä½•æ‰¹è¯„å’Œç–‘é—®ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471300/">https://habr.com/ru/post/zh-CN471300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471282/index.html">ä½¿ç”¨Fast.aiåœ¨Xå…‰ç‰‡ä¸­å¯»æ‰¾è‚ºç‚</a></li>
<li><a href="../zh-CN471288/index.html">ä¸ºâ€œ OnAirâ€æ¸¸æˆåˆ›å»ºè§’è‰²çš„å¤´åƒ</a></li>
<li><a href="../zh-CN471294/index.html">å…³äºHaskellï¼ŒC ++å’Œç¨‹åºå‘˜çš„è¯—</a></li>
<li><a href="../zh-CN471296/index.html">ç²¾ç›Šåˆ¶é€ -æ•ˆç‡å·¥å…·</a></li>
<li><a href="../zh-CN471298/index.html">æ¯”ä¼¯å’Œç¢§å…°æŒ¥ç¬”ã€‚ AIç°åœ¨æ­£åœ¨å”±æ­Œ</a></li>
<li><a href="../zh-CN471302/index.html">ä¸­å›½çš„ç”¨æˆ·éªŒè¯å’Œç¤¾ä¼šä¿¡ç”¨</a></li>
<li><a href="../zh-CN471304/index.html">å¸å›½ERPã€‚ å¨±ä¹ä¼šè®¡ï¼šæ€»è´¦ï¼Œç§‘ç›®ï¼Œä½™é¢</a></li>
<li><a href="../zh-CN471306/index.html">ç”¨äºSailfish OSçš„Continent-AP VPNæ’ä»¶çš„å¼€å‘</a></li>
<li><a href="../zh-CN471310/index.html">æˆ‘å¯¹ä¸“ä¸šçš„çœ‹æ³•éå¸¸ä¸»è§‚ï¼Œè€Œä¸ä»…ä»…æ˜¯ITæ•™è‚²</a></li>
<li><a href="../zh-CN471312/index.html">å‡†å¤‡æ˜¥å­£ä¸“ä¸šè®¤è¯ã€‚ æ˜¥å­£é´</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>