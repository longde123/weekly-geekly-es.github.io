<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìß üêá üßóüèΩ Teste de carga de replica√ß√£o e backup da Veeam üßíüèæ ‚õπÔ∏è ü•í</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na primavera de 2018, a Selectel lan√ßou um servi√ßo de backup para o VMware Cloud atrav√©s do Veeam¬Æ Backup & Replication ‚Ñ¢ (doravante denominado VBR). ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Teste de carga de replica√ß√£o e backup da Veeam</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/431596/"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  Na primavera de 2018, a Selectel lan√ßou um servi√ßo de backup para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VMware Cloud</a> atrav√©s do Veeam¬Æ Backup &amp; Replication ‚Ñ¢ (doravante denominado VBR).  Abordamos o projeto minuciosamente, planejamos e executamos a seguinte lista de trabalhos: <br><br><ul><li>  Explorando a documenta√ß√£o e as pr√°ticas recomendadas do produto Veeam </li><li>  Projetando uma arquitetura VBR no n√≠vel do provedor de servi√ßos </li><li>  Implantar a infraestrutura VBR </li><li>  Testando a solu√ß√£o, determinando as configura√ß√µes e modos operacionais ideais </li><li>  Lan√ßamento da solu√ß√£o em opera√ß√£o industrial (comercial) </li></ul><br>  Como se viu - n√£o em v√£o.  O servi√ßo √© est√°vel, os clientes podem fazer backup de suas m√°quinas virtuais e temos um certo conhecimento que queremos compartilhar. <br><br>  Neste artigo, queremos falar sobre os resultados do teste de carga de VBR para os dois modos operacionais de proxy de backup mais populares, levando em considera√ß√£o a varia√ß√£o no n√∫mero de tarefas paralelas. <br><a name="habracut"></a><br>  Aqui voc√™ pode ver: <br><br><ul><li>  Descri√ß√£o da infraestrutura de produ√ß√£o Selectel usada para teste </li><li>  Recursos do proxy de backup (proxy de backup) em v√°rios modos de transporte </li><li>  Descri√ß√£o do programa de teste e configura√ß√µes dos componentes VBR para sua implementa√ß√£o </li><li>  Indicadores quantitativos, sua compara√ß√£o e conclus√µes </li></ul><br><h2>  Configura√ß√£o da infraestrutura de teste </h2><br><h3>  Infraestrutura de origem </h3><br>  Como plataforma para testar o desempenho do VBR, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi criado</a> um dos clusters de produ√ß√£o da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nuvem</a> p√∫blica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">baseada no VMware</a> . <br><br><ul><li>  A configura√ß√£o de hardware dos hosts neste cluster: </li><li>  Processadores Intel¬Æ Xeon¬Æ Gold 6140 </li><li>  Intel¬Æ DC NVMe P4600 e P3520 </li><li>  4 portas de 10 GbE por host </li></ul><br>  O cluster √© baseado nas seguintes solu√ß√µes: <br><br><ul><li>  Rede f√≠sica - F√°brica de Ethernet nos comutadores Brocade VDX, arquitetura Leaf-Spine (portas 10GbE - conectando hosts, uplinks de 40GbE ao Spine) </li><li>  Ambiente de virtualiza√ß√£o - VMware vSphere¬Æ 6.5 </li><li>  Armazenamento da VM - VMware vSAN ‚Ñ¢ 6.6 (Cluster vSAN totalmente em Flash) </li><li>  Virtualiza√ß√£o de rede - VMware NSX¬Æ 6.4 </li></ul><br>  O desempenho da plataforma de teste √© mais que suficiente e n√£o est√° em d√∫vida.  Obviamente, para um desempenho de alta velocidade, tudo isso deve ser configurado corretamente, mas, como se trata de produ√ß√£o, com clientes animados e satisfeitos, voc√™ pode ter certeza de que tudo est√° bem nesse aspecto. <br><br>  Juntamente com a nuvem baseada em VMware, a Selectel lan√ßou um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servi√ßo</a> para backup na plataforma VBR.  Os clientes recebem um portal da web de autoatendimento onde podem fazer backup e restaurar vApp e VMs do seu VDC (data center virtual). <br><br>  Os clientes t√™m acesso a este portal (portal de autoatendimento Veeam¬Æ Enterprise Manager) com os mesmos direitos que o vCloud Director¬Æ (vCD).  Isso √© poss√≠vel devido √† integra√ß√£o do Veeam¬Æ Backup Enterprise Manager (EM) e do vCD, enquanto cada cliente, quando conectado ao EM, √© limitado pelos recursos de seu VDC, n√£o ver√° outras VMs. <br><br>  O cliente n√£o precisa implantar sua pr√≥pria VBR e a infraestrutura de backup associada, o que implica o custo dos recursos de computa√ß√£o e de rede, armazenamento, licen√ßas Veeam e MS e administra√ß√£o.  √â longo, caro e complicado.  A Selectel fornece os recursos b√°sicos do VBR como um servi√ßo BaaS (Backup como servi√ßo): instantaneamente, de forma simples, conveniente e econ√¥mica. <br><br>  Para fornecer esse servi√ßo, a Selectel implantou uma infraestrutura de provedor VBR cobrindo todos os clusters vSphere e VDC de clientes em nuvem VMware, incluindo o cluster no qual esse teste foi realizado.  Assim, os resultados do teste nos permitir√£o avaliar a velocidade m√°xima com a qual os clientes podem fazer backup de suas VMs. <br><br><h3>  VMs de teste </h3><br>  Para testar o desempenho do backup, 6 VMs id√™nticas foram implantadas no cluster vSphere na seguinte configura√ß√£o: <br><br><ul><li>  SO Windows Server 2016, 2 vCPU, 4 GB de RAM </li><li>  200 GB vDisk </li></ul><br>  O disco est√° quase cheio - 193GB.  Al√©m dos arquivos do SO, foi criada uma pasta com distribui√ß√µes de v√°rios SO e DBMSs com capacidade de 60 GB (dados exclusivos).  Na mesma unidade, foram criadas 3 c√≥pias desta pasta - um total de 180 GB de dados n√£o pertencentes ao sistema. <br><br>  Nenhum aplicativo foi instalado nessas VMs, apenas um SO "limpo" e dados "frios".  Nenhuma carga, computacional ou de rede, iniciada.  Para este teste, isso n√£o foi necess√°rio. <br><br>  O DRS √© ativado no cluster vSphere, para que as VMs de teste sejam automaticamente distribu√≠das de maneira ideal entre os hosts VMware ESXi ‚Ñ¢ para balanceamento de carga. <br><br><h3>  Proxy de backup </h3><br>  Uma VM com proxy de backup √© implementada diretamente no cluster do vSphere descrito acima (a infraestrutura de origem, a seguir denominada cluster do vSphere), essa √© uma condi√ß√£o necess√°ria para testar no modo de dispositivo virtual. <br><br>  Configura√ß√£o da VM: <br><br><ul><li>  8 vCPU </li><li>  8GB RAM </li><li>  VDisk de 40 GB </li><li>  VNIC de 10GbE vmxnet3 </li><li>  Sistema operacional Windows Server 2016 </li></ul><br>  O par√¢metro "M√°ximo de tarefas simult√¢neas" para o proxy de backup no n√≠vel VBR √© definido como 6. Isso significa que o proxy de backup pode processar simultaneamente (em paralelo) at√© 6 tarefas de backup.  Uma tarefa √© um backup de um disco virtual da VM. <br><br><h3>  Reposit√≥rio de backup </h3><br>  O servidor f√≠sico que atua como um reposit√≥rio de backup do VBR atua como um frontend do armazenamento de backup.  Configura√ß√£o do servidor: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32GB RAM </li><li>  2 portas 10GbE </li></ul><br>  Back-end de armazenamento - Cluster CephFS com cache NVMe. <br><br>  O reposit√≥rio de backup e os n√≥s Ceph se comunicam por uma rede de 10 GbE, cada um deles conectado aos comutadores por duas portas. <br><br>  Uma descri√ß√£o detalhada da configura√ß√£o do cluster Ceph est√° al√©m do escopo deste artigo.  Observe que, para confiabilidade e toler√¢ncia a falhas, os dados s√£o armazenados em tr√™s c√≥pias.  O desempenho do cluster n√£o √© satisfat√≥rio e apresenta uma margem, os resultados do teste mostraram que em nenhum deles o armazenamento de backup era um gargalo. <br><br>  O par√¢metro "Limitar o m√°ximo de tarefas simult√¢neas" para o reposit√≥rio de backup no n√≠vel VBR √© definido como 6. Isso significa que o reposit√≥rio de backup poder√° processar simultaneamente (at√© 6) tarefas de backup. <br><br><h3>  Rede de backup </h3><br>  A rede f√≠sica da infraestrutura descrita acima √© limitada por uma largura de banda de 10 Gbit / s, switches e portas de 10GbE s√£o usados ‚Äã‚Äãem todos os lugares.  Isso ocorre n√£o apenas no vSAN, mas tamb√©m nas interfaces de gerenciamento dos hosts ESXi. <br><br>  Para hospedar um proxy de backup no n√≠vel do VMware NSX, uma sub-rede dedicada foi criada com seu pr√≥prio comutador l√≥gico.  Para sua conectividade com a f√≠sica e o roteamento, o NSX-edge, um tamanho X-grande, foi implantado. <br><br>  Olhando para o futuro, de acordo com os resultados do teste, fica claro que a rede pode suportar uma carga de at√© 8 Gb / s.  Essa √© uma largura de banda muito s√≥lida, que √© suficiente nesse est√°gio, se necess√°rio, pode ser aumentada. <br><br><h3>  Diagrama de intera√ß√£o do componente </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Proxies de backup e VMs de teste s√£o implantados no mesmo cluster VMware vSAN.  Depois de iniciar a tarefa de backup (tarefa de backup), dependendo do modo de transporte selecionado, cujos recursos s√£o discutidos abaixo, um proxy de backup: <br><br><ul><li>  Recupera dados de VMs de backup via vSAN (HotAdd) ou rede de controle (NBD) </li><li>  Transfere dados processados ‚Äã‚Äãpara o reposit√≥rio de backup na sub-rede alocada para essa finalidade </li></ul><br><h2>  Modos de transporte de proxy de backup </h2><br>  O proxy de backup √© um componente da infraestrutura VBR que executa diretamente o processamento da tarefa de backup.  Ele extrai dados da VM, os processa (compacta, deduplica, criptografa) e os envia para o reposit√≥rio, onde s√£o salvos nos arquivos de backup. <br><br>  O proxy de backup permite trabalhar em tr√™s modos de transporte: <br><br><ul><li>  Acesso direto ao armazenamento </li><li>  Dispositivo virtual </li><li>  Rede </li></ul><br>  A nuvem baseada no VMware Selectel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usa o vSAN</a> como armazenamento. Nesta configura√ß√£o, o acesso direto ao armazenamento n√£o √© suportado; portanto, este modo n√£o √© considerado e n√£o foi testado.  Os dois modos restantes funcionam maravilhosamente em cada um dos nossos clusters do vSphere. Vamos nos aprofundar neles com mais detalhes. <br><br><h3>  Modo de dispositivo virtual (HotAdd) </h3><br>  Dispositivo virtual √© o modo recomendado ao implantar proxies de backup como VMs.  Os hosts ESXi nos quais os proxies de backup s√£o implantados devem ter acesso a todo o armazenamento de dados do cluster vSphere que armazena as VMs de backup.  A ess√™ncia do modo √© que o proxy monta os discos da VM de backup (VMware SCSI HotAdd) e extrai dados deles como se fossem seus.  A extra√ß√£o de dados ocorre com o Datastore em uma rede de armazenamento. <br><br>  No nosso caso, a VM do proxy de backup deve estar localizada em um dos hosts ESXi do cluster vSAN, para o qual fazemos backup.  A extra√ß√£o de dados ocorre via vSAN.  Portanto, para trabalhar no modo de dispositivo virtual, pelo menos um proxy de backup deve ser implantado em cada cluster vSAN.  Expanda um par de proxies de backup (por exemplo, em um cluster de gerenciamento) e fa√ßa backup de todos os clusters vSAN com eles falhar√°. <br><table><tbody><tr><td align="center">  <strong>Pr√≥s</strong> </td><td align="center">  <strong>Contras</strong> </td></tr><tr><td>  R√°pido, via de regra, √© muito mais r√°pido que o NBD, especialmente no caso de um backup completo ou de grandes incrementos.  Somente o acesso direto ao armazenamento pode ter velocidade inferior. </td><td>  A opera√ß√£o de montagem de discos (HotAdd) em um proxy pode levar at√© 2 minutos por disco.  Com backups incrementais de pequenos blocos de dados, o NBD pode ser mais r√°pido. </td></tr><tr><td>  Descarta a rede de armazenamento.  N√£o carrega a interface de gerenciamento e o hypervisor. </td><td>  A VM de proxy consome parte dos recursos do host.  √Äs vezes, pode haver problemas com a remo√ß√£o de instant√¢neos. </td></tr></tbody></table><h3>  Modo de rede (NBD) </h3><br>  √â o modo mais simples e universal, adequado para proxies de backup f√≠sico e virtual.  A extra√ß√£o de dados, diferentemente dos dois modos anteriores, n√£o ocorre na rede de armazenamento.  Um proxy de backup obt√©m dados da VM conectando-se √† interface de gerenciamento dos hosts ESXi nos quais eles est√£o executando. <br><br>  Essa abordagem tem as seguintes desvantagens: <br><br><ul><li>  Geralmente, as interfaces de gerenciamento ESXi n√£o dependem dos uplinks mais r√°pidos, como regra, √© 1GbE </li><li>  Mesmo que a interface de gerenciamento tenha portas de 10 GbE, o ESXi n√£o abrir√° m√£o de todo o proxy da banda proxy - limita-o artificialmente e aloca apenas uma parte da largura de banda da interface para backups </li></ul><table><tbody><tr><td align="center">  <strong>Pr√≥s</strong> </td><td align="center">  <strong>Contras</strong> </td></tr><tr><td>  Simples e vers√°til.  Os proxies podem ser f√≠sicos e virtuais. </td><td>  Como regra, √© muito mais lento que o HotAdd, especialmente em grandes volumes de backup e em um pequeno n√∫mero de tarefas paralelas. </td></tr><tr><td>  In√≠cio r√°pido, sem demora na montagem das unidades.  N√£o h√° problema com os instant√¢neos. </td><td>  Cria uma carga (pequena) na interface de gerenciamento e no hipervisor. </td></tr></tbody></table>  Ao mesmo tempo, muitas fontes afirmam que o NBD √© muito lento em 1GbE, mas em 10GbE pode ser bastante r√°pido.  Definitivamente vamos verificar isso. <br><br><h2>  Programa de teste </h2><br>  Na infraestrutura descrita acima, √© necess√°rio fazer backup de VMs de teste e registrar os seguintes indicadores: <br><br><ul><li>  Carga da CPU,% </li><li>  Consumo de RAM, GB </li><li>  Carga de rede, Gbps </li><li>  Desempenho de backup, MB / s </li><li>  Tempo de backup, mm: ss </li></ul><br>  Os indicadores devem ser corrigidos para backup de uma VM de teste e backup paralelo de duas, quatro e seis VMs de teste. <br><br>  Os indicadores devem ser registrados para os modos operacionais de dispositivo virtual e proxy de backup de rede.  Sempre que um backup completo deve ser executado, n√£o h√° incrementos. <br><br>  Portanto, √© necess√°rio criar 4 tarefas de backup: <br><br><ul><li>  Para uma VM de teste </li><li>  Para duas VMs de teste </li><li>  Para quatro VMs de teste </li><li>  Para seis VMs de teste </li></ul><br>  Como parte do teste, √© necess√°rio: <br><br><ol><li>  Execute sequencialmente todas as tarefas em um modo </li><li>  Exclua os backups criados para que n√£o haja incrementos </li><li>  A repeti√ß√£o √© executada no segundo modo, sempre que os indicadores s√£o fixados </li></ol><br>  Nas configura√ß√µes de cada tarefa, voc√™ deve selecionar manualmente um proxy de backup preparado para teste, pois n√£o √© o √∫nico na infraestrutura geral de VBR e, por padr√£o, o proxy √© selecionado automaticamente. <br><br>  O modo de proxy de backup padr√£o tamb√©m √© selecionado automaticamente.  Portanto, nas configura√ß√µes do proxy de backup, antes de cada execu√ß√£o, defina manualmente o modo de transporte desejado. <br><br>  O indicador mais interessante √© a velocidade m√©dia ou o desempenho do backup.  Isso pode ser visto nos resultados do trabalho no console do VBR.  Tamb√©m mostrar√° o tempo de execu√ß√£o do backup. <br><br>  Al√©m disso, voc√™ precisa avaliar a carga no proxy de backup em cada um dos testes.  CPU, mem√≥ria e congestionamento de rede podem ser monitorados usando as ferramentas do SO convidado (Windows 2016) e no n√≠vel do VMware. <br><br>  No proxy de backup e nos reposit√≥rios de backup, o par√¢metro para o n√∫mero m√°ximo de tarefas simult√¢neas √© definido como 6. Isso significa que durante o teste, todas as VMs em cada tarefa ser√£o processadas em paralelo, nenhuma delas aguardar√° na fila, o desempenho ser√° m√°ximo. <br><br>  A Veeam¬Æ recomenda que o n√∫mero de tarefas paralelas n√£o exceda o n√∫mero de n√∫cleos de processador em proxies e reposit√≥rios.  A quantidade recomendada de RAM no reposit√≥rio √© de 2 GB por n√∫cleo, total de 12 GB.  A configura√ß√£o da infraestrutura mostra que todas as recomenda√ß√µes s√£o seguidas. <br><br><h2>  Velocidade e carregamento de backup no modo de dispositivo virtual (Hot Add) </h2><br><h3>  Backup de 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  55-95 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2-2,2 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  709 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  VM de backup 2 </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  70-100 (prateleira 100% com quedas bruscas e acentuadas at√© 70%) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  5-7,7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  816 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  100 (prateleira 100% com pequenas gotas raras) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  3-3,5 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  885 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  100 (prateleira 100% com pequenas gotas raras) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  4-4,2 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  888 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Velocidade de backup e carga no modo de rede (NBD) </h2><br><h3>  Backup de 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  18-24 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  192 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  18:30 </td></tr></tbody></table><br></div></div><br><h3>  VM de backup 2 </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  25-33 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  1.5-2.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  269 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  45-55 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2,8-3,5 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  2,8-4,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  446 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carregamento de proxy de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga da CPU,% </td><td align="center">  50-70 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  3,5-4 </td></tr><tr><td>  Carga de rede, Gbps </td><td align="center">  3,5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidade de backup</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Desempenho de backup, MB / s </td><td align="center">  517 </td></tr><tr><td>  Tempo de backup, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Compara√ß√£o de desempenho e carga no dispositivo virtual (HotAdd) e no modo de rede (NBD) </h2><table><tbody><tr><td align="center">  <strong>Contagem de VM</strong> </td><td align="center">  <strong>Velocidade - HotAdd, MB / s</strong> </td><td align="center">  <strong>Velocidade - NBD, MB / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3,69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1,98 </td></tr><tr><td align="center">  6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1,72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Contagem de VM</strong> </td><td align="center">  <strong>Carga da CPU - HotAdd,%</strong> </td><td align="center">  <strong>Carga da CPU - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3.06-3.96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1,82-2,22 </td></tr><tr><td align="center">  6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1,43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Contagem de VM</strong> </td><td align="center">  <strong>Download de RAM - HotAdd, GB</strong> </td><td align="center">  <strong>Carregamento de RAM - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  2-2,2 </td><td align="center">  1.9-2.1 </td><td align="center">  1.05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1,04-1,05 </td></tr><tr><td align="center">  4 </td><td align="center">  3-3,5 </td><td align="center">  2,8-3,5 </td><td align="center">  1-1,07 </td></tr><tr><td align="center">  6 </td><td align="center">  4-4,2 </td><td align="center">  3,5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Contagem de VM</strong> </td><td align="center">  <strong>Download de rede - HotAdd, Gb / s</strong> </td><td align="center">  <strong>Download de rede - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3,56-3,92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7,7 </td><td align="center">  1.5-2.5 </td><td align="center">  3.08-3.33 </td></tr><tr><td align="center">  4 </td><td align="center">  5-8,2 </td><td align="center">  2,8-4,5 </td><td align="center">  1,79-1,82 </td></tr><tr><td align="center">  6 </td><td align="center">  5-8,2 </td><td align="center">  3,5-5 </td><td align="center">  1,43-1,64 </td></tr></tbody></table><h2>  Resultados do teste </h2><br>  Os indicadores de desempenho de backup obtidos como resultado de testes confirmam inequivocamente o fato de que o modo do dispositivo virtual √© significativamente superior em velocidade em compara√ß√£o com o modo de rede, especialmente em um pequeno n√∫mero de tarefas paralelas. <br><br>  Deixe-me lembr√°-lo de que os testes para os dois modos foram executados sob condi√ß√µes absolutamente id√™nticas na mesma plataforma.  A largura de banda da rede tamb√©m era a mesma - as interfaces de controle atrav√©s das quais o proxy coleta dados no modo NBD fornecem 10 Gbit / s, como a rede vSAN no modo HotAdd, n√£o estabelecemos limites de largura de banda. <br><br>  Obviamente, o ESXi realmente desacelera o Veeam¬Æ e fornece apenas parte da banda no modo Rede, da√≠ as diferen√ßas na velocidade do backup.  No entanto, com o aumento do n√∫mero de threads - tarefas de backup simult√¢neas - o modo Rede reduz significativamente a lista de pend√™ncias. <br><br>  Vemos que, no modo de dispositivo virtual, j√° em 4 VMs, o proxy de backup fica no processador, n√£o pode funcionar mais r√°pido; para 6 VMs, a velocidade do backup n√£o mudou muito.  Ao mesmo tempo, a velocidade de backup de 1-2 VMs nesse modo est√° um pouco atrasada, os recursos de proxies e plataformas de backup s√£o usados ‚Äã‚Äãao m√°ximo, mesmo em um pequeno n√∫mero de threads. <br><br>  No modo Rede, pelo contr√°rio, h√° um aumento significativo na produtividade com um aumento no n√∫mero de tarefas simult√¢neas.  Ao mesmo tempo, a carga no processador proxy de backup √© significativamente menor que no modo HotAdd, mesmo em 6 threads, n√£o excede 70%. <br><br>  O consumo de mem√≥ria do proxy de backup √© pequeno e aproximadamente o mesmo nos dois modos. <br><br>  A carga na rede proxy de backup est√° correlacionada com a velocidade do backup, excedendo-a em ~ 10-17%.  Aparentemente, o proxy leva os dados das fontes da VM um pouco mais r√°pido do que carrega no reposit√≥rio, porque eles precisam ser processados. <br><br>  √â interessante observar a linha Carregar nas figuras com os resultados da execu√ß√£o do trabalho.  Ele mostra o n√≠vel de carga em v√°rios elementos da infraestrutura de backup: origem, proxy, rede, reposit√≥rio. <br><br>  No modo Dispositivo virtual, vemos que o desempenho do backup est√° no proxy e na rede, eles sempre t√™m aproximadamente a mesma carga.  A fonte e o reposit√≥rio n√£o s√£o um gargalo. <br><br>  No modo Rede, o gargalo √© sempre a fonte, mesmo para um √∫nico fluxo.  Pode-se ver que o restante da infraestrutura pode oferecer mais, mas o ESXi n√£o fornece. <br><br><h2>  Sum√°rio </h2><br>  Os testes confirmaram que, na pr√°tica, o proxy de backup nos modos de transporte estudados se comporta exatamente como a teoria sugere. <br><br>  O software Veeam¬Æ provou ser muito valioso: <br><br><ul><li>  No modo HotAdd, todos os recursos de infraestrutura foram efetivamente e completamente utilizados. </li><li>  No modo NBD, espera-se que o desempenho seja mais modesto, mas esse n√£o √© um problema do Veeam¬Æ, mas um recurso da pilha de rede ESXi </li></ul><br>  Temos indicadores reais de desempenho e carga, o que √© muito √∫til para escolher o melhor modo de opera√ß√£o e subsequente dimensionamento do sistema. <br><br>  No momento, estamos bastante satisfeitos com o desempenho de backup existente, entendemos como aument√°-lo adequadamente quando essa necessidade surgir. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431596/">https://habr.com/ru/post/pt431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431582/index.html">Hist√≥ria da prote√ß√£o de dados pessoais: como surgiu o GDPR?</a></li>
<li><a href="../pt431584/index.html">Espa√ßo e teste: misture, mas n√£o agite</a></li>
<li><a href="../pt431586/index.html">Como lidar com erros na JVM mais rapidamente</a></li>
<li><a href="../pt431588/index.html">Ato por conta pr√≥pria. Informa√ß√µes para considera√ß√£o</a></li>
<li><a href="../pt431590/index.html">Moderniza√ß√£o de parques e√≥licos obsoletos do Reino Unido aumentar√° a gera√ß√£o de energia em 171%</a></li>
<li><a href="../pt431598/index.html">Trazemos para a Internet uma m√°quina virtual p√∫blica QEMU sem placa de rede e tentamos extrair</a></li>
<li><a href="../pt431600/index.html">Aumentar IDS / NMS: Mikrotik e Suricata com uma interface da web</a></li>
<li><a href="../pt431602/index.html">Desenvolvedores russos apresentaram em Londres um sistema de reabilita√ß√£o virtual</a></li>
<li><a href="../pt431604/index.html">Localiza√ß√£o no Go com pacotes b√°sicos</a></li>
<li><a href="../pt431608/index.html">A empresa americana DriveSavers √© a primeira do mundo a lan√ßar o servi√ßo de hackers para iPhone de indiv√≠duos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>