<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå† üåÄ üêã Otimize a distribui√ß√£o de servidores em rack ‚≠ïÔ∏è ü§¥üèΩ üåï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em uma das conversas, me fizeram uma pergunta: 

 - E h√° algo para ler, como empacotar servidores em racks corretamente? 

 Percebi que n√£o conhecia e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimize a distribui√ß√£o de servidores em rack</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474112/"> Em uma das conversas, me fizeram uma pergunta: <br><br>  - E h√° algo para ler, como empacotar servidores em racks corretamente? <br><br>  Percebi que n√£o conhecia esse texto, ent√£o escrevi o meu. <br><br>  Primeiramente, este texto √© sobre servidores f√≠sicos em centros de dados f√≠sicos (DCs).  Em segundo lugar, acreditamos que existem muitos servidores: centenas ou milhares; para um n√∫mero menor, esse texto n√£o faz sentido.  Em terceiro lugar, acreditamos que temos tr√™s limitadores: espa√ßo f√≠sico nos racks, energia no rack e deix√°-los em filas, para que possamos usar um switch ToR para conectar servidores nos racks vizinhos. <br><a name="habracut"></a><br>  A resposta para a pergunta depende muito de qual par√¢metro otimizamos e o que podemos variar para alcan√ßar o melhor resultado.  Por exemplo, precisamos apenas de um espa√ßo m√≠nimo para deixar mais para um crescimento adicional.  Ou talvez tenhamos liberdade para escolher a altura dos racks, a pot√™ncia por rack, os soquetes na PDU, o n√∫mero de racks em um grupo de comutadores (um comutador por 1, 2 ou 3 racks), o comprimento dos fios e o trabalho de puxar (isso √© fundamental no final das linhas: com 10 racks em uma linha e 3 racks em um switch, voc√™ ter√° que puxar os fios em outra linha ou subutilizar as portas no switch), etc., etc.  Hist√≥rias separadas: sele√ß√£o de servidor e sele√ß√£o de DC, assumimos que elas foram selecionadas. <br><br>  Seria bom entender algumas das nuances e detalhes, em particular, o consumo m√©dio / m√°ximo de servidores e como somos fornecidos com eletricidade.  Portanto, se tivermos uma fonte de alimenta√ß√£o russa de 230V e uma fase por rack, uma m√°quina de 32A poder√° armazenar ~ 7kW.  Suponha que pagamos nominalmente por 6kW por rack.  Se um fornecedor mede nosso consumo apenas para uma s√©rie de 10 racks, e n√£o para cada rack, e se a m√°quina estiver com um corte convencional de 7 kW, ent√£o tecnicamente podemos engordar 6,9 kW em um rack separado, em outros 5,1 kW e tudo ficar√° bem - n√£o √© pun√≠vel. <br><br>  Normalmente, nosso principal objetivo √© minimizar os custos.  O melhor crit√©rio de medi√ß√£o √© a redu√ß√£o no TCO (custo total de propriedade).  Consiste nas seguintes pe√ßas: <br><br><ul><li>  CAPEX: aquisi√ß√£o de infraestrutura de DC, servidores, hardware de rede e cabeamento </li><li>  OPEX: aluguel de DC, eletricidade consumida, manuten√ß√£o.  O OPEX depende da vida √∫til.  √â razo√°vel supor que √© igual a 3 anos. </li></ul><br><img src="https://habrastorage.org/webt/ub/ur/zi/uburzia_hkzpiosfd3k6i2agrwq.jpeg"><br><br>  Dependendo do tamanho das pe√ßas individuais em todo o bolo, precisamos otimizar o mais caro e deixar o restante usar todos os recursos restantes da maneira mais eficiente poss√≠vel. <br><br>  Suponha que tenhamos um controlador de dom√≠nio existente, haja uma altura do rack de unidades H (por exemplo, H = 47), eletricidade no rack P do <sub>rack</sub> ( <sub>rack</sub> P = 6 kW) e decidimos usar h = 2U servidores de duas unidades.  Removemos 2..4 unidades do rack para os switches, patch panels e organizadores.  I.e.  fisicamente, temos S <sub>h</sub> = rounddown ((H-2..4) / h) servidores em nosso rack (ou seja, S <sub>h</sub> = rounddown ((47-4) / 2) = 21 servidores por rack).  Lembre-se de que √© S <sub>h</sub> . <br><br>  No caso simples, todos os servidores no rack s√£o os mesmos.  Total, se conectarmos o rack aos servidores, em cada servidor poderemos gastar, em m√©dia, a pot√™ncia P <sub>serv</sub> = P <sub>rack</sub> / S <sub>h</sub> (P <sub>serv</sub> = 6000 W / 21 = 287 W).  Por simplicidade, ignoramos o consumo do comutador aqui. <br><br>  Damos um passo para o lado e determinamos qual √© o consumo m√°ximo do servidor P <sub>m√°x</sub> .  Se for muito simples, ineficiente e completamente seguro, lemos o que est√° escrito na fonte de alimenta√ß√£o do servidor - √© isso. <br><br>  Se for mais complicado, mais eficiente, pegamos o TDP (pacote de design t√©rmico) de todos os componentes e resumimos (isso n√£o √© muito verdade, mas pode ser). <br><br>  Geralmente, como n√£o conhecemos os componentes TDP (exceto a CPU), adotamos a abordagem mais correta, mas tamb√©m a mais dif√≠cil (precisamos de um laborat√≥rio) - pegamos um servidor experimental da configura√ß√£o necess√°ria e carregamos, por exemplo, com Linpack (CPU e mem√≥ria) e fio (discos) medir consumo.  Se voc√™ levar a s√©rio, tamb√©m precisar√° criar o ambiente mais quente no corredor frio durante os testes, pois isso afetar√° o consumo do ventilador e o CPU.  Obtemos o consumo m√°ximo de um servidor espec√≠fico com uma configura√ß√£o espec√≠fica nessas condi√ß√µes espec√≠ficas sob essa carga espec√≠fica.  Apenas queremos dizer que o novo firmware do sistema, outra vers√£o do software, outras condi√ß√µes podem afetar o resultado. <br><br>  No total, retornamos a P <sub>serv</sub> e como comparamos com P <sub>max</sub> .  Essa √© uma quest√£o de entender como os servi√ßos funcionam e como s√£o fortes os nervos do t√©cnico. <br><br>  Se voc√™ n√£o arriscar, acreditamos que todos os servidores podem come√ßar imediatamente a consumir o m√°ximo.  Ao mesmo tempo, uma entrada para o DC pode ser formada.  A infra-estrutura nessas condi√ß√µes deve fornecer um servi√ßo, portanto, P <sub>serv</sub> ‚â° P <sub>max</sub> .  Essa √© uma abordagem em que a confiabilidade √© absolutamente crucial. <br><br>  Se o techdir pensa n√£o apenas na seguran√ßa perfeita, mas tamb√©m no dinheiro da empresa e √© bastante corajoso, podemos decidir que <br><br><ul><li>  come√ßamos a gerenciar nossos fornecedores, em particular, proibimos a manuten√ß√£o programada nos hor√°rios de pico de carga planejado para minimizar a queda em uma entrada; </li><li>  e / ou nossa arquitetura permite que voc√™ perca o rack / row / DC, e os servi√ßos continuam funcionando; </li><li>  e / ou distribu√≠mos a carga horizontalmente pelos racks, para que nossos servi√ßos nunca atinjam o consumo m√°ximo em um rack juntos. </li></ul><br>  √â muito √∫til aqui n√£o apenas para adivinhar, mas para monitorar o consumo e saber como realmente em condi√ß√µes normais e de pico os servidores consomem eletricidade.  Portanto, ap√≥s algumas an√°lises, o techdir comprime tudo o que possui e diz: ‚Äúaceitamos voluntariamente que a m√©dia m√°xima alcan√ß√°vel do consumo m√°ximo do servidor por rack √© ** muito ** abaixo do consumo m√°ximo", condicionalmente P <sub>serv</sub> = 0,8 * P <sub>m√°x</sub> . <br><br>  E, em um rack de 6kW, n√£o h√° mais 16 servidores com P <sub>max</sub> = 375W, mas 20 servidores com P <sub>serv</sub> = 375W \ * 0,8 = 300W.  I.e.  25% mais servidores.  Essa √© uma economia muito grande - afinal, precisamos imediatamente de 25% menos racks (tamb√©m economizamos em PDUs, comutadores e cabos).  Um ponto negativo grave dessa decis√£o - √© necess√°rio monitorar constantemente que nossas suposi√ß√µes ainda s√£o verdadeiras.  Que a nova vers√£o do firmware n√£o altera significativamente a opera√ß√£o dos ventiladores e o consumo, que o desenvolvimento de uma nova vers√£o repentinamente n√£o come√ßou a usar o servidor com muito mais efici√™ncia (leia-se, temos mais carga e mais consumo no servidor).  Afinal, nossas premissas e conclus√µes iniciais se tornam imediatamente incorretas.  Esse √© um risco que deve ser assumido com responsabilidade (ou evitado e, em seguida, pago pelos racks obviamente sobrecarregados). <br><br>  Uma observa√ß√£o importante - voc√™ deve tentar distribuir servidores de diferentes servi√ßos em racks horizontalmente, se poss√≠vel.  Isso √© necess√°rio para que as hist√≥rias n√£o aconte√ßam quando um lote de servidores para um servi√ßo chegar, os racks ficar√£o obstru√≠dos verticalmente para aumentar a "densidade" (porque √© mais f√°cil).  Na realidade, verifica-se que um rack est√° abarrotado com os mesmos servidores de baixa carga de um servi√ßo e o outro √© igualmente carregado com muita carga.  A probabilidade de uma queda do segundo √© muito maior, porque  o perfil de carga √© o mesmo e todos os servidores juntos nesse rack come√ßam a consumir a mesma quantidade como resultado do aumento da carga. <br><br>  Voltar para a distribui√ß√£o de servidores nos racks.  Examinamos as limita√ß√µes f√≠sicas do espa√ßo em rack e das limita√ß√µes de energia e agora examinamos a rede.  Voc√™ pode usar comutadores nas portas 24/32/48 N (por exemplo, temos comutadores ToR de 48 portas).  Felizmente, n√£o h√° muitas op√ß√µes se voc√™ n√£o pensa em cabos quebrados.  Consideramos os cen√°rios em que temos um comutador por rack, um comutador para dois ou tr√™s racks no grupo R <sub>l√≠quido</sub> .  Parece-me que mais de tr√™s racks no grupo j√° s√£o demais, porque  o problema de cabeamento entre racks se torna muito maior. <br><br>  Portanto, para cada cen√°rio de rede (1, 2 ou 3 racks em um grupo), distribu√≠mos o servidor em racks: <br><br>  <sub>Rack</sub> S = min (S <sub>h</sub> , arredondamento ( <sub>rack</sub> P / <sub>servi√ßo</sub> P), arredondamento ( <sub>rede</sub> N / R)) <br><br>  Assim, para a op√ß√£o com 2 racks no grupo: <br><br>  S <sub>rack</sub> <sup>2</sup> = min (21, arredondamento (6000/300), arredondamento (48/2)) = min (21, 20, 24) = 20 servidores por rack. <br><br>  Da mesma forma, consideramos as op√ß√µes restantes: <br><br>  S <sub>rack</sub> <sup>1</sup> = 20 <br>  S <sub>rack</sub> <sup>3</sup> = 16 <br><br>  E n√≥s estamos quase l√°.  Contamos o n√∫mero de racks para a distribui√ß√£o de todos os nossos servidores S (seja 1000): <br><br>  R = arredondamento (S / ( <sub>rack</sub> S * R <sub>l√≠quido</sub> )) * R <sub>l√≠quido</sub> <br><br>  R <sub>1</sub> = arredondamento (1000 / (20 * 1)) * 1 = 50 * 1 = 50 racks <br><br>  R <sub>2</sub> = arredondamento (1000 / (20 * 2)) * 2 = 25 * 2 = 50 racks <br><br>  R <sub>3</sub> = arredondamento (1000 / (16 * 3)) * 3 = 21 * 3 = 63 racks <br><br>  Em seguida, consideramos o custo total de propriedade para cada op√ß√£o com base no n√∫mero de racks, no n√∫mero necess√°rio de comutadores, cabos, etc.  Escolhemos a op√ß√£o em que o custo total de propriedade √© menor.  Lucro! <br><br>  Observe que, embora o n√∫mero necess√°rio de racks para as op√ß√µes 1 e 2 seja o mesmo, o pre√ßo ser√° diferente, pois  o n√∫mero de comutadores para a segunda op√ß√£o √© metade e o comprimento dos cabos necess√°rios √© maior. <br><br>  PS Se houver uma oportunidade de jogar energia em um rack e na altura do rack, a variabilidade aumenta.  Mas o processo pode ser reduzido ao acima, apenas classificando as op√ß√µes.  Sim, haver√° mais combina√ß√µes, mas ainda assim um n√∫mero muito limitado - a pot√™ncia do rack para c√°lculo pode ser aumentada em incrementos de 1 kW, os racks t√≠picos t√™m um n√∫mero limitado de tamanhos: 42U, 45U, 47U, 48U, 48U, 52U.  E aqui a an√°lise de varia√ß√µes hipot√©ticas do Excel no modo Tabela de dados pode ajudar a calcular.  Olhamos para as placas recebidas e selecionamos o m√≠nimo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474112/">https://habr.com/ru/post/pt474112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt474092/index.html">Se√ß√£o de back-end no DUMP Kazan: arquitetura de aplicativos em nuvem, microsservi√ßos de sa√≠da, DDD e mais</a></li>
<li><a href="../pt474094/index.html">Editor de diagrama de blocos - sobre a amizade entre Vue.js e MxGraph</a></li>
<li><a href="../pt474096/index.html">Linguagens de programa√ß√£o populares 2019 de usu√°rios do hh.ru</a></li>
<li><a href="../pt474104/index.html">Uma maneira universal de personalizar a apar√™ncia de um aplicativo WinForms (usando o exemplo do FAQ.Net)</a></li>
<li><a href="../pt474106/index.html">Sem√¢ntica das Ferramentas de Resolu√ß√£o de Depend√™ncias</a></li>
<li><a href="../pt474114/index.html">Convidamos voc√™ para o GDG DevFest Moscow 2019 - uma confer√™ncia informal de TI</a></li>
<li><a href="../pt474116/index.html">Como voc√™ n√£o precisa obter consentimento para o processamento de dados pessoais</a></li>
<li><a href="../pt474118/index.html">O livro "inDriver: de Yakutsk ao Vale do Sil√≠cio. A hist√≥ria da cria√ß√£o de uma empresa global de tecnologia "</a></li>
<li><a href="../pt474122/index.html">Da teoria √† pr√°tica: como o blockchain √© usado na avia√ß√£o</a></li>
<li><a href="../pt474124/index.html">Precisamos de outro 1C-Bitrix, parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>