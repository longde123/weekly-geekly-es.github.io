<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ« ğŸš£ â†™ï¸ ä½¿ç”¨Rspecå°†æ‚¨çš„Goåº”ç”¨æµ‹è¯•ä¸ºé»‘ç›’ ğŸ‘©ğŸ½ âœŠğŸ½ âœ´ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¼–å†™å¾—å½“çš„æµ‹è¯•å¯ä»¥å¤§å¤§å‡å°‘æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®å¤é”™è¯¯æ—¶â€œç ´åâ€åº”ç”¨ç¨‹åºçš„é£é™©ã€‚ åœ¨ç”±å‡ ä¸ªç›¸äº’è¿æ¥çš„ç»„ä»¶ç»„æˆçš„å¤æ‚ç³»ç»Ÿä¸­ï¼Œæœ€å›°éš¾çš„æ˜¯æµ‹è¯•å®ƒä»¬çš„å…±åŒç‚¹ã€‚ 

 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºåœ¨Goä¸Šå¼€å‘ç»„ä»¶æ—¶å¦‚ä½•é‡åˆ°ç¼–å†™è‰¯å¥½æµ‹è¯•çš„å›°éš¾ï¼Œä»¥åŠå¦‚ä½•åœ¨Ruby on Railsä¸­ä½¿ç”¨RSpecåº“è§£å†³æ­¤é—®é¢˜ã€‚ 

 å°†Goæ·»åŠ åˆ°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Rspecå°†æ‚¨çš„Goåº”ç”¨æµ‹è¯•ä¸ºé»‘ç›’</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427951/"> ç¼–å†™å¾—å½“çš„æµ‹è¯•å¯ä»¥å¤§å¤§å‡å°‘æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®å¤é”™è¯¯æ—¶â€œç ´åâ€åº”ç”¨ç¨‹åºçš„é£é™©ã€‚ åœ¨ç”±å‡ ä¸ªç›¸äº’è¿æ¥çš„ç»„ä»¶ç»„æˆçš„å¤æ‚ç³»ç»Ÿä¸­ï¼Œæœ€å›°éš¾çš„æ˜¯æµ‹è¯•å®ƒä»¬çš„å…±åŒç‚¹ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºåœ¨Goä¸Šå¼€å‘ç»„ä»¶æ—¶å¦‚ä½•é‡åˆ°ç¼–å†™è‰¯å¥½æµ‹è¯•çš„å›°éš¾ï¼Œä»¥åŠå¦‚ä½•åœ¨Ruby on Railsä¸­ä½¿ç”¨RSpecåº“è§£å†³æ­¤é—®é¢˜ã€‚ <br><a name="habracut"></a><br><h2> å°†Goæ·»åŠ åˆ°é¡¹ç›®çš„æŠ€æœ¯å †æ ˆä¸­ </h2><br>  eTeamæ­£åœ¨å¼€å‘çš„é¡¹ç›®ä¹‹ä¸€ï¼ˆæˆ‘åœ¨å…¶ä¸­å·¥ä½œï¼‰å¯ä»¥åˆ†ä¸ºï¼šç®¡ç†é¢æ¿ï¼Œç”¨æˆ·å¸æˆ·ï¼ŒæŠ¥å‘Šç”Ÿæˆå™¨ä»¥åŠå¤„ç†ä¸æˆ‘ä»¬é›†æˆçš„å„ç§æœåŠ¡çš„è¯·æ±‚ã€‚ <br><br> è´Ÿè´£å¤„ç†è¯·æ±‚çš„éƒ¨åˆ†æœ€ä¸ºé‡è¦ï¼Œå› æ­¤æˆ‘å¸Œæœ›ä½¿å…¶å°½å¯èƒ½å¯é å’Œè´Ÿæ‹…å¾—èµ·ã€‚ ä½œä¸ºæ•´ä½“åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œå¥¹åœ¨æ›´æ”¹ä¸ä¹‹æ— å…³çš„ä»£ç æ®µæ—¶æœ‰é‡åˆ°é”™è¯¯çš„é£é™©ã€‚ åŠ è½½å…¶ä»–åº”ç”¨ç¨‹åºç»„ä»¶æ—¶ï¼Œä¹Ÿå­˜åœ¨åˆ é™¤å¤„ç†çš„é£é™©ã€‚ æ¯ä¸ªåº”ç”¨ç¨‹åºçš„Ngnixå·¥ä½œç¨‹åºæ•°é‡æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”éšç€è´Ÿè½½çš„å¢åŠ ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç®¡ç†é¢æ¿ä¸­æ‰“å¼€è®¸å¤šæ²‰é‡çš„é¡µé¢ï¼‰ï¼Œè‡ªç”±å·¥ä½œç¨‹åºåœæ­¢å¹¶ä¸”è¯·æ±‚å¤„ç†é€Ÿåº¦å‡æ…¢ç”šè‡³ä¸‹é™ã€‚ <br><br> è¿™äº›é£é™©ä»¥åŠè¯¥ç³»ç»Ÿçš„æˆç†Ÿåº¦ï¼ˆå‡ ä¸ªæœˆæ— éœ€æ›´æ”¹ï¼‰ä½¿å…¶æˆä¸ºåˆ†ç¦»ä¸ºå•ç‹¬æœåŠ¡çš„ç†æƒ³é€‰æ‹©ã€‚ <br> å†³å®šåœ¨Goä¸Šç¼–å†™æ­¤å•ç‹¬çš„æœåŠ¡ã€‚ ä»–å¿…é¡»ä¸Railsåº”ç”¨ç¨‹åºå…±äº«å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚  Railsè´Ÿè´£è¡¨ç»“æ„çš„å¯èƒ½æ›´æ”¹ã€‚ åŸåˆ™ä¸Šï¼Œè¿™ç§æœ‰å…¬å…±æ•°æ®åº“çš„æ–¹æ¡ˆæ•ˆæœå¾ˆå¥½ï¼Œè€Œåªæœ‰ä¸¤ä¸ªåº”ç”¨ç¨‹åºã€‚ å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><img src="https://habrastorage.org/webt/67/19/wy/6719wyo52lzxj3ofrjy4epnitjq.png" alt="å›¾ç‰‡"><br><br> è¯¥æœåŠ¡å·²ç¼–å†™å¹¶éƒ¨ç½²åˆ°ä¸Railsåˆ†å¼€çš„å®ä¾‹ã€‚ ç°åœ¨ï¼Œåœ¨éƒ¨ç½²Railsåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå®ƒä¼šå½±å“æŸ¥è¯¢å¤„ç†ã€‚ è¯¥æœåŠ¡åœ¨ä¸ä½¿ç”¨Ngnixçš„æƒ…å†µä¸‹ç›´æ¥æ¥å—äº†HTTPè¯·æ±‚ï¼Œåªå ç”¨äº†ä¸€ç‚¹å†…å­˜ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šæ¥è¯´æ˜¯æç®€ä¸»ä¹‰çš„ã€‚ <br><br><h2>  Goä¸­å•å…ƒæµ‹è¯•çš„é—®é¢˜ </h2><br> å•å…ƒæµ‹è¯•æ˜¯åœ¨Goåº”ç”¨ç¨‹åºä¸­å®ç°çš„ï¼Œå¹¶ä¸”å…¶ä¸­çš„æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢éƒ½å·²é”å®šã€‚ æ”¯æŒè¿™ç§è§£å†³æ–¹æ¡ˆçš„å…¶ä»–è®ºæ®åŒ…æ‹¬ï¼šä¸»Railsåº”ç”¨ç¨‹åºè´Ÿè´£æ•°æ®åº“ç»“æ„ï¼Œå› æ­¤goåº”ç”¨ç¨‹åºä¸â€œæ‹¥æœ‰â€ç”¨äºåˆ›å»ºæµ‹è¯•æ•°æ®åº“çš„ä¿¡æ¯ã€‚ å¤„ç†è¯·æ±‚çš„ä¸€åŠç”±ä¸šåŠ¡é€»è¾‘ç»„æˆï¼Œè€Œå¦ä¸€åŠåˆ™ä¸æ•°æ®åº“ä¸€èµ·ä½¿ç”¨ï¼Œè€Œè¿™ä¸€åŠå·²å®Œå…¨é”å®šã€‚  Goä¸­çš„Mokiçœ‹èµ·æ¥æ¯”Rubyä¸­çš„â€œå¯è¯»æ€§â€ä½ã€‚ åœ¨æ·»åŠ æ–°åŠŸèƒ½ä»¥ä»æ•°æ®åº“è¯»å–æ•°æ®æ—¶ï¼Œéœ€è¦åœ¨ä¹‹å‰æœ‰æ•ˆçš„ä¸€ç»„ä¸‹é™æµ‹è¯•ä¸­ä¸ºå…¶æ·»åŠ mokiã€‚ ç»“æœï¼Œè¿™ç§å•å…ƒæµ‹è¯•æ˜¯æ— æ•ˆçš„å¹¶ä¸”éå¸¸è„†å¼±ã€‚ <br><br><h2> è§£å†³æ–¹æ³• </h2><br> ä¸ºäº†æ¶ˆé™¤è¿™äº›ç¼ºç‚¹ï¼Œå†³å®šä½¿ç”¨ä½äºRailsåº”ç”¨ç¨‹åºä¸­çš„åŠŸèƒ½æµ‹è¯•æ¥è¦†ç›–è¯¥æœåŠ¡ï¼Œå¹¶ä»¥é»‘ç›’çš„å½¢å¼åœ¨Goä¸Šæµ‹è¯•è¯¥æœåŠ¡ã€‚ ä½œä¸ºç™½ç›’ï¼Œå®ƒä»ç„¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå³ä½¿æœ‰æ‰€æœ‰éœ€æ±‚ï¼Œä»çº¢å®çŸ³ä¸­ä¹Ÿæ— æ³•å¹²é¢„æœåŠ¡ï¼Œä¾‹å¦‚ï¼Œå¼„æ¹¿æŸç§æ–¹æ³•æ¥æ£€æŸ¥å®ƒæ˜¯å¦è¢«è°ƒç”¨ã€‚ è¿™ä¹Ÿæ„å‘³ç€æµ‹è¯•æœåŠ¡å‘é€çš„è¯·æ±‚ä¹Ÿæ— æ³•é”å®šï¼Œå› æ­¤æ‚¨éœ€è¦å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥æ•è·å’Œè®°å½•å®ƒä»¬ã€‚ å°±åƒRequestBinä¸€æ ·ï¼Œä½†æ˜¯æ˜¯æœ¬åœ°çš„ã€‚ æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªç±»ä¼¼çš„å®ç”¨ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨äº†å®ƒã€‚ <br><br> äº‹å®è¯æ˜ä»¥ä¸‹æ–¹æ¡ˆï¼š <br><br><ol><li>  rspecåœ¨è¿è¡Œæ—¶ç¼–è¯‘å¹¶å¯åŠ¨æœåŠ¡ï¼Œå¹¶å‘å…¶ä¼ é€’ä¸€ä¸ªé…ç½®ï¼Œè¯¥é…ç½®åŒ…å«å¯¹æµ‹è¯•åº“çš„è®¿é—®ä»¥åŠç”¨äºæ¥æ”¶HTTPè¯·æ±‚çš„ç‰¹å®šç«¯å£ï¼Œä¾‹å¦‚8082 </li><li> è¿˜å¯åŠ¨äº†ä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œä»¥è®°å½•åœ¨ç«¯å£8083ä¸Šæ”¶åˆ°çš„HTTPè¯·æ±‚ </li><li> æˆ‘ä»¬åœ¨RSpecä¸Šç¼–å†™æ™®é€šæµ‹è¯•ï¼Œå³ åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå¿…è¦çš„æ•°æ®ï¼Œç„¶åå°†è¯·æ±‚å‘é€åˆ°æœ¬åœ°ä¸»æœºï¼š8082ï¼Œå°±åƒå‘é€åˆ°å¤–éƒ¨æœåŠ¡ä¸€æ ·ï¼Œä¾‹å¦‚ä½¿ç”¨HTTParty </li><li> ç®€çº¦å“åº”; æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ›´æ”¹ï¼› æˆ‘ä»¬ä»â€œ RequestBinâ€è·å–å·²è®°å½•è¯·æ±‚çš„åˆ—è¡¨å¹¶è¿›è¡Œæ£€æŸ¥ã€‚ </li></ol><br><h2> å®æ–½ç»†èŠ‚ï¼š </h2><br> ç°åœ¨ä»‹ç»å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œè®©æˆ‘ä»¬å°†ç»è¿‡æµ‹è¯•çš„æœåŠ¡å‘½åä¸ºâ€œ TheServiceâ€ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºåŒ…è£…å™¨ï¼š <br><br><pre><code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#/spec/support/the_service.rb #ensure that after all specs TheService will be stopped RSpec.configure do |config| config.after :suite do TheServiceControl.stop end end class TheServiceControl class &lt;&lt; self </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment"> = nil </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@config</span></span></span><span class="hljs-comment"> = nil def config puts "Please create file: #{config_path}" unless File.exist?(config_path) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@config</span></span></span><span class="hljs-comment"> = YAML.load_file(config_path) end def host TheServiceControl.config['server']['addr'] end def config_path Rails.root.join('spec', 'support', 'the_service_config.yml') end def start # will be described below end def stop # will be described below end def post(params, headers) HTTParty.post("http://#{host}/request", body: params, headers: headers ) end end end</span></span></code> </pre> <br> ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘ä¼šä¿ç•™ä¸€ç‚¹ï¼Œå³åº”è¯¥åœ¨Rspecä¸­å°†å…¶é…ç½®ä¸ºä»â€œ supportâ€æ–‡ä»¶å¤¹è‡ªåŠ¨åŠ è½½æ–‡ä»¶ï¼š <br><br><pre> <code class="ruby hljs">Dir[Rails.root.join(<span class="hljs-string"><span class="hljs-string">'spec/support/**/*.rb'</span></span>)].each {<span class="hljs-params"><span class="hljs-params">|f|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> f}</code> </pre><br> å¯åŠ¨æ–¹æ³•ï¼š <br><br><ul><li> ä»å•ç‹¬çš„é…ç½®è¯»å–TheServiceæºçš„è·¯å¾„ä»¥åŠè¿è¡Œæ‰€éœ€çš„ä¿¡æ¯ã€‚ å› ä¸º æ­¤ä¿¡æ¯å¯èƒ½ä¸ä¸åŒçš„å¼€å‘äººå‘˜ä¸åŒï¼Œæ­¤é…ç½®ä¸åŒ…å«åœ¨Gitä¸­ã€‚ ç›¸åŒçš„é…ç½®åŒ…å«å¯åŠ¨ç¨‹åºæ‰€éœ€çš„è®¾ç½®ã€‚ è¿™äº›å¼‚æ„é…ç½®ä½äºä¸€ä¸ªä½ç½®ï¼Œä»¥å…äº§ç”Ÿé¢å¤–çš„æ–‡ä»¶ã€‚ <br></li><li> é€šè¿‡â€œè¿è¡Œ{è¿è¡Œåˆ°main.goçš„è·¯å¾„} {é…ç½®çš„è·¯å¾„}â€ç¼–è¯‘å¹¶è¿è¡Œç¨‹åº </li><li> æ¯ç§’è½®è¯¢ä¸€æ¬¡ï¼Œç›´åˆ°è¿è¡Œçš„ç¨‹åºå‡†å¤‡å¥½æ¥å—è¯·æ±‚ä¸ºæ­¢ <br></li><li> è®°ä½è¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œä»¥ä¾¿ä¸é‡æ–°å¯åŠ¨å¹¶èƒ½å¤Ÿåœæ­¢å®ƒã€‚ </li></ul><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#/spec/support/the_service.rb class TheServiceControl #.... def start return unless </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment">.nil? puts "TheService starting. " env = config['rails']['env'] cmd = "go run #{config['rails']['main_go']} --config.file=#{config_path}" puts cmd #useful for debug when need run project manually #compile and run Dir.chdir(File.dirname(config['rails']['main_go'])) { </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment"> = Process.spawn(env, cmd, pgroup: true) } #wait until it ready to accept connections VCR.configure { |c| c.allow_http_connections_when_no_cassette = true } 1.upto(10) do response = HTTParty.get("http://#{host}/monitor") rescue nil break if response.try(:code) == 200 sleep(1) end VCR.configure { |c| c.allow_http_connections_when_no_cassette = false } puts "TheService started. PID: #{</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment">}" end #.... end</span></span></code> </pre><br> é…ç½®æœ¬èº«ï¼š <br><br><pre> <code class="hljs pgsql">#/spec/support/the_service_config.yml <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>: addr: <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8082</span></span> db: dsn: dbname=project_test sslmode=<span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>=postgres <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>=secret redis: url: redis://<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">6379</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> rails: main_go: /home/me/go/src/github.com/company/theservice/main.go recorder_addr: <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8083</span></span> env: <span class="hljs-type"><span class="hljs-type">PATH</span></span>: <span class="hljs-string"><span class="hljs-string">'/home/me/.gvm/gos/go1.10.3/bin'</span></span> GOROOT: <span class="hljs-string"><span class="hljs-string">'/home/me/.gvm/gos/go1.10.3'</span></span> GOPATH: <span class="hljs-string"><span class="hljs-string">'/home/me/go'</span></span></code> </pre><br>  stopæ–¹æ³•åªæ˜¯åœæ­¢è¯¥è¿‡ç¨‹ã€‚ æ–°äº‹ç‰©æ˜¯rubyè¿è¡Œâ€œ go runâ€å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åœ¨IDæœªçŸ¥çš„å­è¿›ç¨‹ä¸­è¿è¡Œç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å¦‚æœä»…åœæ­¢ä»rubyå¯åŠ¨çš„è¿›ç¨‹ï¼Œåˆ™å­è¿›ç¨‹ä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå¹¶ä¸”ç«¯å£ä»å¤„äºç¹å¿™çŠ¶æ€ã€‚ å› æ­¤ï¼Œé€šè¿‡è¿›ç¨‹ç»„IDåœæ­¢ï¼š <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#/spec/support/the_service.rb class TheServiceControl #.... def stop return if </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment">.nil? print "Stopping TheService (PID: #{</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment">}). " Process.kill("KILL", -Process.getpgid(</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment">)) res = Process.wait </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@pid</span></span></span><span class="hljs-comment"> = nil puts "Stopped. #{res}" end #.... end</span></span></code> </pre><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†å‡†å¤‡ä¸€ä¸ªshared_contextï¼Œåœ¨å…¶ä¸­å®šä¹‰é»˜è®¤å˜é‡ï¼Œå¦‚æœå°šæœªå¯åŠ¨ï¼Œåˆ™å¯åŠ¨TheServiceï¼Œå¹¶æš‚æ—¶ç¦ç”¨VCRï¼ˆä»ä»–çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä½†å¯¹äºæˆ‘ä»¬æ¥è¯´ä¸æ˜¯è¿™æ ·ï¼‰ï¼š <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#spec/support/shared_contexts/the_service_black_box.rb shared_context 'the_service_black_box' do let(:params) do { type: 'save', data: 1 } end let(:headers) { { 'HTTPS' =&gt; 'on', 'Content-Type' =&gt; 'application/json; charset=utf-8' } } subject(:response) { TheServiceControl.post(params, headers)} before(:all) { TheServiceControl.start } around(:each) do |example| VCR.configure { |c| c.allow_http_connections_when_no_cassette = true } example.run VCR.configure { |c| c.allow_http_connections_when_no_cassette = false } end end</span></span></code> </pre><br> ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹è‡ªå·±ç¼–å†™è§„èŒƒäº†ï¼š <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#spec/requests/the_service/ping_spec.rb require 'spec_helper' describe 'ping request' do include_context 'the_service_black_box' it 'returns response back' do params[:type] = 'ping' params[:data] = '123' parsed_response = JSON.parse(response.body) # make request and parse response expect(parsed_response['error']).to be nil expect(parsed_response['result']).to eq '123' expect(Log.count).to eq 1 #check something in DB end # more specs... end</span></span></code> </pre><br>  TheServiceå¯ä»¥å‘å¤–éƒ¨æœåŠ¡å‘å‡ºå…¶HTTPè¯·æ±‚ã€‚ ä½¿ç”¨é…ç½®ï¼Œæˆ‘ä»¬å°†é‡å®šå‘åˆ°ä¸€ä¸ªå†™å…¥å®ƒä»¬çš„æœ¬åœ°å®ç”¨ç¨‹åºã€‚ è¿˜æœ‰ä¸€ä¸ªç”¨äºå¯åŠ¨å’Œåœæ­¢çš„åŒ…è£…ç¨‹åºï¼Œç±»ä¼¼äºâ€œ TheServiceControlâ€ç±»ï¼Œä¸åŒä¹‹å¤„åœ¨äºè¯¥å®ç”¨ç¨‹åºæ— éœ€ç¼–è¯‘å³å¯ç›´æ¥å¯åŠ¨ã€‚ <br><br><h2> å¤šä½™çš„é¢åŒ… </h2><br> ç¼–å†™Goåº”ç”¨ç¨‹åºæ˜¯ä¸ºäº†ä½¿æ‰€æœ‰æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯éƒ½æ˜¾ç¤ºåœ¨STDOUTä¸­ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯åŠ¨æ—¶ï¼Œæ­¤è¾“å‡ºå°†å‘é€åˆ°æ–‡ä»¶ã€‚ ä»Rspecå¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ï¼Œè¿™åœ¨è°ƒè¯•æ—¶æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ <br><br> å¦‚æœè§„èŒƒæ˜¯é€‰æ‹©æ€§è¿è¡Œçš„ï¼Œä¸éœ€è¦ä½¿ç”¨TheServiceï¼Œåˆ™å®ƒä¸ä¼šå¯åŠ¨ã€‚ <br><br> ä¸ºäº†é¿å…åœ¨å¼€å‘æ—¶æ¯æ¬¡é‡æ–°å¯åŠ¨è§„èŒƒæ—¶éƒ½æµªè´¹æ—¶é—´å¼€å‘æœåŠ¡ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ï¼Œè€Œä¸å¿…å…³é—­å®ƒã€‚ å¦‚æœ‰å¿…è¦ï¼Œæ‚¨ç”šè‡³å¯ä»¥åœ¨IDEä¸­ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œå®ƒï¼Œç„¶åè¯¥è§„èŒƒå°†å‡†å¤‡æ‚¨éœ€è¦çš„æ‰€æœ‰å†…å®¹ï¼Œå¼•å‘å¯¹æœåŠ¡çš„è¯·æ±‚ï¼Œå®ƒå°†åœæ­¢å¹¶ä¸”æ‚¨å¯ä»¥æ¯«ä¸è´¹åŠ›åœ°é™ä½æ€§èƒ½ã€‚ è¿™ä½¿å¾—TDDæ–¹æ³•éå¸¸æ–¹ä¾¿ã€‚ <br><br><h2> ç»“è®º </h2><br> è¿™æ ·çš„è®¡åˆ’å·²ç»è¿ä½œäº†å¤§çº¦ä¸€å¹´ï¼Œå¹¶ä¸”ä»æœªå¤±è´¥ã€‚ è§„èŒƒæ¯”Goä¸Šçš„å•å…ƒæµ‹è¯•æ›´å…·å¯è¯»æ€§ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºæœåŠ¡å†…éƒ¨ç»“æ„çš„çŸ¥è¯†ã€‚ å¦‚æœç”±äºæŸç§åŸå› ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å¦ä¸€ç§è¯­è¨€é‡å†™æœåŠ¡ï¼Œåˆ™é™¤äº†åŒ…è£…ç¨‹åºï¼ˆåŒ…è£…ç¨‹åºåªéœ€ä½¿ç”¨å¦ä¸€æ¡å‘½ä»¤å¯åŠ¨æµ‹è¯•æœåŠ¡ï¼‰å¤–ï¼Œæˆ‘ä»¬å°±æ— éœ€æ›´æ”¹è§„æ ¼ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427951/">https://habr.com/ru/post/zh-CN427951/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427941/index.html">ä½¿ç”¨Kubeadmå’ŒKeepalivedåœ¨Baremetalä¸Šéƒ¨ç½²Kubernetes HAé›†ç¾¤ï¼ˆç®€å•æŒ‡å—ï¼‰</a></li>
<li><a href="../zh-CN427943/index.html">æˆ‘ä»¬æ­£åœ¨ç­‰å¾…2019å¹´6æœˆçš„ä¸²è¡Œ8K OLED LGç”µè§†ï¼Œå‘å¸ƒå¯èƒ½ä¼šå»¶è¿Ÿ</a></li>
<li><a href="../zh-CN427945/index.html">è™šæ‹Ÿæœºç®¡ç†ç¨‹åº</a></li>
<li><a href="../zh-CN427947/index.html">ç¥ç»ç½‘ç»œä¸äº†è§£ä»€ä¹ˆæ˜¯å…‰å­¦é”™è§‰ã€‚</a></li>
<li><a href="../zh-CN427949/index.html">æˆ‘ä»¬ä¸æ„¿æ”¹å˜ï¼Œä½¿æˆ‘ä»¬æ— æ³•ç†è§£ç»Ÿè®¡æ•°æ®ã€‚</a></li>
<li><a href="../zh-CN427953/index.html">å¾®æœåŠ¡ä½¿ä¸–ç•Œæ›´è½»æ¾ï¼ˆä½†å¹¶éå¦‚æ­¤ï¼‰</a></li>
<li><a href="../zh-CN427955/index.html">ä¸ºä»€ä¹ˆæˆ‘ä¸ä½¿ç”¨æ•…äº‹ç‚¹è¿›è¡Œå†²åˆºè®¡åˆ’</a></li>
<li><a href="../zh-CN427957/index.html">TLSä¸Šçš„DNS-ä½¿ç”¨Stunnelå’ŒLuaåŠ å¯†æˆ‘ä»¬çš„DNSæŸ¥è¯¢</a></li>
<li><a href="../zh-CN427959/index.html">çœ‹çœ‹ï¼šåšäº†ä¸€å¼ æ¡Œå­</a></li>
<li><a href="../zh-CN427961/index.html">Yandexå¦‚ä½•å°è¯•å¤åˆ¶æˆ‘çš„çƒ­å›¾æœåŠ¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>