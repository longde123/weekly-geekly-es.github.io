<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠êÔ∏è üë©üèΩ‚Äçüéì ü•í Wie man aus zwei Codezeilen 200 macht und warum Sie dies tun m√ºssen üèéÔ∏è ü¶à üë®üèΩ‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo an alle. 


 Ich (wir als Unternehmen) beende die Plattform vom Lieferanten, die Plattform ist ein Plugin f√ºr WordPress. Ich kenne das Frontend,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man aus zwei Codezeilen 200 macht und warum Sie dies tun m√ºssen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435216/"><p>  Hallo an alle. </p><br><p>  Ich (wir als Unternehmen) beende die Plattform vom Lieferanten, die Plattform ist ein Plugin f√ºr WordPress.  Ich kenne das Frontend, JS, HTML nur insoweit, als die <strong>oben genannten L√∂sungen m√∂glicherweise nicht lesen und schreiben k√∂nnen, aber das Wesentliche des Artikels ist nicht das</strong> . </p><br><p>  Die Quintessenz soll klar zeigen, warum es manchmal die richtige Entscheidung w√§re, anstelle von zwei Codezeilen zweihundert zu schreiben. </p><br><p>  Anf√§ngliche Entwickler und Entwickler mit Erfahrung, f√ºr die ein solcher Gedanke zweifelhaft erscheint, frage ich unter Katze. </p><a name="habracut"></a><br><h2 id="vvedenie">  Einf√ºhrung </h2><br><p>  Das Lesen des Artikels ohne Lesen der Kommentare im Code ist nicht sinnvoll, da die Kommentare im Code nicht im Text des Artikels dupliziert werden und der Text des Artikels impliziert, dass der Leser die Kommentare gelesen hat. </p><br><h2 id="zadacha">  Herausforderung </h2><br><p>  Es war notwendig, √Ñnderungen an JS vorzunehmen. Ich nehme die √Ñnderungen in separaten Dateien vor, damit der Quellcode des Plattformanbieters so wenig wie m√∂glich "verschmutzt" wird, sodass es in Zukunft einfacher sein wird, die Aktualisierungen der Plattformquellen anzupassen. </p><br><p>  Dementsprechend befindet sich der Code der neuen Funktionalit√§t in neuen Dateien, die auf die Seite geladen werden m√ºssen. </p><br><p> Aufgabe: Beim Laden der Seite m√ºssen bestimmte Dateien geladen werden. </p><br><h2 id="pervyy-blin-komom">  Der erste Pfannkuchen ist klumpig </h2><br><pre><code class="xml hljs">+<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e-cryptex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> +<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wp-content/themes/tol-child/js/child_realforex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (Zeilen mit "+" sind neue Zeilen im Quellcode) </p><br><p>  Die L√∂sung wurde f√ºr die Hauptseite getestet und funktionierte dort. Sp√§ter stellte sich heraus, dass die L√∂sung f√ºr Seiten mit der Adresse example.com/about nicht funktionierte, da der Browser versuchte, example.com/about/e-cryptex.js zu laden, und der Browser einen Fehler 404 erhielt , weil sich die Datei wirklich im Stammverzeichnis befand - example.com/e-cryptex.js. </p><br><h2 id="vtoroy-variant">  Zweite Option </h2><br><p>  Ich habe mir angesehen, wie die Plattformentwickler an der Seite festhalten: </p><br><pre> <code class="php hljs">wp_register_script(FILE-ID,FILE-PATH); wp_enqueue_script(FILE-ID);</code> </pre> <br><p>  Dateien werden mit der WordPress-Funktionalit√§t angeh√§ngt - ok, machen wir dasselbe: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -&lt;script src="e-cryptex.js"&gt;&lt;/script&gt; -&lt;script src="wp-content/themes/tol-child/js/child_realforex.js"&gt;&lt;/script&gt; //  : +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> +const E_CRYPTEX_JS ='e-cryptex_js'; +wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); +wp_enqueue_script(E_CRYPTEX_JS); +const CHILD_REALFOREX_JS = 'child_realforex_js'; +wp_register_script( + CHILD_REALFOREX_JS, + '/wp-content/themes/tol-child/js/child_realforex.js', + array(E_CRYPTEX_JS), + null); +wp_enqueue_script(CHILD_REALFOREX_JS); +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  (Zeilen mit "+" sind neue Zeilen im Quellcode, Zeilen mit "-" sind Zeilen, die aus dem Quellcode gel√∂scht wurden). </p><br><p>  √úberpr√ºft - funktioniert, ca. </p><br><p>  Es gab zwei Zeilen - es wurden 12, alle in derselben Datei. </p><br><h2 id="refaktoring">  Refactoring </h2><br><p>  Ich sah mir diesen Code an und mein Sinn f√ºr Sch√∂nheit rebellierte: </p><br><ul><li>  Eine Person, die nicht mit WordPress vertraut ist, wird nichts verstehen - Sie m√ºssen in das Verzeichnis gehen, um den Zweck der Funktionen wp_register_script () und wp_enqueue_script () zu verstehen </li><li>  Offensichtlich wird dasselbe zweimal hintereinander gemacht, die Argumente sind nur unterschiedlich - DRY wird verletzt </li></ul><br><p>  Ok, Refactor. </p><br><p>  Erstens erstellen wir eine Klasse (eine Datei) und zweitens verbinden wir die Klasse und verwenden sie (wir √§ndern eine andere Datei). </p><br><h3 id="delaem-klass">  Klasse machen </h3><br><pre> <code class="php hljs">+<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migesco</span></span></span><span class="hljs-class"> </span></span>{ + + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SCRIPT = <span class="hljs-string"><span class="hljs-string">'script'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOURCE = <span class="hljs-string"><span class="hljs-string">'source'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEPENDENCY = <span class="hljs-string"><span class="hljs-string">'dependency'</span></span>; + <span class="hljs-comment"><span class="hljs-comment">//   ,      'configuration.js', //     ""   . + static function attachConfigurationJS(){ + $configurationFiles = array( + array(Migesco::SCRIPT =&gt; 'configuration.js', + Migesco::SOURCE=&gt;'/configuration.js')); + Migesco::includeScriptFiles($configurationFiles); + } //              + static function includeScriptFiles($scriptFiles){ + foreach ($scriptFiles as $scriptFile){ + $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) + ? $scriptFile[self::DEPENDENCY] + : array(); + self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); + } + } //    , //    "",     // (     ) + static function includeScript($id,$source,$dependency){ + wp_register_script($id,$source,$dependency,null); + wp_enqueue_script($id); + } +}</span></span></code> </pre> <br><h3 id="podklyuchaem-i-ispolzuem">  Wir verbinden und nutzen </h3><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//: -const E_CRYPTEX_JS ='e-cryptex_js'; -wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); -wp_enqueue_script(E_CRYPTEX_JS); -const CHILD_REALFOREX_JS = 'child_realforex_js'; -wp_register_script( - CHILD_REALFOREX_JS, - '/wp-content/themes/tol-child/js/child_realforex.js', - array(E_CRYPTEX_JS), - null); -wp_enqueue_script(CHILD_REALFOREX_JS); // : //  +require_once(ABSPATH . 'configuration.php'); //  +const ECRYPTEX_JS = 'cryptex'; +const TRADEROOM_SCRIPT_FILES = array( + array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, + Migesco::SOURCE=&gt;'/e-cryptex.js'), + array(Migesco::SCRIPT =&gt; 'child_realforex', + Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', + Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) +); +Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  Es gab 12 Zeilen mit Quellcodes in einer Datei, es gab 35 und in zwei (unterst√ºtzen Sie es sp√§ter, suchen Sie nach Amtsleitungen, die Sie sonst reparieren k√∂nnen, um nichts zu vergessen, nicht zu verpassen, nicht zu verpassen). </p><br><h2 id="i-eschyo-raz-refaktring">  Und wieder umgestalten </h2><br><p>  Sah den neuen Code an: </p><br><ul><li>  einige statische Methoden </li><li>  einige Konstanten ... </li></ul><br><p>  sieht ungeschickt aus!  Ich erinnere mich an den folgenden Rat: "Wenn der Konstruktor keine Argumente hat, wird eine solche Klasse ben√∂tigt?" </p><br><p>  Lassen Sie uns neu erstellen, aber eine normale Klasse mit einem normalen Konstruktor und Methoden. </p><br><h3 id="klass">  Klasse </h3><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -class Migesco { - - const SCRIPT = 'script'; - const SOURCE = 'source'; - const DEPENDENCY = 'dependency'; - - static function attachConfigurationJS(){ - $configurationFiles = array( - array(Migesco::SCRIPT =&gt; 'configuration.js', - Migesco::SOURCE=&gt;'/configuration.js')); - Migesco::includeScriptFiles($configurationFiles); - } - static function includeScriptFiles($scriptFiles){ - foreach ($scriptFiles as $scriptFile){ - $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) - ? $scriptFile[self::DEPENDENCY] - : array(); - self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); - } - } - static function includeScript($id,$source,$dependency){ - wp_register_script($id,$source,$dependency,null); - wp_enqueue_script($id); - } -} //: //      : //   //   //    //       +namespace Migesco; + + //      html- +class Configurator +{ //               + static function attachConfigurationJS() + { + $configurationFiles = array( + (new WebResource('configuration.js'))-&gt;setSource('/configuration.js')); + self::attachFiles($configurationFiles); + } + //      html- + static function attachFiles($resourceList) + { + (new Registrar($resourceList))-&gt;toRegistrate(); + } +} + //      html- +class Registrar +{ //     + public $list = array(); //     private (   ) + /** @var WebResource $resource */ + public $resource = null; + + public function __construct($list) + { + $isArray = is_array($list); + if ($isArray) { + $this-&gt;list = $list; + } + } + //      WordPress + function registerScript() + { + wp_register_script( + $this-&gt;resource-&gt;getName(), + $this-&gt;resource-&gt;getSource(), + $this-&gt;resource-&gt;getDependency(), + null); + } + //     + function enqueueScript() + { + wp_enqueue_script($this-&gt;resource-&gt;getName()); + } + //      + function toRegistrate() + { + $result = false; + foreach ($this-&gt;list as $resource) { + /** @var WebResource $resource */ + $isResource = $resource instanceof WebResource; + if ($isResource) { + $this-&gt;resource = $resource; + $this-&gt;registerScript(); + $this-&gt;enqueueScript(); + + $result = true; + } + } + return $result; + } +} + //     +class WebResource +{ //    + public $source = ''; //   + public $name = ''; //   + public $dependency = array(); + + public function __construct($name) + { + $this-&gt;setName($name); + } + + /** + * @param string $source + * @return WebResource + */ + public function setSource($source) + { + $this-&gt;source = strval($source); + return $this; + } + + /** + * @param string $name + * @return WebResource + */ + public function setName($name) + { + $this-&gt;name = strval($name); + return $this; + } + + /** + * @param array $dependency + * @return WebResource + */ + public function setDependency($dependency) + { + $isArray = is_array($dependency); + if ($isArray) { + $this-&gt;dependency = $dependency; + } + return $this; + } + + /** + * @return string + */ + public function getSource() + { + return $this-&gt;source; + } + + /** + * @return string + */ + public function getName() + { + return $this-&gt;name; + } + + /** + * @return array + */ + public function getDependency() + { + return $this-&gt;dependency; + } +}</span></span></code> </pre> <br><h3 id="ispolzovanie">  Verwenden Sie </h3><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// : -const TRADEROOM_SCRIPT_FILES = array( - array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, - Migesco::SOURCE=&gt;'/e-cryptex.js'), - array(Migesco::SCRIPT =&gt; 'child_realforex', - Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', - Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) -); -Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); // : +$traderoomScriptFiles = array( + (new Migesco\WebResource(ECRYPTEX_JS)) + -&gt;setSource('/e-cryptex.js'), + (new Migesco\WebResource('child_realforex')) + -&gt;setSource('/wp-content/themes/tol-child/js/child_realforex.js') + -&gt;setDependency(array(ECRYPTEX_JS)) +); +Migesco\Configurator::attachFiles($traderoomScriptFiles); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  Sie k√∂nnen das Refactoring erneut durchf√ºhren (die Plattform l√§uft unter PHP 5.6 - Ich w√ºrde die Typen gerne √ºberall festlegen, aber leider nicht. Sie k√∂nnen die statische Konfiguratorklasse menschlicher gestalten, z. B. anhand einer Liste von Dateien initialisieren - Webressourcen und die Methode attachFiles statisch), aber die idealen Dinge f√ºr eine ideale Welt, wir leben in der Realit√§t, und es nimmt seine eigenen Korrekturen vor - die Zeit, die f√ºr die Aufgabe aufgewendet wird - die Arbeit an der Aufgabe wird gestoppt. </p><br><p>  Insgesamt: Es gab 35 Zeilen in der Quelle in zwei Dateien, es wurde ~ 170, auch in zwei Dateien. </p><br><h2 id="chto-my-poluchili-">  Was haben wir bekommen? </h2><br><ol><li>  Jetzt m√ºssen Sie nicht mehr in die WordPress-Hilfe gehen, um den Zweck der "Funktions" -Parameter zu verstehen. </li><li>  Jetzt haben wir einen Wrapper zum Verbinden von Dateien und k√∂nnen den Algorithmus zum Verbinden von Dateien problemlos √§ndern. Wir m√ºssen nicht alle Aufrufe von wp_register_script und wp_enqueue_script bearbeiten </li><li>  Jetzt k√∂nnen wir WordPress in alles √§ndern und nur die Klasse muss neu schreiben <br>  Registrar, es ist nicht erforderlich, alle Aufrufe von wp_register_script und wp_enqueue_script zu ersetzen und der WordPress-Logik zu folgen. </li></ol><br><p>  War es das wert? </p><br><p>  Jeder hat seinen eigenen Ansatz zur Unterst√ºtzung der Codebasis und seine eigene Meinung. </p><br><p>  Meine Antwort lautet ja. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435216/">https://habr.com/ru/post/de435216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435206/index.html">Europa genehmigt Urheberrechtsrichtlinie - warum Streaming-Plattformen dagegen sind</a></li>
<li><a href="../de435208/index.html">Internet der Dinge ... die nach einer guten UI / UX schreien</a></li>
<li><a href="../de435210/index.html">Xamarins Arbeit mit dem C SDK</a></li>
<li><a href="../de435212/index.html">Wie man Papier-Visitenkarten im neuen Jahr vergisst</a></li>
<li><a href="../de435214/index.html">Linux 4.20 ver√∂ffentlicht - was sich in der neuen Kernel-Version ge√§ndert hat</a></li>
<li><a href="../de435220/index.html">Kotlin Native: Verfolgen Sie die Dateien</a></li>
<li><a href="../de435224/index.html">So kommunizieren Sie in einem englischsprachigen B√ºro: 14 n√ºtzliche Redewendungen</a></li>
<li><a href="../de435226/index.html">Stellen Sie die Daten von Grund auf neu her</a></li>
<li><a href="../de435228/index.html">Kubernetes Cluster f√ºr 20 US-Dollar pro Monat</a></li>
<li><a href="../de435234/index.html">Kl√ºger, genauer gesagt: Wie KI Fl√ºge in den Weltraum ver√§ndert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>