<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•ºğŸ¼ ğŸ”¦ ğŸ˜« ä½¿ç”¨ç”¨æˆ·å¸æˆ·æ—¶çš„æŸäº›PowerShellåŠŸèƒ½ ğŸ‘Œ ğŸ“» ğŸ‚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¥ä¸ºæˆ‘åœ¨Powershellæ–¹é¢éå¸¸æ“…é•¿ï¼Œä½†æ˜¯æˆ‘ä»æ¥ä¸éœ€è¦ä½¿ç”¨ç”¨æˆ·å‡­æ®ã€‚ ä½†æ˜¯ï¼Œç°åœ¨æˆ‘æ­£åœ¨æ‰¾å·¥ä½œï¼Œåœ¨ä¸€æ¬¡é¢è¯•ä¸­ï¼Œæˆ‘è¢«èµ‹äºˆæµ‹è¯•ä»»åŠ¡æ¥ç¼–å†™è„šæœ¬ï¼Œè¯¥è„šæœ¬åº”è¯¥ï¼š 



1. æ£€æŸ¥ç”¨æˆ·å¸æˆ·çš„å¯ç”¨æ€§å’ŒçŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰ã€‚ 
2. æ£€æŸ¥å¸æˆ·æ˜¯å¦åŒ…å«åœ¨ç®¡ç†å‘˜ç»„ä¸­ 
3. å¦‚æœæ²¡æœ‰å¸æˆ·ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨ç”¨æˆ·å¸æˆ·æ—¶çš„æŸäº›PowerShellåŠŸèƒ½</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418859/"> æˆ‘ä»¥ä¸ºæˆ‘åœ¨Powershellæ–¹é¢éå¸¸æ“…é•¿ï¼Œä½†æ˜¯æˆ‘ä»æ¥ä¸éœ€è¦ä½¿ç”¨ç”¨æˆ·å‡­æ®ã€‚ ä½†æ˜¯ï¼Œç°åœ¨æˆ‘æ­£åœ¨æ‰¾å·¥ä½œï¼Œåœ¨ä¸€æ¬¡é¢è¯•ä¸­ï¼Œæˆ‘è¢«èµ‹äºˆæµ‹è¯•ä»»åŠ¡æ¥ç¼–å†™è„šæœ¬ï¼Œè¯¥è„šæœ¬åº”è¯¥ï¼š <br><br><ol><li> æ£€æŸ¥ç”¨æˆ·å¸æˆ·çš„å¯ç”¨æ€§å’ŒçŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰ã€‚ </li><li> æ£€æŸ¥å¸æˆ·æ˜¯å¦åŒ…å«åœ¨ç®¡ç†å‘˜ç»„ä¸­ </li><li> å¦‚æœæ²¡æœ‰å¸æˆ·ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ï¼Œé€‰ä¸­â€œç¦æ­¢æ›´æ”¹ç”¨æˆ·å¯†ç â€å’Œâ€œå¯†ç æœªè¿‡æœŸâ€æ¡† </li><li> å¦‚æœè¯¥å¸æˆ·å­˜åœ¨ï¼Œä½†å·²è¢«ç¦ç”¨æˆ–æœªåŒ…å«åœ¨Administratorsç»„ä¸­ï¼Œåˆ™å¯ç”¨è¯¥å¸æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°Administratorsç»„ä¸­ï¼Œé€‰ä¸­â€œæ‹’ç»ç”¨æˆ·å¯†ç æ›´æ”¹â€å’Œâ€œå¯†ç æœªè¿‡æœŸâ€æ¡† </li><li> è¯¥è„šæœ¬ä¸åº”ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„è¯­è¨€ã€‚ </li></ol><br><a name="habracut"></a><br> æˆ‘ä»¥ä¸ºæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šæ£€æŸ¥çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®¡ç®—æœºä¸Šçš„Adminç”¨æˆ·ã€‚ æˆ‘ä¸‰æ€è€Œåè¡Œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span></code> </pre> <br> ç„¶åæˆ‘å¾—åˆ°ä¸€ä¸ªé”™è¯¯ <br><br> <font color="#ff0000"><code>Get-User :  "Get-User"     , ,     .</code></font> <br> <br> æ„Ÿåˆ°æœ‰äº›åƒæƒŠï¼Œå› ä¸ºæˆ‘ä¸è®¤è¯†è¿™æ ·æœ‰ç”¨çš„å‘½ä»¤ï¼Œå¹¶å‘ç°<b>Get-User</b>å‘½ä»¤ä»…åœ¨Powershell Console for Exchangeä¸­æœ‰æ•ˆã€‚ è¦ä½¿ç”¨æœ¬åœ°ç”¨æˆ·ï¼Œå¿…é¡»ä½¿ç”¨<b>Get-Localuser</b> ï¼Œå¯¹äºåŸŸ<b>ç”¨æˆ·</b>å¿…é¡»ä½¿ç”¨<b>Get-Aduser</b> ã€‚ æ„è¯†åˆ°è‡ªå·±çš„é”™è¯¯ï¼Œæˆ‘å¼€è½¦å»äº†ï¼š <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-Localuser <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span></code> </pre> <br> å¹¶å¾—åˆ°äº†ç­”æ¡ˆ <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">Name</span></span> Enabled Description <span class="hljs-comment"><span class="hljs-comment">---- ------- ----------- Admin True     /</span></span></code> </pre> <br> å¥½å§ï¼Œç°åœ¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨è¿™é‡Œå¹¶ä¸é‡è¦ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæˆ‘å†æ¬¡åœ¨ç­‰å¾…å¦ä¸€ä¸ªå‘ç°ã€‚ äº‹å®è¯æ˜ï¼Œä½¿ç”¨æ¡ä»¶ifè¯­å¥å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚ <br><br> äº‹å®æ˜¯ï¼Œå¦‚æœç”¨æˆ·åœ¨ç³»ç»Ÿä¸­ï¼Œåˆ™è¾“å‡ºçš„å€¼ä¸æ˜¯trueï¼Œè€Œæ˜¯å¯ç”¨æˆ–ç¦ç”¨æ­¤å¸æˆ·çš„å®Œæ•´æ•°æ®é›†ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„åç§°ï¼Œæè¿°ã€‚ å¦‚æœæ²¡æœ‰ç”¨æˆ·ï¼Œåˆ™powershellä¼šå¼•å‘é”™è¯¯ã€‚ åœ¨Internetä¸Šé—²é€›ä¹‹åï¼Œæˆ‘å‘ç°å‡ºäºè¿™äº›ç›®çš„ï¼Œæœ€å¥½ä½¿ç”¨<b>try catch</b>è¿ç®—ç¬¦ã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red }</code> </pre> <br> æˆ‘æ·»åŠ äº†$ç”¨æˆ·å˜é‡ï¼Œä½¿æ›´æ”¹æ•´ä¸ªè„šæœ¬ä¸­çš„ç”¨æˆ·åæ›´åŠ å®¹æ˜“ã€‚  ErrorAction Stopæ˜¯å¿…éœ€çš„ï¼Œå› æ­¤è„šæœ¬ä¸ä¼šç”±äºé”™è¯¯è€Œåœ¨æ­¤æ­¥éª¤ä¸­ä¸­æ–­ã€‚ ç­¾å| åˆ†éš”ç®¡é“æ­¥éª¤ï¼ŒOut-Nullå°†éšè—é”™è¯¯æ–‡æœ¬è¾“å‡ºã€‚ æˆ‘è¿˜æ·»åŠ äº†å¸¦æœ‰çªå‡ºæ˜¾ç¤ºçš„æ–‡æœ¬è¾“å‡ºï¼Œä»¥æ–¹ä¾¿æ£€æŸ¥è„šæœ¬ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘æƒ³æ£€æŸ¥è¯¥å¸æˆ·æ˜¯å¯ç”¨è¿˜æ˜¯ç¦ç”¨ã€‚ æ­£å¦‚æˆ‘å·²ç»è¯´è¿‡çš„ï¼ŒGet-LocalUserå‘½ä»¤ç”Ÿæˆä¸€æ•´å¥—æ•°æ®ï¼Œä¸ºäº†è¿›è¡ŒéªŒè¯ï¼Œæˆ‘åªéœ€è¦é€‰æ‹©ä¸€ä¸ªå€¼ä¸ºtrueæˆ–falseçš„Enabledå‚æ•°ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº†ä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="hljs powershell">(<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled</code> </pre> <br> ç¡®ä¿å…¶æ­£å¸¸å·¥ä½œåï¼Œæˆ‘è¿›è¡Œäº†ä»¥ä¸‹æ£€æŸ¥å¹¶æ·»åŠ äº†ç”¨æˆ·å¯ç”¨å‘½ä»¤ã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-string"><span class="hljs-string">"True"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Enable-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br> è¦å¯ç”¨ç”¨æˆ·ï¼Œè‡ªç„¶æœ‰å¿…è¦åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿è¡Œæ§åˆ¶å°ã€‚ <br><br> åœ¨ä»»åŠ¡çš„ç¬¬äºŒæ®µä¸­ï¼Œæœ‰å¿…è¦ç¡®å®šç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜ç»„çš„æˆå‘˜ã€‚ è¦æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨ç‰¹å®šç»„ä¸­ï¼Œæœ‰ä¸€ä¸ªGet-LocalGroupMemberå‘½ä»¤ã€‚ ä½†æ˜¯ï¼Œç®¡ç†å‘˜ç»„çš„åç§°ä¸æ“ä½œç³»ç»Ÿçš„è¯­è¨€ä¸åŒã€‚ å› æ­¤ï¼Œæˆ‘ä¸å¾—ä¸ä½¿ç”¨æ ‡å‡†çš„SID S-1-5-32-544ã€‚ æˆ‘ä¹Ÿå°è¯•äº†ä¸€ä¸‹ã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br> å¦‚æœç”¨æˆ·ä¸æ˜¯è¯¥ç»„çš„æˆå‘˜ï¼Œåˆ™å°†ç®¡ç†å‘˜æ·»åŠ åˆ°è¯¥ç»„ä¸­ã€‚ <br> åœ¨ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘çš„ä»»åŠ¡æ˜¯ç¡®å®šç”¨æˆ·æ˜¯å¦ç¦ç”¨äº†å¯†ç æ›´æ”¹è®¾ç½®ã€‚ ç„¶åæˆ‘é‡åˆ°äº†å¦ä¸€ä¸ªé™·é˜±ã€‚ äº‹å®æ˜¯ï¼Œå¦‚æœç”¨æˆ·å…·æœ‰ä¸å—é™åˆ¶çš„å¯†ç ï¼Œåˆ™PasswordExpireså‚æ•°ä¸ä¼šè¿”å›ä»»ä½•å€¼ã€‚ å¹¶ä¸”å¦‚æœç¦ç”¨æ­¤å¤é€‰æ¡†ï¼Œåˆ™ä¸åŒçš„ç”¨æˆ·å°†å…·æœ‰ä¸åŒçš„å¯†ç æ›´æ”¹æ—¥æœŸã€‚ æˆ‘ä»ç„¶æƒ³å‡ºäº†ä¸€ç§è§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•ï¼š <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).PasswordExpires <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$null</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">set-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚ æˆ‘ä¹Ÿæ²¡æƒ³åˆ°è¿™é‡Œä¹Ÿä¸ä¼šç­‰åˆ°æˆ‘ã€‚ ä½¿ç”¨å‘½ä»¤åˆ›å»ºç”¨æˆ·æ—¶ <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> P@ssW0rD!</code> </pre> <br> è¿”å›é”™è¯¯ï¼š <br><br> <font color="#ff0000"><code>    "Password".     "P@ssW0rD!"  "System.String"   "System.Security.SecureString".</code></font> <br> <br> äº‹å®æ˜¯-passwordå‚æ•°åº”è¯¥ä½¿ç”¨SecureStringè€Œä¸æ˜¯é€šå¸¸çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚ ä¸ºæ­¤ï¼Œæˆ‘åˆ¶ä½œäº†$ passwordå˜é‡å¹¶å°†å…¶è½¬æ¢ä¸ºsecurestringã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">convertto-securestring</span></span> <span class="hljs-string"><span class="hljs-string">"P@ssW0rD!"</span></span> <span class="hljs-literal"><span class="hljs-literal">-asplaintext</span></span> <span class="hljs-literal"><span class="hljs-literal">-force</span></span></code> </pre> <br> å’Œè„šæœ¬æœ¬èº«æ¥åˆ›å»ºç”¨æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span></code> </pre> <br> å®Œæˆçš„è„šæœ¬è€ƒè™‘äº†æˆ‘é€šè¿‡è¿™ç§æ–¹å¼è·å¾—çš„æ‰€æœ‰æ¡ä»¶ï¼š <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">convertto-securestring</span></span> <span class="hljs-string"><span class="hljs-string">"P@ssW0rD!"</span></span> <span class="hljs-literal"><span class="hljs-literal">-asplaintext</span></span> <span class="hljs-literal"><span class="hljs-literal">-force</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> cls <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-string"><span class="hljs-string">"True"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Enable-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).PasswordExpires <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$null</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">set-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { cls <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>       <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br> æŠ•ç¨¿å <br><br> ä½†æ˜¯ï¼Œå°†ç®¡ç†å‘˜å¯†ç å­˜å‚¨åœ¨è„šæœ¬ä¸­å¹¶ä¸æ˜¯æœ€ä½³çš„å®‰å…¨åšæ³•ã€‚ ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¯†ç å“ˆå¸Œï¼Œè€Œä¸æ˜¯å¯†ç æœ¬èº«ã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin1'</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> = <span class="hljs-string"><span class="hljs-string">"01000000d08c9ddf0115d1118c7a00c04fc297eb0100000048baf1b47a72d845b4eeda8659da9fd70000000002000000000010660000000100002000000004d2a3bf03aac92c2e172dc002d1fe8759da4655850462aface5c25f52921e05000000000e8000000002000020000000bfa652b6f7cc6845e3cee1831b54ab93dc272d0b2203024c3de8bc4789a2698a10000000923fb50dcf01125913534d0c1ba6d827400000002757df7d8a8b39c8e84b81323acff1d72419580a0022cf610926e5f081a2e895320088d482eb407f8157aad82f091abee7427b357e871d12238a8f74131238e7"</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">ConvertTo-SecureString</span></span> <span class="hljs-literal"><span class="hljs-literal">-String</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span></code> </pre><br> ä¸ºäº†è·å¾—å¯†ç å“ˆå¸Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">Read-Host</span></span> <span class="hljs-literal"><span class="hljs-literal">-AsSecureString</span></span> <span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">ConvertFrom-SecureString</span></span> <span class="hljs-literal"><span class="hljs-literal">-SecureString</span></span> <span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span></code> </pre> <br> è¦æ±‚ä»é”®ç›˜è¾“å…¥å¯†ç ã€‚ <br><br> è¿˜æœ‰ä¸€ç‚¹å¥–é‡‘å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰ç¦ç”¨çš„è®°å½• <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">Where-Object</span></span> {<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$false</span></span>}</code> </pre> <br> æˆ‘å¸Œæœ›æˆ‘èŠ±è´¹çš„æ—¶é—´å¯ä»¥å¸®åŠ©æŸäººçš„å·¥ä½œã€‚ å¯¹äºæ‚¨è‡ªå·±æ¥è¯´ï¼Œä¸è¦å¿˜è®°è¿™ç§å®è´µçš„ç»éªŒä¼šå¾ˆæœ‰ç”¨ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418859/">https://habr.com/ru/post/zh-CN418859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418849/index.html">2018å¹´8æœˆITé¢†åŸŸäººåŠ›èµ„æºä¸“ä¸šäººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
<li><a href="../zh-CN418851/index.html">å¦‚ä½•ä»¥å„¿ç«¥æ™ºèƒ½æ‰‹è¡¨çš„å½¢å¼è´­ä¹°å®‰å…¨çš„é”™è§‰</a></li>
<li><a href="../zh-CN418853/index.html">æœ‰å…³æ›´æ–°éš”ç¦»è¯äººåŠå…¶åœ¨æ¯”ç‰¹å¸ä¸­é‡‡ç”¨çš„åæœçš„è¯¦ç»†ä¿¡æ¯</a></li>
<li><a href="../zh-CN418855/index.html">å¼€æ”¾å¼ç½‘ç»œç ”è®¨ä¼šâ€œåœ¨Webpack + React + Expressä¸Šåˆ›å»ºåº”ç”¨ç¨‹åºâ€</a></li>
<li><a href="../zh-CN418857/index.html">å‡†å¤‡å®‰è£…SSLè¯ä¹¦</a></li>
<li><a href="../zh-CN418861/index.html">ReactOSç°åœ¨ä»¥BTRFSåˆ†åŒºå¼€å§‹</a></li>
<li><a href="../zh-CN418863/index.html">é€šè¿‡ç¤ºä¾‹äº†è§£æ¸²æŸ“é“å…·</a></li>
<li><a href="../zh-CN418867/index.html">å¥¥æ—åŒ¹å…‹è¿åŠ¨ä¸­çš„åŠ¨æ€ç¼–ç¨‹</a></li>
<li><a href="../zh-CN418869/index.html">æ¯”å¬èµ·æ¥å®¹æ˜“ã€‚ ç¬¬9-10ç« </a></li>
<li><a href="../zh-CN418871/index.html">å‡¯æ ¼å°”Â·è‰¾å°”ç»´ï¼ˆKegel Elvieï¼‰å¼ºåŒ–è‚Œè‚‰çš„æ™ºèƒ½æ•™ç»ƒ-ä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>