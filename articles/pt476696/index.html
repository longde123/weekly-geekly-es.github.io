<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìù üë®üèΩ‚Äçüîß ü§ûüèø Como criar e implantar full-stack Reagir aplica√ß√£o üë®‚Äçüî¨ üë¶üèº üå∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Eu represento a sua aten√ß√£o a tradu√ß√£o do artigo ¬´Como construir e implantar uma completa -Stack Reagir-App¬ª Autor Frank Zickert. 

 Os comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como criar e implantar full-stack Reagir aplica√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476696/"> Ol√° Habr!  Eu represento a sua aten√ß√£o a tradu√ß√£o do artigo <a href="https://medium.com/dailyjs/how-to-build-and-deploy-a-full-stack-react-app-4adc46607604">¬´Como construir e implantar uma completa</a> -Stack Reagir-App¬ª Autor Frank Zickert. <br><br>  Os componentes de infraestrutura facilitam a cria√ß√£o, execu√ß√£o e implanta√ß√£o de um aplicativo React completo.  Com esses componentes do React, voc√™ pode se concentrar em escrever a l√≥gica comercial do seu aplicativo.  Voc√™ n√£o tem que se preocupar com a sua configura√ß√£o. <br><br>  Deseja se tornar um desenvolvedor full-stack?  O aplicativo de pilha completa complementa a interface da web interativa React com um servidor e um banco de dados.  Mas este aplicativo requer muito mais op√ß√µes do que uma simples aplica√ß√£o de uma p√°gina. <br><a name="habracut"></a><br>  Usamos <a href="https://www.infrastructure-components.com/">componentes de infraestrutura</a> .  Esses componentes do React nos permitem definir nossa arquitetura de infraestrutura como parte de nosso aplicativo React.  N√≥s n√£o precisamos de quaisquer outras configura√ß√µes, como Webpack, Babel, ou sem servidor. <br><br><h2>  Iniciar </h2><br>  Voc√™ pode configurar seu projeto de tr√™s maneiras: <br><br><ul><li>  Fa√ßa o download do c√≥digo <a href="http://www.infrastructure-components.com/">padr√£o</a> personalizado em <a href="http://www.infrastructure-components.com/">www.infrastructure-components.com</a> , </li><li>  ou clonar este <a href="https://github.com/infrastructure-components/serviceoriented_example">reposit√≥rio GitHub</a> , </li><li>  ou instalar a biblioteca manualmente. Veja este post para mais detalhes. </li></ul><br>  Depois de instalar as depend√™ncias (execute o <code>npm install</code> ), voc√™ poder√° criar o projeto com um comando: <code>npm run build</code> . <br><br>  O script de constru√ß√£o adiciona mais tr√™s scripts ao package.json: <br><br><ul><li>  <code>npm run{your-project-name}</code> } lan√ßamentos Reagir-o seu aplicativo localmente (modo-dev quente, n√£o o servidor e banco de dados) </li><li>  <code>npm run start-{your-env-name}</code> inicia toda a pilha de software localmente.  Nota: O Java 8 JDK √© necess√°rio para executar o banco de dados offline.  <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/install/install_overview.html">Aqui est√° como voc√™ pode instalar o JDK</a> . </li><li>  <code>npm run deploy-{your-env-name}</code> implanta seu aplicativo na AWS. </li></ul><br>  Nota.  Para aplica√ß√µes Implantar nas AWS voc√™ precisa usu√°rio IAM t√©cnica com esses direitos.  Coloque as credenciais do usu√°rio no seu arquivo .env da seguinte maneira: <br><br><pre> <code class="plaintext hljs">AWS_ACCESS_KEY_ID = *** AWS_SECRET_ACCESS_KEY = ***</code> </pre> <br><h2>  Defina sua arquitetura de aplicativo </h2><br>  Projetos baseados em componentes de infraestrutura t√™m uma estrutura clara.  Voc√™ tem um componente de n√≠vel superior.  Ele define a arquitetura global da sua aplica√ß√£o. <br><br>  Subcomponentes (componente controlada) especificar (dilatam) o comportamento da aplica√ß√£o e a fun√ß√£o adicional. <br><br>  No exemplo a seguir, o componente <code>&lt;ServiceOrientedApp /&gt;</code> √© nosso componente de n√≠vel superior.  N√≥s o exportamos como o arquivo padr√£o para nosso arquivo de ponto de entrada ( <code>src / index.tsx)</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ( &lt;ServiceOrientedApp stackName = "soa-dl" buildPath = 'build' region='eu-west-1'&gt; &lt;Environment name="dev" /&gt; &lt;Route path='/' name='My Service-Oriented React App' render={()=&gt;&lt;DataForm /&gt;} /&gt; &lt;DataLayer id="datalayer"&gt; &lt;UserEntry /&gt; &lt;GetUserService /&gt; &lt;AddUserService /&gt; &lt;/DataLayer&gt; &lt;/ServiceOrientedApp&gt; );</code> </pre> <br>  <code>&lt;ServiceOrientedApp /&gt;</code> √© um aplicativo da web interativo.  Voc√™ pode refinar (estender) a funcionalidade do aplicativo usando voc√™ fornecer componentes filhos.  Ele suporta os <code>&lt;DataLayer /&gt;</code> <code>&lt;Environment /&gt;</code> , <code>&lt;Route /&gt;</code> , <code>&lt;Service /&gt;</code> e <code>&lt;DataLayer /&gt;</code> . <br><br>  <code>&lt;Envrionment /&gt;</code> determina o tempo de execu√ß√£o do seu aplicativo.  Por exemplo, voc√™ pode ter a vers√£o dev e prod.  Voc√™ pode executar e implantar cada um separadamente. <br><br>  <code>&lt;Route /&gt;</code> - uma p√°gina de sua aplica√ß√£o.  Ele funciona como um <code>&lt;Route /&gt;</code> para reagir-router.  <a href="https://medium.com/dailyjs/how-to-create-a-navigation-bar-with-react-router-styled-components-and-infrastructure-components-e24bee8d31bb">Aqui est√° um tutorial sobre como trabalhar com rotas</a> . <br><br>  <code>&lt;Service /&gt;</code> define uma fun√ß√£o que √© executada no lado do servidor.  Pode ter um ou v√°rios componentes <code>&lt;Middleware /&gt;</code> - como filhos. <br><br>  <code>&lt;Middleware /&gt;</code> funciona como o Express.js-middleware. <br>  <code>&lt;DataLayer /&gt;</code> adiciona um banco de dados NoSQL ao seu aplicativo.  Aceita &lt;Entry /&gt; - componentes como filhos.  &lt;Entry /&gt; descreve o tipo de itens no seu banco de dados. <br><br>  Esses componentes s√£o tudo o que precisamos para criar nosso aplicativo de pilha completa.  Como voc√™ pode ver, a nossa aplica√ß√£o √©: um ambiente de tempo de execu√ß√£o, uma p√°gina, dois servi√ßos e um banco de dados com uma entrada. <br><br>  estrutura componente fornece uma vis√£o clara de sua aplica√ß√£o.  Quanto maior for a sua aplica√ß√£o fica, mais importante ele √©. <br><br>  Voc√™ deve ter notado que o <code>&lt;Service /&gt;</code> s√£o filhos do <code>&lt;DataLayer /&gt;</code> .  Isso tem uma explica√ß√£o simples.  Queremos que nossos servi√ßos tenham acesso ao banco de dados.  √â realmente assim t√£o simples! <br><br><h2>  projetar bancos de dados </h2><br>  <code>&lt;DataLayer /&gt;</code> cria o Amazon DynamoDB.  Esta base de dados √© uma chave-valor (NoSQL).  Ele fornece alto desempenho em qualquer escala.  Mas em contraste com o banco de dados relacional, ele n√£o suporta consultas complexas. <br><br>  O esquema do banco de dados possui tr√™s campos: <code>primaryKey</code> , <code>rangeKey</code> e <code>data</code> .  Isto √© importante porque voc√™ precisa saber que voc√™ pode encontrar registros somente para as chaves.  Por <code>primaryKey</code> , ou <code>rangeKey</code> , ou ambos. <br><br>  Com esse conhecimento, vamos dar uma olhada no nosso <code>&lt;Entry /&gt;</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> USER_ENTRY_ID = <span class="hljs-string"><span class="hljs-string">"user_entry"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserEntry</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Entry</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">USER_ENTRY_ID</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">primaryKey</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rangeKey</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"userid"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">age:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">GraphQLString</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">address:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">GraphQLString</span></span></span></span><span class="xml"><span class="hljs-tag"> }} /&gt;</span></span></span><span class="xml"> };</span></span></code> </pre> <br>  <code>&lt;Entry /&gt;</code> descreve a estrutura dos nossos dados.  Definimos nomes para nossa primaryKey e rangeKey.  Voc√™ pode usar qualquer nome, exceto algumas palavras-chave do DynamoDB, que voc√™ pode encontrar aqui.  Mas os nomes que usamos s√£o as conseq√º√™ncias funcionais: <br><br><ul><li>  Quando adicionamos itens ao nosso banco de dados, devemos fornecer valores para esses nomes de chave. </li><li>  A combina√ß√£o de ambas as chaves descreve um elemento exclusivo no banco de dados. </li><li>  N√£o deve haver outra &lt;Entrada /&gt; com os mesmos nomes de chave (um nome pode ser o mesmo, mas n√£o ambos). </li><li>  Podemos encontrar os itens no banco de dados somente se tivermos um valor de pelo menos um nome da chave. </li></ul><br>  No nosso exemplo, isso significa que: <br><br><ul><li>  Cada usu√°rio deve ter um nome de usu√°rio e ID de usu√°rio. </li><li>  n√£o pode haver um segundo usu√°rio com o mesmo nome de usu√°rio e o mesmo ID de usu√°rio.  Do ponto de vista do banco de dados, seria bom se dois usu√°rios tivessem o mesmo nome de usu√°rio quando tivessem uma identifica√ß√£o de usu√°rio diferente (ou vice-versa). </li><li>  N√≥s n√£o podemos ter outra &lt;Entrada /&gt; em nosso banco de dados primaryKey = ¬´nome¬ª e rangeKey = ¬´UserID¬ª. </li><li>  Podemos consultar usu√°rios no banco de dados quando temos um nome de usu√°rio ou <code>id</code> usu√°rio.  Mas n√£o podemos pedir para a idade ou endere√ßo. </li></ul><br><h3>  Adicionar itens ao banco de dados </h3><br>  Definimos dois componentes <code>&lt;Service /&gt;</code> em nosso <code>&lt;ServiceOrientedApp /&gt;</code> .  Servi√ßo <code>POST</code> que adiciona o usu√°rio ao banco de dados e servi√ßo <code>GET</code> que recupera o usu√°rio dele. <br><br>  Vamos come√ßar com <code>&lt;AddUserService /&gt;</code> .  Aqui est√° o c√≥digo para este servi√ßo: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { callService, Middleware, mutate, Service, serviceWithDataLayer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"infrastructure-components"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { USER_ENTRY_ID, IUserEntry } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-entry'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ADDUSER_SERVICE_ID = <span class="hljs-string"><span class="hljs-string">"adduser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ADDUSER_SERVICE_ID</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/adduser"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Middleware</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">callback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{serviceWithDataLayer(async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">next</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parsedBody:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">IUserEntry</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">JSON.parse(req.body);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">await</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mutate</span></span></span></span><span class="xml"><span class="hljs-tag">( </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.client</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.setEntryMutation</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">USER_ENTRY_ID</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parsedBody</span></span></span></span><span class="xml"><span class="hljs-tag">) ); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res.status</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">200</span></span></span></span><span class="xml"><span class="hljs-tag">)</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.set</span></span></span></span><span class="xml"><span class="hljs-tag">({ "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Access-Control-Allow-Origin</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> "*", // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Required</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">CORS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">support</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">work</span></span></span></span><span class="xml"><span class="hljs-tag"> })</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.send</span></span></span></span><span class="xml"><span class="hljs-tag">("</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ok</span></span></span></span><span class="xml"><span class="hljs-tag">"); })}/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> };</span></span></code> ; <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { callService, Middleware, mutate, Service, serviceWithDataLayer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"infrastructure-components"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { USER_ENTRY_ID, IUserEntry } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-entry'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ADDUSER_SERVICE_ID = <span class="hljs-string"><span class="hljs-string">"adduser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ADDUSER_SERVICE_ID</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/adduser"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Middleware</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">callback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{serviceWithDataLayer(async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">next</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parsedBody:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">IUserEntry</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">JSON.parse(req.body);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">await</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mutate</span></span></span></span><span class="xml"><span class="hljs-tag">( </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.client</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.setEntryMutation</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">USER_ENTRY_ID</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parsedBody</span></span></span></span><span class="xml"><span class="hljs-tag">) ); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res.status</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">200</span></span></span></span><span class="xml"><span class="hljs-tag">)</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.set</span></span></span></span><span class="xml"><span class="hljs-tag">({ "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Access-Control-Allow-Origin</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> "*", // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Required</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">CORS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">support</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">work</span></span></span></span><span class="xml"><span class="hljs-tag"> })</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.send</span></span></span></span><span class="xml"><span class="hljs-tag">("</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ok</span></span></span></span><span class="xml"><span class="hljs-tag">"); })}/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> };</span></span></code> </pre> <br>  Componente <code>&lt;Service /&gt;</code> - usa tr√™s par√¢metros: <br><br><ul><li>  O identificador ( <code>id</code> ) deve ser string √∫nica.  Usamos um identificador ( <code>id</code> ) quando precisamos chamar o <code>service</code> em outros componentes. </li><li>  O <code>path</code> (com / inicial) indica o caminho relativo da URL do seu servi√ßo </li><li>  O <code>method</code> deve ser um de <code>GET</code> , <code>POST</code> , <code>UPDATE</code> , <code>DELETE</code> .  Ele HTTP-solicita√ß√£o indica que usamos ao chamar o servi√ßo. </li></ul><br>  Adicionamos <code>&lt;Middleware /&gt;</code> quando crian√ßa.  Este <code>&lt;Middleware /&gt;</code> aceita uma fun√ß√£o de retorno de chamada como par√¢metro.  Poder√≠amos fornecer diretamente o middleware Express.js.  Como queremos acessar o banco de dados, <code>serviceWithDataLayer</code> fun√ß√£o em <code>serviceWithDataLayer</code> .  Isso adiciona <code>dataLayer</code> como o primeiro par√¢metro para o nosso retorno. <br><br>  <code>DataLayer</code> fornece acesso ao banco de dados.  Vamos ver como! <br><br>  A fun√ß√£o <code>mutate</code> ass√≠ncrona aplica as altera√ß√µes aos dados em nosso banco de dados.  Isso requer um cliente e um comando de muta√ß√£o como par√¢metros. <br><br>  Os dados do elemento s√£o um objeto Javascript que possui todos os pares de valores-chave necess√°rios.  Em nosso servi√ßo, obtemos esse objeto do corpo da solicita√ß√£o.  Para <code>User</code> objeto tem a seguinte estrutura: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IUserEntry { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">userid</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: string }</code> </pre> <br>  Este objeto usa os nomes <code>primaryKey</code> e <code>rangeKey</code> e todas as chaves de dados que definimos em <code>&lt;Entry /&gt;</code> . <br><br>  Nota: por enquanto, o √∫nico tipo suportado √© uma sequ√™ncia que corresponde a GraphQLString na defini√ß√£o de &lt;Entry /&gt;. <br>  Mencionamos acima que <code>IUserEntry</code> dados <code>IUserEntry</code> do corpo.  Como est√° indo isso? <br><br>  Os componentes de infraestrutura fornecem a fun√ß√£o ass√≠ncrona <code>callService (serviceId, dataObject)</code> .  Essa fun√ß√£o aceita um identificador de servi√ßo, um objeto Javascript (para enviar como um corpo de solicita√ß√£o ao usar <code>POST</code> ), uma fun√ß√£o de <code>success</code> e uma fun√ß√£o de retorno de chamada de erro. <br><br>  O seguinte snippet mostra como usamos essa fun√ß√£o para chamar nosso <code>&lt;AddUserService /&gt;</code> .  N√≥s especificamos <code>serviceId</code> .  E passamos <code>userData</code> , que tomamos como par√¢metro para nossa fun√ß√£o. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callAddUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userData: IUserEntry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callService( ADDUSER_SERVICE_ID, userData, (data: any) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"received data: "</span></span>, data); }, (error) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"error: "</span></span> , error) } ); };</code> ) { <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callAddUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userData: IUserEntry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callService( ADDUSER_SERVICE_ID, userData, (data: any) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"received data: "</span></span>, data); }, (error) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"error: "</span></span> , error) } ); };</code> ) <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callAddUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userData: IUserEntry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callService( ADDUSER_SERVICE_ID, userData, (data: any) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"received data: "</span></span>, data); }, (error) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"error: "</span></span> , error) } ); };</code> </pre> <br>  Agora, a fun√ß√£o <code>callAddUserService</code> √© tudo o que precisamos quando queremos adicionar um novo usu√°rio.  Por exemplo, chame-o quando o usu√°rio clicar em um bot√£o: <br><br><pre> <code class="javascript hljs">&lt;button onClick={() =&gt; callAddUserService({ <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username, <span class="hljs-attr"><span class="hljs-attr">userid</span></span>: userid, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: age, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: address })}&gt;Save&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br>  N√≥s apenas cham√°-lo usando o objeto <code>IUserEntry</code> .  Ele √© o servi√ßo certo (como definiu a sua identifica√ß√£o ( <code>id</code> )).  Ele coloca <code>userData</code> no corpo da solicita√ß√£o.  <code>&lt;AddUserService /&gt;</code> pega os dados do corpo e os coloca no banco de dados. <br><br><h3>  Obter itens do banco de dados </h3><br>  Recuperar itens de um banco de dados √© t√£o f√°cil quanto adicion√°-los. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">GETUSER_SERVICE_ID</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/getuser"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"GET"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Middleware</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">callback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{serviceWithDataLayer(async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">next</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">await</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span></span><span class="xml"><span class="hljs-tag">( </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.client</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.getEntryQuery</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">USER_ENTRY_ID</span></span></span></span><span class="xml"><span class="hljs-tag">, { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req.query.username</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">userid:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req.query.userid</span></span></span></span><span class="xml"><span class="hljs-tag"> }) ); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res.status</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">200</span></span></span></span><span class="xml"><span class="hljs-tag">)</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.set</span></span></span></span><span class="xml"><span class="hljs-tag">({ "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Access-Control-Allow-Origin</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> "*", // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Required</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">CORS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">support</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">work</span></span></span></span><span class="xml"><span class="hljs-tag"> })</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.send</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">JSON.stringify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag">)); })}/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> }</span></span></code> )); <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">GETUSER_SERVICE_ID</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/getuser"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"GET"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Middleware</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">callback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{serviceWithDataLayer(async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">next</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">await</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span></span><span class="xml"><span class="hljs-tag">( </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.client</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">dataLayer.getEntryQuery</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">USER_ENTRY_ID</span></span></span></span><span class="xml"><span class="hljs-tag">, { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req.query.username</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">userid:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">req.query.userid</span></span></span></span><span class="xml"><span class="hljs-tag"> }) ); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res.status</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">200</span></span></span></span><span class="xml"><span class="hljs-tag">)</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.set</span></span></span></span><span class="xml"><span class="hljs-tag">({ "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Access-Control-Allow-Origin</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> "*", // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Required</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">CORS</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">support</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">work</span></span></span></span><span class="xml"><span class="hljs-tag"> })</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.send</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">JSON.stringify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag">)); })}/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> }</span></span></code> </pre> <br>  Novamente, usamos &lt;Service /&gt;, &lt;Middleware /&gt; e uma fun√ß√£o de retorno de chamada com acesso ao banco de dados. <br><br>  Em vez da fun√ß√£o <code>mutate</code> , que acrescenta um elemento √† base de dados, usamos o <code>select</code> .  Essa fun√ß√£o solicita o cliente que estamos recebendo do <code>dataLayer</code> .  O segundo par√¢metro √© o comando <code>select</code> .  Como uma equipe <code>mutation</code> , podemos construir uma equipa de <code>select</code> usando <code>dataLayer</code> . <br><br>  Desta vez usamos o <code>getEntryQuery</code> .  N√≥s fornecemos o identificador ( <code>id</code> ) <code>&lt;Entry /&gt;</code> cujo elemento queremos receber.  E fornecemos as chaves ( <code>primaryKey</code> e <code>rangeKey</code> ) de um elemento espec√≠fico em um objeto Javascript.  Porque n√≥s fornecemos ambas as teclas, temos uma parte traseira item.  Se ele existir. <br><br>  Como voc√™ pode ver, pegamos os valores-chave da solicita√ß√£o.  Mas desta vez, n√≥s os retiramos de <code>request.query</code> e n√£o de <code>request.body</code> .  O motivo √© que este servi√ßo usa o m√©todo <code>GET</code> .  Este m√©todo n√£o suporta o corpo no pedido.  Mas ele fornece todos os dados como um par√¢metro de consulta. <br><br>  A fun√ß√£o <code>callService</code> lida com isso para n√≥s.  Como em <code>callAddUserService-function</code> , n√≥s fornecemos um identificador ( <code>id</code> ) <code>&lt;Service /&gt;</code> , que deseja chamar.  N√≥s fornecemos os dados necess√°rios.  Aqui est√£o apenas as chaves.  E n√≥s fornecemos uma fun√ß√£o de chamada de retorno. <br><br>  A chamada de retorno bem-sucedido fornece uma resposta.  O corpo da resposta no formato json cont√©m nosso elemento encontrado.  N√≥s podemos acess√°-lo via o elemento chave <code>get_user_entry</code> .  ¬´ <code>Get_</code> ¬ª define uma consulta que colocamos na nossa selec√ß√£o.  " <code>User_entry</code> " √© a chave do nosso <code>&lt;Entry /&gt;</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callGetUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username: string, userid: string, onData: (userData: IUserEntry</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callService( GETUSER_SERVICE_ID, { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username, <span class="hljs-attr"><span class="hljs-attr">userid</span></span>: userid }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response: any</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json().then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data[<span class="hljs-string"><span class="hljs-string">`get_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${USER_ENTRY_ID}</span></span></span><span class="hljs-string">`</span></span>]); onData(data[<span class="hljs-string"><span class="hljs-string">`get_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${USER_ENTRY_ID}</span></span></span><span class="hljs-string">`</span></span>]); }); }, (error) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"error: "</span></span> , error) } ); }</code> (dados) { <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callGetUserService</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username: string, userid: string, onData: (userData: IUserEntry</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callService( GETUSER_SERVICE_ID, { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username, <span class="hljs-attr"><span class="hljs-attr">userid</span></span>: userid }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response: any</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json().then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data[<span class="hljs-string"><span class="hljs-string">`get_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${USER_ENTRY_ID}</span></span></span><span class="hljs-string">`</span></span>]); onData(data[<span class="hljs-string"><span class="hljs-string">`get_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${USER_ENTRY_ID}</span></span></span><span class="hljs-string">`</span></span>]); }); }, (error) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"error: "</span></span> , error) } ); }</code> </pre> <br><h2>  D√™ uma olhada no seu aplicativo Full-Stack em a√ß√£o. </h2><br>  Se voc√™ ainda n√£o iniciou seu aplicativo, agora √© a hora de faz√™-lo: <code>npm run start-{your-env-name}</code> . <br><br>  Voc√™ pode at√© implantar seu aplicativo na AWS com um √∫nico comando: <code>npm run deploy-{your-env-name}</code> .  (Lembre-se de colocar as credenciais da AWS no arquivo .env). <br><br>  Este post n√£o descreve como inserir os dados que voc√™ colocar em um banco de dados, e como voc√™ exibir resultados.  <code>callAddUserService</code> e <code>callGetUserService</code> encapsular tudo o que √© espec√≠fico para os servi√ßos e bancos de dados.  Basta colocar a Javascript objeto e recuper√°-lo. <br><br>  Voc√™ encontrar√° o c√≥digo fonte deste exemplo neste <a href="https://github.com/infrastructure-components/soa-dl">reposit√≥rio GitHub</a> .  Inclui uma interface de usu√°rio muito simples. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476696/">https://habr.com/ru/post/pt476696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476682/index.html">Como escrever um sapador no Phaser e executar uma tarefa de teste do desenvolvedor HTML5</a></li>
<li><a href="../pt476686/index.html">Desenvolvimento de um gateway IoT baseado em Raspberry CM3 +</a></li>
<li><a href="../pt476688/index.html">Novo curso da OTUS. ‚ÄúDesenvolvedor de iOS. Curso Avan√ßado V 2.0 ¬ª</a></li>
<li><a href="../pt476692/index.html">Princ√≠pios de Marketing de Conte√∫do</a></li>
<li><a href="../pt476694/index.html">Sobre rob√≥tica comercial com Farida Roslovets e diretora da empresa RPA electroNeek</a></li>
<li><a href="../pt476698/index.html">Como a Apple mata as tecnologias da Web</a></li>
<li><a href="../pt476700/index.html">Mes na produ√ß√£o de radiadores de a√ßo</a></li>
<li><a href="../pt476702/index.html">Como uma pequena cidade do interior se transformou em um centro internacional de com√©rcio eletr√¥nico</a></li>
<li><a href="../pt476704/index.html">Como automatizar o layout de emails com o mesmo tipo de elementos: usamos objetos inteligentes</a></li>
<li><a href="../pt476706/index.html">Cerebras Systems introduziu um computador com o maior processador do mundo 22 √ó 22 cent√≠metros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>