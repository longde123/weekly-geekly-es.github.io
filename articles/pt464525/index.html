<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèæ üë©üèø‚Äç‚öïÔ∏è üñçÔ∏è Seu pr√≥prio conversor JSON ou um pouco mais sobre o ExpressionTrees ü§î üññüèº ü§Ø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Serializa√ß√£o e desserializa√ß√£o s√£o opera√ß√µes t√≠picas que o desenvolvedor moderno trata como triviais. N√≥s nos comunicamos com bancos de dados, geramos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seu pr√≥prio conversor JSON ou um pouco mais sobre o ExpressionTrees</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464525/"><img src="https://habrastorage.org/webt/ud/qn/kd/udqnkdpyauh-0k7h5d-g_hgzrys.png"><br><br>  Serializa√ß√£o e desserializa√ß√£o s√£o opera√ß√µes t√≠picas que o desenvolvedor moderno trata como triviais.  N√≥s nos comunicamos com bancos de dados, geramos solicita√ß√µes HTTP, recebemos dados por meio da API REST e geralmente nem pensamos em como isso funciona.  Hoje, sugiro escrever meu serializador e desserializador para o JSON para descobrir o que est√° por tr√°s. <br><a name="habracut"></a><br><h2>  Isen√ß√£o de responsabilidade </h2><br>  Como da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫ltima vez</a> , observarei: escreveremos um serializador primitivo, poder√≠amos dizer, uma bicicleta.  Se voc√™ precisar de uma solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pronta para</a> usar, use o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Json.NET</a> .  Esses caras lan√ßaram um produto maravilhoso, altamente personaliz√°vel, que pode fazer muito e <i>j√°</i> est√° <i>resolvendo problemas</i> que surgem ao trabalhar com o JSON.  Usar sua pr√≥pria solu√ß√£o √© muito legal, mas apenas se voc√™ precisar de desempenho m√°ximo, personaliza√ß√£o especial ou se gosta de motos da maneira que eu gosto. <br><br><h2>  √Årea de assunto </h2><br>  O servi√ßo para converter de JSON em uma representa√ß√£o de objeto consiste em pelo menos dois subsistemas.  O desserializador √© um subsistema que transforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSON</a> (texto) v√°lido em uma representa√ß√£o de objeto dentro de nosso programa.  A desserializa√ß√£o envolve a tokeniza√ß√£o, ou seja, a an√°lise do JSON em elementos l√≥gicos.  O serializador √© um subsistema que executa a tarefa inversa: transforma a representa√ß√£o de objeto dos dados em JSON. <br><br>  O consumidor costuma ver a seguinte interface.  Eu o simplifiquei deliberadamente para destacar os principais m√©todos mais usados. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonConverter</span></span> { T Deserialize&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> json); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> source</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  ‚ÄúSob o cap√¥‚Äù, a desserializa√ß√£o inclui tokeniza√ß√£o (an√°lise de um texto JSON) e constru√ß√£o de algumas primitivas que facilitam a cria√ß√£o de uma representa√ß√£o de objeto posteriormente.  Para fins de treinamento, pularemos a constru√ß√£o de primitivas intermedi√°rias (por exemplo, JObject, JProperty do Json.NET) e gravaremos imediatamente os dados no objeto.  Isso √© um sinal de menos, pois reduz as op√ß√µes de personaliza√ß√£o, mas √© imposs√≠vel criar uma biblioteca inteira dentro da estrutura de um artigo. <br><br><h2>  Tokeniza√ß√£o </h2><br>  Deixe-me lembr√°-lo de que o processo de tokeniza√ß√£o ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">an√°lise lexical</a> √© uma an√°lise do texto com o objetivo de obter uma representa√ß√£o diferente e mais rigorosa dos dados nele contidos.  Normalmente, essa representa√ß√£o √© chamada de <b>tokens</b> ou tokens.  Para fins de an√°lise de JSON, devemos destacar as propriedades, seus valores, os s√≠mbolos do in√≠cio e do fim das estruturas - ou seja, tokens que podem ser representados como JsonToken no c√≥digo. <br><br>  <a href="">JsonToken</a> √© uma estrutura que cont√©m um valor (texto), bem como um tipo de token.  JSON √© uma nota√ß√£o estrita; portanto, todos os tipos de tokens podem ser reduzidos para a <a href="">pr√≥xima enumera√ß√£o</a> .  Obviamente, seria bom adicionar ao token suas coordenadas nos dados recebidos (linha e coluna), mas a depura√ß√£o est√° al√©m do escopo da implementa√ß√£o, o que significa que o JsonToken n√£o cont√©m esses dados. <br><br>  Portanto, a maneira mais f√°cil de analisar texto em tokens √© ler cada caractere seq√ºencialmente e compar√°-lo com os padr√µes.  Precisamos entender o que esse ou aquele s√≠mbolo significa.  √â poss√≠vel que a palavra-chave (verdadeiro, falso, nulo) comece com esse caractere, √© poss√≠vel que este seja o come√ßo da linha (aspas) ou talvez esse caractere em si seja um token ([,], {,}).  A ideia geral √© assim: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tokens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;JsonToken&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; json.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch = json[i]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (ch) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'['</span></span>: tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.ArrayStart)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">']'</span></span>: tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.ArrayEnd)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'"'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = ReadString(); tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.String, stringValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... } }</code> </pre><br>  Observando o c√≥digo, parece que voc√™ pode ler e fazer algo imediatamente com os dados lidos.  Eles n√£o precisam ser armazenados, devem ser enviados imediatamente ao consumidor.  Assim, um certo IEnumerator implora, que analisar√° o texto em peda√ßos.  Em primeiro lugar, isso reduzir√° a aloca√ß√£o, pois n√£o precisamos armazenar resultados intermedi√°rios (uma matriz de tokens).  Em segundo lugar, aumentaremos a velocidade do trabalho - sim, no nosso exemplo, a entrada √© uma string, mas em uma situa√ß√£o real, ela ser√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">substitu√≠da pelo Stream</a> (de um arquivo ou rede), que lemos sequencialmente. <br><br>  Eu preparei o c√≥digo <b>JsonTokenizer</b> , que pode ser <a href="">encontrado aqui</a> .  A id√©ia √© a mesma - o tokenizador segue sequencialmente a linha, tentando determinar a que o s√≠mbolo ou sua sequ√™ncia se refere.  Se isso for entendido, criamos um token e transferimos o controle para o consumidor.  Se ainda n√£o estiver claro, continue a ler. <br><br><h2>  Preparando para desserializar objetos </h2><br>  Na maioria das vezes, uma solicita√ß√£o para converter dados do JSON √© uma chamada ao m√©todo gen√©rico Deserialize, em que <b>TOut</b> √© o tipo de dados com o qual os tokens JSON devem ser mapeados.  Onde <a href="">est√° o tipo</a> : √© hora de aplicar as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvores de reflex√£o</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">express√£o</a> .  Os princ√≠pios b√°sicos do trabalho com o ExpressionTrees, bem como o porqu√™ das express√µes compiladas serem melhores do que a reflex√£o "vazia", ‚Äã‚Äãdescrevi em um artigo anterior sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como criar seu AutoMapper</a> .  Se voc√™ n√£o sabe nada sobre Expression.Labmda.Compile () - eu recomendo a leitura.  Parece-me que o exemplo do mapeador acabou bem compreens√≠vel. <br><br>  Portanto, o plano para criar um desserializador de objetos se baseia no conhecimento de que podemos obter tipos de propriedades do tipo TOut a qualquer momento, ou seja, a cole√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PropertyInfo</a> .  Ao mesmo tempo, os tipos de propriedade s√£o limitados pela nota√ß√£o JSON: n√∫meros, cadeias, matrizes e objetos.  Mesmo se n√£o esquecermos o nulo, isso n√£o √© o que parece √† primeira vista.  E se para cada tipo primitivo seremos for√ßados a criar um desserializador separado, ent√£o para matrizes e objetos podemos criar classes gen√©ricas.  Se voc√™ pensa um pouco, todos os serializadores-desserializadores (ou <b>conversores</b> ) podem ser reduzidos para a seguinte interface: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonConverter</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Deserialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonTokenizer tokenizer</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, StringBuilder builder</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  O c√≥digo de um conversor de tipos primitivos fortemente tipado √© o mais simples poss√≠vel: extra√≠mos o JsonToken atual do tokenizer e o transformamos em valor analisando.  Por exemplo, float.Parse (currentToken.Value).  D√™ uma olhada no <a href="">BoolConverter</a> ou no <a href="">FloatConverter</a> - nada complicado.  Em seguida, se voc√™ precisar de um desserializador para bool?  ou float?, tamb√©m pode ser adicionado. <br><br><h2>  Desserializa√ß√£o de matriz </h2><br>  <a href="">O c√≥digo de classe gen√©rico</a> para converter uma matriz de JSON tamb√©m √© relativamente simples.  √â parametrizado pelo tipo de elemento que podemos extrair <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Type.GetElementType ()</a> .  Determinar que um tipo √© uma matriz tamb√©m √© simples: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Type.IsArray</a> .  A desserializa√ß√£o de matriz se resume a dizer tokenizer.MoveNext () at√© que um token do tipo ArrayEnd seja atingido.  A desserializa√ß√£o dos elementos da matriz √© a desserializa√ß√£o do tipo de elemento da matriz; portanto, ao criar um ArrayConverter, o desserializador de elemento √© passado para ele. <br><br>  √Äs vezes, h√° dificuldades com a instancia√ß√£o de implementa√ß√µes gen√©ricas, por isso vou lhe dizer imediatamente como faz√™-lo.  O Reflection permite criar tipos gen√©ricos em tempo real, o que significa que podemos usar o tipo criado como argumento para Activator.CreateInstance.  Aproveite isso: <br><br><pre> <code class="cs hljs">Type elementType = arrayType.GetElementType(); Type converterType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArrayConverter&lt;&gt;).MakeGenericType(elementType); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> converterInstance = Activator.CreateInstance(converterType, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] args);</code> </pre><br>  Preparativos finais para a cria√ß√£o de um desserializador de objetos, voc√™ pode colocar todo o c√≥digo de infraestrutura associado √† cria√ß√£o e armazenamento de desserializadores na fachada do <a href="">JConverter</a> .  Ele ser√° respons√°vel por todas as opera√ß√µes de serializa√ß√£o e desserializa√ß√£o do JSON e estar√° dispon√≠vel para os consumidores como um servi√ßo. <br><br><h2>  Desserializa√ß√£o de objetos </h2><br>  Deixe-me lembr√°-lo de que voc√™ pode obter todas as propriedades do tipo T assim: typeof (T) .GetProperties ().  Para cada propriedade, voc√™ pode extrair <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PropertyInfo.PropertyType</a> , o que nos dar√° a oportunidade de criar um IJsonConverter digitado para serializar e desserializar dados de um tipo espec√≠fico.  Se o tipo da propriedade for uma matriz, instanciamos o ArrayConverter ou encontramos uma adequada entre as existentes.  Se o tipo de propriedade for um tipo primitivo, os desserializadores (conversores) j√° ser√£o criados para eles no construtor JConverter. <br><br>  O c√≥digo resultante pode ser visualizado na classe gen√©rica <a href="">ObjectConverter</a> .  Um ativador √© criado em seu construtor, as propriedades s√£o extra√≠das de um dicion√°rio especialmente preparado e para cada um deles √© criado um m√©todo de desserializa√ß√£o - A√ß√£o &lt;TObject, JsonTokenizer&gt;.  √â necess√°rio, em primeiro lugar, para associar imediatamente o IJsonConverter √† propriedade desejada e, em segundo lugar, para evitar o boxe ao extrair e escrever tipos primitivos.  Cada m√©todo de desserializa√ß√£o sabe qual propriedade do objeto de sa√≠da ser√° registrada, o desserializador do valor √© estritamente digitado e retorna o valor exatamente na forma em que √© necess√°rio. <br><br>  A liga√ß√£o de um IJsonConverter a uma propriedade √© a seguinte: <br><br><pre> <code class="cs hljs">Type converterType = propertyValueConverter.GetType(); ConstantExpression Expression.Constant(propertyValueConverter, converterType); MethodInfo deserializeMethod = converterType.GetMethod(<span class="hljs-string"><span class="hljs-string">"Deserialize"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = Expression.Call(converter, deserializeMethod, tokenizer);</code> </pre><br>  A constante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Expression.Constant</a> √© criada diretamente na express√£o, que armazena uma refer√™ncia √† inst√¢ncia do desserializador para o valor da propriedade.  Esta n√£o √© exatamente a constante que escrevemos em "C # regular", pois ela pode armazenar um tipo de refer√™ncia.  Em seguida, o m√©todo Deserialize √© recuperado do tipo desserializador, que retorna o valor do tipo desejado e, em seguida, √© chamado - <a href="">Expression.Call</a> .  Assim, obtemos um m√©todo que sabe exatamente onde e o que escrever.  Resta coloc√°-lo no dicion√°rio e cham√°-lo quando um token do tipo Property com o nome desejado ‚Äúvem‚Äù do tokenizer.  Outra vantagem √© que tudo funciona muito rapidamente. <br><br><h2>  Qu√£o r√°pido </h2><br>  Bicicletas, como foi observado no in√≠cio, faz sentido escrever em v√°rios casos: se essa √© uma tentativa de entender como a tecnologia funciona, ou voc√™ precisa obter alguns resultados especiais.  Por exemplo, velocidade.  Voc√™ pode ter certeza de que o desserializador realmente desserializa <a href="">com os testes preparados</a> (eu uso o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AutoFixture</a> para obter dados do teste).  A prop√≥sito, voc√™ provavelmente notou que eu tamb√©m escrevi serializa√ß√£o de objetos.  Mas como o artigo se mostrou bastante amplo, n√£o o descreverei, mas apenas darei refer√™ncias.  Sim, assim como no artigo anterior, escrevi benchmarks usando a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BenchmarkDotNet</a> . <br><br>  Obviamente, <a href="">comparei a</a> velocidade de desserializa√ß√£o com a Newtonsoft (Json.NET), como a solu√ß√£o mais comum e recomendada para trabalhar com JSON.  Al√©m disso, no site deles est√° escrito: 50% mais r√°pido que o DataContractJsonSerializer e 250% mais r√°pido que o JavaScriptSerializer.  Em resumo, eu queria saber quanto meu c√≥digo perderia.  Os resultados me surpreenderam: observe que a aloca√ß√£o de dados √© quase tr√™s vezes menor e a taxa de desserializa√ß√£o √© cerca de duas vezes mais r√°pida. <br><div class="scrollable-table"><table><thead><tr><th>  M√©todo </th><th>  Mean </th><th>  Erro </th><th>  Stddev </th><th>  Ratio </th><th>  Alocado </th></tr></thead><tbody><tr><td>  Newtonsoft </td><td>  75,39 ms </td><td>  0,3027 ms </td><td>  0,2364 ms </td><td>  1,00 </td><td>  35.47 MB </td></tr><tr><td>  Velo </td><td>  31,78 ms </td><td>  0,11135 ms </td><td>  0,1062 ms </td><td>  0,42 </td><td>  12,36 MB </td></tr></tbody></table></div><br>  A compara√ß√£o de velocidade e aloca√ß√£o <a href="">durante a serializa√ß√£o de dados</a> produziu resultados ainda mais interessantes.  Acontece que o serializador da bicicleta alocou quase cinco vezes menos e trabalhou quase tr√™s vezes mais r√°pido.  Se a velocidade realmente me incomodasse (realmente), seria um claro sucesso. <br><div class="scrollable-table"><table><thead><tr><th>  M√©todo </th><th>  Mean </th><th>  Erro </th><th>  Stddev </th><th>  Ratio </th><th>  Alocado </th></tr></thead><tbody><tr><td>  Newtonsoft </td><td>  54,83 ms </td><td>  0,5582 ms </td><td>  0,5222 ms </td><td>  1,00 </td><td>  25.44 MB </td></tr><tr><td>  Velo </td><td>  20,66 ms </td><td>  0,0484 ms </td><td>  0,0429 ms </td><td>  0,38 </td><td>  5,93 MB </td></tr></tbody></table></div><br>  Sim, ao medir a velocidade, n√£o usei as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dicas para aumentar a produtividade</a> publicadas no site Json.NET.  Tirei as medidas da caixa, ou seja, de acordo com o cen√°rio mais usado: JsonConvert.DeserializeObject.  Pode haver outras maneiras de melhorar o desempenho, mas eu n√£o as conhe√ßo. <br><br><h2>  Conclus√µes </h2><br>  Apesar da velocidade relativamente alta de serializa√ß√£o e desserializa√ß√£o, eu n√£o recomendaria abandonar o Json.NET em favor da minha pr√≥pria solu√ß√£o.  O ganho de velocidade √© calculado em milissegundos e eles "afogam-se" facilmente em atrasos, disco ou c√≥digo da rede, que est√° localizado hierarquicamente acima do local onde a serializa√ß√£o √© aplicada.  Apoiar essas solu√ß√µes propriet√°rias √© um inferno, onde apenas os desenvolvedores que s√£o bem versados ‚Äã‚Äãno assunto podem ser permitidos. <br><br>  O escopo dessas bicicletas s√£o aplicativos totalmente projetados com vistas ao alto desempenho ou projetos para animais de estima√ß√£o nos quais voc√™ entende como essa ou aquela tecnologia funciona.  Espero ter ajudado um pouco em tudo isso. <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464525/">https://habr.com/ru/post/pt464525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464511/index.html">Como coletar coortes de usu√°rios na forma de gr√°ficos no Grafana [+ imagem do docker com um exemplo]</a></li>
<li><a href="../pt464513/index.html">Duffle: Transformador de XD Design</a></li>
<li><a href="../pt464515/index.html">Como criar e-mails e n√£o bagun√ßar: dicas pr√°ticas</a></li>
<li><a href="../pt464517/index.html">Novos cart√µes CUBA</a></li>
<li><a href="../pt464523/index.html">Sistemas de Pagamento (PSP) para empresas de TI: jogamos muito</a></li>
<li><a href="../pt464529/index.html">Agora, a publicidade contextual com os nomes dos concorrentes pode ser multada em 500.000 rublos</a></li>
<li><a href="../pt464535/index.html">Detalhes sobre o dispositivo e as fun√ß√µes da scooter el√©trica KickScooter T60</a></li>
<li><a href="../pt464537/index.html">Carrossel Demon√≠aco DIY do Arduino</a></li>
<li><a href="../pt464539/index.html">Estudos cl√≠nicos. Como entrar no grupo experimental, obter tratamento gratuito do c√¢ncer e ajudar a ci√™ncia</a></li>
<li><a href="../pt464543/index.html">O que √© e o que n√£o est√° no Go. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>