<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ€„ï¸ ğŸ¦‚ ğŸ‘©ğŸ¿â€ğŸ­ Game debug untuk NES: bagaimana hal itu terjadi hari ini ğŸ‘ƒğŸ½ ğŸŠ ğŸ‘²ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jika Anda pernah terlibat dalam pemrograman, Anda terbiasa dengan konsep bug. Jika mereka tidak mengganggu kami, proses pengembangan akan menjadi jauh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Game debug untuk NES: bagaimana hal itu terjadi hari ini</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466653/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif" alt="gambar"></div><br>  Jika Anda pernah terlibat dalam pemrograman, Anda terbiasa dengan konsep bug.  Jika mereka tidak mengganggu kami, proses pengembangan akan menjadi jauh lebih cepat dan lebih menyenangkan.  Tetapi bug ini hanya menunggu saat untuk merusak kode kami, jadwal kerja dan aliran kreatif.  Untungnya, ada banyak alat dan strategi untuk membunuh bug bahkan dalam kode programmer retro-game. <br><br><h3>  Alat Debugging </h3><br>  Salah satu cara terbaik untuk men-debug kode adalah dengan menggunakan debugger.  Beberapa versi emulator FCEUX dan Mesen memiliki debugger bawaan yang memungkinkan Anda mengganggu program kapan saja untuk memeriksa kesehatan kode. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea6/3aa/a59/ea63aaa59021320ef8bdbdb928f2bf8f.png"></div><br>  <i>FCEUX emulator debugger</i> <br><br>  Perlu dicatat bahwa metode ini lebih cocok untuk pemrogram tingkat lanjut yang bekerja dengan bahasa assembly.  Tapi kami baru, jadi kami akan menulis dalam C (cc65).  Tentu saja, kompiler akan bermain dengan aturannya sendiri, dan akan sulit bagi kita untuk berurusan dengan kode mesin yang dikompilasi dari kode C. <br><a name="habracut"></a><br><h5>  Editor hex FCEUX </h5><br>  Katakanlah kita perlu mengamati beberapa jenis variabel atau array.  Tambahkan baris berikut ke opsi tautan (ld65): <code>-Ln labels.txt</code> <br><br>  Setelah mengkompilasi proyek, file <code>labels.txt</code> akan muncul di foldernya.  Buka saja di program apa saja untuk melihat teks dan cari nama variabel yang ingin kita amati. <br><br>  ( <em>Catatan: jika Anda mendeklarasikan variabel statis, itu tidak akan dimasukkan dalam daftar ini. Oleh karena itu, alih-alih <code>static unsigned char playerX</code> gunakan <code>unsigned char playerX</code></em> ) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc1/949/8d0/dc19498d02f665f3f9c4b797ab74de5b.png"></div><br>  Sekarang kita tahu alamat variabel yang diinginkan, tidak buruk.  Mari kita temukan di debugger.  Jalankan game ROM di emulator FCEUX.  Di menu Debug, pilih item Hex Editor, dan di jendela yang terbuka, tekan Ctrl + G dan masukkan alamat variabel kami: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/495/ce0/085/495ce0085c38bf77a9941c76c28e9f92.png"></div><br>  Tekan OK, dan kursor akan pindah ke alamat tempat variabel itu berada.  Mari kita melihatnya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif"></div><br>  Ini berguna untuk memeriksa apakah array diisi dengan benar atau untuk melacak perubahan pada variabel tertentu.  Selain itu, Anda bisa merasa seperti Kakak, dengan hati-hati memperhatikan kode Anda. <br><br>  Lihat alat emulator FCEUX lain yang berguna untuk menu Debug seperti PPU Viewer, Name table Viewer, dll. <br><br><h3>  Sederhanakan proses debugging </h3><br>  Dan jika kita tidak ingin menjalankan debugger setiap saat untuk mengamati variabel?  Cara yang lebih maju adalah menulis prosedur yang menampilkan nilai ke layar.  Mari kita coba gunakan skor di antarmuka untuk menampilkan posisi pemain pada sumbu Y: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dd/4cb/3ca/9dd4cb3caac2ebb53331df53b565365d.gif"></div><br>  Ini bekerja dengan sempurna! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pemilik blog</a> retro-coder dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nesdoug,</a> Doug Fraker telah menciptakan metode serupa untuk menggunakan visualisasi di layar untuk keperluan debugging.  Prosedur yang ditunjukkan di bawah ini membuat garis abu-abu pada layar yang dengan jelas menunjukkan tingkat beban CPU: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// void gray_line(void); // For debugging. Insert at the end of the game loop, to see how much frame is left. // Will print a gray line on the screen. Distance to the bottom = how much is left. // No line, possibly means that you are in v-blank. _gray_line: lda &lt;PPU_MASK_VAR and #$1f ;no color emphasis bits ora #1 ;yes gray bit sta PPU_MASK ldx #20 ;wait @loop2: dex bne @loop2 lda &lt;PPU_MASK_VAR ;normal sta PPU_MASK rts</span></span></code> </pre> <br>  Anda cukup menyalin prosedur ini ke dalam kode Anda atau memasukkan pustaka nesdoug.h dalam proyek.  Prosedur harus dipanggil setelah selesainya siklus permainan, maka bilah abu-abu akan ditampilkan di layar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca6/11a/007/ca611a0072771688eb1618922b14d8f2.gif"></div><br>  Itu berhasil, tetapi sepertinya saya memiliki satu bug lagi!  Kami akan menyingkirkannya nanti.  Sementara itu, mari kita lanjutkan. <br><br><h3>  Kekuatan makro </h3><br>  Macro juga bisa menjadi alat debugging yang berguna.  Mereka akan memungkinkan Anda untuk menemukan tempat dalam kode yang telah menjadi sumber bug. <br><br>  Mari kita buat semacam makro yang akan memberi kita sinyal pada waktu yang tepat, misalnya memainkan suara atau memilih nol palet dengan nilai yang diperlukan.  Kami memiliki beberapa makro yang mengubah palet nol menjadi warna merah, biru dan acak, serta mereproduksi suara: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/343/886/d8e/343886d8e09643d4a35df968e094ac85.png"></div><br>  Bagaimana cara kerjanya?  Misalkan Anda berhasil menyusun proyek, Anda memulai emulator dengan permainan Anda, klik tombol Start dan ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/220/6ff/9e52206ffadd67162cf8e9893d3e7c4f.gif"></div><br>  Tampaknya tidak ada yang lain selain layar putih.  Selain itu, beberapa emulator dapat melaporkan "CPU macet!" Di bilah status.  Apa yang harus dilakukan selanjutnya? <br><br>  Pertama, Anda perlu melokalkan kode di mana kesalahan terjadi.  Dan di sini makro suara saya ikut bermain. <br><br>  Kami tahu pasti bahwa menu utama berfungsi.  Mari kita lihat apa yang terjadi setelahnya: <br><br><pre> <code class="cpp hljs">playMainMenu(); player.lives = <span class="hljs-number"><span class="hljs-number">9</span></span>; points = <span class="hljs-number"><span class="hljs-number">0</span></span>; gameFlags = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(current_world); debugSound; playCurrentLevel(); }</code> </pre> <br>  Saya curiga bahwa game mogok saat prosedur <code>set_world</code> .  Mari kita periksa firasat ini.  Saya cukup memasukkan nama makro di baris berikutnya setelah prosedur diperiksa. <br><br>  Kami memulai proyek dan ... Saya mendengar suara!  Yaitu, prosedur ini berhasil, dan kami perlu memeriksa yang berikut: <code>playCurrentLevel</code> .  Mari kita pindahkan makro debug di bawah ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(); playCurrentLevel(): debugSound; }</code> </pre> <br>  Saya memulai proyek lagi, tetapi saya tidak dapat mendengar suara.  Ini berarti bahwa prosedur tidak selesai, dan kegagalan terjadi di dalamnya. <br><br>  Dalam kasus seperti itu, Anda harus membuka kode prosedur dan terus menerapkan teknik ini sampai Anda dapat mempersempit pencarian Anda untuk kemungkinan lokasi bug. <br><br>  Makro yang mengubah palet juga dapat berguna untuk memeriksa kondisi.  Misalnya, kode kami melakukan pengujian kompleks terhadap beberapa kondisi: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (getTile(objX, objY+<span class="hljs-number"><span class="hljs-number">16</span></span>) || collide16() ) || (objsOX[i] &amp;&amp; objY&gt;objsOX[i])) { debugRed; objsSTATE[i]=THWOMP_SMASH; objY=objsY[i]-=<span class="hljs-number"><span class="hljs-number">4</span></span>; objsFRM[i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; sfx_play(SFX_THWOMP_SLAM_DOWN,<span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br>  Jika kita mengubah warna palet di sini, kita akan melihat apakah kondisinya terpenuhi: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/196/db1/654/196db16543e8be8a6e7e02f01316a84f.gif"></div><br>  Ayam ini sepertinya baik-baik saja.  Tetapi jika bendera tidak berfungsi, maka salah satu syaratnya tidak terpenuhi.  Dalam hal ini, Anda perlu memeriksa semuanya secara terpisah dan kemudian, mungkin, Anda akan menemukan bug lain. <br><br><h3>  Opsi nuklir </h3><br>  Baru-baru ini saya menemukan bahwa salah satu hantu dalam permainan saya menunjukkan semacam perilaku mencurigakan.  Dari waktu ke waktu, dia menolak untuk menyerang pemain. <br><br>  Lihatlah hantu ini terkena bug - ia hanya menyerang ketika karakternya dekat dengan tengah layar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/bd9/e30/f17bd9e300807a706298c64d8113c5f1.gif"></div><br>  Tidak peduli sekeras apa pun saya mempelajari kode prosedur ini, saya tidak dapat menemukan di mana bug itu disembunyikan, jadi saya memutuskan untuk mengambil langkah ekstrem dan menguji kerja kode ini dalam lingkungan pengembangan modern. <br><br>  Saya mengambil semua yang saya butuhkan: peta layar, array dengan atribut meta-file, kode prosedur, dan cukup memasukkannya ke dalam Visual Studio 2017: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/383/d8f/d69/383d8fd6900e550652513f43fb70b6ff.png"></div><br>  Di PC, kodenya bekerja persis sama.  Ternyata, bug itu bersembunyi di prosedur yang mengisi cache untuk menemukan rintangan antara pemain dan musuh.  Array salah diisi.  Saya yakin harus ada 0 bukan 0x80. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f0/225/8c5/2f02258c52bbc8c4e2bf59b9e9aab8b4.png"></div><br>  Jadi, saya akan mencoba langkah demi langkah men-debug kode untuk mencari tahu mengapa ini terjadi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d23/678/2db/d236782dbf4473e6bee4c7460782fec9.gif"></div><br>  Ini lucu, tapi sepertinya saya melakukan tindakan dalam urutan yang salah.  Mari kita perbaiki dan periksa array lagi! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c7/b01/54b/4c7b0154b745c486715e4af208ff0068.png"></div><br>  Tampaknya sekarang array sudah diisi dengan benar.  Artinya, saya hanya perlu memperbaiki kode cc65 dan mengkompilasi proyek NES lagi. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1NRqqPzOoSg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Jadi, alat pengembangan modern dapat membantu dalam debugging algoritma dan memperbaiki bug. <br><br><h3>  Singkirkan bug dengan tenang </h3><br>  Bug mengganggu, seperti halnya kode mengganggu.  Tetap tenang, jangan kehilangan kendali dan gunakan seluruh jajaran alat yang tersedia untuk mencari dan menghancurkan hama ini.  Kualitas kode Anda dan ketenangan pikiran akan meningkat secara signifikan. <br><br>  <em>Ingin mendapatkan kiat langsung dari profesional desain retro?</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">Selamat Datang di Perselisihan kami!</a></em> <em><br><br></em>  <em><em>Game kami The Meating tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> !</em></em> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id466653/">https://habr.com/ru/post/id466653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id466641/index.html">Sebagai orang bodoh yang diajarkan C #. Bagian 1</a></li>
<li><a href="../id466643/index.html">Intisari materi menarik untuk pengembang seluler # 314 (pada 2 - 8 September)</a></li>
<li><a href="../id466647/index.html">Telepon untuk kuda dan orkestra tanpa pianis. Cara membuat tugas olahraga di ujung depan</a></li>
<li><a href="../id466649/index.html">Akhir pekan di mobil listrik</a></li>
<li><a href="../id466651/index.html">Memilih antara XML dan SQL untuk menggulung skrip LiquiBase menggunakan Java / Spring / H2 sebagai contoh</a></li>
<li><a href="../id466657/index.html">Detail dinamis: game kompiler rahasia, kebocoran memori, nuansa kinerja</a></li>
<li><a href="../id466659/index.html">Ulasan Kubecost untuk menghemat uang di Kubernetes di awan</a></li>
<li><a href="../id466661/index.html">Gelar Master Jarak Di Luar Negeri: Catatan Sebelum Tesis</a></li>
<li><a href="../id466663/index.html">Eksperimen sederhana dengan mikrokontroler STM32F103 (Blue Tablet)</a></li>
<li><a href="../id466665/index.html">CSS overflow dan kehilangan data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>