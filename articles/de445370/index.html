<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëπ üôÜüèª üìº TSDB-Analyse in Prometheus 2 üï¢ ‚åöÔ∏è üê≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Zeitreihendatenbank (TSDB) in Prometheus 2 ist ein hervorragendes Beispiel f√ºr eine technische L√∂sung, die hinsichtlich der Geschwindigkeit der Da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TSDB-Analyse in Prometheus 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/445370/"><img src="https://habrastorage.org/webt/vd/66/kh/vd66khzvg2fd68xtdpwyq462zm0.png"><br><br>  Die Zeitreihendatenbank (TSDB) in Prometheus 2 ist ein hervorragendes Beispiel f√ºr eine technische L√∂sung, die hinsichtlich der Geschwindigkeit der Datenspeicherung und der Abfrageausf√ºhrung sowie der Ressourceneffizienz wesentliche Verbesserungen gegen√ºber dem v2-Speicher in Prometheus 1 bietet.  Wir haben Prometheus 2 in Percona Monitoring and Management (PMM) implementiert, und ich hatte die Gelegenheit, die Leistung von Prometheus 2 TSDB zu verstehen.  In diesem Artikel werde ich √ºber die Ergebnisse dieser Beobachtungen sprechen. <br><a name="habracut"></a><br><h3>  Prometheus durchschnittliche Arbeitsbelastung </h3><br>  F√ºr diejenigen, die es gewohnt sind, mit Prim√§rdatenbanken umzugehen, ist die regul√§re Arbeitsbelastung von Prometheus ziemlich merkw√ºrdig.  Die Geschwindigkeit der Datenakkumulation tendiert zu einem stabilen Wert: Normalerweise senden die von Ihnen √ºberwachten Dienste ungef√§hr die gleiche Anzahl von Metriken, und die Infrastruktur √§ndert sich relativ langsam. <br><br>  Informationsanfragen k√∂nnen aus verschiedenen Quellen stammen.  Einige von ihnen, wie z. B. Warnungen, streben auch einen stabilen und vorhersehbaren Wert an.  Andere, wie z. B. Benutzerabfragen, k√∂nnen Spitzen verursachen, obwohl dies f√ºr den gr√∂√üten Teil der Last nicht typisch ist. <br><br><h3>  Belastungstest </h3><br>  W√§hrend des Testens konzentrierte ich mich auf die F√§higkeit, Daten zu sammeln.  Ich habe Prometheus 2.3.2, kompiliert mit Go 1.10.1 (als Teil von PMM 1.14), auf dem Linode-Dienst mithilfe dieses Skripts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bereitgestellt</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">StackScript</a> .  F√ºr die realistischste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lastgenerierung habe</a> ich mit diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">StackScript</a> mehrere MySQL-Knoten mit einer realen Last gestartet (Sysbench TPC-C-Test), von denen jeder 10 Linux / MySQL-Knoten emulierte. <br><br>  Alle folgenden Tests wurden auf einem Linode-Server mit acht virtuellen Kernen und 32 GB Speicher durchgef√ºhrt, auf dem 20 Lastsimulationen zur √úberwachung von zweihundert MySQL-Instanzen gestartet wurden.  Oder in Prometheus-Begriffen 800 Ziele, 440 Kratzer pro Sekunde, 380.000 Proben pro Sekunde und 1,7 Millionen aktive Zeitreihen. <br><br><h3>  Design </h3><br>  Der √ºbliche Ansatz herk√∂mmlicher Datenbanken, einschlie√ülich des von Prometheus 1.x verwendeten, ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherbeschr√§nkung</a> .  Wenn es nicht ausreicht, um der Last standzuhalten, treten gro√üe Verz√∂gerungen auf und einige Anforderungen werden nicht erf√ºllt. <br>  Die Speichernutzung in Prometheus 2 wird mit dem Schl√ºssel <code>storage.tsdb.min-block-duration</code> konfiguriert, der bestimmt, wie lange die Datens√§tze im Speicher gespeichert werden, bevor sie auf die Festplatte geschrieben werden (standardm√§√üig sind dies 2 Stunden).  Die ben√∂tigte Speichermenge h√§ngt von der Anzahl der Zeitreihen, Beschriftungen und der Intensit√§t der Datenerfassung (Scrapes) insgesamt mit dem Nettoeingabestream ab.  In Bezug auf den Speicherplatz strebt Prometheus die Verwendung von 3 Bytes pro Datensatz (Beispiel) an.  Andererseits sind die Speicheranforderungen viel h√∂her. <br><br>  Trotz der Tatsache, dass es m√∂glich ist, die Blockgr√∂√üe zu konfigurieren, wird nicht empfohlen, sie manuell zu konfigurieren, sodass Sie Prometheus so viel Speicherplatz zur Verf√ºgung stellen m√ºssen, wie f√ºr Ihre Last erforderlich ist. <br><br>  Wenn nicht gen√ºgend Speicher vorhanden ist, um den eingehenden Metrik-Stream zu unterst√ºtzen, f√§llt Prometheus aus dem Speicher aus oder der OOM-Killer erreicht ihn. <br><br>  Das Hinzuf√ºgen von Swap, um den Absturz zu verz√∂gern, wenn Prometheus nicht mehr gen√ºgend Speicher hat, hilft nicht wirklich, da die Verwendung dieser Funktion einen explosiven Speicherverbrauch verursacht.  Ich denke, das Ding ist Go, sein M√ºllsammler und wie es mit Swap funktioniert. <br><br>  Ein weiterer interessanter Ansatz besteht darin, den Kopfblock so einzustellen, dass er zu einem bestimmten Zeitpunkt auf die Festplatte zur√ºckgesetzt wird, anstatt ihn vom Beginn des Prozesses an zu z√§hlen. <br><br><img src="https://habrastorage.org/webt/bl/pi/qv/blpiqvwimzifjmfyzbrplkagkcg.png"><br><br>  Wie Sie in der Grafik sehen k√∂nnen, werden alle zwei Stunden Festplatten geleert.  Wenn Sie den Parameter min-block-duration auf eine Stunde √§ndern, treten diese Entladungen st√ºndlich ab einer halben Stunde auf. <br><br>  <i>Wenn Sie diese und andere Grafiken in Ihrer Prometheus-Installation verwenden m√∂chten, k√∂nnen Sie dieses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dashboard verwenden</a> .</i>  <i>Es wurde f√ºr PMM entwickelt, eignet sich jedoch mit geringf√ºgigen √Ñnderungen f√ºr jede Installation von Prometheus.</i> <br><br>  Wir haben einen aktiven Block namens Kopfblock, der im Speicher gespeichert ist.  Auf Bl√∂cke mit √§lteren Daten kann √ºber <code>mmap()</code> .  Dadurch entf√§llt die Notwendigkeit, den Cache separat zu konfigurieren, aber Sie m√ºssen auch gen√ºgend Speicherplatz f√ºr den Betriebssystem-Cache lassen, wenn Sie Daten anfordern m√∂chten, die √§lter als der Headblock sind. <br><br>  Dies bedeutet auch, dass der Verbrauch des virtuellen Prometheus-Speichers ziemlich hoch sein wird, wor√ºber Sie sich keine Sorgen machen sollten. <br><br><img src="https://habrastorage.org/webt/ls/sl/qp/lsslqpxvg2lgzvpvbnupee0qbik.png"><br><br>  Ein weiterer interessanter Entwurfspunkt ist die Verwendung von WAL (Write Ahead Log).  Wie Sie der Speicherdokumentation entnehmen k√∂nnen, verwendet Prometheus WAL, um Verluste durch St√ºrze zu vermeiden.  Die spezifischen Mechanismen zur Sicherstellung der Daten√ºberlebensf√§higkeit sind leider nicht gut dokumentiert.  Prometheus Version 2.3.2 leert die WAL alle 10 Sekunden auf die Festplatte, und dieser Parameter kann nicht vom Benutzer konfiguriert werden. <br><br><h3>  Dichtungen (Verdichtungen) </h3><br>  Prometheus TSDB basiert auf dem Image eines LSM-Repositorys (Log Structured Merge - ein logstrukturierter Baum mit Zusammenf√ºhrung): Der Kopfblock wird regelm√§√üig auf die Festplatte geleert, w√§hrend der Komprimierungsmechanismus mehrere Bl√∂cke miteinander kombiniert, um das Scannen zu vieler Bl√∂cke w√§hrend Anforderungen zu verhindern.  Hier sehen Sie die Anzahl der Bl√∂cke, die ich nach einem Arbeitstag auf dem Testsystem beobachtet habe. <br><br><img src="https://habrastorage.org/webt/4o/96/oy/4o96oyaps3brdaqea7n1qyerpgw.png"><br><br>  Wenn Sie mehr √ºber das Repository erfahren m√∂chten, k√∂nnen Sie die Datei meta.json lesen, die Informationen zu den verf√ºgbaren Bl√∂cken und deren Darstellung enth√§lt. <br><br><pre> <code class="json hljs">{       <span class="hljs-attr"><span class="hljs-attr">"ulid"</span></span>: <span class="hljs-string"><span class="hljs-string">"01CPZDPD1D9R019JS87TPV5MPE"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"minTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536472800000</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"maxTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536494400000</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"stats"</span></span>: {               <span class="hljs-attr"><span class="hljs-attr">"numSamples"</span></span>: <span class="hljs-number"><span class="hljs-number">8292128378</span></span>,               <span class="hljs-attr"><span class="hljs-attr">"numSeries"</span></span>: <span class="hljs-number"><span class="hljs-number">1673622</span></span>,               <span class="hljs-attr"><span class="hljs-attr">"numChunks"</span></span>: <span class="hljs-number"><span class="hljs-number">69528220</span></span>       },       <span class="hljs-attr"><span class="hljs-attr">"compaction"</span></span>: {               <span class="hljs-attr"><span class="hljs-attr">"level"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>,               <span class="hljs-attr"><span class="hljs-attr">"sources"</span></span>: [                       <span class="hljs-string"><span class="hljs-string">"01CPYRY9MS465Y5ETM3SXFBV7X"</span></span>,                       <span class="hljs-string"><span class="hljs-string">"01CPYZT0WRJ1JB1P0DP80VY5KJ"</span></span>,                       <span class="hljs-string"><span class="hljs-string">"01CPZ6NR4Q3PDP3E57HEH760XS"</span></span>               ],               <span class="hljs-attr"><span class="hljs-attr">"parents"</span></span>: [                       {                               <span class="hljs-attr"><span class="hljs-attr">"ulid"</span></span>: <span class="hljs-string"><span class="hljs-string">"01CPYRY9MS465Y5ETM3SXFBV7X"</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"minTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536472800000</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"maxTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536480000000</span></span>                       },                       {                               <span class="hljs-attr"><span class="hljs-attr">"ulid"</span></span>: <span class="hljs-string"><span class="hljs-string">"01CPYZT0WRJ1JB1P0DP80VY5KJ"</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"minTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536480000000</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"maxTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536487200000</span></span>                       },                       {                               <span class="hljs-attr"><span class="hljs-attr">"ulid"</span></span>: <span class="hljs-string"><span class="hljs-string">"01CPZ6NR4Q3PDP3E57HEH760XS"</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"minTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536487200000</span></span>,                               <span class="hljs-attr"><span class="hljs-attr">"maxTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1536494400000</span></span>                       }               ]       },       <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br>  Siegel in Prometheus sind an die Zeit gebunden, als ein Kopfblock auf die Scheibe gesp√ºlt wurde.  Zu diesem Zeitpunkt k√∂nnen mehrere solcher Operationen ausgef√ºhrt werden. <br><br><img src="https://habrastorage.org/webt/ux/a4/85/uxa485qrm1zltefalsn54euc0ei.png"><br><br>  Anscheinend sind Siegel in keiner Weise unbegrenzt und k√∂nnen zur Laufzeit gro√üe Festplatten-E / A-Spr√ºnge verursachen. <br><br><img src="https://habrastorage.org/webt/kw/bt/ty/kwbttykmjwhoopodhlsl5mbm0-i.png"><br><br>  CPU-Download-Spitzen <br><br><img src="https://habrastorage.org/webt/zk/ls/x2/zklsx2x0txpjym_defuhn0qkoqi.png"><br><br>  Dies wirkt sich nat√ºrlich negativ auf die Geschwindigkeit des Systems aus und ist auch eine ernsthafte Herausforderung f√ºr den LSM-Speicher: Wie werden Siegel hergestellt, um hohe Abfragegeschwindigkeiten zu unterst√ºtzen und nicht zu viel Overhead zu verursachen? <br><br>  Interessant ist auch die Verwendung von Speicher bei der Verdichtung. <br><br><img src="https://habrastorage.org/webt/vb/bn/ei/vbbneip1p05brkhxasvmglr6-ts.png"><br><br>  Wir k√∂nnen sehen, wie nach der Komprimierung der gr√∂√üte Teil des Speichers den Status von zwischengespeichert in frei √§ndert: Dies bedeutet, dass potenziell wertvolle Informationen von dort entfernt wurden.  Es ist merkw√ºrdig, ob hier <code>fadvice()</code> oder eine andere Minimierungstechnik verwendet wird, oder liegt dies daran, dass der Cache von Bl√∂cken befreit wurde, die w√§hrend der Komprimierung zerst√∂rt wurden? <br><br><h3>  Crash Recovery </h3><br>  Die Wiederherstellung nach einem Katastrophenfall braucht Zeit und ist gerechtfertigt.  Bei einem eingehenden Datenstrom von einer Million Datens√§tzen pro Sekunde musste ich etwa 25 Minuten warten, w√§hrend die Wiederherstellung unter Ber√ºcksichtigung des SSD-Laufwerks durchgef√ºhrt wurde. <br><br><pre> <code class="plaintext hljs">level=info ts=2018-09-13T13:38:14.09650965Z caller=main.go:222 msg="Starting Prometheus" version="(version=2.3.2, branch=v2.3.2, revision=71af5e29e815795e9dd14742ee7725682fa14b7b)" level=info ts=2018-09-13T13:38:14.096599879Z caller=main.go:223 build_context="(go=go1.10.1, user=Jenkins, date=20180725-08:58:13OURCE)" level=info ts=2018-09-13T13:38:14.096624109Z caller=main.go:224 host_details="(Linux 4.15.0-32-generic #35-Ubuntu SMP Fri Aug 10 17:58:07 UTC 2018 x86_64 1bee9e9b78cf (none))" level=info ts=2018-09-13T13:38:14.096641396Z caller=main.go:225 fd_limits="(soft=1048576, hard=1048576)" level=info ts=2018-09-13T13:38:14.097715256Z caller=web.go:415 component=web msg="Start listening for connections" address=:9090 level=info ts=2018-09-13T13:38:14.097400393Z caller=main.go:533 msg="Starting TSDB ..." level=info ts=2018-09-13T13:38:14.098718401Z caller=repair.go:39 component=tsdb msg="found healthy block" mint=1536530400000 maxt=1536537600000 ulid=01CQ0FW3ME8Q5W2AN5F9CB7R0R level=info ts=2018-09-13T13:38:14.100315658Z caller=web.go:467 component=web msg="router prefix" prefix=/prometheus level=info ts=2018-09-13T13:38:14.101793727Z caller=repair.go:39 component=tsdb msg="found healthy block" mint=1536732000000 maxt=1536753600000 ulid=01CQ78486TNX5QZTBF049PQHSM level=info ts=2018-09-13T13:38:14.102267346Z caller=repair.go:39 component=tsdb msg="found healthy block" mint=1536537600000 maxt=1536732000000 ulid=01CQ78DE7HSQK0C0F5AZ46YGF0 level=info ts=2018-09-13T13:38:14.102660295Z caller=repair.go:39 component=tsdb msg="found healthy block" mint=1536775200000 maxt=1536782400000 ulid=01CQ7SAT4RM21Y0PT5GNSS146Q level=info ts=2018-09-13T13:38:14.103075885Z caller=repair.go:39 component=tsdb msg="found healthy block" mint=1536753600000 maxt=1536775200000 ulid=01CQ7SV8WJ3C2W5S3RTAHC2GHB level=error ts=2018-09-13T14:05:18.208469169Z caller=wal.go:275 component=tsdb msg="WAL corruption detected; truncating" err="unexpected CRC32 checksum d0465484, want 0" file=/opt/prometheus/data/.prom2-data/wal/007357 pos=15504363 level=info ts=2018-09-13T14:05:19.471459777Z caller=main.go:543 msg="TSDB started" level=info ts=2018-09-13T14:05:19.471604598Z caller=main.go:603 msg="Loading configuration file" filename=/etc/prometheus.yml level=info ts=2018-09-13T14:05:19.499156711Z caller=main.go:629 msg="Completed loading of configuration file" filename=/etc/prometheus.yml level=info ts=2018-09-13T14:05:19.499228186Z caller=main.go:502 msg="Server is ready to receive web requests."</code> </pre> <br>  Das Hauptproblem des Wiederherstellungsprozesses ist der hohe Speicherverbrauch.  Trotz der Tatsache, dass der Server in einer normalen Situation stabil mit der gleichen Speichermenge arbeiten kann, kann es bei einem Absturz aufgrund von OOM nicht zu einem Anstieg kommen.  Die einzige L√∂sung, die ich gefunden habe, war, die Datenerfassung zu deaktivieren, den Server zu erh√∂hen, ihn wiederherzustellen und mit der bereits aktivierten Erfassung neu zu starten. <br><br><h3>  Aufw√§rmen </h3><br>  Ein weiteres Verhalten, an das Sie sich beim Aufw√§rmen erinnern sollten, ist das Verh√§ltnis von geringer Produktivit√§t und hohem Ressourcenverbrauch direkt nach dem Start.  W√§hrend einiger, aber nicht aller Starts stellte ich eine ernsthafte Belastung der CPU und des Speichers fest. <br><br><img src="https://habrastorage.org/webt/kj/lr/2d/kjlr2dlj8mqn0od1dvwlu5sxxdu.png"><br><br><img src="https://habrastorage.org/webt/k_/ua/-y/k_ua-yqqzwh9elxbcoceu6tsrry.png"><br><br>  Speicherl√ºcken weisen darauf hin, dass Prometheus nicht von Anfang an alle Geb√ºhren konfigurieren kann und einige Informationen verloren gehen. <br><br>  Ich habe die genauen Gr√ºnde f√ºr die hohe Belastung des Prozessors und des Speichers nicht herausgefunden.  Ich vermute, dass dies auf die Erstellung neuer Zeitreihen im Kopfblock mit hoher Frequenz zur√ºckzuf√ºhren ist. <br><br><h3>  CPU-Lastspitzen </h3><br>  Zus√§tzlich zu den Dichtungen, die eine ziemlich hohe E / A-Last erzeugen, bemerkte ich alle zwei Minuten ernsthafte Lastspr√ºnge auf dem Prozessor.  Bursts dauern l√§nger mit einem hohen eingehenden Stream und es sieht so aus, als w√ºrden sie vom Go-Garbage-Collector verursacht. Zumindest einige Kernel sind vollst√§ndig geladen. <br><br><img src="https://habrastorage.org/webt/uv/jp/os/uvjposyjmeulwwpvafsdqw_dn20.png"><br><br><img src="https://habrastorage.org/webt/rd/pp/se/rdppsepllvvc85uijh14zwzbsqc.png"><br><br>  Diese Spr√ºnge sind nicht so unbedeutend.  Es scheint, dass der interne Einstiegspunkt und die Prometheus-Metriken nicht mehr zug√§nglich sind, wenn sie auftreten, was zu Datenl√ºcken in denselben Zeitintervallen f√ºhrt. <br><br><img src="https://habrastorage.org/webt/_h/aw/cn/_hawcnvkbwin1kzi8opatkmgbku.png"><br><br>  Sie k√∂nnen auch feststellen, dass der Prometheus-Exporteur f√ºr eine Sekunde geschlossen bleibt. <br><br><img src="https://habrastorage.org/webt/i7/5s/3g/i75s3g5_1bemugg59bgcuiiv-xq.png"><br><br>  Wir k√∂nnen Korrelationen mit der Garbage Collection (GC) erkennen. <br><br><img src="https://habrastorage.org/webt/vx/sn/_y/vxsn_ykevsbir37pexcvjunszn8.png"><br><br><h3>  Fazit </h3><br>  TSDB in Prometheus 2 ist schnell, kann Millionen von Zeitreihen verarbeiten und gleichzeitig Tausende von Aufnahmen pro Sekunde mit relativ bescheidener Hardware aufnehmen.  Beeindruckend ist auch die Auslastung der CPU- und Festplatten-E / A.  In meinem Beispiel wurden bis zu 200.000 Metriken pro Sekunde und verwendetem Kern angezeigt. <br><br>  Um die Erweiterung zu planen, m√ºssen Sie sich an ausreichende Speichervolumina erinnern. Dies sollte realer Speicher sein.  Die Menge des verwendeten Speichers, die ich beobachtete, betrug ungef√§hr 5 GB pro 100.000 Eintr√§ge pro Sekunde des eingehenden Streams, was zusammen mit dem Betriebssystem-Cache ungef√§hr 8 GB belegten Speicher ergab. <br><br>  Nat√ºrlich gibt es noch viel Arbeit, um die Bursts von CPU- und Festplatten-E / A zu z√§hmen, und dies ist nicht √ºberraschend, wenn man bedenkt, wie jung die TSDB Prometheus 2 im Vergleich zu InnoDB, TokuDB, RocksDB, WiredTiger ist, aber alle hatten zu Beginn des Lebenszyklus √§hnliche Probleme. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445370/">https://habr.com/ru/post/de445370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445358/index.html">Organisation des Ereignissystems in Unity - mit den Augen eines Spieledesigners</a></li>
<li><a href="../de445360/index.html">5 typische Aufgaben f√ºr JavaScript-Interviews: Analyse und L√∂sungen</a></li>
<li><a href="../de445362/index.html">Das Buch "Distributed Systems. Entwurfsmuster</a></li>
<li><a href="../de445366/index.html">So beschleunigen Sie die Verschl√ºsselung gem√§√ü GOST 28147-89 auf dem Baikal-T1-Prozessor aufgrund des SIMD-Blocks</a></li>
<li><a href="../de445368/index.html">Laden Sie ein Spiel mit ein paar Hunderttausenden von virtuellen Benutzern</a></li>
<li><a href="../de445372/index.html">Bildverarbeitung vs. menschliche Intuition: Algorithmen zur Unterbrechung des Betriebs von Objekterkennungsprogrammen</a></li>
<li><a href="../de445378/index.html">Labyrinthe: Klassifizierung, Erzeugung, Suche nach L√∂sungen</a></li>
<li><a href="../de445380/index.html">Modernes PHP ist sch√∂n und produktiv</a></li>
<li><a href="../de445384/index.html">Chang'e-4 Mission - wissenschaftliche Ausr√ºstung auf dem Landemodul und dem Repeater-Satelliten</a></li>
<li><a href="../de445390/index.html">IDE einer normalen Person oder warum wir uns f√ºr Monaco entschieden haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>