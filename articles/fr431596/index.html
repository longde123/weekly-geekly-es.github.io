<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüöí üóùÔ∏è ü§±üèª Test de charge de sauvegarde et de r√©plication Veeam üí∞ üö∂üèæ ‚òùüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au printemps 2018, Selectel a lanc√© un service de sauvegarde pour VMware Cloud via Veeam¬Æ Backup & Replication ‚Ñ¢ (ci-apr√®s VBR). Nous avons abord√© le ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de charge de sauvegarde et de r√©plication Veeam</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/431596/"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  Au printemps 2018, Selectel a lanc√© un service de sauvegarde pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VMware Cloud</a> via Veeam¬Æ Backup &amp; Replication ‚Ñ¢ (ci-apr√®s VBR).  Nous avons abord√© le projet de mani√®re approfondie, planifi√© et r√©alis√© la liste de travaux suivante: <br><br><ul><li>  Explorer la documentation et les meilleures pratiques des produits Veeam </li><li>  Conception d'une architecture VBR au niveau du fournisseur de services </li><li>  D√©ployer l'infrastructure VBR </li><li>  Test de la solution, d√©termination des param√®tres et modes de fonctionnement optimaux </li><li>  Lancement de la solution en exploitation industrielle (commerciale) </li></ul><br>  Il s'est av√©r√© - pas en vain.  Le service est stable, les clients peuvent sauvegarder leurs machines virtuelles et nous avons une certaine expertise que nous voulons partager. <br><br>  Dans cet article, nous voulons parler des r√©sultats des tests de charge VBR pour les deux modes de fonctionnement du proxy de sauvegarde les plus populaires, en tenant compte de la variation du nombre de t√¢ches parall√®les. <br><a name="habracut"></a><br>  Ici vous pouvez voir: <br><br><ul><li>  Description de l'infrastructure de production Selectel utilis√©e pour les tests </li><li>  Fonctionnalit√©s du proxy de sauvegarde (proxy de sauvegarde) dans divers modes de transport </li><li>  Description du programme de test et des param√®tres des composants VBR pour sa mise en ≈ìuvre </li><li>  Indicateurs quantitatifs, comparaison et conclusions </li></ul><br><h2>  Tester la configuration de l'infrastructure </h2><br><h3>  Infrastructure source </h3><br>  En tant que plate-forme pour tester les performances de VBR, l'un des clusters de production du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud</a> public <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bas√© sur VMware a √©t√© cr√©√©</a> . <br><br><ul><li>  La configuration mat√©rielle des h√¥tes de ce cluster: </li><li>  Processeurs Intel¬Æ Xeon¬Æ Gold 6140 </li><li>  Intel¬Æ DC NVMe P4600 et P3520 </li><li>  4 ports 10 GbE par h√¥te </li></ul><br>  Le cluster est bas√© sur les solutions suivantes: <br><br><ul><li>  R√©seau physique - Usine Ethernet sur les commutateurs Brocade VDX, architecture Leaf-Spine (ports 10 GbE - h√¥tes de connexion, liaisons montantes 40 GbE vers Spine) </li><li>  Environnement de virtualisation - VMware vSphere¬Æ 6.5 </li><li>  Stockage VM - VMware vSAN ‚Ñ¢ 6.6 (cluster vSAN 100% Flash) </li><li>  Virtualisation r√©seau - VMware NSX¬Æ 6.4 </li></ul><br>  Les performances de la plateforme de test sont plus que suffisantes et ne font aucun doute.  Bien s√ªr, pour des performances √† haute vitesse, tout cela doit √™tre correctement configur√©, mais comme il s'agit de production, avec des clients anim√©s et satisfaits, vous pouvez √™tre s√ªr que tout va bien √† cet √©gard. <br><br>  Avec Cloud bas√© sur VMware, Selectel a lanc√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service</a> pour sa sauvegarde sur la plate-forme VBR.  Les clients re√ßoivent un portail Web libre-service o√π ils peuvent sauvegarder et restaurer des vApp et des VM √† partir de leur VDC (centre de donn√©es virtuel). <br><br>  Les clients ont acc√®s √† ce portail (portail libre-service Veeam¬Æ Enterprise Manager) avec les m√™mes droits que vCloud Director¬Æ (vCD).  Cela est possible en raison de l'int√©gration de Veeam¬Æ Backup Enterprise Manager (EM) et de vCD, alors que chaque client, lorsqu'il est connect√© √† EM, est limit√© par les ressources de son VDC, il ne verra pas d'autres VM. <br><br>  Le client n'a pas besoin de d√©ployer son propre VBR et l'infrastructure de sauvegarde associ√©e, ce qui implique les co√ªts des ressources informatiques et r√©seau, du stockage, des licences Veeam et MS et de l'administration.  C'est long, cher et compliqu√©.  Selectel fournit les capacit√©s de base de VBR en tant que service BaaS (Backup-as-a-Service): instantan√©ment, simplement, commod√©ment et √©conomiquement. <br><br>  Pour fournir ce service, Selectel a d√©ploy√© une infrastructure de fournisseur VBR couvrant tous les clusters vSphere et VDC de clients cloud VMware, y compris le cluster dans lequel ce test a √©t√© effectu√©.  Ainsi, les r√©sultats des tests nous permettront de juger de la vitesse maximale avec laquelle les clients peuvent sauvegarder leurs VM. <br><br><h3>  Tester les machines virtuelles </h3><br>  Pour tester les performances de sauvegarde, 6 machines virtuelles identiques ont √©t√© d√©ploy√©es dans le cluster vSphere dans la configuration suivante: <br><br><ul><li>  OS Windows Server 2016, 2 processeurs virtuels, 4 Go de RAM </li><li>  200 Go de vDisk </li></ul><br>  Le disque est presque plein - 193 Go.  En plus des fichiers OS, un dossier avec des distributions de divers OS et SGBD d'une capacit√© de 60 Go a √©t√© cr√©√© dessus (donn√©es uniques).  Sur le m√™me lecteur, 3 copies de ce dossier ont √©t√© cr√©√©es - un total de 180 Go de donn√©es non syst√®me. <br><br>  Aucune application n'a √©t√© install√©e sur ces VM, seulement un OS ¬´propre¬ª et des donn√©es ¬´froides¬ª.  Aucune charge, informatique ou r√©seau, d√©marr√©e.  Pour ce test, cela n'√©tait pas n√©cessaire. <br><br>  Le DRS est activ√© dans le cluster vSphere, de sorte que les machines virtuelles de test sont automatiquement r√©parties de mani√®re optimale sur les h√¥tes VMware ESXi ‚Ñ¢ pour l'√©quilibrage de charge. <br><br><h3>  Proxy de sauvegarde </h3><br>  Une machine virtuelle avec proxy de sauvegarde est d√©ploy√©e directement dans le cluster vSphere d√©crit ci-dessus (l'infrastructure source, ci-apr√®s d√©nomm√©e cluster vSphere), il s'agit d'une condition n√©cessaire pour les tests en mode Virtual Appliance. <br><br>  Configuration VM: <br><br><ul><li>  8 vCPU </li><li>  8 Go de RAM </li><li>  VDisk de 40 Go </li><li>  10GbE vNIC vmxnet3 </li><li>  OS Windows Server 2016 </li></ul><br>  Le param√®tre "T√¢ches simultan√©es maximales" pour le proxy de sauvegarde au niveau VBR est d√©fini sur 6. Cela signifie que le proxy de sauvegarde peut traiter simultan√©ment (en parall√®le) jusqu'√† 6 t√¢ches de sauvegarde.  Une t√¢che consiste √† sauvegarder un disque de machine virtuelle virtuelle. <br><br><h3>  R√©f√©rentiel de sauvegarde </h3><br>  Le serveur physique faisant office de r√©f√©rentiel de sauvegarde de VBR agit en tant que frontal du stockage de sauvegarde.  Configuration du serveur: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32 Go de RAM </li><li>  2 ports 10 GbE </li></ul><br>  Backend de stockage - cluster CephFS avec cache NVMe. <br><br>  Le r√©f√©rentiel de sauvegarde et les n≈ìuds Ceph communiquent sur un r√©seau 10 GbE, chacun d'eux est connect√© aux commutateurs par deux ports. <br><br>  Une description d√©taill√©e de la configuration du cluster Ceph d√©passe le cadre de cet article.  Notez que pour la fiabilit√© et la tol√©rance aux pannes, les donn√©es y relatives sont stock√©es en trois exemplaires.  Les performances du cluster ne sont pas satisfaisantes et avec une marge, les r√©sultats des tests ont montr√© que dans aucun d'entre eux le stockage de sauvegarde n'√©tait un goulot d'√©tranglement. <br><br>  Le param√®tre "Limiter le nombre maximal de t√¢ches simultan√©es" pour le r√©f√©rentiel de sauvegarde au niveau VBR est d√©fini sur 6. Cela signifie que le r√©f√©rentiel de sauvegarde pourra traiter simultan√©ment (jusqu'√† 6) t√¢ches de sauvegarde. <br><br><h3>  R√©seau de sauvegarde </h3><br>  Le r√©seau physique de l'infrastructure d√©crite ci-dessus est limit√© par une bande passante de 10 Gbit / s, des commutateurs et des ports 10GbE sont utilis√©s partout.  Cela est vrai non seulement pour vSAN, mais √©galement pour les interfaces de gestion des h√¥tes ESXi. <br><br>  Pour h√©berger un proxy de sauvegarde au niveau de VMware NSX, un sous-r√©seau d√©di√© a √©t√© cr√©√© avec son propre commutateur logique.  Pour sa connectivit√© avec la physique et le routage, le NSX-edge, une taille X-large, a √©t√© d√©ploy√©. <br><br>  √Ä l'avenir, selon les r√©sultats des tests, il est clair que le r√©seau peut supporter une charge allant jusqu'√† 8 Gb / s.  Il s'agit d'une bande passante tr√®s solide, qui est suffisante √† ce stade, si n√©cessaire, elle peut √™tre augment√©e. <br><br><h3>  Diagramme d'interaction des composants </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Les proxys de sauvegarde et les machines virtuelles de test sont d√©ploy√©s dans le m√™me cluster VMware vSAN.  Apr√®s le d√©marrage du job de sauvegarde (job de sauvegarde), en fonction du mode de transport s√©lectionn√©, dont les fonctionnalit√©s sont d√©crites ci-dessous, un proxy de sauvegarde: <br><br><ul><li>  R√©cup√®re les donn√©es des machines virtuelles de sauvegarde via vSAN (HotAdd) ou r√©seau de contr√¥le (NBD) </li><li>  Transf√®re les donn√©es trait√©es vers le r√©f√©rentiel de sauvegarde sur le sous-r√©seau allou√© √† cet effet </li></ul><br><h2>  Modes de transport du proxy de sauvegarde </h2><br>  Le proxy de sauvegarde est un composant de l'infrastructure VBR qui effectue directement le traitement des travaux de sauvegarde.  Il extrait les donn√©es de la machine virtuelle, les traite (compresse, d√©duplique, chiffre) et les envoie au r√©f√©rentiel, o√π elles sont enregistr√©es dans des fichiers de sauvegarde. <br><br>  Le proxy de sauvegarde vous permet de travailler dans trois modes de transport: <br><br><ul><li>  Acc√®s direct au stockage </li><li>  Appliance virtuelle </li><li>  R√©seau </li></ul><br>  Le cloud bas√© sur VMware Selectel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilise vSAN</a> comme stockage, dans cette configuration, l'acc√®s direct au stockage n'est pas pris en charge, ce mode n'est donc pas pris en compte et n'a pas √©t√© test√©.  Les deux modes restants fonctionnent √† merveille sur chacun de nos clusters vSphere. Arr√™tons-nous plus en d√©tail. <br><br><h3>  Mode d'appareil virtuel (HotAdd) </h3><br>  L'appliance virtuelle est le mode recommand√© lors du d√©ploiement de proxys de sauvegarde en tant que machines virtuelles.  Les h√¥tes ESXi sur lesquels les proxys de sauvegarde sont d√©ploy√©s doivent avoir acc√®s √† tous le magasin de donn√©es du cluster vSphere qui stocke les machines virtuelles de sauvegarde.  L'essence du mode est que le proxy monte les disques de la machine virtuelle de sauvegarde (VMware SCSI HotAdd) et en prend les donn√©es comme si c'√©tait les siennes.  L'extraction de donn√©es se produit avec Datastore sur un r√©seau de stockage. <br><br>  Dans notre cas, la machine virtuelle de proxy de sauvegarde doit √™tre situ√©e sur l'un des h√¥tes ESXi du cluster vSAN que nous sauvegardons.  L'extraction des donn√©es a lieu via vSAN.  Ainsi, pour fonctionner en mode d'appareil virtuel, au moins un proxy de sauvegarde doit √™tre d√©ploy√© dans chaque cluster vSAN.  D√©veloppez une paire de proxys de sauvegarde (par exemple, dans un cluster de gestion) et la sauvegarde de tous les clusters vSAN avec eux √©chouera. <br><table><tbody><tr><td align="center">  <strong>Avantages</strong> </td><td align="center">  <strong>Inconv√©nients</strong> </td></tr><tr><td>  Rapide, en r√®gle g√©n√©rale, est beaucoup plus rapide que NBD, en particulier dans le cas d'une sauvegarde compl√®te ou de grands incr√©ments.  Seul l'acc√®s direct au stockage peut √™tre inf√©rieur en vitesse. </td><td>  L'op√©ration de montage de disques (HotAdd) sur un proxy peut prendre jusqu'√† 2 minutes par disque.  Avec des sauvegardes incr√©mentielles de petits morceaux de donn√©es, NBD peut √™tre plus rapide. </td></tr><tr><td>  √âlimine le r√©seau de stockage.  Ne charge pas l'interface de gestion et l'hyperviseur. </td><td>  La machine virtuelle proxy consomme une partie des ressources de l'h√¥te.  Parfois, il peut y avoir des probl√®mes avec la suppression des instantan√©s. </td></tr></tbody></table><h3>  Mode r√©seau (NBD) </h3><br>  Il s'agit du mode le plus simple et le plus universel, adapt√© aux proxys de sauvegarde physiques et virtuels.  Contrairement aux deux modes pr√©c√©dents, l'extraction de donn√©es ne se produit pas sur le r√©seau de stockage.  Un proxy de sauvegarde prend les donn√©es VM en se connectant √† l'interface de gestion des h√¥tes ESXi sur lesquels ils s'ex√©cutent. <br><br>  Cette approche pr√©sente les inconv√©nients suivants: <br><br><ul><li>  Souvent, les interfaces de gestion ESXi ne tiennent pas sur les liaisons montantes les plus rapides, en r√®gle g√©n√©rale, il s'agit de 1 GbE </li><li>  M√™me si l'interface de gestion aura des ports 10 GbE, ESXi n'abandonnera pas l'int√©gralit√© du proxy de bande proxy - il le limite artificiellement et n'alloue qu'une partie de la bande passante de l'interface pour les sauvegardes </li></ul><table><tbody><tr><td align="center">  <strong>Avantages</strong> </td><td align="center">  <strong>Inconv√©nients</strong> </td></tr><tr><td>  Simple et polyvalent.  Les proxys peuvent √™tre physiques et virtuels. </td><td>  En r√®gle g√©n√©rale, il est beaucoup plus lent que HotAdd, en particulier sur les gros volumes de sauvegarde et un petit nombre de t√¢ches parall√®les. </td></tr><tr><td>  D√©marrage rapide, aucun retard sur le montage des variateurs.  Aucun probl√®me avec les instantan√©s. </td><td>  Cr√©e une charge (petite) sur l'interface de gestion et l'hyperviseur. </td></tr></tbody></table>  Dans le m√™me temps, de nombreuses sources affirment que NBD est tr√®s lent √† 1 GbE, mais √† 10 GbE, il peut √™tre assez rapide.  Nous allons certainement v√©rifier cela. <br><br><h2>  Programme de test </h2><br>  Sur l'infrastructure d√©crite ci-dessus, il est n√©cessaire de sauvegarder les VM de test et d'enregistrer les indicateurs suivants: <br><br><ul><li>  Charge CPU,% </li><li>  Consommation de RAM, Go </li><li>  Charge r√©seau, Gbps </li><li>  Performances de sauvegarde, Mo / s </li><li>  Temps de sauvegarde, mm: ss </li></ul><br>  Les indicateurs doivent √™tre fixes pour la sauvegarde d'une machine virtuelle de test et pour la sauvegarde parall√®le de deux, quatre et six machines virtuelles de test. <br><br>  Des indicateurs doivent √™tre enregistr√©s pour les modes de fonctionnement de l'appliance virtuelle et du proxy de sauvegarde r√©seau.  Chaque fois qu'une sauvegarde compl√®te doit √™tre effectu√©e, aucun incr√©ment. <br><br>  Ainsi, il est n√©cessaire de cr√©er 4 jobs de sauvegarde: <br><br><ul><li>  Pour une VM de test </li><li>  Pour deux machines virtuelles de test </li><li>  Pour quatre machines virtuelles de test </li><li>  Pour six machines virtuelles de test </li></ul><br>  Dans le cadre des tests, il est n√©cessaire: <br><br><ol><li>  Ex√©cutez s√©quentiellement toutes les t√¢ches en un seul mode </li><li>  Supprimer les sauvegardes cr√©√©es afin qu'il n'y ait pas d'incr√©ments </li><li>  R√©p√©ter les ex√©cutions dans le deuxi√®me mode, en fixant chaque fois les indicateurs </li></ol><br>  Dans les param√®tres de chaque t√¢che, vous devez s√©lectionner manuellement un proxy de sauvegarde pr√©par√© pour les tests, car ce n'est pas le seul dans l'infrastructure VBR g√©n√©rale, et par d√©faut, le proxy est automatiquement s√©lectionn√©. <br><br>  Le mode proxy de sauvegarde par d√©faut est √©galement automatiquement s√©lectionn√©.  Par cons√©quent, dans les param√®tres du proxy de sauvegarde, avant chaque ex√©cution, d√©finissez manuellement le mode de transport souhait√©. <br><br>  L'indicateur le plus int√©ressant est la vitesse moyenne ou les performances de sauvegarde.  Il peut √™tre vu dans les r√©sultats du travail dans la console VBR.  Il affichera √©galement le runtime de sauvegarde. <br><br>  De plus, vous devez √©valuer la charge sur le proxy de sauvegarde dans chacun des tests.  La congestion du processeur, de la m√©moire et du r√©seau peut √™tre surveill√©e √† l'aide des outils du syst√®me d'exploitation invit√© (Windows 2016) et au niveau de VMware. <br><br>  Sur le proxy de sauvegarde et les r√©f√©rentiels de sauvegarde, le param√®tre du nombre maximal de t√¢ches simultan√©es est d√©fini sur 6. Cela signifie que pendant le test, toutes les machines virtuelles de chaque t√¢che seront trait√©es en parall√®le, aucune d'entre elles n'attendra dans la file d'attente, les performances seront maximales. <br><br>  Veeam¬Æ recommande que le nombre de t√¢ches parall√®les ne d√©passe pas le nombre de c≈ìurs de processeur sur les proxys et les r√©f√©rentiels.  La quantit√© de RAM recommand√©e sur le r√©f√©rentiel est de 2 Go par c≈ìur, soit 12 Go au total.  La configuration de l'infrastructure montre que toutes les recommandations sont suivies. <br><br><h2>  Vitesse et charge de sauvegarde en mode Virtual Appliance (ajout √† chaud) </h2><br><h3>  Sauvegarde 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  55-95 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2-2,2 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  709 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  70-100 (√©tag√®re 100% avec de courtes chutes brusques √† 70%) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  5-7,7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  816 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  100 (√©tag√®re 100% avec de petites gouttes rares) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  3-3,5 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  885 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  100 (√©tag√®re 100% avec de petites gouttes rares) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  4-4,2 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  888 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Vitesse de sauvegarde et charge en mode r√©seau (NBD) </h2><br><h3>  Sauvegarde 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  18-24 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  192 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  18h30 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  25-33 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  1,5-2,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  269 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  45-55 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2,8-3,5 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  2,8-4,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  446 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  50-70 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  3,5-4 </td></tr><tr><td>  Charge r√©seau, Gbps </td><td align="center">  3,5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  517 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Comparaison des performances et de la charge dans l'appliance virtuelle (HotAdd) et le mode r√©seau (NBD) </h2><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Vitesse - HotAdd, Mo / s</strong> </td><td align="center">  <strong>Vitesse - NBD, Mo / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3,69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1,98 </td></tr><tr><td align="center">  6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1,72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Charge CPU - HotAdd,%</strong> </td><td align="center">  <strong>Charge CPU - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3.06-3.96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1.82-2.22 </td></tr><tr><td align="center">  6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1,43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>T√©l√©chargement de RAM - HotAdd, GB</strong> </td><td align="center">  <strong>Chargement RAM - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  2-2,2 </td><td align="center">  1.9-2.1 </td><td align="center">  1,05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1,04-1,05 </td></tr><tr><td align="center">  4 </td><td align="center">  3-3,5 </td><td align="center">  2,8-3,5 </td><td align="center">  1-1.07 </td></tr><tr><td align="center">  6 </td><td align="center">  4-4,2 </td><td align="center">  3,5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>T√©l√©chargement r√©seau - HotAdd, Gb / s</strong> </td><td align="center">  <strong>T√©l√©chargement r√©seau - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3.56-3.92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7,7 </td><td align="center">  1,5-2,5 </td><td align="center">  3.08-3.33 </td></tr><tr><td align="center">  4 </td><td align="center">  5-8,2 </td><td align="center">  2,8-4,5 </td><td align="center">  1,79-1,82 </td></tr><tr><td align="center">  6 </td><td align="center">  5-8,2 </td><td align="center">  3,5-5 </td><td align="center">  1,43-1,64 </td></tr></tbody></table><h2>  R√©sultats des tests </h2><br>  Les indicateurs de performance de sauvegarde obtenus √† la suite de tests confirment sans √©quivoque le fait que le mode d'appareil virtuel est nettement sup√©rieur en vitesse par rapport au mode r√©seau, en particulier dans un petit nombre de t√¢ches parall√®les. <br><br>  Permettez-moi de vous rappeler que les tests pour les deux modes ont √©t√© ex√©cut√©s dans des conditions absolument identiques sur la m√™me plate-forme.  La bande passante du r√©seau √©tait √©galement la m√™me - les interfaces de contr√¥le √† travers lesquelles le proxy collecte des donn√©es en mode NBD donnent 10 Gbit / s, comme le r√©seau vSAN pour le mode HotAdd, nous n'avons d√©fini aucune limite de bande passante. <br><br>  De toute √©vidence, ESXi ralentit vraiment Veeam¬Æ et ne lui donne qu'une partie de la bande en mode r√©seau, d'o√π les diff√©rences de vitesse de sauvegarde.  Cependant, avec l'augmentation du nombre de threads - t√¢ches de sauvegarde simultan√©es - le mode R√©seau r√©duit consid√©rablement le retard. <br><br>  Nous voyons qu'en mode Appliance virtuelle, d√©j√† sur 4 VM, le proxy de sauvegarde repose sur le processeur, il ne peut pas fonctionner plus vite, pour 6 VM la vitesse de sauvegarde n'a pas beaucoup chang√©.  Dans le m√™me temps, la vitesse de sauvegarde de 1 √† 2 machines virtuelles dans ce mode est l√©g√®rement en retard, les capacit√©s des proxys et des plates-formes de sauvegarde sont utilis√©es au maximum, m√™me sur un petit nombre de threads. <br><br>  En mode R√©seau, au contraire, il y a une augmentation significative de la productivit√© avec une augmentation du nombre de t√¢ches simultan√©es.  Dans le m√™me temps, la charge sur le processeur proxy de sauvegarde est nettement inf√©rieure √† celle du mode HotAdd, m√™me sur 6 threads, elle ne d√©passe pas 70%. <br><br>  La consommation de m√©moire du proxy de sauvegarde est faible et approximativement la m√™me dans les deux modes. <br><br>  La charge sur le r√©seau proxy de sauvegarde est en corr√©lation avec la vitesse de sauvegarde, la d√©passant de ~ 10-17%.  Apparemment, le proxy prend les donn√©es des sources de machines virtuelles un peu plus rapidement qu'il ne les t√©l√©charge dans le r√©f√©rentiel, car elles doivent √™tre trait√©es. <br><br>  Il est int√©ressant d'observer la ligne Load dans les images avec les r√©sultats de l'ex√©cution du travail.  Il montre le niveau de charge sur divers √©l√©ments de l'infrastructure de sauvegarde: source, proxy, r√©seau, r√©f√©rentiel. <br><br>  En mode d'appliance virtuelle, nous voyons que les performances de sauvegarde reposent sur le proxy et le r√©seau, elles sont toujours approximativement √† la m√™me charge.  La source et le r√©f√©rentiel ne sont pas un goulot d'√©tranglement. <br><br>  En mode r√©seau, le goulot d'√©tranglement est toujours la source, m√™me pour un seul flux.  On peut voir que le reste de l'infrastructure peut donner plus, mais ESXi ne les donne pas. <br><br><h2>  R√©sum√© </h2><br>  Les tests ont confirm√© que le proxy de sauvegarde dans les modes de transport √©tudi√©s se comporte exactement comme le sugg√®re la th√©orie. <br><br>  Le logiciel Veeam¬Æ s'est av√©r√© tr√®s utile: <br><br><ul><li>  En mode HotAdd, toutes les capacit√©s de l'infrastructure ont √©t√© utilis√©es efficacement et compl√®tement. </li><li>  En mode NBD, les performances devraient √™tre plus modestes, mais ce n'est pas un probl√®me Veeam¬Æ, mais une fonctionnalit√© de la pile r√©seau ESXi </li></ul><br>  Nous avons obtenu des indicateurs de performances et de charge r√©els, ce qui est tr√®s utile pour choisir le mode de fonctionnement optimal et la mise √† l'√©chelle ult√©rieure du syst√®me. <br><br>  Pour le moment, nous sommes tr√®s satisfaits des performances de sauvegarde existantes, nous savons comment les augmenter correctement lorsqu'un tel besoin se fait sentir. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431596/">https://habr.com/ru/post/fr431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431582/index.html">Histoire de la protection des donn√©es personnelles: comment est n√© le RGPD?</a></li>
<li><a href="../fr431584/index.html">Espace et test: m√©langer, mais ne pas secouer</a></li>
<li><a href="../fr431586/index.html">Comment g√©rer plus rapidement les erreurs sur la JVM</a></li>
<li><a href="../fr431588/index.html">Loi sur les travailleurs ind√©pendants. Informations √† consid√©rer</a></li>
<li><a href="../fr431590/index.html">La modernisation des parcs √©oliens britanniques obsol√®tes augmentera la production d'√©nergie de 171%</a></li>
<li><a href="../fr431598/index.html">Nous apportons √† Internet une machine virtuelle publique QEMU sans carte r√©seau et essayons d'exploiter</a></li>
<li><a href="../fr431600/index.html">Augmenter IDS / NMS: Mikrotik et Suricata avec une interface Web</a></li>
<li><a href="../fr431602/index.html">Les d√©veloppeurs russes ont pr√©sent√© √† Londres un syst√®me de r√©adaptation virtuel</a></li>
<li><a href="../fr431604/index.html">Localisation dans Go avec des packages de base</a></li>
<li><a href="../fr431608/index.html">La soci√©t√© am√©ricaine DriveSavers est la premi√®re au monde √† lancer un service de piratage iPhone pour les particuliers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>