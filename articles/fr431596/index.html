<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🚒 🗝️ 🤱🏻 Test de charge de sauvegarde et de réplication Veeam 💰 🚶🏾 ☝🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au printemps 2018, Selectel a lancé un service de sauvegarde pour VMware Cloud via Veeam® Backup & Replication ™ (ci-après VBR). Nous avons abordé le ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de charge de sauvegarde et de réplication Veeam</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/431596/"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  Au printemps 2018, Selectel a lancé un service de sauvegarde pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VMware Cloud</a> via Veeam® Backup &amp; Replication ™ (ci-après VBR).  Nous avons abordé le projet de manière approfondie, planifié et réalisé la liste de travaux suivante: <br><br><ul><li>  Explorer la documentation et les meilleures pratiques des produits Veeam </li><li>  Conception d'une architecture VBR au niveau du fournisseur de services </li><li>  Déployer l'infrastructure VBR </li><li>  Test de la solution, détermination des paramètres et modes de fonctionnement optimaux </li><li>  Lancement de la solution en exploitation industrielle (commerciale) </li></ul><br>  Il s'est avéré - pas en vain.  Le service est stable, les clients peuvent sauvegarder leurs machines virtuelles et nous avons une certaine expertise que nous voulons partager. <br><br>  Dans cet article, nous voulons parler des résultats des tests de charge VBR pour les deux modes de fonctionnement du proxy de sauvegarde les plus populaires, en tenant compte de la variation du nombre de tâches parallèles. <br><a name="habracut"></a><br>  Ici vous pouvez voir: <br><br><ul><li>  Description de l'infrastructure de production Selectel utilisée pour les tests </li><li>  Fonctionnalités du proxy de sauvegarde (proxy de sauvegarde) dans divers modes de transport </li><li>  Description du programme de test et des paramètres des composants VBR pour sa mise en œuvre </li><li>  Indicateurs quantitatifs, comparaison et conclusions </li></ul><br><h2>  Tester la configuration de l'infrastructure </h2><br><h3>  Infrastructure source </h3><br>  En tant que plate-forme pour tester les performances de VBR, l'un des clusters de production du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud</a> public <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">basé sur VMware a été créé</a> . <br><br><ul><li>  La configuration matérielle des hôtes de ce cluster: </li><li>  Processeurs Intel® Xeon® Gold 6140 </li><li>  Intel® DC NVMe P4600 et P3520 </li><li>  4 ports 10 GbE par hôte </li></ul><br>  Le cluster est basé sur les solutions suivantes: <br><br><ul><li>  Réseau physique - Usine Ethernet sur les commutateurs Brocade VDX, architecture Leaf-Spine (ports 10 GbE - hôtes de connexion, liaisons montantes 40 GbE vers Spine) </li><li>  Environnement de virtualisation - VMware vSphere® 6.5 </li><li>  Stockage VM - VMware vSAN ™ 6.6 (cluster vSAN 100% Flash) </li><li>  Virtualisation réseau - VMware NSX® 6.4 </li></ul><br>  Les performances de la plateforme de test sont plus que suffisantes et ne font aucun doute.  Bien sûr, pour des performances à haute vitesse, tout cela doit être correctement configuré, mais comme il s'agit de production, avec des clients animés et satisfaits, vous pouvez être sûr que tout va bien à cet égard. <br><br>  Avec Cloud basé sur VMware, Selectel a lancé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service</a> pour sa sauvegarde sur la plate-forme VBR.  Les clients reçoivent un portail Web libre-service où ils peuvent sauvegarder et restaurer des vApp et des VM à partir de leur VDC (centre de données virtuel). <br><br>  Les clients ont accès à ce portail (portail libre-service Veeam® Enterprise Manager) avec les mêmes droits que vCloud Director® (vCD).  Cela est possible en raison de l'intégration de Veeam® Backup Enterprise Manager (EM) et de vCD, alors que chaque client, lorsqu'il est connecté à EM, est limité par les ressources de son VDC, il ne verra pas d'autres VM. <br><br>  Le client n'a pas besoin de déployer son propre VBR et l'infrastructure de sauvegarde associée, ce qui implique les coûts des ressources informatiques et réseau, du stockage, des licences Veeam et MS et de l'administration.  C'est long, cher et compliqué.  Selectel fournit les capacités de base de VBR en tant que service BaaS (Backup-as-a-Service): instantanément, simplement, commodément et économiquement. <br><br>  Pour fournir ce service, Selectel a déployé une infrastructure de fournisseur VBR couvrant tous les clusters vSphere et VDC de clients cloud VMware, y compris le cluster dans lequel ce test a été effectué.  Ainsi, les résultats des tests nous permettront de juger de la vitesse maximale avec laquelle les clients peuvent sauvegarder leurs VM. <br><br><h3>  Tester les machines virtuelles </h3><br>  Pour tester les performances de sauvegarde, 6 machines virtuelles identiques ont été déployées dans le cluster vSphere dans la configuration suivante: <br><br><ul><li>  OS Windows Server 2016, 2 processeurs virtuels, 4 Go de RAM </li><li>  200 Go de vDisk </li></ul><br>  Le disque est presque plein - 193 Go.  En plus des fichiers OS, un dossier avec des distributions de divers OS et SGBD d'une capacité de 60 Go a été créé dessus (données uniques).  Sur le même lecteur, 3 copies de ce dossier ont été créées - un total de 180 Go de données non système. <br><br>  Aucune application n'a été installée sur ces VM, seulement un OS «propre» et des données «froides».  Aucune charge, informatique ou réseau, démarrée.  Pour ce test, cela n'était pas nécessaire. <br><br>  Le DRS est activé dans le cluster vSphere, de sorte que les machines virtuelles de test sont automatiquement réparties de manière optimale sur les hôtes VMware ESXi ™ pour l'équilibrage de charge. <br><br><h3>  Proxy de sauvegarde </h3><br>  Une machine virtuelle avec proxy de sauvegarde est déployée directement dans le cluster vSphere décrit ci-dessus (l'infrastructure source, ci-après dénommée cluster vSphere), il s'agit d'une condition nécessaire pour les tests en mode Virtual Appliance. <br><br>  Configuration VM: <br><br><ul><li>  8 vCPU </li><li>  8 Go de RAM </li><li>  VDisk de 40 Go </li><li>  10GbE vNIC vmxnet3 </li><li>  OS Windows Server 2016 </li></ul><br>  Le paramètre "Tâches simultanées maximales" pour le proxy de sauvegarde au niveau VBR est défini sur 6. Cela signifie que le proxy de sauvegarde peut traiter simultanément (en parallèle) jusqu'à 6 tâches de sauvegarde.  Une tâche consiste à sauvegarder un disque de machine virtuelle virtuelle. <br><br><h3>  Référentiel de sauvegarde </h3><br>  Le serveur physique faisant office de référentiel de sauvegarde de VBR agit en tant que frontal du stockage de sauvegarde.  Configuration du serveur: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32 Go de RAM </li><li>  2 ports 10 GbE </li></ul><br>  Backend de stockage - cluster CephFS avec cache NVMe. <br><br>  Le référentiel de sauvegarde et les nœuds Ceph communiquent sur un réseau 10 GbE, chacun d'eux est connecté aux commutateurs par deux ports. <br><br>  Une description détaillée de la configuration du cluster Ceph dépasse le cadre de cet article.  Notez que pour la fiabilité et la tolérance aux pannes, les données y relatives sont stockées en trois exemplaires.  Les performances du cluster ne sont pas satisfaisantes et avec une marge, les résultats des tests ont montré que dans aucun d'entre eux le stockage de sauvegarde n'était un goulot d'étranglement. <br><br>  Le paramètre "Limiter le nombre maximal de tâches simultanées" pour le référentiel de sauvegarde au niveau VBR est défini sur 6. Cela signifie que le référentiel de sauvegarde pourra traiter simultanément (jusqu'à 6) tâches de sauvegarde. <br><br><h3>  Réseau de sauvegarde </h3><br>  Le réseau physique de l'infrastructure décrite ci-dessus est limité par une bande passante de 10 Gbit / s, des commutateurs et des ports 10GbE sont utilisés partout.  Cela est vrai non seulement pour vSAN, mais également pour les interfaces de gestion des hôtes ESXi. <br><br>  Pour héberger un proxy de sauvegarde au niveau de VMware NSX, un sous-réseau dédié a été créé avec son propre commutateur logique.  Pour sa connectivité avec la physique et le routage, le NSX-edge, une taille X-large, a été déployé. <br><br>  À l'avenir, selon les résultats des tests, il est clair que le réseau peut supporter une charge allant jusqu'à 8 Gb / s.  Il s'agit d'une bande passante très solide, qui est suffisante à ce stade, si nécessaire, elle peut être augmentée. <br><br><h3>  Diagramme d'interaction des composants </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Les proxys de sauvegarde et les machines virtuelles de test sont déployés dans le même cluster VMware vSAN.  Après le démarrage du job de sauvegarde (job de sauvegarde), en fonction du mode de transport sélectionné, dont les fonctionnalités sont décrites ci-dessous, un proxy de sauvegarde: <br><br><ul><li>  Récupère les données des machines virtuelles de sauvegarde via vSAN (HotAdd) ou réseau de contrôle (NBD) </li><li>  Transfère les données traitées vers le référentiel de sauvegarde sur le sous-réseau alloué à cet effet </li></ul><br><h2>  Modes de transport du proxy de sauvegarde </h2><br>  Le proxy de sauvegarde est un composant de l'infrastructure VBR qui effectue directement le traitement des travaux de sauvegarde.  Il extrait les données de la machine virtuelle, les traite (compresse, déduplique, chiffre) et les envoie au référentiel, où elles sont enregistrées dans des fichiers de sauvegarde. <br><br>  Le proxy de sauvegarde vous permet de travailler dans trois modes de transport: <br><br><ul><li>  Accès direct au stockage </li><li>  Appliance virtuelle </li><li>  Réseau </li></ul><br>  Le cloud basé sur VMware Selectel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilise vSAN</a> comme stockage, dans cette configuration, l'accès direct au stockage n'est pas pris en charge, ce mode n'est donc pas pris en compte et n'a pas été testé.  Les deux modes restants fonctionnent à merveille sur chacun de nos clusters vSphere. Arrêtons-nous plus en détail. <br><br><h3>  Mode d'appareil virtuel (HotAdd) </h3><br>  L'appliance virtuelle est le mode recommandé lors du déploiement de proxys de sauvegarde en tant que machines virtuelles.  Les hôtes ESXi sur lesquels les proxys de sauvegarde sont déployés doivent avoir accès à tous le magasin de données du cluster vSphere qui stocke les machines virtuelles de sauvegarde.  L'essence du mode est que le proxy monte les disques de la machine virtuelle de sauvegarde (VMware SCSI HotAdd) et en prend les données comme si c'était les siennes.  L'extraction de données se produit avec Datastore sur un réseau de stockage. <br><br>  Dans notre cas, la machine virtuelle de proxy de sauvegarde doit être située sur l'un des hôtes ESXi du cluster vSAN que nous sauvegardons.  L'extraction des données a lieu via vSAN.  Ainsi, pour fonctionner en mode d'appareil virtuel, au moins un proxy de sauvegarde doit être déployé dans chaque cluster vSAN.  Développez une paire de proxys de sauvegarde (par exemple, dans un cluster de gestion) et la sauvegarde de tous les clusters vSAN avec eux échouera. <br><table><tbody><tr><td align="center">  <strong>Avantages</strong> </td><td align="center">  <strong>Inconvénients</strong> </td></tr><tr><td>  Rapide, en règle générale, est beaucoup plus rapide que NBD, en particulier dans le cas d'une sauvegarde complète ou de grands incréments.  Seul l'accès direct au stockage peut être inférieur en vitesse. </td><td>  L'opération de montage de disques (HotAdd) sur un proxy peut prendre jusqu'à 2 minutes par disque.  Avec des sauvegardes incrémentielles de petits morceaux de données, NBD peut être plus rapide. </td></tr><tr><td>  Élimine le réseau de stockage.  Ne charge pas l'interface de gestion et l'hyperviseur. </td><td>  La machine virtuelle proxy consomme une partie des ressources de l'hôte.  Parfois, il peut y avoir des problèmes avec la suppression des instantanés. </td></tr></tbody></table><h3>  Mode réseau (NBD) </h3><br>  Il s'agit du mode le plus simple et le plus universel, adapté aux proxys de sauvegarde physiques et virtuels.  Contrairement aux deux modes précédents, l'extraction de données ne se produit pas sur le réseau de stockage.  Un proxy de sauvegarde prend les données VM en se connectant à l'interface de gestion des hôtes ESXi sur lesquels ils s'exécutent. <br><br>  Cette approche présente les inconvénients suivants: <br><br><ul><li>  Souvent, les interfaces de gestion ESXi ne tiennent pas sur les liaisons montantes les plus rapides, en règle générale, il s'agit de 1 GbE </li><li>  Même si l'interface de gestion aura des ports 10 GbE, ESXi n'abandonnera pas l'intégralité du proxy de bande proxy - il le limite artificiellement et n'alloue qu'une partie de la bande passante de l'interface pour les sauvegardes </li></ul><table><tbody><tr><td align="center">  <strong>Avantages</strong> </td><td align="center">  <strong>Inconvénients</strong> </td></tr><tr><td>  Simple et polyvalent.  Les proxys peuvent être physiques et virtuels. </td><td>  En règle générale, il est beaucoup plus lent que HotAdd, en particulier sur les gros volumes de sauvegarde et un petit nombre de tâches parallèles. </td></tr><tr><td>  Démarrage rapide, aucun retard sur le montage des variateurs.  Aucun problème avec les instantanés. </td><td>  Crée une charge (petite) sur l'interface de gestion et l'hyperviseur. </td></tr></tbody></table>  Dans le même temps, de nombreuses sources affirment que NBD est très lent à 1 GbE, mais à 10 GbE, il peut être assez rapide.  Nous allons certainement vérifier cela. <br><br><h2>  Programme de test </h2><br>  Sur l'infrastructure décrite ci-dessus, il est nécessaire de sauvegarder les VM de test et d'enregistrer les indicateurs suivants: <br><br><ul><li>  Charge CPU,% </li><li>  Consommation de RAM, Go </li><li>  Charge réseau, Gbps </li><li>  Performances de sauvegarde, Mo / s </li><li>  Temps de sauvegarde, mm: ss </li></ul><br>  Les indicateurs doivent être fixes pour la sauvegarde d'une machine virtuelle de test et pour la sauvegarde parallèle de deux, quatre et six machines virtuelles de test. <br><br>  Des indicateurs doivent être enregistrés pour les modes de fonctionnement de l'appliance virtuelle et du proxy de sauvegarde réseau.  Chaque fois qu'une sauvegarde complète doit être effectuée, aucun incrément. <br><br>  Ainsi, il est nécessaire de créer 4 jobs de sauvegarde: <br><br><ul><li>  Pour une VM de test </li><li>  Pour deux machines virtuelles de test </li><li>  Pour quatre machines virtuelles de test </li><li>  Pour six machines virtuelles de test </li></ul><br>  Dans le cadre des tests, il est nécessaire: <br><br><ol><li>  Exécutez séquentiellement toutes les tâches en un seul mode </li><li>  Supprimer les sauvegardes créées afin qu'il n'y ait pas d'incréments </li><li>  Répéter les exécutions dans le deuxième mode, en fixant chaque fois les indicateurs </li></ol><br>  Dans les paramètres de chaque tâche, vous devez sélectionner manuellement un proxy de sauvegarde préparé pour les tests, car ce n'est pas le seul dans l'infrastructure VBR générale, et par défaut, le proxy est automatiquement sélectionné. <br><br>  Le mode proxy de sauvegarde par défaut est également automatiquement sélectionné.  Par conséquent, dans les paramètres du proxy de sauvegarde, avant chaque exécution, définissez manuellement le mode de transport souhaité. <br><br>  L'indicateur le plus intéressant est la vitesse moyenne ou les performances de sauvegarde.  Il peut être vu dans les résultats du travail dans la console VBR.  Il affichera également le runtime de sauvegarde. <br><br>  De plus, vous devez évaluer la charge sur le proxy de sauvegarde dans chacun des tests.  La congestion du processeur, de la mémoire et du réseau peut être surveillée à l'aide des outils du système d'exploitation invité (Windows 2016) et au niveau de VMware. <br><br>  Sur le proxy de sauvegarde et les référentiels de sauvegarde, le paramètre du nombre maximal de tâches simultanées est défini sur 6. Cela signifie que pendant le test, toutes les machines virtuelles de chaque tâche seront traitées en parallèle, aucune d'entre elles n'attendra dans la file d'attente, les performances seront maximales. <br><br>  Veeam® recommande que le nombre de tâches parallèles ne dépasse pas le nombre de cœurs de processeur sur les proxys et les référentiels.  La quantité de RAM recommandée sur le référentiel est de 2 Go par cœur, soit 12 Go au total.  La configuration de l'infrastructure montre que toutes les recommandations sont suivies. <br><br><h2>  Vitesse et charge de sauvegarde en mode Virtual Appliance (ajout à chaud) </h2><br><h3>  Sauvegarde 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  55-95 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2-2,2 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  709 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  70-100 (étagère 100% avec de courtes chutes brusques à 70%) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  5-7,7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  816 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  100 (étagère 100% avec de petites gouttes rares) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  3-3,5 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  885 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  100 (étagère 100% avec de petites gouttes rares) </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  4-4,2 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  888 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Vitesse de sauvegarde et charge en mode réseau (NBD) </h2><br><h3>  Sauvegarde 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  18-24 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  192 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  18h30 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  25-33 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  1,5-2,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  269 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  45-55 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  2,8-3,5 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  2,8-4,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  446 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Sauvegarde 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Charge du proxy de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Charge CPU,% </td><td align="center">  50-70 </td></tr><tr><td>  Consommation de RAM, Go </td><td align="center">  3,5-4 </td></tr><tr><td>  Charge réseau, Gbps </td><td align="center">  3,5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Vitesse de sauvegarde</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicateur</strong> </td><td align="center">  <strong>Valeur</strong> </td></tr><tr><td>  Performances de sauvegarde, Mo / s </td><td align="center">  517 </td></tr><tr><td>  Temps de sauvegarde, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Comparaison des performances et de la charge dans l'appliance virtuelle (HotAdd) et le mode réseau (NBD) </h2><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Vitesse - HotAdd, Mo / s</strong> </td><td align="center">  <strong>Vitesse - NBD, Mo / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3,69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1,98 </td></tr><tr><td align="center">  6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1,72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Charge CPU - HotAdd,%</strong> </td><td align="center">  <strong>Charge CPU - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3.06-3.96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1.82-2.22 </td></tr><tr><td align="center">  6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1,43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Téléchargement de RAM - HotAdd, GB</strong> </td><td align="center">  <strong>Chargement RAM - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  2-2,2 </td><td align="center">  1.9-2.1 </td><td align="center">  1,05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1,04-1,05 </td></tr><tr><td align="center">  4 </td><td align="center">  3-3,5 </td><td align="center">  2,8-3,5 </td><td align="center">  1-1.07 </td></tr><tr><td align="center">  6 </td><td align="center">  4-4,2 </td><td align="center">  3,5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Nombre de VM</strong> </td><td align="center">  <strong>Téléchargement réseau - HotAdd, Gb / s</strong> </td><td align="center">  <strong>Téléchargement réseau - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3.56-3.92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7,7 </td><td align="center">  1,5-2,5 </td><td align="center">  3.08-3.33 </td></tr><tr><td align="center">  4 </td><td align="center">  5-8,2 </td><td align="center">  2,8-4,5 </td><td align="center">  1,79-1,82 </td></tr><tr><td align="center">  6 </td><td align="center">  5-8,2 </td><td align="center">  3,5-5 </td><td align="center">  1,43-1,64 </td></tr></tbody></table><h2>  Résultats des tests </h2><br>  Les indicateurs de performance de sauvegarde obtenus à la suite de tests confirment sans équivoque le fait que le mode d'appareil virtuel est nettement supérieur en vitesse par rapport au mode réseau, en particulier dans un petit nombre de tâches parallèles. <br><br>  Permettez-moi de vous rappeler que les tests pour les deux modes ont été exécutés dans des conditions absolument identiques sur la même plate-forme.  La bande passante du réseau était également la même - les interfaces de contrôle à travers lesquelles le proxy collecte des données en mode NBD donnent 10 Gbit / s, comme le réseau vSAN pour le mode HotAdd, nous n'avons défini aucune limite de bande passante. <br><br>  De toute évidence, ESXi ralentit vraiment Veeam® et ne lui donne qu'une partie de la bande en mode réseau, d'où les différences de vitesse de sauvegarde.  Cependant, avec l'augmentation du nombre de threads - tâches de sauvegarde simultanées - le mode Réseau réduit considérablement le retard. <br><br>  Nous voyons qu'en mode Appliance virtuelle, déjà sur 4 VM, le proxy de sauvegarde repose sur le processeur, il ne peut pas fonctionner plus vite, pour 6 VM la vitesse de sauvegarde n'a pas beaucoup changé.  Dans le même temps, la vitesse de sauvegarde de 1 à 2 machines virtuelles dans ce mode est légèrement en retard, les capacités des proxys et des plates-formes de sauvegarde sont utilisées au maximum, même sur un petit nombre de threads. <br><br>  En mode Réseau, au contraire, il y a une augmentation significative de la productivité avec une augmentation du nombre de tâches simultanées.  Dans le même temps, la charge sur le processeur proxy de sauvegarde est nettement inférieure à celle du mode HotAdd, même sur 6 threads, elle ne dépasse pas 70%. <br><br>  La consommation de mémoire du proxy de sauvegarde est faible et approximativement la même dans les deux modes. <br><br>  La charge sur le réseau proxy de sauvegarde est en corrélation avec la vitesse de sauvegarde, la dépassant de ~ 10-17%.  Apparemment, le proxy prend les données des sources de machines virtuelles un peu plus rapidement qu'il ne les télécharge dans le référentiel, car elles doivent être traitées. <br><br>  Il est intéressant d'observer la ligne Load dans les images avec les résultats de l'exécution du travail.  Il montre le niveau de charge sur divers éléments de l'infrastructure de sauvegarde: source, proxy, réseau, référentiel. <br><br>  En mode d'appliance virtuelle, nous voyons que les performances de sauvegarde reposent sur le proxy et le réseau, elles sont toujours approximativement à la même charge.  La source et le référentiel ne sont pas un goulot d'étranglement. <br><br>  En mode réseau, le goulot d'étranglement est toujours la source, même pour un seul flux.  On peut voir que le reste de l'infrastructure peut donner plus, mais ESXi ne les donne pas. <br><br><h2>  Résumé </h2><br>  Les tests ont confirmé que le proxy de sauvegarde dans les modes de transport étudiés se comporte exactement comme le suggère la théorie. <br><br>  Le logiciel Veeam® s'est avéré très utile: <br><br><ul><li>  En mode HotAdd, toutes les capacités de l'infrastructure ont été utilisées efficacement et complètement. </li><li>  En mode NBD, les performances devraient être plus modestes, mais ce n'est pas un problème Veeam®, mais une fonctionnalité de la pile réseau ESXi </li></ul><br>  Nous avons obtenu des indicateurs de performances et de charge réels, ce qui est très utile pour choisir le mode de fonctionnement optimal et la mise à l'échelle ultérieure du système. <br><br>  Pour le moment, nous sommes très satisfaits des performances de sauvegarde existantes, nous savons comment les augmenter correctement lorsqu'un tel besoin se fait sentir. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431596/">https://habr.com/ru/post/fr431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431582/index.html">Histoire de la protection des données personnelles: comment est né le RGPD?</a></li>
<li><a href="../fr431584/index.html">Espace et test: mélanger, mais ne pas secouer</a></li>
<li><a href="../fr431586/index.html">Comment gérer plus rapidement les erreurs sur la JVM</a></li>
<li><a href="../fr431588/index.html">Loi sur les travailleurs indépendants. Informations à considérer</a></li>
<li><a href="../fr431590/index.html">La modernisation des parcs éoliens britanniques obsolètes augmentera la production d'énergie de 171%</a></li>
<li><a href="../fr431598/index.html">Nous apportons à Internet une machine virtuelle publique QEMU sans carte réseau et essayons d'exploiter</a></li>
<li><a href="../fr431600/index.html">Augmenter IDS / NMS: Mikrotik et Suricata avec une interface Web</a></li>
<li><a href="../fr431602/index.html">Les développeurs russes ont présenté à Londres un système de réadaptation virtuel</a></li>
<li><a href="../fr431604/index.html">Localisation dans Go avec des packages de base</a></li>
<li><a href="../fr431608/index.html">La société américaine DriveSavers est la première au monde à lancer un service de piratage iPhone pour les particuliers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>