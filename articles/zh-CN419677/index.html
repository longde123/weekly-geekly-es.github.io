<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗼 🛢️ 🙇🏻 如何嗅探iOS设备的HTTPS流量 🛏️ 🕷️ 💦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="嗨，我叫Andrey Batutin，我是DataArt的高级iOS开发人员，今天我们将嗅探您iPhone的HTTPS流量。 

 FoodSniffer及其与之一起吃 
 以非常简单的iOS应用程序FoodSniffer为例 。 根据一天中的时间，它向用户显示吃什么。 



 应用程序从服务器接...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何嗅探iOS设备的HTTPS流量</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/419677/"><img src="https://habrastorage.org/webt/a4/n0/ad/a4n0adtaeosbezsajgrfszbxtrw.jpeg"><br><br> 嗨，我叫Andrey Batutin，我是DataArt的高级iOS开发人员，今天我们将嗅探您iPhone的HTTPS流量。 <a name="habracut"></a><br><br><h2>  FoodSniffer及其与之一起吃 </h2><br> 以非常简单的iOS应用程序<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FoodSniffer为例</a> 。 根据一天中的时间，它向用户显示吃什么。 <br><br><img src="https://habrastorage.org/webt/fs/br/u_/fsbru_ly25oqnao_8ifqt42jacy.png"><br><br> 应用程序从服务器接收以下形式的JSON： <br><br><pre><code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"soup"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"consumePeriod"</span></span> : <span class="hljs-string"><span class="hljs-string">"morning"</span></span> }, … ]</code> </pre> <br> 在这种情况下，服务器是Dropbox，可以在<a href="">此处</a>查看JSON。 <br><br><h2> 问题编号1 </h2><br> 出现了一个错误，该应用程序只显示一个，而不是早上允许的食物列表中的两个项目。 <br><br> 检查出问题的一种方法是查看服务器返回给您的JSON。 <br><br><h3> 如何嗅探流量？ </h3><br> 假设您的MacOS计算机和iOS设备在同一本地网络上，如下所示： <br><br><img src="https://habrastorage.org/webt/v5/_l/aw/v5_lawxwesaw6qpr3-snd0c7dfe.png"><br><br> 无论计算机流量如何，流量都从iOS设备通过路由器流向服务器。 <br><br> 要读取iOS设备的流量，我们需要使其通过Mac。 像这样： <br><br><img src="https://habrastorage.org/webt/qq/lz/xf/qqlzxf6q92ygyk73v4bruvsqml0.png"><br><br> 另外，我们将需要一个HTTP / S <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">代理服务器</a> ，通过它可以监视/修改iOS设备的通过流量。 <br><br> 另一个非常重要的任务是能够嗅探<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTTPS</a>流量。 问题在于创建了HTTPS协议，因此，除了客户端和服务器之外，没有人可以读取HTTPS请求中传输的内容。 因此，HTTPS代理还必须随附<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSL证书</a> ，这是使用HTTPS流量所必需的。 <br><br> 换句话说，我们需要在自己的网络上实施“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">中间人</a>攻击”。 <br><br><img src="https://habrastorage.org/webt/_x/bj/sb/_xbjsbi2ehcuk3fwbbeoaw9lsr8.png"><br><br><h3>  Charles Web调试代理应用程序 </h3><br> 如您所见，嗅探HTTPS流量是一个多阶段的任务，因此，为了尽可能简化我的生活，我使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Charles Proxy</a> 。 <br><br> 让我们从缺点开始： <br><br><ul><li> 它是有偿的，但是试用版中的唯一限制是Charles的工作时间不能超过30分钟，然后必须重新启动。 启动仍然有五秒钟的延迟。 这很烦人，但是你可以活下去。 </li><li> 如果您需要真正的黑客工具才能在24/7全天候远程服务器上运行，甚至使用普通的CLI，Charles也不适合您。 </li><li> 如果您使用的是Windows，最好选择<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Fiddler</a> ，它也是免费的。 </li><li> 如果您需要用于大量设备（超过两个或三个）的代理服务器，Charles不适合您。 </li><li> 如果您需要使用纯格式的TCP / IP数据包，请使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wireshark</a> 。 </li></ul><br> 现在的优点： <br><br><ul><li> 用户友好的用户界面。  Charles不需要任何特殊知识来安装，配置或使用。 普通的MacOs窗口应用程序。 </li><li> 适用于iOS的HTTPS-Charles具有一组工具，可使从您的iOS设备进行HTTPS嗅探尽可能简单。 </li><li> 功能-Charles可以嗅探，修改通过它的流量，模拟慢速Internet，收集统计信息，以各种格式导入/导出流量。 </li><li> 适用于Windows和Linux。 </li></ul><br> 对我来说，这是使用iOS设备时功能和易用性比率的最佳解决方案。 <br><br><h3>  Charles和iOS设备设置 </h3><br> 下面将介绍iOS设备与Charles Proxy一起使用的初始设置过程。 <br><br>  1.在计算机上启动Charles： <br><br><img src="https://habrastorage.org/webt/7_/9t/t2/7_9tt282e2ulhrkg6nha0zlidsw.png"><br><br>  2.在您的iOS设备上安装Charles Root证书： <br><br> 从菜单中，选择帮助-&gt; SSL代理-&gt;在移动设备或远程浏览器上安装Charles Root证书。 <br><br><img src="https://habrastorage.org/webt/ee/tl/vl/eetlvlctkstxbxa0uld6b6nbwvk.png"><br><br> 将出现以下窗口： <br><br><img src="https://habrastorage.org/webt/70/o5/0g/70o50ggj92kd8t_fjxo-a--uh3e.png"><br><br>  3.在iOS设备的网络设置中，指定Charles Proxy的IP和端口： <br><br><img src="https://habrastorage.org/webt/0e/q3/oz/0eq3ozbi5czwwi7sgpzu_j8nfg8.png"><br><br> 根据您的网络体系结构，运行Charles的IP地址可能会有所不同。 <br><br>  4.在iOS设备上打开浏览器，然后点击链接<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-http://chls.pro/ssl</a> 。 <br><br><img src="https://habrastorage.org/webt/mc/_6/ol/mc_6ol45uh4yrwixs0b0p0ko9xm.png"><br><br>  5.在设备上安装Charles SSL证书： <br><br><img src="https://habrastorage.org/webt/km/0p/9-/km0p9-zasxuckzmyoqd1hgqtw2y.png"><br><br>  6.我们在设备设置中表明我们完全信任此证书： <br><br><img src="https://habrastorage.org/webt/co/bd/2c/cobd2cqa3rcoacww-3coe2-nohs.png"><br><br> 具有iOS 10或更高版本的设备需要第六阶段。 <br><br> 在第5-6阶段，我们在Charles设备上安装了SSL证书，并表示我们信任它。 也就是说，现在所有使用此证书签名的HTTPS通信都不会被<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ATS</a>阻止。 <br><br><h3> 如何观看iOS设备流量 </h3><br> 打开<b>FoodSniffer</b>应用。 如果正确完成了代理设置，则应该看到如下屏幕： <br><br><img src="https://habrastorage.org/webt/fs/br/u_/fsbru_ly25oqnao_8ifqt42jacy.png"><br><br> 在Charles Proxy中，转到工具-&gt;无缓存。 <br><br> 并完全关闭代理服务器上的缓存。 <br><br><img src="https://habrastorage.org/webt/kp/7k/pf/kp7kpfnjabtpe3rz-c_n-72hmau.png"><br><br> 在更新产品列表之后，该应用程序实现了“推入刷新”功能，您应该在Charles左侧的列表中看到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.dropbox.com</a> 。 右键单击它，然后选择“ <b>启用S​​SL Proxing”</b> 。 <br><br><img src="https://habrastorage.org/webt/o8/wm/0l/o8wm0l9qpirei_uclwreglz4xgq.png"><br><br> 之后，再次更新应用程序中的产品列表。 现在，您应该看到类似以下内容： <br><br><img src="https://habrastorage.org/webt/ep/up/dm/epupdm7buiijg5cxr1iaq8bg-dk.png"><br><br> 现在，我们可以自由读取来自Dropbox上应用程序的JSON的HTTPS流量。 <br><br> 但这还不是全部！ <br><br>  Dropbox不会直接从dropbox.com主机提供JSON。 相反，它返回302响应并重定向到正在从中下载数据的另一个主机。 <br><br> 您可以通过查看以下查询的<b>原始响应</b>来找到它： <br><br><img src="https://habrastorage.org/webt/ku/kl/ut/kuklut0rfyvddx9btfcbxfywkpk.png"><br><br> 在这种情况下，它是- <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">uc9c29db95802af8490afc3afda9.dl.dropboxusercontent.com</a></b> 。 <br><br> 您很可能会拥有稍微不同的主机。 <br><br> 然后<b>启用S​​SL Proxing：已启用</b> 。 <br><br>  <b>我们</b>将再次<b>更新FoodSniffer</b> 。 <br><br> 现在，我们终于可以看到应用程序显示的真实JSON！ <br><br><img src="https://habrastorage.org/webt/yc/sc/3t/ycsc3tuo_h-nx6fnsqwxjrcpmxo.png"><br><br> 我们看到晚上只有一种食物-威士忌，写给我们的团队负责人，然后去喝咖啡，问题不在我们这边。 <br><br>  *该项目使用已经更正的JSON，晚上有两种食物：啤酒和威士忌。 <br>  *如果在窗口左侧的列表中没有看到主机<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://uc9c29db95802af8490afc3afda9.dl.dropboxusercontent.com</a>或类似的主机，请尝试多次更新应用程序中的产品列表。 <br><br><h2> 问题2，或如何更改iOS设备的HTTPS流量 </h2><br> 后端团队修复了晚上的菜单，现在可以正确形成JSON。 但是，如果是早晨，而又不想等到晚上检查修复方法，该怎么办？ <br><br> 一种选择是使用Charles更改Dropbox附带的JSON。 <br><br> 在这种情况下，我们需要从<b>晚上</b>更改到<b>早上的</b> <b>消耗</b> <b>时间</b> 。 <br><br> 为此，请从菜单中选择<b>工具-&gt;重写</b> 。 <br><br> 在出现的“ <b>重写设置”</b>窗口中，添加新的覆盖类别<b>-dropbox</b> 。 <br><br><img src="https://habrastorage.org/webt/5v/gr/bt/5vgrbt2iaqgsh4hd5hlefm1a_qu.png"><br><br> 通过在“ <b>编辑位置”</b>菜单中指定https端口来添加主机： <br><br><img src="https://habrastorage.org/webt/5w/qv/9o/5wqv9oag85_grxuguzbyxfjcses.png"><br><br> 之后，我们在“ <b>重写规则”</b>菜单中添加重写规则，如下所示： <br><br><img src="https://habrastorage.org/webt/wu/ta/_q/wuta_qy4lleaclipyxemcj-p39o.png"><br><br> 也就是说，现在在我们服务器的响应的每个正文中，“ <b>晚</b> ”一词将被替换为“ <b>早</b> ”一词。 <br><br> 如有必要，我们可以更改HTTP请求/响应的任何部分，并使用正则表达式替换文本。 <br><br> 现在，在更新列表之后，我们应该看到四种类型的产品： <br><br><img src="https://habrastorage.org/webt/cv/ir/cb/cvircb-tlzrqrodkk3lywwleizc.png"><br><br><h2> 结论 </h2><br>  Charles非常简单，是共享软件，具有丰富的HTTPS代理功能。 从我的角度来看，在MacOS和iOS设备上使用时效果最佳。 <br><br> 这绝不是嗅探流量的唯一方法。 对于HTTP / S流量， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Fiddler</a>也被广泛使用。 如果您需要更深入地研究TCP / IP堆栈，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wireshark</a> 。 <br><br> 此外，还有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">证书固定</a>问题。 如果在您的应用程序中实现，则需要将Charles SSL证书添加到允许的证书列表中，或者使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Frida之类的</a>工具在应用程序级别上禁用证书固定。 我希望在下一篇文章中讨论更多。 <br><br> 如果您分享您在监控流量方面的经验，包括HTTP / S，技巧和Lifehacks，我将非常高兴。 <br><br>  <u>注意事项</u> 请仅将此技术用于您的应用程序。 成为白色兔子黑客！ <br><br>  <u>注意2。</u>最近，有关此故事的报道以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">乌克兰语</a>发布，但我以俄语发布了这是第一次。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419677/">https://habr.com/ru/post/zh-CN419677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419667/index.html">有关Azure的一些有用的资料。 第1部分-书籍</a></li>
<li><a href="../zh-CN419669/index.html">十款适合任何钱包的最佳游戏鼠标</a></li>
<li><a href="../zh-CN419671/index.html">需要违反的限制或我们如何加速功能测试三遍</a></li>
<li><a href="../zh-CN419673/index.html">早期宇宙6.均匀膨胀宇宙的动力学，第2部分</a></li>
<li><a href="../zh-CN419675/index.html">2018年夏季莫斯科电动滑板车每分钟租金的评论</a></li>
<li><a href="../zh-CN419679/index.html">从头开始实现Spring Framework API。 初学者入门。 第一部分</a></li>
<li><a href="../zh-CN419683/index.html">指标对敏捷团队意味着什么？</a></li>
<li><a href="../zh-CN419685/index.html">关于编程面试应了解的最重要的数据结构</a></li>
<li><a href="../zh-CN419687/index.html">Secret Keyboard Level 3或如何打印长破折号</a></li>
<li><a href="../zh-CN419689/index.html">一，适应能力差。 二。 多动症或懒惰的白痴？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>