<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ฝโ๐ณ ๐บ๏ธ ๐ ุงูุญูู ูุฑุจุท ูุชูุฒูู ูููุงุช Mach-O ๐ ๐ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃูุฏู ููู ุชุฑุฌูุฉ ููุงูุชู ูู ูุฏููุฉ ูุดุฑูุน ุฏุงุฑูููุฌ. ุงููููู ูู ุงููุณุงุนุฏุฉ ุญูู ุงูููุงููู ุงููุณุชุฎุฏูุฉ: ุฏุงุฑููู - ูุธุงู ุชุดุบูู ููุชูุญ ุงููุตุฏุฑ ูููู ุนูู macOS ู iOS ูุฃูุธูุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุญูู ูุฑุจุท ูุชูุฒูู ูููุงุช Mach-O</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417507/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <em>ุฃูุฏู ููู ุชุฑุฌูุฉ ููุงูุชู ูู ูุฏููุฉ ูุดุฑูุน ุฏุงุฑูููุฌ.</em>  <em>ุงููููู ูู ุงููุณุงุนุฏุฉ ุญูู ุงูููุงููู ุงููุณุชุฎุฏูุฉ: ุฏุงุฑููู - ูุธุงู ุชุดุบูู ููุชูุญ ุงููุตุฏุฑ ูููู ุนูู macOS ู iOS ูุฃูุธูุฉ ุชุดุบูู ุฃุฎุฑู ูู Apple ุ</em>  <em>Mach-O ูู ุชูุณูู ุซูุงุฆู ูููููุงุช ูุงูููุชุจุงุช ุงููุงุจูุฉ ููุชูููุฐ ุงููุณุชุฎุฏูุฉ ูู ุฏุงุฑููู ุ</em>  <em>dyld - ุฃุฏุงุฉ ุชุญููู ุฏููุงููููุฉ ุชุณุชุฎุฏููุง ุฏุงุฑููู ูุชูุฒูู ูููุงุช Mach-O ุ</em>  <em>dylib ูู ููุชุจุฉ ูุงุจูุฉ ููุชุญููู ุฏููุงูููููุง (ุนุงุฏุฉู ูุง ูููู ููุง ุงูุงูุชุฏุงุฏ <code>.dylib</code> ).</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q4/to/tb/q4totbx7ltcbh_gj58-qnayiffg.png" alt="ุตูุฑุฉ ูุฌุฐุจ ุงูุงูุชุจุงู"></p><br><p style=";text-align:right;direction:rtl">  ุงููุฏู ูู ูุดุฑูุน Darling ูู ุชูููู ุชุทุจููุงุช macOS ูู ุงูุนูู ุนูู Linux ุ ูุงููุฏุฑุฉ ุนูู ุชูุฒูู ุงููููุงุช ุงูุซูุงุฆูุฉ ุจุชูุณูู Mach-O ูู ุฅุญุฏู ุงูุฎุทูุงุช ุงูุฑุฆูุณูุฉ ูุญู ูุฐุง ุงููุฏู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ุชู ุจูุงุก ุฏุงุฑูููุฌ ุญูู ุชูููุฐ ูุญูู Mach-O ูููุฑุฉ ุจุซ ุงูููุงููุงุช ุจูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฏุงุฑููู ุนุงููุฉ ุงููุณุชูู ููุธุฑุงุฆูุง ูู ููููุณ.  ููุฐ ุฐูู ุงูุญูู ุ ุชุญูู ุชุฑููุฒูุง ุฅูู ุชุดุบูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุญุงููุฉ ุฏุงุฑููู ุงููุนุฒููุฉ ุจุดูู ูุชุฒุงูุฏ.  ูุธุฑูุง ูุฃููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญูููุง ุฅูู ุงุณุชุฎุฏุงู Mach-O ููููููุงุช ุงูุฏุงุฎููุฉ ูู Darling</a> ุ ููุฏ ุชูููุง ูู ุงุณุชุฎุฏุงู dyld ุงูุฃุตูู ูู Apple ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅูุดุงุก ุงูุนุฏูุฏ ูู ููููุงุช Darwin ููุชูุญุฉ ุงููุตุฏุฑ ุงูุฃุฎุฑู.  ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ูุญูู ุฅููุงุน ุจุณูุท ูู ููุน Mach-O ููุชูููุฏ ููุณู. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ุชููู Mach-O ุ ุฅูู ุฌุงูุจ Mach ููุณูุง ุ ูู ุฃุจุฑุฒ ุงูุนูุงูุงุช ุงููููุฒุฉ ูุฏุงุฑููู ุ ูุชุณุชุฎุฏู ุงูููุชุจุงุช ูุงูุฃุทุฑ ุงููุฎุชููุฉ ุงูุชู ุชููุฑูุง Apple ุนูู ูุทุงู ูุงุณุน ุงูุนุฏูุฏ ูู ุงูููุฒุงุช ุงูุบุงูุถุฉ ูุชูุณูู Mach-O.  ูุฐุง ูุฌุนู ุงูุนูู ูุน Mach-O ุฃุญุฏ ุฃูู ุงูููุงู ูุฃุจุฑุฒูุง ูู ุชุทููุฑ Darling.  ูู ุชูููุฐ ููุงุฏุฑ Mach-O ุงูุฃุตููุฉ ุฅูู ุชุฌููุน ููููุงุช ุฏุงุฑููู (ุฃููุงู ูู ุดูู ูููุงุช ELF ุฎุงุตุฉ ุ ูุงูุขู ูู ุดูู Mach-O ุญูููู) - ูุญุชุงุฌ ุฅูู ููู ุงูุจููุฉ ุงูุฏุงุฎููุฉ ูู Mach-O ุนูู ูุณุชูู ุฃุนูู ุจูุซูุฑ ููุง ูู ูุทููุจ ุนุงุฏุฉู ูู ุงูุนุงุฏู ูุทูุฑู ูููุตุฉ ุฏุงุฑููู. </p><br><p style=";text-align:right;direction:rtl">  ููุชูู ูู ูุฐู ุงูููุฏูุฉ ูููุชูู ุฅูู ููุงูุดุฉ ุจุนุถ ุงูุญูู ุงูุชู ูููู ุฃู ููุฏููุง ููุง ุชูุณูู Mach-O. </p><br><h2 id="ustanovochnye-imena" style=";text-align:right;direction:rtl">  ุฃุณูุงุก ุงูุชุซุจูุช </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุธุงูู ุงูุชุดุบูู Windows ู Linux ุ ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุงูููุชุจุงุช ุงูุฏููุงููููุฉ ุจุงุณููุง (ุนูู ุณุจูู ุงููุซุงู ุ <code>libc.so</code> ) ุ ูุจุนุฏ ุฐูู ุชููู ูููุฉ ุงูุฑุงุจุท ุงูุฏููุงูููู ูู ุงูุนุซูุฑ ุนูู ููุชุจุฉ ุจุงุณู ูุทุงุจู ูู ุฃุญุฏ ุฃุฏูุฉ ุงูููุชุจุฉ ุงูููุงุณูุฉ.  ูุณุชุฎุฏู ุฏุงุฑููู ุนูู ุงูููุฑ ุงููุณุงุฑ ุงููุงูู (ุชูุฑูุจูุง) ูููู ุงูููุชุจุฉ ุจุฏูุงู ูู ุฐูู ุ ูุงูุฐู ูุณูู ุงุณู ุงูุชุซุจูุช ููุฐู ุงูููุชุจุฉ.  ูู ุงูููุชุฑุถ ุฃู ูุฐุง ุชู ูููุน <em>ุงุณุชุจุฏุงู dylib</em> [dylib hijacking] - ูุฌูู ูุชู ููู ูุถุน dylib ูุฒูู ูู ุฏููู ุญูุซ ูุชู ุงูุนุซูุฑ ุนููู ุจูุงุณุทุฉ ุฑุงุจุท ุฏููุงูููู ูู ููุช ุณุงุจู ุนู ุงูุฑุงุจุท ุงูุญูููู ุ ูุงูุฐู ูุณูุญ ูู dylib ุงููุฒูู ุจุชูููุฐ ุฑูุฒ ุชุนุณูู ููุงุจุฉ ุนู ุงูุจุฑูุงูุฌ ุ ููุง ุฃููุน ุจุฐูู ุชุญููู ุฏูููุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชููู ุงููููุงุช ุงูุชูููุฐูุฉ ูุงูููุชุจุงุช ููุท ุจุชุฎุฒูู ุฃุณูุงุก ุงูุชุซุจูุช ุงููุงููุฉ ุงูุฎุงุตุฉ ุจุชุจุนูุงุชูุง ุ ูููู ุชุจุนูุงุช Mach-O ููุณูุง "ุชุนุฑู" ุฃุณูุงุก ุงูุชุซุจูุช ุงูุฎุงุตุฉ ุจูุง.  ูู ุงููุงูุน ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชุนุฑู ุจูุง ุงูุฑุงุจุท ุนูู ุฃุณูุงุก ุงูุชุซุจูุช ุงูุชู ูุฌุจ ุงุณุชุฎุฏุงููุง ูู ุงูุชุจุนูุงุช: ููู ููุฑุฃูุง ูู ุงูุชุจุนูุงุช ููุณูุง. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุฑุจุท dylib ุ ูุฅูู ุชุญุฏุฏ ุงุณู ุงูุชุซุจูุช ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑุงุช ld <code>-dylib_install_name</code> ุฃู <code>-dylib_install_name</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o -install_name /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/libfoo.dylib</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุนูุฏ ุฑุจุท ููู Mach-O ุขุฎุฑ (ูู <code>libbar.dylib</code> ) <code>libfoo.dylib</code> ุ ุณูู ููุชุจ ld ุงุณู ุชุซุจูุช libfoo - <code>/usr/local/lib/libfoo.dylib</code> - ูู <code>libbar</code> ุชุจุนูุงุช <code>libbar</code> ุ ูููุง ูููู dyld ุณูุจุญุซ ุนู <code>libfoo</code> ูู ููุช ุงูุชุดุบูู. </p><br><p style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ุงููุณุงุฑ ุงููุงูู ูุนูู ุจุดูู ุฌูุฏ ุจูุง ููู ุงูููุงูุฉ ูููุชุจุงุช ุงููุธุงู ุ ูุงูุชู ุ ูู ุงููุงูุน ุ ูุซุจุชุฉ ูู ุฃูุงูู ูุนุฑููุฉ ุณุงุจููุง ูู ูุธุงู ุงููููุงุช ุ  ูููู ูุน ุงูููุชุจุงุช ุงูุชู ุชุฃุชู ูุฌุฒุก ูู ุญุฒู ุงูุชุทุจูู ุ ููุงู ูุดููุฉ.  ุนูู ุงูุฑุบู ูู ุฃู ูู ุชุทุจูู ูููู ุฃู ููุชุฑุถ ุฃูู ุณูุชู ุชุซุจูุชู ูู <code>/Applications/AppName.app</code> ุ ุจุดูู ุนุงู ุ ููุฐุง ูุนูู ุฃู ุชุฌููุนุงุช ุงูุชุทุจููุงุช ูุญูููุฉ ููููู ููููุง ุจุญุฑูุฉ ุญูู ูุธุงู ุงููููุงุช ุ ูุฐูู ูุง ูููู ููุณุงุฑ ุงูููุชุจุฉ ุงููุญุฏุฏ ุฏุงุฎู ูุฐู ุงูุชุฌููุนุงุช ุชููู ูุนุฑููุฉ ููุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุญู ููุฐู ุงููุดููุฉ ุ ูุณูุญ ุฏุงุฑููู ูุฃุณูุงุก ุงูุชุซุจูุช ุฃู ุชุจุฏุฃ ุจู <code>@executable_path</code> ุฃู <code>@rpath</code> ุฃู <code>@rpath</code> - ููุฐุง ููุณ ูุทูููุง ุ ูููู ูุดูุฑ ุฅูู ูุณุงุฑ ุงูููุชุจุฉ ูุณุจุฉ ุฅูู ุงููุณุงุฑ ุฅูู ุงูููู ุงููุงุจู ููุชูููุฐ ุงูุฑุฆูุณู ุ ุงููุณุงุฑ ุฅูู "ุชุญููู" (ููู ุฃู ููุชุจุฉ ูุงุจูุฉ ููุชูููุฐ ุ ูุงูุชู ุชุนุชูุฏ ุจุดูู ูุจุงุดุฑ ุนูู ูุฐู ุงูููุชุจุฉ) ุฃู ูุณุจุฉ ุฅูู ูุงุฆูุฉ ุงููุณุงุฑุงุช ุงููุญุฏุฏุฉ ุจูุงุณุทุฉ ุงูููู ุงูุชูููุฐู ุงูุฑุฆูุณู ุ ุนูู ุงูุชูุงูู.  <code>@executable_path</code> ู <code>@loader_path</code> ุจุฏูู ุชุนููุฏ ุฅุถุงูู ุ ูููู ุฅุฐุง ูุงู ุนูู ุงูุฃูู ุฃุญุฏ <code>@executable_path</code> ุฃู <code>@loader_path</code> ุงูุนุงุจุฑุฉ) ูุญุชูู ุนูู ุงุณู ุฅุนุฏุงุฏ ุจุงุณุชุฎุฏุงู <code>@rpath</code> ุ ูุฌุจ ุนููู ุชุนููู <code>@rpath</code> ุจุดูู ุตุฑูุญ ุนูุฏ ุฑุจุท ูููู ุงููุงุจู ููุชูููุฐ ุจุงุณุชุฎุฏุงู ุฎูุงุฑ ld <code>-rpath</code> ุจููุณ ุงููุฏุฑ ูุฑุงุช ูู ุชุญุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o runme -rpath @executable_path/../Frameworks -rpath @executable_path/../bin/lib</code> </pre> <br><p style=";text-align:right;direction:rtl">  (ููููู rpath ูุฏูุฑ ุฅูู ุญุฏ ูุง ุงูููุฑุฉ ุงูุฃุตููุฉ ููุณุงุฑุงุช ุงูููุชุจุฉ ุงููุนุฑููุฉ ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุชุญ</a> ุฅููุงููุฉ ูุฌูุงุช ุงูุชุญุงู dylib. ูููููุง ุฃู ููุชุฑุถ ุฃู ูุฐุง ูุฌุนู ูู ุดูุก ูุชุนูู ุจุฃุณูุงุก ุงูุชุซุจูุช ุนุฏูู ุงููุงุฆุฏุฉ ุฅูู ุญุฏ ูุง.) </p><br><h2 id="ciklicheskie-zavisimosti" style=";text-align:right;direction:rtl">  ุชุจุนูุงุช ุฏูุฑูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุดุบู ุงูููุฏ ุงููุตุฏุฑู ูููุดุฑูุน ุนุฏุฉ ูููุงุช ุ ููู ุงูุทุจูุนู ุชูุงููุง ุฅุฐุง ูุงูุช ูุฐู ุงููููุงุช ุชุนุชูุฏ ุนูู ุจุนุถูุง ุงูุจุนุถ.  ูุนูู ูุฐุง ุจุดูู ุฌูุฏ ุทุงููุง ูุชู ุชุฌููุน ูู ูุฐู ุงููููุงุช ูู ุซูุงุฆู ูุงุญุฏ - ููู ูุงุจู ููุชูููุฐ ุฃู ููุชุจุฉ.  ูุง ูุง ูุนูู ุนูุฏูุง ุชุนุชูุฏ ุนุฏุฉ ููุชุจุงุช ุฏููุงููููุฉ ุนูู ุจุนุถูุง ุงูุจุนุถ. </p><br><p style=";text-align:right;direction:rtl">  ูุฏ ุชุฌุงุฏู ุจุฃูู ุจุฏูุงู ูู ุงุณุชุฎุฏุงู ุงูุชุจุนูุงุช ุงูุฏูุฑูุฉ ุจูู ุงูููุชุจุงุช ุงูุฏููุงููููุฉ ุ ูุฌุฏุฑ ุฅุนุงุฏุฉ ุชุตููู ุจููุฉ ุงููุดุฑูุน ุ ูุฃูุง ุฃุชูู ูุนู.  ูููู ุฅุฐุง ูุงู ููุงู ุดูุก ูููุฐุฌู ูู Apple ุ ููู ุฃููู ูุง ูุชููููู ุฃุจุฏูุง ุนู ุงูุชูููุฑ ูู ุงูุฃุดูุงุก ูุงูููุงู ุจุฐูู ุจุดูู ุตุญูุญ ุ  ุจุฏูุงู ูู ุฐูู ุ ูุถุนูู ุงูุนูุงุฒุงุช ูุงูุญูู ููู ุจุนุถูู ุงูุจุนุถ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุจุงููุณุจุฉ ูู Darling ุ ูุญุชุงุฌ ุฅูู ุฌุนู ุงูุชุจุนูุงุช ุงูุฏุงุฆุฑูุฉ ุชุนูู ุ ูุฃู <code>libSystem</code> libSystem <code>libSystem</code> ุงููุฎุชููุฉ ุ ูุซู <code>libsystem_dyld</code> ู <code>libsystem_kernel</code> ู <code>libsystem_pthread</code> ุ ุชุนุชูุฏ ุฌููุนูุง ุนูู ุจุนุถูุง ุงูุจุนุถ.  (ุญุชู ููุช ูุฑูุจ ุ ูุงู ุนูููุง ุฃูุถูุง ุฃู ูุฑุจุท ุฃุทุฑ ุนูู Cocoa ุจุดูู ุฏูุฑู ูุซู AppKit ู Core Graphics ู Core OpenGL ุ ูุธุฑูุง ููุทุฑููุฉ ุงูุชู ุชู ุจูุง ุชูููุฐ Core OpenGL ูู The Cocotron ุ ููููุง ุฃุนุฏูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุตููู</a> ุจููุฉ ุชูููุฐ Core OpenGL ูุชููููุง ูู ุงูุชุฎูุต ูู ูุฐุง ุงูุฏูุฑู ุงูุชุจุนูุงุช.) </p><br><p style=";text-align:right;direction:rtl">  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุฌุจ ุฃู ุชุนูู ุงูุชุจุนูุงุช ุงูุฏุงุฆุฑูุฉ ุจุดูู ุฌูุฏ: ูุนุฑู ุงูุฑุงุจุท ุงูุฏููุงูููู ุจุงููุนู ููููุฉ ุชุญููู ูู ููุชุจุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ูุฐูู ูู ููุงุฌู ูุดุงูู ูู ุงูุนูุฏูุฉ ุงููุงููุงุฆูุฉ.  ุชููู ุงููุดููุฉ ูู ุฃูู ูุง ูููู <em>ุฑุจุท</em> ูุฐู ุงูููุชุจุงุช ุจุจุณุงุทุฉ ุ ุญูุซ ุฃู ูู ููุงููุฉ ุฑุงุจุท ุชูุดุฆ ููุชุจุฉ ูุงุญุฏุฉ ููุท ุ ูุนูุฏ ุฑุจุท ุฃู ุซูุงุฆูุงุช ุ ูุฌุจ ููู ุฌููุน ุชุจุนูุงุชูุง ุงููุฑุชุจุทุฉ ุจุงููุนู ุฅูู ุงูุฑุงุจุท.  ูุฌุจ ุนูููุง ุฑุจุท ุฅุญุฏู ููุชุจุงุชูุง ุฃููุงู ุ ููู ุงูููุช ุงูุญุงูู ููุณุช ุงูุฃุฎุฑู ุฌุงูุฒุฉ ุจุนุฏ ุ ูุฐูู ูู ูุชููู ูู ููููุง ุฅูู ุงูุฑุงุจุท. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญููุฉ ููุง ูู ุฑุจุท ุจุนุถ (ุฃู ุจุจุณุงุทุฉ) ุฌููุน ูุฐู ุงูููุชุจุงุช <em>ูุฑุชูู</em> .  ูุฃูู ูุฑุฉ ุ ุงุทูุจ ูู ุงูุฑุงุจุท ุชุฌุงูู ุงูุชุจุนูุงุช ุงูููููุฏุฉ ุ ูุญูุงู ูุง ุชูุฑ ุงูุชุจุนูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o -flat_namespace -undefined suppress $ ld -o libbar.dylib bar.o -flat_namespace -undefined suppress</code> </pre> <br><p style=";text-align:right;direction:rtl">  (ุงูุธุฑ ุฃุฏูุงู ููุญุตูู ุนูู <code>-flat_namespace</code> .) </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ุฅุฐุง ุญุงููุช ุงุณุชุฎุฏุงู dylibs ุงููุงุชุฌุฉ ูุจุงุดุฑุฉ ุ ูุณุชุญุตู ุนูู ุฃุฎุทุงุก ุงูุงุฑุชุจุงุท ุงูุฏููุงูููู ูู ููุช ุงูุชุดุบูู.  ุจุฏูุงู ูู ุฐูู ุ ูู ุจุฑุจุท ูุฐู ุงูููุชุจุงุช ูุฑุฉ ุซุงููุฉ ุ ุจุชูุฑูุฑ dylibs ุงููุงุชุฌุฉ ุนูู ุฃููุง ุชุจุนูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o libbar.dylib $ ld -o libbar.dylib bar.o libfoo.dylib</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุฉ ุ ูุฑู ุงูุฑุงุจุท ุฌููุน ุงูุฃุญุฑู ุ ูุฐูู ูุง ูุทูุจ ููู ุชุฌุงูู ุงูุฃุฎุทุงุก (ูุฅุฐุง ูุงูุช ุจุนุถ ุงูุฃุญุฑู ููููุฏุฉ ุญููุง ุ ูุณุชุญุตู ุนูู ุฎุทุฃ). </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุจุนุถ ุงูููุชุจุงุช ุ ุฅู ูู ููู ูููุง ุ ุงููุฑุชุจุทุฉ ุจุงููุณุฎ "ุงูุฎุงุทุฆุฉ" ูู ุชุจุนูุงุชูุง ุ ูุฅู dyld ุณูุฑู ุงูุฅุตุฏุงุฑุงุช ุงูุตุญูุญุฉ ูู ููุช ุงูุชุดุบูู.  ููู ูุนูู ูุฐุง ุ ุชุฃูุฏ ูู ุฃู ููุชุง ูุณุฎุชูู ูู ูู ููุชุจุฉ ููุง ููุณ ุงุณู ุงูุชุซุจูุช. </p><br><p style=";text-align:right;direction:rtl">  ุชูุงุตูู ุฃุฎุฑู ููุง ูู ุชุฑุชูุจ ุงูุชููุฆุฉ.  ูููู ูุฃู ุฑูุฒ ุฃู ูุตุฑุญ ุจูุธุงุฆู <code>__attribute__((constructor))</code> ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>__attribute__((constructor))</code> ุงูุณุญุฑู <code>__attribute__((constructor))</code> ุชูุน ูุงุฆูุฉ <code>__mod_init_func</code> ูู ูุณู <code>__mod_init_func</code> ูู ููู Mach-O).  ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงููุธุงุฆู ุจูุงุณุทุฉ dyld ุนูุฏ ุชุญููู ุงูุซูุงุฆู ุงูุฐู ุชูุฌุฏ ููู ูุจู ุงุณุชุฏุนุงุก <code>main()</code> .  ุนุงุฏุฉู ุ ูุชู ุชูููุฐ ููููุฆ ูู ููุชุจุฉ ุจุนุฏ ููููุฆู ุชุจุนูุงุชูุง ุ ูุฐูู ูููู ููู ููููุฆ ุฃู ูุชููุน ุฃู ููุชุจุงุช ุงูุชุจุนูุฉ ูุฏ ุชูุช ุชููุฆุชูุง ุจุงููุนู ูุฌุงูุฒุฉ ููุนูู.  ุจุงูุทุจุน ุ ูุง ูููู ุถูุงู ุฐูู ุจุงููุณุจุฉ ููุชุจุนูุงุช ุงูุฏูุฑูุฉ ุ  ุณุชููู dyld ุจุชูููุฐ ุนูููุงุช ุงูุชููุฆุฉ ุงูุฎุงุตุฉ ุจูุง ูู <em>ุจุนุถ</em> ุงูุชุฑุชูุจ.  ููููู ุชูููุฒ ุงูุชุจุนูุงุช ุนูู ุฃููุง ุชุจุนูุงุช ุชุตุงุนุฏูุฉ ูุชุฎุตูุต ูุฐุง ุงูุทูุจ ุ  ุณูููู dyld ุจุชููุฆุฉ ุงูููุชุจุงุช ุงูุชู ูุงู ุดุฎุต ูุง ุจุชูููุฒูุง ูุงุนุชูุงุฏ ุนูููุง ุ ุฃุฎูุฑูุง.  ูุฐุง ุ ูุชููุฆุฉ <code>libbar</code> ุจุนุฏ <code>libbar</code> ุ ูู <code>libbar</code> ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o libbar.dylib $ ld -o libbar.dylib bar.o -upward_library libfoo.dylib</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุนููุง ุฃูุซุฑ ููุงุกูุฉ ุ ูุฏููุง ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>add_circular</code></a> CMake ุชุณูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>add_circular</code></a> ุ ูุงูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>add_circular</code></a> ุฌููุน ุงูุตุนูุจุงุช ูุชุณูุญ ูู ุจุงุณุชุฎุฏุงููุง ุจูุฐู ุงูุทุฑููุฉ ุจุจุณุงุทุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>add_circular</code></a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(DYLIB_INSTALL_NAME <span class="hljs-string"><span class="hljs-string">"/usr/lib/system/libdispatch.dylib"</span></span>) add_circular(libdispatch_shared FAT SOURCES <span class="hljs-variable"><span class="hljs-variable">${dispatch_SRCS}</span></span> SIBLINGS system_c system_kernel system_malloc system_blocks system_pthread system_dyld system_duct unwind platform compiler_rt UPWARD objc )</code> </pre> <br><h2 id="dvuhurovnevoe-prostranstvo-imyon-simvolov" style=";text-align:right;direction:rtl">  ูุณุงุญุฉ ุงุณู ุดุฎุตูุฉ ูู ูุณุชูููู </h2><br><p style=";text-align:right;direction:rtl">  ูุง ุชููู ุฌุฏุงูู ุงูุฑููุฒ ูู Mach-O ุจุชุฎุฒูู ุฃุณูุงุก ุงูุฑููุฒ ูุญุณุจ ุ ุจู "ุชุชุฐูุฑ" ุฃูุถูุง ุฃู ููุชุจุฉ (ุฃู ููู ุชูููุฐู) ูุชู ุฃุฎุฐ ุงูุฑูุฒ ููู.  ุจูุนูู ุขุฎุฑ ุ ุชูุฌุฏ ุฃุณูุงุก ุงูุฑููุฒ ูู ูุณุงุญุงุช ุงูุฃุณูุงุก ุงููุนุฑูุฉ ุงูุชู ูุญุฏุฏูุง ุงูุซูุงุฆู ุ  ููู ููุง ูุฅู "ูุณุงุญุฉ ุงูุงุณู ุฐุงุช ุงููุณุชูููู" (ูุณุชูู ุขุฎุฑ ูุนูู ุฃุณูุงุก ุงูุฑููุฒ ููุณูุง). </p><br><p style=";text-align:right;direction:rtl">  ุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุฏุฎุงู</a> ูุณุงุญุฉ ุงุณู ุฐุงุช ูุณุชูููู ูููุน ุชุนุงุฑุถุงุช ุฃุณูุงุก ุงูุฑููุฒ.  ุนุงุฏุฉ ุ ุฅุฐุง ุญุฏุฏุช ุงูุนุฏูุฏ ูู ุงูููุชุจุงุช ุฃุญุฑููุง ุชุญูู ููุณ ุงูุงุณู ุ ูุณูู ุชุญุตู ุนูู ุฎุทุฃ ุฃุซูุงุก ุงูุฑุจุท ุ  ูููู ูุฐุง ูุฏ ูุง ูุนูู ุฅุฐุง ููุช ุจุชุญููู ุงูููุชุจุงุช ูู ููุช ุงูุชุดุบูู (ุนูู ุณุจูู ุงููุซุงู ุ ุงูุฅุถุงูุงุช) ุฃู ุนูุฏูุง ุชุฎุชูู ุฅุตุฏุงุฑุงุช ุงูููุชุจุงุช ูู ููุช ุงูุงุฑุชุจุงุท ูููุช ุงูุชุดุบูู.  ุจุงููุณุจุฉ ููููุชุจุงุช ุงูุชู ุชุณุชุฎุฏู ูุณุงุญุฉ ุงุณู ุฐุงุช ูุณุชูููู ุ ูุฐู ููุณุช ูุดููุฉ - ููู ุชุณูุญ ููููุชุจุงุช ุงููุชุนุฏุฏุฉ ุจุชุนุฑูู ุงูุฃุญุฑู ุงูุชู ุชุญูู ููุณ ุงูุงุณู ุฏูู ุฅูุดุงุก ุชุนุงุฑุถุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฅููุงู ูุณุงุญุฉ ุงูุงุณู ุฐุงุช ุงููุณุชูููู ุนู ุทุฑูู ุงูุนูุฏุฉ ุฅูู ุงุณุชุฎุฏุงู "ูุณุงุญุฉ ุงุณู ูุณุทุญุฉ" (ุฃุญุฏ ุฃุณุจุงุจ ุฐูู ูู ุฃู ุงุณุชุฎุฏุงู ูุณุงุญุฉ ุงุณู ุฐุงุช ูุณุชูููู ูุนูู ุฃูู ูุฌุจ ุงูุณูุงุญ ููู ุญุฑู ุฃุซูุงุก ุงูุฑุจุท ุ ูุฐุง ููุฒู ูุณุงุญุฉ ุงุณู ูุณุทุญุฉ ูู ุฃุฌู <code>-undefined_suppress</code> ุ ููุง ุฑุฃููุง ุฃุนูุงู).  ูุญุชูู Ld ุนูู <code>-flat_namespace</code> ุชุนุทูู ูุณุงุญุฉ ุงูุงุณู ุฐุงุช ุงููุณุชูููู ุฃุซูุงุก ุงูุฑุจุท: <code>-flat_namespace</code> ุ ุงูุฐู ูุคุซุฑ ุนูู ููู Mach-O ูุงุญุฏ ููุท ุ <code>-force_flat_namespace</code> ุ ุงูุฐู ูุนูู ููุท ูุน ุงููููุงุช ุงููุงุจูุฉ ููุชูููุฐ ุ ูููุณ ุงูููุชุจุงุช ุ <code>-force_flat_namespace</code> ุงูุนูููุฉ ุจุฃููููุง ุนูู ุงุณุชุฎุฏุงู ูุณุทุญ ูุณุงุญุฉ ุงูุงุณู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููููู ุฅุฌุจุงุฑ dyld ุนูู ุงุณุชุฎุฏุงู ูุณุงุญุฉ ุงุณู ุซุงุจุชุฉ ูู ููุช ุงูุชุดุบูู ุนู ุทุฑูู ุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ <code>DYLD_FORCE_FLAT_NAMESPACE</code> . </p><br><p style=";text-align:right;direction:rtl">  ุชุชูุซู ุฅุญุฏู ููุฒุงุช ุงุณุชุฎุฏุงู ูุณุงุญุฉ ุงูุงุณู ุฐุงุช ุงููุณุชูููู ูู ุฃูู ูุชุนูู ุนููู ุฏุงุฆููุง ุฑุจุท ูู Mach-O ุตุฑุงุญุฉู ุจุฌููุน ุงูููุชุจุงุช ูุงูุฃุทุฑ ุงูุชู ุชุนุชูุฏ ุนูููุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุจุงูุฑุจุท ุฅูู AppKit ุ ููุง ููููู ุงุณุชุฎุฏุงู Foundation ููุท ุ  ุนููู ุฃู ุชุฑุจุทูุง ุตุฑุงุญุฉ.  ููุฒุฉ ุฃุฎุฑู ูู ุฃูู ุ ููุคูู ููุชุจุฉ ุฃู ุฅุทุงุฑ ุนูู ุ ูุง ููููู ููู ุชุทุจูู ุงูุฑูุฒ "ูุฃุณูู" ุจุญุฑูุฉ ุนูู ุทูู ุณูุณูุฉ ุงูุชุจุนูุฉ ุ ููุง ูุฏ ุชุนุชุงุฏ ุนูู ุงูููุงู ุจุฐูู (ุนูู ุณุจูู ุงููุซุงู ุ ูุง ููููู ููุท ููู ุงูุฑูุฒ ูู AppKit ุฅูู Foundation).  ููุณูุงุญ ุจูุฐุง ุ ูุฅู Mach-O ู ld ู dyld ููุง ุงูุนุฏูุฏ ูู ุงูููุฒุงุช ุงูุฅุถุงููุฉ ุ ููู <em>ุงูููุชุจุงุช ุงููุฑุนูุฉ ูุฅุนุงุฏุฉ ุชุตุฏูุฑ</em> <em>ุงูุฃุญุฑู ูุงูุฃุญุฑู</em> <em>ุงููุตููุฉ</em> . </p><br><h2 id="podbiblioteki" style=";text-align:right;direction:rtl">  ููุชุจุงุช ูุฑุนูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุงูููุชุจุงุช ุงููุฑุนูุฉ - ุขููุฉ ุชุณูุญ ูููุชุจุฉ ูุงุญุฏุฉ (ุชุณูู ููุชุจุฉ <em>ุงููุงุฌูุฉ</em> [ููุชุจุฉ ุงููุธูุฉ] ุฃู ููุชุจุฉ ุงููุธูุฉ [ููุชุจุฉ ุงููุธูุฉ]) ุจุชูููุถ ุชูููุฐ ุฌุฒุก ูู ูุธููุชูุง ุฅูู ููุชุจุฉ ุฃุฎุฑู (ุชุณูู ุงูููุชุจุฉ ุงููุฑุนูุฉ [ุงูููุชุจุฉ ุงููุฑุนูุฉ]) ุ  ุฃู ุ ุฅุฐุง ูุธุฑุช ุฅูููุง ูู ุงูุฌุงูุจ ุงูุขุฎุฑ ุ ููุง ูุณูุญ ููููุชุจุฉ ุจุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฑููุฒ ุงูุชู ุชูุฏููุง ููุชุจุฉ ุฃุฎุฑู ุจุดูู ุนููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูููุงู ุงูุฑุฆูุณู ุงูุฐู ูุณุชุฎุฏู ููู ูุฐุง ุ ูุฑุฉ ุฃุฎุฑู ุ <code>libSystem</code> ูุน <code>libSystem</code> ุงููุฑุนูุฉ ุงูููุฌูุฏุฉ ูู <code>/usr/lib/system</code> ุ  ูููู ูููู ุงุณุชุฎุฏุงูู ูุน ุฃู ุฒูุฌ ูู ุงูููุชุจุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o -lobjc -sub_library libobjc <span class="hljs-comment"><span class="hljs-comment"># : $ ld -o libfoo.dylib foo.o -reexport-lobjc</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุคุซุฑ ุนูู ูุฐุง ููุงุฑูุฉ ุจุงูุฑุจุท ููุท ุจุชูู ุงูููุชุจุฉ ูู ุฃู ุฃูุฑ <code>LC_REEXPORT_DYLIB</code> ููุชูุจ ุนูู ุงูููู ุงููุงุชุฌ ุจุฏูุงู ูู <code>LC_LOAD_DYLIB</code> ุงููุนุชุงุฏ (ุจูุง ูู ุฐูู ุงูุฑููุฒ ูู ุงูููุชุจุฉ ุงููุฑุนูุฉ ุฃุซูุงุก ุงูุฑุจุท <em>ูุง</em> ูุชู ูุณุฎูุง ุฅูู ููุชุจุฉ ุงููุธูุฉ ุ ูุฐูู ูุง ููุฒู ุญุชู ุงูุงุฑุชุจุงุท ูู ุญุงูุฉ ุฅุถุงูุฉ ุฃุญุฑู ุฌุฏูุฏุฉ ุฅูู ุงูููุชุจุฉ ุงููุฑุนูุฉ ูุงุญููุง).  ูู ููุช ุงูุชุดุบูู ุ ุชุนูู <code>LC_REEXPORT_DYLIB</code> ุฃูุถูุง ุนูู ุบุฑุงุฑ <code>LC_LOAD_DYLIB</code> : ุณูููู dyld ุจุชุญููู ุงูููุชุจุฉ ุงููุฑุนูุฉ <code>LC_LOAD_DYLIB</code> ุฃุญุฑููุง ููุจุงูู (ูููู ุจุฎูุงู <code>LC_LOAD_DYLIB</code> ุ ูู ุญูุซ ูุณุงุญุฉ ุงูุงุณู ุฐุงุช ุงููุณุชูููู ุ ุณุชุฃุชู ุงูุฃุญุฑู ูู ุงูููุชุจุฉ ุงูุดุงููุฉ). </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุฎุชูู ุญููุง ูู <code>LC_REEXPORT_DYLIB</code> ูู ูุง ููุนูู ld ุนูุฏ ุฑุจุท ููุชุจุฉ <em>ุฃุฎุฑู</em> ุจู <code>libfoo</code> : ุจุฏูุงู ูู ูุฌุฑุฏ ุงูุจุญุซ ุนู ุงูุฑููุฒ ูู ุฌููุน ูููุงุช ุงููุงุฆูุงุช ูุงููููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ุฅูููุง ุ ุณููุชุญ ld ุฃูุถูุง ูููุธุฑ ูู ุงูููุชุจุฉ ุงููุฑุนูุฉ ุงููุนุงุฏ ุชุตุฏูุฑูุง (ูู ูุฐุง ูุซุงู <code>libobjc</code> ). </p><br><p style=";text-align:right;direction:rtl">  ููู ูุนุฑู ุฃูู ูุจุญุซ ุนููุงุ  ุงูุดูุก ุงููุญูุฏ ุงููุญููุธ ูู <code>libfoo.dylib</code> ูู ุงุณู ุงูุชุซุจูุช <code>libobjc.dylib</code> ุ ุญูุซ ูุชููุน ld ุงูุนุซูุฑ ุนููู.  ูุฐุง ูุนูู ุฃูู ูุฌุจ ุชุซุจูุช ุงูููุชุจุฉ ูู ููุงููุง ูุจู ุงุณุชุฎุฏุงููุง ูููุชุจุฉ ูุฑุนูุฉ ูุฃู ุดูุก ุขุฎุฑ ุ  ูุฐุง ูุนูู ุจุดูู ุฌูุฏ ูููุชุจุงุช ุงููุธุงู ูุซู <code>libobjc</code> ุ ูููู ูููู ุฃู ูููู ุบูุฑ ูุฑูุญ ููุบุงูุฉ ุฃู ูุณุชุญูู ุชูุงููุง ุฅุฐุง ููุช ุชุญุงูู ุฅุนุงุฏุฉ ุชุตุฏูุฑ ููุชุจุชู ุงููุฑุนูุฉ ุงูุฎุงุตุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุญู ูุฐู ุงููุดููุฉ ุ ูููุฑ ld ุฎูุงุฑ <code>-dylib_file</code> ุ ุงูุฐู ูุณูุญ ูู ุจุชุญุฏูุฏ ูุณุงุฑ dylib ูุฎุชูู ูุงุณุชุฎุฏุงูู ุฃุซูุงุก ุงูุฑุจุท: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o -reexport_library /path/to/libsubfoo.dylib $ ld -o libbar.dylib bar.o libfoo.dylib -dylib_file @executable_path/lib/foo/libsubfoo.dylib:/path/to/libsubfoo.dylib</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู <code>libSystem</code> ูุจุนุถ ููุชุจุงุช ุงููุธุงู ุงูุฃุฎุฑู ุชุนูุฏ ุชุตุฏูุฑ ููุชุจุงุชูุง ุงููุฑุนูุฉ ุ ุฅูุง ุฃูู ูุณุช ูุถุทุฑูุง ุฅูู ุงุณุชุฎุฏุงู <code>-dylib_file</code> ุนูุฏ ุฑุจุท ูู ูู ุงููููุงุช ุงููุงุจูุฉ ููุชูููุฐ ุนูู macOS ุ  ูุฐูู ูุฃู ููุชุจุงุช ุงููุธุงู ูุซุจุชุฉ ุจุงููุนู ููููุง ูุงุณู ุงูุชุซุจูุช ุงูุฎุงุต ุจูุง.  ูููู ุนูุฏ ุจูุงุก Darling ุนูู Linux ุ ูุชุนูู ุนูููุง ุชูุฑูุฑ ุนุฏุฏ ูููู ูู ุฎูุงุฑุงุช <code>-dylib_file</code> (ูุงูุญุฌุฌ ุงูุดุงุฆุนุฉ ุงูุฃุฎุฑู) ุฅูู ูู ููุงููุฉ ld.  ูููู ุจุฐูู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธููุฉ ุฎุงุตุฉ</a> ูุชู ุชุทุจูููุง ุชููุงุฆููุง ุนูุฏ ุงุณุชุฎุฏุงู <code>add_darling_library</code> ู <code>add_darling_executable</code> ูุบูุฑูุง. </p><br><h2 id="pereeksportirovanie-simvolov" style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฃุญุฑู </h2><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ูุฏ ุชุญุชุงุฌ ุงูููุชุจุฉ ุฅูู ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุจุนุถ ุงูุดุฎุตูุงุช - ูููู ููุณ ูููุง ูุฑุฉ ูุงุญุฏุฉ - ูู ููุชุจุฉ ุฃุฎุฑู.  ุนูู ุณุจูู ุงููุซุงู ุ ุชููู Core Foundation <code>NSObject</code> ุ ูุงูุฐู ูุชู ุชุทุจููู ูู ุงูุฅุตุฏุงุฑุงุช ุงูุญุฏูุซุฉ ุฏุงุฎู ููุช ุชุดุบูู Objective-C ุ ูู ุฃุฌู ุงูุชูุงูู. </p><br><p style=";text-align:right;direction:rtl">  (ุฅุฐุง ููุช ููุชููุง ุจุงูุณุจุจ ูู ุฃู <code>NSObject</code> ูุงูุช ูู ูุคุณุณุฉ Core ุจุฏูุงู ูู ุงููุคุณุณุฉ ุ ูุฐูู ูุฃู ููููุฉ <em>ุงูุชุญููู ุงููุฌุงูู</em> [ุงูุฌุณุฑ ุงููุฌุงูู ุ ูุงููุฏุฑุฉ ุนูู ุงูุฅููุงุก ูุจุงุดุฑุฉ ุจูู ุฃููุงุน Core Foundation ูุฃููุงุน Foundation ุงูููุงุจูุฉ ุฏูู ุชุญููู ุฅุถุงูู] ุ ูุชุทูุจ ุฃู ูุชู ุชูููุฐ <code>__NSCFString</code> ุฎุงุตุฉ ุนูู ุงูุฃููุงุน ูู Core Foundation (ุนูู ุณุจูู ุงููุซุงู ุ <code>__NSCFString</code> ) ูู Core Foundation ุ <code>__NSCFString</code> Objective-C ุ ูุฌุจ ุฃู ุชููู ููุฑูุซุฉ ูู <code>NSObject</code> . ุฑุจูุง ูููู ุชุญููู ุฐูู ููู ูู ุฎูุงู ูุขุฎุฑ ุ ูุชุฑู <code>NSObject</code> ูุน ุฌููุน ูุฑุซุชูุง ูู ุงููุคุณุณุฉ ูุงูุญููุฉ  esky ูุฑุจุท ุจูู Core Foundation ูุงููุคุณุณุฉ ุ ููู Apple ูุฑุฑุช ุชุฑุญูู ูุฐู ุงููุฆุงุช ุงูุฎุงุตุฉ ุงููุณุงุนุฏุฉ ุฅูู ุฌุงูุจ <code>NSObject</code> ุฅูู Core Foundation ุ ููู Darling ูููู ุจุฐูู ุจููุณ ุงูุทุฑููุฉ ููุญูุงุธ ุนูู ุงูุชูุงูู.) </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชูุฑูุฑ ูุงุฆูุฉ ูู ุงูุฃุญุฑู <code>-reexported_symbols_list</code> ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑ <code>-reexported_symbols_list</code> ุงูุฎุงุต <code>-reexported_symbols_list</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> .objc_class_name_NSObject &gt; reexport_list.exp $ ld -o CoreFoundation CFFiles.o -lobjc -reexported_symbols_list reexport_list.exp</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุฅุนุงุฏุฉ ุชุตุฏูุฑ <em>ุจุนุถ</em> ุงูุฑููุฒ ุชุจุฏู ูุดุงุจูุฉ ุฌุฏูุง ูุฅุนุงุฏุฉ ุชุตุฏูุฑ <em>ุฌููุน</em> ุงูุฑููุฒ ุ ุฅูุง ุฃู ุงูุขููุฉ ุงูุชู ูุชู ูู ุฎูุงููุง ุชูููุฐ ุฐูู ุชุฎุชูู ุชูุงููุง ุนู ุทุฑููุฉ ุนูู ุงูููุชุจุงุช ุงููุฑุนูุฉ.  ูุง ูุชู ุงุณุชุฎุฏุงู ุฃูุฑ <code>LC_*_DYLIB</code> ุ  ุจุฏูุงู ูู ุฐูู ุ ูุชู ุฅุฏุฑุงุฌ <em>ุฑูุฒ ุบูุฑ ูุจุงุดุฑ</em> ุฎุงุต (ูุดุงุฑ ุฅููู <code>N_INDIR</code> ) ูู ุฌุฏูู ุงูุฃุณูุงุก ุ ููุชุตุฑู ูุซู ุงูุฑูุฒ ุงููุญุฏุฏ ูู ูุฐู ุงูููุชุจุฉ.  ุฅุฐุง ูุงูุช ุงูููุชุจุฉ ููุณูุง ุชุณุชุฎุฏู ูุฐุง ุงูุฑูุฒ ุ <em>ูุณุชุธูุฑ</em> ุงููุณุฎุฉ <em>ุงูุซุงููุฉ</em> "ุบูุฑ ุงููุญุฏุฏุฉ" ูู ุงูุฑูุฒ ูู ุฌุฏูู ุงูุฃุณูุงุก (ููุง ูุญุฏุซ ุจุฏูู ุฅุนุงุฏุฉ ุชุตุฏูุฑ). </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฃุดูุงุก ุงูุตุบูุฑุฉ ุงููููุฉ ุงูุชู ูุฌุจ ูุถุนูุง ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุงุณุชุฎุฏุงู ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฃุญุฑู ุจุดูู ุตุฑูุญ ุฃูู ุชุญุชุงุฌ ุนูู ุงูุฃุฑุฌุญ ุฅูู ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฃุญุฑู ุจุฃุณูุงุก ูุฎุชููุฉ ูููุงูู ูุฎุชููุฉ.  ูู ุงููุงูุน ุ ุชุฎุชูู ุงุตุทูุงุญุงุช ุชุณููุฉ [name mangling Convention] ูู Objective-C ููุงุฌูุฉ Objective-C ุงูุซูุงุฆูุฉ [ABI] ูู i386 ู x86-64 ุ ูุฐูู ูู i386 ูุง ุนููู ุณูู <code>.objc_class_name_NSObject</code> ุ ูุนูู x86-64 - <code>_OBJC_CLASS_$_NSObject</code> ู <code>_OBJC_IVAR_$_NSObject.isa</code> ู <code>_OBJC_METACLASS_$_NSObject</code> .  ูุง ูุชุนูู ุนููู ุงูุชูููุฑ ูู ุงูุฃูุฑ ุนูุฏ ุงุณุชุฎุฏุงู ุงูููุชุจุงุช ุงููุฑุนูุฉ ุ ูุธุฑูุง ูุฃูู ูุชู ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุฌููุน ุงูุฑููุฒ ุงููุชุงุญุฉ ุชููุงุฆููุง ููู ุจููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชุชุนุงูู ูุนุธู ุฃุฏูุงุช ุงูุนูู ูุน Mach-O ุจุดูุงููุฉ ูุน ุงูุซูุงุฆูุงุช "ุงูุณูููุฉ" ุฃู ุงูุนุงูุฉ (ูููุงุช Mach-O ุงูุชู ุชุญุชูู ุนูู ุงูุนุฏูุฏ ูู Mach-O ุงููุฑุนูุฉ ููุนุฏูุฏ ูู ุงูุชุตูููุงุช).  ูููู ูู Clang ุชุฌููุน ุงูุซูุงุฆูุงุช ุงูุนุงูููุฉ ูุน ุฌููุน ุงูุจููุงุช ุงููุทููุจุฉ ุ ููุฎุชุงุฑ dyld ุฃู ุจููุฉ ูุชู ุชุญููููุง ูู dylib ุ ููุจุญุซ ูู ุฃู ุจูู ูุฏุนููุง ุงูุฏุนู ุงููุงุจู ููุชูููุฐ ุ ูุฃุฏูุงุช ูุซู ld ู otool ู nm ุชุนูู ูุน ุงูุจููุฉ ุงููุทุงุจูุฉ ูููุฏุณุฉ ุงูููุจููุชุฑ (ุฃู . x86-64) ุ ูุง ูู ุชุทูุจ ุตุฑุงุญุฉ ุจููุฉ ูุฎุชููุฉ ุจุนูุงูุฉ ุฎุงุตุฉ. ,  -   ,     โ  ,         ,      . </p><br><p style=";text-align:right;direction:rtl">         .  ld          ,  ,     dylib-           lipo: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o CF_i386.dylib CFFiles.o -arch i386 -lobjc -reexported_symbols_list reexport_i386.exp $ ld -o CF_x86-64.dylib CFFiles.o -arch x86_64 -lobjc -reexported_symbols_list reexport_x86_64.exp $ lipo -arch i386 CF_i386.dylib -arch x86_64 CF_x86-64.dylib -create -output CoreFoundation</code> </pre> <br><p style=";text-align:right;direction:rtl">  Darling   CMake-   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>add_separated_framework</code></a> ,        lipo,    CMake-   Core Foundation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cmake hljs">add_separated_framework(CoreFoundation CURRENT_VERSION SOURCES <span class="hljs-variable"><span class="hljs-variable">${cf_sources}</span></span> VERSION <span class="hljs-string"><span class="hljs-string">"A"</span></span> DEPENDENCIES objc system icucore LINK_FLAGS <span class="hljs-comment"><span class="hljs-comment"># ...    ) set_property(TARGET CoreFoundation_i386 APPEND_STRING PROPERTY LINK_FLAGS " -Wl,-reexported_symbols_list,${CMAKE_CURRENT_SOURCE_DIR}/reexport_i386.exp") set_property(TARGET CoreFoundation_x86_64 APPEND_STRING PROPERTY LINK_FLAGS " -Wl,-reexported_symbols_list,${CMAKE_CURRENT_SOURCE_DIR}/reexport_x86_64.exp")</span></span></code> </pre> <br><h2 id="meta-simvoly" style=";text-align:right;direction:rtl"> - </h2><br><p style=";text-align:right;direction:rtl"> - โ   , ,   Apple     ,    . </p><br><p style=";text-align:right;direction:rtl">   Mach-O-       macOS,   ,     <code>-mmacosx-version-min=10.x</code> (    iOS, tvOS, watchOS    ,  Apple      ).     ;   ,         <code>AVAILABLE_MAC_OS_X_VERSION_10_13_AND_LATER</code>      C++  <code>libstdc++</code> (  GNU)  <code>libc++</code> (  LLVM).      ,        Mach-O.  ,   ld   <code>-macosx_version_min</code> (        <code>m</code> ),     Mach-O- <code>LC_VERSION_MIN_MACOSX</code> ( dyld,    ,        ). </p><br><p style=";text-align:right;direction:rtl">    ,  ld  <code>-macosx_version_min</code>   ,  - <em></em> Mach-O- . - โ  ,     <code>$ld$</code> ,  ld,    ,    :     ,   .      <code>$ld$$$</code> .  <code></code>   <code>os10.5</code>  ,       - โ  ,        <em></em>   Mach-O-   <em></em> ,   ; <code></code>   <code>add</code> , <code>hide</code> , <code>install_name</code>  <code>compatibility_version</code> ,   ld ,          <code></code> ,  <code></code>          ( )  , . </p><br><p style=";text-align:right;direction:rtl">  <code></code>     , ,  ,             ; ,   -,   <code>libobjc</code> ,   <code>NSObject</code>  ,      macOS: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs perl">$ld$hide$os10.<span class="hljs-number"><span class="hljs-number">0</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">0</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">0</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">1</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">1</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">1</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">2</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">2</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">2</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">3</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">3</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">3</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">4</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">4</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">4</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">5</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">5</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">5</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">6</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">6</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">6</span></span>$_OBJC_METACLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">7</span></span>$_OBJC_CLASS_$_NSObject $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">7</span></span>$_OBJC_IVAR_$_NSObject.isa $ld$hide$os10.<span class="hljs-number"><span class="hljs-number">7</span></span>$_OBJC_METACLASS_$_NSObject</code> </pre> <br><p style=";text-align:right;direction:rtl">           ,   ,   ,          ,   <em></em>   . </p><br><h2 id="rezolvery-simvolov" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">      dyld โ   <em> </em> [symbol resolvers],     .    ,  ,          ,  dyld     ,     . </p><br><p style=";text-align:right;direction:rtl">         ld,     .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> <code>.symbol_resolver</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs mel">;    foo _foo1: movl <span class="hljs-number"><span class="hljs-number">1</span></span>, %eax ret _foo2: movl <span class="hljs-number"><span class="hljs-number">2</span></span>, %eax ret .symbol_resolver _foo ;  -  call _condition jz .ret_foo2 movq _foo1, %rax ret .ret_foo2: movq _foo2, %rax ret ;   ,   _foo  ;   ,     , ;     . .<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> _foo _foo:</code> </pre> <br><p style=";text-align:right;direction:rtl">    C          ,    ,     C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//         return 0; } static void *foo_resolver() { __asm__(".symbol_resolver _foo"); return condition() ? &amp;foo1 : &amp;foo2; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> (     <code>_foo</code>   <code>foo</code> ,    Darwin        C,          .  ,      Mach-O    Darling,            ELF-,     .) </p><br><p style=";text-align:right;direction:rtl">   <code>_foo</code>     ,          (           ),  <code>foo()</code>  <code>foo_resolver()</code>     ,  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ __asm__(<span class="hljs-string"><span class="hljs-string">".symbol_resolver _foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> condition() ? &amp;foo1 : &amp;foo2; }</code> </pre> <br><p style=";text-align:right;direction:rtl">   ,    โ     - ,   <code>foo()</code>   ,      (      <code>int</code> -).  ,  ,       :  <code>dlsym("_foo")</code>    <code>_foo</code> โ  ,      ,       , โ         . ,       ,    ,      <code>foo()</code>    <code>_foo</code> . </p><br><p style=";text-align:right;direction:rtl">         .  Apple    <code>libplatform</code>                     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs tex">#define _OS_VARIANT_RESOLVER(s, v, ...) <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>__attribute__((visibility(OS_STRINGIFY(v)))) extern void* s(void); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>void* s(void) { <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>__asm__(".symbol_resolver _" OS_STRINGIFY(s)); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>__VA_ARGS__ <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>} #define _OS_VARIANT_UPMP_RESOLVER(s, v) <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>_OS_VARIANT_RESOLVER(s, v, <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>uint32_t *_c = (void*)(uintptr_t)_COMM_PAGE_CPU_CAPABILITIES; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>if (*_c &amp; kUP) { <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>extern void OS_VARIANT(s, up)(void); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>return &amp;OS_VARIANT(s, up); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>} else { <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>extern void OS_VARIANT(s, mp)(void); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>return &amp;OS_VARIANT(s, mp); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>})</code> </pre> <br><p style=";text-align:right;direction:rtl">    ,  โ    โ     (   <code>kUP</code>    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">commpage</a> ), , ,       [spinlock].            ,                . </p><br><p style=";text-align:right;direction:rtl">  Darling          :    Mach-O-   ELF-  Linux,    [host,    ,      Darling] โ ,   <code>libX11</code>  <code>libcairo</code> . </p><br><p style=";text-align:right;direction:rtl">     ELF- โ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>libelfloader</code></a> ,     ELF,        ,   ld-linux,  dyld  Linux,    ld-linux      ELF-.    <code>libelfloader</code>  Mach-O     <code>/usr/lib/darling/libelfloader.dylib</code>   Darwin-chroot-;  ,       Darwin-. </p><br><p style=";text-align:right;direction:rtl">     ,  <code>libelfloader</code>  <em></em>     Mach-O  ELF.    ( <code>_elfcalls</code> ),  <a href=""> </a> <code>libSystem</code> ,  Darwin      ,        ELF-  Linux. ยซยป Darwin  Linux         โ   ,      C ( <code>libSystem_c</code>  <code>glibc</code> , ). </p><br><p style=";text-align:right;direction:rtl">     ELF-   Darwin,   - <code>libelfloader</code> API  <code>_elfcalls-&gt;dlsym_fatal(_elfcalls-&gt;dlopen_fatal("libX11.so"), "XOpenDisplay")</code> . ,       <a href="">wrapgen</a> ,   ELF-    ,       ,   The Cocotron โ          Linux โ   .   wrapgen  ELF- (, <code>libX11.so</code> ),           : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs delphi">#include &lt;elfcalls.h&gt; extern struct elf_calls* _elfcalls; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> void* lib_handle; __attribute__((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">{ lib_handle = _elfcalls-&gt;dlopen_fatal("libX11.so"); }</span></span></span><span class="hljs-function"> __</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attribute__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">destructor</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">{ _elfcalls-&gt;dlclose_fatal(lib_handle); }</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XOpenDisplay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">{ __asm__(".symbol_resolver _XOpenDisplay"); return _elfcalls-&gt;dlsym_fatal(lib_handle, "XOpenDisplay"); }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">       Mach-O-     <code>/usr/lib/native/libX11.dylib</code> ,   Mach-O-     ,     <em></em> <code>libX11.so</code> ,    Mach-O.  ,    CMake-   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>wrap_elf</code></a> ,    wrapgen,  Mach-O-     <code>/usr/lib/native</code> :   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> <code>wrap_elf(X11 libX11.so)</code>      <code>libX11</code> ,         Mach-O-. </p><br><p style=";text-align:right;direction:rtl">       Linux        <em></em> .    ,   Darling   ,      Darwin    Linux,     .  Darling โ     Darwin ( ,  Darwin); , , ,           Darwin,   <code>libSystem</code> , dyld, XNU  launchd,        ,     ,   commpage.       ,   <code>libsystem_kernel</code> ,    ,         Linux,   ยซยป   Darwin- โ Linux  GNU/Linux   .          Linux-    ,   Linux   (  X server)      ,     [witnessing a magic trick] โ     <code>libelfloader</code> ,    wrapgen, ,  .   ,    ,   , ,  ,   . </p><br><h2 id="poryadok-simvolov" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">   -   ,      Mach-O-,    ld      . ( ,     โ <em></em> ,  Apple,  ,  .) </p><br><p style=";text-align:right;direction:rtl">   ,   ,     ,      ,  <em> </em> [order file],     ld   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ld -o libfoo.dylib foo.o -order_file foo.order</code> </pre> <br><p style=";text-align:right;direction:rtl">     <code>-reexported_symbols_list</code> ,     , <code>-order_file</code>  ,    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs 1c">symbol1 symbol2 <span class="hljs-meta"><span class="hljs-meta">#  . # #    ,     , # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">   (   C)  #        . foo.o: _static_function3 #  ,   ,     #     ;    # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">       #  lipo,   </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  # . i386:symbol4</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   ( ,    ,  )         ยซยป        .         ,       ,    ,        ,       <code>.subsections_via_symbols</code> ,    Mach-O-   ,     , ,   ,   . </p><br><p style=";text-align:right;direction:rtl">   ,   Apple    โ     <code>libdispatch</code> . <code>libdispatch</code>     , ยซOS objectยป,     ,       .          Objective-C,  <code>libdispatch</code>   <em> </em> (    Core Foundation),     <code>libdispatch</code> -  Objective-C-    ,     Objective-C-.  ,      <code>dispatch_data_t</code>  <code>NSData *</code>      API  Cocoa (    ). </p><br><p style=";text-align:right;direction:rtl">   <a href=""></a>     ,    ,   Objective-C-   <em>OS object vtables</em>     .   ,    <a href=""><code>DISPATCH_OBJECT_TFB</code></a> , ,   Objective-C     <code>libdispatch</code> -,    <code>isa</code>  <code>vtable</code> - <code>dispatch_object</code>  <code>object</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs tex">#define DISPATCH_OBJECT_TFB(f, o, ...) <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>if (slowpath((uintptr_t)((o)._os_obj-&gt;os_obj_isa) &amp; 1) || <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>slowpath((Class)((o)._os_obj-&gt;os_obj_isa) &lt; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>(Class)OS_OBJECT_VTABLE(dispatch_object)) || <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>slowpath((Class)((o)._os_obj-&gt;os_obj_isa) &gt;= <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>(Class)OS_OBJECT_VTABLE(object))) { <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>return f((o), ##__VA_ARGS__); <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>}</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> ,   ,     <code>libdispatch</code> . </p><br><h2 id="podmena-simvolov" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">       (   ) โ    <code>DYLD_INSERT_LIBRARIES</code> ,  dyld     Mach-O-          . ,         ,    ,          <code>DYLD_FORCE_FLAT_NAMESPACE</code> . </p><br><p style=";text-align:right;direction:rtl">  ,      ,    <em></em> -  .     (   ),     <code>dlsym()</code>   <code>RTLD_NEXT</code> ,  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lua">int <span class="hljs-built_in"><span class="hljs-built_in">open</span></span>(const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, int flags, mode_t mode) { printf(<span class="hljs-string"><span class="hljs-string">" open(%s)\n"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>); // <span class="hljs-string"><span class="hljs-string">"  "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strcmp(<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, <span class="hljs-string"><span class="hljs-string">"foo"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">path</span></span> = <span class="hljs-string"><span class="hljs-string">"bar"</span></span>; } int (*original_open)(const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *, int, mode_t); original_open = dlsym(RTLD_NEXT, <span class="hljs-string"><span class="hljs-string">"open"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> original_open(<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>, flags, mode); }</code> </pre> <br><p style=";text-align:right;direction:rtl">    , dyld     ,  <em>dyld-</em> [dyld iterposing].      Mach-O-   <code>__interpose</code> , dyld      ,    โ    . </p><br><p style=";text-align:right;direction:rtl">   ,       โ ,        <code>__interpose</code> โ    <em> </em> [implicit interposing].   ,  <code>__interpose</code>       (     ),  dyld      .  , dyld- <em></em>       ,      - .  , dyld  ,      -    ,     - (   Mach-O-): </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">static <span class="hljs-type"><span class="hljs-type">int</span></span> my_open(const <span class="hljs-type"><span class="hljs-type">char</span></span>* <span class="hljs-type"><span class="hljs-type">path</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> flags, mode_t mode) { printf("Called open(%s)\n", <span class="hljs-type"><span class="hljs-type">path</span></span>); // "  " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strcmp(<span class="hljs-type"><span class="hljs-type">path</span></span>, "foo") == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-type"><span class="hljs-type">path</span></span> = "bar"; } //    ,    //  <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>()      my_open(). <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(<span class="hljs-type"><span class="hljs-type">path</span></span>, flags, mode); } //      __interpose __attribute__ ((section ("__DATA,__interpose"))) static struct { <span class="hljs-type"><span class="hljs-type">void</span></span> *replacement, *replacee; } replace_pair = { my_open, <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,      โ          โ       Mach-O-  -        [relocation table].        ,   dyld      (    ),     . </p><br><p style=";text-align:right;direction:rtl"> ,      <code>dyld_dynamic_interpose</code> ,       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *replacement, *replacee; } replacement_tuple; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mach_header</span></span></span><span class="hljs-class"> __</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dso_handle</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dyld_dynamic_interpose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> struct mach_header*, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> replacement_tuple replacements[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interpose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ replacement_tuple replace_pair = { my_open, open }; dyld_dynamic_interpose(&amp;__dso_handle, &amp;replace_pair, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br><p style=";text-align:right;direction:rtl"> ,     ,         ,     . </p><br><p style=";text-align:right;direction:rtl"> <code>DYLD_INSERT_LIBRARIES</code>  dyld-         Objective-C,   C,  - ,       Objective-C- ( <code>IMP</code> ),    Objective-C       ,   <em>method swizzling</em> ( <em>isa swizzling</em> ). </p><br><p style=";text-align:right;direction:rtl">      Darling     xtrace,       . </p><br><p style=";text-align:right;direction:rtl">   Darwin    Darwin (    โ   BSD    Mach- [Mach traps]).        <code>libsystem_kernel</code> ,   ABI     userspace.  Darling,    <code>libsystem_kernel</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>    Darwin     Linux    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Darling-Mach</a> ,    Linux,  Mach   . </p><br><p style=";text-align:right;direction:rtl"> strace,       Linux,    ,  Linux-;  strace    Darwin,   Darling,     Linux,       Darwin (    Linux,    ELF- ).   ,    Darwin  Linux      ,   ,    Darwin   โ  ,       โ   . </p><br><p style=";text-align:right;direction:rtl">        , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">xtrace</a> .    strace,           ,   <code>ptrace()</code> API, xtrace          .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> <code>DYLD_INSERT_LIBRARIES=/usr/lib/darling/libxtrace.dylib</code> ,   - [trampoline functions]       ,        .  xtrace   ,  strace,       ,       ,   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">Darling [~]$ xtrace arch &lt;......&gt; [223] mach_timebase_info_trap (...) [223] mach_timebase_info_trap () -&gt; KERN_SUCCESS [223] issetugid (...) [223] issetugid () -&gt; 0 [223] host_self_trap () [223] host_self_trap () -&gt; port right 2563 [223] mach_msg_trap (...) [223] mach_msg_trap () -&gt; KERN_SUCCESS [223] _kernelrpc_mach_port_deallocate_trap (task=2563, name=-6) [223] _kernelrpc_mach_port_deallocate_trap () -&gt; KERN_SUCCESS [223] ioctl (...) [223] ioctl () -&gt; 0 [223] fstat64 (...) [223] fstat64 () -&gt; 0 [223] ioctl (...) [223] ioctl () -&gt; 0 [223] write_nocancel (...) i386 [223] write_nocancel () -&gt; 5 [223] <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> (...)</code> </pre> <br><p style=";text-align:right;direction:rtl">    ,       BSD  Mach.   ,   <code>write()</code>  <code>exit()</code> ,     Linux-,       . ,  Mach-   <code>ioctl</code> -   <code>/dev/mach</code> ,     ;   BSD- <code>ioctl()</code> ,   stdio   ,      stdin  stdout (    tty) <a href=""></a>     <code>readlink()</code>    <code>/proc/self/fd/</code> . </p><br><hr><br><p style=";text-align:right;direction:rtl">          Mach-O,        ,     dyld.      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    ,       ,     dylib,  ,  <em> </em>  . ld       <code>-bundle_loader</code> . </li><li style=";text-align:right;direction:rtl">   ,  <code>LC_LOAD_DYLIB</code> , <code>LC_REEXPORT_DYLIB</code>  <code>LC_DYLIB_ID</code>    ,   <em></em>  <em></em>  [compatibility version, current version] ,    โ    ,    .              ld <code>-current_version</code>  <code>-compatibility_version</code> , .     dyld ,       ,    ,     . </li><li style=";text-align:right;direction:rtl">      ,  Mach-O     <em>  </em> [source version].     , <code>LC_SOURCE_VERSION</code> .        ld <code>-source_version</code> ,    ,       Mach-O- โ    <code>-add_source_version</code>  <code>-no_source_version</code> . </li><li style=";text-align:right;direction:rtl">    <code>Info.plist</code>   <code>__info_plist</code> Mach-O-    [codesign] ,           <code>Info.plist</code> .    <a href="">ad-hoc </a>  Security.framework,  ,      <code>CFBundle</code> / <code>NSBundle</code> API,       ,     ,  . </li></ul><br><p style=";text-align:right;direction:rtl"> ,  ,       , ld  dyld    ,    ยซ ยป,   <code>libSystem</code> ,  -.            <code>/usr/lib/</code> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar417507/">https://habr.com/ru/post/ar417507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar417495/index.html">ุงูุชุตุฑุช ุงููุฑู ุงูุฑูุณูุฉ ูุงูุฃููุฑุงููุฉ ุนูู ุงูุฃูุฑูุจููู ูู ุงูููุงุฆู ุงูุฃูุฑูุจู ููุณุงุจูุฉ Intel InnovateFPGA</a></li>
<li><a href="../ar417497/index.html">4 ุณููุงุช ูู ุนูู ุงูุจูุงูุงุช ูู ูุฌููุนุฉ Schibsted Media Group</a></li>
<li><a href="../ar417501/index.html">ุดุฑูุฉ Lifehacks ูุชุตููุน ุงูุฃููุงุญ ูู ุทุจูุชูู (LUT)</a></li>
<li><a href="../ar417503/index.html">ูุง ูุฌุจ ุฃู ูุชุฐูุฑู ูุทูุฑ ุงูููุจ ููููุงู SEO-Feng Shui</a></li>
<li><a href="../ar417505/index.html">ุฅูุชู ุชุทูู ุชุตุญูุญุงุช ูุซุบุฑุงุช ุฃูููุฉ ุฌุฏูุฏุฉ ููุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูู ME</a></li>
<li><a href="../ar417509/index.html">ูุตุงุฆุญ ูุญูู Kubernetes: ุชุณุฑูุน ุนูููุฉ ุงูุชูููุฏ ูููุงุนุฏ ุงูุจูุงูุงุช ุงููุจูุฑุฉ</a></li>
<li><a href="../ar417511/index.html">ุฅูุชู ุชุณุชุญูุฐ ุนูู eASIC - ุงููุทูุฑ ุงูููููู ASIC</a></li>
<li><a href="../ar417513/index.html">ุงููุธูุฑ ูู ุจูุซูู ูุฌุงูุง ุณูุฑูุจุช. ุงูุฌุฒุก ุงูุซุงูู</a></li>
<li><a href="../ar417515/index.html">ูุง ุชุนููุชู ูู ุฎูุงู ุฅูุดุงุก 100 ูุนุจุฉ ูู 5 ุณููุงุช</a></li>
<li><a href="../ar417517/index.html">ุตูุญุงุช ุชุงุฑูุฎ ุฅูุชู. ุตูุฑ ููุงุฆุน ูุงุฎุชุจุงุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>