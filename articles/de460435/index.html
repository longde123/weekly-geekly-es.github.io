<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÆ üêâ üë®üèΩ‚Äç‚úàÔ∏è Kleine Freude # 8: kleine Freuden f√ºr die Arbeit mit der Datenbank üëû ‚§¥Ô∏è üßëüèø‚Äçü§ù‚Äçüßëüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine kurze Befragung von Kollegen zu meinem aktuellen Projekt ergab, dass mit den Worten "ORM und Arbeiten mit der Datenbank" in den allermeisten F√§ll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kleine Freude # 8: kleine Freuden f√ºr die Arbeit mit der Datenbank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460435/"><p>  Eine kurze Befragung von Kollegen zu meinem aktuellen Projekt ergab, dass mit den Worten "ORM und Arbeiten mit der Datenbank" in den allermeisten F√§llen die Worte "Alchemie" und "Django ORM" klingen.  Die Kenntnis dieser beiden W√∂rter reicht im Allgemeinen aus, um sauberen, ordentlichen und funktionierenden Code zu schreiben.  Die Erweiterung des technischen Horizonts hat bisher noch niemandem geschadet. Deshalb werden wir heute ein paar (vielleicht bis heute unbekannte) coole St√ºcke f√ºr die Arbeit mit der Datenbank zu unserem Bild der Welt hinzuf√ºgen. </p><br><p><img src="https://habrastorage.org/webt/uk/az/it/ukazitmggbfvyxec95urmvbz8zs.jpeg"></p><a name="habracut"></a><br><h2 id="yoyo">  Yoyo </h2><br><p>  Heutzutage verf√ºgt jeder ORM √ºber ein internes Datenbankmigrationssystem.  Ein einfacher und cooler Ansatz, bei dem ORM die Struktur von Tabellen im Allgemeinen √ºberwacht, ist f√ºr jeden geeignet.  Diese L√∂sung hat jedoch einen Fall, in dem die Verwendung unpraktisch ist: </p><br><ul><li><p>  Es gibt Leute, die Anfragen in einer Datenbank unter Umgehung von ORM stellen.  Dies verwendet so etwas wie Asyncpg und einen kleinen selbstgeschriebenen Fleck, um das Zusammenstellen von Anforderungen zu vereinfachen. </p><br><p> Warum geben diese Leute die ORM-Annehmlichkeiten auf?  Ja, da jeder Wrapper f√ºr die Datenbank eine bestimmte Menge an Systemressourcen verbraucht und diese Leute Hochleistungscode schreiben m√ºssen.  Sie haben ORM rausgeschmissen und m√ºssen irgendwie die Basis migrieren. </p><br></li><li>  Integrierte Migranten haben m√∂glicherweise ihre eigenen spezifischen Ansichten zum Verkn√ºpfen und Indizieren von Datens√§tzen.  Manchmal ist es nicht m√∂glich, diese ORM-Ansichten f√ºr die Struktur von Tabellen zu deaktivieren. </li></ul><br><p>  In beiden F√§llen ist es praktisch, manuelle Migrationen zu verwenden. Wir verlassen uns nicht auf ORM-Modelle, sondern geben mit unseren H√§nden die erforderlichen SQL-Anweisungen ein und geben sie in einen einfachen Migrator ein, der nacheinander strukturelle √Ñnderungen an der Datenbank anwendet. </p><br><p>  Die Ausgabe ist eine saubere, verst√§ndliche und vollst√§ndig verwaltbare Tabellenstruktur, die mit Bedacht kompiliert wurde. </p><br><p>  F√ºr einen solchen manuellen Ansatz gibt es einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yoyo-</a> Datenbankschema-Migrator. </p><br><pre><code class="bash hljs">pip install yoyo-migrations</code> </pre> <br><p>  Als N√§chstes werden alle Migrationsverwaltungsarbeiten mit der ausf√ºhrbaren Datei yoyo ausgef√ºhrt </p><br><pre> <code class="bash hljs">yoyo new ./migrations -m <span class="hljs-string"><span class="hljs-string">"Add column to foo"</span></span></code> </pre> <br><p>  Der Befehl erstellt eine Datei, in die Sie eine oder mehrere Anweisungen zum Migrieren des Schemas eingeben k√∂nnen </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> yoyo <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> step steps = [ step(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE foo (id INT, bar VARCHAR(20), PRIMARY KEY (id))"</span></span>, <span class="hljs-string"><span class="hljs-string">"DROP TABLE foo"</span></span>), ]</code> </pre> <br><p>  Nach dieser Migration k√∂nnen Sie zur Basis rollen </p><br><pre> <code class="bash hljs">yoyo apply --database postgresql://scott:tiger@localhost/db ./migrations</code> </pre> <br><p>  Alles ist einfach, wie Protokolle.  Gleichzeitig haben Sie die vollst√§ndige Kontrolle dar√ºber, wie die Datenbank aussieht. </p><br><p>  Dieser Ansatz hat zwei Nachteile. </p><br><ul><li>  Auf die Felder in den Tabellen und ihre Parameter m√ºssen Handles folgen.  Jede √Ñnderung f√ºhrt dazu, dass Sie <strong>ALTER TABLE</strong> selbst schreiben m√ºssen. Die M√∂glichkeit, alles mit einem Klick zu migrieren, geht verloren. </li><li>  Das Zusammenf√ºhren solcher Migrationen muss auch immer mit H√§nden und Kopf erfolgen.  Das ist nat√ºrlich √ºberfl√ºssige Arbeit.  In der Praxis sind Konflikte und komplexe Zusammenschl√ºsse von Migration jedoch selten. </li></ul><br><h2 id="peewee">  Peewee </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/465/7ca/2a7/4657ca2a7a5cfe5db0889b7569d953df.png" alt="Bild"></p><br><p>  Ein kleines und nicht das beliebteste ORM (obwohl hier schon mehr als einmal dar√ºber geschrieben wurde), das jedoch ein eigenes Publikum hat. <br>  Peewee wurde entwickelt, um der d√ºmmste und einfachste Wrapper f√ºr die Datenbank zu sein, mit dem verst√§ndlichsten Mechanismus zur Ausf√ºhrung von Abfragen und einfach zu lesendem Code. </p><br><pre> <code class="python hljs">Users.select().where( Users.user_id == user_id ).get()</code> </pre> <br><p>  Trotz seiner Einfachheit, seines Minimalismus und einer geringen Menge an Code verf√ºgt Peewee √ºber alles, was f√ºr eine vern√ºnftige Arbeit erforderlich ist. </p><br><ul><li>  Angemessene Leistung (obwohl nicht die schnellste Abfrageausf√ºhrungsgeschwindigkeit) </li><li>  Alle notwendigen Extras - verschiedene S√§tze von Feldern, Beziehungen zwischen Entit√§ten, Verbindungspools, S√§tze von Plugins und Erweiterungen. </li><li>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">peewee_async-</a> Modul eines Drittanbieters <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">f√ºgt</a> noch mehr oder weniger vern√ºnftige Asynchronit√§t hinzu. </li></ul><br><h2 id="pony-orm">  Pony orm </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pony</a> ist eine legend√§re H√ºlle.  Die mit diesem ORM geschriebene Datenbankschicht kann zeitweise die R√ºckseite anderer L√∂sungen beschleunigen.  Es gibt keine Magie in seiner Geschwindigkeit, es gibt eine sehr kompetente Richtlinie zum Zwischenspeichern von Anforderungen an die Datenbanken, jede Menge Optimierungen und Tricks mit dem Code.  Insgesamt f√ºhrt dies dazu, dass das Pony mit Pferdegeschwindigkeit br√§t. </p><br><p>  Das Minus kann in diesem ORM als Abfragesyntax bezeichnet werden - es ist sehr spezifisch und verwendet Generatoren, Lambdas und andere Python-Sprachbr√∂tchen. </p><br><pre> <code class="python hljs">query = select(c <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Customer <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sum(o.total_price <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> o <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c.orders) &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) Product.select().order_by(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> p: desc(sum(p.order_items.quantity))).first()</code> </pre> <br><p>  Dieser Ansatz erfordert einen gewissen Zusammenbruch des Gehirns. </p><br><h2 id="tortoise-orm">  Schildkr√∂te orm </h2><br><p><img src="https://habrastorage.org/webt/wx/hw/9k/wxhw9knyyo5zzbper-awdud2mwm.png"></p><br><p>  Als ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mich</a> mit verschiedenen tierfreundlichen Repos befasste, fand ich eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sammlung von Tests verschiedener ORMs</a> mit Geschwindigkeitsmessungen.  Zus√§tzlich zum bereits erw√§hnten Pony ORM erschien ein bestimmter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tortoise ORM</a> in der Liste der schnellsten.  Es ist klar, dass die Testergebnisse davon abh√§ngen, wer die Tests schreibt und wie sie dann ausgef√ºhrt werden, aber Sie m√ºssen sich diese Sache genauer ansehen. </p><br><p>  Tortoise ist ein relativ junges Projekt, das sich noch in der aktiven Entwicklung befindet.  Die gute Leistung dieser Bibliothek erkl√§rt sich aus der Tatsache, dass ORM nichts √úberfl√ºssiges enth√§lt und sofort f√ºr den asynchronen Betrieb eingesperrt ist.  Au√üerdem wird die Verwendung von <strong>uvloop vorausgesetzt</strong> , das schneller arbeitet als die nativen Piton-Zyklen von Ereignissen. </p><br><p>  Dieses ORM ist immer noch zu roh, um im Kampf verwendet zu werden (zum Beispiel bis Verbindungspools √ºberhaupt implementiert sind), aber Sie sollten sich die Entwicklung dieser Bibliothek ansehen.  Wenn alles gut mit den Entwicklern l√§uft, werden wir im kommenden Jahr einen wirklich schnellen Wrapper f√ºr die Datenbank mit guter Geschwindigkeit und ohne seltsame Syntax im Stil von Pony bekommen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460435/">https://habr.com/ru/post/de460435/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460421/index.html">Optischer TP-Link T2600G-28SQ-Switch f√ºr Dienstanbieter: Eine detaillierte √úberpr√ºfung</a></li>
<li><a href="../de460423/index.html">WAL in PostgreSQL: 3. Checkpoint</a></li>
<li><a href="../de460425/index.html">H√∂llenk√§lte, Levitation und Plasma: Vergangenheit, Gegenwart und Zukunft der Supraleitung</a></li>
<li><a href="../de460431/index.html">Erstellen einer automatisierten Testpipeline auf Azure DevOps</a></li>
<li><a href="../de460433/index.html">Risiken und Bedrohungen im Internet der Dinge</a></li>
<li><a href="../de460437/index.html">Wie wir ein technisches Support-Fahrrad herausbringen</a></li>
<li><a href="../de460439/index.html">Programmiersprache P4</a></li>
<li><a href="../de460441/index.html">Gleb Nitzman: ‚ÄûIch fand das Ende einer √Ñra, in der die Menschen das in Radioelementen enthaltene Gold noch nicht gejagt hatten.‚Äú</a></li>
<li><a href="../de460443/index.html">Designer gegen Entwickler: √úber die Entstehungsgeschichte der Anwendung ‚ÄûMy Smart City‚Äú</a></li>
<li><a href="../de460445/index.html">Vorlesung "Grundlagen der digitalen Signalverarbeitung"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>