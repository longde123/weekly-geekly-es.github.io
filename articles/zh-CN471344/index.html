<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’ ğŸ“Œ â„¹ï¸ å†æ¬¡å…³äºJavaä¸­çš„ImmutableList ğŸ¥Ÿ ğŸ¤š ğŸ–¼ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æˆ‘ä»¥å‰çš„æ–‡ç« â€œ ç”¨Javaæ©ç›–ImmutableListâ€ä¸­ï¼Œæˆ‘æå‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè§£å†³äº†Javaä¸­ä¸å­˜åœ¨ä¸å¯å˜åˆ—è¡¨çš„é—®é¢˜ï¼Œåœ¨Javaä¸­æ— è®ºç°åœ¨è¿˜æ˜¯ç°åœ¨éƒ½ä¸æ˜¯å›ºå®šçš„ã€‚ 


 ç„¶åï¼Œä»…åœ¨â€œæœ‰è¿™æ ·ä¸€ä¸ªæƒ³æ³•â€çš„çº§åˆ«ä¸Šåˆ¶å®šè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”ä»£ç ä¸­çš„å®ç°æ­ªæ›²äº†ï¼Œå› æ­¤ä¸€åˆ‡éƒ½è¢«æ€€ç–‘äº†ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æå‡ºäº†ä¸€ç§æ”¹è¿›...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å†æ¬¡å…³äºJavaä¸­çš„ImmutableList</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471344/"><p> åœ¨æˆ‘ä»¥å‰çš„æ–‡ç« â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”¨Javaæ©ç›–ImmutableListâ€ä¸­ï¼Œ</a>æˆ‘æå‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè§£å†³äº†Javaä¸­ä¸å­˜åœ¨ä¸å¯å˜åˆ—è¡¨çš„é—®é¢˜ï¼Œåœ¨Javaä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ— è®ºç°åœ¨è¿˜æ˜¯ç°åœ¨éƒ½ä¸</a>æ˜¯å›ºå®šçš„ã€‚ </p><br><p> ç„¶åï¼Œä»…åœ¨â€œæœ‰è¿™æ ·ä¸€ä¸ªæƒ³æ³•â€çš„çº§åˆ«ä¸Šåˆ¶å®šè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”ä»£ç ä¸­çš„å®ç°æ­ªæ›²äº†ï¼Œå› æ­¤ä¸€åˆ‡éƒ½è¢«æ€€ç–‘äº†ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æå‡ºäº†ä¸€ç§æ”¹è¿›çš„è§£å†³æ–¹æ¡ˆã€‚ ä½¿ç”¨çš„é€»è¾‘å’ŒAPIå·²è¾¾åˆ°å¯æ¥å—çš„æ°´å¹³ã€‚ åœ¨ä»£ç ä¸­çš„å®ç°è¾¾åˆ°betaçº§ã€‚ </p><a name="habracut"></a><br><h2 id="postanovka-zadachi"> é—®é¢˜é™ˆè¿° </h2><br><p>æˆ‘ä»¬å°†ä½¿ç”¨åŸå§‹æ–‡ç« ä¸­çš„å®šä¹‰ã€‚ ç‰¹åˆ«æ˜¯ï¼Œè¿™æ„å‘³ç€<code>ImmutableList</code>æ˜¯å¯¹æŸäº›å¯¹è±¡çš„å¼•ç”¨çš„ä¸å¯å˜åˆ—è¡¨ã€‚ å¦‚æœäº‹å®è¯æ˜è¿™äº›å¯¹è±¡ä¸æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå°½ç®¡åç§°å¦‚æ­¤ï¼Œåˆ—è¡¨ä¹Ÿå°†ä¸æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡ã€‚ å®é™…ä¸Šï¼Œè¿™ä¸å¤ªå¯èƒ½ä¼¤å®³ä»»ä½•äººï¼Œä½†æ˜¯ä¸ºäº†é¿å…ä¸åˆç†çš„æœŸæœ›ï¼Œæœ‰å¿…è¦æä¸€ä¸‹ã€‚ </p><br><p> åŒæ ·å¾ˆæ˜æ˜¾ï¼Œå¯ä»¥é€šè¿‡åå°„æˆ–åœ¨åŒä¸€åŒ…ä¸­åˆ›å»ºè‡ªå·±çš„ç±»ï¼Œç„¶åå¼¹å‡ºåˆ—è¡¨çš„å—ä¿æŠ¤å­—æ®µæˆ–ç±»ä¼¼çš„æ–¹å¼æ¥â€œç ´åâ€åˆ—è¡¨çš„ä¸å˜æ€§ã€‚ </p><br><p> ä¸åŸå§‹æ–‡ç« ä¸åŒï¼Œæˆ‘ä»¬ä¸ä¼šåšæŒâ€œå…¨æœ‰æˆ–å…¨æ— â€çš„åŸåˆ™ï¼šé‚£é‡Œçš„ä½œè€…ä¼¼ä¹è®¤ä¸ºï¼Œå¦‚æœä¸èƒ½åœ¨JDKçº§åˆ«è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä»€ä¹ˆä¹Ÿä¸åšã€‚  ï¼ˆå®é™…ä¸Šï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œâ€œæ— æ³•è§£å†³â€æˆ–â€œ Javaä½œè€…ä¸å¸Œæœ›è§£å†³å®ƒã€‚â€åœ¨æˆ‘çœ‹æ¥ï¼Œé€šè¿‡æ·»åŠ å…¶ä»–æ¥å£ï¼Œç±»å’Œæ–¹æ³•æ¥ä½¿ç°æœ‰é›†åˆæ›´æ¥è¿‘ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½çš„ã€‚æ‰€éœ€çš„å¤–è§‚ï¼Œè™½ç„¶æ¯”æ‚¨ç«‹å³æƒ³åˆ°çš„å¤–è§‚è¦æ¼‚äº®ï¼Œä½†ç°åœ¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚ï¼‰ </p><br><p> æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¯ä»¥ä¸Javaç°æœ‰é›†åˆæˆåŠŸå…±å­˜çš„åº“ã€‚ </p><br><p> å›¾ä¹¦é¦†çš„ä¸»è¦æ€æƒ³ï¼š </p><br><ul><li> æœ‰<code>ImmutableList</code>å’Œ<code>MutableList</code> ã€‚ é€šè¿‡å¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Œä¸å¯èƒ½ä»å¦ä¸€ä¸ªä¸­è·å–ä¸€ä¸ªã€‚ </li><li> åœ¨æˆ‘ä»¬è¦ä½¿ç”¨åº“è¿›è¡Œæ”¹è¿›çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸¤ä¸ªæ¥å£ä¹‹ä¸€æ›¿æ¢äº†æ‰€æœ‰<code>List</code> ã€‚ å¦‚æœåœ¨æŸä¸ªæ—¶å€™æ‚¨ä¸èƒ½æ²¡æœ‰<code>List</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†åœ¨ç¬¬ä¸€ä¸ªæœºä¼šå°†<code>List</code>ä»/è½¬æ¢ä¸ºä¸¤ä¸ªæ¥å£ä¹‹ä¸€ã€‚ è¿™åŒæ ·é€‚ç”¨äºä½¿ç”¨<code>List</code>æ¥æ”¶/ä¼ è¾“æ•°æ®åˆ°ç¬¬ä¸‰æ–¹åº“çš„æ—¶åˆ»ã€‚ </li><li>  <code>ImmutableList</code> ï¼Œ <code>MutableList</code> ï¼Œ <code>List</code>ä¹‹é—´çš„ç›¸äº’è½¬æ¢åº”å°½å¿«æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œä¸å¤åˆ¶åˆ—è¡¨ï¼‰ã€‚ æ²¡æœ‰â€œä¾¿å®œçš„â€å¾€è¿”è½¬æ¢ï¼Œæ•´ä¸ªæƒ³æ³•å°±å¼€å§‹å˜å¾—å¯ç–‘ã€‚ </li></ul><br><p> åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œä»…è€ƒè™‘åˆ—è¡¨ï¼Œå› ä¸ºç›®å‰ä»…åœ¨åº“ä¸­å®ç°å®ƒä»¬ã€‚ ä½†æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢åº“å¯¹<code>Set</code>å’Œ<code>Map</code>è¡¥å……ã€‚ </p><br><h2 id="api">  API </h2><br><h3 id="immutablelist"> ä¸å¯å˜åˆ—è¡¨ </h3><br><p>  <code>ImmutableList</code>æ˜¯<code>ReadOnlyList</code>çš„åç»§è€…ï¼ˆä¸ä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œ <code>ReadOnlyList</code>æ˜¯ä¸€ä¸ªå¤åˆ¶çš„<code>List</code>æ¥å£ï¼Œä»ä¸­æŠ›å‡ºæ‰€æœ‰å˜å¼‚æ–¹æ³•ï¼‰ã€‚ æ·»åŠ çš„æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">List&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contentEquals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;? extends E&gt; iterable)</span></span></span></span>;</code> </pre> <br><p>  <code>toList</code>æ–¹æ³•æä¾›äº†å°†<code>ImmutableList</code>ä¼ é€’ç»™ç­‰å¾…<code>List</code>çš„ä»£ç æ®µçš„åŠŸèƒ½ã€‚ è¿”å›ä¸€ä¸ªåŒ…è£…å™¨ï¼Œæ‰€æœ‰ä¿®æ”¹æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ª<code>UnsupportedOperationException</code> ï¼Œç„¶åå°†å…¶ä½™æ–¹æ³•é‡å®šå‘åˆ°åŸå§‹<code>ImmutableList</code> ã€‚ </p><br><p>  <code>mutable</code>æ–¹æ³•å°†<code>ImmutableList</code>è½¬æ¢ä¸º<code>MutableList</code> ã€‚ è¿”å›åŒ…è£…å™¨ï¼Œåœ¨è¯¥åŒ…è£…å™¨ä¸­ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½å°†é‡å®šå‘åˆ°åŸå§‹<code>ImmutableList</code>ç›´åˆ°è¿›è¡Œç¬¬â€‹â€‹ä¸€æ¬¡æ›´æ”¹ã€‚ æ›´æ”¹ä¹‹å‰ï¼Œå°†åŒ…è£…ä¸åŸå§‹<code>ImmutableList</code> ï¼Œå°†å…¶å†…å®¹å¤åˆ¶åˆ°å†…éƒ¨<code>ArrayList</code> ï¼Œç„¶åå°†æ‰€æœ‰æ“ä½œé‡å®šå‘åˆ°è¯¥å†…éƒ¨ã€‚ </p><br><p>  <code>contentEquals</code>æ–¹æ³•ç”¨äºå°†åˆ—è¡¨çš„å†…å®¹ä¸ä¼ é€’çš„ä»»æ„<code>Iterable</code>çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒï¼ˆå½“ç„¶ï¼Œæ­¤æ“ä½œä»…å¯¹å…·æœ‰æŸäº›ä¸åŒå…ƒç´ é¡ºåºçš„<code>Iterable</code>å®ç°æœ‰æ„ä¹‰ã€‚ï¼‰ </p><br><p> è¯·æ³¨æ„ï¼Œåœ¨æˆ‘ä»¬çš„<code>ReadOnlyList</code>å®ç°ä¸­ï¼Œ <code>iterator</code>å’Œ<code>listIterator</code>è¿”å›æ ‡å‡†<code>java.util.Iterator</code> / <code>java.util.ListIterator</code> ã€‚ è¿™äº›è¿­ä»£å™¨åŒ…å«ä¿®æ”¹æ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡æŠ›å‡º<code>UnsupportedOperationException</code>æ¥æŠ‘åˆ¶è¿™äº›ä¿®æ”¹æ–¹æ³•ã€‚ æœ€å¥½ä½¿ç”¨<code>ReadOnlyIterator</code> ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ç¼–å†™<code>for (Object item : immutableList)</code> ï¼Œè¿™å°†ç«‹å³ç ´åä½¿ç”¨è¯¥åº“çš„æ‰€æœ‰ä¹è¶£ã€‚ </p><br><h3 id="mutablelist"> å¯å˜åˆ—è¡¨ </h3><br><p>  <code>MutableList</code>æ˜¯å¸¸è§„<code>List</code>çš„åä»£ã€‚ æ·»åŠ çš„æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">releaseSnapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contentEquals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;? extends E&gt; iterable)</span></span></span></span>;</code> </pre> <br><p>  <code>snapshot</code>æ–¹æ³•æ—¨åœ¨å°†<code>MutableList</code>å½“å‰çŠ¶æ€çš„â€œå¿«ç…§â€ä½œä¸º<code>ImmutableList</code> ã€‚  â€œå¿«ç…§â€ä¿å­˜åœ¨<code>MutableList</code> ï¼Œå¦‚æœåœ¨ä¸‹ä¸€æ¬¡æ–¹æ³•è°ƒç”¨æ—¶çŠ¶æ€æœªæ›´æ”¹ï¼Œ <code>ImmutableList</code>çš„ç›¸åŒå®ä¾‹ã€‚ ç¬¬ä¸€æ¬¡è°ƒç”¨ä»»ä½•ä¿®æ”¹æ–¹æ³•æ—¶æˆ–è°ƒç”¨<code>releaseSnapshot</code>æ—¶ï¼Œå°†ä¸¢å¼ƒå­˜å‚¨åœ¨å…¶ä¸­çš„â€œå¿«ç…§â€ã€‚ å¦‚æœæ‚¨ç¡®å®šæ²¡æœ‰äººéœ€è¦â€œå¿«ç…§â€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>releaseSnapshot</code>æ–¹æ³•æ¥èŠ‚çœå†…å­˜ï¼Œä½†æ˜¯ä¸ä¼šå¾ˆå¿«è°ƒç”¨ä¿®æ”¹æ–¹æ³•ã€‚ </p><br><h3 id="mutabor">  Mutabor </h3><br><p>  <code>Mutabor</code>ç±»æä¾›äº†ä¸€ç»„é™æ€æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ˜¯åº“çš„â€œå…¥å£â€ã€‚ </p><br><p> æ˜¯çš„ï¼Œè¯¥é¡¹ç›®ç°åœ¨è¢«ç§°ä¸ºâ€œ mutaborâ€ï¼ˆä¸â€œ mutableâ€ç›¸è¾…ç›¸æˆï¼Œåœ¨ç¿»è¯‘ä¸­æ„ä¸ºâ€œæˆ‘å°†è½¬å‹â€ï¼Œè¿™ä¸å°†æŸäº›ç±»å‹çš„é¦†è—å¿«é€Ÿâ€œè½¬åŒ–â€ä¸ºå…¶ä»–ç±»å‹çš„æƒ³æ³•éå¸¸ä¸€è‡´ï¼‰ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E[] original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToMutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToMutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;E&gt; original)</span></span></span></span>;</code> </pre> <br><p>  <code>copyTo*</code>æ–¹æ³•æ—¨åœ¨é€šè¿‡å¤åˆ¶æä¾›çš„æ•°æ®æ¥åˆ›å»ºé€‚å½“çš„é›†åˆã€‚  <code>convertTo*</code>æ–¹æ³•<code>convertTo*</code>å°†ä¼ è¾“çš„é›†åˆå¿«é€Ÿè½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ï¼Œå¦‚æœæ— æ³•å¿«é€Ÿè½¬æ¢ï¼Œåˆ™æ‰§è¡Œæ…¢é€Ÿå¤åˆ¶ã€‚ å¦‚æœå¿«é€Ÿè½¬æ¢æˆåŠŸï¼Œåˆ™åŸå§‹é›†åˆå°†è¢«æ¸…é™¤ï¼Œå¹¶å‡å®šå°†æ¥ä¸ä¼šä½¿ç”¨å®ƒï¼ˆå°½ç®¡å¯ä»¥ï¼Œä½†è¿™å‡ ä¹æ²¡æœ‰é“ç†ï¼‰ã€‚ </p><br><p> å¯¹<code>ImmutableList</code> / <code>MutableList</code>å®ç°<code>ImmutableList</code>çš„æ„é€ å‡½æ•°çš„è°ƒç”¨<code>MutableList</code>éšè—çš„ã€‚ å‡å®šç”¨æˆ·ä»…å¤„ç†æ¥å£ï¼Œä»–ä¸åˆ›å»ºæ­¤ç±»å¯¹è±¡ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸Šè¿°æ–¹æ³•è½¬æ¢é›†åˆã€‚ </p><br><h2 id="detali-realizacii"> å®æ–½ç»†èŠ‚ </h2><br><h3 id="immutablelistimpl">  ImmutableListImpl </h3><br><p> å°è£…å¯¹è±¡æ•°ç»„ã€‚ è¯¥å®ç°å¤§è‡´ä¸<code>ArrayList</code>å®ç°ç›¸å¯¹åº”ï¼Œä»ä¸­æŠ›å‡ºæ‰€æœ‰ä¿®æ”¹æ–¹æ³•å’Œå¹¶å‘ä¿®æ”¹æ£€æŸ¥ã€‚ </p><br><p>  <code>toList</code>å’Œ<code>contentEquals</code>ä¹Ÿå¾ˆç®€å•ã€‚  <code>toList</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…è£…å™¨ï¼Œè¯¥åŒ…è£…å™¨å°†è°ƒç”¨é‡å®šå‘åˆ°ç»™å®šçš„<code>ImmutableList</code> ï¼›ä¸ä¼šå‘ç”Ÿæ•°æ®çš„æ…¢é€Ÿå¤åˆ¶ã€‚ </p><br><p>  <code>mutable</code>æ–¹æ³•è¿”å›åŸºäºæ­¤<code>ImmutableList</code>åˆ›å»ºçš„<code>MutableListImpl</code> ã€‚ åœ¨æ¥æ”¶åˆ°çš„<code>MutableList</code>ä¸Šè°ƒç”¨ä»»ä½•ä¿®æ”¹æ–¹æ³•ä¹‹å‰ï¼Œä¸ä¼šå‘ç”Ÿæ•°æ®å¤åˆ¶ã€‚ </p><br><h3 id="mutablelistimpl">  MutableListImpl </h3><br><p> å°è£…æŒ‡å‘<code>ImmutableList</code>å’Œ<code>List</code>é“¾æ¥ã€‚ åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå§‹ç»ˆä»…å¡«å……è¿™ä¸¤ä¸ªé“¾æ¥ä¹‹ä¸€ï¼Œå¦ä¸€ä¸ªä¿æŒä¸º<code>null</code> ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> ImmutableList&lt;E&gt; immutable; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> List&lt;E&gt; list;</code> </pre> <br><p> ä¸å¯å˜æ–¹æ³•å°†è°ƒç”¨é‡å®šå‘åˆ°<code>ImmutableList</code>å¦‚æœå®ƒä¸ä¸º<code>null</code> ï¼Œå¦åˆ™é‡å®šå‘åˆ°<code>List</code> ã€‚ </p><br><p> åˆå§‹åŒ–åï¼Œä¿®æ”¹æ–¹æ³•ä¼šå°†è°ƒç”¨é‡å®šå‘åˆ°<code>List</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(immutable.toList()); } immutable = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br><p>  <code>snapshot</code>æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immutable != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> immutable; } immutable = InternalUtils.convertToImmutableList(list); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immutable != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    //   ,  . //     immutable     . list = null; return immutable; } immutable = InternalUtils.copyToImmutableList(list); return immutable; }</span></span></code> </pre> <br><p>  <code>releaseSnapshot</code>å’Œ<code>contentEquals</code>ç®€å•ã€‚ </p><br><p> è¿™ç§æ–¹æ³•ä½¿æ‚¨å¯ä»¥åœ¨â€œå¸¸è§„â€ä½¿ç”¨æœŸé—´æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ•°æ®å‰¯æœ¬çš„æ•°é‡ï¼Œä»è€Œç”¨å¿«é€Ÿè½¬æ¢æ›¿æ¢å‰¯æœ¬ã€‚ </p><br><h3 id="bystroe-preobrazovanie-spiskov"> å¿«é€Ÿåˆ—è¡¨è½¬æ¢ </h3><br><p>  <code>ArrayList</code>æˆ–<code>Arrays$ArrayList</code>ç±»ï¼ˆ <code>Arrays.asList()</code>æ–¹æ³•çš„ç»“æœ<code>Arrays.asList()</code>å¯ä»¥è¿›è¡Œå¿«é€Ÿè½¬æ¢ã€‚ å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¢°å·§å°±æ˜¯è¿™äº›ç±»ã€‚ </p><br><p> è¿™äº›ç±»ä¸­åŒ…å«ä¸€ä¸ªå…ƒç´ æ•°ç»„ã€‚ å¿«é€Ÿè½¬æ¢çš„æœ¬è´¨æ˜¯é€šè¿‡åå°„è·å–å¯¹æ­¤æ•°ç»„çš„å¼•ç”¨ï¼ˆè¿™æ˜¯ä¸€ä¸ªç§æœ‰å­—æ®µï¼‰ï¼Œå¹¶ç”¨å¯¹ç©ºæ•°ç»„çš„å¼•ç”¨æ›¿æ¢å®ƒã€‚ è¿™æ ·å¯ä»¥ç¡®ä¿å¯¹æ•°ç»„çš„å”¯ä¸€å¼•ç”¨ä¿ç•™åœ¨æˆ‘ä»¬çš„å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”æ•°ç»„ä¿æŒä¸å˜ã€‚ </p><br><p> åœ¨è¯¥åº“çš„å…ˆå‰ç‰ˆæœ¬ä¸­ï¼Œé›†åˆç±»å‹çš„å¿«é€Ÿè½¬æ¢é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°æ¥æ‰§è¡Œã€‚ åŒæ—¶ï¼ŒåŸå§‹çš„æ”¶é›†å¯¹è±¡å˜åäº†ï¼ˆå®ƒå˜å¾—ä¸é€‚åˆè¿›ä¸€æ­¥ä½¿ç”¨ï¼‰ï¼Œè¿™æ˜¯æ‚¨åœ¨ä¸çŸ¥ä¸è§‰ä¸­ä¸å¸Œæœ›è®¾è®¡å¸ˆçœ‹åˆ°çš„ã€‚ ç°åœ¨ï¼Œä½¿ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„é™æ€æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼ŒåŸå§‹é›†åˆä¸ä¼šå˜è´¨ï¼Œåªæ˜¯è¢«æ¸…é™¤äº†ã€‚ å› æ­¤ï¼Œæ¶ˆé™¤äº†ä»¤äººææƒ§çš„å¼‚å¸¸è¡Œä¸ºã€‚ </p><br><h3 id="problemy-s-equals--hashcode">  equals / hashCodeé—®é¢˜ </h3><br><p>  Javaé›†åˆä½¿ç”¨ä¸€ç§éå¸¸å¥‡æ€ªçš„æ–¹æ³•æ¥å®ç°<code>equals</code>å’Œ<code>hashCode</code>æ–¹æ³•ã€‚ </p><br><p> æ¯”è¾ƒæ˜¯æ ¹æ®å†…å®¹æ‰§è¡Œçš„ï¼Œè¿™ä¼¼ä¹æ˜¯åˆä¹é€»è¾‘çš„ï¼Œä½†æ˜¯æœªè€ƒè™‘åˆ—è¡¨æœ¬èº«çš„ç±»åˆ«ã€‚ å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå…·æœ‰ç›¸åŒå†…å®¹çš„<code>ArrayList</code>å’Œ<code>LinkedList</code>å°†<code>equals</code> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">è¿™æ˜¯AbstractListçš„equals / hashCodeå®ç°ï¼ˆç»§æ‰¿ArrayListï¼‰</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(o <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> List)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ListIterator&lt;E&gt; e1 = listIterator(); ListIterator e2 = ((List) o).listIterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (e1.hasNext() &amp;&amp; e2.hasNext()) { E o1 = e1.next(); Object o2 = e2.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(o1==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? o2==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : o1.equals(o2))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !(e1.hasNext() || e2.hasNext()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hashCode = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (E e : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) hashCode = <span class="hljs-number"><span class="hljs-number">31</span></span>*hashCode + (e==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : e.hashCode()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashCode; }</code> </pre> </div></div><br><p> å› æ­¤ï¼Œç°åœ¨ç»å¯¹éœ€è¦æ‰€æœ‰<code>List</code>å®ç°éƒ½å…·æœ‰ç›¸ä¼¼çš„<code>equals</code>å®ç°ï¼ˆå› æ­¤ï¼Œæ˜¯<code>hashCode</code> ï¼‰ã€‚ å¦åˆ™ï¼Œæ‚¨ä¼šé‡åˆ°<code>a.equals(b) &amp;&amp; !b.equals(a)</code>ä¸å¥½çš„æƒ…å†µã€‚  <code>Set</code>å’Œ<code>Map</code>æƒ…å†µä¸æ­¤ç±»ä¼¼ã€‚ </p><br><p> åœ¨è¯¥åº“çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™æ„å‘³ç€<code>equals</code>å’Œ<code>hashCode</code> for <code>MutableList</code>é¢„å®šä¹‰çš„ï¼Œå¹¶ä¸”åœ¨è¿™ç§å®ç°ä¸­ï¼Œå…·æœ‰ç›¸åŒå†…å®¹çš„<code>ImmutableList</code>å’Œ<code>MutableList</code>ä¸èƒ½<code>equals</code> ï¼ˆå› ä¸º<code>ImmutableList</code>ä¸æ˜¯<code>List</code> ï¼‰ã€‚ å› æ­¤ï¼Œæ·»åŠ äº†<code>contentEquals</code>æ–¹æ³•æ¥æ¯”è¾ƒå†…å®¹ã€‚ </p><br><p> ä½¿<code>ImmutableList</code>çš„<code>equals</code>å’Œ<code>hashCode</code>æ–¹æ³•çš„å®ç°ä¸<code>AbstractList</code>çš„ç‰ˆæœ¬å®Œå…¨ç›¸ä¼¼ï¼Œä½†ç”¨<code>ReadOnlyList</code>æ›¿æ¢<code>List</code> ã€‚ </p><br><h2 id="itogo"> åˆè®¡ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åº“çš„æºä»£ç å’Œæµ‹è¯•</a>ä»¥Mavené¡¹ç›®çš„å½¢å¼<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡å¼•ç”¨å‘å¸ƒ</a> ã€‚ </p><br><p> å¦‚æœæœ‰äººè¦ä½¿ç”¨è¯¥åº“ï¼Œä»–å·²ç»åˆ›å»ºäº†ä¸€ä¸ªâ€œåé¦ˆâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è”ç³»äººç»„</a> ã€‚ </p><br><p> ä½¿ç”¨è¯¥åº“éå¸¸æ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myBusinessProcess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Entity&gt; tempFromDb = queryEntitiesFromDatabase(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM my_table"</span></span>); ImmutableList&lt;Entity&gt; fromDb = Mutabor.convertToImmutableList(tempFromDb); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromDb.isEmpty() || !someChecksPassed(fromDb)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//... MutableList&lt;Entity&gt; list = fromDb.mutable(); //time to change list.remove(1); ImmutableList&lt;Entity&gt; processed = list.snapshot(); //time to change ended //... if (!callSideLibraryExpectsListParameter(processed.toList())) { return false; } for (Entity entity : processed) { outputToUI(entity); } return true; }</span></span></code> </pre> <br><p> ç¥å¤§å®¶å¥½è¿ï¼ å‘é€é”™è¯¯æŠ¥å‘Šï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471344/">https://habr.com/ru/post/zh-CN471344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471332/index.html">æœˆçƒè®¡ç®—æœºçš„æ•…äº‹ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN471334/index.html">è®°ä½è€Œä¸æ˜¯è¡¥ä¹ -é€šè¿‡å¡ç‰‡å­¦ä¹ </a></li>
<li><a href="../zh-CN471336/index.html">éœåˆ©ç“¦å°” å•å†…ç‰¹çš„å†å²ã€‚ ç¬¬6éƒ¨åˆ†ã€‚é”ï¼šæ½œä¼ï¼Œç£å¸¦ï¼Œ282ndå’Œä¸­æ–‡è·¯å¾„</a></li>
<li><a href="../zh-CN471340/index.html">Drimsim vs Mate 20ä¸“ä¸šèµ›ï¼ ä½†æ˜¯å¯¹äºè°å‘¢ï¼Ÿ</a></li>
<li><a href="../zh-CN471342/index.html">æ—¶å°šçš„é˜¿ç“¦éš†</a></li>
<li><a href="../zh-CN471346/index.html">ä¸Šå‘¨ç¬¬384æœŸï¼ˆ2019å¹´10æœˆ7æ—¥è‡³13æ—¥ï¼‰æ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦</a></li>
<li><a href="../zh-CN471350/index.html">1969å¹´é€šè¿‡æ¨¡æ‹Ÿè®¡ç®—æœºå¯¹ä½å™ªå£°è¿ç®—æ”¾å¤§å™¨è¿›è¡Œé€†å‘å·¥ç¨‹</a></li>
<li><a href="../zh-CN471352/index.html">åœ¨LaTeXä¸­ç¼–å†™æ¼”ç¤ºæ–‡ç¨¿</a></li>
<li><a href="../zh-CN471358/index.html">å¦‚ä½•ä½¿ç”¨Python on Ontologyç¼–å†™æ™ºèƒ½åˆçº¦ï¼Ÿ ç¬¬4éƒ¨åˆ†ï¼šæœ¬æœºAPI</a></li>
<li><a href="../zh-CN471360/index.html">å¤åˆ¶æ–¹æ³•ã€‚ ICEè®¾è®¡çš„11ä¸ªç¤ºä¾‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>