<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≥üèø üßëüèø‚Äçü§ù‚Äçüßëüèø ‚öîÔ∏è Passer √† Kotlin dans un projet Android: trucs et astuces üò™ üöó üßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publi√© par Sergey Yeshin, Strong Middle Android Developer, DataArt 

 Plus d'un an et demi s'est √©coul√© depuis que Google a annonc√© le support officie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Passer √† Kotlin dans un projet Android: trucs et astuces</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/433074/"><img src="https://habrastorage.org/webt/ss/no/sd/ssnosdopahysny9zaa0gevj_u54.jpeg"><br>  <i>Publi√© par Sergey Yeshin, Strong Middle Android Developer, DataArt</i> <br><br>  Plus d'un an et demi s'est √©coul√© depuis que Google a annonc√© le support officiel de Kotlin dans Android, et les d√©veloppeurs les plus aguerris ont commenc√© √† l'exp√©rimenter dans leur combat et pas dans les projets il y a plus de trois ans. <br><br>  La nouvelle langue a √©t√© chaleureusement accueillie dans la communaut√© Android, et la grande majorit√© des nouveaux projets Android commencera avec Kotlin √† bord.  Il est √©galement important que Kotlin compile dans un bytecode JVM, par cons√©quent, est enti√®rement compatible avec Java.  Ainsi, dans les projets Android existants √©crits en Java, il y a aussi une opportunit√© (d'ailleurs, un besoin) d'utiliser toutes les fonctionnalit√©s de Kotlin, gr√¢ce auxquelles il a gagn√© tant de fans. <br><br>  Dans l'article, je vais parler de l'exp√©rience de la migration d'une application Android de Java vers Kotlin, des difficult√©s qui ont d√ª √™tre surmont√©es dans le processus, et expliquer pourquoi tout cela n'a pas √©t√© vain.  L'article est principalement destin√© aux d√©veloppeurs Android qui commencent tout juste √† apprendre Kotlin et, en plus de son exp√©rience personnelle, s'appuie sur des documents d'autres membres de la communaut√©. <a name="habracut"></a><br><br><h2>  Pourquoi Kotlin? </h2><br>  D√©crivez bri√®vement les fonctionnalit√©s de Kotlin, √† cause desquelles je suis pass√© √† lui dans le projet, laissant le monde Java "confortable et douloureusement familier": <br><br><ol><li>  Compatibilit√© Java compl√®te </li><li>  S√©curit√© nulle </li><li>  Inf√©rence de type </li><li>  M√©thodes d'extension </li><li>  Fonctionne comme objets de premi√®re classe et lambda </li><li>  G√©n√©riques </li><li>  Coroutines </li><li>  Aucune exception v√©rifi√©e </li></ol><br><h2>  Application DISCO </h2><br>  Il s'agit d'une application de petite taille pour l'√©change de cartes de r√©duction, compos√©e de 10 √©crans.  En utilisant son exemple, nous consid√©rerons la migration. <br><br><h3>  En bref sur l'architecture </h3><br>  L'application utilise l'architecture MVVM avec les composants d'architecture Google sous le capot: ViewModel, LiveData, Room. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oe/n1/e4/oen1e4fepl7q4ff8zdth-jxwjlk.png"></div><br>  De plus, selon les principes de Clean Architecture d'Oncle Bob, j'ai s√©lectionn√© 3 couches dans l'application: donn√©es, domaine et pr√©sentation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/em/o4/rz/emo4rzbpvpeadmnhzucuyhhtzpq.png"></div><br>  Par o√π commencer?  Ainsi, nous imaginons les principales fonctionnalit√©s de Kotlin et avons une id√©e minimale du projet √† migrer.  La question naturelle est ¬´par o√π commencer?¬ª. <br><br>  La page officielle de la documentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prise en main de Kotlin</a> Android indique que si vous souhaitez porter une application existante sur Kotlin, il vous suffit de commencer √† √©crire des tests unitaires.  Lorsque vous acqu√©rez un peu d'exp√©rience avec ce langage, √©crivez un nouveau code dans Kotlin, il vous suffit de convertir le code Java existant. <br><br>  Mais il y a un ¬´mais¬ª.  En effet, une simple conversion permet g√©n√©ralement (mais pas toujours) d'obtenir un code de travail sur Kotlin, cependant, son idiome laisse beaucoup √† d√©sirer.  De plus, je vous dirai comment √©liminer cet √©cart en raison des caract√©ristiques mentionn√©es (et pas seulement) du langage Kotlin. <br><br><h2>  Migration de couche </h2><br>  √âtant donn√© que l'application est d√©j√† en couches, il est logique de migrer par couches, en commen√ßant par le haut. <br><br>  La s√©quence des couches pendant la migration est illustr√©e dans l'image suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kp/oq/k_/kpoqk_8rpc0xg9qstzecyrlp_is.png"></div><br>  Ce n'est pas un hasard si nous avons commenc√© la migration pr√©cis√©ment depuis la couche sup√©rieure.  Nous nous √©pargnons ainsi l'utilisation du code Kotlin dans le code Java.  Au contraire, nous faisons utiliser le code Kotlin de la couche sup√©rieure aux classes Java de la couche inf√©rieure.  Le fait est que Kotlin a √©t√© initialement con√ßu en tenant compte de la n√©cessit√© d'interagir avec Java.  Le code Java existant peut √™tre appel√© depuis Kotlin de mani√®re naturelle.  Nous pouvons facilement h√©riter des classes Java existantes, y acc√©der et appliquer des annotations Java aux classes et m√©thodes Kotlin.  Le code Kotlin peut √©galement √™tre utilis√© en Java sans trop de probl√®mes, mais cela prend souvent des efforts suppl√©mentaires, comme l'ajout d'une annotation JVM.  Mais pourquoi faire des conversions suppl√©mentaires en code Java si √† la fin il sera toujours r√©√©crit dans Kotlin? <br><br>  Pour un exemple, regardons la g√©n√©ration de surcharge. <br><br>  Habituellement, si vous √©crivez une fonction Kotlin avec des valeurs de param√®tres par d√©faut, elle ne sera visible en Java qu'en tant que signature compl√®te avec tous les param√®tres.  Si vous souhaitez fournir plusieurs surcharges aux appels Java, vous pouvez utiliser l'annotation @JvmOverloads: <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JvmOverloads</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@JvmOverloads</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: String, b: Int = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, c: String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"abc"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br>  Pour chaque param√®tre avec une valeur par d√©faut, cela cr√©era une surcharge suppl√©mentaire, qui a ce param√®tre et tous les param√®tres √† sa droite, dans la liste des param√®tres distants.  Dans cet exemple, les √©l√©ments suivants seront cr√©√©s: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Constructors: Foo(int x, double y) Foo(int x) // Methods void f(String a, int b, String c) { } void f(String a, int b) { } void f(String a) { }</span></span></code> </pre> <br>  Il existe de nombreux exemples d'utilisation d'annotations JVM pour le bon fonctionnement de Kotlin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cette page de documentation</a> d√©taille l'appel √† Kotlin depuis Java. <br><br>  Nous d√©crivons maintenant le processus de migration couche par couche. <br><br><h3>  Couche de pr√©sentation </h3><br>  Il s'agit d'une couche d'interface utilisateur qui contient des √©crans avec des vues et un ViewModel, √† son tour, contenant des propri√©t√©s sous la forme de LiveData avec des donn√©es du mod√®le.  Ensuite, nous examinons les astuces et les outils qui se sont r√©v√©l√©s utiles lors de la migration de cette couche d'application. <br><br><h4>  1. Processeur d'annotation Kapt </h4><br>  Comme avec n'importe quel MVVM, View est li√© aux propri√©t√©s ViewModel via la liaison de donn√©es.  Dans le cas d'Android, nous avons affaire √† la biblioth√®que Android Databind, qui utilise un traitement d'annotation.  Ainsi, Kotlin a <b>son propre processeur d'annotation</b> , et si vous n'apportez pas de modifications au fichier build.gradle correspondant, le projet s'arr√™tera de se construire.  Par cons√©quent, nous apporterons ces modifications: <br><br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-kapt'</span></span> android { dataBinding { enabled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } } dependencies { <span class="hljs-function"><span class="hljs-function">api </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'libs'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">///‚Ä¶ kapt "com.android.databinding:compiler:$android_plugin_version" }</span></span></span></span></code> </pre><br>  Il est important de se rappeler que vous devez remplacer compl√®tement toutes les occurrences de la configuration annotationProcessor dans votre build.gradle par kapt. <br><br>  Par exemple, si vous utilisez les biblioth√®ques Dagger ou Room dans le projet, qui utilisent √©galement le processeur d'annotation sous le capot pour la g√©n√©ration de code, vous devez sp√©cifier kapt comme processeur d'annotation. <br><br><h4>  2. Fonctions en ligne </h4><br>  Lorsque nous marquons une fonction comme √©tant en ligne, nous demandons au compilateur de la placer sur le lieu d'utilisation.  Le corps de la fonction s'encastre, en d'autres termes, il se substitue √† l'usage habituel de la fonction.  Gr√¢ce √† cela, nous pouvons contourner la restriction de l'effacement de type, c'est-√†-dire l'effacement d'un type.  Lorsque vous utilisez des fonctions en ligne, nous pouvons obtenir le type (classe) lors de l'ex√©cution. <br><br>  Cette fonctionnalit√© de Kotlin a √©t√© utilis√©e dans mon code pour ¬´extraire¬ª la classe de l'activit√© lanc√©e. <br><br><pre> <code class="scala hljs">inline fun &lt;reified <span class="hljs-type"><span class="hljs-type">T</span></span> : <span class="hljs-type"><span class="hljs-type">Activity</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Context</span></span>?.startActivity(args: <span class="hljs-type"><span class="hljs-type">Bundle</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> intent = <span class="hljs-type"><span class="hljs-type">Intent</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-type"><span class="hljs-type">T</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">intent</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">putExtras</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">args</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">it</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startActivity</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">intent</span></span></span><span class="hljs-class">) } }</span></span></code> </pre> <br>  r√©ifi√© - d√©signation d'un type r√©ifi√©. <br><br>  Dans l'exemple d√©crit ci-dessus, nous avons √©galement abord√© une telle fonctionnalit√© du langage Kotlin que les extensions. <br><br><h4>  3. Extensions </h4><br>  Ce sont des extensions.  Les m√©thodes utilitaires ont √©t√© supprim√©es dans les extensions, ce qui a permis d'√©viter les utilitaires de classe gonfl√©s et monstrueux. <br><br>  Je vais donner un exemple des extensions impliqu√©es dans l'application: <br><br><pre> <code class="scala hljs">fun <span class="hljs-type"><span class="hljs-type">Context</span></span>.inflate(res: <span class="hljs-type"><span class="hljs-type">Int</span></span>, parent: <span class="hljs-type"><span class="hljs-type">ViewGroup</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>): <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">LayoutInflater</span></span>.from(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).inflate(res, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } fun &lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Collection</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;?.isNotNullOrEmpty(): <span class="hljs-type"><span class="hljs-type">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; isNotEmpty(); } fun <span class="hljs-type"><span class="hljs-type">Fragment</span></span>.hideKeyboard() { view?.let { hideKeyboard(activity, it.windowToken) } }</code> </pre> <br>  Les d√©veloppeurs de Kotlin ont pens√© √† l'avance aux extensions Android utiles en proposant leur plugin Kotlin Android Extensions.  Parmi les fonctionnalit√©s qu'il propose, citons la reliure View et le support Parcelable.  Des informations d√©taill√©es sur les fonctionnalit√©s de ce plugin peuvent √™tre trouv√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h4>  4. Fonctions Lambda et fonctions d'ordre sup√©rieur </h4><br>  En utilisant les fonctions lambda dans le code Android, vous pouvez vous d√©barrasser du ClickListener et du rappel maladroits, qui en Java ont √©t√© impl√©ment√©s via des interfaces auto-√©crites. <br><br>  Un exemple d'utilisation d'un lambda au lieu de onClickListener: <br><br><pre> <code class="java hljs">button.setOnClickListener({ doSomething() })</code> </pre> <br>  Les lambdas sont √©galement utilis√©s dans les fonctions d'ordre sup√©rieur, par exemple, pour les fonctions de collecte. <br><br>  Prenons l'exemple de la <b>carte</b> : <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T, R&gt;</span></span></span><span class="hljs-function"> List</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(transform: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; R): List&lt;R&gt; {...}</code> </pre> <br>  Il y a un endroit dans mon code o√π j'ai besoin de "mapper" l'ID des cartes pour leur retrait ult√©rieur. <br><br>  En utilisant l'expression lambda pass√©e √† la carte, j'obtiens le tableau d'ID souhait√©: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ids = cards.map { it.id }.toIntArray() cardDao.deleteCardsByIds(ids)</code> </pre> <br>  Veuillez noter que les parenth√®ses peuvent √™tre omises du tout lors de l'appel de la fonction, si lambda est le seul argument et le mot-cl√© c'est le nom implicite du seul param√®tre. <br><br><h4>  5. Types de plateformes </h4><br>  Vous devrez in√©vitablement travailler avec des SDK √©crits en Java (y compris, en fait, le SDK Android).  Cela signifie que vous devez toujours √™tre sur vos gardes avec Kotlin et Java Interop tels que les types de plate-forme. <br><br>  Un type de plate-forme est un type pour lequel Kotlin ne peut pas trouver d'informations de validit√© nulles.  Le fait est que, par d√©faut, le code Java ne contient pas d'informations sur la validit√© de null et que les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">annotations NotNull</a> et @ Nullable ne sont pas toujours utilis√©es.  Lorsqu'il n'y a pas d'annotation correspondante en Java, le type devient plateforme.  Vous pouvez l'utiliser avec un type qui autorise null et un type qui n'autorise pas null. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zw/r_/cu/zwr_cuwc3ajqxcsezq1b0zqcwyw.png"></div><br>  Cela signifie que, tout comme en Java, le d√©veloppeur est enti√®rement responsable des op√©rations avec ce type.  Le compilateur n'ajoute pas un runtime de v√©rification nulle et vous permettra de tout faire. <br><br>  Dans l'exemple suivant, nous rempla√ßons onActivityResult dans notre activit√©: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(requestCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, resultCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Intent</span></span></span></span><span class="hljs-function"><span class="hljs-params">{ </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">super</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">onActivityResult</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">requestCode</span></span></span></span><span class="hljs-function"><span class="hljs-params">, resultCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> randomString = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.getStringExtra(<span class="hljs-string"><span class="hljs-string">"some_string"</span></span>) }</code> </pre> <br>  Dans ce cas, les donn√©es sont un type de plate-forme qui peut contenir null.  Cependant, du point de vue du code Kotlin, les donn√©es ne peuvent en aucun cas √™tre nul, et que vous sp√©cifiez le type d'intention comme nullable, vous ne recevrez pas d'avertissement ou d'erreur du compilateur, car les deux versions de la signature sont valides .  Mais comme la r√©ception de donn√©es non vides n'est pas garantie, car dans les cas avec le SDK, vous ne pouvez pas contr√¥ler cela, obtenir null dans ce cas conduira √† NPE. <br><br>  Aussi, √† titre d'exemple, nous pouvons lister les endroits suivants pour l'√©mergence possible de types de plateformes: <br><br><ol><li>  Service.onStartCommand (), o√π l'intention peut √™tre nulle. </li><li>  BroadcastReceiver.onReceive (). </li><li>  Activity.onCreate (), Fragment.onViewCreate () et d'autres m√©thodes similaires. </li></ol><br>  De plus, il arrive que les param√®tres de la m√©thode soient annot√©s, mais pour une raison quelconque, le studio perd la nullit√© lors de la g√©n√©ration d'un remplacement. <br><br><h3>  Couche de domaine </h3><br>  Cette couche comprend toute la logique m√©tier; elle est responsable de l'interaction entre la couche de donn√©es et la couche de pr√©sentation.  Le r√¥le cl√© ici est jou√© par le r√©f√©rentiel.  Dans Repository, nous effectuons les manipulations de donn√©es n√©cessaires, √† la fois c√¥t√© serveur et local.  A l'√©tage, vers la couche Pr√©sentation, nous ne donnons que la m√©thode d'interface Repository, qui masque la complexit√© des op√©rations de donn√©es. <br><br>  Comme indiqu√© ci-dessus, RxJava a √©t√© utilis√© pour la mise en ≈ìuvre. <br><br><h4>  1. RxJava </h4><br>  Kotlin est enti√®rement compatible avec RxJava et plus concis avec Java que Java.  Cependant, m√™me ici, j'ai d√ª faire face √† un probl√®me d√©sagr√©able.  Cela ressemble √† ceci: si vous passez un lambda comme param√®tre de la m√©thode <b>andThen</b> , ce lambda ne fonctionnera pas! <br><br>  Pour le v√©rifier, √©crivez simplement un test simple: <br><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Completable</span></span> .fromCallable { cardRepository.uploadDataToServer() } .andThen { cardRepository.markLocalDataAsSynced() } .subscribe()</code> </pre> <br>  <b>Et puis le</b> contenu √©chouera.  C'est le cas avec la plupart des op√©rateurs (comme <b>flatMap</b> , <b>defer</b> , <b>fromAction</b> et bien d'autres), vraiment lambda est attendu comme argument.  Et avec un tel enregistrement avec <b>andThen</b> , <b>Completable / Observable / SingleSource est attendu</b> .  Le probl√®me est r√©solu en utilisant des parenth√®ses ordinaires () au lieu de boucl√©s {}. <br><br>  Ce probl√®me est d√©crit en d√©tail dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Kotlin et Rx2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment j'ai perdu 5 heures √† cause de mauvais supports</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> <br><br><h4>  2. Restructuration </h4><br>  Nous abordons √©galement des syntaxes Kotlin int√©ressantes telles que la d√©structuration ou l' <i>affectation de la d√©structuration</i> .  Il vous permet d'affecter un objet √† plusieurs variables √† la fois, en le divisant en parties. <br><br>  Imaginez que nous avons une m√©thode dans l'API qui renvoie plusieurs entit√©s √† la fois: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/foo/api/sync"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBrandsAndCards</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Single&lt;BrandAndCardResponse&gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BrandAndCardResponse</span></span></span></span>(<span class="hljs-meta"><span class="hljs-meta">@SerializedName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cards"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards: List&lt;Card&gt;?, <span class="hljs-meta"><span class="hljs-meta">@SerializedName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"brands"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brands: List&lt;Brand&gt;?)</code> </pre><br>  Une m√©thode compacte pour renvoyer le r√©sultat de cette m√©thode est la d√©structuration, comme le montre l'exemple suivant: <br><br><pre> <code class="scala hljs">syncRepository.getBrandsAndCards() .flatMapCompletable {it-&gt; <span class="hljs-type"><span class="hljs-type">Completable</span></span>.fromAction{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (cards, brands) = it syncCards(cards) syncBrands(brands) } } }</code> </pre> <br>  Il convient de mentionner que les multi-d√©clarations sont bas√©es sur la convention: les classes qui sont cens√©es √™tre d√©truites doivent contenir des fonctions componentN (), o√π N est le num√©ro de composant correspondant - un membre de la classe.  Autrement dit, l'exemple ci-dessus se traduit par le code suivant: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards = it.component1() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brands = it.component2()</code> </pre> <br>  Notre exemple utilise une classe de donn√©es qui d√©clare automatiquement les fonctions componentN ().  Par cons√©quent, les multi-d√©clarations fonctionnent avec lui hors de la bo√Æte. <br><br>  Nous parlerons davantage de la classe de donn√©es dans la partie suivante, consacr√©e √† la couche Data. <br><br><h3>  Couche de donn√©es </h3><br>  Cette couche comprend POJO pour les donn√©es du serveur et de la base, des interfaces pour travailler avec les donn√©es locales et les donn√©es re√ßues du serveur. <br><br>  Pour travailler avec des donn√©es locales, nous avons utilis√© Room, qui nous fournit un wrapper pratique pour travailler avec la base de donn√©es SQLite. <br><br>  Le premier objectif de la migration, qui se sugg√®re, est les POJO, qui dans le code Java standard sont des classes en vrac avec de nombreux champs et leurs m√©thodes get / set correspondantes.  Vous pouvez rendre POJO plus concis √† l'aide des classes de donn√©es.  Une ligne de code sera suffisante pour d√©crire une entit√© √† plusieurs champs: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Card</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id:String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cardNumber:String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brandId:String,<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> barCode:String)</code> </pre><br>  En plus de la concision, nous obtenons: <br><br><ul><li>  Substitue les m√©thodes <b>equals ()</b> , <b>hashCode ()</b> et <b>toString ()</b> sous le capot.  La g√©n√©ration d'√©gaux pour toutes les propri√©t√©s de la classe de donn√©es est extr√™mement pratique lorsque vous utilisez DiffUtil dans un adaptateur qui g√©n√®re des vues pour RecyclerView.  Le fait est que DiffUtil compare deux ensembles de donn√©es, deux listes: l'ancien et le nouveau, d√©couvre les changements qui se sont produits et l'utilisation de m√©thodes de notification met √† jour de mani√®re optimale l'adaptateur.  Et g√©n√©ralement, les √©l√©ments de liste sont compar√©s en utilisant des √©gaux. <br><br>  Ainsi, apr√®s avoir ajout√© un nouveau champ √† la classe, nous n'avons pas besoin de l'ajouter √† √©gal pour que DiffUtil prenne en compte le nouveau champ. </li><li>  Classe immuable </li><li>  Prise en charge des valeurs par d√©faut, qui peuvent √™tre remplac√©es par l'utilisation du mod√®le Builder. <br><br>  Un exemple: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Card</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id : <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span> = <span class="hljs-number"><span class="hljs-number">0L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cardNumber: String=<span class="hljs-string"><span class="hljs-string">"99"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> barcode: String = <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> brandId: String=<span class="hljs-string"><span class="hljs-string">"1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newCard = Card(id =<span class="hljs-number"><span class="hljs-number">1L</span></span>,cardNumber = <span class="hljs-string"><span class="hljs-string">"123"</span></span>)</code> </pre> </li></ul><br>  Autre bonne nouvelle: avec kapt configur√© (comme d√©crit ci-dessus), les classes de donn√©es fonctionnent correctement avec les annotations de salle, ce qui vous permet de traduire toutes les entit√©s de base de donn√©es en classes de donn√©es.  Room prend √©galement en charge les propri√©t√©s nullables.  Certes, Room ne prend pas encore en charge les valeurs par d√©faut de Kotlin, mais le bogue correspondant a d√©j√† √©t√© institu√© pour cela. <br><br><h2>  Conclusions </h2><br>  Nous n'avons examin√© que quelques pi√®ges pouvant survenir lors de la migration de Java vers Kotlin.  Il est important que, bien que des probl√®mes surviennent, en particulier en raison d'un manque de connaissances th√©oriques ou d'exp√©rience pratique, ils soient tous r√©solubles. <br><br>  Cependant, le plaisir d'√©crire un code expressif concis et s√ªr dans Kotlin fera plus que payer toutes les difficult√©s qui se posent sur le chemin de transition.  Je peux dire avec confiance que l'exemple du projet DISCO le confirme certainement. <br><br><h3>  Livres, liens utiles, ressources </h3><br><ol><li>  Le fondement th√©orique de la connaissance de la langue permettra de poser le livre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kotlin in Action</a> des cr√©ateurs de la langue Svetlana Isakova et Dmitry Zhemerov. <br><br>  Laconicisme, informativit√©, large couverture des sujets, concentration sur les d√©veloppeurs Java et la disponibilit√© d'une version russe en font le meilleur des manuels possibles au d√©but de l'apprentissage des langues.  J'ai commenc√© avec elle. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources</a> Kotlin avec developer.android. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide Kotlin en russe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un excellent article de</a> Konstantin Mikhailovsky, un d√©veloppeur Android de Genesis, sur l'exp√©rience du passage √† Kotlin. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433074/">https://habr.com/ru/post/fr433074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433062/index.html">AXIS P1367 vs IDIS DC-B3303X: Comparez les cam√©ras CCTV</a></li>
<li><a href="../fr433064/index.html">Gestion des incidents: ¬´vous ne pouvez pas abandonner¬ª ou l'art de placer des virgules</a></li>
<li><a href="../fr433066/index.html">Coupe HighLoad # 2. Championnat pour les d√©veloppeurs backend de retour en service</a></li>
<li><a href="../fr433070/index.html">Comment distinguer le shampoing des champignons et les brochettes du champagne ... Elasticsearch - rechercher des produits dans les bases de donn√©es du magasin</a></li>
<li><a href="../fr433072/index.html">Comment pirater la protection contre la copie de la console Sega Dreamcast</a></li>
<li><a href="../fr433076/index.html">Comment nous avons cr√©√© notre biblioth√®que Android Gallery pour afficher le contenu multim√©dia</a></li>
<li><a href="../fr433078/index.html">Nous √©crivons des robots de trading en utilisant le cadre graphique StockSharp. 2e partie</a></li>
<li><a href="../fr433082/index.html">Pomper les comptes d'autrui est devenu une infraction p√©nale en Cor√©e du Sud</a></li>
<li><a href="../fr433084/index.html">Le√ßon ouverte "Ing√©nierie des fonctionnalit√©s sur l'exemple du jeu de donn√©es Titanic classique"</a></li>
<li><a href="../fr433086/index.html">Tinkoff et tout, tout, tout: IoT, analyse et surveillance pour les banques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>