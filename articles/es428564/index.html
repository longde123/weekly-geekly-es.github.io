<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèø üë®üèæ‚Äçüéì üßëüèæ‚Äçü§ù‚Äçüßëüèº B√∫squeda de MapKit: consejos y trucos ü•á üßî ‚è™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MapKit es una biblioteca de software que le permite utilizar datos de mapas y tecnolog√≠as Yandex en aplicaciones m√≥viles. Ella tiene documentaci√≥n ofi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>B√∫squeda de MapKit: consejos y trucos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/428564/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/_i/jl/dq_ijlbhgproad1ydyfpsill35e.png" width="480"></div><br><p>  MapKit es una biblioteca de software que le permite utilizar datos de mapas y tecnolog√≠as Yandex en aplicaciones m√≥viles.  Ella tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> que ya contiene una descripci√≥n detallada de los m√©todos API, por lo que hoy hablaremos de otra cosa. </p><br><p>  En esta publicaci√≥n, les contar√© a los lectores de Habr sobre las caracter√≠sticas de la b√∫squeda en MapKit y compartir√© recomendaciones y trucos que pueden serle √∫tiles. </p><br><p>  <strong>TL; DR</strong> Si no desea leer el art√≠culo completo, estos son dos de los puntos m√°s √∫tiles como compensaci√≥n por leer el pr√≥logo: </p><br><ul><li>  No olvide guardar sesiones, de lo contrario la b√∫squeda no funcionar√°. </li><li>  Toda la informaci√≥n m√°s interesante se almacena en los metadatos del objeto.  Si desea averiguar la direcci√≥n completa, el horario de apertura o cu√°nto cuesta una taza de capuchino en un caf√© en particular, necesita metadatos. </li></ul><br><p>  Los enlaces a la documentaci√≥n en el texto ser√°n para Android, las clases y los m√©todos para iOS se llaman de la misma manera. </p><a name="habracut"></a><br><h2 id="chto-umeet-poisk">  Lo que puede buscar </h2><br><p>  En primer lugar, hablemos sobre lo que puede hacer la b√∫squeda en MapKit.  La b√∫squeda puede hacer lo que espera de una aplicaci√≥n de mapas cuando desea encontrar algo all√≠. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m0/1g/wv/m01gwvpktgpsipyacy4rj5pi3yw.jpeg" width="720"></div><br><p>  Cuando escribe en la barra de b√∫squeda ‚Äúcafe‚Äù, ‚ÄúLev Tolstoy street, 16‚Äù o ‚Äútram 3‚Äù, la <strong>b√∫squeda de texto</strong> funciona.  Este es el tipo de b√∫squeda m√°s sofisticado.  Apiladas en el sentido de que admite el conjunto m√°ximo de par√°metros para la personalizaci√≥n.  Puede intentar buscar inmediatamente a lo largo de una ruta o una calle que le interese, aclarar el n√∫mero deseado de resultados, establecer la posici√≥n del usuario, etc.  Si despu√©s de la primera b√∫squeda desea mover el mapa o aplicar filtros a la solicitud ("farmacias con un grupo"), estas son <strong>nuevas solicitudes</strong> . </p><br><p>  <strong>La b√∫squeda inversa es</strong> familiar para la mayor√≠a de los usuarios en la pregunta "¬øQu√© hay aqu√≠?".  Le permite hacer clic en el mapa para determinar qu√© calle o casa est√° "debajo del cursor" o qu√© organizaciones est√°n cerca de este punto.  <strong>La b√∫squeda por URI es</strong> necesaria cuando desea encontrar un objeto espec√≠fico.  Se puede usar, por ejemplo, para crear marcadores en una aplicaci√≥n.  Encontramos nuestra cafeter√≠a favorita, la marcamos con un asterisco; la pr√≥xima vez ser√° posible encontrar exactamente esta organizaci√≥n por URI, donde sea que se encuentre la ventana del mapa.  Ni la b√∫squeda inversa ni las b√∫squedas de URI admiten nuevas solicitudes, porque no hay nada que especificar para ellas. </p><br><p>  Otra posibilidad que vive en la b√∫squeda son las <strong>sugerencias de b√∫squeda</strong> , que le permiten complementar autom√°ticamente la consulta mientras la escribe.  Pero pospondremos una historia detallada sobre ellos para otro momento. </p><br><h2 id="kak-ustroen-zapros">  C√≥mo se organiza la solicitud </h2><br><p> La b√∫squeda, como muchas partes de MapKit, funciona de forma as√≠ncrona.  El objeto principal para trabajar con esta asincron√≠a es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sesi√≥n de b√∫squeda</a> .  Veamos un peque√±o ejemplo. </p><br><div class="spoiler">  <b class="spoiler_title">Un poco sobre ejemplos</b> <div class="spoiler_text"><p> Los ejemplos en el art√≠culo estar√°n en Kotlin para facilitar el trabajo con valores opcionales y menos c√≥digo repetitivo.  MapKit tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aplicaci√≥n de demostraci√≥n</a> .  Se puede usar para probar ejemplos, pero para esto, <a href=""><code>SearchActivity</code></a> debe convertir de Java a Kotlin.  <code>showMessage</code> , que de vez en cuando aparece en el c√≥digo, es una forma conveniente de mostrar una l√≠nea de texto en la pantalla o en el registro. </p></div></div><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">// `searchManager`  `searchSession` ‚Äì  .    //    ,     . searchManager = SearchFactory.getInstance().createSearchManager( SearchManagerType.ONLINE ) val point = Geometry.fromPoint(Point(59.95, 30.32)) searchSession = searchManager!!.submit("", point, SearchOptions(), object: Session.SearchListener { override fun onSearchError(p0: Error) { showMessage("Error") } override fun onSearchResponse(p0: Response) { showMessage("Success") } } )</span></span></code> </pre> <br><p>  Inmediatamente despu√©s de llamar a <code>submit</code> control volver√° a su c√≥digo, y cuando MapKit reciba una respuesta del servidor, se llamar√° a SearchListener. </p><br><p>  La sesi√≥n de b√∫squeda le permite: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cancelar solicitud</a>  Por ejemplo, si el usuario cierra la pantalla de b√∫squeda. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repita la solicitud</a> en caso de error.  Por ejemplo, si hubo alg√∫n problema con la red. </li><li>  Continuar la interacci√≥n con la b√∫squeda despu√©s de la respuesta recibida.  <strong>Las nuevas solicitudes</strong> se realizan a trav√©s de la sesi√≥n. </li></ul><br><p>  Una sesi√≥n tras la cancelaci√≥n se cancela autom√°ticamente.  Esto significa que si no se guarda en el lado del c√≥digo del cliente, la b√∫squeda no funcionar√°. <br>  <strong>¬°No olvides guardar la sesi√≥n, la sesi√≥n es tu amiga!</strong> </p><br><h3 id="search-options">  Opciones de busqueda </h3><br><p>  Una forma general de configurar consultas de b√∫squeda es a trav√©s de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>SearchOptions</code></a> , que le permite modificar los par√°metros de consulta. </p><br><ul><li>  El principal de estos par√°metros es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>SearchType</code></a> .  Le permite especificar si desea ver top√≥nimos, organizaciones o transporte en la respuesta (lo m√°s probable es que no necesite otros tipos). </li><li>  Otro par√°metro de consulta importante son los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fragmentos</a> .  Hablaremos de ellos con m√°s detalle en la secci√≥n sobre el dispositivo de respuesta. </li><li>  Si desea obtener la geometr√≠a del top√≥nimo (por ejemplo, calles o √°reas), debe ordenarlo a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>setGeometry(true)</code></a> .  Tenga en cuenta que la geometr√≠a es bastante "pesada" en t√©rminos de datos transmitidos. </li><li>  De forma predeterminada, la b√∫squeda no devuelve organizaciones cerradas (temporal o permanentemente), pero si las necesita, debe establecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>setSearchClosed(true)</code></a> . </li></ul><br><p>  Adem√°s de los par√°metros enumerados, hay algunos m√°s que pueden serle √∫tiles, se pueden encontrar en la documentaci√≥n de la clase.  Tenga en cuenta que no todas las consultas admiten todas las combinaciones de par√°metros.  La documentaci√≥n para cada m√©todo <code>SearchManager</code> o <code>Session</code> indica qu√© par√°metros de <code>SearchOptions</code> entiende. </p><br><h2 id="kak-ustroen-otvet">  ¬øC√≥mo se arregla la respuesta? </h2><br><p>  A juzgar por las preguntas de apoyo, la mayor√≠a de los usuarios est√°n confundidos por el formato de la respuesta de b√∫squeda.  Si nos fijamos en la clase de respuesta, parece bastante simple (al menos, la parte interesante para nosotros): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> SearchMetadata </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> GeoObjectCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Aqu√≠ <code>getCollection()</code> devuelve los objetos en la respuesta, y <code>getMetadata()</code> son algunos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">datos adicionales</a> que contienen, por ejemplo, informaci√≥n sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la ventana de respuesta</a> , el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tipo de clasificaci√≥n</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">n√∫mero de resultados encontrados</a> .  Si mira dentro de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>GeoObjectCollection</code></a> puede ver que contiene algunos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>Item</code></a> que pueden ser otros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>GeoObjectCollection</code></a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>GeoObject</code></a> . </p><br><p>  No hay colecciones dentro de las colecciones en la b√∫squeda (al menos todav√≠a no), as√≠ que echemos un vistazo a <code>GeoObject</code> .  Dentro del objeto hay un nombre ( <code>getName()</code> ), una descripci√≥n ( <code>getDescriptionText()</code> ), un marco ( <code>getBoundingBox()</code> ), un conjunto de geometr√≠as ( <code>getGeometry()</code> ) y algunos otros m√©todos no muy claros.  ¬øD√≥nde est√°n los n√∫meros de tel√©fono de la organizaci√≥n?  ¬øC√≥mo entender a qu√© ciudad se refiere el top√≥nimo? </p><br><p>  Seg√∫n los m√©todos del objeto, esto no est√° muy claro. </p><br><h3 id="geoobject">  Geoobject </h3><br><p>  Es hora de hablar m√°s sobre <code>GeoObject</code> . </p><br><p>  <code>GeoObject</code> es un objeto de "tarjeta" tan b√°sico.  En su interior puede haber un evento de carretera, un objeto separado del resultado de la b√∫squeda, una maniobra en la ruta o un objeto en el mapa (PDI), como un monumento o alguna organizaci√≥n notable. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_l/ut/15/_lut15ur4w70yz88v1127swd6wg.png"></div><br><p>  Todo lo m√°s interesante sobre el objeto se almacena en metadatos.  Se puede acceder a ellos utilizando el m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>getMetadataContainer()</code></a> .  La clave en este contenedor es el tipo de metadatos.  Si ve algo en la documentaci√≥n que termina con la palabra <code>Metadata</code> , lo m√°s probable es que est√© aqu√≠.  En la b√∫squeda de diferentes piezas de "metadatos" 15. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gd/we/00/gdwe00tnfbshuzugslvjssupja4.png"></div><br><p>  Los metadatos se pueden dividir en varios tipos.  El primer tipo son los metadatos que determinan a qu√© tipo pertenece el objeto: top√≥nimos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>ToponymObjectMetadata</code></a> ), organizaciones ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>BusinessObjectMetadata</code></a> ) o transporte ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>TransitObjectMetadata</code></a> ).  En los metadatos para el top√≥nimo, puede encontrar una direcci√≥n estructurada y una geometr√≠a detallada.  Los metadatos para la organizaci√≥n son las horas de operaci√≥n o el sitio de la empresa.  Estos metadatos est√°n determinados por el tipo de b√∫squeda en la solicitud: si busc√≥ solo top√≥nimos, cada objeto en la respuesta deber√≠a tener los metadatos correspondientes.  Si buscaba nombres de lugares u organizaciones, cada objeto tendr√° al menos uno de los dos "metadatos". </p><br><p>  Aqu√≠ le mostramos c√≥mo encontrar los n√∫meros de tel√©fono de la compa√±√≠a: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> phones = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">BusinessObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">phones</span></span></span></span></code> </pre> <br><p>  Y aqu√≠ est√° c√≥mo encontrar la ciudad en una direcci√≥n estructurada: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> city = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">ToponymObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">components</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">firstOrNull</span></span></span><span class="hljs-class"> </span></span>{ it.kinds.contains(<span class="hljs-type"><span class="hljs-type">Address</span></span>.<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Kind</span></span>.<span class="hljs-type"><span class="hljs-type">LOCALITY</span></span>) } ?.name</code> </pre> <br><p>  El segundo tipo son los metadatos que vienen con el objeto, aunque no lo haya preguntado.  El tipo principal que necesita saber es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>URIObjectMetadata</code></a> .  Dentro de <code>URIObjectMetadata</code> el identificador √∫nico del objeto, que <strong>URI</strong> debe pasar en la <strong>b√∫squeda</strong> . </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//       ¬´¬ª,     //     val uri = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(UriObjectMetadata::class.java) ?.uris ?.firstOrNull() ?.value</span></span></code> </pre> <br><p>  Y el tercer tipo son los metadatos, que aparecer√°n en la respuesta solo si solicita espec√≠ficamente una b√∫squeda al respecto.  De manera diferente, estos metadatos se denominan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fragmentos</a> .  Los fragmentos son peque√±os datos adicionales que cambian con m√°s frecuencia que los datos de "referencia" b√°sicos o que no todos necesitan.  Puede ser una calificaci√≥n, un enlace a fotos o panor√°micas, el tipo de cambio o el precio del combustible en una estaci√≥n de servicio.  La lista de fragmentos debe establecerse utilizando las opciones de b√∫squeda.  Si el servidor tiene un fragmento ordenado, lo agregar√° al objeto correspondiente. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Geometry</span></span>.fromPoint(<span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">59.95</span></span>, <span class="hljs-number"><span class="hljs-number">30.32</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> options = <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>() options.snippets = <span class="hljs-type"><span class="hljs-type">Snippet</span></span>.<span class="hljs-type"><span class="hljs-type">FUEL</span></span>.value searchSession = searchManager!!.submit(<span class="hljs-string"><span class="hljs-string">""</span></span>, point, options, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> fun onSearchResponse(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//         showMessage(response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(FuelMetadata::class.java) ?.fuels ?.joinToString("\n") { "Fuel(name=${it.name}, price=${it.price?.text})" } ?: "No fuel" ) }</span></span></code> </pre> <br><p>  Todos los metadatos enumerados anteriormente se agregan a objetos individuales en la respuesta.  Tambi√©n hay metadatos que se agregan a toda la respuesta.  Pero se muestran en los m√©todos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>SearchMetadata</code></a> y no es necesario extraerlos de ninguna colecci√≥n especial. </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//            response.metadata.businessResultMetadata?.categories //     (  )     response.metadata.toponymResultMetadata?.responseInfo?.mode</span></span></code> </pre> <br><h2 id="primery-ispolzovaniya">  Ejemplos de uso </h2><br><p>  Ahora veamos los principales m√©todos de b√∫squeda de clases, veamos ejemplos de uso y algunos puntos no obvios asociados con ellos. </p><br><h3 id="poisk-po-tekstu">  B√∫squeda de texto </h3><br><p>  El m√©todo principal para la b√∫squeda de texto (y para toda la b√∫squeda, probablemente) es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><ul><li>  Se espera que el par√°metro de <code>text</code> contenga el texto que desea buscar. </li><li>  El par√°metro de <code>geometry</code> es un poco m√°s complicado.  Dependiendo de qu√© tipo de geometr√≠a se transfiere, la b√∫squeda se comportar√° de manera diferente: <br><ul><li>  Si pasa un punto, la b√∫squeda se realizar√° en una peque√±a ventana al lado de este punto. </li><li>  Si pasa una ventana rectangular ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>BoundingBox</code></a> ) o un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pol√≠gono</a> de cuatro puntos, se usar√° como un cuadro de b√∫squeda.  Un ejemplo simple de dicha ventana es el √°rea visible del mapa. </li><li>  Finalmente, si pasa la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">polil√≠nea</a> , la ventana que la describe se usar√° como una ventana de b√∫squeda, y la clasificaci√≥n se llevar√° a cabo teniendo en cuenta esta polil√≠nea. </li></ul></li><li>  Ya <code>SearchOptions</code> sobre <code>SearchOptions</code> y <code>SearchListener</code> arriba. </li></ul><br><p>  El servidor puede considerar que la respuesta correcta no est√° en la ventana en la que se realiz√≥ la b√∫squeda inicial ("caf√© en Vladivostok" cuando la ventana de b√∫squeda est√° en Mosc√∫).  En este caso, deber√° tomar la ventana de respuesta y mover la tarjeta all√≠ para que los resultados sean visibles en la pantalla (las nuevas solicitudes no se permiten y no solicitan mover la tarjeta). </p><br><p>  El m√©todo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>submit</code></a> tiene un gemelo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Polyline polyline, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><p>  con un par√°metro adicional  Este par√°metro se puede usar para transferir una polil√≠nea grande (por ejemplo, una ruta a otra ciudad) y una peque√±a ventana de b√∫squeda.  Luego, la b√∫squeda misma cortar√° la parte necesaria de la polil√≠nea transferida y la usar√° solo para la consulta. </p><br><h3 id="perezaprosy">  Re-solicitudes </h3><br><p>  Las nuevas solicitudes, a diferencia de otros tipos de solicitudes, se realizan con la ayuda de una sesi√≥n de b√∫squeda, que devuelve el mismo <code>submit</code> y su hermano gemelo.  Parte de los m√©todos de la sesi√≥n es simple y directo: </p><br><ul><li>  puede cambiar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ventana de solicitud</a> (cuando el usuario, por ejemplo, movi√≥ la tarjeta) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">las opciones de b√∫squeda</a> se pueden actualizar (por ejemplo, para actualizar la posici√≥n del usuario) </li><li>  Puede cambiar el tipo de clasificaci√≥n, por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">distancia</a> o por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clasificaci√≥n</a> . </li></ul><br><p>  Para realizar una b√∫squeda refinada, debe utilizar el m√©todo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>resubmit</code></a> .  Acepta el mismo <code>SearchListener</code> que una b√∫squeda normal.  Antes de llamarlo, puede cambiar varios par√°metros de sesi√≥n.  Por ejemplo, cambie simult√°neamente el tipo de clasificaci√≥n y aplique filtros. </p><br><h4 id="filtry">  Filtros </h4><br><p>  Ya que estamos hablando de filtros.  Los filtros son cuando Wi-Fi y cocina italiana.  Probablemente tengan la sintaxis m√°s confusa de todas las interfaces de b√∫squeda en MapKit.  Esto se debe al hecho de que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> utilizan las mismas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estructuras de datos</a> para obtener filtros de la respuesta de b√∫squeda y para especificar filtros en la nueva solicitud. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/51/ky/7m51ky9gytyd1rlubljviboun5k.jpeg" width="360"></div><br><p>  Los filtros vienen en dos tipos.  Los filtros booleanos suponen solo dos valores mutuamente excluyentes: s√≠ o no.  Esto puede ser la presencia de Wi-Fi en un caf√©, un ba√±o en una estaci√≥n de servicio o un estacionamiento cerca de la organizaci√≥n.  Los filtros de enumeraci√≥n asumen muchos valores que se pueden solicitar juntos.  Este, por ejemplo, es el tipo de cocina para una cafeter√≠a o los tipos de combustible en una estaci√≥n de servicio. </p><br><p>  Primero, veamos c√≥mo obtener los filtros disponibles para el reinicio actual: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fun filters(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span>? { fun enumValues(filter: <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>) = filter .values .enums ?.joinToString(prefix = <span class="hljs-string"><span class="hljs-string">" -&gt; "</span></span>) { e -&gt; e.value.id } ?: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response .metadata .businessResultMetadata ?.businessFilters ?.joinToString(separator = <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) { f -&gt; <span class="hljs-string"><span class="hljs-string">"${f.id}${enumValues(f)}"</span></span> } }</code> </pre> <br><p>  En la l√≠nea resultante, para los filtros booleanos, solo se mostrar√° el identificador, y para los filtros de enumeraci√≥n, el identificador del filtro mismo y los identificadores de los valores disponibles.  Ahora, armados con el conocimiento de los identificadores disponibles, buscaremos los caf√©s de la cocina italiana que tienen Wi-Fi.  Primero agregue un filtro booleano: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boolFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"wi_fi"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromBooleans( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">BooleanValue</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) ) )</code> </pre> <br><p>  Ahora el filtro de enumeraci√≥n: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enumFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"type_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromEnums( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">EnumValue</span></span>( <span class="hljs-type"><span class="hljs-type">Feature</span></span>.<span class="hljs-type"><span class="hljs-type">FeatureEnumValue</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"italian_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* imageUrlTemplate= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> ), <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> )) ) )</code> </pre> <br><p>  Finalmente, puede agregar filtros a la sesi√≥n y llamar a <code>resubmit()</code> : </p><br><pre> <code class="scala hljs">searchSession!!.setFilters(listOf(boolFilter, enumFilter)) searchSession!!.resubmit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  Tenga en cuenta que no puede establecer filtros para la primera consulta.  Primero debe obtener una respuesta de b√∫squeda que enumere los filtros disponibles.  Y solo entonces para formar un reinicio. </p><br><h5 id="dopolnitelnye-rezultaty">  Resultados adicionales </h5><br><p>  Otra sesi√≥n le permite verificar si hay resultados de b√∫squeda adicionales para su solicitud.  Y, si lo son, cons√≠guelos.  Por ejemplo, cuando est√° buscando un caf√© en su ciudad, lo m√°s probable es que no encajen en una p√°gina de la respuesta de b√∫squeda.  Se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>hasNextPage</code></a> un par de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>fetchNextPage</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>hasNextPage</code></a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>fetchNextPage</code></a> para ver las siguientes p√°ginas en la lista.  Aqu√≠ debe saber que, en primer lugar, llamar a <code>fetchNextPage</code> arrojar√° una excepci√≥n si el m√©todo <code>hasNextPage</code> devuelve <code>false</code> .  Y en segundo lugar, el uso de estos m√©todos implica que los par√°metros restantes no cambian.  Es decir, la sesi√≥n se usa para refinar la solicitud ( <code>resubmit()</code> ) o para recuperar las siguientes p√°ginas ( <code>fetchNextPage()</code> ).  La combinaci√≥n de estos modos no es necesaria. </p><br><h4 id="obratnyy-poisk">  B√∫squeda inversa </h4><br><p>  La b√∫squeda inversa por conveniencia tambi√©n se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Point point, Integer zoom, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span></code> </pre> <br><p>  Se diferencia de otros tipos de consultas en que <em>requiere</em> solo un tipo de b√∫squeda para ingresar.  Puede pasar el tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>GEO</code></a> y buscar nombres de lugares, o el tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>BIZ</code></a> y buscar organizaciones.  No hay un tercero. </p><br><p>  Al buscar de nuevo con un tipo <code>GEO</code> , hay puntos que necesitan aclaraci√≥n.  Tenga en cuenta que la respuesta contendr√° varios objetos en la jerarqu√≠a (es decir, la respuesta incluir√° una casa, calle, ciudad, etc.).  En casos simples, puede tomar solo el primer objeto.  En los m√°s complejos, busque a trav√©s de la jerarqu√≠a que desee. </p><br><p>  El nivel de zoom es necesario para producir resultados adecuados dependiendo de lo que el usuario vea en el mapa.  Imagine a un usuario mirando un mapa en todo el pa√≠s.  Entonces ser√° extra√±o para √©l hacer clic en una calle o casa separada si el usuario accidentalmente logr√≥ entrar en ellas.  Bastante ciudades.  Para esto es el par√°metro de <code>zoom</code> . </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">55.734</span></span>, <span class="hljs-number"><span class="hljs-number">37.588</span></span>) <span class="hljs-comment"><span class="hljs-comment">//         ¬´  , 16¬ª searchSession = searchManager!!.submit(point, 16, SearchOptions(), this) //    ‚Äì  " " searchSession = searchManager!!.submit(point, 14, SearchOptions(), this)</span></span></code> </pre> <br><h4 id="poisk-po-uri">  B√∫squeda por URI </h4><br><p>  Aqu√≠ todo est√° bastante claro: tomamos el URI del <code>URIObjectMetadata</code> , recu√©rdenlo, despu√©s de un tiempo vamos en la b√∫squeda y con este URI obtenemos exactamente el objeto que recordamos. </p><br><pre> <code class="scala hljs">searchSession = searchManager!!.resolveURI(uri, <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  De alguna manera incluso aburrido. </p><br><h2 id="poiskovyy-sloy-i-svetloe-buduschee">  Capa de b√∫squeda y futuro brillante </h2><br><p>  Al lado de <code>SearchManager</code> todav√≠a hay una cosa llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">capa de b√∫squeda</a> .  La capa fue concebida para combinar la b√∫squeda con el mapa.  √âl mismo sabe c√≥mo agregarle resultados, mover el mapa para que estos resultados se muestren y realicen consultas cuando el usuario mueva el mapa.  En muchos sentidos, es similar al <code>SearchManager</code> y la <code>Session</code> combinados, pero el trabajo integrado con el mapa agrega nuevas caracter√≠sticas.  Y hablar de ellos est√° m√°s all√° del alcance de este art√≠culo.  En el momento del lanzamiento de MapKit 3.1, ya hab√≠amos corrido alrededor de la capa de b√∫squeda en aplicaciones reales, por lo que puede intentar usarlo en su hogar.  Tal vez facilitar√° su b√∫squeda de empleo. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ct/tg/g4/cttgg4rh3iffabd5xfm8fc6s_ha.jpeg" width="480"></div><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Espero que despu√©s de leer el art√≠culo comprenda c√≥mo trabajar con la b√∫squeda en MapKit con toda su fuerza.  Seguramente todav√≠a hubo algunos momentos sutiles y no triviales (por ejemplo, casi no hablamos sobre los consejos y la capa de b√∫squeda).  Algo se puede encontrar en la documentaci√≥n, algo para aclarar en proyectos en GitHub o solicitar nuestro apoyo. </p><br><p>  ¬°Prueba MapKit, usa la b√∫squeda en √©l y ve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a Maps</a> para hacerlos a√∫n mejores! </p><br><p>  <strong>PD:</strong> Y tambi√©n vis√≠tenos el 29 de noviembre para escuchar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥mo se organiza el backend de enrutamiento automotriz</a> .  Que, por cierto, tambi√©n se puede usar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MapKit</a> , pero esta es una historia completamente diferente. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428564/">https://habr.com/ru/post/es428564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428552/index.html">Algoritmo: c√≥mo encontrar la pr√≥xima permutaci√≥n lexicogr√°fica</a></li>
<li><a href="../es428556/index.html">"El entorno de producci√≥n est√° m√°s all√° de su control": Rian Lewis sobre la prueba de proyectos de blockchain</a></li>
<li><a href="../es428558/index.html">C√≥mo cre√© un asistente para WordPress a partir de mi pereza profunda</a></li>
<li><a href="../es428560/index.html">Anuncio no programado del viernes</a></li>
<li><a href="../es428562/index.html">Droidcon London. Como fue</a></li>
<li><a href="../es428566/index.html">Funciones de flecha de JavaScript: por qu√© son necesarias, c√≥mo manejarlas, cu√°ndo usarlas y cu√°ndo no</a></li>
<li><a href="../es428568/index.html">Gu√≠a de desarrollo de aplicaciones web React Native</a></li>
<li><a href="../es428570/index.html">Funciones de orden superior en JavaScript</a></li>
<li><a href="../es428572/index.html">Componentes de orden superior en reacci√≥n</a></li>
<li><a href="../es428574/index.html">Lleve la comunicaci√≥n corporativa al siguiente nivel con Zextras Chat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>