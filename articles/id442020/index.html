<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚞 🌻 🤙🏻 Codec AV1 baru: mempercepat pemuatan video di browser 🐦 🧕 🧛🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam panduan ini, kita akan belajar cara menggunakan video di Web, seperti kebiasaan pada tahun 2019. Chrome dan Firefox telah mulai mendukung codec ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Codec AV1 baru: mempercepat pemuatan video di browser</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442020/"> Dalam panduan ini, kita akan belajar cara menggunakan video di Web, seperti kebiasaan pada tahun 2019. Chrome dan Firefox telah mulai mendukung codec AV1 baru - bagi mereka, video dapat dibuat separuh dari itu. <br><br>  Kami akan berbicara secara terpisah bagaimana cara mengganti GIF dengan video dalam AV1 dan H.264 - maka ukurannya akan turun 20-40 kali. <br><br><img src="https://habrastorage.org/webt/e6/ma/qx/e6maqxoeu5hqqh3ilpk5vh6ozvk.jpeg" alt="Browser AV1 di"><br><br>  YouTube sudah menggunakannya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">TestTube</a> .  Netflix mengatakan AV1 akan menjadi " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">codec generasi berikutnya</a> ." <br><br>  Kami di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Evil Mars</a> sudah menggunakannya di situs web kami dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Amplifer</a> .  Pada artikel ini, saya akan berbagi pengalaman menerapkan AV1 dan langkah-demi-langkah memberi tahu Anda cara menyematkan video agar berfungsi di semua browser. <br><a name="habracut"></a><br><h2>  Codec dan wadah </h2><br>  Semuanya sederhana dengan gambar: baik JPEG dengan PNG untuk semua browser, atau membuat file yang lebih ringkas di WebP untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">browser modern</a> .  Kami selalu dapat memastikan bahwa file <code>.png</code> akan memiliki format PNG (dengan pengecualian yang jarang dari bom PNG yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">dapat dilindungi</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">imgproxy</a> ). <br><br>  File video lebih rumit.  Ekstensi file ( <code>.mp4</code> , <code>.wmv</code> , <code>.webm</code> atau <code>.mov</code> ) hanya berbicara tentang wadah.  Sedangkan file video terdiri dari tiga komponen berbeda: <br><br><ol><li>  <b>Codec video</b> menentukan seberapa banyak Anda dapat mengompres video, dan apa yang harus Anda korbankan.  Codec video utama dari Web: H.264, HEVC, VP9 dan, sekarang, AV1. </li><li>  <b>Codec audio</b> memadatkan suara.  Tentu saja, itu tidak diperlukan jika tidak ada suara di video.  Pilihan yang populer adalah MP3, Opus, dan AAC. </li><li>  <b>Kontainer</b> menyimpan video (dikompresi oleh beberapa jenis codec video) dan aliran audio (dikompresi oleh beberapa jenis codec audio).  Serta data tambahan, seperti subtitle dan meta-informasi.  Wadah populer: MP4, MOV, WebM. </li></ol><br>  Ketika kita melihat ekstensi file <code>.mp4</code> , kita hanya bisa mengatakan bahwa wadah MP4 digunakan.  Tetapi codec di dalamnya mungkin berbeda - penulis dapat mengambil H.264 dan AAC, AV1 dan Opus, atau yang lainnya. <br><br><h2>  Lihatlah AV1 </h2><br>  AV1 adalah video codec yang dirilis setahun yang lalu, pada bulan Maret 2018. Itu dibuat untuk melampaui codec dari generasi sebelumnya - HEVC, VP9, ​​H.264 dan VP8. <br><br><img src="https://habrastorage.org/webt/l1/pr/n6/l1prn6kicyr6f7smayebyp7m85m.jpeg" alt="Grafik generasi codec video"><br>  <i>Diagram codec generasi dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Tsahi Levent-Levy</a></i> <br><br><blockquote>  Jika Anda tertarik pada bagaimana tepatnya AV1 berhasil melampaui codec lainnya dalam kompresi, baca detail teknis dalam terjemahan di Habré: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video Generasi Selanjutnya: Memperkenalkan AV1</a> <br>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AV1 Next Generation Codec: Filter Directional Koreksi CDEF</a> ” <br></blockquote><br>  Karena optimasi baru, AV1 memampatkan video 30-50% lebih baik daripada H.264 atau VP8, dan hingga 30% lebih baik daripada HEVC.  Tetapi codec dirilis baru-baru ini dan sejauh ini memiliki beberapa penyakit anak-anak: <br><br><ul><li>  Encoder saat ini tidak dioptimalkan.  AV1 memampatkan video dengan <i>sangat</i> lambat ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">encoder cepat</a> baru <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">pada Rust</a> sudah dalam pengembangan).  Codec tidak cocok untuk streaming.  Jika kita berbicara tentang video statis di pendaratan - masalah ini tidak relevan bagi kami. </li><li>  Sejauh ini, codec hanya didukung di desktop Chrome dan Firefox di Windows.  Belum ada dukungan untuk Safari dan Edge (meskipun Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">sudah mengujinya</a> ).  Anda memerlukan setidaknya 2 file: AV1 untuk Chrome dan Firefox dan H.264 untuk browser lain. </li></ul><br>  Hal paling keren tentang AV1 adalah bahwa kotak " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">jackalisasi</a> " tidak muncul pada bit rate yang rendah. <br><br><img src="https://habrastorage.org/webt/kd/fi/gm/kdfigmacjbsduq4reyw7fsjvygo.png" alt="Perbandingan kualitas gambar untuk codec yang berbeda pada bitrate yang berbeda"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Membandingkan</a> kualitas gambar untuk codec yang berbeda pada bitrate yang berbeda - AV1 menang</i> <br><br><h2>  Memasak AV1 dengan benar </h2><br>  Akhirnya mari kita mulai berlatih.  Pertama, mari kita putuskan wadahnya.  Secara teori, AV1 dapat ditempatkan di wadah yang berbeda, tetapi MP4 lebih kompak dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">direkomendasikan</a> dalam spesifikasi.  Untuk suara dalam AV1 kami mengambil Opus, karena itu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">kompres suara dengan sempurna</a> . <br><br>  Agar video berfungsi di semua browser, kami akan menghasilkan 3 file: <br><br><ol><li>  Untuk desktop Chrome dan Firefox di Windows ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">31% pasar</a> pada Maret 2019): Wadah MP4 dengan AV1 untuk video dan Opus untuk suara. </li><li>  Untuk Safari dan Edge ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">16% pasar</a> ) - MP4 dengan HEVC dan AAC. </li><li>  Selebihnya: file MP4 besar dengan H.264 dan AAC. </li></ol><br>  Anda hanya dapat mengambil AV1 dan H.264 - video juga akan berfungsi untuk semua orang. <br><br>  Untuk kompresi, saya sarankan mengambil konsol <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">FFmpeg</a> .  Ada banyak utilitas grafis, tetapi lebih mudah untuk menyimpan opsi di konsol dan kemudian memulai konversi secara otomatis.  Pastikan untuk menggunakan FFmpeg versi terbaru.  Versi sebelum <b>4.1</b> tidak mendukung AV1 dalam MP4. <br><br>  Untuk Mac OS X: <br><br><ol><li>  Instal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Homebrew</a> . </li><li> <code>brew install ffmpeg</code> </li> </ol><br>  Untuk Linux, lebih baik mengambil versi baru dari situs resmi - sementara di banyak distribusi tidak ada versi dengan dukungan untuk AV1 dalam MP4: <br><br><ol><li> <code>wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>tar -xf ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>sudo cp ffmpeg-4.1-64bit-static/ff* /usr/local/bin/</code> </li> </ol><br>  Untuk Windows, Anda dapat menginstal FFmpeg <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">oleh William Diaz</a> . <br><br>  Kami beralih ke konversi file H.264, yang kami perlukan untuk browser lama.  Karena semua file kami menggunakan wadah MP4, saya akan menggunakan <code>.av1.mp4</code> , <code>.hevc.mp4</code> dan <code>.h264.mp4</code> .  Jangan khawatir dengan tim panjang, kami kemudian akan menganalisis semuanya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  SOURCE.mov     - ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" video.h264.mp4</span></span></code> </pre><br>  Sekarang buka <code>video.h264.mp4</code> .  Jika kualitasnya bagus dan ukurannya besar, coba <code>-crf</code> ( <code>-crf 26</code> lalu <code>-crf 28</code> ).  Opsi ini akan mengurangi ukuran file dengan mengorbankan kualitas yang lebih rendah.  Menyeimbangkan kualitas dan ukuran adalah seni. <br><br><blockquote>  Jika tidak ada file video asli, maka Anda dapat mengkonversi file H.264 lama ke AV1. </blockquote><br>  Sekarang saatnya untuk mengonversi AV1 - Saya ingatkan Anda, ini akan lebih panjang dari H.264.  Codec belum menggunakan kekuatan penuh dari prosesor (masuk akal untuk mulai mengkonversi beberapa file secara paralel). <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libopus -c:v libaom-av1 -crf 34 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  <code>-crf</code> dengan <code>-crf</code> lagi untuk <code>-crf</code> keseimbangan kualitas dan ukuran yang sempurna. <br><br>  Sekarang sama untuk HEVC. <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx265 -crf 24 -preset veryslow -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.hevc.mp4</code> </pre><br>  Salin <code>video.h264.mp4</code> , <code>video.hevc.mp4</code> dan <code>video.av1.mp4</code> ke root situs Anda. <br><br><h3>  Memahami Opsi FFmpeg </h3><br>  Apakah perintah di atas terlihat seperti mantra pemanggil setan?  Jangan khawatir, ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">bukan PostCSS</a> .  Mari kita lihat opsinya. <br><br>  <code>-i SOURCE.mov</code> menunjukkan file input, dari mana FFmpeg akan mengambil stream video dan audio, kompres mereka dan kemas dalam wadah baru. <br><br>  <code>-map_metadata -1</code> akan menghapus informasi meta dari video (misalnya, program di mana video dibuat).  Informasi seperti itu jarang berguna di Web. <br><br>  <code>-c:a libopus</code> atau <code>-c:a libfdk_aac</code> mengatur codec audio.  Jika Anda tidak membutuhkan suara, gantilah dengan <code>-an</code> . <br><br>  <code>-c:v libaom-av1</code> memilih codec video - perpustakaan yang akan memampatkan bingkai aliran video. <br><br>  <code>-crf 34</code> - Faktor Tingkat Konstan, keseimbangan kualitas dan ukuran.  Ini seperti slider kualitas JPEG, hanya saja bergerak ke arah yang berbeda (0 adalah kualitas terbaik dan file terbesar).  Skala CRF berbeda untuk H.264 dan AV1 - untuk H.264 naik menjadi 51, untuk AV1 naik menjadi 61. CRF untuk AV1 dan H.264 akan berbeda. <br><br><blockquote>  Facebook menemukan perkiraan korespondensi antara nilai CRF untuk H.264 dan AV1: <br>  19 → 27, 23 → 33, 27 → 39, 31 → 45, 35 → 51, 39 → 57. <br></blockquote><br>  <code>-preset veryslow</code> memaksa codec H.264 dan HEVC untuk mengompres file lebih banyak dengan biaya peningkatan waktu konversi yang tajam. <br><br>  <code>-profile:v main</code> digunakan oleh H.264 untuk memilih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">profil codec</a> .  Hanya "Utama" yang akan berfungsi di Safari. <br><br>  <code>-b:v 0</code> menetapkan bitrate minimum untuk AV1 sehingga video memiliki kualitas yang konsisten. <br><br>  <code>-pix_fmt yuv420p</code> (format piksel) adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">cara yang</a> sulit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">untuk</a> mengurangi ukuran file.  Ini meninggalkan resolusi asli untuk kecerahan, tetapi mengurangi resolusi untuk warna.  Mata kita melihat warna lebih buruk, oleh karena itu mereka tidak memperhatikan trik ini.  Hapus opsi ini jika dalam kasus Anda itu akan mengganggu. <br><br>  <code>-movflags +faststart</code> memindahkan semua yang penting ke awal file sehingga browser dapat memutar video hingga unduhan selesai. <br><br>  <code>-vf "scale=trunc(iw/2)*2:trunc(ih/2)*2"</code> akan mengubah ukuran sisi video menjadi yang genap terdekat (beberapa codec dapat bekerja dengan resolusi 300 × 200 dan 302 × 200, tetapi tidak akan berfungsi dengan 301 × 200).  Jika Anda yakin di mana-mana resolusi dibagi 2 - Anda dapat menghapus opsi ini. <br><br>  <code>-strict experimental</code> diperlukan untuk AV1, encoder-nya masih eksperimental. <br><br>  <code>video.av1.mp4</code> menetapkan nama file yang dihasilkan. <br><br><h3>  Kami meluncurkan video di browser </h3><br>  Sekarang kita membutuhkan setiap browser untuk mengunduh video yang didukungnya.  Untuk ini, &lt;source&gt; memiliki atribut <code>type</code> .  Dan saya menyarankan Anda untuk membaca tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">opsi di &lt;video&gt;</a> . <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controls</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.hevc.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=hevc,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08,opus"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=avc1.4D401E,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  &lt;source&gt; seperti <code>if…else</code> ekspresi <code>if…else</code> - browser membacanya dari atas ke bawah hingga menemukan yang <code>type</code> didukungnya. <br><br>  Dalam <code>type</code> Anda dapat menentukan seluruh format file: wadah ( <code>video/mp4</code> untuk MP4), codec video ( <code>av01.0.05M.08</code> untuk AV1, <code>hevc</code> untuk HEVC dan <code>avc1.4D401E</code> untuk H.264) dan codec audio ( <code>opus</code> untuk Opus dan <code>mp4a.40.2</code> untuk AAC). <br><br><h2>  Bonus: cara mengonversi GIF ke AV1 dan H.264 </h2><br>  Pada 2019, menggunakan GIF untuk video pendek adalah dosa besar.  Berat GIF 20-40 kali lebih banyak daripada H.264 atau AV1.  GIF lebih keras mengenai CPU dan membuat baterai bocor lebih cepat.  Jika Anda membutuhkan video loop pendek, ambil codec video.  Dan FFmpeg dapat mengkonversi video langsung dari GIF. <br><br>  Konversi GIF ke H.264: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.h264.mp4</code> </pre><br>  Hasilkan AV1 yang lebih kecil: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an opus -c:v libaom-av1 -crf 50 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  Sekarang masukkan <code>animation.h264.mp4</code> dan <code>animation.av1.mp4</code> ke dalam HTML. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">muted</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">playsinline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Opsi <code>autoplay</code> dan <code>loop</code> menjadikan video sebagai "GIF" - video loop yang segera diputar setelah halaman dimuat.  <code>playsinline</code> memblokir Safari dari membuka video di layar penuh ketika Anda mengklik video. <br><br><h2>  Waktu penarikan </h2><br>  AV1 masih eksperimental.  Tapi itu sudah bisa digunakan untuk membuat seperempat dari pengguna Anda lebih bahagia.  Sepasang perintah FFmpeg akan menghasilkan file video.  &lt;video&gt; dibuat sejak awal untuk membuat video sesuai dengan kemampuan browser.  Kami sudah menggunakan AV1 dalam produksi dan semuanya bekerja dengan baik (kecuali untuk waktu tunggu sampai AV1 encoder selesai bekerja). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442020/">https://habr.com/ru/post/id442020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442010/index.html">Python dan FPGA. Pengujian</a></li>
<li><a href="../id442012/index.html">Eksperimen: kami mengumpulkan direktori unit yang mengeluarkan paspor</a></li>
<li><a href="../id442014/index.html">Dart 2.2 Diumumkan: Kode Mesin yang Lebih Efisien, Dukungan untuk Set Literals</a></li>
<li><a href="../id442016/index.html">Peretas lebih buruk daripada melukis, atau cara melindungi aplikasi web</a></li>
<li><a href="../id442018/index.html">Hukum pegas dalam hal konstitusi. Kenapa bisa</a></li>
<li><a href="../id442022/index.html">Desain pada CodeFest. Tapi itu tidak pasti</a></li>
<li><a href="../id442024/index.html">Strategi kecerdasan buatan nasional sedang dibuat di Rusia</a></li>
<li><a href="../id442026/index.html">Trojan.Multi.BroSubsc.gen - Kaspersky bekerja</a></li>
<li><a href="../id442028/index.html">Steroid karier. Samurai Way</a></li>
<li><a href="../id442032/index.html">Reintroduksi Bison (kemenangan kecil ahli zoologi)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>