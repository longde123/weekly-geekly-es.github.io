<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏 〰️ 📜 移动开发中的质量管道，第1部分：Android 👨🏽 👨‍❤️‍💋‍👨 🧜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="来自Unsplash的“管道”照片 
 一般方法 


 你好 我将在开发中的管道上发表一系列文章，不仅是帮助验证正在开发的移动应用程序的质量。 主要思想是强调当前与移动相关的所有方法：针对Android和iOS的本地开发，React Native，Xamarin和Flutter。 我将从Andro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>移动开发中的质量管道，第1部分：Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/476624/"><p><img src="https://habrastorage.org/webt/sq/py/ho/sqpyhopyvs0j1usjqu4ftlxu4pa.jpeg"><br>  <sup>来自Unsplash的“管道”照片</sup> </p><br><h2 id="obschiy-podhod"> 一般方法 </h2><br><p> 你好 我将在开发中的管道上发表一系列文章，不仅是帮助验证正在开发的移动应用程序的质量。 主要思想是强调当前与移动相关的所有方法：针对Android和iOS的本地开发，React Native，Xamarin和Flutter。 我将从Android开始，但首先我想对这一切有一个大致的了解。 </p><br><p> 请记住，这是在开发Android应用程序时可能会用到的工具和实践的一般概述，而不是有关如何配置这些工具的教程。 </p><a name="habracut"></a><br><h2 id="radi-chego-eto-vsyo"> 这是做什么用的？ </h2><br><p>让我们从一个众所周知的事实开始：越晚发现应用程序中的缺陷，修复它的成本就越高。 假设您已经发现生产中的错误。 您的测试人员需要在本地重现此错误，对其进行注册，确定优先级，将其传递给开发人员，然后他们又需要对其进行修复，制作一个新的程序集，然后将其传送回测试人员，以使他们确信所有问题都已修复，然后进行发行版本的构建，以及然后将新版本发送给用户。 </p><br><p><img src="https://habrastorage.org/webt/l7/nf/pt/l7nfptsim8xn66s8duzn770gwms.png"></p><br><p> 如果您从一开始就具有防止出现错误的机制，那么可以节省许多时间。 我并不是说有消除所有错误的灵丹妙药-这是不可能的。 但是，可能的是建立障碍（也称为质量门），以增加尽早发现代码中的错误的可能性。 </p><br><p><img src="https://habrastorage.org/webt/ay/jm/sv/ayjmsviy3_24g0cpj9qevhuqyqy.png"></p><br><h2 id="na-kompyutere-razrabotchika"> 在开发人员的计算机上 </h2><br><p> 作为开发人员，您始终使用IDE和命令行工具在计算机上工作。 让我们来看看对于Android开发人员而言存在什么。 </p><br><h2 id="android-studio">  Android Studio </h2><br><p> 现在，这是Android开发人员的默认选项，并且由于它基于IntelliJ平台，因此对Java，Kotlin和XML进行了许多检查。 我建议您在团队中就要使用的特定规则达成一致，在一台计算机上对其进行配置，然后将包含这些规则的settings.jar文件上传到您的版本控制系统或某种协作性工作工具（例如Confluence）。 </p><br><p><img src="https://habrastorage.org/webt/iw/sn/l6/iwsnl6-lv3hfov22cdoqtm2rosy.png"><br>  <sup>Android Studio中的检查设置</sup> </p><br><p>  AS还具有可通过按Alt + Enter应用于代码的快速修复。 </p><br><p><img src="https://habrastorage.org/webt/nd/du/oa/ndduoa5mreobztpsjqoxgqrdt9k.png"><br>  <sup>Android Studio的快速修复示例</sup> </p><br><h2 id="android-lint">  Android Lint </h2><br><p> 这是一个专门用于Android开发的静态分析工具，提供了数百条规则，您可以使用任何规则。  Lint也可以从Gradle任务（任务）启动，并直接在Android Studio中给出提示，并生成报告。 它具有许多检查，分为类别-安全性，国际化，可用性，性能... </p><br><p> 但是添加自己的规则的能力使其功能特别强大。 例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Room</a>有其自己的规则集， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Timber</a>日志记录库有其自己的规则。 您可以为团队或项目创建规则，并确保没有人犯某些典型的错误。  （顺便说一下，即将在Mobius会议上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发表</a>有关此方面的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">报告</a> ，解释了理论方面和实践方面）。 </p><br><p><img src="https://habrastorage.org/webt/ow/iw/cl/owiwclh-pwh1aa_tabmzo7e2ra8.png"><br>  <sup>Android Lint报告示例</sup> </p><br><h2 id="eschyo-staticheskiy-analiz"> 更多静态分析 </h2><br><p> 当然，有许多静态分析工具不是专门为Android设计的，而是通常为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Java</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kotlin设计的</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PMD</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FindBugs</a> （已放弃，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SpotBugs</a> ）， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Checkstyle</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ktlink</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Detekt</a>等。 选择您喜欢的方式，将其集成到您的管道中并确保其实际使用（精确度如何？ </p><br><p><img src="https://habrastorage.org/webt/vr/pc/ok/vrpcokjpfdxch9mfcpxtl69sik0.png"><br>  <sup>来自FindBugs的报告示例</sup> </p><br><p> 但是，仅仅拥有一个提供需要修复的数据的工具还不够。 您还将发现以下有用信息： </p><br><ol><li> 测试的代码覆盖率随时间如何变化？ </li><li> 我要花多长时间才能解决所有发现的问题？ </li><li> 项目中有多少重复代码？ </li><li> 如何将规则扩展到多个团队？ </li></ol><br><p> 还有许多其他。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EPAM Systems，我们</a>注重质量，因此我们选择SonarQube作为回答这些问题的工具。 有关SonarQube的其他好处，请单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> 。 </p><br><h2 id="yunit-testirovanie"> 单元测试 </h2><br><p> 希望您不必<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">因为各种原因</a>再次保证该死的代码需要单元测试。 遵循TDD，遵循测试金字塔的原理或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测试蘑菇</a>的新概念都没关系。 将覆盖范围设置为目标并不重要，无论如何，单元测试是必要的组成部分。 因此，您需要编写和运行它们！ 幸运的是，经过11年的发展，我们从Gradle和Android Gradle插件中获得了一种非常方便的运行测试机制。 </p><br><p> 在Android项目中，默认项目具有testDebugUnitTest任务（当然，对于您来说，它可能因口味而异），由她来运行测试。 确保使用它，并且代码覆盖率随着时间的推移而增加。  Java单元测试的优点是它们可以在JVM工作站上运行，而不是在Dalvik / ART上运行，这在速度上具有优势。 </p><br><p> 在android单元测试的情况下，存在一个基本问题：对Android SDK的依赖。 这就是为什么所有这些UI层方法都像MVP，MVVM，MVI和其他MV *出现的原因之一。 取决于Android上的类的具体问题是，单元测试只是由于使用了这个Android本身的存根而导致下降，而存根只是引发了异常。 当然，有两种选择：要么跳过此类的测试，要么将某些逻辑提取到其他类中，或者为依赖于Android的类创建接口以测试一些高级逻辑，或者使用Robolectric（这远非理想）。 另一种选择是使用仪器化测试，该测试可能适用于检查活动的行为，但是当前的趋势是活动不应包含测试。 </p><br><p> 关于覆盖率问题：您想知道当前情况以及它随时间的变化，因此您也将需要一个工具。 据我所知， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">jacoco</a>是Java的行业标准，并且具有Kotlin支持。 </p><br><h2 id="instrumentirovannye-testy"> 仪器测试 </h2><br><p> 这些测试在Android模拟器上运行，从而允许他们使用Android框架。 不幸的是，它们运行缓慢且不稳定（由于仿真器存在一些问题），因此我所知的大多数开发人员都亲自避免使用它们。 但是它们在Gradle和Android Studio中提供支持，因此对于您来说，它们可能是合适的。 </p><br><h2 id="audit-bezopasnosti"> 安全审核 </h2><br><p> 除了简单的错误，错别字，复制粘贴问题等外，您还应注意一大类问题：安全性。 当然，Android Lint已经提供了一些相关提示，但是最好使用专门用于此任务的专用工具。 这些工具可以在静态和动态模式下工作。 根据您的安全要求，您可能要使用这两种模式，或同时使用这两种模式。 例如，您可能想从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mobile Security Framework开始</a> ，然后再考虑付费选项。 </p><br><p> 幸运的是，这里有一系列由OWASP直接编译<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>静态分析工具。 例如，您可以选择<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Find Security Bugs</a>或使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OWASP SonarCube Project</a> 。 </p><br><h2 id="udostoveritsya-v-vypolnenii-proverok"> 验证验证 </h2><br><p> 正如我所说，反馈周期越短，您花费在修复错误上的时间和金钱就越少。 因此，我想确保代码与生产质量相对应，甚至可以到达存储库甚至在本地进行通信。 当然，您可以简单地要求开发人员执行检查，但是还有一个更好的选择：Git挂钩。 </p><br><p> 我建议为我们上面讨论的所有检查添加一个预提交钩子：lint，静态代码分析和单元测试。 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>找到设置过程的示例。 </p><br><h2 id="cicd-payplayn">  CI / CD管道 </h2><br><p> 很难想象没有CI / CD管道的Android项目。 您的目标是在组装阶段重复上述所有检查。 这有几个原因： </p><br><ol><li> 使用--no-verify选项可以轻松绕开Git挂钩 </li><li> 该代码可以在本地成功通过所有检查，但是在合并后会引入问题 </li><li> 需要测试和覆盖率报告 </li></ol><br><p><img src="https://habrastorage.org/webt/92/w4/ar/92w4arwkjf2erl4z_rpbftefkbu.png"><br>  <sup>bitrise.io上的报告示例</sup> </p><br><p> 幸运的是，您只需要在Gradle构建脚本中直接提及这些安全检查，或者在CI / CD管道中调用相应的任务。 如果您在构建管道方面遇到困难，我最近在2019年关于移动DevOps的DevOops会议上做了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">演讲</a> 。 </p><br><p> 还请执行以下操作： </p><br><ol><li> 运行所有检查请求请求。 不要让任何违反任何规则的请求合并。 这非常重要：如果不执行该规则，那么实际上它不存在。 </li><li> 在组装和部署期间运行所有检查。 您不想降低质量标准。 </li><li> 如果构建被破坏，这是第一要务。 团队应立即解决问题，因为这违反了您的持续交付惯例，并阻止了团队编写质量代码。 </li></ol><br><p> 祝您好运，改善您的代码！ </p><br><p> 如果您喜欢本文，请<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在Twitter上</a>关注我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>以免您错过以下内容。 而且，如果您将于12月在莫斯科举行，或者可以参加，请参加我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mobius</a>会议，了解有关Android（和iOS）开发的许多其他信息！ </p><br><p>  PS感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vixentael</a>处理安全问题，感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Alexei Nikitin</a>进行审查和评论，感谢Alexander Bakanov进行校对。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476624/">https://habr.com/ru/post/zh-CN476624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476594/index.html">外国客户和俄罗斯联邦程序员收入的合法化。 应该做什么，要花多少钱？</a></li>
<li><a href="../zh-CN476596/index.html">西门子建立了一个由风车提供动力的钢铁生产电解工厂</a></li>
<li><a href="../zh-CN476610/index.html">一点业务流程理论</a></li>
<li><a href="../zh-CN476618/index.html">我如何设计对焦套件</a></li>
<li><a href="../zh-CN476620/index.html">SP701 + PCAM-5C + 15分钟+ VITIS = FPGA上的简易MIPI</a></li>
<li><a href="../zh-CN476626/index.html">云中的PVS-Studio：GitLab CI / CD</a></li>
<li><a href="../zh-CN476628/index.html">PVS-Studio走向云端：GitLab CI / CD</a></li>
<li><a href="../zh-CN476636/index.html">调整Firebird和Linux，以容纳691 GB的数据库，可容纳1000多个用户</a></li>
<li><a href="../zh-CN476640/index.html">保护Zimbra OSE免受暴力和DoS攻击</a></li>
<li><a href="../zh-CN476644/index.html">语言层</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>