<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüåæ üë©üèæ‚Äçüöí üíè Nous fabriquons un routeur et un NAS sur un seul processeur üë©üèæ‚Äçü§ù‚Äçüë©üèª üì∂ üì≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article a une suite . 


 J'ai obtenu un ¬´serveur domestique¬ª sous Linux quelques ann√©es seulement apr√®s avoir achet√© un ordinateur. Maintenant, √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous fabriquons un routeur et un NAS sur un seul processeur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477810/"><p>  Cet article a une <a href="https://habr.com/ru/post/478924/">suite</a> . </p><br><p>  J'ai obtenu un ¬´serveur domestique¬ª sous Linux quelques ann√©es seulement apr√®s avoir achet√© un ordinateur.  Maintenant, √† partir de ce moment, plus de quinze ans se sont √©coul√©s et la plupart du temps, j'avais une sorte de deuxi√®me ordinateur suppl√©mentaire √† la maison.  Une fois, quand est venu le temps de le mettre √† jour, j'ai pens√©: pourquoi ai-je besoin d'un routeur s√©par√©, si j'ai d√©j√† un ordinateur gratuit?  Apr√®s tout, puis pendant longtemps, dans le z√©ro, pour beaucoup, c'√©tait une configuration standard. </p><br><p>  En effet: aujourd'hui, pour cela, vous pouvez obtenir une machine virtuelle s√©par√©e, y acheminer une carte Wi-Fi USB ou PCI.  Et en tant que syst√®me d'exploitation, vous pouvez utiliser MikroTik RouterOS d'un seul coup, obtenant un logiciel de niveau entreprise pour peu d'argent. </p><a name="habracut"></a><br><h3 id="vstuplenie">  Entr√©e </h3><br><p>  Je d√©crirai mes buts et objectifs au moment o√π je commen√ßais √† peine le projet: </p><br><ol><li>  L'assemblage doit √™tre compos√© des composants standard les plus courants.  Cela signifie qu'il n'y a pas de cartes m√®res de tailles autres que mATX / mini-ITX et des bo√Ætiers bas dans lesquels les cartes pleine taille ne conviennent pas </li><li>  Il devrait y avoir beaucoup d'espace disque, mais les paniers eux-m√™mes font moins de 2,5 pouces </li><li>  La modularit√© devrait conduire √† des √©conomies apr√®s un certain temps - apr√®s tout, la carte Wi-Fi de l'ancienne norme 5 peut simplement √™tre chang√©e en 7 </li><li>  Prise en charge d'au moins une t√©l√©commande, afin que vous puissiez comprendre pourquoi le syst√®me ne monte pas, sans connecter physiquement le moniteur et le clavier √† quelque chose de haut et de loin </li><li>  Libert√© totale dans le choix d'un syst√®me d'exploitation et leur prise en charge de tous les composants critiques dans n'importe quel syst√®me d'exploitation </li><li>  Haute performance.  Fatigu√© d'attendre que Deluge ¬´vive¬ª .torrent en plusieurs milliers de fichiers ou que le cryptage soit activ√©, cela entra√Æne une baisse de la vitesse en dessous des disques ou de la connexion r√©seau. </li><li>  Beaut√© visuelle et pr√©cision de l'assemblage </li><li>  La plus grande compacit√©.  La taille id√©ale est une console de jeu moderne. </li></ol><br><p>  Je vous pr√©viens imm√©diatement que si vous croyez que dans l'article ci-dessous, je vais vous dire comment compl√©ter tous les points, vous √™tes tr√®s na√Øf et vous feriez mieux d'acheter Synology ou une place dans le cloud. <br>  En fait, je ne vois rien d'irr√©aliste dans une telle d√©cision, c'est juste que je n'ai probablement pas assez bien √©tudi√© l'ensemble de l'offre, et peut-√™tre parce que le march√© des NAS auto-assembl√©s est depuis longtemps en d√©clin et que les composants √† cet effet deviennent plus petits et moins chers. </p><br><h3 id="nemnogo-o-softe">  Un peu de logiciel </h3><br><p>  R√©cemment, je suis devenu si paresseux que je ne voulais m√™me pas configurer KVM moi-m√™me, j'ai donc d√©cid√© d'essayer de voir ce qu'est unRAID, ce que LinusTechTips annon√ßait tant comme une interface graphique pratique pour configurer KVM et comme un bon logiciel pour le NAS dans son ensemble.  Puisque j'√©tais trop paresseux pour fouiner avec mdadm - unRAID a tu√© deux oiseaux avec une pierre. </p><br><h3 id="sborka">  Assemblage </h3><br><h4 id="korpus">  Logement </h4><br><p>  Puis est venu, de fa√ßon surprenante, la partie la plus difficile de l'assemblage d'un NAS de fortune sur des composants standard: choisir un bo√Ætier!  Comme je l'ai dit, l'√©poque o√π l'√©tui avec la porte, derri√®re lequel se trouvent des paniers √† disques est r√©volue depuis longtemps.  Et je voulais toujours vraiment utiliser des disques Seagate 2,5 "(2,5") comme disques (au moment de la r√©daction, la capacit√© maximale est de 5 To).  Ils sont silencieux et prennent peu de place.  Alors que 5 To me suffisaient. </p><br><p>  √âvidemment, la carte m√®re voulait miniITX, car il semblait qu'un emplacement d'extension √©tait suffisant. </p><br><p>  Il s'est av√©r√© qu'il existe des √©tuis compacts de la taille d'un netbook, mais il n'y a qu'un seul emplacement pour 2.5 et les ¬´autres¬ª √©tuis, o√π il y a d√©j√† quelques 3.5 de la taille appropri√©e.  Le milieu n'existe tout simplement pas.  M√™me pour l'argent.  Il y avait quelque chose sur Ali, mais il a √©t√© abandonn√© (v√©rifiez TOUJOURS Ali, √† la recherche de choses inhabituelles, parfois les Chinois ont d√©j√† tout invent√© et mis en production de masse).  Dans un petit forum, j'ai lu sur SilverStone CS01B-HS, mais le prix ne correspondait pas du tout √† la cat√©gorie budg√©taire.  Fatigu√© de la recherche, je l'ai command√© sur Amazon via Shipito, ce qui a compl√®tement √©chou√© au troisi√®me point de la t√¢che technique. </p><br><p>  Mais maintenant, vous ne pouvez plus vous soucier du budget! </p><br><p>  Je vous conseille de r√©aliser imm√©diatement un mod√®le 3D de votre logement Dream et de l'allumer sur une v√©ritable machine CNC aluminium.  Il sera un peu plus cher que le silverstone, mais mille fois plus agr√©able.  Partagez-le plus tard sur le github! </p><br><h4 id="processor">  CPU </h4><br><p>  Bien s√ªr, je voulais prendre AMD comme processeur, 2019 est dans la cour, seuls ceux qui ne plongent pas profond√©ment dans shtud.  Mais, en essayant de respecter le point quatre ¬´Prise en charge de la t√©l√©commande¬ª, je ne trouve AMD que Ryzen DASH et je comprends que dans ce cas, vous devez choisir Intel. </p><br><p>  De plus, tout est comme toujours: Yandex.Market, filtres, googler facilement pour les probl√®mes des enfants et livraison gratuite demain √† l'int√©rieur du MKAD. </p><br><h4 id="matplata">  Carte m√®re </h4><br><p>  √Ä partir des cartes m√®res, en fait, le choix est parmi un - le Gigabyte GA-Q170TN. </p><br><p>  Je ne sais pas pourquoi l'emplacement d'extension n'est que x4, mais si √† l'avenir vous souhaitez y installer une carte r√©seau de dix gigaoctets, il y aura suffisamment de stock (mais vous ne pourrez pas connecter un stockage qui offre de telles performances). </p><br><p>  Parmi les gros avantages: deux emplacements miniPCI-E.  MikroTik publie toutes ses cartes Wi-Fi (et nous en avons besoin, car elles ne sont prises en charge que dans RouterOS) au format miniPCI-E, et produira probablement de nombreuses ann√©es de plus, car il s'agit de leur principal standard pour les cartes d'extension.  Par exemple, vous pouvez acheter leur module <a href="https://mikrotik.com/product/r11e_lora8" rel="nofollow">LoRaWAN</a> et obtenir facilement un support pour les appareils avec LoRa. </p><br><p>  Deux Ethernet, mais 1 Gbps.  En 2017, j'ai propos√© une loi interdisant la vente de cartes m√®res avec des vitesses Ethernet allant jusqu'√† 4 Gbps, mais je n'ai pas r√©ussi √† collecter le nombre de signatures requis pour le passage du filtre municipal. </p><br><h4 id="diski">  Disques </h4><br><p>  Nous prenons deux STDR5000200 comme disques.  Pour une raison quelconque, ils co√ªtent moins cher que les ST5000LM000, qui sont r√©ellement l√†.  Apr√®s l'achat, nous v√©rifions, d√©montons, obtenons le ST5000LM000 et nous nous connectons via SATA.  Dans le cas d'une garantie, vous la r√©cup√©rez et la remettez en recevant un nouveau disque en √©change (je ne plaisante pas, je l'ai fait). </p><br><p>  Je n'ai pas utilis√© le SSD NVMe, peut-√™tre √† l'avenir, si n√©cessaire. </p><br><p>  Intel dans ses meilleures traditions a √©tabli un r√¢teau: il n'y a pas assez de support dans la carte m√®re, le support vPro est √©galement n√©cessaire dans le processeur, et vous vous lasserez de chercher une table de compatibilit√©.  Par miracle, j'ai d√©couvert que j'avais besoin d'un minimum de i5-7500.  Mais comme il n'y avait plus de limite sur le budget, je me suis r√©concili√©. </p><br><p>  Je ne vois rien d'int√©ressant dans les composants restants, ils peuvent √™tre remplac√©s par des analogues, alors voici un tableau g√©n√©ral avec les prix au moment de l'achat: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nom </th><th>  La quantit√© </th><th>  Prix </th><th>  Co√ªt </th></tr></thead><tbody><tr><td>  Crucial DDR4 SO-DIMM 2400MHz PC4-19200 CL17 - 4Gb CT4G4SFS624A </td><td>  2 </td><td>  1 259 </td><td>  2,518 </td></tr><tr><td>  Seagate STDR5000200 </td><td>  2 </td><td>  8 330 </td><td>  16 660 </td></tr><tr><td>  SilverStone CS01B-HS </td><td>  1 </td><td>  159 $ + 17 $ (exp√©dition d'Amazon) + 80 $ (exp√©dition en Russie) = 256 $ </td><td>  16 830 </td></tr><tr><td>  Contr√¥leur PCI-E Espada FG-EST14A-1-BU01 </td><td>  1 </td><td>  2 850 </td><td>  2 850 </td></tr><tr><td>  Bloc d'alimentation SFX 300 W Be quiet SFX POWER 2 BN226 </td><td>  1 </td><td>  4160 </td><td>  4160 </td></tr><tr><td>  Kingston SSD 240GB SUV500MS / 240G {mSATA} </td><td>  1 </td><td>  2 770 </td><td>  2 770 </td></tr><tr><td>  Intel Core i5-7500 </td><td>  1 </td><td>  10 000 </td><td>  10 000 </td></tr><tr><td>  GIGABYTE GA-Q170TN </td><td>  1 </td><td>  9 720 </td><td>  9 720 </td></tr><tr><td>  MikroTik R11e-5HacT </td><td>  1 </td><td>  3,588 </td><td>  3,588 </td></tr><tr><td>  Antennes </td><td>  3 </td><td>  358 </td><td>  1 074 </td></tr><tr><td>  Licence RouterOS niveau 4 </td><td>  1 </td><td>  45 $ </td><td>  2 925 </td></tr><tr><td>  Licence de base UnRAID </td><td>  1 </td><td>  59 $ </td><td>  3 835 </td></tr></tbody></table></div><br><p>  Total 66 930 roubles.  Le troisi√®me point sur la partie √©conomique de la question a √©t√© bris√©, mais l'id√©e que dans dix ans ce fer sera toujours en mesure d'accomplir la t√¢che assign√©e r√©chauffe l'√¢me. </p><br><p>  La mise en place du logiciel a √©t√© assez facile, bon, il l'a: 95% peuvent √™tre cliqu√©s avec la souris en une soir√©e.  Je peux d√©crire cela dans un article s√©par√© si c'est int√©ressant, car tout n'√©tait pas parfait, mais il n'y avait pas de probl√®mes non r√©solus non li√©s √† Google.  Par exemple, il n'√©tait pas si facile de se d√©barrasser des adaptateurs Ethernet c√¢bl√©s dans RouterOS, car sa liste d'√©quipements pris en charge est plut√¥t rare. </p><br><h3 id="vyvody-posle-prohozhdeniya-granicy-v-sto-dney-uptime">  Conclusions apr√®s avoir franchi la fronti√®re d'une centaine de jours de disponibilit√© </h3><br><ol><li>  vPro n'est pas n√©cessaire √† cette fin.  Cela r√©duit consid√©rablement le choix des cartes m√®res et des processeurs, et pour un usage domestique, vous aurez besoin d'un c√¢ble d'extension HDMI sans fil et d'un clavier sans fil.  Dans les cas extr√™mes (le serveur est au sous-sol sous une dalle en b√©ton arm√©) - utilisez une rallonge √† paire torsad√©e. </li><li>  10 gigabits ont √©t√© n√©cessaires hier.  Le disque dur moyen des ann√©es 2010 lit plus vite que 120 m√©gaoctets par seconde, pour lesquels un r√©seau gigabit n'est pas suffisant.  Et nous allons mettre le cache SSD, pour lequel 1,25 Go / s peut devenir une limitation. </li><li>  Le corps a mang√© un quart du budget.  C'est inacceptable. </li><li>  Processeur rapide dans le NAS / routeur - plus n√©cessaire qu'il n'y paraissait initialement </li><li>  unRAID est vraiment un bon logiciel, il y a tout ce qui est n√©cessaire et il n'y a rien qui ne soit pas n√©cessaire.  Vous payez une fois, si vous avez besoin de plus de disques - ils ne demandent que la diff√©rence de co√ªt des licences. </li></ol><br><p>  Mon ancien hap ac donnait environ 20 m√©gabits avec le cryptage du tunnel VPN activ√©.  Maintenant, un seul c≈ìur i5-7500 suffit pour distribuer des gigabits. </p><br><img src="https://habrastorage.org/webt/m1/i-/kb/m1i-kbxxfxmtko2p9bec5neooaq.png"><br><h3 id="ps">  PS </h3><br><p>  Je suis tr√®s content que vous lisiez jusqu'au bout et cela vous a int√©ress√©!  Veuillez poser des questions si quelque chose n'est pas clair.  J'aurais pu compl√®tement oublier. </p><br><p>  Je r√©pondrai imm√©diatement √† l'√©vidence: </p><br><p>  <strong>- Pourquoi tout cela, vous pouvez simplement acheter Synology?</strong> <br>  "Oui, et je vous conseille de le faire."  C'est plus simple, plus rapide, moins cher et plus fiable.  Un article pour les passionn√©s qui savent pourquoi ils ont besoin de fonctionnalit√©s suppl√©mentaires. </p><br><p>  <strong>- Pourquoi pas FreeNAS, y a-t-il tout ce qui est dans unRAID, mais gratuit?</strong> <br>  - H√©las, l'open source est d√©j√† compl√®tement diff√©rent.  FreeNAS est √©crit par exactement les m√™mes programmeurs de paie.  Et si vous obtenez leur travail gratuitement, le produit final est vous.  Ou ils cesseront bient√¥t de payer l'investisseur. </p><br><p>  <strong>- Vous pouvez tout faire sur Linux pur et √©conomiser plus!</strong> <br>  - Oui.  Une fois que je l'ai fait.  Mais pourquoi?  Pour moi, la mise en place d'un r√©seau sous Linux a toujours √©t√© un probl√®me.  Que cela reste des concierges informatiques.  Et RouterOS r√©sout compl√®tement cette classe de probl√®mes.  Il en va de m√™me avec MD RAID: malgr√© le fait que mdadm ne vous permette pas de faire des erreurs stupides, j'ai quand m√™me perdu les donn√©es.  Et unRAID ne vous permet tout simplement pas d'appuyer sur le mauvais bouton.  Encore une fois, vous ne devriez pas perdre votre temps √† configurer manuellement le r√©f√©rentiel. </p><br><p>  <strong>- Mais vous avez quand m√™me install√© l'ubuntu habituel dans une machine virtuelle!</strong> <br>  - Pour cela, tout a commenc√©.  Maintenant, vous avez votre AWS personnel avec la vitesse maximale de connexion √† votre stockage, √† votre r√©seau domestique et √† Internet en m√™me temps, ce que personne ne peut vous donner.  Et c'est vous qui d√©cidez des services √† ex√©cuter dans cette machine virtuelle. </p><br><p>  <strong>- Tout probl√®me dans la maison imm√©diatement il n'y a pas de Wi-Fi, pas d'Internet, pas de stockage.</strong> <br>  - Un routeur de rechange ment pour 1000 roubles et rien ne sortira des disques.  Pour tout le temps, √† l'exception des disques et des refroidisseurs, rien ne s'est cass√©.  M√™me un nettop ordinaire fonctionne 24h / 24 et 7j / 7 depuis pr√®s de dix ans et se sent bien en ce moment.  Surv√©cu √† deux disques. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477810/">https://habr.com/ru/post/fr477810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477792/index.html">Quand gagner est votre profil</a></li>
<li><a href="../fr477800/index.html">Faits saillants du forum de d√©veloppement Web Chrome Web Dev Summit 2019</a></li>
<li><a href="../fr477802/index.html">Bo√Ætier pour appareil √©lectronique: comment le concevoir et le fabriquer en Chine</a></li>
<li><a href="../fr477804/index.html">Le chemin vers l'intelligence naturelle</a></li>
<li><a href="../fr477808/index.html">Nous nous d√©barrassons des avertissements g√™nants lors de l'entr√©e dans le serveur de terminal</a></li>
<li><a href="../fr477812/index.html">Examen de la l√©gislation russe pour prot√©ger les infrastructures d'informations critiques</a></li>
<li><a href="../fr477814/index.html">Existe-t-il des virus sous Mac?</a></li>
<li><a href="../fr477816/index.html">Comment trouver un emploi avec un bon contrat</a></li>
<li><a href="../fr477818/index.html">Comment devenir Data Scientist en 2019</a></li>
<li><a href="../fr477820/index.html">VMware, Hyper-V, OpenStack, Kubernetes, Swarm - surveillance √† partir d'une seule interface dans Quest Foglight</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>