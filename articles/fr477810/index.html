<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🌾 👩🏾‍🚒 💏 Nous fabriquons un routeur et un NAS sur un seul processeur 👩🏾‍🤝‍👩🏻 📶 📭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article a une suite . 


 J'ai obtenu un «serveur domestique» sous Linux quelques années seulement après avoir acheté un ordinateur. Maintenant, à...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous fabriquons un routeur et un NAS sur un seul processeur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477810/"><p>  Cet article a une <a href="https://habr.com/ru/post/478924/">suite</a> . </p><br><p>  J'ai obtenu un «serveur domestique» sous Linux quelques années seulement après avoir acheté un ordinateur.  Maintenant, à partir de ce moment, plus de quinze ans se sont écoulés et la plupart du temps, j'avais une sorte de deuxième ordinateur supplémentaire à la maison.  Une fois, quand est venu le temps de le mettre à jour, j'ai pensé: pourquoi ai-je besoin d'un routeur séparé, si j'ai déjà un ordinateur gratuit?  Après tout, puis pendant longtemps, dans le zéro, pour beaucoup, c'était une configuration standard. </p><br><p>  En effet: aujourd'hui, pour cela, vous pouvez obtenir une machine virtuelle séparée, y acheminer une carte Wi-Fi USB ou PCI.  Et en tant que système d'exploitation, vous pouvez utiliser MikroTik RouterOS d'un seul coup, obtenant un logiciel de niveau entreprise pour peu d'argent. </p><a name="habracut"></a><br><h3 id="vstuplenie">  Entrée </h3><br><p>  Je décrirai mes buts et objectifs au moment où je commençais à peine le projet: </p><br><ol><li>  L'assemblage doit être composé des composants standard les plus courants.  Cela signifie qu'il n'y a pas de cartes mères de tailles autres que mATX / mini-ITX et des boîtiers bas dans lesquels les cartes pleine taille ne conviennent pas </li><li>  Il devrait y avoir beaucoup d'espace disque, mais les paniers eux-mêmes font moins de 2,5 pouces </li><li>  La modularité devrait conduire à des économies après un certain temps - après tout, la carte Wi-Fi de l'ancienne norme 5 peut simplement être changée en 7 </li><li>  Prise en charge d'au moins une télécommande, afin que vous puissiez comprendre pourquoi le système ne monte pas, sans connecter physiquement le moniteur et le clavier à quelque chose de haut et de loin </li><li>  Liberté totale dans le choix d'un système d'exploitation et leur prise en charge de tous les composants critiques dans n'importe quel système d'exploitation </li><li>  Haute performance.  Fatigué d'attendre que Deluge «vive» .torrent en plusieurs milliers de fichiers ou que le cryptage soit activé, cela entraîne une baisse de la vitesse en dessous des disques ou de la connexion réseau. </li><li>  Beauté visuelle et précision de l'assemblage </li><li>  La plus grande compacité.  La taille idéale est une console de jeu moderne. </li></ol><br><p>  Je vous préviens immédiatement que si vous croyez que dans l'article ci-dessous, je vais vous dire comment compléter tous les points, vous êtes très naïf et vous feriez mieux d'acheter Synology ou une place dans le cloud. <br>  En fait, je ne vois rien d'irréaliste dans une telle décision, c'est juste que je n'ai probablement pas assez bien étudié l'ensemble de l'offre, et peut-être parce que le marché des NAS auto-assemblés est depuis longtemps en déclin et que les composants à cet effet deviennent plus petits et moins chers. </p><br><h3 id="nemnogo-o-softe">  Un peu de logiciel </h3><br><p>  Récemment, je suis devenu si paresseux que je ne voulais même pas configurer KVM moi-même, j'ai donc décidé d'essayer de voir ce qu'est unRAID, ce que LinusTechTips annonçait tant comme une interface graphique pratique pour configurer KVM et comme un bon logiciel pour le NAS dans son ensemble.  Puisque j'étais trop paresseux pour fouiner avec mdadm - unRAID a tué deux oiseaux avec une pierre. </p><br><h3 id="sborka">  Assemblage </h3><br><h4 id="korpus">  Logement </h4><br><p>  Puis est venu, de façon surprenante, la partie la plus difficile de l'assemblage d'un NAS de fortune sur des composants standard: choisir un boîtier!  Comme je l'ai dit, l'époque où l'étui avec la porte, derrière lequel se trouvent des paniers à disques est révolue depuis longtemps.  Et je voulais toujours vraiment utiliser des disques Seagate 2,5 "(2,5") comme disques (au moment de la rédaction, la capacité maximale est de 5 To).  Ils sont silencieux et prennent peu de place.  Alors que 5 To me suffisaient. </p><br><p>  Évidemment, la carte mère voulait miniITX, car il semblait qu'un emplacement d'extension était suffisant. </p><br><p>  Il s'est avéré qu'il existe des étuis compacts de la taille d'un netbook, mais il n'y a qu'un seul emplacement pour 2.5 et les «autres» étuis, où il y a déjà quelques 3.5 de la taille appropriée.  Le milieu n'existe tout simplement pas.  Même pour l'argent.  Il y avait quelque chose sur Ali, mais il a été abandonné (vérifiez TOUJOURS Ali, à la recherche de choses inhabituelles, parfois les Chinois ont déjà tout inventé et mis en production de masse).  Dans un petit forum, j'ai lu sur SilverStone CS01B-HS, mais le prix ne correspondait pas du tout à la catégorie budgétaire.  Fatigué de la recherche, je l'ai commandé sur Amazon via Shipito, ce qui a complètement échoué au troisième point de la tâche technique. </p><br><p>  Mais maintenant, vous ne pouvez plus vous soucier du budget! </p><br><p>  Je vous conseille de réaliser immédiatement un modèle 3D de votre logement Dream et de l'allumer sur une véritable machine CNC aluminium.  Il sera un peu plus cher que le silverstone, mais mille fois plus agréable.  Partagez-le plus tard sur le github! </p><br><h4 id="processor">  CPU </h4><br><p>  Bien sûr, je voulais prendre AMD comme processeur, 2019 est dans la cour, seuls ceux qui ne plongent pas profondément dans shtud.  Mais, en essayant de respecter le point quatre «Prise en charge de la télécommande», je ne trouve AMD que Ryzen DASH et je comprends que dans ce cas, vous devez choisir Intel. </p><br><p>  De plus, tout est comme toujours: Yandex.Market, filtres, googler facilement pour les problèmes des enfants et livraison gratuite demain à l'intérieur du MKAD. </p><br><h4 id="matplata">  Carte mère </h4><br><p>  À partir des cartes mères, en fait, le choix est parmi un - le Gigabyte GA-Q170TN. </p><br><p>  Je ne sais pas pourquoi l'emplacement d'extension n'est que x4, mais si à l'avenir vous souhaitez y installer une carte réseau de dix gigaoctets, il y aura suffisamment de stock (mais vous ne pourrez pas connecter un stockage qui offre de telles performances). </p><br><p>  Parmi les gros avantages: deux emplacements miniPCI-E.  MikroTik publie toutes ses cartes Wi-Fi (et nous en avons besoin, car elles ne sont prises en charge que dans RouterOS) au format miniPCI-E, et produira probablement de nombreuses années de plus, car il s'agit de leur principal standard pour les cartes d'extension.  Par exemple, vous pouvez acheter leur module <a href="https://mikrotik.com/product/r11e_lora8" rel="nofollow">LoRaWAN</a> et obtenir facilement un support pour les appareils avec LoRa. </p><br><p>  Deux Ethernet, mais 1 Gbps.  En 2017, j'ai proposé une loi interdisant la vente de cartes mères avec des vitesses Ethernet allant jusqu'à 4 Gbps, mais je n'ai pas réussi à collecter le nombre de signatures requis pour le passage du filtre municipal. </p><br><h4 id="diski">  Disques </h4><br><p>  Nous prenons deux STDR5000200 comme disques.  Pour une raison quelconque, ils coûtent moins cher que les ST5000LM000, qui sont réellement là.  Après l'achat, nous vérifions, démontons, obtenons le ST5000LM000 et nous nous connectons via SATA.  Dans le cas d'une garantie, vous la récupérez et la remettez en recevant un nouveau disque en échange (je ne plaisante pas, je l'ai fait). </p><br><p>  Je n'ai pas utilisé le SSD NVMe, peut-être à l'avenir, si nécessaire. </p><br><p>  Intel dans ses meilleures traditions a établi un râteau: il n'y a pas assez de support dans la carte mère, le support vPro est également nécessaire dans le processeur, et vous vous lasserez de chercher une table de compatibilité.  Par miracle, j'ai découvert que j'avais besoin d'un minimum de i5-7500.  Mais comme il n'y avait plus de limite sur le budget, je me suis réconcilié. </p><br><p>  Je ne vois rien d'intéressant dans les composants restants, ils peuvent être remplacés par des analogues, alors voici un tableau général avec les prix au moment de l'achat: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nom </th><th>  La quantité </th><th>  Prix </th><th>  Coût </th></tr></thead><tbody><tr><td>  Crucial DDR4 SO-DIMM 2400MHz PC4-19200 CL17 - 4Gb CT4G4SFS624A </td><td>  2 </td><td>  1 259 </td><td>  2,518 </td></tr><tr><td>  Seagate STDR5000200 </td><td>  2 </td><td>  8 330 </td><td>  16 660 </td></tr><tr><td>  SilverStone CS01B-HS </td><td>  1 </td><td>  159 $ + 17 $ (expédition d'Amazon) + 80 $ (expédition en Russie) = 256 $ </td><td>  16 830 </td></tr><tr><td>  Contrôleur PCI-E Espada FG-EST14A-1-BU01 </td><td>  1 </td><td>  2 850 </td><td>  2 850 </td></tr><tr><td>  Bloc d'alimentation SFX 300 W Be quiet SFX POWER 2 BN226 </td><td>  1 </td><td>  4160 </td><td>  4160 </td></tr><tr><td>  Kingston SSD 240GB SUV500MS / 240G {mSATA} </td><td>  1 </td><td>  2 770 </td><td>  2 770 </td></tr><tr><td>  Intel Core i5-7500 </td><td>  1 </td><td>  10 000 </td><td>  10 000 </td></tr><tr><td>  GIGABYTE GA-Q170TN </td><td>  1 </td><td>  9 720 </td><td>  9 720 </td></tr><tr><td>  MikroTik R11e-5HacT </td><td>  1 </td><td>  3,588 </td><td>  3,588 </td></tr><tr><td>  Antennes </td><td>  3 </td><td>  358 </td><td>  1 074 </td></tr><tr><td>  Licence RouterOS niveau 4 </td><td>  1 </td><td>  45 $ </td><td>  2 925 </td></tr><tr><td>  Licence de base UnRAID </td><td>  1 </td><td>  59 $ </td><td>  3 835 </td></tr></tbody></table></div><br><p>  Total 66 930 roubles.  Le troisième point sur la partie économique de la question a été brisé, mais l'idée que dans dix ans ce fer sera toujours en mesure d'accomplir la tâche assignée réchauffe l'âme. </p><br><p>  La mise en place du logiciel a été assez facile, bon, il l'a: 95% peuvent être cliqués avec la souris en une soirée.  Je peux décrire cela dans un article séparé si c'est intéressant, car tout n'était pas parfait, mais il n'y avait pas de problèmes non résolus non liés à Google.  Par exemple, il n'était pas si facile de se débarrasser des adaptateurs Ethernet câblés dans RouterOS, car sa liste d'équipements pris en charge est plutôt rare. </p><br><h3 id="vyvody-posle-prohozhdeniya-granicy-v-sto-dney-uptime">  Conclusions après avoir franchi la frontière d'une centaine de jours de disponibilité </h3><br><ol><li>  vPro n'est pas nécessaire à cette fin.  Cela réduit considérablement le choix des cartes mères et des processeurs, et pour un usage domestique, vous aurez besoin d'un câble d'extension HDMI sans fil et d'un clavier sans fil.  Dans les cas extrêmes (le serveur est au sous-sol sous une dalle en béton armé) - utilisez une rallonge à paire torsadée. </li><li>  10 gigabits ont été nécessaires hier.  Le disque dur moyen des années 2010 lit plus vite que 120 mégaoctets par seconde, pour lesquels un réseau gigabit n'est pas suffisant.  Et nous allons mettre le cache SSD, pour lequel 1,25 Go / s peut devenir une limitation. </li><li>  Le corps a mangé un quart du budget.  C'est inacceptable. </li><li>  Processeur rapide dans le NAS / routeur - plus nécessaire qu'il n'y paraissait initialement </li><li>  unRAID est vraiment un bon logiciel, il y a tout ce qui est nécessaire et il n'y a rien qui ne soit pas nécessaire.  Vous payez une fois, si vous avez besoin de plus de disques - ils ne demandent que la différence de coût des licences. </li></ol><br><p>  Mon ancien hap ac donnait environ 20 mégabits avec le cryptage du tunnel VPN activé.  Maintenant, un seul cœur i5-7500 suffit pour distribuer des gigabits. </p><br><img src="https://habrastorage.org/webt/m1/i-/kb/m1i-kbxxfxmtko2p9bec5neooaq.png"><br><h3 id="ps">  PS </h3><br><p>  Je suis très content que vous lisiez jusqu'au bout et cela vous a intéressé!  Veuillez poser des questions si quelque chose n'est pas clair.  J'aurais pu complètement oublier. </p><br><p>  Je répondrai immédiatement à l'évidence: </p><br><p>  <strong>- Pourquoi tout cela, vous pouvez simplement acheter Synology?</strong> <br>  "Oui, et je vous conseille de le faire."  C'est plus simple, plus rapide, moins cher et plus fiable.  Un article pour les passionnés qui savent pourquoi ils ont besoin de fonctionnalités supplémentaires. </p><br><p>  <strong>- Pourquoi pas FreeNAS, y a-t-il tout ce qui est dans unRAID, mais gratuit?</strong> <br>  - Hélas, l'open source est déjà complètement différent.  FreeNAS est écrit par exactement les mêmes programmeurs de paie.  Et si vous obtenez leur travail gratuitement, le produit final est vous.  Ou ils cesseront bientôt de payer l'investisseur. </p><br><p>  <strong>- Vous pouvez tout faire sur Linux pur et économiser plus!</strong> <br>  - Oui.  Une fois que je l'ai fait.  Mais pourquoi?  Pour moi, la mise en place d'un réseau sous Linux a toujours été un problème.  Que cela reste des concierges informatiques.  Et RouterOS résout complètement cette classe de problèmes.  Il en va de même avec MD RAID: malgré le fait que mdadm ne vous permette pas de faire des erreurs stupides, j'ai quand même perdu les données.  Et unRAID ne vous permet tout simplement pas d'appuyer sur le mauvais bouton.  Encore une fois, vous ne devriez pas perdre votre temps à configurer manuellement le référentiel. </p><br><p>  <strong>- Mais vous avez quand même installé l'ubuntu habituel dans une machine virtuelle!</strong> <br>  - Pour cela, tout a commencé.  Maintenant, vous avez votre AWS personnel avec la vitesse maximale de connexion à votre stockage, à votre réseau domestique et à Internet en même temps, ce que personne ne peut vous donner.  Et c'est vous qui décidez des services à exécuter dans cette machine virtuelle. </p><br><p>  <strong>- Tout problème dans la maison immédiatement il n'y a pas de Wi-Fi, pas d'Internet, pas de stockage.</strong> <br>  - Un routeur de rechange ment pour 1000 roubles et rien ne sortira des disques.  Pour tout le temps, à l'exception des disques et des refroidisseurs, rien ne s'est cassé.  Même un nettop ordinaire fonctionne 24h / 24 et 7j / 7 depuis près de dix ans et se sent bien en ce moment.  Survécu à deux disques. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477810/">https://habr.com/ru/post/fr477810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477792/index.html">Quand gagner est votre profil</a></li>
<li><a href="../fr477800/index.html">Faits saillants du forum de développement Web Chrome Web Dev Summit 2019</a></li>
<li><a href="../fr477802/index.html">Boîtier pour appareil électronique: comment le concevoir et le fabriquer en Chine</a></li>
<li><a href="../fr477804/index.html">Le chemin vers l'intelligence naturelle</a></li>
<li><a href="../fr477808/index.html">Nous nous débarrassons des avertissements gênants lors de l'entrée dans le serveur de terminal</a></li>
<li><a href="../fr477812/index.html">Examen de la législation russe pour protéger les infrastructures d'informations critiques</a></li>
<li><a href="../fr477814/index.html">Existe-t-il des virus sous Mac?</a></li>
<li><a href="../fr477816/index.html">Comment trouver un emploi avec un bon contrat</a></li>
<li><a href="../fr477818/index.html">Comment devenir Data Scientist en 2019</a></li>
<li><a href="../fr477820/index.html">VMware, Hyper-V, OpenStack, Kubernetes, Swarm - surveillance à partir d'une seule interface dans Quest Foglight</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>