<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏻 🤷 ⭕️ 在Travis CI中自动在Windows上构建Qt项目 👩🏼‍🌾 👨🏽‍🚀 😨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近，对于QtProtobuf，我感到困惑的是设置了一个笨拙的 CI来验证又名拉取请求，当然还要在项目的README中插入一个时髦的徽章。 选择为GitHub Actions和Travis CI 。 老实说，我没有开始搜索，比较，分析，我想要简单和快速的解决方案来完成一个非常简单的任务。 首先，我确...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在Travis CI中自动在Windows上构建Qt项目</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485034/"><p> 最近，对于<a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">QtProtobuf，</a>我感到困惑的是设置了一个<a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">笨拙的</a> CI来验证又名拉取请求，当然还要在项目的README中插入一个时髦的徽章。 选择为<a href="https://github.com/features/actions" rel="nofollow">GitHub Actions</a>和<a href="https://travis-ci.com/" rel="nofollow">Travis CI</a> 。 老实说，我没有开始搜索，比较，分析，我想要简单和快速的解决方案来完成一个非常简单的任务。 首先，我确定了GitHub Actions的CI，并通过docker容器设置了构建和单元测试验证。 但是由于种种限制，GitHub Actions根本不适合Windows中的项目验证。 我不得不求助于Travis CI。 </p><br><p>  <em>KDPV_not_found.png</em> </p><a name="habracut"></a><br><p> 在Travis CI撰写本文时，有一个免责声明： </p><br><blockquote>  Windows版本处于早期访问阶段。 请前往Travis CI社区论坛以获取帮助或发表想法。 </blockquote><p> 这引起了人们的关注，因为最初我尝试通过docker容器配置所有内容，然后将其放入GitHub Actions，但是由于容器的大小，类型等方面的限制，这项尝试失败了。 在github上 </p><br><h2 id="k-delu"> 对企业 </h2><br><p>首先，您需要在GitHub上授权Travis CI，之后Travis CI <a href="https://github.com/settings/installations" rel="nofollow">应用程序</a>将出现在您的个人资料设置中。 方便地，您可以定义Travis CI可以访问的存储库： </p><br><p><img src="https://habrastorage.org/webt/x-/rl/lc/x-rllc93_hpbwe6vsoyqhd6ckj8.png"></p><br><p> 下一步是配置Travis CI触发器。 此过程已在Travis CI本身的管理面板中完成；在撰写本文时，以下触发器可用： </p><br><ul><li> 将启动推送到任何项目早午餐 </li><li> 创建合并请求时运行 </li><li> 定时触发（定时） </li></ul><br><p> 原则上讲，这是构建CI的合适工具。 </p><br><p> 在选择要运行构建的触发器之后，您需要创建<em>.travis.yml</em> ，其中包含构建过程的描述，然后根据可用触发器将此文件放入存储库中。  Travis CI本身有关<em>.travis.yml</em>的零散，无系统的文档立刻引起了困惑，但是您可以根据需要弄清楚。 </p><br><p> 站立的主要任务是为装配准备环境，因为装配本身和验证是CMake的业务。 </p><br><h2 id="opisyvaem-proceduru-sborki-v-travisyml"> 我们在<em>.travis.yml中</em>描述了组装过程 </h2><br><p> 首先，您需要选择一个在Travis CI服务器上作为虚拟机运行的操作系统以及一种编程语言。 </p><br><pre><code class="plaintext hljs">os: windows language: C++ ...</code> </pre> <br><p> 据我了解， <em>language语言</em>会自动执行某些步骤（如果未明确指定），但是对我来说这是一个谜。 我以为没有它，就不会预安装MSVC，但是在实验过程中，事实证明它也存在于其他语言中。 </p><br><p> 下一步是下载并安装必要的依赖项。 对于QtProtobuf，这些是： </p><br><ul><li>  Qt 5.12.3或更高 </li><li>  cmake-3.1或更高 </li><li> 草莓perl 5.28或更高 </li><li>  GoLang 1.10或更高版本 </li><li>  Yasm 1.3或更高 </li><li>  Visual Studio编译器14.16.x </li></ul><br><p> 而Travis CI在这里大有<a href="https://docs.travis-ci.com/user/reference/windows/" rel="nofollow">帮助</a> 。 预安装的软件包中不仅包括Git和MSVC，还包括cmake，wget和<a href="https://chocolatey.org/" rel="nofollow">Chocolatey</a> 。 在存在巧克力味的普里斯尼普（prisnip）中，极大地促进了依赖关系的进一步安装。 的确，为什么Qt尚未交付使用巧克力，这仍然是一个谜。 </p><br><p> 首先，请从官方存储库下载完整的Qt安装程序： </p><br><pre> <code class="plaintext hljs">... before_install: - wget -q https://download.qt.io/official_releases/qt/5.13/5.13.2/qt-opensource-windows-x86-5.13.2.exe ...</code> </pre> <br><blockquote>  <em>注意：</em>下载时，wget会转储大量具有下载进度的日志。 像GitHub一样，Travis CI对构建日志的大小有限制，因此应避免不必要的日志。  -q aka --quite选项隐藏wget日志输出。 </blockquote><p> 我们进行必要的依赖项的安装： </p><br><pre> <code class="plaintext hljs">... install: - choco install golang - choco install yasm - ./qt-opensource-windows-x86-5.13.2.exe --script ./.ci/qt_installer_windows.qs ...</code> </pre> <br><p> 通过安装GoLang和Yasm，我认为应该没有问题。 但是启动Qt安装程序后，我会更加注意。 </p><br><p>  <a href="https://doc.qt.io/qtinstallerframework/index.html" rel="nofollow">QtInstallerFramework</a>通过编写<a href="https://doc.qt.io/qtinstallerframework/noninteractive.html" rel="nofollow">脚本</a> <a href="https://doc.qt.io/qtinstallerframework/index.html" rel="nofollow">来</a>支持安装过程的自动化。 </p><br><p> 对于谷歌来说，用于安装特定版本的Qt的现成脚本非常简单，我将只提供一个指向我现有Qt的链接，并注意安装组件的选择： </p><br><pre> <code class="plaintext hljs">... Controller.prototype.ComponentSelectionPageCallback = function() { var widget = gui.currentPageWidget(); widget.deselectAll(); widget.selectComponent("qt.qt5.5132.win32_msvc2017"); gui.clickButton(buttons.NextButton); } ...</code> </pre> <br><p> 在这里，我通过调用<code>widget.deselectAll();</code>关闭所有复选框组件<code>widget.deselectAll();</code> 并包含构建所需的“ <em>qt.qt5.5132.win32_msvc2017</em> ”。 编写此过程时，有两个方面很重要： </p><br><ul><li>  selectComponent与图形组件的工作原理相同，因此依赖项和子组件是根据与我们在图形界面中选择它们相同的逻辑选择的。 这就是为什么无需担心解决依赖关系的原因。 </li><li> 可以在“语言”安装模式下查看组件的名称。 为此，我在其中一次迭代中执行了<code>widget.selectAll();</code> 并使用<code>- ./qt-opensource-windows-x86-5.13.2.exe --verbose --script ./.ci/qt_installer_windows.qs</code>命令开始安装。 在日志中，您可以轻松地找到所需的所有组件，并使用widget.selectComponent / widget.deselectComponent来简化其安装。 </li></ul><br><p> 我将在本教程中讨论的最后一个重点是构建环境。 由于依赖项和程序集的安装是在同一shell中进行的，因此在我们的shell中设置Go和Yasm之后，在可执行文件之前没有注册的PATH。 因此，在进行虚脱之前，必须手动注册PATH，GOROOT： </p><br><pre> <code class="plaintext hljs">script: ... - setx path "%path%;C:\Qt\5.13.2\msvc2017\bin;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" - set GOROOT="c:\Go" - set PATH="%PATH%;C:\Qt\5.13.2\msvc2017\bin;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" - cmake -DCMAKE_PREFIX_PATH="C:\Qt\5.13.2\msvc2017;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" .. ...</code> </pre> <br><p> 我还想注意一个事实，以此类推，在CMAKE_PREFIX_PATH中，您需要指定Go和Yasm的路径，以使find_program函数正常工作。 </p><br><p> 也许稍后，我将描述如何在船上使用Qt进行构建的docker容器的创建。 </p><br><p> 所有脚本都可以在<a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">这里</a>找到<a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">。</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN485034/">https://habr.com/ru/post/zh-CN485034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN485024/index.html">什么是GraalVM编译器优化的内幕？</a></li>
<li><a href="../zh-CN485026/index.html">佐治亚州IT专业人员的机会</a></li>
<li><a href="../zh-CN485028/index.html">客户关系管理2020</a></li>
<li><a href="../zh-CN485030/index.html">现在排名前8位的IEO费用及其资本化</a></li>
<li><a href="../zh-CN485032/index.html">如何通过状态共托管使React应用程序更快</a></li>
<li><a href="../zh-CN485036/index.html">为什么需要关键分页的工具支持</a></li>
<li><a href="../zh-CN485042/index.html">由于强制性5G支持，配备Snapdragon 865的智能手机在2020年将变得更糟</a></li>
<li><a href="../zh-CN485046/index.html">如何规划成功的产品策略</a></li>
<li><a href="../zh-CN485050/index.html">超立方体。 我们如何为开发人员提供测试设备而又不会丢失它们</a></li>
<li><a href="../zh-CN485052/index.html">谁是好的质量检查人员？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>