<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüè≠ üï† üíáüèø Hacer el bien, hacer el mal: escribir c√≥digo malvado con Go, parte 2 üññ üö≥ üßõüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Malos consejos para un programador de Go 



 En la primera parte de la publicaci√≥n, expliqu√© c√≥mo convertirse en un programador Go "malicioso". El ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hacer el bien, hacer el mal: escribir c√≥digo malvado con Go, parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460911/">  <i><b>Malos consejos para un programador de Go</b></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/265/872/8cc265872daa29a415c830378896ad61.png" alt="imagen"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En la primera parte de la publicaci√≥n,</a> expliqu√© c√≥mo convertirse en un programador Go "malicioso".  El mal viene en muchas formas, pero en la programaci√≥n radica en la dificultad deliberada de comprender y mantener el c√≥digo.  Los programas malvados ignoran los medios b√°sicos del lenguaje a favor de las t√©cnicas que proporcionan beneficios a corto plazo a cambio de problemas a largo plazo.  Como breve recordatorio, las "pr√°cticas" malvadas de Go incluyen: <br><br><ul><li>  Paquetes mal nombrados y organizados </li><li>  Interfaces mal organizadas </li><li>  Pasar punteros a variables en funciones para llenar sus valores </li><li>  Usando p√°nico en lugar de errores </li><li>  Usar funciones de inicio e importaciones vac√≠as para configurar dependencias </li><li>  Descargue archivos de configuraci√≥n utilizando las funciones de inicio </li><li>  Usar marcos en lugar de bibliotecas </li></ul><br><h3>  Gran bola del mal </h3><br>  ¬øQu√© pasa si juntamos todas nuestras malas pr√°cticas?  Tendr√≠amos un marco de trabajo que usar√≠a muchos archivos de configuraci√≥n, completar√≠a los campos de estructura utilizando punteros, definir√≠a interfaces para describir los tipos publicados, se basar√≠a en c√≥digo "m√°gico" y entrar√≠a en p√°nico cuando ocurriera un problema. <br><br>  Y lo hice  Si va a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/evil-go</a> , ver√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fall</a> , un marco de DI que le permite implementar las pr√°cticas "malvadas" que desee.  He soldado Fall con un peque√±o framework web Outboy que sigue los mismos principios. <br><br>  Puedes preguntar qu√© tan villanos son?  A ver  Sugiero ir a un programa simple de Go (escrito utilizando las mejores pr√°cticas) que proporciona el punto final http.  Y luego reescr√≠balo usando Fall and Outboy. <br><a name="habracut"></a><br><h3>  Mejores pr√°cticas </h3><br>  Nuestro programa se encuentra en un √∫nico paquete llamado greet, que utiliza todas las funciones b√°sicas para implementar nuestro punto final.  Como este es un ejemplo, utilizamos un DAO de memoria en funcionamiento, con tres campos para los valores que devolveremos.  Tambi√©n tendremos un m√©todo que, dependiendo de la entrada, reemplaza la llamada a nuestra base de datos y devuelve el saludo deseado. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> greet <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Dao <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sdi Dao)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetingForName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> name { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.BobMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Julia"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.JuliaMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.DefaultMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br>  Lo siguiente es la l√≥gica de negocios.  Para implementarlo, definimos una estructura para almacenar datos de salida, una interfaz de GreetingFinder para describir lo que la l√≥gica de negocios est√° buscando en el nivel de b√∫squeda de datos y una estructura para almacenar la l√≥gica de negocios con un campo para GreetingFinder.  La l√≥gica real es simple: solo llama a GreetingFinder y maneja cualquier error que pueda ocurrir. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Response <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetingFinder <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { GreetingForName(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Service <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { GreetingFinder GreetingFinder } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ssi Service)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Response, error)</span></span></span></span> { msg, err := ssi.GreetingFinder.GreetingForName(name) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response{}, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response{Message: msg}, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Luego viene la capa web, y para esta parte definimos la interfaz Greeter, que proporciona toda la l√≥gica de negocios que necesitamos, as√≠ como la estructura que contiene el controlador http configurado usando Greeter.  Luego creamos un m√©todo para implementar la interfaz http.Handler, que divide la solicitud http, llama a greeter-a (saludo), procesa errores y devuelve los resultados. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Greeter <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Greeting(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) (Response, error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Controller <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Greeter Greeter } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc Controller)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServeHTTP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rw http.ResponseWriter, req *http.Request)</span></span></span></span> { result, err := mc.Greeter.Greeting( req.URL.Query().Get(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { rw.WriteHeader(http.StatusInternalServerError) rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(err.Error())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(result.Message)) }</code> </pre> <br>  Este es el final del paquete de bienvenida.  A continuaci√≥n, veremos c√≥mo un desarrollador de Go "bueno" escribir√≠a main para usar este paquete.  En el paquete principal, definimos una estructura llamada Config, que contiene las propiedades que necesitamos ejecutar.  La funci√≥n principal hace 3 cosas. <br><br><ul><li>  Primero, llama a la funci√≥n loadProperties, que usa una biblioteca simple ( <a href="">https://github.com/evil-go/good-sample/blob/master/config/config.go</a> ) para cargar propiedades del archivo de configuraci√≥n y las coloca en nuestra copia de una configuraci√≥n.  Si la descarga de la configuraci√≥n falla, la funci√≥n principal informa un error y se cierra. </li><li>  En segundo lugar, la funci√≥n principal vincula los componentes en el paquete greet, asign√°ndoles expl√≠citamente valores de la configuraci√≥n y configurando las dependencias. </li><li>  En tercer lugar, llama a una peque√±a biblioteca de servidor ( <a href="">https://github.com/evil-go/good-sample/blob/master/server/server.go</a> ) y pasa la direcci√≥n, el m√©todo HTTP y http.Handler al punto final para procesamiento de solicitudes.  Una llamada a la biblioteca inicia un servicio web.  Y esta es toda nuestra aplicaci√≥n. </li></ul><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { c, err := loadProperties() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } dao := greet.Dao{ DefaultMessage: c.DefaultMessage, BobMessage: c.BobMessage, JuliaMessage: c.JuliaMessage, } svc := greet.Service{GreetingFinder: dao} controller := greet.Controller{Greeter: svc} err = server.Start(server.Endpoint{c.Path, http.MethodGet, controller}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br>  El ejemplo es bastante corto, pero muestra lo genial que est√° escrito Go;  Algunas cosas son ambiguas, pero en general est√° claro lo que est√° sucediendo.  Pegamos bibliotecas peque√±as que est√°n configuradas espec√≠ficamente para trabajar juntas.  Nada est√° oculto;  cualquiera puede tomar este c√≥digo, comprender c√≥mo est√°n conectadas sus partes y, si es necesario, rehacerlas a otras nuevas. <br><br><h3>  Punto negro </h3><br>  Ahora consideraremos la versi√≥n de Fall and Outboy.  Lo primero que haremos es dividir el paquete de saludo en varios paquetes, cada uno de los cuales contiene una capa de aplicaci√≥n.  Aqu√≠ est√° el paquete DAO.  Importa Fall, nuestro marco DI, y dado que somos "malvados" y definimos las relaciones con las interfaces al rev√©s, definiremos una interfaz llamada GreetDao.  Tenga en cuenta que hemos eliminado todos los enlaces a errores;  Si algo est√° mal, simplemente entramos en p√°nico.  En este punto, ya tenemos un mal empaquetado, malas interfaces y errores.  Gran comienzo! <br><br>  Cambiamos ligeramente el nombre de nuestra estructura a partir de un buen ejemplo.  Los campos ahora tienen etiquetas de estructura;  se usan para hacer que Fall establezca el valor registrado en el campo.  Tambi√©n tenemos una funci√≥n init para nuestro paquete, con el cual acumulamos "poder maligno".  En la funci√≥n init del paquete, llamamos a Fall dos veces: <br><br><ul><li>  Una vez para registrar un archivo de configuraci√≥n que proporciona valores para las etiquetas de estructura. </li><li>  Y otro, registrar un puntero a una instancia de la estructura.  Fall podr√° completar estos campos para nosotros y hacer que el DAO est√© disponible para que lo use otro c√≥digo. </li></ul><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> dao <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetDao <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { GreetingForName(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> greetDaoImpl <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.default"`</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.bob"`</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.julia"`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gdi greetDaoImpl)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetingForName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> name { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.BobMessage <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Julia"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.DefaultMessage } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.RegisterPropertiesFile(<span class="hljs-string"><span class="hljs-string">"dao.properties"</span></span>) fall.Register(&amp;greetDaoImpl{}) }</code> </pre> <br>  Veamos el paquete de servicios.  Importa el paquete DAO porque necesita acceso a la interfaz definida all√≠.  El paquete de servicios tambi√©n importa el paquete modelo, que a√∫n no hemos considerado: almacenaremos nuestros tipos de datos all√≠.  E importamos Fall porque, como todos los marcos "buenos", penetra en todas partes.  Tambi√©n definimos una interfaz de servicio para dar acceso a la capa web.  De nuevo, sin errores de manejo. <br><br>  La implementaci√≥n de nuestro servicio ahora tiene una etiqueta estructural con cable.  El cable marcado en el campo conecta autom√°ticamente su dependencia cuando la estructura se registra en oto√±o.  En nuestro peque√±o ejemplo, est√° claro qu√© se asignar√° a este campo.  Pero en un programa m√°s grande, solo sabr√° que en alg√∫n lugar se implementa esta interfaz GreetDao, y se registra en oto√±o.  No puede controlar el comportamiento de dependencia. <br><br>  El siguiente es el m√©todo de nuestro servicio, que se ha modificado ligeramente para obtener la estructura GreetResponse del paquete del modelo, y que elimina cualquier manejo de errores.  Finalmente, tenemos una funci√≥n init en el paquete que registra una instancia de servicio en Fall. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/dao"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/model"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetService <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Greeting(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) model.GreetResponse } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> greetServiceImpl <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Dao dao.GreetDao <span class="hljs-string"><span class="hljs-string">`wire:""`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ssi greetServiceImpl)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">model</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetResponse</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model.GreetResponse{Message: ssi.Dao.GreetingForName(name)} } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.Register(&amp;greetServiceImpl{}) }</code> </pre> <br>  Ahora veamos el paquete del modelo.  Especialmente no hay nada que mirar.  Se puede ver que el modelo est√° separado del c√≥digo que lo crea, solo para dividir el c√≥digo en capas. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> model <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetResponse <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br>  En el paquete web tenemos una interfaz web.  Aqu√≠ importamos Fall y Outboy, y tambi√©n importamos el paquete de servicio del que depende el paquete web.  Debido a que los marcos solo funcionan bien juntos cuando se integran entre bastidores, Fall tiene un c√≥digo especial para asegurarse de que √©l y Outboy trabajen juntos.  Tambi√©n estamos cambiando la estructura para que se convierta en el controlador de nuestra aplicaci√≥n web.  Ella tiene dos campos: <br><br><ul><li>  El primero se conecta a trav√©s de Fall a la implementaci√≥n de la interfaz GreetService desde el paquete de servicio. </li><li>  El segundo es el camino para nuestro √∫nico punto final web.  Se le asigna el valor del archivo de configuraci√≥n registrado en la funci√≥n init de este paquete. </li></ul><br>  Nuestro controlador http ha sido renombrado GetHello y ahora est√° libre de manejo de errores.  Tambi√©n tenemos el m√©todo Init (con may√∫scula), que no debe confundirse con la funci√≥n init.  Init es un m√©todo m√°gico que se llama para estructuras registradas en oto√±o despu√©s de completar todos los campos.  En Init, llamamos a Outboy para registrar nuestro controlador y su punto final en la ruta que se configur√≥ con Fall.  Al mirar el c√≥digo, ver√° la ruta y el controlador, pero el m√©todo HTTP no est√° especificado.  En Outboy, el nombre del m√©todo se utiliza para determinar a qu√© m√©todo HTTP responde el controlador.  Como nuestro m√©todo se llama GetHello, responde a las solicitudes GET.  Si no conoce estas reglas, no podr√° comprender qu√© solicitudes responde.  Es cierto, esto es muy malo? <br><br>  Finalmente, llamamos a la funci√≥n init para registrar el archivo de configuraci√≥n y el controlador en oto√±o. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> web <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/outboy"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/service"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetController <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Service service.GreetService <span class="hljs-string"><span class="hljs-string">`wire:""`</span></span> Path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"controller.path.hello"`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc GreetController)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rw http.ResponseWriter, req *http.Request)</span></span></span></span> { result := mc.Service.Greeting(req.URL.Query().Get(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)) rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(result.Message)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc GreetController)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { outboy.Register(mc, <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{ <span class="hljs-string"><span class="hljs-string">"GetHello"</span></span>: mc.Path, }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.RegisterPropertiesFile(<span class="hljs-string"><span class="hljs-string">"web.properties"</span></span>) fall.Register(&amp;GreetController{}) }</code> </pre> <br>  Solo queda mostrar c√≥mo ejecutamos el programa.  En el paquete principal, utilizamos importaciones vac√≠as para registrar Outboy y el paquete web.  Y la funci√≥n principal llama a fall.Start () para iniciar toda la aplicaci√≥n. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( _ <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/web"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> _ <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/outboy"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.Start() }</code> </pre> <br><h3>  Interrupci√≥n del tegumento. </h3><br>  Y aqu√≠ est√°, un programa completo escrito usando todas nuestras malvadas herramientas Go.  Esto es una pesadilla  Ella oculta m√°gicamente c√≥mo encajan las partes del programa y hace que sea terriblemente dif√≠cil entender su trabajo. <br><br>  Y, sin embargo, debes admitir que hay algo atractivo en escribir c√≥digo con Fall and Outboy.  Para un programa peque√±o, incluso podr√≠a decir que es una mejora.  ¬°Mira lo f√°cil que es configurarlo!  ¬°Puedo conectar dependencias casi sin c√≥digo!  ¬°Registr√© un controlador para el m√©todo, solo usando su nombre!  Y sin ning√∫n error en el manejo, ¬°todo se ve tan limpio! <br><br>  As√≠ es como funciona el mal.  A primera vista, es realmente atractivo.  Pero a medida que su programa cambia y crece, toda esta magia solo comienza a interferir, lo que complica la comprensi√≥n de lo que est√° sucediendo.  Solo cuando est√°s completamente obsesionado con el mal, miras hacia atr√°s y te das cuenta de que est√°s atrapado. <br><br>  Para los desarrolladores de Java, esto puede parecer familiar.  Estas t√©cnicas se pueden encontrar en muchos frameworks Java populares.  Como mencion√© anteriormente, he estado trabajando con Java durante m√°s de 20 a√±os, comenzando desde 1.0.2 en 1996.  En muchos casos, los desarrolladores de Java fueron los primeros en encontrar problemas para escribir software empresarial a gran escala en la era de Internet.  Recuerdo los momentos en que los servlets, EJB, Spring e Hibernate acababan de aparecer.  Las decisiones que tomaron los desarrolladores de Java en ese momento ten√≠an sentido.  Pero con los a√±os, estas t√©cnicas muestran su edad.  Los lenguajes m√°s nuevos, como Go, est√°n dise√±ados para eliminar los puntos d√©biles encontrados al usar t√©cnicas m√°s antiguas.  Sin embargo, a medida que los desarrolladores de Java comienzan a aprender Go y escribir c√≥digo con √©l, deben recordar que intentar reproducir patrones de Java producir√° malos resultados. <br><br>  Go fue dise√±ado para una programaci√≥n seria, para proyectos que abarcan cientos de desarrolladores y docenas de equipos.  Pero para que Go haga esto, debe usarlo de la manera que funcione mejor.  Podemos elegir ser malvados o buenos.  Si elegimos el mal, podemos alentar a los j√≥venes desarrolladores de Go a cambiar su estilo y t√©cnicas antes de que comprendan Go.  O podemos elegir bien.  Parte de nuestro trabajo como desarrolladores de Go es educar a los j√≥venes Gophers (Gophers), para ayudarlos a comprender los principios que subyacen a nuestras mejores pr√°cticas. <br><br>  El √∫nico inconveniente de seguir el camino del bien es que debes buscar otra forma de expresar tu mal interior.  <i>¬øQuiz√°s intente conducir a una velocidad de 30 km / h en la carretera federal?</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460911/">https://habr.com/ru/post/460911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460899/index.html">26 de julio, Deworkacy - DocOps de Rostelecom</a></li>
<li><a href="../460901/index.html">Por qu√© los desarrolladores senior no pueden conseguir un trabajo</a></li>
<li><a href="../460905/index.html">M√≠nimo conocimiento de SEO para emprendedores</a></li>
<li><a href="../460907/index.html">Uso de Liquibase para administrar la estructura de la base de datos en una aplicaci√≥n Spring Boot. Parte 2</a></li>
<li><a href="../460909/index.html">¬øQu√© comeremos en 2050?</a></li>
<li><a href="../460913/index.html">Recorrido fotogr√°fico por el museo del Instituto de F√≠sica y Energ√≠a en Obninsk</a></li>
<li><a href="../460915/index.html">Conveniente sistema de gesti√≥n de bases de datos</a></li>
<li><a href="../460923/index.html">Tarea de prueba Yandex</a></li>
<li><a href="../460925/index.html">Juego en l√≠nea con verdaderos robots RC en Chernobyl. Parte 2</a></li>
<li><a href="../460929/index.html">Confluencia atlassiana: extensible en python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>