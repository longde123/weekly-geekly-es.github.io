<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèø üìû üèπ O monitoramento est√° morto? - Monitoramento ao vivo ü§´ ü§∂üèº ‚ÜîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desde 2008, nossa empresa atua principalmente no gerenciamento de infraestrutura e no suporte t√©cnico cont√≠nuo a projetos web: temos mais de 400 clien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O monitoramento est√° morto? - Monitoramento ao vivo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/448602/"><img src="https://habrastorage.org/webt/rb/6a/wf/rb6awfy_oiasqde7kja4h39oczm.jpeg"><br><br>  Desde 2008, nossa empresa atua principalmente no gerenciamento de infraestrutura e no suporte t√©cnico cont√≠nuo a projetos web: temos mais de 400 clientes, o que representa cerca de 15% do com√©rcio eletr√¥nico na R√∫ssia.  Consequentemente, uma arquitetura muito diversificada √© suportada.  Se algo cair, devemos corrigi-lo em 15 minutos.  Mas, para entender que ocorreu um acidente, voc√™ precisa monitorar o projeto e responder a incidentes.  Como fazer isso? <br><br>  Acredito que a organiza√ß√£o do sistema de monitoramento correto esteja com problemas.  Se n√£o houve problemas, meu discurso consistiu em uma tese: "Instale o Prometheus + Grafana e os plugins 1, 2, 3."  Infelizmente, isso n√£o funciona agora.  E o principal problema √© que todos continuam acreditando em algo que existia em 2008, em termos de componentes de software. <br><br>  Em rela√ß√£o √† organiza√ß√£o do sistema de monitoramento, arrisco-me a dizer que ... projetos com monitoramento competente n√£o existem.  E a situa√ß√£o √© t√£o ruim se algo cair, corre o risco de passar despercebido - todos t√™m certeza de que "tudo est√° sendo monitorado". <br>  Talvez tudo esteja sendo monitorado.  Mas como <br><br>  Todos nos deparamos com uma hist√≥ria semelhante √† seguinte: um certo devop, um certo administrador est√° trabalhando, uma equipe de desenvolvimento chega a eles e diz: "n√≥s conseguimos, agora √© monitorado".  Qual monitor?  Como isso funciona? <br><br>  Ok  Monitoramos a maneira antiquada.  Mas j√° est√° mudando e acontece que voc√™ monitorou o servi√ßo A, que se tornou o servi√ßo B, que interage com o servi√ßo C. Mas a equipe de desenvolvimento diz para voc√™: ‚ÄúInstale o software, ele deve monitorar tudo!‚Äù <br><br>  Ent√£o o que mudou?  - Tudo mudou! <br><a name="habracut"></a><br><h4>  2008 ano.  Est√° tudo bem </h4><br>  Existem alguns desenvolvedores, um servidor, um servidor de banco de dados.  A partir daqui tudo vai.  Temos alguns infa, colocamos zabbix, Nagios, cactos.  E ent√£o definimos alertas claros na CPU, na opera√ß√£o dos discos, no local dos discos.  Tamb√©m fazemos algumas verifica√ß√µes manuais de que o site responde a pedidos que chegam ao banco de dados.  E √© isso - estamos mais ou menos protegidos. <br><br>  Se compararmos a quantidade de trabalho que o administrador executou para garantir o monitoramento, foi 98% autom√°tico: a pessoa que est√° monitorando deve entender como instalar o Zabbix, como configur√°-lo e configurar alertas.  E 2% - para verifica√ß√µes externas: que o site responda e solicite ao banco de dados a chegada de novos pedidos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/846/5ae/a65/8465aea65cdf10015bb2aad7eff7ebf6.png"><br><br><h4>  Ano de 2010.  A carga est√° crescendo </h4><br>  Come√ßamos a dimensionar a web, adicionar um mecanismo de pesquisa.  Queremos ter certeza de que o cat√°logo de produtos cont√©m todos os produtos.  E essa pesquisa de produto funciona.  Que o banco de dados funciona, que pedidos est√£o sendo feitos, que o site est√° respondendo externamente e est√° respondendo a partir de dois servidores e que o usu√°rio n√£o √© expulso do site enquanto est√° reequilibrando para outro servidor, etc.  Existem mais entidades. <br><br>  Al√©m disso, a entidade associada √† infraestrutura continua sendo a maior na cabe√ßa do gerente.  Ainda est√° na minha cabe√ßa que a pessoa que est√° monitorando √© a pessoa que instalar√° o zabbix e poder√° configur√°-lo. <br><br>  Mas, ao mesmo tempo, existem trabalhos sobre a realiza√ß√£o de verifica√ß√µes externas, sobre a cria√ß√£o de um conjunto de scripts para consultar o indexador de pesquisa, um conjunto de scripts para verificar se a pesquisa √© alterada durante o processo de indexa√ß√£o, um conjunto de scripts que verifica se as mercadorias s√£o transferidas para o servi√ßo de entrega etc.  etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45c/974/24c/45c97424c842cf539e79b900b903437d.png"><br><br>  Nota: eu escrevi um "conjunto de scripts" 3 vezes.  Ou seja, a pessoa respons√°vel pelo monitoramento n√£o √© mais a √∫nica que instala o zabbix.  Essa √© a pessoa que come√ßa a codificar.  Mas nada mudou na cabe√ßa da equipe ainda. <br><br>  Mas o mundo est√° mudando, se tornando cada vez mais complicado.  Uma camada de virtualiza√ß√£o, v√°rios novos sistemas s√£o adicionados.  Eles come√ßam a interagir um com o outro.  Quem disse que "cheira a microsservi√ßos?"  Mas cada servi√ßo ainda parece individualmente um site.  Podemos nos voltar para ele e entender que ele fornece as informa√ß√µes necess√°rias e trabalha por si s√≥.  E se voc√™ √© um administrador que est√° constantemente envolvido em um projeto que est√° em desenvolvimento por 5-7-10 anos, voc√™ tem esse conhecimento acumulado: um novo n√≠vel aparece - voc√™ percebeu, outro n√≠vel aparece - voc√™ percebeu ... <br><br><img src="https://habrastorage.org/webt/tc/we/qe/tcweqem6jjpldcpovhhoklgt3kq.png"><br><br>  Mas raramente algu√©m acompanha o projeto h√° 10 anos. <br><br><h3>  Resumo de Monitoramento Man </h3><br>  Suponha que voc√™ tenha chegado a uma nova startup que pontuou imediatamente 20 desenvolvedores, escreveu 15 microsservi√ßos e voc√™ √© o administrador informado: ‚ÄúCrie um CI / CD.  Por favor "  Voc√™ criou um CI / CD e, de repente, ouve: "√â dif√≠cil trabalhar com a produ√ß√£o no" cubo "sem entender como o aplicativo funcionar√° nele.  Fa√ßa-nos uma caixa de areia no mesmo "cubo". <br>  Voc√™ faz uma caixa de areia neste cubo.  Eles imediatamente dizem: "Queremos um banco de dados de est√°gio, que √© atualizado diariamente a partir da produ√ß√£o, para entender que ele funciona no banco de dados, mas ao mesmo tempo n√£o estragar o banco de dados da produ√ß√£o". <br><br>  Voc√™ vive em tudo isso.  Faltam duas semanas para o lan√ßamento, eles dizem para voc√™: "Agora tudo seria monitorado ..." Isso √©  monitorar a infraestrutura de cluster, monitorar a arquitetura de microsservi√ßos, monitorar o trabalho com servi√ßos externos ... <br><br>  E os colegas tiram um esquema t√£o familiar e dizem: ‚ÄúEnt√£o aqui est√° tudo claro!  Instale um programa que monitore tudo. ‚Äù  Sim: plugins Prometheus + Grafana +. <br>  E eles acrescentam ao mesmo tempo: "Voc√™ tem duas semanas, verifique se tudo √© confi√°vel". <br><br>  No monte de projetos que vemos, uma pessoa √© alocada para monitoramento.  Imagine que queremos contratar uma pessoa por 2 semanas para monitorar e escreveremos um curr√≠culo para ele.  Que habilidades essa pessoa deve possuir - considerando tudo o que dissemos antes? <br><br><ul><li>  Ele deve entender o monitoramento e as especificidades do trabalho da infraestrutura de ferro. </li><li>  Ele deve entender as especificidades do monitoramento do Kubernetes (e todo mundo quer um "cubo", porque voc√™ pode ignorar tudo, ocultar, porque o administrador descobrir√° isso) - por si s√≥, sua infraestrutura e entender como monitorar aplicativos internos. </li><li>  Ele deve entender que os servi√ßos se comunicam de maneiras especiais e conhecer as especificidades da intera√ß√£o dos servi√ßos entre si.  √â bastante realista ver um projeto em que alguns dos servi√ßos se comunicam de forma s√≠ncrona, porque n√£o h√° outra maneira.  Por exemplo, o back-end continua no REST, no gRPC para o servi√ßo de cat√°logo, recebe uma lista de mercadorias e retorna.  Voc√™ n√£o pode esperar aqui.  E com outros servi√ßos, funciona de forma ass√≠ncrona.  Transfira o pedido para o servi√ßo de entrega, envie uma carta, etc. <br>  Voc√™ provavelmente j√° navegou de tudo isso?  E o administrador, que precisa monitorar isso, nadou ainda mais. </li><li>  Ele deve ser capaz de planejar e planejar corretamente - √† medida que o trabalho se torna cada vez mais. </li><li>  Portanto, ele deve criar uma estrat√©gia a partir do servi√ßo criado para entender como monitor√°-lo especificamente.  Ele precisa entender a arquitetura do projeto e seu desenvolvimento + entender as tecnologias usadas no desenvolvimento. </li></ul><br>  Lembremos de um caso absolutamente normal: parte dos servi√ßos em php, parte dos servi√ßos em Go, parte dos servi√ßos em JS.  De alguma forma eles trabalham entre si.  √â da√≠ que vem o termo ‚Äúmicrosservi√ßo‚Äù: existem tantos sistemas separados que os desenvolvedores n√£o conseguem entender o projeto como um todo.  Uma parte da equipe cria servi√ßos em JS que funcionam por conta pr√≥pria e n√£o sabem como o restante do sistema funciona.  A outra parte escreve servi√ßos em Python e n√£o entra no modo como outros servi√ßos funcionam, eles s√£o isolados em seu campo.  Terceiro - escreve servi√ßos em php ou outra coisa. <br>  Todas essas 20 pessoas est√£o divididas em 15 servi√ßos, e apenas um administrador deve entender tudo isso.  Pare com isso!  n√≥s apenas dividimos o sistema em 15 microsservi√ßos, porque 20 pessoas n√£o conseguem entender o sistema inteiro. <br><br>  Mas precisa ser monitorado de alguma forma ... <br><br>  Qual √© o resultado?  Como resultado, h√° uma pessoa que inclui tudo o que toda uma equipe de desenvolvedores n√£o pode entender e, no entanto, ele tamb√©m deve conhecer e ser capaz do que indicamos acima - infraestrutura de ferro, infraestrutura de Kubernetes etc. <br><br>  O que posso dizer ... Houston, temos problemas. <br><br><h3>  Monitorar um projeto de software moderno √© um projeto de software em si </h3><br>  Por uma falsa cren√ßa de que monitorar √© um software, temos f√© em milagres.  Mas milagres, infelizmente, n√£o acontecem.  Voc√™ n√£o pode instalar o zabbix e esperar que tudo funcione.  N√£o faz sentido colocar Grafana e espero que tudo d√™ certo.  A maior parte do tempo ser√° gasta na organiza√ß√£o de verifica√ß√µes sobre a opera√ß√£o dos servi√ßos e sua intera√ß√£o entre si, verifica√ß√µes de como os sistemas externos funcionam.  De fato, 90% do tempo ser√° gasto n√£o na escrita de scripts, mas no desenvolvimento de software.  E deve ser uma equipe que entenda o trabalho do projeto. <br>  Se nesta situa√ß√£o uma pessoa for lan√ßada para monitoramento, ocorrer√° um problema.  O que est√° acontecendo em todo lugar. <br><br>  Por exemplo, existem v√°rios servi√ßos que se comunicam atrav√©s do Kafka.  Chegou um pedido, enviamos uma mensagem sobre o pedido para Kafka.  Existe um servi√ßo que escuta informa√ß√µes sobre o pedido e realiza o transporte de mercadorias.  H√° um servi√ßo que escuta informa√ß√µes sobre o pedido e envia uma carta ao usu√°rio.  E ainda h√° muitos servi√ßos, e come√ßamos a ficar confusos. <br><br>  E se voc√™ ainda o der ao administrador e aos desenvolvedores em um est√°gio em que resta pouco tempo antes do lan√ßamento, uma pessoa precisar√° entender todo esse protocolo.  I.e.  um projeto dessa escala leva um tempo consider√°vel, e isso deve ser incorporado ao desenvolvimento do sistema. <br>  Mas muitas vezes, especialmente na grava√ß√£o, nas startups, vemos como o monitoramento √© adiado at√© mais tarde.  ‚ÄúAgora faremos a Prova de Conceito, come√ßaremos com ela, deixaremos cair - estamos prontos para o sacrif√≠cio.  E ent√£o vamos monitorar tudo. ‚Äù  Quando (ou se) o projeto come√ßa a ganhar dinheiro, a empresa deseja reduzir ainda mais recursos - porque come√ßou a funcionar, ent√£o voc√™ precisa ir mais longe!  E voc√™ est√° no ponto em que, no come√ßo, precisa monitorar tudo o que √© anterior, o que leva n√£o 1% do tempo, mas muito mais.  A prop√≥sito, os desenvolvedores precisar√£o de monitoramento e √© mais f√°cil coloc√°-los em novos recursos.  Como resultado, novos recursos s√£o gravados, tudo √© encerrado e voc√™ fica em um beco sem sa√≠da. <br><br>  Ent√£o, como voc√™ monitora um projeto desde o in√≠cio e se voc√™ tem um projeto que precisa monitorar, mas n√£o sabe por onde come√ßar? <br><br>  Primeiro, voc√™ precisa planejar. <br><br>  <i>Digress√£o l√≠rica: muitas vezes come√ßa com o monitoramento da infraestrutura.</i>  <i>Por exemplo, temos o Kubernetes.</i>  <i>Para come√ßar, colocamos Prometheus na Grafana, colocamos os plugins sob o monitoramento do "cubo".</i>  <i>N√£o apenas os desenvolvedores, mas tamb√©m os administradores t√™m uma pr√°tica infeliz: "Instalaremos este plug-in, e o plug-in provavelmente sabe como fazer isso".</i>  <i>As pessoas gostam de come√ßar com a√ß√µes simples e compreens√≠veis, em vez de importantes.</i>  <i>E a infraestrutura de monitoramento √© f√°cil.</i> <br><br>  Primeiro, decida o que e como deseja monitorar e depois pegue o instrumento, porque outras pessoas n√£o podem pensar em voc√™.  Sim, e deveriam?  Outras pessoas pensaram consigo mesmas sobre o sistema universal - ou nem pensaram quando esse plugin foi escrito.  E o fato de este plugin ter 5 mil usu√°rios n√£o significa que traga algum benef√≠cio.  Talvez voc√™ se torne o 5001 simplesmente porque j√° havia 5.000 pessoas l√° antes. <br><br>  Se voc√™ come√ßou a monitorar a infraestrutura e o back-end do seu aplicativo parou de responder, todos os usu√°rios perder√£o contato com o aplicativo m√≥vel.  Um erro vai desaparecer.  Eles v√£o at√© voc√™ e dizem: "O aplicativo n√£o funciona, o que voc√™ est√° fazendo aqui?"  "Estamos monitorando."  - "Como voc√™ monitora se n√£o v√™ que o aplicativo n√£o est√° funcionando?!" <br><br><ol><li>  Eu acredito que √© necess√°rio iniciar o monitoramento a partir do ponto de entrada do usu√°rio.  Se o usu√°rio n√£o perceber que o aplicativo est√° funcionando - isso √© tudo, √© uma falha.  E o sistema de monitoramento deve alertar sobre isso em primeiro lugar. </li><li>  E s√≥ ent√£o podemos monitorar a infraestrutura.  Ou fa√ßa-o em paralelo.  A infraestrutura √© mais simples - aqui finalmente podemos instalar o zabbix. </li><li>  E agora voc√™ precisa ir √†s ra√≠zes do aplicativo para entender onde isso n√£o funciona. </li></ol><br>  Meu pensamento principal √© que o monitoramento seja paralelo ao processo de desenvolvimento.  Se voc√™ destacar a equipe de monitoramento para outras tarefas (cria√ß√£o de um CI / CD, caixas de prote√ß√£o, reorganiza√ß√£o da infraestrutura), o monitoramento come√ßar√° a ficar lento e voc√™ nunca poder√° acompanhar o desenvolvimento (ou mais cedo ou mais tarde precisar√° ser interrompido). <br><br><h3>  Tudo por n√≠veis </h3><br>  √â assim que vejo a organiza√ß√£o do sistema de monitoramento. <br><br>  1) N√≠vel de Aplica√ß√£o: <br><ul><li>  monitorar a l√≥gica de neg√≥cios do aplicativo; </li><li>  monitoramento de m√©tricas de sa√∫de dos servi√ßos; </li><li>  monitoramento de integra√ß√£o. </li></ul><br>  2) N√≠vel de infraestrutura: <br><ul><li>  monitorar o n√≠vel de orquestra√ß√£o; </li><li>  software de sistema de monitoramento; </li><li>  monitorando o n√≠vel de "ferro". </li></ul><br>  3) Mais uma vez, o n√≠vel de aplica√ß√£o - mas como um produto de engenharia: <br><ul><li>  coletando e monitorando logs de aplicativos; </li><li>  APM </li><li>  rastreamento. </li></ul><br>  4) Alerta: <br><ul><li>  organiza√ß√£o de um sistema de alerta; </li><li>  organiza√ß√£o de um sistema de observa√ß√£o; </li><li>  organiza√ß√£o de uma "base de conhecimento" e processamento de incidentes no fluxo de trabalho. </li></ul><br>  <b>Importante</b> : chegamos ao alerta n√£o depois, mas imediatamente!  N√£o √© necess√°rio come√ßar a monitorar e "de alguma forma mais tarde" pensar em quem receber√° alertas.  Afinal, qual √© a tarefa de monitoramento: entender onde algo n√£o est√° funcionando no sistema e informar as pessoas certas.  Se isso for deixado at√© o fim, as pessoas certas descobrir√£o que algo est√° errado, apenas chamando "nada funciona para n√≥s". <br><br><h3>  Camada de aplica√ß√£o - Monitorando a l√≥gica de neg√≥cios </h3><br>  Aqui estamos falando sobre verificar o fato de que o aplicativo funciona para o usu√°rio. <br><br>  Este n√≠vel deve ser feito na fase de design.  Por exemplo, temos um Prometheus condicional: ele rastreia para o servidor envolvido em verifica√ß√µes, obt√©m o ponto final e o ponto final vai e verifica a API. <br><br>  Quando solicitado a monitorar a p√°gina principal para garantir que o site esteja funcionando, os programadores fornecem uma caneta que pode ser puxada toda vez que voc√™ precisa garantir que a API funcione.  E os programadores neste momento ainda pegam e escrevem / api / test / helloworld <br>  A √∫nica maneira de garantir que tudo funcione?  N√£o! <br><br><ul><li>  Criar tais verifica√ß√µes √© essencialmente uma tarefa dos desenvolvedores.  Os testes de unidade devem ser escritos por programadores que escrevem c√≥digo.  Porque se voc√™ mesclar isso ao administrador "Cara, aqui est√° uma lista de protocolos de API para todas as 25 fun√ß√µes, monitore tudo!"  - nada vai funcionar. </li><li>  Se voc√™ imprimir ‚Äúol√° mundo‚Äù, ningu√©m nunca saber√° que a API deve e realmente funciona.  Cada altera√ß√£o na API deve levar a uma altera√ß√£o nas verifica√ß√µes. </li><li>  Se voc√™ j√° tiver esse desastre, pare os recursos e selecione os desenvolvedores que far√£o essas verifica√ß√µes ou se reconciliar√£o com as perdas, se reconciliar√£o se nada for verificado e cair√°. </li></ul><br>  Dicas t√©cnicas: <br><br><ul><li>  Certifique-se de organizar um servidor externo para organizar as inspe√ß√µes - voc√™ deve ter certeza de que seu projeto est√° acess√≠vel ao mundo externo. </li><li>  Organize a valida√ß√£o em todo o protocolo da API, n√£o apenas nos pontos de extremidade individuais. </li><li>  Crie um ponto final prometheus com os resultados do teste. </li></ul><br><h3>  N√≠vel do aplicativo - Monitoramento de m√©tricas de integridade </h3><br>  Agora estamos falando de m√©tricas externas de sa√∫de de servi√ßos. <br><br>  Decidimos monitorar todas as "canetas" do aplicativo usando verifica√ß√µes externas que chamamos de um sistema de monitoramento externo.  Mas essas s√£o precisamente as "canetas" que o usu√°rio "v√™".  Queremos ter certeza de que os pr√≥prios servi√ßos funcionam para n√≥s.  Aqui est√° uma hist√≥ria melhor: o K8s tem verifica√ß√µes de sa√∫de para que pelo menos o cubo garanta que o servi√ßo funcione.  Mas metade dos cheques que vi s√£o da mesma estampa ‚Äúol√° mundo‚Äù.  I.e.  aqui ele puxa uma vez ap√≥s a implanta√ß√£o, respondeu que est√° tudo bem - e √© isso.  E o servi√ßo, se descansar em sua pr√≥pria API, possui um grande n√∫mero de pontos de entrada para a mesma API, que tamb√©m precisa ser monitorada, porque queremos saber que funciona.  E j√° estamos monitorando isso l√° dentro. <br><br>  Como implement√°-lo tecnicamente corretamente: cada servi√ßo define um ponto final sobre seu desempenho atual e, nos gr√°ficos da Grafana (ou qualquer outro aplicativo), vemos o status de todos os servi√ßos. <br><br><ul><li>  Cada altera√ß√£o na API deve levar a uma altera√ß√£o nas verifica√ß√µes. </li><li>  Crie um novo servi√ßo imediatamente com m√©tricas de integridade. </li><li>  O administrador pode procurar os desenvolvedores e perguntar "adicione-me alguns recursos para que eu entenda tudo e adicione informa√ß√µes sobre isso ao meu sistema de monitoramento".  Mas os desenvolvedores geralmente respondem: "N√£o adicionaremos nada duas semanas antes do lan√ßamento". <br>  Informe os gerentes de desenvolvimento de que haver√° tais perdas; informe tamb√©m os chefes dos gerentes de desenvolvimento.  Porque quando tudo cai, algu√©m ainda liga e exige o monitoramento do "servi√ßo em constante queda" (c) </li><li>  A prop√≥sito, selecione desenvolvedores para escrever plugins para o Grafana - isso ser√° uma boa ajuda para os administradores. </li></ul><br><h3>  Camada de Aplica√ß√£o - Monitoramento de Integra√ß√£o </h3><br>  O monitoramento da integra√ß√£o se concentra no monitoramento da comunica√ß√£o entre sistemas cr√≠ticos para os neg√≥cios. <br><br>  Por exemplo, existem 15 servi√ßos que se comunicam.  Estes n√£o s√£o mais sites individuais.  I.e.  n√£o podemos executar o servi√ßo por conta pr√≥pria, obter / helloworld e entender que o servi√ßo est√° funcionando.  Como o servi√ßo da web para fazer um pedido deve enviar informa√ß√µes sobre o pedido ao barramento - o servi√ßo do armaz√©m deve receber essa mensagem do barramento e trabalhar com ele ainda mais.  E o servi√ßo de distribui√ß√£o de email deve lidar com isso de alguma forma, etc. <br><br>  Portanto, n√£o podemos entender, cutucando cada servi√ßo individual, que tudo isso funciona.  Porque n√≥s temos um certo barramento atrav√©s do qual tudo se comunica e interage. <br>  Portanto, esse est√°gio deve indicar o est√°gio de servi√ßos de teste para interagir com outros servi√ßos.  Ap√≥s monitorar um intermedi√°rio de mensagens, voc√™ n√£o pode organizar o monitoramento da comunica√ß√£o.  Se houver um servi√ßo que emita dados e um servi√ßo que os receba, ao monitorar um broker, veremos apenas os dados que voam de um lado para o outro.  Mesmo que de alguma forma tenhamos conseguido monitorar a intera√ß√£o desses dados - que algum produtor publica os dados, algu√©m os l√™, esse fluxo continua indo para Kafka - ainda n√£o nos fornecer√° informa√ß√µes se um servi√ßo enviar uma mensagem em uma vers√£o, mas outro servi√ßo n√£o esperava essa vers√£o e a ignorou.  N√£o descobriremos isso, porque os servi√ßos nos dir√£o que tudo funciona. <br><br>  Como eu recomendo fazer: <br><br><ul><li>  Para comunica√ß√£o s√≠ncrona: o terminal executa solicita√ß√µes de servi√ßos relacionados.  I.e.  pegamos esse endpoint, puxamos o script dentro do servi√ßo, que vai para todos os pontos e diz: "Eu posso puxar para l√° e puxar para l√°, eu posso puxar ..." </li><li>  Para comunica√ß√£o ass√≠ncrona: mensagens recebidas - o terminal verifica o barramento quanto a mensagens de teste e exibe o status do processamento. </li><li>  Para comunica√ß√£o ass√≠ncrona: mensagens enviadas - o terminal envia mensagens de teste ao barramento. </li></ul><br>  Como costuma acontecer: temos um servi√ßo que lan√ßa dados no barramento.  Chegamos a este servi√ßo e pedimos que voc√™ fale sobre a integridade da integra√ß√£o.  E se o servi√ßo precisar vender alguma mensagem em outro local (WebApp), produzir√° essa mensagem de teste.  E se extrairmos o servi√ßo do lado do OrderProcessing, ele publicar√° primeiro algo que pode ser independente e, se houver alguma coisa dependente, ele ler√° um conjunto de mensagens de teste do barramento, entender√° que pode process√°-las, denunci√°-las e , se necess√°rio, poste-os mais e, sobre isso, ele diz - est√° tudo bem, estou vivo. <br><br>  Muitas vezes ouvimos a pergunta "como podemos testar isso em dados de combate?"  Por exemplo, estamos falando do mesmo servi√ßo de pedidos.  O pedido envia mensagens para o armaz√©m onde as mercadorias s√£o baixadas: n√£o podemos testar isso nos dados de combate, porque "minhas mercadorias ser√£o baixadas!"  Sa√≠da: no est√°gio inicial, planeje todo esse teste.  Voc√™ tem testes de unidade que zombam.  Portanto, fa√ßa isso em um n√≠vel mais profundo, onde voc√™ ter√° um canal de comunica√ß√£o que n√£o prejudicar√° os neg√≥cios. <br><br><h3>  N√≠vel de infraestrutura </h3><br>  Monitoramento de infraestrutura √© o que h√° muito tempo √© considerado monitoramento em si. <br><br><ul><li>  O monitoramento da infraestrutura pode e deve ser iniciado como um processo separado. </li><li>  Voc√™ n√£o deve come√ßar monitorando a infraestrutura em um projeto em funcionamento, mesmo se realmente quiser.  Isso √© uma ferida para todos os devops.  "Primeiro monitoro o cluster, monitoro a infraestrutura" - ou seja,  Primeiro, ele monitora o que est√° abaixo, mas n√£o entra no aplicativo.  Porque o aplicativo √© uma coisa incompreens√≠vel para a devopa.  Eles vazaram para ele, e ele n√£o entende como isso funciona.  E ele entende a infraestrutura e come√ßa com ela.  Mas n√£o - voc√™ sempre precisa monitorar o aplicativo primeiro. </li><li>     .    ,   ,       - .   on-call,     ,  ¬´    ¬ª.       . </li></ul><br><h3>    - </h3><br>  : <br><br><ul><li> ELK.   .   -     ,    . </li><li> APM.  APM       (NewRelic, BlackFire, Datadog).      ,   - ,    . </li><li> Tracing.       ,         .    ,     tracing   ‚Äî     .     ‚Äì ! . Jaeger/Zipkin </li></ul><br><h3>  </h3><br><ul><li>   :           .   Grafana.     PagerDuty.     (,   ‚Ä¶).   ,     </li><li>   :      (    ,     ). Oncall    :    ,       ,       ,   ‚Äî     (          ‚Äî  , :         ,  ).  ,     ‚Äî    (¬´   ‚Äî    ¬ª),    . </li><li>  ¬´ ¬ª  workflow  :        ,        ,   .   ,    ‚Äî  ;        . </li></ul><br><h3>   </h3><br>  ,     : <br><br><ul><li>   ‚Äî Prometheus + Grafana; </li><li>   ‚Äî ELK; </li><li>  APM  Tracing ‚Äî Jaeger (Zipkin). </li></ul><br><img src="https://habrastorage.org/webt/tv/xl/3i/tvxl3isq0zhn8tfkeqermj9tuko.png"><br><br>   .  ,     ,      ,         .   ,     .  , , ,     ‚Äî       . <br><br>   ,       : <br><br> <i>Prometheus   Kubernetes ‚Äî   ?!</i>     ,    ?      ,        ,   ‚Äî ,      . <br><br> <i>       .</i>      .    ,   Promtheus,   ,    ,      .             ? ,     ,      . <br><br><h3>  Conclus√µes </h3><br><ul><li>   ‚Äî   ,    . 98%   ‚Äî  .   ,   ,   ,  --. </li><li>      :     30%  ,   . </li><li> ,  ,      - ,     ‚Äî     .    ,    ‚Äî   . </li><li>        (  ) ‚Äî    . </li><li>     ,   ,   ¬´ ¬ª ‚Äî    ,      . </li></ul><br> <i>      Saint Highload++.</i> <br><br> UPD (       ): <br><br> 1.  ,   ,  ,   ¬´,  ,    ,   ¬ª. ,   :  DevOps    ,     ‚Äî   , ,  ,  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. N√£o estou tentando sugerir, eles dizem, "tudo est√° ruim em todos os lugares, mas podemos monitor√°-lo - venha para o ITSumma". </font><font style="vertical-align: inherit;">N√£o, se o projeto for lan√ßado, o monitoramento n√£o poder√° ser realizado por uma empresa terceirizada. </font><font style="vertical-align: inherit;">Obviamente, tamb√©m temos objetivos de neg√≥cios, e o que realmente estamos pensando em fazer √© introduzir consultoria para apoiar o projeto no processo de seu desenvolvimento, a fim de transmitir como √© correto, do lado do desenvolvimento, realizar a parte de monitoramento.</font></font><br><br>  Se voc√™ est√° interessado em minhas id√©ias e pensamentos, e assim por diante, pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ler o canal</a> :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448602/">https://habr.com/ru/post/pt448602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448584/index.html">7 erros comuns ao usar preposi√ß√µes em ingl√™s e como evit√°-las</a></li>
<li><a href="../pt448588/index.html">A arquitetura do balanceador de carga de rede no Yandex.Cloud</a></li>
<li><a href="../pt448590/index.html">Estranhos familiares ou mais uma vez sobre o uso de padr√µes de design</a></li>
<li><a href="../pt448594/index.html">Antiv√≠rus e firewalls gratuitos (UTM, NGFW) da Sophos</a></li>
<li><a href="../pt448600/index.html">Como o Windows 10 Explore a vulnerabilidade cr√≠tica do DHCP detecta mais dois erros de seguran√ßa</a></li>
<li><a href="../pt448604/index.html">Gameboy em C #</a></li>
<li><a href="../pt448606/index.html">Sidorin: KnowledgeConf √© sobre como manter o conhecimento com uma dura√ß√£o m√©dia de trabalho em um local em 2 a 3 anos</a></li>
<li><a href="../pt448608/index.html">Como dar os primeiros passos na rob√≥tica?</a></li>
<li><a href="../pt448610/index.html">DIY: Como fizemos uma programa√ß√£o ao vivo para o Codefest X</a></li>
<li><a href="../pt448612/index.html">O que foi congelado no congelamento de recursos em 2019. Parte I. JSONPath</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>