<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÄÔ∏è üö£üèª üåé C√≥mo integrar ReactJS en 1C-Bitrix con generaci√≥n autom√°tica de plantillas en el back-end utilizando el ejemplo de la red Globus ü§∏üèΩ üôÅ üéã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este a√±o, ReactJS se lanz√≥ por primera vez para la tienda en l√≠nea de la cadena de hipermercados Globus. El proyecto es interesante porque expande las...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo integrar ReactJS en 1C-Bitrix con generaci√≥n autom√°tica de plantillas en el back-end utilizando el ejemplo de la red Globus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421531/"> Este a√±o, ReactJS se lanz√≥ por primera vez para la tienda en l√≠nea de la cadena de hipermercados Globus.  El proyecto es interesante porque expande las capacidades de la plataforma Bitrix y al mismo tiempo conserva la capacidad de generar p√°ginas para motores de b√∫squeda y no se llena con la duplicaci√≥n de c√≥digo y dise√±o.  En este art√≠culo, hablamos sobre c√≥mo conectar los componentes de Bitrix con los componentes de ReactJS utilizando el m√≥dulo v8js para php y guardar la parte frontal principal del sitio. <br><a name="habracut"></a><br><h3>  ¬øPor qu√© se necesitaba esto? </h3><br>  Inicialmente, la l√≥gica del sitio web de la tienda en l√≠nea se cre√≥ en la biblioteca Marionette.js.  Hace unos a√±os, esta l√≥gica vali√≥ la pena, pero con el tiempo, los requisitos comerciales para la funcionalidad front-end crecieron tanto que cada refinamiento estuvo acompa√±ado de serias dificultades.  Debido a la alta carga, la velocidad de la parte delantera disminuy√≥ y dej√≥ mucho que desear.  Para resolver este problema, elegimos ReactJS, pero hab√≠a un problema al procesar las p√°ginas en el back-end y luego vincular partes de las p√°ginas para reaccionar componentes.  Al mismo tiempo, nuestro objetivo era una transici√≥n gradual a ReactJS, ya que  cambios dr√°sticos podr√≠an conducir a un redise√±o completo del frente. Como resultado, la elecci√≥n recay√≥ en los siguientes componentes: <br><br><ul><li>  Tarjetas de producto; </li><li>  Mini canasta; </li><li>  Menu </li></ul><br>  La principal dificultad para transferir mini-canastas y tarjetas de productos a ReactJS fue la sincronizaci√≥n instant√°nea de la cantidad de bienes en ambos componentes, es decir.  Si hay 3 kg de zanahorias en la cesta, entonces en el bloque para agregar productos a la cesta (selector) se deben mostrar 3 kg, y cuando la cantidad de productos en la mini-cesta cambia, el cambio debe ocurrir en el selector y viceversa.  Adem√°s, era necesario nivelar el retraso de la solicitud de fondo para que la interfaz funcionara lo m√°s r√°pido posible. <br><br><img src="https://habrastorage.org/webt/zs/0-/4t/zs0-4tm2cptsxb_ertod4wohimm.png">  " <br><br>  Una complejidad adicional fue la especificidad de la tienda (venta de alimentos), donde existe el concepto de bienes ponderados.  Este es un producto que se considera en kg, pero el usuario lo compra en trozos, por ejemplo, una sand√≠a, que el cliente no puede comprar en parte, solo en su totalidad.  Dicho producto para el usuario debe mostrarse en el n√∫mero de piezas, pero en el back-end se considera en kilogramos. <br><br><h3>  ¬øC√≥mo resolviste el problema? </h3><br>  Para no duplicar el dise√±o de los componentes en las plantillas del sistema 1C-Bitrix and React, se decidi√≥ colocarlo en los componentes React.  El nombre del componente en React debe coincidir con la plantilla de componente del sistema 1C-Bitrix.  Para implementar tales ideas, utilizamos: <br><br><ul><li>  M√≥dulo V8js para php; </li><li>  reactjs / react-php-v8js; </li><li>  paquete web </li></ul><br>  El primer elemento es el m√≥dulo v8js, que deber√≠a convertir nuestros componentes de reacci√≥n en un dise√±o est√°tico en un entorno php. <br><br>  La siguiente es una peque√±a biblioteca de React Community, que es un contenedor para facilitar la inicializaci√≥n de React en el entorno js del m√≥dulo v8js. <br><br>  Y, por supuesto, webpack, donde sin √©l.  En combinaci√≥n con babel, le permite usar plantillas jsx y el est√°ndar es6 para escribir c√≥digo.  Todos los ejemplos se presentar√°n en la sintaxis es6.  Es bastante simple, pero si no se entiende de inmediato, entonces debe actualizar su memoria para ello. <br><br>  <i>M√≥dulo V8js para php.</i> <br><br>  Este m√≥dulo es una extensi√≥n para php, que le permite usar el motor Javascript V8 para ejecutar c√≥digo js en php.  Se instala simplemente, como una extensi√≥n PECL normal.  Lo principal es que tiene en las bibliotecas de su sistema y los archivos de encabezado V8. <br><br>  <i>Paquete web</i> <br><br>  Para construir la biblioteca de componentes de reacci√≥n y reacci√≥n, usamos webpack.  Los archivos de ensamblaje para el anverso y el reverso son ligeramente diferentes.  Vamos a 3 archivos: <br><br><ul><li>  initialize.js -&gt; app.js - aplicaci√≥n para el frente; </li><li>  reactServer.js -&gt; reactBuild.js - reaccionar biblioteca para el lado del servidor; </li><li>  components.js -&gt; reactComponents.js - una colecci√≥n de componentes react. </li></ul><br>  La principal diferencia entre el ensamblaje para la representaci√≥n del servidor es que todas las bibliotecas y componentes deben colocarse en el objeto global y las bibliotecas est√°n conectadas a trav√©s de la funci√≥n require.  La directiva de importaci√≥n por alguna raz√≥n no funciona. <br><br>  Todos los archivos de origen est√°n en el directorio local / templates / &lt;template name&gt; / src / <br><br><img src="https://habrastorage.org/webt/gg/vz/ck/ggvzckbgtq4g4jl9ftrgkr5ipnu.png"><br><br>  En la ra√≠z del proyecto se encuentra webpack.config.js - settings. <br><br><img src="https://habrastorage.org/webt/fd/2j/yk/fd2jykgbdtcbpwfjn11goi5s8xq.png"><br><br>  El contenido de los archivos de ensamblaje se puede encontrar al final del art√≠culo. <br><br>  Npm y los siguientes paquetes deben estar instalados: <br><br><ul><li>  babel </li><li>  babel-cli; </li><li>  paquete web </li><li>  reaccionar </li><li>  reaccionar </li><li>  gui√≥n bajo // opcional. </li></ul><br>  El ensamblaje se realiza ejecutando el comando: <br>  $ webpack. <br><br>  <i>Personalizaci√≥n del motor de plantillas bitrix</i> <br><br>  Para registrar un motor personalizado en el sistema 1C-Bitrix, debe agregar su configuraci√≥n a la variable global $ arCustomTemplateEngines.  En la clave, debe especificar el c√≥digo de su motor.  Utilizamos "JSX".  En los valores que necesita para especificar la extensi√≥n del archivo de la plantilla, la funci√≥n de renderizar la plantilla.  Es recomendable especificar un tipo por debajo de un valor de 100, de modo que la prioridad de nuestro motor est√© por encima del est√°ndar. <br><br>  Cree una clase JSXEngine con los siguientes m√©todos: <br><br><ul><li>  setEngine: registra una plantilla; </li><li>  init: inicializaci√≥n de v8js a trav√©s del contenedor de biblioteca reactjs / react-php-v8js; </li><li>  execute: funcionalidad de representaci√≥n de plantillas </li></ul><br>  y una funci√≥n de contenedor para representar la plantilla _JSXEngineExecute, porque  El sistema 1C-Bitrix requiere el registro de una funci√≥n particular. <br><br>  Para no inicializar cada vez que una instancia de React, col√≥quela en una variable est√°tica y agregue un m√©todo de inicializaci√≥n. <br><br>  Se implementa una interfaz especial en la clase ReactJS de la biblioteca reactjs / react-php-v8js para representar el componente de reacci√≥n.  El constructor de la clase toma dos par√°metros como entrada, que deben contener el c√≥digo js del m√≥dulo de reacci√≥n y todos los componentes de reacci√≥n que se usan en el proyecto recopilados a trav√©s del paquete web.  Despu√©s de la inicializaci√≥n, podemos renderizarlos.  Para hacer esto, llame al m√©todo setComponent para instalar el componente con los par√°metros del nombre del componente y la matriz de accesorios.  Despu√©s de eso, el m√©todo getMarkup mostrar√° el contenido del componente y getJS mostrar√° el c√≥digo js para vincular el componente en la parte delantera.  El m√©todo getJS requiere el identificador del bloque html en el que se encuentra el componente en los par√°metros.  Para hacer esto, implementamos una plantilla simple para envolver un componente renderizado en un bloque html.  La configuraci√≥n del bloque en s√≠ se transfiere a un archivo json, que se coloca en la plantilla de componentes del sistema 1C-Bitrix.  La configuraci√≥n se almacena en formato json. <br><br><img src="https://habrastorage.org/webt/t7/fd/r3/t7fdr30zlxslwvouggmryh6bvgu.png"><br><br><img src="https://habrastorage.org/webt/6g/ng/op/6gngopga5l-r10z4zfqzkjjgmbw.jpeg"><br><br>  <i>Transferir un componente a una nueva plantilla</i> <br><br>  Mostraremos la traducci√≥n del componente a React usando el ejemplo de un componente de men√∫ est√°ndar.  El dise√±o del componente ya se ha integrado en el motor de plantillas est√°ndar.  React recomienda una pol√≠tica para dividir la funcionalidad en componentes.  Adem√°s, los componentes pueden ser muy peque√±os.  Hasta la etiqueta del hiperv√≠nculo.  No vamos a dividir nuestro men√∫ en triviales, pero sin embargo haremos una peque√±a descomposici√≥n. <br><br>  Nuestro men√∫ utiliza anidamiento de hasta 3 niveles.  Por lo tanto, ser√° l√≥gico dividir la funcionalidad del men√∫ en 3 componentes de reacci√≥n, cada uno por nivel.  Si observa detenidamente, notar√° que los elementos del men√∫ del segundo nivel est√°n organizados en dos columnas.  Esta funcionalidad debe colocarse en un componente adicional. <br><br><img src="https://habrastorage.org/webt/y1/uy/fo/y1uyfohp9vilnly4xun9zkfe5pm.png"><br><br>  Por lo tanto, tenemos 4 componentes.  Vamos a colocarlos en los archivos TopMenu.js, SubMenuLevel2.js, SubMenuLevel3.js, TwoColumnItem.js en el directorio src / components (vea el c√≥digo para otros componentes al final): <br><br><img src="https://habrastorage.org/webt/nt/80/bj/nt80bjgwhznbqv9ckuiursphqyw.png"><br><br>  Para que nuestra plantilla funcione, debe crear una plantilla para el componente del men√∫ del sistema 1C-Bitrix.  El nombre de la plantilla debe coincidir con el nombre del componente de reacci√≥n.  Dentro de la plantilla, debe colocar el archivo con la extensi√≥n correspondiente a la configuraci√≥n de nuestro motor.  Dentro del archivo debe especificar el nodo html en el que se representar√° nuestro componente de reacci√≥n. <br><br><h3>  Resultado </h3><br>  Esta soluci√≥n le permite utilizar componentes de reacci√≥n en el lado posterior y en el lado frontal.  Por lo tanto, la l√≥gica de mostrar la funcionalidad se almacena en un solo lugar, lo que facilita enormemente el soporte del proyecto. <br><br>  La velocidad de representaci√≥n de la p√°gina inicial aument√≥ en casi 1 segundo.  Porque  Ahora no necesita volver a dibujar el elemento de la casa en el que se encuentra el componente.  ReactJs lo recoge sobre la marcha.  Adem√°s, el parpadeo de elementos en dispositivos d√©biles desapareci√≥. <br><br>  En el futuro, planea cambiar a la representaci√≥n de componentes en el lado de back-end a trav√©s de un servicio basado en node.js e implementar una aplicaci√≥n de una sola p√°gina mientras conserva la capacidad de generar p√°ginas para SEO. <br><br><h3>  App </h3><br>  initialize.js <br><br><img src="https://habrastorage.org/webt/s_/n2/mz/s_n2mz7lilpjjdadeg0ppctjlmk.png"><br><br>  components.js <br><br><img src="https://habrastorage.org/webt/gs/eo/m7/gseom7029c7ams6zdvaojkl894c.png"><br><br>  reactServer.js <br><br><img src="https://habrastorage.org/webt/bh/ne/ln/bhnelnigqxydigkiafpmoccwvwm.png"><br><br>  SubMenuLevel2.js <br><br><img src="https://habrastorage.org/webt/ep/7t/xa/ep7txacqkwh--ep9lealiucgves.png"><br><br>  SubMenuLevel3.js <br><br><img src="https://habrastorage.org/webt/8l/bo/oq/8lbooq9g6y2ivrt_sr7pti6eyzc.png"><br><br>  TwoColumnItems.js <br><br><img src="https://habrastorage.org/webt/lv/5s/bk/lv5sbkebar6j_yvdjwjv3s01nca.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421531/">https://habr.com/ru/post/es421531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421521/index.html">Monstruos despu√©s de las vacaciones: AMD Threadripper 2990WX 32-Core y 2950X 16-Core (parte 3 - pruebas)</a></li>
<li><a href="../es421523/index.html">Unidad: conociendo los Objetos Scriptables</a></li>
<li><a href="../es421525/index.html">Un poco sobre las diferencias entre los hosteleros rusos y extranjeros</a></li>
<li><a href="../es421527/index.html">Lanzamiento de difusi√≥n del proyecto "Servidor en las nubes"</a></li>
<li><a href="../es421529/index.html">Netflix, Uber, Google y usted en MBLT DEV 2018</a></li>
<li><a href="../es421533/index.html">Elegir un lenguaje de programaci√≥n: 3 consejos de un programador de Apple</a></li>
<li><a href="../es421535/index.html">Aventura - Electr√≥nica. En un columpio alado en el mundo de TI</a></li>
<li><a href="../es421537/index.html">Funciones de orden superior en JS: Young Fighter Course</a></li>
<li><a href="../es421543/index.html">Clonar una tarjeta sin contacto usando una aplicaci√≥n m√≥vil</a></li>
<li><a href="../es421545/index.html">Revisi√≥n de PocketBook 616: la billetera 2018 m√°s econ√≥mica con funci√≥n de retroiluminaci√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>