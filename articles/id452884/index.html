<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🍳 🥞 ⏰ Analisis kinerja mesin virtual di VMware vSphere. Bagian 1: CPU 👩🏻‍🎓 🍈 💬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jika Anda mengelola infrastruktur virtual berdasarkan VMware vSphere (atau tumpukan teknologi lainnya), Anda mungkin sering mendengar keluhan dari pen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analisis kinerja mesin virtual di VMware vSphere. Bagian 1: CPU</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/452884/"><img src="https://habrastorage.org/webt/m9/sx/3b/m9sx3brt_zkyowlzywiwyoobc60.png"><br><br>  Jika Anda mengelola infrastruktur virtual berdasarkan VMware vSphere (atau tumpukan teknologi lainnya), Anda mungkin sering mendengar keluhan dari pengguna: "Mesin virtual lambat!".  Dalam seri artikel ini saya akan menganalisis metrik kinerja dan menjelaskan apa dan mengapa itu "melambat" dan bagaimana memastikan bahwa itu tidak "melambat". <br><br>  Saya akan mempertimbangkan aspek kinerja berikut dari mesin virtual: <br><br><ul><li>  CPU </li><li>  RAM </li><li>  DISK, </li><li>  Jaringan </li></ul><br>  Saya akan mulai dengan CPU. <br><br>  Untuk analisis kinerja kita perlu: <br><br><ul><li> <b>Penghitung Kinerja vCenter</b> adalah penghitung kinerja yang grafiknya dapat dilihat melalui vSphere Client.  Informasi tentang penghitung ini tersedia dalam versi klien apa pun (klien "tebal" dalam C #, klien web pada Flex dan klien web pada HTML5).  Dalam artikel ini, kami akan menggunakan tangkapan layar dari klien C #, hanya karena mereka terlihat lebih baik dalam miniatur :) </li><li>  <b>ESXTOP</b> adalah utilitas yang dijalankan dari baris perintah ESXi.  Dengan bantuannya, Anda bisa mendapatkan nilai penghitung kinerja secara waktu nyata atau mengunggah nilai-nilai ini untuk periode tertentu ke file .csv untuk analisis lebih lanjut.  Selanjutnya, saya akan memberi tahu Anda lebih banyak tentang alat ini dan memberikan beberapa tautan bermanfaat ke dokumentasi dan artikel terkait. </li></ul><br><a name="habracut"></a><br><h3>  Sedikit teori </h3><br><img src="https://habrastorage.org/webt/zf/rh/dx/zfrhdxqi6ys3wgdgzs0m5ibk96i.png"><br><br>  Dalam ESXi, proses terpisah bertanggung jawab untuk pengoperasian setiap vCPU (inti mesin virtual) - dunia dalam terminologi VMware.  Ada juga proses layanan, tetapi dari sudut pandang analisis kinerja VM, mereka kurang menarik. <br><br>  Suatu proses di ESXi dapat di salah satu dari empat negara: <br><br><ul><li>  <b>Jalankan</b> - proses melakukan beberapa pekerjaan yang bermanfaat. </li><li>  <b>Tunggu</b> - proses tidak melakukan pekerjaan apa pun (idle) atau sedang menunggu input / output. </li><li>  <b>Costop</b> adalah suatu kondisi yang terjadi pada mesin virtual multi-core.  Ini terjadi ketika penjadwal CPU hypervisor (ESXi CPU Scheduler) tidak dapat menjadwalkan semua core aktif dari mesin virtual untuk berjalan secara bersamaan pada core server fisik.  Dalam dunia fisik, semua core prosesor bekerja secara paralel, OS tamu di dalam VM mengharapkan perilaku yang sama, sehingga hypervisor harus memperlambat core VM, yang memiliki kemampuan untuk menyelesaikan ketukan lebih cepat.  Dalam versi modern ESXi, penjadwal CPU menggunakan mekanisme yang disebut santai penjadwalan bersama: hypervisor mempertimbangkan kesenjangan antara inti mesin virtual tercepat dan paling lambat (condong) .Jika kesenjangan melebihi ambang tertentu, inti cepat masuk ke keadaan costop Jika VM core menghabiskan banyak waktu dalam kondisi ini, ini dapat menyebabkan masalah kinerja. </li><li>  <b>Siap</b> - proses masuk ke keadaan ini ketika hypervisor tidak memiliki kemampuan untuk mengalokasikan sumber daya untuk pelaksanaannya.  Nilai siap tinggi dapat menyebabkan masalah kinerja VM. </li></ul><br><h3>  Penghitung kinerja CPU dasar dari mesin virtual </h3><br>  <b>Penggunaan CPU,%.</b>  Memperlihatkan persentase penggunaan CPU untuk periode tertentu. <br><br><img src="https://habrastorage.org/webt/ly/ad/rg/lyadrgztwkrkipbfnzllfcjtrq4.png"><br><br>  <b>Bagaimana cara menganalisa?</b>  Jika VM stabil menggunakan CPU untuk 90% atau ada puncak hingga 100%, maka kita memiliki masalah.  Masalah dapat diekspresikan tidak hanya dalam operasi "lambat" aplikasi di dalam VM, tetapi juga dalam tidak dapat diaksesnya VM melalui jaringan.  Jika sistem pemantauan menunjukkan bahwa VM jatuh secara berkala, perhatikan puncak pada grafik Penggunaan CPU. <br><br>  Ada Alarm standar, yang menunjukkan beban CPU dari mesin virtual: <br><br><img src="https://habrastorage.org/webt/6a/pr/b9/6aprb9vc1gwbtioocqpjdm7jzhk.png"><br><br>  <b>Apa yang harus dilakukan</b>  Jika Penggunaan CPU terus-menerus membanjiri VM, maka Anda dapat berpikir tentang meningkatkan jumlah vCPU (sayangnya, ini tidak selalu membantu) atau mentransfer VM ke server dengan prosesor yang lebih efisien. <br><br><h3>  Penggunaan CPU dalam Mhz </h3><br>  Di grafik Penggunaan vCenter di% Anda hanya dapat melihat seluruh mesin virtual, tidak ada grafik untuk masing-masing inti (Esxtop memiliki nilai dalam% untuk inti).  Untuk setiap inti, Anda dapat melihat Penggunaan dalam MHz. <br><br>  <b>Bagaimana cara menganalisa?</b>  Itu terjadi bahwa aplikasi tidak dioptimalkan untuk arsitektur multi-core: ia menggunakan 100% hanya satu inti, dan sisanya menganggur tanpa beban.  Misalnya, dengan pengaturan cadangan default, MS SQL memulai proses hanya pada satu inti.  Akibatnya, cadangan diperlambat bukan karena kecepatan disk yang lambat (ini yang awalnya dikeluhkan oleh pengguna), tetapi karena prosesor tidak dapat mengatasinya.  Masalahnya dipecahkan dengan mengubah parameter: cadangan mulai berjalan secara paralel di beberapa file (masing-masing, dalam beberapa proses). <br><br><img src="https://habrastorage.org/webt/6p/pm/w8/6ppmw8d5vqe2gepkiahzqx9tfms.png"><br>  <i>Contoh beban inti yang tidak merata.</i> <br><br>  Ada juga situasi (seperti pada grafik di atas) ketika core dimuat tidak merata dan beberapa dari mereka memiliki puncak 100%.  Seperti halnya dengan memuat hanya satu inti, alarm pada Penggunaan CPU tidak akan berfungsi (ini ada di seluruh VM), tetapi akan ada masalah kinerja. <br><br>  <b>Apa yang harus dilakukan</b>  Jika perangkat lunak di mesin virtual memuat kernel tidak merata (hanya menggunakan satu inti atau bagian dari kernel), tidak ada gunanya meningkatkan jumlah mereka.  Dalam hal ini, lebih baik untuk memindahkan VM ke server dengan prosesor yang lebih efisien. <br><br>  Anda juga dapat mencoba memeriksa pengaturan daya di BIOS server.  Banyak administrator mengaktifkan mode Kinerja Tinggi di BIOS dan dengan demikian mematikan teknologi hemat daya dari C-state dan P-state.  Prosesor Intel modern menggunakan teknologi Turbo Boost, yang meningkatkan frekuensi masing-masing inti prosesor karena inti lainnya.  Tetapi hanya bekerja dengan teknologi hemat energi yang disertakan.  Jika kita mematikannya, maka prosesor tidak dapat mengurangi konsumsi daya kernel yang tidak dimuat. <br><br>  VMware merekomendasikan untuk tidak mematikan teknologi hemat energi di server, tetapi untuk memilih mode yang memaksimalkan manajemen energi untuk hypervisor.  Pada saat yang sama, dalam pengaturan daya hypervisor Anda harus memilih High Performance. <br><br>  Jika Anda memiliki VM terpisah (atau inti VM) di infrastruktur Anda yang memerlukan peningkatan frekuensi CPU, konfigurasi konsumsi daya yang benar dapat secara signifikan meningkatkan kinerjanya. <br><br><img src="https://habrastorage.org/webt/uq/ov/-o/uqov-ooazq0fetmazbwzhvxlgeg.png"><br><br><h3>  Siap CPU (Kesiapan) </h3><br>  Jika VM core (vCPU) dalam status Siap, itu tidak melakukan pekerjaan yang bermanfaat.  Kondisi ini terjadi ketika hypervisor tidak menemukan inti fisik gratis yang dapat digunakan proses vCPU dari mesin virtual. <br><br>  <b>Bagaimana cara menganalisa?</b>  Biasanya, jika core mesin virtual dalam status Siap untuk lebih dari 10% dari waktu, maka Anda akan melihat masalah kinerja.  Sederhananya, lebih dari 10% dari waktu VM menunggu ketersediaan sumber daya fisik. <br><br>  Di vCenter, Anda dapat melihat 2 penghitung yang terkait dengan CPU Ready: <br><br><ul><li>  Kesiapan </li><li>  Siap </li></ul><br>  Nilai-nilai kedua penghitung dapat dilihat baik di seluruh VM dan untuk kernel individu. <br>  Kesiapan menunjukkan nilai segera dalam persen, tetapi hanya dalam waktu-nyata (data untuk jam terakhir, interval pengukuran 20 detik).  Penghitung ini paling baik digunakan hanya untuk mencari masalah "dalam pengejaran." <br><br>  Nilai counter ready juga dapat dilihat dalam perspektif historis.  Ini berguna untuk membangun pola dan untuk analisis masalah yang lebih dalam.  Misalnya, jika mesin virtual mulai mengalami masalah kinerja pada waktu tertentu, Anda dapat membandingkan interval nilai Ready CPU yang digantung dengan total beban pada server tempat VM berjalan, dan mengambil langkah-langkah untuk mengurangi beban (jika DRS tidak dapat mengatasinya). <br><br>  Siap, tidak seperti Kesiapan, ditampilkan bukan dalam persentase, tetapi dalam milidetik.  Ini adalah penghitung tipe penjumlahan, yaitu, itu menunjukkan berapa lama inti VM berada dalam status siap selama periode pengukuran.  Anda dapat menerjemahkan nilai ini menjadi persen dengan rumus sederhana: <br><br>  (Nilai penjumitan siap CPU / (grafik interval pembaruan default dalam detik * 1000)) * 100 = CPU siap% <br><br>  Misalnya, untuk VM di grafik di bawah ini, nilai puncak Ready untuk seluruh mesin virtual adalah sebagai berikut: <br><br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>4286</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mo stretchy=&quot;false&quot;>(</mo><mn>20</mn><mo>&amp;#x2217;</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2217;</mo><mn>100</mn><mo>=</mo><mn>21</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.706ex" height="2.66ex" viewBox="0 -832 12789.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-34"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-32" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-38" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-36" x="1501" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-2F" x="2391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-28" x="2892" y="0"></use><g transform="translate(3281,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-2217" x="4504" y="0"></use><g transform="translate(5227,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="1501" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-29" x="7229" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-29" x="7618" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-2217" x="8230" y="0"></use><g transform="translate(8953,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-3D" x="10732" y="0"></use><g transform="translate(11788,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhjTxLuM0wGxQzzaGQoitjBBcUV_cA#MJMAIN-31" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>4286</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mn>20</mn><mo>∗</mo><mn>1000</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>∗</mo><mn>100</mn><mo>=</mo><mn>21</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> (4286 / (20 * 1000)) * 100 = 21% (4286 / (20 * 1000)) * 100 = 21% </script><br><br><img src="https://habrastorage.org/webt/oq/ma/1u/oqma1u-x4wdruct6jqgvlak9ia0.png"><br><br>  Saat menghitung nilai Ready sebagai persentase, Anda harus memperhatikan dua poin: <br><br><ul><li>  Nilai Ready di seluruh VM adalah jumlah Ready di seluruh core. </li><li>  Interval pengukuran.  Untuk Real-time, ini adalah 20 detik, dan, misalnya, pada grafik harian, ini adalah 300 detik. </li></ul><br>  Dengan pemecahan masalah aktif, poin-poin sederhana ini dapat dengan mudah dilewatkan dan waktu yang berharga dapat dihabiskan untuk menyelesaikan masalah yang tidak ada. <br><br>  Kami menghitung Ready berdasarkan data dari grafik di bawah ini.  (324474 / (20 * 1000)) * 100 = 1622% untuk seluruh VM.  Jika Anda melihat inti, itu akan berubah tidak begitu menakutkan: 1622/64 = 25% per inti.  Dalam hal ini, mendeteksi trik cukup sederhana: nilai Ready tidak realistis.  Tetapi jika kita berbicara sekitar 10-20% untuk seluruh VM dengan beberapa core, maka untuk setiap inti nilainya dapat berada dalam kisaran normal. <br><br><img src="https://habrastorage.org/webt/_m/qe/cc/_mqeccs8ivn_r-zrogedc_ofw9a.png"><br><br>  <b>Apa yang harus dilakukan</b>  Nilai Ready yang tinggi menunjukkan bahwa server tidak memiliki sumber daya prosesor yang cukup untuk operasi normal mesin virtual.  Dalam situasi ini, tetap hanya untuk mengurangi kelebihan langganan pada prosesor (vCPU: pCPU).  Jelas, ini dapat dicapai dengan mengurangi parameter VM yang ada atau dengan memigrasi sebagian VM ke server lain. <br><br><h3>  Berhenti bersama </h3><br>  <b>Bagaimana cara menganalisa?</b>  Penghitung ini juga memiliki tipe penjumlahan dan diterjemahkan ke dalam persentase seperti Ready: <br><br>  (Nilai penjumlah co-stop CPU / (grafik interval pembaruan default dalam detik * 1000)) * 100 = CPU co-stop% <br><br>  Di sini Anda juga perlu memperhatikan jumlah core per VM dan interval pengukuran. <br>  Dalam keadaan costop, kernel tidak melakukan pekerjaan yang bermanfaat.  Dengan pemilihan ukuran VM yang benar dan beban normal pada server, penghitung co-stop harus mendekati nol. <br><br><img src="https://habrastorage.org/webt/pz/y8/sr/pzy8sr12hk1z2yosm9devw7knvs.png"><br>  <i>Dalam hal ini, bebannya jelas abnormal :)</i> <br><br>  <b>Apa yang harus dilakukan</b>  Jika beberapa VM dengan sejumlah besar core berjalan pada hypervisor yang sama dan ada kelebihan langganan pada CPU, maka penghitung co-stop dapat tumbuh, yang akan menyebabkan masalah dengan kinerja VM ini. <br><br>  Juga, co-stop akan meningkat jika utas digunakan untuk kernel aktif dari satu VM pada inti server fisik yang sama dengan hyper-treading diaktifkan.  Situasi seperti itu dapat muncul, misalnya, jika VM memiliki lebih banyak core daripada yang ada secara fisik di server tempat kerjanya, atau jika pengaturan "preferHT" diaktifkan untuk VM.  Anda dapat membaca tentang pengaturan ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Untuk menghindari masalah dengan kinerja VM karena co-stop yang tinggi, pilih ukuran VM sesuai dengan rekomendasi dari produsen perangkat lunak yang berjalan pada VM ini, dan dengan kemampuan server fisik di mana VM berjalan. <br><br>  Jangan menambahkan kernel sebagai cadangan, ini dapat menyebabkan masalah kinerja tidak hanya dari VM itu sendiri, tetapi juga dari tetangga servernya. <br><br><h3>  Metrik CPU Berguna Lainnya </h3><br>  <b>Jalankan</b> - berapa banyak waktu (ms) untuk periode pengukuran vCPU dalam status RUN, yaitu, benar-benar melakukan pekerjaan yang bermanfaat. <br><br>  <b>Menganggur</b> - berapa banyak waktu (ms) untuk periode pengukuran vCPU tidak aktif.  Nilai Idle tinggi bukan masalah, hanya vCPU yang "tidak ada hubungannya." <br><br>  <b>Tunggu</b> - berapa banyak waktu (ms) untuk periode pengukuran vCPU dalam status Tunggu.  Karena IDLE termasuk dalam penghitung ini, nilai Tunggu yang tinggi juga tidak menunjukkan masalah.  Tetapi jika pada IDLE tinggi Tunggu rendah, maka VM sedang menunggu untuk operasi I / O untuk menyelesaikan, dan ini, pada gilirannya, dapat menunjukkan masalah dengan kinerja hard disk atau beberapa perangkat VM virtual. <br><br>  <b>Terbatas terbatas</b> - berapa banyak waktu (ms) untuk periode pengukuran vCPU dalam status Siap karena batas sumber daya yang ditetapkan.  Jika kinerjanya sangat rendah, ada baiknya memeriksa nilai penghitung ini dan batas CPU dalam pengaturan VM.  VM mungkin memang memiliki batasan yang tidak Anda sadari.  Sebagai contoh, ini terjadi ketika VM miring dari template tempat batas CPU ditetapkan. <br><br>  <b>Swap wait</b> - berapa lama vCPU menunggu operasi dengan VMkernel Swap selama periode pengukuran.  Jika nilai-nilai penghitung ini di atas nol, maka VM pasti memiliki masalah kinerja.  Kami akan berbicara lebih banyak tentang SWAP di artikel tentang penghitung RAM. <br><br><h3>  ESXTOP </h3><br>  Jika penghitung kinerja di vCenter baik untuk menganalisis data historis, maka analisis online masalah sebaiknya dilakukan di ESXTOP.  Di sini, semua nilai disajikan dalam bentuk jadi (tidak perlu menerjemahkan apa pun), dan periode pengukuran minimum adalah 2 detik. <br>  Layar ESXTOP pada CPU dipanggil oleh tombol "c" dan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/5x/8g/-o/5x8g-ovkxsc4xsuuvvk6guv3t0u.png"><br><br>  Untuk kenyamanan, Anda hanya dapat meninggalkan proses mesin virtual dengan menekan Shift-V. <br>  Untuk melihat metrik untuk masing-masing inti VM, tekan "e" dan ketikkan GID dari VM yang Anda minati (30919 pada tangkapan layar di bawah): <br><br><img src="https://habrastorage.org/webt/tu/fn/jz/tufnjzwauierg5thzwsij3elpca.png"><br><br>  Secara singkat buka kolom yang disajikan secara default.  Kolom tambahan dapat ditambahkan dengan menekan "f". <br><br>  <b>NWLD (Number of Worlds)</b> - jumlah proses dalam grup.  Untuk memperluas grup dan melihat metrik untuk setiap proses (misalnya, untuk setiap inti dari VM multi-inti), tekan "e".  Jika grup memiliki lebih dari satu proses, maka nilai metrik untuk grup sama dengan jumlah metrik untuk masing-masing proses. <br><br>  <b>% DIGUNAKAN</b> - berapa banyak siklus CPU server menggunakan suatu proses atau kelompok proses. <br><br>  <b>% RUN</b> - berapa banyak waktu selama periode pengukuran proses berada dalam keadaan RUN, mis.  melakukan pekerjaan yang bermanfaat.  Ini berbeda dari% USED karena tidak memperhitungkan hyper-threading, penskalaan frekuensi, dan waktu yang dihabiskan untuk tugas sistem (% SYS). <br><br>  <b>% SYS</b> - waktu yang dihabiskan untuk tugas-tugas sistem, misalnya: menangani interupsi, input / output, operasi jaringan, dll. Nilainya dapat tinggi jika ada banyak input / output pada VM. <br><br>  <b>% OVRLP</b> - berapa banyak waktu inti fisik yang digunakan untuk menjalankan proses VM dihabiskan pada tugas-tugas dari proses lain. <br><br>  Metrik ini terkait sebagai berikut: <br><br>  % DIGUNAKAN =% RUN +% SYS -% OVRLP. <br><br>  Biasanya metrik% USED lebih informatif. <br><br>  <b>% TUNGGU</b> - berapa banyak waktu selama periode pengukuran proses dalam status Tunggu.  Termasuk IDLE. <br><br>  <b>% IDLE</b> - berapa lama proses dalam status IDLE selama periode pengukuran. <br><br>  <b>% SWPWT</b> - berapa lama vCPU menunggu operasi dengan VMkernel Swap selama periode pengukuran. <br><br>  <b>% VMWAIT</b> - berapa lama vCPU berada dalam keadaan menunggu suatu peristiwa (biasanya I / O) selama periode pengukuran.  Tidak ada penghitung serupa di vCenter.  Nilai tinggi menunjukkan masalah dengan input / output ke VM. <br><br>  % WAIT =% VMWAIT +% IDLE +% SWPWT. <br><br>  Jika VM tidak menggunakan VMkernel Swap, maka ketika menganalisis masalah kinerja, disarankan untuk melihat% VMWAIT, karena metrik ini tidak memperhitungkan waktu ketika VM tidak melakukan apa-apa (% IDLE). <br><br>  <b>% RDY</b> - berapa lama proses dalam status Siap selama periode pengukuran. <br><br>  <b>% CSTP</b> - berapa lama proses dalam status pos selama periode pengukuran. <br><br>  <b>% MLMTD</b> - berapa banyak waktu selama periode pengukuran vCPU dalam status Siap karena batas sumber daya yang ditetapkan. <br><br>  % WAIT +% RDY +% CSTP +% RUN = 100% - inti VM selalu di salah satu dari empat negara ini. <br><br><h3>  CPU pada hypervisor </h3><br>  Ada juga penghitung kinerja CPU untuk hypervisor di vCenter, tetapi mereka tidak mewakili sesuatu yang menarik - itu hanya jumlah penghitung untuk semua VM di server. <br>  Cara paling mudah untuk melihat status CPU di server ada di tab Summary: <br><br><img src="https://habrastorage.org/webt/cr/zn/bb/crznbbcz3ifhippyvvrpqaotvps.png"><br><br>  Untuk server, dan juga untuk mesin virtual, ada Alarm standar: <br><br><img src="https://habrastorage.org/webt/-v/x0/gz/-vx0gzuta3wskstyrmu8ylixqla.png"><br><br>  Dengan beban yang tinggi pada CPU server, VM yang menjalankannya mulai mengalami masalah kinerja. <br><br>  Dalam ESXTOP, data pemanfaatan CPU server disajikan di bagian atas layar.  Selain beban CPU standar, yang tidak informatif untuk hypervisor, ada tiga metrik lagi: <br><br>  <b>CORE UTIL (%)</b> - memuat inti dari server fisik.  Penghitung ini menunjukkan berapa banyak waktu kernel melakukan pekerjaan selama periode pengukuran. <br><br>  <b>PCPU UTIL (%)</b> - jika hyper-threading diaktifkan, maka ada dua utas (PCPU) untuk setiap inti fisik.  Metrik ini menunjukkan seberapa banyak waktu setiap utas bekerja. <br><br>  <b>PCPU USED (%)</b> sama dengan PCPU UTIL (%), tetapi memperhitungkan penskalaan frekuensi akun (baik menurunkan frekuensi inti untuk menghemat energi atau meningkatkan frekuensi inti karena teknologi Turbo Boost) dan hyper-threading. <br><br>  PCPU_USED% = PCPU_UTIL% * frekuensi inti efektif / frekuensi inti nominal. <br><br><img src="https://habrastorage.org/webt/gk/il/nh/gkilnhtdazgv5nxiwbydkhda-oe.png"><br>  <i>Dalam tangkapan layar ini, untuk beberapa inti, karena operasi Turbo Boost, nilai USED lebih dari 100%, karena frekuensi inti lebih tinggi dari nominal.</i> <br><br>  Beberapa kata tentang bagaimana hyper-threading diperhitungkan.  Jika proses berjalan 100% dari waktu pada kedua utas inti fisik server, sedangkan inti berjalan pada frekuensi nominal, maka: <br><br><ul><li>  CORE UTIL untuk kernel akan menjadi 100%, </li><li>  PCPU UTIL untuk kedua utas akan menjadi 100%, </li><li>  PCED USED untuk kedua utas akan menjadi 50%. </li></ul><br>  Jika kedua utas tidak bekerja 100% dari waktu selama periode pengukuran, maka pada periode tersebut ketika utas bekerja secara paralel, PCPU DIGUNAKAN untuk inti dibagi menjadi setengah. <br><br>  ESXTOP juga memiliki layar dengan parameter konsumsi daya dari server CPU.  Di sini Anda dapat melihat apakah server menggunakan teknologi hemat energi: Status-C dan Status-P.  Dipanggil oleh tombol p: <br><br><img src="https://habrastorage.org/webt/cd/qv/he/cdqvhelnmce9qeseanbqzl3qsqs.png"><br><br><h3>  Masalah Kinerja CPU yang Umum </h3><br>  Akhirnya, saya akan membahas alasan khas masalah dengan kinerja VM CPU dan memberikan tips singkat untuk menyelesaikannya: <br><br>  <b>Kecepatan clock inti tidak cukup.</b>  Jika tidak ada cara untuk mentransfer VM ke kernel yang lebih efisien, Anda dapat mencoba mengubah pengaturan energi untuk membuat Turbo Boost bekerja lebih efisien. <br><br>  <b>Ukuran yang salah dari VM (terlalu banyak / sedikit inti).</b>  Jika Anda menaruh beberapa core, akan ada beban tinggi pada VM CPU.  Jika banyak, tangkap pemberhentian bersama yang tinggi. <br><br>  <b>Berlebih-lebihan dari CPU pada server.</b>  Jika VM siap tinggi, kurangi langganan berlebih pada CPU. <br><br>  <b>Topologi NUMA salah pada VM besar.</b>  Topologi NUMA yang dilihat oleh VM (vNUMA) harus cocok dengan topologi server NUMA (pNUMA).  Tentang diagnostik dan kemungkinan solusi untuk masalah ini ditulis, misalnya, dalam buku <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"VMware vSphere 6.5</a> .  Jika Anda tidak ingin masuk lebih dalam dan Anda tidak memiliki batasan lisensi pada OS yang diinstal pada VM, lakukan banyak soket virtual pada VM pada satu inti.  Anda tidak akan kehilangan banyak :) <br><br>  Itu saja untuk CPU.  Ajukan pertanyaan.  Pada bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">selanjutnya saya</a> akan berbicara tentang RAM. <br><br><div class="spoiler">  <b class="spoiler_title">Tautan yang bermanfaat</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://virtual-red-dot.info/vm-cpu-counters-vsphere/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://kb.vmware.com/kb/1017926</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://www.yellow-bricks.com/2012/07/17/why-is-wait-so-high/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://communities.vmware.com/docs/DOC-9279</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/techpaper/performance/whats-new-vsphere65-perf.pdf</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://pages.rubrik.com/host-resources-deep-dive_request.html</a> </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id452884/">https://habr.com/ru/post/id452884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id452856/index.html">Mengapa proyek indie tidak bisa dirilis?</a></li>
<li><a href="../id452872/index.html">Karena saya tidak mempersiapkan dan mengadakan seminar Rosnanov tentang FPGA di Moskow. Berencana untuk melakukan hal yang sama di Las Vegas dan Zelenograd</a></li>
<li><a href="../id452876/index.html">UICollectionViewLayout untuk pizza dari belahan yang berbeda</a></li>
<li><a href="../id452880/index.html">Kebocoran data pengguna sensasional untuk Januari - April 2019</a></li>
<li><a href="../id452882/index.html">Kesalahan Pelanggan pada Kontak Pertama dengan Freelancer</a></li>
<li><a href="../id452886/index.html">Proyek Wiki dan nama Noosphere di HACKNOWLEGE</a></li>
<li><a href="../id452888/index.html">Dekat Munich mulai menguji tiltrotor lima-kursi Lilium Jet ukuran penuh</a></li>
<li><a href="../id452890/index.html">23 Mei 18:30 - siaran langsung QIWI Kitchen</a></li>
<li><a href="../id452892/index.html">Bagaimana cara non-programmer pindah ke AS: petunjuk langkah demi langkah</a></li>
<li><a href="../id452894/index.html">Face Anti-Spoofing atau secara teknis mengenali penipu dari seribu wajah</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>