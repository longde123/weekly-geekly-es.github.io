<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄºÔ∏è üì≤ üè§ ¬øC√≥mo hacer amigos PHPstorm, xDebug y ramas remotas compiladas a trav√©s de Docker? Demasiado simple ... ‚ÜñÔ∏è ü¶ê üéΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen dia, Habr! 

 Hace un a√±o, mi proceso de depuraci√≥n de c√≥digo en PHP consist√≠a en dos l√≠neas: 



var_dump($variable); die();  
 De vez en cuando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo hacer amigos PHPstorm, xDebug y ramas remotas compiladas a trav√©s de Docker? Demasiado simple ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423337/">  Buen dia, Habr! <br><br>  Hace un a√±o, mi proceso de depuraci√≥n de c√≥digo en PHP consist√≠a en dos l√≠neas: <br><br><pre><code class="php hljs">var_dump($variable); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>();</code> </pre> <br>  De vez en cuando, por supuesto, ten√≠a que usar construcciones m√°s "complejas": <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data);</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($variable, JSON_UNESCAPED_UNICODE); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br>  No, que eres!  Lo sab√≠a, en nuestro tiempo no es apropiado que un programador cultural haga esto <br><br><div class="spoiler">  <b class="spoiler_title">embarcaciones antiguas</b> <div class="spoiler_text">  una broma sobre otra embarcaci√≥n antigua <br></div></div><br>  Pero honestamente, siempre tuve miedo de lo que no entend√≠a.  Incluyendo <s>impresoras</s> xDebug, especialmente c√≥mo configurar todo esto.  Un buen d√≠a, logr√© hacerlo en mi autom√≥vil y en un proyecto local: no hab√≠a l√≠mite para la alegr√≠a.  Muchos meses despu√©s, me encontr√© con un nuevo problema, c√≥mo depurar en PHPstorm a trav√©s de xDebug, si el proyecto est√° construido de forma remota por Docker a trav√©s de CI. <br><br>  Si, como yo, tiene dificultades para configurar diferentes cosas, bienvenido a la escena, le contar√© sobre mi experiencia en la configuraci√≥n de un entorno de depuraci√≥n con palabras aterradoras como Docker, xDebug, CI. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Para aquellos que no les gusta el agua y quieren ir directamente a la esencia del entorno.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a> <br><h3>  ¬øPor qu√© deber√≠a alejarse de los m√©todos de depuraci√≥n con moho y cambiar a tecnolog√≠as adecuadas? </h3><br>  Enga√±√© un poco al gato, me dediqu√© a la depuraci√≥n artesanal, no solo porque ten√≠a miedo de configurar algo, y no porque fuera demasiado est√∫pido, sino simplemente porque no necesitaba algo m√°s conveniente.  Muy a menudo, trabajaba en proyectos localmente en mi computadora bastante poderosa, y las tareas no eran tan complicadas que el proceso de depuraci√≥n comenz√≥ a ocupar una posici√≥n bastante significativa. <br><br>  En alg√∫n momento, me di cuenta de que estaba inc√≥modo e intent√© hacer amigos xDebug y PHPstorm cuando trabajaba en un proyecto local.  El problema es que la mayor√≠a de la documentaci√≥n y las gu√≠as que encontr√© implican que la persona que las lee tiene bastante conocimiento del √°rea tem√°tica y entiende todo, en mi caso este no fue el caso y pas√© 4-5 en mi primera configuraci√≥n de xDebug horas en 2 pm.  Fue una moral bastante dura, me sent√≠ infinitamente tonto.  Sin embargo, result√≥ configurar, ¬°todo funcion√≥! <br><br>  S√≠, se volvi√≥ m√°s conveniente, localmente, en casa, pero en el trabajo principal hice los sitios de forma remota, y la mayor√≠a de las veces no pude descargar el sitio localmente (debido a una m√°quina d√©bil o un proceso de implementaci√≥n inconveniente), o afectar la configuraci√≥n del servidor debido a hosting, por lo tanto, realiz√≥ ediciones "en vivo" y depur√≥ a trav√©s de html-commenting print_r (en ese trabajo fue "normal", aunque no orgulloso de esta experiencia). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cd1/3af/ffdcd13af6a976ca99ff2f26976458e9.jpg" alt="imagen"><br><br>  Sin embargo, hace 3 meses me mud√© a una empresa m√°s fresca y comenc√© a participar en un proyecto realmente serio con una gran carga.  Y aqu√≠ muchas cosas han cambiado para m√≠.  La infraestructura y el proceso de desarrollo son aproximadamente los siguientes: hay un servidor GitLab, cada proyecto tiene su propio repositorio, las tareas llegan a Jira, se crea una rama por n√∫meros de tarea, al crear una rama usando CI, se crea autom√°ticamente su propia caja de arena con el sitio donde trabaja en silencio, cada inserci√≥n vuelve a ensamblar la rama, al final del trabajo que le da a la revisi√≥n del c√≥digo, vierta la rama en el maestro. <br><br>  Todo est√° bien, excepto un PERO, cada reconstrucci√≥n de una rama en mi caso lleva unos 10 segundos.  En el proceso de desarrollo en s√≠, este es un momento insignificante, ya que ya pas√© la etapa en la que tuve que verificar la operabilidad del c√≥digo en casi todas las l√≠neas debido a la incertidumbre y la poca experiencia.  Sin embargo, cuando cambi√© a la depuraci√≥n, estos 10 segundos comenzaron a jugar un papel tangible.  El proceso de dicha depuraci√≥n fue el siguiente: <br><br><ul><li>  Agregar 2 l√≠neas </li><li>  Pushu commit </li><li>  Espero 10 segundos </li><li>  Mira, mira qu√© pasa </li><li>  Repetir </li></ul><br>  Seg√∫n estimaciones aproximadas, una rama lista para fusionar ten√≠a aproximadamente un 20% de confirmaciones √∫tiles y un 80% de confirmaciones de depuraci√≥n.  Supongamos que termin√© de trabajar en una rama con 300 confirmaciones, de las cuales 240 confirmaciones consumieron esencialmente 40 minutos de mi tiempo de trabajo (y este es solo el tiempo de espera para el ensamblaje de la rama, sin tener en cuenta los segundos que suman hasta minutos, para agregar 2 l√≠neas y luego eliminarlos). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9a/810/70f/b9a81070f5d6091988cee3ff3ac88463.png" alt="imagen"><br><br>  En alg√∫n momento estaba cansado y decid√≠ configurar xDebug para que el proceso de depuraci√≥n fuera menos costoso.  Desafortunadamente, mis colegas actuales no usaron esta tecnolog√≠a (estoy esperando una broma sobre "Tengo una compa√±√≠a genial donde nadie usa xDebug"), o no sab√≠an / ‚Äã‚Äãno recordaban c√≥mo hacer amigos con el IDE de xDebug cuando la sucursal yendo de forma remota a trav√©s de CI, y como nunca he desarrollado y, como mencion√© anteriormente, el proceso de configuraci√≥n es un proceso doloroso para m√≠, me llev√≥ aproximadamente 6 horas de tiempo puro para finalmente trabajar, y entend√≠ el proceso, y eso ser√≠a lo suficientemente conveniente. <br><a name="process"></a><br><h3>  Proceso de configuraci√≥n </h3><br>  No entrar√© en detalles sobre c√≥mo sujetar CI, Docker, en general, c√≥mo ensamblar la infraestructura, se supone que todo est√° hecho y todo lo que queda es configurar su entorno personal. <br><br>  Digamos que nuestro repositorio tiene algo como esta estructura: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/3ea/285/56d3ea285e90fed97ea116ac79715381.jpg" alt="imagen"><br><br>  Primero debemos verificar si xDebug est√° en la imagen actual, para esto puedes usar <b>phpinfo ();</b> <br><br>  Si xDebug ya est√° incluido en el ensamblaje, est√° bien, si no, entonces revise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta fuente</a> , que me ayud√≥ directamente en la configuraci√≥n en s√≠, sin embargo, tom√© un camino un poco diferente. <br><br><h4>  Configurar php.ini </h4><br>  Para que todo funcione al final, 2 configuraciones de xDebug son importantes para nosotros: <br><br><ul><li>  xdebug.remote_enable </li><li>  xdebug.remote_host </li></ul><br>  En el ensamblaje final de la rama remota, <b>remote_enable</b> debe estar habilitado y en <b>remote_host</b> debe <b>asignarse la</b> IP de su computadora en la red.  Incluyamos esta configuraci√≥n en nuestra compilaci√≥n. <br><br>  Primero debe averiguar d√≥nde se almacenan las configuraciones de php, pueden ubicarse en <b>/usr/local/etc/php/conf.d/php.ini</b> , o el archivo .ini en s√≠ mismo puede tener un nombre diferente, en mi caso es <b>/ usr / local / etc / php / conf.d / php-settings.ini</b> .  Puede averiguarlo desde la configuraci√≥n de la imagen recopilada. <br><br>  Creamos nuestra configuraci√≥n adicional en nuestra sucursal a trav√©s del mismo archivo php-settings.ini y la colocamos en <b>./build_env/php/php-settings.ini</b> <br>  Escribimos en √©l 2 de las configuraciones anteriores: <br> <code>xdebug.remote_enable = on <br> xdebug.remote_host = IP...</code> <br> <br>  A continuaci√≥n, debemos agregar este archivo a la configuraci√≥n de imagen "principal".  Hago esto a trav√©s de vol√∫menes agregando la l√≠nea a ./build_env/docker-compose/docker-compose.tmpl: <br> <code>- ${PROJECT_DIR}/build_env/php/php-settings.ini:/usr/local/etc/php/conf.d/php-settings.ini</code> <br> <br>  As√≠ es como se ve docker-compose.tmpl en mi proyecto: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/dfc/03d/6a9dfc03d0adf60127a3c03ede9b0f3e.jpg" alt="imagen"><br><br>  La pr√≥xima vez que construya la rama, puede verificar si la nueva configuraci√≥n est√° vinculada a trav√©s del mismo <b>phpinfo ();</b>  en caso afirmativo, excelente, si no, no tiene suerte y tendr√° que seguir el mismo camino que hice la primera vez :( <br><br><h4>  Personalizaci√≥n de asignaciones en PHPstorm </h4><br>  A continuaci√≥n, debe configurar PHPstorm.  Decid√≠ no usar DBgp Proxy, para no configurar las asignaciones en la ventana emergente cada vez.  En mi caso, uso una plantilla de servidor que contendr√° las asignaciones necesarias. <br><br>  Vaya a <b>Configuraci√≥n / Preferencias |</b>  <b>Idiomas y marcos |</b>  <b>Php |</b>  <b>Servidores</b> <br><br><ol><li>  Crear una plantilla de servidor </li><li>  Nombre: RAMA </li><li>  host: cualquiera, no afecta </li><li>  puerto: cualquiera, no afecta </li><li>  Depurador: xDebug </li><li>  Da un toque en Usar asignaciones de ruta </li><li>  Colocamos las asignaciones apropiadas, las carpetas locales de trabajo deben corresponder a las carpetas en el servidor donde se encuentran las ramas recopiladas, en mi caso, las compilaciones recopiladas est√°n en la carpeta / var / www / builds / your_namespace / your_project / your_branch </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/fb9/268/c0bfb9268a256e387f3464e7ce100cc0.jpg" alt="imagen"><br><br>  Guardamos estas configuraciones, las cambiaremos cada vez que trabajemos con una nueva sucursal.  Por ejemplo, si hoy trabajo con la rama web-2233, entonces cambiar√© la asignaci√≥n a <b>/ var / www / builds / build_path / web-2233</b> <br><br><h4>  Agregue una nueva variable de entorno para que el IDE extraiga autom√°ticamente las asignaciones </h4><br>  Ahora un punto bastante importante y no el m√°s obvio.  Cuando comenzamos la depuraci√≥n, PHPstorm necesita comprender qu√© archivos locales corresponden a los archivos en el servidor remoto.  Si el servidor no le proporcion√≥ una instalaci√≥n espec√≠fica, aparecer√° una ventana emergente en la que deber√° asignar manualmente las rutas.  Para que PHPstorm tome asignaciones inmediatamente de un servidor con el nombre BRANCH, debe agregar la variable de entorno <b>PHP_IDE_CONFIG</b> a nuestro ensamblado <br><br>  En <b>./build_env/docker-compose/docker-compose.tmpl</b> cree una nueva variable de entorno en el entorno: <br> <code>PHP_IDE_CONFIG: ${PHP_IDE_CONFIG}</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/793/5d1/274/7935d1274fadf298d10e57a2b6d6aba8.jpg" alt="imagen"><br><br>  En <b>.gitlab-ci.yml</b> establecemos esta variable: <br> <code>- export PHP_IDE_CONFIG="serverName=BRANCH"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/336/529/676/336529676de2d579e86a5820e02f06dc.jpg" alt="imagen"><br><br><h4>  Hecho </h4><br>  No necesitamos extensiones del navegador, no necesitamos pasar URL XDEBUG_SESSION_START = IDE_KEY para obtener par√°metros, no necesitamos agregar configuraciones adicionales. <br><br>  Solo enciende la escucha <img src="https://habrastorage.org/getpro/habr/post_images/f5f/cb7/dbd/f5fcb7dbd0b27a12b5be3ce65f1e9936.jpg" alt="imagen">  y actualice la p√°gina del sitio, tan pronto como nos topemos con el primer punto de interrupci√≥n, la aplicaci√≥n se detendr√° <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/99c/352/45799c352fe12908ae598f93d1271aeb.jpg" alt="imagen"><br><br>  Gracias por su atenci√≥n, espero que este art√≠culo sea √∫til y alguien ahorre tiempo sin pisar el mismo rastrillo que yo :) <br><br>  Fuentes que utilic√© durante la configuraci√≥n inicial: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://gist.github.com/chadrien/c90927ec2d160ffea9c4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://confluence.jetbrains.com/display/PhpStorm/Docker+Support+in+PhpStorm#DockerSupportinPhpStorm-DebuggingthePHPwebapplicationrunningintheDockercontainer</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423337/">https://habr.com/ru/post/es423337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423319/index.html">Integraci√≥n de c√≥digo Vivaldi. Nuestros desarrolladores cuentan</a></li>
<li><a href="../es423321/index.html">Proteger los repositorios de GitHub de confirmaciones maliciosas</a></li>
<li><a href="../es423323/index.html">"Necesitas ser flojo para convertirte en un buen probador".</a></li>
<li><a href="../es423329/index.html">Prepar√°ndose para una entrevista con una empresa Big Five</a></li>
<li><a href="../es423335/index.html">C√≥mo superar el clic en Y. Direct y AdWords por 600 mil rublos al mes</a></li>
<li><a href="../es423339/index.html">¬øHay vida bajo Windows 98, primera parte? Sobre hardware</a></li>
<li><a href="../es423341/index.html">Bajo presi√≥n p√∫blica, Sony admiti√≥ que las obras de Bach no le pertenecen.</a></li>
<li><a href="../es423343/index.html">Los valores culturales hechos de pl√°stico comienzan a decaer</a></li>
<li><a href="../es423345/index.html">Soga de miedo</a></li>
<li><a href="../es423347/index.html">¬øD√≥nde est√° mi dinero amigo: dise√±o y paquetes de Steam, localizaci√≥n y distribuidores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>