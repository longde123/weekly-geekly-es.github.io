<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè≥Ô∏è‚Äçüåà ‚ô®Ô∏è ‚ò∏Ô∏è Under the Hood Turbo Pages: Architecture de la technologie de t√©l√©chargement rapide des pages Web üìï ü§üüèª üï∫üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Stas Makeev. Chez Yandex, je dirige le d√©veloppement de la technologie pour les pages Turbo, qui permet un chargement rapide du ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Under the Hood Turbo Pages: Architecture de la technologie de t√©l√©chargement rapide des pages Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/460373/">  Bonjour, je m'appelle Stas Makeev.  Chez Yandex, je dirige le d√©veloppement de la technologie pour les pages Turbo, qui permet un chargement rapide du contenu m√™me avec une connexion lente.  Aujourd'hui, je vais parler un peu de l'architecture de notre projet aux lecteurs de Habr. <br><br>  Le bonheur de l'utilisateur est largement influenc√© par la rapidit√© avec laquelle il voit le contenu de la page Web.  La vitesse inqui√®te beaucoup: dans la boutique d'applications mobiles, seul Speedtest compte plus de cent millions d'installations.  Les fournisseurs, op√©rateurs mobiles, d√©veloppeurs de sites Web et d'applications s'efforcent de fournir l'acc√®s le plus rapide au contenu afin que les clients soient satisfaits. <br><br>  La vitesse de t√©l√©chargement moyenne dans les r√©seaux mobiles russes est de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">16,26 Mbit / s</a> - c'est un tr√®s bon indicateur.  Mais la vitesse de connexion est in√©gale, nous sommes toujours confront√©s √† une connexion Internet lente - 3G, 2G, EDGE.  Vous √©tiez s√ªrement dans une situation o√π dans un caf√© ou un centre commercial, sur la route ou √† la campagne, la vitesse habituellement √©lev√©e est consid√©rablement r√©duite: les sites se chargent pendant des dizaines de secondes, voire plus. <br><br>  La technologie Turbo-page r√©sout le probl√®me d'acc√®s au contenu, y compris √† des vitesses de connexion faibles ou instables.  Ceci est important pour les propri√©taires de sites qui ont un pourcentage r√©duit de visiteurs "tombant" pendant la transition de la recherche. <br><br><img src="https://habrastorage.org/webt/r5/du/oe/r5duoeno8m1eogct3fsti4qgupc.png"><br><a name="habracut"></a><br><h2>  Comment fonctionnent les pages Turbo </h2><br>  Le propri√©taire du site enregistre le flux RSS dans Yandex.Webmaster.  Le flux entre dans le syst√®me de contenu Turbo Pages, qui prend des mises √† jour toutes les quelques minutes.  Contenu lourd - principalement des images et des vid√©os - que nous mettons en cache et disposons dans un CDN.  En plus du RSS, le contenu peut √™tre transmis via l'API et l'autoparser. <br><blockquote>  Le volume d'images en cache des pages Turbo approche les 100 To </blockquote><br>  La fiabilit√© et la tol√©rance aux pannes du syst√®me sont importantes pour nous, c'est pourquoi nous faisons plusieurs r√©pliques des donn√©es et les stockons dans nos trois centres de donn√©es.  Dans chaque centre de donn√©es, des centaines de serveurs traitent des milliers de demandes par seconde, ce qui vous permet d'√©quilibrer la charge de mani√®re flexible. <br><br>  Le syst√®me de contenu Turbo Pages m√©rite un article s√©par√©, et nous l'√©crirons.  Pour l'instant, nous nous limitons √† un sch√©ma simplifi√©. <br><br><img src="https://habrastorage.org/webt/yu/s8/5g/yus85gt3p8lf4_91p87latqspac.png"><br><br><h2>  Que se passe-t-il lorsque vous ouvrez une URL dans un navigateur? </h2><br>  Lorsque l'utilisateur acc√®de √† la page Turbo, quelque chose comme ce qui suit se produit ¬´sous le capot¬ª: <br><br><img src="https://habrastorage.org/webt/pw/g0/8w/pwg08wrb3dnoc5cozornpe_6uco.png"><br><br>  <b>L'adaptateur HTTP</b> traite la demande HTTP de l'utilisateur et envoie une demande au graphique souhait√© dans AppHost et le rapport de rendu. <br><br>  <b>AppHost</b> est un composant sp√©cial qui encapsule l'interaction r√©seau des sources, d√©crit comme un graphique de d√©pendance.  Les sources sont interrog√©es dans l'ordre de tri topologique sur ce graphe; toute logique m√©tier y est cousue et dans la configuration du graphe.  En particulier, au niveau du graphique, le stockage KV est interrog√© et une demande de donn√©es est envoy√©e √† des API tierces. <br><br>  <b>Report-renderer</b> est une application √©crite en node.js qui accepte les entr√©es JSON, ex√©cute les mod√®les √©crits en JS et renvoie une cha√Æne. <br><br>  Tout cela se produit presque instantan√©ment. <br><br><h2>  Qu'est-ce qui affecte la vitesse de t√©l√©chargement? </h2><br>  Nous travaillons sur tous les aspects de la vitesse: de l'impl√©mentation de HTTP / 2 sur l'√©quilibreur et l'optimisation de la n√©gociation TLS √† l'optimisation manuelle de SVG.  Dans ce cas, vous devez comprendre la composition de la vitesse de l'utilisateur final. <br><br>  Au sein de l'√©quipe, nous distinguons trois √©tapes du traitement des demandes: serveur, r√©seau et client. <br><br>  <b>Serveur</b> <br><br>  Cela inclut tout ce qui se passe dans les centres de donn√©es: depuis le moment o√π la requ√™te HTTP arrive sur notre serveur jusqu'√† la g√©n√©ration de la page HTML, qui est envoy√©e directement au client. <br><br>  Le temps de traitement des demandes sur le serveur doit √™tre minimal.  Malgr√© les valeurs relativement petites, cela affecte absolument toutes les requ√™tes des utilisateurs.  De plus, tous les processus se produisent dans notre environnement contr√¥l√© - il ne peut tout simplement pas y avoir d'excuses pour des retards importants. <br><br>  L'heure du serveur est constitu√©e des interactions r√©seau entre les sommets du graphe de d√©pendance source et les temps de fonctionnement de chacun des sommets.  Mais nous ne nous concentrerons pas sur les caract√©ristiques de l'infrastructure r√©seau des centres de donn√©es Yandex - ils m√©ritent un article s√©par√©. <br><br>  Je veux pr√™ter plus d'attention au deuxi√®me composant - le temps d'ex√©cution de chacun des pics.  √Ä titre d'exemple, examinons nos principes et outils pour travailler avec le composant Report-renderer, qui est responsable de la g√©n√©ration du HTML.  Pour les autres composants, ils sont tr√®s similaires. <br><br>  Dans notre processus CI, certaines t√¢ches acceptent les demandes d'extraction dans dev, qui effectuent des v√©rifications de base pour chaque validation dans la branche de fonctionnalit√©.  Si des indicateurs d√©passent les limites sp√©cifi√©es, l'influence dans dev est gel√©e jusqu'√† ce que les raisons soient clarifi√©es. <br><br>  Mesures cl√©s √† ce stade: <br><br><ul><li>  heure du mod√®le; </li><li>  taille de la page r√©capitulative; </li><li>  taille des fichiers statiques. </li></ul><br>  Nous collectons des statistiques client (CSS et JS) pour chaque page en fonction des donn√©es, mais les bundles avec les blocs eux-m√™mes sont ind√©pendants de la demande, il suffit donc de comparer la taille des fichiers de la branche avec des fichiers similaires en dev.  Pour diff√©rents types de fichiers, nous avons d√©fini diff√©rentes valeurs de seuil, apr√®s quoi la t√¢che ne peut pas √™tre vers√©e en dev sans "OK" de la part des responsables de la vitesse. <br><br>  En r√®gle g√©n√©rale, il existe une analyse conjointe du code et recherche des moyens d'optimiser. <br><br>  Nous devons agir diff√©remment avec les m√©triques de taille de page et le temps de mod√®le, car ils d√©pendent fortement d'une demande sp√©cifique et une sorte de certitude statistique est n√©cessaire.  De plus, vous ne pouvez pas prendre de requ√™tes synth√©tiques, car ce seront des mesures malhonn√™tes.  Par cons√©quent, nous collectons constamment des demandes d'utilisateurs al√©atoires pour les journaux d'acc√®s, en formons des ¬´cartouches¬ª et les ¬´tirons¬ª avec des mod√®les dans la branche avec des modifications et avec le dev.  Cela vous permet de d√©tecter les modifications m√™me sur des demandes peu populaires. <br><br>  Nous avons plusieurs ¬´paniers de demandes¬ª qui nous permettent de couvrir la majeure partie du trafic vers les pages Turbo. <br><br>  En plus d'optimiser nos mod√®les, nous suivons les optimisations qui se produisent dans V8.  Par exemple, le passage √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TurboFan a</a> donn√© d'excellents r√©sultats: le temps de mod√©lisation c√¥t√© serveur a √©t√© consid√©rablement r√©duit. <br><br><img src="https://habrastorage.org/webt/tz/pd/kx/tzpdkxmsqdg8x5sonpthevid_nk.png"><br>  Le temps de mod√©lisation du serveur a diminu√© apr√®s le passage √† TurboFan <br><br>  <b>R√©seau</b> <br><br>  Dans la partie r√©seau, nous incluons tout ce qui se passe entre le client et le serveur: temps de transfert des donn√©es, taille de page et statique, ainsi que la mise en cache des ressources.  C'est d√©j√† plus int√©ressant, car √† partir de nos centres de donn√©es confortables, nous nous trouvons dans le monde ext√©rieur sauvage, o√π tout ne d√©pend pas de nous.  Les mesures deviennent un peu plus compliqu√©es, et surtout - vous pouvez obtenir des r√©sultats vraiment tangibles en centaines de millisecondes. <br><br>  Voici ce que nous faisons. <br><br>  Nous avons tordu les param√®tres TCP et TLS, qui vous permettent de gagner plusieurs RTT (Round Trip Time), cela donne d'excellents r√©sultats dans les r√©seaux √† latence √©lev√©e.  Nos coll√®gues ont d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> √† ce sujet, donc je ne vais pas approfondir. <br><br>  La taille des donn√©es transmises peut grandement affecter la vitesse de t√©l√©chargement, nous essayons donc d'envoyer uniquement ce dont la page actuelle a besoin de la mani√®re la plus efficace. <br><br>  Les images de nos interfaces sont optimis√©es √† l'aide d'ImageOptim.  Pour optimiser SVG, nous utilisons non seulement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SVGO</a> , mais nous ne sommes pas trop paresseux pour examiner le contenu et, si possible, l'optimiser √† la main. <br><br>  Nous t√©l√©chargeons des images des propri√©taires de sites vers un CDN sp√©cial, optimis√© pour le rendu d'images.  Nous recadrons le profil exif et couleur de l'image en convertissant d'abord l'image en sRGB.  Le d√©bit binaire est r√©duit √† 8 bits par canal, le niveau de compression est r√©gl√© √† 85. Le filtre lanczos est utilis√© pour le redimensionnement. <br><br>  Nous cr√©ons des dizaines d'options pour chaque image pour une combinaison de diff√©rentes tailles d'√©cran, en tenant compte de la densit√© de pixels (√©crans r√©tine).  Et bien s√ªr, nous encodons automatiquement les images au format WebP, si elles sont prises en charge par le navigateur. <br>  Les formats de texte (HTML, JavaScript, CSS) sont compress√©s √† l'aide de gzip / zopfli et brotli, si le navigateur le prend en charge. <br><br>  Il est important de ne pas oublier l'√©loignement des utilisateurs des serveurs.  Les pages turbo sont utilis√©es dans de nombreuses r√©gions et le contenu peut √™tre quelconque.  Nous ne faisons donc aucun compromis et pour r√©duire la latence m√™me dans les r√©gions les plus recul√©es, nous utilisons CDN, qui est en constante expansion. <br><br>  Et bien s√ªr, la requ√™te la plus rapide est qu'ils ne le font pas du tout.  Toutes les statistiques sont fournies avec une mise en cache √©ternelle √† partir d'un domaine s√©par√© sans cookies, et pour augmenter le cache, il peut encore √™tre r√©chauff√© en plus sur la page principale et la page avec les r√©sultats de la recherche. <br><br>  <b>Client</b> <br><br>  Il ne suffit pas de former une r√©ponse du serveur et de la transmettre au navigateur via le r√©seau, elle doit encore √™tre affich√©e efficacement.  Nous optimisons l'heure de d√©but du rendu de la page afin que la personne commence √† lire le contenu plus rapidement. <br><br>  Dans l'en-t√™te HTML, nous ¬´r√©chauffons¬ª la connexion √† nos serveurs de distribution statiques et la pr√©chargons √©galement.  Styles int√©gr√©s √† la page, ce qui permet au navigateur de commencer √† afficher la page sans attendre le chargement des styles sur le r√©seau. <br><br>  Les images de contenu, les incorporations et les publicit√©s ne sont pas charg√©es imm√©diatement, mais au fur et √† mesure qu'elles lisent la page, lorsqu'elles se rapprochent du champ de vision de l'utilisateur. <br><br>  JavaScript est partiellement int√©gr√© dans HTML et tous les autres scripts sont charg√©s √† la fin avec des requ√™tes HTTP distinctes.  Les scripts essentiels au d√©marrage, la collecte des erreurs et des m√©triques, ainsi que les composants qui ne sont pas souvent trouv√©s sur la page sont int√©gr√©s dans la page. <br><br>  Nous collectons des m√©triques de chargement de page RUM.  Le plus critique: le temps jusqu'au premier octet, le premier dessin et le d√©but de l'interactivit√©, lorsque tous les scripts ont termin√© l'initialisation et que l'utilisateur peut utiliser la page. <br><br>  La plupart des utilisateurs n'acc√®dent pas directement aux pages Turbo, mais √† partir d'autres services Yandex, et nous voulions √©valuer le temps de chargement des pages dans le contexte de l'exp√©rience utilisateur.  Non seulement obtenir un temps abstrait dans le vide, mais une mesure de la fa√ßon dont l'utilisateur voit tout. <br><br>  Nous avons donc formul√© la m√©trique de vitesse int√©grale: <br> <code>max (firstContentfulPaint, firstImageLoadTime, timeToVisible) ‚Äî timeToClick</code> <br> <br>  O√π: <br><br><ul><li>  timeToClick - temps de clic absolu qui a conduit √† l'affichage de la page Turbo.  Cela peut √™tre un clic sur un extrait de la page de r√©sultats de recherche ou sur une carte dans Yandex.Zen. </li><li>  firstImageLoadTime - temps de chargement absolu de la premi√®re image de contenu dans le premier √©cran. </li><li>  timeToVisible - le temps absolu o√π la page entre dans l'√©tat visible.  Cela est vrai pour les cas o√π la page a √©t√© charg√©e en arri√®re-plan. </li></ul><br>  Et obtenu une m√©trique d'exp√©rience utilisateur: <br><br><ul><li>  si 2/3 de l'√©cran est occup√© par une image qui n'a pas encore √©t√© charg√©e, l'int√©grit√© de la premi√®re m√©triqueContentfulPaint est plut√¥t douteuse; </li><li>  il y a beaucoup de gestionnaires d'√©v√©nements sur les liens, entre le clic et l'heure de d√©but r√©elle du chargement de la page, une heure non nulle pourrait passer, ce que j'aimerais comprendre. </li></ul><br><img src="https://habrastorage.org/webt/zb/kx/m_/zbkxm_or2yhbbupxfcrk9ugzbic.png"><br><br>  Nous d√©veloppons constamment des technologies afin que les sites attirent plus de visiteurs.  D√©sormais, une page Turbo se charge en moyenne 15 fois plus rapidement qu'une version mobile standard.  Des dizaines de milliers de sites utilisent Turbo et le nombre total de visites sur ces sites d√©passe les 12 milliards. <br><br>  Tout cela est le r√©sultat du travail des d√©veloppeurs, des services d'assistance, des gestionnaires travaillant avec les propri√©taires de sites et bien d'autres.  Au fil du temps, l'√©quipe, bien s√ªr, s'agrandit.  Par exemple, nous recherchons maintenant des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cialistes du frontend et du backend</a> et nous serons heureux de voir de nouveaux coll√®gues. <br><br>  Quels composants de la technologie Turbo Page aimeriez-vous lire √† l'avenir des documents techniques plus d√©taill√©s?  Quelle exp√©rience vous int√©resserait?  Nous accueillerons √©galement les commentaires et les id√©es.  Je vous remercie! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460373/">https://habr.com/ru/post/fr460373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460359/index.html">Cours Young Game Designer 2: √©quilibrer la progression et la dynamique sans math√©matiques</a></li>
<li><a href="../fr460361/index.html">Grande FAQ sur la cybers√©curit√© des syst√®mes d'information m√©dicale</a></li>
<li><a href="../fr460363/index.html">7 facteurs manquants dans l'approche 12 Factor App</a></li>
<li><a href="../fr460365/index.html">Trace distribu√©e: nous avons tout mal fait</a></li>
<li><a href="../fr460367/index.html">Chaos Engineering: l'art de la destruction intentionnelle. Partie 1</a></li>
<li><a href="../fr460375/index.html">Livre "Machine Learning for Business and Marketing"</a></li>
<li><a href="../fr460377/index.html">Utilisation de Liquibase pour g√©rer la structure de la base de donn√©es dans une application Spring Boot. Partie 1</a></li>
<li><a href="../fr460381/index.html">Qu'est-ce que l'assertivit√© et pourquoi est-elle n√©cessaire</a></li>
<li><a href="../fr460383/index.html">Les transitions d'√©cran dans Legend of Zelda utilisent les fonctionnalit√©s non document√©es de NES</a></li>
<li><a href="../fr460387/index.html">Guide du d√©butant SELinux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>