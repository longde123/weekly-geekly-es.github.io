<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèª üë©üèΩ‚Äçüöí üò´ Learning Go: √©crire un messager p2p avec un cryptage de bout en bout üë®üèª‚Äç‚öñÔ∏è üç° üöà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Encore un autre P2P Messenger 


 La lecture des revues et de la documentation linguistique ne suffit pas pour apprendre √† y √©crire des applications p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Learning Go: √©crire un messager p2p avec un cryptage de bout en bout</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437686/"><h1 id="yet-another-p2p-messenger">  Encore un autre P2P Messenger </h1><br><p>  La lecture des revues et de la documentation linguistique ne suffit pas pour apprendre √† y √©crire des applications plus ou moins utiles. </p><br><p>  Assurez-vous de consolider, vous devez cr√©er quelque chose d'int√©ressant afin que les d√©veloppements puissent √™tre utilis√©s dans d'autres t√¢ches. </p><br><p><img src="https://habrastorage.org/webt/kt/bm/3r/ktbm3rsivunfcdcvcyqvnm14f5u.png" alt="Exemple d'interface utilisateur de chat ReactJs"></p><br><p>  Cet article est destin√© aux d√©butants int√©ress√©s par la langue go et les r√©seaux peer-to-peer. <br>  Et pour les professionnels qui peuvent proposer des id√©es raisonnables ou critiquer de mani√®re constructive. </p><a name="habracut"></a><br><p>  Je programme depuis un certain temps avec diff√©rents degr√©s d'immersion en java, php, js, python. <br>  Et chaque langage de programmation est bon dans son domaine. </p><br><p>  Le domaine principal de Go est la cr√©ation de services distribu√©s, de microservices. <br>  Le plus souvent, un microservice est un petit programme qui ex√©cute ses fonctionnalit√©s hautement sp√©cialis√©es. </p><br><p> Mais les microservices devraient toujours pouvoir communiquer entre eux, donc l'outil de cr√©ation de microservices devrait permettre une mise en r√©seau facile et indolore. <br>  Pour tester cela, nous allons √©crire une application organisant un r√©seau d√©centralis√© de pairs (Peer-To-Peer), le plus simple est un messager p2p (au fait, existe-t-il un synonyme russe pour ce mot?). </p><br><p>  Dans le code, j'invente activement des v√©los et monte sur le r√¢teau pour sentir le golang, obtenir des critiques constructives et des suggestions rationnelles. </p><br><h2 id="chto-delaem">  On fait quoi </h2><br><p>  Peer (peer) - une instance unique du messager. </p><br><p>  Notre messager devrait pouvoir: </p><br><ul><li>  Trouver des f√™tes √† proximit√© </li><li>  √âtablir une connexion avec d'autres pairs </li><li>  Crypter l'√©change de donn√©es avec des pairs </li><li>  Recevoir des messages de l'utilisateur </li><li>  Afficher les messages √† l'utilisateur </li></ul><br><p>  Pour rendre la t√¢che un peu plus int√©ressante, faisons-la passer par un seul port r√©seau. </p><br><p><img src="https://habrastorage.org/webt/5b/zo/8g/5bzo8g4eqogveeure4lzgngo5ma.png" alt="Le sch√©ma conditionnel du messager"></p><br><p>  Si vous tirez ce port sur HTTP, nous obtenons une application React qui tire le m√™me port en √©tablissant une connexion de socket Web. </p><br><p>  Si vous tirez le port via HTTP et non depuis la machine locale, nous affichons la banni√®re. </p><br><p>  Si un autre homologue est connect√© √† ce port, une connexion permanente est √©tablie avec un chiffrement de bout en bout. </p><br><h2 id="opredelyaem-tip-vhodyaschego-soedineniya">  D√©terminer le type de connexion entrante </h2><br><p>  Tout d'abord, ouvrez le port d'√©coute et nous attendrons de nouvelles connexions. </p><br><pre><code class="go hljs">net.ListenTCP(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, tcpAddr)</code> </pre> <br><p>  Sur la nouvelle connexion, lisez les 4 premiers octets. </p><br><p>  Nous prenons la liste des verbes HTTP et comparons nos 4 octets avec elle. </p><br><p>  Maintenant, nous d√©terminons si une connexion est √©tablie √† partir de la machine locale, et sinon, nous r√©pondons avec une banni√®re et raccrochons. </p><br><pre> <code class="go hljs"> buf, err := readWriter.Peek(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ItIsHttp(buf) { handleHttp(readWriter, conn, p) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { peer := proto.NewPeer(conn) p.HandleProto(readWriter, peer) } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !strings.EqualFold(s, <span class="hljs-string"><span class="hljs-string">"127"</span></span>) &amp;&amp; !strings.EqualFold(s, <span class="hljs-string"><span class="hljs-string">"[::"</span></span>) { response.Body = ioutil.NopCloser(strings.NewReader(<span class="hljs-string"><span class="hljs-string">"Peer To Peer Messenger. see https://github.com/easmith/p2p-messenger"</span></span>)) }</code> </pre> <br><p>  Si la connexion est locale, nous r√©pondons avec le fichier correspondant √† la demande. </p><br><p>  J'ai alors d√©cid√© d'√©crire le traitement moi-m√™me, m√™me si je pouvais utiliser le gestionnaire disponible dans la biblioth√®que standard. </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//   func processRequest(request *http.Request, response *http.Response) {/*    */} //     fileServer := http.FileServer(http.Dir("./front/build/")) fileServer.ServeHTTP(NewMyWriter(conn), request)</span></span></code> </pre> <br><p>  Si le chemin <code>/ws</code> demand√©, alors nous essayons d'√©tablir une connexion websocket. </p><br><p>  Depuis que j'ai assembl√© le v√©lo dans le traitement des demandes de fichiers, je vais faire le traitement de la connexion ws en utilisant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que gorilla / websocket</a> . </p><br><p>  Pour ce faire, cr√©ez <code>MyWriter</code> et impl√©mentez-y des m√©thodes correspondant aux interfaces <code>http.ResponseWriter</code> et <code>http.Hijacker</code> . </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">// w - MyWriter func handleWs(w http.ResponseWriter, r *http.Request, p *proto.Proto) { c, err := upgrader.Upgrade(w, r, w.Header()) /*          */ }</span></span></code> </pre> <br><h2 id="obnaruzhenie-pirov">  D√©tection de pairs </h2><br><p>  Pour rechercher des homologues dans un r√©seau local, nous utiliserons la multidiffusion UDP. </p><br><p>  Nous enverrons des paquets contenant des informations sur nous-m√™mes √† l'adresse IP de multidiffusion. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMeow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p *proto.Proto)</span></span></span></span> { conn, err := net.DialUDP(<span class="hljs-string"><span class="hljs-string">"udp"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, addr) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { _, err := conn.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"meow:%v:%v"</span></span>, hex.EncodeToString(p.PubKey), p.Port))) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> time.Sleep(<span class="hljs-number"><span class="hljs-number">1</span></span> * time.Second) } }</code> </pre> <br><p>  Et √©coutez s√©par√©ment de Multicast IP pour tous les paquets UDP. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listenMeow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p *proto.Proto, handler </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">func</span></span></span></span><span class="hljs-function"><span class="hljs-params">(p *proto.Proto, peerAddress </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> conn, err := net.ListenMulticastUDP(<span class="hljs-string"><span class="hljs-string">"udp"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, addr) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> _, src, err := conn.ReadFromUDP(buffer) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">// connectToPeer handler(p, peerAddress) }</span></span></code> </pre> <br><p>  Ainsi nous nous d√©clarons et apprenons l'apparition d'autres f√™tes. </p><br><p>  Il serait possible d'organiser cela au niveau IP, et m√™me dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle du package IPv4,</a> seul le paquet de donn√©es de multidiffusion est donn√© comme exemple de code. </p><br><h2 id="protokol-vzaimodeystviya-pirov">  Protocole d'interaction entre pairs </h2><br><p>  Nous emballerons toutes les communications entre pairs dans une enveloppe (enveloppe). </p><br><p>  Sur toute enveloppe, il y a toujours un exp√©diteur et un destinataire, √† cela nous ajouterons une commande (qu'il emporte avec lui), un identifiant (jusqu'√† pr√©sent, c'est un nombre al√©atoire, mais peut √™tre fait comme un hachage de contenu), la longueur du contenu et le contenu de l'enveloppe elle-m√™me - un message ou des param√®tres de commande. </p><br><p><img src="https://habrastorage.org/webt/3b/yx/yc/3byxycyif222uk2jslbya9qb1bs.png" alt="Octets d'enveloppe"></p><br><p>  La commande, (ou le type de contenu) est plac√©e avec succ√®s au tout d√©but de l'enveloppe et nous d√©finissons une liste de commandes de 4 octets qui ne se croisent pas avec les noms des verbes HTTP. </p><br><p>  L'enveloppe enti√®re pendant la transmission est s√©rialis√©e en un tableau d'octets. </p><br><h3 id="rukopozhatie">  Poign√©e de main </h3><br><p>  Lorsque la connexion est √©tablie, le festin tend imm√©diatement la main pour une poign√©e de main, donnant son nom, sa cl√© publique et sa cl√© publique √©ph√©m√®re pour g√©n√©rer une cl√© de session partag√©e. </p><br><p>  En r√©ponse, l'homologue re√ßoit un ensemble similaire de donn√©es, enregistre l'homologue trouv√© dans sa liste et calcule (CalcSharedSecret) la cl√© de session commune. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handShake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p *proto.Proto, conn net.Conn)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proto</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Peer</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> peer := proto.NewPeer(conn) <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> p.SendName(peer) <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> envelope, err := proto.ReadEnvelope(bufio.NewReader(conn)) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><h3 id="obmen-pirami">  √âchange de f√™te </h3><br><p>  Apr√®s une poign√©e de main, les pairs √©changent leurs listes de pairs =) </p><br><p>  Pour ce faire, une enveloppe contenant la commande LIST est envoy√©e et une liste JSON de pairs est plac√©e dans son contenu. <br>  En r√©ponse, nous obtenons une enveloppe similaire. </p><br><p>  On en retrouve dans les listes de nouveaux et avec chacun d'eux on essaie de se connecter, se serrer la main, √©changer des f√™tes etc. </p><br><h3 id="obmen-polzovatelskimi-soobscheniyami">  Messagerie utilisateur </h3><br><p>  Les messages personnalis√©s sont de la plus grande valeur pour nous, nous allons donc crypter et signer chaque connexion. </p><br><h4 id="o-shifrovanii">  √Ä propos du chiffrement </h4><br><p>  Dans les biblioth√®ques golang standard (google) du paquet crypto, de nombreux algorithmes diff√©rents sont impl√©ment√©s (il n'y a pas de normes GOST). </p><br><p>  Le plus pratique pour les signatures, je pense, est la courbe Ed25519.  Nous utiliserons la biblioth√®que ed25519 pour signer des messages. </p><br><p>  Au tout d√©but, j'ai pens√© √† utiliser une paire de cl√©s obtenue √† partir de ed25519 non seulement pour signer, mais aussi pour g√©n√©rer une cl√© de session. </p><br><p>  Cependant, les cl√©s de signature ne sont pas applicables pour le calcul de la cl√© partag√©e - vous devez toujours les conjurer: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateKeyExchangePair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(publicKey [32]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, privateKey [32]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { pub, priv, err := ed25519.GenerateKey(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(publicKey[:], pub[:]) <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(privateKey[:], priv[:]) curve25519.ScalarBaseMult(&amp;publicKey, &amp;privateKey) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  Par cons√©quent, il a √©t√© d√©cid√© de g√©n√©rer des cl√©s √©ph√©m√®res, et d'une mani√®re g√©n√©rale, c'est la bonne approche qui ne laisse pas aux attaquants la possibilit√© de r√©cup√©rer une cl√© commune. </p><br><p>  Pour les amateurs de math√©matiques, voici les liens wiki: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Protocole <em>Diffie</em> - Hellman_ sur les courbes elliptiques</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signature num√©rique EdDSA</a> </p><br><p>  La g√©n√©ration d'une cl√© partag√©e est assez standard: d'abord, pour une nouvelle connexion, nous g√©n√©rons des cl√©s √©ph√©m√®res, nous envoyons une enveloppe avec une cl√© publique au socket. </p><br><p>  Le c√¥t√© oppos√© fait de m√™me, mais dans un ordre diff√©rent: il re√ßoit une enveloppe avec une cl√© publique, g√©n√®re sa propre paire et envoie la cl√© publique au socket. </p><br><p>  D√©sormais, chaque participant dispose des cl√©s √©ph√©m√®res publiques et priv√©es de quelqu'un d'autre. </p><br><p>  En les multipliant, nous obtenons la m√™me cl√© pour les deux, que nous utiliserons pour crypter les messages. </p><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//CalcSharedSecret Calculate shared secret func CalcSharedSecret(publicKey []byte, privateKey []byte) (secret [32]byte) { var pubKey [32]byte var privKey [32]byte copy(pubKey[:], publicKey[:]) copy(privKey[:], privateKey[:]) curve25519.ScalarMult(&amp;secret, &amp;privKey, &amp;pubKey) return }</span></span></code> </pre> <br><p>  Nous crypterons les messages par l'algorithme AES √©tabli depuis longtemps en mode de couplage de blocs (CBC). </p><br><p>  Toutes ces impl√©mentations sont faciles √† trouver dans la documentation de golang. </p><br><p>  Le seul raffinement consiste √† remplir automatiquement le message avec z√©ro octet pour la multiplicit√© de sa longueur √† la longueur du bloc de chiffrement (16 octets). </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//Encrypt the message func Encrypt(content []byte, key []byte) []byte { padding := len(content) % aes.BlockSize if padding != 0 { repeat := bytes.Repeat([]byte("\x00"), aes.BlockSize-(padding)) content = append(content, repeat...) } /* ... */ } //Decrypt encrypted message func Decrypt(encrypted []byte, key []byte) []byte { /* ... */ encrypted = bytes.Trim(encrypted, string([]byte("\x00"))) return encrypted }</span></span></code> </pre> <br><p>  En 2013, il a impl√©ment√© AES (avec un mode similaire √† CBC) pour crypter les messages dans Telegram dans le cadre d'un concours de Pavel Durov. </p><br><p>  √Ä cette √©poque, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">protocole Diffie-Hellman</a> le plus courant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tait</a> utilis√© dans les t√©l√©grammes pour g√©n√©rer une cl√© √©ph√©m√®re. </p><br><p>  Et afin d'exclure la charge des fausses connexions, avant chaque √©change de cl√©s, les clients ont r√©solu le probl√®me de factorisation. </p><br><h2 id="gui">  GUI </h2><br><p>  Nous devons afficher une liste de pairs et une liste de messages avec eux, et √©galement r√©pondre aux nouveaux messages en augmentant le compteur √† c√¥t√© du nom du pair. </p><br><p>  Ici sans probl√®mes - ReactJS + websocket. </p><br><p>  Les messages de socket Web sont essentiellement des enveloppes uniques, mais ils ne contiennent pas de texte chiffr√©. </p><br><p>  Tous sont des "h√©ritiers" de type <code>WsCmd</code> et sont s√©rialis√©s en JSON lors du transfert. </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//Serializable interface to detect that can to serialised to json type Serializable interface { ToJson() []byte } func toJson(v interface{}) []byte { json, err := json.Marshal(v) /*  err */ return json } /* ... */ //WsCmd WebSocket command type WsCmd struct { Cmd string `json:"cmd"` } //WsMessage WebSocket command: new Message type WsMessage struct { WsCmd From string `json:"from"` To string `json:"to"` Content string `json:"content"` } //ToJson convert to JSON bytes func (v WsMessage) ToJson() []byte { return toJson(v) } /* ... */</span></span></code> </pre> <br><p>  Donc, une requ√™te HTTP arrive √† la racine ("/"), maintenant pour afficher le front, regardez dans le r√©pertoire "front / build" et donnez index.html </p><br><p>  Eh bien l'interface est constitu√©e, maintenant le choix pour les utilisateurs est: l'ex√©cuter dans un navigateur ou dans une fen√™tre s√©par√©e - WebView. </p><br><p>  Pour la derni√®re option utilis√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zserge / webview</a> </p><br><pre> <code class="go hljs"> e := webview.Open(<span class="hljs-string"><span class="hljs-string">"Peer To Peer Messenger"</span></span>, fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"http://localhost:%v"</span></span>, initParams.Port), <span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)</code> </pre> <br><p>  Pour cr√©er une application avec celle-ci, vous devez installer un autre syst√®me </p><br><pre> <code class="bash hljs"> sudo apt install libwebkit2gtk-4.0-dev</code> </pre> <br><p>  Au cours de la r√©flexion sur l'interface graphique, j'ai trouv√© de nombreuses biblioth√®ques pour GTK, QT, et l'interface de la console aurait l'air tr√®s geek - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/jroimartin/gocui</a> - √† mon avis, une id√©e tr√®s int√©ressante. </p><br><h2 id="zapusk-messendzhera">  Lancement de Messenger </h2><br><h3 id="ustanovka-golang">  Installation de Golang </h3><br><p>  Bien s√ªr, vous devez d'abord installer go. <br>  Pour ce faire, je recommande fortement d'utiliser l'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">golang.org/doc/install</a> . </p><br><p>  Instructions simplifi√©es pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bash script</a> </p><br><h3 id="zagruzka-prilozheniya-v-gopath">  T√©l√©chargez une application dans GOPATH </h3><br><p>  Il est tellement arrang√© que toutes les biblioth√®ques et m√™me vos projets doivent √™tre dans le soi-disant GOPATH. </p><br><p>  Par d√©faut, c'est $ HOME / go.  Go vous permet d'extraire la source du r√©f√©rentiel public avec une simple commande: </p><br><pre> <code class="bash hljs"> go get github.com/easmith/p2p-messenger</code> </pre> <br><p>  Maintenant, dans votre <code>$HOME/go/src/github.com/easmith/p2p-messenger</code> source de la branche principale appara√Ætra </p><br><h3 id="ustanovka-npm-i-sborka-fronta">  Installation et montage avant du NPM </h3><br><p>  Comme je l'ai √©crit ci-dessus, notre interface graphique est une application Web avec un front sur ReactJs, donc le front doit encore √™tre assembl√©. </p><br><p>  Nodejs + npm - ici comme d'habitude. </p><br><p>  Juste au cas o√π, voici les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instructions pour Ubuntu</a> </p><br><p>  Maintenant, nous commen√ßons l'assemblage avant en standard </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> front npm update npm run build</code> </pre> <br><p>  L'avant est pr√™t! </p><br><h3 id="zapusk">  Lancement </h3><br><p>  Revenons √† la racine et lan√ßons la f√™te de notre messager. </p><br><p>  Au d√©marrage, nous pouvons sp√©cifier le nom de notre homologue, le port, le fichier avec les adresses des autres homologues et un indicateur indiquant s'il faut lancer WebView. </p><br><p>  Par d√©faut, <code>$USER@$HOSTNAME</code> est utilis√© comme nom d' <code>$USER@$HOSTNAME</code> et port 35035. </p><br><p>  Donc, nous commen√ßons et discutons avec des amis sur le r√©seau local. </p><br><pre> <code class="bash hljs"> go run app.go -name Snowden</code> </pre> <br><h2 id="otzyv-o-programmirovanii-na-golang">  Commentaires sur la programmation de Golang </h2><br><ul><li>  La chose la plus importante que je voudrais noter: <strong>√† l'aller, il s'av√®re imm√©diatement mettre en ≈ìuvre ce que je voulais</strong> . <br>  Presque tout ce dont vous avez besoin se trouve dans la biblioth√®que standard. </li><li>  Cependant, il y avait une difficult√© lorsque j'ai commenc√© le projet dans un r√©pertoire autre que GOPATH. <br>  J'ai utilis√© GoLand pour √©crire du code.  Et au d√©but, il √©tait g√™nant de formater automatiquement le code avec des biblioth√®ques d'importation automatique. </li><li>  Il y a <strong>beaucoup de g√©n√©rateurs de code</strong> dans l' <strong>IDE</strong> , ce qui nous a permis de nous concentrer sur le d√©veloppement plut√¥t que sur le jeu de code. </li><li>  Vous vous habituez rapidement √† la gestion fr√©quente des erreurs, mais un visage se produit lorsque vous r√©alisez que pour aller, une situation normale est lorsque l'essence de l'erreur est analys√©e en fonction de sa repr√©sentation sous forme de cha√Æne. <br><pre> <code class="go hljs">err != io.EOF</code> </pre> </li><li>  Les choses vont un peu mieux avec la biblioth√®que os.  De telles constructions aident √† comprendre l'essence du probl√®me. <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.IsNotExist(err) { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> </li><li>  Hors de la bo√Æte, go nous apprend √† documenter correctement le code et √† √©crire des tests. <br>  Et il y en a mais.  Nous avons d√©crit l'interface avec la m√©thode <code>ToJson()</code> . <br>  Ainsi, le g√©n√©rateur de documentation n'h√©rite pas de la description de cette m√©thode pour les m√©thodes qui l'impl√©mentent, donc pour supprimer les avertissements inutiles, vous devez copier la documentation dans chaque m√©thode impl√©ment√©e (proto / mtypes.go). </li><li>  R√©cemment, je me suis habitu√© √† la puissance de log4j en java, donc il n'y a pas assez de bon enregistreur en route. <br>  Il vaut probablement la peine d'√©tudier l'immensit√© du github avec une belle journalisation avec des appender et des formateurs. </li><li>  Travail inhabituel avec des tableaux. <br>  Par exemple, la concat√©nation se produit via la fonction <code>append</code> et la conversion d'un tableau de longueur arbitraire en un tableau de longueur fixe par <code>copy</code> . </li><li>  <code>switch-case</code> fonctionne comme <code>if-elseif-else</code> - mais c'est une approche int√©ressante, mais encore une fois face √† la main: <br>  si nous voulons le comportement de <code>switch-case</code> habituel, nous devons mettre en <code>fallthrough</code> chaque cas. <br>  Vous pouvez √©galement utiliser <code>goto</code> , mais ne le faisons pas, s'il vous pla√Æt! </li><li>  Il n'y a pas d'op√©rateur ternaire et souvent ce n'est pas pratique. </li></ul><br><h2 id="chto-dalshe">  Et ensuite? </h2><br><p>  Ainsi, le messager Peer-To-Peer le plus simple est impl√©ment√©. </p><br><p>  Les c√¥nes sont bond√©s, vous pouvez en outre am√©liorer les fonctionnalit√©s de l'utilisateur: envoi de fichiers, d'images, d'audio, d'√©motic√¥nes, etc., etc. </p><br><p>  Et vous ne pouvez pas inventer votre protocole et utiliser les tampons de protocole Google, <br>  Connectez la cha√Æne de blocs et prot√©gez-vous contre le spam √† l'aide des contrats intelligents Ethereum. </p><br><p>  Sur les contrats intelligents, organisez des discussions de groupe, des canaux, un syst√®me de noms, des avatars et des profils utilisateur. </p><br><p>  Il est √©galement imp√©ratif d'ex√©cuter des homologues de d√©part, de mettre en ≈ìuvre un contournement NAT et d'envoyer des messages d'homologue √† homologue. </p><br><p>  En cons√©quence, vous obtenez un bon t√©l√©gramme / t√©l√©phone de remplacement, il vous suffit d'y transf√©rer tous vos amis =) </p><br><h2 id="poleznosti">  Utilit√© </h2><br><div class="spoiler">  <b class="spoiler_title">Quelques liens</b> <div class="spoiler_text"><p>  Au cours des travaux sur le messager, j'ai trouv√© des pages int√©ressantes pour un d√©veloppeur d√©butant. <br>  Je les partage avec vous: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">golang.org/doc/</a> - documentation en langue, tout est simple, clair et avec des exemples.  La m√™me documentation peut √™tre ex√©cut√©e localement avec la commande </p><br><pre> <code class="bash hljs">godoc -HTTP=:6060</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gobyexample.com</a> - une collection d'exemples simples </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">golang-book.ru</a> - un bon livre en russe </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/dariubs/GoBooks</a> est une collection de livres sur Go. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">awesome-go.com</a> - Une liste de biblioth√®ques, de frameworks et d'applications int√©ressantes √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">emporter</a> .  La cat√©gorisation est plus ou moins, mais la description de beaucoup d'entre eux est tr√®s rare, ce qui n'aide pas la recherche par Ctrl + F </p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437686/">https://habr.com/ru/post/fr437686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437674/index.html">M√©thodes de reconnaissance d'objets 3D pour les v√©hicules sans pilote. Rapport Yandex</a></li>
<li><a href="../fr437676/index.html">Les universit√©s et les acc√©l√©rateurs d'entreprise comme levier pour lancer une start-up B2B aux √âtats-Unis</a></li>
<li><a href="../fr437680/index.html">Ma collection de bricolage sur Youtube</a></li>
<li><a href="../fr437682/index.html">√âcriture d'un autre outil de cr√©ation de mod√®les Kubernetes</a></li>
<li><a href="../fr437684/index.html">Algorithme supr√™me - Compendium biais√©</a></li>
<li><a href="../fr437688/index.html">OpenSceneGraph: Techniques de programmation de base</a></li>
<li><a href="../fr437694/index.html">Analyse de l'utilitaire Files.walkFileTree ();</a></li>
<li><a href="../fr437696/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 283 (du 21 au 27 janvier)</a></li>
<li><a href="../fr437698/index.html">Service de traduction de brevets de l'OMPI Translate - Mes exp√©riences</a></li>
<li><a href="../fr437702/index.html">Analyse des entrevues d'emploi Google: requ√™tes synonymes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>