<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüíº ü§∫ üíó En invierno y verano en un color? Buscar la estacionalidad en los datos üåÆ üïØÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez que decidimos ver qu√© intereses estacionales tienen los usuarios de 2GIS en diferentes ciudades. Se esperan estallidos de inter√©s en flores, r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En invierno y verano en un color? Buscar la estacionalidad en los datos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/414041/"><img src="https://habrastorage.org/webt/3m/jp/jn/3mjpjnj7rqfzdr01mo8jsoesomy.jpeg"><br><br>  Una vez que decidimos ver qu√© intereses estacionales tienen los usuarios de 2GIS en diferentes ciudades.  Se esperan estallidos de inter√©s en flores, regalos de A√±o Nuevo y llantas.  Decidimos no limitarnos a ellos e ir m√°s all√° al verificar todas las √°reas de actividad en las 113 ciudades de presencia. <br><br>  En este art√≠culo, le dir√© c√≥mo buscamos la estacionalidad y qu√© caracter√≠sticas del comportamiento del usuario se encontraron en ellos. <br><a name="habracut"></a><br><h4>  ¬øPor qu√© necesitas medir la estacionalidad? </h4><br>  Las necesidades de los usuarios de 2GIS cambian a lo largo del a√±o: bienes de consumo, servicios, construcci√≥n, servicios p√∫blicos.  El conocimiento estacional es √∫til por varias razones: <br><br><ul><li>  Estamos comenzando a comprender m√°s sobre los valores e intereses de nuestros usuarios en este momento y en el futuro cercano. </li><li>  Podemos "predecir" la solicitud de un usuario. </li><li>  Los gerentes de ventas se centran en √°reas de actividad relevantes para los usuarios. </li></ul><br><h3>  Tipos de trafico </h3><br>  Antes de hablar sobre c√≥mo procesamos el tr√°fico, vale la pena aclarar que lo dividimos en varios tipos. <br><br>  La recuperaci√≥n es un tipo de tr√°fico en el que el usuario conoce exactamente la empresa con la que desea contactar.  Necesita aclarar la direcci√≥n, el horario de trabajo o encontrar la entrada.  En este caso, la b√∫squeda se realiza por el nombre de la empresa, el n√∫mero de tel√©fono y otros atributos de la propia empresa. <br><br>  El tr√°fico de descubrimiento es cuando un usuario formula una solicitud en t√©rminos m√°s generales: "muebles tapizados", "comer en Lenin", "ba√±os".  Es decir, el usuario explora las opciones y ofertas del mercado, a menudo llamando a organizaciones o visitando sus sitios. <br><br>  El tr√°fico geogr√°fico ocurre cuando un usuario trabaja con un mapa.  Por ejemplo, est√° buscando farmacias o estaciones de servicio m√°s cercanas a la casa. <br><img src="https://habrastorage.org/webt/a7/da/xs/a7daxskkn-arknmjqpz-av2d1pe.jpeg"><br>  Todas las solicitudes de los usuarios y todas las acciones posteriores est√°n marcadas en el tr√°fico.  Para buscar la estacionalidad, el an√°lisis tom√≥ descubrimiento + geo-tr√°fico.  Dado que, en primer lugar, corresponden a la manifestaci√≥n de los intereses del usuario y, en segundo lugar, pueden controlarse.  No puede administrar el tr√°fico de recuperaci√≥n. <br><br><h3>  Sobre tendencias </h3><br><img src="https://habrastorage.org/webt/av/we/sx/avwesx7puvrhmwfvo9ubshrperg.png" alt="Gr√°fico 1: ¬øVes estacionalidad?"><br>  <font color="gray"><i>Gr√°fico 1: ¬øVes estacionalidad?</i></font> <br><br>  Antes de comenzar a buscar la estacionalidad, debe tener en cuenta los cambios en el volumen de tr√°fico en diferentes tipos de dispositivos.  Tomamos en cuenta que la audiencia de las versiones de WinPhone y PC est√° disminuyendo constantemente.  Mientras que en l√≠nea, Android, iOS est√°n en constante crecimiento. <br><br><h4>  Prueba de hip√≥tesis </h4><br>  Los criterios para determinar la estacionalidad se desarrollan para series estacionarias.  Es necesario probar la hip√≥tesis de que la serie contiene una tendencia.  Consideraremos las series de tiempo como un proceso aleatorio.  Entonces los elementos de la serie son realizaciones de alguna variable aleatoria. <br><br>  Podemos probar la hip√≥tesis de que todos los valores de la muestra pertenecen a la misma poblaci√≥n con m promedio.  Entonces la hip√≥tesis principal es: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.429ex" height="2.419ex" viewBox="0 -780.1 12240 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-48" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-30" x="1175" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3A" x="1563" y="0"></use><g transform="translate(2119,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-69" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3D" x="3620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-6D" x="4676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="5554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-69" x="5999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3D" x="6623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-31" x="7679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="8180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-32" x="8625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="9125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="9570" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="10016" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="10461" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="10906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-4E" x="11351" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> H_0: m_i = m, i = 1,2, ..., N </script><br>  contra la hip√≥tesis de la tendencia rival <br><math> </math> $ en l√≠nea $ H_1: ‚à£m_ {i + 1} ‚àím_i‚à£&gt; 0, i = 1,2, ..., N - 1 $ en l√≠nea $ <br>  donde N es el n√∫mero de elementos en una fila. <br><br>  Para probar la hip√≥tesis, debe usar uno de los criterios para la importancia de la tendencia.  En base a los estudios, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> eligi√≥ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">criterio de inversiones</a> . <br><br>  Si la hip√≥tesis no se rechaza, entonces es necesario eliminar la tendencia de los datos.  Suponemos que en nuestros datos solo puede haber una tendencia lineal.  ¬°Oh, ser√≠a exponencial!  Tambi√©n asumiremos que no podemos tener m√°s de un punto de inflexi√≥n. <br><br><img src="https://habrastorage.org/webt/xo/vp/rh/xovprhfclo4duighdd7eibfieig.png" alt="Gr√°fico 2: Series temporales (del Gr√°fico 1) y su tendencia"><br>  <font color="gray"><i>Gr√°fico 2: Series temporales (del Gr√°fico 1) y su tendencia</i></font> <br><br><h4>  Sobre un rastrillo y descubrimientos </h4><br>  Esbozamos los l√≠mites del estudio y comenzamos a probar hip√≥tesis.  Por supuesto, no fue sin rastrillos y descubrimientos: dado que la tarea no se limit√≥ a los servicios populares en ciudades con m√°s de un mill√≥n de personas, hemos compilado una lista de casos especiales a los que vale la pena prestarles atenci√≥n. <br><br><ol><li>  Lagunas de datos.  En √°reas estrechas de actividad, algunas fechas pueden no tener datos.  El caso es especialmente relevante para las ciudades peque√±as.  Esta caracter√≠stica debe tenerse en cuenta para la correcta construcci√≥n de la regresi√≥n. </li><li>  Si se encuentra un punto de inflexi√≥n, considere su proximidad al principio o al final de la fila.  Es posible una mala interpretaci√≥n del comportamiento de una serie en condiciones de contorno.  Por ejemplo, en el gr√°fico 2, los primeros 120 puntos parecer√≠an indicar un crecimiento lineal por partes.  Pero, de hecho, mostr√≥ estacionalidad, que veremos m√°s adelante. </li><li>  Elegir el punto de referencia correcto.  Para obtener los coeficientes correctos, debe usar una serie, comenzando desde el primer punto significativo, y recordar la coordenada X de este punto (la fecha en que aparecieron los datos en la serie).  La tendencia se construir√° en el sistema de coordenadas con 0 en este punto.  Este caso es relevante para comparar esferas entre s√≠.  Por ejemplo, en 2GIS las ciudades no se lanzaron simult√°neamente y, en consecuencia, comenzaron a enviar estad√≠sticas en diferentes momentos.  Lo mismo es cierto para la aparici√≥n de nuevos negocios, como, por ejemplo, las barber√≠as. </li><li>  Quiz√°s lo m√°s dif√≠cil es encontrar un compromiso entre el nivel de detalle y la adecuaci√≥n de la cantidad de datos.  Nos decidimos por tres dimensiones: ciudad, campo de actividad, plataforma de dispositivo de usuario. </li></ol><br><img src="https://habrastorage.org/webt/sg/-m/gc/sg-mgcxzvjd16e8aodxfv4ikixq.png" alt="Gr√°fico 3: una serie sin tendencia"><br>  <font color="gray"><i>Gr√°fico 3: una serie sin tendencia</i></font> <br><br><h3>  B√∫squeda de estacionalidad </h3><br>  Despu√©s de restar las tendencias correspondientes de la serie temporal, podemos proceder a la tarea de encontrar la estacionalidad.  Consta de dos subtareas: <br><br><ol><li>  Detecci√≥n del hecho de la presencia de estacionalidad en una serie. </li><li>  Definiciones de temporadas altas y bajas: esto es lo que tiene valor pr√°ctico. </li></ol><br><h4>  Detecci√≥n de correlaci√≥n </h4><br>  Hay funciones de b√∫squeda de correlaci√≥n listas para usar tanto en R como en Python.  Utilizamos la correlaci√≥n de Pearson.  Cuando trabaje con vectores de intereses del usuario, tenga en cuenta lo siguiente: <br><br><ul><li>  Despu√©s de restar la tendencia de la serie original, se pueden obtener valores negativos.  Esto es normal en esta etapa. </li><li>  Para nuestra tarea, es suficiente verificar la correlaci√≥n de series de tiempo de 365 d√≠as.  S√≠, la influencia de un a√±o bisiesto es insignificante y no lo tenemos en cuenta. </li><li>  Para buscar la estacionalidad, debe tener datos de al menos dos per√≠odos completos.  Nuestros c√°lculos utilizaron datos de cuatro per√≠odos. </li></ul><br>  Estamos buscando la correlaci√≥n de dos vectores: X: [0;  N-365], Y: [366;  N]  Donde N es la longitud de la fila. <br><br><img src="https://habrastorage.org/webt/pm/ht/-6/pmht-6_tiwi8bek3cu6vly95pzg.png" alt="Gr√°fico 4: Detecci√≥n de correlaci√≥n"><br>  <font color="gray"><i>Gr√°fico 4: Detecci√≥n de correlaci√≥n</i></font> <br><br><h4>  Obt√©n el beneficio </h4><br>  El hecho de la presencia de estacionalidad no tiene valor pr√°ctico.  Debe comprender qu√© atenci√≥n se prestar√° al campo de actividad el pr√≥ximo mes: mayor, menor o normal. <br><br>  Se eligi√≥ una escala multiplicativa como resultado final.  Donde la unidad es el nivel "normal" de inter√©s del usuario en el campo de actividad.  Un valor distinto de uno caracteriza un aumento o disminuci√≥n m√∫ltiple en el inter√©s. <br><br>  En nuestro caso, [por ahora] una escala suficientemente temporal que dura un mes es suficiente.  Para determinar el nivel 1, se utiliz√≥ la mediana de atenci√≥n mensual del usuario.  Luego calcul√≥ la desviaci√≥n m√∫ltiple de esta mediana. <br><br><img src="https://habrastorage.org/webt/rv/pj/rr/rvpjrrnufdxhm3hmtnacnfvsu10.png" alt="Gr√°fico 5: Estacionalidad anual"><br>  <font color="gray"><i>Gr√°fico 5: Estacionalidad anual</i></font> <br><br>  Es hora de revelar el secreto de qu√© datos muestran los gr√°ficos del art√≠culo.  En este y en todos los gr√°ficos anteriores, clics en los museos de San Petersburgo.  Como se puede ver en el √∫ltimo horario, los museos son populares durante las vacaciones de enero, cuando hay muchos d√≠as libres y en verano. <br><br><h4>  ¬øY si ... </h4><br>  ... tomar y alimentar el algoritmo no los intereses de los usuarios, sino, por ejemplo, las ventas? <br><br>  El algoritmo de acciones es el mismo: <br><br><ol><li>  Estamos buscando tendencias.  El p√∫blico de las ciudades est√° creciendo, y con √©l crece el n√∫mero de anunciantes.  Es necesario restar la tendencia asociada con la creciente popularidad de 2GIS como plataforma de publicidad para obtener aumentos y recesiones de la industria. </li><li>  Encontramos correlaciones de ventas de a√±o en a√±o, y luego temporadas altas y bajas. </li></ol><br><h4>  Tom√≥ una serie de ajustes </h4><br>  La publicidad en 2GIS se vende mensualmente, por lo que tomaron un mes para la escala, pero la estacionalidad del usuario se analiz√≥ hasta un d√≠a.  Para la compatibilidad con versiones anteriores, adaptamos los algoritmos para trabajar con series arbitrarias, donde el eje x es el n√∫mero de serie del punto y el eje y tiene alg√∫n valor (en este nivel, la sem√°ntica del valor no importa). <br><br>  El punto de referencia de una serie de ventas (origen), por regla general, no coincide con el punto de referencia de estacionalidad del usuario.  Despu√©s de todo, al principio la ciudad gana audiencia, y solo entonces aparece la publicidad.  En esta etapa, no debe combinar los resultados de dos estacionalidades. <br><br>  Como las ventas son mensuales, tenemos significativamente menos puntos en las filas.  En este caso, la correlaci√≥n debe considerarse en 12 puntos en lugar de 365. <br><br><img src="https://habrastorage.org/webt/zg/sv/lo/zgsvlogmzxvi347x9mlbs9dmdyw.png" alt="Gr√°fico 6: Estacionalidad de las ventas."><br>  <font color="gray"><i>Gr√°fico 6: Estacionalidad de las ventas.</i></font> <br><br>  Como paso final, decidimos imponer la estacionalidad de las ventas a la estacionalidad del usuario.  Ahora puede ver d√≥nde vendemos anuncios m√°s tarde de lo necesario y retrasar la demanda de los usuarios. <br><br>  Por ejemplo, los usuarios est√°n interesados ‚Äã‚Äãen comprar concreto en Nizhny Novgorod de abril a octubre.  Mientras que las empresas se dedican a la promoci√≥n solo de mayo a septiembre. <br><br><img src="https://habrastorage.org/webt/fy/n7/mc/fyn7mcluv1duddq8a2hueb-idj8.png" alt="Gr√°fico 7: Intersecci√≥n de la estacionalidad del usuario y la estacionalidad de las ventas."><br>  <font color="gray"><i>Gr√°fico 7: La intersecci√≥n de la estacionalidad del usuario y la estacionalidad de las ventas (verde - usuario, azul - ventas, rojo - coincidencia)</i></font> <br><br><h4>  Que hizo </h4><br>  Todo lo descrito anteriormente se implementa en MS SQL Server 2016. Para buscar la regresi√≥n lineal y la correlaci√≥n, se usa R, que se ha incluido en el servidor desde la versi√≥n 2016. Y dado que ya tenemos Data Warehouse y an√°lisis de estad√≠sticas de usuario en SQL Server, result√≥ ser muy conveniente usar R para c√°lculos matem√°ticos <br><img src="https://habrastorage.org/webt/zo/uv/fi/zouvfihpufdsdoywofaz85qvra4.jpeg"><br>  Ejemplo de uso de R de TSQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmp EXEC sp_execute_external_script @language = N'R', @script = @R, @input_data_1 = N'SELECT DataId, Number, Value FROM #data ORDER BY 1, 2'</span></span></code> </pre> <br>  Donde: <br><br><ul><li>  la variable R contiene directamente el c√≥digo R; </li><li>  language = N'R ': indica que el script pasado en la variable R contiene c√≥digo de idioma R. En SQL Server 2017, adem√°s de R, puede usar language = N'Python'.  Luego, en consecuencia, el c√≥digo de Python debe pasarse al par√°metro del script. </li><li>  input_data_1: contiene una consulta SQL, cuyos resultados dentro del c√≥digo R se pueden acceder como InputDataSet; </li><li>  El resultado del procedimiento ser√° RecordDataSet, formado como OutputDataSet &lt;- calcAllTrend (data = InputDataSet); </li><li>  Aseg√∫rese de especificar el formato del registro resultante: el n√∫mero y los tipos de columnas.  En este caso, el formato de OutputDataSet est√° determinado por la tabla #tmp donde se registran los resultados.  O puede usar WITH RESULT SETS para describir el conjunto de registros resultante. </li></ul><br>  En nuestro caso, result√≥ que una parte significativa del tiempo de ejecuci√≥n sp_execute_external_script est√° ocupada directamente al acceder a los Servicios R.  El c√≥digo R en s√≠ funcion√≥ r√°pidamente. <br><br>  Perm√≠tame recordarle que quer√≠amos calcular las tendencias y la estacionalidad para todas las ciudades que cubren 2GIS y todas las √°reas de actividad.  Por lo tanto, decidimos enviar no una fila (N√∫mero, Valor) a InputDataSet, sino varias a la vez, agrupadas por DataId.  Y el ciclo DataId se organiz√≥ dentro de R. Por lo tanto, ahorramos significativamente al llamar a R Services. <br><br><h3>  Hechos de la vida </h3><br>  Lees el art√≠culo hasta el final, es recomendable.  Para entretenerlo antes de los resultados, compartimos hechos interesantes identificados durante el an√°lisis de la estacionalidad. <br><br><h4>  Hecho No. 1 </h4><br>  Los automovilistas saben por experiencia personal que la temporada de b√∫squeda de neum√°ticos y ajuste de neum√°ticos es primavera y oto√±o.  Pero, para ser precisos, la temporada en diferentes ciudades puede ser muy diferente.  Por lo tanto, al formar colecciones y tableros (pantallas de inicio en productos), es importante considerar la estacionalidad en cada ciudad espec√≠fica. <br><br><img src="https://habrastorage.org/webt/r4/6j/q4/r46jq4en-rsrns97h1tsqk-ae18.png" alt="Gr√°fico 8: Estacionalidad de neum√°ticos en Krasnodar, Novosibirsk y Norilsk"><br>  <font color="gray"><i>Gr√°fico 8: Estacionalidad de neum√°ticos en Krasnodar, Novosibirsk y Norilsk</i></font> <br><br><h4>  Hecho No. 2 </h4><br>  La estacionalidad puede diferir incluso dentro del mismo campo de actividad, en diferentes tipos de dispositivos.  Por ejemplo, los "regalos de A√±o Nuevo" en la pantalla grande comienzan a buscar en octubre.  Mientras que en las versiones m√≥viles, la b√∫squeda comienza un mes despu√©s y el pico se acerca al A√±o Nuevo. <br><br><img src="https://habrastorage.org/webt/hk/ke/rc/hkkercsmeaa9svqjoplu3pvgjyk.png" alt="Gr√°fico 9: Busque regalos de Navidad en l√≠nea y en la versi√≥n m√≥vil de 2GIS"><br>  <font color="gray"><i>Gr√°fico 9: Busque regalos de Navidad en l√≠nea y en la versi√≥n m√≥vil de 2GIS</i></font> <br><br><h4>  Hecho No. 3 </h4><br>  En el proceso de trabajar en la estacionalidad, descubrimos una esfera de actividad, cuyo inter√©s se muestra una vez cada tres meses.  Y esto es cierto para diferentes ciudades de Rusia. <br>  Intenta adivinar qu√© tipo de negocio es este. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler tip</b> <div class="spoiler_text">  Ciudades muy diferentes de Rusia.  Entonces, ni el clima, ni la regi√≥n, ni las empresas locales, sino algo globalmente com√∫n. <br>  3 meses = trimestre.  Presta atenci√≥n a April ... <br></div></div><br><img src="https://habrastorage.org/webt/nj/dj/rv/njdjrv7h0mgsoyo5coff1uvkxle.png" alt="Gr√°fico 10"><br>  <font color="gray"><i>Gr√°fico 10</i></font> <br><br><div class="spoiler">  <b class="spoiler_title">La respuesta</b> <div class="spoiler_text">  Estos son fondos de seguro social: los informes trimestrales se presentan al FSS una vez cada tres meses, y el pico de abril se explica por un cambio en los formularios de informes a partir del 1 de enero de cada a√±o. <br></div></div><br><h3>  Una vez m√°s sobre lo principal </h3><br>  ¬øVas a buscar correlaciones en los datos?  No olvide preparar estos datos: brechas de proceso, libres de tendencias y emisiones.  Tenga en cuenta que la preparaci√≥n llevar√° la mayor parte del tiempo. <br><br>  En la etapa de trabajar con filas, abstraiga lo m√°s posible de la sem√°ntica: trabaje con el valor y el n√∫mero de serie del punto, luego el c√≥digo ser√° m√°s f√°cil de reutilizar.  La visualizaci√≥n en cada etapa del procesamiento ser√° de gran ayuda. <br><br>  PD: la tarea de encontrar tendencias y estacionalidad se realiz√≥ como parte de otra tarea: predecir cambios en la atenci√≥n del usuario despu√©s de adquirir publicidad en 2GIS.  Estoy listo para decirle c√≥mo hicimos el pron√≥stico, si est√° interesado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414041/">https://habr.com/ru/post/es414041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414023/index.html">Preg√∫ntele a Ethan: ¬øQu√© tan r√°pido podr√≠a haber aparecido la vida en el universo?</a></li>
<li><a href="../es414025/index.html">Los empleadores rastrean computadoras, viajes al ba√±o y ahora tambi√©n emociones; ¬øTu jefe te sigue?</a></li>
<li><a href="../es414027/index.html">¬øPueden mis amigos ser considerados verdaderos amigos?</a></li>
<li><a href="../es414029/index.html">Luz misteriosa alrededor de una estrella reci√©n formada, y lo que los astr√≥nomos piensan al respecto</a></li>
<li><a href="../es414031/index.html">Tras la reuni√≥n "Nuevas funciones de PostgreSQL 11"</a></li>
<li><a href="../es414043/index.html">An√°lisis de tablas de enrutamiento, o por qu√© un ingeniero de red de Python</a></li>
<li><a href="../es414047/index.html">C√≥mo hacer una poderosa escalera Jacob con un transformador de microondas con tus propias manos</a></li>
<li><a href="../es414049/index.html">Los principales juegos de E3 2018: Fallout 76, Metro Exodus, Doom Eternal y otros</a></li>
<li><a href="../es414053/index.html">5 conceptos err√≥neos sobre GDPR</a></li>
<li><a href="../es414055/index.html">Trans-PRK: uno de los est√°ndares de correcci√≥n de la visi√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>