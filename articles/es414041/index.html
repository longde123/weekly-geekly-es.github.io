<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍💼 🤺 💗 En invierno y verano en un color? Buscar la estacionalidad en los datos 🌮 🕯️ 👩🏿‍🤝‍👩🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez que decidimos ver qué intereses estacionales tienen los usuarios de 2GIS en diferentes ciudades. Se esperan estallidos de interés en flores, r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En invierno y verano en un color? Buscar la estacionalidad en los datos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/414041/"><img src="https://habrastorage.org/webt/3m/jp/jn/3mjpjnj7rqfzdr01mo8jsoesomy.jpeg"><br><br>  Una vez que decidimos ver qué intereses estacionales tienen los usuarios de 2GIS en diferentes ciudades.  Se esperan estallidos de interés en flores, regalos de Año Nuevo y llantas.  Decidimos no limitarnos a ellos e ir más allá al verificar todas las áreas de actividad en las 113 ciudades de presencia. <br><br>  En este artículo, le diré cómo buscamos la estacionalidad y qué características del comportamiento del usuario se encontraron en ellos. <br><a name="habracut"></a><br><h4>  ¿Por qué necesitas medir la estacionalidad? </h4><br>  Las necesidades de los usuarios de 2GIS cambian a lo largo del año: bienes de consumo, servicios, construcción, servicios públicos.  El conocimiento estacional es útil por varias razones: <br><br><ul><li>  Estamos comenzando a comprender más sobre los valores e intereses de nuestros usuarios en este momento y en el futuro cercano. </li><li>  Podemos "predecir" la solicitud de un usuario. </li><li>  Los gerentes de ventas se centran en áreas de actividad relevantes para los usuarios. </li></ul><br><h3>  Tipos de trafico </h3><br>  Antes de hablar sobre cómo procesamos el tráfico, vale la pena aclarar que lo dividimos en varios tipos. <br><br>  La recuperación es un tipo de tráfico en el que el usuario conoce exactamente la empresa con la que desea contactar.  Necesita aclarar la dirección, el horario de trabajo o encontrar la entrada.  En este caso, la búsqueda se realiza por el nombre de la empresa, el número de teléfono y otros atributos de la propia empresa. <br><br>  El tráfico de descubrimiento es cuando un usuario formula una solicitud en términos más generales: "muebles tapizados", "comer en Lenin", "baños".  Es decir, el usuario explora las opciones y ofertas del mercado, a menudo llamando a organizaciones o visitando sus sitios. <br><br>  El tráfico geográfico ocurre cuando un usuario trabaja con un mapa.  Por ejemplo, está buscando farmacias o estaciones de servicio más cercanas a la casa. <br><img src="https://habrastorage.org/webt/a7/da/xs/a7daxskkn-arknmjqpz-av2d1pe.jpeg"><br>  Todas las solicitudes de los usuarios y todas las acciones posteriores están marcadas en el tráfico.  Para buscar la estacionalidad, el análisis tomó descubrimiento + geo-tráfico.  Dado que, en primer lugar, corresponden a la manifestación de los intereses del usuario y, en segundo lugar, pueden controlarse.  No puede administrar el tráfico de recuperación. <br><br><h3>  Sobre tendencias </h3><br><img src="https://habrastorage.org/webt/av/we/sx/avwesx7puvrhmwfvo9ubshrperg.png" alt="Gráfico 1: ¿Ves estacionalidad?"><br>  <font color="gray"><i>Gráfico 1: ¿Ves estacionalidad?</i></font> <br><br>  Antes de comenzar a buscar la estacionalidad, debe tener en cuenta los cambios en el volumen de tráfico en diferentes tipos de dispositivos.  Tomamos en cuenta que la audiencia de las versiones de WinPhone y PC está disminuyendo constantemente.  Mientras que en línea, Android, iOS están en constante crecimiento. <br><br><h4>  Prueba de hipótesis </h4><br>  Los criterios para determinar la estacionalidad se desarrollan para series estacionarias.  Es necesario probar la hipótesis de que la serie contiene una tendencia.  Consideraremos las series de tiempo como un proceso aleatorio.  Entonces los elementos de la serie son realizaciones de alguna variable aleatoria. <br><br>  Podemos probar la hipótesis de que todos los valores de la muestra pertenecen a la misma población con m promedio.  Entonces la hipótesis principal es: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.429ex" height="2.419ex" viewBox="0 -780.1 12240 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-48" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-30" x="1175" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3A" x="1563" y="0"></use><g transform="translate(2119,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-69" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3D" x="3620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-6D" x="4676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="5554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-69" x="5999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-3D" x="6623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-31" x="7679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="8180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-32" x="8625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="9125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="9570" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="10016" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2E" x="10461" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMAIN-2C" x="10906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhi8Uj4xrkrQ7ztTQUgAbYVlP_l9xw#MJMATHI-4E" x="11351" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> H_0: m_i = m, i = 1,2, ..., N </script><br>  contra la hipótesis de la tendencia rival <br><math> </math> $ en línea $ H_1: ∣m_ {i + 1} −m_i∣&gt; 0, i = 1,2, ..., N - 1 $ en línea $ <br>  donde N es el número de elementos en una fila. <br><br>  Para probar la hipótesis, debe usar uno de los criterios para la importancia de la tendencia.  En base a los estudios, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> eligió el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">criterio de inversiones</a> . <br><br>  Si la hipótesis no se rechaza, entonces es necesario eliminar la tendencia de los datos.  Suponemos que en nuestros datos solo puede haber una tendencia lineal.  ¡Oh, sería exponencial!  También asumiremos que no podemos tener más de un punto de inflexión. <br><br><img src="https://habrastorage.org/webt/xo/vp/rh/xovprhfclo4duighdd7eibfieig.png" alt="Gráfico 2: Series temporales (del Gráfico 1) y su tendencia"><br>  <font color="gray"><i>Gráfico 2: Series temporales (del Gráfico 1) y su tendencia</i></font> <br><br><h4>  Sobre un rastrillo y descubrimientos </h4><br>  Esbozamos los límites del estudio y comenzamos a probar hipótesis.  Por supuesto, no fue sin rastrillos y descubrimientos: dado que la tarea no se limitó a los servicios populares en ciudades con más de un millón de personas, hemos compilado una lista de casos especiales a los que vale la pena prestarles atención. <br><br><ol><li>  Lagunas de datos.  En áreas estrechas de actividad, algunas fechas pueden no tener datos.  El caso es especialmente relevante para las ciudades pequeñas.  Esta característica debe tenerse en cuenta para la correcta construcción de la regresión. </li><li>  Si se encuentra un punto de inflexión, considere su proximidad al principio o al final de la fila.  Es posible una mala interpretación del comportamiento de una serie en condiciones de contorno.  Por ejemplo, en el gráfico 2, los primeros 120 puntos parecerían indicar un crecimiento lineal por partes.  Pero, de hecho, mostró estacionalidad, que veremos más adelante. </li><li>  Elegir el punto de referencia correcto.  Para obtener los coeficientes correctos, debe usar una serie, comenzando desde el primer punto significativo, y recordar la coordenada X de este punto (la fecha en que aparecieron los datos en la serie).  La tendencia se construirá en el sistema de coordenadas con 0 en este punto.  Este caso es relevante para comparar esferas entre sí.  Por ejemplo, en 2GIS las ciudades no se lanzaron simultáneamente y, en consecuencia, comenzaron a enviar estadísticas en diferentes momentos.  Lo mismo es cierto para la aparición de nuevos negocios, como, por ejemplo, las barberías. </li><li>  Quizás lo más difícil es encontrar un compromiso entre el nivel de detalle y la adecuación de la cantidad de datos.  Nos decidimos por tres dimensiones: ciudad, campo de actividad, plataforma de dispositivo de usuario. </li></ol><br><img src="https://habrastorage.org/webt/sg/-m/gc/sg-mgcxzvjd16e8aodxfv4ikixq.png" alt="Gráfico 3: una serie sin tendencia"><br>  <font color="gray"><i>Gráfico 3: una serie sin tendencia</i></font> <br><br><h3>  Búsqueda de estacionalidad </h3><br>  Después de restar las tendencias correspondientes de la serie temporal, podemos proceder a la tarea de encontrar la estacionalidad.  Consta de dos subtareas: <br><br><ol><li>  Detección del hecho de la presencia de estacionalidad en una serie. </li><li>  Definiciones de temporadas altas y bajas: esto es lo que tiene valor práctico. </li></ol><br><h4>  Detección de correlación </h4><br>  Hay funciones de búsqueda de correlación listas para usar tanto en R como en Python.  Utilizamos la correlación de Pearson.  Cuando trabaje con vectores de intereses del usuario, tenga en cuenta lo siguiente: <br><br><ul><li>  Después de restar la tendencia de la serie original, se pueden obtener valores negativos.  Esto es normal en esta etapa. </li><li>  Para nuestra tarea, es suficiente verificar la correlación de series de tiempo de 365 días.  Sí, la influencia de un año bisiesto es insignificante y no lo tenemos en cuenta. </li><li>  Para buscar la estacionalidad, debe tener datos de al menos dos períodos completos.  Nuestros cálculos utilizaron datos de cuatro períodos. </li></ul><br>  Estamos buscando la correlación de dos vectores: X: [0;  N-365], Y: [366;  N]  Donde N es la longitud de la fila. <br><br><img src="https://habrastorage.org/webt/pm/ht/-6/pmht-6_tiwi8bek3cu6vly95pzg.png" alt="Gráfico 4: Detección de correlación"><br>  <font color="gray"><i>Gráfico 4: Detección de correlación</i></font> <br><br><h4>  Obtén el beneficio </h4><br>  El hecho de la presencia de estacionalidad no tiene valor práctico.  Debe comprender qué atención se prestará al campo de actividad el próximo mes: mayor, menor o normal. <br><br>  Se eligió una escala multiplicativa como resultado final.  Donde la unidad es el nivel "normal" de interés del usuario en el campo de actividad.  Un valor distinto de uno caracteriza un aumento o disminución múltiple en el interés. <br><br>  En nuestro caso, [por ahora] una escala suficientemente temporal que dura un mes es suficiente.  Para determinar el nivel 1, se utilizó la mediana de atención mensual del usuario.  Luego calculó la desviación múltiple de esta mediana. <br><br><img src="https://habrastorage.org/webt/rv/pj/rr/rvpjrrnufdxhm3hmtnacnfvsu10.png" alt="Gráfico 5: Estacionalidad anual"><br>  <font color="gray"><i>Gráfico 5: Estacionalidad anual</i></font> <br><br>  Es hora de revelar el secreto de qué datos muestran los gráficos del artículo.  En este y en todos los gráficos anteriores, clics en los museos de San Petersburgo.  Como se puede ver en el último horario, los museos son populares durante las vacaciones de enero, cuando hay muchos días libres y en verano. <br><br><h4>  ¿Y si ... </h4><br>  ... tomar y alimentar el algoritmo no los intereses de los usuarios, sino, por ejemplo, las ventas? <br><br>  El algoritmo de acciones es el mismo: <br><br><ol><li>  Estamos buscando tendencias.  El público de las ciudades está creciendo, y con él crece el número de anunciantes.  Es necesario restar la tendencia asociada con la creciente popularidad de 2GIS como plataforma de publicidad para obtener aumentos y recesiones de la industria. </li><li>  Encontramos correlaciones de ventas de año en año, y luego temporadas altas y bajas. </li></ol><br><h4>  Tomó una serie de ajustes </h4><br>  La publicidad en 2GIS se vende mensualmente, por lo que tomaron un mes para la escala, pero la estacionalidad del usuario se analizó hasta un día.  Para la compatibilidad con versiones anteriores, adaptamos los algoritmos para trabajar con series arbitrarias, donde el eje x es el número de serie del punto y el eje y tiene algún valor (en este nivel, la semántica del valor no importa). <br><br>  El punto de referencia de una serie de ventas (origen), por regla general, no coincide con el punto de referencia de estacionalidad del usuario.  Después de todo, al principio la ciudad gana audiencia, y solo entonces aparece la publicidad.  En esta etapa, no debe combinar los resultados de dos estacionalidades. <br><br>  Como las ventas son mensuales, tenemos significativamente menos puntos en las filas.  En este caso, la correlación debe considerarse en 12 puntos en lugar de 365. <br><br><img src="https://habrastorage.org/webt/zg/sv/lo/zgsvlogmzxvi347x9mlbs9dmdyw.png" alt="Gráfico 6: Estacionalidad de las ventas."><br>  <font color="gray"><i>Gráfico 6: Estacionalidad de las ventas.</i></font> <br><br>  Como paso final, decidimos imponer la estacionalidad de las ventas a la estacionalidad del usuario.  Ahora puede ver dónde vendemos anuncios más tarde de lo necesario y retrasar la demanda de los usuarios. <br><br>  Por ejemplo, los usuarios están interesados ​​en comprar concreto en Nizhny Novgorod de abril a octubre.  Mientras que las empresas se dedican a la promoción solo de mayo a septiembre. <br><br><img src="https://habrastorage.org/webt/fy/n7/mc/fyn7mcluv1duddq8a2hueb-idj8.png" alt="Gráfico 7: Intersección de la estacionalidad del usuario y la estacionalidad de las ventas."><br>  <font color="gray"><i>Gráfico 7: La intersección de la estacionalidad del usuario y la estacionalidad de las ventas (verde - usuario, azul - ventas, rojo - coincidencia)</i></font> <br><br><h4>  Que hizo </h4><br>  Todo lo descrito anteriormente se implementa en MS SQL Server 2016. Para buscar la regresión lineal y la correlación, se usa R, que se ha incluido en el servidor desde la versión 2016. Y dado que ya tenemos Data Warehouse y análisis de estadísticas de usuario en SQL Server, resultó ser muy conveniente usar R para cálculos matemáticos <br><img src="https://habrastorage.org/webt/zo/uv/fi/zouvfihpufdsdoywofaz85qvra4.jpeg"><br>  Ejemplo de uso de R de TSQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmp EXEC sp_execute_external_script @language = N'R', @script = @R, @input_data_1 = N'SELECT DataId, Number, Value FROM #data ORDER BY 1, 2'</span></span></code> </pre> <br>  Donde: <br><br><ul><li>  la variable R contiene directamente el código R; </li><li>  language = N'R ': indica que el script pasado en la variable R contiene código de idioma R. En SQL Server 2017, además de R, puede usar language = N'Python'.  Luego, en consecuencia, el código de Python debe pasarse al parámetro del script. </li><li>  input_data_1: contiene una consulta SQL, cuyos resultados dentro del código R se pueden acceder como InputDataSet; </li><li>  El resultado del procedimiento será RecordDataSet, formado como OutputDataSet &lt;- calcAllTrend (data = InputDataSet); </li><li>  Asegúrese de especificar el formato del registro resultante: el número y los tipos de columnas.  En este caso, el formato de OutputDataSet está determinado por la tabla #tmp donde se registran los resultados.  O puede usar WITH RESULT SETS para describir el conjunto de registros resultante. </li></ul><br>  En nuestro caso, resultó que una parte significativa del tiempo de ejecución sp_execute_external_script está ocupada directamente al acceder a los Servicios R.  El código R en sí funcionó rápidamente. <br><br>  Permítame recordarle que queríamos calcular las tendencias y la estacionalidad para todas las ciudades que cubren 2GIS y todas las áreas de actividad.  Por lo tanto, decidimos enviar no una fila (Número, Valor) a InputDataSet, sino varias a la vez, agrupadas por DataId.  Y el ciclo DataId se organizó dentro de R. Por lo tanto, ahorramos significativamente al llamar a R Services. <br><br><h3>  Hechos de la vida </h3><br>  Lees el artículo hasta el final, es recomendable.  Para entretenerlo antes de los resultados, compartimos hechos interesantes identificados durante el análisis de la estacionalidad. <br><br><h4>  Hecho No. 1 </h4><br>  Los automovilistas saben por experiencia personal que la temporada de búsqueda de neumáticos y ajuste de neumáticos es primavera y otoño.  Pero, para ser precisos, la temporada en diferentes ciudades puede ser muy diferente.  Por lo tanto, al formar colecciones y tableros (pantallas de inicio en productos), es importante considerar la estacionalidad en cada ciudad específica. <br><br><img src="https://habrastorage.org/webt/r4/6j/q4/r46jq4en-rsrns97h1tsqk-ae18.png" alt="Gráfico 8: Estacionalidad de neumáticos en Krasnodar, Novosibirsk y Norilsk"><br>  <font color="gray"><i>Gráfico 8: Estacionalidad de neumáticos en Krasnodar, Novosibirsk y Norilsk</i></font> <br><br><h4>  Hecho No. 2 </h4><br>  La estacionalidad puede diferir incluso dentro del mismo campo de actividad, en diferentes tipos de dispositivos.  Por ejemplo, los "regalos de Año Nuevo" en la pantalla grande comienzan a buscar en octubre.  Mientras que en las versiones móviles, la búsqueda comienza un mes después y el pico se acerca al Año Nuevo. <br><br><img src="https://habrastorage.org/webt/hk/ke/rc/hkkercsmeaa9svqjoplu3pvgjyk.png" alt="Gráfico 9: Busque regalos de Navidad en línea y en la versión móvil de 2GIS"><br>  <font color="gray"><i>Gráfico 9: Busque regalos de Navidad en línea y en la versión móvil de 2GIS</i></font> <br><br><h4>  Hecho No. 3 </h4><br>  En el proceso de trabajar en la estacionalidad, descubrimos una esfera de actividad, cuyo interés se muestra una vez cada tres meses.  Y esto es cierto para diferentes ciudades de Rusia. <br>  Intenta adivinar qué tipo de negocio es este. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler tip</b> <div class="spoiler_text">  Ciudades muy diferentes de Rusia.  Entonces, ni el clima, ni la región, ni las empresas locales, sino algo globalmente común. <br>  3 meses = trimestre.  Presta atención a April ... <br></div></div><br><img src="https://habrastorage.org/webt/nj/dj/rv/njdjrv7h0mgsoyo5coff1uvkxle.png" alt="Gráfico 10"><br>  <font color="gray"><i>Gráfico 10</i></font> <br><br><div class="spoiler">  <b class="spoiler_title">La respuesta</b> <div class="spoiler_text">  Estos son fondos de seguro social: los informes trimestrales se presentan al FSS una vez cada tres meses, y el pico de abril se explica por un cambio en los formularios de informes a partir del 1 de enero de cada año. <br></div></div><br><h3>  Una vez más sobre lo principal </h3><br>  ¿Vas a buscar correlaciones en los datos?  No olvide preparar estos datos: brechas de proceso, libres de tendencias y emisiones.  Tenga en cuenta que la preparación llevará la mayor parte del tiempo. <br><br>  En la etapa de trabajar con filas, abstraiga lo más posible de la semántica: trabaje con el valor y el número de serie del punto, luego el código será más fácil de reutilizar.  La visualización en cada etapa del procesamiento será de gran ayuda. <br><br>  PD: la tarea de encontrar tendencias y estacionalidad se realizó como parte de otra tarea: predecir cambios en la atención del usuario después de adquirir publicidad en 2GIS.  Estoy listo para decirle cómo hicimos el pronóstico, si está interesado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414041/">https://habr.com/ru/post/es414041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414023/index.html">Pregúntele a Ethan: ¿Qué tan rápido podría haber aparecido la vida en el universo?</a></li>
<li><a href="../es414025/index.html">Los empleadores rastrean computadoras, viajes al baño y ahora también emociones; ¿Tu jefe te sigue?</a></li>
<li><a href="../es414027/index.html">¿Pueden mis amigos ser considerados verdaderos amigos?</a></li>
<li><a href="../es414029/index.html">Luz misteriosa alrededor de una estrella recién formada, y lo que los astrónomos piensan al respecto</a></li>
<li><a href="../es414031/index.html">Tras la reunión "Nuevas funciones de PostgreSQL 11"</a></li>
<li><a href="../es414043/index.html">Análisis de tablas de enrutamiento, o por qué un ingeniero de red de Python</a></li>
<li><a href="../es414047/index.html">Cómo hacer una poderosa escalera Jacob con un transformador de microondas con tus propias manos</a></li>
<li><a href="../es414049/index.html">Los principales juegos de E3 2018: Fallout 76, Metro Exodus, Doom Eternal y otros</a></li>
<li><a href="../es414053/index.html">5 conceptos erróneos sobre GDPR</a></li>
<li><a href="../es414055/index.html">Trans-PRK: uno de los estándares de corrección de la visión</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>