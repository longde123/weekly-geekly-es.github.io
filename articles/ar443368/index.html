<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷🏻 🚶🏽 🌙 نحن نستعد للبحث عن النص الكامل في بوستجرس. الجزء 2 🍈 🦓 🏴󠁧󠁢󠁳󠁣󠁴󠁿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في المقالة الأخيرة ، قمنا بتحسين البحث في PostgreSQL باستخدام الأدوات القياسية. في هذه المقالة ، سنواصل تحسين استخدام مؤشر RUM وتحليل إيجابيات وسلبيات...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نحن نستعد للبحث عن النص الكامل في بوستجرس. الجزء 2</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443368/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المقالة الأخيرة ،</a> قمنا بتحسين البحث في PostgreSQL باستخدام الأدوات القياسية.  في هذه المقالة ، سنواصل تحسين استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مؤشر RUM</a> وتحليل إيجابيات وسلبيات مقارنة مع GIN. </p><a name="habracut"></a><br><h2 id="vvedenie" style=";text-align:right;direction:rtl">  مقدمة </h2><br><p style=";text-align:right;direction:rtl">  RUM امتداد لـ Postgres ، وهو فهرس جديد للبحث عن النص الكامل.  يسمح لك بإرجاع النتائج مرتبة حسب الصلة عند المرور بالفهرس.  لن أركز على تثبيته - فهو موصوف في <a href="">README</a> في المستودع. </p><br><h2 id="polzuemsya-indeksom" style=";text-align:right;direction:rtl">  نحن نستخدم فهرس </h2><br><p style=";text-align:right;direction:rtl">  يتم إنشاء فهرس مشابه لمؤشر GIN ، ولكن مع بعض المعلمات.  يمكن العثور على قائمة المعلمات بأكملها في الوثائق. </p><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> idx_rum_document <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_documentvector <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> rum ("text" rum_tsvector_ops);</code> </pre> <br><p style=";text-align:right;direction:rtl">  استعلام البحث عن RUM: </p><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> document_id, "text" &lt;=&gt; plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rank <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> documents_documentvector <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> "text" @@ plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rank;</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">طلب للحصول على الجن</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> document_id, ts_rank("text", plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rank <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> documents_documentvector <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> "text" @@ plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rank <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  الفرق من GIN هو أن الصلة يتم الحصول عليها لا باستخدام الدالة ts_rank ، ولكن باستخدام استعلام مع المشغل <code>&lt;=&gt;</code> : <code>"text" &lt;=&gt; plainto_tsquery('')</code> .  يُرجع هذا الاستعلام بعض <em>المسافة</em> بين متجه البحث واستعلام البحث.  كلما كان حجمها أصغر ، كلما كان الاستعلام أفضلًا مع المتجه. </p><br><h2 id="sravnenie-s-gin" style=";text-align:right;direction:rtl">  مقارنة مع الجن </h2><br><p style=";text-align:right;direction:rtl">  سنقارن هنا على أساس اختبار بـ 500 ألف مستند تقريبًا لإشعار الاختلافات في نتائج البحث. </p><br><h3 id="skorost-vypolneniya-zaprosov" style=";text-align:right;direction:rtl">  طلب السرعة </h3><br><p style=";text-align:right;direction:rtl">  دعونا نرى ما الذي ستنتجه شركة EXPLAIN for GIN في هذه القاعدة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Gather Merge (actual time=563.840..611.844 rows=119553 loops=1) Workers Planned: 2 Workers Launched: 2 -&gt; Sort (actual time=553.427..557.857 rows=39851 loops=3) Sort Key: (ts_rank(text, plainto_tsquery(''::text))) Sort Method: external sort Disk: 1248kB -&gt; Parallel Bitmap Heap Scan on documents_documentvector (actual time=13.402..538.879 rows=39851 loops=3) Recheck Cond: (text @@ plainto_tsquery(''::text)) Heap Blocks: exact=5616 -&gt; Bitmap Index Scan on idx_gin_document (actual time=12.144..12.144 rows=119553 loops=1) Index Cond: (text @@ plainto_tsquery(''::text)) Planning time: 4.573 ms Execution time: 617.534 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ولروم؟ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Sort (actual time=1668.573..1676.168 rows=119553 loops=1) Sort Key: ((text &lt;=&gt; plainto_tsquery(''::text))) Sort Method: external merge Disk: 3520kB -&gt; Bitmap Heap Scan on documents_documentvector (actual time=16.706..1605.382 rows=119553 loops=1) Recheck Cond: (text @@ plainto_tsquery(''::text)) Heap Blocks: exact=15599 -&gt; Bitmap Index Scan on idx_rum_document (actual time=14.548..14.548 rows=119553 loops=1) Index Cond: (text @@ plainto_tsquery(''::text)) Planning time: 0.650 ms Execution time: 1679.315 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ما هذا؟  ما هو استخدام هذا RUM المتبجح ، كما تسأل ، إذا كان يعمل <em>ثلاث مرات</em> أبطأ من GIN؟  وأين الفرز الشهير داخل الفهرس؟ </p><br><p style=";text-align:right;direction:rtl">  الهدوء: دعنا نحاول إضافة <code>LIMIT 1000</code> إلى الطلب. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">اشرح لـ RUM</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl">  الحد (الوقت الفعلي = 115.568..137.313 الصفوف = 1000 حلقة = 1)
    -&gt; فهرس المسح الضوئي باستخدام idx_rum_document على documents_documentvector (الوقت الفعلي = 115.567..137.239 الصفوف = 1000 حلقة = 1)
          فهرس الفهرس: (textplainto_tsquery ('query' :: text))
          الترتيب حسب: (text &lt;=&gt; plainto_tsquery ('query' :: text))
  وقت التخطيط: 0.481 مللي ثانية
  مدة التنفيذ: 137.678 مللي ثانية </pre></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">شرح للحصول على الجن</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl">  الحد (الوقت الفعلي = 579.905..585.650 الصفوف = 1000 حلقة = 1)
    -&gt; جمع دمج (الوقت الفعلي = 579.904..585.604 الصفوف = 1000 حلقة = 1)
          العمال المخطط: 2
          تم إطلاق العمال: 2
          -&gt; الترتيب (الوقت الفعلي = 574.061..574.171 صفوف = 992 حلقة = 3)
                مفتاح التصنيف: (ts_rank (text ، plainto_tsquery ('query' :: text))) DESC
                طريقة الفرز: قرص دمج خارجي: 1224 كيلو بايت
                -&gt; مسح كومة نقطية متوازية على documents_documentvector (الوقت الفعلي = 8.920..555.571 الصفوف = 39851 حلقة = 3)
                      إعادة فحص Cond: (textplainto_tsquery ('query' :: text))
                      كتل الكومة: بالضبط = 5422
                      -&gt; مسح فهرس الصور النقطية على idx_gin_document (الوقت الفعلي = 8.945..8.945 الصفوف = 119553 حلقات = 1)
                            فهرس الفهرس: (textplainto_tsquery ('query' :: text))
  وقت التخطيط: 0.223 مللي ثانية
  مدة التنفيذ: 585.948 مللي ثانية </pre></div></div><br><p style=";text-align:right;direction:rtl">  ~ 150 مللي مقابل ~ 600 مللي ثانية!  بالفعل لا تؤيد GIN ، أليس كذلك؟  وقد انتقل الفرز داخل الفهرس! </p><br><p style=";text-align:right;direction:rtl">  وإذا كنت تبحث عن <code>LIMIT 100</code> ؟ </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">اشرح لـ RUM</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl">  الحد (الوقت الفعلي = 105.863..108.530 الصفوف = 100 حلقة = 1)
    -&gt; فهرس المسح الضوئي باستخدام idx_rum_document على documents_documentvector (الوقت الفعلي = 105.862..108.517 الصفوف = 100 حلقة = 1)
          فهرس الفهرس: (textplainto_tsquery ('query' :: text))
          الترتيب حسب: (text &lt;=&gt; plainto_tsquery ('query' :: text))
  وقت التخطيط: 0.199 مللي ثانية
  مدة التنفيذ: 108.958 مللي ثانية </pre></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">شرح للحصول على الجن</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl">  الحد (الوقت الفعلي = 582.924..588.351 الصفوف = 100 حلقة = 1)
    -&gt; جمع الدمج (الوقت الفعلي = 582.923..588.344 الصفوف = 100 حلقة = 1)
          العمال المخطط: 2
          تم إطلاق العمال: 2
          -&gt; الترتيب (الوقت الفعلي = 573.809..573.889 الصفوف = 806 حلقة = 3)
                مفتاح التصنيف: (ts_rank (text ، plainto_tsquery ('query' :: text))) DESC
                طريقة الفرز: قرص دمج خارجي: 1224 كيلو بايت
                -&gt; مسح كومة نقطية متوازية على documents_documentvector (الوقت الفعلي = 18.038..552.827 الصفوف = 39851 حلقة = 3)
                      إعادة فحص Cond: (textplainto_tsquery ('query' :: text))
                      كتل الكومة: بالضبط = 5275
                      -&gt; مسح فهرس الصور النقطية على idx_gin_document (الوقت الفعلي = 16.541..16.541 الصفوف = 119553 حلقات = 1)
                            فهرس الفهرس: (textplainto_tsquery ('query' :: text))
  وقت التخطيط: 0.487 مللي ثانية
  مدة التنفيذ: 588.583 مللي ثانية </pre></div></div><br><p style=";text-align:right;direction:rtl">  الفرق هو أكثر وضوحا. </p><br><p style=";text-align:right;direction:rtl">  الشيء المهم هو أن GIN لا يهم بالضبط عدد الخطوط التي تحصل عليها في النهاية - بل يجب أن تمر عبر جميع الخطوط التي نجح الطلب ، وترتيبها.  RUM يفعل هذا فقط لتلك الخطوط التي نحتاجها حقًا.  إذا احتجنا إلى الكثير من الخطوط ، يفوز GIN.  يقوم <code>ts_rank</code> الخاص <code>ts_rank</code> بإجراء العمليات الحسابية بشكل <code>ts_rank</code> كفاءة من المشغل <code>&lt;=&gt;</code> .  ولكن في الاستعلامات الصغيرة ، لا يمكن إنكار ميزة RUM. </p><br><p style=";text-align:right;direction:rtl">  في أغلب الأحيان ، لا يحتاج المستخدم إلى تفريغ جميع المستندات الـ 50 ألف من قاعدة البيانات في وقت واحد.  يحتاج فقط 10 مشاركات في الصفحة الأولى والثانية والثالثة إلخ.  وفي ظل هذه الحالات بالتحديد ، يتم شحذ هذا الفهرس ، وسيوفر زيادة جيدة في أداء البحث على قاعدة كبيرة. </p><br><h3 id="terpimost-k-join-am" style=";text-align:right;direction:rtl">  تاريخ التسامح </h3><br><p style=";text-align:right;direction:rtl">  ماذا لو تطلب منك البحث الانضمام إلى جداول أخرى أو أكثر؟  على سبيل المثال ، لعرض في النتائج نوع المستند ، مالكها؟  أو ، كما في حالتي ، قم بالتصفية حسب أسماء الكيانات ذات الصلة؟ </p><br><p style=";text-align:right;direction:rtl">  قارن: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">طلب مع اثنين من الانضمام للحصول على الجن</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> document_id, ts_rank("text", plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rank, case_number <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> documents_documentvector <span class="hljs-keyword"><span class="hljs-keyword">RIGHT JOIN</span></span> documents_document <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_documentvector.document_id = documents_document.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> documents_case <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_document.case_id = documents_case.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> "text" @@ plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rank <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  النتيجة: </p><br><pre style=";text-align:right;direction:rtl"> الحد (الوقت الفعلي = 1637.902..1643.483 الصفوف = 10 حلقات = 1)
    -&gt; جمع الدمج (الوقت الفعلي = 1637.901..1643.479 الصفوف = 10 حلقات = 1)
          العمال المخطط: 2
          تم إطلاق العمال: 2
          -&gt; الترتيب (الوقت الفعلي = 1070.614..1070.687 الصفوف = 652 حلقة = 3)
                مفتاح التصنيف: (ts_rank (documents_documentvector.text، plainto_tsquery ('query' :: text))) DESC
                طريقة الفرز: قرص دمج خارجي: 2968 كيلو بايت
                -&gt; Hash Left Join (الوقت الفعلي = 323.386..1049.092 صفوف = 39851 حلقة = 3)
                      Hash Cond: (documents_document.case_id = documents_case.id)
                      -&gt; التجزئة التجزئة (الوقت الفعلي = 239.312..324.797 الصفوف = 39851 حلقة = 3)
                            Hash Cond: (documents_documentvector.document_id = documents_document.id)
                            -&gt; مسح كومة نقطية متوازية على documents_documentvector (الوقت الفعلي = 11.022..37.073 الصفوف = 39851 حلقة = 3)
                                  إعادة فحص Cond: (textplainto_tsquery ('query' :: text))
                                  كتل الكومة: بالضبط = 9362
                                  -&gt; مسح فهرس الصور النقطية على idx_gin_document (الوقت الفعلي = 12.094..12.094 الصفوف = 119553 حلقات = 1)
                                        فهرس الفهرس: (textplainto_tsquery ('query' :: text))
                            -&gt; التجزئة (الوقت الفعلي = 227.856..227.856 الصفوف = 472089 حلقات = 3)
                                  الدلاء: 65536 الدفعات: 16 استخدام الذاكرة: 2264 كيلو بايت
                                  -&gt; Seq Scan على documents_document (الوقت الفعلي = 0.009..147.104 الصفوف = 472089 حلقة = 3)
                      -&gt; التجزئة (الوقت الفعلي = 83.338..83.338 الصفوف = 273695 حلقة = 3)
                            الدلاء: 65536 الدفعات: 8 استخدام الذاكرة: 2602 كيلو بايت
                            -&gt; Seq Scan على documents_case (الوقت الفعلي = 0.009..39.082 الصفوف = 273695 حلقة = 3)
 وقت التخطيط: 0.857 مللي ثانية
 مدة التنفيذ: 1644.028 مللي ثانية
</pre></div></div><br><p style=";text-align:right;direction:rtl">  في ثلاث صلات وأكبر ، يصل وقت الطلب إلى 2-3 ثوان وينمو بعدد صلات. </p><br><p style=";text-align:right;direction:rtl">  ولكن ماذا عن رم؟  دع الطلب يتم على الفور مع خمسة صلات. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">خمسة الانضمام طلب للحصول على رم</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> document_id, "text" &lt;=&gt; plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rank, case_number, classifier_procedure.title, classifier_division.title, classifier_category.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> documents_documentvector <span class="hljs-keyword"><span class="hljs-keyword">RIGHT JOIN</span></span> documents_document <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_documentvector.document_id = documents_document.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> documents_case <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_document.case_id = documents_case.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> classifier_procedure <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_case.procedure_id = classifier_procedure.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> classifier_division <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_case.division_id = classifier_division.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> classifier_category <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> documents_document.category_id = classifier_category.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> "text" @@ plainto_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> documents_document.is_active <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rank <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  النتيجة: </p><br><pre style=";text-align:right;direction:rtl">  الحد (الوقت الفعلي = 70.524..72.292 الصفوف = 10 حلقات = 1)
   -&gt; Left Loop Left Join (الوقت الفعلي = 70.521..72.279 صفوف = 10 حلقات = 1)
         -&gt; الانضمام إلى اليسار حلقة متداخلة (الوقت الفعلي = 70.104..70.406 الصفوف = 10 حلقات = 1)
               -&gt; Left Loop Left Join (الوقت الفعلي = 70.089..70.351 صفوف = 10 حلقات = 1)
                     -&gt; Left Loop Left Join (الوقت الفعلي = 70.073..70.302 الصفوف = 10 حلقات = 1)
                           -&gt; حلقة متداخلة (الوقت الفعلي = 70.052..70.201 الصفوف = 10 حلقات = 1)
                                 -&gt; فهرس المسح الضوئي باستخدام document_vector_rum_index على documents_documentvector (الوقت الفعلي = 70.001..70.035 الصفوف = 10 حلقات = 1)
                                       فهرس الفهرس: (textplainto_tsquery ('query' :: text))
                                       الترتيب حسب: (text &lt;=&gt; plainto_tsquery ('query' :: text))
                                 -&gt; فهرس المسح الضوئي باستخدام documents_document_pkey على documents_document (الوقت الفعلي = 0.013..0.013 الصفوف = 1 حلقات = 10)
                                       فهرس الفهرس: (id = documents_documentvector.document_id)
                                       عامل التصفية: (is_active IS TRUE)
                           -&gt; فهرس المسح الضوئي باستخدام documents_case_pkey على documents_case (الوقت الفعلي = 0.009..0.009 الصفوف = 1 حلقات = 10)
                                 فهرس الفهرس: (documents_document.case_id = id)
                     -&gt; فهرس المسح الضوئي باستخدام classifier_procedure_pkey على classifier_procedure (الوقت الفعلي = 0.003..0.003 الصفوف = 1 حلقات = 10)
                           فهرس الفهرس: (documents_case.procedure_id = id)
               -&gt; فهرس المسح الضوئي باستخدام classifier_division_pkey على classifier_division (الوقت الفعلي = 0.004..0.004 الصفوف = 1 حلقات = 10)
                     فهرس الفهرس: (documents_case.division_id = id)
         -&gt; فهرس المسح الضوئي باستخدام classifier_category_pkey على classifier_category (الوقت الفعلي = 0.003..0.003 الصفوف = 1 حلقات = 10)
               فهرس الفهرس: (documents_document.category_id = id)
 وقت التخطيط: 2.861 مللي ثانية
 مدة التنفيذ: 72.865 مللي ثانية
</pre></div></div><br><p style=";text-align:right;direction:rtl">  إذا لم يكن بإمكانك الاستغناء عن الانضمام عند البحث ، فسيكون RUM مناسبًا لك بوضوح. </p><br><h3 id="mesto-na-diske" style=";text-align:right;direction:rtl">  مساحة القرص </h3><br><p style=";text-align:right;direction:rtl">  على قاعدة اختبار من حوالي 500 ألف وثيقة و 3.6 غيغابايت فهارس احتلت أحجام مختلفة <em>جدا</em> . </p><br><pre style=";text-align:right;direction:rtl">  idx_rum_document |  1950 ميغابايت
  idx_gin_document |  418 ميغابايت
</pre><br><p style=";text-align:right;direction:rtl">  نعم ، محرك رخيص.  ولكن 2 غيغابايت بدلاً من 400 ميغابايت لا يمكن الرجاء.  نصف حجم القاعدة كثيرًا بالنسبة للمؤشر.  هنا يفوز GIN دون قيد أو شرط. </p><br><h2 id="vyvody" style=";text-align:right;direction:rtl">  النتائج </h2><br><p style=";text-align:right;direction:rtl">  تحتاج إلى رم إذا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لديك الكثير من المستندات ، لكنك تعطي صفحة نتائج البحث صفحة </li><li style=";text-align:right;direction:rtl">  تحتاج إلى تصفية متطورة لنتائج البحث </li><li style=";text-align:right;direction:rtl">  أنت لا تمانع في مساحة القرص </li></ul><br><p style=";text-align:right;direction:rtl">  ستكون راضيًا تمامًا عن GIN إذا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لديك قاعدة صغيرة </li><li style=";text-align:right;direction:rtl">  لديك قاعدة كبيرة ، ولكن عليك أن تنتج نتائج على الفور وهذا كل شيء </li><li style=";text-align:right;direction:rtl">  لا تحتاج إلى تصفية مع Join s </li><li style=";text-align:right;direction:rtl">  هل أنت مهتم في الحد الأدنى لحجم الفهرس على القرص </li></ul><br><p style=";text-align:right;direction:rtl">  آمل أن تزيل هذه المقالة الكثير من WTF ؟! يحدث ذلك عند العمل وإعداد البحث في بوستجرس.  سأكون سعيدًا لسماع نصيحة من أولئك الذين يعرفون كيفية تكوين كل شيء بشكل أفضل!) </p><br><p style=";text-align:right;direction:rtl">  أخطط في الأجزاء التالية لمعرفة المزيد عن RUM في مشروعي: حول استخدام خيارات RUM إضافية ، والعمل في حزمة Django + PostgreSQL. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar443368/">https://habr.com/ru/post/ar443368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar443350/index.html">كيفية جعل لعبة الجوال فريقًا يتكون من شخصين بميزانية صفرية والحصول على إعلانات مميزة على Google Play</a></li>
<li><a href="../ar443352/index.html">ماذا يفعل محللو تكنولوجيا المعلومات؟</a></li>
<li><a href="../ar443358/index.html">F5 يشتري NGINX</a></li>
<li><a href="../ar443360/index.html">نظرة من الداخل. كلية الدراسات العليا في EPFL. الجزء 3: من الاستلام إلى الحماية</a></li>
<li><a href="../ar443364/index.html">كيف يمكن لعقد وسائل الإعلام إطلاق 12 شركة ناشئة ناجحة في السنة</a></li>
<li><a href="../ar443370/index.html">ربط Google reCAPTCHA بـ Vue والتحقق من صحة الاستجابة على الخادم</a></li>
<li><a href="../ar443372/index.html">الخلفية على CodeFest. الشجاعة أمرت؟</a></li>
<li><a href="../ar443376/index.html">تمكنت من العثور على العشرات من مخازن شركات Box.com التي تكشف عن بيانات من Apple و Herbalife ، إلخ.</a></li>
<li><a href="../ar443378/index.html">نكتب عميل http عالي الأداء يستخدم fasthttp كمثال. ألكساندر فاليكالين (VertaMedia)</a></li>
<li><a href="../ar443380/index.html">UDB. ما هذا؟ الجزء 6. الحالة والتحكم وحدة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>