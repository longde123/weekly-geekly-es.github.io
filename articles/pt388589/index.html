<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèæ üë©üèæ‚Äçüç≥ ‚õ≤Ô∏è Outro sistema de rega autom√°tica da planta usando ESP8266 e Blynk üë©‚Äç‚ù§Ô∏è‚Äçüë© üõ¥ üîç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Certa vez, quando eu estava relaxando com os amigos em um campo de estudantes no MEPhI, um deles me disse que ele havia decidido recentemente tentar p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Outro sistema de rega autom√°tica da planta usando ESP8266 e Blynk</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388589/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certa vez, quando eu estava relaxando com os amigos em um campo de estudantes no MEPhI, um deles me disse que ele havia decidido recentemente tentar plantar morangos em um terreno. Comprei panelas, desenterrei um pouco de terra em algum lugar e trouxe mangueiras para rega. E tudo ficaria bem, o propriet√°rio est√° dormindo - os morangos est√£o crescendo, mas eles s√≥ precisam ir ao pa√≠s de forma est√°vel uma vez por semana ou mais frequentemente, para que as plantas n√£o sequem sem √°gua. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembrando de um par de Arduino deitado em uma c√¥moda, bem como um desejo de longa data de realizar algo mais do que apenas LEDs piscantes, decidi imediatamente assumir essa tarefa e fazer esse tempo, se poss√≠vel, at√© o fim.</font></font><br>
<br>
<img src="https://habrastorage.org/files/ffc/8b7/deb/ffc8b7deb2ff4ca893b5493546e9f826.jpg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como interface de gerenciamento do sistema, foi decidido fornecer controle manual ‚Äúa partir do bot√£o‚Äù, al√©m de implementar o controle remoto via Internet. O Arduino Mega foi escolhido como o controlador principal, j√° que um escudo com uma tela LCD e bot√µes √© facilmente conectado a ele, e tamb√©m possui mem√≥ria e GPIO suficientes para esta tarefa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema geral do sistema: </font></font><br>
<br>
<img src="https://habrastorage.org/files/805/b74/a51/805b74a51ab54684af02c5961b3dfff3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para interagir com a rede global, a placa-m√£e ESP8266, ganhando popularidade ativamente, foi escolhida. A escolha de um protocolo de transfer√™ncia de dados sem fio se deve, al√©m do baixo custo do m√≥dulo Wi-Fi, √† presen√ßa de um roteador Wi-Fi constantemente na dacha do cliente, o que evita a conex√£o com fio dentro de casa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar do ESP8266 ter aparecido no horizonte da comunidade DIY recentemente, um recurso de desenvolvedores deste chip j√° est√° se desenvolvendo ativamente no RuNet, onde voc√™ sempre pode procurar a resposta para sua pergunta, encontrar um exemplo de conex√£o de uma placa ESP espec√≠fica ou pedir ajuda com um problema.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estimativa do projeto</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para monitorar a umidade atual do solo, foi solicitado um sensor padr√£o com o Ebay. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para exibir e inserir informa√ß√µes, decidiu-se usar o escudo do teclado LCD, que √© um m√≥dulo eletr√¥nico com uma tela LCD e 6 bot√µes conectados a uma entrada anal√≥gica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dispositivo de controle do abastecimento de √°gua, foi escolhida uma torneira mecanizada de 12 volts com 2 fios, cuja abertura e fechamento √© realizada alterando os sinais da tens√£o fornecida. Portanto, al√©m da deriva√ß√£o, foi solicitado um m√≥dulo de rel√© de 4 canais (dois rel√©s alteram a polaridade fornecida, um √© respons√°vel pelo fornecimento de tens√£o e mais um √© deixado na reserva). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o ESP8266 no Ebay, a vers√£o mais simples foi encomendada - ESP-01. O principal √© lembrar que o ESP8266 √© alimentado exclusivamente a partir de 3,3 V, que deve ser tratado com anteced√™ncia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lista de equipamentos necess√°rios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guindaste motorizado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino mega</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo WiFi (ESP8266)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rel√© de 4 canais</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensores de umidade do solo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visor LCD com bot√µes</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Custo total (excluindo o custo de tudo o que √© necess√°rio para solda, montagem e fonte de alimenta√ß√£o): $ 61,01. </font><font style="vertical-align: inherit;">A principal contribui√ß√£o para o custo final do meu sistema foi feita por um guindaste motorizado (US $ 23,32) e um funcion√°rio do Arduino Mega 2560 (US $ 26,80).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funcionalidade do sistema</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de um pouco de reflex√£o, decidi que o sistema de rega autom√°tica deveria funcionar nos tr√™s modos a seguir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manual ("do bot√£o"). </font><font style="vertical-align: inherit;">Nesse modo, o usu√°rio decide o hor√°rio de in√≠cio da irriga√ß√£o com base nas informa√ß√µes fornecidas a ele pelo sensor de umidade do solo ou com base na experi√™ncia pessoal;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo agendado. </font><font style="vertical-align: inherit;">O usu√°rio define apenas os par√¢metros de irriga√ß√£o de acordo com o cronograma (frequ√™ncia, dura√ß√£o), ap√≥s o qual o pr√≥prio sistema irriga de acordo com as configura√ß√µes selecionadas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo sensor. </font><font style="vertical-align: inherit;">A rega √© realizada automaticamente quando um limite de umidade predeterminado √© atingido. </font><font style="vertical-align: inherit;">O usu√°rio s√≥ precisa definir o valor limite de umidade e a dura√ß√£o da rega;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remoto (do smartphone ou computador). </font><font style="vertical-align: inherit;">Inclui a capacidade de controlar remotamente o sistema usando a l√≥gica de qualquer um dos tr√™s modos listados acima.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â dif√≠cil imaginar a implementa√ß√£o de tal funcionalidade sem o menu mais simples, cuja navega√ß√£o ser√° realizada usando os bot√µes de blindagem do teclado LCD. </font><font style="vertical-align: inherit;">Voc√™ pode ler sobre a implementa√ß√£o do menu no Arduino, por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blynk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pensando na implementa√ß√£o do controle remoto da irriga√ß√£o, deparei-me com um projeto interessante de Blynk, cuja arrecada√ß√£o de fundos foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lan√ßada no Kickstarter em 16 de janeiro de 2015</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por um m√™s, o projeto levantou US $ 49.235 em vez de US $ 10.000, o que, aparentemente, reflete o enorme interesse em tais projetos pela comunidade global de geeks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal objetivo do Blynk √© criar uma plataforma acess√≠vel para controle sem fio de dispositivos eletr√¥nicos caseiros a partir de um smartphone. Conforme planejado pelos autores, o acesso √† Internet n√£o √© um pr√©-requisito - o Blynk Server pode ser baixado e implantado em sua rede dom√©stica, tendo recebido total autonomia em sua casa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lista completa de plataformas suportadas (entre as quais, √© claro, Arduino, Raspberry PI e Intel Edison), para as quais o Blynk deve ser portado, est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esquematicamente, o princ√≠pio de opera√ß√£o do Blynk √© apresentado na figura a seguir: </font></font><br>
<br>
<img src="https://habrastorage.org/files/1f9/7ac/ca3/1f97acca361d4f4ea4f48a78ac433937.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na lista de recursos de interface do programa para um smartphone para controlar um dispositivo remoto e exibir as informa√ß√µes recebidas dele, uma grande variedade de elementos ("widgets") √© anunciada. </font><font style="vertical-align: inherit;">Destacamos os principais:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bot√µes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sliders</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joysticks monoaxiais e biaxiais;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciamento usando girosc√≥pio e aceler√¥metros telef√¥nicos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°rios tipos de bot√µes de controle;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°ficos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indicadores de seta;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notifica√ß√µes pop-up.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma lista completa de itens pode ser encontrada na p√°gina do projeto Blynk no Kickstarter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se notar que o projeto est√° em um est√°gio ativo de desenvolvimento; portanto, nem todas as fun√ß√µes declaradas pelos desenvolvedores foram implementadas at√© o momento. </font><font style="vertical-align: inherit;">No entanto, segundo eles, isso √© apenas uma quest√£o de tempo. </font><font style="vertical-align: inherit;">A funcionalidade dispon√≠vel para o nosso projeto ser√° suficiente.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√£o t√©cnica</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama esquem√°tico do dispositivo: </font></font><br>
<br>
<img src="https://habrastorage.org/files/4d4/1b7/3f8/4d41b73f802341d7aecc2dd74067e2fc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto no diagrama apresentado, a troca de informa√ß√µes entre o Arduino e o ESP8266 ser√° realizada atrav√©s do UART. </font><font style="vertical-align: inherit;">Para n√£o ter problemas ao piscar o controlador, conectamos o m√≥dulo Wi-Fi aos contatos D2, D3, organizando um UART (Serial3) de hardware nessas pernas e ajustando a velocidade para 11520 baud.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um leitor atento deve ter uma pergunta l√≥gica - como o Arduino alimentado pela l√≥gica de 5 volts e o ESP8266 de 3,3 volts se comunicar√°? </font><font style="vertical-align: inherit;">Tendo estudado essa quest√£o na Internet, cheguei √† conclus√£o de que a maioria n√£o atribui absolutamente import√¢ncia a esse problema (como se viu mais tarde - n√£o em v√£o), conectando diretamente as pernas correspondentes dessas duas pranchas. </font><font style="vertical-align: inherit;">Apenas alguns artigos sugeriram o uso do divisor de tens√£o mais simples ou de conversores especialmente projetados. </font><font style="vertical-align: inherit;">Naturalmente, eu n√£o tinha um conversor, ent√£o, inicialmente, foi feita uma tentativa de implementar a comunica√ß√£o usando um divisor, mas n√£o resultou em nenhum resultado. Entrei no conjunto de pessoas acima mencionado, fechando meus olhos para o problema descrito (o benef√≠cio funcionou sem a coordena√ß√£o dos n√≠veis l√≥gicos) .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas palavras sobre o poder do ESP8266</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° mencionado em muitos tutoriais, para a opera√ß√£o normal do ESP, voc√™ precisa de uma fonte de alimenta√ß√£o est√°vel na faixa de 3,0 a 3,6 volts. </font><font style="vertical-align: inherit;">Para fazer isso, voc√™ pode usar v√°rios conversores lineares, por exemplo, o popular hoje AMS1117 3.3. </font><font style="vertical-align: inherit;">A </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folha de dados do AMS1117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indica que a tens√£o de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">entrada</font></a><font style="vertical-align: inherit;"> pode atingir 15 V. No entanto, para opera√ß√£o est√°vel no modo de corrente de sa√≠da de cerca de 1 A, recomenda-se diminuir a tens√£o de entrada (na pr√°tica, 5-6 V √© suficiente). </font><font style="vertical-align: inherit;">Pela minha pr√≥pria experi√™ncia, direi que quando o conversor √© conectado a uma fonte de 12 V, o AMS come√ßa a aquecer ativamente, o que rapidamente leva a uma diminui√ß√£o na tens√£o de sa√≠da e, como resultado, a uma reinicializa√ß√£o do ESP8266.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar ESP8266</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A intera√ß√£o do Arduino e do ESP8266 ao usar o Blynk pode ser implementada de duas maneiras diferentes:</font></font><br>
<br>
<ul>
<li> ¬´¬ª  ESP8266 AT-,      Arduino (..  ¬´ESP8266 as shield¬ª);</li>
<li>  ESP   Arduino IDE    Blynk,      ,    ,  Arduino      ,      /  (..  ¬´ESP8266 as standalone¬ª).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambas as op√ß√µes t√™m seus pr√≥s e contras, mas a primeira op√ß√£o √© mais conveniente porque n√£o h√° necessidade de trabalhar com dois programas e monitorar constantemente a compatibilidade dos dois dispositivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar o uso do Blynk, voc√™ deve poder fazer o upload do firmware desejado para o ESP8266. No nosso caso, a vers√£o do firmware AT </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v0.22 SDK v1.0.0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° usada </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para atualizar as placas ESP8266, voc√™ precisa de um conversor USB-TTL (por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), no entanto, tamb√©m pode usar o Arduino fechando as pernas RST e GND e conectando o m√≥dulo Wi-Fi RX √† perna Arduino RX, semelhante a TX e TX. Em seguida, coloque o ESP8266 no modo intermitente (para fazer isso, feche a sa√≠da GPIO0 ao terra) e, usando o utilit√°rio XTCom Util, preencha o firmware, conforme descrito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Resta apenas aumentar a velocidade do UART para 115200 baud com o comando AT AT + UART_DEF = 115200,8,1,0,0, ap√≥s o qual a configura√ß√£o do m√≥dulo Wi-Fi ser√° conclu√≠da.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esbo√ßo para Arduino</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A biblioteca principal para trabalhar com o Blynk no IDE do Arduino √© a biblioteca BlynkSimpleEsp8266.h. Considere suas principais fun√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Blynk.begin (auth, "ssid", "pass") </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ deve ter adivinhado, a fun√ß√£o recebe os par√¢metros para conectar-se a um ponto Wi-Fi - seu SSID e senha, bem como o token de autentica√ß√£o do nosso dispositivo para conectar-se ao servidor Blynk. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importante!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O processo de conex√£o com o servidor Blynk √© iniciado somente depois que qualquer uma das seguintes fun√ß√µes √© chamada no programa pela primeira vez: Blynk.run () ou Blynk.connect ().</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para desconectar / conectar-se ao servidor Blynk, as fun√ß√µes Blynk.disconnect () e Blynk.connect () s√£o usadas, retornando o resultado em um tipo booleano. Para estabelecer uma conex√£o (tempo limite em segundos), Blynk.connect (s) √© usado (por padr√£o, o tempo limite √© definido como 30 s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Blynk.run () </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal fun√ß√£o para sincronizar o dispositivo com o servidor Blynk e receber comandos do smartphone. Comumente usado em um loop. Al√©m disso, esta fun√ß√£o permite controlar as entradas e sa√≠das da placa ESP (no modo ‚ÄúIndependente‚Äù) sem usar fun√ß√µes como digitalRead, digitalWrite, analogWrite, analogRead, analogWrite em qualquer lugar do c√≥digo. Basta adicionar os elementos necess√°rios √† tela de controle do aplicativo no smartphone e correlacion√°-los com o GPIO ESP8266 necess√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Trabalhando com contatos virtuais ("pinos virtuais")</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos recursos do Blynk √© o uso de contatos virtuais. Este termo refere-se a um canal l√≥gico para transmitir v√°rias informa√ß√µes entre um aplicativo m√≥vel e um dispositivo, sejam vari√°veis ‚Äã‚Äãbooleanas, valores num√©ricos (n√∫mero inteiro ou longo) ou dados de texto como uma sequ√™ncia. Os contatos virtuais n√£o t√™m uma conex√£o direta com os terminais do dispositivo e s√£o usados ‚Äã‚Äãprincipalmente para intera√ß√£o com as bibliotecas de m√≥dulos perif√©ricos (LCDs, servos, etc.) ou uma interface de aplicativo m√≥vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No c√≥digo de esbo√ßo, o processamento da chamada para o contato virtual com o n√∫mero n ocorre usando os blocos BLYNK_READ (Vn) {...} e BLYNK_WRITE (Vn) {...}. </font><font style="vertical-align: inherit;">Dentro dos colchetes, √© indicado o c√≥digo de processamento para acessar o contato virtual. </font><font style="vertical-align: inherit;">Por exemplo, se o widget de aplicativo solicitar que o valor da umidade do solo para a exibi√ß√£o virtual n ¬∞ 2 seja exibido como gr√°fico, precisamos escrever algo assim no esbo√ßo:</font></font><br>
<br>
<pre><code class="cpp hljs">BLYNK_READ(V2)<font></font>
{<font></font>
<span class="hljs-comment"><span class="hljs-comment">//     ,    humidity:</span></span>
  Blynk.virtualWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, humidity);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da mesma forma, voc√™ pode considerar o par√¢metro enviado, por exemplo, pelo contato virtual n¬∫ 9 do usu√°rio do aplicativo Blynk:</font></font><br>
<br>
<pre><code class="cpp hljs">BLYNK_WRITE(V9)<font></font>
{<font></font>
<span class="hljs-comment"><span class="hljs-comment">//      x:</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = param.asInt();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso usa a convers√£o da vari√°vel de entrada em um valor inteiro usando param.asInt (). Convers√µes param.asStr () e param.asDouble () tamb√©m s√£o permitidas. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importante!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Os procedimentos BLYNK_READ / BLYNK_WRITE devem ser executados o mais r√°pido poss√≠vel, para que o dispositivo possa processar todas as solicita√ß√µes do aplicativo. Portanto, √© altamente desencorajado o uso das fun√ß√µes sllep / delay dentro dessas rotinas.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Informa√ß√µes mais detalhadas sobre a funcionalidade Blynk podem ser encontradas na p√°gina github do desenvolvedor na pasta de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou na p√°gina de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, armados com o conhecimento, vamos retornar ao autowatering e escrever um esbo√ßo. Forneceremos as seguintes possibilidades para o aplicativo m√≥vel interagir com o sistema:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A escolha do modo de opera√ß√£o do sistema: manual, por sensor, por programa√ß√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibi√ß√£o da umidade do solo recebida do sistema e sa√≠da de dados hist√≥ricos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Troca de informa√ß√µes atrav√©s do elemento de aplica√ß√£o do terminal.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentei comentar cada peda√ßo de c√≥digo respons√°vel por uma fun√ß√£o espec√≠fica do sistema, para que n√£o nos debru√ßemos sobre o c√≥digo do programa em detalhes. </font><font style="vertical-align: inherit;">Observo apenas que, para facilitar o uso, todas as configura√ß√µes feitas pelo usu√°rio s√£o gravadas na mem√≥ria n√£o vol√°til do Arduino (EEPROM). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Sketch pode ser baixado no GitHub.</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando o aplicativo m√≥vel Blynk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫ltimo passo √© deixado - configurando o aplicativo m√≥vel. </font><font style="vertical-align: inherit;">No meu caso, os seguintes elementos ser√£o usados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 indicadores LED (pinos virtuais 1, 29, 30, 31);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 bot√µes (pinos virtuais 2, 3);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminal para troca de informa√ß√µes (Virtual Pin 4);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indicador num√©rico ‚ÄúValue Display‚Äù (pino virtual 8);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°fico com a capacidade de exibir dados hist√≥ricos ‚ÄúHistory Graph‚Äù (Virtual Pin 8);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Widget para ativar o trabalho com correio ("Email");</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um widget para ativar as notifica√ß√µes pop-up ("Push").</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de instalar o aplicativo m√≥vel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blynk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">voc√™</font></a><font style="vertical-align: inherit;"> precisa registrar e selecionar o dispositivo que deseja gerenciar (no nosso caso, √© o ESP8266). </font><font style="vertical-align: inherit;">Al√©m disso, para n√£o perder, enviamos para n√≥s um token de autentica√ß√£o exclusivo, usado no esbo√ßo para autentica√ß√£o nos servidores Blynk. </font><font style="vertical-align: inherit;">Abaixo est√£o as capturas de tela que ilustram a configura√ß√£o do aplicativo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie um novo projeto</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/281/a53/aa0/281a53aa0ca146e881c9cc3f1dd7feea.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na janela aberta do projeto criado, no canto superior direito, existem 3 bot√µes: configura√ß√µes globais do projeto, adicionando elementos (widgets) ao formul√°rio e iniciando:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formul√°rio vazio para novo projeto</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/fc7/abf/40c/fc7abf40ca904aaeaff940c7f253c728.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta adicionar controles ao formul√°rio de aplica√ß√£o e configur√°-los. </font><font style="vertical-align: inherit;">Alguns dos widgets dispon√≠veis no momento da reda√ß√£o s√£o apresentados abaixo:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de widgets a serem adicionados ao formul√°rio de inscri√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/e43/d27/9bd/e43d279bd969493e8db442636f980fe3.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar a opera√ß√£o do sistema, adicione 2 bot√µes ao formul√°rio: um ser√° respons√°vel por escolher o modo de opera√ß√£o, o segundo - por iniciar a irriga√ß√£o no modo manual. </font><font style="vertical-align: inherit;">O status atual do sistema ser√° estabelecido usando quatro indicadores LED. </font><font style="vertical-align: inherit;">Um indicador acende durante a irriga√ß√£o, os outros tr√™s s√£o necess√°rios para exibir o modo atual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta escolher as cores dos elementos, adicionar legendas e vincul√°-las aos contatos virtuais desejados.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando bot√µes e indicadores LED</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/d0d/356/6bc/d0d3566bc8f74bdc9e9314c71443770e.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para exibir a din√¢mica da umidade do solo, adicione ao formul√°rio um gr√°fico com a capacidade de exibir dados hist√≥ricos ("Gr√°fico Hist√≥rico"). </font><font style="vertical-align: inherit;">Exibiremos o valor atual da umidade no display digital ("Display de valor").</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar gr√°fico de hist√≥rico e elementos de exibi√ß√£o de valor</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/290/032/d00/290032d009594489a490e7ad79ef16c3.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para facilitar a configura√ß√£o remota dos par√¢metros do sistema, al√©m de obter informa√ß√µes mais completas sobre o estado atual, adicionamos um terminal ao aplicativo. </font><font style="vertical-align: inherit;">E para receber notifica√ß√µes por email e telefone, voc√™ tamb√©m deve colocar os elementos "Push" e "Email" no formul√°rio.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar terminal, push e email</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/e51/925/ced/e51925ced41e406298873c57bb1ef698.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta colocar no formul√°rio todos os widgets descritos acima e teremos algo assim:</font></font><br>
<br>
<img src="https://habrastorage.org/files/644/2ce/b5c/6442ceb5c4d04b8fb99632e68e2aa374.jpg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√£o algumas fotos do sistema no estado atual e um v√≠deo do trabalho de autowatering e Blynk. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Farei uma reserva imediatamente de que n√£o conectei uma torneira mecanizada no apartamento e forne√ßo √°gua ao vaso de flores, e n√£o h√° necessidade urgente - no momento do teste do sistema, o processo de rega (quando a torneira √© aberta) √© emulado com √™xito por minha esposa e um regador comum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foto n¬∫ 1: </font></font><br>
<br>
<img src="https://habrastorage.org/files/130/39f/64b/13039f64bd264d478120610771310cf0.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foto n¬∫ 2: </font></font><br>
<br>
<img src="https://habrastorage.org/files/cde/fe9/15a/cdefe915aad142d4a2468d15eff9b6ad.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√≠deo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/wSNd7GkT-Wc%3Ffeature%3Doembed&amp;usg=ALkJrhhi_DvXb1zrFheJ3QinJVvs1CQ5rQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de uma conclus√£o</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resumindo a cria√ß√£o de um sistema de rega autom√°tico usando o Blynk, podemos dizer o seguinte: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Por si s√≥, o servi√ßo Blynk √© uma ferramenta muito conveniente e f√°cil de aprender que, gra√ßas √† abund√¢ncia de placas e dispositivos suportados, pode ser facilmente integrada a praticamente qualquer dispositivo. Juntamente com o baixo pre√ßo do m√≥dulo Wi-Fi ESP8266, essas vantagens permitem adicionar controle remoto a um projeto espec√≠fico com o m√≠nimo de esfor√ßo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As desvantagens de usar essa solu√ß√£o, √© claro, s√£o menos flexibilidade na personaliza√ß√£o do sistema e depend√™ncia dos desenvolvedores de aplicativos, o que, no entanto, n√£o reduz seus m√©ritos quando usado em pequenos projetos de bricolage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. As duas principais desvantagens da implementa√ß√£o acima do sistema de irriga√ß√£o autom√°tica s√£o o custo e a baixa qualidade do sensor de umidade do solo utilizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira desvantagem √© causada, como mencionado acima, pelo alto custo da torneira eletromagn√©tica e do painel oficial do Arduino Mega. No entanto, pode ser reduzido significativamente usando, por exemplo, an√°logos do Arduino ou implementando toda a parte eletr√¥nica em outro MK adequado. Infelizmente, o guindaste n√£o foi encontrado muito mais barato, e esse n√£o era meu objetivo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto ao sensor de umidade, para aumentar sua vida √∫til e reduzir os produtos de eletr√≥lise entre seus contatos, primeiro √© necess√°rio aplicar tens√£o apenas imediatamente antes de medir a umidade (que √© implementada no meu sistema) e, segundo, √© melhor substituir seja em hastes de grafite ou use contatos de a√ßo inoxid√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um futuro pr√≥ximo, est√° planejado montar a parte eletr√¥nica e coloc√°-la em algum pr√©dio decente e, espero, finalmente instalar tudo no pa√≠s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado pela aten√ß√£o!</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt388589/">https://habr.com/ru/post/pt388589/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt388579/index.html">DEXP Ursus KX210i - Tablet Windows 10 Transformer com processador Intel¬Æ Atom ‚Ñ¢</a></li>
<li><a href="../pt388581/index.html">Como fiz um snowblower 3.0 com controle Bluetooth a partir de um smartphone Android</a></li>
<li><a href="../pt388583/index.html">Decreto sobre a aboli√ß√£o da Ag√™ncia Espacial Federal assinado</a></li>
<li><a href="../pt388585/index.html">Evolu√ß√£o da m√≠dia de armazenamento Parte 3: Discos r√≠gidos</a></li>
<li><a href="../pt388587/index.html">Impressora Dotwork barata caseira</a></li>
<li><a href="../pt388591/index.html">A Mozilla est√° pensando em lan√ßar dispositivos no Firefox OS, em vez de um smartphone recentemente falecido</a></li>
<li><a href="../pt388593/index.html">A Netflix descobriu como fazer as crian√ßas irem dormir cedo na v√©spera de Ano Novo</a></li>
<li><a href="../pt388595/index.html">Controlador de luvas com gera√ß√£o de energia independente para o trabalho</a></li>
<li><a href="../pt388601/index.html">Os eventos mais significativos na explora√ß√£o espacial do ano</a></li>
<li><a href="../pt388603/index.html">O que √© rob√≥tica educacional? A opini√£o de especialistas da Comiss√£o do Conselho da Federa√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>