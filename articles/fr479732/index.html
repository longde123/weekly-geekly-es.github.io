<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèæ ‚öñÔ∏è üë®‚Äçüëß‚Äçüëß Arr√™tez d'√©mettre autre chose comme une fuite de m√©moire üî† ‚ÜòÔ∏è üìÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä ce jour, de nombreux articles ont √©t√© √©crits sur la n√©cessit√© de se d√©sabonner des abonnements Observable RxJS, sinon une fuite de m√©moire se produi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arr√™tez d'√©mettre autre chose comme une fuite de m√©moire</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479732/"><p> √Ä ce jour, de <a href="https://medium.com/alexonozor/angular-rxjs-please-always-unsubscribe-86ca55ba7f12" rel="nofollow">nombreux</a> <a href="https://habr.com/ru/post/351338/">articles</a> ont √©t√© √©crits sur la <a href="https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f" rel="nofollow">n√©cessit√© de se d√©sabonner</a> des abonnements Observable RxJS, sinon <strong>une fuite de m√©moire</strong> se produira.  Pour la plupart des lecteurs de tels articles, la r√®gle ferme ¬´sign√©? - signez!¬ª √âtait √©tablie dans ma t√™te.  Mais, malheureusement, souvent dans ces articles, les informations sont d√©form√©es ou quelque chose n'est pas n√©goci√©, et pire encore lorsque les concepts sont remplac√©s.  Nous en parlerons. </p><br><p><img src="https://habrastorage.org/webt/oa/f5/pf/oaf5pfujlesdzjavtjopl6z4_gi.jpeg"></p><a name="habracut"></a><br><p>  Prenons par exemple cet article: <a href="https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f" rel="nofollow">https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f</a> </p><br><p><img src="https://habrastorage.org/webt/n2/av/hm/n2avhmxwuemrtc0tvv7noyhl2za.png"></p><br><p>  Quand ils me parlent de ¬´ <strong>l'</strong> opportunit√© <strong>potentielle</strong> d'obtenir une r√©gression des performances¬ª, je pense tout de suite √† <a href="http://optimization.guide/" rel="nofollow">une optimisation pr√©matur√©e</a> . </p><br><p><img src="https://habrastorage.org/webt/on/__/rg/on__rgsm7admmp7p1u9t2gok4mu.png"></p><br><p><img src="https://habrastorage.org/webt/hw/rz/rw/hwrzrwkwlzlxmdhi3d2uusuj7sa.png"></p><br><p>  Nous continuons √† lire l'article de l'homme sous le surnom de <strong>Reactive Fox</strong> : <br><img src="https://habrastorage.org/webt/fn/6j/qn/fn6jqnrypjv7e1zo_v9kg43jkv4.png"></p><br><p><img src="https://habrastorage.org/webt/ue/w2/mg/uew2mga3qjig9rint74jn7i0q0q.png"></p><br><p>  De plus, il contient des informations et des conseils utiles.  Je suis d'accord que vous devez toujours vous d√©sabonner <strong>des flux sans fin dans RxJS</strong> .  Mais je me concentre uniquement sur les informations nuisibles (√† mon avis). <br><img src="https://habrastorage.org/webt/e1/ep/rz/e1eprzkk7depkecysfapwnlmhkc.png"></p><br><p>  Wow ... rattrap√© l'horreur.  Une telle intimidation sans fondement (pas de m√©triques, de chiffres ...) √† l'heure actuelle a conduit au fait que pour un tr√®s grand nombre de front-end, l'absence de d√©sinscription est comme un chiffon rouge pour un taureau.  Quand ils tombent dessus, ils ne voient plus rien d'autre que ce chiffon. <br><img src="https://habrastorage.org/webt/1i/-o/c_/1i-oc_a48-jwxjp7xyfgofkajpe.jpeg"></p><br><p>  L'auteur de l'article a m√™me fait une demande de d√©monstration, o√π il a essay√© de prouver ses pens√©es: <br>  <a href="https://stackblitz.com/edit/why-you-have-to-unsubscribe-from-observable-material" rel="nofollow">https://stackblitz.com/edit/why-you-have-to-unsubscribe-from-observable-material</a> </p><br><p>  En effet, sur son stand, vous pouvez voir comment le processeur fait un travail inutile (quand je ne clique sur rien) et comment la consommation de m√©moire augmente (un petit changement): </p><br><p> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/lm/4r/p_/lm4rp_3sl0zqb11rf5dsufwdole.png"></a> </p><br><p>  Pour confirmer le fait que vous devez <strong>toujours</strong> vous d√©sabonner des abonnements <strong>aux</strong> requ√™tes <strong>HttpClient</strong> observables, il a ajout√© un intercepteur de requ√™te qui affiche "toujours vivant ... toujours vivant ... toujours vivant ..." dans la console: <br><img src="https://habrastorage.org/webt/cs/m-/tz/csm-tzst2fx6prkarqwx_dfc_k4.png"><br>  C'est-√†-dire  la personne a intercept√© le flux final, l'a rendu <strong>infini</strong> (en cas d'erreur, la demande est r√©p√©t√©e, mais l'erreur se produit toujours) et donne cela comme preuve que vous devez vous d√©sinscrire des flux finaux. </p><br><p>  <strong>StackBlitz n'est</strong> pas tr√®s appropri√© pour mesurer les performances d'une application,  il y a une synchronisation automatique pendant la mise √† niveau et elle prend des ressources.  J'ai donc fait ma demande de test: <a href="https://github.com/andchir/test-angular-app" rel="nofollow">https://github.com/andchir/test-angular-app</a> </p><br><p>  Il y a deux fen√™tres l√†-bas.  Lorsque vous ouvrez chacun, une demande est envoy√©e √† <strong>action.php</strong> , dans laquelle il y a un d√©lai de 3 secondes comme une imitation d'une op√©ration tr√®s gourmande en ressources.  <strong>Action.php</strong> enregistre √©galement toutes les demandes dans le fichier <strong>log.txt</strong> . </p><br><div class="spoiler">  <b class="spoiler_title">Code Action.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> header(<span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logging</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($str, $fileName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'log.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($str)) { $str = json_encode($str); } $rootPath = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>; $logFilePath = $rootPath . DIRECTORY_SEPARATOR . $fileName; $options = [ <span class="hljs-string"><span class="hljs-string">'max_log_size'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">200</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_dir(dirname($logFilePath))) { mkdir(dirname($logFilePath)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($logFilePath) &amp;&amp; filesize($logFilePath) &gt;= $options[<span class="hljs-string"><span class="hljs-string">'max_log_size'</span></span>]) { unlink($logFilePath); } $fp = fopen( $logFilePath, <span class="hljs-string"><span class="hljs-string">'a'</span></span> ); $dateFormat = <span class="hljs-string"><span class="hljs-string">'d/m/YH:i:s'</span></span>; $str = PHP_EOL . PHP_EOL . date($dateFormat) . PHP_EOL . $str; fwrite( $fp, $str ); fclose( $fp ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } $actionName = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) &amp;&amp; !is_array($_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) ? $_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>] : <span class="hljs-string"><span class="hljs-string">'1'</span></span>; logging(<span class="hljs-string"><span class="hljs-string">"STARTED-{$actionName}"</span></span>); sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>);<span class="hljs-comment"><span class="hljs-comment">// Very resource-intensive operation that takes 3 seconds logging("COMPLETED-{$actionName}"); echo json_encode([ 'success' =&gt; true, 'data' =&gt; ['name' =&gt; 'test', 'title' =&gt; 'This is a test'] ]);</span></span></code> </pre> </div></div><br><p>  Mais d'abord, une petite digression.  Dans l'image ci-dessous (cliquable), vous pouvez voir un exemple simple du fonctionnement du ramasse-miettes JavaScript dans le navigateur Chrome.  PUSH s'est produit, mais setTimeout n'a pas emp√™ch√© le garbage collector de vider la m√©moire. <br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/ly/r0/1w/lyr01wmysa9pphmphoj8aa39aaq.png"></a> </p><br><p>  N'oubliez pas d'appeler le ramasse-miettes en appuyant sur un bouton lorsque vous exp√©rimentez. <br><img src="https://habrastorage.org/webt/ir/k4/j4/irk4j4izd09-npb06n2zysccpum.png"></p><br><p>  Revenons √† mon application de test.  Voici le code pour les deux fen√™tres: </p><br><div class="spoiler">  <b class="spoiler_title">Code BadModalComponent</b> <div class="spoiler_text"><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-bad-modal'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./bad-modal.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./bad-modal.component.css'</span></span>], <span class="hljs-attr"><span class="hljs-attr">providers</span></span>: [HttpClient] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BadModalComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-class"> </span></span>{ loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; largeData: number[] = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000000</span></span></span></span></span><span class="hljs-function">)).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destroyed$</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Subject</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> private http: HttpClient, private bsModalRef: BsModalRef </span></span></span><span class="hljs-function">) { } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ngOnInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> { // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">For</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">example</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">only</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">not</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">production</span></span></span><span class="hljs-function">. </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loading</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subscription</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">http</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'/action.php?a=2'</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> takeUntil(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.destroyed$</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">catchError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err</span></span></span><span class="hljs-function">) =&gt;</span></span> throwError(err.message)), finalize(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'FINALIZE'</span></span>)) ) .subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'LOADED'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = res; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error); }, <span class="hljs-attr"><span class="hljs-attr">complete</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'COMPLETED'</span></span>); } }); } close(event?: MouseEvent): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event) { event.preventDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bsModalRef.hide(); } ngOnDestroy() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'DESTROY'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroyed$.next(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroyed$.complete(); } }</code> </pre> </div></div><br><p>  Comme vous pouvez le voir, il y a un d√©sabonnement (takeUntil).  Tout comme le "professeur" nous l'a conseill√©.  Il existe √©galement un large √©ventail. </p><br><div class="spoiler">  <b class="spoiler_title">GoodModalComponent Code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-good-modal'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./good-modal.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./good-modal.component.css'</span></span>] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoodModalComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-class"> </span></span>{ loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; largeData: number[] = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000000</span></span></span></span></span><span class="hljs-function">)).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> private http: HttpClient, private bsModalRef: BsModalRef </span></span></span><span class="hljs-function">) { } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ngOnInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> { // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">For</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">example</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">only</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">not</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">production</span></span></span><span class="hljs-function">. </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loading</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subscription</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">http</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'/action.php?a=1'</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> catchError((err</span></span></span><span class="hljs-function">) =&gt;</span></span> throwError(err.message)), finalize(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'FINALIZE'</span></span>)) ) .subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'LOADED'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = res; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error); }, <span class="hljs-attr"><span class="hljs-attr">complete</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'COMPLETED'</span></span>); } }); } close(event?: MouseEvent): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event) { event.preventDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bsModalRef.hide(); } ngOnDestroy() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'DESTROY'</span></span>); } }</code> </pre> </div></div><br><p>  Il y a exactement la m√™me propri√©t√© avec un grand tableau, mais il n'y a pas de d√©sabonnement.  Et cela ne m'emp√™che pas d'appeler cette fen√™tre une bonne.  Pourquoi - plus tard. </p><br><p>  Regardez la vid√©o: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jQ5qLosbnOY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Comme vous pouvez le voir, dans les deux cas, apr√®s √™tre pass√© au deuxi√®me composant, le garbage collector a r√©ussi √† ramener la m√©moire √† des valeurs normales.  Oui, on pourrait permettre de vider la m√©moire √©galement apr√®s la fermeture des fen√™tres, mais dans notre exp√©rience ce n'est pas important.  Il s'av√®re que le "professeur" avait tort quand il a dit: </p><br><blockquote>  Par exemple, vous avez fait une demande, mais lorsque la r√©ponse n'est pas encore arriv√©e du backend, vous d√©truisez le composant comme inutile, <strong>votre abonnement conservera le lien vers le composant</strong> , cr√©ant ainsi une fuite de m√©moire potentielle. </blockquote><p>  Oui, il parle d'une fuite <strong>¬´potentielle¬ª</strong> .  Mais, si le flux est fini, il n'y aura pas de fuite de m√©moire. </p><br><p>  Je pr√©vois les exclamations indign√©es de ces ¬´professeurs¬ª.  Ils vont certainement nous dire quelque chose comme: <em>"ok, il n'y a pas de fuite de m√©moire, mais en vous <strong>d√©sinscrivant,</strong> nous <strong>annulons</strong> √©galement <strong>la demande</strong> , ce qui signifie que nous serons s√ªrs qu'aucun code ne sera plus ex√©cut√© apr√®s avoir re√ßu une r√©ponse du serveur</em> . <em>"</em>  Premi√®rement, je ne dis pas que la d√©sinscription est <strong>toujours</strong> mauvaise, je dis simplement que vous <strong>remplacez les concepts</strong> .  Oui, le fait qu'une fois la r√©ponse arriv√©e, une autre op√©ration inutile sera effectu√©e est mauvais, mais <strong>vous ne pouvez vous prot√©ger contre une v√©ritable fuite de m√©moire qu'en vous d√©sinscrivant</strong> (dans ce cas), et vous pouvez vous prot√©ger contre d' <strong>autres effets ind√©sirables par d'</strong> <strong>autres moyens</strong> .  Pas besoin d'intimider les lecteurs et de leur imposer leur propre style d'√©criture de code. </p><br><p>  Avons-nous toujours besoin d'annuler la demande si l'utilisateur change d'avis?  Pas toujours!  N'oubliez pas que vous annulez la demande, <strong>mais vous n'annulez pas l'op√©ration sur le serveur</strong> .  Imaginez qu'un utilisateur a ouvert un composant, que quelque chose se charge depuis longtemps et qu'il passe √† un autre composant.  Il est possible que le <strong>serveur soit charg√© et ne g√®re pas</strong> toutes les demandes et op√©rations.  Dans ce cas, l'utilisateur peut piquer fr√©n√©tiquement tous les liens dans la navigation et cr√©er une <strong>charge</strong> encore <strong>plus importante sur le serveur</strong> , car <strong>la requ√™te ne s'arr√™te pas c√¥t√© serveur</strong> (dans la plupart des cas). </p><br><p>  Regardez la vid√©o suivante: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uAEka7a5_eA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  J'ai fait attendre l'utilisateur une r√©ponse.  Dans la plupart des cas, la r√©ponse viendra rapidement et l'utilisateur ne rencontrera aucun inconv√©nient.  <strong>Mais de cette fa√ßon, nous √©viterons au serveur d'effectuer des op√©rations lourdes r√©p√©t√©es, le cas √©ch√©ant.</strong> </p><br><p>  R√©sum√©: </p><br><ul><li>  Je ne dis pas que <strong>vous</strong> n'avez pas besoin de vous d√©sabonner des abonnements RxJS des requ√™tes HttpClient.  Je dis simplement qu'il y a des moments o√π cela n'est pas n√©cessaire.  Pas besoin de remplacer les concepts.  Si vous parlez d'une fuite de m√©moire, montrez cette fuite.  Pas votre <strong>console.log</strong> sans fin, √† savoir une fuite.  Dans quoi la m√©moire est-elle mesur√©e?  Quel est le temps de fonctionnement mesur√©?  C'est ce qu'il faut montrer. </li><li>  Je n'appelle pas ma solution, que j'ai appliqu√©e dans l'application de test, une ¬´solution miracle¬ª.  <strong>Au contraire, j'exhorte le soumissionnaire √† donner plus de libert√©.</strong>  Laissez-le d√©cider comment √©crire son code.  Pas besoin de l'intimider et d'imposer son propre style de d√©veloppement. </li><li>  Je suis contre le fanatisme et l'optimisation pr√©matur√©e.  J'en ai trop vu r√©cemment. </li><li>  Le navigateur dispose de m√©thodes plus avanc√©es pour d√©tecter les fuites de m√©moire que celle que j'ai montr√©e.  Je pense que dans mon cas, l'application de cette m√©thode simple est suffisante.  Mais je vous recommande de vous familiariser avec le sujet plus en d√©tail, par exemple, dans cet article: <a href="https://habr.com/ru/post/309318/">https://habr.com/en/post/309318/</a> . </li></ul><br><p>  <strong>UPD # 1</strong> <br>  Pour le moment, le poste s'est affaiss√© pendant presque une journ√©e.  Au d√©but, il s'est tourn√© vers le pour et le contre, puis l'√©valuation s'est arr√™t√©e √† z√©ro.  Cela signifie que le public √©tait divis√© exactement en deux camps.  Je ne sais pas si c'est bon ou mauvais. </p><br><p>  <strong>UPD # 2</strong> <br>  Dans les commentaires, Jet Fox est apparu (l'auteur de l'article analys√©).  Au d√©but, il m'a remerci√©, il √©tait tr√®s poli.  Mais, voyant la passivit√© du public, il a commenc√© √† faire pression.  Il est arriv√© au point o√π il a <a href="https://habr.com/ru/post/479732/">√©crit</a> que je devais m'excuser.  C'est-√†-dire  il a menti (mensonges encadr√©s d'un cadre jaune au-dessus), et je dois m'excuser. <br>  Au d√©but, je pensais que l'intercepteur de flux avec des r√©p√©titions sans fin (enfin, 2-3 r√©p√©titions), qu'il a √©crit dans son application de d√©monstration, est uniquement destin√© aux tests et √† l'information.  Mais il s'est av√©r√© qu'il le <a href="https://habr.com/ru/post/479732/">consid√©rait</a> comme un exemple de la vie.  C'est-√†-dire  bloquer le bouton d'une fen√™tre - <a href="https://habr.com/ru/post/479732/">c'est impossible</a> .  Et pour cr√©er de tels intercepteurs, violant les principes de SOLID, violant la modularit√© de l'application (les modules et les composants doivent √™tre ind√©pendants les uns des autres), laissant les tests unitaires de vos unit√©s (composants, services) √† travers la for√™t - vous pouvez.  Imaginez la situation: vous avez √©crit un composant, √©crit des tests unitaires pour celui-ci.  Et puis un tel Fox appara√Æt, ajoute un intercepteur similaire √† votre application, et vos tests deviennent inutiles.  Puis il vous dit toujours: "Pourquoi n'avez-vous pas pr√©vu que je pourrais vouloir ajouter un tel intercepteur. Eh bien, corrigez votre code."  C'est peut-√™tre une r√©alit√© dans son √©quipe, mais je ne pense pas que cela devrait √™tre encourag√© ou ferm√© les yeux. </p><br><p>  <strong>UPD # 3</strong> <br>  Les commentaires traitent principalement des abonnements et des d√©sabonnements.  Un article intitul√© "Se d√©sabonner du mal"?  Non.  Je ne vous exhorte pas √† ne pas vous d√©sinscrire.  Faites comme avant.  Mais vous devez comprendre pourquoi vous faites cela.  La d√©sinscription n'est pas une optimisation pr√©matur√©e.  Mais, en marchant sur le chemin de la protection contre les menaces potentielles (comme nous appelle l'auteur de l'article analys√©), vous pouvez franchir la ligne.  Ensuite, votre code peut devenir surcharg√© et difficile √† maintenir. <br>  Cet article porte sur le fanatisme, qui conduit √† la diffusion d'informations non v√©rifi√©es.  Dans certains cas, il est n√©cessaire de relier plus calmement l'absence de d√©sinscription (il faut bien comprendre si un probl√®me existe dans un cas particulier). </p><br><p>  <strong>UPD # 4</strong> </p><br><blockquote>  Au contraire, j'exhorte le soumissionnaire √† se voir accorder plus de libert√©.  Laissez-le d√©cider comment √©crire son code. </blockquote><p>  Ici, vous devez clarifier.  Je suis pour les standards.  Mais la norme peut √™tre fix√©e par l'auteur de la biblioth√®que ou son √©quipe, alors que ce n'est pas le cas (dans la documentation et officiellement).  Par exemple, la documentation du framework Symfony a une section <a href="https://symfony.com/doc/current/best_practices.html" rel="nofollow">Meilleures pratiques</a> .  S'il en √©tait de m√™me dans la documentation de RxJS et qu'il disait "d√©sinscription-signature", je n'aurais pas envie de discuter avec lui. </p><br><p>  <strong>UPD # 5</strong> <br>  Commentaire important avec des r√©ponses de personnes r√©put√©es: <br>  <a href="https://habr.com/ru/post/479732/">https://habr.com/en/post/479732/#comment_21012620</a> <br>  La recommandation de respecter le <strong>contrat de ¬´d√©sinscription sign√©e¬ª</strong> du d√©veloppeur RxJS <strong>existe</strong> , mais officieusement. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479732/">https://habr.com/ru/post/fr479732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479716/index.html">Une autre SuperApp "premi√®re au monde"</a></li>
<li><a href="../fr479718/index.html">Cr√©ation d'une application d'environnement Arduino √† l'aide de CI Github</a></li>
<li><a href="../fr479724/index.html">Les pirates informatiques sont termin√©s</a></li>
<li><a href="../fr479726/index.html">Vladimir aka wowik: ¬´OpenStreetMap a besoin d'id√©es irr√©alisables dans d'autres syst√®mes¬ª</a></li>
<li><a href="../fr479728/index.html">Comment organiser une startup r√©ussie?</a></li>
<li><a href="../fr479736/index.html">Appareils photo ou lasers</a></li>
<li><a href="../fr479738/index.html">Comme Youtube et Instagram: internationaliser et localiser une application Python</a></li>
<li><a href="../fr479742/index.html">Backyards - un maillage de services automatis√© au-dessus d'une infrastructure multicloud et hybride</a></li>
<li><a href="../fr479744/index.html">Gestion de la m√©moire Python: un peu sur la fragmentation de la m√©moire</a></li>
<li><a href="../fr479746/index.html">Le logiciel d'entreprise rend vos employ√©s plus cool. En avez-vous besoin?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>