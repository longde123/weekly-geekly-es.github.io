<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèø üë©üèº‚Äçüè≠ üëåüèæ Primeiro conhecimento do Assistente Dom√©stico ü§∏üèæ üòó üë®üèº‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Home Assistant √© um aplicativo popular de c√≥digo aberto para organizar uma casa inteligente. A primeira experi√™ncia do autor com o Assistente Dom√©st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Primeiro conhecimento do Assistente Dom√©stico</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471822/"><img width="25%" align="right" src="https://habrastorage.org/webt/sj/wt/mu/sjwtmujve5xdbroiyxjiebxbc5o.png"><br>  O Home Assistant √© um aplicativo popular de c√≥digo aberto para organizar uma casa inteligente.  A primeira experi√™ncia do autor com o Assistente Dom√©stico se baseia na tentativa de integrar uma panela de arroz inteligente.  O autor tentar√° descrever os principais componentes e recursos deste aplicativo, que ele teve a chance de conhecer passo a passo.  O artigo √©, de certa forma, uma revis√£o, de certa forma um guia para quem deseja iniciar um relacionamento com o Assistente Dom√©stico. <br><a name="habracut"></a><br>  Para quem tem pouco tempo livre, aconselho que voc√™ pule o ditado - o primeiro cap√≠tulo - e v√° direto para o segundo.  Voc√™ s√≥ precisa saber que trabalharemos com uma panela de arroz chinesa inteligente da Xiaomi. <br><br><h3>  Panela de arroz inteligente </h3>  Uma panela de arroz √© obviamente uma panela de arroz.  Wiki nos mostra vapores de arroz em cer√¢mica do Museu Brit√¢nico que remontam a 1250 aC  Em 1945, a Mitsubishi se tornou a primeira empresa de panela el√©trica de arroz do Jap√£o.  Nosso modelo - Panela de Arroz da Xiaomi - pode cozinhar n√£o apenas arroz.  ‚ÄúEste √© um √≥timo dispositivo para fazer n√£o apenas arroz, mas outros tipos de pratos.  Pode cozinhar sopas, doces e muito mais ‚Äù, diz o an√∫ncio.  Mas o mais importante √© a presen√ßa de um m√≥dulo wi-fi, software com recursos de automa√ß√£o e mais de 200 receitas instaladas por software.  "O caminho para uma casa inteligente atrav√©s do est√¥mago √© correto", pensou o autor e decidiu. <br><br>  O Xiaomi Rice Cooker, como conv√©m a um dispositivo digital, √© externamente muito atraente, agrada a sua forma redonda e minimalismo geral.  Para configur√°-lo e us√°-lo, o fabricante oferece o aplicativo Mi Home.  Depois de registrar a conta Mi, o programa encontra com facilidade um novo dispositivo e voc√™ o registra na sua rede local.  A interface do aplicativo n√£o √© a pior, fornece ferramentas b√°sicas de automa√ß√£o e pode receber notifica√ß√µes dos dispositivos.  No entanto, existem desvantagens significativas.  Nem todo mundo pode ficar satisfeito com o envio de informa√ß√µes ao desenvolvedor sobre cada clique do usu√°rio.  E uma express√£o desagrad√°vel √© frequentemente encontrada hoje em cores nacionais.  Em vez de mais de 200 receitas, apenas quatro s√£o traduzidas e est√£o dispon√≠veis em idiomas estrangeiros.  O resto √© exclusivamente para o povo chin√™s.  Quando sua panela de arroz ‚Äúinteligente‚Äù n√£o √© capaz de cumprir todos os deveres culin√°rios prometidos, ent√£o, veja voc√™, fica triste.  Depois de vagar por algum tempo na Internet, um triste autor se deparou com o pr√≥ximo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto</a> interessante (benef√≠cios eternos para o autor).  O que acabou se dedicando ao desenvolvimento de um m√≥dulo para um determinado Assistente Dom√©stico. <br><br><h3>  Assistente de casa </h3>  Primeiro, algumas informa√ß√µes gerais.  Como nos dizem na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina inicial do HA</a> , ‚ÄùEste √© um software de c√≥digo aberto para automa√ß√£o residencial inteligente que se concentra no gerenciamento local e na privacidade.  Desenvolvido pelo trabalho de uma comunidade aberta de entusiastas, √© √≥timo para trabalhar em um Raspberry Pi ou servidor local. ‚Äù  O projeto tem mais de cinco anos, usa python e uma licen√ßa Apache 2.0.  A vers√£o de lan√ßamento no momento da escrita dessas linhas √© 0.99.3. <br><br>  A HA usa m√≥dulos separados (integra√ß√µes ou componentes) para gerenciar dispositivos.  Criar um √© bem simples.  No site, voc√™ encontra um cat√°logo dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">principais</a> m√≥dulos (aprovados e suportados pela comunidade).  Entre o n√∫mero total (1485 pe√ßas), existem outros completamente diversos, os nomes amazon, google, xiaomi e at√© uma vez que o yandex est√° listado no cat√°logo. <br>  Vamos tentar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instalar a</a> HA em um ambiente virtual na √°rea de trabalho do Linux.  N√≥s precisaremos do gerenciador de pacotes python3 e pip. <br><pre><code class="bash hljs">python3 -m venv homeassistant <span class="hljs-comment"><span class="hljs-comment">#    cd homeassistant source bin/activate #    python3 -m pip install homeassistant #  Home Assistant hass --open-ui #  Home Assistant</span></span></code> </pre> <br>  Depois disso, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GUI</a> do HA ficar√° dispon√≠vel em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8123</a> .  Na primeira vez que voc√™ fizer login, ser√° necess√°rio criar uma conta de usu√°rio.  A interface da web do HA √© bastante volumosa.  Alguns elementos importantes que merecem ser mencionados no in√≠cio s√£o a guia Configura√ß√£o ‚Üí Geral, onde voc√™ pode recarregar facilmente os arquivos de configura√ß√£o ou o pr√≥prio servidor.  E tamb√©m a p√°gina Informa√ß√µes na lista de ferramentas dos Desenvolvedores, onde voc√™ pode ver os logs de erros. <br><br>  O HA armazena todos os dados do usu√°rio necess√°rios, no caso do Linux, na pasta de configura√ß√µes ‚Äú~ / .homeassistant‚Äù.  Os arquivos de configura√ß√£o s√£o gravados no formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">YAML</a> , e o principal √© "configuration.yaml".  Combina os dados dos m√≥dulos, automa√ß√£o, etc.  O recurso de importa√ß√£o permite dividir as configura√ß√µes em arquivos organizados logicamente separados.  Os m√≥dulos s√£o armazenados nas subpastas "componentes" (integrados) e "custom_components". <br><br>  Esse conhecimento deve ser suficiente para instalarmos um novo m√≥dulo.  Copie a pasta "xiaomi_cooker" do nosso reposit√≥rio para o nosso "~ / .homeassistant / custom_components".  De acordo com a descri√ß√£o, adicione as configura√ß√µes do m√≥dulo ao arquivo "configuration.yaml": <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">xiaomi_cooker: <span class="hljs-comment"><span class="hljs-comment">#   name: 'Akari' #   host: 192.168.1.10 # IP   token: '4921def609273302248d040a24243a25' #   Xiaomi model: chunmi.cooker.normal2 #  </span></span></code> </pre> <br></div></div><br>  Feito.  Ap√≥s a reinicializa√ß√£o do HA, uma nova entrada de m√≥dulo ser√° exibida na se√ß√£o Geral ‚Üí Integra√ß√µes da interface da web. <br><br>  Qualquer m√≥dulo √© um determinado conjunto de objetos (entidades) e servi√ßos (servi√ßos, em ess√™ncia - fun√ß√µes).  Os objetos armazenam v√°rios dados recebidos dos dispositivos.  Por exemplo, sensor.xiaomi_cooker_temperature √© a temperatura da panela de arroz, sun.sun √© a posi√ß√£o do sol.  Os dados de um objeto s√£o expressos por um valor b√°sico - status (estado) e um conjunto arbitr√°rio de atributos adicionais (atributos).  Os servi√ßos s√£o usados ‚Äã‚Äãpara transferir comandos e valores para dispositivos.  Por exemplo, xiaomi_cooker.start - o comando para iniciar a opera√ß√£o da panela de arroz, ou homeassistant.check_config - a inicializa√ß√£o da pesquisa de erros nos arquivos de configura√ß√µes de alta disponibilidade.  A lista Ferramentas do desenvolvedor da interface da web cont√©m a se√ß√£o Servi√ßos, onde voc√™ pode visualizar a lista de servi√ßos dispon√≠veis para voc√™ e brincar com as chamadas.  Perto √© a se√ß√£o Estados, onde, consequentemente, voc√™ pode visualizar e alterar os valores dos objetos.  Note-se que as altera√ß√µes nos valores dos objetos na se√ß√£o Estados s√£o unilaterais.  I.e.  se, por exemplo, voc√™ alterar o estado do objeto lights.state aqui de desligado para ligado, isso n√£o afetar√° o estado real do dispositivo e, na pr√≥xima vez em que os dados do dispositivo forem atualizados, o valor do objeto ser√° substitu√≠do por real. <br><br><h3>  Automa√ß√£o </h3>  A principal ferramenta de gerenciamento para uma casa inteligente √© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">automa√ß√£o</a> .  Voc√™ pode adicion√°-los e edit√°-los usando a interface gr√°fica na se√ß√£o Geral ‚Üí Automa√ß√£o ou diretamente no arquivo "automations.yaml".  A principal fun√ß√£o da automa√ß√£o √© chamar servi√ßos quando determinadas condi√ß√µes forem atendidas.  Ferramentas b√°sicas para definir as condi√ß√µes para chamar o valor dos objetos, incl.  dados de tempo.  Existem solu√ß√µes um pouco mais espec√≠ficas, como eventos.  Como um exemplo simples de automa√ß√£o, forneceremos um c√≥digo que atualiza os dados de vantagem do autor com um per√≠odo de 15 minutos: <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1565889970818'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: Umpiro decharging #  trigger: #   - platform: time_pattern #   -  minutes: /15 #   (   ‚Äì    15 ) condition: [] #    action: #    - data: # ,     entity_id: sensor.umpiro_charge #  (: ) service: homeassistant.update_entity #   </span></span></code> </pre> <br></div></div><br>  Deve-se notar que at√© agora nem toda a automa√ß√£o dispon√≠vel (por exemplo, a acima) pode ser configurada sem editar o c√≥digo yaml por meio da interface gr√°fica, mas os desenvolvedores dizem que est√£o trabalhando ativamente para eliminar essa desvantagem. <br><br><h3>  Templating </h3>  Ap√≥s a automa√ß√£o, √© hora de falar sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelos</a> (modelos).  V√°rios elementos de configura√ß√µes nos arquivos yaml permitem usar inser√ß√µes na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linguagem de script jinja2</a> .  Muitos desses elementos s√£o unidos pelo nome comum 'Modelos', como service_template ou trigger_template.  Usando modelos, obtemos acesso aos valores dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">objetos no HA</a> e a capacidade de usar esses dados em express√µes matem√°ticas e l√≥gicas complexas, o que expande bastante o nosso potencial.  Como exemplo, vamos usar um c√≥digo um pouco mais complicado de sensor.umpiro_charge, escrito em "configuration.yaml".  Este √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">template_sensor</a> , ou seja, "um sensor que forma dados com base nos valores de outros objetos".  Nosso sensor ser√° um an√°logo de uma bateria gradualmente descarregada: <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">sensor: <span class="hljs-comment"><span class="hljs-comment">#   platform: template #   -  sensors: #   #   ‚Äì sensor.umpiro_charge umpiro_charge: #      UI () unit_of_measurement: '%' # ,    value_template: &gt;- #    ‚Äì   'int' # +     {% if states('sensor.umpiro_charge')|int('unknown') is number %} #       #         {% set value = (states('sensor.umpiro_charge')|int - (as_timestamp(now()) - as_timestamp(states.sensor.umpiro_charge.last_updated))/60/15)|round %} #       {{ [[0, value]|max, 100]|min }} {% else %} # ,  HA   #      {{ 'unknown' }} {% endif %} # ID  ,     #      entity_id: [] friendly_name: 'Charge' #   #      UI () device_class: battery</span></span></code> </pre><br></div></div><br>  Deixamos o entity_id em branco porque j√° adicionamos automa√ß√£o que causar√° independentemente a atualiza√ß√£o dos dados do objeto. <br><br><h3>  Scripts Python </h3>  Por sua vez, os scripts python s√£o uma ferramenta simples para criar novos servi√ßos.  Ap√≥s adicionar a linha: ‚Äúscript python:‚Äù a ‚Äúconfiguration.yaml‚Äù, todos os arquivos com a extens√£o ‚Äú.py‚Äù que colocamos na pasta ‚Äú~ / .homeassistant / python_scripts‚Äù ficar√£o dispon√≠veis como servi√ßos com os nomes ‚Äúpython_scripts. &lt; nome_do_arquivo&gt; ‚Äù.  Seu c√≥digo √© executado em um ambiente predefinido, onde os dados e vari√°veis ‚Äã‚Äãhass nos d√£o acesso aos argumentos da chamada de servi√ßo, bem como aos objetos e servi√ßos de alta disponibilidade.  Como exemplo, fornecemos o c√≥digo do arquivo "charge_set.py" para o servi√ßo "python_scripts.charge_set".  Sua fun√ß√£o ser√° definir a carga da nossa bateria: <br><div class="spoiler">  <b class="spoiler_title">python_scripts / charge_set.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     name = data.get('name', 'sensor.umpiro_charge') #     new_state = data.get('charge', '100') #    attributes = hass.states.get(name).attributes #    hass.states.set(name, new_state, attributes)</span></span></code> </pre> <br></div></div><br><br><h3>  Criando integra√ß√£o </h3>  Tudo o que fizemos com a ajuda de modelos e scripts Python, talvez fosse mais f√°cil fazer isso escrevendo um m√≥dulo separado.  Como j√° mencionado, os m√≥dulos n√£o oficiais s√£o armazenados na pasta "custom_components".  No futuro, precisaremos de um objeto que armazene informa√ß√µes sobre a receita atual da nossa panela de arroz e um servi√ßo que permita alterar esses dados.  Com base em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo da documenta√ß√£o,</a> criaremos um novo m√≥dulo para isso, "sobrecarregar".  A primeira etapa √© o arquivo custom_components / overmind / __ init__.py: <br><div class="spoiler">  <b class="spoiler_title">custom_components / overmind / __ init__.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     DOMAIN = 'overmind' #       () DEFAULT_RECIPE = { "title": "Habr post", "description": "Post an article on habr.com", "profile": "471822" } #    def setup(hass, config): #    hass.states.set('overmind.current_recipe', 'on', DEFAULT_RECIPE) #       def handle_set(call): #    recipe = call.data.get('recipe', DEFAULT_RECIPE) #   -    hass.states.set('overmind.current_recipe', 'set', recipe) #   hass.services.register(DOMAIN, 'recipe_set', handle_set) return True</span></span></code> </pre> <br></div></div><br>  Depois disso, reportaremos o novo m√≥dulo ao arquivo de configura√ß√£o ‚Äúconfiguration.yaml‚Äù, adicionando uma linha com o nome do m√≥dulo: ‚Äúovermind:‚Äù.  O problema est√° resolvido. <br><br><h3>  Interface do usu√°rio Lovelace </h3>  Esse √© o nome do HA de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">front-end</a> usado.  Essa interface gr√°fica, atrav√©s da qual um usu√°rio comum √© convidado a controlar uma casa inteligente, √© a primeira p√°gina da interface da web de alta disponibilidade.  A interface LUI √© formada por cart√µes de v√°rios tipos, que podem refletir os valores dos objetos, servem para chamar fun√ß√µes e outras tarefas.  Os cart√µes podem ser distribu√≠dos nas p√°ginas (visualiza√ß√£o), por analogia com os favoritos do navegador.  A configura√ß√£o √© convenientemente organizada atrav√©s da mesma interface gr√°fica, mas tamb√©m √© acess√≠vel atrav√©s do c√≥digo yaml, para o qual tamb√©m h√° um editor de texto embutido.  Eu recomendo que voc√™ consulte a p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://demo.home-assistant.io/</a> , onde existem v√°rios exemplos diferentes de configura√ß√µes da LUI e onde voc√™ pode ver, clicar e modific√°-las com facilidade. <br><br><img src="https://habrastorage.org/webt/64/bd/zf/64bdzfwclc_3sqnoek13735wgqq.png"><br>  <i><font color="grey">Exemplo de configura√ß√£o da GUI</font></i> <br><br>  Falando sobre as defici√™ncias da interface, infelizmente, os pr√≥prios desenvolvedores admitem que o projeto est√° tentando se sentar simultaneamente nas cadeiras da √°rea de trabalho e do smartphone.  A LUI, por padr√£o, gosta de determinar independentemente a localiza√ß√£o e o tamanho dos cart√µes, o que √†s vezes pode transformar uma p√°gina que parece normal no monitor em uma bagun√ßa na tela do smartphone e vice-versa.  Existem algumas ferramentas simples para otimizar a interface, mas, na minha experi√™ncia, nem sempre s√£o eficazes. <br><br>  Eu acho que n√£o faz muito sentido descrever a cria√ß√£o de uma interface usando ferramentas gr√°ficas, ent√£o darei alguns exemplos na forma do c√≥digo yaml que usei.  Depois de criar uma p√°gina separada (visualiza√ß√£o) para a nossa panela de arroz, tentaremos preench√™-la com os elementos mais necess√°rios para que n√£o cause rejei√ß√£o ao usar a tela do smartphone. <br><br>  Aqui, tentaremos essas ferramentas muito simples de ordena√ß√£o de interfaces, que s√£o a pilha horizontal e a pilha vertical.  Primeiro, crie uma pilha vertical a partir de cart√µes dos tipos bot√£o de entidade e sensor.  O primeiro servir√° para lan√ßar nossa panela de arroz, o segundo - para exibir a temperatura: <br><div class="spoiler">  <b class="spoiler_title">pilha vertical</b> <div class="spoiler_text"><pre> <code class="bash hljs">cards: <span class="hljs-comment"><span class="hljs-comment">#    - type: entity-button #      entity: sensor.xiaomi_cooker_state # ,     icon: 'mdi:selection' #     icon_height: 100px #   name: Offline #    show_icon: true # show_name: true # tap_action: #    action: call-service #  ‚Äì   service: script.turn_on #  ‚Äì   service_data: #    entity_id: script.order_cooker_start #  ‚Äì   hold_action: #    action: none # - type: sensor #      entity: sensor.xiaomi_cooker_temperature # ,     name: Temper #   type: vertical-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  O Assistente Dom√©stico inclui um arquivo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√çcones de Design</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Materiais</a> , que, por meio de nomes apropriados (por exemplo, mdi: selection), pode ser usado nos itens de configura√ß√£o.  O script (neste caso, n√£o python-, mas yaml-), que costum√°vamos chamar de servi√ßo, √© outra ferramenta conveniente de HA. <br><br>  Agora combine a pilha vertical acima com o cart√£o de retrato na pilha agora horizontal.  Tudo ser√° t√£o simples: <br><div class="spoiler">  <b class="spoiler_title">pilha horizontal</b> <div class="spoiler_text"><pre> <code class="bash hljs">ards: <span class="hljs-comment"><span class="hljs-comment">#    - type: picture #   image: /local/akari_r.jpg #    - #         type: horizontal-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  Aqui voc√™ precisa marcar a linha 'imagem:'.  Todos os arquivos que colocamos na pasta '~ / .homeassistant / www' ficam dispon√≠veis no link <a href="">http: // localhost / local / filename</a> . <br><br>  O pr√≥ximo passo √© trabalhar um pouco no bot√£o de chamada de servi√ßo que criamos.  Seria conveniente para n√≥s se funcionasse como uma chave seletora, ou seja,  on / off, e n√£o da maneira como √© feito agora.  Isso pode ser alcan√ßado com o uso de um cart√£o do tipo condicional, cuja exibi√ß√£o na tela pode ser ajustada atrav√©s da defini√ß√£o de determinadas condi√ß√µes.  Abaixo est√° o c√≥digo do cart√£o, que √© o bot√£o para desligar a panela de arroz e s√≥ √© vis√≠vel se a panela estiver no processo de prepara√ß√£o do prato: <br><div class="spoiler">  <b class="spoiler_title">condicional</b> <div class="spoiler_text"><pre> <code class="bash hljs">card: <span class="hljs-comment"><span class="hljs-comment">#    entity: sensor.xiaomi_cooker_state # icon: 'mdi:star-box-outline' # icon_height: 100px # name: Running # tap_action: # action: call-service # service: xiaomi_cooker.stop # type: entity-button # conditions: #   # ,    entity: sensor.xiaomi_cooker_mode #  ,     state: Running type: conditional #  </span></span></code> </pre> <br></div></div><br>  Reescrevendo o c√≥digo do bot√£o liga / desliga criado anteriormente de maneira semelhante e combinando-o com isso, obtemos um bot√£o que funciona tanto dentro quanto fora. <br><br>  Complementamos nosso interesse com outro cart√£o - com o tempo at√© o final do cozimento (semelhante ao cart√£o de temperatura) e mais um com os detalhes da receita (personalizada: cart√£o de receita) exibida.  Como resultado, temos algo parecido com isto: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/k6/kv/zq/k6kvzqqugn8sizjtsemxyufquo8.jpeg"></div><br><h3>  Cart√µes personalizados </h3>  O Assistente de Casa, al√©m da riqueza do conjunto interno de tipos de cart√£o, √© claro, oferece a capacidade de criar o seu pr√≥prio.  Esses cart√µes s√£o chamados de cart√µes personalizados e o javascript √© usado para cri√°-los.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui</a> est√£o dois exemplos simples de c√≥digo.  √â f√°cil encontrar cart√µes prontos criados por v√°rios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">entusiastas na</a> rede e, se voc√™ quiser experimentar, ser√° √∫til descobrir que existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≥dulos js</a> especiais criados para simplificar o trabalho de cria√ß√£o de novos.  Minha experi√™ncia com javascript continua a querer menos, portanto, como exemplo, darei apenas uma pequena parte do c√≥digo do cart√£o usado para selecionar e exibir a receita atual. <br><div class="spoiler">  <b class="spoiler_title">www / receita-card.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     lit-element LitElement, html, css } from "https://unpkg.com/lit-element@latest/lit-element.js?module"; //      class RecipeCard extends LitElement { //     HA static get properties() { return { hass: {}, config: {} }; } //    callServiceEx() { this.hass.callService('persistent_notification', 'create', {message: 'example'}); } //  html-  render() { //    ,     const entityId = this.config.entity; //    const state = this.hass.states[entityId]; //    const titleStr = state ? state.attributes.title : 'unavailable'; const descrStr = state ? state.attributes.description : 'unavailable'; //    return html` &lt;ha-card&gt; &lt;div class="flex" style="margin-top:16px;"&gt; &lt;div class="icon"&gt; &lt;ha-icon icon="mdi:bowl"&gt;&lt;/ha-icon&gt; &lt;/div&gt; &lt;div class="header"&gt; &lt;span class="name"&gt;Recipe&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="flex info" style="margin-bottom:16px;"&gt; &lt;span class="recipe-title"&gt;${titleStr}&lt;/span&gt; &lt;span class="recipe-descr"&gt;${descrStr}&lt;/span&gt; &lt;/div&gt; &lt;/ha-card&gt; `; } //     customElements.define('recipe-card', RecipeCard);</span></span></code> </pre> <br></div></div><br><br>  Para usar o novo cart√£o, voc√™ precisar√° adicionar o seguinte c√≥digo no in√≠cio do arquivo de configura√ß√µes da LUI: <br><div class="spoiler">  <b class="spoiler_title">cart√£o de receita</b> <div class="spoiler_text"><pre> <code class="bash hljs">resources: <span class="hljs-comment"><span class="hljs-comment">#    - type: module #   ‚Äì  url: /local/recipe-card.js #  </span></span></code> </pre><br>  e entre a lista de cart√µes: <br><pre> <code class="bash hljs"> - <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'custom:recipe-card'</span></span> <span class="hljs-comment"><span class="hljs-comment">#   entity: overmind.current_recipe # ,    </span></span></code> </pre><br><br></div></div><br><h3>  Notifica√ß√µes </h3>  Uma parte necess√°ria de uma casa inteligente est√° enviando mensagens para o usu√°rio.  No HA, essas mensagens s√£o chamadas de notifica√ß√µes e existem dois tipos b√°sicos de notifica√ß√µes.  O primeiro s√£o notifica√ß√µes persistentes.  Para envi√°-los, o servi√ßo interno "persistent_notification.create" √© usado.  Uma lista dessas mensagens est√° dispon√≠vel atrav√©s do √≠cone de campainha na interface gr√°fica, elas usam a marca√ß√£o de remarca√ß√£o e s√£o essencialmente bastante simples. <br><br>  Outra ferramenta mais interessante √© o m√≥dulo de notifica√ß√£o embutido, que atrav√©s da instala√ß√£o de m√≥dulos adicionais permite enviar mensagens usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plataformas de terceiros</a> .  Como exemplo, considere um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≥dulo para telegrama</a> . <br><br>  Para usar o m√≥dulo, primeiro, precisamos criar um bot no pr√≥prio telegrama.  Ao configurar, precisamos do chat_id do nosso usu√°rio e da API do bot de token.  Como obter esses dados - descritos em detalhes no link acima, assumimos que estamos prontos.  Movendo-se diretamente para a instala√ß√£o do m√≥dulo, primeiro, como j√° fizemos, copie seu c√≥digo-fonte para a pasta components e, em seguida, adicione suas configura√ß√µes ao arquivo "configuration.yaml": <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">telegram_bot: <span class="hljs-comment"><span class="hljs-comment">#   telegram platform: polling #   api_key: XXXXXXXXXXXXX # API Token   allowed_chat_ids: XXXXXXX # chat_id   proxy_url: socks5://XXXXXXXXXXXXX #     proxy_params: username: umpiro password: umpiro_password</span></span></code> </pre> <br>  mais configura√ß√µes para o m√≥dulo de notifica√ß√£o: <br><pre> <code class="bash hljs">notify: <span class="hljs-comment"><span class="hljs-comment">#   notify name: notify_send #   (   ‚Äì  notify.notify_send) platform: telegram #   chat_id: XXXXXXX # chat_id  </span></span></code> </pre> <br></div></div><br><br>  O m√≥dulo de telegrama nos permite enviar mensagens, fotos ou v√≠deos.  Como exemplo, criaremos automa√ß√£o para enviar uma mensagem com uma foto, notificando-nos do final do cozimento. <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1571074941908'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: EOC #   trigger: #    # ,   - entity_id: sensor.xiaomi_cooker_mode from: Running #    #   ‚Äì    platform: state to: Waiting #    condition: [] #   action: #    - service: notify.notify_send #  ‚Äì   data: # ,     title: End of Cooking #  message: "EOC" #  data: #    photo: #   -  #   - file: /home/umpiro/.homeassistant/www/cat.jpg #   caption: ‚ÄúEOC‚Äù</span></span></code> </pre> <br></div></div><br><br><h3>  Posf√°cio </h3>  O Assistente de resid√™ncia pode ser de interesse para quem deseja tentar organizar o gerenciamento local de uma casa inteligente.  Este √© um projeto amplo, interessante, de desenvolvimento aberto e ativo, devido aos esfor√ßos da comunidade.  A variedade de ferramentas do Assistente Dom√©stico n√£o pode deixar de se alegrar (n√£o tive tempo de mencionar algumas importantes).  Como sinal de menos, pode-se mencionar a relativa complexidade e incompletude da documenta√ß√£o. <br>  PS <br>  Recentemente, em 10 de outubro, houve, n√£o sei se isso pode ser chamado de release, a transi√ß√£o do projeto da vers√£o 0.99 para a vers√£o 0.100. <br>  Cita√ß√£o das Notas da vers√£o: <br><blockquote>  Bem-vindo √†s notas de lan√ßamento de mais um lan√ßamento maravilhoso!  N√£o, n√£o estamos indo para 1.0, estamos fazendo 0.100!  Sentimos que ainda n√£o estamos prontos com nossas metas para a 1.0, mas estamos progredindo todos os dias.  Para uma amostra do que estamos pensando, consulte o blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modo simples no Home Assistant 1.0.</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471822/">https://habr.com/ru/post/pt471822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471810/index.html">Compare as ferramentas para auditar altera√ß√µes no Active Directory: Quest Change Auditor e Netwrix Auditor</a></li>
<li><a href="../pt471812/index.html">Biblioteca gratuita do Wolfram Engine para desenvolvedores de software</a></li>
<li><a href="../pt471814/index.html">WolframClientForPython | Nova biblioteca cliente da linguagem Wolfram para Python</a></li>
<li><a href="../pt471816/index.html">Como assinar aplicativos para o macOS Catalina 10.15</a></li>
<li><a href="../pt471820/index.html">Golpistas por telefone. Etapa tr√™s, na qual obtenho documenta√ß√£o de que meu celular do banco foi criado</a></li>
<li><a href="../pt471824/index.html">C√¢mera de disquete: 8 fatos interessantes sobre o Sony Mavica MVC-FD85 (muitas fotos)</a></li>
<li><a href="../pt471836/index.html">Visualiza√ß√£o de c√≥digo python automatizada. Parte Quatro: Suporte √† Documenta√ß√£o</a></li>
<li><a href="../pt471838/index.html">Amor de matem√°tica</a></li>
<li><a href="../pt471840/index.html">Por que ir a entrevistas</a></li>
<li><a href="../pt471844/index.html">5 raz√µes para visitar EPAM INSIDER no Cazaquist√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>