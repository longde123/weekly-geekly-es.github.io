<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèº üëäüèº ü•§ Comment automatiser la collecte de KPI par mois et laisser les utilisateurs presque satisfaits üë∑üèª üèµÔ∏è üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans de nombreuses organisations, l'√©valuation des unit√©s est effectu√©e √† l'aide de KPI (Key Performance Indicators). Dans l'organisation o√π je travai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment automatiser la collecte de KPI par mois et laisser les utilisateurs presque satisfaits</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423919/"> Dans de nombreuses organisations, l'√©valuation des unit√©s est effectu√©e √† l'aide de KPI (Key Performance Indicators).  Dans l'organisation o√π je travaille, un tel syst√®me est appel√© ¬´syst√®me d'indicateurs de performance¬ª, et dans cet article, je veux parler de la fa√ßon dont nous avons r√©ussi √† automatiser une partie du travail avec des indicateurs en un mois.  Avec tout cela, nos co√ªts de main-d'≈ìuvre n'√©taient pas les plus √©lev√©s, mais en m√™me temps, nous avons essay√© de mettre en ≈ìuvre une liste de souhaits de longue date.  Dans mon histoire, il n'y aura pas de technologies ou de r√©v√©lations hype (apr√®s tout, le d√©veloppement provincial est dur), mais il y aura quelques croquis sur le sujet qui aideront √† comprendre comment nous avons commenc√©, ce que nous avons fait et quelles pens√©es nous avons tir√©es du d√©veloppement.  Si vous ne vous √™tes pas encore ennuy√©, je demande un chat. <br><a name="habracut"></a><br><h3>  Contexte </h3><br>  En 2006, nous avons introduit un syst√®me d'indicateurs de performance: quinze crit√®res d'√©valuation ont √©t√© √©labor√©s, une m√©thodologie pour les calculer et une fr√©quence trimestrielle de calcul de ces indicateurs a √©t√© √©tablie.  L'√©valuation a √©t√© r√©alis√©e pour vingt-deux branches de l'organisation situ√©es dans toutes les r√©gions de notre r√©gion.  Et pour que les indicateurs soient atteints avec beaucoup d'enthousiasme, une prime leur √©tait attach√©e - plus la somme des indicateurs est √©lev√©e, plus la place dans la notation est √©lev√©e, plus la place dans la notation est √©lev√©e, plus la prime est √©lev√©e, et ainsi de suite chaque trimestre et chaque ann√©e. <br><br>  Au fil du temps, la composition des crit√®res a chang√©: chaque trimestre, de nouveaux ont √©t√© ajout√©s ou d'anciens ont √©t√© exclus.  Au plus fort, vers 2016, le nombre d'indicateurs d√©passait la quarantaine, et maintenant il n'y en a plus que quatorze. <br><br>  Cependant, pendant tout ce temps, le processus de calcul a √©t√© le m√™me.  Chaque crit√®re est calcul√© par l'unit√© responsable de l'organisation m√®re selon un algorithme approuv√© sp√©cifiquement pour ce crit√®re.  Le calcul peut √™tre effectu√© √† la fois par une formule simple et par un certain nombre de formules complexes, il peut n√©cessiter la collecte de donn√©es de plusieurs syst√®mes, alors qu'il est tr√®s probable que l'algorithme changera assez souvent.  Et puis tout est d√©j√† beaucoup plus simple: l'indicateur calcul√© en pourcentage est multipli√© par son coefficient, ainsi, un score est obtenu par le crit√®re, puis les points sont class√©s et chaque unit√© se d√©roule en fonction du score.  La m√™me chose se fait avec la somme des points pour calculer la place finale. <br><br>  D√®s le d√©but, Excel a √©t√© utilis√© pour prendre en compte et calculer tout ce qui est d√©crit ci-dessus.  Pendant de nombreuses ann√©es, l'ensemble final de crit√®res et le calcul ult√©rieur des points et des lieux ont √©t√© effectu√©s dans une belle assiette, dont une partie est illustr√©e sur la figure. <br><br><img src="https://habrastorage.org/webt/vg/wa/c6/vgwac6cdozzjztrpwhci_smaon4.png"><br><br>  Je note seulement que sur cette jolie tablette, la plupart des enceintes sont simplement cach√©es, mais en r√©alit√© au 4√®me trimestre 2016 √ßa ressemblait √† √ßa <br><br><img src="https://habrastorage.org/webt/ku/8s/ah/ku8sah_m9zrjx3ozezxqvz2w9xq.png"><br><br>  D'accord, un tel nombre d'indicateurs et un tel volume du tableau n'ajoutent pas √† sa simplicit√©.  De plus, chacun des crit√®res a √©t√© calcul√© s√©par√©ment, et les filles du d√©partement g√©n√©ral ont r√©alis√© ce tableau r√©capitulatif de leurs mains.  √âtant donn√© que non seulement la composition des crit√®res a chang√©, mais aussi que les calculs ont pu √™tre refaits plusieurs fois (pour de nombreuses raisons), les derniers jours de chaque trimestre, pour le moins, n'√©taient pas satisfaits.  J'ai d√ª constamment changer les donn√©es du tableau, le v√©rifier et le rev√©rifier: comme √ßa, vous oubliez d'ajouter une nouvelle colonne √† la somme des points ou vous ne mettez pas √† jour le coefficient, et pour certaines personnes l'endroit diminue, et avec lui le bonus est moins.  Par cons√©quent, apr√®s la r√©duction h√©ro√Øque de la table, une v√©rification non moins h√©ro√Øque a commenc√©, tous ceux qui ont consid√©r√© chaque crit√®re, les gestionnaires et m√™me un informaticien assign√© √† l'organisation ont v√©rifi√© et accept√©.  √âtant donn√© que tout le travail a √©t√© effectu√© manuellement et que le calcul des indicateurs pour le tableau crois√© dynamique a √©t√© envoy√© par la poste, il y a souvent eu des situations o√π le tableau crois√© dynamique contenait des erreurs dans les formules et les donn√©es des versions non pertinentes.  Le capitaine des preuves indique qu'apr√®s chaque erreur a √©t√© d√©tect√©e, le processus de v√©rification a √©t√© red√©marr√©. <br>  Lorsque tous les indicateurs sont calcul√©s, la tablette est approuv√©e et envoy√©e aux succursales, l√†, dans les succursales, elle a √©t√© rev√©rifi√©e: et si Excel insidieux pensait que quelque chose n'allait pas?  Je pense qu'il est √©vident que la compilation d'un rapport annuel sur les crit√®res ou l'analyse des donn√©es historiques s'est av√©r√©e √™tre une qu√™te non moins passionnante. <br><br>  Cependant, d'un point de vue manag√©rial, un tel syst√®me est assez efficace et permet, si n√©cessaire, de resserrer les zones d'affaissement du travail, de suivre et d'avoir une id√©e de ce qui se passe dans chacune des branches dans un domaine d'activit√© particulier.  De plus, l'emplacement de la succursale, calcul√© selon les crit√®res, √©tait un indicateur int√©gral. <br><br><h3>  Le syst√®me doit changer </h3><br>  La pratique a prouv√© la n√©cessit√© et l'importance d'un syst√®me d'√©valuation.  D√©but 2017, il est devenu clair que le calcul des crit√®res une fois par trimestre permettait d'√©valuer le travail effectu√©, mais le suivi lui permettait d'√™tre faible.  Dur√©e trop longue.  √Ä cet √©gard, il a √©t√© d√©cid√© que le calcul des indicateurs serait effectu√© une fois toutes les deux semaines, et les r√©sultats seraient r√©sum√©s tout de m√™me tous les trimestres.  L'augmentation de la fr√©quence de calcul a vraiment permis aux directeurs d'agence de r√©agir rapidement aux changements et de contr√¥ler davantage les processus au sein de leurs unit√©s. <br><br>  Mais seulement dans l'organisation m√®re, peu √©taient satisfaits de la perspective de mener √† bien le processus de collecte de donn√©es d√©crit ci-dessus, pas tous les trimestres, mais toutes les deux semaines.  Comme ce n'est pas difficile √† deviner, ils ont d√©cid√© d'automatiser le processus.  Les d√©lais se sont av√©r√©s serr√©s: du moment de la d√©cision de passer √† une nouvelle fr√©quence de calcul, √† la transition proprement dite, seul un mois aurait d√ª s'√©couler.  Pour cette p√©riode, il √©tait tr√®s souhaitable de trouver quelque chose de mieux qu'un tas d'Excel pour le code et le calcul, et un courrier pour la collecte et la notification. <br><br>  Au d√©but, il y a eu pas mal de discussions anim√©es sur ce qui devait vraiment, vraiment √™tre fait automatiquement et le calcul des indicateurs lui-m√™me, en tenant compte de toutes leurs formules et sources de donn√©es.  Mais √©tant donn√© les d√©lais serr√©s, la complexit√© d'une telle fonctionnalit√© et la n√©cessit√© de sa maintenance constante dans l'√©tat actuel ont r√©ussi √† r√©pondre aux exigences suivantes pour le syst√®me: <br><br><ul><li>  Un manuel de r√©f√©rence des crit√®res doit √™tre conserv√©, pr√©servant l'historique de leur √©volution; </li><li>  Il devrait √™tre possible de saisir et de stocker les indicateurs calcul√©s, ainsi que leur conversion en points comme dans la m√™me plaque; </li><li>  Sur la base des valeurs des indicateurs, un rapport devrait √™tre g√©n√©r√© et accessible √† toutes les parties int√©ress√©es; </li><li>  Naturellement, tout cela devrait √™tre fourni avec une interface Web. </li></ul><br>  La fonctionnalit√© est tr√®s petite, mais pas beaucoup de temps. <br><br><h3>  D√©but du d√©veloppement </h3><br>  J'ai toujours √©t√© attir√© par les moyens de d√©veloppement rapide et de g√©n√©ration automatique d'interfaces.  Dans les cas o√π il est n√©cessaire de mettre en ≈ìuvre la fonctionnalit√© CRUD, l'id√©e quand l'interface et une partie de la logique m√©tier seront fournies pr√™tes √† l'emploi, pour ainsi dire, semble tr√®s tentante.  Bien s√ªr, l'interface sera une logique sans pr√©tention et maladroite, mais pour de nombreuses t√¢ches, cela suffit. <br><br>  Pouss√© par ces id√©es, j'ai d√©cid√© d'essayer quelque chose comme √ßa.  Il existe Spring Roo, Cuba et d'autres outils int√©ressants, mais le choix s'est port√© sur OpenXava.  Premi√®rement, une fois que j'ai d√©j√† fait une application tr√®s simple sur celui-ci et que j'√©tais satisfait, et deuxi√®mement, ce cadre √† l'√©poque s'inscrivait avec succ√®s dans notre pile technologique.  De plus, il est tr√®s agr√©able d'avoir un petit tutoriel en russe. <br><br>  Une br√®ve description des fonctionnalit√©s et capacit√©s d'OpenXava peut √™tre trouv√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  OpenXava est un framework qui impl√©mente la construction automatique d'une interface web int√©gr√©e √† une base de donn√©es bas√©e sur JPA, et utilise des annotations pour d√©crire les r√®gles de visualisation.  L'application est bas√©e sur des composants m√©tier - des classes Java qui contiennent les informations n√©cessaires pour cr√©er des applications.  Ces informations comprennent la structure des donn√©es, les validateurs, les repr√©sentations valides, le mappage aux tables de base de donn√©es.  Les op√©rations sur les composants m√©tier sont effectu√©es via des contr√¥leurs qui peuvent CRUD √† partir d'une bo√Æte, rechercher, exporter au format PDF, etc.  L'application OpenXava pr√©sente un ensemble de modules.  Un module associe un composant m√©tier √† un ou plusieurs contr√¥leurs.  Les repr√©sentations d√©finies pour chaque composant m√©tier sont utilis√©es pour afficher l'interface.  Rien d'inhabituel, MVC avec un peu de sa propre atmosph√®re. <br><br><h3>  Stockage de donn√©es </h3><br>  Dans la plupart des applications, nous utilisons le SGBD IBM DB2.  Une petite base de donn√©es a √©t√© cr√©√©e qui stocke les livres de r√©f√©rence des groupes de crit√®res et des crit√®res selon lesquels les branches sont √©valu√©es, le r√©pertoire des branches et une plaque dans laquelle les valeurs calcul√©es des crit√®res sont entr√©es.  Pour chaque crit√®re, √† un certain moment, un coefficient est attribu√© qui sera utilis√© dans la notation.  Chaque branche, pour chaque crit√®re, re√ßoit √©galement une √©valuation pour une certaine date.  Les donn√©es sur les valeurs des crit√®res sont stock√©es historiquement, c'est-√†-dire que les donn√©es pertinentes pour n'importe quelle date seront celles qui ont √©t√© entr√©es √† la date la plus proche dans le pass√©.  Cette approche, inspir√©e des registres d'informations de 1C: Enterprise, me semble assez pratique: il y a un historique et les probl√®mes d'√©dition / suppression ne sont pas particuli√®rement importants. <br><br><div class="spoiler">  <b class="spoiler_title">Structure de la base de donn√©es</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_DEPART ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, PARENT_ID <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_GROUP_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_STATE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_VALUE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_DEPART <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_DEPART) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_DEPART(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT );</code> </pre> <br></div></div><br>  Afin d'obtenir le rapport convoit√© sur les performances des branches de la base de donn√©es, des fonctions stock√©es ont √©t√© cr√©√©es, dont les r√©sultats sont d√©j√† mapp√©s √† la classe Java.  Les fonctions ressemblent √† ceci. <br><div class="spoiler">  <b class="spoiler_title">Nous obtenons d'abord tous les crit√®res valides pour la date, ainsi que les coefficients des crit√®res pertinents pour cette date</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_STATE_ALL_CRITERIA ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RSC.ID_CRITERIA, RSC.ID_GROUP_CRITERIA, RSC.TIME_BEGIN, RSC.TIME_END, RSC.TIME_CREATE, RSC.KOEFFICIENT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RSC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(TIME_BEGIN) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> ID_CRITERIA, TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TIME_BEGIN &lt; PMAX_TIME <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> TIME_END &gt; PMAX_TIME ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SL <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_SLICE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> RSC.ID_CRITERIA = MAX_SLICE.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> RSC.TIME_BEGIN = MAX_SLICE.TIME_BEGIN ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Maintenant, nous recevrons √† la m√™me date les valeurs de tous les crit√®res pour toutes les branches</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), GROUP_CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, GROUP_CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, DEPART_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_CODE_INT <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CDEP.ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.ID_GROUP_CRITERIA, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_GROUP_CRITERIA, CDEP.ID_DEPART, VALS.DATE_REG, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.PERCENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.VAL, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VAL, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.KOEFFICIENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> KOEFFICIENT, CDEP.CRITERIA_NAME, CDEP.CRITERIA_CODE, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_NAME, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_CODE, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE, CDEP.DEPART_NAME, CDEP.DEPART_CODE, CDEP.DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CCRT.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_CRITERIA, CCRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_NAME, CCRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_CODE, CDEP.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_DEPART, CDEP.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_NAME, CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE, <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span> (CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP, ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_STATE_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ACTC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CC.ID = ACTC.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CC.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CCRT <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CDEP.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> VALS.ID_CRITERIA, VALS.ID_GROUP_CRITERIA, VALS.ID_DEPART, VALS.DATE_REG, VALS.PERCENT, VALS.VAL, VALS.KOEFFICIENT, CGRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, CGRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> SUMMAR.CLS_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CGRT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> VALS.ID_GROUP_CRITERIA = CGRT.ID ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CDEP.ID_DEPART = VALS.ID_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> CDEP.ID_CRITERIA = VALS.ID_CRITERIA ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Dans la requ√™te finale, nous num√©rotons les valeurs des indicateurs, les classons et trouvons le minimum et le maximum, cela sera n√©cessaire pour calculer les places plus tard</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_NUM, <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MIN_RATING, VALS.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES (?)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> GROUP_CRITERIA_CODE, CRITERIA_CODE, DEPART_CODE_INT</code> </pre><br></div></div><br>  Le transfert d'une partie de la logique m√©tier vers le SGBD est tout √† fait justifi√©, notamment lorsqu'il s'agit de pr√©parer des donn√©es pour diff√©rents rapports.  Il s'av√®re que les op√©rations peuvent √™tre √©crites sous une forme plus concise et naturelle; en Java, de telles manipulations avec les donn√©es n√©cessiteraient une plus grande quantit√© de code et quelques efforts pour la structurer.  Bien que les op√©rations relativement complexes ou non triviales soient toujours plus faciles √† programmer en Java.  Par cons√©quent, dans notre application, en ce qui concerne l'√©chantillonnage des donn√©es, une approche est utilis√©e dans laquelle la connexion des ensembles de donn√©es, des conditions d'√©cr√™tage et de certaines op√©rations qui peuvent √™tre effectu√©es par des fonctions de fen√™tre sont effectu√©es dans des fonctions et des proc√©dures stock√©es, et une logique plus complexe est impl√©ment√©e dans l'application. <br><br><h3>  App </h3><br>  Comme je l'ai dit, OpenXava a √©t√© utilis√© pour impl√©menter l'application.  Pour obtenir une interface et un CRUD typiques, vous devez effectuer certaines actions. <br>  Pour commencer, dans web.xml, vous devez d√©crire le filtre et le servlet de l'addon qui navigue dans l'application: <br><br><div class="spoiler">  <b class="spoiler_title">web.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXFilter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>*.jsp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/modules/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>REQUEST<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>FORWARD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXServlet<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/m/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Ensuite, dans le fichier controllers.xml, nous d√©finissons les contr√¥leurs utilis√©s dans l'application.  Dans notre cas, le plus simple suffit: <br><br><div class="spoiler">  <b class="spoiler_title">controllers.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Navigation"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CRUD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtendedPrint"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Le contr√¥leur ci-dessus combine les fonctions des contr√¥leurs inclus dans OpenXava par d√©faut, dont les fonctions sont faciles √† deviner √† partir des noms. <br><br>  Et enfin, dans le fichier application.xml, nous connecterons le contr√¥leur cr√©√© et le mod√®le.  Quelque chose comme √ßa: <br><br><div class="spoiler">  <b class="spoiler_title">application.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"summar"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Comme mentionn√© ci-dessus, l'application est bas√©e sur les composants m√©tier qui composent le mod√®le d'application.  Par exemple, consid√©rez le composant RegValueCriteria associ√© au contr√¥leur dans application.xml.  Ce composant d√©crit la valeur du crit√®re pour la branche (par souci de concision, seule la description des champs de classe est laiss√©e, et je vais omettre des m√©thodes telles que les getters et les setters): <br><br><div class="spoiler">  <b class="spoiler_title">Classe de composants</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"REG_VALUE_CRITERIA"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">""</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"SUMMAR"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@Views</span></span>({ <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>), <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(name=<span class="hljs-string"><span class="hljs-string">"massReg"</span></span>, members = <span class="hljs-string"><span class="hljs-string">"idDepart.name, percent, val"</span></span>) }) <span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegValueCriteria</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"DATE_REG"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Temporal</span></span>(TemporalType.TIMESTAMP) <span class="hljs-meta"><span class="hljs-meta">@DefaultValueCalculator</span></span>(CurrentDateCalculator.class) <span class="hljs-meta"><span class="hljs-meta">@Stereotype</span></span>(<span class="hljs-string"><span class="hljs-string">"DATETIME"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date dateReg; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PERCENT"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangePercentAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal percent; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VAL"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal val; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangeClsCriteriaAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsCriteria idCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_GROUP_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsGroupCriteria idGroupCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_DEPART"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsDepart idDepart; }</code> </pre> <br></div></div><br>  En plus des annotations JPA habituelles.  Vous pouvez √©galement remarquer des annotations OpenXava.  Ils devraient √™tre examin√©s plus en d√©tail. <br><br>  L' <code>@View</code> permet de contr√¥ler le format de pr√©sentation des champs de classe et, √† l'aide d'une syntaxe sp√©ciale sous forme de crochets, les champs peuvent √™tre regroup√©s et dispos√©s horizontalement et verticalement √† l'aide de symboles <code>,</code> et <code>;</code>  .  Si plusieurs mappages doivent √™tre sp√©cifi√©s pour un seul composant, les annotations <code>@View</code> sont regroup√©es √† l'aide d'annotations <code>@View</code> .  Dans notre exemple, les propri√©t√©s ont √©t√© organis√©es comme suit: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>)</code> </pre> <br>  Et cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/nh/5m/ss/nh5msssvc0-xft3prl99emnw1-e.png"><br><br>  Sans pr√©tention, mais avec un minimum d'effort.  Cependant, il existe des moyens de ¬´faire revivre¬ª un peu la forme. <br>  Pour que la date d'enregistrement soit remplie lors de la cr√©ation du composant, l'annotation <code>@DefaultValueCalculator</code> est <code>@DefaultValueCalculator</code> , qui appelle un objet calculateur sp√©cial.  Ici, une calculatrice d'OpenXava elle-m√™me est utilis√©e, mais vous pouvez √©galement en faire une personnalis√©e.  L'annotation <code>@Stereotype</code> est utilis√©e pour afficher la date √† l'aide du contr√¥le appropri√©. <br><br>  Pour configurer des listes d√©roulantes contenant des objets associ√©s, l'annotation <code>@DescriptionsList</code> est <code>@DescriptionsList</code> , dans laquelle vous pouvez sp√©cifier quelle propri√©t√© sera affich√©e dans la liste. <br><br>  √Ä l'aide d'annotations, vous pouvez impl√©menter une logique m√©tier du formulaire lui-m√™me.  Par exemple, pour que lorsque le pourcentage change, la valeur est calcul√©e automatiquement en tenant compte du coefficient du crit√®re, vous pouvez appliquer l'annotation <code>@OnChange</code> pour le champ <code>BigDecimal val</code> .  Pour que l'annotation <code>@OnChange</code> fonctionne, elle doit pointer vers la classe impl√©mentant l'interface <code>OnChangePropertyBaseAction</code> .  Une seule m√©thode <code>execute()</code> doit √™tre impl√©ment√©e dans la classe, dans laquelle les donn√©es d'entr√©e sont extraites de la vue, le calcul est effectu√© et la valeur calcul√©e est r√©√©crite dans la vue: <br><br><div class="spoiler">  <b class="spoiler_title">Classe enfant OnChangePropertyBaseAction</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePercentAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePropertyBaseAction</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ BigDecimal percent = (BigDecimal)getNewValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (percent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Map value = (Map)getView().getValue(<span class="hljs-string"><span class="hljs-string">"idCriteria"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Long idCriteria = (Long)value.get(<span class="hljs-string"><span class="hljs-string">"id"</span></span>); Query query = XPersistence.getManager().createNativeQuery( <span class="hljs-string"><span class="hljs-string">"SELECT KOEFFICIENT FROM SUMMAR.SLCLA_STATE_CRITERIA WHERE ID_CRITERIA = ?"</span></span>); query.setParameter(<span class="hljs-number"><span class="hljs-number">1</span></span>, idCriteria); List&lt;?&gt; list = query.getResultList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !list.isEmpty()){ BigDecimal koef = (BigDecimal) list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>); BigDecimal vl = koef.multiply(percent); getView().setValue(<span class="hljs-string"><span class="hljs-string">"val"</span></span>, vl); } } } } }</code> </pre> <br></div></div><br>  Pour une pr√©sentation tabulaire des donn√©es, l'annotation <code>@Tab</code> est <code>@Tab</code> , ce qui vous permet de r√©pertorier les propri√©t√©s des objets qui seront affich√©es dans une repr√©sentation tabulaire.  Dans notre exemple, l'annotation a √©t√© structur√©e comme suit: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> )</code> </pre> <br>  Il ressemblera √† ceci <br><br><img src="https://habrastorage.org/webt/hb/ps/vs/hbpsvs9i46ue1abfxabexohsnni.png"><br><br>  Heureux de la disponibilit√© des filtres, de la pagination et de l'exportation hors de la bo√Æte, cependant, de nombreux d√©tails n√©cessitent un raffinement avec un fichier. <br><br>  Le travail avec d'autres composants est construit de mani√®re similaire.  L'utilisation d'OpenXava a consid√©rablement r√©duit les co√ªts de main-d'≈ìuvre pour la mise en ≈ìuvre des fonctions CRUD et la plupart de l'interface utilisateur.  L'utilisation d'actions √† partir de contr√¥leurs et d'annotations pr√©d√©finis pour cr√©er des formulaires permet de gagner beaucoup de temps si vous ne trouvez pas de probl√®me avec les d√©tails et essayez d'impl√©menter quelque chose de plus compliqu√© que le formulaire d'entr√©e avec plusieurs √©v√©nements.  Bien que cela puisse √™tre le cas dans l'exp√©rience. <br><br><h3>  De quoi il s'agissait </h3><br>  Rappelez-vous ce que l'application √©tait en place?  Oui, afin que la plaque avec les indicateurs ne soit pas h√©ro√Øquement r√©duite dans Excel, mais cr√©√©e automatiquement en fonction des donn√©es saisies.  Dans la fen√™tre du navigateur, le tableau crois√© dynamique a commenc√© √† ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/sm/x_/v1/smx_v17og5oi-ube78ymyhosnie.png"><br><img src="https://habrastorage.org/webt/26/sz/45/26sz45etsyy1jldlfoqff7034zg.png"><br><br>  Je ne donnerai pas de d√©tails sur la mise en ≈ìuvre, car tout n'est pas tr√®s bon avec elle et le m√©lange de JSP avec le HTML g√©n√©r√© lors de la demande de donn√©es n'est pas quelque chose √† partager avec le grand public.  Dans le m√™me temps, l'√©chantillonnage des donn√©es lui-m√™me a √©t√© d√©montr√© ci-dessus. <br><br>  Cependant, je veux m'attarder sur un d√©tail int√©ressant.  Lorsque les exigences de la demande ont √©t√© recueillies, la direction souhaitait vraiment que, en plus du rapport de synth√®se, les valeurs d'un indicateur individuel puissent √™tre affich√©es sous la forme d'une carte de la r√©gion, divis√©e en r√©gions avec une indication de l'emplacement et du score de la branche correspondante.  Qui a reconnu la r√©gion sur la carte - bravo =) <br><br><img src="https://habrastorage.org/webt/ip/8t/a-/ip8ta-wuufxirkycdn_kohxqqkc.png"><br><br>  D'une part, l'exigence √©tait facultative, mais d'autre part, l'image promettait d'√™tre visuelle, et du point de vue de la mise en ≈ìuvre, il √©tait int√©ressant d'essayer.  Apr√®s r√©flexion, l'id√©e est venue de trouver l'image de la r√©gion au format SVG et d'en faire un mod√®le XSLT. <br><br>  Le mod√®le r√©sultant est facilement rempli de donn√©es, puis converti en PNG. <br>  Tout d'abord, en utilisant la requ√™te d√©crite ci-dessus, les donn√©es sont √©chantillonn√©es, les donn√©es re√ßues sont converties en un objet de cette classe: <br><br><div class="spoiler">  <b class="spoiler_title">Classes pour la sortie de donn√©es sur une carte</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@XmlType</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VisualisedValuesCriteria"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualisedValuesCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> XMLGregorianCalendar date; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String criteriaName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String koefficient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;VisualizedValueCriteria&gt; departValues; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> XMLGregorianCalendar </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLGregorianCalendar date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.date = date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String criteriaName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.criteriaName = criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String koefficient)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.koefficient = koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;VisualizedValueCriteria&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (departValues == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ departValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;VisualizedValueCriteria&gt; departValues)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departValues = departValues; } } <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualizedValueCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departCode; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String value; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String percent; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String colorCode; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departName = departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departCode = departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String percent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.percent = percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> colorCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String colorCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.colorCode = colorCode; } } }</code> </pre> <br></div></div><br>  Ensuite, convertissez l'objet en XML; <br><br><div class="spoiler">  <b class="spoiler_title">Conversion</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Private String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">marshal</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualisedValuesCriteria obj)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Marshaller marshaller = JAXBContext.newInstance(VisualisedValuesCriteria.class).createMarshaller(); marshaller.setEventHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultValidationEventHandler()); marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); StringWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringWriter(); marshaller.marshal(obj, writer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> writer.toString(); }</code> </pre> <br></div></div><br>  Maintenant, prenons le XML r√©sultant, le mod√®le XSLT pr√©par√©, appliquons la conversion et obtenons svg dans la sortie: <br><br><div class="spoiler">  <b class="spoiler_title">Obtenez svg</b> <div class="spoiler_text"><pre> <code class="java hljs"> String xml = marshal(obj); TransformerFactory factory = TransformerFactory.newInstance(); FileInputStream xsltFis = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\map_xsl.svg"</span></span>); InputStreamReader xsltIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(xsltFis, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); Source xslt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xsltIn); Transformer transformer = factory.newTransformer(xslt); InputStream xmlIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayInputStream( xml.getBytes( <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> ) ); Source text = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xmlIn); String filename = <span class="hljs-string"><span class="hljs-string">"map"</span></span> + System.currentTimeMillis() + <span class="hljs-string"><span class="hljs-string">".svg"</span></span>; String filePath = <span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\"</span></span> + filename; transformer.transform(text, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamResult(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(filePath)));</code> </pre> <br></div></div><br>  En principe, nous pourrions nous arr√™ter ici, les navigateurs affichent SVG sans aucun probl√®me.  Mais les rapports d√©crits ont √©galement √©t√© obtenus via le bot Telegram, donc SVG doit √™tre converti en un format tel que JPEG ou PNG.  Pour ce faire, utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apache Batik</a> <br><br><div class="spoiler">  <b class="spoiler_title">Convertir en PNG</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToPNG</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String svg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filePath)</span></span></span></span>{ String png = filePath + filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { PNGTranscoder trancoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PNGTranscoder(); String svgURI = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(svg).toURL().toString(); TranscoderInput input = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderInput(svgURI); OutputStream ostream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(png); TranscoderOutput output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderOutput(ostream); trancoder.transcode(input, output); ostream.flush(); ostream.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MalformedURLException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException | TranscoderException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br></div></div><br>  Le rapport sous forme de carte est pr√™t.  Il peut √©galement √™tre consult√© via le navigateur et demand√© au robot t√©l√©gramme.  √Ä mon avis, pas mal. <br><br><h3>  Conclusion </h3><br>  √Ä l'heure fix√©e, nous avions le temps et d√©j√† en mars 2017, des indicateurs de performance au lieu d'Excel ont commenc√© √† √™tre r√©guli√®rement entr√©s dans le syst√®me cr√©√©.  D'une part, le probl√®me maximum n'a pas √©t√© r√©solu; la partie la plus difficile du calcul des indicateurs se fait manuellement.  Mais d'un autre c√¥t√©, la mise en ≈ìuvre de ces calculs comportait des risques de raffinement constant.  De plus, m√™me l'interface simple cr√©√©e pour la collecte de donn√©es a supprim√© un grand nombre de questions avec des changements constants, un contr√¥le de version et un r√©sum√© de la feuille de calcul Excel.  Un grand nombre de travaux manuels, de contr√¥les et de v√©rifications crois√©es ont √©t√© supprim√©s. <br><br>  Il est impossible de ne pas dire que l'interface sur Open Xav n'√©tait pas trop agr√©able aux utilisateurs.  Au d√©but, ses caract√©ristiques posaient de nombreuses questions.  √Ä un moment donn√©, les utilisateurs ont commenc√© √† se plaindre qu'il avait fallu trop de temps pour entrer des donn√©es et, en g√©n√©ral, ¬´nous voulons, comme dans Excel, seulement un programme¬ª.  J'ai m√™me d√ª surveiller la vitesse d'entr√©e en fonction des donn√©es sur le moment de la cr√©ation des enregistrements.  Cette surveillance a montr√© que m√™me dans les cas les plus graves, les utilisateurs ne passaient pas plus de 15 minutes en entr√©e, mais se situaient g√©n√©ralement entre 5 et 7, malgr√© le fait qu'ils devaient saisir des donn√©es sur 22 succursales.  Ces indicateurs semblent tout √† fait acceptables. <br><br>  Cependant, je veux noter deux choses: <br><br><ol><li>  Open Xava s'est av√©r√© √™tre un bon outil pour cr√©er rapidement une interface.  Je dirais m√™me une interface prototype.  Son avantage incontestable est √©galement la r√©gularit√© g√©n√©rale et la r√©gularit√©.  Tous les formulaires de l'application sont cr√©√©s selon des principes uniformes, ce qui permet au d√©veloppeur de ne pas proposer des v√©los l√† o√π il n'en a pas besoin, mais √† l'utilisateur de traiter des jeux de formulaires standard.  Cependant, les tentatives de mise en ≈ìuvre d'une logique plus complexe ou de modification des contr√¥les pour nous-m√™mes nous ont conduits √† un certain nombre de probl√®mes auxquels nous n'avons pas pu faire face dans le temps imparti.  Tr√®s probablement, nous ne comprenions tout simplement pas, et l'objectif √©tait de cr√©er une interface CRUD simple avec un minimum d'effort.  Pour ma part, je conclus qu'Open Xava est un outil int√©ressant dans lequel il est facile de faire des choses simples, mais si vous avez besoin de faire quelque chose de compliqu√©, je pr√©f√®re passer plus de temps √† cr√©er la partie client en utilisant ExtJS ou React, mais avoir plus de flexibilit√© . </li><li>  M√™me les utilisateurs confiants prennent du mal avec les nouvelles interfaces.  Ce n'est bien s√ªr pas un secret.  √Ä mon avis, cela est principalement d√ª √† un manque de compr√©hension de la nature syst√©mique de nombreuses interfaces.  Pour beaucoup, toute application poss√®de un ensemble d'√©crans, chacun √©tant unique et fonctionnant selon ses propres principes inconnus: par exemple, il existe un formulaire avec une liste d'objets / lignes (formulaire de liste), mais pour de nombreux utilisateurs, il n'est pas du tout √©vident que chacun de ces formulaires dans l'application puisse avoir filtrage uniforme, pagination, fonctions de tri et g√©n√©ralement le m√™me comportement, compl√©t√© par des fonctions sp√©cifiques.  Ceci est aggrav√© par le fait qu'un grand nombre de logiciels d'entreprise est une pile presque spontan√©e de boutons et de formulaires, assaisonn√©e d'une documentation indistincte dans le style de ¬´Cliquez sur ce bouton¬ª.  De ce point de vue, les interfaces cr√©√©es par les m√™mes d√©veloppeurs utilisateurs de la discipline Open Xav, cr√©ent plus d'ordre dans la t√™te.  Certes, avec cette approche, les boutons magiques ne disparaissent nulle part, mais deviennent soigneusement dispos√©s en formes. </li></ol><br>  Si nous parlons des avantages pour l'organisation dans son ensemble, apr√®s l'introduction de la demande, comme pr√©vu, le degr√© de contr√¥le a augment√©.  Les responsables de terrain ont re√ßu un outil de suivi des indicateurs, avec lequel ils peuvent influencer le travail dans un mode plus op√©rationnel, comparer les indicateurs pour diff√©rentes p√©riodes, sans se confondre avec le flux des fichiers envoy√©s.  L'int√©r√™t des dirigeants pour le suivi constant et vigilant de leur branche a √©t√© d√©couvert par nous de mani√®re tr√®s int√©ressante: en parcourant les logs du bot Telegram, nous avons remarqu√© que certains rapports √©taient re√ßus √† 4 ou 5 heures du matin.  Vous pouvez imm√©diatement voir qui est int√©ress√© par le travail. <br><br>  C‚Äôest tout.  Je serais reconnaissant pour la r√©troaction constructive! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423919/">https://habr.com/ru/post/fr423919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423897/index.html">Conseils utiles pour l'utilisation de l'assistant DDR HyperLynx pour l'analyse QDR4</a></li>
<li><a href="../fr423901/index.html">Lorsque la vitesse et la mise √† l'√©chelle sont n√©cessaires: serveur d'appareils iOS distribu√©s</a></li>
<li><a href="../fr423903/index.html">Immersion dans AD: nous analysons les attaques avanc√©es sur Microsoft Active Directory et comment les d√©tecter</a></li>
<li><a href="../fr423905/index.html">Les d√©veloppeurs sont rest√©s inconnus. Conf√©rence Yandex</a></li>
<li><a href="../fr423911/index.html">La photonique sur silicium tr√©buche sur le dernier m√®tre</a></li>
<li><a href="../fr423921/index.html">10 ans d'Android: souvenez-vous de tout</a></li>
<li><a href="../fr423923/index.html">SAP Leonardo Hackathon de velcom et SAP pour les d√©veloppeurs de Bi√©lorussie</a></li>
<li><a href="../fr423925/index.html">Webinaire ouvert "Mod√®le r√©cursif √©trange"</a></li>
<li><a href="../fr423927/index.html">10 moteurs de recherche prometteurs pour am√©liorer le r√©f√©rencement</a></li>
<li><a href="../fr423931/index.html">Comment contourner l'authentification SMS lors de la connexion aux r√©seaux Wi-Fi publics?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>