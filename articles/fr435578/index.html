<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÉ üë©‚Äçüéì üñãÔ∏è Sortie dans l'espace pour No√´l üë≤ üë®üèæ‚Äçü§ù‚Äçüë®üèº üëá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 

 Peu avant No√´l, il a √©t√© d√©cid√© d'√©tudier Spacewalk dans le service informatique - il s'agit du syst√®me Red Hat, un analogue gratuit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sortie dans l'espace pour No√´l</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435578/"> Bonjour, Habr! <br><br>  Peu avant No√´l, il a √©t√© d√©cid√© d'√©tudier Spacewalk dans le service informatique - il s'agit du syst√®me Red Hat, un analogue gratuit de Satellite, pour la gestion centralis√©e de la configuration, les mises √† jour du syst√®me et un support pratique pour l'ensemble du parc de serveurs. <br><br>  √âtant donn√© que la documentation disponible sur le site officiel est plut√¥t rare pour des commentaires suppl√©mentaires sur divers types de d√©pannage, la t√¢che consistait √† √©tudier le produit pour son introduction progressive d'abord sur les serveurs de test, puis sur les produits. <br><br>  L'id√©e principale de l'introduction de Spacewalk √©tait non seulement la centralisation et la simplification du contr√¥le, mais aussi pour que personne ne joue les mises √† jour sur les serveurs du nouveau projet avec des stylos ludiques, car des pr√©c√©dents s'√©taient d√©j√† produits. <br><br>  Apr√®s deux semaines de travail, toutes les connaissances que j'ai re√ßues ont √©t√© saisies dans l'analogue interne de Confluence, et une journ√©e de cong√© m'a incit√© √† √©crire un article sur Habr. <br><a name="habracut"></a><br>  Avant de commencer, je voudrais souligner bri√®vement ce qui a √©t√© et n'a pas √©t√© affect√©, afin de ne pas √™tre admissible au manuel complet pour travailler avec Spacewalk: <br><br>  + Installation et configuration du serveur / client <br>  + Configuration du syst√®me dans l'interface graphique <br>  + D√©panner les packages d'installation / mise √† jour, travailler avec les configurations <br>  + Errata (collecte d'informations sur les mises √† jour critiques, les vuln√©rabilit√©s, etc.) <br><br>  - Proxy (le besoin a disparu, apr√®s avoir abandonn√© HA) <br>  - cordonnier / kickstart <br>  - OpenSCAP <br><br><h3>  Configuration requise </h3><br>  √âtant donn√© que toute l'infrastructure fonctionne sur VMWare, le travail a √©t√© effectu√© sur une machine virtuelle ex√©cutant CentOS 7. La configuration syst√®me recommand√©e par le d√©veloppeur est la suivante: <br><br><ul><li>  4 Go de RAM </li><li>  6 Go d'espace libre pour / var / satellite / </li><li>  12 Go pour DB </li></ul><br>  J'ai utilis√©: <br><br><ul><li>  6 Go de RAM </li><li>  4 CPU (s) </li><li>  Disque dur de 40 Go </li></ul><br>  Je vous conseille √©galement de d√©sactiver SELinux et, si vous n'utilisez pas, firewalld.  Ou ajoutez le service http aux exceptions. <br><br>  Remarque: √† la fin de l'article, il y aura des playbooks pour Ansible, √† la fois pour les parties client et serveur, ainsi que des scripts bash.  Avec leur aide, il sera possible de d√©ployer l'ensemble de l'infrastructure en quelques minutes. <br><br><h3>  L'installation </h3><br>  L'installation elle-m√™me est d√©crite √† la fois dans la documentation officielle et sur plusieurs sites, cependant, pour l'int√©grit√© de l'article, permettez-moi de mentionner ce point ici. <br><br>  Spacewalk fonctionne avec deux SGBD: PostgreSQL et Oracle RDBMS.  J'ai de l'exp√©rience avec le premier, et je vais l'utiliser maintenant. <br><br>  Il existe deux options d'installation: √† la fois via le programme d'installation automatique de Spacewalk, qui s'installera et se configurera lui-m√™me et la base de donn√©es, cependant, sur le m√™me serveur, et l'installation manuelle, o√π vous pouvez placer la base de donn√©es et l'application sur diff√©rents serveurs.  J'examinerai les deux options, je commencerai par une installation distincte. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  Il est √©galement n√©cessaire de connecter des modules PL / Tcl pour PG: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Cr√©ez une base de donn√©es, un utilisateur et connectez le module: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  Afin d'√©viter les probl√®mes de connexion, il vaut la peine de changer <i>/var/lib/pgsql/data/pg_hba.conf</i> , en ajoutant les lignes AVANT la ligne tout: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Red√©marrez tout: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  Si vous avez l'intention d'installer l'application et la base de donn√©es sur diff√©rents serveurs, assurez-vous que le package <i>postgresql-contrib</i> est install√© sur le serveur de base de donn√©es. <br><br><h4>  Spacewalk </h4><br>  Nous connectons des r√©f√©rentiels: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  Connectez √©galement epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Java: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Maintenant directement l'installateur de Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Connectez-vous √† notre base de donn√©es: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  Dans le cas o√π vous utilisez une m√©thode de base de donn√©es / application distincte, vous devrez ajouter l'indicateur <i>--standalone</i> et sp√©cifier l'adresse IP du serveur de base de donn√©es, n'oubliez pas non plus d'ouvrir le port 5432. <br><br>  <i>Remarque: je conseille de r√©gler la base de donn√©es en fonction de votre mat√©riel pour un fonctionnement plus productif de l'ensemble du syst√®me.</i> <br><br>  Maintenant, installez Spacewalk lui-m√™me et ex√©cutez l'installation: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  Ensuite, plusieurs questions seront pos√©es, concernant √† la fois le certificat SSL et la base de donn√©es.  Vous pouvez entrer toutes les valeurs manuellement, ou vous pouvez utiliser l' <i>indicateur --answer-file</i> et sp√©cifier le chemin d'acc√®s au fichier avec les r√©ponses afin d'automatiser l'installation √† l'avenir: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  Pour contr√¥ler directement l'application, vous devez utiliser: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  Pour afficher tous les services tiers qui contribuent √† l'application: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Option deux, installation automatique </h4><br>  Apr√®s avoir connect√© les r√©f√©rentiels, configurez et ex√©cutez: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Encore une fois, des questions seront pos√©es concernant la base de donn√©es et SSL, nous utilisons la <i>cl√© --answer-file</i> et le chemin d'acc√®s au fichier avec les r√©ponses. <br><br><h3>  Cha√Ænes de base et enfants, Repos </h3><br>  Pour g√©rer les stations client, Spacewalk utilise un syst√®me de canaux dits, qui peut √™tre principal (enfant) ou enfant (enfant), un r√©f√©rentiel dont vous avez besoin est attach√© √† chaque canal, ainsi qu'une cl√© - avec laquelle le client est associ√© serveur. <br><br>  En cons√©quence, les r√©f√©rentiels sont synchronis√©s avec les canaux, qui, √† leur tour, sont connect√©s aux clients, et Spacewalk fonctionne de mani√®re g√©n√©rale.  Les errata, qui peuvent √™tre li√©s aux canaux, m√©ritent √©galement d'√™tre mentionn√©s, ce qui simplifie la mise √† jour et le contr√¥le des packages. <br><br>  Tous les clients peuvent √™tre regroup√©s selon diff√©rents crit√®res, √† la fois avec les m√™mes canaux et avec diff√©rents canaux ou r√©f√©rentiels. Il est possible de travailler avec un grand nombre de clients √† la fois, ce qui permet d'effectuer des mises √† jour sur plus de 100 serveurs. <br><br>  Une liste de tous les packages install√©s est disponible, et apr√®s synchronisation des r√©f√©rentiels et possible pour l'installation.  Certains points sont intuitifs et il n‚Äôa aucun sens de consid√©rer chaque √©l√©ment ligne par ligne. <br><br>  Toutes les actions dans Spacewalk se d√©roulent selon un planning (Schedule), presque toutes les actions peuvent √™tre configur√©es pour le moment qui vous convient le mieux. <br><br>  Apr√®s l'installation, il sera possible de se rendre √† l'adresse de votre serveur, d'effectuer une configuration suppl√©mentaire via l'interface graphique: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Saisissez le mot de passe, le nom de l'administrateur, le nom de l'organisation (qui est √©galement l'un des moyens de g√©rer les clients) et acc√©dez au panneau de d√©marrage. <br><br>  Pour l'instant, vous pouvez soit explorer les options disponibles vous-m√™me, soit passer √† la cr√©ation de cha√Ænes. <br><br>  <i>Cha√Ænes - G√©rer les cha√Ænes logicielles - Cr√©er une cha√Æne:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  Je recommande de d√©finir les noms de canal en fonction des types et du type d'OS qui seront li√©s √† ce canal, par exemple, <i>CentOS_7_x86_64</i> , vous pouvez choisir en toute s√©curit√© sha256 comme v√©rifications, le champ R√©capitulatif Channell est destin√© √† une petite description du canal.  vous pouvez √©galement √©ventuellement fournir des informations suppl√©mentaires. <br><br>  Cr√©ez maintenant un canal enfant et liez-le au canal principal.  Nous proc√©dons de la m√™me mani√®re que pour cr√©er le canal principal, uniquement dans le champ Canal parent, nous indiquerons le canal cr√©√© pr√©c√©demment. <br><br>  Liez les r√©f√©rentiels aux canaux principaux et subsidiaires. <br>  <i>Canaux - G√©rer les r√©f√©rentiels</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  Pour les canaux principaux, j'utilise les ressources de base, pour les canaux subsidiaires - Mises √† jour. <br><br>  Apr√®s avoir cr√©√© les r√©f√©rentiels, vous devez les connecter aux canaux. <br>  <i>Canaux - G√©rez les canaux logiciels</i> , ouvrez votre canal principal, ouvrez la section R√©f√©rentiels. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  Il y aura tous les r√©f√©rentiels cr√©√©s, s√©lectionnez celui dont vous avez besoin, marquez-le et cliquez sur Mettre √† jour les ressources. <br><br>  Ensuite, ouvrez la sous-cl√© Sync: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  O√π vous pouvez synchroniser le r√©f√©rentiel et le canal, configurez la planification de la synchronisation. <br><br>  <i>Remarque: dans mon cas de stylos ludiques, j'ai d√ª supprimer le r√©f√©rentiel standard du syst√®me client.</i> <br><br><h4>  Installation du client, couplage du client avec le serveur, gestion des cl√©s, mise en place du canal de configuration </h4><br>  Comme je l'ai mentionn√© pr√©c√©demment, Spacewalk utilise un syst√®me de cl√© de Red Hat Network, qui est utilis√© pour le couplage et la gestion. <br><br>  Pour cr√©er une cl√©, acc√©dez √† <i>Syst√®mes - Cl√©s d'activation - Cr√©er une cl√©:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  Tout est extr√™mement simple ici, il convient de mentionner que vous pouvez d√©finir vous-m√™me la cl√©, son format sera toujours <i>1-XXXXXX</i> , et aussi, chaque cl√© est attach√©e √† la cha√Æne.  Le drapeau Universal Default oblige les nouveaux syst√®mes √† r√©cup√©rer les param√®tres cl√©s. <br><br>  <b>Installation du client</b> <br><br>  Connectez le r√©f√©rentiel client et installez les packages n√©cessaires: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Remarque: les actions rhncfg et deltarpm sont n√©cessaires pour que les configurations et la t√©l√©commande fonctionnent correctement.</i> <br><br>  Spacewalk utilise rhn_check pour synchroniser le serveur client, qui s'ex√©cute toutes les 4 heures.  Cette valeur peut √™tre r√©duite √† 60 minutes, mais pour moi aucune des options n'√©tait optimale, donc il y a deux options: utilisez osad, qui vient avec Spacewalk, ou ajoutez simplement un cronjob pour rhn_check, par exemple, pour chaque minute pendant que nous testez le syst√®me, puis la valeur peut √™tre modifi√©e √† votre guise. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  Il ne sera pas non plus inutile d'ajouter / usr / bin / rhn-actions-control --enable-all √† Cron aussi, il est utilis√© pour d√©ployer des configurations, et parfois il s'√©mousse. <br><br>  Nous revenons √† la gestion des cl√©s, copions l'ID de cl√© que nous avons cr√©√© et ex√©cutons: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  N'oubliez pas de changer l'IP et les valeurs de cl√© pour les v√¥tres.  Encore une fois, je vous conseille d'utiliser l'indicateur <i>--force</i> , car j'ai remarqu√© des probl√®mes sans utiliser cet indicateur. <br><br>  Nous revenons √† <i>Systems - All</i> , nous sommes ravis de remarquer notre syst√®me.  Vous pouvez maintenant l'ouvrir et explorer quoi et comment, mais pour l'instant je recommande fortement de cr√©er un groupe pour une gestion plus pratique du syst√®me. <br><br>  <i>Syst√®mes - Groupes de syst√®mes - Cr√©er un groupe</i> , remplissez le nom et la description, enregistrez, ouvrez le groupe fra√Æchement cr√©√©, acc√©dez √† la section <i>Syst√®mes</i> et ajoutez le syst√®me au groupe. <br><br>  Abonnez maintenant le syst√®me √† la cha√Æne, <i>Syst√®mes - Votre syst√®me - Dossier Logiciels - Sous-dossier Canaux logiciels:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  Choisissez votre cha√Æne et cliquez sur confirmation.  Pour le plaisir, vous pouvez essayer d'installer le package, <i>Software - Packages - Install</i> . <br><br>  <b>Canal de configuration</b> <br><br>  Pour g√©rer les configurations entre le serveur client / la machine locale, ainsi que le contr√¥le √† distance, il convient de configurer le canal de configuration et de relier le syst√®me √† celui-ci. <br>  Nous allons √† <i>Configuration - Canaux de configuration - Cr√©er un canal de configuration</i> , d√©finissons le nom, la description, enregistrez, puis dans <i>Configuration - G√©rer les canaux de configuration - Abonnez-vous aux canaux</i> et signez le canal de configuration au canal logiciel et au syst√®me. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Nous pouvons maintenant d√©ployer des configurations √† partir du serveur et des machines locales et cr√©er des partitions. <br><br>  <i>Configuration - Ajouter des fichiers - Cr√©er un fichier / T√©l√©charger un fichier:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  De plus, nous pouvons envoyer des commandes √† distance sous la forme d'un script bash: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  Je vous rappelle que toutes les actions passent par un Schedule, une liste de toutes les actions appliqu√©es √† ce syst√®me se trouve dans la section Events: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Errata</b> <br><br>  L'une des fonctionnalit√©s les plus importantes de Spacewalk est la prise en charge des errata, qui se lie facilement aux canaux et vous permet de surveiller le niveau d'importance des derni√®res mises √† jour.  Ceci est configur√© directement sur le serveur, en plus des scripts, vous devez t√©l√©charger les packages n√©cessaires pour Pearl: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Ensuite, cr√©ez les principaux errata du script de mise √† jour et de collecte, qui seront stock√©s dans <i>/ etc / rhn /:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  Dans l'exportation, sp√©cifiez le nom et le mot de passe de l'administrateur de Spacewalk, que vous avez sp√©cifi√©s au tout d√©but. <br><br>  Rendons le script ex√©cutable et ajoutons-le √† Cron: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Ex√©cutons-le maintenant pour voir les changements dans l'interface graphique.  L'ex√©cution prendra un certain temps. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  R√©sum√© </h4><br>  Un point important, √† mon avis, que j'ai personnellement manqu√©, est la configuration et l'installation d'un proxy, ainsi que l'augmentation de l'ensemble du syst√®me en tant que HA.  J'ai eu une id√©e pour configurer l'application via un stimulateur cardiaque et synchroniser sur la base de donn√©es.  En cons√©quence, il a √©t√© d√©cid√© d'abandonner cette id√©e, compte tenu du parc de serveurs client pas tr√®s important.  Cependant, si le syst√®me s'av√®re extr√™mement utile au cours des six prochains mois, vous devrez peut-√™tre √©tendre le serveur d'origine. <br><br><h4>  Automatisation </h4><br>  <b>Serveur:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash pour le d√©ploiement du serveur (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Script Bash pour installer les errata (d√©finissez d'abord le nom et le mot de passe de l'administrateur Spacewalk):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Playbook Ansible pour le d√©ploiement du serveur (n'oubliez pas d'ajouter un fichier de r√©ponses):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Client:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash pour le d√©ploiement client (n'oubliez pas l'IP et la cl√©):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Playbook anisble pour le d√©ploiement client:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Merci √† tous d'avoir lu l'article.  Bonne chance </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435578/">https://habr.com/ru/post/fr435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435564/index.html">Utilisation de GtkApplication. Fonctions de rendu Librsvg</a></li>
<li><a href="../fr435568/index.html">Routeur VyOS OpenSource</a></li>
<li><a href="../fr435572/index.html">Anycubic i3 Mega: remake de qualit√© de Prusa i3</a></li>
<li><a href="../fr435574/index.html">Comment fonctionne zig?</a></li>
<li><a href="../fr435576/index.html">1C, pas de douleur</a></li>
<li><a href="../fr435580/index.html">Java, Spring, Kurento et Media Services</a></li>
<li><a href="../fr435582/index.html">Comment ajouter un index sur un syst√®me charg√© 24/7 sans interruption?</a></li>
<li><a href="../fr435584/index.html">Slush 2018. Premier jour, deuxi√®me jour</a></li>
<li><a href="../fr435586/index.html">L'art du chamanisme ou du firmware personnalis√© pour Olinuxino. Noyau et Ubuntu Partie 3</a></li>
<li><a href="../fr435588/index.html">Promotion d'une application mobile avec une r√©elle exp√©rience des chiffres</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>