<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚖️ 👩🏻‍🎨 🕴🏽 新的AV1编解码器：加速浏览器中的视频加载 🤦🏿 ⏲️ 🌐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本指南中，我们将按照2019年的惯例学习如何在网络上使用视频。Chrome和Firefox已开始支持新的AV1编解码器-对于他们来说，视频的制作量可以减少一半。 

 我们将分别讨论如何用AV1和H.264中的视频替换GIF-然后​​其大小将减小20-40倍。 



 YouTube已在Test...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>新的AV1编解码器：加速浏览器中的视频加载</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442020/">在本指南中，我们将按照2019年的惯例学习如何在网络上使用视频。Chrome和Firefox已开始支持新的AV1编解码器-对于他们来说，视频的制作量可以减少一半。 <br><br> 我们将分别讨论如何用AV1和H.264中的视频替换GIF-然后​​其大小将减小20-40倍。 <br><br><img src="https://habrastorage.org/webt/e6/ma/qx/e6maqxoeu5hqqh3ilpk5vh6ozvk.jpeg" alt="浏览器中的AV1"><br><br>  YouTube已在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">TestTube</a>上使用它。  Netflix表示AV1将是“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">他们的下一代编解码器”</a> 。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">邪恶火星人</a>已经在我们的网站和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Amplifer</a>上使用它。 在本文中，我将分享实现AV1的经验，并逐步告诉您如何嵌入视频，使其在所有浏览器中都能正常工作。 <br><a name="habracut"></a><br><h2> 编解码器和容器 </h2><br> 使用图片，一切都很简单：对于所有浏览器都可以使用JPEG和PNG格式，对于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">现代浏览器</a>可以在WebP中制作更紧凑的文件。 我们始终可以确保<code>.png</code>文件将具有PNG格式（极少数例外是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">imgproxy</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">可以防御</a>的PNG炸弹）。 <br><br> 视频文件更加复杂。 文件扩展名（ <code>.mp4</code> ， <code>.wmv</code> ， <code>.webm</code>或<code>.mov</code> ）仅涉及容器。 视频文件由三个不同的组件组成： <br><br><ol><li>  <b>视频编解码器</b>确定您可以压缩多少视频以及必须牺牲的内容。  Web的主要视频编解码器：H.264，HEVC，VP9和现在的AV1。 </li><li>  <b>音频编解码器</b>压缩声音。 当然，如果视频中没有声音，则不需要。 流行的选择是MP3，Opus和AAC。 </li><li>  <b>容器同时</b>存储视频（由某种视频编解码器压缩）和音频流（由某种音频编解码器压缩）。 以及其他数据，例如字幕和元信息。 流行的容器：MP4，MOV，WebM。 </li></ol><br> 当我们看到<code>.mp4</code>文件扩展名时，我们只能说已使用MP4容器。 但是其中的编解码器可能有所不同-作者可以使用H.264和AAC，AV1和Opus或其他东西。 <br><br><h2> 看吧AV1 </h2><br>  AV1是一年前的2018年3月发布的视频编解码器。其创建目的是超越上一代的编解码器-HEVC，VP9，H.264和VP8。 <br><br><img src="https://habrastorage.org/webt/l1/pr/n6/l1prn6kicyr6f7smayebyp7m85m.jpeg" alt="视频编解码器生成图"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Tsahi Levent-Levy的</a>生成编解码器图</i> <br><br><blockquote> 如果您想知道AV1如何精确地超过了压缩中的其余编解码器，请阅读有关Habré的翻译中的技术细节： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下一代视频：AV1简介</a> <br>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AV1下一代编解码器：CDEF校正定向滤波器</a> ” <br></blockquote><br> 由于进行了新的优化，AV1的视频压缩比H.264或VP8压缩30-50％，比HEVC压缩高达30％。 但是编解码器是最近发布的，到目前为止有几种儿童疾病： <br><br><ul><li> 当前编码器未优化。  AV1会<i>非常</i>缓慢地压缩视频（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Rust上</a>已经在开发一种新的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">快速编码器</a> ）。 编解码器不适合流式传输。 如果我们正在谈论着陆时的静态视频-这个问题与我们无关。 </li><li> 到目前为止，仅桌面Chrome和Windows上的Firefox支持编解码器。 尚不支持Safari和Edge（尽管Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">已经对其进行了测试</a> ）。 您至少需要2个文件：用于Chrome和Firefox的AV1，以及用于其他浏览器的H.264。 </li></ul><br> 关于AV1的最酷的事情是“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">插孔化</a> ”方块不会以低比特率出现。 <br><br><img src="https://habrastorage.org/webt/kd/fi/gm/kdfigmacjbsduq4reyw7fsjvygo.png" alt="不同编解码器在不同比特率下的图像质量比较"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">比较</a>不同编解码器在不同比特率下的图像质量-AV1获胜</i> <br><br><h2> 正确烹饪AV1 </h2><br> 让我们最后开始练习。 首先，让我们确定容器。 从理论上讲，AV1可以放在不同的容器中，但MP4更为紧凑， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">建议</a>在规格中使用。 对于AV1中的声音，我们采用Opus，因为它可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">完美地压缩声音</a> 。 <br><br> 为了使视频在所有浏览器中都能正常播放，我们将生成3个文件： <br><br><ol><li> 对于Windows上的台式机Chrome和Firefox（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">截至</a> 2019年3月<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">，市场份额</a>为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">31％</a> ）：带有AV1的视频和Opus的MP4容器。 </li><li> 对于Safari和Edge（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">市场的16％</a> ）-带有HEVC和AAC的MP4。 </li><li> 其余的：具有H.264和AAC的大型MP4文件。 </li></ol><br> 您只能拍摄AV1和H.264-视频也将对所有人有效。 <br><br> 对于压缩，我建议使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">FFmpeg</a>控制台。 图形实用程序很多，但是将选项保存在控制台中然后自动开始转换会更容易。 确保使用最新版本的FFmpeg。  <b>4.1</b>之前的版本不支持MP4中的AV1。 <br><br> 对于Mac OS X： <br><br><ol><li> 安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Homebrew</a> 。 </li><li> <code>brew install ffmpeg</code> </li> </ol><br> 对于Linux，最好从官方站点上进行全新构建-而在许多发行版中，没有在MP4中支持AV1的版本： <br><br><ol><li> <code>wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>tar -xf ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>sudo cp ffmpeg-4.1-64bit-static/ff* /usr/local/bin/</code> </li> </ol><br> 对于Windows，您可以安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">William Diaz的</a> FFmpeg。 <br><br> 我们转向转换H.264文件，这是旧版浏览器所需要的。 由于我们所有文件都使用MP4容器，因此我将使用<code>.av1.mp4</code> ， <code>.hevc.mp4</code>和<code>.h264.mp4</code>后缀。 不要为长期的团队感到震惊，我们将对其进行分析： <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  SOURCE.mov     - ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" video.h264.mp4</span></span></code> </pre><br> 现在打开<code>video.h264.mp4</code> 。 如果质量良好且尺寸较大，请尝试增加<code>-crf</code> （ <code>-crf 26</code>然后<code>-crf 28</code> ）。 此选项将以降低质量为代价减小文件大小。 平衡质量和尺寸是一门艺术。 <br><br><blockquote> 如果没有原始视频文件，则可以将旧的H.264文件转换为AV1。 </blockquote><br> 现在该转换AV1了-我提醒您，它将比H.264长。 编解码器尚未使用处理器的全部功能（开始并行转换多个文件是有意义的）。 <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libopus -c:v libaom-av1 -crf 34 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br> 再次使用<code>-crf</code>可以<code>-crf</code>质量和大小<code>-crf</code>完美平衡。 <br><br> 现在，HEVC也是一样。 <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx265 -crf 24 -preset veryslow -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.hevc.mp4</code> </pre><br> 将<code>video.h264.mp4</code> ， <code>video.hevc.mp4</code>和<code>video.av1.mp4</code>复制到您网站的根目录。 <br><br><h3> 了解FFmpeg选项 </h3><br> 上面的命令看起来像是恶魔召唤法术吗？ 不用担心，这<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">不是PostCSS</a> 。 让我们看一下选项。 <br><br>  <code>-i SOURCE.mov</code>指示输入文件，FFmpeg将从该文件中获取视频和音频流，将其压缩并将其打包在新的容器中。 <br><br>  <code>-map_metadata -1</code>将从视频中删除元信息（例如，创建视频的程序）。 这样的信息在网络上很少有用。 <br><br>  <code>-c:a libopus</code>或<code>-c:a libfdk_aac</code>设置音频编解码器。 如果不需要声音，请用<code>-an</code>替换它们。 <br><br>  <code>-c:v libaom-av1</code>选择视频编解码器-一个将压缩视频流的帧的库。 <br><br>  <code>-crf 34</code>恒定速率因子，质量和大小的平衡。 就像JPEG质量滑块一样，只是方向不同（0是最佳质量和最大文件）。  H.264和AV1的CRF比例不同-H.264的CRF比例最大为51，AV1的CRF比例最大为61。AV1和H.264的CRF比例将不同。 <br><br><blockquote>  Facebook找到了H.264和AV1的CRF值之间的近似对应关系： <br>  19→27，23→33，27→39，31→45，35→51，39→57。 <br></blockquote><br>  <code>-preset veryslow</code>强制H.264和HEVC编解码器进一步压缩文件，但会大大增加转换时间。 <br><br>  <code>-profile:v main</code> H.264使用<code>-profile:v main</code>选择<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">编解码器配置文件</a> 。 在Safari中，只有“ Main”才可以使用。 <br><br>  <code>-b:v 0</code>设置AV1的最小比特率，以使视频具有一致的质量。 <br><br>  <code>-pix_fmt yuv420p</code> （像素格式）是减小文件大小的棘手<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">方法</a> 。 它保留了亮度的原始分辨率，但降低了颜色的分辨率。 我们的眼睛看到的颜色变差，因此他们没有注意到此技巧。 如果您遇到这种情况，请删除此选项。 <br><br>  <code>-movflags +faststart</code>将所有重要<code>-movflags +faststart</code>移到文件开头，以便浏览器可以播放视频，直到下载完成。 <br><br>  <code>-vf "scale=trunc(iw/2)*2:trunc(ih/2)*2"</code>会将视频的两边的大小更改为最接近的偶数（某些编解码器可以以300×200和302×200的分辨率工作，但不能与301×200）。 如果您确定所有位置的分辨率都被2除，则可以删除此选项。 <br><br>  AV1需要进行<code>-strict experimental</code> ，其编码器仍处于实验状态。 <br><br>  <code>video.av1.mp4</code>设置结果文件的名称。 <br><br><h3> 我们在浏览器中启动视频 </h3><br> 现在，我们需要每个浏览器下载其支持的视频。 为此，&lt;source&gt;具有<code>type</code>属性。 我建议您阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">&lt;video&gt;上</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">选项</a> 。 <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controls</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.hevc.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=hevc,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08,opus"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=avc1.4D401E,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  &lt;source&gt;就像<code>if…else</code>表达式-浏览器从上到下读取它们，直到找到支持其<code>type</code>表达式。 <br><br> 在<code>type</code>您可以指定整个文件格式：容器（对于MP4为<code>video/mp4</code> ），视频编解码器（对于AV1为<code>hevc</code>对于HEVC为<code>hevc</code>和对于H.264为<code>avc1.4D401E</code> ）和音频编解码器（Opus为opus和<code>mp4a.40.2</code>对于AAC）。 <br><br><h2> 奖励：如何将GIF转换为AV1和H.264 </h2><br> 在2019年，使用GIF播放短视频是一大罪恶。  GIF的重量是H.264或AV1的20-40倍。  GIF对CPU的打击更大，使电池泄漏更快。 如果您需要短循环视频，请使用视频编解码器。  FFmpeg可以直接从GIF转换视频。 <br><br> 将GIF转换为H.264： <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.h264.mp4</code> </pre><br> 生成更小的AV1： <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an opus -c:v libaom-av1 -crf 50 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br> 现在，将<code>animation.h264.mp4</code>和<code>animation.av1.mp4</code>插入HTML。 <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">muted</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">playsinline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <code>autoplay</code>和<code>loop</code>选项使视频成为“ GIF”，即在页面加载后立即播放的循环视频。 当您单击视频时， <code>playsinline</code>阻止Safari全屏打开视频。 <br><br><h2> 提款时间 </h2><br>  AV1仍处于实验阶段。 但是它已经可以用来使四分之一的用户感到幸福。 一对FFmpeg命令将生成视频文件。  &lt;video&gt;是从一开始就创建的，目的是根据浏览器功能呈现视频。 我们已经在生产中使用了AV1，并且一切正常（除了AV1编码器完成工作之前的等待时间）。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442020/">https://habr.com/ru/post/zh-CN442020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442010/index.html">Python和FPGA。 测试中</a></li>
<li><a href="../zh-CN442012/index.html">实验：我们收集发放护照的单位目录</a></li>
<li><a href="../zh-CN442014/index.html">Dart 2.2发布：更高效的机器代码，支持Set文字</a></li>
<li><a href="../zh-CN442016/index.html">黑客比绘画或如何保护Web应用程序更糟糕</a></li>
<li><a href="../zh-CN442018/index.html">宪法规定的春季法律。 为什么能</a></li>
<li><a href="../zh-CN442022/index.html">在CodeFest上设计。 但这并不确定</a></li>
<li><a href="../zh-CN442024/index.html">俄罗斯正在制定一项国家人工智能战略</a></li>
<li><a href="../zh-CN442026/index.html">Trojan.Multi.BroSubsc.gen-卡巴斯基的作品</a></li>
<li><a href="../zh-CN442028/index.html">职业类固醇。 武士之路</a></li>
<li><a href="../zh-CN442032/index.html">重新引入野牛（动物学家的小胜利）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>