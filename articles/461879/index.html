<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üñêÔ∏è üë∂üèΩ El libro "Linux en acci√≥n" üè∞ üßïüèæ ‚ûï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habrozhiteli! En el libro, David Clinton describe 12 proyectos del mundo real, incluida la automatizaci√≥n de un sistema de copia de seguridad y r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El libro "Linux en acci√≥n"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/461879/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/d4/en/xh/d4enxhes8pqnlk78urqxopa7ley.jpeg" align="left" alt="imagen"></a>  Hola habrozhiteli!  En el libro, David Clinton describe 12 proyectos del mundo real, incluida la automatizaci√≥n de un sistema de copia de seguridad y recuperaci√≥n, la configuraci√≥n de una nube de archivos personal de estilo Dropbox y la creaci√≥n de su propio servidor MediaWiki.  Con ejemplos interesantes, aprender√° sobre virtualizaci√≥n, recuperaci√≥n ante desastres, seguridad, respaldo, implementaci√≥n de DevOps y resoluci√≥n de problemas del sistema.  Cada cap√≠tulo termina con una revisi√≥n de recomendaciones pr√°cticas, un glosario de nuevos t√©rminos y ejercicios. <br><br><h3>  Extracto "10.1.  Crear un t√∫nel OpenVPN ¬ª </h3><br><a name="habracut"></a>  En este libro, ya he hablado mucho sobre el cifrado.  SSH y SCP pueden proteger los datos transmitidos a trav√©s de conexiones remotas (cap√≠tulo 3), el cifrado de archivos le permite proteger los datos cuando se almacenan en el servidor (cap√≠tulo 8), y los certificados TLS / SSL pueden proteger los datos durante la transmisi√≥n entre sitios y navegadores de clientes (cap√≠tulo 9).  Pero a veces sus datos requieren protecci√≥n en una gama m√°s amplia de conexiones.  Por ejemplo, es posible que algunos miembros de su equipo tengan que trabajar en la carretera, conect√°ndose a la red a trav√©s de Wi-Fi a trav√©s de puntos de acceso p√∫blico.  Definitivamente no debe suponer que todos estos puntos de acceso son seguros, pero su gente realmente necesita una forma de conectarse a los recursos de la compa√±√≠a, en cuyo caso una VPN ayudar√°. <br><br>  Un t√∫nel VPN correctamente dise√±ado proporciona una conexi√≥n directa entre clientes remotos y el servidor de tal manera que oculta datos cuando se transmiten a trav√©s de una red insegura.  ¬øY qu√©?  Ya has visto muchas herramientas que pueden hacer esto con el cifrado.  El valor real de las VPN es que al abrir el t√∫nel, puede conectar redes remotas, como si todas fueran locales.  En cierto sentido, est√° utilizando una soluci√≥n alternativa. <br><br>  Usando una red tan extendida, los administradores pueden hacer su trabajo en sus servidores desde cualquier lugar.  Pero, lo que es m√°s importante, una empresa con recursos distribuidos en varias sucursales puede hacerlos visibles y accesibles para todos los grupos que los necesitan, donde sea que est√©n (Fig. 10.1). <br><br>  El t√∫nel en s√≠ no garantiza la seguridad.  Pero uno de los est√°ndares de cifrado se puede incluir en la estructura de la red, lo que aumenta significativamente el nivel de seguridad.  Los t√∫neles creados con el paquete OpenVPN de c√≥digo abierto usan el mismo cifrado TLS / SSL del que ya le√≠ste.  OpenVPN no es la √∫nica opci√≥n disponible para hacer t√∫neles, sino una de las m√°s famosas.  Se cree que es un poco m√°s r√°pido y m√°s seguro que un protocolo de t√∫nel de capa 2 alternativo que utiliza encriptaci√≥n IPsec. <br><br>  ¬øDesea que todos en su equipo se comuniquen de manera segura entre ellos mientras est√°n en la carretera o trabajando en diferentes edificios?  Para hacer esto, debe crear un servidor OpenVPN para permitir el uso compartido de aplicaciones y el acceso al entorno de red local del servidor.  Para que esto funcione, es suficiente iniciar dos m√°quinas virtuales o dos contenedores: uno para actuar como servidor / host y el otro para el cliente.  Crear una VPN no es un proceso f√°cil, por lo que probablemente valga la pena tomarse unos minutos para tener una idea general. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vg/gc/o1/vggco1j4npzsjj4rqo8r-5bzmz8.png" alt="imagen"></div><br><h3>  10.1.1.  Configurar el servidor OpenVPN </h3><br>  Antes de comenzar, te dar√© consejos √∫tiles.  Si va a hacer todo usted mismo (y lo recomiendo encarecidamente), probablemente encontrar√° que est√° trabajando con varias ventanas de terminal abiertas en el Escritorio, cada una de las cuales est√° conectada a su m√°quina.  Existe el riesgo de que en alg√∫n momento ingrese el comando incorrecto en la ventana.  Para evitar esto, puede usar el comando hostname para cambiar el nombre de la m√°quina que se muestra en la l√≠nea de comando a algo que le diga claramente d√≥nde se encuentra.  Tan pronto como haga esto, deber√° salir del servidor e iniciar sesi√≥n nuevamente para que la nueva configuraci√≥n surta efecto.  As√≠ es como se ve: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/d9/o9/b8d9o9pzt2-m5-rtirtr46hl1lu.png" alt="imagen"></div><br>  Adhiri√©ndose a este enfoque y asignando los nombres correspondientes a cada una de las m√°quinas con las que trabaja, puede rastrear f√°cilmente d√≥nde se encuentra. <br><br><blockquote>  Despu√©s de usar el nombre de host, puede encontrar molestos mensajes de No se puede resolver Host OpenVPN-Server cuando ejecuta los siguientes comandos.  La actualizaci√≥n del archivo / etc / hosts con el nuevo nombre de host correspondiente deber√≠a solucionar el problema. </blockquote><br><h3>  Preparando su servidor para OpenVPN </h3><br>  La instalaci√≥n de OpenVPN en su servidor requiere dos paquetes: openvpn y easy-rsa (para controlar el proceso de generaci√≥n de la clave de cifrado).  Si es necesario, los usuarios de CentOS deben instalar primero el repositorio de epel-release, como lo hizo en el cap√≠tulo 2. Para poder verificar el acceso a la aplicaci√≥n del servidor, tambi√©n puede instalar el servidor web Apache (apache2 para Ubuntu y httpd en CentOS). <br><br>  Mientras configura el servidor, le aconsejo que active un firewall que bloquee todos los puertos excepto el 22 (SSH) y el 1194 (el puerto predeterminado de OpenVPN).  Este ejemplo ilustra c√≥mo funcionar√° ufw en Ubuntu, pero estoy seguro de que a√∫n recuerda el programa CentOS del firewall del cap√≠tulo 9: <br><br><pre><code class="javascript hljs"># ufw enable # ufw allow <span class="hljs-number"><span class="hljs-number">22</span></span> # ufw allow <span class="hljs-number"><span class="hljs-number">1194</span></span></code> </pre> <br>  Para permitir el enrutamiento interno entre las interfaces de red en el servidor, debe descomentar una l√≠nea (net.ipv4.ip_forward = 1) en el archivo /etc/sysctl.conf.  Esto le permitir√° redirigir clientes remotos seg√∫n sea necesario despu√©s de que se conecten.  Para que el nuevo par√°metro funcione, ejecute sysctl -p: <br><br><pre> <code class="javascript hljs"># nano /etc/sysctl.conf # sysctl -p</code> </pre> <br>  Ahora el entorno del servidor est√° completamente configurado, pero hay algo m√°s que hacer antes de que est√© listo: deber√° completar los siguientes pasos (los consideraremos con m√°s detalle a continuaci√≥n). <br><br><ol><li>  Cree un conjunto de claves en el servidor para cifrar la infraestructura de clave p√∫blica (PKI) utilizando los scripts que vienen con el paquete easy-rsa.  En esencia, el servidor OpenVPN tambi√©n act√∫a como su propia autoridad de certificaci√≥n (CA). </li><li>  Prepare las claves apropiadas para el cliente. </li><li>  Configure el archivo server.conf para el servidor </li><li>  Configure su cliente OpenVPN </li><li>  Verifica tu VPN </li></ol><br><h3>  Generaci√≥n de clave de cifrado </h3><br>  Para no complicar su vida, puede configurar su infraestructura clave en la misma m√°quina donde se ejecuta el servidor OpenVPN.  Sin embargo, las recomendaciones de seguridad generalmente sugieren el uso de un servidor de CA separado para implementaciones en un entorno de producci√≥n.  El proceso de generaci√≥n y asignaci√≥n de recursos clave de cifrado para su uso en OpenVPN se ilustra en la Fig.  10.2 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/vl/a0/rwvla0o86yzylrzsytcf--7bnms.png" alt="imagen"></div><br>  Cuando instal√≥ OpenVPN, el directorio / etc / openvpn / se cre√≥ autom√°ticamente, pero todav√≠a no hay nada en √©l.  Los paquetes openvpn y easy-rsa vienen con archivos de plantilla de muestra que puede usar como base para su configuraci√≥n.  Para iniciar el proceso de certificaci√≥n, copie el directorio de plantilla easy-rsa de / usr / share / to / etc / openvpn y cambie al directorio easy-rsa /: <br><br><pre> <code class="javascript hljs"># cp -r /usr/share/easy-rsa/ <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn $ cd /etc/openvpn/easy-rsa</code> </pre> <br>  El directorio easy-rsa ahora contendr√° bastantes scripts.  En la mesa  10.1 enumera las herramientas que usar√° para crear claves. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ih/zx/zt/ihzxztprk0hm0gr9ozc8sz9qsgs.png" alt="imagen"></div><br><blockquote>  Estas operaciones requieren privilegios de root, por lo que a trav√©s de sudo su debe convertirse en root. </blockquote><br>  El primer archivo con el que trabajar√° se llama vars y contiene las variables de entorno que easy-rsa usa al generar claves.  Debe editar el archivo para usar sus propios valores en lugar de los valores predeterminados que ya existen.  As√≠ es como se ver√° mi archivo (Listado 10.1). <br><br>  Listado 10.1.  Los fragmentos principales del archivo / etc / openvpn / easy-rsa / vars <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_COUNTRY=<span class="hljs-string"><span class="hljs-string">"CA"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_PROVINCE=<span class="hljs-string"><span class="hljs-string">"ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_CITY=<span class="hljs-string"><span class="hljs-string">"Toronto"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_ORG=<span class="hljs-string"><span class="hljs-string">"Bootstrap IT"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_EMAIL=<span class="hljs-string"><span class="hljs-string">"info@bootstrap-it.com"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_OU=<span class="hljs-string"><span class="hljs-string">"IT"</span></span></code> </pre> <br>  La ejecuci√≥n del archivo vars le permitir√° transferir sus valores al entorno de shell, desde donde se incluir√°n en el contenido de sus nuevas claves.  ¬øPor qu√© no funciona solo el comando sudo?  Porque en la primera etapa, editamos el script llamado vars y luego lo aplicamos.  Aplicaci√≥n y significa que el archivo vars transfiere sus valores al entorno de shell, desde donde se incluir√°n en el contenido de sus nuevas claves. <br><br>  Aseg√∫rese de volver a ejecutar el archivo utilizando el nuevo shell para completar el proceso inacabado.  Cuando se hace esto, el script le pedir√° que ejecute otro script, clean-all, para eliminar cualquier contenido en el directorio / etc / openvpn / easy-rsa / keys /: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2v/b4/ot/2vb4otncxyedhork8j0cs29s_64.png" alt="imagen"></div><br>  Naturalmente, el siguiente paso es ejecutar el script clean-all, seguido de build-ca, que utiliza el script pkitool para crear el certificado ra√≠z.  Se le pedir√° que confirme la configuraci√≥n de autenticaci√≥n proporcionada por vars: <br><br><pre> <code class="javascript hljs"># ./clean-all # ./build-ca Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> bit RSA private key</code> </pre> <br>  Luego viene la secuencia de comandos del servidor build-key.  Como usa el mismo script pkitool junto con el nuevo certificado ra√≠z, ver√° las mismas preguntas para confirmar la creaci√≥n del par de claves.  Las claves recibir√°n nombres en funci√≥n de los argumentos que pase, que, a menos que inicie varias VPN en esta computadora, generalmente ser√°n servidores, como en el ejemplo: <br><br><pre> <code class="javascript hljs"># ./build-key-server server [...] Certificate is to be certified until Aug <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2027</span></span> GMT (<span class="hljs-number"><span class="hljs-number">3650</span></span> days) Sign the certificate? [y/n]:y <span class="hljs-number"><span class="hljs-number">1</span></span> out <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> certificate requests certified, commit? [y/n]y Write out database <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> entries Data Base Updated</code> </pre> <br>  OpenVPN usa los par√°metros generados por el algoritmo Diffie-Hellman (usando build-dh) para negociar la autenticaci√≥n de nuevas conexiones.  El archivo creado aqu√≠ no debe ser secreto, sino que debe generarse utilizando el script build-dh para las claves RSA que est√°n activas actualmente.  Si crea nuevas claves RSA en el futuro, tambi√©n necesitar√° actualizar el archivo basado en el algoritmo Diffie-Hellman: <br><br><pre> <code class="javascript hljs"># ./build-dh</code> </pre> <br>  Sus claves del lado del servidor ahora estar√°n en el directorio / etc / openvpn / easy-rsa / keys /, pero OpenVPN no lo sabe.  Por defecto, OpenVPN buscar√° claves en / etc / openvpn /, as√≠ que c√≥pielas: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/server* <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn # cp /etc/openvpn/easy-rsa/keys/dh2048.pem /etc/openvpn # cp /etc/openvpn/easy-rsa/keys/ca.crt /etc/openvpn</code> </pre> <br><h3>  Preparaci√≥n de claves de cifrado del cliente </h3><br>  Como ya ha visto, el cifrado TLS utiliza pares de claves correspondientes: una est√° instalada en el servidor y la otra en el cliente remoto.  Esto significa que necesitar√° claves de cliente.  Nuestro viejo amigo pkitool es exactamente lo que necesitas para esto.  En este ejemplo, ejecutando el programa en el directorio / etc / openvpn / easy-rsa /, le pasamos el argumento del cliente para generar archivos llamados client.crt y client.key: <br><br><pre> <code class="javascript hljs"># ./pkitool client</code> </pre> <br>  Los dos archivos del cliente, junto con el archivo ca.crt original, que todav√≠a est√° en el directorio keys /, ahora deben transferirse de manera segura a su cliente.  Debido a sus derechos de afiliaci√≥n y acceso, esto puede no ser tan f√°cil.  El enfoque m√°s f√°cil es copiar manualmente el contenido del archivo fuente (y nada m√°s que este contenido) al terminal que se ejecuta en el escritorio de su PC (seleccione el texto, haga clic derecho sobre √©l y seleccione Copiar en el men√∫).  Luego pegue esto en un nuevo archivo con el mismo nombre que cre√≥ en el segundo terminal conectado a su cliente. <br><br>  Pero cualquiera puede cortar y pegar.  En cambio, piense como administrador, porque no siempre tendr√° acceso a la GUI, donde es posible una operaci√≥n de cortar / pegar.  Copie los archivos en el directorio de inicio de su usuario (para que la operaci√≥n scp remota pueda acceder a ellos), y luego use chown para cambiar el propietario de los archivos de root a un usuario regular no root para que se pueda realizar la acci√≥n scp remota.  Aseg√∫rese de que todos sus archivos est√©n actualmente instalados y accesibles.  Los mover√° al cliente un poco m√°s tarde: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/client.key /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/ca.crt /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/client.crt /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/client.key # chown ubuntu:ubuntu /home/ubuntu/client.crt # chown ubuntu:ubuntu /home/ubuntu/ca.crt</code> </pre> <br>  Con un conjunto completo de claves de cifrado listas para la acci√≥n, debe decirle al servidor c√≥mo desea crear una VPN.  Esto se hace usando el archivo server.conf. <br><br><blockquote>  <b>Reduce la cantidad de pulsaciones de teclas</b> <br><br>  ¬øDemasiado para imprimir?  Una extensi√≥n con par√©ntesis ayudar√° a reducir estos seis comandos a dos.  Estoy seguro de que puede estudiar estos dos ejemplos y comprender lo que est√° sucediendo.  M√°s importante a√∫n, puede comprender c√≥mo aplicar estos principios a las operaciones que involucran docenas o incluso cientos de elementos: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/{ca.crt,client.{key,crt}} /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/{ca.crt,client.{key,crt}}</code> </pre> <br></blockquote><br><h3>  Configurar el archivo server.conf </h3><br>  ¬øC√≥mo puede saber c√≥mo deber√≠a ser el archivo server.conf?  ¬øRecuerda la plantilla de directorio easy-rsa que copi√≥ de / usr / share /?  Durante la instalaci√≥n de OpenVPN, qued√≥ un archivo de plantilla de configuraci√≥n comprimido, que puede copiar a / etc / openvpn /.  Construir√© sobre el hecho de que la plantilla ha sido archivada y te presentar√© una herramienta √∫til: zcat. <br><br>  Ya sabe c√≥mo mostrar el contenido de texto de un archivo con el comando cat, pero ¬øqu√© sucede si el archivo se comprime con gzip?  Siempre puede descomprimir el archivo y luego cat lo mostrar√° con gusto, pero este es uno o dos pasos m√°s de lo necesario.  En cambio, como probablemente ya haya adivinado, puede ingresar el comando zcat para cargar el texto desempaquetado en la memoria en un solo paso.  En el siguiente ejemplo, en lugar de imprimir texto en la pantalla, lo redirige a un nuevo archivo llamado server.conf: <br><br><pre> <code class="javascript hljs"># zcat \ /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz \ &gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn/server.conf $ cd /etc/openvpn</code> </pre> <br>  Dejamos de lado la extensa y √∫til documentaci√≥n que vino con el archivo y vemos c√≥mo podr√≠a verse cuando termine de editar.  Tenga en cuenta que el punto y coma (;) le dice a OpenVPN que no lea ni ejecute la siguiente l√≠nea (Listado 10.2). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/en/4r/ften4rayxj99stxecmfjb9mx8eg.png" alt="imagen"></div><br>  Veamos algunas de estas configuraciones. <br><br><ul><li>  De forma predeterminada, OpenVPN funciona a trav√©s del puerto 1194. Puede cambiar esto, por ejemplo, para ocultar sus acciones a√∫n m√°s o para evitar conflictos con otros t√∫neles activos.  Como 1194 requiere una coordinaci√≥n m√≠nima con los clientes, es mejor hacerlo. </li><li>  OpenVPN utiliza el Protocolo de control de transmisi√≥n (TCP) o el Protocolo de datagramas de usuario (UDP) para la transferencia de datos.  TCP puede ser un poco m√°s lento, pero es m√°s confiable y es m√°s probable que las aplicaciones que se ejecutan en ambos extremos del t√∫nel lo entiendan. </li><li>  Puede decirle a dev tun cu√°ndo desea crear un t√∫nel IP m√°s simple y eficiente que transmita el contenido de los datos y nada m√°s.  Si, por otro lado, necesita conectar varias interfaces de red (y las redes que representan) creando un puente Ethernet, deber√° seleccionar dev tap.  Si no comprende lo que significa todo esto, use el argumento tun. </li><li>  Las siguientes cuatro l√≠neas pasan los nombres OpenVPN de los tres archivos de autenticaci√≥n en el servidor y el archivo de configuraci√≥n dh2048 que cre√≥ anteriormente. </li><li>  La l√≠nea del servidor establece el rango y la m√°scara de subred que se utilizar√°n para asignar direcciones IP a los clientes al iniciar sesi√≥n. </li><li>  El par√°metro push opcional "ruta 10.0.3.0 255.255.255.0" permite a los clientes remotos acceder a subredes privadas detr√°s del servidor.  Para realizar este trabajo, tambi√©n debe configurar la red en el servidor, de modo que la subred privada conozca la subred OpenVPN (10.8.0.0). </li><li>  La l√≠nea localhost 80 de puerto compartido le permite redirigir el tr√°fico del cliente que llega a trav√©s del puerto 1194 al servidor web local que escucha en el puerto 80. (Esto ser√° √∫til si tiene la intenci√≥n de utilizar el servidor web para probar su VPN). Esto solo funciona si cuando se selecciona el protocolo tcp. </li><li>  El usuario nobody y el grupo nogroup lines deben estar activos; para hacer esto, elimine los puntos y comas (;).  Al obligar a los clientes remotos a trabajar con nobody y nogroup, se garantiza que las sesiones en el servidor no tengan privilegios. </li><li>  log indica que las entradas de registro actuales sobrescribir√°n las entradas antiguas cada vez que se inicie OpenVPN, mientras que log-append agrega nuevas entradas a un archivo de registro existente.  El archivo openvpn.log se escribe en el directorio / etc / openvpn /. </li></ul><br>  Adem√°s, el valor de cliente a cliente tambi√©n se agrega a menudo al archivo de configuraci√≥n para que varios clientes puedan verse entre s√≠ adem√°s del servidor OpenVPN.  Si est√° satisfecho con su configuraci√≥n, puede iniciar el servidor OpenVPN: <br><br><pre> <code class="javascript hljs"># systemctl start openvpn</code> </pre> <br><blockquote>  Debido a la naturaleza cambiante de la relaci√≥n entre OpenVPN y systemd, a veces puede ser necesaria la siguiente sintaxis para iniciar un servicio: systemctl start openvpn @ server. </blockquote><br>  Ejecutar ip addr para mostrar la lista de interfaces de red de su servidor ahora deber√≠a mostrar un enlace a una nueva interfaz llamada tun0.  OpenVPN lo crear√° para servir a los clientes entrantes: <br><br><pre> <code class="javascript hljs">$ ip addr [...] <span class="hljs-number"><span class="hljs-number">4</span></span>: tun0: mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> qdisc [...] link/none inet <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> peer <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> scope global tun0 valid_lft forever preferred_lft forever</code> </pre> <br>  Es posible que deba reiniciar el servidor antes de que todo comience a funcionar por completo.  La siguiente parada es la computadora del cliente. <br><br><h3>  10.1.2.  Configuraci√≥n del cliente OpenVPN </h3><br>  Tradicionalmente, los t√∫neles se construyen con al menos dos salidas (de lo contrario, los llamar√≠amos cuevas).  Un OpenVPN configurado correctamente en el servidor dirige el tr√°fico hacia y desde el t√∫nel, por un lado.  Pero tambi√©n necesita alg√∫n tipo de software del lado del cliente, es decir, en el otro extremo del t√∫nel. <br><br>  En esta secci√≥n, me enfocar√© en configurar manualmente una computadora Linux de un tipo u otro para que funcione como un cliente OpenVPN.  Pero esta no es la √∫nica forma en que esta oportunidad est√° disponible.  OpenVPN admite aplicaciones cliente que se pueden instalar y utilizar en computadoras de escritorio y port√°tiles con Windows o macOS, as√≠ como en tel√©fonos inteligentes y tabletas basados ‚Äã‚Äãen Android e iOS.  Ver openvpn.net para m√°s detalles. <br><br>  El paquete OpenVPN deber√° instalarse en la computadora del cliente, tal como se instal√≥ en el servidor, aunque no hay necesidad de easy-rsa, ya que las claves que usa ya existen.  Debe copiar el archivo de plantilla client.conf en el directorio / etc / openvpn / que acaba de crear.  Esta vez, el archivo no se archivar√°, por lo que el comando cp normal har√° esta tarea perfectamente: <br><br><pre> <code class="javascript hljs"># apt install openvpn # cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf \ /etc/openvpn/</code> </pre> <br>  La mayor√≠a de las configuraciones en su archivo client.conf ser√°n bastante sencillas: deben coincidir con los valores en el servidor.  Como puede ver en el siguiente ejemplo de archivo, el par√°metro √∫nico es remoto 192.168.1.23 1194, que le indica al cliente la direcci√≥n IP del servidor.  Nuevamente, aseg√∫rese de que esta sea la direcci√≥n de su servidor.  Tambi√©n debe obligar a la computadora cliente a autenticar el certificado del servidor para evitar un posible ataque de intermediario.  Una forma de hacerlo es agregar la l√≠nea de servidor remote-cert-tls (Listado 10.3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m1/nw/2w/m1nw2wwrhwag7fct4mr4ggng5n4.png" alt="imagen"></div><br>  Ahora puede ir al directorio / etc / openvpn / y extraer las claves de certificaci√≥n del servidor.  Reemplace la direcci√≥n IP del servidor o el nombre de dominio en el ejemplo con sus valores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/u1/rm/ngu1rmk8tyxrntuepummte1wxuo.png" alt="imagen"></div><br>  Es probable que no ocurra nada emocionante hasta que ejecute OpenVPN en el cliente.  Como necesita pasar un par de argumentos, lo har√° desde la l√≠nea de comandos.  El argumento --tls-client le dice a OpenVPN que actuar√° como cliente y se conectar√° usando el cifrado TLS, y --config se√±ala su archivo de configuraci√≥n: <br><br><pre> <code class="javascript hljs"># openvpn --tls-client --config /etc/openvpn/client.conf</code> </pre> <br>  Lea la salida del comando cuidadosamente para asegurarse de que est√° conectado correctamente.  Si por primera vez algo sale mal, esto puede deberse a una falta de coincidencia entre la configuraci√≥n entre el servidor y los archivos de configuraci√≥n del cliente o un problema de conexi√≥n de red / firewall.  Aqu√≠ hay algunos consejos para la soluci√≥n de problemas. <br><br><ul><li>  Lea atentamente el resultado de la operaci√≥n OpenVPN en el cliente.  A menudo contiene valiosos consejos sobre qu√© no se puede realizar exactamente y por qu√©. </li><li>  Verifique los mensajes de error en los archivos openvpn.log y openvpn-status.log en el directorio / etc / openvpn / en el servidor. </li><li>  Verifique los mensajes relacionados con OpenVPN y los tiempos apropiados en los registros del sistema en el servidor y el cliente.  (journalctl -ce mostrar√° las entradas m√°s recientes). </li><li>  Aseg√∫rese de tener una conexi√≥n de red activa entre el servidor y el cliente (para m√°s detalles, consulte el cap√≠tulo 14). </li></ul><br><h3>  Sobre el autor </h3><br>  <b>David Clinton</b> es administrador del sistema, maestro y escritor.  Administr√≥, escribi√≥ sobre √©l y cre√≥ materiales de capacitaci√≥n para muchas disciplinas t√©cnicas importantes, incluidos los sistemas Linux, la computaci√≥n en la nube (en particular AWS) y las tecnolog√≠as de contenedores como Docker.  Escribi√≥ el libro Learn Amazon Web Services en un mes de almuerzos (Manning, 2017).  Muchos de sus videos tutoriales se pueden encontrar en Pluralsight.com, y los enlaces a sus otros libros (sobre administraci√≥n de Linux y virtualizaci√≥n de servidores) est√°n disponibles en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bootstrap-it.com</a> . <br><br>  ¬ªSe puede encontrar m√°s informaci√≥n sobre el libro en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sitio web del editor</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenidos</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Extracto</a> <br><br>  Cup√≥n de 25% de descuento para vendedores ambulantes - <b>Linux</b> <br>  Tras el pago de la versi√≥n en papel del libro, se env√≠a un libro electr√≥nico por correo electr√≥nico. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461879/">https://habr.com/ru/post/461879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461867/index.html">C√≥mo reconocer im√°genes y textos en su tel√©fono usando ML Kit</a></li>
<li><a href="../461871/index.html">101 consejos para convertirte en un buen programador (y humano)</a></li>
<li><a href="../461873/index.html">ViewPager 2: nueva funcionalidad en el contenedor antiguo</a></li>
<li><a href="../461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../461877/index.html">Java vs Kotlin para Android: opiniones de desarrolladores</a></li>
<li><a href="../461881/index.html">Gu√≠a de registro de Node.js</a></li>
<li><a href="../461885/index.html">EDS es otro tipo de fraude</a></li>
<li><a href="../461887/index.html">Entrando en Aeronet Episodio 2: Homing Drone</a></li>
<li><a href="../461891/index.html">C√≥mo nos hicimos amigos en la infraestructura bancaria usando ManageIQ</a></li>
<li><a href="../461895/index.html">Aprenda mientras viaja: c√≥mo conducimos el 1er D√≠a Europeo del An√°lisis Empresarial</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>