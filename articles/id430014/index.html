<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔬 💔 📻 Kelas tertutup. Semantik vs kinerja 👯 👋🏽 🎉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mungkin bukan saya sendiri setelah membaca dokumentasi tentang kelas-kelas tersegel saya berpikir: “Oke. Mungkin suatu hari akan berguna. ” Kemudian, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kelas tertutup. Semantik vs kinerja</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430014/">  Mungkin bukan saya sendiri setelah membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi tentang kelas-kelas tersegel</a> saya berpikir: “Oke.  Mungkin suatu hari akan berguna. ”  Kemudian, ketika dalam pekerjaan saya, saya bertemu beberapa tugas di mana saya berhasil menggunakan alat ini, saya berpikir: “Tidak buruk.  Anda harus sering memikirkan aplikasi. "  Dan akhirnya, saya menemukan deskripsi kelas tugas dalam buku <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Java Efektif (Joshua Bloch, 3)</a> (ya, dalam buku tentang Jawa). <br><br>  Mari kita lihat satu aplikasi dan mengevaluasinya dalam hal semantik dan kinerja. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/th/tb/bb/thtbbbw3gitb5qb4n5sxhgq0oag.jpeg"></div><a name="habracut"></a><br>  Saya pikir semua orang yang bekerja dengan UI pernah bertemu implementasi interaksi UI dengan <i>layanan</i> melalui beberapa <i>negara</i> , di mana salah satu atributnya adalah beberapa <i>jenis penanda</i> .  Mekanisme pemrosesan negara berikutnya dalam implementasi seperti itu, biasanya secara langsung tergantung pada penanda yang ditentukan.  Sebagai contoh, implementasi dari kelas <b>Negara</b> : <br><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: String?, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> error: Throwable? ) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ LOADING, ERROR, EMPTY, DATA } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Kami membuat daftar kerugian dari implementasi semacam itu (coba sendiri)</b> <div class="spoiler_text"><blockquote>  Kata-kata dari bab 23 dari buku "Memilih hierarki kelas untuk menandai kelas".  Saya mengusulkan untuk berkenalan dengannya. </blockquote><br><ol><li>  Konsumsi memori untuk atribut yang diinisialisasi hanya untuk tipe tertentu.  Faktornya bisa signifikan dalam volume besar.  Situasi ini diperburuk jika objek default dibuat untuk mengisi atribut. </li><li>  Beban semantik yang berlebihan.  Pengguna kelas perlu memonitor untuk tipe apa, atribut apa yang tersedia. </li><li>  Dukungan rumit dalam kelas logika bisnis.  Misalkan implementasi di mana suatu objek dapat melakukan beberapa operasi pada datanya.  Kelas semacam itu akan terlihat seperti <i>pemanen</i> , dan menambahkan tipe atau operasi baru bisa menjadi sulit. </li></ol><br></div></div><br>  Memproses status baru mungkin terlihat seperti ini: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">State</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span>(state.type) { State.Type.LOADING -&gt; onLoading() State.Type.ERROR -&gt; state.error?.run(::onError) ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Unexpected error state: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$state</span></span></span><span class="hljs-string">"</span></span>) State.Type.EMPTY -&gt; onEmpty() State.Type.DATA -&gt; state.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>?.run(::onData) ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Unexpected data state: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$state</span></span></span><span class="hljs-string">"</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Throwable</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEmpty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {}</code> </pre><br>  Harap dicatat bahwa untuk negara-negara seperti ERROR dan DATA, kompiler tidak dapat menentukan keamanan menggunakan atribut, sehingga pengguna harus menulis kode yang berlebihan.  Perubahan dalam semantik hanya dapat dideteksi saat runtime. <br><br><h3>  Kelas tertutup </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/956/e26/aba/956e26abadccbdf82049a80523cf6c87.jpg" alt="gambar"></div><br>  Dengan refactoring sederhana, kita dapat membagi <b>Negara</b> kita menjadi sekelompok kelas: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> //    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stateless</span></span></span><span class="hljs-class">  -     </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Loading</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> error: Throwable) : State() <span class="hljs-comment"><span class="hljs-comment">//  ,     ,  stateless  -  singleton object Empty : State() data class Data(val data: String) : State()</span></span></code> </pre><br>  Di sisi pengguna, kami mendapatkan pemrosesan status, di mana aksesibilitas atribut akan ditentukan pada tingkat bahasa, dan penyalahgunaan akan menyebabkan kesalahan pada tahap kompilasi: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">State</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span>(state) { Loading -&gt; onLoading() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Error -&gt; onError(state.error) Empty -&gt; onEmpty() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Data -&gt; onData(state.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) } }</code> </pre><br>  Karena hanya atribut signifikan yang ada dalam salinan, kita dapat berbicara tentang menghemat memori dan, yang terpenting, meningkatkan semantik.  Pengguna kelas tersegel tidak perlu mengimplementasikan aturan secara manual untuk bekerja dengan atribut tergantung pada <i>penanda jenis</i> , ketersediaan atribut dipastikan dengan pemisahan menjadi jenis. <br><br><h3>  Apakah semua ini gratis? </h3><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Tidak, tidak gratis. <br></div></div><br>  Pengembang Java yang mencoba Kotlin pasti telah melihat kode yang didekompilasi untuk melihat seperti apa istilah Java Kotlin.  Ekspresi dengan <b>kapan</b> akan terlihat seperti ini: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull State state)</span></span></span><span class="hljs-function"> </span></span>{ Intrinsics.checkParameterIsNotNull(state, <span class="hljs-string"><span class="hljs-string">"state"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Intrinsics.areEqual(state, Loading.INSTANCE)) { onLoading(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Error) { onError(((Error)state).getError()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Intrinsics.areEqual(state, Empty.INSTANCE)) { onEmpty(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Data) { onData(((Data)state).getData()); } }</code> </pre><br>  Cabang dengan banyak <b>contoh</b> mungkin mengkhawatirkan karena stereotip tentang "tanda kode buruk" dan "dampak kinerja", tetapi kami tidak tahu.  Penting untuk membandingkan kecepatan eksekusi, misalnya, menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jmh</a> . <br><br>  Berdasarkan artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Mengukur kecepatan kode Java dengan benar"</a> , sebuah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tes</a> pemrosesan empat negara (LOADING, ERROR, EMPTY, DATA) telah disiapkan, berikut adalah hasilnya: <br><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units CompareSealedVsTagged.sealed thrpt 500 940739,966 ± 5350,341 ops/s CompareSealedVsTagged.tagged thrpt 500 1281274,381 ± 10675,956 ops/s</code> </pre><br>  Dapat dilihat bahwa implementasi yang disegel bekerja lebih lambat 25% (ada asumsi bahwa lag tidak akan melebihi 10-15%). <br><br>  Jika pada empat tipe kita memiliki seperempat lag, dengan tipe yang meningkat (jumlah instance dari cek), lag hanya akan tumbuh.  Untuk memeriksanya, kami akan menambah jumlah jenis menjadi 16 (misalkan kami telah berhasil mendapatkan hierarki yang begitu luas): <br><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units CompareSealedVsTagged.sealed thrpt 500 149493,062 ± 622,313 ops/s CompareSealedVsTagged.tagged thrpt 500 235024,737 ± 3372,754 ops/s</code> </pre><br>  Bersama dengan penurunan produktivitas, kelambatan penjualan yang disegel meningkat menjadi ≈35% - keajaiban tidak terjadi. <br><br><h3>  Kesimpulan </h3><br>  Dalam artikel ini, kami tidak menemukan Amerika, dan menyegel implementasi di cabang-cabang contohnya benar-benar bekerja lebih lambat daripada perbandingan tautan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/et/y-/dqety-iylhzbywcxttnbxtu29ri.jpeg"></div><br>  Namun demikian, beberapa pemikiran perlu disuarakan: <br><br><ul><li>  dalam kebanyakan kasus, kami ingin bekerja dengan semantik kode yang baik, mempercepat pengembangan karena petunjuk tambahan dari IDE dan pemeriksaan kompiler - dalam kasus seperti itu, Anda dapat menggunakan kelas tersegel </li><li>  jika Anda tidak dapat mengorbankan kinerja dalam tugas, Anda harus mengabaikan implementasi yang disegel dan menggantinya, misalnya, dengan implementasi tagget.  Mungkin Anda harus sepenuhnya meninggalkan kotlin demi bahasa tingkat rendah </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id430014/">https://habr.com/ru/post/id430014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id430002/index.html">Red Hat Enterprise Linux 8 Beta - Bersamaan Dengan Dunia</a></li>
<li><a href="../id430004/index.html">Pelacak GPS tidak bersertifikat dari Cina. Apakah itu legal di Rusia?</a></li>
<li><a href="../id430006/index.html">Proyek Ilmu Data dari penelitian hingga implementasi menggunakan Talking Hat sebagai contoh</a></li>
<li><a href="../id430008/index.html">Ugears: kuda, berlayar, dan hiburan kerajaan lainnya</a></li>
<li><a href="../id430010/index.html">Buka pelajaran "Bagaimana tidak: anti-contoh dalam analisis proses bisnis"</a></li>
<li><a href="../id430016/index.html">Para ilmuwan dengan bingung mengakui bahwa mereka masih belum tahu persis besarnya interaksi gravitasi</a></li>
<li><a href="../id430024/index.html">Bagaimana kecelakaan pesawat dapat meningkatkan penguraian TI</a></li>
<li><a href="../id430026/index.html">Nio memiliki 18 stasiun penggantian baterai, yang mencakup lebih dari 2.000 km jalan tol</a></li>
<li><a href="../id430028/index.html">10 konferensi dan hackathon mendatang di Moskow</a></li>
<li><a href="../id430030/index.html">Bagaimana kami mengganti pemandu olahraga dengan jaringan saraf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>