<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”› ğŸ’…ğŸ¼ ğŸ‘¨ğŸ¿â€ğŸš€ Performance Orchester ğŸ‘°ğŸ¼ ğŸ‘¨ğŸ½â€ğŸ“ ğŸ‘ƒğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist kaum falsch zu sagen, dass die besten Leute 
 Freude durch Leiden gewinnen. 
 Ludwig van Beethoven 





 Ich bin Sergey und arbeite bei Yandex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Performance Orchester</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/443822/"><p>  <em>Es ist kaum falsch zu sagen, dass die besten Leute</em> <em><br></em>  <em>Freude durch Leiden gewinnen.</em> <em><br></em>  <em>Ludwig van Beethoven</em> </p><br><p><img src="https://habrastorage.org/webt/9k/ht/xx/9khtxxwiwqsesccfpb5n2sbrnwo.jpeg"></p><br><p>  Ich bin Sergey und arbeite bei Yandex.Money in einem Performance-Forschungsteam.  Ich mÃ¶chte Ihnen den Beginn einer Geschichte Ã¼ber unseren Weg zur Verwendung von Orchestrierung erzÃ¤hlen - wie wir Instrumente ausgewÃ¤hlt haben und was wir berÃ¼cksichtigt haben.  Alle Ereignisse aus dem Artikel finden in Echtzeit statt, sodass Sie, liebe Leser, die Entwicklung der Situation fast live verfolgen kÃ¶nnen. </p><a name="habracut"></a><br><h2 id="zachem-nam-dirizhyor-v-komande">  Warum brauchen wir einen Dirigenten im Team? </h2><br><p>  Wer ist Dirigent?  Von fr.  diriger - managen, leiten, fÃ¼hren - in der Welt der Musik - das ist eine Person, die das Lernen und AuffÃ¼hren von Ensemblemusik anfÃ¼hrt.  In unserem Fall wird dieser Ort von Orchestrierungs- und Automatisierungssystemen belegt. </p><br><p>  Ihre Rolle unterscheidet sich nicht von der des Dirigenten in der Musik - sie werden benÃ¶tigt, um dem Team zu helfen, sein Spiel zu leiten und zu organisieren. </p><br><p>  In der Regel verfÃ¼gt ein Team Ã¼ber bestimmte KapazitÃ¤ten. Nennen wir sie Server, auf denen sie ihre Projekte implementieren. </p><br><p>  Der Ansatz zum Erhalt und Betrieb dieser Server ist vielfÃ¤ltig.  Einige Beispiele: </p><br><ul><li>  Das Team fordert beispielsweise die Operationsgruppe auf, ihnen Ressourcen mit bestimmten Parametern bereitzustellen. </li><li>  Die Betriebsgruppe stellt ihnen die erforderliche Menge zur VerfÃ¼gung - Cloud oder Bare Metal (â€Bare Metalâ€œ) - und verpflichtet sich, sie gemÃ¤ÃŸ SLA in gutem Zustand zu halten.  Die Anpassung wird auch vom Betriebsteam durchgefÃ¼hrt. </li><li>  Das Team erhÃ¤lt nur Cloud- oder Bare-Metal-Ressourcen von der Betriebsgruppe und nimmt seine eigenen Einstellungen vor. </li><li>  Das Team selbst â€kauftâ€œ Ressourcen und unterstÃ¼tzt / konfiguriert sie vÃ¶llig unabhÃ¤ngig. </li></ul><br><p>  Unser Team verwendet Server, die unterstÃ¼tzt werden mÃ¼ssen - aktualisieren Sie das Betriebssystem, installieren Sie neue Pakete usw. </p><br><p>  FÃ¼r uns haben wir sie in zwei Haupttypen unterschieden: </p><br><ul><li>  Tankgruppe </li><li>  Servicegruppe. </li></ul><br><p>  Die Panzergruppe besteht aus Hosts mit Yandex.Tank. </p><br><p>  Die Servicegruppe umfasst alles, was mit Wartung zu tun hat. Hierbei handelt es sich um verschiedene Services, die den Freigabezyklus unterstÃ¼tzen, automatische Berichte erstellen usw. </p><br><p>  Irgendwann wurde es unpraktisch, dies alles manuell zu verwalten, und wir Ã¼berlegten, den gesamten Prozess zu automatisieren, angefangen beim â€Ladenâ€œ der Server bis hin zur Entwicklung, dem Layout und dem Start unseres internen Dienstes. </p><br><h2 id="pochemu-dirizhyor-nuzhen-dazhe-esli-orkestr-sam-umeet-igrat">  Warum wird ein Dirigent benÃ¶tigt, auch wenn das Orchester selbst spielen kann? </h2><br><p>  ZunÃ¤chst haben wir Ansible gemeistert und begonnen, unsere Bare-Metal-Server so zu â€gieÃŸenâ€œ, dass sie weniger von Systemadministratoren abhÃ¤ngig sind. Jeder gewinnt hier, wir erwerben neue FÃ¤higkeiten und entlasten Administratoren von dem Teil der Arbeit, den sie immer ohne uns haben.  Wir bemÃ¼hen uns, unser Team so weit wie mÃ¶glich auÃŸerhalb unserer SpezialitÃ¤t und Autonomie zu entwickeln. </p><br><p>  Das Unternehmen arbeitet bereits seit langer Zeit mit Ansible zusammen, das bereits eingerichtet und reguliert wurde. Daher haben wir unsere LÃ¶sung problemlos in diesen Prozess integriert. </p><br><p>  Das Hosting besteht jetzt aus drei Ansible-Rollen: </p><br><ul><li>  Die erste Rolle installiert das Betriebssystem. </li><li>  Die zweite Option enthÃ¤lt die Grundeinstellungen fÃ¼r den Host, z. B. die LDAP-Autorisierung. </li><li>  und der dritte installiert Yandex.Tank und verwandte AbhÃ¤ngigkeiten im Docker-Container. </li></ul><br><p>  Kommen wir zu den Diensten, die wir im Team nutzen. </p><br><p> FÃ¼r unsere Aufgaben verwenden wir gleichermaÃŸen Kotlin und Python und etwas mehr Golang.  Um die Entwicklung und Bereitstellung unserer Dienste zu vereinheitlichen, haben wir beschlossen, sie in Docker-Container zu verpacken.  Dies gibt die Freiheit, eine Programmiersprache zu wÃ¤hlen, und regelt gleichzeitig das einheitliche Ãœbermittlungsformat ihrer Anwendung. </p><br><h3 id="nebolshaya-remarka-pro-ipv6-v-docker">  Eine kleine Bemerkung zu IPv6 in Docker </h3><br><p>  Einige der Dienste, mit denen wir interagieren, sind nur Ã¼ber IPv6 verfÃ¼gbar, daher musste ich herausfinden, wie IPv6 fÃ¼r Container erstellt werden kann. </p><br><p>  GemÃ¤ÃŸ der Dokumentation fÃ¼r ipv6 auf der offiziellen Docker-Website wird ipv6 durch HinzufÃ¼gen von Parametern zu daemon.json aktiviert: </p><br><pre><code class="plaintext hljs">{ "ipv6": true, "fixed-cidr-v6": "2001:db8:1::/64" }</code> </pre> <br><p>  In diesem Fall sollte der Anbieter das IPv6-Subnetz ausgeben, das Sie in <code>fixed-cidr-v6.</code> <br>  Wir haben uns jedoch fÃ¼r eine andere Option entschieden - ipv6 NAT, und hier ist der Grund dafÃ¼r: </p><br><ul><li>  Jetzt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kann</a> Docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht</a> nur mit IPv6 verwendet werden. </li><li>  Das Vorhandensein einer global routbaren Adresse in jedem Container bedeutet, dass alle Ports (auch unverÃ¶ffentlichte) fÃ¼r alle verfÃ¼gbar sind, wenn keine zusÃ¤tzliche Filterung durchgefÃ¼hrt wird. </li><li>  Userland-Proxy zum VerÃ¶ffentlichen von Ports, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">iptables nur fÃ¼r ipv4</a> . </li></ul><br><p>  ipv6 NAT ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Docker-Container</a> , der die Regeln in ip6tables selbst verwaltet und bearbeitet, wenn ein neuer Container hinzugefÃ¼gt wird. </p><br><p>  Damit diese LÃ¶sung ordnungsgemÃ¤ÃŸ funktioniert, mussten einige Manipulationen durchgefÃ¼hrt werden.  Stellen Sie sicher, dass Sie ip6table_nat auf dem System initialisieren.  Das Vorhandensein eines im System installierten Moduls garantiert nicht, dass das Modul beim Start in den Kernel geladen wird.  Wir sind darauf gestoÃŸen, als wir diesen Fehler beim Starten eines Containers mit NAT auf einem neuen Host erhalten haben: </p><br><pre> <code class="plaintext hljs">2019/01/22 14:59:54 running [/sbin/ip6tables -t filter -N DOCKER --wait]: exit status 3: modprobe: can't change directory to '/lib/modules': No such file or directory ip6tables v1.6.2: can't initialize ip6tables table `filter': Table does not exist (do you need to insmod?)</code> </pre> <br><p>  Das Problem wurde behoben, nachdem die Initialisierung mithilfe des Modprobe-Moduls zur Ansible-Rolle hinzugefÃ¼gt und beim Start mit lineinfile geladen wurde: </p><br><pre> <code class="plaintext hljs">- name: Add ip6table_nat module modprobe: name: ip6table_nat state: present - name: Add ip6table_nat to boot lineinfile: path: /etc/modules line: 'ip6table_nat'</code> </pre> <br><p>  Ãœbrigens gibt es einen guten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> Ã¼ber den Haber, der kurz und klar die Vor- und Nachteile einer bestimmten Methode fÃ¼r ipv6 in Docker beschreibt. </p><br><p>  Aber zurÃ¼ck zu unserer am Anfang gestellten Frage: <br>  <strong>Warum wird ein Dirigent benÃ¶tigt, auch wenn das Orchester selbst spielen kann?</strong> </p><br><p>  Jetzt weiÃŸ jeder, wie man in unserem Team spielt: </p><br><ul><li>  der Prozess des "FÃ¼llens" der Server wird erstellt, </li><li>  Entwicklung und Bereitstellung von Diensten sind vereinheitlicht. </li></ul><br><p>  Es stellt sich die vernÃ¼nftige Frage, wie unsere Dienste in Docker-Containern effizient und so automatisiert wie mÃ¶glich bereitgestellt, aktualisiert und gesteuert werden kÃ¶nnen. </p><br><p>  Trotz der Tatsache, dass jedes Orchestermitglied seinen eigenen Teil kennt, kann er sich verirren und von der ursprÃ¼nglichen Idee abweichen.  Hier kommen wir zu der Tatsache, dass unser Orchester ohne Dirigenten nicht effektiv proben und harmonisch spielen kann.  Der Dirigent ist fÃ¼r alle Leistungsparameter verantwortlich, um sicherzustellen, dass alles in einem einzigen Tempo und einer einzigen Stimmung vereint ist. </p><br><h2 id="kak-s-minimalnymi-vlozheniyami-poluchit-horoshego-dirizhera">  Wie bekomme ich einen guten Dirigenten mit minimalen Investitionen? </h2><br><p>  Das Thema Orchestrierung ist auf dem Markt gut entwickelt.  Aber zuerst sprechen wir Ã¼ber unterstÃ¼tzende Werkzeuge, die dem Dirigenten helfen kÃ¶nnen. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Consul</a> ist ein System, das zwei Hauptfunktionen bietet: </p><br><ul><li>  Serviceerkennung </li><li>  verteilter SchlÃ¼sselwertspeicher. </li></ul><br><p>  In unserem Orchester ist der Konsul fÃ¼r die Registrierung der Dienste und die Speicherung ihrer Konfigurationen verantwortlich.  Es gibt zwei Registrierungsoptionen: </p><br><ul><li>  Aktiv - In diesem Fall registriert sich der Dienst selbst Ã¼ber die HTTP-API. </li><li>  Passiv - Der Dienst muss manuell registriert werden. </li></ul><br><p>  Vault ist ein Repository, das den sicheren Speicher standardisiert und vereinheitlicht und mit Geheimnissen arbeitet - PasswÃ¶rtern, Zertifikaten. <br>  Hier sind die Vorteile, die wir mit diesem Tool erhalten: </p><br><ul><li>  Ein einziges Zentrum zum Erstellen und Aufbewahren von Geheimnissen und zum Verwalten ihres Lebenszyklus Ã¼ber die HTTP-API. </li><li>  Transit Secrets Engine - VerschlÃ¼sselung-EntschlÃ¼sselung von Daten ohne Speicherung.  Die FÃ¤higkeit, Daten in verschlÃ¼sselter Form Ã¼ber ungesicherte KommunikationskanÃ¤le zu Ã¼bertragen. </li><li>  Greifen Sie auf Richtlinien zu, die bequem zu konfigurieren sind. </li><li>  ÃœberprÃ¼fen Sie den Zugriff auf Geheimnisse. </li><li>  MÃ¶glichkeit, eine eigene Zertifizierungsstelle (Certificate Authority) fÃ¼r die Verwaltung selbstsignierter Zertifikate in Ihrer Infrastruktur zu erstellen. </li></ul><br><p>  In Anbetracht all unserer Anforderungen passten zwei Optionen zur Rolle des Dirigenten - Kubernetes und Nomad. </p><br><h4 id="kubernetes">  Kubernetes </h4><br><p>  Wie viele Artikel und BÃ¼cher bereits Ã¼ber ihn geschrieben wurden (zum Beispiel dieser), wurde berichtet, dass ich kurz schreiben werde - dies ist ein universeller Prozessor, der fast alles kann.  Es ist nicht immer einfach, einen Cluster auf Kubernetes einzurichten und zu unterstÃ¼tzen. </p><br><h4 id="nomad">  Nomad </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das Tool stammt</a> von HashiCorp, einem Unternehmen, das fÃ¼r den oben genannten Konsul und das Tresor bekannt ist. </p><br><p>  Nomad schien uns eher einfach zu installieren und zu konfigurieren als Kubernetes.  Eine BinÃ¤rdatei funktioniert sowohl im Server- als auch im Client-Modus.  Gleichzeitig deckt Nomad die gesamte Liste der Aufgaben ab, die gelÃ¶st werden sollen: Clusterverwaltung, schneller Scheduler, UnterstÃ¼tzung fÃ¼r mehrere Zentren.  Wenn wir Konsul und Tresor verwenden, erhalten wir auÃŸerdem eine engere Integration, um unsere Dienste zu koordinieren. </p><br><p>  Was ist jetzt in Arbeit: </p><br><ul><li>  bereitete die Server fÃ¼r die Bereitstellung von Consul vor, </li><li>  Die Konfiguration des Nomadenclusters wird in Consul eingegeben, mit dem Nomaden automatisch bereitgestellt werden sollen. </li><li>  Parallel dazu werden wir Vault installieren, um Geheimnisse zu bewahren. </li></ul><br><p>  Die Frage im Saal ist, ob es sich lohnt, einen Dirigenten fÃ¼r solche Aufgaben zu haben, oder ob ein Orchester ohne ihn gut ist.  Sagen Sie uns in den Kommentaren, was Sie darÃ¼ber denken. </p><br><hr><br><p>  Abonnieren Sie unseren Blog und bleiben Sie in Kontakt - wir werden Ihnen bald mitteilen, was am Ende passiert ist und ob wir den Nomadencluster so konfiguriert haben, wie wir es wollten. </p><br><p>  Besuchen Sie unseren gemÃ¼tlichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegramm-Chatroom,</a> in dem Sie jederzeit um Rat fragen, Kollegen helfen und einfach Ã¼ber Leistungsforschung und mehr sprechen kÃ¶nnen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443822/">https://habr.com/ru/post/de443822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443812/index.html">So implementieren Sie eine Programmiersprache in JavaScript. Teil 2: Dolmetscher</a></li>
<li><a href="../de443814/index.html">Geben ist mein "ehemaliges GeschÃ¤ft"</a></li>
<li><a href="../de443816/index.html">Das Kommunikationsministerium besteht auf einem einzigen 5G-Betreiber</a></li>
<li><a href="../de443818/index.html">MÃ¤rz IT Events Digest (Teil Zwei)</a></li>
<li><a href="../de443820/index.html">Wie der Flughafen Fukuoka herausfand, welche MaÃŸnahmen zur Reduzierung der Warteschlangen wirksam sind</a></li>
<li><a href="../de443824/index.html">5 GrÃ¼nde, auf den 3D-Druck von Metallprodukten umzusteigen</a></li>
<li><a href="../de443826/index.html">Veralterung von Unterrichtsmaterialien verhindern</a></li>
<li><a href="../de443828/index.html">Die UrsprÃ¼nge der Startup-Kultur: Wie die frÃ¼hen Erfolgsgeschichten den modernen Zustand der Tech-Industrie prÃ¤gten</a></li>
<li><a href="../de443830/index.html">Tesla stellte das neue Modell Y vor - Details, Fotos von der PrÃ¤sentation und EindrÃ¼cke der Probefahrt</a></li>
<li><a href="../de443834/index.html">Runet um die Jahrtausendwende: Woran erinnern Sie sich?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>