<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯП┤єаБзєаБвєаБеєаБоєаБзєаБ┐ ЁЯОА ЁЯСиЁЯП╗тАНЁЯФм InfoWatch рдЯреНрд░реИрдлрд┐рдХ рдореЙрдирд┐рдЯрд░ рдкрд░ рд▓реЛрдб рд╕рдВрддреБрд▓рди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ ЁЯШЛ ЁЯСйЁЯП╝тАНЁЯОУ тЬВя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдпрджрд┐ рдПрдХ рд╕рд░реНрд╡рд░ рдХреА рд╢рдХреНрддрд┐ рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдирд┐рд░реНрдорд╛рддрд╛ рд▓реЛрдб рд╕рдВрддреБрд▓рди рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ рдореБрдЭреЗ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>InfoWatch рдЯреНрд░реИрдлрд┐рдХ рдореЙрдирд┐рдЯрд░ рдкрд░ рд▓реЛрдб рд╕рдВрддреБрд▓рди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ntc-vulkan/blog/484964/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/4w/ol/wf/4wolwfpah48j6egm8hqmcn4we5o.png"></div><br><p>  рдпрджрд┐ рдПрдХ рд╕рд░реНрд╡рд░ рдХреА рд╢рдХреНрддрд┐ рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдирд┐рд░реНрдорд╛рддрд╛ рд▓реЛрдб рд╕рдВрддреБрд▓рди рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ рдореБрдЭреЗ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?  рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ - рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдЦрд░реАрджрдиреЗ рд╕реЗ рд▓реЗрдХрд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рддрдХ рд╕реАрдорд┐рдд рдХрд░рдирд╛ред  рдХреМрди рд╕рд╛ рд╕рд╣реА рд╣реИ, рдЖрдкрдХреЛ рдореМрдЬреВрджрд╛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рд╕реНрдерд┐рддрд┐ рдХреЛ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдЖрдкрдХреЛ рдмрддрд╛рдПрдВрдЧреЗ рдХрд┐ рдмрдЬрдЯ рд╕реАрдорд┐рдд рд╣реЛрдиреЗ рдкрд░ рдХреНрдпрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирд┐рд╢реБрд▓реНрдХ рд╕рд░реНрд╡рд░ рдЙрдкрд▓рдмреНрдз рд╣реИред </p><a name="habracut"></a><br><p>  рдЬрд┐рд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдПрдХ рдкрд░ рд▓реЛрдб рдХреЛ рдХрдо рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛, рд╣рдордиреЗ рдЗрдиреНрдлреЛрд╡реЙрдЪ рдбреАрдПрд▓рдкреА (рдЗрдиреНрдлреЙрд░реНрдореЗрд╢рди рд▓реАрдХ рдкреНрд░реАрдпрд░ рд╕рд┐рд╕реНрдЯрдо) рдХреЛ рдЪреБрдирд╛ред  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ "рдореБрдХрд╛рдмрд▓рд╛" рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рдмреИрд▓реЗрдВрд╕рд░ рдлрд╝рдВрдХреНрд╢рди рдХреА рдирд┐рдпреБрдХреНрддрд┐ рдереАред </p><br><p>  рдЬрд┐рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╣рдореЗрдВ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛, рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╕реНрд░реЛрдд NAT (SNAT) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрдерддрд╛ рд╣реИред  рдЗрд╕рдХреА рдХреНрдпрд╛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА рдФрд░ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдХреИрд╕реЗ рд╣реБрдЖ, рд╣рдо рдЖрдЧреЗ рдмрддрд╛рдПрдВрдЧреЗред </p><br><p>  рдЗрд╕рд▓рд┐рдП, рдореМрдЬреВрджрд╛ рдкреНрд░рдгрд╛рд▓реА рдХрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рддрд╛рд░реНрдХрд┐рдХ рдЖрд░реЗрдЦ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдерд╛: </p><br><img src="https://habrastorage.org/webt/jn/p_/w1/jnp_w1x4tilvkrdpsk98z0ikwxo.jpeg"><br><p>  ICAP рдЯреНрд░реИрдлрд╝рд┐рдХ, SMTP, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рдИрд╡реЗрдВрдЯ рдЯреНрд░реИрдлрд╝рд┐рдХ рдореЙрдиреАрдЯрд░ (TM) рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП рдЧрдП рдереЗред  рдЙрд╕реА рд╕рдордп, рдбреЗрдЯрд╛рдмреЗрд╕ рд╕рд░реНрд╡рд░ рдиреЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЯреАрдПрдо рдкрд░ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд▓реЛрдб рдХрд╛ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдЯреАрдПрдо рдкрд░ рд▓реЛрдб рдмрдбрд╝рд╛ рдерд╛ред  рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдореЙрдиреАрдЯрд░ (рдбреАрдПрдо) рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рдХреА рдШрдЯрдирд╛ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЯреАрдПрдо рдкрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдФрд░ рдореЗрдореЛрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдерд╛ред </p><br><p>  рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ, рдЕрдЧрд░ рд╣рдо рдЗрд╕ рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХ рдФрд░ TM рд╕рд░реНрд╡рд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рдпрд╛ рддреЛ ICAP рдпрд╛ DM рдХреЛ рдЗрд╕рдореЗрдВ рд╕реНрд╡рд┐рдЪ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдордиреЗ рдЗрд╕ рдкрджреНрдзрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЧрд▓рддреА рд╕рд╣рдирд╢реАрд▓рддрд╛ рдХрдо рд╣реЛ рдЧрдИ рдереАред </p><br><h1>  рд╕рдорд╛рдзрд╛рди рдХрд╛ рд╡рд░реНрдгрди </h1><br><p>  рд╕рд╣реА рд╕рдорд╛рдзрд╛рди рдЦреЛрдЬрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рд╣рдо <a href="http://www.linuxvirtualserver.org/">LVS рдХреЗ</a> рд╕рд╛рде рдорд┐рд▓рдХрд░ рдлреНрд░реАрд╡реЗрдпрд░ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдкрд░ рдмрд╕ рдЧрдПред  рдЪреВрдБрдХрд┐ рдЕрдиреБрдЧрд╛рдореА рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ LVS рдмреИрд▓реЗрдВрд╕рд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рднреА рдХрд░ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рд╣рдо рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗ (рдЯреАрдПрдо рдкрд░ рд▓реЛрдб рдХреЛ рдХрдо рдХрд░рдирд╛ рдФрд░ рджреЛрд╖ рд╕рд╣рд┐рд╖реНрдгреБрддрд╛ рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрддрд░ рдХреЛ рдмрдирд╛рдП рд░рдЦрдирд╛) рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><img src="https://habrastorage.org/webt/kr/yh/lz/kryhlzufx39kmzvq9ndepj_gpxi.jpeg"><br><p>  рдкреНрд░рджрд░реНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд╕реНрдЯрдо RedHat рдПрд╕рдПрдирдПрдЯреА рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдордиреЗ SNAT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ рддрд╛рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкреИрдХреЗрдЯ рдФрд░ рдЙрдирдХреЗ рдЙрддреНрддрд░ рдЙрд╕реА рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рднреЗрдЬреЗ рдЬрд╛рдПрдВ, рдЕрдиреНрдпрдерд╛ рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд┐рддреНрд░ рдорд┐рд▓реЗрдЧрд╛: </p><br><img src="https://habrastorage.org/webt/hl/zt/oa/hlztoaeuk5itpyjn_iv5kncmumw.jpeg"><br><p>  рдпрд╣ рдЕрд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░, рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдЖрдИрдкреА (рд╡реАрдЖрдИрдкреА) рдкрддреЗ рдкрд░ рдкреИрдХреЗрдЯ рднреЗрдЬрдиреЗ, рд╡реАрдЖрдИрдкреА рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдмреИрдХрдЕрдк рдХреЗ рд▓рд┐рдП рднреЗрдЬреЗ рдЧрдП рд╕рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдИрдкреА 2 рд╕реЗ рдЖрдПрдЧрд╛ред  рд╕рдорд╛рдзрд╛рди рдкрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛: рдмреИрдХрдЕрдк рдкрд░ рдПрдХ рдФрд░ рд░реВрдЯрд┐рдВрдЧ рдЯреЗрдмрд▓ рдмрдирд╛рдирд╛ рдФрд░ рджреЛ рдЯреАрдПрдо рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛, рдЬреИрд╕рд╛ рдХрд┐ рдиреАрдЪреЗ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: </p><br><img src="https://habrastorage.org/webt/24/bf/vp/24bfvpitjgkba5nxbqaftdeglhu.jpeg"><br><h1>  рд╕реЗрдЯрд┐рдВрдЧреНрд╕ </h1><br><p>  рд╣рдо ICAP, SMTP, TCP 9100 рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рджреЛ рд╕рд░реНрд╡рд░реЛрдВ рдХреА рдПрдХ рдпреЛрдЬрдирд╛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </p><br><p> рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рдЖрд░рдПрдЪрдИрдПрд▓ 6 рд╕рд░реНрд╡рд░ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдорд╛рдирдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдФрд░ рдкреИрдХреЗрдЬ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  рдЬрд┐рди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╣рдореЗрдВ рд╕рдВрддреБрд▓рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><p>  тАв рдЖрдИрд╕реАрдПрдкреА - рдЯреАрд╕реАрдкреА 1344; </p><br><p>  тАв рдПрд╕рдПрдордЯреАрдкреА - рдЯреАрд╕реАрдкреА 25ред </p><br><p>  рдбреАрдПрдо рдпрд╛рддрд╛рдпрд╛рдд рд╕реЗрд╡рд╛ - tcp 9100ред </p><br><p>  рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рд╡рд░реНрдЪреБрдЕрд▓ рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕ (VIP): </p><br><p>  тАв рдЖрдИрдкреА: 10.20.20.105ред </p><br><p>  рд╕рд░реНрд╡рд░ TM6_1: </p><br><p>  тАв рдмрд╛рд╣рд░реА рдЖрдИрдкреА: 10.20.20.101; </p><br><p>  тАв рдЖрдВрддрд░рд┐рдХ рдЖрдИрдкреА: 192.168.1.101ред </p><br><p>  рд╕рд░реНрд╡рд░ TM6_2: </p><br><p>  тАв рдмрд╛рд╣рд░реА рдЖрдИрдкреА: 10.20.20.102; </p><br><p>  тАв рдЖрдВрддрд░рд┐рдХ рдЖрдИрдкреА: 192.168.1.102ред </p><br><p>  рдлрд┐рд░ рджреЛ TM рд╕рд░реНрд╡рд░ рдкрд░ IP рдЕрдЧреНрд░реЗрд╖рдг рд╕рдХреНрд╖рдо рдХрд░реЗрдВред  RedHat рдкрд░ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, <a href="https://rhel7tutorial.wordpress.com/how-to-enable-ip-forwarding/">рдпрд╣рд╛рдБ</a> рд╡рд░реНрдгрд┐рдд <a href="https://rhel7tutorial.wordpress.com/how-to-enable-ip-forwarding/">рд╣реИ</a> ред </p><br><p>  рд╣рдо рддрдп рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреМрди рд╕рд╛ рд╕рд░реНрд╡рд░ рдореБрдЦреНрдп рд╣реЛрдЧрд╛, рдФрд░ рдХреМрди рд╕рд╛ - рдмреИрдХрдЕрдкред  рдорд╛рд╕реНрдЯрд░ рдХреЛ TM6_1 рд╣реЛрдиреЗ рджреЗрдВ, рдмреИрдХрдЕрдк TM6_2 рд╣реЛред </p><br><p>  рдмреИрдХрдЕрдк рдкрд░, рдПрдХ рдирдпрд╛ рдмреИрд▓реЗрдВрд╕рд░ рд░реВрдЯрд┐рдВрдЧ рдЯреЗрдмрд▓ рдФрд░ рд░реВрдЯрд┐рдВрдЧ рдирд┐рдпрдо рдмрдирд╛рдПрдВ: </p><br><pre><code class="plaintext hljs">[root@tm6_2 ~]echo 101 balancer &gt;&gt; /etc/iproute2/rt_tables [root@tm6_2 ~]ip rule add from 192.168.1.102 table balancer [root@tm6_2 ~]ip route add default via 192.168.1.101 table balancer</code> </pre> <br><p>  рд╕рд┐рд╕реНрдЯрдо рд░рд┐рдмреВрдЯ рд╣реЛрдиреЗ рддрдХ рдЙрдкрд░реЛрдХреНрдд рдХрдорд╛рдВрдб рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдиреНрд╣реЗрдВ <em>/etc/rc.d/rc.local</em> рдореЗрдВ рджрд░реНрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕реЗрдЯрд┐рдВрдЧ рдлрд╝рд╛рдЗрд▓ <em>/ etc / sysconfig / network-script / path-eth1 рдХреЗ</em> рдорд╛рдзреНрдпрдо рд╕реЗ рдмреЗрд╣рддрд░ (рдзреНрдпрд╛рди рджреЗрдВ: рдпрд╣ рдПрдХ рдЕрд▓рдЧ рд╡рд╛рдХреНрдпрд╡рд┐рдиреНрдпрд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ)ред </p><br><p>  рджреЛрдиреЛрдВ TM рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рд░рдЦреЗрдВред  рд╡рд┐рддрд░рдг рд╕реНрд░реЛрдд рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдордиреЗ rpmfind.net рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛: </p><br><pre> <code class="plaintext hljs">[root@tm6_1 ~]#yum install https://rpmfind.net/linux/centos/6.10/os/x86_64/Packages/keepalived-1.2.13-5.el6_6.x86_64.rpm</code> </pre> <br><p>  рдореБрдЦреНрдп рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ, рд╣рдо рдорд╛рд╕реНрдЯрд░ рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рддреЗ рд╣реИрдВ, рдЕрдиреНрдп - рдмреИрдХрдЕрдкред  рдлрд┐рд░ рд╣рдо рд▓реЛрдб рд╕рдВрддреБрд▓рди рдХреЗ рд▓рд┐рдП рд╡реАрдЖрдИрдкреА рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдлрд╝рд╛рдЗрд▓ рдЖрдорддреМрд░ рдкрд░ рдпрд╣рд╛рдВ рд╕реНрдерд┐рдд рд╣реИ: <em>/etc/keepalived/keepalived.conf</em> ред </p><br><div class="spoiler">  <b class="spoiler_title">TM1 рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрд┐рдВрдЧреНрд╕</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">vrrp_sync_group VG1 { group { VI_1 } } vrrp_instance VI_1 { state MASTER interface eth0 lvs_sync_daemon_inteface eth0 virtual_router_id 51 priority 151 advert_int 1 authentication { auth_type PASS auth_pass example } virtual_ipaddress { 10.20.20.105 } } virtual_server 10.20.20.105 1344 { delay_loop 6 lb_algo wrr lb_kind NAT protocol TCP real_server 192.168.1.101 1344 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 1344 nb_get_retry 3 delay_before_retry 3 } } real_server 192.168.1.102 1344 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 1344 nb_get_retry 3 delay_before_retry 3 } } } virtual_server 10.20.20.105 25 { delay_loop 6 lb_algo wrr lb_kind NAT protocol TCP real_server 192.168.1.101 25 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 25 nb_get_retry 3 delay_before_retry 3 } } real_server 192.168.1.102 25 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 25 nb_get_retry 3 delay_before_retry 3 } } } virtual_server 10.20.20.105 9100 { delay_loop 6 lb_algo wrr lb_kind NAT protocol TCP real_server 192.168.1.101 9100 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 9100 nb_get_retry 3 delay_before_retry 3 } } real_server 192.168.1.102 9100 { weight 1 TCP_CHECK { connect_timeout 3 connect_port 9100 nb_get_retry 3 delay_before_retry 3 } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">TM2 рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрд┐рдВрдЧреНрд╕</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">vrrp_sync_group VG1 { group { VI_1 } } vrrp_instance VI_1 { state BACKUP interface eth0 lvs_sync_daemon_inteface eth0 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_type PASS auth_pass example } virtual_ipaddress { 10.20.20.105 } }</code> </pre> </div></div><br><p>  рдорд╛рд╕реНрдЯрд░ LVS рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдЬреЛ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕рдВрддреБрд▓рд┐рдд рдХрд░реЗрдЧрд╛ред  рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдПрдХ рдмреИрд▓реЗрдВрд╕рд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рджреЛ рд╕рд░реНрд╡рд░ рд╣реИрдВред </p><br><pre> <code class="plaintext hljs">[root@tm6_1 ~]##yum install https://rpmfind.net/linux/centos/6.10/os/x86_64/Packages/ipvsadm-1.26-4.el6.x86_64.rpm</code> </pre> <br><p>  рдмреИрд▓реЗрдВрд╕рд░ рдХреЛ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдкрд╣рд▓реЗ рд╣реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд░рдЦрд╡рд╛рд▓реЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдЪрд┐рддреНрд░ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдСрдЯреЛрд░рди рдореЗрдВ рдЬреЛрдбрд╝реЗ рд░рдЦреЗрдВ: </p><br><pre> <code class="plaintext hljs">[root@tm6_1 ~]#chkconfig keepalived on</code> </pre> <br><h1>  рдирд┐рд╖реНрдХрд░реНрд╖ </h1><br><p>  <em>рдЬрд╛рдБрдЪ рдкрд░рд┐рдгрд╛рдо</em> </p><br><p>  рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛рдПрдБ: </p><br><pre> <code class="plaintext hljs">service keepalived start</code> </pre> <br><p>  <em>VRRP рд╡рд░реНрдЪреБрдЕрд▓ рдкрддрд╛ рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ</em> </p><br><p>  рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╡реАрдЖрдИрдкреА рдорд╛рд╕реНрдЯрд░ рдкрд░ рд╣реИ: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gi/ki/w_/gikiw_8kvn4oasjpykqljrpnjha.jpeg"></div><br><p>  рдФрд░ рдмреИрдХрдЕрдк рдкрд░ рдХреЛрдИ VIP рдирд╣реАрдВ рд╣реИ: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p7/8x/6o/p78x6o9prduqmsyknrjazt9lcoe.jpeg"></div><br><p>  рдкрд┐рдВрдЧ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, VIP рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1n/ev/b2/1nevb23tpstycsrbokowdm34-lk.jpeg"></div><br><p>  рдЕрдм рдЖрдк рдорд╛рд╕реНрдЯрд░ рдХреЛ рдмрдВрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ <code>ping</code> рдХрдорд╛рдВрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдкрд░рд┐рдгрд╛рдо рд╕рдорд╛рди рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдмреИрдХрдЕрдк рдкрд░ рд╣рдо рд╡реАрдЖрдИрдкреА рджреЗрдЦреЗрдВрдЧреЗ: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ny/ga/mg/nygamghufaycljxfyxamf6ixspk.jpeg"></div><br><p>  <em>рд╕реЗрд╡рд╛ рд╕рдВрддреБрд▓рди рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ</em> </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП SMTP рдХреЛ рд▓реЗрдВред  рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рджреЛ рдХрдиреЗрдХреНрд╢рди рдХреЛ 10.20.20.105 рдкрд░ рдЪрд▓рд╛рдПрдБ: </p><br><pre> <code class="plaintext hljs">telnet 10.20.20.105 25</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░ рдкрд░, рд╣рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рджреЛрдиреЛрдВ рдХрдиреЗрдХреНрд╢рди рд╕рдХреНрд░рд┐рдп рд╣реИрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">[root@tm6_1 ~]#watch ipvsadm тАУLn</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/54/uw/og/54uwogp1mozyhstfkkxfx1pc5ck.jpeg"></div><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдордиреЗ рдЯреАрдПрдо рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рдПрдХ рдмреИрд▓реЗрдВрд╕рд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд╕рд╛рде рдЯреАрдПрдо рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред  рд╣рдорд╛рд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП, рдЗрд╕рдиреЗ TM рдкрд░ рд▓реЛрдб рдХреЛ рдЖрдзрд╛ рдШрдЯрд╛ рджрд┐рдпрд╛, рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд╖реИрддрд┐рдЬ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреА рдХрдореА рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реАред </p><br><p>  рдЬреНрдпрд╛рджрд╛рддрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдпрд╣ рд╕рдорд╛рдзрд╛рди рдЬрд▓реНрджреА рдФрд░ рдмрд┐рдирд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд▓рд╛рдЧрдд рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдпреВрдбреАрдкреА рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕рдВрддреБрд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реАрдорд╛рдПрдБ рдФрд░ рдХрдард┐рдирд╛рдЗрдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi484964/">https://habr.com/ru/post/hi484964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi484944/index.html">рдореИрдВ ACID рдореЗрдВ рдХреНрдпрд╛ рд╣реВрдВ рдпрд╛ рд╣рдореЗрдВ рд╢реЛрднрд╛ рдирд╣реАрдВ рджреЗрддрд╛</a></li>
<li><a href="../hi484946/index.html">рдЬреАрдкреАрдЖрд░ рдореЙрдбрд▓рд┐рдВрдЧ</a></li>
<li><a href="../hi484948/index.html">NEC рдиреЗ рдПрдХ рд╕рдмрдорд░реАрди рдХреЗрдмрд▓ рдХреЛ рдСрдкреНрдЯрд┐рдХрд▓ рдлрд╛рдЗрдмрд░ рдХреЗ рд░рд┐рдХреЙрд░реНрдб 20 рдЬреЛрдбрд╝реЗ рдХреЗ рд╕рд╛рде рдЬрд╛рд░реА рдХрд┐рдпрд╛</a></li>
<li><a href="../hi484952/index.html">рдСрдмреНрдЬрд╝рд░реНрд╡рдмрд▓реНрд╕ рдФрд░ рд░рд┐рдПрдХреНрдЯ рд╣реБрдХ рдХреЗ рд╕рд╛рде Redux рдХреА рдЬрдЧрд╣</a></li>
<li><a href="../hi484954/index.html">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рджреГрд╢реНрдп рд╕рдорд╕реНрдпрд╛ рдирд┐рд╡рд╛рд░рдг рдЧрд╛рдЗрдб</a></li>
<li><a href="../hi484966/index.html">рд╕реНрдкреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдЯреЗрдореНрдкрд▓реЗрдЯ</a></li>
<li><a href="../hi484968/index.html">WPF DataGridред рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рд▓рд┐рдП рд▓рдбрд╝реЛ</a></li>
<li><a href="../hi484972/index.html">рд╢рд░рд╛рдм 5.0 рдЬрд╛рд░реА рдХрд┐рдпрд╛</a></li>
<li><a href="../hi484974/index.html">рдЯреНрдпреВрд░рд┐рдВрдЧ рдорд╢реАрди рд╕рд┐рдореБрд▓реЗрд╢рди рдХреЗ рд▓рд┐рдП рд╡рд╛рдВрдЧ рдЯрд╛рдЗрд▓реЗрдВ</a></li>
<li><a href="../hi484978/index.html">PubSub рд▓рдЧрднрдЧ рдореБрдлреНрдд рд╣реИ: PostgreSQL рдореЗрдВ NOTIFY рд╕реБрд╡рд┐рдзрд╛рдПрдБ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>