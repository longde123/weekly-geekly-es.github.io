<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃🏿 🌱 👸🏼 Apache Kafka + Spring Boot: مرحبًا ، خدمات microservices ✊🏽 🏠 👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبا يا هبر! في هذا المنشور ، سنكتب تطبيقًا على Spring Boot 2 باستخدام Apache Kafka ضمن Linux ، من تثبيت JRE إلى تطبيق microservice فعال. 

 يشكو زمل...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apache Kafka + Spring Boot: مرحبًا ، خدمات microservices</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440400/" style=";text-align:right;direction:rtl"> مرحبا يا هبر!  في هذا المنشور ، سنكتب تطبيقًا على Spring Boot 2 باستخدام Apache Kafka ضمن Linux ، من تثبيت JRE إلى تطبيق microservice فعال. <br><br>  يشكو زملاء من قسم تطوير الواجهة الأمامية الذين شاهدوا المقال من أنني لا أشرح ماهية أباتشي كافكا و Spring Boot.  أعتقد أن أي شخص يحتاج إلى تجميع مشروع مكتمل باستخدام التقنيات المذكورة أعلاه يعرف ما هو عليه ولماذا يحتاجون إليه.  إذا لم يكن السؤال في وضع الخمول بالنسبة للقارئ ، فإليك بعض المقالات الممتازة حول هبر وما هي <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">أباتشي كافكا</a> و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Spring Boot</a> . <br><br>  يمكننا الاستغناء عن توضيحات مطولة حول ماهية Kafka و Spring Boot و Linux وبدلاً من ذلك ، تشغيل خادم Kafka من نقطة الصفر على جهاز Linux ، وكتابة جهازي microservices وجعل أحدهما يرسل رسائل إلى الآخر - بشكل عام ، قم بتكوين العمارة الدقيقة الكاملة. <br><br><img src="https://habrastorage.org/webt/5d/p3/ab/5dp3abjx-c62zmfmmtp5tjvbjci.jpeg"><br><br>  سوف تتألف المشاركة من قسمين.  في البداية ، نقوم بتكوين وتشغيل Apache Kafka على جهاز Linux ، وفي الثانية نكتب جهازي خدمات مصغّرة في Java. <br><a name="habracut"></a><br>  في بدء التشغيل ، حيث بدأت مسيرتي المهنية كمبرمج ، كانت هناك خدمات microservices على Kafka ، كما عملت واحدة من خدمات microservices الخاصة بي مع آخرين من خلال Kafka ، لكنني لم أعرف كيف يعمل الخادم نفسه ، سواء كان مكتوبًا كتطبيق أم أنه محاصر بالفعل المنتج.  ما كان مفاجأة وخيبة الأمل عندما اتضح أن Kafka لا يزال منتجًا محاصرًا ، ولن تكون مهمتي هي كتابة عميل في Java (وهو ما أحب القيام به) ، بالإضافة إلى نشر وإعداد التطبيق النهائي كـ devOps (وهو ما أفترضه) أكره أن تفعل).  ومع ذلك ، حتى لو تمكنت من رفعه على خادم كافكا الافتراضي في أقل من يوم ، فمن السهل جدًا القيام بذلك.  هكذا <br><br>  سيكون لدينا تطبيق هيكل التفاعل التالي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wy/id/y5/wyidy5ttuw6eam5buszy6rb8z0m.jpeg"></div><br>  في نهاية المنشور ، كالعادة ، ستكون هناك روابط إلى git مع رمز العمل. <br><br><h1 style=";text-align:right;direction:rtl">  نشر Apache Kafka + Zookeeper على جهاز افتراضي </h1><br>  حاولت أن أرفع كافكا على نظام Linux المحلي ، وعلى الخشخاش وعلى نظام Linux البعيد.  في حالتين (Linux) ، نجحت بسرعة كبيرة.  مع الخشخاش حتى الآن لم يحدث شيء.  لذلك ، سنرفع كافكا على لينكس.  اخترت أوبونتو 18.04. <br><br>  ولكي تعمل كافكا ، فإنها تحتاج إلى حارس للحيوانات.  للقيام بذلك ، يجب عليك تنزيله وتشغيله قبل تشغيل Kafka. <br><br>  هكذا <br><br><h4 style=";text-align:right;direction:rtl">  0. تثبيت JRE </h4><br>  يتم ذلك عن طريق الأوامر التالية: <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">sudo apt-get update sudo apt-get install default-jre</code> </pre> <br>  إذا سارت الأمور على ما يرام ، يمكنك إدخال الأمر <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">java -version</code> </pre> <br>  وتأكد من تثبيت Java. <br><br><h4 style=";text-align:right;direction:rtl">  1. قم بتنزيل Zookeeper </h4><br>  أنا لا أحب الفرق السحرية على نظام Linux ، خاصةً عندما يقدمون بعض الأوامر فقط وليس من الواضح ما الذي يفعلونه.  لذلك ، سوف أصف كل إجراء - ماذا يفعل بالضبط.  لذلك ، نحن بحاجة إلى تنزيل Zookeeper وفك ضغطه في مجلد مناسب.  من المستحسن أن يتم تخزين جميع التطبيقات في مجلد / opt ، وهذا في حالتنا ، سيكون / opt / zookeeper. <br><br>  أنا استخدم الأمر أدناه.  إذا كنت تعرف أوامر Linux الأخرى التي ، برأيك ، ستتيح لك القيام بذلك بطريقة أكثر عنصرية بشكل صحيح ، استخدمها.  أنا مطور ، وليست مطورًا ، وأنا أتواصل مع الخوادم على مستوى "الماعز نفسه".  لذلك ، قم بتنزيل التطبيق: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">wget -P /home/xpendence/downloads/ <span class="hljs-string"><span class="hljs-string">"http://apache-mirror.rbc.ru/pub/apache/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz"</span></span></code> </pre> <br>  تم تنزيل التطبيق على المجلد الذي تحدده ، لقد قمت بإنشاء المجلد / home / xpendence / download لتنزيل جميع التطبيقات التي أحتاجها. <br><br><h4 style=";text-align:right;direction:rtl">  2. فك الحارس </h4><br>  استخدمت الأمر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">tar -xvzf /home/xpendence/downloads/zookeeper-3.4.12.tar.gz</code> </pre> <br>  يقوم هذا الأمر بفك ضغط الأرشيف في المجلد الذي توجد به.  قد تحتاج بعد ذلك إلى نقل التطبيق إلى / opt / zookeeper.  ويمكنك الدخول إليه على الفور ومن هناك فك الأرشيف بالفعل. <br><br><h4 style=";text-align:right;direction:rtl">  3. تحرير الإعدادات </h4><br>  في المجلد / zookeeper / conf / يوجد ملف zoo-sample.cfg ، أقترح إعادة تسميته إلى zoo.conf ، هذا هو الملف الذي سيبحث عنه JVM عند بدء التشغيل.  يجب إضافة ما يلي إلى هذا الملف في النهاية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">tickTime=2000 dataDir=/var/zookeeper clientPort=2181</code> </pre> <br>  أيضًا ، قم بإنشاء الدليل / var / zookeeper. <br><br><h4 style=";text-align:right;direction:rtl">  4. إطلاق Zookeeper </h4><br>  انتقل إلى المجلد / opt / zookeeper وابدأ تشغيل الخادم باستخدام الأمر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">bin/zkServer.sh start</code> </pre> <br>  يجب أن تظهر كلمة "STARTED". <br><br>  بعد ذلك ، أقترح التحقق من أن الخادم يعمل.  نكتب: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">telnet localhost 2181</code> </pre> <br>  يجب أن تظهر رسالة أن الاتصال كان ناجحًا.  إذا كان لديك خادم ضعيف ولم تظهر الرسالة ، فحاول مرة أخرى - حتى عند ظهور STARTED ، يبدأ التطبيق في الاستماع إلى المنفذ في وقت لاحق.  عندما حاولت كل هذا على خادم ضعيف ، حدث لي كل مرة.  إذا كان كل شيء متصلاً ، فأدخل الأمر <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ruok</code> </pre> <br>  ماذا يعني ذلك: "هل أنت بخير؟"  يجب أن يستجيب الخادم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">imok ( !)</code> </pre> <br>  وانقطع الاتصال.  لذلك ، كل شيء وفقا للخطة.  نشرع في إطلاق Apache Kafka. <br><br><h4 style=";text-align:right;direction:rtl">  5. إنشاء مستخدم تحت Kafka </h4><br>  للعمل مع كافكا نحتاج إلى مستخدم منفصل. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">sudo adduser --system --no-create-home --disabled-password --disabled-login kafka</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  6. تحميل اباتشي كافكا </h4><br>  هناك نوعان من التوزيعات - ثنائي ومصادر.  نحن بحاجة إلى ثنائي.  في المظهر ، الأرشيف مع ثنائي يختلف في الحجم.  يزن الثنائي 59 ميغابايت ، ويزن 6.5 ميغابايت. <br><br>  قم بتنزيل الملف الثنائي إلى الدليل هناك ، باستخدام الرابط أدناه: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">wget -P /home/xpendence/downloads/ <span class="hljs-string"><span class="hljs-string">"http://mirror.linux-ia64.org/apache/kafka/2.1.0/kafka_2.11-2.1.0.tgz"</span></span></code> </pre> <br><h4 style=";text-align:right;direction:rtl">  7. فك أباتشي كافكا </h4><br>  لا يختلف إجراء التفريغ عن نفس الشيء بالنسبة لـ Zookeeper.  نقوم أيضًا بفك ضغط الأرشيف في دليل / opt وإعادة تسميته إلى kafka بحيث يكون المسار إلى مجلد / bin هو / opt / kafka / bin <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">tar -xvzf /home/xpendence/downloads/kafka_2.11-2.1.0.tgz</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  8. تحرير الإعدادات </h4><br>  الإعدادات في /opt/kafka/config/server.properties.  أضف سطر واحد: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">delete.topic.enable = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  يبدو أن هذا الإعداد اختياري ، ويعمل بدونه.  يسمح لك هذا الإعداد بحذف الموضوعات.  خلاف ذلك ، لا يمكنك ببساطة حذف المواضيع من خلال سطر الأوامر. <br><br><h4 style=";text-align:right;direction:rtl">  9. نمنح حق الوصول إلى دليل المستخدم كافكا كافكا </h4><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">chown -R kafka:nogroup /opt/kafka chown -R kafka:nogroup /var/lib/kafka</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  10. الإطلاق الذي طال انتظاره لإباتشي كافكا </h4><br>  ندخل الأمر ، وبعد ذلك يبدأ كافكا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">/opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/server.properties</code> </pre> <br>  إذا لم تنتشر الإجراءات المعتادة (يتم كتابة كافكا بلغة جافا وسكالا) في السجل ، فكل شيء يعمل ويمكنك اختبار خدمتنا. <br><br><h4 style=";text-align:right;direction:rtl">  10.1.  مشاكل الخادم ضعيفة </h4><br>  لإجراء تجارب على Apache Kafka ، أخذت خادمًا ضعيفًا يحتوي على لب واحد و 512 ميجابايت من ذاكرة الوصول العشوائي (مقابل 99 روبل فقط) ، والتي تبين أنها عدة مشكلات بالنسبة لي. <br><br>  نفاد الذاكرة.  بالطبع ، لا يمكنك رفع تردد التشغيل بسعة 512 ميجابايت ، ولم يتمكن الخادم من نشر تطبيق كافكا بسبب نقص الذاكرة.  الحقيقة هي أن كافكا يستهلك بشكل افتراضي 1 غيغابايت من الذاكرة.  لا عجب أنه كان في عداد المفقودين :) <br><br>  نذهب إلى kafka-server-start.sh ، zookeeper-server-start.sh.  يوجد بالفعل خط ينظم الذاكرة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">export KAFKA_HEAP_OPTS=<span class="hljs-string"><span class="hljs-string">"-Xmx1G -Xms1G"</span></span></code> </pre> <br>  تغييره إلى: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">export KAFKA_HEAP_OPTS=<span class="hljs-string"><span class="hljs-string">"-Xmx256M -Xms128M"</span></span></code> </pre> <br>  هذا سوف يقلل من شهية كافكا ويسمح لك ببدء تشغيل الخادم. <br><br>  المشكلة الثانية مع الكمبيوتر الضعيف هي ضيق الوقت للاتصال بـ Zookeeper.  بشكل افتراضي ، يتم إعطاء هذا 6 ثوانٍ.  إذا كان الحديد ضعيفًا ، فهذا بالطبع لا يكفي.  في server.properties نزيد وقت الاتصال بـ zukipper: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">zookeeper.connection.timeout.ms=30000</code> </pre> <br>  أنا وضعت نصف دقيقة. <br><br><h4 style=";text-align:right;direction:rtl">  11. اختبار خادم كافكا </h4><br>  للقيام بذلك ، سوف نفتح محطتين ، على واحدة سنطلق المنتج ، والآخر - المستهلك. <br>  في وحدة التحكم الأولى ، أدخل سطر واحد: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">/opt/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  يجب أن يظهر هذا الرمز ، للإشارة إلى أن المنتج جاهز لإرسال رسائل غير مرغوب فيها: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">&gt;</code> </pre> <br>  في وحدة التحكم الثانية ، أدخل الأمر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">/opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --from-beginning</code> </pre> <br>  الآن ، بالكتابة في وحدة التحكم الخاصة بالمنتج ، عند الضغط على Enter ، ستظهر في وحدة التحكم الخاصة بالمستهلك. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/k7/uu/kf/k7uukff1u2kyygrgetrnvjnqmmg.png"></a> <br><br>  إذا رأيت على الشاشة نفس مثلي - تهانينا ، فالأسوأ قد انتهى! <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/n7/rg/lz/n7rglz4s3wvbqzg_chzjjooiazw.jpeg"></div><br>  الآن علينا فقط أن نكتب اثنين من العملاء على Spring Boot سيتواصلون مع بعضهم البعض من خلال Apache Kafka. <br><br><h1 style=";text-align:right;direction:rtl">  كتابة تطبيق على Spring Boot </h1><br>  سنكتب تطبيقين لتبادل الرسائل من خلال Apache Kafka.  سوف تسمى الرسالة الأولى kafka-server وسوف تحتوي على كل من المنتج والمستهلك.  سيطلق على الثاني اختبار kafka ، وهو مصمم بحيث يكون لدينا بنية microservice. <br><br><h3 style=";text-align:right;direction:rtl">  خادم kafka </h3><br>  لمشاريعنا التي تم إنشاؤها من خلال Spring Initializr ، نحن بحاجة إلى وحدة كافكا.  أضفت لومبوك وويب ، لكن هذه مسألة ذوق. <br><br>  يتكون عميل كافكا من مكونين - المنتج (يرسل رسائل إلى خادم كافكا) والمستهلك (يستمع إلى خادم كافكا ويأخذ رسائل جديدة من هناك حول الموضوعات التي اشترك فيها).  مهمتنا هي كتابة كلا المكونين وجعلها تعمل. <br><br>  المستهلك: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KafkaConsumerConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.server}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaServer; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.group.id}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaGroupId; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; batchFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BatchMessagingMessageConverter(converter())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; singleFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ConsumerFactory&lt;Long, AbstractDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringJsonMessageConverter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">converter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter(); } }</code> </pre> <br>  نحتاج إلى تهيئة حقلين ببيانات ثابتة من kafka.properties. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">kafka.server=localhost:<span class="hljs-number"><span class="hljs-number">9092</span></span> kafka.group.id=server.broadcast</code> </pre> <br>  kafka.server هو العنوان الذي يتوقف عليه خادمنا ، في هذه الحالة ، محلي.  بشكل افتراضي ، يستمع Kafka على المنفذ 9092. <br><br>  kafka.group.id هي مجموعة من العملاء ، يتم خلالها تسليم مثيل واحد من الرسالة.  على سبيل المثال ، لديك ثلاثة ناقلات في مجموعة واحدة ، وكلهم يستمعون إلى نفس الموضوع.  بمجرد ظهور رسالة جديدة على الخادم مع هذا الموضوع ، يتم تسليمها إلى شخص ما في المجموعة.  لا يتلقى المستهلكان المتبقيان الرسالة. <br><br>  بعد ذلك ، نقوم بإنشاء مصنع للمستهلكين - ConsumerFactory. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ConsumerFactory&lt;Long, AbstractDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs()); }</code> </pre> <br>  تم التهيئة مع الخصائص التي نحتاجها ، وسيكون بمثابة مصنع قياسي للمستهلكين في المستقبل. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; }</code> </pre> <br>  ConsumerConfigs هي مجرد خريطة التكوين.  نحن نقدم عنوان الخادم والمجموعة و deserializers. <br><br>  علاوة على ذلك ، واحدة من أهم النقاط للمستهلك.  يمكن للمستهلك استلام كل من الكائنات والمجموعات - على سبيل المثال ، كل من StarshipDto و List.  وإذا حصلنا على StarshipDto كـ JSON ، فسنحصل على قائمة كـ ، بصفتها صفيف JSON تقريبًا.  لذلك ، لدينا مصنعان للرسالة على الأقل - للرسائل الفردية وللصفائف. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; singleFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; }</code> </pre> <br>  نحن إنشاء مثيل ConcurrentKafkaListenerContainerFactory ، كتابة طويلة (مفتاح الرسالة) و AbstractDto (قيمة الرسالة المجردة) ، وتهيئة حقولها بخصائص.  نحن ، بطبيعة الحال ، نهيئ المصنع من خلال المصنع القياسي (الذي يحتوي بالفعل على تهيئة الخريطة) ، ثم نحتفل على أننا لا نستمع إلى الحزم (نفس المصفوفات) ونحدد محول JSON البسيط كمحول. <br><br>  عندما ننشئ مصنعًا للحزم / المصفوفات (الدُفعة) ، يكون الاختلاف الرئيسي (بصرف النظر عن أننا نحتفل بالاستماع إلى الحزم) هو أننا نحدد كمحول محول حزمة خاص يحول الحزم التي تتكون من من سلاسل JSON. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; batchFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BatchMessagingMessageConverter(converter())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringJsonMessageConverter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">converter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter(); }</code> </pre> <br>  وأكثر شيء واحد.  عند تهيئة حبوب الربيع ، قد لا يتم حساب الصندوق تحت اسم kafkaListenerContainerFactory وسيتم إتلاف التطبيق.  من المؤكد أن هناك خيارات أكثر أناقة لحل المشكلة ، والكتابة عنها في التعليقات ، في الوقت الحالي ، قمت فقط بإنشاء صندوق تم إلغاء تحميله بوظائف بنفس الاسم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); }</code> </pre> <br>  تم إعداد المستهلك.  نمر إلى المنتج. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KafkaProducerConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.server}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaServer; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.producer.id}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaProducerId; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">producerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, LongSerializer.class); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class); props.put(ProducerConfig.CLIENT_ID_CONFIG, kafkaProducerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProducerFactory&lt;Long, StarshipDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">producerStarshipFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> KafkaTemplate&lt;Long, StarshipDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kafkaTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ KafkaTemplate&lt;Long, StarshipDto&gt; template = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaTemplate&lt;&gt;(producerStarshipFactory()); template.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template; } }</code> </pre> <br>  من المتغيرات الثابتة ، نحتاج إلى عنوان خادم kafka ومعرف المنتج.  يمكن أن يكون أي شيء. <br><br>  في التكوينات ، كما نرى ، لا يوجد شيء خاص.  تقريبا نفس الشيء.  لكن فيما يتعلق بالمصانع هناك فرق كبير.  يجب أن نسجل قالبًا لكل فئة نرسل كائناتها إلى الخادم ، وكذلك مصنعًا لها.  لدينا زوج واحد من هذا القبيل ، ولكن يمكن أن يكون هناك العشرات منهم. <br><br>  في القالب ، نحتفل بأننا سنسلسل الكائنات في JSON ، وربما هذا يكفي. <br><br>  لدينا مستهلك ومنتج ، يبقى كتابة خدمة من شأنها إرسال الرسائل واستقبالها. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StarshipServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StarshipService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ObjectMapper objectMapper; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StarshipServiceImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate, ObjectMapper objectMapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.kafkaStarshipTemplate = kafkaStarshipTemplate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.objectMapper = objectMapper; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@KafkaListener</span></span>(id = <span class="hljs-string"><span class="hljs-string">"Starship"</span></span>, topics = {<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>}, containerFactory = <span class="hljs-string"><span class="hljs-string">"singleFactory"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"=&gt; consumed {}"</span></span>, writeValueAsString(dto)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeValueAsString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objectMapper.writeValueAsString(dto); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsonProcessingException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Writing value to JSON failed: "</span></span> + dto.toString()); } } }</code> </pre> <br>  هناك طريقتان فقط في خدمتنا ، وهما كافيتان لشرح عمل العميل.  نحن autowire الأنماط التي نحتاجها: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate;</code> </pre> <br>  طريقة المنتج: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); }</code> </pre> <br>  كل ما هو مطلوب لإرسال رسالة إلى الخادم هو استدعاء طريقة الإرسال على القالب ونقل الموضوع (الموضوع) وكائننا هناك.  سيتم إجراء تسلسل للكائن في JSON وسيتم نقله إلى الخادم تحت الموضوع المحدد. <br><br>  تبدو طريقة الاستماع هكذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@KafkaListener</span></span>(id = <span class="hljs-string"><span class="hljs-string">"Starship"</span></span>, topics = {<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>}, containerFactory = <span class="hljs-string"><span class="hljs-string">"singleFactory"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"=&gt; consumed {}"</span></span>, writeValueAsString(dto)); }</code> </pre> <br>  نحتفل بهذه الطريقة باستخدام التعليق التوضيحيKafkaListener ، حيث نشير إلى أي معرّف نرغب فيه ، وموضوعات مستمع إليها ومصنع يقوم بتحويل الرسالة المستلمة إلى ما نحتاج إليه.  في هذه الحالة ، بما أننا نقبل كائنًا واحدًا ، فإننا نحتاج إلى مصنع فردي.  للحصول على قائمة &lt;؟&gt; ، حدد batchFactory.  نتيجة لذلك ، نرسل الكائن إلى خادم kafka باستخدام طريقة الإرسال ونحصل عليه باستخدام طريقة الاستهلاك. <br><br>  يمكنك كتابة اختبار خلال 5 دقائق لإظهار القوة الكاملة لكافكا ، لكننا سنذهب أبعد من ذلك - نمضي 10 دقائق ونكتب تطبيقًا آخر يرسل رسائل إلى الخادم الذي سيستمع إليه أول تطبيق لدينا. <br><br><h2 style=";text-align:right;direction:rtl">  اختبار الكافا </h2><br>  بعد تجربة كتابة التطبيق الأول ، يمكننا بسهولة كتابة الثاني ، خاصةً إذا قمنا بنسخ اللصق وحزمة dto ، تسجيل المنتج فقط (سنرسل الرسائل فقط) وأضف طريقة الإرسال الوحيدة إلى الخدمة.  باستخدام الرابط أدناه ، يمكنك بسهولة تنزيل رمز المشروع والتأكد من عدم وجود شيء معقد هناك. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(initialDelay = <span class="hljs-number"><span class="hljs-number">10000</span></span>, fixedDelay = <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">produce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ StarshipDto dto = createDto(); log.info(<span class="hljs-string"><span class="hljs-string">"&lt;= sending {}"</span></span>, writeValueAsString(dto)); kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> StarshipDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StarshipDto(<span class="hljs-string"><span class="hljs-string">"Starship "</span></span> + (LocalTime.now().toNanoOfDay() / <span class="hljs-number"><span class="hljs-number">1000000</span></span>)); }</code> </pre> <br>  بعد أول 10 ثوانٍ ، يبدأ kafka-tester في إرسال رسائل بأسماء النجوم إلى خادم كافكا كل 5 ثوانٍ (الصورة قابلة للنقر). <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/oo/ri/gk/oorigkqltxuntytvhzbarlninhk.png"></a> <br><br>  هناك ، يتم الاستماع إليها وتلقيها من قبل خادم kafka (الصورة هي أيضا قابلة للنقر). <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/cs/w-/vc/csw-vcgajjpjymkdxcwibqllnoi.png"></a> <br><br>  آمل أن ينجح أولئك الذين يحلمون بالبدء في كتابة خدمات ميكروية في كافكا بنفس السهولة التي نجحت بها.  وهنا هي الروابط إلى المشاريع: <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">خادم كافكا</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">اختبار الكافا</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar440400/">https://habr.com/ru/post/ar440400/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar440388/index.html">فترات: تطور C ++ القادم</a></li>
<li><a href="../ar440390/index.html">عالم متنوع من الأنظمة المضمنة ومكان Embox فيه</a></li>
<li><a href="../ar440392/index.html">WebRTC على موقعك - ​​لا أخطاء ولا ميزانية</a></li>
<li><a href="../ar440394/index.html">تصاعد امتياز PostgreSQL - تحليل CVE-2018-10915</a></li>
<li><a href="../ar440398/index.html">تاريخ المشاركة (والانتصار) في كأس منظمة العفو الدولية الروسية 2018 - CodeBall</a></li>
<li><a href="../ar440402/index.html">مطور SearchFace حول ميزات الخوارزمية</a></li>
<li><a href="../ar440404/index.html">"هندسة المعلومات": mitap في OZON</a></li>
<li><a href="../ar440410/index.html">تحديد الصور وتخزينها مؤقتًا وعرضها على الخريطة</a></li>
<li><a href="../ar440412/index.html">Zimbra Collaboration Suite و MS Exchange على نفس المجال</a></li>
<li><a href="../ar440414/index.html">حول linter ، جودة الكود ، الجودة بشكل عام وإدارة الجودة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>