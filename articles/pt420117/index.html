<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèúÔ∏è üíî üéí Guia de filas simples no Mikrotik üë® üöë üëÇüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existem muitos artigos na Internet dedicados √† limita√ß√£o de velocidade e compartilhamento de tr√°fego no equipamento MikroTik, mas quase todos consider...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia de filas simples no Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420117/"><p>  Existem muitos artigos na Internet dedicados √† limita√ß√£o de velocidade e compartilhamento de tr√°fego no equipamento MikroTik, mas quase todos consideram apenas a √Årvore de filas, que requer um entendimento profundo e √© redundante em muitas tarefas e pode ser substitu√≠da por Filas simples. </p><a name="habracut"></a><br><p>  Filas simplificadas - um mecanismo para dividir a capacidade do canal e priorizar o tr√°fego vinculado a um destino espec√≠fico.  O tr√°fego de entrada e sa√≠da √© calculado em rela√ß√£o ao destino. </p><br><p>  Existem tr√™s op√ß√µes para objetivos: ip, sub-rede, interface.  Voc√™ pode adicionar v√°rios destinos para uma regra. </p><br><h3 id="teoreticheskaya-chast">  Parte te√≥rica </h3><br><h4 id="sheypery-planirovschiki-i-ocheredi">  Modeladores, planejadores e filas </h4><br><p>  A taxa de dados √© medida em rela√ß√£o √† informa√ß√£o transmitida em bits por segundo de tempo - bit / s.  A unidade de bit √© pequena, ent√£o eles usam os prefixos kilo (kbit / s), mega (Mbit / s), gig (Gbit / s). </p><br><p>  A velocidade de transmiss√£o de pacotes nas redes de comunica√ß√£o √© sempre igual √† velocidade de transmiss√£o do meio (por exemplo, 100Mbit / s para Ethernet 100BASE-TX).  Se for necess√°rio reduzir essa velocidade, um dispositivo intermedi√°rio, como um roteador, recebendo pacotes de uma interface na velocidade m√°xima, envia-os de outra com um certo atraso; se os pacotes excederem o limite de velocidade definido, eles ser√£o armazenados em uma fila e enviados de acordo com o primeiro a entrar, primeiro a sair ( FIFO), se a fila estiver cheia (tamanho ausente ou zero), o roteador descartar√° os pacotes. </p><br><p>  <strong>Limite</strong> - limite de velocidade administrativa para o tr√°fego proveniente da interface. <br>  <strong>Shaper (Shaper)</strong> - um algoritmo de software que atrasa e descarta pacotes em excesso. <br>  <strong>Scheduler (Sheduler)</strong> - um algoritmo que decide como armazenar e enviar pacotes que ultrapassam o limite. <br>  <strong>Filas</strong> - algoritmos de armazenamento e prioriza√ß√£o de tr√°fego. </p><br><p>  Exemplos gr√°ficos do trabalho de um shaper e agendador. </p><br><p>  Usando um modelador fora de linha </p><br><p><img src="https://habrastorage.org/webt/rk/60/8_/rk608_lhdbfv_zstsgrk0t_6rpq.png"></p><br><p>  Usando um Shaper com um Agendador </p><br><p><img src="https://habrastorage.org/webt/ln/ry/im/lnryimsagc89acaf3pgjy9qollk.png"></p><br><h4 id="simple-queues-na-packet-flow">  Filas simples no fluxo de pacotes </h4><br><p>  Filas simples v√™m depois da √Årvore de filas, √†s vezes filas simples s√£o usadas para limitar rapidamente o tr√°fego a um (ou v√°rios) usu√°rios, sem interferir na √Årvore de filas. </p><br><div class="spoiler">  <b class="spoiler_title">Fluxo de pacotes simplificado para os interessados</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/9k/yk/vr/9kykvrkaxqkpncv_hjsqc3i9ssg.png"></p></div></div><br><h4 id="mehanika-raboty-ocheredey-none-pfifo-pcq">  Mec√¢nica de filas: none, pfifo, pcq </h4><br><p>  <strong>none</strong> - nenhuma fila; se o limite for excedido, todos os novos pacotes ser√£o descartados. </p><br><p>  <strong>O pfifo</strong> √© um algoritmo fifo orientado a pacotes.  Armazena o n√∫mero de pacotes especificados nas configura√ß√µes.  Usado por padr√£o em filas simples. </p><br><p><img src="https://habrastorage.org/webt/o-/af/gv/o-afgv9hsemh5ekrhrloakgatnm.png"></p><br><p>  <strong>pcq (por fila de conex√£o)</strong> - todo o tr√°fego √© dividido em sub-filas, dependendo de um conjunto de condi√ß√µes.  De cada sub-fila, parte do tr√°fego √© enviada alternadamente.  O espa√ßo vago √© ocupado pelo tr√°fego rec√©m-chegado.  Se o local na sub-fila acabar, os pacotes destinados a ele ser√£o descartados. </p><br><p><img src="https://habrastorage.org/webt/0j/ya/2i/0jya2iixjm_adtvot6x5cuoa00u.png"></p><br><p>  Considere uma pequena parte das configura√ß√µes: <br>  <strong>Taxa</strong> : limite de velocidade para cada uma das sub-filas. <br>  <strong>Limite</strong> : tamanho da sub-fila em kilobytes. <br>  <strong>Limite total</strong> : o tamanho total de todas as sub-filas em kilobytes. <br>  <em>A propor√ß√£o Limite / Limite total √© selecionada com base na situa√ß√£o.</em>  <em>Por padr√£o, 40 filas (2000/50), sujeitas ao preenchimento m√°ximo de tr√°fego.</em> <br>  <strong>Explos√£o</strong> : sobre ele ser√° menor. <br>  <strong>Classificador</strong> : com base no que dividir o tr√°fego em filas. <br>  O classificador divide seq√ºencialmente v√°rias conex√µes (conex√µes), se voc√™ selecionar [IP] -&gt; [Firewall] -&gt; [Conex√µes], pode-se observar que a maioria das conex√µes cont√©m o endere√ßo e a porta do remetente (endere√ßo src. Porta src. Porta) e o destinat√°rio ( endere√ßo padr√£o, porta padr√£o). </p><br><p>  Discutimos filas simples, portanto, para simplificar, consideraremos que filtramos apenas o tr√°fego proveniente da interface wan; nesse caso, em rela√ß√£o ao destino, o tr√°fego de sa√≠da (upload) ser√° classificado por src.  endere√ßo e a entrada (download) da dst.  endere√ßo. </p><br><p>  A classifica√ß√£o por porta ajudar√° a evitar a situa√ß√£o de entupir a fila com o tr√°fego de um aplicativo, se um aplicativo produzir muitas conex√µes de sa√≠da (por exemplo, torrent ou Web. Navegador com v√°rias guias), o src ser√° diferente.  porta e tr√°fego tamb√©m ser√£o divididos em filas. </p><br><h4 id="dinamicheskiy-sheyping-sredstvami-pcq">  Modelagem din√¢mica usando PCQ </h4><br><p>  Se a taxa for codificada, cada subfluxo ter√° uma velocidade determinada e n√£o poder√° exceder at√© que a velocidade total de todos os subfluxos exceda o limite mais alto (em filas simples, √© o limite total); nesse caso, a velocidade de todos os subfluxos diminuir√° proporcionalmente. </p><br><p><img src="https://habrastorage.org/webt/k8/z4/rb/k8z4rbxttud1n5yzgb0iapcpvom.png"></p><br><p>  Se a Taxa estiver definida como 0, a restri√ß√£o mais alta ser√° compartilhada entre todos os sub-fluxos.  De fato, isso √© modelagem din√¢mica. </p><br><p><img src="https://habrastorage.org/webt/g-/ig/rm/g-igrm9quokfmrvbmot1fh5_g5e.png"></p><br><p>  Se a Taxa estiver definida como 0 e o Limite total para filas simples n√£o for especificado, a velocidade entre os subencadeamentos ser√° dividida com base em um limite mais alto, se as filas n√£o estiverem aninhadas, essa √© uma limita√ß√£o da interface f√≠sica.  Se o seu plano tarif√°rio for mais baixo, parte do tr√°fego ser√° eliminada no equipamento do fornecedor e n√£o haver√° benef√≠cio nas filas. </p><br><p><img src="https://habrastorage.org/webt/0k/um/i7/0kumi7g7yykezh0v0jlkcp3dd8u.png"></p><br><p>  <em>Os demais tipos de filas (SFQ, RED) t√™m suas pr√≥prias peculiaridades e aplicativos e tamb√©m podem ser usados ‚Äã‚Äãpara filas simples, mas agora n√£o s√£o de nosso interesse.</em> </p><br><h4 id="markirovka-paketov">  Rotulagem de Pacotes </h4><br><p>  Sim, em filas simples, voc√™ pode usar o tr√°fego rotulado.  Isso n√£o √© um pr√©-requisito (diferente da √Årvore de filas), mas permite que voc√™ se afaste das limita√ß√µes do destino. </p><br><p> A rotulagem de tr√°fego ocorre em [IP] -&gt; [Firewall] -&gt; [Mangle], no total, existem tr√™s tipos de etiquetas: Conex√£o, Pacote, Rota.  Cada pacote pode conter um r√≥tulo de cada tipo.  Uma vez no mangle, a embalagem passa uma a uma de acordo com todas as regras; se houver duas etiquetas de conjunto derretidas, a regra inferior substituir√° a etiqueta da etiqueta superior.  Para evitar a substitui√ß√£o, voc√™ pode desativar a passagem de um pacote pela cadeia na primeira regra ( <code>passtrought=no</code> ). </p><br><p>  Ao configurar filas, voc√™ pode usar apenas r√≥tulos de pacotes ( <code>action=mark-packet</code> ).  Mas, para melhorar o desempenho (os r√≥tulos das conex√µes s√£o verificados mais rapidamente do que as condi√ß√µes de cada pacote), √© recomend√°vel marcar as conex√µes ( <code>action=mark-connection</code> ) primeiro e depois os pacotes nessa conex√£o ( <code>action=mark-package</code> ).  <em>A regra com conex√µes de pr√©-marca√ß√£o nem sempre √© verdadeira, mas se voc√™ chegou a esse entendimento ao criar filas, deve usar a √Årvore de filas.</em> </p><br><p>  Voc√™ pode marcar o tr√°fego de tr√¢nsito em qualquer uma das cadeias de fluxo de pacotes, mas na maioria dos casos eu prefiro usar o encaminhamento, porque  Nesta fase, os endere√ßos do destinat√°rio com o remetente e os nomes das interfaces de entrada e sa√≠da s√£o conhecidos. </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de rotulagem de tr√°fego</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/4p/fk/kk/4pfkkkzdf7nrl0eew8x7ckapnas.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-port=5060,10000-20000 new-connection-mark=output-sip-and-rtp passthrough=yes protocol=udp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=output-sip-and-rtp new-packet-mark=output-packet-sip-and-rtp passthrough=no</code> </pre> </div></div><br><h4 id="chto-takoe-burst">  O que √© burst </h4><br><p>  Geralmente, o limite de velocidade √© entendido como um certo valor est√°tico do limite por segundo ao atingir os pacotes descartados ou na fila.  O Burst opera com um valor m√©dio por unidade de tempo, isso possibilita o uso de velocidades mais altas (pico) em curtos per√≠odos de tempo e limita a velocidade com uma carga constante no canal. </p><br><p>  <strong>Limite m√°ximo</strong> √© a principal limita√ß√£o. <br>  <strong>Limite de Ruptura</strong> - velocidade de pico, tem prioridade sobre o Limite M√°ximo ao observar a velocidade m√©dia especificada. <br>  <strong>Limite de Ruptura</strong> - velocidade do limite. <br>  <strong>Burst Time</strong> - hora. </p><br><p>  O alvo obt√©m a velocidade do Limite de Ruptura, mas a cada segundo a velocidade m√©dia do tempo de Ruptura ser√° calculada.  Se a velocidade m√©dia por um determinado tempo exceder o limite de ruptura, o usu√°rio ficar√° limitado ao limite m√°ximo; se a velocidade m√©dia retornar ao normal, o alvo receber√° novamente o limite de explos√£o. </p><br><div class="spoiler">  <b class="spoiler_title">Estudo de caso de ruptura</b> <div class="spoiler_text"><p>  Regra de ruptura: </p><br><p><img src="https://habrastorage.org/webt/x8/e6/kr/x8e6krcahevnrpazzw3eo1rlrv8.png"></p><br><p>  Fluxograma mostrando a altera√ß√£o da velocidade desejada: </p><br><p><img src="https://habrastorage.org/webt/ss/u8/_i/ssu8_i_b8z-kbg9etldtnkzu9ga.png"></p><br><p>  E como √© a velocidade de destino alterada: </p><br><p><img src="https://habrastorage.org/webt/av/kz/jb/avkzjbsh7wfduzsflatk8fqutqc.png"></p></div></div><br><p>  <em>Se voc√™ estiver interessado no tema Burst, recomendo ler as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informa√ß√µes no wiki</a> , existem gr√°ficos e tabelas com base nas quais ser√° melhor entender como os valores de Limite e Tempo afetam o limite de velocidade.</em> </p><br><h4 id="razlichie-limit-at-i-max-limit">  Limite de diferen√ßa em e limite m√°ximo </h4><br><p><img src="https://habrastorage.org/webt/ii/n7/jh/iin7jhchctr21e2n5i1jenft-my.png"></p><br><p>  <strong>Limite em</strong> - velocidade garantida para a regra.  √â desej√°vel que a soma de todo o limite em n√£o exceda a largura de banda do canal.  Sempre menor que o m√°ximo. <br>  <strong>Limite</strong> m√°ximo - velocidade m√°xima para a regra.  Se o "or√ßamento" da fila permitir, a largura de banda m√°xima ser√° alocada. </p><br><p>  Normalmente, apenas o limite m√°ximo √© indicado em filas simplificadas e isso funciona bem, mas em uma configura√ß√£o de fila em cascata, os dois limites devem ser especificados. </p><br><h3 id="prakticheskaya-chast">  Parte pr√°tica </h3><br><p>  Filas simples s√£o configuradas em [Filas] -&gt; [Filas simples]. <br>  As regras s√£o processadas alternadamente de cima para baixo, a primeira regra adequada √© aplicada ao pacote que passa.  De fato, uma exce√ß√£o pode ser feita a partir de qualquer regra, colocando uma regra mais espec√≠fica acima. </p><br><h4 id="ogranichenie-skorosti-dlya-konkretnogo-hostapodsetiinterfeysa">  Limite de velocidade do host / sub-rede / interface </h4><br><p>  Geralmente √© usado quando √© necess√°rio diminuir a velocidade de um usu√°rio espec√≠fico. <br>  Nome: qualquer nome <br>  Destino: endere√ßo, sub-rede ou interface. <br>  Upload de destino: limite de velocidade de sa√≠da. <br>  Targer Download: limite de velocidade recebido. </p><br><p>  Limite de velocidade de 1Mbit / s: </p><br><p><img src="https://habrastorage.org/webt/rj/0l/dy/rj0ldymsyrl-ulstludlvz6uhty.png"></p><br><pre> <code class="plaintext hljs">/queue simple add max-limit=1M/1M name=Limit-For-100.200 queue=default/default target=192.168.100.200/32</code> </pre> <br><p>  Em Estat√≠sticas, voc√™ pode verificar a velocidade atual do destino, o n√∫mero de pacotes na fila e o n√∫mero de pacotes descartados. </p><br><h4 id="ogranichenie-skorosti-dlya-udalennogo-resursa">  Limite de velocidade para um recurso remoto </h4><br><p>  Op√ß√£o sem rotular pacotes. </p><br><p>  No campo dst, da mesma forma que o destino pode ser especificado: ip, sub-rede, interface.  Nas condi√ß√µes da Internet moderna, isso n√£o √© suficiente, mas pode ser √∫til para pequenas empresas e limites de velocidade entre escrit√≥rios. </p><br><p><img src="https://habrastorage.org/webt/jo/fi/te/jofiteubgejsubajjte9e26smj0.png"></p><br><pre> <code class="plaintext hljs">/queue simple add dst=192.168.200.10/32 max-limit=10M/10M name=Limit-For-Fileserver target=192.168.100.0/24</code> </pre> <br><h4 id="ravnocennoe-delenie-kanala-mezhdu-uchastnikami-podseti-pcq">  Divis√£o igual de canal entre participantes da sub-rede (pcq) </h4><br><p>  Uma regra que salvar√° sua sub-rede dom√©stica ou do escrit√≥rio da captura exclusiva de canal (no exemplo 50 Mb / s, ajuste ao seu canal) por um usu√°rio. </p><br><p><img src="https://habrastorage.org/webt/w_/nl/mg/w_nlmgmsen5nlddzajhh1jm3v0y.png"></p><br><p>  As filas pcq especificadas est√£o presentes na configura√ß√£o b√°sica, mas anexo capturas de tela em caso de altera√ß√µes. </p><br><p><img src="https://habrastorage.org/webt/ki/xk/-s/kixk-svzxxq8i3c7ekpzj_tynyc.png"></p><br><pre> <code class="plaintext hljs"># /queue type add kind=pcq name=pcq-upload-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB add kind=pcq name=pcq-download-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB # Simple queues /queue simple add max-limit=50M/50M name=Limit-Equivalent queue=pcq-upload-default/pcq-download-default target=192.168.100.0/24</code> </pre> <br><p>  Na guia Estat√≠sticas, voc√™ pode ver quantos threads de pcq est√£o atualmente na fila. </p><br><p><img src="https://habrastorage.org/webt/yz/8s/vf/yz8svfgkm1oz-veqdsihxt0t_lq.png"></p><br><h4 id="markirovannyy-trafik">  Tr√°fego marcado </h4><br><p>  A op√ß√£o dst √© bastante limitada e, se voc√™ quiser usar nomes de dom√≠nio ou listas de endere√ßos, precisar√° recorrer √† marca√ß√£o de tr√°fego.  Por exemplo, removeremos as restri√ß√µes para o dom√≠nio yandex.ru (sim, um monte de cdn'ok est√° conectado l√° e outras coisas, e para opera√ß√£o normal, voc√™ precisar√° adicion√°-las). </p><br><p>  Em uma vers√£o recente, tornou-se poss√≠vel adicionar nomes de dom√≠nio √†s listas de endere√ßos, o mikrotik os resolver√° automaticamente e adicionar√° entradas din√¢micas. </p><br><p><img src="https://habrastorage.org/webt/sq/3h/zt/sq3hztxzt1qzmwfjeejb4seuzog.png"></p><br><p>  Marcando o tr√°fego http / https (conex√£o e pacotes na conex√£o) para os endere√ßos especificados: </p><br><p><img src="https://habrastorage.org/webt/xv/9e/8i/xv9e8ijrdum_l0owpnkri2mehs8.png"></p><br><p><img src="https://habrastorage.org/webt/nj/hh/xx/njhhxx9sgajhbqk2qixgosht3oi.png"></p><br><p><img src="https://habrastorage.org/webt/z_/hn/xi/z_hnxipzr3mhe3khsehfnb7l_gc.png"></p><br><p>  Regra na fila simples: </p><br><p><img src="https://habrastorage.org/webt/pk/2p/jx/pk2pjxppbsgbxgcpblnvppzuv7k.png"></p><br><pre> <code class="plaintext hljs">#   /ip firewall address-list add address=yandex.ru list=ForQueues add address=yastatic.net list=ForQueues #    /ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-address-list=ForQueues dst-port=80,443 new-connection-mark=Mark-ForQueues passthrough=yes protocol=tcp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=Mark-ForQueues new-packet-mark=Mark-Packet-ForQueues passthrough=no #  Simple Queue /queue simple add max-limit=1M/1M name=Limit-For-Yandex packet-marks=Mark-Packet-ForQueues target=192.168.100.0/24</code> </pre> <br><h4 id="kaskadnye-ocheredi">  Filas em cascata </h4><br><p>  Tudo o que foi dito acima se refere √† limita√ß√£o e divis√£o da velocidade entre os participantes da rede, √© hora de abordar o tema da prioriza√ß√£o de tr√°fego.  Normalmente, √© necess√°rio para tr√°fego interativo (voip, vcs, ssh, rdp, ...) em um canal limitado e ocupado. </p><br><p>  Para filas em cascata, o par√¢metro Parent √© respons√°vel, que se refere √† fila "parent".  Para funcionar, todo o tr√°fego das filas "filho" deve ser capturado pelo pai. </p><br><p>  O par√¢metro Priority √© respons√°vel por qual tr√°fego ser√° adicionado √† fila anteriormente, funciona apenas em filas filhas (ou em "pai" se n√£o tiverem "filho"), pode levar valores de 1 (prioridade mais alta) a 8 e n√£o possui nada comum com tags QoS (DSCP; TOS). </p><br><p>  Pr√©-marca√ß√£o de tr√°fego: </p><br><p><img src="https://habrastorage.org/webt/3q/aj/wj/3qajwjqsgfsk2rjyttjox_puw_q.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=related,new dst-port=5060,10000-20000 in-interface=br-lan new-connection-mark=mark-conn-voip passthrough=yes protocol=udp add action=mark-packet chain=forward connection-mark=mark-conn-voip new-packet-mark=mark-pkg-voip passthrough=no add action=mark-connection chain=forward connection-state=new dst-port=80,443 in-interface=br-lan new-connection-mark=mark-conn-web passthrough=yes protocol=tcp</code> </pre> <br><p>  Filas no SimpleQueue: </p><br><p><img src="https://habrastorage.org/webt/__/np/f0/__npf0bat-c1n1qzxtthgufnwnw.png"></p><br><p><img src="https://habrastorage.org/webt/z6/1h/kt/z61hktl_myep7moyk_l4tl4umji.png"></p><br><p><img src="https://habrastorage.org/webt/pu/uu/os/puuuosqryi6zu8_userqrvlse50.png"></p><br><p><img src="https://habrastorage.org/webt/ot/rc/dv/otrcdvd-qjwvsk7gettmlv-1qma.png"></p><br><p><img src="https://habrastorage.org/webt/0t/gg/ga/0tgggaclbuc1ar18coyvqkffplg.png"></p><br><pre> <code class="plaintext hljs">/queue simple add limit-at=24M/24M max-limit=25M/25M name=main target=10.10.10.0/24 add limit-at=5M/5M max-limit=8M/8M name=voip packet-marks=mark-pkg-voip parent=main priority=1/1 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=web packet-marks=mark-pkg-web parent=main priority=2/2 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=other packet-marks=mark-pkg-other parent=main priority=3/3 queue=pcq-upload-default/pcq-download-default target=""</code> </pre> <br><p>  Agora, se voc√™ precisar fazer uma restri√ß√£o para um IP, basta colocar a regra na frente da cascata de filas. </p><br><h3 id="posleslovie">  Posf√°cio </h3><br><p>  O Simple Queues √© uma ferramenta bastante interessante e funcional para configura√ß√µes dom√©sticas e SOHO. Com uma regra (sem recorrer √† rotulagem de tr√°fego), voc√™ pode resolver o problema de captura de canal por um dispositivo.  Mas, se voc√™ usar o FastTrack, esque√ßa as filas - o tr√°fego passar√° por elas. </p><br><p>  Para configura√ß√µes mais complexas, existem √°rvores de filas (√°rvores HTB). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420117/">https://habr.com/ru/post/pt420117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420107/index.html">Typegram - Plataforma Zen Blog</a></li>
<li><a href="../pt420109/index.html">Elon Musk disse que a empresa poderia ser vendida a investidores privados. Acabaram por ser um fundo saudita</a></li>
<li><a href="../pt420111/index.html">De zero a her√≥i "A√ß√µes no Google": seu c√≥digo</a></li>
<li><a href="../pt420113/index.html">A lenda da estrutura do poder</a></li>
<li><a href="../pt420115/index.html">UE4 Equipamento para Multiplayer # 4 | Criando e conectando um cont√™iner</a></li>
<li><a href="../pt420119/index.html">10 frameworks web Python com os quais vale a pena trabalhar em 2018</a></li>
<li><a href="../pt420121/index.html">Teste de for√ßa: Cupim LT450, LXI</a></li>
<li><a href="../pt420123/index.html">O que √© realmente o Node.js?</a></li>
<li><a href="../pt420125/index.html">Automa√ß√£o em finan√ßas: funcion√°rios banc√°rios podem ficar sem trabalho devido a rob√¥s</a></li>
<li><a href="../pt420129/index.html">Padr√µes ass√≠ncronos de rotina: fora aguardam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>