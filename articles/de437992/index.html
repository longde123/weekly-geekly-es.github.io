<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõµ ü§ü üßöüèø Microservices. Versionierung in kontinuierlichen Integrations- und Bereitstellungssystemen CI / CD-Fallstudie mit TFS üë®‚Äçüëß‚Äçüëß üë®üèæ‚Äç‚öñÔ∏è üåë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem 
 Bei gro√üen und technisch komplexen Projekten, an denen in der Regel viele verteilte Teams gleichzeitig arbeiten, gibt es ein bekanntes Probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microservices. Versionierung in kontinuierlichen Integrations- und Bereitstellungssystemen CI / CD-Fallstudie mit TFS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437992/"><h4>  Problem </h4><br>  Bei gro√üen und technisch komplexen Projekten, an denen in der Regel viele verteilte Teams gleichzeitig arbeiten, gibt es ein bekanntes Problem bei der Entwicklung versionierter Software, das verschiedene Unternehmen unterschiedlich l√∂sen. <a name="habracut"></a><br><br>  Derzeit liefern einige unserer Kunden und Partner die neuesten Versionen (CI / CD) manuell an die Produktion, indem sie die neuesten / aktuellen Versionen ihrer Software installieren, nachdem sie diese zuvor mit dem Rest der Umgebung getestet haben.  Zum Beispiel durch Bereitstellung von Builds von iOS-, Android- usw. Anwendungen, wenn es sich um Client-Software handelt, oder durch Aktualisieren von Docker-Images in einer Docker-Umgebung, wenn es sich um Backend handelt.  Bei gro√üen und wichtigen Projekten, bei denen die Entscheidung, jedes Mal eine neue Version in Production zu ver√∂ffentlichen, vom Projektmanager getroffen wird, ist eine solche Entscheidung gerechtfertigt und nicht zu kostspielig, insbesondere wenn Releases nicht h√§ufig ver√∂ffentlicht werden.  In der Testentwicklungsumgebung (Dev / Stage-Umgebung) f√ºhrt die Verwendung von ‚Äûmanuellen‚Äú Tools jedoch zu einer Komplexit√§t des Projekts, einer m√∂glichen Unterbrechung der Impressionen f√ºr den Kunden usw.  Dies kann viele Gr√ºnde haben, darunter Inkonsistenzen in den Versionen verschiedener Container in Middleware-Software oder das Fehlen eines detaillierten Versionsverlaufs. <br><br>  Wir mussten dies pers√∂nlich sicherstellen und hatten gro√üe Schwierigkeiten bei einem gro√üen Projekt, bei dem t√§glich 6-8 neue Softwareversionen im Backend und 2-3 Softwareversionen im Frontend im CI-System ver√∂ffentlicht wurden, bei denen Testingenieure die Last und nicht objektiv bew√§ltigen konnten Es gab einen st√§ndigen Mangel an Verst√§ndnis daf√ºr, welche Version der Software im Frontend / Backend im Moment als stabil angesehen wurde. <br><br><h4>  Unsere Erfahrung </h4><br>  Unser Unternehmen verwendet bei seiner Arbeit verschiedene CI / CD-Systeme, deren Auswahl h√§ufig von den Anforderungen des Kunden abh√§ngt.  Beispielsweise sto√üen unsere Spezialisten h√§ufig auf CI / CD-Systeme wie Jenkins, TeamCity, Travis CI, Circle CI, Gitlab CI und Atlassian Bamboo, bei denen wir manchmal ausschlie√ülich an der Infrastruktur des Kunden arbeiten.  Dementsprechend liegt bei diesem Ansatz das Problem bei der L√∂sung der Versionierung vollst√§ndig beim Kunden. <br><br>  Wenn wir L√∂sungen f√ºr Kunden entwickeln und die M√∂glichkeit haben, dies in unserer eigenen Infrastruktur zu tun, verwenden wir TFS Version 2018 als Grundlage f√ºr das Continuous Integration / Continuous Delivery-System. Dies erm√∂glicht es uns, die Hauptaufgabe zu l√∂sen, einen vollst√§ndigen Softwareentwicklungszyklus zu erstellen, n√§mlich: <br><br><ul><li>  Aufstellung der Aufgaben (Probleme, Fehler, Aufgaben) basierend auf dem im aktuellen Projekt verwendeten Ansatz zur Softwareentwicklung; </li><li>  Speicherung des Projektquellcodes; </li><li>  Bereitstellung der Infrastruktur von Build-Agents f√ºr Assemblys f√ºr verschiedene Betriebssysteme (Windows, Linux, MacOS); </li><li>  Zusammenstellen von Projekten im "manuellen" Modus und CI; </li><li>  Bereitstellung von Projekten im "manuellen" Modus und auf CD; </li><li>  Projekte testen; </li><li>  Bildung von Daten √ºber die Zeit, die Mitarbeiter f√ºr das Projekt aufgewendet haben, und eine Reihe zus√§tzlicher Funktionen, die wir mithilfe von TFS-Erweiterungen unseres eigenen Designs und durch Hinzuf√ºgen von Statiken zu WIT implementiert haben (in dieser Form ersetzte TFS unser Unternehmen Redmine und vereinfachte die Erfassung von Statistiken, Berichten usw. im Rahmen von Projekten ) </li></ul><br>  In diesem Fall w√§re es logisch, TFS die L√∂sung f√ºr das Versionsproblem zuzuweisen und die TFS-Funktionalit√§t f√ºr unsere Aufgaben und die W√ºnsche des Kunden zu finalisieren.  Infolgedessen wurde die Aufgabe, ein Versionsverwaltungssystem f√ºr Microservice-Architekturprojekte zu erstellen, durch TFS-Tools gel√∂st, indem verschiedene Build-Skripte angepasst und Test- / Release-Umgebungen organisiert wurden. <br><br><h4>  Die L√∂sung: Verwenden von TFS und Tools von Drittanbietern </h4><br>  Daher ben√∂tigen wir ein Versionierungssystem f√ºr Microservice-Architekturprojekte, um Testumgebungen und Releases zu organisieren. <br><br>  Als erste Daten haben wir: <br><br><ul><li>  Orchestrierung - Wir verwenden Docker-Schwarm haupts√§chlich, um die Verwendung anderer Tools von Drittanbietern zu reduzieren.  Gleichzeitig gibt es Konverter zum Konvertieren von Konfigurationen - zum Beispiel das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kompose</a> , mit dem Sie bei Bedarf Kubernetes verwenden k√∂nnen. </li><li>  Build Agents - VM basierend auf Linux-Servern. </li><li>  Quell-Repository - TFS-basiertes Git. </li><li>  Bildspeicherung - Docker-Registrierung auf VM. </li></ul><br><h4>  Auf die Frage nach dem Namen der Builds </h4><br><ul><li>  Es ist logisch, vorhandene Namensstandards zu verwenden, z. B. die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semantic Versioning Specification</a> . </li><li>  Wir folgen diesem Namen, wenn wir den Erstellungsprozess der Release-Version manuell starten, da Sie sonst nicht automatisch den richtigen Namen erhalten k√∂nnen (es sei denn, Sie geben ihn manuell in den Code ein, was wiederum wenig mit der CI-Ideologie zu tun hat). </li><li>  Im CI-Modus zum "Debuggen" von Softwareversionen verwenden wir die folgenden Namen f√ºr verschiedene Projekte: <br><br><ol><li>  Integrierte TFS-Erweiterungen </li><li>  Nummerierung basierend auf dem aktuellen Datum und der Build-Nummer an diesem Tag; </li><li>  Die Nummer des Commits, mit dem der Build gestartet wurde. </li></ol></li></ul><br>  Eine bestimmte L√∂sung kann beispielsweise anhand eines Beispiels des in Javascript erstellten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Calculator-</a> Dienstes und mehrerer √∂ffentlich verf√ºgbarer Projekte angezeigt werden. <br><br><h4>  Entscheidungsalgorithmus </h4><br>  <b>1.</b> Erstellen Sie in TFS2018 ein Projekt namens SibEDGE Semver und importieren Sie das Repository in das lokale Repository <br><br><img src="https://habrastorage.org/webt/3n/9l/xi/3n9lxiufbqej7sscqofb3el3q58.jpeg" alt="Bild"><br>  <i>Abbildung 1 - SibEDGE Semver-Projekt im Repository bei TFS 2018</i> <br><br>  <b>2.</b> Erstellen Sie eine Dockerfile-Datei mit der Beschreibung der Assembly node.js f√ºr unsere Anforderungen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> ). <br><br><pre><code class="plaintext hljs">FROM node:7 WORKDIR /usr/src/app COPY package.json app.js LICENSE /usr/src/app/ COPY lib /usr/src/app/lib/ LABEL license MIT COPY tests tests ENV NODE_ENV dev RUN npm config set strict-ssl false RUN npm update &amp;&amp; \ npm install -g mocha CMD ["mocha", "tests/test.js", "--reporter", "spec"]</code> </pre> <br><h4>  Skript 1 - Docker-Datei zum Erstellen eines Builds </h4><br>  <b>3.</b> Erstellen Sie auf dem Pr√ºfstand (mit installiertem Docker), auf dem wir unsere Umgebung bereitstellen m√∂chten, einen Schwarmcluster.  In unserem Fall besteht es aus einem Server. <br><br><pre> <code class="plaintext hljs">$ docker swarm init</code> </pre> <br>  <b>4.</b> Erstellen Sie eine yml-Datei mit einer Beschreibung der Microservices f√ºr unsere Bed√ºrfnisse ( <a href="">Link</a> ). <br>  Beachten Sie, dass <code>vm-docker-registry.development.com:5000</code> das interne Repository f√ºr dieses Projekt ist, das wir im Voraus vorbereitet haben.  Damit der Teststand dieses Repository verwenden kann, muss ein SSL-Zertifikat auf dem Stand im Ordner /etc/docker/certs.d/ &lt;Repository-Name&gt; /ca.crt registriert werden <br><br><pre> <code class="plaintext hljs">version: '3.6' services: #--- # Portainer for manage Docker #--- portainer: image: portainer/portainer:1.15.3 command: --templates http://templates/templates.json -d /data -H unix:///var/run/docker.sock networks: - semver-network ports: - 9000:9000 volumes: - /var/run/docker.sock:/var/run/docker.sock #--- #----Service Calculator Test# #--- semver-calc: image: vm-docker-registry.development.com:5000/calculator:latest networks: - semver-network #--- #----Pminder - Nginx# #--- nginx: image: nginx:1.9.6 depends_on: - mysql ports: - "8888:80" - "6443:443" networks: - semver-network # #----------------------------- # START NoSQL - Redis. #--- redis: image: redis:4.0 networks: - semver-network ports: - "8379:6379" # # END NoSQL - Redis. #--- #----Pminder - DB# #--- mysql: image: mysql:5.7 ports: - "3306:3306" environment: MYSQL_ROOT_PASSWORD: 'ODdsX0xcN5A9a6q' MYSQL_DATABASE: 'semver' MYSQL_USER: 'user' MYSQL_PASSWORD: 'uXcgTQS8XUm1RzR' networks: - semver-network #--- #----PhpMyAdmin # #--- phpmyadmin: image: phpmyadmin/phpmyadmin depends_on: - mysql environment: PMA_HOST: 'mysql' PMA_USER: 'user' PMA_PASSWORD: 'uXcgTQS8XUm1RzR' ports: - "8500:80" - "8600:9000" networks: - semver-network #--- networks: semver-network:</code> </pre><br><h4>  Skript 2 ist der Inhalt der Datei semver.yml, bei der es sich um die Docker-Compose-Projektdatei handelt. </h4><br>  <b>5.</b> Erstellen Sie eine Build-Beschreibung in TFS2018 (Build-Definition). <br><br>  <b>6.</b> Die erste Aktion unseres Skripts besteht darin, das Docker-Container-Image zu erstellen: <br><br><img src="https://habrastorage.org/webt/ot/u2/hc/otu2hcqbokm6jsqq2xvrgdyo7ma.jpeg" alt="Bild"><br>  <i>Abbildung 2 - Erstellen eines Images f√ºr unseren Build in TFS 2018</i> <br><br>  <b>7.</b> Senden Sie das auf dem Buildcomputer erstellte Docker-Container-Image an das interne Repository f√ºr dieses Projekt: <br><br><img src="https://habrastorage.org/webt/c5/z0/-i/c5z0-irkolgl5vtvd_ljjmp4hte.jpeg" alt="Bild"><br>  <i>Abbildung 3 - Speichern des Docker-Images f√ºr unsere Assembly im TFS 2018-Repository</i> <br><br>  <b>8.</b> √Ñndern Sie f√ºr die gesamte Umgebung auf dem Pr√ºfstand in der Microservices-Beschreibungsdatei den Bildnamen in einen neuen: <br><br><img src="https://habrastorage.org/webt/va/vs/-z/vavs-zlakgyiujowaaclrddgzd4.jpeg" alt="Bild"><br>  <i>Abbildung 4 - Ersetzen des Image-Namens im Build-Skript f√ºr unser Build in TFS 2018</i> <br><br>  <b>9.</b> Kopieren Sie auf dem Pr√ºfstand das erstellte Docker-Container-Image aus dem internen Repository und aktualisieren Sie den Dienst in Docker-Schwarm: <br><br><img src="https://habrastorage.org/webt/rc/gl/vq/rcglvqmsxim1iedm2ieq25_i_pq.jpeg" alt="Bild"><br>  <i>Abbildung 5 - Bereitstellen des Docker-Containers mit dem Build-Skript f√ºr unseren Build aus dem Image in TFS 2018</i> <br><br>  Wenn wir das TFS-Repository verlassen, haben wir daher eine yml-Datei mit Release-Versionen von Docker-Images, die wiederum einen Release-Namen f√ºr das gesamte Projekt hat. <br><br>  <b>10. Wir</b> gehen zum Pr√ºfstand und √ºberpr√ºfen den Betrieb der Dienste und stellen sicher, dass der Rechnerdienst aktualisiert wurde und die neue Version der Baugruppe verwendet. <br><br><pre> <code class="plaintext hljs">$ docker service ls</code> </pre> <br><br><img src="https://habrastorage.org/webt/mj/tq/kh/mjtqkhpjmndkwu-gnac7rc_jteo.jpeg" alt="Bild"><br>  <i>Abbildung 6 - Aktualisieren des Rechnerservices und √úberpr√ºfen der aktuellen Version auf unserem Pr√ºfstand</i> <br><br>  Daher haben wir in unserem Docker-Registrierungsbildspeicher eine Reihe von Bildern verschiedener Versionen von Mikrodiensten (in diesem speziellen Fall wird die Version von nur einem Mikrodienst ge√§ndert).  Durch Starten eines separaten Bereitstellungsprozesses (√ºber ein Skript, das die yml-Beschreibungsdatei √§ndert) k√∂nnen Sie jederzeit die zum Testen erforderliche Umgebung auf einem Pr√ºfstand abrufen und diese Konfiguration an die QS-Abteilung √ºbertragen.  Nach dem Testen (Regression, Laden usw.) erhalten wir die Information, dass der Microservice einer bestimmten Version auf einem Pr√ºfstand mit den Release-Versionen anderer Microservices dieser und jener Versionen stabil funktioniert, und die endg√ºltige Entscheidung dar√ºber, was aktualisiert werden kann oder nicht, ist bereits getroffen Release Stand auf die neue Version. <br><br><h4>  Zusammenfassung - was Sie am Ausgang bekommen haben </h4><br>  Dank der Implementierung der Versionierung in Projekten mit Microservice-Architektur wurde folgendes Ergebnis erzielt: <br><br><ul><li>  Das Chaos in den Versionen hat abgenommen. </li><li>  Die Geschwindigkeit der Bereitstellung einer neuen Umgebung in Projekten hat zugenommen. </li><li>  Die Qualit√§t der Baugruppen hat sich verbessert und die Fehlerquote hat abgenommen. </li><li>  erh√∂hte Transparenz der Entwicklung f√ºr Projektmanager und Kunden; </li><li>  Die Interaktion zwischen den Abteilungen hat sich verbessert. </li><li>  Es gibt neue Richtungen in der Arbeit von DevOps. </li></ul><br>  <b>PS</b> Vielen Dank an meine Kollegin Kirill B., die mir beim Schreiben dieses Artikels geholfen hat. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de437992/">https://habr.com/ru/post/de437992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de437982/index.html">Der neue Verschl√ºsselungsangriff von Shade richtet sich an russische Gesch√§ftsanwender</a></li>
<li><a href="../de437984/index.html">Threading in Node.js: Modul worker_threads</a></li>
<li><a href="../de437986/index.html">Warum ist TypeScript das Herzst√ºck jeder neuen PayPal-Webanwendung?</a></li>
<li><a href="../de437988/index.html">React Tutorial, Teil 12: Workshop, Phase 3 TODO-Anwendung</a></li>
<li><a href="../de437990/index.html">React Tutorial Teil 13: Klassenbasierte Komponenten</a></li>
<li><a href="../de437994/index.html">Automatisches Melken und automatische Gew√§chsh√§user: So funktioniert eine kleine Hightech-Farm</a></li>
<li><a href="../de437996/index.html">SITIS CTF: Wie das Siegel CTF zum Sieg verhalf</a></li>
<li><a href="../de437998/index.html">"Moderne" Essensphilosophen in C ++ durch Schauspieler und CSP</a></li>
<li><a href="../de438000/index.html">Erfolg und Misserfolg bei der Erstellung Ihres Projekts (Start)</a></li>
<li><a href="../de438002/index.html">Konfigurieren Sie den Reverse Proxy f√ºr Nextcloud und ONLYOFFICE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>