<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТГЁЯП╝ ЁЯС╕ЁЯП╜ ЁЯОЕЁЯП╗ рд╡рд┐рдВрдбреЛрдЬ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛: рд╕рдмрд╕реЗ рдЕрдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ ЁЯМЦ ЁЯзСЁЯП╛тАНЁЯдЭтАНЁЯзСЁЯП╜ тЪкя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХрдЯ рдХреЗ рддрд╣рдд рдмреНрд▓реИрдХрд╣реИрдЯ 2018 рд╕рдореНрдореЗрд▓рди рдореЗрдВ рдПрд▓реЗрдХреНрд╕ рдЖрдпрдиреЛрд╕реНрдХреВ рдФрд░ рдЧреИрдмреНрд░рд┐рдПрд▓ рд╡рд┐рдпрд╛рд▓рд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╕реНрддреБрдд "рдж рд╡рд┐рдВрдбреЛрдЬ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдлреИрд╕рд┐рд▓рд┐рдЯреА: рдж рдореЛрд╕реНрдЯ рдЕрдирдбрд╛рдЗрдиреЗрдЯреЗрдб рдХрд░реНрдиреЗрд▓ рдЕрдЯреИрдХ рд╕...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╡рд┐рдВрдбреЛрдЬ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛: рд╕рдмрд╕реЗ рдЕрдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣рдорд▓реЗ рдХреА рд╕рддрд╣</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459626/"><p>  рдХрдЯ рдХреЗ рддрд╣рдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреНрд▓реИрдХрд╣реИрдЯ 2018 рд╕рдореНрдореЗрд▓рди рдореЗрдВ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрд▓реЗрдХреНрд╕</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдпрдиреЛрд╕реНрдХреВ</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреИрдмреНрд░рд┐рдПрд▓ рд╡рд┐рдпрд╛рд▓рд╛</a> рджреНрд╡рд╛рд░рд╛ <strong>рдкреНрд░рд╕реНрддреБрдд</strong> "рдж рд╡рд┐рдВрдбреЛрдЬ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдлреИрд╕рд┐рд▓рд┐рдЯреА: рдж рдореЛрд╕реНрдЯ рдЕрдирдбрд╛рдЗрдиреЗрдЯреЗрдб рдХрд░реНрдиреЗрд▓ рдЕрдЯреИрдХ рд╕рд░рдлреЗрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдЯреНрд░реЗрдЯ</a> " рдХрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдиреБрд╡рд╛рдж рд╣реИ</a> ред <br><img src="https://habrastorage.org/webt/ja/q7/pl/jaq7plcphybdtfljwzxxdryln8q.png"><img src="https://habrastorage.org/webt/fi/sw/fe/fiswfev1j4ndustfitqdyvruxis.jpeg"></p><br><div class="spoiler"> <b class="spoiler_title">рдкреНрд░рдХрд╛рд╢рди рдореЗрдВ рдХреНрдпрд╛ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреА</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Windows рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛ (WNF) рдХреНрдпрд╛ рд╣реИ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрдпреЛрдВ WNF рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">WNF рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб API (ntdll)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдХрд░реНрдиреЗрд▓ рд╕реНрддрд░ API (рдкреВрд░реНрд╡)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">WNF рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд╣рдорд▓реЗ рдХреА рд╕рддрд╣</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд┐рд▓рдЪрд╕реНрдк рдФрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдЧреЗ рдХреЗ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреЗ рд▓рд┐рдП рджрд┐рд╢рд╛-рдирд┐рд░реНрджреЗрд╢</a> </li></ul></div></div><a name="habracut"></a><br><a name="what"></a><br><h3 id="chto-takoe-windows-notification-facility-wnf">  рд╡рд┐рдВрдбреЛрдЬ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛ (WNF) рдХреНрдпрд╛ рд╣реИ </h3><br><p>  рд╡рд┐рдВрдбреЛрдЬ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛ рдПрдХ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рддрдВрддреНрд░ рд╣реИ (рдХрд░реНрдиреЗрд▓ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб рдореЗрдВ рджреЛрдиреЛрдВ рдЙрдкрд▓рдмреНрдз рд╣реИ), рдЬреЛ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рдХрд╛рд╢рдХ-рдЧреНрд░рд╛рд╣рдХ</a> рдореЙрдбрд▓ ( <em>рдкрдмрд╕</em> , рдкреНрд░рдХрд╛рд╢рдХ / рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдмрд░) рдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рддрдВрддреНрд░ рдХреЛ рд╡рд┐рдВрдбреЛрдЬ 8 рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛: рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдУрдПрд╕ рдореЗрдВ рдХреБрдЫ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдбрд┐рдЬрд╛рдЗрди рдХреА рд╕реАрдорд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд▓реЗрдХрд┐рди рдпрд╣ рднреА рдЖрдИрдУрдПрд╕ / рдПрдВрдбреНрд░реЙрдЗрдб рдХреЗ рд╕рдорд╛рди рдкреБрд╢-рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рдирд╛ рдерд╛ред </p><br><p>  рдЗрд╕рдХреА рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ <em>рдЕрдВрдзрд╛</em> (рдЬреНрдпрд╛рджрд╛рддрд░ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рдмрд┐рдирд╛) рдореЙрдбрд▓ рд╣реИ рдЬреЛ рдмрд┐рдирд╛ рд╕рджрд╕реНрдпрддрд╛ рдФрд░ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рддрд╛рддреНрдкрд░реНрдп рдпрд╣ рд╣реИ рдХрд┐ рдХреЛрдИ рдЙрдкрднреЛрдХреНрддрд╛ рдЕрдкрдиреЗ рд╕реНрд░реЛрдд рджреНрд╡рд╛рд░рд╛ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗ рд╕рдХрддрд╛ рд╣реИред  рдФрд░ рдпрд╣ рдХрд┐ рдШрдЯрдирд╛рдУрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдиреЛрдЯрд┐рд╕ рдХреЛ "рд░рдЬрд┐рд╕реНрдЯрд░" рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рддрдВрддреНрд░ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ: </p><br><ul><li>  рд╕реНрдерд╛рдпреА рдФрд░ рдЕрд╕реНрдерд╛рдпреА рд╕реВрдЪрдирд╛рдПрдВ </li><li>  рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЛ рдиреАрд░рд╕рддрд╛ рд╕реЗ рдмрдврд╝рд╛ рд░рд╣рд╛ рд╣реИ </li><li>  рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдирд╛ рдХреЗ рд▓рд┐рдП рдкреЗрд▓реЛрдб рдмрдлрд░ (4 рдХрд┐рд▓реЛрдмрд╛рдЗрдЯ рддрдХ) </li><li>  рдереНрд░реЗрдб-рдкреВрд▓ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдореЙрдбрд▓ рд╕рдореВрд╣-рдЖрдзрд╛рд░рд┐рдд рдХреНрд░рдорд╛рдВрдХрди рдХреЗ рд╕рд╛рде </li><li>  рдПрдХ рдЧреБрдВрдЬрд╛рдЗрд╢-рдЖрдзрд╛рд░рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбрд▓ рдЬреЛ рдорд╛рдирдХ <abbr title="рд╡рд┐рд╡реЗрдХрд╛рдзреАрди рдЕрднрд┐рдЧрдо рдирд┐рдпрдВрддреНрд░рдг рд╕реВрдЪреА">рдбреАрдПрд╕реАрдПрд▓</abbr> / <abbr title="рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ">рдПрд╕рдПрд╕реАрдПрд▓</abbr> рддрдВрддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ <abbr title="рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ">рд╡рд┐рд╡рд░рдгрдХреЛрдВ рдХреЛ рд▓рд╛рдЧреВ</abbr> рдХрд░рддрд╛ рд╣реИ </li></ul><br><a name="why"></a><br><h3 id="pochemu-poyavilsya-wnf">  рдХреНрдпреЛрдВ WNF рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ </h3><br><p>  рдПрдХ рд╡рд┐рд╣рд┐рдд рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: рдПрдХ рдбреНрд░рд╛рдЗрд╡рд░ рд╣реИ рдЬреЛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ рдХрд┐ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╡рд╛рд▓рд╛ рдПрдХ рд╡реЙрд▓реНрдпреВрдо рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, Autochk (рд╡рд┐рдВрдбреЛрдЬ рдкрд░ <abbr title="рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕рдВрдЧрддрд┐ рдЬрд╛рдБрдЪ">fsck</abbr> рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ) VolumesSafeForWriteAccess рдирд╛рдордХ рдПрдХ рдШрдЯрдирд╛ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рдШрдЯрдирд╛ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдЗрд╡реЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рд╣рдореЗрдВ рдпрд╣ рднреА рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдСрдЯреЛрдЪреЙрдХ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡реЙрд▓реНрдпреВрдо рдкрд░ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдЙрд╕ рдШрдЯрдирд╛ рдХрд╛ рд╕рдВрдХреЗрдд рдирд╣реАрдВ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рд╣рдо рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдЦрд░рд╛рдм рд╕рдорд╛рдзрд╛рди: рдиреАрдВрдж рдХреЗ рд╕рд╛рде рдПрдХ рд▓реВрдк рдореЗрдВ рдмреИрдареЛ (), рдПрдХ рдШрдЯрдирд╛ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдФрд░ рдЬрдм рдШрдЯрдирд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ - рдЗрд╕рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВред </p><br><p>  рд▓реЗрдХрд┐рди рд╡рд┐рдВрдбреЛрдЬ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕рдХреЗ рд╕рднреА рд╡рд┐рд╡рд░рдг рдмрдВрдж рд╣реЛ рдЧрдП рд╣реИрдВред  рдФрд░ рдЬрдм рд╡рд╕реНрддреБ рдХрд╛ рдХреЛрдИ рд╡рд┐рд╡рд░рдг рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИред  рддреЛ рдпрд╣ рдЖрдпреЛрдЬрди рдХреМрди рдХрд░реЗрдЧрд╛? </p><br><p>  WNF рдХреЗ рдмрд┐рдирд╛, рд╕рдорд╛рдзрд╛рди рдХрд┐рд╕реА рднреА рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдШрдЯрдирд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП OS рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рд╣реИ, рдФрд░ Autochk рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдПрдХ рдЙрдкрднреЛрдХреНрддрд╛ рдХреА рддрд░рд╣ рдЦреЛрд▓рдирд╛ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЗрд╕ рдШрдЯрдирд╛ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><a name="state_name"></a><br><h3 id="imena-sostoyaniy-state-names-wnf">  рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл </h3><br><p>  рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рджреБрдирд┐рдпрд╛ рдореЗрдВ, рдПрдХ рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо 64-рдмрд┐рдЯ рд╕рдВрдЦреНрдпрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдПрдХ рдЪрд╛рд▓ рд╣реИ - рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдПрдХ рдХреЛрдбрд┐рдд рд╕рдВрд░рдЪрдирд╛ рд╣реИред  рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо рдореЗрдВ рдПрдХ <em>рд╕рдВрд╕реНрдХрд░рдг</em> , <em>рдПрдХ рдЬреАрд╡рдирдХрд╛рд▓</em> , рдПрдХ <em>рдЧреБрдВрдЬрд╛рдЗрд╢</em> , рдПрдХ <em>рдбреЗрдЯрд╛ рджреГрдврд╝рддрд╛ рдЭрдВрдбрд╛</em> рдФрд░ рдПрдХ <em>рдЕрджреНрд╡рд┐рддреАрдп рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░ рд╣реИ</em> ред </p><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WNF_STATE_NAME_INTERNAL</span></span></span><span class="hljs-class"> {</span></span> ULONG64 Version:<span class="hljs-number"><span class="hljs-number">4</span></span>; ULONG64 NameLifetime:<span class="hljs-number"><span class="hljs-number">2</span></span>; ULONG64 DataScope:<span class="hljs-number"><span class="hljs-number">4</span></span>; ULONG64 PermanentData:<span class="hljs-number"><span class="hljs-number">1</span></span>; ULONG64 Unique:<span class="hljs-number"><span class="hljs-number">53</span></span>; } WNF_STATE_NAME_INTERNAL, *PWNF_STATE_NAME_INTERNAL;</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдпрд╣ рдбреЗрдЯрд╛ рдХреЗрд╡рд▓ рддрднреА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ рдЬрдм рд╣рдо рдПрдХ рдЬрд╛рджреВ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рд╕рд╛рде 64-рдмрд┐рдЯ рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WNF_STATE_KEY 0x41C64E6DA3BC0074</span></span></code> </pre> <br><a name="lifetime"></a><br><h4 id="vremya-zhizni-lifetime-imeni-sostoyaniya">  рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо рдХрд╛ рдЬреАрд╡рдирдХрд╛рд▓ </h4><br><p>  WNF рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо (WNF_STATE_NAME_LIFETIME) рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: </p><br><ul><li>  рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬреНрдЮрд╛рдд (рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ) </li><li>  рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ (рд╕реНрдерд╛рдпреА) </li><li>  рд╕реНрдерд┐рд░ (рд▓рдЧрд╛рддрд╛рд░) </li><li>  рдЕрдирдВрддрд┐рдо (рдЕрд╕реНрдерд╛рдпреА) </li></ul><br><p>  рдкрд╣рд▓реЗ рддреАрди рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВ, рдЬрд╣рд╛рдВ рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рдПрдЧреА: </p><br><ul><li>  рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рдирд╛рдо HKLM \ SYSTEM \ CurrentControlSet \ Control \ Notifications рдореЗрдВ рд░рд╣рддреЗ рд╣реИрдВ </li><li>  рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдо HKLM \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Notifications рдореЗрдВ рд░рд╣рддреЗ рд╣реИрдВ </li><li>  рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдо HKLM \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ VolatileNotifications рдореЗрдВ рд░рд╣рддреЗ рд╣реИрдВ </li></ul><br><p>  рдкреНрд░рд╕рд┐рджреНрдз рдирд╛рдореЛрдВ рдХреА рдЕрдкрдиреА рдЦрд╝рд╛рд╕рд┐рдпрдд рд╣реИ: рд╡реЗ рдкрдВрдЬреАрдХреГрдд рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗред  рд╕рд┐рд╕реНрдЯрдо рдмреВрдЯ рдХреЗ рд╕рдордп рдРрд╕рд╛ рдирд╛рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд▓рдЧрд╛рддрд╛рд░ рдФрд░ рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП SeCreatePermanentPrivilege рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ (рдЕрдиреНрдп рд╡реИрд╢реНрд╡рд┐рдХ рд╡рд╕реНрддреБрдУрдВ рдХреА рддрд░рд╣) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдо рд░рдЬрд┐рд╕реНрдЯреНрд░рд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдмрд╛рд╣рд░ рд░рд╣рддреЗ рд╣реИрдВ, рдЬрдмрдХрд┐ рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдо рдПрдХ рд╕рд┐рд╕реНрдЯрдо рд░рд┐рдмреВрдЯ рдмрдЪ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><a name="scope"></a><br><h4 id="oblast-vidimosti-scope-dannyh">  рдбреЗрдЯрд╛ рдХрд╛ рд╕реНрдХреЛрдк </h4><br><p>  рдбреЗрдЯрд╛ рд╕реНрдХреЛрдк WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреА рдкрд╣рд▓реА рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ; рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рдЗрд╕реЗ рджреЗрдЦрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдкрд╣реБрдВрдЪ рд╣реИред  рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо рдХрд╛ рджрд╛рдпрд░рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: </p><br><ul><li>  рдкреНрд░рдгрд╛рд▓реА </li><li>  рдХрд╛рд░ </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рддреНрд░ </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ </li><li>  рдкреНрд░рдХреНрд░рд┐рдпрд╛ </li></ul><br><p>  рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд╕реНрдХреЛрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╣реА рдирд╛рдо рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЙрджрд╛рд╣рд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХрд░реНрдиреЗрд▓ (рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдХреЗ рд╕рд╛рде) рд░рд╛рдЬреНрдп рдПрдХреНрд╕реЗрд╕ рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред  TCB рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ WNF рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдореЛрдВ рдХреЛ рдХреНрд░реЙрд╕-рд╕реНрдХреЛрдк рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рд╕реНрдХреЛрдк "рд╕рд┐рд╕реНрдЯрдо" рдФрд░ рд╕реНрдХреЛрдк "рдорд╢реАрди" рдЧреНрд▓реЛрдмрд▓ рд╕реНрдХреЛрдк рд╣реИрдВред  рдЙрдирдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдирд╣реАрдВ рд╣реИрдВ (рд╡реЗ рд╡рд┐рднрд┐рдиреНрди рд╡реИрд╢реНрд╡рд┐рдХ рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ)ред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рддреНрд░ рдХрд╛ рджрд╛рдпрд░рд╛ рд╕рддреНрд░ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ (рд╕рддреНрд░ рдЖрдИрдбреА) рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдИрдбреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рддрд╛ рд╣реИред  рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рджрд╛рдпрд░рд╛ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ SID рдХреЛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  EPROCESS рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдкрддрд╛ рдкреНрд░реЛрд╕реЗрд╕ рд╕реНрдХреЛрдк рдХрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реИред </p><br><a name="sequence"></a><br><h4 id="poryadkovye-nomera-sequence-numbers">  рдЕрдиреБрдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ </h4><br><p>  рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп 51-рдмрд┐рдЯ рдЕрдиреБрдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ рд╣реИред  рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рдирд╛рдореЛрдВ рдореЗрдВ рдЙрдирдХреЗ рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░ рдореЗрдВ 4-рдЪрд░рд┐рддреНрд░ рд╡рд╛рд▓рд╛ рдкрд╛рд░рд┐рд╡рд╛рд░рд┐рдХ рдЯреИрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдФрд░ рд╢реЗрд╖ 21 рдмрд┐рдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реНрдерд╛рдпреА рдирд╛рдо рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореВрд▓реНрдп "SequenceNumber" рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд╡реЗрддрди рд╡реГрджреНрдзрд┐ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВред  рд▓рдЧрд╛рддрд╛рд░ рдФрд░ рдЕрд╕реНрдерд╛рдпреА рдирд╛рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрддрди рд╡реГрджреНрдзрд┐ рдХрд╛рдЙрдВрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред  рдпрд╣ рдбреЗрдЯрд╛ рдкреНрд░рддреНрдпреЗрдХ рдХрдВрдЯреЗрдирд░ (рдкреНрд░рддрд┐-рд╕рд╛рдЗрд▓реЛ) рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдФрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ PspHostSiloGlobals-&gt; WnfSiloState рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред </p><br><p>  Microsoft рдХреЗ рдЕрдВрджрд░, рдкреНрд░рддреНрдпреЗрдХ WNF рдирд╛рдо рдореЗрдВ рдПрдХ "рджреЛрд╕реНрддрд╛рдирд╛" рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдХреЛрдб рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХрднреА-рдХрднреА рдЗрд╕реЗ рдЙрд╕реА рдирд╛рдо рдХреЗ рд╕рд╛рде рд╡реИрд╢реНрд╡рд┐рдХ рдирд╛рдорд╕реНрдерд╛рди рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреАрдХ nt! WNF_BOOT_DIRTY_SHUTDOWN, рдЬрд┐рд╕рдХрд╛ рдорд╛рди 0x1589012fa3bc0875 рд╣реИред  рдЬрд╛рджреВ рдирд┐рд░рдВрддрд░ <abbr title="0x41C64E6DA3BC0074">WNF_STATE_KEY рдХреЗ</abbr> рд╕рд╛рде XOR рдХреЗ рдмрд╛рдж рд╣рдореЗрдВ <abbr title="0x41C64E6DA3BC0074">0x544f4f4200000801</abbr> рдХрд╛ рдорд╛рди рдорд┐рд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ рдХреЗ рд░реВрдк рдореЗрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ: </p><br><pre> <code class="plaintext hljs">BOOT1, Well-Known Lifetime, System Scope, Version 1</code> </pre> <br><a name="syscall"></a><br><h3 id="sistemnye-vyzovy-dlya-raboty-s-wnf">  WNF рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ </h3><br><p>  рдХрд░реНрдиреЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЖрдкрдХреЛ WNF рд░рд╛рдЬреНрдп рдирд╛рдо рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ, WNF рд░рд╛рдЬреНрдп рдирд╛рдо рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдФрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рдФрд░ WNF рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рд╕реВрдЪрдирд╛рдПрдВ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </p><br><a name="register"></a><br><h4 id="registraciya-imeni-sostoyaniya-wnf">  WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВ </h4><br><p>  рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рдирд╛рдореЛрдВ (рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде, WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ OS рдЪрд▓ рд░рд╣рд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwCreateWnfStateName</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _Out_ PWNF_STATE_NAME StateName, _In_ WNF_STATE_NAME_LIFETIME NameLifetime, _In_ WNF_DATA_SCOPE DataScope, _In_ BOOLEAN PersistData, _In_opt_ PCWNF_TYPE_ID TypeId, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//      _In_ ULONG MaximumStateSize, //   4-  _In_ PSECURITY_DESCRIPTOR SecurityDescriptor // **  );</span></span></span></span></span></span></code> </pre> <br><p>  рдПрдХ рд╕рдордорд┐рдд рдкреНрд░рдгрд╛рд▓реА рдХреЙрд▓ ZwDeleteWnfStateName рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЖрдк рдкрдВрдЬреАрдХреГрдд рд░рд╛рдЬреНрдп рдирд╛рдо (рдлрд┐рд░ рд╕реЗ, рдкреНрд░рд╕рд┐рджреНрдз рд▓реЛрдЧреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░) рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><a name="publishing"></a><br><h4 id="publikaciya-dannyh-sostoyaniya-wnf">  WNF рд╕реНрдерд┐рддрд┐ рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ </h4><br><p>  WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдбреЗрдЯрд╛ рдХреЛ рд╕реЗрдЯ рдпрд╛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк ZwUpdateWnfStateData рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwUpdateWnfStateData</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ PCWNF_STATE_NAME StateName, _In_reads_bytes_opt_(Length) </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> VOID* Buffer, _In_opt_ ULONG Length, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//   ,   MaximumSize,    _In_opt_ PCWNF_TYPE_ID TypeId, //      _In_opt_ const PVOID ExplicitScope, //  , SID ,  (ID)  _In_ WNF_CHANGE_STAMP MatchingChangeStamp, //     _In_ LOGICAL CheckStamp //         );</span></span></span></span></span></span></code> </pre> <br><p>  WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд╣рдЯрд╛рдиреЗ (рд╕рд╛рдл) рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ZwDeleteWnfStateData рдПрдХ рд╕рдордорд┐рдд рдкреНрд░рдгрд╛рд▓реА рдХреЙрд▓ рд╣реИред </p><br><a name="consuming"></a><br><h4 id="poluchenie-dannyh-sostoyaniya-wnf">  WNF рд╕реНрдЯреЗрдЯрд╕ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ </h4><br><p>  WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЕрдзрд┐рдХрд╛рдВрд╢ рдкреИрд░рд╛рдореАрдЯрд░ рдЕрдкрдбреЗрдЯ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдорд╛рди рд╣реИрдВ): </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwQueryWnfStateData</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ PCWNF_STATE_NAME StateName, _In_opt_ PCWNF_TYPE_ID TypeId, _In_opt_ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> VOID* ExplicitScope, _Out_ PWNF_CHANGE_STAMP ChangeStamp, _Out_writes_bytes_to_opt_(*BufferSize, *BufferSize) PVOID Buffer, _Inout_ PULONG BufferSize </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//   0,      );</span></span></span></span></span></span></code> </pre> <br><p>  рдЕрд╕рд▓реА рддрд╛рдХрдд рдЗрд╕ рддрдереНрдп рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИ рдХрд┐ рдЕрджреНрдпрддрди рдФрд░ рдХреНрд╡реЗрд░реА API рдлрд╝рдВрдХреНрд╢рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ <u>рдкрдВрдЬреАрдХреГрдд</u> WNF рд░рд╛рдЬреНрдп рдирд╛рдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдФрд░ рдпрджрд┐ рдирд╛рдо рдЕрд╕реНрдерд╛рдпреА рдирд╣реАрдВ рд╣реИ (рдФрд░ рдХреЙрд▓рд┐рдВрдЧ рдХреЛрдб рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ), рддреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рдирд╛рдо рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ! </p><br><a name="notifications"></a><br><h4 id="uvedomleniya-wnf">  WNF рд╕реВрдЪрдирд╛рдПрдВ </h4><br><p>  рдЕрдм рддрдХ, рд╣рдордиреЗ рдорд╛рди рд▓рд┐рдпрд╛ рд╣реИ рдХрд┐ рдЙрдкрднреЛрдХреНрддрд╛ рдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ рдбреЗрдЯрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрдм рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╡рд╣рд╛рдБ рднреА <em>рдкрдврд╝рдиреЗ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░ рд░рд╣рд╛ рд╣реИ</em> , рдЬреЛ рдПрдХ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдкреНрд░рдгрд╛рд▓реА (рдЬреЛ рдХрд┐ рд╕рдЪреНрдЪреЗ рдкреНрд░рдХрд╛рд╢рдХ-рдЧреНрд░рд╛рд╣рдХ рдореЙрдбрд▓ рдХреЗ рдХрд░реАрдм рд╣реИ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ ZwSetWnfProcessNotificationEvent рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдШрдЯрдирд╛ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рддрдм рдЖрдкрдХреЛ ZwSubscribeWnfStateChange рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╕рджрд╕реНрдпрддрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдИрд╡реЗрдВрдЯ рдорд╛рд╕реНрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред  рдШрдЯрдирд╛рдПрдБ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ: </p><br><ul><li>  рдбреЗрдЯрд╛ рд╕реВрдЪрдирд╛рдПрдВ: <br><ul><li>  0x01 - рдбреЗрдЯрд╛ рдЙрдкрд╕реНрдерд┐рддрд┐ </li><li>  0x10 - рдирд╛рдо рд╡рд┐рдирд╛рд╢ </li></ul></li><li>  рдореЗрдЯрд╛ рдореЗрдЯрд╛рдиреЛрдЯрд╛рдЗрдЬрд╝реЗрд╢рди <br><ul><li>  0x02 - рдбреЗрдЯрд╛ рд╕реВрдЪрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреНрд░рд╛рд╣рдХ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ (рдбреЗрдЯрд╛ рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдмрд░) </li><li>  0x04 - рдореЗрдЯрд╛ рд╕реВрдЪрдирд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреНрд░рд╛рд╣рдХ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ (рдореЗрдЯрд╛ рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдмрд░) </li><li>  0x08 - рдбреЗрдЯрд╛ рд╕реВрдЪрдирд╛ рдФрд░ рдореЗрдЯрд╛-рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреНрд░рд╛рд╣рдХ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ (рдЬреЗрдиреЗрд░рд┐рдХ рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдмрд░) </li></ul></li></ul><br><p>  рдлрд┐рд░ рдЖрдкрдХреЛ рдЙрд╕ рдШрдЯрдирд╛ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд░рд┐рдХреЙрд░реНрдб рдХреА рдЧрдИ рдереАред  рдФрд░ рд╣рд░ рдмрд╛рд░ рдЬрдм рдИрд╡реЗрдВрдЯ рд╕рд┐рдЧреНрдирд▓ рдмрди рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ ZwGetCompleteWnfStateSubscription рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬреЛ WNF_DELIVERY_DESCRIPTOR рджреЗрддрд╛ рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдЗрди рдирд┐рдореНрди-рд╕реНрддрд░реАрдп API рдлрд╝рдВрдХреНрд╢рдВрд╕ рдореЗрдВ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ (рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХреЗ рд▓рд┐рдП рдЧреИрдмреА рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж): рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдкрдВрдЬреАрдХреГрдд рдШрдЯрдирд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред </p><br><a name="rtl"></a><br><h3 id="vysokourovnevoe-api-polzovatelskogo-rezhima-ntdll">  рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб API (ntdll) </h3><br><p>  рдЬрдм рд╕реВрдЪрдирд╛рдУрдВ рдХреА рдмрд╛рдд рдЖрддреА рд╣реИ, рддреЛ рдЪреАрдЬреЗрдВ рдЬрдЯрд┐рд▓ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП ntdll.dll рд╕реЗ rtl рдкрд░рдд рдПрдХ рд╕рд░рд▓ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RtlSubscribeWnfStateChangeNotification</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _Outptr_ PWNF_USER_SUBSCRIPTION* Subscription, _In_ WNF_STATE_NAME StateName, _In_ WNF_CHANGE_STAMP ChangeStamp, _In_ PWNF_USER_CALLBACK Callback, _In_opt_ PVOID CallbackContext, _In_opt_ PCWNF_TYPE_ID TypeId, _In_opt_ ULONG SerializationGroup, _In_opt_ ULONG Unknown )</span></span></span></span>;</code> </pre> <br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ: рдмрд╕ рдПрдХ ntdll.dll- рдЪрд╛рд▓рд┐рдд рдИрд╡реЗрдВрдЯ рдХрддрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </p><br><p>  рдкрд░реНрджреЗ рдХреЗ рдкреАрдЫреЗ, WNF_DELIVERY_DESCRIPTOR рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреЙрд▓рдмреИрдХ рдорд╛рдкрджрдВрдбреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NTSTATUS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*PWNF_USER_CALLBACK)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ WNF_STATE_NAME StateName, _In_ WNF_CHANGE_STAMP ChangeStamp, _In_opt_ PWNF_TYPE_ID TypeId, _In_opt_ PVOID CallbackContext, _In_ PVOID Buffer, _In_ ULONG BufferSize)</span></span></span></span>;</code> </pre> <br><p>  рдкреНрд░рддреНрдпреЗрдХ рдирдИ рд╕рджрд╕реНрдпрддрд╛ рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕реЗ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ RtlpWnfProcessSubsults рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рд╕реВрдЪреА рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред  рд╕реВрдЪреА WNF_NAME_SUBSCRIPTION рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рдЬреЛ LIST_ENTRY рдкреНрд░рдХрд╛рд░ рдХреА рд╣реИред  WNF_NAME_SUBSCRIPTION рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ, рдХреЙрд▓рдмреИрдХ рдФрд░ рд╕рдВрджрд░реНрдн рдХреЗ рд╕рд╛рде WNF_USER_SUBSCRIPTION рдХреА рд╕реВрдЪреА рдХреЗ рдЖрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ LIST_ENTRY рдлрд╝реАрд▓реНрдб рд╣реИред </p><br><a name="kernel"></a><br><h3 id="vysokourovnevoe-api-urovnya-yadra-ex">  рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдХрд░реНрдиреЗрд▓ рд╕реНрддрд░ API (рдкреВрд░реНрд╡) </h3><br><p>  WNF рдХрд░реНрдиреЗрд▓ рдореЛрдб рдХреЛрдб рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рд╕рдорд╛рди рдлрд╝рдВрдХреНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ (рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреНрд░рд╛рдЗрд╡рд░ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ): рджреЛрдиреЛрдВ рдирд┐рд░реНрдпрд╛рдд рдкреНрд░рдгрд╛рд▓реА рдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдФрд░ рд░рдирдЯрд╛рдЗрдо (EX рд▓реЗрдпрд░) рдореЗрдВ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп API рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред </p><br><p>  ExSubscribeWnfStateChange рдлрд╝рдВрдХреНрд╢рди рд░рд╛рдЬреНрдп рдирд╛рдо, рдкреНрд░рдХрд╛рд░ рдорд╛рд╕реНрдХ рдФрд░ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрд▓рдмреИрдХ рдлрд╝рдВрдХреНрд╢рди + рд╕рдВрджрд░реНрдн рдХреЗ рдкрддреЗ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╕рджрд╕реНрдпрддрд╛ рд╡рд┐рд╡рд░рдгрдХ рд▓реМрдЯрд╛рддрд╛ рд╣реИред  рдХреЙрд▓рдмреИрдХ рдлрд╝рдВрдХреНрд╢рди рд▓рдХреНрд╖реНрдп рдирд╛рдо, рдИрд╡реЗрдВрдЯ рдорд╛рд╕реНрдХ, рдкрд░рд┐рд╡рд░реНрддрди рд▓реЗрдмрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмрдлрд░ рдпрд╛ рдЗрд╕рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдирд╣реАрдВред </p><br><p>  рдкрд╛рд░рд┐рдд рд╕рджрд╕реНрдпрддрд╛ рд╡рд┐рд╡рд░рдгрдХ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ ExQueryWnfStateData рдлрд╝рдВрдХреНрд╢рди, рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдбреЗрдЯрд╛ рдХреЛ рдкрдврд╝рддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдмреИрдХ рд╕реВрдЪрдирд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ExQueryWnfStateData рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдХрд░реНрдиреЗрд▓ рдореЛрдб рд╕рджрд╕реНрдпрддрд╛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб рд╕рджрд╕реНрдпрддрд╛ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП, WNF (рд╕рджрд╕реНрдпрддрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) WNF_SUBSCRIPTION рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб рдХреЗ рд▓рд┐рдП, рдХреБрдЫ рдлрд╝реАрд▓реНрдб рдирд╣реАрдВ рднрд░реЗ рдЬрд╛рдПрдВрдЧреЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рдФрд░ рд╕рдВрджрд░реНрдн, рдХреНрдпреЛрдВрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб рдХреЗ рд▓рд┐рдП, рд╣реИрдВрдбрд▓рд░ рдХреЗ рдкрддреЗ ntdll.dll рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдФрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </p><br><a name="data"></a><br><h3 id="struktury-dannyh-wnf">  WNF рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдБ </h3><br><p><img src="https://habrastorage.org/webt/sj/wk/ne/sjwknenp1z89s3xldzz5jlvzidi.jpeg"><br>  <u><em>рдЕрдиреБрд╡рд╛рджрдХ рд╕реЗ</em></u> : рдЕрдЧрд▓рд╛ рднрд╛рдЧ рджреЗрдЦреЗрдВред </p><br><a name="analyze"></a><br><h3 id="utility-analiza-wnf">  WNF рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ </h3><br><p>  <u><em>рдПрдХ рдЕрдиреБрд╡рд╛рджрдХ рд╕реЗ</em></u> : рдпрд╣рд╛рдБ рдпрд╣ рдлрд┐рд░ рд╕реЗ рдпрд╛рдж рдХрд░рдиреЗ рд▓рд╛рдпрдХ рд╣реИ рдХрд┐ рдкреНрд░рд╕реНрддреБрддрд┐ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рди рдХреЗрд╡рд▓ рдПрд▓реЗрдХреНрд╕ рдиреЗ рдХрд┐рдпрд╛ рдерд╛, рдмрд▓реНрдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреЗрдмреНрд░рд┐рдпрд▓ рд╡реЗрд▓рд╛</a> рдиреЗ рднреА рдХрд┐рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдерд╛</a> ред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЗрд╕рдХрд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдиреАрдЪреЗ рд╡рд░реНрдгрд┐рдд WnfCom рдореЙрдбреНрдпреВрд▓ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЧреЗрдмреНрд░рд┐рдпрд▓ рдиреЗ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рдХреА рдЖрдВрддрд░рд┐рдХ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХрд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╡рд░рдг рдореЗрдВ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ (рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЪрд┐рддреНрд░рдг рджреЗрдЦреЗрдВ)ред  рдЗрд╕рдХреА рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕реНрд▓рд╛рдЗрдб, рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, рдкреНрд░рд╕реНрддреБрддрд┐ рдХреА рдкреАрдбреАрдПрдл (рдореВрд▓ рдХреЗ рд░реВрдк рдореЗрдВ) рдореЗрдВ рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИрдВ рдпрд╛ рд╢реАрд░реНрд╖рдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрдХреЗрддрд┐рдд рд╣реИрдВред  рд▓реЗрдХрд┐рди: </p><br><ul><li>  рдпрд╣ рдЙрдирдХреЗ рд╕рдВрдпреБрдХреНрдд рдкреНрд░рджрд░реНрд╢рди рдХреА рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рдЕрд╡рд╕рд░ рд╣реИ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдВрдбреЛрдЬ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рд╕реБрд╡рд┐рдзрд╛: рд╕рдмрд╕реЗ рдЕрд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХрд░реНрдиреЗрд▓ рд╣рдорд▓рд╛ рд╕рддрд╣ рдХреЗ рдкреНрдпрд╛рдЬ рдХреЛ рдЫреАрд▓рдирд╛</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд┐рд░ рднреА</a> рдЧреИрдмреНрд░рд┐рдПрд▓ рдХреА рд╢реБрд░реБрдЖрдд ~ 19: 27)ред  рд╡рд╣рд╛рдБ (рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛) рд╡рд╣рд╛рдБ рдПрдХ рдХрд╣рд╛рдиреА рд╣реЛрдЧреА рдХрд┐ рдЙрдиреНрд╣реЛрдВрдиреЗ рдбрд┐рдмрдЧрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреИрд╕реЗ рддрдп рдХрд┐рдпрд╛! Wnf (рд╕реНрдкреЙрдЗрд▓рд░ - NT рдЗрдирд╕рд╛рдЗрдбрд░ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд┐рдХреНрд╕рд┐рдВрдЧ рдмреНрд░реЛрдХрди рдбреАрдмрдЧрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди</a> ) </li><li>  рдЧреИрдмреНрд░рд┐рдПрд▓ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рдЕрдЪреНрдЫрд╛ рд▓реЗрдЦ рд╣реИ (рд╡рд┐рд╕реНрддреГрдд, рдПрдХ рдкреНрд░рд╕реНрддреБрддрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ) - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдВрдбреЛрдЬ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдлреИрд╕рд┐рд▓рд┐рдЯреА (рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл) рдХреЗ рд╕рд╛рде рдЦреЗрд▓рдирд╛</a> , рдЬрд┐рд╕реЗ рд╕рднреА рд░реБрдЪрд┐ рдХреЗ рд▓рд┐рдП рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><p>  <u><em>рдФрд░ рдЕрдиреБрд╡рд╛рджрдХ рд╕реЗ</em></u> : рдпрджрд┐ рдХреЛрдИ рдЧреИрдмреНрд░рд┐рдПрд▓ рд╕реНрд▓рд╛рдЗрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рд╡рд░реНрддрдорд╛рди рдЕрдиреБрд╡рд╛рдж рдХреЛ рдкреВрд░рдХ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ рдпрд╛ рднрд╛рд╖рдг рдХреЗ рд╡реАрдбрд┐рдпреЛ рдХреЗ рдХрд┐рд╕реА рднреА рд╣рд┐рд╕реНрд╕реЗ рд╕реЗ рд╢реЙрд░реНрдЯрд╣реИрдВрдб рдХреЗ рдЕрдиреБрд╡рд╛рдж рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ - рд╕реНрд╡рд╛рдЧрдд рд╣реИред  рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ / рдмрджрд▓рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдЕрдиреБрд╡рд╛рдж рд╕реНрд░реЛрдд рдХреЛ рдЧреАрдердм (рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг рд╕рд░реНрд╡рд░) рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред </p><br><a name="wnfcom"></a><br><h4 id="wnfcom">  WnfCom </h4><br><p>  WnfCom рдПрдХ рдЕрдЬрдЧрд░ рдореЙрдбреНрдпреВрд▓ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">github рд╕реНрд░реЛрдд рдХреЛрдб</a> ) рд╣реИ рдЬреЛ WNF рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдВрддрд░ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред  рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ: </p><br><ul><li>  рдЖрдкрдХреЛ рдореМрдЬреВрджрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдЙрджрд╛рд╣рд░рдгреЛрдВ рд╕реЗ рдбреЗрдЯрд╛ рдкрдврд╝рдиреЗ / рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ </li><li>  рдЖрдкрдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░рд╛рдЬреНрдп рдирд╛рдо ( <em>рд╕рд░реНрд╡рд░ рдХреЗ</em> рд░реВрдк рдореЗрдВ) рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ </li><li>  рдЖрдкрдХреЛ рдПрдХ <em>рдХреНрд▓рд╛рдЗрдВрдЯ-</em> рд╕рд╛рдЗрдб рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдирд╛рдо рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрдирд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдЧрд╛ </li></ul><br><p>  рдЙрдкрдпреЛрдЧ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wnfcomimport Wnfcom &gt;&gt;&gt; wnfserver = Wnfcom() &gt;&gt;&gt; wnfserver.CreateServer() [SERVER] StateNamecreated: <span class="hljs-number"><span class="hljs-number">41</span></span>c64e6da5559945 &gt;&gt;&gt; wnfserver.Write(<span class="hljs-string"><span class="hljs-string">b"potatosoup"</span></span>) Encoded Name: <span class="hljs-number"><span class="hljs-number">41</span></span>c64e6da5559945, Clear Name: <span class="hljs-number"><span class="hljs-number">6e99931</span></span> Version: <span class="hljs-number"><span class="hljs-number">1</span></span>, Permanent: No, Scope: Machine, Lifetime: Temporary, Unique: <span class="hljs-number"><span class="hljs-number">56627</span></span> State update: <span class="hljs-number"><span class="hljs-number">11</span></span> bytes written</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wnfcomimport Wnfcom &gt;&gt;&gt; wnfclient = Wnfcom() &gt;&gt;&gt; wnfclient.SetStateName(<span class="hljs-string"><span class="hljs-string">"41c64e6da5559945"</span></span>) &gt;&gt;&gt; wnfclient.Listen() [CLIENT] Event registered: <span class="hljs-number"><span class="hljs-number">440</span></span> [CLIENT] Timestamp: <span class="hljs-number"><span class="hljs-number">0x1</span></span> Size: <span class="hljs-number"><span class="hljs-number">0xb</span></span> Data:<span class="hljs-number"><span class="hljs-number">00000000</span></span>: <span class="hljs-number"><span class="hljs-number">70</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">70</span></span> potato soup</code> </pre> <br><a name="wnfdump"></a><br><h4 id="wnfdump">  WnfDump </h4><br><p>  WnfDump C. рдореЗрдВ рд▓рд┐рдЦреА рдПрдХ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЙрдкрдпреЛрдЧрд┐рддрд╛ рд╣реИред рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЖрд╡рд╢реНрдпрдХ рдмрд┐рдЯ рдЧрд╣рд░рд╛рдИ рдХреЗ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЪрдпрди рдХрд░рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/ionescu007/wnfun</a> рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдореЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><ul><li>  -d ( <u>D</u> ump) рд░рдЬрд┐рд╕реНрдЯреНрд░реА-рдЖрдзрд╛рд░рд┐рдд рдЧрдгрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рднреА WNF рд░рд╛рдЬреНрдп рдирд╛рдореЛрдВ рдХреЛ рдбрдВрдк рдХрд░реЗрдВред  рдЗрд╕реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдкреВрд░рдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><ul><li>  -v ( <u>V</u> erbose) рдПрдХ рд╡рд░реНрдмреЛрдЬрд╝ рдЖрдЙрдЯрдкреБрдЯ рдЬрд┐рд╕рдореЗрдВ WNF рд░рд╛рдЬреНрдп рдбреЗрдЯрд╛ рдХрд╛ рдПрдХ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдбрдВрдк рд╢рд╛рдорд┐рд▓ рд╣реИ; </li><li>  -s ( <u>S</u> ecurity) рд╕реБрд░рдХреНрд╖рд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ - SDNL WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рддрд╛рд░ред </li></ul></li><li>  -b ( <u>рдмреА</u> рд░реБрдЯ-рдмрд▓) рдЕрд╕реНрдерд╛рдпреА WNF рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдореЛрдВ рдХреА рдкреНрд░рддреНрдпрдХреНрд╖ рдЧрдгрдирд╛ (рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ) </li><li>  -i ( <u>I</u> nformation) рдПрдХрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ WNF рд░рд╛рдЬреНрдп рдирд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li><li>  -r ( <u>R</u> ead) рдирд┐рд░реНрджрд┐рд╖реНрдЯ WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рд╕реЗ рдбреЗрдЯрд╛ рдкрдврд╝реЗрдВ </li><li>  -w ( <u>рдбрдмреНрд▓реНрдпреВ</u> рд╕рдВрд╕реНрдХрд╛рд░) рдирд┐рд░реНрджрд┐рд╖реНрдЯ WNF рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд▓рд┐рдЦреЗрдВ </li><li>  -рдПрди ( <u>рдПрди</u> рдУрдЯреАрдлрд┐рдХреЗрд╢рди) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд╕реНрдерд┐рддрд┐ рдирд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдЧреНрд░рд╛рд╣рдХ рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВ (рдЗрд╕рдХреЗ рдмрд╛рдж рдПрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдзрд┐рдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧ рдорд╛рдорд▓рд╛ рд╣реЛрдЧрд╛) </li></ul><br><a name="surface"></a><br><h3 id="poverhnost-ataki-na-wnf">  рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ </h3><br><p>  рдпрд╣ рдЦрдВрдб (рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдЗрд╕рдХреЗ рдЙрдкрдЦрдВрдб) рд╕рдВрднрд╛рд╡рд┐рдд рд╣рдорд▓реЛрдВ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рдбреЗрдЯрд╛ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдЧрд╛ред </p><br><a name="disclosure"></a><br><h4 id="raskrytie-privelegirovannyh-dannyh">  рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдбреЗрдЯрд╛ рдкреНрд░рдХрдЯреАрдХрд░рдг </h4><br><p>  рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдореМрдЬреВрдж рд╣рдЬрд╛рд░реЛрдВ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд░рд╛рдЬреНрдп рдирд╛рдореЛрдВ рдХреЛ рдкрдврд╝рдирд╛, рдХрдИ рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдбреЗрдЯрд╛ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рджрд┐рдЦрддрд╛ рд╣реИред  рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдРрд╕реЗ рдереЗ рдЬрд┐рдирдХрд╛ рдбреЗрдЯрд╛ рд╕рдВрджрд┐рдЧреНрдз рд░реВрдк рд╕реЗ рд╕рдВрдХреЗрдд рдпрд╛ рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рдХреЗ рд╕рдорд╛рди рд╣реИред </p><br><p>  рдХрдИ рдорд╢реАрдиреЛрдВ рдкрд░ рдЦреЗрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдпрд╣ рдПрдХ рдЧреБрдЪреНрдЫрд╛, рд╕реНрдЯреИрдХ рдФрд░ рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рдерд╛, рдЬреЛ рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╕реАрдорд╛рдУрдВ рдореЗрдВ рдЦреБрд▓рд╛рд╕рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдмрдЧ / рднреЗрджреНрдпрддрд╛ рд░рд┐рдкреЛрд░реНрдЯ рдЬреБрд▓рд╛рдИ рдореЗрдВ MSRC рдХреЛ рд╕реМрдВрдкреА рдЧрдИ рдереА, рд▓реЗрдХрд┐рди рдирд╡рдВрдмрд░ рдореЗрдВ (рдкреНрд░рд╕реНрддреБрддрд┐ рдХреЗ рдмрд╛рдж) рд╕рд╣реА рдХрд░ рджреА рдЧрдИ рдереАред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: WNF_AUDC * рдИрд╡реЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ 4 рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо рд╕реНрдЯреИрдХ рд▓реАрдХ рд╣реБрдЖ! </p><br><p>  рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛рдПрдВ рд╡рд╣реА рд╣реИрдВ рдЬреЛ рд╣рдордиреЗ рдкрд┐рдЫрд▓реЗ рдЕрдзреНрдпрдпрдиреЛрдВ рдореЗрдВ j00ro, рдЯреИрд╡рд┐рд╕реЛ рдФрд░ рдЕрдиреНрдп рд╕реЗ рджреЗрдЦреА рдереАрдВред  рдХреБрдЫ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдореЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдкреИрдбрд┐рдВрдЧ рдФрд░ / рдпрд╛ рд╕рдВрд░реЗрдЦрдг рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдиреНрдХреЛрдбреЗрдб рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ рд╣реИрдВред  рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдмрд┐рди рдмреБрд▓рд╛рдП рдореЗрдореЛрд░реА рд▓реАрдХ рд╣реЛ рдЬрд╛рддреА рд╣реИред <br>  <u><em>рдЕрдиреБрд╡рд╛рджрдХ рд╕реЗ</em></u> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рдкрд░рд┐рдЪрдпрд╛рддреНрдордХ рднрд╛рдЧ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░реНрдиреЗрдЯ рдореЗрдореЛрд░реА рдбрд┐рд╕реНрдХреНрд▓реЛрдЬрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдореЗрдВ x86 рдПрдореБрд▓реЗрд╢рди рдФрд░ рдореЗрдЯреНрдЯреНрдЬрд╝ рдЬрд░реНрдХрдЬрд╝реА рдЙрд░реНрдл тАЛтАЛj00ro рд╕реЗ рдЯреИрдиреНрдЯ рдЯреНрд░реИрдХрд┐рдВрдЧ</a> ред </p><br><a name="discovering"></a><br><h4 id="obnaruzhenie-imen-sostoyaniy-i-razresheniy">  рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ </h4><br><p>  рдкрд╣рд▓рд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд░рд╛рдЬреНрдп рдирд╛рдореЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ рдерд╛ рдЬрд┐рдиреНрд╣реЗрдВ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рддрд░реАрдХреЗ рд╕реЗ рд╣реЗрд░рдлреЗрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛ред  рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬреНрдЮрд╛рдд, рд╕реНрдерд╛рдпреА рдФрд░ рд▓рдЧрд╛рддрд╛рд░ рдирд╛рдо рдХреЗ рд▓рд┐рдП, рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рджреНрд╡рд╛рд░рд╛ рдЧрдгрдирд╛ рд╕рдВрднрд╡ рд╣реИред  рдлрд┐рд░ рдкрд╛рдпрд╛ рдореВрд▓реНрдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореИрддреНрд░реАрдкреВрд░реНрдг рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ (рдХрдИ рдЬрдЧрд╣ рд╣реИрдВ рдЬрд╣рд╛рдВ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ :)) </p><br><p>  рдлрд┐рд░ рд╣рдо рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдХреЛ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣ рдбреЗрдЯрд╛ рдмрдлрд░ рдореЗрдВ рдкрд╣рд▓реА рдмрд╛рдд рд╣реИ)ред  рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдгрдХ рд╡рд┐рд╣рд┐рдд рдирд╣реАрдВ рд╣реИ: рдЗрд╕рдХрд╛ рдХреЛрдИ рд╕реНрд╡рд╛рдореА рдФрд░ рд╕рдореВрд╣ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рд╕реБрд░рдХреНрд╖рд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдХреЛ <em>рдареАрдХ рдХрд░рдиреЗ</em> рдХреЗ рд▓рд┐рдП рдирдХрд▓реА рдорд╛рд▓рд┐рдХ рдФрд░ рд╕рдореВрд╣ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИред </p><br><a name="temporary"></a><br><h4 id="obnaruzhenie-vremennyh-imen-sostoyaniy-i-ih-razresheniy">  рдЕрд╕реНрдерд╛рдпреА рд░рд╛рдЬреНрдп рдирд╛рдореЛрдВ рдФрд░ рдЙрдирдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ </h4><br><p>  рд▓реЗрдХрд┐рди рдЕрд╕реНрдерд╛рдпреА рдирд╛рдореЛрдВ рдХреЗ рд╕рд╛рде, рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рдЪрд╛рд▓реЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреА: рд╡реЗ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВред  рдФрд░ рдХреЗрд╡рд▓ рдХрд░реНрдиреЗрд▓ рдореЗрдореЛрд░реА рдореЗрдВ рдЙрдирдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ (! Wnf) рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрд╕реНрдерд╛рдпреА рдирд╛рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрд╕ рдХрдард┐рди рд╢рдХреНрддрд┐ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИрдВ: </p><br><ul><li>  рд╕рдВрд╕реНрдХрд░рдг рд╣рдореЗрд╢рд╛ 1 рдорд╛рдпрдиреЗ рд░рдЦрддрд╛ рд╣реИ </li><li>  рд▓рд╛рдЗрдлрдЯрд╛рдЗрдо рд╣рдореЗрд╢рд╛ WnfTemporaryStateName рдорд╛рдпрдиреЗ рд░рдЦрддрд╛ рд╣реИ </li><li>  рд╕реНрдерд╛рдпреА рдзреНрд╡рдЬ рдХреЛ рд╣рдореЗрд╢рд╛ рд╕рд╛рдлрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЕрд╕реНрдерд╛рдпреА рд░рд╛рдЬреНрдп рдХрд╛ рдирд╛рдо рд╕реНрдерд╛рдпреА рдбреЗрдЯрд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ) </li><li>  рд╕реНрдХреЛрдк (рд╕реНрдХреЛрдк) 4 рдореЗрдВ рд╕реЗ рдПрдХ рдорд╛рди рд▓реЗ рд╕рдХрддрд╛ рд╣реИ </li></ul><br><p>  рд╣рд╛рдБ, рд▓реЗрдХрд┐рди рд╢реЗрд╖ рдЕрдиреБрдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ релрез рдмрд┐рдЯреНрд╕ рд╣реИ!  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ ... рд▓реЗрдХрд┐рди рдпрд╣ рдордд рднреВрд▓реЛ рдХрд┐ рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░ рдиреАрд░рд╕ рд░реВрдк рд╕реЗ рдмрдврд╝ рд░рд╣реЗ рд╣реИрдВред  рдФрд░ рдЕрд╕реНрдерд╛рдпреА рдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП, рдЕрдиреБрдХреНрд░рдо рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдмреВрдЯ рдкрд░ 0 рдкрд░ рд░реАрд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкрд░рдореНрдкрд░рд╛рдЧрдд рд░реВрдк рд╕реЗ, рдЖрдк рдПрдХ рд▓рд╛рдЦ рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░реЛрдВ рдХреА рд╡рд┐рдВрдбреЛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ: рдПрдХ рд▓реВрдк рдореЗрдВ, ZwQueryWnfStateNameInformation рд╕реЗ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕реВрдЪрдирд╛ рд╡рд░реНрдЧ WnfInfoStateNameExist (рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ рдирд╛рдо рдХрд╛ рдЕрд╕реНрддрд┐рддреНрд╡ рднреА рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ) рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдирд╛рдо (0 рд╕реЗ рд╢реБрд░реВ) рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред  рдпрджрд┐ рдХреЛрдИ рдЕрдиреНрдп рдорд┐рд▓рд┐рдпрди рдирд╛рдо рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЦреЛрдЬ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЕрд╕реНрдерд╛рдпреА рдирд╛рдо рд╕реБрд░рдХреНрд╖рд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ (рдЕрдиреНрдп рдЕрд╕реНрдерд╛рдпреА рдирд╛рдо рдбреЗрдЯрд╛ рдХреА рддрд░рд╣) рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдЙрдирд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рдХрд░реНрдиреЗрд▓ рдореЛрдб рдбреАрдмрдЧ рдХрд░рддреЗ рд╕рдордп Wnf рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><ul><li>  рдбреЗрдЯрд╛ рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╕рдордп рдкрдарди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓реЗрдВред </li><li>  рдпрд╣ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдбреЗрдЯрд╛ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдХреЗ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдПрдХ рд╕рдлрд▓ рд▓реЗрдЦрди рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ 0 рдмрд╛рдЗрдЯ рдбреЗрдЯрд╛ рдХреЛ рдирд╖реНрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИ рдЬреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрднреЛрдХреНрддрд╛ рдЕрднреА рддрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рдирд╣реАрдВ рд╣реБрдЖ рд╣реИред  рдФрд░ рдлрд┐рд░, рдПрдХ рдЪрд╛рд▓ рд╣реИ: рд╣рдо рдЙрдкрдпреБрдХреНрдд рдкрд░рд┐рд╡рд░реНрддрди рд╕реНрдЯрд╛рдореНрдк рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рд▓реЗрдмрд▓ 0xFFFFFFFF рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ: рд▓реЗрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХреНрд╕реЗрд╕ рдЪреЗрдХ рдХреЗ рдмрд╛рдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рддреНрд░реБрдЯрд┐ рдорд╛рди рдкрд░рд┐рдгрд╛рдо рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗ рд░рд┐рд╕рд╛рд╡ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИред </li></ul><br><p>  рдпрд╣ рд╣рдореЗрдВ рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб рдЪрд▓рд╛рдХрд░ рд╣рдо рд╡рд┐рднрд┐рдиреНрди рд╕рд┐рд╕реНрдЯрдо рдЦрд╛рддреЛрдВ (рд▓реЛ IL / рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ / рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ / рдкреНрд░рдгрд╛рд▓реА) рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХрд╛ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><a name="subscribers"></a><br><h4 id="perechislenie-podpischikov">  рд╕реВрдЪреАрдмрджреНрдз рд╕рджрд╕реНрдп </h4><br><p>  WNF_PROCESS_CONTEXT рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ, рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╕реЗ рдПрдХ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рднреА рд╕рджрд╕реНрдпрддрд╛ рдХреЗ рд╕реВрдЪреА рдкреНрд░рдореБрдЦ (LIST_ENTRY) рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рд╕рджрд╕реНрдпрддрд╛ WNF_SUBSCRIPTION рдХрд╛ рдПрдХ рдЕрд▓рдЧ рдЙрджрд╛рд╣рд░рдг рд╣реИред </p><br><p>  рдХрд░реНрдиреЗрд▓-рдореЛрдб рдЧреНрд░рд╛рд╣рдХ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдореЗрдВ рд╣реИрдВред  рд╣рдо WNF_SUBSCRIPTT рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рд╣реИрдВрдбрд▓рд░ рдФрд░ рдЙрдирдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реВрдЪреА рдбрд┐рдмрдЧрд░ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдПрдХ рдЗрд╡реЗрдВрдЯ рдПрдЧреНрд░реАрдЧреЗрдЯрд░ (CEA.SYS) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрдкрдиреЗ рд╕рдВрджрд░реНрдн рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреЙрд▓рдмреИрдХ рдкрддреЗ рдХреЛ рдЫреБрдкрд╛рддрд╛ рд╣реИред </p><br><p>  рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдореЛрдб рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рджреЛрд╣рд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЙрд▓рдмреИрдХ рдкрддрд╛ NULL рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдореЛрдб рдЧреНрд░рд╛рд╣рдХ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, RtlpWnfProcessSubscos рдЯреЗрдмрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ WNF_USER_SUBSCRIPTION рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреА рд╕реВрдЪреА рдХреЛ рдбрдВрдк рдХрд░реЗрдВ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреЙрд▓рдмреИрдХ рдкрддрд╛ рд╣реИред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдЪрд░рд┐рддреНрд░ рд╕реНрдерд┐рд░ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрд╣ рдЦреБрд▓реЗ рдкрд╛рддреНрд░реЛрдВ рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрд╕рдВрддреБрд╖реНрдЯ рд╣реЛрдХрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдФрд░ рдлрд┐рд░, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ (CEA.SYS рдХрд░реНрдиреЗрд▓ рдореЛрдб рдХреЗ рд╕рд╛рде рд╕рд╛рджреГрд╢реНрдп рджреНрд╡рд╛рд░рд╛) рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдореЛрдб рд╣реИрдВрдбрд▓рд░ рдореЗрдВ рд╕реЗ рдХрдИ рдЗрд╡реЗрдВрдЯ рдПрдЧреНрд░реАрдЧреЗрдЯрд░ (EventAggregation.dll) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХреЙрд▓рдмреИрдХ рдХреЛ рдЗрд╕рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред </p><br><a name="sensitive"></a><br><h3 id="interesnye-i-chuvstvitelnye-imena-sostoyaniy-wnf">  рджрд┐рд▓рдЪрд╕реНрдк рдФрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбрдмреНрд▓реНрдпреВрдПрдирдПрдл рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо </h3><br><p>  рдпрд╣ рдЦрдВрдб рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЙрджрд╛рд╣рд░рдг рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ рдХрд┐ рдХреИрд╕реЗ рдХреБрдЫ WNF рд░рд╛рдЬреНрдп рдХреЗ рдирд╛рдо рд╕рд┐рд╕реНрдЯрдо рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рддреЗ рд╣реИрдВред </p><br><a name="system_state"></a><br><h4 id="opredelenie-sostoyaniya-sistemy-i-povedeniya-polzovatelya-s-pomoschyu-wnf">  WNF рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реНрдерд┐рддрд┐ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдирд╛ </h4><br><p>  рдХреБрдЫ WNF рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рдорд╢реАрди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреА рд░реБрдЪрд┐ рд╣реИ: </p><br><ul><li>  WNF_WIFI_CONNECTION_STATUS - рд╡рд╛рдпрд░рд▓реЗрд╕ рд╕реНрдерд┐рддрд┐ </li><li>  WNF_BLTH_BLUETOOTH_STATUS - рдЗрд╕реА рддрд░рд╣, рд▓реЗрдХрд┐рди рдмреНрд▓реВрдЯреВрде рдХреЗ рд▓рд┐рдП рднреА (WNF_TETH_TETHERING_STATE) </li><li>  WNF_UBPM_POWER_SOURCE - рдкрд╛рд╡рд░ рд╕реНрд░реЛрдд (рдмреИрдЯрд░реА рдпрд╛ рдкрд╛рд╡рд░ рдПрдбреЙрдкреНрдЯрд░) рджрд┐рдЦрд╛рддрд╛ рд╣реИ </li><li>  WNF_SEB_BATTERY_LEVEL - рдореЗрдВ рдмреИрдЯрд░реА рд╕реНрддрд░ рд╣реЛрддрд╛ рд╣реИ </li><li>  рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди рдкрд░ WNF_CELL_ * - рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИ: рдиреЗрдЯрд╡рд░реНрдХ, рдирдВрдмрд░, рд╕рд┐рдЧреНрдирд▓ рдХреА рд╢рдХреНрддрд┐, рдзрд╛рд░ рдпрд╛ 3G, ... </li></ul><br><p>   WNF         : </p><br><ul><li> WNF_AUDC_CAPTURE/RENDER тАФ   ( PID),   /  </li><li> WNF_TKBN_TOUCH_EVENT тАФ    ,       </li><li> WNF_SEB_USER_PRESENT/WNF_SEB_USER_PRESENCE_CHANGED тАФ    Windows </li></ul><br><a name="avoiding"></a><br><h4 id="alternativy-standartnym-api-uvedomleniy">   API  </h4><br><p>   ,        API  ,  API , ,      /.     WNF     . ,  ,   WNF      . </p><br><p> : WNF_SHEL_(DESKTOP)_APPLICATION_(STARTED/TERMINATED)      modern- (   ,   )  DCOM,       Win32.      тАФ       ShellExecute:    Explorer,   cmd.exe, ... </p><br><p>   ,  WNF    API  ,      : </p><br><ul><li> WNF_SHEL_LOCKSCREEN_ACTIVE тАФ     </li><li> WNF_EDGE_LAST_NAVIGATED_HOST тАФ   URL,    ( )  Edge </li></ul><br><div class="spoiler"> <b class="spoiler_title">   :      Edge</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/6x/mw/uh/6xmwuhsm2ngnwcg6kpp5htsoxby.gif"></p></div></div><br><a name="effect"></a><br><h4 id="vozdeystvie-na-sistemu-s-ispolzovaniem-wnf">      WNF </h4><br><p>    WNF,        . : WNF_FSRL_OPLOCK_BREAK тАФ ,    (/),  PID'    ! </p><br><p>       WNF     ,       . : WNF_SHEL_DDC_(WNS/SMS)_COMMAND тАУ   4 ,         . </p><br><p>  ,     WNF,      . : WNF_CERT_FLUSH_CACHE_TRIGGER (  ), WNF_BOOT_MEMORY_PARTITIONS_RESTORE, WNF_RTDS_RPC_INTERFACE_TRIGGER_CHANGED, ... </p><br><a name="inject"></a><br><h3 id="vnedrenie-v-process-s-ispolzovaniem-wnf">      WNF </h3><br><p>          : </p><br><ul><li> WriteProcessMemory тАФ    </li><li>   ( ) тАФ               </li><li>   (Atom) тАФ            </li><li>    тАФ  ,   WM_COPYDATA  DDE,       </li><li> GUI  тАФ    (   )  ,       </li></ul><br><p>  WNF         : </p><br><ul><li>       WNF,      (,        ) </li><li>      Rtl/ZwQueryWnfStateData    WNF </li></ul><br><p>  ,            : </p><br><ul><li> <abbr title="Asynchronous Procedure Call">APC</abbr> s </li><li>       (Remote Threads) </li><li>         (Changing Thread Context) </li><li>  " <em>window long</em> " тАФ  ,     ,      </li></ul><br><p>        WNF_USER_SUBSCRIPTION   (     WNF_NAME_SUBSCRIPTION,    RtlpWnfProcessSubscriptions).      ( <abbr title="Control Flow Guard">CFG</abbr> ),         ( 5  6    ). </p><br><p>       ,      :    , ,   ,     -. </p><br><a name="future"></a><br><h3 id="napravleniya-dlya-dalneyshih-issledovaniy">     </h3><br><p>    WNF   SEB_,       ( <u>S</u> ystem <u>E</u> vents <u>B</u> roker). SystemEventsBrokerServer.dll  SystemEventsBrokerClient.dll   API  . ,      SEB     SEB,     . </p><br><p>            CEA.SYS  EventAggregation.dll.    "  " (Event Aggregation Library),     ,      :     ,      ,   WNF             ,         .        WNF,     .        . </p><br><hr><br><p> <u><em> </em></u> :              . </p><br><hr><br><a name="before"></a><br><h3 id="do-prezentacii">   </h3><br><p>   ,   Windows Notification Facility     Alex'  Gabrielle.    ( )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">redp</a> . </p><br><p><img src="https://habrastorage.org/webt/kv/jx/xp/kvjxxppelx9k4zjkqbweh8ukkre.jpeg"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   WNF</a> (  )   <em>    </em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">wincheck</a> .  ,      Gabrielle Viala  ,       redp,     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">http://redplait.blogspot.com/search/label/wnf</a> . </p><br><a name="after"></a><br><h3 id="posle-prezentacii">   </h3><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PoC</a> (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> github</a> )   explorer (  тАФ  notepad). <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">modexp</a>         :   Callback  WNF_USER_SUBSCRIPTION.      : </p><br><ul><li>    explorer.exe </li><li>    WNF_USER_SUBSCRIPTION </li><li>    RWX-     ,  WriteProcessMemory (,     VirtualAllocEx + WriteProcessMemory) </li><li>     WNF_USER_SUBSCRIPTION (    WriteProcessMemory) </li><li>  ntdll!NtUpdateWnfStateData(...)   ,        </li><li>     WNF_USER_SUBSCRIPTION     </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi459626/">https://habr.com/ru/post/hi459626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi459616/index.html">MIPT рдХрдВрдкреНрдпреВрдЯрд░ рд╕рд╛рдЗрдВрд╕ рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдореЗрдВ рд░реВрд╕ рдХреЗ рдкрд╣рд▓реЗ рдЙрдиреНрдирдд рдорд╛рд╕реНрдЯрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдЦреЛрд▓рддрд╛ рд╣реИ</a></li>
<li><a href="../hi459618/index.html">рдХреБрдЫ рдЕрд▓реНрдкрдЬреНрдЮрд╛рдд рдбреЙрдХрдЯрд░-рд░рдЪрдирд╛рдПрдБ</a></li>
<li><a href="../hi459620/index.html">TDDx2, BDD, DDD, FDD, MDD рдФрд░ PDD, рдпрд╛ рдЬреЛ рдХреБрдЫ рднреА рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi459622/index.html">1995 рдореЗрдВ рд╕реЗрдЧрд╛ рд╢рдирд┐ рдХреЗ рд▓рд┐рдП рдЦреЗрд▓ рд▓рд┐рдЦреЗ рдЧрдП рдереЗ</a></li>
<li><a href="../hi459624/index.html">рд╕реИрдиреНрдп рдбреНрд░реЛрди</a></li>
<li><a href="../hi459628/index.html">рдУрдкрди рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рддреАрди рд╣рдЬрд╛рд░ рд╕реЗ рдЕрдзрд┐рдХ рд▓рд╛рдЗрд╕реЗрдВрд╕рдзрд╛рд░реА рд╣реИрдВ - рдУрдкрди рд╕реЛрд░реНрд╕ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ</a></li>
<li><a href="../hi459630/index.html">рдЯрд┐рдХ рдЯреАрдПрд╕реА рдХреЛ рдкреИрд░ рдХреА рдЕрдВрдЧреБрд▓реА рднрд╛рдЧ 2: рд╕реНрдЯреЗрдЯрд▓реЗрд╕ рдкреВрд░реНрд╡рд╡рдд рдХрд░реЗрдВ / рдлрд┐рд░ рд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi459638/index.html">рдмреИрдЯрд░реА рдкрд░ рд╡реИрд╢реНрд╡рд┐рдХ рдЬреНрдЮрд╛рди рдХрд╛ рдЖрдзрд╛рд░ рдмрдирд╛рдирд╛</a></li>
<li><a href="../hi459640/index.html">рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рдбреЙрдХреНрд╕ред рднрд╛рдЧ 1: рдЕрджреНрдпрддрди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi459642/index.html">рджрдХреНрд╖рддрд╛ рдХрд╛ рддреНрдпрд╛рдЧ рдХрд┐рдП рдмрд┐рдирд╛ C ++ рдореЗрдВ рдлрд╝реАрд▓реНрдб рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рдкрд╣реБрдБрдЪ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ CortexM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>