<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ó ü¶é üôÖüèø Wie wir geschrieben haben, das Frontend unseres eigenen Hosting-Control-Panels: Framework und Backdoors „äôÔ∏è ‚óºÔ∏è üëÇüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im letzten Artikel haben wir dar√ºber gesprochen, wie wir auf die Idee gekommen sind, ein eigenes Hosting-Control-Panel zu schreiben, und √ºber die allg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir geschrieben haben, das Frontend unseres eigenen Hosting-Control-Panels: Framework und Backdoors</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/465285/"><img src="https://habrastorage.org/webt/mt/pj/hx/mtpjhxpebii_0okylhb3xp4zzcc.png"><br>  Im letzten Artikel haben wir dar√ºber gesprochen, wie wir auf die Idee gekommen sind, ein eigenes Hosting-Control-Panel zu schreiben, und √ºber die allgemeine Struktur des fertigen Panels. <br><br>  Heute wird unser Front-End-Entwickler Artysh erz√§hlen, wie er das Front-End dieses Panels geschrieben hat: Welches Framework wurde ausgew√§hlt, welches Antimuster wird als gute Form angesehen und wie man sich gegen Backdoors verteidigt, wenn Sie vorgefertigte Bibliotheken verwenden. <br><a name="habracut"></a><br><h2>  Rahmenwahl: Warum haben Sie nach einem neuen gesucht? </h2><br>  Das vorherige Panel wurde in einem eigenen Framework implementiert, das in jQuery geschrieben wurde.  Wir sa√üen auf VMManager, es waren viele Verbesserungen erforderlich: In Bezug auf Benutzeroberfl√§che und Funktionalit√§t war es schwierig, solchen Code zu warten.  Das Hinzuf√ºgen neuer Funktionen zum Bedienfeld von vorne hat lange gedauert.  Es ist klar, dass Sie auf Wunsch ein gutes Framework f√ºr jQuery (ich liebe jQuery immer noch) oder sogar einen Anschein von CMS implementieren k√∂nnen. Dies war jedoch nicht die beste Option: Beginnen Sie mit einer geringen Dokumentation eines selbst geschriebenen Frameworks und enden Sie mit der nicht ganz korrekten Architektur der Anwendung selbst. <br><br>  Das alte Panel wurde als Einzelseitenanwendung implementiert, und dort endeten seine guten Eigenschaften.  Nachdem ich ein weiteres R√§tsel gel√∂st hatte, um der Liste eine Schaltfl√§che hinzuzuf√ºgen, wurde mir klar, dass ich eine Alternative brauchte.  Die Wahl fiel auf Vue. <br><br><h3>  Warum SPA? </h3><br>  Die Einzelseitenanwendung ist eine ideale Wahl f√ºr ein Bedienfeld.  Das Control Panel in Bezug auf das Rendern ist eine recht einfache Sache, diese Arbeit kann leicht dem Browser des Benutzers anvertraut werden.  Dar√ºber hinaus ist die SEO-Optimierung f√ºr das Panel nicht wichtig, daf√ºr haben wir eine Hauptseite.  Nun, Benutzer des Panels sehen die erforderliche Zeit f√ºr das anf√§ngliche Laden aller erforderlichen Skripte aufgrund der Besonderheiten dieser Benutzer selbst.  Auch hier war das Backend ein klassischer RestAPI-Service, um unseren Kunden in Zukunft eine offene API zur Verf√ºgung zu stellen. <br><br>  Die SPA-Anwendung erwies sich als so leicht, dass sie gut mit dem Browser von Telefonen und Tablets zusammenarbeitet. Wir haben lediglich ein adaptives Layout erstellt und mussten keine separate Anwendung erstellen. <br><br><h3>  Warum Vue? </h3><br>  Vor 3 Jahren war Vue ein relativ junges Framework, aber selbst dann haben sie viel dar√ºber gesprochen und geschrieben, und als die Version 2.0 ver√∂ffentlicht wurde, haben wir beschlossen, darauf zu wetten - und wir hatten Recht.  Zuerst planten sie, einige in jQuery geschriebene Komponenten nur schrittweise zu ersetzen, und Vue machte es einfach.  Nachdem die ziemlich umfangreichen Komponenten neu geschrieben worden waren, entschieden sie, dass es besser war, die gesamte Anwendung in Vue umzuschreiben. <br>  Dies w√§re ein riskanter Schritt und wir haben uns aus vier Gr√ºnden daf√ºr entschieden: <br><br><ol><li>  Vue ist ein einfacher deklarativer Rahmen, den selbst Programmierer verstehen k√∂nnen.  Wenn √ºberhaupt, ist es einfach, einen Entwickler f√ºr ihn zu finden oder einfach einen Freund zu unterrichten.  Dies bedeutet, dass wir keine Probleme haben werden, einen neuen Entwickler zu finden und in das Projekt einzusteigen, wenn eine Stra√üenbahn mich √ºberquert (Lob an die G√∂tter, sie sind nicht in meiner Stadt). </li><li>  Vue eignet sich objektiv gut zum Schreiben von SPA-Anwendungen. </li><li>  Ich hatte die Erfahrung, React vor meinen Augen zu entwickeln, und ich schlug vor, dass die Popularit√§t von Vue ebenfalls zunehmen wird.  Jetzt ist das Framework in den TOP-3 der g√§ngigen JS-Frameworks enthalten (dies l√§sst sich leicht mit einer Suchabfrage √ºberpr√ºfen), nach React und Angular.  Er hat gute Unterst√ºtzung, ein entwickeltes √ñkosystem und eine gro√üe Gemeinschaft. </li><li>  Entwicklungsgeschwindigkeit.  Pers√∂nlich begann ich sofort, Vue als eine Art Konstruktor wahrzunehmen, und die Entwicklung darauf ist ziemlich schnell: Wenn ich zum Beispiel eine Datumsauswahl ben√∂tige, die h√∂chstwahrscheinlich bereits auf Vue vorhanden ist, kann sie von der Community kostenlos verwendet und getestet werden.  Ich installiere einfach die Komponente im Projekt, schreibe ein Tag und alles funktioniert.  Tats√§chlich besteht unser Panel zu 70-80% aus den fertigen Bibliotheken.  Ich meine die Verwendung der Komponente, nicht die Gr√∂√üe der Codebasis, die mit einem Befehl wie npx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">intrinsic</a> / loc √ºberpr√ºft werden kann </li></ol><br>  Bei der Umsetzung eines Projekts ber√ºcksichtigen Sie immer dessen Perspektiven, insbesondere Entwicklungsperspektiven.  Und die Tatsache, dass Vue-√ñkosysteme bereits Tools wie Weex, Quasar Framework oder Nuxt f√ºr mich haben, erweitert den Horizont unserer Panel-Entwicklung erheblich. <br><br>  Auf Habr√© gibt es einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wunderbaren Artikel √ºber Vue</a> von seinem Sch√∂pfer, und ich werde √ºber einige Funktionen unserer Anwendung berichten. <br><br><h2>  Vuex Sync mit RestAPI Service </h2><br>  Ein Teil der globalen Vuex-Speicherdaten in unserer Anwendung wird durch normale Anforderungen an die entsprechenden Adressen mit RestAPI synchronisiert.  Warum haben wir das gemacht?  Zumindest, damit die Hauptbenutzereinstellungen nicht an einen bestimmten Browser eines bestimmten Ger√§ts gebunden sind.  Sie k√∂nnen unser Panel vom Computer Ihrer Frau oder von einem Spieleclub aus betreten und gleichzeitig in die vertraute Umgebung gelangen, die Sie in Ihrem eigenen Auto hatten. <br><br>  Wenn die Synchronisierung nur mit localStorage erfolgte, haben einige Browser den Inhalt von localStorage w√§hrend der Aktualisierungen verloren - er wurde vollst√§ndig gel√∂scht.  Ja, und in letzter Zeit gab es eine Tendenz, die Richtlinie zum Speichern von Benutzerdaten in Cookies zu versch√§rfen, beispielsweise eine Funktion in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WebKit Intelligent Tracking Prevention</a> - f√ºr eine Stunde werden sie zu localStorage gelangen. <br><br><h2>  Ereignisbus </h2><br>  Ja, wir verwenden den globalen Ereignisbus.  Wie bei jeder anderen gro√üen Anwendung mit vielen Komponenten besteht fr√ºher oder sp√§ter die Notwendigkeit, eine Interaktion zwischen nicht verwandten Komponenten herzustellen.  Auch durch globale Speicherung.  Es ist klar, dass bei einer Eltern-Kind-Beziehung die Interaktion standardm√§√üig √ºber die Requisiteneigenschaften in die eine und die $ emit-Methode in die andere Richtung oder √ºber die Speicherung organisiert wird, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie in den Vue-Empfehlungen beschrieben</a> . <br><br>  Die Dokumentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beschreibt aber auch die M√∂glichkeit der Verwendung des globalen Ereignisbusses</a> .  Wir haben eine Reihe von Formularen im Projekt mit unterschiedlichen Felds√§tzen. In einigen F√§llen (es gibt nicht viele, aber alle sind von grundlegender Bedeutung) m√ºssen Sie auf besondere Weise auf √Ñnderungen des Feldwerts reagieren.  Es ist nicht sinnvoll, die Werte aller Felder jedes Formulars im globalen Speicher zu speichern: <br><br><ol><li>  Erstens wegen der seltenen Notwendigkeit </li><li>  Zweitens werden alle unsere Formulare dynamisch generiert und die Anzahl der Felder f√ºr jedes Formular kann sich dramatisch √§ndern. </li></ol><br>  Also habe ich mich f√ºr den Event-Bus-Mechanismus entschieden.  Gleichzeitig hindert Sie nichts daran, Ihren Event-Emitter zu verwenden - die Hauptsache ist, diesen Mechanismus sorgf√§ltig zu verwenden, nur f√ºr Ausnahmesituationen, und alles sorgf√§ltig f√ºr sich selbst zu bereinigen. <br><br><h2>  RestAPI-Interaktion mit dem Panel </h2><br>  Um die Benutzeroberfl√§che im alten jQuery-Framework reaktionsf√§higer zu machen, wurde das Feedback von RestAPI an die Clientanwendung √ºber ein gerissenes Zeitgebersystem emuliert: Es f√ºhrte RestAPI-Abfragen in einem bestimmten Intervall aus und zeichnete die DOM-Knoten neu, die die √Ñnderungen beeinflussten. <br><br>  Dies war keine ideale L√∂sung: In allen modernen Browsern frieren Timer fast vollst√§ndig ein, wenn die Registerkarte inaktiv wird und eine niedrige Priorit√§t erh√§lt.  Infolgedessen kann eine Anforderung an den RestAPI-Dienst verz√∂gert werden und bereits irrelevante Daten empfangen. <br><br>  Um dieses Problem in einem neuen Panel zu l√∂sen, habe ich mich entschieden, das Bundle aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem Nchan-Modul</a> f√ºr den Nginx-Webserver und die neuen Funktionen der HTML5-Schnittstellen - EventSource und WebWorker - zu verwenden. <br><br>  Das Nchan-Modul unterst√ºtzt das Senden von Nachrichten √ºber Websocket, EventSource und Long-Polling.  Ich habe mehrere Tests durchgef√ºhrt und mich f√ºr EventSource entschieden: Nachrichten k√∂nnen nur Text sein und Nachrichten flie√üen nur in eine Richtung (vom Server).  Dies l√∂ste die Aufgabe vollst√§ndig. <br><br>  Jetzt wird die EventSource-Oberfl√§che unabh√§ngig von der Aktivit√§t der Registerkarte in einem separaten WebWorker-Hintergrundthread ausgef√ºhrt.  Im selben Thread ist eine primitive Nachrichtenwarteschlange so organisiert, dass nichts verloren geht.  Die Warteschlange wird an den Hauptthread der Anwendung gesendet, der wiederum die erforderlichen Neuzeichnungen der Benutzeroberfl√§che erstellt, wenn dies zweckm√§√üig ist und den Browser zul√§sst. <br><br><h2>  Hintert√ºren: Wie und warum √ºberpr√ºfe ich die Sicherheit von Komponenten? </h2><br>  Vor dem Anschlie√üen der Bibliothek muss die Sicherheit √ºberpr√ºft werden: Es gab einen Fall, in dem eine Komponente speziell eine Hintert√ºr einf√ºhrte, die den Zugriff auf die Site und das Herunterladen von Daten erm√∂glichte. <br><br>  Aber h√§ufiger treten Sicherheitsl√ºcken aufgrund der Schlamperei der Entwickler auf.  Auf den Anwendungsm√§rkten gibt es ein Team, das Komponenten auf Sicherheit √ºberpr√ºft, aber es ist nicht zu zahnig und es ist besser, Bibliotheken manuell zu √ºberpr√ºfen. <br><br>  Ich √ºberpr√ºfe Pakete immer auf Preinstall-, Installations- und Postinstall-Hooks im Feld "scripts" der Datei "package.json".  Au√üerdem verwende ich statische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paketanalysatoren</a> wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Retirement</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Snyk</a> und den Befehl ‚Äûaudit‚Äú des npm-Paketmanagers. <br><br>  Sicherheitswarnungen treten auf verschiedenen Ebenen auf, meistens w√§hrend des Scans, wenn unkritische Warnungen auftreten.  Manchmal reicht es aus, ein Upgrade durchzuf√ºhren, um eine Bibliothek zu behandeln. Die Bibliotheksentwickler selbst √ºberwachen die Sicherheit. <br><br>  Wenn sich eine Bibliothek einmal selbst kompromittiert hat, ist es besser, sie zu ersetzen - dies ist ein Zeichen f√ºr Unzuverl√§ssigkeit. Bei Warnungen suche ich nach einer anderen Bibliothek. <br><br>  Nachdem das Paket die Analyse bestanden hat, werde ich definitiv seine Version korrigieren.  Wenn Sie eine andere Version ben√∂tigen, besteht das Paket die Analyse erneut.  Ja, es braucht Zeit, aber es lohnt sich. <br><br>  Hintert√ºren sind bisher noch nie in unsere Produktion gekommen. <br><br><h2>  Viele, viele Kommentare </h2><br>  Wie gesagt, Vue wurde aufgrund seiner Einfachheit und Aussagekraft ausgew√§hlt.  Dar√ºber hinaus schreibe ich in fast jeder Zeile viele Kommentare: In diesem Fall kann ein neuer Entwickler das Projekt problemlos eingeben und ich selbst kann problemlos zu den alten Codeteilen zur√ºckkehren. <br><br><h2>  Warum ich mich in das neue Frontend und das Panel verliebt habe </h2><br><h4>  Es ist einfacher geworden, Code zu pflegen </h4><br>  Die Entwicklung dauerte ein halbes Jahr.  Jetzt besch√§ftige ich mich eher mit Panel-Unterst√ºtzung, mein Code dr√ºckt nicht und reibt nicht. <br><br><h4>  Kunden k√∂nnen schnell bekommen, was sie angefordert haben. </h4><br><img src="https://habrastorage.org/webt/d9/ko/zg/d9kozgyoj_it6a913dxovniuifk.png"><br><br>  Es wurde schnell und bequem, neue Funktionen hinzuzuf√ºgen, die im Backend angezeigt wurden: Zum Beispiel habe ich die Zahlung f√ºr juristische Personen innerhalb von 2 Tagen und Schnappsch√ºsse innerhalb eines Tages hinzugef√ºgt. <br><br><h2>  Ich bin offen f√ºr Fragen </h2><br>  In diesem Artikel habe ich einige der Geheimnisse enth√ºllt, die mit dem Frontend unseres Panels zusammenh√§ngen.  Wenn Sie Fragen haben - willkommen zu kommentieren, werde ich versuchen zu beantworten. <br><br>  Und nat√ºrlich lade ich Sie ein, Vorschl√§ge zur Verbesserung des Panels zu machen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnieren Sie unseren Instagram-Entwickler </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465285/">https://habr.com/ru/post/de465285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465275/index.html">Alice bekommt Geschicklichkeit</a></li>
<li><a href="../de465277/index.html">Analysieren und Analysieren der Semantik f√ºr SEO: 5 kostenlose Google Sheets-Vorlagen</a></li>
<li><a href="../de465279/index.html">Gesichtserkennung mit siamesischen Netzwerken</a></li>
<li><a href="../de465281/index.html">Kontinuierliche Glukose√ºberwachung (NMH) mit Medtronic 640g Pumpe</a></li>
<li><a href="../de465283/index.html">‚ÄûEs gibt alles, was ben√∂tigt wird, und nichts macht w√ºtend‚Äú - die Wahrheit spricht durch die Lippen des Klienten</a></li>
<li><a href="../de465289/index.html">Die Zusammenfassung der Ereignisse f√ºr HR-Experten im Bereich IT f√ºr September 2019</a></li>
<li><a href="../de465291/index.html">N√§her am Boden: Wie ich Coworking in ein Dorfhaus verwandelte</a></li>
<li><a href="../de465293/index.html">Wie wir den gro√üen Hackathon aufgaben und anfingen, Reisen f√ºr einzelne Teams zu unternehmen</a></li>
<li><a href="../de465295/index.html">Wie ich in der T√ºrkei gearbeitet und den lokalen Markt kennengelernt habe</a></li>
<li><a href="../de465297/index.html">"Das Beste, was ich in meiner Karriere getan habe, ist, den Job in die H√∂lle zu schicken." Chris Dancy √ºber das Verwandeln des Lebens in Daten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>