<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÄ ‚úåüèø ‚òÅÔ∏è XXE: entidade externa XML üßïüèΩ üë©üèº‚Äçü§ù‚Äçüë®üèª üëáüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, explicaremos o que √© a inje√ß√£o de entidades XML externas, descreveremos alguns exemplos comuns, explicaremos como encontrar e usar difer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>XXE: entidade externa XML</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vds/blog/454614/"><img src="https://habrastorage.org/getpro/habr/post_images/f3b/531/918/f3b531918a09a85fc1df23a7805721b2.svg" alt="imagem"><br>  Neste artigo, explicaremos o que √© a inje√ß√£o de entidades XML externas, descreveremos alguns exemplos comuns, explicaremos como encontrar e usar diferentes tipos de inje√ß√µes de XXE e tamb√©m generalizaremos como evitar ataques com a ajuda deles. <br><a name="habracut"></a><br><h3>  O que √© uma inje√ß√£o de entidades XML externas? </h3><br>  A inje√ß√£o de entidades XML externas (tamb√©m conhecida como XXE) √© uma vulnerabilidade de seguran√ßa da Web que pode permitir que um invasor interfira no processamento de dados XML por um aplicativo.  Geralmente, ele permite que um invasor exiba arquivos no sistema de arquivos do servidor de aplicativos e interaja com qualquer servidor ou sistema externo que o pr√≥prio aplicativo possa acessar. <br><br>  Em algumas situa√ß√µes, um invasor pode alavancar um ataque XXE para comprometer um servidor principal ou outra infraestrutura interna, explorando a vulnerabilidade XXE para executar ataques de falsifica√ß√£o de solicita√ß√£o (SSRFs) no servidor. <br><br><h3>  Como surgem as vulnerabilidades do XXE? </h3><br>  Alguns aplicativos usam o formato XML para transferir dados entre o navegador e o servidor.  Os aplicativos que fazem isso quase sempre usam as APIs de biblioteca ou plataforma padr√£o para processar dados XML no servidor.  As vulnerabilidades do XXE surgem porque a especifica√ß√£o XML cont√©m v√°rias fun√ß√µes potencialmente perigosas, e os analisadores padr√£o suportam essas fun√ß√µes, mesmo que elas n√£o sejam normalmente usadas pelo aplicativo. <br><br>  Entidades externas XML s√£o um tipo de entidade XML personalizada cujos valores espec√≠ficos s√£o carregados a partir dos arquivos DTD nos quais eles s√£o gravados.  Entidades externas s√£o particularmente interessantes do ponto de vista de seguran√ßa, porque permitem definir uma entidade com base no conte√∫do de um caminho ou URL de arquivo. <br><br><h3>  Que tipos de ataques XXE existem? </h3><br><ul><li>  Usando XXE para extrair arquivos, em que uma entidade externa, incluindo o conte√∫do do arquivo, √© determinada e retornada na resposta do aplicativo. </li><li>  Usando o XXE para executar ataques SSRF, em que uma entidade externa √© determinada com base na URL do sistema interno. </li><li>  Usando a extra√ß√£o cega de informa√ß√µes XXE no canal de controle, onde dados confidenciais s√£o transferidos do servidor de aplicativos para o sistema controlado pelo invasor. </li><li>  Usando XXE cego para retornar dados de mensagens de erro quando um invasor pode disparar uma mensagem de erro contendo as informa√ß√µes necess√°rias. </li><li>  Usando XXE para extrair arquivos </li></ul><br>  Para executar um ataque da inje√ß√£o XXE do formul√°rio, que extrai um arquivo arbitr√°rio do sistema de arquivos do servidor, voc√™ deve modificar o XML apresentado de uma das duas maneiras: <br><br><ul><li>  Digite (ou modifique) o elemento DOCTYPE que define a entidade externa que cont√©m o caminho do arquivo. </li><li>  Altere o valor dos dados em XML retornados na resposta do aplicativo para usar uma entidade externa espec√≠fica. </li></ul><br>  Por exemplo, suponha que um aplicativo de compras verifique a quantidade de estoques de produtos enviando o seguinte XML ao servidor: <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span>381<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span>      XXE,     XXE    /etc/passwd,    XXE: <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt; ]&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;xxe;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Essa estrutura XXE define uma entidade externa &amp; xxe, cujo valor √© o conte√∫do do arquivo / etc / passwd, e usa uma entidade com o valor productId.  Isso faz com que a resposta do aplicativo inclua o conte√∫do do arquivo: <br><br><pre> <code class="bash hljs">Invalid product ID: root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin ...</code> </pre> <br>  No caso de vulnerabilidades reais do XXE, geralmente haver√° um grande n√∫mero de valores de dados no XML enviado, qualquer um dos quais pode ser usado na resposta do aplicativo.  Para testes sistem√°ticos de vulnerabilidades do XXE, como regra, ser√° necess√°rio verificar cada n√≥ de dados em XML individualmente, usando uma entidade espec√≠fica e ver o status da resposta. <br><br>  Al√©m de extrair dados confidenciais, outra maneira de usar ataques XXE √© us√°-los para falsificar solicita√ß√µes do lado do servidor (SSRF). <br><br>  Essa √© uma vulnerabilidade potencialmente s√©ria; com sua ajuda, o aplicativo do servidor pode ser usado para executar solicita√ß√µes HTTP para qualquer URL que o servidor possa acessar. <br><br>  Para usar a vulnerabilidade XXE para executar um ataque SSRF, voc√™ deve definir uma entidade XML externa usando a URL que deseja acessar e usar uma entidade espec√≠fica com um valor de dados.  Se voc√™ pode usar uma entidade espec√≠fica com o valor dos dados retornados na resposta do aplicativo, √© poss√≠vel visualizar a resposta do URL na resposta do aplicativo e, assim, obter intera√ß√£o bidirecional com o sistema do servidor.  Caso contr√°rio, voc√™ poder√° executar apenas ataques cegos do SSRF (que tamb√©m podem ter consequ√™ncias cr√≠ticas). <br><br>  No exemplo a seguir, usando XXE, uma entidade externa for√ßa o servidor a executar uma solicita√ß√£o HTTP interna para o sistema interno na infraestrutura do sistema: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"&gt; ]&gt;</span></span></code> </pre> <br><h3>  Usando o XXE para executar ataques SSRF: </h3><br>  Muitos tipos de vulnerabilidades do XXE s√£o cegas.  Isso significa que o aplicativo n√£o retorna o valor de nenhuma entidade externa espec√≠fica em suas respostas e, portanto, a pesquisa direta de arquivos no lado do servidor √© imposs√≠vel. <br><br>  As vulnerabilidades cegas do XXE ainda podem ser detectadas e exploradas, mas s√£o necess√°rios m√©todos mais avan√ßados.  √Äs vezes, voc√™ pode usar m√©todos externos para procurar vulnerabilidades e us√°-los para exfiltrar dados.  √Äs vezes, tamb√©m pode causar erros de an√°lise XML que resultam na divulga√ß√£o de dados confidenciais em mensagens de erro. <br><br><h3>  Pesquisa e uso de vulnerabilidades cegas XXE: </h3><br>  A capacidade de atacar com uma inje√ß√£o XXE √© √≥bvia em muitos casos, pois o tr√°fego HTTP normal do aplicativo inclui solicita√ß√µes que cont√™m dados XML.  Em outros casos, a capacidade de atacar √© menos percept√≠vel.  No entanto, se voc√™ procurar nos lugares certos, encontrar√° a oportunidade de um ataque XXE em consultas que n√£o cont√™m XML. <br><br><h3>  XInclude Ataques </h3><br>  Alguns aplicativos recebem dados enviados pelo cliente, insere-os no lado do servidor em um documento XML e os analisa.  Um exemplo disso √© quando os dados do cliente s√£o colocados em uma solicita√ß√£o de back-end SOAP, que √© processada pelo servi√ßo de back-end SOAP. <br><br>  Nesse caso, voc√™ n√£o pode executar o ataque XXE cl√°ssico porque n√£o est√° no controle de todo o documento XML e, portanto, n√£o pode determinar ou modificar o elemento DOCTYPE.  No entanto, voc√™ pode usar o XInclude.  XInclude faz parte da especifica√ß√£o XML, que permite criar um documento XML a partir de documentos aninhados.  Voc√™ pode colocar um ataque XInclude em qualquer valor de dados em um documento XML, para que o ataque possa ser realizado em situa√ß√µes em que voc√™ esteja gerenciando apenas um elemento de dados colocado em um documento XML no lado do servidor. <br><br>  Para executar um ataque do XInclude, voc√™ deve fazer refer√™ncia ao espa√ßo para nome do XInclude e especificar o caminho para o arquivo que deseja envolver.  Por exemplo: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XInclude"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xi:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:///etc/passwd"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Alguns aplicativos permitem que os usu√°rios carreguem arquivos, que s√£o processados ‚Äã‚Äãno lado do servidor.  Alguns formatos de arquivo comuns usam XML ou cont√™m subcomponentes XML.  Exemplos de formatos XML s√£o os formatos de documento do Office, como DOCX, e os formatos de imagem, como SVG. <br><br>  Por exemplo, um aplicativo pode permitir que os usu√°rios carreguem imagens e processem ou as verifiquem no servidor ap√≥s o download.  Mesmo que o aplicativo espere receber o formato PNG ou JPEG, a biblioteca de processamento de imagens usada pode suportar imagens SVG.  Como o formato SVG usa XML, um invasor pode enviar uma imagem SVG mal-intencionada e, assim, ser capaz de atacar vulnerabilidades do XXE. <br><br><h3>  Usando XXE, fazendo upload de arquivos de imagem: </h3><br>  A maioria das solicita√ß√µes POST usa o tipo de conte√∫do padr√£o criado por formul√°rios HTML, como application / x-www-form-urlencoded.  Alguns sites esperam receber solicita√ß√µes nesse formato, mas permitem outros tipos de conte√∫do, incluindo XML. <br><br>  Por exemplo, se uma solicita√ß√£o regular contiver o seguinte: <br><br><pre> <code class="xml hljs">POST /action HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 7 foo=bar         : POST /action HTTP/1.0 Content-Type: text/xml Content-Length: 52 <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span>bar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Se um aplicativo aceita solicita√ß√µes que cont√™m XML no corpo da mensagem e analisa o conte√∫do como XML, voc√™ pode ter a oportunidade de atacar o XXE simplesmente reformatando as solicita√ß√µes para usar o formato XML. <br><br><h3>  Como encontrar e verificar vulnerabilidades do XXE </h3><br>  A grande maioria das vulnerabilidades do XXE pode ser encontrada de maneira r√°pida e confi√°vel usando o scanner de vulnerabilidades da Web Burp Suite. <br><br><ul><li>  O teste manual de vulnerabilidades do XXE normalmente inclui: </li><li>  Testando a extra√ß√£o de arquivo, definindo uma entidade externa com base em um arquivo conhecido do sistema operacional e usando esse objeto nos dados retornados na resposta do aplicativo. </li><li>  Testando vulnerabilidades cegas do XXE, definindo uma entidade externa com base na URL do sistema que voc√™ est√° gerenciando e monitorando a intera√ß√£o com este sistema.  O cliente Burp Collaborator √© ideal para esse fim. </li><li>  Testando a inclus√£o vulner√°vel de dados do usu√°rio n√£o XML em um documento do servidor XML usando um ataque XInclude para tentar obter um arquivo conhecido do sistema operacional. </li></ul><br><h3>  Como evitar vulnerabilidades do XXE </h3><br>  Quase todas as vulnerabilidades do XXE surgem devido ao fato de a biblioteca de an√°lise de aplicativos XML suportar fun√ß√µes XML potencialmente perigosas que o aplicativo n√£o precisa ou n√£o se destina a usar.  A maneira mais f√°cil e eficaz de impedir ataques XXE √© desativar esses recursos. <br><br>  Como regra, basta desabilitar a resolu√ß√£o de entidades externas e desabilitar o suporte ao XInclude.  Isso geralmente pode ser feito usando op√ß√µes de configura√ß√£o ou substituindo programaticamente o comportamento padr√£o.  Para obter mais informa√ß√µes sobre como desativar recursos desnecess√°rios, consulte a documenta√ß√£o da biblioteca de an√°lise de XML ou API. <br><br><hr><br>  Voc√™ pode usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">laborat√≥rios especializados</a> como campo de treinamento para testar as habilidades de explora√ß√£o de tais vulnerabilidades. <br><br><hr><br>  As configura√ß√µes mais recentes de dois processadores de servidores dedicados com os processadores Intel Scalable 2019 est√£o dispon√≠veis no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>DEDIC.SH</b></a> : <br><ul><li>  2x Xeon Silver 4214 - um total de 24 n√∫cleos </li><li>  2x Xeon Gold 5218 - um total de 32 n√∫cleos </li><li>  2x Xeon Gold 6240 - configura√ß√£o com 36 n√∫cleos. </li></ul><br>  O custo de um servidor com dois Xeon Silver 4214 - a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>partir de 15210 rublos / m√™s</b></a> <br>  Tamb√©m estamos prontos para coletar <b>qualquer configura√ß√£o</b> para voc√™ - <b><a href="">escreva-nos</a></b> ! <br><br>  Se n√£o s√£o necess√°rias grandes pot√™ncias de um servidor dedicado - √© necess√°rio o <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VDS de 150 rublos / m√™s</a></b> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454614/">https://habr.com/ru/post/pt454614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454604/index.html">Gerando um aplicativo React com um back-end do GraphQL em minutos</a></li>
<li><a href="../pt454606/index.html">Recursos do atributo inputmode para SO e navegadores m√≥veis</a></li>
<li><a href="../pt454608/index.html">Contrato de n√≠vel de servi√ßo: escrevemos SLA para ... outros, ou a conclus√£o de um SLA com um operador de telecomunica√ß√µes</a></li>
<li><a href="../pt454610/index.html">Marketing de conte√∫do, SEO, testes e pesquisas: 9 ferramentas para promover uma startup no exterior</a></li>
<li><a href="../pt454612/index.html">Agentes de aprendizado de m√°quina na Unity</a></li>
<li><a href="../pt454616/index.html">O uso da IA ‚Äã‚Äãpara aumentar a efici√™ncia dos trabalhadores mentais</a></li>
<li><a href="../pt454618/index.html">Po√ßo da produtividade: como o Slack prejudica nosso fluxo de trabalho</a></li>
<li><a href="../pt454620/index.html">#NoDeployFriday: ajuda ou prejudica?</a></li>
<li><a href="../pt454622/index.html">Kreisel EVEX 910e: modelo hist√≥rico - nova vida</a></li>
<li><a href="../pt454626/index.html">DevOops ontem e hoje</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>