<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇ ‚ö†Ô∏è ‚¨úÔ∏è Para que devemos construir uma CDN? üç™ ü§üüèª üßîüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Habr! Neste artigo, criaremos nosso pr√≥prio CDN. Por que n√£o usar solu√ß√µes prontas? Como o site do autor √© totalmente est√°tico, criado em Jekyll, c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Para que devemos construir uma CDN?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/466447/"> Oi Habr!  Neste artigo, criaremos nosso pr√≥prio CDN.  Por que n√£o usar solu√ß√µes prontas?  Como o site do autor √© totalmente est√°tico, criado em Jekyll, com fotos grandes que precisam ser exibidas o mais r√°pido poss√≠vel.  O servidor n√£o deve estar armazenando em cache, ele deve armazenar o site inteiro, suportar HTTP / 2 e Brotli e o mesmo certificado deve ser instalado em todos os servidores. <br><br>  Tamb√©m faremos tudo isso no IIS em execu√ß√£o no Windows Server 2019 Core. <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/jd/-8/bh/jd-8bhr2bkenojiyts1op3nxdr0.jpeg"></a> </div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Brevemente sobre a implementa√ß√£o</font> </h2><br>  Nos n√≥s finais, gerenciaremos os meios embutidos no sistema operacional, precisaremos de: <br><br><ol><li>  Diret√≥rio ativo </li><li>  Dfs </li><li>  IIS </li><li>  Winacme </li><li>  RSAT </li></ol><br>  Opcional, mas recomendado: <br><br><ol><li>  Centro de administra√ß√£o do Windows </li></ol><br>  Em sites com sites, apenas o IIS e o DFS s√£o necess√°rios, o Active Directory √© necess√°rio, o DFS, que sincronizar√° o conte√∫do do site entre servidores.  O RSAT √© necess√°rio para gerenciar componentes e o Windows Admin Center √© necess√°rio para editar o registro.  Isso tamb√©m pode ser feito atrav√©s do Powershell, que tamb√©m discutirei. <br><br>  O dom√≠nio do autor √© chamado ***. ***. Wtf (por favor, n√£o se assuste), e os servidores t√™m o nome de data centers e t√™m nomes no formato cache-zur1, cahe-ru e assim por diante.  O AD √© implantado e os servidores est√£o conectados a ele.  Agora em ordem. <br><br><h2>  <font color="#3AC1EF">Sele√ß√£o de ponto</font> </h2><br>  O RUVDS possui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8 data centers</a> - 3 na Europa e 5 na R√∫ssia.  Minha escolha recaiu sobre Rucloud em Moscou e LD8 (a de Londres).  Rucloud porque quase n√£o √© diferente do M9, e atrav√©s de Londres h√° um cabo transcontinental para os EUA, ent√£o na Europa √© um must have.  Para uma distribui√ß√£o mais restrita na Europa, voc√™ pode escolher a Su√≠√ßa ou a Alemanha - isso, em geral, pode parar. <br><br><h2>  <font color="#3AC1EF">Escolhendo um DNS GeoIP</font> </h2><br>  Se o cliente estiver batendo no site, como entender qual servidor deve transmitir os dados para ele?  Usando DNS, √© claro.  Ou seja, dependendo do endere√ßo IP de quem dirigiu o DNS, uma resposta relevante ser√° dada. <br><br>  Podemos usar nosso pr√≥prio DNS (BIND com um plug-in para Maxmind) ou uma solu√ß√£o pronta para uso (Route53).  Uma assinatura dos bancos de dados Maxmind GeoIP custa US $ 25 por m√™s, e o Route53 custa US $ 0,50 por zona de dom√≠nio, mais um centavo se voc√™ atender a um milh√£o de solicita√ß√µes.  Al√©m disso, criar outro ponto de fortalecimento dos ataques DDoS √© a √∫ltima coisa, ent√£o minha escolha caiu no Route53. <br><br>  Este artigo √© sobre CDN for Europe;  se voc√™ precisar de um CDN para a R√∫ssia, a escolha do seu pr√≥prio DNS √© √≥bvia, porque o Route53 fornece roteamento por pa√≠s, n√£o por cidade. <br>  A Microsoft possui servi√ßos semelhantes (Gerenciador de Tr√°fego do Azure). <br><br><h2>  <font color="#3AC1EF">1. Instale o IIS</font> </h2><br>  <b>1.1</b>  <b>Instala√ß√£o do IIS</b> <br><br>  Instalamos os componentes b√°sicos do IIS, o componente de suporte para certificados centralizados e no servidor principal suporte adicional para gerenciamento remoto.  Esse componente √© necess√°rio apenas para um servidor - voc√™ n√£o poder√° gerenciar outros servidores quando ativar configura√ß√µes compartilhadas, mesmo que o gerenciamento remoto tenha sido configurado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/d98/c66/f09d98c6665d1e5106436c0fd9fc258d.png"><br><br>  Via Powershell: <br><br><pre><code class="plaintext hljs">Install-WindowsFeature Web-Server, Web-CertProvider</code> </pre> <br>  No servidor principal, voc√™ deve instalar adicionalmente: <br><br><pre> <code class="plaintext hljs">Install-WindowsFeature Web-Mgmt-Service</code> </pre> <br>  <b>1.1.1 Ligar o controle remoto</b> <br><br>  Para que possamos gerenciar remotamente o servidor IIS, precisamos aumentar o Servi√ßo de Gerenciamento Remoto do IIS.  No servidor principal, inicie o servi√ßo: <br><br><pre> <code class="plaintext hljs">start-service WMSVC set-service -Name WMSVC -StartupType Automatic</code> </pre> <br>  E agora inclu√≠mos a capacidade de gerenciar como tal atrav√©s do registro. <br><br><pre> <code class="plaintext hljs">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server</code> </pre> <br>  A maneira mais f√°cil de gerenciar o registro, √© claro, √© atrav√©s do Centro de Administra√ß√£o do Windows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fd/9cb/7b1/8fd9cb7b19b7523283885d61564eb920.png"><br><br>  Mas isso tamb√©m pode ser feito atrav√©s do Powershell: <br><br><pre> <code class="plaintext hljs">Set-Itemproperty -path "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server" -Name "EnableRemoteManagement" -value "1"</code> </pre> <br>  No Windows Server 2012 e 2016, a regra do firewall n√£o aumenta por si s√≥; voc√™ precisa editar o firewall. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c7/13e/d35/8c713ed356d5418549cdc602c62e3161.png"><br><br><pre> <code class="plaintext hljs">Set-NetFirewallRule -Name IIS-WebServerRole-WMSVC-In-TCP -Enabled True</code> </pre> <br>  Verifique se aumentou: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/929/121/aa3/929121aa33cdffa49494d791b583da7f.png"><br><br><pre> <code class="plaintext hljs">Test-NetConnection 8.8.8.8 -port 8172</code> </pre> <br>  Tr√™s edi√ß√µes em tr√™s locais diferentes e agora podemos nos conectar atrav√©s do gerenciador do IIS ao nosso servidor usando outro servidor com uma √°rea de trabalho.  Isso foi apenas para a conveni√™ncia do gerenciamento subsequente. <br><br>  <b>1.2 Cortamos a centraliza√ß√£o das configura√ß√µes</b> <br><br>  N√£o h√° bot√µes para instalar configura√ß√µes e certificados centralizados no Gerenciador do IIS, eles est√£o apenas no gerenciador de servidor local; portanto, no Server Core, voc√™ precisar√° fazer tudo atrav√©s do Powershell. <br><br>  A centraliza√ß√£o de configura√ß√µes e certificados √© realizada atrav√©s do SMB.  Portanto, criei dois usu√°rios sem privil√©gios (separadamente para configura√ß√µes e certificados) que t√™m acesso de leitura apenas √† sua pasta e os nomeei de certadmin e configadmin. <br><br>  √â recomend√°vel que os usu√°rios sejam locais no servidor principal - se o seu controlador de dom√≠nio morrer, os aplicativos que se apegam √† configura√ß√£o e aos certificados via SMB em nome do usu√°rio do dom√≠nio morrer√£o.  O uso de usu√°rios locais elimina essa situa√ß√£o. <br><br>  <b>1.2.1 Criando uma pasta compartilhada</b> <br><br>  Duas pastas p√∫blicas devem ser armazenadas em um dos servidores, de onde obtemos a configura√ß√£o e os certificados.  Como o caminho para a pasta compartilhada, seguimos o caminho padr√£o para as configura√ß√µes do IIS: <br><br><pre> <code class="plaintext hljs">New-SmbShare -ReadAccess configadmin@**.**wtf -Path C:\windows\System32\Inetsrv\Config -Name sharedconfigs</code> </pre> <br>  E para certificados, podemos escolher qualquer.  Coloquei-os em uma pasta com o IIS. <br><br><pre> <code class="plaintext hljs">New-SmbShare -Path C:\inetpub\centralizedcerts -Name sharedconfigs -ReadAccess configadmin</code> </pre> <br>  <b>1.2.2 N√≥s conectamos n√≥s √†s configura√ß√µes</b> <br><br>  As configura√ß√µes precisam ser feitas apenas para os servidores que ler√£o essa configura√ß√£o.  Meu servidor principal sob o nome cache-ru ser√° o chefe, ent√£o eu configurei nos outros dois. <br>  Digite a senha do usu√°rio que tem acesso √† pasta: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISSharedConfig -PhysicalPath \\cache-ru.**.**wtf\SharedConfig -UserName configadmin@**.**wtf -Password $pass -DontCopyRemoteKeys</code> </pre> <br>  Imediatamente ap√≥s entrar em uma nova sess√£o deve abrir.  Para verificar se tudo funcionou, voc√™ pode abrir RSAT ‚Üí Gerenciamento do computador ‚Üí Pastas compartilhadas ‚Üí Sess√µes.  Veremos as sess√µes do usu√°rio e o endere√ßo IP do servidor, que neste usu√°rio l√™ a pasta compartilhada.  No lado do cliente, ele √© verificado pelo cmdlet: <br><br><pre> <code class="plaintext hljs">Get-IISSharedConfig</code> </pre> <br>  √â assim que me parecia: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/bc9/857/459bc9857540abe84a63229992b7d3dd.png"><br><br>  <b>1.2.2 Conectar n√≥s aos certificados</b> <br><br>  A pr√≥xima linha s√≥ pode ser inserida diretamente, tendo uma conex√£o direta com a √°rea de trabalho executando o servidor com uma GUI; ela n√£o funciona no Server Core. <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISCentralCertProvider -CertStoreLocation \\cache-ru.**.**wtf\centralizedcerts -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  Se voc√™ tentar inseri-lo atrav√©s do Winrm, ver√° a seguinte sa√≠da: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85f/e1b/c76/85fe1bc7691f4a7c4765560e4d62a2f8.png"><br><br>  Para fazer isso remotamente, voc√™ precisa editar o registro.  Qu√£o conveniente!  Voamos em: <br><br><pre> <code class="plaintext hljs">HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\</code> </pre> <br>  Crie um DWORD de 32 bits "Ativado" com o par√¢metro "1": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/06c/ba1/e1e/06cba1e1e6dd5af05cc7f9d0279e138f.png"><br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name Enabled -Value 1</code> </pre> <br>  Em seguida, criamos o valor da sequ√™ncia CertStoreLocation com o par√¢metro \\ cache-ru. **. ** wtf \ centralizedcerts: <br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name CertStoreLocation -Value &lt;a href="about:blank"&gt;\\cache-ru.**.**wtf\centralizedcerts&lt;/a&gt;</code> </pre> <br>  Para verificar se tudo est√° em ordem, usamos: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  A sa√≠da deve ser assim: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8b/dd6/48d/c8bdd648d8d5f147c8bd28d1bad9cfc0.png"><br><br>  E somente depois disso entramos: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Set-IISCentralCertProvider -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  Verifique novamente: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  Tudo pronto para o uso √© chamado.  Diferentemente das configura√ß√µes comuns, os certificados centralizados n√£o criam uma sess√£o SMB ativa. <br><br>  <b>1.2.3 Brotli</b> <br><br>  Em cada servidor, baixe e execute o arquivo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compacta√ß√£o</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IIS</a> <br><br><pre> <code class="plaintext hljs">Start-Process .\iiscompression_amd64.msi -ArgumentList /quiet</code> </pre> <br>  J√° compartilhamos as configura√ß√µes, portanto, voc√™ precisa configurar algo em apenas um lugar.  Usando o Gerenciador do IIS, vamos ao editor de configura√ß√£o no servidor principal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/489/874/4db/4898744dbe1eea52b6bfe3c92ea5a1ad.png"><br><br><pre> <code class="plaintext hljs">system.webServer/httpCompression</code> </pre> <br>  E defina StaticCompressionLevel como 11 para Brotli e 9 para Gzip, este √© o m√°ximo que eles podem fazer. <br><br>  <b>1.2.4 MIME e cabe√ßalhos</b> <br><br>  Fora da caixa, o IIS n√£o transmite o cabe√ßalho de codifica√ß√£o, e √© por isso que o alfabeto cir√≠lico se transforma em runas.  Tamb√©m no MIME, n√£o h√° nenhuma entrada no formato webp que precise ser adicionada. <br><br>  <b>1.</b> V√° para o expedidor ‚Üí MIME.  Encontre .HTML e modifique seu tipo para: text / html;  charset = utf-8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4c/bef/017/e4cbef017ae044d8720535ff9bdea63a.png"><br><br>  <b>2.</b> N√£o se esque√ßa do Webp - voc√™ precisa adicionar este MIME manualmente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07a/b62/aec/07ab62aecf03ee9b4a32ecd4044d7a42.png"><br><br><h2>  <font color="#3AC1EF">2. Emitimos um certificado</font> </h2><br>  Usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Winacme</a> .  Primeiro, voc√™ precisa vincular os dom√≠nios ao site - isso pode ser feito atrav√©s do Gerenciador do IIS.  Ao criar uma CDN, n√£o selecione a verifica√ß√£o do host, pois  Os problemas come√ßam imediatamente com a confirma√ß√£o da propriedade do dom√≠nio. Nossa escolha √© a verifica√ß√£o por registro TXT.  Voc√™ precisar√° direcionar manualmente o caminho para a pasta com os certificados, al√©m de copiar manualmente o registro do desafio.  Agora, coloque ar no seu peito. <br><br>  Para n√£o imprimir tudo manualmente, ative o RDP no Server Core com o seguinte comando: <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 0</code> </pre> <br>  √â assim que o RDP se parece no Server Core: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/856/2ea/478/8562ea478872a08964c125a8b997eae6.png"><br><br>  Ap√≥s o desafio, os certificados caem na pasta especificada no Winacme.  Winacme coloca a tarefa no agendador para renovar o certificado.  Instalado e esqueci. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/8e3/d33/f208e3d33f61e407a19e1ff53e14ecde.png"><br><br>  Bem, quando terminamos, podemos desativar o RDP - instalamos o Server Core por um bom motivo, descobrimos muitas nuances. <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 1</code> </pre> <br><h2>  <font color="#3AC1EF">3. Certificado Bindim para N√≥s</font> </h2><br>  Agora voc√™ precisa configurar dois outros n√≥s para que o HTTPS finalmente funcione.  No momento, no servidor em que os certificados est√£o armazenados, o HTTPS j√° est√° em execu√ß√£o.  Para que o restante comece a trabalhar em HTTPS, bem, em geral, isso √© feito atrav√©s do netsh. <br><br>  Como estamos acostumados, nos conectamos ao Windows Server Core via RDP para executar esse snap-in.  N√£o consulte o site da Microsoft, especialmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste</a> guia.  As etapas nele est√£o descritas incorretamente. <br><br>  Usando netsh http show sslcert, no n√≥ principal voc√™ precisa obter o appid, que inserimos como descrito abaixo: <br><br><pre> <code class="plaintext hljs">netsh http add sslcert ccs=443 appid= '{4dc3e181-e14b-4a21-b022-59fc669b0914}'</code> </pre> <br>  O valor do appid deve estar entre aspas, caso contr√°rio, n√£o funcionar√°. <br><br><h2>  <font color="#3AC1EF">4. Instale o DFS</font> </h2><br>  N√£o sincronize certificados e configura√ß√µes por meio do DFS; as ferramentas especializadas foram inventadas por um motivo.  Tentei e, por algum motivo pouco claro, as configura√ß√µes nos servidores que fizeram a configura√ß√£o pararam de ler as altera√ß√µes, embora pela primeira vez tudo funcionasse.  N√£o descobri a causa do fracasso e decidi faz√™-lo de maneira diferente. <br><br>  A configura√ß√£o adicional √© feita exclusivamente por meio do RSAT, os cmdlets especificados na documenta√ß√£o funcionam apenas no Windows Server com uma GUI.  A implanta√ß√£o da replica√ß√£o DFS usando o Server Core exclusivamente n√£o √© poss√≠vel.  Voc√™ precisa de outro servidor com uma GUI ou de um computador executando o Windows 10 Pro com o RSAT instalado, associado ao dom√≠nio. <br><br>  <b>2.1</b>  <b>Instale</b> <br><br>  Em cada servidor, voc√™ precisa instalar a Replica√ß√£o DFS: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebf/999/b17/ebf999b179089dd87a346406bfe6a09d.png"><br><br><pre> <code class="plaintext hljs">Install-WindowsFeature FS-DFS-Replication, FS-DFS-Namespace</code> </pre> <br>  <b>2.2</b>  <b>Criando um novo grupo de replica√ß√£o</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53b/3e2/9d6/53b3e29d6aee1c0e9f9a6b4e8f5ea06e.png"><br><br>  Primeiro voc√™ precisa ligar para o nosso grupo de replica√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14d/7ce/a23/14d7cea23a3bd08b1aec745ed40c0fb3.png"><br><br>  Escolha a topologia ao seu gosto.  Pessoalmente, ser√° mais conveniente adicionar conte√∫do a um local, por isso escolho uma estrela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fb/a17/e99/2fba17e99d83b3bec4940c5517c2a690.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a2/6e4/508/7a26e4508dfe041bc25c5cf008120ec2.png"><br><br>  Um dos servidores deve ser o principal, √© a partir dele que a replica√ß√£o come√ßa.  Se voc√™ enviar arquivos para ouvintes, o arquivo enviado n√£o ser√° replicado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d36/298/12a/d3629812afb96964a66db8a1c7682513.png"><br><br>  Como pasta para replica√ß√£o, escolhi a pasta padr√£o com sites: <br><br><pre> <code class="plaintext hljs">C:\inetpub\wwwroot</code> </pre> <br>  Esta pasta √© o caminho para o diret√≥rio deste primeiro servidor espec√≠fico.  Voc√™ pode replicar o conte√∫do desta pasta em qualquer lugar, independentemente do caminho. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d10/e94/f5e/d10e94f5e3e48d88ddcc3a5cb97ff5a4.png"><br><br>  Dentro de um grupo, podemos replicar v√°rias pastas e, no futuro, podemos expandir sua lista, se necess√°rio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ccc/ae9/649/cccae9649e5b0145fb38a6cd59d73490.png"><br><br>  Terminado. <br><br><h2>  <font color="#3AC1EF">5. Teste de desempenho</font> </h2><br>  Para entender quanto os visitantes do site realmente ganharam, √© necess√°rio fazer medi√ß√µes.  Eles ser√£o realizados a partir de dois pontos.  PC do autor em Moscou e servidor virtual em Frankfurt.  Todos os tr√™s pontos ser√£o testados separadamente.  Aqui est√° um resumo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d26/12c/04a/d2612c04abedc5d8eb796cbeeaaf31f7.png"><br><br>  Entramos no Devtools e observamos a cachoeira.  Em m√©dia, em um hospital, uma CDN reduzir√° cerca de 200 milissegundos antes que um site seja totalmente carregado.  A imagem, o maior objeto da p√°gina, √© carregada assim que entra na janela de visualiza√ß√£o; portanto, preste aten√ß√£o na linha vertical azul.  A CDN acelerou os estilos e scripts HTML + puros em 10 a 15 milissegundos e a imagem carregou 220 milissegundos mais rapidamente, essa √© uma diferen√ßa muito significativa. <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12b/5e5/8a9/12b5e58a9665f6901f073c0eba3f2678.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/03e/435/b93/03e435b93de7b098fbd98afdacc0c8f4.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1f2/474/cfb/1f2474cfba94d72d5482cb9a0ba0c679.png"></div></div><br>  Tamb√©m medi a velocidade de Jekyll em um host local: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/514/976/285/514976285849bbf746909644173302ba.png"><br><br>  Nos voltamos para o farol e vemos resultados estranhos: <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f2b/516/abb/f2b516abbaeb5ea7ec29c39585719d38.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9d8/38c/9ab9d838cd9c67792381c0741ef81a27.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12e/500/00b/12e50000b52c228beb3f08367fbbf00d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/3eb/449/599/3eb449599c0eee7698301470b48ea67b.png"></div></div><br>  Nesse sint√©tico, um servidor em terras distantes ignora o host local.  Mas porque? <br>  Por divers√£o, vamos nos livrar do Google Fonts e transferi-los para nossos servidores. <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/457/082/7cb/4570827cb685795120f645da992ebcf8.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f90/fbd/2ad/f90fbd2ad39d80e6b246faf348fee577.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Moscovo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d45/2f0/530/d452f0530f2d1d914aba53649cff763d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/6a1/f27/bc26a1f275f6d3626de02d96b436c186.png"></div></div><br>  Resultados entre data centers alinhados.  Mas ainda n√£o explica nada.  Eu refiz os testes v√°rias vezes, os resultados s√£o absolutamente de ferro e reproduz√≠veis a qualquer momento. <br><br>  Agora vamos usar um VPS com dois n√∫cleos e 4 gigabytes de RAM localizado em Frankfurt e ver o que diz.  Cachoeiras: <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/d40/dd7/025d40dd7962e7e312a6978cff91cabd.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/961/e9f/acf/961e9facf3d0a4654654f3541c7093a6.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/81e/399/d5a81e399de00ca9f3a451d09379f6cd.png"></div></div><br>  Aqui, com o ponto certo, a economia de tempo apenas em estilos e HTML chegou a 200 milissegundos.  Ou seja, no caso de um cliente de Frankfurt, o site simplesmente ser√° mais r√°pido em 200 milissegundos.  Isso tamb√©m se reflete na casa da luz.  Nesses casos, a CDN acelerar√° n√£o apenas a loja online, mas tamb√©m um blog f√°cil. <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e4d/e88/785/e4de88785e56ed3102cef5ade05f8462.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/042/b1c/071/042b1c0716f7e44b2f2dfc0b3955a68f.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/db1/ae1/de5/db1ae1de5ebfd5be8c3af5e6822a4376.png"></div></div><br>  Agora ative o Google Fonts e olhe novamente para o farol. <br><br><div class="spoiler">  <b class="spoiler_title">Moscovo - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/87d/ae6/281/87dae6281e2510fa35ee4aecd45079f0.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/ec2/d7d/025ec2d7d6982b39261551f927167ad2.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurique - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/802/f0c/073/802f0c073e6fa0f445dda60d7823da00.png"></div></div><br>  Infelizmente, n√£o tenho mais pontos para realizar testes, ent√£o vou terminar. <br><br><h2>  <font color="#3AC1EF">Conclus√µes</font> </h2><br><ul><li>  √â necess√°rio um CDN para gerar todas as estat√≠sticas, especialmente quando se trata de imagens pesadas ou scripts longos. </li><li>  O uso do Google Fonts √© poss√≠vel e necess√°rio. Em cen√°rios pesados, ele realmente acelera o site. </li><li>  O servidor principal, se voc√™ decidir fazer tudo isso no Windows, √© aconselh√°vel ter uma GUI. </li><li>  Os usu√°rios que far√£o as configura√ß√µes do servidor principal s√£o melhor localizados - no caso de uma falha no controlador de dom√≠nio, os n√≥s podem perder a conex√£o com as configura√ß√µes e os certificados e o Pool de Aplicativos ser√° interrompido porque  n√£o ser√° capaz de ler uma configura√ß√£o. </li></ul><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466447/">https://habr.com/ru/post/pt466447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466437/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 43. Protocolos de Roteamento Dist√¢ncia do Vetor e Estado do Link</a></li>
<li><a href="../pt466439/index.html">Verifique voc√™ mesmo: quantas perguntas voc√™ pode responder √† ChGK?</a></li>
<li><a href="../pt466441/index.html">C√≥digo de bugs Python: 10 erros mais comuns que os desenvolvedores cometem</a></li>
<li><a href="../pt466443/index.html">ShIoTiny e o mundo: sensores anal√≥gicos ou ADCs para os menores</a></li>
<li><a href="../pt466445/index.html">Ataques entre rela√ß√µes de confian√ßa entre dom√≠nios</a></li>
<li><a href="../pt466449/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 44. Introdu√ß√£o ao OSPF</a></li>
<li><a href="../pt466451/index.html">Read_You'n n√£o pode jogar</a></li>
<li><a href="../pt466453/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 45. Configurando o OSPF</a></li>
<li><a href="../pt466455/index.html">Servi√ßos, microsservi√ßos e programa√ß√£o orientada a lotes</a></li>
<li><a href="../pt466457/index.html">Agricultura e pain√©is solares - estrat√©gia ganha-ganha para engenheiros e agricultores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>