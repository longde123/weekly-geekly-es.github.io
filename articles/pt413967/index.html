<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë®üèæ üñêÔ∏è üè£ Engenharia Reversa no Modo Desenvolvedor Animal Crossing üöô üéÖüèª üìä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No ver√£o passado, comecei a engenharia reversa Animal Crossing para o GameCube. Eu queria explorar a possibilidade de criar mods para este jogo. Al√©m ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Engenharia Reversa no Modo Desenvolvedor Animal Crossing</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413967/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Usando o c√≥digo em um GameCube real"></div><br>  No ver√£o passado, comecei a engenharia reversa Animal Crossing para o GameCube.  Eu queria explorar a possibilidade de criar mods para este jogo.  Al√©m disso, queria documentar o processo para criar tutoriais para pessoas interessadas em invadir ROMs e engenharia reversa.  Neste post, falarei sobre os recursos de depura√ß√£o para desenvolvedores que permaneceram no jogo e tamb√©m compartilharei como descobri combos de truques que podem ser usados ‚Äã‚Äãpara desbloque√°-los. <br><a name="habracut"></a><br><h3>  new_Debug_mode </h3><br>  Estudando os s√≠mbolos de depura√ß√£o restantes, notei os nomes das fun√ß√µes e vari√°veis ‚Äã‚Äãque cont√™m a palavra "debug" e decidi que seria interessante ver se alguma funcionalidade de depura√ß√£o permanecia no jogo.  Se eu conseguir ativar as fun√ß√µes de depura√ß√£o ou desenvolvimento, isso me ajudar√° no processo de cria√ß√£o de mods. <br><br>  A primeira fun√ß√£o que notei foi <code>new_Debug_mode</code> .  √â chamado pela fun√ß√£o de <code>entry</code> , que inicia imediatamente ap√≥s a tela do logotipo da Nintendo terminar.  Tudo o que ela faz √© colocar a estrutura de byte <code>0x1C94</code> e salvar um ponteiro nela. <br><br>  Depois de ser chamado na <code>entry</code> na estrutura hospedada no deslocamento <code>0xD4</code> imediatamente antes de chamar o <code>mainproc</code> valor 0 √© definido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63e/fbc/0af/63efbc0af9ebfb4eeb2c3b42feddcbed.png"></div><br>  Para ver o que acontece quando o valor n√£o √© zero, <code>80407C8C</code> a instru√ß√£o <code>li r0, 0</code> em <code>80407C8C</code> , substituindo-a por <code>li r0, 1</code> .  Os bytes brutos da instru√ß√£o <code>li r0, 0</code> s√£o <code>38 00 00 00</code> onde o valor atribu√≠do est√° no final da instru√ß√£o, ent√£o eu poderia substituir os bytes por <code>38 00 00 01</code> e obter <code>li r0, 1</code> .  Como uma maneira mais confi√°vel de criar instru√ß√µes, voc√™ pode usar algo como o <code>kstool</code> : <br><br> <code>$ kstool ppc32be "li 0, 1" <br> li 0, 1 = [ 38 00 00 01 ]</code> <br> <br>  No emulador Dolphin, esse patch pode ser aplicado acessando a guia "Patches" nas propriedades do jogo e inserindo-o da seguinte maneira: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e65/ecb/706/e65ecb7061c9470c9a9b71c4aad8e506.png"></div><br>  Depois de atribuir o valor 1, um gr√°fico interessante apareceu na parte inferior da tela: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be5/cab/e1f/be5cabe1fe1df63d0534c092d49ca8f9.png"></div><br><br>  Parecia um indicador de desempenho: as pequenas barras na parte inferior da tela aumentavam ou diminu√≠am.  (Mais tarde, quando examinei os nomes das fun√ß√µes que desenham esse gr√°fico, descobri que elas realmente exibem m√©tricas de uso de CPU e mem√≥ria.) <br><br>  Foi √≥timo, mas n√£o particularmente √∫til.  Depois de atribuir o valor 1, minha cidade parou de carregar, para que nada mais pudesse ser feito aqui. <br><br><h3>  Modo Zuru </h3><br>  Novamente, comecei a procurar outras refer√™ncias a fun√ß√µes de depura√ß√£o e v√°rias vezes me deparei com algo chamado "modo zuru".  As ramifica√ß√µes dos blocos de c√≥digo com funcionalidade de depura√ß√£o costumavam verificar a vari√°vel <code>zurumode_flag</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/4d4/63c/88e4d463c3ea3474d3b67e2cf8367ee2.png" alt="fun√ß√£o game_move_first"></div><br>  <code>zzz_LotsOfDebug</code> (o nome que eu mesmo <code>game_move_first</code> ) na fun√ß√£o <code>game_move_first</code> mostrada acima √© chamado apenas quando <code>zurumode_flag</code> n√£o <code>zurumode_flag</code> igual a zero. <br><br>  Procurando fun√ß√µes associadas a esse valor, encontrei estas: <br><br><ul><li> <code>zurumode_init</code> </li> <li> <code>zurumode_callback</code> </li> <li> <code>zurumode_update</code> </li> <li> <code>zurumode_cleanup</code> </li> </ul><br>  √Ä primeira vista, seu objetivo √© misterioso, eles manipulam bits nos desvios de uma vari√°vel chamada <code>osAppNMIBuffer</code> . <br><br>  Aqui est√° como o trabalho dessas fun√ß√µes olhou √† primeira vista: <br><br><h4>  zurumode_init </h4><br><ul><li>  Define <code>zurumode_flag</code> como 0 </li><li>  Verifica v√°rios bits no <code>osAppNMIBuffer</code> </li><li>  Salva um ponteiro para a fun√ß√£o <code>zurumode_callback</code> na estrutura <code>padmgr</code> </li><li>  Chamadas <code>zurumode_update</code> </li></ul><br><h4>  zurumode_update </h4><br><ul><li>  Verifica v√°rios bits no <code>osAppNMIBuffer</code> </li><li>  Dependendo do valor desses bits, o <code>zurumode_flag</code> atualiza </li><li>  Imprime uma string de formato no console do SO. </li></ul><br>  Isso geralmente √© √∫til para contextualizar o c√≥digo, mas havia muitos caracteres n√£o imprim√≠veis na linha.  O √∫nico texto reconhec√≠vel foi "zurumode_flag" e "% d". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/268/f99/093/268f99093e0f9dec2a19bfc22be95ac7.png" alt="sequ√™ncia de formato do modo zuru"></div><br>  Supondo que poderia ser texto em japon√™s com codifica√ß√£o de caracteres multibyte, passei a string pela ferramenta de reconhecimento de codifica√ß√£o e descobri que a string foi codificada com Shift-JIS.  Na tradu√ß√£o, a linha simplesmente significava "O valor de zurumode_flag mudou de% d para% d".  Isso n√£o nos fornece muitas informa√ß√µes novas, mas agora sabemos que o Shift-JIS √© usado: em arquivos bin√°rios e tabelas de linhas, h√° muito mais linhas nessa codifica√ß√£o. <br><br><h4>  zurumode_callback </h4><br><ul><li>  Chamadas <code>zerumode_check_keycheck</code> </li><li>  Verifica v√°rios bits no <code>osAppNMIBuffer</code> </li><li>  O valor <code>zurumode_flag</code> est√° sendo <code>zurumode_flag</code> </li><li>  Chamadas <code>zurumode_update</code> </li></ul><br>  <code>zerumode_check_keycheck</code> at√© nos conhecermos por causa de uma ortografia diferente ... o que √©? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  Uma fun√ß√£o enorme e complexa que trabalha muito mais em bits com valores sem nome. <br><br>  Nesse ponto, decidi dar um passo atr√°s e estudar outras fun√ß√µes e vari√°veis ‚Äã‚Äãde depura√ß√£o, porque n√£o tinha certeza da import√¢ncia do modo zuru.  Al√©m disso, n√£o entendi o que ‚Äúverifica√ß√£o de chave‚Äù significa aqui.  √â poss√≠vel que essa seja uma chave criptogr√°fica? <br><br><h3>  Voltar √† depura√ß√£o </h3><br>  Nessa √©poca, notei um problema com minha maneira de carregar s√≠mbolos de depura√ß√£o na IDA.  O arquivo <code>foresta.map</code> no disco do jogo cont√©m muitos endere√ßos e nomes de fun√ß√µes e vari√°veis.  No come√ßo, n√£o vi que os endere√ßos de cada se√ß√£o recome√ßam do zero, ent√£o escrevi um script simples que adiciona uma entrada de nome para cada linha do arquivo. <br><br>  Escrevi novos scripts da IDA para corrigir o carregamento de tabelas de s√≠mbolos para diferentes se√ß√µes do programa: <code>.text</code> , <code>.rodata</code> , <code>.data</code> e <code>.bss</code> .  A se√ß√£o <code>.text</code> cont√©m todas as fun√ß√µes, ent√£o eu fiz isso para que, desta vez, quando eu definir o nome, o script reconheceria automaticamente as fun√ß√µes em cada endere√ßo. <br><br>  Nas se√ß√µes de dados, ele agora criou um segmento para cada objeto bin√°rio (por exemplo, <code>m_debug.o</code> , que deveria ser o c√≥digo compilado para algo chamado <code>m_debug</code> ) e definiu o espa√ßo e os nomes de cada parte dos dados. <br><br>  Isso me deu muito mais informa√ß√µes, mas tive que definir manualmente o tipo de dados para cada parte dos dados, porque defini cada objeto de dados como uma matriz de bytes simples.  (Olhando para tr√°s, entendo que seria melhor supor que fragmentos de 4 bytes continha n√∫meros inteiros de 32 bits, porque havia muitos e muitos endere√ßos contidos de fun√ß√µes e dados importantes para a cria√ß√£o de refer√™ncias cruzadas.) <br><br>  Estudando o novo segmento <code>.bss</code> para <code>m_debug_mode.o</code> , encontrei v√°rias vari√°veis ‚Äã‚Äãno formato <code>quest_draw_status</code> e <code>event_status</code> .  Isso √© interessante porque eu queria que informa√ß√µes √∫teis, n√£o apenas um gr√°fico de desempenho, fossem exibidas no modo de depura√ß√£o.  Felizmente, nesses registros de dados, havia refer√™ncias cruzadas para um grande peda√ßo de c√≥digo verificando <code>debug_print_flg</code> . <br><br>  Usando um depurador no emulador Dolphin, defino um ponto de interrup√ß√£o no local da fun√ß√£o em que <code>debug_print_flg</code> verificado (no <code>8039816C</code> ) para entender como essa verifica√ß√£o funciona.  Mas o programa nunca passou para esse ponto de interrup√ß√£o. <br><br>  Vamos <code>game_debug_draw_last</code> por que isso acontece: essa fun√ß√£o √© chamada por <code>game_debug_draw_last</code> .  Adivinha qual valor √© verificado antes de sua chamada condicional?  <code>zurumode_flag</code> !  Que diabos est√° acontecendo? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/257/048/964/257048964f9e8265670952e66868fc83.png" alt="verifica√ß√£o zurumode_flag"></div><br>  Defina um ponto de interrup√ß√£o nessa verifica√ß√£o ( <code>80404E18</code> ) e funcionou imediatamente.  O valor de <code>zurumode_flag</code> era zero, portanto, na execu√ß√£o normal, o programa teria perdido a chamada para esta fun√ß√£o.  Em vez disso, inseri uma instru√ß√£o de ramifica√ß√£o NOP (substitu√≠-a por uma instru√ß√£o que n√£o faz nada) para verificar o que acontece quando a fun√ß√£o √© chamada. <br><br>  No depurador Dolphin, isso pode ser feito pausando o jogo, clicando com o bot√£o direito do mouse nas instru√ß√µes e selecionando ‚ÄúInsert nop‚Äù: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e6/f00/8d1/2e6f008d1dcf1be707b1961e05df2e71.png" alt="Depura√ß√£o do depurador Dolphin"></div><br>  Nada aconteceu.  Depois, verifiquei o que estava acontecendo dentro da fun√ß√£o e descobri outra constru√ß√£o ramificada que contornava tudo de interessante que acontecia em <code>803981a8</code> .  Tamb√©m inseri o NOP e a letra ‚ÄúD‚Äù apareceu no canto superior direito da tela. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a18/9a0/816/a189a0816b08438ad5b85c09adaac57c.png" alt="Letra do modo de depura√ß√£o D"></div><br>  Nesta fun√ß√£o no <code>8039816C</code> (eu chamei de <code>zzz_DebugDrawPrint</code> ), ainda h√° um monte de c√≥digo interessante, mas n√£o √© chamado.  Se voc√™ olhar para esta fun√ß√£o na forma de um gr√°fico, poder√° ver que h√° uma s√©rie de operadores de ramifica√ß√£o que ignoram os blocos de c√≥digo em toda a fun√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/236/131/4bb/2361314bbb4165b8e1c82386e8c50533.png" alt="Ramifica√ß√µes em zzz_DebugDrawPrint"></div><br>  Depois de inserir o NOP em vez de v√°rias outras constru√ß√µes ramificadas, comecei a ver v√°rias coisas interessantes na tela: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/c19/008/0dbc1900844131d0c3d7f507f2b61b63.png" alt="Mais material de depura√ß√£o sendo impresso"></div><br>  A pr√≥xima pergunta era como ativar essa funcionalidade de depura√ß√£o sem alterar o c√≥digo. <br><br>  Al√©m disso, em algumas constru√ß√µes de ramifica√ß√£o, <code>zurumode_flag</code> ocorre novamente nessa fun√ß√£o de desenho de depura√ß√£o.  <code>zurumode_update</code> outro patch para que em <code>zurumode_update</code> sinalizador <code>zurumode_update</code> sempre <code>zurumode_flag</code> atribu√≠do ao valor 2, porque quando n√£o se compara com 0, √© comparado especificamente com o valor 2. <br><br>  Depois de reiniciar o jogo, vi no canto superior direito da tela uma mensagem "msg.  n√£o " <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/16e/a0b/97d16ea0b169c72dd86ab623e0e3f977.png" alt="exibi√ß√£o do n√∫mero da mensagem"></div><br>  O n√∫mero 687 √© o identificador de registro da mensagem exibida mais recentemente.  Eu o verifiquei usando o programa visualizador de tabelas que escrevi no in√≠cio da an√°lise, mas voc√™ tamb√©m pode verific√°-lo usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">editor de tabelas de strings com uma GUI completa</a> , que escrevi para invadir ROMs.  Aqui est√° a apar√™ncia da postagem no editor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cad/e3f/378/cade3f3785a86e9bf335a144fe16a338.png" alt="Mensagem 687 no editor de tabela de cadeias"></div><br>  Nesse ponto, ficou claro que o estudo do modo zuru n√£o era mais retirado - est√° diretamente relacionado √†s fun√ß√µes de depura√ß√£o do jogo. <br><br><h3>  Voltar ao modo Zuru novamente </h3><br>  <code>zurumode_init</code> inicializa v√°rias coisas: <br><br><ul><li>  <code>0xC(padmgr_class)</code> recebe o valor do endere√ßo <code>zurumode_callback</code> </li><li>  <code>0x10(padmgr_class)</code> recebe o valor do endere√ßo da pr√≥pria <code>padmgr_class</code> </li><li>  <code>0x4(zuruKeyCheck)</code> recebe o valor do √∫ltimo bit na palavra carregada de <code>0x3C(osAppNMIBuffer)</code> . </li></ul><br>  Eu descobri o que <code>padmgr</code> o <code>padmgr</code> , uma abrevia√ß√£o de "gamepad manager".  Isso significa que pode haver uma combina√ß√£o especial de teclas (bot√µes) que podem ser inseridas no gamepad para ativar o modo zuru, ou algum tipo de dispositivo de depura√ß√£o ou fun√ß√£o do console do desenvolvedor que pode ser usado para enviar um sinal para ativ√°-lo. <br><br>  <code>zurumode_init</code> √© executado apenas na primeira inicializa√ß√£o do jogo (quando o bot√£o de reset √© pressionado, ele n√£o funciona). <br><br>  Depois de definir um ponto de interrup√ß√£o no endere√ßo <code>8040efa4</code> , no qual o valor <code>0x4(zuruKeyCheck)</code> √© atribu√≠do <code>0x4(zuruKeyCheck)</code> , podemos ver que, ao carregar sem pressionar as teclas, o valor √© definido como 0. Se voc√™ substitu√≠-lo por 1, algo interessante acontece: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dc/5f5/0fb/9dc5f50fbd68beb624745d0704a18383.png" alt="Tela de t√≠tulo com o modo zuru"></div><br>  A letra ‚ÄúD‚Äù aparece novamente no canto superior direito (desta vez √© verde, n√£o amarelo), e algumas informa√ß√µes de montagem tamb√©m s√£o exibidas: <br><br> <code>[CopyDate: 02/08/01 00:16:48 ] <br> [Date: 02-07-31 12:52:00] <br> [Creator:SRD@SRD036J]</code> <br> <br>  Um patch que sempre define <code>0x4(zuruKeyCheck)</code> como 1 no in√≠cio √© assim: <br><br> <code>8040ef9c 38c00001</code> <br> <br>  Esta parece ser a maneira correta de inicializar o modo zuru.  Ap√≥s isso, v√°rias a√ß√µes podem ser necess√°rias para obter a exibi√ß√£o de certas informa√ß√µes de depura√ß√£o.  Iniciando o jogo, dando uma volta nele e conversando com um morador, n√£o veremos nenhuma das mensagens mencionadas acima (exceto a letra "D" no canto). <br><br>  Os suspeitos mais prov√°veis ‚Äã‚Äãs√£o <code>zurumode_update</code> e <code>zurumode_callback</code> . <br><br><h4>  zurumode_update </h4><br>  <code>zurumode_update</code> chamado primeiro em <code>zurumode_init</code> e depois constantemente chamado por <code>zurumode_callback</code> . <br><br>  Ele verifica novamente o √∫ltimo bit <code>0x3C(osAppNMIBuffer)</code> e, com base nesse valor, atualiza <code>zurumode_flag</code> . <br><br>  Se o bit for zero, o sinalizador ser√° definido como zero. <br><br>  Caso contr√°rio, a seguinte instru√ß√£o √© executada, com o valor completo <code>0x3c(osAppNMIBuffer)</code> sendo <code>r5</code> : <br><br> <code>extrwi r3, r5, 1, 28</code> <br> <br>  Extrai o 28¬∫ bit de <code>r5</code> e o armazena em <code>r3</code> . <br><br>  Em seguida, 1 √© adicionado ao resultado, ou seja, o resultado final √© sempre 1 ou 2. <br><br>  Em seguida, <code>zurumode_flag</code> comparado com o resultado anterior, dependendo de quantos dos 28¬∫ e √∫ltimos bits est√£o configurados para <code>0x3c(osAppNMIBuffer)</code> : 0, 1 ou 2. <br><br>  Este valor √© gravado em <code>zurumode_flag</code> .  Se n√£o mudar nada, a fun√ß√£o sai e retorna o valor atual do sinalizador.  Se ele mudar o valor, ser√° executada uma cadeia muito mais complexa de blocos de c√≥digo. <br><br>  Uma mensagem √© exibida em japon√™s: o mesmo "valor zurumode_flag alterado de% d para% d", sobre o qual falamos acima. <br><br>  Em seguida, uma s√©rie de fun√ß√µes √© chamada com argumentos diferentes, dependendo se o sinalizador se tornou igual a zero ou n√£o.  O c√≥digo assembler desta parte √© mon√≥tono, ent√£o mostrarei seu pseudoc√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag_changed_to_zero) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">2</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">25</span></span>) || BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">31</span></span>)) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">3</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br>  Observe que, se o sinalizador for zero, o argumento 0 ser√° passado para JC_JUTDbPrint_setVisible. <br><br>  Se o sinalizador n√£o for igual a <code>0x3C(osAppNMIBuffer)</code> E o bit 25 ou 31 s√£o definidos como <code>0x3C(osAppNMIBuffer)</code> , ent√£o <code>setVisible</code> passado o argumento 1. <br><br>  Esta √© a primeira chave para ativar o modo zuru: o √∫ltimo bit <code>0x3C(osAppNMIBuffer)</code> deve ser definido como 1 para exibir informa√ß√µes de depura√ß√£o e definir <code>zurumode_flag</code> valor diferente de zero. <br><br><h4>  zurumode_callback </h4><br>  <code>zurumode_callback</code> est√° localizado em <code>8040ee74</code> e provavelmente √© chamado por uma fun√ß√£o relacionada ao gamepad.  Ap√≥s inserir um ponto de interrup√ß√£o no depurador Dolphin, a pilha de chamadas nos mostra que na verdade est√° sendo chamada de <code>padmgr_HandleRetraceMsg</code> . <br><br>  Uma de suas primeiras a√ß√µes foi executar <code>zerucheck_key_check</code> .  Essa fun√ß√£o √© complexa, mas parece que em geral foi projetada para ler e atualizar o valor de <code>zuruKeyCheck</code> .  Antes de passar para a fun√ß√£o de verifica√ß√£o de tecla, decidi verificar como esse valor √© usado no restante da fun√ß√£o de retorno de chamada. <br><br>  Em seguida, ele novamente verifica alguns bits em <code>0x3c(osAppNMIBuffer)</code> .  Se o bit 26 estiver definido ou se o bit 25 estiver definido e <code>padmgr_isConnectedController(1)</code> retornar um valor diferente de zero, o √∫ltimo bit em <code>0x3c(osAppNMIBuffer)</code> como 1! <br><br>  Se nenhum desses bits estiver definido ou o bit 25 estiver definido, mas <code>padmgr_isConnectedController(1)</code> retornar 0, a fun√ß√£o verificar√° se o byte no endere√ßo <code>0x4(zuruKeyCheck)</code> √© igual a zero.  Se igual, ele redefine o √∫ltimo bit no valor original e o grava de volta em <code>0x3c(osAppNMIBuffer)</code> .  Caso contr√°rio, ele ainda define o √∫ltimo bit como 1. <br><br>  No pseudo-c√≥digo, fica assim: <br><br><pre> <code class="cpp hljs">x = osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(x, <span class="hljs-number"><span class="hljs-number">26</span></span>) || (BIT(x, <span class="hljs-number"><span class="hljs-number">25</span></span>) &amp;&amp; isConnectedController(<span class="hljs-number"><span class="hljs-number">1</span></span>)) || zuruKeyCheck[<span class="hljs-number"><span class="hljs-number">4</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] = x | <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// set last bit } else { osAppNMIBuffer[0x3c] = x &amp; ~1 // clear last bit }</span></span></code> </pre> <br>  Depois disso, se o bit 26 n√£o estiver definido, a fun√ß√£o continuar√° chamando <code>zurumode_update</code> e ser√° encerrada. <br><br>  Se o bit estiver definido, se <code>0x4(zuruKeyCheck)</code> n√£o <code>0x4(zuruKeyCheck)</code> igual a zero, ele carregar√° uma string de formato na qual exibir√° o seguinte: ‚ÄúZURU% d /% d‚Äù. <br><br><h4>  Para resumir o subtotal </h4><br>  Aqui est√° o que acontece: <br><br>  <code>padmgr_HandleRetraceMsg</code> chama <code>zurumode_callback</code> .  Eu suponho que essa "mensagem de retra√ß√£o de identificador" significa que simplesmente verifica as teclas digitadas no controlador.  Com cada varredura, isso pode causar uma s√©rie de retornos de chamada diferentes. <br><br>  Quando <code>zurumode_callback</code> executado <code>zurumode_callback</code> ele verifica os pressionamentos de tecla atuais (bot√µes).  Parece que ela est√° verificando um bot√£o espec√≠fico ou uma combina√ß√£o de bot√µes. <br><br>  O √∫ltimo bit no NMI Buffer √© atualizado dependendo dos bits espec√≠ficos em seu valor atual, bem como do valor de um dos bytes <code>zuruKeyCheck</code> ( <code>0x4(zuruKeyCheck)</code> ). <br><br>  Ent√£o <code>zurumode_update</code> √© <code>zurumode_update</code> e verifica esse bit.  Se for 0, o sinalizador do modo zuru ser√° definido como 0. Se for 1, o sinalizador de modo mudar√° para 1 ou 2, dependendo se o bit 28 estiver definido. <br><br>  <strong>Existem tr√™s maneiras de ativar o modo zuru:</strong> <br><br><ol><li>  O bit 26 est√° definido como <code>0x3C(osAppNMIBuffer)</code> </li><li>  O bit 25 est√° definido como <code>0x3C(osAppNMIBuffer)</code> e o controlador est√° conectado √† porta 2 </li><li>  <code>0x4(zuruKeyCheck)</code> n√£o <code>0x4(zuruKeyCheck)</code> zero </li></ol><br><h4>  osAppNMIBuffer </h4><br>  Interessado no que significa <code>osAppNMIBuffer</code> , comecei a procurar por "NMI" e encontrei links no contexto da Nintendo como "interrup√ß√£o n√£o mascar√°vel".  Acontece que o nome dessa vari√°vel √© totalmente mencionado na documenta√ß√£o do desenvolvedor do Nintendo 64: <br><br><blockquote>  o osAppNMIBuffer √© um buffer de 64 bytes que √© limpo ap√≥s uma reinicializa√ß√£o a frio.  Se o sistema reiniciar devido √† NMI, o estado desse buffer n√£o ser√° alterado. </blockquote><br>  De fato, esse √© um pequeno peda√ßo de mem√≥ria salva durante uma reinicializa√ß√£o "suave" (com o bot√£o de reinicializa√ß√£o).  O jogo pode usar esse buffer para armazenar quaisquer dados enquanto o console estiver na rede.  O Animal Crossing original foi lan√ßado no Nintendo 64, por isso √© l√≥gico que algo semelhante deveria aparecer no c√≥digo. <br><br>  Se formos para o arquivo bin√°rio <code>boot.dol</code> (tudo mostrado acima estava em <code>foresta.rel</code> ), sua fun√ß√£o <code>main</code> possui muitos links para <code>osAppNMIBuffer</code> .  Uma r√°pida olhada mostra que h√° uma s√©rie de verifica√ß√µes que podem levar √† <code>0x3c(osAppNMIBuffer)</code> valores de diferentes bits <code>0x3c(osAppNMIBuffer)</code> usando opera√ß√µes OR. <br><br>  Os seguintes valores do operando OR podem ser interessantes: <br><br><ul><li>  Bit 31: 0x01 </li><li>  Bit 30: 0x02 </li><li>  Bit 29: 0x04 </li><li>  Bit 28: 0x08 </li><li>  Bit 27: 0x10 </li><li>  Bit 26: 0x20 </li></ul><br>  Lembramos que os bits 25, 26 e 28 s√£o especialmente interessantes: 25 e 26 determinam se o modo zuru est√° ativado e o bit 28 determina o n√≠vel da flag (1 ou 2). <br>  O bit 31 tamb√©m √© interessante, mas parece que muda dependendo dos valores dos outros. <br><br><h5>  Bit 26 </h5><br>  Primeiro: no endere√ßo <code>800062e0</code> h√° uma instru√ß√£o <code>ori r0, r0, 0x20</code> com um valor de buffer de <code>0x3c</code> .  Ele define o bit 26, que sempre ativa o modo zuru. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/b3c/207/b5cb3c207a61dc20dd12e6724f25099b.png" alt="Bit de configura√ß√£o 26"></div><br>  Para que o bit seja definido, o oitavo byte retornado de <code>DVDGetCurrentDiskID</code> deve ser <code>0x99</code> .  Este identificador est√° localizado no in√≠cio da imagem de disco do jogo e √© carregado na mem√≥ria em <code>80000000</code> .  Em um lan√ßamento de varejo regular do jogo, o ID fica assim: <br><br> <code>47 41 46 45 30 31 00 00 GAFE01..</code> <br> <br>  Substituindo o √∫ltimo byte do identificador por um <code>0x99</code> para <code>0x99</code> , obtemos a seguinte imagem ao iniciar o jogo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da6/c58/c90/da6c58c90515fefb62ed8cf766ad8776.png" alt="ID da vers√£o do jogo 0x99"></div><br>  E o seguinte √© exibido no console do SO: <br><br> <code>06:43:404 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: ZURUMODE2 ENABLE <br> 08:00:288 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: osAppNMIBuffer[15]=0x00000078</code> <br> <br>  Todos os outros patches podem ser removidos, ap√≥s o que a letra D aparece novamente no canto superior direito da tela, mas n√£o h√° mais mensagens de depura√ß√£o ativadas. <br><br><h5>  Bit 25 </h5><br>  O bit 25 √© usado em conjunto com a verifica√ß√£o da porta do controlador 2. O que faz com que ele seja ligado? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddf/d00/4a1/ddfd004a1488ec21842c90581ef177fc.png" alt="Bit 25 e 28"></div><br>  Acontece que ele deve usar a mesma verifica√ß√£o do bit 28: a vers√£o deve ser maior ou igual a <code>0x90</code> .  Se o bit 26 estiver definido (o ID √© <code>0x99</code> ), os dois bits tamb√©m ser√£o definidos e o modo zuru ainda ser√° ativado. <br><br>  No entanto, se a vers√£o estiver no intervalo de <code>0x90</code> a <code>0x98</code> , o modo zuru n√£o ser√° ativado instantaneamente.  Lembre-se da verifica√ß√£o realizada em <code>zurumode_callback</code> - o modo ser√° ativado apenas se o bit 25 estiver definido <em>e</em> <code>padmgr_isConnectedController(1)</code> retornar um valor diferente de zero. <br><br>  Ap√≥s o controlador ser conectado √† porta 2 (o argumento <code>isConnectedController</code> possui zero indexa√ß√£o), o modo zuru √© ativado.  A letra D e as informa√ß√µes sobre a montagem aparecem na tela inicial, e n√≥s ... podemos controlar a exibi√ß√£o da depura√ß√£o usando os bot√µes do segundo controlador! <br><br>  Alguns bot√µes executam a√ß√µes que n√£o apenas alteram a exibi√ß√£o, mas tamb√©m, por exemplo, aumentam a velocidade do jogo. <br><br><h4>  zerucheck_key_check </h4><br>  O √∫ltimo mist√©rio permanece <code>0x4(zuruKeyCheck)</code> .  Acontece que esse valor √© atualizado com uma enorme fun√ß√£o complexa que mostrei acima: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  Usando o depurador do emulador Dolphin, consegui determinar que o valor verificado por esta fun√ß√£o √© um conjunto de bits correspondente ao pressionamento do bot√£o no segundo controlador. <br><br>  O rastreamento de cliques no bot√£o √© armazenado em um valor de 16 bits em <code>0x2(zuruKeyCheck)</code> .  Quando o controlador n√£o est√° conectado, o valor √© <code>0x7638</code> . <br><br>  2 bytes contendo sinalizadores das teclas pressionadas do controlador s√£o baixados e atualizados no in√≠cio de <code>zerucheck_key_check</code> .  O novo valor √© passado com o registro <code>r4</code> fun√ß√£o <code>padmgr_HandleRetraceMsg</code> quando chama a fun√ß√£o de retorno de chamada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f98/478/318/f984783181e592098f8beef9c22cef23.png" alt="fim de verifica√ß√£o de chave"></div><br>  Perto do final de <code>zerucheck_key_check</code> h√° outro local em que <code>0x4(zuruKeyCheck)</code> atualizado <code>0x4(zuruKeyCheck)</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele n√£o apareceu na lista de refer√™ncias cruzadas porque √© usado como o endere√ßo base </font></font><code>r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e podemos descobrir o valor </font></font><code>r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas olhando para qual valor √© atribu√≠do a ele antes de chamar esta fun√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No endere√ßo, o </font></font><code>8040ed88</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor √© </font></font><code>r4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravado em </font></font><code>0x4(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Logo antes disso, mas ele √© gravado no mesmo local e, em seguida, XORs a partir de 1. A tarefa desta opera√ß√£o √© alternar o valor do byte (e de fato o √∫ltimo bit) entre 0 e 1. (Se o valor for 0, o resultado de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XOR de 1 ser√° 1). Se o valor for 1, o resultado ser√° 0. Consulte a tabela verdade para XOR.)</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/048/c32/eb1/048c32eb12dda64c878fa7b9f0bd7ddc.png" alt="fim de verifica√ß√£o de chave"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, quando estudei os valores na mem√≥ria, n√£o percebi esse comportamento, mas tentarei quebrar essa instru√ß√£o no depurador para entender o que est√° acontecendo. O valor original √© carregado em </font></font><code>8040ed7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem tocar nos bot√µes do controlador, n√£o chegarei a esse ponto de interrup√ß√£o na tela inicial. Para entrar nesse bloco de c√≥digo, o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve se tornar igual </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes da instru√ß√£o de ramifica√ß√£o anterior ao ponto de interrup√ß√£o ( </font></font><code>8040ed74</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Dos muitos caminhos diferentes que levam a esse bloco, apenas um atribui um </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† sua frente no endere√ßo </font></font><code>8040ed68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04c/926/959/04c926959999b5f6facfc8920f6a212f.png" alt="Configurando r5 para 0xb"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que, para alcan√ßar o bloco que atribui o </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual </font><font style="vertical-align: inherit;">logo antes dele </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ap√≥s os blocos da cadeia at√© o in√≠cio da fun√ß√£o, podemos ver todas as restri√ß√µes necess√°rias para atingir esse bloco:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed74: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual</font></font><code>0xB</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed60: o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual</font></font><code>0x1000</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe8: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual</font></font><code>0xA</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe4: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser menor</font></font><code>0x5B</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eba4: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser maior</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb94: o valor </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser 1</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb5c: o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o deve ser 0</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040eb74: os valores do bot√£o da porta 2 devem mudar </font></font></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28e/2fa/9f3/28e2fa9f3d35b1c6146f816120dee72b.png" alt="Rastreando o caminho do c√≥digo"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui chegamos ao ponto em que os valores dos bot√µes antigos s√£o carregados e os novos valores s√£o salvos. Em seguida, v√™m algumas opera√ß√µes aplicadas aos valores novos e antigos: </font><font style="vertical-align: inherit;">A opera√ß√£o XOR marca todos os bits que foram alterados entre os dois valores. Em seguida, a opera√ß√£o AND mascara a nova entrada para definir todos os bits que n√£o est√£o configurados no momento para o estado 0. O resultado </font><font style="vertical-align: inherit;">√© um conjunto de novos bits (pressionar o bot√£o) no novo valor. Se n√£o estiver vazio, estamos no caminho certo. </font><font style="vertical-align: inherit;">Para fazer </font><font style="vertical-align: inherit;">a diferen√ßa </font><font style="vertical-align: inherit;">, o quarto dos bot√µes de rastreamento de 16 bits deve mudar. Depois de inserir um ponto de interrup√ß√£o ap√≥s a opera√ß√£o XOR / AND, descobri que o bot√£o START aciona esse estado. </font><font style="vertical-align: inherit;">A pr√≥xima pergunta √© como faz√™- </font><font style="vertical-align: inherit;">lo ser inicialmente igual</font></font><br><br> <code>old_vals = old_vals XOR new_vals <br> old_vals = old_vals AND new_vals</code> <br> <br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><code>0x1000</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r5</code><font style="vertical-align: inherit;"></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o carregados desde </font></font><code>0x0(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o in√≠cio da fun√ß√£o de teste principal e atualizados mais perto do fim, quando n√£o entramos no bloco de c√≥digo que o inclui </font></font><code>0x4(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem v√°rios lugares antes disso onde o </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor √© atribu√≠do </font></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ul><li> <code>8040ed50</code> </li> <li> <code>8040ed00</code> </li> <li> <code>8040ed38</code> </li> </ul><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed38 </font></font></h5><br><ul><li> <code>8040ed34</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual </font></font><code>0x4000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(o bot√£o B </font><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">pressionado)</font></font></li><li> <code>8040ebe0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser maior</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ent√£o tudo corre como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve come√ßar com </font></font><code>0x5b</code> <br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed00 </font></font></h5><br><ul><li> <code>8040ecfc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual </font></font><code>0xC000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(A e B s√£o pressionados)</font></font></li><li> <code>8040ebf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser&gt; = 9</font></font></li><li> <code>8040ebf0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser menor que 10</font></font></li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser menor</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser mais</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ent√£o tudo corre como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve come√ßar √†s 9 </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed50 </font></font></h5><br><ul><li> <code>8040ed4c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser igual </font></font><code>0x8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bot√£o A pressionado)</font></font></li><li> <code>8040ec04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser menor</font></font><code>0x5d</code> </li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser maior</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser maior</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ent√£o tudo corre como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve come√ßar com </font></font><code>0x5c</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que existe algum tipo de estado entre as teclas, ap√≥s o qual voc√™ precisa inserir uma certa sequ√™ncia de combos a partir dos bot√µes, terminando com a tecla START. </font><font style="vertical-align: inherit;">Parece que A e / ou B devem ir logo antes de INICIAR. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ rastrear o caminho do c√≥digo que define o </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor como 9, surge um padr√£o: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- √© um valor crescente que pode aumentar quando um </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor adequado √© encontrado ou zero. </font><font style="vertical-align: inherit;">Os casos mais estranhos, onde n√£o √© um valor na faixa de </font></font><code>0x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√©</font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ocorre ao processar etapas com v√°rios bot√µes, por exemplo, quando A e B. s√£o pressionados simultaneamente.Uma pessoa que tenta entrar nesse combo geralmente n√£o pode pressionar os dois bot√µes exatamente ao mesmo tempo enquanto acompanha o gamepad, portanto, √© necess√°rio processar o bot√£o pressionado primeiro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuamos a explorar diferentes caminhos de c√≥digo:</font></font><br><br><ul><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 9 quando RIGHT √© pressionado no endere√ßo </font></font><code>8040ece8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 8 quando o bot√£o direito C no endere√ßo √© pressionado </font></font><code>8040eccc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 7 quando o bot√£o esquerdo C √© pressionado no endere√ßo </font></font><code>8040ecb0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 6 quando ESQUERDA √© pressionado no endere√ßo </font></font><code>8040ec98</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 5 (e r6 assume o valor 1) quando DOWN √© pressionado no endere√ßo </font></font><code>8040ec7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 4 quando o bot√£o superior C no endere√ßo √© pressionado </font></font><code>8040ec64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 3 quando o bot√£o inferior C no endere√ßo √© pressionado </font></font><code>8040ec48</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 2 quando UP √© pressionado no endere√ßo </font></font><code>8040ec30</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 1 (e </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assume o valor 1) quando Z √© pressionado no endere√ßo </font></font><code>8040ec1c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sequ√™ncia atual √©: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z, CIMA, C-BAIXO, C-UP, BAIXO, ESQUERDA, C-ESQUERDA, C-DIREITA, DIREITA, A + B, IN√çCIO </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de verificar Z, mais uma condi√ß√£o √© verificada: embora um novo bot√£o deva ser pressionado Z, os sinalizadores atuais devem ser iguais </font></font><code>0x2030</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: os p√°ra-choques esquerdo e direito tamb√©m devem ser pressionados (eles t√™m valores de </font></font><code>0x10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>0x20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Al√©m disso, ACIMA / ABAIXO / ESQUERDA / DIREITA s√£o bot√µes D-pad, n√£o um stick anal√≥gico.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Batota c√≥digo </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A combina√ß√£o completa fica assim: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Segure os para-choques L + R e pressione Z </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-DOWN </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-down </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-esquerda </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-esquerda </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-DIREITA </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-DIREITA </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A + B </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> INICIAR </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso funciona! </font><font style="vertical-align: inherit;">Conecte o controlador √† segunda porta e insira o c√≥digo, ap√≥s o qual as informa√ß√µes de depura√ß√£o ser√£o exibidas. </font><font style="vertical-align: inherit;">Depois disso, voc√™ pode come√ßar a pressionar os bot√µes no segundo (ou at√© terceiro) controlador para executar v√°rias a√ß√µes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa combina√ß√£o funcionar√° sem corrigir o n√∫mero da vers√£o do jogo. </font><font style="vertical-align: inherit;">Pode at√© ser usado em uma c√≥pia regular do jogo, sem nenhuma ferramenta de trapa√ßa ou mods de console. </font><font style="vertical-align: inherit;">Voltar a entrar em combos desativa o modo zuru.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Usando o c√≥digo em um GameCube real"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A mensagem "ZURU% d /% d" √© </font></font><code>zurumode_callback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usada para exibir o status dessa combina√ß√£o se voc√™ a inserir quando o ID do disco j√° for igual </font></font><code>0x99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(provavelmente para depurar o pr√≥prio c√≥digo de fraude). O primeiro n√∫mero √© sua posi√ß√£o atual na sequ√™ncia, correspondente </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O segundo pega o valor 1, quando certos bot√µes da sequ√™ncia s√£o mantidos, eles podem corresponder a quando o </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor √© atribu√≠do 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria das mensagens n√£o explica o que est√° fazendo na tela; portanto, para entender sua finalidade, √© necess√°rio encontrar fun√ß√µes que as processem. Por exemplo, uma longa linha de estrelas azuis e vermelhas na parte superior da tela s√£o espa√ßos reservados para exibir o status de v√°rias miss√µes. Quando a miss√£o est√° ativa, alguns n√∫meros aparecem l√°, informando o status da miss√£o.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tela preta exibida ao pressionar Z √© um console para exibir mensagens de depura√ß√£o, especificamente para aspectos de baixo n√≠vel, como aloca√ß√£o de mem√≥ria, erros de heap e outras exce√ß√µes ruins. Por comportamento, </font></font><code>fault_callback_scroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode-se supor que ele seja usado para exibir esses erros antes que o sistema reinicie. Ele n√£o inicia nenhum desses erros, mas pode causar a impress√£o de alguns caracteres ileg√≠veis com v√°rios NOPs. Eu acho que no futuro ser√° muito √∫til para exibir suas pr√≥prias mensagens de depura√ß√£o:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b06/755/a33/b06755a33e0b0b8b010b7cbff7a26594.png" alt="Caracteres de lixo da console"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de fazer tudo isso, descobri que entrar no modo de depura√ß√£o corrigindo o ID da </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o </font></font><code>0x99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° </font><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">conhecido por outras pessoas: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tcrf.net/Animal_Crossing#Debug_Mode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Tamb√©m existem boas notas no link que indicam v√°rias mensagens e conversam sobre outras coisas que podem ser feitas com o controlador na porta 3.) No entanto, at√© onde eu sei, ningu√©m publicou a combina√ß√£o de truques ainda.</font></font><br><br>  Isso √© tudo.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> H√° outros recursos de desenvolvedor que eu gostaria de explorar, como a tela de depura√ß√£o do cart√£o e a tela de sele√ß√£o do emulador NES e como ativ√°-los sem usar patches. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/eb3/445/258eb3445236357c201c343d6c8ae4ba.png" alt="Tela de sele√ß√£o de mapa"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al√©m disso, publicarei artigos sobre engenharia reversa de sistemas de di√°logo, eventos e miss√µes com o objetivo de criar mods. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413967/">https://habr.com/ru/post/pt413967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413955/index.html">Ciclo de desenvolvimento completo do dispositivo IoT para controle de aquecimento de piscinas no ESP8266 em um ambiente Arduino</a></li>
<li><a href="../pt413957/index.html">Um exemplo de cria√ß√£o de um aplicativo esportivo em tempo real no Node.js</a></li>
<li><a href="../pt413959/index.html">Menor imagem do Docker - Menos de 1000 bytes</a></li>
<li><a href="../pt413963/index.html">Mini CRM para pequenas empresas</a></li>
<li><a href="../pt413965/index.html">Revis√£o de c√≥digo: voc√™ est√° fazendo errado</a></li>
<li><a href="../pt413969/index.html">Technopark Russky - desenvolvimento inovador de bilh√µes de or√ßamento</a></li>
<li><a href="../pt413971/index.html">Mais de 10 m√≠dias noticiosos em ingl√™s para alunos de idiomas</a></li>
<li><a href="../pt413973/index.html">Avalia√ß√£o Cavium ThunderX2: O sonho do servidor de arm√°rios √© verdadeiro (parte 2)</a></li>
<li><a href="../pt413977/index.html">Construindo um sistema de prote√ß√£o antiv√≠rus expandido para uma pequena empresa. Parte 3</a></li>
<li><a href="../pt413979/index.html">Mitap "Como administrar guildas e comunidades?" do Tutu.ru e AgileVerse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>