<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง ๐ฐ๏ธ ๐คถ๐ผ ููุงุฐุง ุ ููุงุฐุง ุ ููุชู ุชุณุชุฎุฏู ValueTask ๐ฆ ๐ค๐ฟ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฌุงุกุช ูุฐู ุงูุชุฑุฌูุฉ ุจูุถู ุงูุชุนููู ุงูุฌูุฏ 0x1000000 . 
 




 ูุฏู .NET Framework 4 ูุณุงุญุฉ System.Threading.Tasks ุ ููุนูุง ูุฆุฉ ุงููููุฉ. ูุฐุง ุงูููุน ูุงููููุฉ <ุงููุชู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุงุฐุง ุ ููุงุฐุง ุ ููุชู ุชุณุชุฎุฏู ValueTask</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458828/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <sup>ุฌุงุกุช ูุฐู ุงูุชุฑุฌูุฉ ุจูุถู ุงูุชุนููู ุงูุฌูุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">0x1000000</a> .</sup> <sup><br></sup> </p><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4t/kr/wh/4tkrwhp_br-sobqvgwwyimflsjq.jpeg" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุฏู .NET Framework 4 ูุณุงุญุฉ System.Threading.Tasks ุ ููุนูุง ูุฆุฉ ุงููููุฉ.  ูุฐุง ุงูููุน ูุงููููุฉ &lt;ุงููุชูุฌุฉ&gt; ุงูุชู ุชู ุฅูุดุงุคูุง ููู ูุงูุช ุชูุชุธุฑ ููุชูุง ุทูููุงู ุญุชู ูุชู ุงูุชุนุฑู ุนูููุง ุจูุงุณุทุฉ ุงููุนุงููุฑ ูู .NET ุจุงุนุชุจุงุฑูุง ุงูุฌูุงูุจ ุงูุฑุฆูุณูุฉ ููููุฐุฌ ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงูู ุงูุฐู ุชู ุชูุฏููู ูู C # 5 ูุน ุนุจุงุฑุงุช ุงูุชุฒุงูู / ุงูุงูุชุธุงุฑ.  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุชุญุฏุซ ุนู ุฃููุงุน ุฌุฏูุฏุฉ ูู ValueTask / ValueTask &lt;TResult&gt; ุ ุงููุตููุฉ ูุชุญุณูู ุฃุฏุงุก ุงูุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ูู ุงูุญุงูุงุช ุงูุชู ูุฌุจ ูููุง ุฃุฎุฐ ููุฏุงุฑ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ูู ุงูุงุนุชุจุงุฑ. </p><a name="habracut"></a><br><h3 id="task" style=";text-align:right;direction:rtl">  ูููุฉ </h3><br><p style=";text-align:right;direction:rtl"> ุชุนูู ุงููููุฉ ุจุฃุฏูุงุฑ ูุฎุชููุฉ ุ ูููู ุงูุนูุตุฑ ุงูุฑุฆูุณู ูู "ุงููุนุฏ" (ุงููุนุฏ) ุ ููู ูุงุฆู ููุซู ุฅููุงููุฉ ุฅููุงู ุจุนุถ ุงูุนูููุงุช.  ููููู ุจุฏุก ุนูููุฉ ูุงูุญุตูู ุนูู ูุงุฆู Task ููุง ุ ูุงูุฐู ุณูุชู ุชูููุฐู ุนูุฏ ุงูุชูุงู ุงูุนูููุฉ ุ ูุงูุฐู ูููู ุฃู ูุญุฏุซ ูู ุงููุถุน ุงููุชุฒุงูู ูุฌุฒุก ูู ุชููุฆุฉ ุงูุนูููุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุงุณุชูุงู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุจุงููุนู ูู ุงููุฎุฒู ุงููุคูุช) ุ ูู ูุถุน ุบูุฑ ูุชุฒุงูู ูุน ุงูุชูููุฐ ูู ุงูููุช ุงูุญุงูู ุนูุฏูุง ุชุญุตู ุนูู ูููุฉ (ุชููู ุงูุจูุงูุงุช ููุณ ูู ุงููุฎุฒู ุงููุคูุช ุ ูููู ุจุณุฑุนุฉ ูุจูุฑุฉ) ุ ุฃู ูู ูุถุน ุบูุฑ ูุชุฒุงูู ุ ูููู ุจุนุฏ ุฃู ูุฏูู ุจุงููุนู ูููุฉ (ุชููู ุจูุงูุงุช ูู ููุฑุฏ ุจุนูุฏ).  ูุธุฑูุง ูุฃู ุงูุนูููุฉ ูููู ุฃู ุชูุชูู ุจุดูู ุบูุฑ ูุชุฒุงูู ุ ูุฃูุช ุฅูุง ุชููุน ุชุฏูู ุงูุชูููุฐ ุฃู ุชูุชุธุฑ ุงููุชูุฌุฉ (ููุง ูุฌุนู ุนุฏู ุงูุชุฒุงูู ููููุงููุฉ ุจูุง ูุนูู) ุ ุฃู ุฅูุดุงุก ูุธููุฉ ุฑุฏ ุงุชุตุงู ุณูุชู ุชูุนูููุง ุจุนุฏ ุงูุชูุงู ุงูุนูููุฉ.  ูู .Net 4 ุ ูุชู ุชุทุจูู ุฅูุดุงุก ุฑุฏ ุงุชุตุงู ุนู ุทุฑูู ุฃุณุงููุจ ContinueWith ููุงุฆู ุงููููุฉ ุ ูุงูุชู ุชูุถุญ ูุฐุง ุงููููุฐุฌ ุจูุถูุญ ูู ุฎูุงู ูุจูู ูุธููุฉ ุงููููุถ ูุชุดุบููู ุจุนุฏ ุชูููุฐ ุงููููุฉ: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">SomeOperationAsync().ContinueWith(task =&gt; { try { TResult result = task.Result; UseResult(result); } catch (Exception e) { HandleException(e); } });</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูู .NET Framework 4.5 ู C # 5 ุ ูููู ุจุจุณุงุทุฉ ุงุณุชุฏุนุงุก ูุงุฆูุงุช ุงููููุฉ ุจูุงุณุทุฉ ุนุงูู ุงูุชุธุงุฑ ุ ููุง ูุฌุนู ูู ุงูุณูู ุงูุญุตูู ุนูู ูุชูุฌุฉ ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ ุ ูุณูู ุชุนูู ุงูุดูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ูุงูุชู ุชู ุชุญุณูููุง ููุฎูุงุฑุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุจุดูู ุตุญูุญ ูู ุฌููุน ุงูุญุงูุงุช ุนูุฏ ุงูุชูุงู ุงูุนูููุฉ ูู ุงููุถุน ุงููุชุฒุงูู ุ ุจุณุฑุนุฉ ุบูุฑ ูุชุฒุงูู ุฃู ุบูุฑ ูุชุฒุงูู ูุน ุฅุฌุฑุงุก callbacka: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TResult result = await SomeOperationAsync(); UseResult(result);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููููุฉ ูู ูุฆุฉ ูุฑูุฉ ููุบุงูุฉ ููุฏููุง ุนุฏุฏ ูู ุงููุฒุงูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุงูุฃุฏุงุก ูู ุงูุชุธุงุฑ ุนุฏุฉ ูุฑุงุช ูุฃู ุนุฏุฏ ูู ุงููุณุชููููู ูู ููุช ูุงุญุฏ.  ููููู ูุถุนู ูู ูุฌููุนุฉ (ูุงููุณ) ููุงูุชุธุงุฑ ุงููุชูุฑุฑ ูู ุงููุณุชูุจู ุ ูุงุณุชุฎุฏุงูู ูุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ููุชุงุฆุฌ ุงูููุงููุงุช ุบูุฑ ุงููุชุฒุงููุฉ.  ููููู ุญุธุฑ ุงูุชูููุฐ ุฃุซูุงุก ุงูุชุธุงุฑ ุงููููุฉ ูุฅููุงููุง ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ูููููู ูุชุงุจุฉ ูุชุทุจูู ุนูููุงุช ูุชููุนุฉ ุนูู ูุงุฆูุงุช ุงูููุงู (ุชุณูู ุฃุญูุงููุง "ุฃุฏูุงุช ุฏูุฌ") ุ ุนูู ุณุจูู ุงููุซุงู ุ "ุนูุฏ ูุฌูุฏ" ููุงูุชุธุงุฑ ุบูุฑ ุงููุชุฒุงูู ููุฅููุงู ุงูุฃูู ููุนุฏูุฏ ูู ุงูููุงู. <br>  ูููู ูุฐู ุงููุฑููุฉ ุชุตุจุญ ุบูุฑ ุถุฑูุฑูุฉ ูู ุงูุญุงูุฉ ุงูุฃูุซุฑ ุดููุนูุง: ูุง ุนููู ุณูู ุงุณุชุฏุนุงุก ุงูุนูููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูุงูุชุธุฑ ุงููููุฉ ูุฅููุงููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TResult result = await SomeOperationAsync(); UseResult(result);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุญู ูุณูุง ุจุญุงุฌุฉ ุฅูู ุงูุงูุชุธุงุฑ ุญุชู ุนุฏุฉ ูุฑุงุช.  ูุญู ูุณูุง ุจุญุงุฌุฉ ููุชุฃูุฏ ูู ุฃู ุงูุชููุนุงุช ุชูุงูุณูุฉ.  ูุญู ูุณูุง ุจุญุงุฌุฉ ูุฃุฏุงุก ููู ูุชุฒุงูู.  ูู ููุชุจ ูููุฏุงุช.  ูุญู ููุท ูู ุงูุชุธุงุฑ ูุนุฏ ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ ูุฅููุงู.  ูู ุงูููุงูุฉ ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ููุชุจ ุจูุง ุฑูุฒ ูุชุฒุงูู (ุนูู ุณุจูู ุงููุซุงู ุ ูุชูุฌุฉ TResult = SomeOperation () ุ) ุ ููุชู ุชุฑุฌูุชูุง ุนุงุฏุฉู ุฅูู ุงูุชุฒุงูู / ุงูุชุธุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู Task ููุง ููุงุท ุถุนู ูุญุชููุฉ ุ ุฎุงุตุฉู ุนูุฏ ุฅูุดุงุก ุนุฏุฏ ูุจูุฑ ูู ุงูุญุงูุงุช ุ ูุงูุฅูุชุงุฌูุฉ ุงูุนุงููุฉ ูุงูุฃุฏุงุก ููุง ูู ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ - ุงููููุฉ ุนุจุงุฑุฉ ุนู ูุฆุฉ.  ูุฐุง ูุนูู ุฃู ุฃู ุนูููุฉ ุชุญุชุงุฌ ุฅูู ูููุฉ ูุชู ุฅุฌุจุงุฑูุง ุนูู ุฅูุดุงุก ูุงุฆู ููุถุนู ุ ููููุง ุชู ุฅูุดุงุก ุงููุฒูุฏ ูู ุงููุงุฆูุงุช ุ ุฒุงุฏ ุนูู ูุฌูุน ุฃุฏุงุฉ ุชุฌููุน ุงูุจูุงูุงุช ุงูููููุฉ (GC) ุ ููุณุชููู ูุฐุง ุงูุนูู ููุงุฑุฏ ูููููุง ุฅููุงููุง ุนูู ุดูุก ุฃูุซุฑ ูููุฏ. </p><br><p style=";text-align:right;direction:rtl">  ููุช ุงูุชุดุบูู ูููุชุจุงุช ุงููุธุงู ุชุณุงุนุฏ ูู ุชุฎููู ูุฐู ุงููุดููุฉ ูู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุช.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุชุจูุง ุทุฑููุฉ ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public async Task WriteAsync(byte value) { if (_bufferedCount == _buffer.Length) { await FlushAsync(); } _buffer[_bufferedCount++] = value; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุนุฏุฉ ุนุงูุฉ ุ ุณูููู ููุงู ูุณุงุญุฉ ุญุฑุฉ ูุงููุฉ ูู ุงููุฎุฒู ุงููุคูุช ุ ูุณูุชู ุชูููุฐ ุงูุนูููุฉ ุจุดูู ูุชุฒุงูู.  ุนูุฏูุง ูุญุฏุซ ูุฐุง ุ ููุณุช ููุงู ุญุงุฌุฉ ููุนู ุฃู ุดูุก ูุน ุงููููุฉ ุ ูุงูุชู ููุจุบู ุฅุฑุฌุงุนูุง ุ ูุธุฑูุง ูุนุฏู ูุฌูุฏ ูููุฉ ุฅุฑุฌุงุน ุ ูุณุชุฎุฏู ูุฐุง ุงููููุฉ ูููุงูุฆ ูุทุฑููุฉ ูุชุฒุงููุฉ ุชููู ุจุฅุฑุฌุงุน ูููุฉ ูุงุฑุบุฉ (ุฎุงููุฉ).  ูุฐูู ุ ูููู ููุจูุฆุฉ ุจุจุณุงุทุฉ ุชุฎุฒูู ูููุฉ ุบูุฑ ุนุงูุฉ ูุคูุชูุง ูุงุณุชุฎุฏุงููุง ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ููุชูุฌุฉ ููุชูููุฐ ูุฃู ุทุฑููุฉ ูุฒุงููุฉ ุชูุชูู ุจุดูู ูุชุฒุงูู (ูููู ุงูุญุตูู ุนูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูููุฑุฏุฉ ูุฐู ูู ุฎูุงู Task.CompletedTask).  ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชูุชุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public async Task&lt;bool&gt; MoveNextAsync() { if (_bufferedCount == 0) { await FillBuffer(); } return _bufferedCount &gt; 0; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจูุฌู ุนุงู ุ ุชููุน ุฃู ุชููู ุงูุจูุงูุงุช ููุฌูุฏุฉ ุจุงููุนู ูู ุงููุฎุฒู ุงููุคูุช ุ ูุฐูู ุชููู ุงูุทุฑููุฉ ุจุจุณุงุทุฉ ุจุงูุชุญูู ูู ูููุฉ _bufferedCount ุ ูุชุฑู ุฃููุง ุฃูุจุฑ ูู 0 ุ ูุฅุฑุฌุงุน true ุ  ูููุท ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุจูุงูุงุช ูู ุงููุฎุฒู ุงููุคูุช ุจุนุฏ ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ.  ููุธุฑูุง ููุฌูุฏ ูุชูุฌุชูู ูุญุชููุชูู ููุท ูู ุงูููุน Boolean (ุตูุงุจ ูุฎุทุฃ) ุ ูุง ููุฌุฏ ุณูู ูุงุฆููู ูุญุชูููู ูู ููุงู ุงูููุงู ุงููุงุฒูุฉ ูุชูุซูู ูุฐู ุงููุชุงุฆุฌ ุ ุญูุซ ูููู ููุจูุฆุฉ ุชุฎุฒูู ูุฐู ุงููุงุฆูุงุช ูุคูุชูุง ูุฅุนุงุฏุชูุง ุจุงููููุฉ ุงูููุงุจูุฉ ุฏูู ุชุฎุตูุต ุฐุงูุฑุฉ.  ููุท ูู ุญุงูุฉ ุงูุงูุชูุงู ุบูุฑ ุงููุชุฒุงูู ุ ุณุชุญุชุงุฌ ุงูุทุฑููุฉ ุฅูู ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ ุ ูุฃูู ูุฌุจ ุฃู ูุชู ุฅุฑุฌุงุนูุง ูุจู ูุนุฑูุฉ ูุชูุฌุฉ ุงูุนูููุฉ. <br></p><p style=";text-align:right;direction:rtl">  ุชููุฑ ุงูุจูุฆุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุจุนุถ ุงูุฃููุงุน ุงูุฃุฎุฑู ุ ูููู ูู ุบูุฑ ุงููุงูุนู ุชุฎุฒูู ุฌููุน ุงูุฃููุงุน ุงูููููุฉ ูุคูุชูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุทุฑููุฉ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public async Task&lt;int&gt; ReadNextByteAsync() { if (_bufferedCount == 0) { await FillBuffer(); } if (_bufferedCount == 0) { return -1; } _bufferedCount--; return _buffer[_position++]; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุณูุชู ุชูููุฐูุง ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุจุดูู ูุชุฒุงูู.  ูููู ุนูู ุนูุณ ุงููุชุบูุฑ ุงููุงุชุฌ ุนู ุงูููุน Boolean ุ ุชูุฑุฌุน ูุฐู ุงูุทุฑููุฉ Int32 ุ ุงูุชู ุชุญุชูู ุนูู ุญูุงูู 4 ูููุงุฑุงุช ูููุฉ ุ ูุชุฎุฒูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุงูุฉ ุงููุชุบูุฑุงุช ุงููููุฉ &lt;int&gt; ูุชุทูุจ ูุฆุงุช ุบูุบุง ุจุงูุช ูู ุงูุฐุงูุฑุฉ.  ุชููุฑ ุงูุจูุฆุฉ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ุตุบูุฑุฉ ูููููุฉ &lt;int&gt; ุ ูููู ูุฌููุนุฉ ูุญุฏูุฏุฉ ููุบุงูุฉ ูู ุงูููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุงูุชูุช ูุฐู ุงูุทุฑููุฉ ุจุดูู ูุชุฒุงูู (ุงูุจูุงูุงุช ููุฌูุฏุฉ ุจุงููุนู ูู ุงููุฎุฒู ุงููุคูุช) ูุน ูููุฉ ุงูุฅุฑุฌุงุน 4 ุ ูุณุชููู ูููุฉ ูุฎุฒูุฉ ูุคูุชูุง ุ ูููู ุฅุฐุง ุชู ุฅุฑุฌุงุน ุงููููุฉ 42 ุ ูุณุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุงุญุฏุฉ ุฌุฏูุฏุฉ ุงููููุฉ &lt;int&gt; ุ ุชุดุจู ุงุณุชุฏุนุงุก Task.FromResult (42). </p><br><p style=";text-align:right;direction:rtl">  ุชุญุงูู ุงูุนุฏูุฏ ูู ุฃุณุงููุจ ุงูููุชุจุงุช ุชูุฏุฆุฉ ุฐูู ูู ุฎูุงู ุชูููุฑ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุฎุงุตุฉ ุจูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุชุญููู ุงูุฒุงุฆุฏ ูู .NET Framework 4.5 ูุทุฑููุฉ MemoryStream.ReadAsync ููุชูู ุฏุงุฆููุง ุจุดูู ูุชุฒุงูู ุ ูุฃูู ููุฑุฃ ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ.  ุฅุฑุฌุงุน ReadAsync ูููุฉ &lt;int&gt; ุ ุญูุซ ุชุดูุฑ ูุชูุฌุฉ Int32 ุฅูู ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ุชูุช ูุฑุงุกุชูุง.  ุบุงูุจูุง ูุง ุชุณุชุฎุฏู ูุฐู ุงูุทุฑููุฉ ูู ุญููุฉ ุ ูุบุงูุจูุง ูุน ููุณ ุงูุนุฏุฏ ุงููุทููุจ ูู ุงูุจุงูุชุงุช ููู ููุงููุฉ ุ ูุบุงูุจูุง ูุง ูุชู ุชูุจูุฉ ูุฐู ุงูุญุงุฌุฉ ุจุงููุงูู.  ูุฐูู ุจุงููุณุจุฉ ููููุงููุงุช ุงููุชูุฑุฑุฉ ุฅูู ReadAsync ุ ููู ุงููุนููู ุชููุน ุฃู ุงููููุฉ &lt;int&gt; ุณุชุนูุฏ ุจุดูู ูุชุฒุงูู ุจููุณ ุงููููุฉ ููุง ูู ุงูููุงููุฉ ุงูุณุงุจูุฉ.  ูุฐูู ุ ููุดุฆ MemoryStream ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ููุงุฆู ูุงุญุฏ ุชู ุฅุฑุฌุงุนู ูู ุขุฎุฑ ููุงููุฉ ูุงุฌุญุฉ.  ููู ุงูููุงููุฉ ุงูุชุงููุฉ ุ ุฅุฐุง ุชูุฑุฑุช ุงููุชูุฌุฉ ุ ูุณูู ุชูุฑุฌุน ุงููุงุฆู ุงููุฎุฒู ูุคูุชูุง ุ ูุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ููู ุจุฅูุดุงุก ูุงุฆู ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู Task.FromResult ุ ูุงุญูุธู ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุฃุนุฏู. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ููุงู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุช ุงูุฃุฎุฑู ุนูุฏูุง ูุชู ุชูููุฐ ุงูุนูููุฉ ุจุดูู ูุชุฒุงูู ุ ูููู ูุชู ูุฑุถ ุงููุงุฆู Task &lt;TResult&gt;. </p><br><h4 id="valuetasktresult-i-sinhronnoe-vypolnenie" style=";text-align:right;direction:rtl">  ValueTask &lt;ุงููุชูุฌุฉ&gt; ูุงูุชูููุฐ ุงููุชุฒุงูู </h4><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ูุชุทูุจ ุชุทุจูู ููุน ุฌุฏูุฏ ูู .NET Core 2.0 ุ ูุงูุฐู ูุงู ูุชุงุญูุง ูู ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ูู .NET ูู ูุธุงู NuGet.Threading.Tasks.Extensions: ValueTask &lt;TResult&gt; ุงูุญุฒูุฉ. <br>  ุชู ุฅูุดุงุก ValueTask &lt;TResult&gt; ูู .NET Core 2.0 ููููู ูุงุฏุฑ ุนูู ุงูุชูุงู ูู ูู TResult ูุงููููุฉ &lt;TResult&gt;.  ูุฐุง ูุนูู ุฃูู ูููู ุฅุฑุฌุงุนูุง ูู ุทุฑููุฉ ุงููุฒุงููุฉ ุ ูุฅุฐุง ุชู ุชูููุฐ ูุฐู ุงูุทุฑููุฉ ุจุดูู ูุชุฒุงูู ูุจูุฌุงุญ ุ ููู ุชุญุชุงุฌ ุฅูู ูุถุน ุฃู ูุงุฆู ุนูู ูููุฉ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ: ููููู ุจุจุณุงุทุฉ ุชููุฆุฉ ุจููุฉ ValueTask &lt;TResult&gt; ูุฐู ูุน ุงููููุฉ TResult ูุฅุนุงุฏุชูุง.  ููุท ูู ุญุงูุฉ ุงูุชูููุฐ ุบูุฑ ุงููุชุฒุงูู ุ ุณูุชู ูุถุน ูุงุฆู Task &lt;TResult&gt; ุ ูุณูู ูููู ValueTask &lt;TResult&gt; ุจุงูุชูุงูู (ูุชูููู ุญุฌู ุงููููู ูุชุญุณูู ุญุงูุฉ ุงูุชูููุฐ ุงููุงุฌุญ ุ ูุฅู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุ ุงูุชู ุชูุชูู ุจุงุณุชุซูุงุก ุบูุฑ ูุฏุนูู ุ ุณุชุถุน ุงููููุฉ &lt;TResult&gt; ุฃูุถูุง ุชููู ValueTask &lt;TResult&gt; ุฃูุถูุง ุจูู ุงููููุฉ &lt;ุงููุชูุฌุฉ&gt; ุ ููู ุชุญูู ูุนูุง ุญูููุง ุฅุถุงูููุง ูุชุฎุฒูู ุงูุงุณุชุซูุงุก). </p><br><p style=";text-align:right;direction:rtl">  ุจูุงุกู ุนูู ุฐูู ุ ูุฌุจ ุฃูุง ุชุชุนุงูู ุทุฑููุฉ ูุซู MemoryStream.ReadAsync ุ ูููู ุฅุฑุฌุงุน ValueTask &lt;int&gt; ุ ูุน ุงูุชุฎุฒูู ุงููุคูุช ุ ูููู ุจุฏูุงู ูู ุฐูู ูููู ูุชุงุจุชูุง ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public override ValueTask&lt;int&gt; ReadAsync(byte[] buffer, int offset, int count) { try { int bytesRead = Read(buffer, offset, count); return new ValueTask&lt;int&gt;(bytesRead); } catch (Exception e) { return new ValueTask&lt;int&gt;(Task.FromException&lt;int&gt;(e)); } }</code> </pre> <br><h4 id="valuetasktresult-i-asinhronnoe-vypolnenie" style=";text-align:right;direction:rtl">  ValueTask &lt;ุงููุชูุฌุฉ&gt; ูุงูุชูููุฐ ุบูุฑ ุงููุชุฒุงูู </h4><br><p style=";text-align:right;direction:rtl">  ุงููุฏุฑุฉ ุนูู ูุชุงุจุฉ ุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ูููู ุฃู ุชูุชูู ุจุดูู ูุชุฒุงูู ุฏูู ุงูุญุงุฌุฉ ุฅูู ูุถุน ุฅุถุงูู ูููุชูุฌุฉ ูู ููุฒ ูุจูุฑ.  ููุฐุง ุงูุณุจุจ ุชู ุฅุถุงูุฉ ValueTask &lt;TResult&gt; ูู .NET Core 2.0 ุ ููุชู ุงูุขู ุงูุฅุนูุงู ุนู ุฃุณุงููุจ ุฌุฏูุฏุฉ ูู ุงููุญุชูู ุงุณุชุฎุฏุงููุง ูู ุงูุชุทุจููุงุช ุงูุชู ุชุชุทูุจ ุฃุฏุงุก ูุน ุฅุฑุฌุงุน ValueTask &lt;TResult&gt; ุจุฏูุงู ูู Task &lt;TResult&gt;.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ุฃุถููุง ุญูููุง ุฌุฏูุฏูุง ReadAsync ูู ูุฆุฉ Stream ุฅูู .NET Core 2.1 ุ ููู ูุชููู ูู ุชูุฑูุฑ ุงูุฐุงูุฑุฉ ุจุฏูุงู ูู ุงูุจุงูุช [] ุ ูุฑุฌุน ููุน ValueTask &lt;int&gt; ููู.  ูู ูุฐุง ุงููููุฐุฌ ุ ูููู ุงุณุชุฎุฏุงู ูุงุฆูุงุช Stream (ุงูุชู ูุชู ูููุง ุชูููุฐ ุงูุฃุณููุจ ReadAsync ูู ุงูุบุงูุจ ุจุดูู ูุชุฒุงูู ุ ููุง ูู ุงููุซุงู ุงูุณุงุจู ูู MemoryStream) ูุน ุชุฎุตูุต ุฐุงูุฑุฉ ุฃูู ุจูุซูุฑ. <br></p><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ุนูุฏูุง ูุนูู ูุน ุฎุฏูุงุช ุฐุงุช ูุทุงู ุชุฑุฏุฏู ูุฑุชูุน ููุบุงูุฉ ุ ูุง ุฒููุง ูุฑูุฏ ุชุฌูุจ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ูุฏุฑ ุงูุฅููุงู ุ ููุง ูุนูู ุชูููู ูุฅูุบุงุก ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุนูู ุทูู ูุณุงุฑ ุงูุชูููุฐ ุบูุฑ ุงููุชุฒุงูู. <br>  ูู ูููุฐุฌ ุงูุชุธุงุฑ ุ ูุฃู ุนูููุฉ ุชูุชูู ุจุดูู ุบูุฑ ูุชุฒุงูู ุ ูุญุชุงุฌ ุฅูู ุงููุฏุฑุฉ ุนูู ุฅุฑุฌุงุน ูุงุฆู ููุซู ุงูุฅููุงู ุงููุญุชูู ููุนูููุฉ: ูุญุชุงุฌ ุงููุชุตู ุฅูู ุฅุนุงุฏุฉ ุชูุฌูู ุฑุฏ ุงูุงุชุตุงู ุงูุฐู ุณูุจุฏุฃ ูู ููุงูุฉ ุงูุนูููุฉ ุ ููุฐุง ูุชุทูุจ ูุงุฆููุง ูุฑูุฏูุง ูู ุงููููุฉ ุ ูุงูุฐู ูููู ุฃู ูููู ุจูุซุงุจุฉ ููุงุฉ ููู ู ูุฐู ุงูุนูููุฉ ุฎุงุตุฉ.  ูุฐุง ุ ูู ุงูููุช ููุณู ุ ูุง ูุนูู ุฃู ุดูุก ูุง ุฅุฐุง ูุงู ุณูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ูุฐุง ุงููุงุฆู ุจุนุฏ ุงูุชูุงู ุงูุนูููุฉ.  ุฅุฐุง ูุงู ูู ุงููููู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ูุฐุง ุงููุงุฆู ุ ููููู ูู API ุชูุธูู ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ููุงุญุฏ ุฃู ุฃูุซุฑ ูู ูุฐู ุงููุงุฆูุงุช ุ ูุงุณุชุฎุฏุงูู ูู ุนูููุงุช ูุชุณูุณูุฉ ุ ุจูุนูู ุนุฏู ุงุณุชุฎุฏุงู ููุณ ุงููุงุฆู ูุนุฏุฉ ุนูููุงุช ุบูุฑ ูุชุฒุงููุฉ ูุณูุทุฉ ุ ูููู ููุงุณุชุฎุฏุงู ูููุตูู ุบูุฑ ุงูุชูุงูุณู. <br>  ูู .NET Core 2.1 ุ ุชู ุชุญุณูู ูุฆุฉ ValueTask &lt;TResult&gt; ูุฏุนู ุงูุชุฌููุน ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู ุงููุชูุงุซููู.  ุจุฏูุงู ูู ูุฌุฑุฏ ุงูุชูุงู TResult ุฃู Task &lt;TResult&gt; ุ ูููู ููุฆุฉ ุชูุช ูุฑุงุฌุนุชูุง ุงูุชูุงู ูุงุฌูุฉ IValueTaskSource &lt;TResult&gt; ุฌุฏูุฏุฉ.  ุชููุฑ ูุฐู ุงููุงุฌูุฉ ุงููุธููุฉ ุงูุฃุณุงุณูุฉ ุงููุงุฒูุฉ ููุฑุงููุฉ ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ ูุน ูุงุฆู &lt;Tesult&gt; ValueTask ุจููุณ ุงูุทุฑููุฉ ุงูุชู ุชุนูู ุจูุง ุงููููุฉ &lt;TResult&gt;: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public interface IValueTaskSource&lt;out TResult&gt; { ValueTaskSourceStatus GetStatus(short token); void OnCompleted(Action&lt;object&gt; continuation, object state, short token, ValueTaskSourceOnCompletedFlags flags); TResult GetResult(short token); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฎุฏุงู ุงูุฃุณููุจ GetStatus ูุชุทุจูู ุฎุตุงุฆุต ูุซู ValueTask &lt;TResult&gt; .IsCompleted ุ ูุงูุชู ุชูุฑุฌุน ูุนูููุงุช ุนูุง ุฅุฐุง ูุงูุช ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ ูุฏ ุชู ุชูููุฐูุง ุฃู ุฅููุงููุง ุ ูููู ุชู ุฅููุงููุง (ูุงุฌุญุฉ ุฃู ูุง).  ูุชู ุงุณุชุฎุฏุงู ุงูุฃุณููุจ OnCompleted ุจูุงุณุทุฉ ูุงุฆู ุงูุชุธุงุฑ ูุฅุฑูุงู ุฑุฏ ุงุชุตุงู ููุชุงุจุนุฉ ุงูุชูููุฐ ูู ููุทุฉ ุงูุชุธุงุฑ ุนูุฏ ุงูุชูุงู ุงูุนูููุฉ.  ูููุงู ุญุงุฌุฉ ุฅูู ุทุฑููุฉ GetResult ููุญุตูู ุนูู ูุชูุฌุฉ ุงูุนูููุฉ ุ ูุฐูู ุจุนุฏ ููุงูุฉ ุงูุนูููุฉ ุ ูููู ูููุชุตู ุงูุญุตูู ุนูู ูุงุฆู TResult ุฃู ุชูุฑูุฑ ุฃู ุงุณุชุซูุงุก ุชู ุทุฑุญู. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุญุชุงุฌ ูุนุธู ุงููุทูุฑูู ุฅูู ูุฐู ุงููุงุฌูุฉ: ูุงูุทุฑู ุชุฑุฌุน ุจุจุณุงุทุฉ ูุงุฆู &lt;Tesult&gt; ValueTask ุ ูุงูุฐู ูููู ุฅูุดุงุคู ูููู ููุงุฆู ูููู ุจุชูููุฐ ูุฐู ุงููุงุฌูุฉ ุ ูุณุชุธู ุทุฑููุฉ ุงูุงุณุชุฏุนุงุก ูู ุงูุธูุงู.  ูุฐู ุงููุงุฌูุฉ ูููุทูุฑูู ุงูุฐูู ูุญุชุงุฌูู ุฅูู ุชุฌูุจ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุนูุฏ ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูููุฉ ููุฃุฏุงุก. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูุฃูุซูุฉ ููุซู ูุฐู API ูู .NET Core 2.1.  ุงูุทุฑู ุงูุฃูุซุฑ ุดูุฑุฉ ูู Socket.ReceiveAsync ู Socket.SendAsync ูุน ุฒูุงุฏุฉ ุงูุฃุญูุงู ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ ูู 2.1 ุ ุนูู ุณุจูู ุงููุซุงู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public ValueTask&lt;int&gt; ReceiveAsync(Memory&lt;byte&gt; buffer, SocketFlags socketFlags, CancellationToken cancellationToken = default);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุชุญููู ุงูุฒุงุฆุฏ ุจุฅุฑุฌุงุน ValueTask &lt;int&gt;.  ุฅุฐุง ุงูุชููุช ุงูุนูููุฉ ุจุดูู ูุชุฒุงูู ุ ููููููุง ุจุจุณุงุทุฉ ุฅุฑุฌุงุน ValueTask &lt;int&gt; ุจุงููููุฉ ุงูููุงุจูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">int result = โฆ; return new ValueTask&lt;int&gt;(result);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุฅููุงุก ุบูุฑ ุงููุชุฒุงูู ุ ููููู ุงุณุชุฎุฏุงู ูุงุฆู ูู ุงูุชุฌูุน ูููู ุจุชูููุฐ ุงููุงุฌูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">IValueTaskSource&lt;int&gt; vts = โฆ; return new ValueTask&lt;int&gt;(vts);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฏุนู ุชุทุจูู Socket ูุงุฆููุง ูุงุญุฏูุง ูู ุงูุชุฌูุน ููุงุณุชูุจุงู ูุงูุขุฎุฑ ููุฅุฑุณุงู ุ ุญูุซ ูุง ูููู ุฃู ูููู ููุงู ุฃูุซุฑ ูู ูุงุฆู ูุงุญุฏ ููู ุงุชุฌุงู ูู ุงูุชุธุงุฑ ุงูุชูููุฐ ูู ููุช ูุงุญุฏ.  ูุฐู ุงูุฃุญูุงู ุงูุฒุงุฆุฏุฉ ูุง ุชุฎุตุต ุงูุฐุงูุฑุฉ ุ ุญุชู ูู ุญุงูุฉ ูุฌูุฏ ุนูููุฉ ุบูุฑ ูุชุฒุงููุฉ.  ูุฐุง ุงูุณููู ูู ูุงุถุญ ุฃูุซุฑ ูู ูุฆุฉ NetworkStream. <br>  ุนูู ุณุจูู ุงููุซุงู ุ ูู .NET Core 2.1 Stream ูููุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public virtual ValueTask&lt;int&gt; ReadAsync(Memory&lt;byte&gt; buffer, CancellationToken cancellationToken);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฐู ุชู ุฅุนุงุฏุฉ ุชุนุฑููู ูู NetworkStream.  ูุณุชุฎุฏู ุฃุณููุจ NetworkStream.ReadAsync ุจุจุณุงุทุฉ ุทุฑููุฉ Socket.ReceiveAsync ุ ุจุญูุซ ูุชู ุจุซ ุงูุฃุฑุจุงุญ ูู Socket ุฅูู NetworkStream ุ ููุง ูุฎุตุต NetworkStream.ReadAsync ุงูุฐุงูุฑุฉ ุจุงููุนู. </p><br><h4 id="neobobschyonnyy-valuetask" style=";text-align:right;direction:rtl">  Unseded ValueTask </h4><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุธูุฑ ValueTask &lt;TResult&gt; ูู .NET Core 2.0 ุ ุชู ุชุญุณูู ุญุงูุฉ ุงูุชูููุฐ ุงููุชุฒุงูู ููุท ูู ุฃุฌู ุงุณุชุจุนุงุฏ ููุถุน ูุงุฆู ุงููููุฉ &lt;TResult&gt; ุฅุฐุง ูุงูุช ูููุฉ TResult ุฌุงูุฒุฉ ุจุงููุนู.  ูุฐุง ูุนูู ุฃู ูุฆุฉ ValueTask ุบูุฑ ุงูุนุงูุฉ ููุณุช ุถุฑูุฑูุฉ: ุจุงููุณุจุฉ ูุญุงูุฉ ุงูุชูููุฐ ุงููุชุฒุงูู ุ ูููู ุจุจุณุงุทุฉ ุฅุฑุฌุงุน Task.CompletedTask ุงููููุฑุฏุฉ ูู ุงูุทุฑููุฉ ุ ููุฏ ุชู ุฐูู ุจูุงุณุทุฉ ุงูุจูุฆุฉ ุจุดูู ุถููู ูู ุฃุณุงููุจ ุงููุชุฒุงูู ุฅุฑุฌุงุน ุงูููุงู. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุน ุงูุญุตูู ุนูู ุนูููุงุช ุบูุฑ ูุชุฒุงููุฉ ุฏูู ุชุฎุตูุต ุฐุงูุฑุฉ ุ ุฃุตุจุญ ุงุณุชุฎุฏุงู ValueTask ุบูุฑ ุงููุดุชุฑู ูุฑุฉ ุฃุฎุฑู ุฐุง ุตูุฉ.  ูู .NET Core 2.1 ุ ูุฏููุง โโValueTask ู IValueTaskSource ุงูุนุงูุฉ.  ุฃููุง ุชููุฑ ููุงูุฆุงุช ูุจุงุดุฑุฉ ููุฅุตุฏุงุฑุงุช ุงูุนุงูุฉ ุ ููุงุณุชุฎุฏุงู ุงูููุงุซู ุ ูุน ูููุฉ ุฅุฑุฌุงุน ูุงุฑุบุฉ ููุท. </p><br><h4 id="realizaciya-ivaluetasksourceivaluetasksourcet" style=";text-align:right;direction:rtl">  ุชุทุจูู IValueTaskSource / IValueTaskSource &lt;T&gt; </h4><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุนูู ูุนุธู ุงููุทูุฑูู ุนุฏู ุชุทุจูู ูุฐู ุงููุงุฌูุงุช.  ุนูุงูุฉ ุนูู ุฐูู ุ ุงูุฃูุฑ ููุณ ุจูุฐู ุงูุณูููุฉ.  ุฅุฐุง ูุฑุฑุช ุงูููุงู ุจุฐูู ุ ูููู ุฃู ุชุนูู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ูู .NET Core 2.1 ูููุทุฉ ุงูุทูุงู ุ ุนูู ุณุจูู ุงููุซุงู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  AwaitableSocketAsyncEventArgs </li><li style=";text-align:right;direction:rtl">  AsyncOperation &lt;ุงููุชูุฌุฉ&gt; </li><li style=";text-align:right;direction:rtl">  DefaultPipeReader </li></ul><br><p style=";text-align:right;direction:rtl">  ูุชุณููู ูุฐุง ุงูุฃูุฑ ุ ูู .NET Core 3.0 ุ ูุฎุทุท ูุฅุฏุฎุงู ูู ุงูููุทู ุงูุถุฑูุฑู ุงููุถููู ูู ุงูููุน ManualResetValueTaskSourceCore &lt;TResult&gt; ุ ููู ุจููุฉ ูููู ุชุถููููุง ูู ูุงุฆู ุขุฎุฑ ูููู ุจุชูููุฐ IValueTaskSource &lt;TResult&gt; ู / ุฃู IValueTaskSource ุ ุจุญูุซ ูููู ุชูููุถู ุฅูู ูุฐุง ุงููููู ูู ุงูุฌุฒุก ุงูุฃูุจุฑ ูู ุงููุธููุฉ.  ููููู ูุนุฑูุฉ ุงููุฒูุฏ ุญูู ูุฐุง ุงูุฃูุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/dotnet/corefx/issues/32664</a> ูู ูุณุชูุฏุน dotnet / corefx. </p><br><h4 id="patterny-primeneniya-valuetasks" style=";text-align:right;direction:rtl">  ุฃููุงุท ุชุทุจูู ValueTasks </h4><br><p style=";text-align:right;direction:rtl">  ูููููุฉ ุงูุฃููู ุ ูููู ูุทุงู ValueTask ู ValueTask &lt;TResult&gt; ูุญุฏูุฏูุง ุฃูุซุฑ ูู Task and Task &lt;TResult&gt;.  ูุฐุง ุฃูุฑ ุฌูุฏ ุ ูุญุชู ูุชููุน ุ ูุฃู ุงูุทุฑููุฉ ุงูุฑุฆูุณูุฉ ูุงุณุชุฎุฏุงููู ูู ุจุจุณุงุทุฉ ุงุณุชุฎุฏุงู ุนุงูู ุงูุชุดุบูู ุงูุฐู ููุชุธุฑ. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุธุฑูุง ูุฃูู ูููููู ุงูุชูุงู ุงููุงุฆูุงุช ุงูุชู ูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง ุ ูููุงู ูููุฏ ูุจูุฑุฉ ุนูู ุงุณุชุฎุฏุงููุง ููุงุฑูุฉ ุจุงููููุฉ ูุงููููุฉ &lt;ุงููุชูุฌุฉ&gt; ุ ุฅุฐุง ููุช ุชูุญุฑู ุนู ุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ ูู ุงูุงูุชุธุงุฑ ุงูุจุณูุท.  ูู ุงูุญุงูุงุช ุงูุนุงูุฉ ุ ูุง ููุจุบู ุฃุจุฏูุง ุชูููุฐ ุงูุนูููุงุช ุงูุชุงููุฉ ุจุงุณุชุฎุฏุงู ValueTask / ValueTask &lt;ุงููุชูุฌุฉ&gt;: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุงูุชุธุงุฑ ุงููุชูุฑุฑ ValueTask / ValueTask &lt;ุงููุชูุฌุฉ&gt;</strong> ูุฏ ูุชู ุจุงููุนู ุงูุชุฎูุต ูู ูุงุฆู ุงููุชูุฌุฉ ูุงุณุชุฎุฏุงูู ูู ุนูููุฉ ุฃุฎุฑู.  ูู ุงูููุงุจู ุ ูุง ุชูุชูู ุงููููุฉ / ุงููููุฉ &lt;TResult&gt; ุฃุจุฏูุง ูู ุญุงูุฉ ููุชููุฉ ุฅูู ุญุงูุฉ ุบูุฑ ูุงููุฉ ุ ุจุญูุซ ููููู ุฅุนุงุฏุฉ ุชููุนูุง ุนุฏุฉ ูุฑุงุช ุญุณุจ ุงูุญุงุฌุฉ ูุงูุญุตูู ุนูู ููุณ ุงููุชูุฌุฉ ูู ูู ูุฑุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>ุงูุชุธุงุฑ ูุชูุงุฒู ValueTask / ValueTask &lt;TResult&gt;</strong> ูุชููุน ูุงุฆู ุงููุชูุฌุฉ ูุนุงูุฌุฉ ูุน ุฑุฏ ุงุชุตุงู ูุงุญุฏ ููุท ูู ูุณุชููู ูุงุญุฏ ูู ูู ูุฑุฉ ุ ููุญุงููุฉ ุงูุงูุชุธุงุฑ ูู ุชุฏููุงุช ูุฎุชููุฉ ูู ููุณ ุงูููุช ูููู ุฃู ูุคุฏู ุจุณูููุฉ ุฅูู ุณุจุงูุงุช ูุฃุฎุทุงุก ุจุฑูุงูุฌ ุฎููุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฅููุง ุฃูุถูุง ุญุงูุฉ ุฃูุซุฑ ุชุญุฏูุฏุงู ูุนูููุฉ "ุฅุนุงุฏุฉ ุงูุงูุชุธุงุฑ" ุบูุฑ ุงูุตุงูุญุฉ ุงูุณุงุจูุฉ.  ูู ุงูููุงุฑูุฉ ุ ุชููุฑ ุงููููุฉ / ุงููููุฉ &lt;ุงููุชูุฌุฉ&gt; ุฃู ุนุฏุฏ ูู ุงูุงูุชุธุงุฑ ุงููุชูุงุฒู. </li><li style=";text-align:right;direction:rtl">  <strong>ุจุงุณุชุฎุฏุงู .GetAwaiter (). GetResult () ุนูุฏูุง ูู ุชูุชูู ุงูุนูููุฉ ุจุนุฏ.</strong> ูุง ูุญุชุงุฌ ุชุทุจูู IValueTaskSource / IValueTaskSource &lt;TResult&gt; ุฅูู ุฏุนู ุงูููู ุญุชู ุชูุชูู ุงูุนูููุฉ ุ ูุนูู ุงูุฃุฑุฌุญ ูู ุชูุนู ุฐูู ุ ูุจุงูุชุงูู ูุฅู ูุฐู ุงูุนูููุฉ ุณุชุคุฏู ุจุงูุชุฃููุฏ ุฅูู ุงูุณุจุงู ูุฑุจูุง ูู ุชููุฐ ููุง ุชุชููุน ุทุฑููุฉ ุงูุงุชุตุงู.  ุงููููุฉ / ุงููููุฉ &lt;ุงููุชูุฌุฉ&gt; ุจุญุธุฑ ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุงุณุชุฏุนุงุก ุญุชู ุชูุชูู ุงููููุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุชูููุช ValueTask ุฃู ValueTask &lt;TResult&gt; ุ ูููู ุชุญุชุงุฌ ุฅูู ุชูููุฐ ุฅุญุฏู ูุฐู ุงูุนูููุงุช ุงูุซูุงุซ ุ ูููููู ุงุณุชุฎุฏุงู .AsTask () ุ ูุงูุญุตูู ุนูู Task / Task &lt;TResult&gt; ุ ุซู ุงูุนูู ูุน ุงููุงุฆู ุงููุณุชูู.  ุจุนุฏ ุฐูู ุ ูู ูุนุฏ ุจุฅููุงูู ุงุณุชุฎุฏุงู ValueTask / ValueTask &lt;TResult&gt;. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุฎุชุตุงุฑ ุ ุงููุงุนุฏุฉ ูู: ุนูุฏ ุงุณุชุฎุฏุงู ValueTask / ValueTask &lt;ุงููุชูุฌุฉ&gt; ูุฌุจ ุนููู ุฅูุง ุฃู ุชูุชุธุฑูุง ูุจุงุดุฑุฉ (ุฑุจูุง ุจุงุณุชุฎุฏุงู .ConfigureAwait (false)) ุฃู ุงูุงุชุตุงู ุจู AsTask () ูุนุฏู ุงุณุชุฎุฏุงููุง ุจุนุฏ ุงูุขู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//   ,  ValueTask&lt;int&gt; public ValueTask&lt;int\&gt; SomeValueTaskReturningMethodAsync(); ... // GOOD int result = await SomeValueTaskReturningMethodAsync(); // GOOD int result = await SomeValueTaskReturningMethodAsync().ConfigureAwait(false); // GOOD Task&lt;int&gt; t = SomeValueTaskReturningMethodAsync().AsTask(); // WARNING ValueTask&lt;int&gt; vt = SomeValueTaskReturningMethodAsync(); //       , //     // BAD: await   ValueTask&lt;int&gt; vt = SomeValueTaskReturningMethodAsync(); int result = await vt; int result2 = await vt; // BAD: await  (    ) ValueTask&lt;int&gt; vt = SomeValueTaskReturningMethodAsync(); Task.Run(async () =&gt; await vt); Task.Run(async () =&gt; await vt); // BAD:  GetAwaiter().GetResult(),     ValueTask&lt;int&gt; vt = SomeValueTaskReturningMethodAsync(); int result = vt.GetAwaiter().GetResult();</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ููุท ูุชูุฏู ุขุฎุฑ ูููู ูููุจุฑูุฌูู ุชุทุจููู ุ ููุง ุขูู ุ ููุท ุจุนุฏ ุงูููุงุณ ุงูุฏููู ูุงููุฒุงูุง ุงููุงูุฉ.  ุชุญุชูู ูุฆุงุช ValueTask / ValueTask &lt;TResult&gt; ุนูู ุงูุนุฏูุฏ ูู ุงูุฎุตุงุฆุต ุงูุชู ุชุจูุบ ุนู ุงูุญุงูุฉ ุงูุญุงููุฉ ููุนูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชููู ุฎุงุตูุฉ IsCompleted ุจุฅุฑุฌุงุน true ุฅุฐุง ูุงูุช ุงูุนูููุฉ ููุชููุฉ (ุฃู ุ ูู ุชุนุฏ ุชุนูู ุจูุฌุงุญ ุฃู ูู ุชูุฌุญ ุจูุฌุงุญ) ุ ูุฅุฑุฌุงุน ุงูุฎุงุตูุฉ IsCompletedSuccessfully true ุ ููุท ุฅุฐุง ุชู ุฅููุงููุง ุจูุฌุงุญ (ุฃุซูุงุก ุงูุชุธุงุฑ ุงููุชูุฌุฉ ูุชููููุง ุ ูุฅููุง ูู ุชุฑู ุงุณุชุซูุงุกู).  ููุญุตูู ุนูู ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูุฃูุซุฑ ุชุทูุจูุง ููุชูููุฐ ุ ุญูุซ ูุฑุบุจ ุงููุทูุฑ ูู ุชุฌูุจ ุงูุชูุงููู ุงูุชู ุชูุดุฃ ูู ุงููุถุน ุบูุฑ ุงููุชุฒุงูู ุ ูููู ุงูุชุญูู ูู ูุฐู ุงูุฎุตุงุฆุต ูุจู ุฃู ุชููู ุนูููุฉ ูุนููุฉ ุจุชุฏููุฑ ูุงุฆู ValueTask / ValueTask &lt;TResult&gt; ุ ุนูู ุณุจูู ุงููุซุงู ุ await ุ .AsTask ().  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุชุทุจูู SocketsHttpHandler ูู .NET Core 2.1 ุ ููุฑุฃ ุงูุฑูุฒ ูู ุงูุงุชุตุงู ููุชููู ValueTask &lt;int&gt;.  ุฅุฐุง ุชู ุชูููุฐ ูุฐู ุงูุนูููุฉ ุจุดูู ูุชุฒุงูู ุ ููุง ุฏุงุนู ููููู ุจุดุฃู ุงูุฅููุงุก ุงููุจูุฑ ููุนูููุฉ.  ูููู ุฅุฐุง ุชู ุชุดุบููู ุจุดูู ุบูุฑ ูุชุฒุงูู ุ ููุฌุจ ุนูููุง ุฑุจุท ูุนุงูุฌุฉ ุงูููุงุทุนุฉ ุจุญูุซ ููุทุน ุทูุจ ุงูููุงุทุนุฉ ุงูุงุชุตุงู.  ูุธุฑูุง ูุฃู ูุฐุง ุฌุฒุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุฌูุฏุฉ ููุบุงูุฉ ุ ุฅุฐุง ุฃุธูุฑ ุงูุชูุตูู ุงูุญุงุฌุฉ ุฅูู ุงูุชุบููุฑ ุงูุจุณูุท ุงูุชุงูู ุ ููููู ุชูุธููู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">int bytesRead; { ValueTask&lt;int&gt; readTask = _connection.ReadAsync(buffer); if (readTask.IsCompletedSuccessfully) { bytesRead = readTask.Result; } else { using (_connection.RegisterCancellation()) { bytesRead = await readTask; } } }</code> </pre> <br><h4 id="dolzhen-li-kazhdyy-novyy-metod-asinhronnogo-api-vozvraschat-valuetaskvaluetasktresult" style=";text-align:right;direction:rtl">  ูู ูุฌุจ ุนูู ูู ุทุฑููุฉ API ุบูุฑ ูุชุฒุงููุฉ ุฌุฏูุฏุฉ ุฅุฑุฌุงุน ValueTask / ValueTask &lt;TResult&gt;ุ </h4><br><p style=";text-align:right;direction:rtl">  ููุฅุฌุงุจุฉ ููุชุฑุฉ ูุฌูุฒุฉ: ูุง ุ ุจุดูู ุงูุชุฑุงุถู ุ ูุง ูุฒุงู ุงูุฃูุฑ ูุณุชุญู ุงุฎุชูุงุฑ ุงููููุฉ / ุงููููุฉ &lt;ุงููุชูุฌุฉ&gt;. <br>  ููุง ูู ููุถุญ ุฃุนูุงู ุ ูุฅู ุงูููุงู ูุงูููุงู &lt;TResult&gt; ุฃุณูู ูู ุงูุงุณุชุฎุฏุงู ุจุดูู ุตุญูุญ ูู ValueTask ู ValueTask &lt;TResult&gt; ุ ูุทุงููุง ุฃู ูุชุทูุจุงุช ุงูุฃุฏุงุก ูุง ุชููู ูุชุทูุจุงุช ุงูุชุทุจูู ุงูุนููู ุ ูุฅู ุงูููุงู ูุงูููุงู &lt;TResult&gt; ูู ุงูููุถูุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ุชูุงููู ุตุบูุฑุฉ ูุฑุชุจุทุฉ ุจุฅุฑุฌุงุน ValueTask &lt;TResult&gt; ุจุฏูุงู ูู Task &lt;TResult&gt; ุ ุฃู ุ ุชุธูุฑ ุงูููุงููุณ ุงูุฏูููุฉ ุฃู ุงูุชุธุงุฑ ุงููููุฉ &lt;TResult&gt; ุฃุณุฑุน ูู ุงูุชุธุงุฑ ValueTask &lt;TResult&gt;.  ูุฐุง ุ ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุชุฎุฒูู ุงููุคูุช ููููุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชูุฑุฌุน ุงูุทุฑููุฉ "ูููุฉ" ุฃู "ูููุฉ" ุ ุญูุซ ุฅู ุงูุฃุฏุงุก ูุณุชุญู ุงูุฃูุฑ ูุน ุงููููุฉ ุฃู ุงููููุฉ.  ุชุดุบู ูุงุฆูุงุช ValueTask / ValueTask &lt;TResult&gt; ุนุฏุฉ ูููุงุช ูู ุงูุฐุงูุฑุฉ ุ ูุฐูู ุ ุนูุฏูุง ูููู ูุชููุนูุง ูุญููููุง ูุญุฌูุฒุฉ ูู ุฌูุงุฒ ุงูุญุงูุฉ ุงูุฐู ูุณุชุฏุนู ุงูุฃุณููุจ ุบูุฑ ุงููุชุฒุงูู ุ ูุฅููุง ุณุชุดุบู ุงููุฒูุฏ ูู ุงูุฐุงูุฑุฉ ููู. <br></p><p style=";text-align:right;direction:rtl">  - ValueTask/ValueTask&lt;TResult&gt;    : )  ,        await, )        , )     ,          .   ,                /  . </p><br><h4 id="chto-dalshe-s-valuetask-i-valuetasktresult" style=";text-align:right;direction:rtl">    ValueTask  ValueTask&lt;TResult&gt;? </h4><br><p style=";text-align:right;direction:rtl">    .NET      ,  Task/Task&lt;TResult&gt;,  ,  ValueTask/ValueTask&lt;TResult&gt;,     ,   .      โ   IAsyncEnumerator&lt;T&gt;,     .NET Core 3.0. IEnumerator&lt;T&gt;   MoveNext,   bool,     IAsyncEnumerator&lt;T&gt;   MoveNextAsync.     , ,     Task,             . ,   ,       ,        (           ),        await   foreach,      ValueTask.        ,         .      C#   ,    ,     ,   . </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458828/">https://habr.com/ru/post/ar458828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458812/index.html">JVM TI: ููููุฉ ุฌุนู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ ูุฌูุงุฒ ุงูุธุงูุฑู</a></li>
<li><a href="../ar458814/index.html">ุฅุทูุงู ูููุน ูููุชุฌ ุฐู ุทูุจ ุบูุฑ ูุดูุจ</a></li>
<li><a href="../ar458818/index.html">ุฃุจุฑุฒ ุงููุนุงุตุฑูู</a></li>
<li><a href="../ar458820/index.html">ุญูู ุชูููุฐ ูุฐุง ุงูููุน ุงูุดููุฑ ุนูู ููุตุฉ Minecraft</a></li>
<li><a href="../ar458826/index.html">ููููุฉ ุงูุชุฎูุต ูู ุงูููุงุฏ ุงููุฏููุฉ ุจุญูุซ ุชููู ุจุดูู ุญุงุฏ ูู ุงูุนุถููุฉ: + 104 ูช ูู ุญุฑูุฉ ุงููุฑูุฑ ููุฏุฉ ุณุชุฉ ุฃุดูุฑ</a></li>
<li><a href="../ar458830/index.html">ูุฏูุงุช ุชูููุงุช Dell ุนุจุฑ ุงูููุจ: ุฌููุน ุชูุงุตูู ุจุฑูุงูุฌูุง ุงูุชุนูููู</a></li>
<li><a href="../ar458832/index.html">ุฎูุณุฉ ุทูุงุจ ูุซูุงุซุฉ ูุชุงุฌุฑ ุฑุฆูุณูุฉ ุฐุงุช ูููุฉ</a></li>
<li><a href="../ar458834/index.html">ุฌุงูุจ ูู ุดุฎุตูุฉ ุจูู ุฃููู ุ ุงูุฐู ูู ูุนุฑู ุนูู ุงููุซูุฑ ูู ุงููุงุณ</a></li>
<li><a href="../ar458836/index.html">ูุคุดุฑ ุจูุฑุด. ูููุฌูุฉ ูููุฌูุฉ ูุชูููู ูููุงุฑูุฉ ูุชุญุฏูุฏ ูุณุจุฉ ุงูุณุนุฑ / ุงูุฌูุฏุฉ</a></li>
<li><a href="../ar458840/index.html">ููู ุงุฎุชุฑูุง ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุตููู ุงูุนุธูู (ุงูุฌุฒุก ุงูุซุงูู)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>