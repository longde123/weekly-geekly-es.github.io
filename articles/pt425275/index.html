<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔪 💻 👨🏾‍🎨 12 dicas para dimensionar o Node.js 🤸🏻 🏏 👩🏿‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Node.js já está operando com sucesso em escala global, conforme evidenciado pelos aplicativos implantados nele de empresas como Netflix, Reddit, Wal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>12 dicas para dimensionar o Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425275/">  O Node.js já está operando com sucesso em escala global, conforme evidenciado pelos aplicativos implantados nele de empresas como Netflix, Reddit, Walmart e Ebay.  No entanto, ele tem seu próprio conjunto de problemas ao dimensionar;  do ponto de vista do dimensionamento de pessoas que trabalham em uma única base de código; portanto, do ponto de vista do dimensionamento vertical e horizontal na nuvem.  Além da minha experiência pessoal com o dimensionamento do Node.js. para empresas como Reddit e Netflix, conversei com alguns especialistas do Microsoft Azure e criei algumas dicas para você sobre o dimensionamento do Node.js. para sua empresa. <br><a name="habracut"></a><br><h3>  Escreva um Node.js de qualidade </h3><br>  Quanto mais cedo você começar a usar linters, formatação e ferramentas de verificação de tipo no seu código, melhor. <br><br>  Pode ser complicado introduzir essas coisas no meio de um projeto devido à quantidade potencialmente grande de refatoração que pode ser necessária, mas também pode poluir seu histórico de git, mas no final essas ferramentas ajudarão você a tornar o código legível. <br>  Se você ainda não os usa, volte imediatamente os olhos para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ESLint</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prettier</a> .  O ESLint protegerá seu código de padrões incorretos, o Prettier o ajudará a formatar seu código automaticamente antes da solicitação de recebimento. <br><br>  Uma solução mais substancial é adicionar ferramentas como Flow ou TypeScript à sua base de código.  Essas ferramentas permitem capturar erros mais sutis, como chamar uma função com um parâmetro numérico em vez de uma string ou chamar o método <b>.filter</b> em objetos em vez de uma matriz.  Apesar da complexidade e da necessidade de treinar sua equipe, essas ferramentas merecem sua atenção: elas podem acelerar o desenvolvimento com o Intellisense e evitar erros de tempo de execução com proteção de tipo. <br><br><h3>  Escrever testes </h3><br>  Os testes sempre foram um problema difícil para os desenvolvedores.  Alguns acreditam firmemente no desenvolvimento orientado a testes, enquanto outros raramente escrevem testes.  Mas existe um meio termo: <br><br><ul><li>  <b>Defina os módulos principais</b> e escreva testes de unidade abrangentes para eles.  Preste atenção especial às “jornadas felizes”: casos extremos e cenários em que os erros podem potencialmente ocorrer.  Para outros módulos, escreva um ou dois testes de unidade cobrindo “caminhos felizes” e possivelmente casos comuns que você pode ter descoberto </li><li>  <b>Teste mínimo de interface do usuário</b> .  A interface do usuário está constantemente mudando e geralmente é impraticável gastar muito tempo fazendo testes de código que mudam com frequência. <br></li><li>  <b>Escreva testes para detectar erros</b> .  Sempre que você encontrar e corrigir um erro no seu código, escreva um teste de unidade que detectará esse erro no futuro. <br></li><li>  <b>Faça alguns testes de integração</b> para garantir que todas as peças coincidam. <br></li><li>  <b>Faça ainda menos testes de ponta a ponta</b> .  Cubra os principais caminhos do seu site, por exemplo, se você estiver criando um site de comércio eletrônico, pode valer a pena fazer um teste para entrar no site, adicioná-lo à cesta e verificar a lista de produtos.  Esses testes são caros de manter; portanto, considere manter um pequeno núcleo de testes que você possa motivar a manter. <br></li></ul><br>  O ponto de partida para escrever testes é a capacidade de implantar com segurança um novo código.  Escreva tantos testes que não haja menos do que você sente, mas tente escrever não mais do que a lista acima. <br><br><h3>  Design sem estado </h3><br>  A chave ao escrever o Node.js escalável é que seus servidores não precisam armazenar estados para alguém ou algo.  Isso impedirá o dimensionamento horizontal.  Mova o estado para outro aplicativo e resolva o problema em outro lugar (por exemplo, Redis, Etcd, ...).  Você deve pensar sobre isso com antecedência.  Será muito difícil desvendar se você não fez isso antes.  Também ajudará se você decidir decompor monólitos em microsserviços. <br><br><h3>  Estatísticas: para desenvolvimento - Node.js, para produção - CDN </h3><br>  Como eu gostaria que as empresas vissem um erro nesse erro.  Servir seus ativos estáticos do seu aplicativo Web (em particular, através de algo como webpack-dev-server ou servidor de desenvolvimento Parsel) é uma ótima experiência para desenvolvedores, pois reduz o ciclo de introdução ao escrever código.  No entanto, você nunca deve servir suas estatísticas através do Node.js.  Ele deve ser enviado separadamente por meio de uma CDN, como uma CDN do Azure. <br><br>  Os retornos estáticos com o Node.js são desnecessariamente lentos porque as CDNs são mais dispersas e, portanto, fisicamente mais próximas do usuário final, e os servidores da CDN são altamente otimizados para recursos pequenos.  Manter estática no Node também é excessivamente caro, pois o tempo do servidor Node.js. é muito mais caro que o tempo do servidor CDN. <br><br><h3>  Comece a implantar cedo, implante com mais frequência </h3><br>  Eu não te conheço, mas quando desbloqueio algo pela primeira vez, isso nunca funciona.  Isso geralmente ocorre porque esqueci de enviar as chaves privadas corretas ou codifiquei o caminho para o host local.  Pequenos problemas que trabalham localmente remotamente se recusam a fazer isso.  Esses problemas podem se acumular, e o que poderia ser facilmente resolvido antes, se, é claro, cedo para encontrá-los, pode se transformar em um enorme grupo de erros incompreensíveis que simplesmente não podem ser detectados normalmente. <br><br>  A propósito, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Visual Studio Code permite que você resolva esse tipo de problema</a> .  Ele permite implantar seu aplicativo diretamente no Azure com um clique.  Essa é uma maneira bastante simples de verificar se não há problemas para implantar em outro ambiente. <br><br><h3>  Implante 2 servidores de uma só vez </h3><br>  Esse conselho vem do meu conhecimento conquistado com muito esforço e de um mar de mágoa.  A essência do conselho é que existem poucas diferenças entre a implantação de dois servidores e dez servidores, e não há muita diferença entre a implantação de dez servidores e cem servidores.  No entanto, existe simplesmente uma enorme diferença entre implantar um servidor e dois servidores. <br>  Semelhante à questão da implantação de servidores sem estado, começando com dois servidores, você pode superar rapidamente seus problemas de escala horizontal para que, quando houver um aumento acentuado no tráfego, você esteja pronto para escalar. <br><br><h3>  Não tenha medo de linhas </h3><br>  Os bancos de dados modernos lidam com uma certa quantidade de leitura e gravação por conta própria, sem a sua ajuda.  Ao testar sua ideia, fique à vontade para confiar no seu banco de dados para lidar com cargas de trabalho pequenas e médias. <br><br>  O dimensionamento prematuro tem mais chances de matá-lo do que salvá-lo.  Mas, em algum momento, seu aplicativo crescerá e você também não poderá gravar tudo no banco de dados, diante de problemas de largura de banda de leitura e gravação.  Para alguns aplicativos que possuem um registro leve, ou se você selecionar um banco de dados como o Cassandra, que lida sozinho com uma escala massiva, isso será um problema mais tarde, para outros será mais cedo. <br><br>  Se você tiver ou terá esse problema em breve, terá opções para escolher as tecnologias com as quais irá adiante.  Uma dessas tecnologias pode ser a fila de mensagens.  O padrão atual no momento é o Apache Kafka, que permite organizar suas mensagens em tópicos e, em seguida, aplicativos para assinar este tópico.  Assim, por exemplo, você pode acumular mensagens no aplicativo, ouvindo um determinado tópico e, em seguida, gravar em lote dados no banco de dados para que não obstruam o tempo todo.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Além disso, o Kafka é executado facilmente no Azure</a> . <br><br><h3>  Microsserviços para dimensionamento </h3><br>  À medida que seu aplicativo cresce, divisões lógicas naturais começam a aparecer.  Uma parte do aplicativo pode processar pagamentos, enquanto a outra parte servirá a API para o seu front-end.  Ao fazer divisões lógicas, considere fazê-las separar microsserviços.  Mas tenha cuidado, pois a introdução de microsserviços também é repleta de grande complexidade.  Mas vale a pena.  Assim, por exemplo, cada microsserviço pode ter sua própria métrica.  Ao avaliá-los, você pode escalá-los independentemente. <br><br><h3>  Use recipientes </h3><br>  Seu aplicativo pode funcionar bem localmente, mas pode haver sérios problemas ao tentar implantar.  Ferramentas como Docker e Kubernetes funcionarão para você evitar esse problema.  Docker, que você pode imaginar como uma mini-instância (contêiner) do Linux ou Windows, na qual você pode executar o aplicativo;  e Kubernetes como uma ferramenta que conecta todos os seus contêineres na nuvem. <br><br>  Kubernetes pode ser um animal complexo, mas um animal que resolve um problema complexo.  Se você é um feiticeiro inexperiente do DevOps, pode ter dificuldades, por isso recomendo começar com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rascunho</a> .  Se você estiver familiarizado com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Yeoman</a> para projetos Javascript, poderá avaliar o Rascunho como uma ferramenta semelhante, mas para projetos Kubernetes: uma ferramenta que cria uma estrutura de arame para o seu projeto.  A partir daí, você pode usar a ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Helm</a> para instalar partes adicionais da arquitetura que você precisa construir (por exemplo, nginx, mais Node.js, MongoDB, servidores Kafka etc.), quase como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm</a> para o Kubernetes. <br><br>  Assim que você entender o ecossistema Kubernetes, a partir de agora, a implantação na nuvem se tornará um jogo infantil. <br><br><h3>  Coletar métricas </h3><br>  Se você não souber responder à pergunta "Como meu aplicativo funciona?", Você terá problemas ou eles em breve.  Afinal, vários tipos de indicadores ao longo do tempo ajudarão você a melhorar constantemente o estado do seu aplicativo.  Do ponto de vista dos custos para o futuro, e do ponto de vista da conveniência do usuário em termos de melhoria do tempo de resposta.  Você definitivamente deve acompanhar as métricas, como caminhos lentos, visualizações de página, tempo de sessão e outras métricas importantes que são importantes para os seus negócios. <br><br>  Existem muitas maneiras de coletar esses indicadores.  Serviços como New Relic e AppDynamics fornecerão informações valiosas sobre como melhorar seu aplicativo. <br><br>  Se você trabalha com o Azure, o Application Insights também atende a essa necessidade e também é fácil conectar outras ferramentas, como CI / CD. <br><br><h3>  O CI / CD salvará você de tanta dor </h3><br>  Quantas vezes você estragou a implantação durante o FTP e desativou o servidor por vários minutos?  Foi comigo.  Você nunca deve confiar em si mesmo na implantação do código de produção.  Como fazer isso usando o Visual Studio Code é muito legal, mas é principalmente para fins de desenvolvimento ou demonstração.  Quando você estiver pronto para criar um sistema em nível de produção, use a integração e a implantação contínuas (geralmente abreviado como CI / CD - integração e implantação contínuas). <br><br>  A integração contínua é a prática do desenvolvimento de software, que consiste na fusão de cópias de trabalho em um ramo principal comum do desenvolvimento várias vezes ao dia e na realização de montagens automatizadas frequentes do projeto para identificar rapidamente possíveis defeitos e resolver problemas de integração. <br><br>  A implantação contínua cuida de levar seu código que passou no IC, executando as etapas necessárias para compilar, contêiner ou empacotá-los e enviá-los ao servidor.  É uma boa prática ter vários níveis para testar.  Você pode primeiro acessar o servidor de desenvolvimento interno para vê-lo em um ambiente de baixo risco.  Você pode testá-lo primeiro antes de enviá-lo para um ambiente de controle de qualidade em que seus engenheiros de controle de qualidade ou possivelmente um serviço externo confirmarão que tudo está funcionando conforme o esperado.  A partir daí, você pode ir para um ambiente intermediário no qual seu aplicativo ainda é apenas interno, mas funciona usando dados e configurações de produção, para que você possa testá-lo no próprio ambiente de produção antes de enviá-lo diretamente para produção.  Você também pode selecionar um pequeno grupo de servidores para verificar o novo código: você e direciona apenas uma pequena porcentagem de tráfego real a esses servidores para garantir que nada ocorra ao trabalhar com usuários reais.  Se quebrar, você sabe onde procurar o problema.  Caso contrário, você pode passar de um pequeno grupo de usuários para todos. <br><br>  Muitos fornecedores e projetos de código aberto atendem a essas necessidades.  Jenkins, Travis e CircleCI são ótimas opções para o IC.  O Azure tem seu próprio serviço de CI / CD chamado Azure Pipelines e é bastante intuitivo de usar e, novamente, se conecta facilmente ao ecossistema integrado do Azure. <br><br><h3>  Mantenha segredos </h3><br>  Qualquer aplicativo inevitavelmente tem alguns segredos.  Pode ser chaves e linhas secretas de credenciais, bancos de dados e muito mais.  Seria muito ruim se eles se voltassem para as mãos erradas.  No entanto, eles são necessários para executar o aplicativo.  Então o que fazemos?  Normalmente, no desenvolvimento, usaremos ferramentas como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dotenv</a> para salvar o arquivo de configuração localmente e poder lê-lo através do process.env no Node.js.  Isso é ótimo para desenvolvedores, mas é péssimo para produção. <br><br>  Em vez disso, é útil usar algum tipo de ferramenta de gerenciamento secreto.  Felizmente, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kubernetes possui um sistema embutido</a> e é bastante simples de usar.  Você fornece segredos do Kubernetes no lado do contêiner e, em seguida, ele os fornece ao seu aplicativo como um ambiente que complica bastante o ataque. <br><br>  Outra ferramenta digna de sua atenção é o Azure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Key Vault</a> .  O que é interessante sobre o Key Vault, mesmo que a Microsoft não possa ler suas chaves (somente você pode descriptografá-las), o Azure acompanhará seus logs e acompanhará quaisquer usos duvidosos de suas chaves para alertá-lo sobre quaisquer compromissos. <br><br><h3>  Conclusão </h3><br>  O Node.js, como qualquer outra plataforma, precisa ser escalado.  E, como qualquer outra plataforma, possui tarefas próprias e a peculiaridade de dimensionamento, que vale a pena conhecer e que devem ser levadas em consideração ao projetar grandes projetos. <br><br>  Artigo original: “Onze dicas para escalar o Node.js” ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pt</a> ). <br><br>  Sugiro nos comentários para compartilhar dicas que você pode dar sobre o dimensionamento do Node.js.  Será interessante ouvir. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt425275/">https://habr.com/ru/post/pt425275/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt425265/index.html">Regras de desenvolvimento no Yandex.Health</a></li>
<li><a href="../pt425267/index.html">Local de trabalho do desenvolvedor .NET ou dificuldades em escolher a configuração ideal ver.2.0</a></li>
<li><a href="../pt425269/index.html">Hackathon GAZ - como tocar o gigante dos automóveis</a></li>
<li><a href="../pt425271/index.html">WPA3 poderia ser mais seguro: opinião de especialistas</a></li>
<li><a href="../pt425273/index.html">Outra maneira de usar o docker-compose</a></li>
<li><a href="../pt425279/index.html">Como entrevistar o Google: o que ser, o que não passar</a></li>
<li><a href="../pt425281/index.html">Diretrizes para trazer "à condição" um clone do popular mini-roteador chinês Hame A15, também conhecido como "sem marca A5-V11"</a></li>
<li><a href="../pt425283/index.html">Localização infinita ou como traduzimos um mapa em tempo real</a></li>
<li><a href="../pt425285/index.html">Se você não contrata o Jones, não merece os senhores</a></li>
<li><a href="../pt425287/index.html">Casas FIAS no PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>