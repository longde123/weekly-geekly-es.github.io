<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌗 🏨 ◀️ Injeksi ketergantungan hirarkis dalam React dan MobX State Tree sebagai model domain 👩🏼‍🏫 👃🏾 🍏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah beberapa proyek tentang Bereaksi, saya memiliki kesempatan untuk mengerjakan aplikasi di bawah Angular 2. Terus terang, saya tidak terkesan. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Injeksi ketergantungan hirarkis dalam React dan MobX State Tree sebagai model domain</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431942/"><p><img src="https://habrastorage.org/webt/78/ou/57/78ou57kbv7kdv7llnfl-_cwmxpw.png" align="left">  Setelah beberapa proyek tentang Bereaksi, saya memiliki kesempatan untuk mengerjakan aplikasi di bawah Angular 2. Terus terang, saya tidak terkesan.  Tapi satu hal yang diingat - mengelola logika dan keadaan aplikasi menggunakan Dependency Injection.  Dan saya bertanya-tanya apakah nyaman untuk mengelola keadaan Bereaksi menggunakan DDD, arsitektur berlapis, dan injeksi ketergantungan? </p><br><p>  Jika Anda tertarik untuk melakukan ini, dan yang paling penting, mengapa - selamat datang di cut! </p><a name="habracut"></a><br><p> Sejujurnya, bahkan di backend, DI jarang digunakan sepenuhnya.  Kecuali dalam aplikasi yang sangat besar.  Dan dalam ukuran kecil dan menengah, bahkan dengan DI, setiap antarmuka biasanya hanya memiliki satu implementasi.  Tetapi ketergantungan injeksi masih memiliki kelebihan: </p><br><ul><li>  Kode terstruktur lebih baik, dan antarmuka bertindak sebagai kontrak eksplisit. </li><li>  Pembuatan rintisan dalam unit test disederhanakan. </li></ul><br><p>  Tetapi pustaka pengujian modern untuk JS, seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jest</a> , memungkinkan Anda untuk menulis moki hanya berdasarkan pada sistem ES6 modular.  Jadi di sini kita tidak akan mendapat banyak keuntungan dari DI. </p><br><p>  Poin kedua tetap - pengelolaan ruang lingkup dan masa objek.  Di server, masa pakai biasanya terikat ke seluruh aplikasi (Singleton), atau ke permintaan.  Dan pada klien, unit kode utama adalah komponen.  Kami akan melekat padanya. </p><br><p> Jika kita perlu menggunakan status pada level aplikasi, cara termudah adalah mengatur variabel pada level modul ES6 dan mengimpornya jika perlu.  Dan jika keadaan hanya diperlukan di dalam komponen - kita cukup letakkan di <strong><code>this.state</code></strong> .  Untuk yang lainnya, ada <strong><code>Context</code></strong> .  Tetapi tingkat terlalu rendah: </p><br><ul><li>  Kami tidak dapat menggunakan konteks di luar pohon komponen React.  Misalnya, dalam lapisan logika bisnis. </li><li>  Kami tidak dapat menggunakan lebih dari satu konteks di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code><strong>Class.contextType</strong></code></a> .  Untuk menentukan ketergantungan pada beberapa layanan yang berbeda, kita harus membangun "piramida horor" dengan cara baru: </li></ul><br><img src="https://habrastorage.org/webt/as/4r/2n/as4r2ncj0zh_2dmpoxbuahkio74.png"><br><br><p>  Hook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code><strong>useContext()</strong></code></a> sedikit memperbaiki situasi untuk komponen fungsional.  Tapi kami tidak akan menyingkirkan banyak <strong><code>&lt;Context.Provider&gt;</code></strong> .  Hingga kami mengubah konteks kami menjadi Pencari Layanan, dan komponen induknya menjadi Root Komposisi.  Tapi ini tidak jauh dari DI, jadi mari kita mulai! </p><br><blockquote>  Anda dapat melewati bagian ini dan langsung ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">deskripsi arsitektur.</a> </blockquote><br><h2 id="realizaciya-mehanizma-di">  Implementasi mekanisme DI </h2><br><p>  Pertama kita perlu Konteks Bereaksi: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InjectorContext= React.createContext(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br><p>  Karena Bereaksi menggunakan konstruktor komponen untuk kebutuhannya, kami akan menggunakan Injeksi Properti.  Untuk melakukan ini, tentukan dekorator <strong><code>@inject</code></strong> , yang: </p><br><ul><li>  menyetel properti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code><strong>Class.contextType</strong></code></a> , </li><li>  mendapat jenis ketergantungan </li><li>  menemukan objek <strong><code>Injector</code></strong> dan menyelesaikan ketergantungan. </li></ul><br><div class="spoiler">  <b class="spoiler_title">inject.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"reflect-metadata"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, key</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  static cotextType target.constructor.contextType = InjectorContext; //    const type = Reflect.getMetadata("design:type", target, key); //  property Object.defineProperty(target, key, { configurable: true, enumerable: true, get() { //  Injector       const instance = getInstance(getInjector(this), type); Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); return instance; }, // settet     Dependency Injection set(instance) { Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); } }); }</span></span></code> </pre> </div></div><br><p>  Sekarang kita dapat mendefinisikan dependensi antara kelas-kelas yang berubah-ubah: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; @inject bar: BarService; }</code> </pre> <br><p>  Bagi mereka yang tidak menerima dekorator, kami mendefinisikan fungsi <strong><code>inject()</code></strong> dengan tanda tangan ini: </p><br><pre> <code class="javascript hljs">type Constructor&lt;T&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (...args: any[]) =&gt; T; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target: Object, type: Constructor&lt;T&gt; | Function</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">inject.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, keyOrType</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFunction(keyOrType)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getInstance(getInjector(target), keyOrType); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><p>  Ini akan memungkinkan Anda untuk menentukan dependensi secara eksplisit: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); bar = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, BarService); <span class="hljs-comment"><span class="hljs-comment">//   static contextType = InjectorContext; }</span></span></code> </pre> <br><p>  Bagaimana dengan komponen fungsional?  Bagi mereka, kami dapat menerapkan Hook <strong><code>useInstance()</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">hooks.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useRef, useContext } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ref = useRef(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> injector = useContext(InjectorContext); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ref.current || (ref.current = getInstance(injector, type)); }</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MyComponent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> foo = useInstance(FooService); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bar = useInstance(BarService); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br><p>  Sekarang kita akan menentukan seperti apa tampilan <strong><code>Injector</code></strong> kita, bagaimana menemukannya, dan bagaimana menyelesaikan dependensi.  Injektor harus berisi referensi ke induk, cache objek untuk dependensi yang sudah diselesaikan, dan kamus aturan untuk yang belum diselesaikan. </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">type Binding = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector: Injector</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> abstract <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Injector _parent?: Injector; //    _bindingMap: Map&lt;Function, Binding&gt;; //      _instanceMap: Map&lt;Function, Object&gt;; }</span></span></code> </pre> </div></div><br><p>  Untuk komponen Bereaksi, <strong><code>Injector</code></strong> tersedia melalui bidang <strong><code>this.context</code></strong> , dan untuk kelas dependensi, kita dapat sementara menempatkan <strong><code>Injector</code></strong> dalam variabel global.  Untuk mempercepat pencarian injektor untuk setiap kelas, kami akan menembolokkan tautan ke <strong><code>Injector</code></strong> di bidang tersembunyi. </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INJECTOR = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__injector__"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentInjector = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInjector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> injector = target[INJECTOR]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } injector = currentInjector || target.context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Injector) { target[INJECTOR] = injector; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> </div></div><br><p>  Untuk menemukan aturan pengikatan tertentu, kita perlu naik pohon injector menggunakan fungsi <strong><code>getInstance()</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> instance = injector._instanceMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> binding = injector._bindingMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (binding) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prevInjector = currentInjector; currentInjector = injector; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { instance = binding(injector); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { currentInjector = prevInjector; } injector._instanceMap.set(type, instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } injector = injector._parent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; }</code> </pre> </div></div><br><p>  Akhirnya, mari beralih ke mendaftarkan dependensi.  Untuk melakukan ini, kita memerlukan <strong><code>provider()</code></strong> HOC <strong><code>provider()</code></strong> , yang mengambil array binding ketergantungan untuk implementasinya, dan mendaftarkan <strong><code>Injector</code></strong> baru melalui <strong><code>InjectorContext.Provider</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bindingMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); addBindings(bindingMap, definitions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Provider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span></span>{ _parent = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context; _bindingMap = bindingMap; _instanceMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;InjectorContext.Provider value={this}&gt; &lt;Wrapped {...this.props} /&gt; &lt;/InjectorContext.Provider&gt; ); } static contextType = InjectorContext; static register(...definitions) { addBindings(bindingMap, definitions); } }; };</code> </pre> </div></div><br><p>  Dan juga, satu set fungsi yang mengikat yang menerapkan berbagai strategi untuk membuat instance ketergantungan. </p><br><div class="spoiler">  <b class="spoiler_title">bindings.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toClass = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(); if (!instance[INJECTOR]) { instance[INJECTOR] = injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toFactory = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">depsOrFactory, factory</span></span></span><span class="hljs-function">) =&gt;</span></span> asBinding( factory ? <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> factory(...depsOrFactory.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type))) : depsOrFactory ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toExisting = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type)); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toValue = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> value); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IS_BINDING = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__binding__"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asBinding</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">binding</span></span></span><span class="hljs-function">) </span></span>{ binding[IS_BINDING] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binding; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBindings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bindingMap, definitions</span></span></span><span class="hljs-function">) </span></span>{ definitions.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">definition</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token, binding; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(definition)) { [token, binding = token] = definition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { token = binding = definition; } bindingMap.set(token, binding[IS_BINDING] ? binding : toClass(binding)); }); }</code> </pre> </div></div><br><p>  Sekarang kita dapat mendaftarkan ikatan ketergantungan pada tingkat komponen arbitrer dalam bentuk seperangkat pasangan <strong><code>[&lt;&gt;, &lt;&gt;]</code></strong> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, toClass, toValue, toFactory, toExisting } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider( <span class="hljs-comment"><span class="hljs-comment">//    [FirstService, toClass(FirstServiceImpl)], //     [SecondService, toValue(new SecondServiceImpl())], //    [ThirdService, toFactory( [FirstService, SecondService], (first, second) =&gt; ThirdServiceFactory.create(first, second) )], //      [FourthService, toExisting(FirstService)] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Atau dalam bentuk singkatan untuk kelas: </p><br><pre> <code class="javascript hljs">@provider( <span class="hljs-comment"><span class="hljs-comment">// [FirstService, toClass(FirstService)] FirstService, // [SecondService, toClass(SecondServiceImpl)] [SecondService, SecondServiceImpl] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Karena masa pakai suatu layanan ditentukan oleh komponen penyedia di mana ia terdaftar, untuk setiap layanan kami dapat mendefinisikan metode pembersihan <strong><code>.dispose()</code></strong> .  Di dalamnya, kita dapat berhenti berlangganan dari beberapa acara, menutup soket, dll.  Saat Anda menghapus penyedia dari DOM, itu akan memanggil <strong><code>.dispose()</code></strong> pada semua layanan yang dibuatnya. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... return class Provider extends Injector { // ... componentWillUnmount() { this._instanceMap.forEach(instance =&gt; { if (isObject(instance) &amp;&amp; isFunction(instance.dispose)) { instance.dispose(); } }); } // ... }; };</span></span></code> </pre> </div></div><br><p>  Untuk memisahkan kode dan pemuatan malas, kita mungkin perlu membalikkan metode pendaftaran layanan dengan penyedia.  Dekorator <strong><code>@registerIn()</code></strong> akan membantu kami dengan ini. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registrationQueue = []; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registerIn = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getProvider, binding</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span> =&gt; { registrationQueue.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { getProvider().register(binding ? [<span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>, binding] : <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>); }); return <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>; };</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (registrationQueue.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { registrationQueue.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">registration</span></span></span><span class="hljs-function"> =&gt;</span></span> { registration(); }); registrationQueue.length = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { registerIn } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { HomePage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../components/HomePage"</span></span>; @registerIn(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> HomePage) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyLazyLoadedService</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><img src="https://habrastorage.org/webt/gu/w5/d-/guw5d-sj0h53wnapsftgqeqnvvg.png"><br><p>  Jadi, untuk 150 baris dan 1 KB kode, Anda dapat menerapkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wadah DI hirarkis yang</a> hampir lengkap. </p><br><h2 id="arhitektura-prilozheniya">  Arsitektur aplikasi </h2><br><p>  Akhirnya, mari kita beralih ke hal utama - bagaimana mengatur arsitektur aplikasi.  Ada tiga opsi yang mungkin, tergantung pada ukuran aplikasi, kompleksitas area subjek dan kemalasan kita. </p><br><h3 id="1-the-ugly">  1. Jelek </h3><br><p>  Kami memiliki DOM Virtual, yang berarti harus cepat.  Setidaknya dengan saus ini, React dihidangkan pada awal karier.  Karena itu, ingat saja tautan ke komponen root (misalnya, menggunakan dekorator <strong><code>@observer</code></strong> ).  Dan kami akan memanggil <strong><code>.forceUpdate()</code></strong> di atasnya setelah setiap tindakan yang mempengaruhi layanan bersama (misalnya, menggunakan dekorator <strong><code>@action</code></strong> ) </p><br><div class="spoiler">  <b class="spoiler_title">observer.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Wrapped</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentDidMount() { observerRef = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } componentWillUnmount() { observerRef = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wrapped</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml">; } } } let observerRef = null;</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">action.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_target, _key, descriptor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> method = descriptor.value; descriptor.value = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result; runningCount++; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = method.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { runningCount--; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runningCount === <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; observerRef) { observerRef.forceUpdate(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> runningCount = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class"> </span></span>{ @action doSomething() {} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject userService: UserService; } @provider(UserService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><p>  Bahkan akan berhasil.  Tapi ... kamu sendiri mengerti :-) </p><br><h3 id="2-the-bad">  2. Yang Buruk </h3><br><p>  Kami tidak puas dengan memberikan semuanya untuk setiap bersin.  Tapi kami masih ingin menggunakannya <del>  hampir </del>  objek dan array reguler untuk menyimpan status.  Ayo ambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MobX</a> ! </p><br><p>  Kami memulai beberapa penyimpanan data dengan tindakan standar: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable, action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span><span class="hljs-class"> </span></span>{ byId = observable.map&lt;number, User&gt;(); @action add(user: User) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.byId.set(user.id, user); } <span class="hljs-comment"><span class="hljs-comment">// ... } export class PostStore { // ... }</span></span></code> </pre> <br><p>  Kami mengeluarkan logika bisnis, I / O, dll. Ke lapisan layanan: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ @inject userStore userStore; @action updateUserInfo(userInfo: Partial&lt;User&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); } }</code> </pre> <br><p>  Dan kami mendistribusikannya ke dalam komponen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(UserStore, PostStore) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{} @provider(AccountService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{} @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject accountService: AccountService; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Hal yang sama berlaku untuk komponen fungsional dan tanpa dekorator</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ userStore = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UserStore); updateUserInfo = action(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userInfo: Partial&lt;User&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); }); }</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react-lite"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = provider(UserStore, PostStore)(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... }); const AccountPage = provider(AccountService)(observer(props =&gt; { // ... })); const UserFrom = observer(props =&gt; { const accountService = useInstance(AccountService); // ... });</span></span></code> </pre> </div></div><br><p>  Hasilnya adalah arsitektur tiga tingkat klasik. </p><br><h3 id="3-the-good">  3. Yang Baik </h3><br><p>  Kadang-kadang area subjek menjadi sangat kompleks sehingga tidak nyaman untuk bekerja dengannya menggunakan objek sederhana (atau model anemia dalam hal DDD).  Ini terutama terlihat ketika data memiliki struktur relasional dengan banyak hubungan.  Dalam kasus seperti itu, perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MobX State Tree</a> datang untuk menyelamatkan, memungkinkan Anda untuk menerapkan prinsip-prinsip Desain Berbasis Domain dalam arsitektur aplikasi front-end. </p><br><p>  Merancang model dimulai dengan deskripsi jenis: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/Post.ts import { types as t, Instance } from "mobx-state-tree"; export const Post = t .model("Post", { id: t.identifier, title: t.string, body: t.string, date: t.Date, rating: t.number, author: t.reference(User), comments: t.array(t.reference(Comment)) }) .actions(self =&gt; ({ voteUp() { self.rating++; }, voteDown() { self.rating--; }, addComment(comment: Comment) { self.comments.push(comment); } })); export type Post = Instance&lt;typeof Post&gt;;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">model / User.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = t.model(<span class="hljs-string"><span class="hljs-string">"User"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: t.string }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type User = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> User&gt;;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">model / Comment.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./User"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Comment = t .model(<span class="hljs-string"><span class="hljs-string">"Comment"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: t.string, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: t.Date, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: t.number, <span class="hljs-attr"><span class="hljs-attr">author</span></span>: t.reference(User) }) .actions(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ voteUp() { self.rating++; }, voteDown() { self.rating--; } })); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type Comment = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Comment&gt;;</code> </pre> </div></div><br><p>  Dan jenis penyimpanan data: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/index.ts import { types as t } from "mobx-state-tree"; export { User, Post, Comment }; export default t.model({ users: t.map(User), posts: t.map(Post), comments: t.map(Comment) });</span></span></code> </pre> <br><p>  Jenis entitas berisi keadaan model domain dan operasi dasar dengannya.  Skenario yang lebih kompleks, termasuk I / O, diterapkan di lapisan layanan. </p><br><div class="spoiler">  <b class="spoiler_title">layanan / DataContext.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Instance, unprotect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> create() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> models = Models.create(); unprotect(models); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> models; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface DataContext extends Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Models&gt; {}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">layanan / AuthService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthService</span></span></span><span class="hljs-class"> </span></span>{ @observable currentUser: User; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">layanan / PostService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Post } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; @inject authService: AuthService; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> publishPost(postInfo: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(postInfo) }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { id } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.savePost(id, postInfo); } @action savePost(id: string, <span class="hljs-attr"><span class="hljs-attr">postInfo</span></span>: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> post = Post.create({ id, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(), <span class="hljs-attr"><span class="hljs-attr">author</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.authService.currentUser.id, <span class="hljs-attr"><span class="hljs-attr">comments</span></span>: [], ...postInfo }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataContext.posts.put(post); } }</code> </pre> </div></div><br><p>  Fitur utama MobX State Tree adalah pekerjaan efisien dengan snapshot data.  Kapan saja, kita bisa mendapatkan status serial entitas apa pun, koleksi, atau bahkan seluruh status aplikasi menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code><strong>getSnapshot()</strong></code></a> .  Dan dengan cara yang sama, kita dapat menerapkan snapshot ke bagian mana pun dari model menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code><strong>applySnapshot()</strong></code></a> .  Ini memungkinkan kita untuk menginisialisasi keadaan dari server dalam beberapa baris kode, memuat dari LocalStorage, atau bahkan berinteraksi dengannya melalui Redux DevTools. </p><br><p>  Karena kita menggunakan model relasional yang dinormalisasi, kita membutuhkan pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">normalizr</a> untuk memuat data.  Ini memungkinkan Anda untuk menerjemahkan pohon JSON ke dalam tabel datar objek yang dikelompokkan berdasarkan <strong><code>id</code></strong> , sesuai dengan skema data.  Hanya dalam format itu Pohon Status MobX diperlukan sebagai snapshot. </p><br><p>  Untuk melakukan ini, tentukan skema objek yang diunduh dari server: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"users"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CommentSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"comments"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">author</span></span>: UserSchema }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PostSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"posts"</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//   - //      author: UserSchema, comments: [CommentSchema] }); export { UserSchema, PostSchema, CommentSchema };</span></span></code> </pre> <br><p>  Dan memuat data ke dalam penyimpanan: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { normalize } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applySnapshot } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; <span class="hljs-comment"><span class="hljs-comment">// ... async loadPosts() { const response = await fetch("/posts.json"); const posts = await response.json(); const { entities } = normalize(posts, [PostSchema]); applySnapshot(this.dataContext, entities); } // ... }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">posts.json</b> <div class="spoiler_text"><pre> <code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"    React"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"  -     React..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hmmm..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> } }] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum dolor sit amet..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Marcus Tullius Cicero"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [] } ]</code> </pre> </div></div><br><p>  Akhirnya, daftarkan layanan dalam komponen yang sesuai: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(AuthService, PostService, [ DataContext, toFactory(DataContext.create) ]) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject postService: PostService; componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postService.loadPosts(); } }</code> </pre> <br><p>  Ternyata semua arsitektur tiga lapis yang sama, tetapi dengan kemampuan untuk mempertahankan negara dan runtime verifikasi tipe data (dalam mode DEV).  Yang terakhir memungkinkan Anda untuk memastikan bahwa jika tidak ada pengecualian terjadi, maka keadaan gudang data sesuai dengan spesifikasi. </p><br><img src="https://habrastorage.org/webt/po/3u/vi/po3uvia2jujcg9q7w1ptr8kvwzk.png"><br><p><br></p><br><hr><br><p>  Bagi mereka yang tertarik, tautan ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">demo</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431942/">https://habr.com/ru/post/id431942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431932/index.html">Fort Byte Car (dan banyak lagi) Penduduk Asli Amerika</a></li>
<li><a href="../id431934/index.html">Bagaimana kecerdasan buatan membantu bekerja dengan dokumen hukum? Kuliah oleh Egor Budnikov dari ABBYY</a></li>
<li><a href="../id431936/index.html">Hasil dari kontes TechnoText</a></li>
<li><a href="../id431938/index.html">Integer Cube Root di Verilog</a></li>
<li><a href="../id431940/index.html">Orang-orang terbakar jika mereka tidak merasakan nilai mereka. Apa yang harus dilakukan?</a></li>
<li><a href="../id431944/index.html">Yealink Meeting Server 2.0 - Fitur Konferensi Video Baru</a></li>
<li><a href="../id431946/index.html">Pekan Keamanan 49: meretas Dell dan Marriott</a></li>
<li><a href="../id431948/index.html">Deep Mind mengajarkan AI-nya untuk memprediksi struktur protein</a></li>
<li><a href="../id431950/index.html">Cara memperkirakan permintaan dan mengotomatiskan pembelian menggunakan pembelajaran mesin: Kasing Ozon</a></li>
<li><a href="../id431954/index.html">Mantan wakil presiden Sun dan DEC menjadi presiden MIPS / Wave, berbicara tentang Rusia dan RISC / V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>