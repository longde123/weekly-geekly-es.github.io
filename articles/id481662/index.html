<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ğŸ¼ â­ï¸ ğŸ‘©â€ğŸš’ Mencoba alat baru untuk membangun dan mengotomatiskan penyebaran di Kubernetes ğŸ‘™ ğŸ“† ğŸ¥‡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai Baru-baru ini, banyak alat otomatisasi keren telah dirilis baik untuk membangun gambar Docker dan untuk digunakan ke Kubernetes. Dalam hal ini, sa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mencoba alat baru untuk membangun dan mengotomatiskan penyebaran di Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481662/"><p><img src="https://habrastorage.org/webt/fu/wy/ia/fuwyia7huxrflvry8lzz2dbl2tw.png"></p><br><p>  Hai  Baru-baru ini, banyak alat otomatisasi keren telah dirilis baik untuk membangun gambar Docker dan untuk digunakan ke Kubernetes.  Dalam hal ini, saya memutuskan untuk bermain dengan gitlab, bagaimana mempelajari kemampuannya dan, tentu saja, mengkonfigurasi pipeline. </p><br><p>  Inspirasi untuk pekerjaan ini adalah situs <a href="https://kubernetes.io/" rel="nofollow">kubernetes.io</a> , yang secara otomatis dihasilkan dari <a href="http://github.com/kubernetes/website" rel="nofollow">kode sumber</a> , dan untuk setiap kumpulan yang dikirim, robot secara otomatis membuat versi pratinjau situs dengan perubahan Anda dan menyediakan tautan untuk dilihat. </p><br><p>  Saya mencoba untuk membangun proses serupa dari awal, tetapi seluruhnya berdasarkan pada Gitlab CI dan alat gratis yang saya gunakan untuk menggunakan aplikasi di Kubernetes.  Hari ini saya akhirnya akan memberi tahu Anda lebih banyak tentang mereka. </p><br><p>  Artikel tersebut akan mempertimbangkan alat-alat seperti: <br>  <strong>Hugo</strong> , <strong>qbec</strong> , <strong>kaniko</strong> , <strong>git-crypt</strong> dan <strong>GitLab CI</strong> dengan penciptaan lingkungan yang dinamis. </p><a name="habracut"></a><br><hr><br><h1 id="coderzhanie">  Isi </h1><br><ol><li>  <a href="https://habr.com/ru/post/481662/"><strong>Memperkenalkan Hugo</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Mempersiapkan Dockerfile</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Kenalan dengan kaniko</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Memperkenalkan qbec</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Mencoba Gitlab-runner dengan Kubernetes-executor</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Penempatan grafik Helm dengan qbec</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Memperkenalkan git-crypt</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Buat gambar toolbox</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Pipa pertama kami dan kumpulan gambar dengan tag</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Otomasi Penerapan</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Artefak dan push build in master</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Lingkungan yang dinamis</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Tinjau Aplikasi</strong></a> </li></ol><br><hr><br><h1 id="1-znakomstvo-s-hugoanchorhugoanchor">  1. Memperkenalkan Hugo <a name="hugo"></a></h1><br><p>  Sebagai contoh proyek kami, kami akan mencoba membuat situs web untuk penerbitan dokumentasi yang dibangun di atas Hugo.  Hugo adalah generator konten statis. </p><br><p>  Bagi mereka yang tidak terbiasa dengan generator statis, saya akan memberi tahu Anda lebih banyak tentang mereka.  Tidak seperti mesin situs database biasa dan beberapa mesin php yang, ketika diminta oleh pengguna, menghasilkan halaman dengan cepat, generator statis diatur sedikit berbeda.  Mereka memungkinkan Anda untuk mengambil sumber, sebagai aturan itu adalah satu set file di markup markdown dan template tema, kemudian kompilasi mereka ke situs yang sudah selesai. </p><br><p>  Artinya, pada output Anda akan mendapatkan struktur direktori dan satu set file html yang dihasilkan yang dapat dengan mudah diunggah ke hosting murah dan mendapatkan situs yang berfungsi. </p><br><p>  Hugo dapat diinstal secara lokal dan mencobanya: </p><br><p>  Kami menginisialisasi situs baru: </p><br><pre><code class="bash hljs">hugo new site docs.example.org</code> </pre> <br><p>  Dan pada saat yang sama repositori git: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> docs.example.org git init</code> </pre> <br><p>  Sejauh ini, situs kami masih asli dan untuk sesuatu yang muncul terlebih dahulu kita perlu menghubungkan tema, tema - itu hanya seperangkat template dan aturan yang telah ditetapkan oleh mana situs kami dihasilkan. </p><br><p>  Sebagai topik, kami akan menggunakan <a href="https://themes.gohugo.io/hugo-theme-learn/" rel="nofollow"><strong>Learn</strong></a> , yang, menurut pendapat saya, paling cocok untuk situs dengan dokumentasi. </p><br><p>  Saya ingin memberikan perhatian khusus pada kenyataan bahwa kita tidak perlu menyimpan file tema dalam repositori proyek kita, sebagai gantinya kita cukup menghubungkannya menggunakan <strong>git submodule</strong> : </p><br><pre> <code class="bash hljs">git submodule add https://github.com/matcornic/hugo-theme-learn themes/learn</code> </pre> <br><p>  Dengan demikian, dalam repositori kami hanya akan ada file yang terkait langsung dengan proyek kami, dan topik yang terhubung akan tetap dalam bentuk tautan ke repositori tertentu dan komit di dalamnya, yaitu, selalu dapat ditarik dari sumber asli dan tidak takut akan perubahan yang tidak kompatibel. </p><br><p>  Perbaiki <strong>config.toml</strong> config: </p><br><pre> <code class="plaintext hljs">baseURL = "http://docs.example.org/" languageCode = "en-us" title = "My Docs Site" theme = "learn"</code> </pre> <br><p>  Sudah pada tahap ini, Anda dapat menjalankan: </p><br><pre> <code class="bash hljs">hugo server</code> </pre> <br><p>  Dan di <a href="http://localhost:1313/" rel="nofollow">http: // localhost: 1313 /</a> periksa situs kami yang baru dibuat, semua perubahan yang dilakukan pada direktori secara otomatis diperbarui dan halaman terbuka di browser sangat nyaman! </p><br><p>  Mari kita coba membuat halaman sampul dalam <strong>konten / _index.md</strong> : </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># My docs site ## Welcome to the docs! You will be very smart :-)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Cuplikan layar halaman yang baru dibuat</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gb/yx/nv/gbyxnvagfs6bks4iqbwcrrovumu.png"></p></div></div><br><p>  Untuk menghasilkan situs, jalankan: </p><br><pre> <code class="bash hljs">hugo</code> </pre> <br><p>  Isi direktori <strong>publik /</strong> akan menjadi situs Anda. <br>  Ya, omong-omong, mari segera tambahkan ke <strong>.gitignore</strong> : </p><br><pre> <code class="plaintext hljs">echo /public &gt; .gitignore</code> </pre> <br><p>  Jangan lupa untuk melakukan perubahan kami: </p><br><pre> <code class="plaintext hljs">git add . git commit -m "New site created"</code> </pre> <br><hr><br><h1 id="2-podgotovka-dockerfileanchordockerfileanchor">  2. Mempersiapkan Dockerfile <a name="dockerfile"></a></h1><br><p>  Inilah saatnya menentukan struktur repositori kami.  Biasanya saya menggunakan sesuatu seperti: </p><br><pre> <code class="plaintext hljs">. â”œâ”€â”€ deploy â”‚ â”œâ”€â”€ app1 â”‚ â””â”€â”€ app2 â””â”€â”€ dockerfiles â”œâ”€â”€ image1 â””â”€â”€ image2</code> </pre> <br><ul><li>  <strong>dockerfiles /</strong> - berisi direktori dengan Dockerfiles dan semua yang Anda butuhkan untuk membangun gambar buruh pelabuhan kami. </li><li>  <strong>deploy /</strong> - berisi direktori untuk menyebarkan aplikasi kami ke Kubernetes </li></ul><br><p>  Jadi, kita akan membuat Dockerfile pertama kita di sepanjang path <strong>dockerfiles / website / Dockerfile</strong> </p><br><pre> <code class="bash hljs">FROM alpine:3.11 as builder ARG HUGO_VERSION=0.62.0 RUN wget -O- https://github.com/gohugoio/hugo/releases/download/v<span class="hljs-variable"><span class="hljs-variable">${HUGO_VERSION}</span></span>/hugo_<span class="hljs-variable"><span class="hljs-variable">${HUGO_VERSION}</span></span>_linux-64bit.tar.gz | tar -xz -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin ADD . /src RUN hugo -s /src FROM alpine:3.11 RUN apk add --no-cache darkhttpd COPY --from=builder /src/public /var/www ENTRYPOINT [ <span class="hljs-string"><span class="hljs-string">"/usr/bin/darkhttpd"</span></span> ] CMD [ <span class="hljs-string"><span class="hljs-string">"/var/www"</span></span> ]</code> </pre> <br><p>  Seperti yang Anda lihat, Dockerfile berisi dua FROMs, fitur ini disebut <a href="https://docs.docker.com/develop/develop-images/multistage-build/" rel="nofollow"><strong>multi-stage build</strong></a> dan memungkinkan Anda untuk mengecualikan semua yang tidak perlu dari gambar buruh pelabuhan akhir. <br>  Dengan demikian, gambar akhir hanya akan berisi <strong>darkhttpd</strong> (server HTTP ringan) dan <strong>publik /</strong> - konten situs kami yang dihasilkan secara statis. </p><br><p>  Jangan lupa untuk melakukan perubahan kami: </p><br><pre> <code class="plaintext hljs">git add dockerfiles/website git commit -m "Add Dockerfile for website"</code> </pre> <br><hr><br><h1 id="3-znakomstvo-s-kanikoanchorkanikoanchor">  3. Berkenalan dengan kaniko <a name="kaniko"></a></h1><br><p>  Sebagai kolektor gambar buruh pelabuhan, saya memutuskan untuk menggunakan <strong><a href="https://github.com/GoogleContainerTools/kaniko" rel="nofollow">kaniko</a></strong> , karena tidak memerlukan daemon buruh pelabuhan untuk bekerja, dan perakitan itu sendiri dapat dilakukan pada mesin apa pun dan menyimpan cache secara langsung dalam registri, sehingga menghilangkan kebutuhan untuk penyimpanan persisten penuh. . </p><br><p>  Untuk membangun gambar, mulai saja wadah dengan <strong>pelaksana kaniko</strong> dan sampaikan konteks pembuatan saat ini, Anda dapat melakukan ini secara lokal, melalui buruh pelabuhan: </p><br><pre> <code class="bash hljs">docker run -ti --rm \ -v <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>:/workspace \ -v ~/.docker/config.json:/kaniko/.docker/config.json:ro \ gcr.io/kaniko-project/executor:v0.15.0 \ --cache \ --dockerfile=dockerfiles/website/Dockerfile \ --destination=registry.gitlab.com/kvaps/docs.example.org/website:v0.0.1</code> </pre> <br><p>  Di mana <strong>registry.gitlab.com/kvaps/docs.example.org/website</strong> adalah nama dari gambar buruh pelabuhan Anda, setelah perakitan akan secara otomatis dimasukkan ke dalam register buruh pelabuhan. </p><br><p>  Parameter <strong>--cache</strong> memungkinkan Anda untuk <strong>me</strong> -cache lapisan dalam register docker, untuk contoh yang diberikan mereka akan disimpan di <strong>registry.gitlab.com/kvaps/docs.example.org/website/cache</strong> , tetapi Anda dapat menentukan lintasan lain menggunakan parameter <strong>--cache- repo</strong> . </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot docker-registry</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0-/31/qx/0-31qxfta2gk7-colutf2l_qtmm.png"></p></div></div><br><hr><br><h1 id="4-znakomstvo-s-qbecanchorqbecanchor">  4. Berkenalan dengan qbec <a name="qbec"></a></h1><br><p>  <a href="https://qbec.io/" rel="nofollow">Qbec</a> adalah alat penyebaran yang memungkinkan Anda untuk mendeskripsikan manifes aplikasi Anda dan menyebarkannya ke Kubernetes.  Menggunakan Jsonnet sebagai sintaks utama memungkinkan Anda untuk sangat menyederhanakan deskripsi perbedaan untuk beberapa lingkungan, dan juga hampir sepenuhnya menghilangkan pengulangan kode. </p><br><p>  Ini bisa benar terutama dalam kasus di mana Anda perlu menyebarkan aplikasi ke beberapa cluster dengan parameter yang berbeda dan Anda ingin menggambarkan secara deklaratif di Git. </p><br><p>  Qbec juga memungkinkan Anda untuk membuat grafik Helm dengan memberikan parameter yang diperlukan dan kemudian mengoperasikannya serta manifesto normal, termasuk berbagai mutasi yang dapat ditumpangkan pada mereka, dan ini, pada gilirannya, menghilangkan kebutuhan untuk menggunakan ChartMuseum.  Artinya, Anda dapat menyimpan dan membuat grafik langsung dari git, di mana mereka memiliki tempat itu. </p><br><p>  Seperti yang saya katakan sebelumnya, kami akan menyimpan semua penyebaran di direktori <strong>deploy /</strong> : </p><br><pre> <code class="bash hljs">mkdir deploy <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy</code> </pre> <br><p>  Mari inisialisasi aplikasi pertama kita: </p><br><pre> <code class="bash hljs">qbec init website <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> website</code> </pre> <br><p>  Sekarang struktur aplikasi kita terlihat seperti ini: </p><br><pre> <code class="plaintext hljs">. â”œâ”€â”€ components â”œâ”€â”€ environments â”‚  â”œâ”€â”€ base.libsonnet â”‚  â””â”€â”€ default.libsonnet â”œâ”€â”€ params.libsonnet â””â”€â”€ qbec.yaml</code> </pre> <br><p>  lihat file <strong>qbec.yaml</strong> : </p><br><pre> <code class="plaintext hljs">apiVersion: qbec.io/v1alpha1 kind: App metadata: name: website spec: environments: default: defaultNamespace: docs server: https://kubernetes.example.org:8443 vars: {}</code> </pre> <br><p>  Di sini kami terutama tertarik pada <strong>spec.environmentments</strong> , qbec sudah membuat lingkungan default untuk kami dan mengambil alamat server, serta namespace dari kubeconfig kami saat ini. <br>  Sekarang, ketika menggunakan ke lingkungan <strong>default</strong> , qbec akan selalu menyebarkan hanya ke cluster Kubernetes yang ditentukan dan ke namespace yang ditentukan, yaitu, Anda tidak lagi harus beralih antara konteks dan ruang nama untuk melakukan penyebaran. <br>  Jika perlu, Anda selalu dapat memperbarui pengaturan dalam file ini. </p><br><p>  Semua lingkungan Anda dijelaskan dalam <strong>qbec.yaml</strong> , dan dalam file <strong>params.libsonnet</strong> , di mana ia mengatakan di mana Anda perlu mengambil parameter untuk mereka. </p><br><p>  Selanjutnya kita melihat dua direktori: </p><br><ul><li>  <strong>komponen /</strong> - semua manifes untuk aplikasi kita akan disimpan di sini, mereka dapat dijelaskan baik di jsonnet dan file yaml biasa </li><li>  <strong>lingkungan /</strong> - di sini kita akan menjelaskan semua variabel (parameter) untuk lingkungan kita. </li></ul><br><p>  Secara default, kami memiliki dua file: </p><br><ul><li>  <strong>environment / base.libsonnet</strong> - ini akan berisi parameter umum untuk semua lingkungan </li><li>  <strong>environment / default.libsonnet</strong> - berisi parameter yang diganti untuk lingkungan <strong>default</strong> </li></ul><br><p>  Mari kita buka <strong>environment / base.libsonnet</strong> dan tambahkan parameter untuk komponen pertama kita di sana: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">website</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'example-docs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/website:v0.0.1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">ingressClass</span></span>: <span class="hljs-string"><span class="hljs-string">'nginx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">domain</span></span>: <span class="hljs-string"><span class="hljs-string">'docs.example.org'</span></span>, }, }, }</code> </pre> <br><p>  Kami juga akan membuat komponen <strong>komponen / website.jsonnet</strong> pertama kami: </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.website; [ { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'apps/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Deployment'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: params.replicas, <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: { <span class="hljs-attr"><span class="hljs-attr">matchLabels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, }, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: { <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">containers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'darkhttpd'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: params.image, <span class="hljs-attr"><span class="hljs-attr">ports</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: params.containerPort, }, ], }, ], <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: params.nodeSelector, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: params.tolerations, <span class="hljs-attr"><span class="hljs-attr">imagePullSecrets</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'regsecret'</span></span> }], }, }, }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Service'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">ports</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">port</span></span>: params.servicePort, <span class="hljs-attr"><span class="hljs-attr">targetPort</span></span>: params.containerPort, }, ], }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'extensions/v1beta1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Ingress'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">annotations</span></span>: { <span class="hljs-string"><span class="hljs-string">'kubernetes.io/ingress.class'</span></span>: params.ingressClass, }, <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">host</span></span>: params.domain, <span class="hljs-attr"><span class="hljs-attr">http</span></span>: { <span class="hljs-attr"><span class="hljs-attr">paths</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">backend</span></span>: { <span class="hljs-attr"><span class="hljs-attr">serviceName</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: params.servicePort, }, }, ], }, }, ], }, }, ]</code> </pre> <br><p>  Dalam file ini kami segera menggambarkan tiga entitas Kubernetes, yaitu: <strong>Deployment</strong> , <strong>Service</strong> , dan <strong>Ingress</strong> .  Jika diinginkan, kita bisa membawanya ke komponen yang berbeda, tetapi pada tahap ini, satu sudah cukup bagi kita. </p><br><p>  Sintaks <strong>jsonnet</strong> sangat mirip dengan json biasa, pada prinsipnya jsonnet reguler sudah jsonnet yang valid, jadi pada awalnya mungkin lebih mudah untuk menggunakan layanan online seperti <strong>yaml2json</strong> untuk mengonversi yaml Anda menjadi json, atau jika komponen Anda tidak mengandung variabel apa pun, maka mereka dapat digambarkan dalam bentuk yaml biasa. </p><br><blockquote>  Ketika bekerja dengan <strong>jsonnet, saya</strong> sangat menyarankan untuk menginstal plugin untuk editor Anda <br><br>  Misalnya, untuk vim ada <strong>plugin vim-jsonnet</strong> yang menyalakan penyorotan sintaks dan secara otomatis melakukan <strong>jsonnet fmt</strong> setiap kali disimpan (memerlukan jsonnet diinstal). </blockquote><p>  Semuanya siap, sekarang kita bisa memulai penyebaran: </p><br><p>  Untuk melihat apa yang terjadi, kami akan melakukan: </p><br><pre> <code class="bash hljs">qbec show default</code> </pre> <br><p>  Pada output, Anda akan melihat manifes yaml yang diberikan yang akan diterapkan ke cluster default. </p><br><p>  Oke, sekarang terapkan: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><p>  Di pintu keluar, Anda akan selalu melihat apa yang akan dilakukan di kluster Anda, qbec akan meminta Anda untuk menerima perubahan, dengan mengetik <strong>y</strong> Anda dapat mengonfirmasi niat Anda. </p><br><p>  Selesai, sekarang aplikasi kita merapat! </p><br><p>  Jika Anda melakukan perubahan, Anda selalu dapat melakukan: </p><br><pre> <code class="bash hljs">qbec diff default</code> </pre> <br><p>  untuk melihat bagaimana perubahan ini akan mempengaruhi penyebaran saat ini </p><br><p>  Jangan lupa untuk melakukan perubahan kami: </p><br><pre> <code class="plaintext hljs">cd ../.. git add deploy/website git commit -m "Add deploy for website"</code> </pre> <br><hr><br><h1 id="5-probuem-gitlab-runner-s-kubernetes-executoranchorgitlab-runneranchor">  5. Mencoba Gitlab-runner dengan Kubernetes-executor <a name="gitlab-runner"></a></h1><br><p>  Sampai baru-baru ini, saya hanya menggunakan <strong>gitlab-runner biasa</strong> pada mesin yang sudah disiapkan (wadah LXC) dengan shell atau docker-executor.  Awalnya, kami memiliki beberapa pelari yang didefinisikan secara global di hitlab kami.  Mereka mengumpulkan gambar buruh pelabuhan untuk semua proyek. </p><br><p>  Tetapi seperti yang telah ditunjukkan oleh praktik, opsi ini bukanlah yang paling ideal, baik dalam hal kepraktisan maupun dalam hal keamanan.  Jauh lebih baik dan ideologis lebih tepat untuk memiliki pelari yang terpisah dikerahkan untuk setiap proyek, dan bahkan untuk setiap lingkungan. </p><br><p>  Untungnya, ini bukan masalah sama sekali, karena sekarang kami akan menggunakan <strong>gitlab-runner</strong> secara langsung sebagai bagian dari proyek kami langsung ke Kubernetes. </p><br><p>  Gitlab menyediakan bagan helm yang siap pakai untuk menempatkan gitlab-pelari di Kubernetes.  Dengan demikian, semua yang perlu Anda lakukan adalah mencari <strong>token pendaftaran</strong> untuk proyek kami di <strong>Pengaturan -&gt; CI / CD -&gt; Pelari</strong> dan berikan helm: </p><br><pre> <code class="bash hljs">helm repo add gitlab https://charts.gitlab.io helm install gitlab-runner \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> gitlabUrl=https://gitlab.com \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> runnerRegistrationToken=yga8y-jdCusVDn_t4Wxc \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> rbac.create=<span class="hljs-literal"><span class="hljs-literal">true</span></span> \ gitlab/gitlab-runner</code> </pre> <br><p>  Dimana: </p><br><ul><li>  <strong><a href="https://gitlab.com/" rel="nofollow">https://gitlab.com</a></strong> adalah alamat server Gitlab Anda. </li><li>  <strong>yga8y-jdCusVDn_t4Wxc</strong> - token pendaftaran untuk proyek Anda. </li><li>  <strong>rbac.create = true</strong> - Memberi pelari jumlah hak istimewa yang diperlukan untuk dapat membuat pod untuk melakukan tugas kami menggunakan kubernetes-executor. </li></ul><br><p>  Jika semuanya dilakukan dengan benar, Anda akan melihat pelari terdaftar di bagian <strong>Pelari</strong> , di pengaturan proyek Anda. </p><br><div class="spoiler">  <b class="spoiler_title">Cuplikan layar pelari yang ditambahkan</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/at/lx/g_/atlxg_u6rjn4n0pkcpn8--2gare.png"></p></div></div><br><p>  Apakah sesederhana itu?  - ya, sangat sederhana!  Tidak ada lagi kesulitan dengan mendaftarkan pelari secara manual, mulai sekarang pelari akan dibuat dan dihancurkan secara otomatis. </p><br><hr><br><h1 id="6-deploy-helm-chartov-s-qbecanchorqbec-helmanchor">  6. Penyebaran grafik Helm dengan QBEC <a name="qbec-helm"></a></h1><br><p>  Karena kami memutuskan untuk mempertimbangkan <strong>gitlab-runner</strong> bagian dari proyek kami, sekarang saatnya untuk menggambarkannya di repositori Git kami. </p><br><p>  Kami dapat menggambarkannya sebagai komponen terpisah dari <strong>situs web</strong> , tetapi di masa mendatang kami berencana untuk menyebarkan salinan berbeda dari <strong>situs web</strong> sangat sering, tidak seperti <strong>gitlab-runner</strong> , yang akan digunakan hanya sekali untuk setiap kluster Kubernetes.  Jadi mari kita inisialisasi aplikasi terpisah untuk itu: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy qbec init gitlab-runner <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gitlab-runner</code> </pre> <br><p>  Kali ini kami tidak akan menjelaskan entitas Kubernetes secara manual, tetapi mengambil grafik Helm yang sudah jadi.  Salah satu keuntungan dari qbec adalah kemampuan untuk merender grafik Helm langsung dari repositori Git. </p><br><p>  Mari kita pasang menggunakan submitule git: </p><br><pre> <code class="bash hljs">git submodule add https://gitlab.com/gitlab-org/charts/gitlab-runner vendor/gitlab-runner</code> </pre> <br><p>  Sekarang direktori <strong>vendor / gitlab-runner</strong> berisi repositori kami dengan bagan untuk gitlab-runner. </p><br><blockquote>  Demikian pula, Anda dapat menghubungkan repositori lain, misalnya, seluruh repositori dengan grafik resmi <strong><a href="https://github.com/helm/charts" rel="nofollow">https://github.com/helm/charts</a></strong> </blockquote><p>  Mari kita gambarkan <strong>komponen / komponen gitlab-runner.jsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.gitlabRunner; std.native(<span class="hljs-string"><span class="hljs-string">'expandHelmTemplate'</span></span>)( <span class="hljs-string"><span class="hljs-string">'../vendor/gitlab-runner'</span></span>, params.values, { <span class="hljs-attr"><span class="hljs-attr">nameTemplate</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: env.namespace, <span class="hljs-attr"><span class="hljs-attr">thisFile</span></span>: std.thisFile, <span class="hljs-attr"><span class="hljs-attr">verbose</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } )</code> </pre> <br><p>  Argumen pertama untuk <strong>memperluasHelmTemplate</strong> kita melewati jalur ke bagan, lalu <strong>params.values</strong> , yang kita ambil dari parameter lingkungan, lalu objek dengan </p><br><ul><li>  <strong>nameTemplate</strong> - nama rilis </li><li>  <strong>namespace</strong> - namespace diteruskan ke helm </li><li>  <strong>thisFile</strong> - diperlukan parameter yang meneruskan jalur ke file saat ini </li><li>  <strong>verbose</strong> - menunjukkan perintah <strong>templat helm</strong> dengan semua argumen saat merender bagan </li></ul><br><p>  Sekarang kita akan menjelaskan parameter untuk komponen kita di <strong>lingkungan / base.libsonnet</strong> : </p><br><pre> <code class="javascript hljs">local secrets = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../secrets/base.libsonnet'</span></span>; { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabRunner</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner'</span></span>, <span class="hljs-attr"><span class="hljs-attr">values</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'https://gitlab.com/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: secrets.runnerRegistrationToken, }, }, }, }</code> </pre> <br><p>  Perhatikan <strong>runnerRegistrationToken yang</strong> kita ambil dari file eksternal <strong>secret / base.libsonnet</strong> , mari kita buat: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: <span class="hljs-string"><span class="hljs-string">'yga8y-jdCusVDn_t4Wxc'</span></span>, }</code> </pre> <br><p>  Periksa apakah semuanya berfungsi: </p><br><pre> <code class="bash hljs">qbec show default</code> </pre> <br><p>  jika semuanya beres, maka kami dapat menghapus rilis kami sebelumnya melalui rilis Helm: </p><br><pre> <code class="bash hljs">helm uninstall gitlab-runner</code> </pre> <br><p>  dan menyebarkannya, tetapi sudah melalui qbec: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><hr><br><h1 id="7-znakomstvo-s-git-cryptanchorgit-cryptanchor">  7. Memperkenalkan git-crypt <a name="git-crypt"></a></h1><br><p>  <strong><a href="https://github.com/AGWA/git-crypt" rel="nofollow">Git-crypt</a></strong> adalah alat yang memungkinkan Anda mengatur enkripsi transparan untuk repositori Anda. </p><br><p>  Saat ini, struktur direktori kami untuk gitlab-runner terlihat seperti ini: </p><br><pre> <code class="plaintext hljs">. â”œâ”€â”€ components â”‚  â”œâ”€â”€ gitlab-runner.jsonnet â”œâ”€â”€ environments â”‚  â”œâ”€â”€ base.libsonnet â”‚  â””â”€â”€ default.libsonnet â”œâ”€â”€ params.libsonnet â”œâ”€â”€ qbec.yaml â”œâ”€â”€ secrets â”‚  â””â”€â”€ base.libsonnet â””â”€â”€ vendor â””â”€â”€ gitlab-runner (submodule)</code> </pre> <br><p>  Tapi menyimpan rahasia di Git tidak aman, kan?  Jadi kita perlu mengenkripsi mereka dengan benar. </p><br><blockquote>  Biasanya demi satu variabel ini tidak selalu masuk akal.  Anda dapat meneruskan rahasia ke <strong>qbec</strong> dan melalui variabel lingkungan sistem CI Anda. <br>  Tetapi perlu dicatat bahwa ada proyek yang lebih kompleks yang dapat mengandung lebih banyak rahasia, akan sangat sulit untuk mentransfer semuanya melalui variabel lingkungan. <br><br>  Selain itu, dalam hal ini, saya tidak akan bisa memberi tahu Anda tentang alat luar biasa seperti <strong>git-crypt</strong> . <br><br>  <strong>git-crypt</strong> juga nyaman karena memungkinkan Anda untuk menyimpan seluruh sejarah rahasia, serta membandingkan, menggabungkan dan menyelesaikan konflik dengan cara yang sama seperti yang biasa kita lakukan dalam kasus Git. </blockquote><p>  Pertama-tama, setelah menginstal <strong>git-crypt,</strong> kita perlu membuat kunci untuk repositori kita: </p><br><pre> <code class="plaintext hljs">git crypt init</code> </pre> <br><p>  Jika Anda memiliki kunci PGP, maka Anda dapat segera menambahkan diri Anda sebagai kolaborator untuk proyek ini: </p><br><pre> <code class="plaintext hljs">git-crypt add-gpg-user kvapss@gmail.com</code> </pre> <br><p>  Dengan demikian, Anda selalu dapat mendekripsi repositori ini menggunakan kunci pribadi Anda. </p><br><p>  Jika Anda tidak memiliki kunci PGP dan tidak diharapkan, maka Anda dapat pergi ke arah lain dan mengekspor kunci proyek: </p><br><pre> <code class="plaintext hljs">git crypt export-key /path/to/keyfile</code> </pre> <br><p>  Dengan cara ini, siapa pun dengan <strong>keyfile yang</strong> diekspor akan dapat mendekripsi repositori Anda. </p><br><p>  Sekarang saatnya untuk mengatur rahasia pertama kami. <br>  Biarkan saya mengingatkan Anda bahwa kami masih dalam direktori <strong>deploy / gitlab-runner /</strong> , di mana kami memiliki <strong>rahasia /</strong> direktori, mari mengenkripsi semua file di dalamnya, untuk ini kami membuat file <strong>rahasia / .gitributributes</strong> dengan konten berikut: </p><br><pre> <code class="plaintext hljs">* filter=git-crypt diff=git-crypt .gitattributes !filter !diff</code> </pre> <br><p>  Seperti yang Anda lihat dari konten, semua file dengan mask <strong>*</strong> akan dijalankan melalui <strong>git-crypt</strong> , kecuali untuk <strong>.gitattributes</strong> sendiri </p><br><p>  Kami dapat memverifikasi ini dengan menjalankan: </p><br><pre> <code class="bash hljs">git crypt status -e</code> </pre> <br><p>  Pada output, kita mendapatkan daftar semua file di repositori yang enkripsi diaktifkan </p><br><p>  Itu saja, sekarang kita bisa melakukan perubahan dengan aman: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../.. git add . git commit -m <span class="hljs-string"><span class="hljs-string">"Add deploy for gitlab-runner"</span></span></code> </pre> <br><p>  Untuk memblokir repositori, cukup lakukan: </p><br><pre> <code class="bash hljs">git crypt lock</code> </pre> <br><p>  dan kemudian semua file terenkripsi berubah menjadi sesuatu biner, tidak mungkin untuk membacanya. <br>  Untuk mendekripsi repositori, lakukan: </p><br><pre> <code class="bash hljs">git crypt unlock</code> </pre> <br><hr><br><h1 id="8-sozdayom-toolbox-obrazanchortoolboxanchor">  8. Buat gambar toolbox <a name="toolbox"></a></h1><br><p>  Gambar toolbox adalah gambar seperti itu dengan semua alat yang akan kami gunakan untuk menggunakan proyek kami.  Ini akan digunakan oleh gitlab runner untuk melakukan tugas-tugas penyebaran yang khas. </p><br><p>  Semuanya sederhana di sini, kami membuat <strong>dockerfiles / toolbox / Dockerfile baru</strong> dengan konten berikut: </p><br><pre> <code class="bash hljs">FROM alpine:3.11 RUN apk add --no-cache git git-crypt RUN QBEC_VER=0.10.3 \ &amp;&amp; wget -O- https://github.com/splunk/qbec/releases/download/v<span class="hljs-variable"><span class="hljs-variable">${QBEC_VER}</span></span>/qbec-linux-amd64.tar.gz \ | tar -C /tmp -xzf - \ &amp;&amp; mv /tmp/qbec /tmp/jsonnet-qbec /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/ RUN KUBECTL_VER=1.17.0 \ &amp;&amp; wget -O /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/kubectl \ https://storage.googleapis.com/kubernetes-release/release/v<span class="hljs-variable"><span class="hljs-variable">${KUBECTL_VER}</span></span>/bin/linux/amd64/kubectl \ &amp;&amp; chmod +x /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/kubectl RUN HELM_VER=3.0.2 \ &amp;&amp; wget -O- https://get.helm.sh/helm-v<span class="hljs-variable"><span class="hljs-variable">${HELM_VER}</span></span>-linux-amd64.tar.gz \ | tar -C /tmp -zxf - \ &amp;&amp; mv /tmp/linux-amd64/helm /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/helm</code> </pre> <br><p>  Seperti yang Anda lihat, pada gambar ini kami memasang semua utilitas yang kami gunakan untuk menggunakan aplikasi kami.  Kami tidak perlu <strong>kubectl di sini</strong> , tetapi Anda mungkin ingin bermain dengannya di tahap penyiapan pipa. </p><br><p>  Juga, untuk dapat berkomunikasi dengan Kubernetes dan melakukan penyebaran ke dalamnya, kita perlu mengkonfigurasi peran untuk pod yang dihasilkan oleh gitlab-runner. </p><br><p>  Untuk melakukan ini, buka direktori dengan gitlab-runner: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy/gitlab-runner</code> </pre> <br><p>  dan tambahkan komponen <strong>komponen baru / rbac.jsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.rbac; [ { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'ServiceAccount'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Role'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">apiGroups</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">resources</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">verbs</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], }, ], }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'RoleBinding'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">roleRef</span></span>: { <span class="hljs-attr"><span class="hljs-attr">apiGroup</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Role'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">subjects</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'ServiceAccount'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: env.namespace, }, ], }, ]</code> </pre> <br><p>  Kami juga akan menjelaskan parameter baru di <strong>lingkungan / base.libsonnet</strong> , yang sekarang terlihat seperti ini: </p><br><pre> <code class="javascript hljs">local secrets = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../secrets/base.libsonnet'</span></span>; { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabRunner</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner'</span></span>, <span class="hljs-attr"><span class="hljs-attr">values</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'https://gitlab.com/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: secrets.runnerRegistrationToken, <span class="hljs-attr"><span class="hljs-attr">runners</span></span>: { <span class="hljs-attr"><span class="hljs-attr">serviceAccountName</span></span>: $.components.rbac.name, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/toolbox:v0.0.1'</span></span>, }, }, }, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner-deploy'</span></span>, }, }, }</code> </pre> <br><p>  Catatan <strong>$ .components.rbac.name</strong> mengacu pada <strong>nama</strong> untuk komponen <strong>rbac</strong> </p><br><p>  Mari kita periksa apa yang telah berubah: </p><br><pre> <code class="bash hljs">qbec diff default</code> </pre> <br><p>  dan terapkan perubahan kami pada Kubernetes: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><p>  Juga jangan lupa untuk melakukan perubahan pada git: </p><br><pre> <code class="plaintext hljs">cd ../.. git add dockerfiles/toolbox git commit -m "Add Dockerfile for toolbox" git add deploy/gitlab-runner git commit -m "Configure gitlab-runner to use toolbox"</code> </pre> <br><hr><br><h1 id="9-nash-pervyy-payplayn-i-sborka-obrazov-po-tegamanchorpipeline-buildanchor">  9. Jalur pipa pertama kami dan perakitan gambar dengan tag <a name="pipeline-build"></a></h1><br><p>  Di root proyek kami akan membuat <strong>.gitlab-ci.yml</strong> dengan konten berikut: </p><br><pre> <code class="plaintext hljs">.build_docker_image: stage: build image: name: gcr.io/kaniko-project/executor:debug-v0.15.0 entrypoint: [""] before_script: - echo "{\"auths\":{\"$CI_REGISTRY\":{\"username\":\"$CI_REGISTRY_USER\",\"password\":\"$CI_REGISTRY_PASSWORD\"}}}" &gt; /kaniko/.docker/config.json build_toolbox: extends: .build_docker_image script: - /kaniko/executor --cache --context $CI_PROJECT_DIR/dockerfiles/toolbox --dockerfile $CI_PROJECT_DIR/dockerfiles/toolbox/Dockerfile --destination $CI_REGISTRY_IMAGE/toolbox:$CI_COMMIT_TAG only: refs: - tags build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_TAG only: refs: - tags</code> </pre> <br><p>  Harap perhatikan bahwa kami menggunakan <strong>GIT_SUBMODULE_STRATEGY: normal</strong> untuk pekerjaan-pekerjaan di mana Anda perlu menginisialisasi submodul secara eksplisit sebelum dieksekusi. </p><br><p>  Jangan lupa untuk melakukan perubahan kami: </p><br><pre> <code class="plaintext hljs">git add .gitlab-ci.yml git commit -m "Automate docker build"</code> </pre> <br><p>  Saya pikir Anda dapat dengan aman menyebutnya versi <strong>v0.0.1</strong> dan menggantung tag: </p><br><pre> <code class="bash hljs">git tag v0.0.1</code> </pre> <br><p>  Kami akan menggantung tag setiap kali kami perlu merilis versi baru.  Tag dalam gambar Docker akan diikat ke tag Git.  Setiap dorongan dengan tag baru akan menginisialisasi perakitan gambar dengan tag ini. </p><br><p>  Jalankan <strong>git push --tags</strong> , dan lihat pipa pertama kami: </p><br><div class="spoiler">  <b class="spoiler_title">Cuplikan layar pipa pertama</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/5u/ce/fg/5ucefgejcfjz7jpwvou206mwufy.png"></p></div></div><br><blockquote>  Anda perlu memperhatikan fakta bahwa perakitan dengan tag cocok untuk merakit gambar buruh pelabuhan, tetapi tidak cocok untuk menggunakan aplikasi di Kubernetes.  Karena tag baru juga dapat ditetapkan untuk komit lama, dalam hal ini inisialisasi pipa untuknya akan mengarah ke penyebaran versi lama. <br><br>  Untuk mengatasi masalah ini, biasanya rakitan gambar buruh pelabuhan dilampirkan ke tag, dan penyebaran aplikasi ke cabang <strong>master</strong> , di mana versi gambar yang dikumpulkan di-hardcode.  Dalam hal ini Anda dapat menginisialisasi rollback dengan tag <strong>master</strong> revert sederhana. </blockquote><br><hr><br><h1 id="10-avtomatizaciya-deployaanchorpipeline-deployanchor">  10. Otomatisasi penyebaran <a name="pipeline-deploy"></a></h1><br><p>  Agar Gitlab-runner dapat mendekripsi rahasia kita, kita perlu mengekspor kunci repositori, dan menambahkannya ke variabel lingkungan CI kita: </p><br><pre> <code class="plaintext hljs">git crypt export-key /tmp/docs-repo.key base64 -w0 /tmp/docs-repo.key; echo</code> </pre> <br><p>  simpan string yang dihasilkan di Gitlab, untuk ini kita akan pergi ke pengaturan proyek kami: <br>  <strong>Pengaturan -&gt; CI / CD -&gt; Variabel</strong> </p><br><p>    : </p><br><div class="scrollable-table"><table><thead><tr><th> Type </th><th> Key </th><th> Value </th><th> Protected </th><th> Masked </th><th> Scope </th></tr></thead><tbody><tr><td> <code>File</code> </td> <td> <code>GITCRYPT_KEY</code> </td> <td> <code>&lt;your string&gt;</code> </td> <td> <code>true</code> <em>(     <code>false</code> )</em> </td><td> <code>true</code> </td> <td> <code>All environments</code> </td> </tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vj/li/ea/vjliealfwwsmiy4-nvjfvcf89ig.png"></p></div></div><br><p>    <strong>.gitlab-ci.yml</strong>   : </p><br><pre> <code class="plaintext hljs">.deploy_qbec_app: stage: deploy only: refs: - master deploy_gitlab_runner: extends: .deploy_qbec_app variables: GIT_SUBMODULE_STRATEGY: normal before_script: - base64 -d "$GITCRYPT_KEY" | git-crypt unlock - script: - qbec apply default --root deploy/gitlab-runner --force:k8s-context __incluster__ --wait --yes deploy_website: extends: .deploy_qbec_app script: - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes</code> </pre> <br><p>        qbec: </p><br><ul><li> <strong>--root some/app</strong> â€”      </li><li> <strong>--force:k8s-context __incluster__</strong> â€”   ,             gtilab-runner.   ,      qbec     Kubernetes-   kubeconfig </li><li> <strong>--wait</strong> â€”  qbec ,        Ready       exit-code. </li><li> <strong>--yes</strong> â€”     <strong>Are you sure?</strong>  . </li></ul><br><p>     : </p><br><pre> <code class="plaintext hljs">git add .gitlab-ci.yml git commit -m "Automate deploy"</code> </pre> <br><p>   <strong>git push</strong>       : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0p/aj/vs/0pajvs-a-lrxvfuw8zylnj6lleg.png"></p></div></div><br><hr><br><h1 id="11-artefakty-i-sborka-pri-push-v-masteranchorartifactsanchor"> 11.     push  master <a name="artifacts"></a></h1><br><p>            ,             .           digest  master-. </p><br><p>  :    <strong>website</strong>      push  <strong>master</strong> ,       Kubernetes. </p><br><p>        <strong>.gitlab-ci.yml</strong> : </p><br><pre> <code class="plaintext hljs">build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - mkdir -p $CI_PROJECT_DIR/artifacts - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_REF_NAME --digest-file $CI_PROJECT_DIR/artifacts/website.digest artifacts: paths: - artifacts/ only: refs: - master - tags deploy_website: extends: .deploy_qbec_app script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST"</code> </pre> <br><p>  ,    <strong>master</strong>  <strong>refs</strong>   <strong>build_website</strong>     <strong>$CI_COMMIT_REF_NAME</strong>  <strong>$CI_COMMIT_TAG</strong> ,        Git           .  ,        ,           docker-registry. </p><br><p>   docker-       ,        Kubernetes,           ,         . </p><br><p>  <strong>--vm:ext-str digest="$DIGEST"</strong>  qbec â€”      jsonnet.            .   ,     ,     ,               . </p><br><p>     Kaniko  digest    ( <strong>--digest-file</strong> ) <br>          . </p><br><p>     <strong>deploy/website/environments/base.libsonnet</strong>     : </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">website</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'example-docs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/website@'</span></span> + std.extVar(<span class="hljs-string"><span class="hljs-string">'digest'</span></span>), <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">ingressClass</span></span>: <span class="hljs-string"><span class="hljs-string">'nginx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">domain</span></span>: <span class="hljs-string"><span class="hljs-string">'docs.example.org'</span></span>, }, }, }</code> </pre> <br><p> ,     <strong>master</strong>   docker-  <strong>website</strong> ,      Kubernetes. </p><br><p>     : </p><br><pre> <code class="bash hljs">git add . git commit -m <span class="hljs-string"><span class="hljs-string">"Configure dynamic build"</span></span></code> </pre> <br><p> ,  <strong>git push</strong>    - : </p><br><div class="spoiler"> <b class="spoiler_title">   master</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7_/ry/nh/7_rynh5lgu_8hqnnl_gasx73zwq.png"></p></div></div><br><p>       gitlab-runner   push, , ,      ,     <strong>.gitlab-ci.yml</strong> : </p><br><pre> <code class="plaintext hljs">deploy_gitlab_runner: extends: .deploy_qbec_app variables: GIT_SUBMODULE_STRATEGY: normal before_script: - base64 -d "$GITCRYPT_KEY" | git-crypt unlock - script: - qbec apply default --root deploy/gitlab-runner --force:k8s-context __incluster__ --wait --yes only: changes: - deploy/gitlab-runner/**/*</code> </pre> <br><p> <strong>changes</strong>      <strong>deploy/gitlab-runner/</strong>          </p><br><p>     : </p><br><pre> <code class="bash hljs">git add .gitlab-ci.yml git commit -m <span class="hljs-string"><span class="hljs-string">"Reduce gitlab-runner deploy"</span></span></code> </pre> <br><p> <strong>git push</strong> , - : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/-t/9b/3m/-t9b3mtofbunu7xfogpmb0pacsm.png"></p></div></div><br><hr><br><h1 id="12-dynamic-environmentsanchordynamic-environmentsanchor"> 12. Dynamic environments <a name="dynamic-environments"></a></h1><br><p>       . </p><br><p>     <strong>build_website</strong>   <strong>.gitlab-ci.yml</strong> ,     <strong>only</strong> ,   Gitlab        : </p><br><pre> <code class="plaintext hljs">build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - mkdir -p $CI_PROJECT_DIR/artifacts - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_REF_NAME --digest-file $CI_PROJECT_DIR/artifacts/website.digest artifacts: paths: - artifacts/</code> </pre> <br><p>    <strong>deploy_website</strong> ,    <strong>environment</strong> : </p><br><pre> <code class="plaintext hljs">deploy_website: extends: .deploy_qbec_app environment: name: prod url: https://docs.example.org script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST"</code> </pre> <br><p>   Gitlab    <strong>prod</strong>       . </p><br><p>     : </p><br><pre> <code class="plaintext hljs">deploy_website: extends: .deploy_qbec_app environment: name: prod url: https://docs.example.org script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST" deploy_review: extends: .deploy_qbec_app environment: name: review/$CI_COMMIT_REF_NAME url: http://$CI_ENVIRONMENT_SLUG.docs.example.org on_stop: stop_review script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply review --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST" --vm:ext-str subdomain="$CI_ENVIRONMENT_SLUG" --app-tag "$CI_ENVIRONMENT_SLUG" only: refs: - branches except: refs: - master stop_review: extends: .deploy_qbec_app environment: name: review/$CI_COMMIT_REF_NAME action: stop stage: deploy before_script: - git clone "$CI_REPOSITORY_URL" master - cd master script: - qbec delete review --root deploy/website --force:k8s-context __incluster__ --yes --vm:ext-str digest="$DIGEST" --vm:ext-str subdomain="$CI_ENVIRONMENT_SLUG" --app-tag "$CI_ENVIRONMENT_SLUG" variables: GIT_STRATEGY: none only: refs: - branches except: refs: - master when: manual</code> </pre> <br><p>     push     master    preview  . </p><br><p>      qbec: <strong>--app-tag</strong> â€”             ,       Kubernetes qbec    . <br>           review,       . </p><br><p>      <strong>qbec apply review</strong> ,  <strong>qbec apply default</strong> â€”               (review  default): </p><br><p>  <strong>review</strong>   <strong>deploy/website/qbec.yaml</strong> </p><br><pre> <code class="plaintext hljs">spec: environments: review: defaultNamespace: docs server: https://kubernetes.example.org:8443</code> </pre> <br><p>     <strong>deploy/website/params.libsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>); local paramsMap = { <span class="hljs-attr"><span class="hljs-attr">_</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/base.libsonnet'</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/default.libsonnet'</span></span>, <span class="hljs-attr"><span class="hljs-attr">review</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/review.libsonnet'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> std.objectHas(paramsMap, env) then paramsMap[env] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> error <span class="hljs-string"><span class="hljs-string">'environment '</span></span> + env + <span class="hljs-string"><span class="hljs-string">' not defined in '</span></span> + std.thisFile</code> </pre> <br><p>        <strong>deploy/website/environments/review.libsonnet</strong> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// this file has the param overrides for the default environment local base = import './base.libsonnet'; local slug = std.extVar('qbec.io/tag'); local subdomain = std.extVar('subdomain'); base { components+: { website+: { name: 'example-docs-' + slug, domain: subdomain + '.docs.example.org', }, }, }</span></span></code> </pre> <br><p>       <strong>stop_review</strong> ,         gitlab    checkout    <strong>GIT_STRATEGY: none</strong> ,    <strong>master</strong> -   review  . <br>  ,        . <br>       review   ,     . </p><br><p>     : </p><br><pre> <code class="plaintext hljs">git add . git commit -m "Enable automatic review"</code> </pre> <br><p> <strong>git push</strong> , <strong>git checkout -b test</strong> , <strong>git push origin test</strong> , : </p><br><div class="spoiler"> <b class="spoiler_title">  environments  Gitlab</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wc/pz/ce/wcpzcedcwgfqvr0h_thgcw4ylqk.png"></p></div></div><br><p>  ? â€” ,    : <strong>git checkout master</strong> , <strong>git push origin :test</strong> ,      environment   . </p><br><blockquote>    ,        ,     <strong>.gitlab-ci.yml</strong>       . <br>          protected-,   <strong>master</strong> ,        . </blockquote><br><hr><br><h1 id="13-review-appsanchorreview-appsanchor"> 13. Review Apps <a name="review-apps"></a></h1><br><p> <strong><a href="https://docs.gitlab.com/ee/ci/review_apps/" rel="nofollow">Review Apps</a></strong>    ,                . </p><br><p>      ,    <strong>.gitlab/route-map.yml</strong>       ,       : </p><br><pre> <code class="plaintext hljs"># Indices - source: /content\/(.+?)_index\.(md|html)/ public: '\1' # Pages - source: /content\/(.+?)\.(md|html)/ public: '\1/'</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs">git add .gitlab/ git commit -m "Enable review apps"</code> </pre> <br><p> <strong>git push</strong> ,  : </p><br><div class="spoiler"> <b class="spoiler_title">  Review App</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ns/wi/za/nswizajvjjozyoluazo21pzq7t8.png"></p></div></div><br><h1 id="job-is-done"> Job is done! </h1><br><p> <strong> :</strong> </p><br><ul><li>  Gitlab: <a href="" rel="nofollow">https://gitlab.com/kvaps/docs.example.org</a> </li><li>  GitHub: <a href="" rel="nofollow">https://github.com/kvaps/docs.example.org</a> </li></ul><br><p>   ,    <img src="https://habrastorage.org/getpro/habr/post_images/cd7/2c7/9c3/cd72c79c3eeb7355e20bba58e9088654.gif" alt="gambar"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481662/">https://habr.com/ru/post/id481662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481644/index.html">Bagaimana cara bertahan hidup database SQL di abad ke-21: cloud, Kubernetes dan PostgreSQL multimaster</a></li>
<li><a href="../id481648/index.html">Junos PyEZ pada contoh tugas menemukan subnet ipv4 gratis</a></li>
<li><a href="../id481652/index.html">Backdoor (?) Di smartphone Android BlackBerry</a></li>
<li><a href="../id481654/index.html">Kisah bagaimana QA Engineer membuat hidup Anda lebih mudah dengan bantuan Test IT, menggunakan Bot Framework</a></li>
<li><a href="../id481656/index.html">PagerDuty, atau Mengapa Departemen Operasi Mungkin Tidak Tidur di Malam Hari</a></li>
<li><a href="../id481664/index.html">Harga dan biaya tanpa server: AWS Lambda</a></li>
<li><a href="../id481666/index.html">Aturan SwiftLint Kustom</a></li>
<li><a href="../id481668/index.html">Masalah pemirsa pertama, atau kesulitan mengkonversi aliran video WebRTC ke HLS</a></li>
<li><a href="../id481670/index.html">Buat rencana tindakan menggunakan AWS Cloud Adoption Framework</a></li>
<li><a href="../id481672/index.html">Automata seluler di browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>