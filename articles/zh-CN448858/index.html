<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš¶ğŸ» ğŸš ğŸ’© åœæ­¢ä¸ºæ­¤ä½¿ç”¨Ngrx /ç‰¹æ•ˆ â›±ï¸ ğŸ‘©ğŸ½â€ğŸ¨ ğŸ‘§ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ‰æ—¶ï¼Œæœ€ç®€å•çš„åŠŸèƒ½å®ç°æœ€ç»ˆä¼šå¸¦æ¥å¼Šå¤§äºåˆ©çš„é—®é¢˜ï¼Œåªä¼šå¢åŠ å…¶ä»–åœ°æ–¹çš„å¤æ‚æ€§ã€‚ æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªæ²¡äººå¸Œæœ›æ¥è§¦çš„é”¯é½¿çŠ¶æ¶æ„ã€‚ 

 ç¿»è¯‘ç¬”è®° 

 è¿™ç¯‡æ–‡ç« å†™äº2017å¹´ï¼Œä½†ä¸ä»Šå¤©æœ‰å…³ã€‚ å®ƒé¢å‘æœ‰RxJSå’ŒNgrxç»éªŒçš„äººå‘˜ï¼Œæˆ–è€…æƒ³åœ¨Angularä¸­å°è¯•Reduxçš„äººå‘˜ã€‚ 
 è¿™äº›ä»£ç ç‰‡æ®µæ˜¯æ ¹æ®å½“å‰çš„RxJ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœæ­¢ä¸ºæ­¤ä½¿ç”¨Ngrx /ç‰¹æ•ˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448858/"><img src="https://habrastorage.org/webt/73/82/fl/7382flctc9zmk_xd-mox_6ahrru.jpeg" alt="åŠèº«åƒ"><br><br> æœ‰æ—¶ï¼Œæœ€ç®€å•çš„åŠŸèƒ½å®ç°æœ€ç»ˆä¼šå¸¦æ¥å¼Šå¤§äºåˆ©çš„é—®é¢˜ï¼Œåªä¼šå¢åŠ å…¶ä»–åœ°æ–¹çš„å¤æ‚æ€§ã€‚ æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªæ²¡äººå¸Œæœ›æ¥è§¦çš„é”¯é½¿çŠ¶æ¶æ„ã€‚ <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">ç¿»è¯‘ç¬”è®°</b> <div class="spoiler_text"><p> è¿™ç¯‡æ–‡ç« å†™äº2017å¹´ï¼Œä½†ä¸ä»Šå¤©æœ‰å…³ã€‚ å®ƒé¢å‘æœ‰RxJSå’ŒNgrxç»éªŒçš„äººå‘˜ï¼Œæˆ–è€…æƒ³åœ¨Angularä¸­å°è¯•Reduxçš„äººå‘˜ã€‚ </p><br> è¿™äº›ä»£ç ç‰‡æ®µæ˜¯æ ¹æ®å½“å‰çš„RxJSè¯­æ³•è¿›è¡Œæ›´æ–°çš„ï¼Œå¹¶è¿›è¡Œäº†å°‘è®¸ä¿®æ”¹ä»¥æé«˜å¯è¯»æ€§å’Œæ˜“æ‡‚æ€§ã€‚ <br></div></div><br><p> Ngrx / storeæ˜¯ä¸€ä¸ªAngularåº“ï¼Œæœ‰åŠ©äºåŒ…å«å•ä¸ªå‡½æ•°çš„å¤æ‚æ€§ã€‚ åŸå› ä¹‹ä¸€æ˜¯ngrx / storeåŒ…å«å‡½æ•°å¼ç¼–ç¨‹ï¼Œè¿™é™åˆ¶äº†å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æ‰§è¡Œçš„æ“ä½œï¼Œä»¥åœ¨å‡½æ•°å¤–éƒ¨å®ç°æ›´å¤šçš„åˆç†æ€§ã€‚ åœ¨ngrx / storeä¸­ï¼Œè¯¸å¦‚reducersï¼ˆä»¥ä¸‹ç§°ä¸ºreducersï¼‰ï¼Œé€‰æ‹©å™¨ï¼ˆä»¥ä¸‹ç§°ä¸ºSelectorï¼‰å’ŒRxJSè¿ç®—ç¬¦ä¹‹ç±»çš„ä¸œè¥¿éƒ½æ˜¯çº¯å‡½æ•°ã€‚ </p><br><p> çº¯å‡½æ•°æ›´æ˜“äºæµ‹è¯•ï¼Œè°ƒè¯•ï¼Œåˆ†æï¼Œå¹¶è¡ŒåŒ–å’Œç»„åˆã€‚ åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œå‡½æ•°æ˜¯å¹²å‡€çš„ï¼š </p><br><ul><li> ä½¿ç”¨ç›¸åŒçš„è¾“å…¥ï¼Œå®ƒæ€»æ˜¯è¿”å›ç›¸åŒçš„è¾“å‡ºï¼› </li><li> æ²¡æœ‰å‰¯ä½œç”¨ã€‚ </li></ul><br><p> å‰¯ä½œç”¨æ˜¯æ— æ³•é¿å…çš„ï¼Œä½†æ˜¯å®ƒä»¬è¢«éš”ç¦»åœ¨ngrx / storeä¸­ï¼Œå› æ­¤åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¯èƒ½ç”±çº¯å‡½æ•°ç»„æˆã€‚ </p><br><h3> å‰¯ä½œç”¨ </h3><br><p> å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæ›´æ”¹ã€‚ æ›´æ”¹æœåŠ¡å™¨å¹¶å“åº”å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªå‰¯ä½œç”¨ã€‚ å¯ä»¥åœ¨ç»„ä»¶ä¸­å¤„ç†ï¼š </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SAVE_DATA'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: data, }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.saveData(data) <span class="hljs-comment"><span class="hljs-comment">// POST    .pipe(map(res =&gt; this.store.dispatch({ type: 'DATA_SAVED' }))) .subscribe();</span></span></code> </pre> <br><p> å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·æäº¤è¡¨å•å¹¶åœ¨å…¶ä»–åœ°æ–¹å¤„ç†å‰¯ä½œç”¨æ—¶ï¼Œå°±å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨åˆ†æ´¾åŠ¨ä½œï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºåŠ¨ä½œï¼‰ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚ </p><br><p>  Ngrx / effectæ˜¯ç”¨äºå¤„ç†ngrx / storeä¸­çš„å‰¯ä½œç”¨çš„ä¸­é—´ä»¶ã€‚ å®ƒåœ¨å¯è§‚å¯Ÿçº¿ç¨‹ä¸­ä¾¦å¬æäº¤çš„æ“ä½œï¼Œæ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¹¶ç«‹å³æˆ–å¼‚æ­¥è¿”å›æ–°æ“ä½œã€‚ è¿”å›çš„åŠ¨ä½œå°†ä¼ é€’ç»™å‡é€Ÿå™¨ã€‚ </p><br><p> ä»¥RxJSæ–¹å¼å¤„ç†å‰¯ä½œç”¨çš„èƒ½åŠ›ä½¿ä»£ç æ›´æ•´æ´ã€‚ ä»ç»„ä»¶å‘é€åˆå§‹åŠ¨ä½œ<code>SAVE_DATA</code>ä¹‹åï¼Œæ‚¨å°†åˆ›å»ºä¸€ä¸ªæ•ˆæœç±»æ¥å¤„ç†å…¶ä½™çš„åŠ¨ä½œï¼š </p><br><pre> <code class="javascript hljs">@Effect() saveData$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'SAVE_DATA'</span></span>), pluck(<span class="hljs-string"><span class="hljs-string">'payload'</span></span>), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.saveData(data)), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'DATA_SAVED'</span></span> })), );</code> </pre><br><p> è¿™ç®€åŒ–äº†ç»„ä»¶çš„æ“ä½œï¼Œä»…åœ¨å‘é€æ“ä½œå’Œè®¢é˜…å¯è§‚å¯Ÿçš„æ“ä½œä¹‹å‰ã€‚ </p><br><h2> æ˜“äºæ»¥ç”¨Ngrx /æ•ˆæœ </h2><br><p>  Ngrx / effectsæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤å¾ˆå®¹æ˜“æ»¥ç”¨ã€‚ è¿™æ˜¯Ngrx / effectç®€åŒ–çš„ä¸€äº›å¸¸è§ngrx / storeåæ¨¡å¼ï¼š </p><br><h3>  1.é‡å¤çŠ¶æ€ </h3><br><p> å‡è®¾æ‚¨æ­£åœ¨æŸç§å¤šåª’ä½“åº”ç”¨ç¨‹åºä¸Šå·¥ä½œï¼Œå¹¶ä¸”åœ¨çŠ¶æ€æ ‘ä¸­å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface State { <span class="hljs-attr"><span class="hljs-attr">mediaPlaying</span></span>: boolean; audioPlaying: boolean; videoPlaying: boolean; }</code> </pre><br><p> ç”±äºéŸ³é¢‘æ˜¯ä¸€ç§åª’ä½“ï¼Œå› æ­¤åªè¦<code>audioPlaying</code>ä¸ºtrueï¼Œ <code>mediaPlaying</code>ä¹Ÿåº”ä¸ºtrueã€‚ æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼šâ€œå¦‚ä½•åœ¨audioPlayingæ›´æ–°æ—¶ç¡®ä¿mediaPlayingæ›´æ–°ï¼Ÿâ€ </p><br><p>  <b>æ— æ•ˆç­”æ¡ˆ</b> ï¼šä½¿ç”¨Ngrx /ç‰¹æ•ˆï¼ </p><br><pre> <code class="javascript hljs">@Effect() playMediaWithAudio$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'PLAY_AUDIO'</span></span>), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'PLAY_MEDIA'</span></span> })), );</code> </pre><br><p>  <b>æ­£ç¡®çš„ç­”æ¡ˆæ˜¯</b> ï¼šå¦‚æœ<code>mediaPlaying</code>çš„çŠ¶æ€å®Œå…¨ç”±çŠ¶æ€æ ‘çš„å¦ä¸€éƒ¨åˆ†é¢„æµ‹ï¼Œåˆ™è¿™ä¸æ˜¯çœŸå®çŠ¶æ€ã€‚ è¿™æ˜¯ä¸€ä¸ªæ´¾ç”ŸçŠ¶æ€ã€‚ å®ƒå±äºé€‰æ‹©å™¨ï¼Œè€Œä¸æ˜¯å•†åº—ã€‚ </p><br><pre> <code class="javascript hljs">audioPlaying$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.select(<span class="hljs-string"><span class="hljs-string">'audioPlaying'</span></span>); videoPlaying$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.select(<span class="hljs-string"><span class="hljs-string">'videoPlaying'</span></span>); mediaPlaying$ = combineLatest(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.audioPlaying$, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.videoPlaying$).pipe( map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[audioPlaying, videoPlaying]</span></span></span><span class="hljs-function">) =&gt;</span></span> audioPlaying || videoPlaying), );</code> </pre><br><p> ç°åœ¨æˆ‘ä»¬çš„ç—…æƒ…å¯ä»¥ä¿æŒæ¸…æ´å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­£å¸¸åŒ–</a> ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ä¼šå°†Ngrx /ç‰¹æ•ˆç”¨äºéå‰¯ä½œç”¨ã€‚ </p><br><h3>  2.ä¸å‡é€Ÿå™¨çš„è¿é”åŠ¨ä½œ </h3><br><p> æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨åœ¨çŠ¶æ€æ ‘ä¸­å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface State { <span class="hljs-attr"><span class="hljs-attr">items</span></span>: { [index: number]: Item }; favoriteItems: number[]; }</code> </pre><br><p> ç„¶åï¼Œç”¨æˆ·åˆ é™¤è¯¥é¡¹ç›®ã€‚ è¿”å›åˆ é™¤è¯·æ±‚åï¼Œå°†å‘é€<code>DELETE_ITEM_SUCCESS</code>æ“ä½œä»¥æ›´æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚ åœ¨<code>items</code>ç¼©å‡å™¨ä¸­ï¼Œå•ä¸ª<code>Item</code>ä»<code>items</code>å¯¹è±¡ä¸­åˆ é™¤ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ­¤å…ƒç´ æ ‡è¯†ç¬¦ä½äº<code>favoriteItems</code>æ•°ç»„ä¸­ï¼Œåˆ™å®ƒæ‰€å¼•ç”¨çš„å…ƒç´ å°†ä¸å­˜åœ¨ã€‚ æ‰€ä»¥é—®é¢˜æ˜¯ï¼Œåœ¨å‘é€<code>DELETE_ITEM_SUCCESS</code>æ“ä½œæ—¶ï¼Œå¦‚ä½•ç¡®ä¿ä»<code>favoriteItems</code>åˆ é™¤æ ‡è¯†ç¬¦ï¼Ÿ </p><br><p>  <b>æ— æ•ˆç­”æ¡ˆ</b> ï¼šä½¿ç”¨Ngrx /ç‰¹æ•ˆï¼ </p><br><pre> <code class="javascript hljs">@Effect() removeFavoriteItemId$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'DELETE_ITEM_SUCCESS'</span></span>), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'REMOVE_FAVORITE_ITEM_ID'</span></span> })), );</code> </pre><br><p> å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬å°†æœ‰ä¸¤ä¸ªåŠ¨ä½œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€ï¼Œä¸¤ä¸ªå‡é€Ÿå™¨ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿”å›æ–°çŠ¶æ€ã€‚ </p><br><p>  <b>æ­£ç¡®ç­”æ¡ˆ</b> ï¼š <code>DELETE_ITEM_SUCCESS</code>å¯ä»¥ç”±<code>items</code> reducerå’Œ<code>favoriteItems</code> reducerè¿›è¡Œå¤„ç†ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">favoriteItemsReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action: Action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'REMOVE_FAVORITE_ITEM'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'DELETE_ITEM_SUCCESS'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> itemId = action.payload; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function"> =&gt;</span></span> id !== itemId); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre><br><p> è¯¥è¡ŒåŠ¨çš„ç›®æ ‡æ˜¯å°†å‘ç”Ÿçš„æƒ…å†µä¸çŠ¶æ€åº”å¦‚ä½•å˜åŒ–åˆ†å¼€ã€‚ å‘ç”Ÿäº†ä»€ä¹ˆäº‹<code>DELETE_ITEM_SUCCESS</code> ã€‚ å‡é€Ÿå™¨çš„ä»»åŠ¡æ˜¯å¼•èµ·çŠ¶æ€çš„ç›¸åº”å˜åŒ–ã€‚ </p><br><p> ä»<code>favoriteItems</code> <code>Item</code>ä¸­åˆ é™¤æ ‡è¯†ç¬¦å¹¶ä¸æ˜¯åˆ é™¤<code>Item</code>å‰¯ä½œç”¨ã€‚ æ•´ä¸ªè¿‡ç¨‹æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œå¯ä»¥ç”±å‡é€Ÿå™¨å¤„ç†ã€‚ ä¸éœ€è¦Ngrx /ç‰¹æ•ˆã€‚ </p><br><h3>  3.è¯·æ±‚ç»„ä»¶æ•°æ® </h3><br><p> æ‚¨çš„ç»„ä»¶éœ€è¦ä»å­˜å‚¨ä¸­è·å–æ•°æ®ï¼Œä½†æ˜¯é¦–å…ˆæ‚¨éœ€è¦ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚ é—®é¢˜æ˜¯ï¼Œå¦‚ä½•å°†æ•°æ®æ”¾å…¥å­˜å‚¨ä¸­ï¼Œä»¥ä¾¿ç»„ä»¶å¯ä»¥æ¥æ”¶æ•°æ®ï¼Ÿ </p><br><p>  <b>ç—›è‹¦çš„æ–¹å¼</b> ï¼šä½¿ç”¨Ngrx /ç‰¹æ•ˆï¼ </p><br><p> åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å‘é€æ“ä½œæ¥å‘èµ·è¯·æ±‚ï¼š </p><br><pre> <code class="javascript hljs">ngOnInit() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET_USERS'</span></span> }); }</code> </pre><br><p> åœ¨æ•ˆæœç±»ä¸­ï¼Œæˆ‘ä»¬å¬<code>GET_USERS</code> ï¼š </p><br><pre> <code class="javascript hljs">@Effect getUsers$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'GET_USERS'</span></span>), withLatestFrom(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userSelectors.needUsers$), filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[action, needUsers]</span></span></span><span class="hljs-function">) =&gt;</span></span> needUsers), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getUsers()), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'RECEIVE_USERS'</span></span>, users })), );</code> </pre><br><p> ç°åœ¨ï¼Œå‡è®¾ç”¨æˆ·è®¤ä¸ºæŸæ¡è·¯çº¿çš„åŠ è½½æ—¶é—´å¤ªé•¿ï¼Œé‚£ä¹ˆä»–å°†ä»ä¸€æ¡è·¯çº¿åˆ‡æ¢åˆ°å¦ä¸€æ¡è·¯çº¿ã€‚ ä¸ºäº†æé«˜æ•ˆç‡å¹¶é¿å…åŠ è½½ä¸å¿…è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›å–æ¶ˆæ­¤è¯·æ±‚ã€‚ å½“ç»„ä»¶è¢«é”€æ¯æ—¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡å‘é€æ“ä½œé€€è®¢è¯·æ±‚ï¼š </p><br><pre> <code class="javascript hljs">ngOnDestroy() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'CANCEL_GET_USERS'</span></span> }); }</code> </pre><br><p> ç°åœ¨ï¼Œåœ¨effectsç±»ä¸­ï¼Œæˆ‘ä»¬å¬ä¸¤ç§åŠ¨ä½œï¼š </p><br><pre> <code class="javascript hljs">@Effect getUsers$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'GET_USERS'</span></span>, <span class="hljs-string"><span class="hljs-string">'CANCEL_GET_USERS'</span></span>), withLatestFrom(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userSelectors.needUsers$), filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[action, needUsers]</span></span></span><span class="hljs-function">) =&gt;</span></span> needUsers), map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[action, needUsers]</span></span></span><span class="hljs-function">) =&gt;</span></span> action), switchMap( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> action.type === <span class="hljs-string"><span class="hljs-string">'CANCEL_GET_USERS'</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>() : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getUsers().pipe(map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'RECEIVE_USERS'</span></span>, users }))), ), );</code> </pre><br><p> å¥½å•Š ç°åœ¨ï¼Œå¦ä¸€ä¸ªå¼€å‘äººå‘˜æ·»åŠ äº†ä¸€ä¸ªéœ€è¦ç›¸åŒHTTPè¯·æ±‚çš„ç»„ä»¶ï¼ˆæˆ‘ä»¬ä¸ä¼šå¯¹å…¶ä»–ç»„ä»¶åšä»»ä½•å‡è®¾ï¼‰ã€‚ ç»„ä»¶åœ¨ç›¸åŒçš„ä½ç½®å‘é€ç›¸åŒçš„åŠ¨ä½œã€‚ å¦‚æœä¸¤ä¸ªç»„ä»¶åŒæ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™ç¬¬ä¸€ä¸ªç»„ä»¶å°†å‘èµ·HTTPè¯·æ±‚ä»¥å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚ å½“ç¬¬äºŒä¸ªç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å¤šä½™çš„äº‹æƒ…ï¼Œå› ä¸º<code>needUsers</code>å°†ä¸º<code>false</code> ã€‚ å¤ªå¥½äº†ï¼ </p><br><p> ç„¶åï¼Œå½“ç¬¬ä¸€ä¸ªç»„ä»¶è¢«ç ´åæ—¶ï¼Œå®ƒå°†å‘é€<code>CANCEL_GET_USERS</code> ã€‚ ä½†æ˜¯ç¬¬äºŒä¸ªç»„ä»¶ä»ç„¶éœ€è¦æ­¤æ•°æ®ã€‚ æˆ‘ä»¬å¦‚ä½•é˜²æ­¢è¯·æ±‚è¢«å–æ¶ˆï¼Ÿ ä¹Ÿè®¸æˆ‘ä»¬å°†å¯åŠ¨æ‰€æœ‰è®¢é˜…è€…çš„è®¡æ•°å™¨ï¼Ÿ æˆ‘ä¸ä¼šå®ç°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘æƒ³æ‚¨ç†è§£è¿™ä¸€ç‚¹ã€‚ æˆ‘ä»¬å¼€å§‹æ€€ç–‘æœ‰æ›´å¥½çš„æ–¹æ³•æ¥ç®¡ç†è¿™äº›æ•°æ®ä¾èµ–é¡¹ã€‚ </p><br><p> ç°åœ¨å‡è®¾å‡ºç°äº†å¦ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå–å†³äºåœ¨<code>users</code>æ•°æ®å‡ºç°åœ¨å­˜å‚¨ä¸­ä¹‹å‰æ— æ³•æ£€ç´¢çš„æ•°æ®ã€‚ è¿™å¯èƒ½æ˜¯ç”¨äºèŠå¤©çš„Webå¥—æ¥å­—çš„è¿æ¥ï¼Œæœ‰å…³æŸäº›ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯æˆ–å…¶ä»–å†…å®¹ã€‚ æˆ‘ä»¬ä¸çŸ¥é“åœ¨å‘<code>users</code>è®¢é˜…å…¶ä»–ä¸¤ä¸ªç»„ä»¶ä¹‹å‰æˆ–ä¹‹åå°†åˆå§‹åŒ–æ­¤ç»„ä»¶ã€‚ </p><br><p> å¯¹äºè¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘å‘ç°çš„æœ€ä½³å¸®åŠ©å°±æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç« </a> ã€‚ åœ¨ä»–çš„ç¤ºä¾‹ä¸­ï¼Œ <code>callApiY</code>è¦æ±‚<code>callApiX</code>å·²ç»å®Œæˆã€‚ æˆ‘åˆ é™¤äº†è¯„è®ºä»¥ä½¿å…¶çœ‹èµ·æ¥ä¸é‚£ä¹ˆå“äººï¼Œä½†è¯·éšæ—¶é˜…è¯»åŸå§‹æ–‡ç« ä»¥äº†è§£æ›´å¤šä¿¡æ¯ï¼š </p><br><pre> <code class="javascript hljs">@Effect() actionX$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'ACTION_X'</span></span>), map(toPayload), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.api.callApiX(payload).pipe( map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_X_SUCCESS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: data })), catchError(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_X_FAIL'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: err })), ), ), ); @Effect() actionY$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'ACTION_Y'</span></span>), map(toPayload), withLatestFrom(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.select(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state.someBoolean)), switchMap(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[payload, someBoolean]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> callHttpY = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.api.callApiY(v).pipe( map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_Y_SUCCESS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: data, })), catchError(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_Y_FAIL'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: err, }), ), ); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (someBoolean) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callHttpY(payload); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_X'</span></span>, payload }).merge( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions$.pipe( ofType(<span class="hljs-string"><span class="hljs-string">'ACTION_X_SUCCESS'</span></span>, <span class="hljs-string"><span class="hljs-string">'ACTION_X_FAIL'</span></span>), first(), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'ACTION_X_FAIL'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ACTION_Y_FAIL'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'Because ACTION_X failed.'</span></span>, }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callHttpY(payload); }), ), ); }), );</code> </pre><br><p> ç°åœ¨æ·»åŠ ä¸€ä¸ªè¦æ±‚ï¼Œå³å½“ç»„ä»¶ä¸å†éœ€è¦HTTPè¯·æ±‚æ—¶ï¼Œåº”å°†å…¶å–æ¶ˆï¼Œè¿™å°†å˜å¾—æ›´åŠ å¤æ‚ã€‚ </p><br><h3><pre>  ã€‚  ã€‚  ã€‚ </pre></h3><br><p> é‚£ä¹ˆï¼Œå½“RxJSçœŸæ­£ä½¿å®ƒå˜å¾—ç®€å•æ—¶ï¼Œä¸ºä»€ä¹ˆæ•°æ®ä¾èµ–ç®¡ç†å­˜åœ¨è¿™ä¹ˆå¤šé—®é¢˜ï¼Ÿ </p><br><p> å°½ç®¡ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œæ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼ŒNgrx /æ•ˆæœå¹¶ä¸æ˜¯å¤„ç†æ­¤é—®é¢˜çš„æœ€ä½³æ–¹æ³•ã€‚ </p><br><p> ç»„ä»¶æ˜¯ç”¨æˆ·è¾“å…¥/è¾“å‡ºæ¥å£ã€‚ å®ƒä»¬æ˜¾ç¤ºæ•°æ®å¹¶å‘é€ä»–æ‰§è¡Œçš„åŠ¨ä½œã€‚ åŠ è½½ç»„ä»¶æ—¶ï¼Œå®ƒä¸ä¼šå‘é€è¯¥ç”¨æˆ·æ‰§è¡Œçš„ä»»ä½•æ“ä½œã€‚ ä»–æƒ³æ˜¾ç¤ºæ•°æ®ã€‚ è¿™æ›´åƒæ˜¯è®¢é˜…ï¼Œè€Œä¸æ˜¯å‰¯ä½œç”¨ã€‚ </p><br><p> å¾ˆå¤šæ—¶å€™ï¼Œæ‚¨ä¼šçœ‹åˆ°ä½¿ç”¨åŠ¨ä½œæ¥å¯åŠ¨æ•°æ®è¯·æ±‚çš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›åº”ç”¨ç¨‹åºå®ç°äº†ä¸€ä¸ªç‰¹æ®Šçš„ç•Œé¢ï¼Œå¯ä»¥é€šè¿‡å‰¯ä½œç”¨è¿›è¡Œè§‚å¯Ÿã€‚ è€Œä¸”ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæ­¤ç•Œé¢å¯èƒ½ä¼šå˜å¾—éå¸¸ä¸ä¾¿å’Œéº»çƒ¦ã€‚ è®¢é˜…ï¼Œé€€è®¢å’Œè¿æ¥å¯è§‚å¯Ÿçš„å¯¹è±¡è¦å®¹æ˜“å¾—å¤šã€‚ </p><br><h3><pre>  ã€‚  ã€‚  ã€‚ </pre></h3><br><p>  <b>å‡è½»ç—›è‹¦çš„æ–¹å¼</b> ï¼šç»„ä»¶å°†é€šè¿‡å¯è§‚å¯Ÿçš„æ–¹å¼è®¢é˜…æ•°æ®ï¼Œä»è€Œå¯¹æ•°æ®æ„Ÿå…´è¶£ã€‚ </p><br><p> æˆ‘ä»¬å°†åˆ›å»ºå¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å¿…è¦çš„HTTPè¯·æ±‚ã€‚ æˆ‘ä»¬å°†çœ‹åˆ°ä½¿ç”¨çº¯RxJSè€Œä¸æ˜¯é€šè¿‡æ•ˆæœæ¥ç®¡ç†å½¼æ­¤ä¾èµ–çš„å¤šä¸ªè®¢é˜…å’ŒæŸ¥è¯¢é“¾è¦å®¹æ˜“å¾—å¤šã€‚ </p><br><p> åœ¨æœåŠ¡ä¸­åˆ›å»ºä»¥ä¸‹å¯è§‚å¯Ÿåˆ°çš„å†…å®¹ï¼š </p><br><pre> <code class="javascript hljs">requireUsers$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe( select(selectNeedUser), filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">needUsers</span></span></span><span class="hljs-function"> =&gt;</span></span> needUsers), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET_USERS'</span></span> })), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getUsers()), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'RECEIVE_USERS'</span></span>, users })), finalize(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'CANCEL_GET_USERS'</span></span> })), share(), ); users$ = muteFirst( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.requireUsers$.pipe(startWith(<span class="hljs-literal"><span class="hljs-literal">null</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe(select(selectUsers)), );</code> </pre><br><p> å¯¹<code>users$</code>è®¢é˜…å°†åŒæ—¶å‘é€åˆ°<code>requireUsers$</code>å’Œ<code>this.store.pipe(select(selectUsers))</code> ï¼Œä½†æ˜¯ä»…ä»<code>this.store.pipe(select(selectUsers))</code>æ¥æ”¶æ•°æ®ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>muteFirst</code></a>å®ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>muteFirst</code></a>å’Œå›ºå®š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>muteFirst</code></a>ç»è¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¥¹çš„æµ‹è¯•</a> ã€‚ï¼‰ </p><br><p> åœ¨ç»„ä»¶ä¸­ï¼š </p><br><pre> <code class="javascript hljs">ngOnInit() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userService.users$; }</code> </pre><br><p> ç”±äºç°åœ¨å¯ä»¥è½»æ¾è§‚å¯Ÿåˆ°è¿™ç§æ•°æ®ä¾èµ–å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>async</code>ç®¡é“åœ¨æ¨¡æ¿ä¸­è¿›è¡Œè®¢é˜…å’Œé€€è®¢ï¼Œå¹¶ä¸”ä¸å†éœ€è¦å‘é€æ“ä½œã€‚ å¦‚æœåº”ç”¨ç¨‹åºç•™ä¸‹äº†æœ€åä¸€ä¸ªä¸ºæ•°æ®ç­¾åçš„ç»„ä»¶çš„è·¯ç”±ï¼Œåˆ™ä¼šå–æ¶ˆHTTPè¯·æ±‚æˆ–å…³é—­Webå¥—æ¥å­—ã€‚ </p><br><p> æ•°æ®ä¾èµ–é“¾å¯ä»¥è¿™æ ·å¤„ç†ï¼š </p><br><pre> <code class="javascript hljs">requireUsers$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe( select(selectNeedUser), filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">needUsers</span></span></span><span class="hljs-function"> =&gt;</span></span> needUsers), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET_USERS'</span></span> })), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getUsers()), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'RECEIVE_USERS'</span></span>, users })), share(), ); users$ = muteFirst( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.requireUsers$.pipe(startWith(<span class="hljs-literal"><span class="hljs-literal">null</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe(select(selectUsers)), ); requireUsersExtraData$ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users$.pipe( withLatestFrom(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe(select(selectNeedUsersExtraData))), filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[users, needData]</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>(users.length) &amp;&amp; needData), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET_USERS_EXTRA_DATA'</span></span> })), switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getUsers()), tap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'RECEIVE_USERS_EXTRA_DATA'</span></span>, users, }), ), share(), ); public usersExtraData$ = muteFirst( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.requireUsersExtraData$.pipe(startWith(<span class="hljs-literal"><span class="hljs-literal">null</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.pipe(select(selectUsersExtraData)), );</code> </pre><br><p> è¿™æ˜¯ä¸Šè¿°æ–¹æ³•ä¸æ­¤æ–¹æ³•çš„å¹³è¡Œæ¯”è¾ƒï¼š </p><br><img src="https://habrastorage.org/webt/xd/cb/ho/xdcbhozsjus5vu64eqp9x8nsnuy.png" alt="å¹³è¡Œæ¯”è¾ƒ"><br><br><p> ä½¿ç”¨çº¯å¯è§‚å¯Ÿçš„ä»£ç éœ€è¦æ›´å°‘çš„ä»£ç è¡Œï¼Œå¹¶ä¸”è‡ªåŠ¨å–æ¶ˆäº†æ•´ä¸ªé“¾ä¸­å¯¹æ•°æ®çš„ä¾èµ–ã€‚  ï¼ˆä¸ºäº†ä½¿æ¯”è¾ƒæ›´å®¹æ˜“ç†è§£ï¼Œæˆ‘è·³è¿‡äº†æœ€åˆåŒ…å«çš„<code>finalize</code>è¯­å¥ï¼Œä½†æ˜¯å³ä½¿æ²¡æœ‰å®ƒä»¬ï¼ŒæŸ¥è¯¢ä¹Ÿå°†ç›¸åº”åœ°è¢«å–æ¶ˆã€‚ï¼‰ </p><br><img src="https://habrastorage.org/webt/mj/2m/pc/mj2mpclzeric84dwrap4c5fpkqm.jpeg" alt="åƒé¸¡å°¾é…’ä¸­çš„æ¨±æ¡ƒä¸€æ ·çš„æ•ˆæœ"><br><br><h2> ç»“è®º </h2><br><p>  Ngrx /ç‰¹æ•ˆæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼ ä½†æ˜¯åœ¨ä½¿ç”¨å®ƒä¹‹å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š </p><br><ul><li> è¿™çœŸçš„æ˜¯å‰¯ä½œç”¨å—ï¼Ÿ </li><li>  Ngrx / effectsæ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„æœ€ä½³æ–¹æ³•å—ï¼Ÿ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448858/">https://habr.com/ru/post/zh-CN448858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448842/index.html">éœå°¼éŸ¦å°”HAQç©ºæ°”è´¨é‡ç›‘æµ‹ä»ª</a></li>
<li><a href="../zh-CN448846/index.html">åœ¨å¤§å‹å…¬å¸ä¸­å®æ–½æ•æ·æ—¶ï¼Œä¸è¦å¿˜è®°é‡è¦çš„ä¸€ç‚¹</a></li>
<li><a href="../zh-CN448848/index.html">å…³äºä»å®éªŒæ•°æ®ä¸­åˆ é™¤è¶‹åŠ¿</a></li>
<li><a href="../zh-CN448854/index.html">èˆ¹å‘˜é¾™çˆ†ç‚¸</a></li>
<li><a href="../zh-CN448856/index.html">Torfon-åŒ¿åç”µè¯çš„ç§»åŠ¨åº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN448860/index.html">Android Studio 3.4å‘è¡Œè¯´æ˜ï¼ˆ2019å¹´4æœˆï¼‰</a></li>
<li><a href="../zh-CN448866/index.html">ä»æˆå¯¹ï¼ˆç›¸å¯¹ï¼‰æ±‡ç‡åˆ°ç»å¯¹æ±‡ç‡çš„è½¬æ¢çš„è¯¦ç»†ä¿¡æ¯ã€‚ é”™è¯¯å¤„ç†</a></li>
<li><a href="../zh-CN448868/index.html">ï¼ƒ295ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ4æœˆ15æ—¥è‡³21æ—¥ï¼‰</a></li>
<li><a href="../zh-CN448870/index.html">Optlib é—ä¼ ä¼˜åŒ–ç®—æ³•åœ¨Rustä¸­çš„å®ç°</a></li>
<li><a href="../zh-CN448872/index.html">å¯¹è®²äº§å“ç¿»è¯‘ä¹¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>