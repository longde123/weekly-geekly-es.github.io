<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß† üëú üßëüèº Apple Patch-Verlauf üë≥ üëàüèΩ üôéüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Jahr sprachen a1exdandy und ich auf den Konferenzen von VolgaCTF und KazHackStan √ºber Patch Diffing-Programme, die auf Objective-C geschrieb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Patch-Verlauf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/479972/"><p><img src="https://habrastorage.org/webt/wh/kp/c3/whkpc3ybatnoasln45yfqbbvrkc.jpeg" alt="Bild"></p><br><p>  In diesem Jahr sprachen a1exdandy und ich auf den Konferenzen von VolgaCTF und KazHackStan √ºber Patch Diffing-Programme, die auf Objective-C geschrieben wurden, und dar√ºber, wie man damit 0-Tage- und 1-Tage-Schwachstellen in Apple-Produkten sucht und findet.  Sie k√∂nnen das Video der Pr√§sentation <a href="https://youtu.be/G1p0CVNxK28%3Ft%3D5191">hier</a> ansehen und den Artikel lesen, willkommen bei cat. </p><a name="habracut"></a><br><p>  Beim bin√§ren Vergleichen werden zwei ausf√ºhrbare Dateien verglichen, um Gemeinsamkeiten und Unterschiede zwischen ihnen festzustellen.  Patch Diffing ist ein Spezialfall von Binary Diffing, wenn eine Datei mit einer Sicherheitsanf√§lligkeit mit einer festen Datei (Datei mit einem Patch) verglichen wird.  So k√∂nnen Sie herausfinden, welche Korrekturen der Entwickler vorgenommen hat, und die Schwachstelle nachvollziehen. </p><br><p>  Vor einigen Jahren (2013) wurde <a href="https://xakep.ru/issues/xa/169/">ein Artikel</a> √ºber Patch Diffing f√ºr Windows-Programme ver√∂ffentlicht, an dem wir auch beteiligt waren.  Wir empfehlen Ihnen, sich mit diesem Thema vertraut zu machen, wenn Sie sich f√ºr dieses Thema im Zusammenhang mit dem Windows-Betriebssystem interessieren.  Im selben Artikel werden wir √ºber die Analyse von Programmen f√ºr Apple OS sprechen. </p><br><h2 id="chem-mogut-byt-polezny-binary-diffing-i-patch-diffing">  Wie kann Binary Diffing und Patch Diffing n√ºtzlich sein? </h2><br><p>  Die Hauptaufgabe von Binary Diffing besteht darin, zu verfolgen, welche √Ñnderungen an der Anwendung vorgenommen wurden.  Dazu m√ºssen Sie die alte Version mit der neuen vergleichen, um zu sehen, welche √Ñnderungen der Entwickler hinzugef√ºgt hat und wie sie implementiert werden. </p><br><p>  Lassen Sie uns Situationen betrachten, in denen dies n√ºtzlich sein kann: </p><br><ul><li>  <strong>Analyse der Programmentwicklung</strong> : Beim Vergleich der neuen und alten Versionen k√∂nnen Sie nachvollziehen, wie sich die Anwendung entwickelt, welche neuen Funktionen hinzugef√ºgt, welche entfernt und welche √Ñnderungen am vorhandenen Code vorgenommen wurden. </li><li>  <strong>Vorhandenes Wissen importieren</strong> : In Programmen, die keine symbolischen Informationen verwenden, m√ºssen Reverse Engineers viel mehr Zeit damit verbringen, die Logik zu studieren und nach Schwachstellen zu suchen.  Es kommt jedoch vor, dass Entwickler in einigen Versionen der Software versehentlich oder absichtlich symbolische Informationen hinterlassen.  Diese Informationen k√∂nnen von dort auf die von Ihnen ben√∂tigte Softwareversion portiert werden.  <a href="https://googleprojectzero.blogspot.com/2019/10/the-story-of-adobe-reader-symbols.html">Beispielsweise</a> konnten Mitarbeiter von Google Project Zero, die Binary Diffing verwendeten, Zeichen f√ºr neue Windows-Versionen von Adobe Reader aus √§lteren Versionen f√ºr andere Betriebssysteme abrufen, um Schwachstellen zu finden. </li><li> <strong>Schulung zu echter Software</strong> : Patch Diffing ist unserer Meinung nach eine gro√üartige M√∂glichkeit, um reibungslos von der Untersuchung kleiner CTF-Probleme zur Erforschung echter Software √ºberzugehen.  Durch Durchsuchen des Patches k√∂nnen Sie die tats√§chliche Sicherheitsanf√§lligkeit in einem gro√üen Softwareprodukt mit all seinen Funktionen untersuchen (wobei Sie sicher sein m√ºssen, dass die Sicherheitsanf√§lligkeit im Code vorhanden ist).  Indem Sie Fehler in einem Produkt untersuchen, k√∂nnen Sie nach und nach dieselben Sicherheitsanf√§lligkeiten finden.  Als Bonus k√∂nnen Sie versuchen, Exploits f√ºr sie zu schreiben. </li><li>  <strong>Erstellen von 1-Tages-Exploits</strong> : Wenn ein Entwickler bereits einen Patch ver√∂ffentlicht hat, k√∂nnen Sie ihn schnell analysieren, einen Exploit f√ºr diese Sicherheitsanf√§lligkeit schreiben und einen 1-Tages-Exploit erhalten.  Gleichzeitig gibt es das sogenannte Patch Gapping - die Zeit zwischen der Ver√∂ffentlichung des Patches und seiner direkten Installation durch die Clients.  W√§hrend dieser Zeit kann ein eint√§giger Exploit erfolgreich funktionieren und dem Autor zugute kommen (Updates rechtzeitig installieren!), Bis alle den von den Entwicklern ver√∂ffentlichten Patch installiert haben.  Es gibt Situationen, in denen eine Sicherheitsanf√§lligkeit in einer Bibliothek behoben wurde, Programme jedoch weiterhin eine veraltete Version der Bibliothek verwenden.  Hier einige interessante Beispiele f√ºr Patch Gapping f√ºr <a href="https://blog.exodusintel.com/2019/09/09/patch-gapping-chrome/">Chrome</a> und <a href="https://googleprojectzero.blogspot.com/2019/08/jsc-exploits.html">WebKit</a> . </li><li>  <strong>Suche nach 0-Tage-Sicherheitsl√ºcken</strong> : Unabh√§ngig davon, wie seltsam dies bei der Analyse von Patches klingt, k√∂nnen Sie auch zuvor unbekannte Sicherheitsl√ºcken (0-Tage-Sicherheitsl√ºcken) finden.  Entwickler irren sich ebenfalls und daher wird die Sicherheitsanf√§lligkeit beim Erstellen eines Patches m√∂glicherweise nicht ordnungsgem√§√ü geschlossen.  Wenn Sie also ein Patch analysieren, k√∂nnen Sie einen Weg finden, um es zu umgehen.  Zum Beispiel haben Apache Struts-Entwickler f√ºnf Mal eine Sicherheitsl√ºcke behoben, aber der Patch funktionierte nur in der sechsten Version!  Au√üerdem kann es vorkommen, dass ein Entwickler, der die ihm zugewiesene Aufgabe zur Behebung einer bestimmten Sicherheitsanf√§lligkeit eindeutig erf√ºllt, nicht bemerkt, was in benachbarten Abschnitten des Codes geschieht.  Es k√∂nnte genau die gleiche Sicherheitsanf√§lligkeit in der N√§he sein, und im Falle einer Erkennung wird dies 0 Tage dauern.  Es ist wichtig, das Muster eines erkannten Entwicklerfehlers zu untersuchen und zu versuchen, im selben Programm etwas √Ñhnliches zu finden.  Wenn der Entwickler an einer Stelle einen Fehler gemacht hat, ist die Wahrscheinlichkeit gro√ü, dass derselbe Fehler an einer anderen Stelle wiederholt wird. </li></ul><br><p>  Es gibt einen Mythos, dass das Verbergen von Informationen zu Schwachstellen-Patches die Sicherheit erh√∂ht.  In der Regel haben Angreifer jedoch bereits eine Infrastruktur f√ºr die Analyse von Patches entwickelt, sodass sie schnell die Daten finden, an denen sie interessiert sind.  Das Verbergen von Schwachstellen erschwert die Arbeit derjenigen, die f√ºr den Schutz des Systems verantwortlich sind, da ohne vollst√§ndigen Zugriff auf Informationen nicht nachvollziehbar ist, wie wichtig dieser Patch f√ºr das Unternehmen ist.  Zu diesem Thema empfehlen wir dringend, den Artikel <a href="http://addxorrol.blogspot.com/2019/08/rashomon-of-disclosure.html">"Rashomon of Disclosure"</a> des Forschers Halvar Flake zu lesen, in dem die Situation aus verschiedenen Blickwinkeln betrachtet wird. </p><br><p>  Nicht immer entdeckte Schwachstellen werden absichtlich ausgeblendet.  Entwickler legen m√∂glicherweise keinen besonderen Wert auf einige der M√§ngel ihres Produkts und beheben diese, wie bei einem normalen Fehler, ohne Werbung. </p><br><p>  Wir sind sicher, dass dies nicht alle Situationen sind, in denen Sie Binary Diffing und Patch Diffing verwenden k√∂nnen, und in den Kommentaren k√∂nnen Sie Ihre eigenen Skripte schreiben. </p><br><h2 id="instrumentariy">  Toolkit </h2><br><p>  Von der Theorie gehen wir allm√§hlich zur Praxis √ºber.  Binary Diffing manuell durchzuf√ºhren ist nat√ºrlich ein verr√ºcktes Unterfangen.  Es wurde lange ein umfangreiches Toolkit entwickelt, das sowohl eigenst√§ndige Programme als auch Plug-Ins f√ºr g√§ngige Bin√§ranalysatoren umfasst: Diaphora, BinDiff, DarunGrim, YaDiff, Rizzo, Realyze, Turbodiff, Patchdiff2, Rematch und andere. </p><br><p><img src="https://habrastorage.org/webt/ek/ou/r0/ekour0t64vi9hsrnpnvpaqzra6e.png" alt="Bild"><br>  <em>BinDiff-Schnittstelle.</em> </p><br><p><img src="https://habrastorage.org/webt/g_/q_/k1/g_q_k1bg4g_x858ps6k24ywuonk.png" alt="Bild"><br>  <em>Diaphora-Schnittstelle</em> </p><br><p>  In der Praxis verwenden wir haupts√§chlich nur die ersten beiden (sie sind in den obigen Screenshots dargestellt).  Leider sind die meisten der aktuellen Tools entweder nicht von der Qualit√§t der Arbeit angetan oder werden g√§nzlich aufgegeben.  Jetzt gibt es neue Tools, die ML verwenden, aber ihre Qualit√§t l√§sst zu w√ºnschen √ºbrig, obwohl sie interessante Ideen f√ºr den Vergleich von Bin√§rdateien verschiedener Architekturen haben. </p><br><p>  Ich m√∂chte auch die k√ºrzlich erschienenen Tools zum Vergleichen von Open-Source-Code in Bin√§rdateien gesondert erw√§hnen: Pigaios und Karta.  Dies ist eine sehr interessante und n√ºtzliche Richtung.  Sie sammeln Metriken aus dem Quellcode und verwenden sie dann, um Funktionen in Bin√§rdateien zu vergleichen.  Dies ist sehr n√ºtzlich, wenn keine Zeichen und statische Verkn√ºpfungen vorhanden sind.  Die Aufgabe dieser Tools besteht darin, Funktionen in einer Datei Funktionen in einer anderen zuzuordnen. </p><br><h2 id="sravnenie-patchey-dlya-operacionnyh-sistem-apple">  Vergleich von Patches f√ºr Apple-Betriebssysteme </h2><br><p>  In der Regel schreiben Anwendungen f√ºr Apple OS auf Objective-C.  Dies ist eine objektorientierte Erweiterung f√ºr C, die auf Smalltalk-Sprachparadigmen mit eigener Laufzeit basiert. </p><br><p>  Wenn wir das Programm auf Objective-C in einem Bin√§ranalysator √∂ffnen (in unserem Fall IDA), sehen wir so etwas: Funktionen in C / C ++ haben abstrakte Namen, und Funktionen in Objective-C werden sehr sch√∂n aufgerufen.  (Wir werden gleich sagen, dass wir Situationen mit Code-Verschleierung nicht ber√ºcksichtigen - dies ist eine separate Geschichte.) Dies erleichtert den Reverse-Engineering: Es ist leicht zu erkennen, welches Objekt aufgerufen wird, welche Methode verwendet wird und welche Argumente es hat.  Diese symbolischen Informationen vereinfachen auch die Arbeit mit Tools zum Vergleichen von Bin√§rdateien erheblich.  Sie k√∂nnen damit schnell und mit einer minimalen Anzahl von Fehlern Kartenfunktionen ausf√ºhren. </p><br><p><img src="https://habrastorage.org/webt/nc/dc/ri/ncdcrissgbl_y_deb3fx9qaqd9a.png" alt="Bild"></p><br><p>  Wenn keine Symbole vorhanden sind, m√ºssen die Tools interne Algorithmen f√ºr Analyse, Heuristik usw. verwenden.  Nat√ºrlich funktionieren sie nicht immer richtig. </p><br><h2 id="use-cases-gde-patch-diffing-byl-ochen-polezen">  Anwendungsf√§lle, in denen Patch-Differenzen sehr n√ºtzlich waren </h2><br><p>  Wahrscheinlich w√§ren diese Pr√§sentation (im Format von 45 Minuten) und dieser Artikel nicht entstanden, wenn Apple die Weltforschungsgemeinschaft in letzter Zeit nicht mehrmals √ºberrascht h√§tte.  Schauen wir uns diese F√§lle an. </p><br><h3 id="case-1-cve-2019-8606">  Fall 1: CVE-2019-8606 </h3><br><p>  Im Mai 2019 wurde iOS 12.3 f√ºr das iPhone ver√∂ffentlicht, bei dem die Schwachstelle behoben wurde, mit der ein Jailbreak installiert werden konnte.  Im Juli dieses Jahres ver√∂ffentlichte Apple die Version 12.4, in der der Jailbreak wieder funktionierte: Mitarbeiter entfernten versehentlich den Schutzpatch.  Die korrigierte Version wurde erst nach einem Monat ver√∂ffentlicht: W√§hrend dieser ganzen Zeit konnte jedes Ger√§t mit der neuesten Version leicht Jailbreak-Operationen unterzogen werden.  All dies wurde dank Patch-Diffing entdeckt. </p><br><p><img src="https://habrastorage.org/webt/97/ri/gn/97rign6v9ubqzhnwlo3zgc0shre.png" alt="Bild"></p><br><h3 id="case-2-cve-2019-7278-i-cve-2019-7286">  Fall 2: CVE-2019-7278 und CVE-2019-7286 </h3><br><p>  Pers√∂nliche Erfahrungen mit unterschiedlichen Patches bei der Hack-in-the-Box-Konferenz in seinem Bericht Die Neuerstellung <a href="https://gsec.hitb.org/materials/sg2019/D2%2520-%2520Recreating%2520an%2520iOS%25200day%2520Jailbreak%2520Out%2520of%2520Apple%25E2%2580%2599s%2520Security%2520Updates%2520-%2520Stefan%2520Esser.pdf">eines 0-t√§gigen iOS-Jailbreak aus Apples Sicherheitspatches wurde</a> vom Sicherheitsforscher Stefan Esser beschrieben.  Er sprach √ºber CVE-2019-7278 und CVE-2019-7286 - sie sind bemerkenswert f√ºr diejenigen, die dank der Google Threat Analysis Group w√§hrend ihrer tats√§chlichen Verwendung durch Angreifer (ITW, in the wild) entdeckt wurden.  Apple hat Informationen √ºber sie erhalten, aber weder sie noch die Jungs von Google haben technische Details preisgegeben.  Dann fragte sich Stefan, was die Angreifer benutzten.  Wir empfehlen dringend, dass Sie seinen Bericht lesen, da er sich auch mit dem Vergleich von Kernel- und User-Space-Komponenten befasst. <br>  Interessante Tatsache: ein oder zwei Tage vor Stefans Rede ver√∂ffentlichte Project Zero Ian Beer eine Reihe von Artikeln <a href="https://googleprojectzero.blogspot.com/2019/08/a-very-deep-dive-into-ios-exploit.html">"Ein sehr tiefer Einblick in die in freier Wildbahn gefundenen iOS Exploit-Ketten"</a> , die die Karten f√ºr den Forscher etwas verwirrten;) </p><br><h3 id="case-3-checkm8">  Fall 3: checkm8 </h3><br><p>  Apple-Ger√§te verwenden zwei Bootloader: Bootrom und Iboot.  Die erste beginnt zu arbeiten, sobald sich das Ger√§t einschaltet.  Es befindet sich im Nur-Lese-Speicher und kann nicht aktualisiert werden.  Iboot ist ein Bootloader der zweiten Ebene, der die Authentifizierung in der Bootkette verbessert. <br>  Die Besonderheit der Loader ist, dass sie den Code gemeinsam nutzen.  Anfang letzten Jahres verglichen Spezialisten die Updates f√ºr Iboot und stellten fest, dass Apple eine Schwachstelle im USB-Stack behoben hat.  Als sie wussten, dass derselbe Code im nicht aktualisierten Teil von Bootrom verwendet wird, stellten sie fest, dass diese Sicherheitsanf√§lligkeit auch dort besteht.  Dann begann die Entwicklung des checkm8-Exploits.  Jetzt sind alle Ger√§te, die auf Chips von A5 bis A11 basieren (von iPhone 4s bis iPhone X), vollst√§ndig anf√§llig, und es ist m√∂glich, Ihren eigenen Code darauf auszuf√ºhren.  Gleichzeitig ist diese Sicherheitsanf√§lligkeit auf Ger√§ten der Versionen XR und 11 bereits geschlossen, und es gab keine Berichte von Apple dar√ºber. <br>  Wenn du also wei√üt, wo es gepatcht wurde und wie der Code aufgeteilt ist, findest du einige wirklich coole Sachen! </p><br><h2 id="nasha-istoriya-cve-2019-8574">  Unsere Geschichte: CVE-2019-8574 </h2><br><p><img src="https://habrastorage.org/webt/sb/4a/hj/sb4ahjfaar4slhvzgdhshhe6qye.png" alt="Bild"><br>  Im Mai ver√∂ffentlichte Apple ein neues Update f√ºr seine Ger√§te.  Wir haben uns die Liste der behobenen Sicherheitsl√ºcken angesehen und das Dienstprogramm sysdiagnose gefunden.  Dieses Programm sammelt Diagnoseinformationen aus verschiedenen Quellen und √ºbertr√§gt sie in Form eines Archivs zur weiteren Analyse, Unterst√ºtzung oder als Service-Center an den Benutzer.  Es schien unm√∂glich zu sein, die Art und Weise zu beeinflussen, in der sie Informationen sammelte.  In der Patch-Beschreibung wurde angegeben, dass die Sicherheitsanf√§lligkeit zur Erh√∂hung von Berechtigungen verwendet werden kann und ein Speicherbesch√§digungsfehler ist, der uns noch mehr fasziniert.  Und der Autor des Funds selbst hat keine Beschreibung von sich selbst ver√∂ffentlicht ... </p><br><p><img src="https://habrastorage.org/webt/ss/qj/xs/ssqjxs3dnufltlr6qvqkakimzbw.png" alt="Bild"></p><br><p>  Sie k√∂nnen sysdiagnose unter macOS aufrufen, indem Sie STRG + WAHL + UMSCHALT + dr√ºcken oder den Befehl sudo sysdiagnose verwenden.  Auf iOS-Ger√§ten m√ºssen Sie die Ein- / Aus-Taste und die Lautst√§rketasten nach oben und unten gedr√ºckt halten. </p><br><h3 id="patch-diffing-apple-na-praktike">  Patch Diffing Apple in der Praxis </h3><br><p>  Wenn Sie verschiedene Apple-Ger√§te patchen m√∂chten, ben√∂tigen Sie zwei Versionen des Updates (alt und neu).  Unter macOS k√∂nnen Sie Dateien im Software-Update-Katalog analysieren.  Diese Methode hilft nicht immer, da Apple einige Updates entfernt.  Updates finden Sie auch im Verzeichnis / Library / Updates.  Firmware f√ºr iOS-Ger√§te finden Sie auf der <a href="https://ipsw.me/">ipsw.me-</a> Website. <br>  F√ºr macOS m√ºssen Sie ausf√ºhrbare Dateien, Bibliotheksdateien, Frameworks und den Kernel mit dem Dienstprogramm Suspicious Package extrahieren. <br>  Bei iOS-Ger√§ten sind die Dinge etwas komplizierter.  Das Update selbst ist ein ZIP-Archiv.  In diesem Archiv m√ºssen Sie die Kernelcache-Datei finden: Im Inneren befinden sich der Kernel und seine Erweiterung.  Vor der Analyse m√ºssen Sie die Datei jedoch in das Mach-O-Format konvertieren.  Dies kann mit den Dienstprogrammen img4tool, joker, jtool2 und anderen erfolgen. <br>  User-Land-Component-Firmware befindet sich im gr√∂√üten DMG-Image: Es enth√§lt das Root-System und ausf√ºhrbare Dateien.  Wenn Sie sich jedoch gemeinsam genutzte Bibliotheken und Frameworks ansehen, sind diese nicht vorhanden.  Tatsache ist, dass sie zur Optimierung des Speicherplatzes in dyld_shared_cache abgelegt werden.  Diese Datei enth√§lt alle Bibliotheken auf dem iPhone und ben√∂tigt mehr als 1 GB, was die Analyse erschwert.  Wenn Sie einen separaten Teil der ipsw-Datei herunterladen m√ºssen, verwenden Sie das Dienstprogramm ipsw ( <a href="https://github.com/blacktop/ipsw">https://github.com/blacktop/ipsw</a> ). </p><br><h3 id="patchdifing-cve-2019-8574">  Patchdifting CVE-2019-8574 </h3><br><p>  Um den Patch CVE-2019-8574 zu studieren, rufen wir eine Datei aus Library / Updates ab und extrahieren zwei ausf√ºhrbare sysdiagnose-Dateien (alte und neue) mit dem Suspicious Package. Dann suchen wir nach Updates mithilfe von Dienstprogrammen zum Vergleichen von Bin√§rcodes, z. B. Diaphora oder BinDiff (das sind viele) besser als Hex-Editor). </p><br><h3 id="kak-rabotaet-patch">  Wie funktioniert der Patch? </h3><br><p>  F√ºr die x86_64-Architektur haben wir nur eine ge√§nderte Funktion gefunden.  Es gibt weitere √Ñnderungen in ARM, aber sie sind unbedeutend. </p><br><p><img src="https://habrastorage.org/webt/lz/-r/kw/lz-rkw3czadbapcb5bkywgenypo.png" alt="Bild"></p><br><p>  Das Problem war mit der [SDTask start] -Methode: Es wurde eine neue Pr√ºfung hinzugef√ºgt.  In der Abbildung sehen Sie, wie ein Aufruf einer isAppleInternal-Funktion aufgerufen und das Vorhandensein der Teilzeichenfolge / usr / local in einem Pfad √ºberpr√ºft wird. </p><br><p><img src="https://habrastorage.org/webt/hd/8u/vc/hd8uvcvbusgs1m52yx0xn8ka4ie.png" alt="Bild"></p><br><p>  Wie bereits erw√§hnt, sammelt sysdiagnose Informationen aus verschiedenen Quellen.  Quellen k√∂nnen entweder Dateien (z. B. ein Ereignisprotokoll) oder die Ausgabe einiger Informationsbefehle (z. B. Auflisten von Prozessen oder Threads mit ps) sein. Solche Aufgaben werden in sysdiagnose als SDTask-Objekte gespeichert.  Die Methode [SDTask start] startet die Ausf√ºhrung von Tasks.  In der folgenden Abbildung sehen Sie den Code, in dem alle Aufgaben gebildet werden.  Alle Pfade der ausf√ºhrbaren Dateien und ihrer Argumente werden direkt in das Programm geschrieben, und es gibt Aufgaben aus verschiedenen Verzeichnissen, einschlie√ülich / usr / local. </p><br><p><img src="https://habrastorage.org/webt/5y/kj/uc/5ykjuc8umbymhffj-xo01ohw2oi.png" alt="image! [] (./ assets / 8.png)"></p><br><p>  Vor der Installation des Patches kann daher jede Aufgabe ausgef√ºhrt werden, unabh√§ngig davon, wo sich die ausf√ºhrbare Datei befindet.  Nach der Installation des Patches wird die Funktion isAppleInternal aufgerufen, die pr√ºft, ob es sich bei dem Ger√§t um ein internes Testger√§t von Apple handelt.  Handelt es sich um ein internes Ger√§t, wird die Aufgabe auf standardm√§√üige Weise ausgef√ºhrt. Handelt es sich um eine clientseitige Aufgabe, wird √ºberpr√ºft, ob der Teilstring / usr / local / im Pfad der ausf√ºhrbaren Aufgabendatei vorhanden ist.  Wenn eine Teilzeichenfolge gefunden wird, wird die Aufgabe nicht abgeschlossen. </p><br><p>  Denken Sie daran, dass in der Beschreibung der Sicherheitsanf√§lligkeit angegeben wurde, dass es sich um einen Speicherbesch√§digungsfehler handelt, in dem Patch jedoch nichts dergleichen festgestellt wurde. Dies ist unserer Meinung nach eine gut und stabil ausgenutzte logische Sicherheitsanf√§lligkeit. </p><br><h3 id="kak-eto-ekspluatirovat">  Wie man es ausnutzt </h3><br><p>  Um die Sicherheitsanf√§lligkeit auszunutzen, m√ºssen Sie die folgenden Schritte ausf√ºhren: <br>  Erstellen Sie eine ausf√ºhrbare Datei (Bin√§r- oder Shell-Skript), die sysdiagnose aus / usr / local / bin startet, und stellen Sie unsere Nutzdaten dort ab.  Die Liste der g√ºltigen Dateien ist unten angegeben.  Es ist wichtig, dass der Brew-Paket-Manager auf dem System installiert ist: Er erm√∂glicht es dem Benutzer, Dateien in / usr / local / zu erstellen, ohne die Berechtigungen zu erh√∂hen. </p><br><p>  Es ist notwendig, sysdiagnose aufzurufen.  Gleichzeitig werden unsere Nutzdaten mit Root-Benutzerrechten ausgef√ºhrt und ihre Ausgabe in das Archiv gestellt, das sysdiagnose bildet.  Dadurch erhalten wir eine Privilegieneskalation.  Das Ausf√ºhren von sysdiagnose selbst erfordert jedoch erh√∂hte Berechtigungen.  Wie oben erw√§hnt, kann sysdiagnose jedoch auch √ºber eine Tastenkombination gestartet werden, und dies funktioniert sogar √ºber den MacOS-Sperrbildschirm. <br>  Diese Sicherheitsanf√§lligkeit kann verwendet werden, um verschiedene Schadprogramme zu erstellen. </p><br><pre><code class="plaintext hljs">/usr/local/bin/airplayutil /usr/local/bin/amstool /usr/local/bin/apsclient /usr/local/bin/audioDeviceDump /usr/local/bin/cdcontexttool /usr/local/bin/cddebug /usr/local/bin/cdknowledgetool /usr/local/bin/dastool /usr/local/bin/idstool /usr/local/bin/imtool /usr/local/bin/keystorectl /usr/local/bin/pmtool /usr/local/bin/xcpm /usr/local/efi/bin/efi-perf</code> </pre> <br><p>  Interessanterweise k√∂nnen andere Sicherheitsl√ºcken mit dem Brew-Paket-Manager oder vielmehr mit der F√§higkeit, ohne Berechtigungen nach / usr / local / zu schreiben, verbunden sein. </p><br><h2 id="vyvod">  Fazit </h2><br><p>  Mit dieser Studie m√∂chten wir zeigen, wie wichtig und kritisch Patches sind, die sich nicht nur f√ºr Angreifer unterscheiden, sondern auch die Sicherheit von Softwareprodukten erh√∂hen.  Leider kann der Patch nicht nur die Sicherheitsl√ºcke schlie√üen, sondern auch dem Angreifer in die H√§nde spielen. </p><br><p>  Dieser Ansatz erm√∂glicht es jedoch nicht nur, bekannte Schwachstellen zu untersuchen, sondern auch nach neuen Schwachstellen wie diesen zu suchen.  Aus diesem Grund sind wir der Meinung, dass Patch-Unterschiede ein Muss f√ºr jeden Forscher sind. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479972/">https://habr.com/ru/post/de479972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479958/index.html">Firmware- und Prozessor-Schwachstellen</a></li>
<li><a href="../de479960/index.html">Leistungsmodell der Medienwerbung f√ºr Online-Shops</a></li>
<li><a href="../de479966/index.html">Playrix CI / CD: Wie wir unsere Spiele bauen und testen</a></li>
<li><a href="../de479968/index.html">Das B√ºro von Nginx wird aufgrund einer Klage der Rambler Group durchsucht. Der Pressedienst des Beschwerdef√ºhrers best√§tigte die Klage</a></li>
<li><a href="../de479970/index.html">Tausend und ein UI-Fehler oder wie man einem Entwickler hilft, h√§ufige UI-Fehler zu vermeiden</a></li>
<li><a href="../de479974/index.html">Zero-Click-Angriffe: Wenn Ihre Sicherheit nicht Ihnen √ºberlassen bleibt</a></li>
<li><a href="../de479978/index.html">Wie ohne Schmerzen, ohne Sicherheitsabfrage und kostenlos, um Ausz√ºge aus dem Federal State Property Fund des Unified State Register of Human Rights in eine f√ºr Menschen lesbare (*) Form zu bringen</a></li>
<li><a href="../de479982/index.html">Vidos und Insekten</a></li>
<li><a href="../de479988/index.html">Technologische Wettbewerbe Radiofest-2019. Zusammenfassung</a></li>
<li><a href="../de479992/index.html">Wie Sie UITextView beibringen, sich von anderen abzuheben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>