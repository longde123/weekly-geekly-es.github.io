<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏿 🔻 👨🏾‍🎨 ioBroker智能家居中的小米无线设备 🚦 🍳 🚶🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="向所有家庭自动化爱好者致以问候。 我决定分享使用带ZigBee界面的小米无线设备的经验。 老实说，我反对在任何自动化系统中使用任何无线设备，从大型对象的严重过程控制系统到小型自动化系统（例如火灾报警系统或智能家居），但是...小米解决方案充斥着价格便宜，价格适中，出色的设计以及用户的积极反馈，我决定...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ioBroker智能家居中的小米无线设备</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/433340/"> 向所有家庭自动化爱好者致以问候。 我决定分享使用带ZigBee界面的小米无线设备的经验。 老实说，我反对在任何自动化系统中使用任何无线设备，从大型对象的严重过程控制系统到小型自动化系统（例如火灾报警系统或智能家居），但是...小米解决方案充斥着价格便宜，价格适中，出色的设计以及用户的积极反馈，我决定尝试。 <br><br> 本文应作为将ZigBee设备集成到智能家居基础架构中的分步说明。 此处描述的绝不是公理，您可以找到许多其他方式连接ZigBee设备。 但是，如果您跳过详细说明，则可以使用ZigBee和ioBroker的示例（稍后再介绍），将来自不同制造商的设备组合到一个本地平台中的复杂性或易用性印象。 在本文中，我将告诉您如何将设备连接到智能家居，如何在平板电脑上或仅在浏览器中显示来自设备的信息，以及如何通过电报发送有关设备状态更改的消息。 如果您对我感兴趣，那么我要一只猫。 <br><a name="habracut"></a><br> 根据小米制造商的说法，用户应使用具有云连接和Wi-Fi网关的本机应用程序用于ZigBee设备。 然而，很早就已知一种用于在应用中激活开发者模式以获得控制令牌的方法。 因此，在本地网络内部，您可以与网关进行通信，这允许您执行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mihome</a>驱动程序，该驱动程序是ioBroker的一部分。 <br><br>  ioBroker是物联网的开放平台，包括用于构建智能家居系统的平台。 在上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇文章中</a>可以找到什么是ioBroker。 <br><br> 现在，我的智能家居正在“旋转”在Cubietruck ARM板上，带有一些“主体套件”，包括80GB硬盘，5000mAh可充电电池，1线USB主设备，用于使用Modbus协议轮询设备的USB-RS485转换器。 随根分区的传输，将Armbian OS安装在硬盘上，只有引导加载程序保留在microSD存储卡上。 <br><br> 我通过购买温度和湿度传感器开始了解小米无线设备。 当时，它们集成的唯一可能性是<b>mihome</b>驱动程序，上面已经提到过。 <br><br><h4>  Mihome驱动程序 </h4><br> 向系统添加驱动程序非常简单，您需要单击可用驱动程序列表中的“ +”按钮，并注意安装过程。 <br><br><img src="https://habrastorage.org/webt/1q/uv/gs/1quvgskqfsscaszi1df_weidl_k.png"><br><br> 我不会描述本地Android应用程序Mi Home的安装和初始配置，您可以在驱动程序的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>页面或Internet上看到它。 因此，开发人员模式被激活，令牌被接收，我们配置mihome适配器，如果尚未启动，则保存并运行。 <br><br><img src="https://habrastorage.org/webt/hg/gi/uz/hggiuzkuphbirpnjp1xdcwcxy2e.png"><br><br>  Mi Home应用程序中连接的小米网关和设备应出现在对象树中。 <br><br><img src="https://habrastorage.org/webt/tm/wf/gs/tmwfgsbmgvfncvw-gyezzdjhamw.png"><br><br> 接下来，您可以配置新创建的对象。 例如，存储温度和湿度传感器的历史记录。 我将SQL驱动程序用于在SQLite数据库上配置的历史数据。 <br><br><img src="https://habrastorage.org/webt/wv/op/yk/wvopykrwhlu2pcgdru82m1yv8sg.png"><br><br> 变量历史记录的存储是在系统对象窗口中配置的：在对象层次结构中，您需要进入变量本身，然后使用右侧的扳手按按钮。 在“设置”选项卡上，我已通过传感器激活了历史记录存储-仅更改了变量。 <br><br> 其他设定： <br><br><ul><li> 最小间隔为10秒-如果变量将更频繁地更改，则数据库中的条目将被忽略 </li><li> 每300秒（5分钟）记录一次值-如果变量的更改时间超过5分钟，则当前值仍会写入数据库 </li><li> 值类型-数字 </li><li> 保质期-1年 </li></ul><br><img src="https://habrastorage.org/webt/a2/6n/ed/a26nedcztddt2fo4vofcdndkadu.png"><br><br> 通过本机应用程序添加新设备。 即 您需要根据随附的说明将新设备与网关配对，然后它将自动出现在ioBroker对象列表中。 <br><br><h4>  Zigbee驱动程序 </h4><br> 使用本机小米应用程序给我带来了不便，特别是因为我必须购买带有中文插件的网关，在我的情况下，除了与设备进行通信外，它对任何事情都没有用。 是的，它可以用作夜灯，或在某些情况下使用光传感器。 在Internet上，您可以找到有关如何将播放列表“馈送”到网关以播放其自己的广播电台的说明，但是这些都没有困扰我。 另外，以为我的数据在某个地方泄漏，正在处理和存储在某个地方的想法困扰着人们。 <br><br>  ioBroker平台的活跃用户之一在Internet上找到了node.js上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zigbee-shepherd</a>库，其中提到了连接小米设备的问题。  ioBroker的驱动程序是在此基础上编写的，该驱动程序的作者不仅限于小米设备，支持的设备列表也在不断更新，可以在该项目的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>页面上找到。 <br><br> 它应该使用基于TI <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CC25xx</a>芯片的廉价现成设备作为网络协调器。 您可以购买现成的具有USB连接和内置天线的ZigBee模块，以及更昂贵和更严格的型号：带有外部天线，放大器和通过UART的连接。 <br><br> 要使用驱动程序，您只需要更改固件。 因此，事实证明该驱动程序不需要昂贵的网关，也不需要Wi-Fi网络。  “入口”是协调器-一种基于带有特殊固件的SS25xx芯片的设备。 通过协调器，zigbee设备与智能家居系统之间可以进行直接通信，还可以绑定新设备。 <br><br> 作为协调员，我使用现成的主板，该主板基于带有外部天线的CC2530芯片，并通过UART连接到服务器。 <br><br> 对于设备固件，购买了一个特殊的SmartRF04EB调试器，我将其的microUSB端口连接到了计算机，并通过接线连接了ZigBee模块，以根据方案进行调试： <br><table><tbody><tr><th>  SS2530 </th><th>  SmartRF04EB板 </th></tr><tr><td>  P22 </td><td> 直流电 </td></tr><tr><td>  P21 </td><td>  DD </td></tr><tr><td>  Rst </td><td> 重设 </td></tr><tr><td> 地线 </td><td> 地线 </td></tr><tr><td>  Vcc </td><td>  3.3伏 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/zy/g3/mf/zyg3mfircqqapiz8vz59afyrm5g.jpeg"><br><br> 在项目的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>页面上，下载固件（此设备的文件名为CC2530ZNP-Pro-Secure_LinkKeyJoin.hex）和固件程序（闪存编程器），然后将必要的驱动程序添加到系统中。 <br> 将调试器板连接到计算机的USB端口时，程序将立即显示连接的设备。 您只需要指定固件文件的路径，然后单击“执行操作”按钮即可 <br><br><img src="https://habrastorage.org/webt/7z/rd/w8/7zrdw8e3iwpyvisw6dzohkfn3zs.png"><br><br>  ZigBee模块端口P03（Rx）和P02（Tx）连接到UART4（在操作系统中，如ttyS4）cubietruck板上，由3V3供电，GND接在相邻的引脚上。 为了稳定运行，您仍然需要将协调器的端口P20，P4，P5接地。 如我上面所写，我使用的是Armbian OS，使用“ <b>系统</b> - <b>硬件”</b>部分中的<b>armbian-config</b>命令非常简单地激活UART端口，您需要激活所需的端口并重新启动系统。 <br><br><img src="https://habrastorage.org/webt/ic/7l/il/ic7lilxwfsext55fvjnpdyxfiuq.png"><br><br> 一键式从管理面板添加zigbee驱动程序。 <br><br><img src="https://habrastorage.org/webt/uw/-d/zm/uw-dzmkdrsbgnunfmchqtzqq8ta.png"><br><br> 在我的情况下，协调器连接到端口<b>/ dev / ttyS4</b> （如上所述），我们在设置中指定它。 <br><br><img src="https://habrastorage.org/webt/eu/2i/bo/eu2ibog5mba2paet4ecec7jo7aw.png"><br><br> 默认情况下可以保留其他设置。 首次启动驱动程序后，您需要配对（添加）设备。 通过该驱动程序在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>上的完整说明比通过本机应用程序进行配对要复杂一些，但是我没有任何问题。 <br><br> 因此，例如，添加小米按钮（Mijia系列），为此，我们在驱动程序设置中按绿色按钮，然后按照说明先用回形针按住背面的配对按钮，直到LED开始闪烁，然后大约每2秒单击一次此按钮，查看配对进度。 <br><br><img src="https://habrastorage.org/webt/mm/vq/ok/mmvqokw8ors3oszymkuqv5jsswq.png"><br><br> 我的公寓并不大，所有设备的连接都稳定，即使平台上有开门传感器（钢筋混凝土墙为100mm，直5m）也是如此。 当我决定在街道空气中增加一个温度和湿度传感器时，问题就开始了，我从绝缘凉廊的侧面将其安装在房屋的外墙上。 同样在街上的弱传感器的信号也没有到达自动化柜。 这个问题可以简单地解决-您需要在ZigBee网络中添加路由器并将其放置在距离传感器较近的位置。 某些无线设备（例如小米插座）可以用作路由器，但我没有此类设备。 我不想购买昂贵的插座或可控灯，只是为了从街道上的传感器“转发”数据。 事实证明，对于基于SS25xx芯片的相同终端设备，有一种特殊的固件，可将它们用作系统中的路由器。 结果，我添加了基于CC2531芯片并带有USB连接的路由器。 我不会详细介绍固件过程，该方案和固件文件本身可以在项目的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>页面上找到。 <br><br> 由于实际上没有发生通过USB端口与模块进行通信的情况，因此我暂时将其插入USB端口进行充电，然后将其插入厨房的插座。 我计划在不久的将来将其固定在凉廊上的正常建筑物中，并使用家用UPS的正常电源供电。 <br><br><img src="https://habrastorage.org/webt/kh/an/8v/khan8vzw8f5ueqs2n-jf-9kc2e4.jpeg"><br><br> 将路由器添加到系统的过程很简单：按下驱动程序中的配对按钮，然后在打开的路由器上按下S2按钮几次，直到设备连接。 <br><br><img src="https://habrastorage.org/webt/6g/x_/gf/6gx_gfpctjiecwfz8mtz3ah8bne.png"><br><br> 让我们添加一个温度/湿度传感器的示例，该传感器位于室外凉廊上，可以通过路由器工作。 <br><br> 您可以简单地通过驱动程序进行配对，并且传感器应该通过路由器连接（如果距离更近）。 但是您可以强制指定配对通过特定路由器，为此，请在路由器图标上的设备列表中，单击绿色的配对按钮。 <br><br><img src="https://habrastorage.org/webt/bz/df/tr/bzdftrouwfsmd3qq0yyztpsfyee.png"><br><br> 确保传感器连接正确-请参阅网络图。 <br><br><img src="https://habrastorage.org/webt/g9/bj/ru/g9bjruowwwdc7tvq03p0vychauo.png"><br><br> 该图显示了设备的配对线，指示网段之间的信号质量。 就像我在上面写的那样，我有一个35平方米的小odnushka，因此地图相当适中。 在其他用户的允许下，我将使用更大的卡发布可能的选项。 <br><br><img src="https://habrastorage.org/webt/9b/r9/g6/9br9g6psblxtppn56-khinqtf90.png"><br><br><img src="https://habrastorage.org/webt/jo/--/ux/jo--uxxcnxpn_qtlah5yd4awl_g.png"><br><br><img src="https://habrastorage.org/webt/p0/lg/ba/p0lgba6-rpbvnqkcttsabf6wnaa.jpeg"><br><br> 通过此适配器的某些小米设备的功能甚至比通过本机应用程序和mihome驱动程序获得的功能还要多。 将来，我想扩展网络并尝试新设备，尤其是用于窗帘和传感器立方体的智能驱动器。 <br><br><h4> 物料驱动 </h4><br> 我们获得了数据，将执行器捆绑在一起，现在该如何处理？ 首先，让我们在漂亮的界面中进行显示。 我在VIS驱动程序中有一个大项目，该项目存在多个版本，具有不同的权限，但是有足够的材料来撰写单独的文章。 也许她会是下一个。 <br><br> 为了简单快速地显示数据和控制各种设备，我使用了材质驱动程序。 单击几次即可像往常一样安装。 界面磁贴根据类别设置显示数据，这些设置添加在同名的界面管理窗口中。 类别列表仅受想象力限制，我使用“房间功能”方案，并根据它们进行分组。 添加了所有房间（厨房，走廊，房间，阳台等）和功能（照明，传感器，系统等）。 <br><br><img src="https://habrastorage.org/webt/le/nt/7p/lent7pos1th-k5mzz9yezdmug-m.png"><br><br> 现在，在系统对象的设置窗口中，将需要在屏幕上显示的变量指示房间，功能和分配角色（为了正确显示）。 一个例子是小米的室内墙壁温度和湿度传感器，通过蓝牙连接。 <br><br><img src="https://habrastorage.org/webt/by/2u/ws/by2uwskolk1rxomzcm-mvg_rccw.png"><br><br> 根据这些设置，磁贴将在屏幕上显示数据，图标将收紧，并且对于某些类型的控件，将可用。 <br><br>  <b>示例1.</b>一类所有信息的输出-函数。 整个公寓照明。 <br><br><img src="https://habrastorage.org/webt/jp/xs/m3/jpxsm3v67xbi7otryix6xqemigu.png"><br><br>  <b>示例2.</b>有关该房间的所有信息的输出-浴室。 <br><br><img src="https://habrastorage.org/webt/5x/ce/2m/5xce2mjrmxjetxojelprdg95chg.png"><br><br>  <b>示例3.</b>所有小米无线设备<b>的</b>电压和电池放电水平。 <br><br><img src="https://habrastorage.org/webt/40/t4/p3/40t4p3d-ggn71albkiy7aarsylo.png"><br><br> 该驱动程序为我工作，可通过移动电话（墙上的固定平板电脑）对系统进行本地控制。 有时我通过VPN连接。 为了远程控制和查看状态，以接收通知，我使用电报驱动程序。 <br><br><h4> 电报驱动程序 </h4><br> 我不会描述安装，只需要检查设置即可。 我通过定期轮询（默认为300毫秒）和通过代理服务器进行连接来使用操作模式。 要获得令牌，您需要与机器人的创建者BotFather“对话”。 过程很简单-查找该机器人的搜索，提供创建新机器人的命令，指定其唯一名称和密钥，在驱动程序设置中进行指示，并为安全起见，请确保指定“欢迎”密码。 与新用户交流时，您的机器人会询问他。 <br><br><img src="https://habrastorage.org/webt/du/nw/jt/dunwjtmlt874q5t1hma81lpz0qs.png"><br><br> 现在，您需要通过机器人配置通信案例。 您可以使用text2command驱动程序或JavaScript来执行此操作。 历史上曾经发生过这样的事情，我同时以文本和Blockly块的形式使用JavaScript。 安装JS驱动程序应该不会造成困难，在这种情况下不需要配置。 安装和启动后，需要启用菜单的显示以创建和编辑脚本。 <br><br><img src="https://habrastorage.org/webt/wj/tc/pb/wjtcpbty2ro46bn6a5orrwbvpis.png"><br><br>  <b>示例1.</b>警报。 <br><br> 首先，让我们尝试发送有关前门打开的通知。 我在前门上有一个小米无线传感器簧片开关。 当我在工作时，我会监视妻子如何走小路。 在公共组中创建一个新脚本。 <br><br><img src="https://habrastorage.org/webt/cu/l6/5j/cul65jefd-k794nct-cicju7x64.png"><br><br> 指定将被“绘制”的块，并将其称为“ telegram_bot”。 <br><br><img src="https://habrastorage.org/webt/os/ed/kq/osedkqplopwii7ckmd3eftjliwo.png"><br><br> 在“事件”组中，我们使用反应单位来更改变量并将其拖动到工作字段中。 <br><br><img src="https://habrastorage.org/webt/1h/o6/yq/1ho6yq_kluvryjb48bdo9iijn-a.png"><br><br> 接下来，选择我们要订阅的对象的ID，然后通过“ if”-“否则”通过true / false插入对象检查。 结果应该类似于以下内容。 <br><br><img src="https://habrastorage.org/webt/9u/-r/0s/9u-r0sajaneojinyzpgojw2lnoa.png"><br><br> 好的，现在我们在跑步，打开门-关闭门，然后在电报中看到消息。 <br><br><img src="https://habrastorage.org/webt/ae/07/u6/ae07u62jmarzp0nw1hv2a3bhv9y.png"><br><br>  <b>示例2.</b>通过菜单进行照明控制。 <br> 一个例子更加复杂，让我们使用电报中的菜单按钮进行照明控制。 在这里，您必须稍稍徘徊，即 创建脚本时，需要选择JS。 任务大致如下：以菜单形式制作按钮，并在按钮签名文本中立即显示灯具的状态。 仍要尝试确保当您按下按钮时，照明状态会反转，并且按钮文本中的状态会随着灯泡的出现/消失而立即更新。 另外，如果菜单已经在运行，并且使用按钮手动打开/关闭灯，则还必须使用灯具的状态来更新菜单。 <br> 该代码包含注释，并且相对简单： <br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/c980b9dd1c2e9d050810b11ed712b0c0.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist93669305" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-telegram_bot" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-telegram_bot-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-telegram_bot-LC1" class="blob-code blob-code-inner js-file-line">//    ID   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-telegram_bot-LC2" class="blob-code blob-code-inner js-file-line">const LIGHT1 = ' ',     CH_LIGHT1 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main1';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-telegram_bot-LC3" class="blob-code blob-code-inner js-file-line">const LIGHT2 = ' ',      CH_LIGHT2 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main2';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-telegram_bot-LC4" class="blob-code blob-code-inner js-file-line">const LIGHT3 = ' ',    CH_LIGHT3 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_sec';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-telegram_bot-LC5" class="blob-code blob-code-inner js-file-line">const LIGHT4 = ' ',      CH_LIGHT4 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-telegram_bot-LC6" class="blob-code blob-code-inner js-file-line">const LIGHT5 = ' 1',  	CH_LIGHT5 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_top';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-telegram_bot-LC7" class="blob-code blob-code-inner js-file-line">const LIGHT6 = ' 2',    CH_LIGHT6 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_bottom';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-telegram_bot-LC8" class="blob-code blob-code-inner js-file-line">const LIGHT7 = ' ',     CH_LIGHT7 = 'mqtt.0.PLC55_Lighting.lighting.BathRoom_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-telegram_bot-LC9" class="blob-code blob-code-inner js-file-line">const LIGHT8 = ' ',       CH_LIGHT8 = 'mqtt.0.PLC55_Lighting.lighting.Hall_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-telegram_bot-LC10" class="blob-code blob-code-inner js-file-line">const LIGHT9 = ' ',    CH_LIGHT9 = 'mqtt.0.PLC55_Lighting.lighting.Balcon_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-telegram_bot-LC11" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-telegram_bot-LC12" class="blob-code blob-code-inner js-file-line">//    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-telegram_bot-LC13" class="blob-code blob-code-inner js-file-line">function sendLightMenu(message_text) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-telegram_bot-LC14" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-telegram_bot-LC15" class="blob-code blob-code-inner js-file-line">    var l1 = getState(CH_LIGHT1).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-telegram_bot-LC16" class="blob-code blob-code-inner js-file-line">    var l2 = getState(CH_LIGHT2).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-telegram_bot-LC17" class="blob-code blob-code-inner js-file-line">    var l3 = getState(CH_LIGHT3).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-telegram_bot-LC18" class="blob-code blob-code-inner js-file-line">    var l4 = getState(CH_LIGHT4).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-telegram_bot-LC19" class="blob-code blob-code-inner js-file-line">    var l5 = getState(CH_LIGHT5).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-telegram_bot-LC20" class="blob-code blob-code-inner js-file-line">    var l6 = getState(CH_LIGHT6).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-telegram_bot-LC21" class="blob-code blob-code-inner js-file-line">    var l7 = getState(CH_LIGHT7).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-telegram_bot-LC22" class="blob-code blob-code-inner js-file-line">    var l8 = getState(CH_LIGHT8).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-telegram_bot-LC23" class="blob-code blob-code-inner js-file-line">    var l9 = getState(CH_LIGHT9).val ? '💡' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-telegram_bot-LC24" class="blob-code blob-code-inner js-file-line">    // </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-telegram_bot-LC25" class="blob-code blob-code-inner js-file-line">	sendTo('telegram.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-telegram_bot-LC26" class="blob-code blob-code-inner js-file-line">        text:   message_text,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-telegram_bot-LC27" class="blob-code blob-code-inner js-file-line">        reply_markup: {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-telegram_bot-LC28" class="blob-code blob-code-inner js-file-line">            keyboard: [</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-telegram_bot-LC29" class="blob-code blob-code-inner js-file-line">                [LIGHT1+l1, LIGHT2+l2, LIGHT3+l3],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-telegram_bot-LC30" class="blob-code blob-code-inner js-file-line">                [LIGHT4+l4, LIGHT5+l5, LIGHT6+l6],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-telegram_bot-LC31" class="blob-code blob-code-inner js-file-line">                [LIGHT7+l7, LIGHT8+l8, LIGHT9+l9]</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-telegram_bot-LC32" class="blob-code blob-code-inner js-file-line">            ],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-telegram_bot-LC33" class="blob-code blob-code-inner js-file-line">            resize_keyboard:   true,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-telegram_bot-LC34" class="blob-code blob-code-inner js-file-line">            one_time_keyboard: true</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-telegram_bot-LC35" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-telegram_bot-LC36" class="blob-code blob-code-inner js-file-line">    });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-telegram_bot-LC37" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-telegram_bot-LC38" class="blob-code blob-code-inner js-file-line">//  </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-telegram_bot-LC39" class="blob-code blob-code-inner js-file-line">function changeLight(room, channel) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-telegram_bot-LC40" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-telegram_bot-LC41" class="blob-code blob-code-inner js-file-line">    var alive = getState("mqtt.0.info.connection").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-telegram_bot-LC42" class="blob-code blob-code-inner js-file-line">    if (alive.includes("PLC55_Lighting")) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-telegram_bot-LC43" class="blob-code blob-code-inner js-file-line">        if (getState(channel).val) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-telegram_bot-LC44" class="blob-code blob-code-inner js-file-line">            setState(channel, false, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-telegram_bot-LC45" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-telegram_bot-LC46" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-telegram_bot-LC47" class="blob-code blob-code-inner js-file-line">        } else { </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-telegram_bot-LC48" class="blob-code blob-code-inner js-file-line">            setState(channel, true, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-telegram_bot-LC49" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-telegram_bot-LC50" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-telegram_bot-LC51" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-telegram_bot-LC52" class="blob-code blob-code-inner js-file-line">    } else {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-telegram_bot-LC53" class="blob-code blob-code-inner js-file-line">        sendLightMenu('  OFFLINE');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-telegram_bot-LC54" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-telegram_bot-LC55" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-telegram_bot-LC56" class="blob-code blob-code-inner js-file-line">//   request  ,    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-telegram_bot-LC57" class="blob-code blob-code-inner js-file-line">on({id: "telegram.0.communicate.request", ack: false, change: 'any'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-telegram_bot-LC58" class="blob-code blob-code-inner js-file-line">    var msg = obj.state.val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-telegram_bot-LC59" class="blob-code blob-code-inner js-file-line">    var command = obj.state.val.substring(obj.state.val.indexOf(']')+1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-telegram_bot-LC60" class="blob-code blob-code-inner js-file-line">    var user = obj.state.val.substring(obj.state.val.indexOf('[')+1,obj.state.val.indexOf(']'));</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-telegram_bot-LC61" class="blob-code blob-code-inner js-file-line">    var chat_id = getState("telegram.0.communicate.requestChatId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-telegram_bot-LC62" class="blob-code blob-code-inner js-file-line">    var message_id = getState("telegram.0.communicate.requestMessageId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-telegram_bot-LC63" class="blob-code blob-code-inner js-file-line">    var handled = false;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-telegram_bot-LC64" class="blob-code blob-code-inner js-file-line">    //     </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-telegram_bot-LC65" class="blob-code blob-code-inner js-file-line">	if (command == '/start' || command == '/menu' || command == '' || command == '') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-telegram_bot-LC66" class="blob-code blob-code-inner js-file-line">        sendLightMenu("");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-telegram_bot-LC67" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-telegram_bot-LC68" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-telegram_bot-LC69" class="blob-code blob-code-inner js-file-line">//######################## Lighting menu and commands ################</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-telegram_bot-LC70" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT1 || command == LIGHT1+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-telegram_bot-LC71" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT1, CH_LIGHT1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-telegram_bot-LC72" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-telegram_bot-LC73" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-telegram_bot-LC74" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT2 || command == LIGHT2+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-telegram_bot-LC75" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT2, CH_LIGHT2);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-telegram_bot-LC76" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-telegram_bot-LC77" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-telegram_bot-LC78" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT3 || command == LIGHT3+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-telegram_bot-LC79" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT3, CH_LIGHT3);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-telegram_bot-LC80" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-telegram_bot-LC81" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-telegram_bot-LC82" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT4 || command == LIGHT4+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-telegram_bot-LC83" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT4, CH_LIHT4);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-telegram_bot-LC84" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-telegram_bot-LC85" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-telegram_bot-LC86" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT5 || command == LIGHT5+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-telegram_bot-LC87" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT5, CH_LIGHT5);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-telegram_bot-LC88" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-telegram_bot-LC89" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-telegram_bot-LC90" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT6 || command == LIGHT6+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-telegram_bot-LC91" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT6, CH_LIGHT6);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-telegram_bot-LC92" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-telegram_bot-LC93" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-telegram_bot-LC94" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT7 || command == LIGHT7+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-telegram_bot-LC95" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT7, CH_LIGHT7);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-telegram_bot-LC96" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-telegram_bot-LC97" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-telegram_bot-LC98" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT8 || command == LIGHT8+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-telegram_bot-LC99" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT8, CH_LIGHT8);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-telegram_bot-LC100" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-telegram_bot-LC101" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-telegram_bot-LC102" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT9 || command == LIGHT9+'💡') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-telegram_bot-LC103" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT9, CH_LIGHT9);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-telegram_bot-LC104" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-telegram_bot-LC105" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-telegram_bot-LC106" class="blob-code blob-code-inner js-file-line">	//       ,      text2command</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-telegram_bot-LC107" class="blob-code blob-code-inner js-file-line">    if (!handled) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-telegram_bot-LC108" class="blob-code blob-code-inner js-file-line">        sendTo('text2command.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-telegram_bot-LC109" class="blob-code blob-code-inner js-file-line">            text: command.replace(/\//g, '#').replace(/_/g, ' '),</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-telegram_bot-LC110" class="blob-code blob-code-inner js-file-line">            id: chat_id,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-telegram_bot-LC111" class="blob-code blob-code-inner js-file-line">            user: user</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-telegram_bot-LC112" class="blob-code blob-code-inner js-file-line">        }, function (response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-telegram_bot-LC113" class="blob-code blob-code-inner js-file-line">            if (response &amp;&amp; response.response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-telegram_bot-LC114" class="blob-code blob-code-inner js-file-line">                sendTo('telegram.0', {user: user, text: response.response});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-telegram_bot-LC115" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-telegram_bot-LC116" class="blob-code blob-code-inner js-file-line">        });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-telegram_bot-LC117" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-telegram_bot-LC118" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-telegram_bot-LC119" class="blob-code blob-code-inner js-file-line">//   ,   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-telegram_bot-LC120" class="blob-code blob-code-inner js-file-line">on({id: /^mqtt\.0\.PLC55_Lighting\.lighting\..*$/, ack: true, change: 'ne'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-telegram_bot-LC121" class="blob-code blob-code-inner js-file-line">    sendLightMenu(" ");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-telegram_bot-LC122" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-telegram_bot-LC123" class="blob-code blob-code-inner js-file-line">//       </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-telegram_bot-LC124" class="blob-code blob-code-inner js-file-line">sendLightMenu("");</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">telegram_bot</a>
        hosted with ❤ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br><br> 结果应该是这样的： <br><br><img src="https://habrastorage.org/webt/wm/kw/dj/wmkwdjedebx86h6ujqutsik93sa.png"><br><br><h4> 结论 </h4><br> 文章虽然篇幅长，但我希望它有用，并且也许可以使某些用户的生活更轻松，或者鼓励某人创建自己的智能家居。 <br> 目前，我基于ioBroker的智能家居系统已经运转了4年，对此我感到非常满意。 除了ZigBee之外，还通过MQTT和HTTP连接了几个自制控制器，用于控制照明，通风和其他系统，1-wire总线上的温度传感器网络，RS485总线上的电源监视设备和modbus RTU协议等等。 <br><br> 在我的智能家居解决方案储钱罐中，我积累了很多想法，尽管可能应该将它们更多地看作是智能家居问题的储钱罐（那些了解我的意思的人）。 在评论中留下您的希望，以帮助我决定下一篇文章的主题。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433340/">https://habr.com/ru/post/zh-CN433340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433330/index.html">使用SAT解算器解决日语填字游戏</a></li>
<li><a href="../zh-CN433332/index.html">Azure Functions中的Python支持</a></li>
<li><a href="../zh-CN433334/index.html">WPF的XAML行为现已开放源代码</a></li>
<li><a href="../zh-CN433336/index.html">巴比伦图书馆的实施</a></li>
<li><a href="../zh-CN433338/index.html">Creality 3D打印机制造商概述</a></li>
<li><a href="../zh-CN433342/index.html">另一个简单的Verilog处理器</a></li>
<li><a href="../zh-CN433344/index.html">私人空间的两次成功</a></li>
<li><a href="../zh-CN433346/index.html">从Redshift切换到ClickHouse</a></li>
<li><a href="../zh-CN433348/index.html">JSX使用TypeScript输入DSL</a></li>
<li><a href="../zh-CN433350/index.html">12月17日至12月23日在莫斯科举行的数字活动</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>