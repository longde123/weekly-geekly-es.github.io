<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêò üë´ üè¶ Zabbix comme scanner de s√©curit√© ü§öüèΩ üå≥ üìÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Nous connaissons et aimons tous les produits pour les processus d'√©valuation de la vuln√©rabilit√© tels que Nessus , Qualys , Max Patrol et toutes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix comme scanner de s√©curit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vulners/blog/416137/"><p>  Salut  Nous connaissons et aimons tous les produits pour les processus d'√©valuation de la vuln√©rabilit√© tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nessus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qualys</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Max Patrol</a> et toutes sortes d'autres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenVAS</a> .  L'une des principales t√¢ches qu'ils r√©solvent consiste √† contr√¥ler les vuln√©rabilit√©s versionn√©es. </p><br><p>  Il s'agit d'un processus assez simple de comparaison des versions logicielles install√©es avec la plage ¬´ne contient pas de vuln√©rabilit√©s connues¬ª.  Eh bien, les responsables de la s√©curit√© de l'information, ainsi que le d√©veloppement et les administrateurs, d√©cident quels risques peuvent √™tre pris et ce qui doit √™tre corrig√© aujourd'hui. </p><br><p>  Il existe de nombreux outils diff√©rents pour r√©soudre ce probl√®me, mais de notre point de vue, ils ont tous un probl√®me commun - ils n√©cessitent un d√©ploiement g√™nant distinct et engendrent un autre outil avec un compte root dans votre infrastructure.  Mais apr√®s tout, pour une action aussi simple que la collecte d'informations sur les packages racine install√©s n'est pas n√©cessaire!  Et g√©n√©ralement, dans l'infrastructure, il existe d√©j√† des syst√®mes d√©ploy√©s avec la capacit√© de consolider les donn√©es, la collaboration et l'ex√©cution √† distance des commandes sur les serveurs.  Par cons√©quent, nous avons d√©cid√© de cr√©er un outil qui permettrait en quelques clics de d√©ployer un syst√®me de surveillance des vuln√©rabilit√©s Linux dans notre environnement avec un minimum de changements de production. </p><br><p>  Qu'est-ce qui est d√©ploy√© dans la plupart des syst√®mes alimentaires?  Bien s√ªr, la surveillance.  Et bien souvent, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zabbix</a> .  Alors allons-y et fixons-le! </p><a name="habracut"></a><br><h1 id="v-odnoy-ruke-zabbix">  Dans une main Zabbix </h1><br><p>  Tout est simple: un syst√®me d'agent distribu√©, des tableaux de bord pour la visualisation, un syst√®me d'acc√®s multi-utilisateurs et la r√©alisation d'actions selon des crit√®res sp√©cifi√©s ont d√©j√† √©t√© r√©alis√©s sans nous.  Nous n'avons pas besoin de r√©inventer la roue et de tout faire √† partir de z√©ro. </p><br><p>  Zabbix a suffisamment de droits pour recevoir des informations sur les paquets, o√π les mettre aussi.  Il reste √† les combiner et √† les envoyer pour analyse √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API Vulners</a> .  Ensuite, traitez les connaissances acquises sur les vuln√©rabilit√©s. </p><br><p>  Mais commen√ßons par une courte introduction sur ce que Zabbix peut faire et ce que nous devons faire. </p><br><p>  <strong>Les agents Zabbix</strong> sont install√©s sur le serveur et permettent: </p><br><ul><li>  Obtenez une large gamme de m√©triques de syst√®me d'exploitation </li><li>  ex√©cuter des scripts et des programmes et obtenir le r√©sultat de leur ex√©cution; </li><li>  ex√©cuter toutes les commandes dans un processus s√©par√© (fork), ind√©pendant des processus de l'agent Zabbix; </li><li>  travailler avec plusieurs serveurs Zabbix √† la fois; </li><li>  travailler derri√®re un pare-feu, √©tablir une connexion au serveur, ou vice versa, attendre les connexions entrantes. </li></ul><br><p>  <strong>Le serveur Zabbix</strong> re√ßoit des mesures de surveillance en entr√©e, les √©crit dans la base de donn√©es et effectue un traitement suppl√©mentaire. </p><br>  Analysant les donn√©es obtenues et selon une logique assez souple, il peut effectuer diff√©rentes actions: <br><br><ul><li>  Envoyer des alertes sur diff√©rents canaux (mail, sms, messagerie instantan√©e, etc.); </li><li>  Connectez-vous aux serveurs via SSH ou IPMI et ex√©cutez diverses commandes sur eux; </li><li>  Ou, ex√©cutez diverses commandes correctives sur les serveurs en utilisant des connexions d'agent Zabbix avec eux; </li></ul><br><p>  <strong>L'interface Web est</strong> √©crite en PHP et vous permettra d'afficher les m√©triques collect√©es par Zabbix, les graphiques, les alertes d√©clench√©es sur les probl√®mes et les commandes et actions ex√©cut√©es par le syst√®me de surveillance. </p><br><p>  L'administration de Zabbix s'effectue √©galement via l'interface Web. </p><br><p>  <strong>L'API Zabbix</strong> est une <strong>API</strong> Web et fait partie de l'interface Web.  Il utilise le protocole JSON-RPC. </p><br><ul><li>  Vous permet de recevoir, cr√©er, configurer et supprimer tous les objets du syst√®me de surveillance. </li><li>  En utilisant l'API, vous pouvez facilement int√©grer le syst√®me de surveillance √† divers syst√®mes externes. </li></ul><br><p>  Cependant, Zabbix ne sait rien des vuln√©rabilit√©s!  Mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vulners les</a> conna√Æt :) </p><br><h2 id="v-drugoy-ruke-vulners">  De l'autre c√¥t√© des Vulner </h2><br><ul><li>  Agr√©gateur de donn√©es de vuln√©rabilit√© provenant de plus de 115 sources </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API pratique pour diverses m√©thodes de num√©risation</a> </li><li>  Fournit des donn√©es sous une forme lisible par machine normalis√©e </li><li>  Tr√®s rapide </li><li>  Permet la corr√©lation des donn√©es provenant de diverses sources </li></ul><br><p>  Nous avons essay√© de les int√©grer les uns aux autres et c'est ce qui en est ressorti. </p><br><h1 id="zabbix-threat-control">  Contr√¥le des menaces Zabbix </h1><br><p>  Il s'agit d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin</a> Zabbix open source √©crit en Python qui: </p><br><ul><li>  Affiche des informations sur les vuln√©rabilit√©s trouv√©es dans votre infrastructure dans l'interface Web Zabbix. </li><li>  Affiche le niveau de menace de chaque vuln√©rabilit√© selon la norme CVSS. </li><li>  Et il propose des m√©thodes facilement applicables pour √©liminer les vuln√©rabilit√©s trouv√©es. </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVSS</a> est une norme industrielle ouverte pour √©valuer la criticit√© de la vuln√©rabilit√©.  En fait - √©chelle de 10 points. </p><br>  L'utilisation de cette technique vous permet de regrouper les vuln√©rabilit√©s trouv√©es dans diff√©rents syst√®mes et avec diff√©rentes propri√©t√©s dans un seul d√©nominateur, ce qui simplifie la hi√©rarchisation des probl√®mes d√©tect√©s. <br><br>  Nous avons parl√© de ce plugin lors du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Meetup Zabbix Moscou</a> .  Pour ceux qui n'aiment pas lire, mais aiment regarder - il y a un reportage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> . <br><br><h2 id="konsolidiruyte-informaciyu-ob-uyazvimostyah">  Consolider les informations de vuln√©rabilit√© </h2><br><p>  Le r√©sultat du plugin dans Zabbix est le suivant: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/70c/a22/394/70ca22394ca3092373bf8529d0c69025.png" alt="Tableau de bord"><br>  Ceci est un tableau de bord dans Zabbix.  Sur lequel, de gauche √† droite, les informations suivantes s'affichent: </p><br><ul><li>  Distribution du score CVSS par serveurs.  Le graphique circulaire montre la relation - combien de serveurs nous avons avec des vuln√©rabilit√©s critiques, combien de vuln√©rabilit√©s non critiques ont ou n'ont pas du tout de vuln√©rabilit√©s connues. </li><li>  Score CVSS m√©dian de l'ensemble de l'infrastructure.  Il est affich√© sous forme de graphique, ce qui permet d'observer la dynamique de son √©volution. </li><li>  Liste des packages vuln√©rables avec un index de l'impact de la vuln√©rabilit√© sur l'infrastructure. </li><li>  Une liste compl√®te des serveurs vuln√©rables avec un niveau de menace pour chacun d'eux. </li><li>  Liste des bulletins de s√©curit√© qui ont √©t√© ¬´trouv√©s¬ª dans l'infrastructure. </li></ul><br><p>  Ci-dessous plus en d√©tail sur les plus int√©ressants: </p><br><p>  <strong>Informations sur les serveurs vuln√©rables:</strong> </p><br><p><img src="https://habrastorage.org/webt/hb/nm/5m/hbnm5mgchmq1yfj9mxfzkdepwxu.gif" alt="H√¥tes"></p><br><p>  Le panneau affiche une liste de tous les serveurs avec un niveau de vuln√©rabilit√© sup√©rieur √† critique.  Le niveau de criticit√© minimum acceptable, apr√®s lequel le serveur commence √† appara√Ætre comme vuln√©rable, est sp√©cifi√© dans les param√®tres du plugin. </p><br><p>  Les informations suivantes sont disponibles pour chaque serveur: </p><br><ol><li>  En fait, le nom du serveur vuln√©rable. </li><li>  Score maximum du serveur CVSS.  Le score le plus √©lev√© de toutes les vuln√©rabilit√©s trouv√©es pour ce serveur s'affiche. </li><li>  Une commande pour √©liminer toutes les vuln√©rabilit√©s d√©tect√©es sur ce serveur.  Ceci fait, nous obtenons un serveur sur lequel il n'y a pas de vuln√©rabilit√©s versionn√©es connues. </li></ol><br><p>  Les donn√©es sont pr√©sent√©es avec un tri CVSS, du maximum au minimum.  Cela vous permet de garder les serveurs qui n√©cessitent le plus d'attention, toujours en haut de la liste, sous vos yeux. </p><br><p>  <strong>Le panneau suivant montre les packages vuln√©rables:</strong> </p><br><p><img src="https://habrastorage.org/webt/0q/75/em/0q75emnx6roeuhvz3ltalvwrbio.gif" alt="Forfaits"></p><br><p>  Ici, pour chaque paquet vuln√©rable de notre infrastructure, nous avons un bref r√©sum√©: </p><br><ol><li>  Nom du package vuln√©rable. </li><li>  <em>Version</em> vuln√©rable <em>du</em> package. </li><li>  Nombre de serveurs sur lesquels la version vuln√©rable du package est install√©e. </li><li>  Score CVSS pour cette version du package. </li><li>  Index de l'impact de cette vuln√©rabilit√© sur les infrastructures. </li><li>  Une liste de tous les serveurs sur lesquels une version vuln√©rable du package est d√©tect√©e. </li><li>  Lien vers le bulletin de s√©curit√©.  Vous permet de lire et de comprendre √† quel point cette vuln√©rabilit√© est critique dans notre situation. </li><li>  L'√©quipe corrigeant la vuln√©rabilit√© dans ce package. </li></ol><br><p>  Les donn√©es sont pr√©sent√©es tri√©es par <em>indice d'impact</em> , du maximum au minimum. </p><br><p>  <em>L'Impact Index</em> est le nombre de serveurs affect√©s multipli√© par le score de vuln√©rabilit√© CVSS.  Il arrive souvent qu'une vuln√©rabilit√© avec un score moins √©lev√© soit beaucoup plus r√©pandue dans l'infrastructure, et donc potentiellement plus dangereuse. </p><br><h2 id="vybirayte-strategii-ustraneniya-uyazvimostey">  Choisissez des strat√©gies de gestion de la vuln√©rabilit√© </h2><br><p>  Cependant, vous ne pouvez pas simplement prendre et mettre √† niveau tous les packages sur tous les serveurs vers la derni√®re version, ce qui √©limine les vuln√©rabilit√©s existantes. </p><br><p>  Dans toute infrastructure compos√©e de plusieurs serveurs, il existe de nombreuses restrictions: la d√©pendance d'un logiciel √† la version d'un autre, les risques de fonctionnalit√© alt√©r√©e, etc. </p><br><p>  Par cons√©quent, il y a toujours un choix - quels packages nous pouvons mettre √† jour sans douleur.  Quels packages n√©cessitent un plan de travail distinct pour la mise en ≈ìuvre des mesures compensatoires.  Et par ce que nous pouvons accepter des risques. </p><br><p>  L'approche propos√©e dans le plugin vous permet de choisir la strat√©gie d'√©limination des vuln√©rabilit√©s qui vous convient: </p><br><ul><li>  <strong>Une vuln√©rabilit√© dans l'ensemble de l'infrastructure:</strong> si une vuln√©rabilit√© sp√©cifique est critique pour vous, le plugin vous fournit des informations sur l'emplacement de cette vuln√©rabilit√© dans votre infrastructure et sur la mani√®re de la corriger imm√©diatement dans l'ensemble de l'infrastructure. </li><li>  <strong>Toutes les vuln√©rabilit√©s sur un serveur sp√©cifique:</strong> si vous avez besoin d'un serveur compl√®tement s√©curis√©, par exemple, situ√© dans la DMZ ou derri√®re le p√©rim√®tre de l'entreprise, en utilisant le plug-in, vous obtenez des informations sur la fa√ßon d'√©liminer toutes les vuln√©rabilit√©s trouv√©es sur celui-ci. </li></ul><br><h2 id="ustranyayte-naydennye-uyazvimosti">  Correction des vuln√©rabilit√©s trouv√©es </h2><br><p>  Mais il ne suffit pas de savoir quelles vuln√©rabilit√©s nous avons et de d√©terminer comment et lesquelles peuvent √™tre corrig√©es.  Il faut aussi faire √ßa! </p><br><p>  Des syst√®mes tels que Puppet ou Ansible sont largement utilis√©s pour la gestion centralis√©e de la configuration et les mises √† jour logicielles.  Vous pouvez utiliser la commande fix qui corrige la vuln√©rabilit√© et l'ex√©cuter de mani√®re centralis√©e √† l'aide de ces syst√®mes. </p><br><p>  Si votre infrastructure n'utilise pas de tels syst√®mes, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zabbix Threat Control</a> vous permet d'√©liminer les vuln√©rabilit√©s directement √† partir de l'interface Web de Zabbix. </p><br><p><img src="https://habrastorage.org/webt/f5/i7/pj/f5i7pjelugjzoildcxmb-qkttfc.png"></p><br><p>  Pour cela, le plugin utilise la fonctionnalit√© standard de Zabbix: confirmation des √©v√©nements et ex√©cution des commandes √† distance: </p><br><ol><li>  D√®s que le probl√®me est confirm√© via l'interface web par un utilisateur autoris√©; </li><li>  Une commande distante est lanc√©e qui ex√©cute sur le serveur cible, ou la liste des serveurs, une commande fix qui corrige la vuln√©rabilit√©. </li></ol><br><h2 id="kak-eto-rabotaet">  Comment √ßa marche </h2><br><p><img src="https://habrastorage.org/webt/io/mf/li/iomflipmyk5lxwmn8qbntuswufs.gif"></p><br><ol><li>  Le serveur Zabbix re√ßoit des informations sur les packages et le syst√®me d'exploitation de tous les serveurs de l'infrastructure via des agents zabbix. </li><li>  Le plugin (utilisant l'API Zabbix) re√ßoit un rapport de syst√®me d'exploitation pr√©c√©demment compil√© par le serveur Zabbix.  Le plugin ne re√ßoit rien directement des serveurs.  Et √† ce stade ne n√©cessite pas de contact direct avec eux. </li><li>  Apr√®s avoir trait√© les informations re√ßues de Zabbix, le plugin les transmet √† Vulners.  D'o√π il re√ßoit une liste des vuln√©rabilit√©s trouv√©es, leur criticit√©, et un moyen de les √©liminer. </li><li>  Le plugin traite les donn√©es re√ßues, les agr√®ge pour g√©n√©rer des statistiques et g√©n√®re des paquets de donn√©es pour la transmission √† Zabbix. </li><li>  Le plugin pousse les donn√©es Zabbix dans le format de syst√®me de surveillance requis.  Il le fait en utilisant l'utilitaire zabbix-sender.  Apr√®s cela, vous avez d√©j√† tout surveill√© sur les vuln√©rabilit√©s trouv√©es, qui sont affich√©es sur le tableau de bord montr√© pr√©c√©demment. </li><li>  Apr√®s avoir confirm√© le probl√®me, une commande √† distance est ex√©cut√©e, qui passe au plugin: <br><ul><li>  Le nom de la personne qui l'a initi√© </li><li>  Fix Vulnerability Fix Team </li><li>  Liste des serveurs </li></ul></li><li>  Apr√®s avoir re√ßu tout ce contr√¥le des menaces Zabbix: <br><ul><li>  V√©rifie que la commande de correction est lanc√©e par ceux qui en ont besoin.  De celui qui n'est pas n√©cessaire - il n'accepte pas la commande :) </li><li>  Ex√©cute la commande qui lui est transf√©r√©e sur le nombre de serveurs n√©cessaire. </li></ul></li></ol><br><p> Par d√©faut, le plugin envoie une commande fix aux serveurs vuln√©rables √† l'aide de l'utilitaire zabbix-get, acc√©dant √† l'agent Zabbix sur le serveur cible avec le param√®tre <code>nowait</code> .  Cette m√©thode de connexion permet au processus de mise √† jour des packages de s'ex√©cuter en arri√®re-plan sans √™tre li√© aux processus de l'agent zabbix.  Il est √©galement possible d'ex√©cuter la commande sur le serveur cible via une simple connexion SSH.  La mani√®re d'ex√©cuter les commandes fix est s√©lectionn√©e en option dans le fichier de configuration du plugin. </p><br><p>  Et du fait du travail - l'absence de serveurs vuln√©rables, votre bon sommeil et votre bonne humeur :) </p><br><h2 id="ustanovka">  L'installation </h2><br><p>  Nous avons parl√© de ce qu'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zabbix Threat Control</a> , pourquoi il est n√©cessaire et comment il fonctionne.  Nous allons maintenant vous expliquer comment l'installer et le configurer! </p><br><h3 id="zavisimosti">  D√©pendances </h3><br><p>  Pour fonctionner, le plugin ne n√©cessite rien de surnaturel.  Il est n√©cessaire que sur le <strong>serveur Zabbix</strong> sur lequel nous d√©finissons le plan, les √©l√©ments suivants soient: </p><br><ul><li>  <strong>zabbix v3.4</strong> pour l'utilisation de tableaux de bord personnalis√©s (ils n'apparaissaient que dans cette version). </li><li>  <strong>zabbix-sender est</strong> n√©cessaire pour envoyer des donn√©es de vuln√©rabilit√© au syst√®me de surveillance. </li><li>  <strong>zabbix-get</strong> pour envoyer des commandes fix qui corrigent les vuln√©rabilit√©s des serveurs. </li><li>  <strong>python v3</strong> avec modules: <strong>pyzabbix, jpath, requ√™tes</strong> pour ex√©cuter les principaux scripts du plugin. </li></ul><br><p>  Sur tous les <strong>serveurs pour lesquels l'analyse</strong> des vuln√©rabilit√©s est requise, uniquement: </p><br><ul><li>  <strong>zabbix-agent</strong> pour la collecte de donn√©es et l'ex√©cution de scripts. </li><li>  <strong>python v2</strong> pour ex√©cuter le script collectant le rapport du syst√®me d'exploitation. </li></ul><br><h3 id="ustanovka-plagina-iz-paketov">  Installer le plugin √† partir de packages </h3><br><p>  Pour commencer, connectez le r√©f√©rentiel aux packages: </p><br><p>  Distributions <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> rpm -Uhv https://repo.vulners.com/redhat/vulners-repo.rpm</code> </pre> <br><p>  Distributions <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> wget https://repo.vulners.com/debian/vulners-repo.deb dpkg -i vulners-repo.deb</code> </pre> <br><p>  Apr√®s cela, sur le serveur Zabbix, nous installons le package principal qui fournit toute la logique du plug-in et le package qui rend compte sur le syst√®me d'exploitation: </p><br><p>  Distributions <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Distributions <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Et sur tous les autres serveurs qui n√©cessitent une analyse des vuln√©rabilit√©s, nous installons un package qui g√©n√®re des rapports sur le syst√®me d'exploitation: </p><br><p>  Distributions <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-host</code> </pre> <br><p>  Distributions <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-host</code> </pre> <br><h3 id="ustanovka-iz-ishodnikov">  Installation √† partir de la source </h3><br><p>  Si vous pr√©f√©rez l'installation √† partir de la source, cela est √©galement tr√®s simple: </p><br><p>  Sur le serveur Zabbix, nous installons les scripts principaux qui fournissent toute la logique du plug-in et le script qui rapporte sur l'OS: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># main mkdir -p /opt/monitoring/zabbix-threat-control cp zabbix-threat-control/ztc* /opt/monitoring/zabbix-threat-control/ chown -R zabbix:zabbix /opt/monitoring/zabbix-threat-control chmod 640 /opt/monitoring/zabbix-threat-control/ztc_config.py touch /var/log/zabbix-threat-control.log chown zabbix:zabbix /var/log/zabbix-threat-control.log chmod 664 /var/log/zabbix-threat-control.log # host cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><p>  Sur tous les autres serveurs qui n√©cessitent une analyse des vuln√©rabilit√©s, nous installons uniquement un script qui rend compte du syst√®me d'exploitation: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># host mkdir -p /opt/monitoring/ cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><h2 id="nastroyka">  Personnalisation </h2><br><p>  Apr√®s l'installation, vous devez configurer le plugin et pr√©parer un syst√®me de surveillance pour son fonctionnement.  Voici une description √©tape par √©tape de toutes les actions n√©cessaires. </p><br><h3 id="nastraivaem-servera-trebuyuschie-skanirovaniya">  Configuration de serveurs n√©cessitant une analyse </h3><br><p>  Vous devez activer l'agent Zabbix pour ex√©cuter des commandes √† distance.  Pour ce faire, sur tous les serveurs pour lesquels une analyse est requise, modifiez les param√®tres dans le fichier de configuration de zabbix-agent comme indiqu√© ci-dessous: </p><br><pre> <code class="hljs">EnableRemoteCommands=1 LogRemoteCommands=1</code> </pre> <br><p>  Le fichier de configuration de l'agent zabbix se trouve g√©n√©ralement ici: <code>/etc/zabbix/zabbix_agentd.conf</code> </p><br><p>  Si vous souhaitez utiliser la fonctionnalit√© pour √©liminer les vuln√©rabilit√©s trouv√©es √† l'aide de <em>Zabbix Threat Control</em> , vous devez autoriser l'utilisateur zabbix √† <strong>mettre</strong> √† <strong>jour les</strong> packages (mais pas les installer ni les d√©sinstaller). </p><br>  Pour ce faire, ajoutez la ligne suivante au fichier <code>/etc/sudoers</code> : <br><p>  Pour les distributions <strong>RPM</strong> , la ligne ressemble √† ceci: </p><br><pre> <code class="hljs pgsql">zabbix <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>) NOPASSWD: /usr/bin/yum -y <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> *</code> </pre> <br><p>  Pour les distributions <strong>DEB</strong> un peu diff√©remment: </p><br><pre> <code class="hljs powershell">zabbix ALL=(ALL) NOPASSWD: /usr/bin/apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> -<span class="hljs-literal"><span class="hljs-literal">-assume</span></span><span class="hljs-literal"><span class="hljs-literal">-yes</span></span> install -<span class="hljs-literal"><span class="hljs-literal">-only</span></span><span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span> *</code> </pre> <br><h3 id="podklyuchaemsya-k-vulners">  Connectez-vous √† Vulner </h3><br><p>  Pour utiliser l'API Vulners, vous avez besoin d'une cl√© api.  Pour l'obtenir: </p><br><ul><li>  Inscrivez-vous sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vulners.com</a> </li><li>  Dans votre compte, acc√©dez √† l'onglet API KEYS </li><li>  S√©lectionnez "Num√©riser" dans la zone Port√©e et appuyez sur "G√âN√âRER UNE NOUVELLE CL√â". </li></ul><br><p>  Vous obtiendrez une cl√© API qui ressemble √† ceci: RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K9269B0K86K6XQQQR32O6007NUK </p><br><p><img src="https://habrastorage.org/webt/bu/r1/_8/bur1_85domk9m6gkzoaxsghzoqa.png"></p><br><p>  Maintenant, vous devez ajouter la cl√© API Vulners au fichier de configuration du plugin <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><p>  Un exemple: </p><br><pre> <code class="hljs 1c">vuln_api_key = 'RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K<span class="hljs-number"><span class="hljs-number">9269</span></span>B0K86K6XQQQR32O<span class="hljs-number"><span class="hljs-number">6007</span></span>NUK'</code> </pre> <br><h3 id="podklyuchaemsya-k-zabbix">  Connectez-vous √† Zabbix </h3><br><p>  Pour que le plugin puisse se connecter √† Zabbix, vous devez sp√©cifier les donn√©es suivantes dans le fichier de configuration: <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><ul><li>  Adresse de l'interface Web Zabbix pour travailler avec Zabbix-API; </li><li>  nom d'utilisateur et mot de passe sous lesquels nous nous connecterons √† l'API Zabbix. </li></ul><br>  Nom de domaine et port du serveur Zabbix pour l'envoi de donn√©es √† l'aide de l'utilitaire zabbix-sender. <br><br><p>  Un exemple: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">zbx_pass</span></span> = <span class="hljs-string"><span class="hljs-string">'yourpassword'</span></span> zbx_user = <span class="hljs-string"><span class="hljs-string">'yourlogin'</span></span> zbx_url = <span class="hljs-string"><span class="hljs-string">'https://zabbixfront.yourdomain.com'</span></span> zbx_server_fqdn = <span class="hljs-string"><span class="hljs-string">'zabbixserver.yourdomain.com'</span></span> zbx_server_port = <span class="hljs-string"><span class="hljs-string">'10051'</span></span></code> </pre> <br><h3 id="podgotavlivaem-zabbix">  Pr√©paration de Zabbix </h3><br><p>  Vous devez cr√©er des objets dans Zabbix qui fournissent le plugin.  Pour ce faire, ex√©cutez le script <code>/opt/monitoring/zabbix-threat-control/ztc_create.py</code> .  Le script v√©rifiera que le plugin est correctement configur√© et, en utilisant l'API, il cr√©era dans Zabbix: </p><br><ol><li>  <strong>Groupe</strong> d'h√¥tes auquel sont ajout√©s des h√¥tes affichant des vuln√©rabilit√©s. </li><li>  <strong>Le mod√®le</strong> par lequel le rapport du syst√®me d'exploitation est collect√© sur tous les serveurs. </li><li>  <strong>H√¥tes</strong> pour afficher les vuln√©rabilit√©s par packages, serveurs, bulletins et statistiques g√©n√©rales. </li><li>  <strong>Une action</strong> pour ex√©cuter des commandes de correction de vuln√©rabilit√© √† distance. </li><li>  <strong>Tableau</strong> de <strong>bord</strong> pour un affichage facile de toutes ces informations. </li></ol><br><p><img src="https://habrastorage.org/webt/mh/p1/qe/mhp1qeyu_r-c-zvxhtrthl0bzyg.gif"></p><br><p>  Apr√®s avoir cr√©√© tous les objets dans Zabbix, le script affichera: </p><br><ul><li>  Lien vers le tableau de bord cr√©√© dans Zabbix, sur lequel les vuln√©rabilit√©s seront affich√©es. </li><li>  Heure √† laquelle l'analyse de l'infrastructure √† la recherche de vuln√©rabilit√©s sera lanc√©e. </li></ul><br><p>  Une fois que tous les objets n√©cessaires ont √©t√© cr√©√©s dans Zabbix, vous devez acc√©der √† l'interface Web de Zabbix et lier le mod√®le "Vulners OS-Report" que vous venez de cr√©er par le script √† tous les serveurs qui n√©cessitent une analyse des vuln√©rabilit√©s. </p><br><p><img src="https://habrastorage.org/webt/0h/px/im/0hpxim3eoxm9zxk-_isvvvkpycu.png"></p><br><p>  Apr√®s cela, il reste √† attendre que le plugin d√©marre √† l'heure sp√©cifi√©e lors de l'installation. </p><br><h2 id="skaniruem">  Scannez! </h2><br><p>  Le script principal de traitement des donn√©es ( <code>ztc.py</code> ) est <code>ztc.py</code> automatiquement, une fois par jour, via le "Service Item ..." sur l'h√¥te "Vulners - Statistics" √† l'heure sp√©cifi√©e par le script. </p><br><p>  Vous pouvez modifier l'heure de d√©but du plug-in √† votre convenance en modifiant l '"intervalle de planification" dans cet √©l√©ment de donn√©es.  Dans ce cas, il est √©galement n√©cessaire d'ajuster le temps de collecte des statistiques dans les trois √©l√©ments de donn√©es du mod√®le "Vulners OS-Report" - les m√©triques du mod√®le devraient fonctionner 10 ... 15 minutes plus t√¥t que la m√©trique principale "Service Item ..." sur l'h√¥te "Vulners - Statistics". </p><br><p>  La dur√©e pendant laquelle toutes les donn√©es de vuln√©rabilit√© seront trait√©es d√©pend du nombre de serveurs dans l'infrastructure et du nombre de packages install√©s sur ceux-ci.  Environ 30 minutes sont consacr√©es au traitement de 1 000 serveurs. </p><br><h1 id="plany">  Plans </h1><br><p>  Ce n'est que la premi√®re version du plugin Zabbix Threat Control.  Et nous continuons √† le d√©velopper. </p><br>  Les plans: <br><br><ul><li>  Ajoutez des informations sur les tableaux de bord trouv√©s dans l'infrastructure CVE. </li><li>  Refusez d'installer des scripts sur les agents et de collecter toutes les informations n√©cessaires sur le syst√®me d'exploitation et les packages √† l'aide des cl√©s d'√©l√©ment de donn√©es int√©gr√©es √† l'agent Zabbix. </li></ul><br><p>  Et comme il est open source - rejoignez-nous!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les demandes de tirage sont les bienvenues :)</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416137/">https://habr.com/ru/post/fr416137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416127/index.html">CUDA et GPU √† distance</a></li>
<li><a href="../fr416129/index.html">Comment l'IA apprend √† g√©n√©rer des images de chats</a></li>
<li><a href="../fr416131/index.html">Comment g√©rer la MP dans la F√©d√©ration de Russie et ne pas enfreindre la loi</a></li>
<li><a href="../fr416133/index.html">Centre de donn√©es √† l'√©tranger: Equinix LD8</a></li>
<li><a href="../fr416135/index.html">Application GUI inf√©rieure √† 1 ko</a></li>
<li><a href="../fr416139/index.html">Authentification forte dans le cadre de la strat√©gie GDPR</a></li>
<li><a href="../fr416143/index.html">Le livre "Une autopsie va montrer!" Analyse pratique des malwares ¬ª</a></li>
<li><a href="../fr416147/index.html">Organisation de la navigation dans les applications iOS √† l'aide du Root Controller</a></li>
<li><a href="../fr416149/index.html">Questions et r√©ponses sur les √©nergies renouvelables, partie 1</a></li>
<li><a href="../fr416151/index.html">Ballon sans dimension. Magie d'analyse de dimension utilitaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>