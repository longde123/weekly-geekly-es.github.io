<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš² ğŸ™…ğŸ¾ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¾ å‡¿å­-ï¼ˆä¸å¤ªå®Œå…¨ï¼‰æ•°å­—é€»è¾‘å¼€å‘çš„æ–°æ–¹æ³• â˜£ï¸ ğŸ•¹ï¸ ğŸ†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="éšç€å¾®ç”µå­å­¦çš„å‘å±•ï¼ŒRTLè®¾è®¡å˜å¾—è¶Šæ¥è¶Šå¤šã€‚ å³ä½¿ä½¿ç”¨generateï¼Œå®å’Œç³»ç»ŸverilogèŠ¯ç‰‡ï¼Œverilogä»£ç çš„å¯é‡ç”¨æ€§ä¹Ÿå¸¦æ¥å¾ˆå¤šä¸ä¾¿ã€‚ ç„¶è€Œï¼ŒChiselä½¿å°†å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹çš„å…¨éƒ¨åŠŸèƒ½åº”ç”¨äºrtlå¼€å‘æˆä¸ºå¯èƒ½ï¼Œè¿™æ˜¯äººä»¬æœŸå¾…å·²ä¹…çš„ä¸€æ­¥ï¼Œå¯ä»¥ä¸ºASICå’ŒFPGAå¼€å‘äººå‘˜æä¾›æ–°é²œçš„ç©ºæ°”ã€‚ 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å‡¿å­-ï¼ˆä¸å¤ªå®Œå…¨ï¼‰æ•°å­—é€»è¾‘å¼€å‘çš„æ–°æ–¹æ³•</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419413/"><p><img src="https://habrastorage.org/webt/ka/wc/b5/kawcb52amqtfs9chlivqku8sj-a.jpeg"></p><br><p> éšç€å¾®ç”µå­å­¦çš„å‘å±•ï¼ŒRTLè®¾è®¡å˜å¾—è¶Šæ¥è¶Šå¤šã€‚ å³ä½¿ä½¿ç”¨generateï¼Œå®å’Œç³»ç»ŸverilogèŠ¯ç‰‡ï¼Œverilogä»£ç çš„å¯é‡ç”¨æ€§ä¹Ÿå¸¦æ¥å¾ˆå¤šä¸ä¾¿ã€‚ ç„¶è€Œï¼ŒChiselä½¿å°†å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹çš„å…¨éƒ¨åŠŸèƒ½åº”ç”¨äºrtlå¼€å‘æˆä¸ºå¯èƒ½ï¼Œè¿™æ˜¯äººä»¬æœŸå¾…å·²ä¹…çš„ä¸€æ­¥ï¼Œå¯ä»¥ä¸ºASICå’ŒFPGAå¼€å‘äººå‘˜æä¾›æ–°é²œçš„ç©ºæ°”ã€‚ </p><br><p> æœ¬æ–‡å°†ç®€è¦æ¦‚è¿°ä¸»è¦åŠŸèƒ½ï¼Œå¹¶è€ƒè™‘ä¸€äº›ç”¨æˆ·ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬è¿˜å°†è®¨è®ºè¯¥è¯­è¨€çš„ç¼ºç‚¹ã€‚ å°†æ¥ï¼Œå¦‚æœæ‚¨å¯¹è¯¥ä¸»é¢˜æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å°†åœ¨æ›´è¯¦ç»†çš„æ•™ç¨‹ä¸­ç»§ç»­è¯¥æ–‡ç« ã€‚ </p><a name="habracut"></a><br><h3 id="sistemnye-trebovaniya"> ç³»ç»Ÿè¦æ±‚ </h3><br><ul><li> æ ‡é‡åŸºç¡€å±‚ </li><li>  verilogå’Œæ„å»ºæ•°å­—è®¾è®¡çš„åŸºæœ¬åŸç†ã€‚ </li><li> ä¿æŒå‡¿å­æ–‡æ¡£æ–¹ä¾¿ </li></ul><br><p> æˆ‘å°†å°è¯•é€šè¿‡ç®€å•çš„ç¤ºä¾‹æ¥äº†è§£å‡¿å­çš„åŸºæœ¬çŸ¥è¯†ï¼Œä½†æ˜¯å¦‚æœä¸æ¸…æ¥šï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>çœ‹çœ‹ã€‚ </p><br><p> è‡³äºscalaï¼Œè¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤‡å¿˜å•</a>å¯èƒ½æœ‰åŠ©äºå¿«é€Ÿæ½œæ°´ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡¿å­ä¹Ÿæœ‰</a>ç±»ä¼¼çš„ä¸œè¥¿ã€‚ </p><br><p> å®Œæ•´çš„æ–‡ç« ä»£ç ï¼ˆä»¥scala sbté¡¹ç›®çš„å½¢å¼ï¼‰å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„æ‰¾åˆ°</a> ã€‚ </p><br><h3 id="prostoy-schetchik"> ç®€å•æŸœå° </h3><br><p> é¡¾åæ€ä¹‰ï¼Œâ€œåœ¨ScalaåµŒå…¥å¼è¯­è¨€ä¸­æ„å»ºç¡¬ä»¶â€å‡¿å­æ˜¯å»ºç«‹åœ¨scalaä¹‹ä¸Šçš„ç¡¬ä»¶æè¿°è¯­è¨€ã€‚ </p><br><p> ç„¶åç®€è¦ä»‹ç»ä¸€åˆ‡å·¥ä½œåŸç†ï¼šä»å‡¿å­ä¸Šçš„rtlæè¿°æ„å»ºç¡¬ä»¶å›¾ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºfirrtlè¯­è¨€çš„ä¸­é—´æè¿°ï¼Œç„¶åä»firrtl verilogç”Ÿæˆå†…ç½®çš„åç«¯è§£é‡Šå™¨ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•è®¡æ•°å™¨çš„ä¸¤ç§å®ç°ã€‚ </p><br><p>  Verilogï¼š </p><br><pre><code class="plaintext hljs">module SimpleCounter #( parameter WIDTH = 8 )( input clk, input reset, input wire enable, output wire [WIDTH-1:0] out ); reg [WIDTH-1:0] counter; assign out = counter; always @(posedge clk) if (reset) begin counter &lt;= {(WIDTH){1'b0}}; end else if (enable) begin counter &lt;= counter + 1; end endmodule</code> </pre> <br><p> å‡¿å­ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCounter</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enable = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) io.out &lt;&gt; counter when(io.enable) { counter := counter + <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span> } }</code> </pre> <br><p> å…³äºå‡¿å­çš„ä¸€ç‚¹ï¼š </p><br><ul><li>  <code>Module</code> -rtlæ¨¡å—æè¿°çš„å®¹å™¨ </li><li>  <code>Bundle</code>æ˜¯å‡¿å­ä¸­çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºå®šä¹‰æ¥å£ã€‚ </li><li>  <code>io</code>ç”¨äºç¡®å®šç«¯å£çš„å˜é‡ </li><li>  <code>Bool</code> -æ•°æ®ç±»å‹ï¼Œç®€å•çš„ä¸€ä½ä¿¡å· </li><li>  <code>UInt(width: Width)</code> -æ— ç¬¦å·æ•´æ•°ï¼Œæ„é€ å‡½æ•°æ¥å—ä¿¡å·çš„ä½æ·±ä½œä¸ºè¾“å…¥ã€‚ </li><li>  <code>RegInit[T &lt;: Data](init: T)</code>æ˜¯å¯„å­˜å™¨æ„é€ å‡½æ•°ï¼›å®ƒåœ¨è¾“å…¥å¤„é‡‡ç”¨å¤ä½å€¼ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ </li><li>  <code>&lt;&gt;</code> -é€šç”¨ä¿¡å·è¿æ¥è¿ç®—ç¬¦ </li><li>  <code>when(cond: =&gt; Bool) { /*...*/ }</code> -verilogä¸­çš„<code>if</code>æ¨¡æ‹Ÿ </li></ul><br><p> ç¨åæˆ‘ä»¬å°†è®¨è®ºå“ªä¸ªverilogäº§ç”Ÿå‡¿å­ã€‚ ç°åœ¨ï¼Œåªéœ€æ¯”è¾ƒè¿™ä¸¤ç§è®¾è®¡å³å¯ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œå‡¿å­ä¸­æ²¡æœ‰æåŠ<code>clk</code>å’Œ<code>reset</code>ä¿¡å·ã€‚ äº‹å®æ˜¯å‡¿å­é»˜è®¤æƒ…å†µä¸‹ä¼šå°†è¿™äº›ä¿¡å·æ·»åŠ åˆ°æ¨¡å—ä¸­ã€‚  <code>counter</code>å¯„å­˜å™¨çš„å¤ä½å€¼<code>RegInit</code>å¤ä½<code>RegInit</code>å¯„å­˜å™¨æ„é€ å‡½æ•°ã€‚  Chiselæ”¯æŒå…·æœ‰è®¸å¤šæ—¶é’Ÿä¿¡å·çš„æ¨¡å—ï¼Œä½†ä¸ä¹…ä¹‹åå°±æ”¯æŒäº†ã€‚ </p><br><h3 id="schetchik-chut-poslozhnee"> è®¡æ•°å™¨æœ‰ç‚¹å¤æ‚ </h3><br><p> è®©æˆ‘ä»¬è¿›ä¸€æ­¥è®²ï¼Œä½¿ä»»åŠ¡å¤æ‚ä¸€ç‚¹ï¼Œä¾‹å¦‚-æˆ‘ä»¬å°†ä½¿ç”¨è¾“å…¥å‚æ•°ä»¥æ¯ä¸ªé€šé“æŒ‰ä½åºåˆ—çš„å½¢å¼åˆ¶ä½œä¸€ä¸ªå¤šé€šé“è®¡æ•°å™¨ã€‚ </p><br><p> è®©æˆ‘ä»¬ä»å‡¿å­ç‰ˆæœ¬å¼€å§‹ </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiChannelCounter</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">] = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">(32, 16, 8, 4</span></span></span><span class="hljs-class">)) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enable = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Vec</span></span>(width.length, <span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.sum.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOut</span></span></span></span>(i: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">UInt</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> right = width.dropRight(width.length - i).sum <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.out(right + width(i) - <span class="hljs-number"><span class="hljs-number">1</span></span>, right) } }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counters: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">SimpleCounter</span></span>] = width.map(x =&gt; <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SimpleCounter</span></span>(x)) ) io.out &lt;&gt; util.<span class="hljs-type"><span class="hljs-type">Cat</span></span>(counters.map(_.io.out)) width.indices.foreach { i =&gt; counters(i).io.enable &lt;&gt; io.enable(i) } }</code> </pre> <br><p> å…³äºscalaçš„ä¸€ç‚¹ï¼š </p><br><ul><li>  <code>width: Seq[Int]</code> <code>MultiChannelCounter</code>ç±»çš„æ„é€ å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œç±»å‹ä¸º<code>Seq[Int]</code> -åŒ…å«æ•´æ•°å…ƒç´ çš„åºåˆ—ã€‚ </li><li>  <code>Seq</code>æ˜¯scalaä¸­å…·æœ‰æ˜ç¡®å®šä¹‰çš„å…ƒç´ åºåˆ—çš„é›†åˆç±»å‹ä¹‹ä¸€ã€‚ </li><li>  <code>.map</code>æ˜¯æ¯ä¸ªäººéƒ½ç†Ÿæ‚‰çš„é›†åˆå‡½æ•°ï¼Œç”±äºå¯¹æ¯ä¸ªå…ƒç´ çš„ç›¸åŒæ“ä½œï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€ä¸ªé›†åˆè½¬æ¢ä¸ºå¦ä¸€ä¸ªé›†åˆï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæ•´æ•°å€¼åºåˆ—å˜æˆå…·æœ‰ç›¸åº”ä½æ·±åº¦çš„<code>SimpleCounter</code>åºåˆ—ã€‚ </li></ul><br><p> å…³äºå‡¿å­çš„ä¸€ç‚¹ï¼š </p><br><ul><li>  <code>Vec[T &lt;: Data](gen: T, n: Int): Vec[T]</code> -å‡¿å­æ•°æ®ç±»å‹ï¼Œæ˜¯æ•°ç»„çš„æ¨¡æ‹Ÿã€‚ </li><li>  <code>Module[T &lt;: BaseModule](bc: =&gt; T): T</code>æ˜¯å¯å®ä¾‹åŒ–æ¨¡å—çš„å¿…éœ€åŒ…è£…æ–¹æ³•ã€‚ </li><li>  <code>util.Cat[T &lt;: Bits](r: Seq[T]): UInt</code>ä¸²è”å‡½æ•°ï¼Œåœ¨Verilogä¸­ç±»ä¼¼<code>{1'b1, 2'b01, 4'h0}</code> </li></ul><br><p> æ³¨æ„ç«¯å£ï¼š <br>  <code>Vec[Bool]</code>å¤§è‡´æ¥è¯´ï¼Œå·²ç»åœ¨<code>Vec[Bool]</code> *ä¸­éƒ¨ç½²ä¸ºä¸€ä¸ª1ä½ä¿¡å·çš„æ•°ç»„ï¼Œæ¯ä¸ªé€šé“ä¸€ä¸ªï¼Œå¯ä»¥åˆ¶ä½œ<code>UInt(width.length.W)</code> ã€‚ <br>  <code>out</code>æ‰©å±•ä¸ºæˆ‘ä»¬æ‰€æœ‰é€šé“çš„å®½åº¦ä¹‹å’Œã€‚ </p><br><p> å¯å˜<code>counters</code>æ˜¯æˆ‘ä»¬çš„è®¡æ•°å™¨æ•°ç»„ã€‚ æˆ‘ä»¬å°†æ¯ä¸ªè®¡æ•°å™¨çš„<code>enable</code>ä¿¡å·è¿æ¥åˆ°ç›¸åº”çš„è¾“å…¥ç«¯å£ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„<code>util.Cat</code>å‡½æ•°å°†æ‰€æœ‰<code>out</code>ä¿¡å·ç»„åˆä¸ºä¸€ä¸ªä¿¡å·ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°è¾“å‡ºã€‚ </p><br><p> æˆ‘ä»¬è¿˜æ³¨æ„åˆ°<code>getOut(i: Int)</code>å‡½æ•°-æ­¤å‡½æ•°è®¡ç®—å¹¶è¿”å›<code>i</code>é€šé“çš„<code>out</code>ä¿¡å·ä¸­çš„ä½èŒƒå›´ã€‚ è¿™å¯¹äºä½¿ç”¨æ­¤ç±»è®¡æ•°å™¨çš„è¿›ä¸€æ­¥å·¥ä½œå°†éå¸¸æœ‰ç”¨ã€‚ åœ¨verilogä¸­å®ç°è¿™æ ·çš„æ“ä½œå°†ä¸èµ·ä½œç”¨ </p><br><p>  * <code>Vec</code>ä¸åº”ä¸<code>Vector</code>æ··æ·†ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‡¿å­ä¸­çš„æ•°æ®æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯scalaä¸­çš„é›†åˆã€‚ </p><br><p> ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œç°åœ¨è®©æˆ‘ä»¬å°è¯•åœ¨verilogä¸Šç¼–å†™è¯¥æ¨¡å—ï¼Œç”šè‡³åœ¨systemVerilogä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚ </p><br><p> ç»è¿‡æ€è€ƒï¼Œæˆ‘æ¥åˆ°äº†è¿™ä¸ªé€‰é¡¹ï¼ˆå¾ˆå¯èƒ½å®ƒä¸æ˜¯å”¯ä¸€çš„ï¼Œæœ€ç†æƒ³çš„é€‰æ‹©ï¼Œä½†æ˜¯æ‚¨æ€»æ˜¯å¯ä»¥åœ¨æ³¨é‡Šä¸­å»ºè®®æ‚¨çš„å®ç°ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">Verilog</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">module MultiChannelCounter #( parameter TOTAL = 4, parameter integer WIDTH_SEQ [TOTAL] = {32, 16, 8, 4} )(clk, reset, enable, out); localparam OUT_WIDTH = get_sum(TOTAL, WIDTH_SEQ); input clk; input reset; input wire [TOTAL - 1 : 0] enable; output wire [OUT_WIDTH - 1 :0] out; genvar j; generate for(j = 0; j &lt; TOTAL; j = j + 1) begin : counter_generation localparam OUT_INDEX = get_sum(j, WIDTH_SEQ); SimpleCounter #( WIDTH_SEQ[j] ) SimpleCounter_unit ( .clk(clk), .reset(reset), .enable(enable[j]), .out(out[OUT_INDEX + WIDTH_SEQ[j] - 1: OUT_INDEX]) ); end endgenerate function automatic integer get_sum; input integer array_width; input integer array [TOTAL]; integer counter = 0; integer i; begin for(i = 0; i &lt; array_width; i = i + 1) counter = counter + array[i]; get_sum = counter; end endfunction endmodule</code> </pre> </div></div><br><p> å®ƒçœ‹èµ·æ¥å·²ç»ä»¤äººå°è±¡æ·±åˆ»ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯ä»¥ï¼Œæˆ‘ä»¬èµ°å¾—æ›´è¿œï¼Œå¹¶é€šè¿‡å…·æœ‰å¯„å­˜å™¨è®¿é—®æƒé™çš„æµè¡Œçš„wishboneæ¥å£è¿›è¡Œæ“ä½œã€‚ </p><br><h3 id="bundle-interfeysy"> æ†ç»‘æ¥å£ </h3><br><p>  Wishboneæ˜¯ç±»ä¼¼äºAMBA APBçš„å°å‹æ€»çº¿ï¼Œä¸»è¦ç”¨äºå¼€æ”¾æºIPå†…æ ¸ã€‚ </p><br><p>  Wikiä¸Šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//ru.wikipedia.org/wiki/Wishbone</a> </p><br><p> å› ä¸º å‡¿å­ä¸ºæˆ‘ä»¬æä¾›äº†<code>Bundle</code>ç±»å‹çš„æ•°æ®å®¹å™¨ï¼Œå°†æ€»çº¿åŒ…è£…åœ¨ä¸€ä¸ªå®¹å™¨ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä»¥åå¯ä»¥åœ¨ä»»ä½•å‡¿å­é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneMasterSignals</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, gotTag: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = false</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> adr = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(addrWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dat_master = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(dataWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dat_slave = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(dataWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stb = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> we = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cyc = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sel = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>((dataWidth / <span class="hljs-number"><span class="hljs-number">8</span></span>).<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ack_master = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ack_slave = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tag_master: <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gotTag) <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tag_slave: <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gotTag) <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbTransaction</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = cyc &amp;&amp; stb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbWrite</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = wbTransaction &amp;&amp; we <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbRead</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = wbTransaction &amp;&amp; !we <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneMasterSignals.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth, dataWidth, gotTag).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p> å…³äºscalaçš„ä¸€ç‚¹ï¼š </p><br><ul><li>  <code>Option</code> -scalaä¸­çš„å¯é€‰æ•°æ®åŒ…è£…å™¨ï¼Œå¯ä»¥æ˜¯å…ƒç´ æˆ–<code>None</code> ï¼Œ <code>Option[UInt]</code>æ˜¯<code>Some(UInt(/*...*/))</code>æˆ–<code>None</code> ï¼Œåœ¨å‚æ•°åŒ–ä¿¡å·æ—¶å¾ˆæœ‰ç”¨ã€‚ </li></ul><br><p> ä¼¼ä¹æ²¡ä»€ä¹ˆå¼‚å¸¸ã€‚ åªæ˜¯å‘å¯¼å¯¹æ¥å£çš„æè¿°ï¼Œé™¤äº†ä¸€äº›ä¿¡å·å’Œæ–¹æ³•ï¼š </p><br><p>  <code>tag_master</code>å’Œ<code>tag_slave</code>æ˜¯å‰éª¨åè®®ä¸­çš„å¯é€‰é€šç”¨ä¿¡å·ï¼Œå¦‚æœ<code>gotTag</code>å‚æ•°ä¸º<code>true</code> ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å®ƒä»¬ã€‚ </p><br><p>  <code>wbTransaction</code> ï¼Œ <code>wbWrite</code> ï¼Œ <code>wbRead</code>ç”¨äºç®€åŒ–æ€»çº¿çš„å·¥ä½œã€‚ </p><br><p>  <code>cloneType</code>æ‰€æœ‰å‚æ•°åŒ–çš„<code>[T &lt;: Bundle]</code>ç±»çš„å¿…éœ€ç±»å‹å…‹éš†æ–¹æ³• </p><br><p> ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä»å±æ¥å£ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°å®ƒã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlave</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, tagWidht: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 0</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb = <span class="hljs-type"><span class="hljs-type">Flipped</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth , dataWidth, tagWidht)) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneSlave.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(addrWidth, dataWidth, tagWidht).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p> æ­£å¦‚æ‚¨å¯èƒ½ä»åç§°ä¸­çŒœåˆ°çš„é‚£æ ·ï¼Œ <code>Flipped</code>æ–¹æ³•ç¿»è½¬äº†ç•Œé¢ï¼Œç°åœ¨æˆ‘ä»¬çš„å‘å¯¼ç•Œé¢å˜æˆäº†ä»å±ç•Œé¢ï¼Œæˆ‘ä»¬ä¸ºå‘å¯¼æ·»åŠ äº†ç›¸åŒçš„ç±»ã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneMaster</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, tagWidht: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 0</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth , dataWidth, tagWidht) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneMaster.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMaster(addrWidth, dataWidth, tagWidht).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p> å¥½äº†ï¼Œå°±æ˜¯è¿™æ ·ï¼Œç•Œé¢å·²ç»å‡†å¤‡å¥½äº†ã€‚ ä½†æ˜¯åœ¨ç¼–å†™å¤„ç†ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™äº›æ¥å£ï¼Œä»¥é˜²æˆ‘ä»¬éœ€è¦è¿›è¡Œåˆ‡æ¢æˆ–å¸¦æœ‰å¤§é‡å‰éª¨æ¥å£çš„ä¸œè¥¿ã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneCrossbarIo</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> slaves = <span class="hljs-type"><span class="hljs-type">Vec</span></span>(n, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(addrWidth, dataWidth, <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> master = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMaster(addrWidth, dataWidth, <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WBCrossBar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">WishboneCrossbarIo</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>)) io.master &lt;&gt; io.slaves(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p> è¿™æ˜¯äº¤æ¢æœºçš„ä¸€ä¸ªå°ç©ºç™½ã€‚ å£°æ˜ç±»å‹ä¸º<code>Vec[wishboneSlave]</code>çš„æ¥å£å¾ˆæ–¹ä¾¿ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„<code>&lt;&gt;</code>è¿ç®—ç¬¦è¿æ¥è¿™äº›æ¥å£ã€‚ åœ¨ç®¡ç†å¤§é‡ä¿¡å·æ—¶æœ‰ç”¨çš„å‡¿å­èŠ¯ç‰‡ã€‚ </p><br><h3 id="universalnyy-kontroller-shiny"> é€šç”¨æ€»çº¿æ§åˆ¶å™¨ </h3><br><p> å¦‚å‰æ‰€è¿°ï¼Œå…³äºåŠŸèƒ½å’Œå¯¹è±¡ç¼–ç¨‹çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†å°è¯•åº”ç”¨å®ƒã€‚ è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä»¥<code>trait</code>çš„å½¢å¼è®¨è®ºé€šç”¨å‰éª¨æ€»çº¿æ§åˆ¶å™¨çš„å®ç°ï¼Œè¿™å¯¹äºå¸¦æœ‰<code>wishboneSlave</code>æ€»çº¿çš„ä»»ä½•æ¨¡å—éƒ½æ˜¯æŸç§mixinï¼Œå¯¹äºè¯¥æ¨¡å—ï¼Œæ‚¨åªéœ€è¦å®šä¹‰ä¸€ä¸ªå­˜å‚¨å¡å¹¶åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å°†<code>trait</code>æ§åˆ¶å™¨ä¸å…¶æ··åˆå³å¯ã€‚ </p><br><h4 id="realizaciya"> å®ä½œ </h4><br><div class="spoiler">  <b class="spoiler_title">å¯¹äºé‚£äº›ä»ç„¶çƒ­æƒ…çš„äºº</b> <div class="spoiler_text"><p> è®©æˆ‘ä»¬ç»§ç»­å¤„ç†ç¨‹åºçš„å®ç°ã€‚ è¿™å¾ˆç®€å•ï¼Œå¯ä»¥ç«‹å³å¯¹å•ä¸ªäº‹åŠ¡ä½œå‡ºå“åº”ï¼Œä»¥é˜²ä»åœ°å€æ± ä¸­æ‰å‡ºï¼Œè¿”å›é›¶ã€‚ </p><br><p> è®©æˆ‘ä»¬åˆ†éƒ¨åˆ†è¿›è¡Œåˆ†æï¼š </p><br><ul><li><p> æ¯ç¬”äº¤æ˜“éƒ½éœ€è¦ç¡®è®¤ </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io : wishboneSlave = <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_ack = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) when(io.wb.wbTransaction) { wb_ack := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.otherwise { wb_ack := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } wb_ack &lt;&gt; io.wb.ack_slave</code> </pre> <br></li><li> æˆ‘ä»¬ä»¥æ•°æ®å›åº”é˜…è¯» <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_dat = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(io.wb.dat_slave.getWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// getWidth   when(io.wb.wbRead) { wb_dat := MuxCase(default = 0.U, Seq( (io.wb.addr === ADDR_1) -&gt; data_1, (io.wb.addr === ADDR_3) -&gt; data_2, (io.wb.addr === ADDR_3) -&gt; data_2 )) } wb_dat &lt;&gt; io.wb.dat_slave</span></span></code> </pre> <br><ul><li>  <code>MuxCase[T &lt;: Data] (default: T, mapping: Seq[(Bool, T)]): T</code>æ˜¯Verilog *ä¸­<code>case</code>ç±»å‹çš„å†…ç½®åè°ƒæ–¹æ¡ˆã€‚ </li></ul></li></ul><br><p> åœ¨verilogä¸­ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼š </p><br><pre> <code class="plaintext hljs"> always @(posedge clock) if(reset) wb_dat_o &lt;= 0; else if(wb_read) case (wb_adr_i) `ADDR_1 : wb_dat_o &lt;= data_1; `ADDR_2 : wb_dat_o &lt;= data_2; `ADDR_3 : wb_dat_o &lt;= data_3; default : wb_dat_o &lt;= 0; endcase }</code> </pre> <br><p>  *é€šå¸¸ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è¿›è¡Œå‚æ•°åŒ–ï¼Œè¿™æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼Œå‡¿å­å…·æœ‰æ ‡å‡†çš„è®¾è®¡ï¼Œå¦‚æœç¼–å†™æ›´ç®€å•çš„å†…å®¹ï¼Œåˆ™æ›´å¥½ã€‚ </p><br><pre> <code class="scala hljs">switch(x) { is(value1) { <span class="hljs-comment"><span class="hljs-comment">// ... } is(value2) { // ... } }</span></span></code> </pre> <br><p> å¥½å§ï¼Œè®°å½• </p><br><pre> <code class="scala hljs"> when(io.wb.wbWrite) { data_4 := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.wb.addr === <span class="hljs-type"><span class="hljs-type">ADDR_4</span></span>, io.wb.dat_master, data_4) }</code> </pre> <br><ul><li>  <code>Mux[T &lt;: Data](cond: Bool, con: T, alt: T): T</code>å¸¸è§„å¤šè·¯å¤ç”¨å™¨ </li></ul><br><p> æˆ‘ä»¬åµŒå…¥ç±»ä¼¼äºå¤šé€šé“è®¡æ•°å™¨çš„å†…å®¹ï¼ŒæŒ‚èµ·ç”¨äºé€šé“ç®¡ç†çš„å¯„å­˜å™¨å’Œå¸½å­ã€‚ ä½†æ˜¯åœ¨è¿™é‡Œï¼Œå®ƒä¸é€šç”¨WBæ€»çº¿æ§åˆ¶å™¨è¿‘åœ¨å’«å°ºï¼Œæˆ‘ä»¬å°†å‘å…¶ä¼ è¾“è¿™ç§å­˜å‚¨å¡ï¼š </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p> å¯¹äºè¿™æ ·çš„ä»»åŠ¡ï¼Œ <code>trait</code>ä¼šå¸®åŠ©æˆ‘ä»¬-åƒSalaä¸­çš„mixinsã€‚ ä¸»è¦ä»»åŠ¡æ˜¯ä½¿<code>readMemMap: [Int, Data]</code>çœ‹èµ·æ¥åƒ<code>Seq( -&gt; )</code> ï¼Œå¦‚æœå¯ä»¥åœ¨å­˜å‚¨å¡ä¸­ä¼ è¾“åŸºå€å’Œæ•°æ®æ•°ç»„ï¼Œé‚£ä¹Ÿå¾ˆå¥½ã€‚ </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p> å°†æ‰©å±•ä¸ºç±»ä¼¼çš„å†…å®¹ï¼Œå…¶ä¸­WB_DAT_WIDTHæ˜¯æ•°æ®çš„å®½åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_0</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_2</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_3</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p> ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªä»<code>Map[Int, Any]</code>åˆ°<code>Seq[(Bool, UInt)]</code>çš„è½¬æ¢å™¨å‡½æ•°ã€‚ æ‚¨å¿…é¡»ä½¿ç”¨Scalaæ¨¡å¼ç®—æœ¯ã€‚ </p><br><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseMemMap</span></span></span></span>(memMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>]): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = memMap.flatMap { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(addr, data) =&gt; data <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a: <span class="hljs-type"><span class="hljs-type">UInt</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>((io.wb.adr === addr.<span class="hljs-type"><span class="hljs-type">U</span></span>) -&gt; a) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] =&gt; a.map(x =&gt; (io.wb.adr === (addr + io.wb.dat_slave.getWidth / <span class="hljs-number"><span class="hljs-number">8</span></span>).<span class="hljs-type"><span class="hljs-type">U</span></span>) -&gt; x) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"WRONG MEM MAP!!!"</span></span>) } }.toSeq</code> </pre> <br><p> æœ€åï¼Œæˆ‘ä»¬çš„ç‰¹å¾å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlaveDriver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io : wishboneSlave <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parsedReadMap: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = parseMemMap(readMemMap) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parsedWriteMap: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = parseMemMap(writeMemMap) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_ack = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_dat = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(io.wb.dat_slave.getWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) when(io.wb.wbTransaction) { wb_ack := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.otherwise { wb_ack := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } when(io.wb.wbRead) { wb_dat := <span class="hljs-type"><span class="hljs-type">MuxCase</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> = <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>, parsedReadMap) } when(io.wb.wbWrite) { parsedWriteMap.foreach { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(addrMatched, data) =&gt; data := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(addrMatched, io.wb.dat_master, data) } } wb_dat &lt;&gt; io.wb.dat_slave wb_ack &lt;&gt; io.wb.ack_slave <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseMemMap</span></span></span></span>(memMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>]): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = { <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span>} }</code> </pre> <br><p> å…³äºscalaçš„ä¸€ç‚¹ï¼š </p><br><ul><li>  <code>io , readMemMap, writeMemMap</code>æ˜¯<code>trait</code> 'açš„æŠ½è±¡å­—æ®µï¼Œå¿…é¡»åœ¨å°†å…¶æ··åˆåˆ°çš„ç±»ä¸­å®šä¹‰ã€‚ </li></ul></div></div><br><h4 id="kak-im-polzovatsya"> ä½¿ç”¨æ–¹æ³• </h4><br><p> ä¸ºäº†å°†æˆ‘ä»¬çš„<code>trait</code>ä¸æ¨¡å—æ··åˆï¼Œå¿…é¡»æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š </p><br><ul><li>  <code>io</code>åº”è¯¥ç»§æ‰¿<code>wishboneSlave</code>ç±» </li><li> éœ€è¦å£°æ˜ä¸¤ä¸ªå­˜å‚¨å¡<code>readMemMap</code>å’Œ<code>writeMemMap</code> </li></ul><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneMultiChannelCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">BASE</span></span> = <span class="hljs-number"><span class="hljs-number">0x11A00000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">OUT</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">S_EN</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">H_EN</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000300</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbAddrWidth = <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbDataWidth = <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbTagWidth = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> width = <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(wbAddrWidth, wbDataWidth, wbTagWidth) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hardwareEnable: <span class="hljs-type"><span class="hljs-type">Vec</span></span>[<span class="hljs-type"><span class="hljs-type">Bool</span></span>] = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Vec</span></span>(width.length, <span class="hljs-type"><span class="hljs-type">Bool</span></span>())) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MultiChannelCounter</span></span>(width)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> softwareEnable = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(width.length.<span class="hljs-type"><span class="hljs-type">W</span></span>)) width.indices.foreach(i =&gt; counter.io.enable(i) := io.hardwareEnable(i) &amp;&amp; softwareEnable(i)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">OUT</span></span> -&gt; width.indices.map(counter.io.getOut), <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">S_EN</span></span> -&gt; softwareEnable, <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">H_EN</span></span> -&gt; io.hardwareEnable.asUInt ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">S_EN</span></span> -&gt; softwareEnable ) }</code> </pre> <br><p> æˆ‘ä»¬åˆ›å»ºäº†<code>softwareEnable</code>å¯„å­˜å™¨ï¼Œå¹¶é€šè¿‡<code>hardwareEnable</code>è¾“å…¥ä¿¡å·å°†å…¶æ·»åŠ åˆ°â€œå’Œâ€ä¸­ï¼Œå¹¶å¯ç”¨<code>counter[MultiChannelCounter]</code> ã€‚ </p><br><p> æˆ‘ä»¬å£°æ˜äº†ä¸¤ä¸ªç”¨äºè¯»å–å’Œå†™å…¥çš„å­˜å‚¨å¡ï¼š <code>readMemMap</code> <code>writeMemMap</code> ï¼Œæœ‰å…³ç»“æ„çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ä¸Šä¸€ç« ã€‚ <br> åœ¨è¯»å–å­˜å‚¨å¡ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“æ¯ä¸ªé€šé“çš„è®¡æ•°å™¨å€¼*ï¼Œ <code>softwareEnable</code>å’Œ<code>hardwareEnable</code> ã€‚ ä¸ºäº†è®°å½•ï¼Œæˆ‘ä»¬ä»…æä¾›<code>softwareEnable</code>å¯„å­˜å™¨ã€‚ </p><br><p>  * <code>width.indices.map(counter.io.getOut)</code> -ä¸€ä¸ªå¥‡æ€ªçš„è®¾è®¡ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œåˆ†éƒ¨åˆ†åˆ†æã€‚ </p><br><ul><li>  <code>width.indices</code>å°†è¿”å›å¸¦æœ‰å…ƒç´ ç´¢å¼•çš„æ•°ç»„ï¼Œå³ å¦‚æœ<code>width.length == 4</code>åˆ™<code>width.indices = {0, 1, 2, 3}</code> </li><li>  <code>{0, 1, 2, 3}.map(counter.io.getOut)</code> -ç»™å‡ºå¦‚ä¸‹å†…å®¹ï¼š <br> <code>{ counter.io.getOut(0), counter.io.getOut(1), /*...*/ }</code> </li> </ul><br><p> ç°åœ¨ï¼Œå¯¹äºå‡¿å­ä¸Šçš„ä»»ä½•æ¨¡å—ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å£°æ˜ç”¨äºè¯»å–å’Œå†™å…¥çš„å­˜å‚¨å¡ï¼Œå¹¶åœ¨ç”Ÿæˆæ—¶ç®€å•åœ°è¿æ¥é€šç”¨å‰éª¨æ€»çº¿æ§åˆ¶å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishbone_multicahnnel_counter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneMultiChannelCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlaveDriver</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countersDriver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"-td"</span></span>, <span class="hljs-string"><span class="hljs-string">"./src/generated"</span></span>), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishbone_multicahnnel_counter ) }</code> </pre> <br><p>  <code>wishboneSlaveDriver</code>è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨æ‰°æµå™¨ä¸‹æè¿°çš„ç‰¹å¾æ··åˆã€‚ </p><br><p> å½“ç„¶ï¼Œæ­¤ç‰ˆæœ¬çš„é€šç”¨æ§åˆ¶å™¨è¿˜è¿œè¿œä¸æ˜¯æœ€ç»ˆç‰ˆæœ¬ï¼Œè€Œæ˜¯ç›¸åã€‚ å…¶ä¸»è¦ç›®æ ‡æ˜¯æ¼”ç¤ºåœ¨å‡¿å­ä¸Šå¼€å‘rtlçš„å¯èƒ½æ–¹æ³•ä¹‹ä¸€ã€‚ å‡­å€Ÿscalaçš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ­¤ç±»æ–¹æ³•å¯èƒ½æ›´å¤§ï¼Œå› æ­¤æ¯ä¸ªå¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„åˆ›é€ åŠ›é¢†åŸŸã€‚ æ˜¯çš„ï¼Œé™¤äº†ä»¥ä¸‹å‡ ç‚¹ï¼Œæ²¡æœ‰ä»€ä¹ˆåœ°æ–¹å¯ä»¥ç‰¹åˆ«å—åˆ°å¯å‘çš„ï¼š </p><br><ul><li> æœ¬åœ°å‡¿å·¥å…·åº“ï¼Œå…³äºå®ƒçš„è¿›ä¸€æ­¥ä»‹ç»ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹æ¨¡å—å’Œæ¥å£çš„ç»§æ‰¿ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/freechipsproject/rocket-chip-risc-v</a>æ•´ä¸ªå†…æ ¸éƒ½æ˜¯åœ¨å‡¿å­ä¸Šå®ç°çš„ï¼Œå‰ææ˜¯æ‚¨éå¸¸äº†è§£scalaï¼Œå¯¹äºæ²¡æœ‰åŠå‡çš„åˆå­¦è€…ï¼Œæ­£å¦‚ä»–ä»¬æ‰€è¯´ï¼Œæ‚¨å°†éœ€è¦å¾ˆé•¿æ—¶é—´æ¥ç†è§£ã€‚ æ²¡æœ‰æœ‰å…³è¯¥é¡¹ç›®å†…éƒ¨ç»“æ„çš„æ­£å¼æ–‡ä»¶ã€‚ </li></ul><br><h3 id="multiclockdomain"> å¤šæ—¶é’ŸåŸŸ </h3><br><p> å¦‚æœæˆ‘ä»¬è¦æ‰‹åŠ¨æ§åˆ¶æ—¶é’Ÿå¹¶ç”¨å‡¿å­å¤ä½ä¿¡å·è¯¥æ€ä¹ˆåŠã€‚ ç›´åˆ°æœ€è¿‘ï¼Œè¿˜ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨æœ€æ–°ç‰ˆæœ¬ä¹‹ä¸€ä¸­ï¼Œå‡ºç°äº†å¯¹<code>withClock {}</code> ï¼Œ <code>withReset {}</code>å’Œ<code>withClockAndReset {}</code> ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleClockModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> in = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outB = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClock = <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) regClock &lt;&gt; io.out <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockB = withClock(io.clockB) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockB &lt;&gt; io.outB }</code> </pre> <br><ul><li>  <code>regClock</code>å°†ç”±æ ‡å‡†<code>clock</code>ä¿¡å·è®¡æ—¶å¹¶ç”±æ ‡å‡†å¤ä½å¤ä½çš„å¯„å­˜å™¨ </li><li>  <code>regClockB</code>æ‚¨é€šè¿‡<code>io.clockB</code>ä¿¡å·çŒœå‡ºäº†åŒä¸€å¯„å­˜å™¨çš„æ—¶é’Ÿï¼Œä½†æ˜¯å°†ä½¿ç”¨æ ‡å‡†å¤ä½ã€‚ </li></ul><br><p> å¦‚æœæˆ‘ä»¬è¦å®Œå…¨åˆ é™¤æ ‡å‡†<code>clock</code>å¹¶<code>reset</code>ä¿¡å·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®éªŒåŠŸèƒ½<code>RawModule</code> ï¼ˆæ²¡æœ‰æ ‡å‡†æ—¶é’Ÿå’Œé‡ç½®ä¿¡å·çš„æ¨¡å—ï¼Œæ¯ä¸ªäººéƒ½å¿…é¡»æ‰‹åŠ¨æ§åˆ¶ï¼‰ã€‚ ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiClockModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockA = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resetA = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resetB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> in = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outA = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outB = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockA = withClockAndReset(io.clockA, io.resetA) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockA &lt;&gt; io.outA <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockB = withClockAndReset (io.clockB, io.resetB) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockB &lt;&gt; io.outB }</code> </pre> <br><h3 id="utils-biblioteka"> å®ç”¨ç¨‹åºåº“ </h3><br><p> å‡¿å­å¸¦æ¥çš„ä»¤äººæ„‰æ‚¦çš„æ”¶è·å¹¶ä¸æ­¢äºæ­¤ã€‚ å®ƒçš„åˆ›å»ºè€…åŠªåŠ›å·¥ä½œï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªå°å‹ä½†éå¸¸æœ‰ç”¨çš„åº“ï¼Œå…¶ä¸­åŒ…å«å°å‹æ¥å£ï¼Œæ¨¡å—å’Œå‡½æ•°ã€‚ å¥‡æ€ªçš„æ˜¯ï¼ŒWikiä¸Šæ²¡æœ‰åº“çš„æè¿°ï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨å¼€å§‹æ—¶çœ‹åˆ°å¤‡å¿˜å•é“¾æ¥ï¼ˆæœ€åä¸¤ä¸ªéƒ¨åˆ†ï¼‰ </p><br><p> æ¥å£ï¼š </p><br><ul><li>  <code>DecoupledIO</code>æ˜¯å¸¸ç”¨çš„å°±ç»ª/æœ‰æ•ˆæ¥å£ã€‚ <br>  <code>DecoupledIO(UInt(32.W))</code> -å°†åŒ…å«ä»¥ä¸‹ä¿¡å·ï¼š <br> <code>val ready = Input(Bool())</code> <br> <code>val valid = Output(Bool())</code> <br> <code>val data = Output(UInt(32.W))</code> </li> <li>  <code>ValidIO</code>ä»…åœ¨æœª<code>ready</code>ä¸<code>ValidIO</code>ç›¸åŒ </li></ul><br><p> æ¨¡å—ï¼š </p><br><ul><li>  <code>Queue</code> -åŒæ­¥FIFOæ¨¡å—éå¸¸æœ‰ç”¨ï¼Œç•Œé¢çœ‹èµ·æ¥åƒ <br>  <code>val enq: DecoupledIO[T]</code> -åå‘çš„<code>DecoupledIO</code> <br>  <code>val deq: DecoupledIO[T]</code> -å¸¸è§„çš„<code>val deq: DecoupledIO[T]</code> <br>  <code>val count: UInt</code>é˜Ÿåˆ—ä¸­çš„æ•°æ®é‡ </li><li>  <code>Pipe</code> -å»¶è¿Ÿæ¨¡å—ï¼Œæ’å…¥ç¬¬nä¸ªå¯„å­˜å™¨ç‰‡ </li><li>  <code>Arbiter</code>å™¨<code>DecoupledIO</code>æ¥å£ä¸Šçš„ä»²è£å™¨ï¼Œå…·æœ‰è®¸å¤šäºšç§ï¼Œå…¶ä»²è£ç±»å‹ä¸åŒ <br>  <code>val in: Vec[DecoupledIO[T]]</code> -è¾“å…¥æ¥å£çš„æ•°ç»„ <br> <code>val out: DecoupledIO[T]</code> <br>  <code>val chosen: UInt</code> selected <code>val chosen: UInt</code>æ˜¾ç¤ºé€‰å®šçš„é¢‘é“ </li></ul><br><p> ä»å¯¹githubçš„è®¨è®ºä¸­å¯ä»¥äº†è§£åˆ°çš„-åœ¨å…¨å±€è®¡åˆ’ä¸­ï¼Œè¯¥æ¨¡å—åº“æœ‰å¤§é‡æ‰©å±•ï¼šä¾‹å¦‚å¼‚æ­¥FIFOï¼ŒLSSFRï¼Œåˆ†é¢‘å™¨ï¼ŒFPGAçš„PLLæ¨¡æ¿ï¼› å„ç§æ¥å£ï¼› ä»–ä»¬çš„æ§åˆ¶å™¨ç­‰ç­‰ã€‚ </p><br><h3 id="chisel-io-teseters"> å‡¿å­é’³å·¥ </h3><br><p> åº”è¯¥æåˆ°åœ¨å‡¿å­ä¸­è¿›è¡Œæµ‹è¯•çš„å¯èƒ½æ€§ï¼Œç›®å‰æœ‰ä¸¤ç§æµ‹è¯•æ–¹æ³•ï¼š </p><br><ul><li>  <code>peekPokeTesters</code>çº¯ç²¹çš„æ¨¡æ‹Ÿæµ‹è¯•ï¼Œå¯ä»¥æµ‹è¯•è®¾è®¡çš„é€»è¾‘ </li><li><p>  <code>hardwareIOTeseters</code>å·²ç»å˜å¾—æ›´åŠ æœ‰è¶£ï¼Œå› ä¸º é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªç”Ÿæˆçš„tesetå·¥ä½œå°ï¼Œå…¶ä¸­åŒ…å«æ‚¨åœ¨å‡¿å­ä¸Šç¼–å†™çš„æµ‹è¯•ï¼Œå³ä½¿æ‚¨æ‹¥æœ‰Verilatorï¼Œæ‚¨ç”šè‡³è¿˜ä¼šå¾—åˆ°ä¸€ä¸ªæ—¶é—´è¡¨ã€‚ </p><br><p> ä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæµ‹è¯•æ–¹æ³•å°šæœªæœ€ç»ˆç¡®å®šï¼Œè®¨è®ºä»åœ¨è¿›è¡Œä¸­ã€‚ å°†æ¥ï¼Œæœ€æœ‰å¯èƒ½å‡ºç°é€šç”¨å·¥å…·ï¼Œç”¨äºæµ‹è¯•å’Œæµ‹è¯•ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨å‡¿å­ä¸Šä¹¦å†™ã€‚ ä½†æ˜¯ç°åœ¨ï¼Œæ‚¨å¯ä»¥çœ‹çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>å·²ç»æœ‰ä»€ä¹ˆä»¥åŠå¦‚ä½•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨å®ƒ</a> ã€‚ </p><br></li></ul><br><h3 id="nedostatki-chisel"> å‡¿å­çš„ç¼ºç‚¹ </h3><br><p> è¿™å¹¶ä¸æ˜¯è¯´å‡¿å­æ˜¯ä¸€ç§é€šç”¨å·¥å…·ï¼Œæ¯ä¸ªäººéƒ½åº”è¯¥ä½¿ç”¨å®ƒã€‚ ä»–å¯èƒ½ä¸å¼€å‘é˜¶æ®µçš„æ‰€æœ‰é¡¹ç›®ä¸€æ ·ï¼Œéƒ½æœ‰å…¶ç¼ºç‚¹ï¼Œä¸ºå®Œæ•´èµ·è§ï¼Œå€¼å¾—ä¸€æã€‚ </p><br><p> ç¬¬ä¸€ä¸ªä¹Ÿè®¸ä¹Ÿæ˜¯æœ€é‡è¦çš„ç¼ºç‚¹æ˜¯ç¼ºå°‘å¼‚æ­¥åˆ·æ–°ã€‚ è¶³å¤Ÿé‡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è§£å†³ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯åŸºäºverilogçš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬å°†åŒæ­¥é‡ç½®å˜ä¸ºå¼‚æ­¥ã€‚ è¿™å¾ˆå®¹æ˜“åšåˆ°ï¼Œå› ä¸º ç”Ÿæˆçš„verilogä¸­çš„æ‰€æœ‰æ„é€ <code>always</code>éå¸¸ç»Ÿä¸€ã€‚ </p><br><p> è®¸å¤šäººè®¤ä¸ºï¼Œç¬¬äºŒä¸ªç¼ºç‚¹æ˜¯ç”Ÿæˆçš„Verilogæ— æ³•è¯»å–ï¼Œå› æ­¤ï¼Œè°ƒè¯•å¾ˆå¤æ‚ã€‚ ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ä¸­ç”Ÿæˆçš„ä»£ç  </p><br><div class="spoiler">  <b class="spoiler_title">äº§ç”Ÿçš„verilog</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">`ifdef RANDOMIZE_GARBAGE_ASSIGN `define RANDOMIZE `endif `ifdef RANDOMIZE_INVALID_ASSIGN `define RANDOMIZE `endif `ifdef RANDOMIZE_REG_INIT `define RANDOMIZE `endif `ifdef RANDOMIZE_MEM_INIT `define RANDOMIZE `endif module SimpleCounter( input clock, input reset, input io_enable, output [7:0] io_out ); reg [7:0] counter; reg [31:0] _RAND_0; wire [8:0] _T_7; wire [7:0] _T_8; wire [7:0] _GEN_0; assign _T_7 = counter + 8'h1; assign _T_8 = _T_7[7:0]; assign _GEN_0 = io_enable ? _T_8 : counter; assign io_out = counter; `ifdef RANDOMIZE integer initvar; initial begin `ifndef verilator #0.002 begin end `endif `ifdef RANDOMIZE_REG_INIT _RAND_0 = {1{$random}}; counter = _RAND_0[7:0]; `endif // RANDOMIZE_REG_INIT end `endif // RANDOMIZE always @(posedge clock) begin if (reset) begin counter &lt;= 8'h0; end else begin if (io_enable) begin counter &lt;= _T_8; end end end endmodule</code> </pre> </div></div><br><p> ä¹ä¸€çœ‹ï¼Œå³ä½¿åœ¨ä¸­ç­‰å¤§å°çš„è®¾è®¡ä¸­ï¼Œç”Ÿæˆçš„Verilogä¹Ÿå¯ä»¥æ¨å¼€ï¼Œä½†è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ã€‚ </p><br><ul><li>  RANDOMIZEå®šä¹‰-ï¼ˆåœ¨ä½¿ç”¨å‡¿å­æµ‹è¯•ä»ªè¿›è¡Œæµ‹è¯•æ—¶å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºï¼‰-é€šå¸¸æ— ç”¨ï¼Œä½†å®ƒä»¬ä¸ä¼šç‰¹åˆ«å¹²æ‰° </li><li> æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ç«¯å£åç§°ä¸€æ ·ï¼Œå¯„å­˜å™¨è¢«ä¿ç•™ </li><li>  _GEN_0å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªæ— ç”¨çš„å˜é‡ï¼Œä½†å¯¹äºè§£é‡Šå™¨æ¥è¯´æ˜¯å¿…éœ€çš„ï¼Œä»¥ç”Ÿæˆverilogã€‚ æˆ‘ä»¬ä¹Ÿæ²¡æœ‰æ³¨æ„å®ƒã€‚ </li><li> å‰©ä¸‹_T_7å’Œ_T_8ï¼Œç”Ÿæˆçš„Verilogä¸­çš„æ‰€æœ‰ç»„åˆé€»è¾‘å°†ä»¥å˜é‡_Tçš„å½¢å¼é€æ­¥å‘ˆç°ã€‚ </li></ul><br><p> æœ€é‡è¦çš„æ˜¯ï¼Œè°ƒè¯•æ‰€éœ€çš„æ‰€æœ‰ç«¯å£ï¼Œå¯„å­˜å™¨å’Œæ¥çº¿éƒ½ä¸è¦ä½¿ç”¨å‡¿å­ã€‚ è€Œä¸”ï¼Œå¦‚æœæ‚¨ä¸ä»…æŸ¥çœ‹verilogï¼Œè¿˜æŸ¥çœ‹å‡¿å­ï¼Œé‚£ä¹ˆå¾ˆå¿«è°ƒè¯•è¿‡ç¨‹å°†å˜å¾—ä¸ä½¿ç”¨çº¯verilogä¸€æ ·å®¹æ˜“ã€‚ </p><br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p> åœ¨ç°ä»£ç°å®ä¸­ï¼ŒRTLçš„å¼€å‘ï¼ˆæ— è®ºæ˜¯åœ¨å­¦æœ¯ç¯å¢ƒä¹‹å¤–çš„asicè¿˜æ˜¯fpgaï¼‰å·²ç»ä»ä»…ä½¿ç”¨çº¯æ‰‹å†™Verilogä»£ç å‘å±•ä¸ºä¸€ç§æˆ–å¦ä¸€ç§ç”Ÿæˆè„šæœ¬ï¼Œæ— è®ºæ˜¯å°å‹tclè„šæœ¬è¿˜æ˜¯å…·æœ‰è®¸å¤šåŠŸèƒ½çš„æ•´ä¸ªIDEã€‚ </p><br><p> åè¿‡æ¥ï¼ŒChiselæ˜¯ç”¨äºæ•°å­—é€»è¾‘å¼€å‘å’Œæµ‹è¯•çš„è¯­è¨€çš„é€»è¾‘å¼€å‘ã€‚ å‡è®¾ä»–åœ¨è¿™ä¸ªé˜¶æ®µè¿˜è¿œè¿œä¸å¤Ÿå®Œç¾ï¼Œä½†æ˜¯å·²ç»èƒ½å¤Ÿæä¾›æœºä¼šå¼¥è¡¥ä»–çš„ç¼ºç‚¹ã€‚      ,                   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419413/">https://habr.com/ru/post/zh-CN419413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419401/index.html">Javaå‘½ä»¤è¡Œç•Œé¢ï¼špicocli</a></li>
<li><a href="../zh-CN419405/index.html">IPv6çš„æƒ…å†µå¦‚ä½•ï¼Œæˆ–é˜»ç¢è¿‡æ¸¡åˆ°è¯¥åè®®çš„æ–°ç‰ˆæœ¬çš„åŸå› -è®¨è®ºæƒ…å†µ</a></li>
<li><a href="../zh-CN419407/index.html">OpenAIå’Œ5x5æ ¼å¼çš„äººä¹‹é—´çš„Dota 2åŒ¹é…çš„è¯¦ç»†åˆ†æã€‚ äººä»¬è¿·è·¯äº†</a></li>
<li><a href="../zh-CN419409/index.html">åŸºäºCoffee Lakeå¤„ç†å™¨çš„æ–°å‹è‹±ç‰¹å°”NUC</a></li>
<li><a href="../zh-CN419411/index.html">å…³äºæ‘©å¤©å¤§æ¥¼ä¸­çš„å¤§ç«ã€‚ ç”µå½±ä¸ç°å®</a></li>
<li><a href="../zh-CN419415/index.html">Mattermostå’ŒPowershell-å¼ºå¤§çš„åŠŸèƒ½æˆ–å®¶åº­ä¸­çš„å°å‹è‡ªåŠ¨åŒ–</a></li>
<li><a href="../zh-CN419417/index.html">GDPRï¼šæ•°æ®æ˜ å°„æˆ–å®¢æˆ·å¦‚ä½•æ‰¾åˆ°é•¿æœŸè¢«é—å¿˜çš„ç¬”è®°æœ¬ç”µè„‘</a></li>
<li><a href="../zh-CN419419/index.html">UIè‡ªåŠ¨æµ‹è¯•ï¼šè¿™æ ·åšæ˜¯ä¸å€¼å¾—çš„</a></li>
<li><a href="../zh-CN419423/index.html">æˆ‘ä»¬æ‰¿è¯ºå‘æˆ‘ä»¬æä¾›å®æ—¶è§†é¢‘ï¼Œä¸å¸¦frå’ŒæŠ½æ</a></li>
<li><a href="../zh-CN419425/index.html">å®‰å…¨å‘¨29.é»‘å®¢Redditï¼Œä¸€ç§ç”¨äºåŠ å¯†è´§å¸å’ŒMikroTikè·¯ç”±å™¨çš„é’±åŒ…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>