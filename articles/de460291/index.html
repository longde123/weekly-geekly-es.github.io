<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèø üåü üë®‚Äçüëß‚Äçüë¶ Probleme der Stapelverarbeitung von Anfragen und deren L√∂sungen (Teil 1) üëñ üíö üë®üèΩ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fast alle modernen Softwareprodukte bestehen aus mehreren Diensten. Oft werden lange Antwortzeiten zwischen Kan√§len zwischen Diensten zu einer Ursache...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Probleme der Stapelverarbeitung von Anfragen und deren L√∂sungen (Teil 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/custis/blog/460291/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/0r/ap/sb0raprlu2jwllu3gasyznuom40.jpeg"></div>  Fast alle modernen Softwareprodukte bestehen aus mehreren Diensten.  Oft werden lange Antwortzeiten zwischen Kan√§len zwischen Diensten zu einer Ursache f√ºr Leistungsprobleme.  Die Standardl√∂sung f√ºr diese Art von Problem besteht darin, mehrere dienst√ºbergreifende Anforderungen in ein Paket zu packen, was als Batching bezeichnet wird. <br><br>  Wenn Sie die Stapelverarbeitung verwenden, sind Sie m√∂glicherweise nicht zufrieden mit dem Ergebnis in Bezug auf Leistung oder Codeverst√§ndlichkeit.  Diese Methode ist f√ºr den Anrufer nicht so einfach, wie Sie vielleicht denken.  F√ºr verschiedene Zwecke und in verschiedenen Situationen k√∂nnen Entscheidungen sehr unterschiedlich sein.  An konkreten Beispielen werde ich die Vor- und Nachteile verschiedener Ans√§tze aufzeigen. <br><a name="habracut"></a><br><h2>  Demo-Projekt </h2><br>  Betrachten Sie zur Verdeutlichung ein Beispiel f√ºr einen der Dienste in der Anwendung, an der ich gerade arbeite. <br><br><div class="spoiler">  <b class="spoiler_title">Eine Erkl√§rung der Wahl der Plattform f√ºr Beispiele</b> <div class="spoiler_text">  Das Problem der schlechten Leistung ist recht allgemein und gilt nicht f√ºr bestimmte Sprachen und Plattformen.  In diesem Artikel werden Spring + Kotlin-Codebeispiele verwendet, um Aufgaben und L√∂sungen zu demonstrieren.  Kotlin ist f√ºr Java- und C # -Entwickler gleicherma√üen verst√§ndlich (oder unverst√§ndlich). Au√üerdem ist der Code kompakter und verst√§ndlicher als in Java.  Um reinen Java-Entwicklern das Verst√§ndnis zu erleichtern, werde ich die schwarze Magie von Kotlin vermeiden und nur Wei√ü verwenden (im Geiste von Lombok).  Es wird einige Erweiterungsmethoden geben, die jedoch allen Java-Programmierern als statische Methoden bekannt sind. Dies ist also ein wenig Zucker, der den Geschmack des Gerichts nicht beeintr√§chtigt. </div></div><br>  Es gibt einen Dokumentgenehmigungsdienst.  Jemand erstellt ein Dokument und legt es zur Diskussion vor, w√§hrenddessen √Ñnderungen vorgenommen werden. Letztendlich ist das Dokument konsistent.  Der Abstimmungsdienst selbst wei√ü nichts √ºber Dokumente: Es handelt sich lediglich um einen Chat von Koordinatoren mit kleinen zus√§tzlichen Funktionen, die wir hier nicht ber√ºcksichtigen werden. <br><br>  Es gibt also Chatrooms (entsprechend den Dokumenten) mit jeweils einer vordefinierten Gruppe von Teilnehmern.  Wie in normalen Chats enthalten Nachrichten Text und Dateien und k√∂nnen beantwortet und weitergeleitet werden: <br><br> <code><font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="3f7f5f">// nullable      persist <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="3f7f5f">// -   JPA+    null,    <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br>  Links zu der Datei und dem Benutzer sind Links zu anderen Dom√§nen.  Es lebt bei uns so: <br><br> <code><font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font> <font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font></code> <br>  Benutzerdaten werden in Keycloak gespeichert und √ºber REST abgerufen.  Gleiches gilt f√ºr Dateien: Dateien und Metainformationen dar√ºber befinden sich in einem separaten Dateispeicherdienst. <br><br>  Alle Anrufe bei diesen Diensten sind <strong>schwere Anfragen</strong> .  Dies bedeutet, dass der Aufwand f√ºr den Transport dieser Anforderungen viel gr√∂√üer ist als die Zeit, die sie f√ºr die Verarbeitung durch einen Drittanbieter ben√∂tigen.  Auf unseren Pr√ºfst√§nden betr√§gt die typische Anrufzeit f√ºr solche Dienste 100 ms, daher werden wir diese Nummern in Zukunft verwenden. <br><br>  Wir m√ºssen einen einfachen REST-Controller erstellen, um die letzten N Nachrichten mit allen erforderlichen Informationen zu empfangen.  Das hei√üt, wir glauben, dass das Nachrichtenmodell im Frontend fast dasselbe ist und wir alle Daten senden m√ºssen.  Der Unterschied zwischen dem Frontend-Modell besteht darin, dass die Datei und der Benutzer in einer leicht entschl√ºsselten Form dargestellt werden m√ºssen, damit sie verkn√ºpft werden: <br><br> <code><font color="395da1">/**          */ <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="395da1">/**   url */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">ref</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">&gt;, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br>  Wir m√ºssen Folgendes implementieren: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br>  Postfix UI bedeutet DTO-Modelle f√ºr das Frontend, das hei√üt, was wir durch REST geben m√ºssen. <br><br>  Es mag hier √ºberraschend erscheinen, dass wir keine Chat-ID √ºbergeben und dies auch im ChatMessage / ChatMessageUI-Modell nicht ist.  Ich habe dies absichtlich getan, um den Code f√ºr die Beispiele nicht zu √ºberladen (die Chats sind isoliert, sodass wir davon ausgehen k√∂nnen, dass wir √ºberhaupt einen haben). <br><br><div class="spoiler">  <b class="spoiler_title">Philosophischer R√ºckzug</b> <div class="spoiler_text">  Sowohl die ChatMessageUI-Klasse als auch die ChatRestApi.getLast-Methode verwenden den List-Datentyp, w√§hrend dies tats√§chlich eine geordnete Menge ist.  Im JDK ist dies alles schlecht, sodass das Deklarieren der Reihenfolge der Elemente auf Schnittstellenebene (Beibehalten der Reihenfolge beim Hinzuf√ºgen und Extrahieren) fehlschl√§gt.  Es ist daher √ºblich, List in F√§llen zu verwenden, in denen Sie ein bestelltes Set ben√∂tigen (es gibt immer noch ein LinkedHashSet, dies ist jedoch keine Schnittstelle). </div></div><br>  <b>Eine wichtige Einschr√§nkung:</b> Wir gehen davon aus, dass es keine langen Ketten von Antworten oder Vorw√§rtsbewegungen gibt.  Das hei√üt, sie sind es, aber ihre L√§nge √ºberschreitet drei Nachrichten nicht.  Die Front-End-Nachrichtenkette muss vollst√§ndig √ºbertragen werden. <br><br>  Um Daten von externen Diensten zu empfangen, gibt es folgende APIs: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>findLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>FileReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>FileRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>FileReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>FileHeadRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByChat</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>UserRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br>  Es ist ersichtlich, dass die Stapelverarbeitung urspr√ºnglich in externen Diensten vorgesehen war, und zwar in beiden F√§llen: √ºber Set (ohne die Reihenfolge der Elemente mit eindeutigen Schl√ºsseln beizubehalten) und √ºber List (es kann Duplikate geben - die Reihenfolge bleibt erhalten). <br><br><h2>  Einfache Implementierungen </h2><br><h4>  Naive Umsetzung </h4><br>  Die erste naive Implementierung unseres REST-Controllers sieht in den meisten F√§llen ungef√§hr so ‚Äã‚Äãaus: <br><br> <code><font color="7f0055"><b>class</b></font> <font color="3e7eff"><b>ChatRestController</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">messageRepository</font> : <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">userRepository</font> : <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">fileRepository</font> : <font color="3e7eff"><b>FileRemoteApi <br></b></font> <font color="000066">)</font> : <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>it</i></font> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b><br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> <font color="000066"><i>files</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">} <br></font></code> <br>  Alles ist sehr klar und das ist ein gro√ües Plus. <br><br>  Wir verwenden die Stapelverarbeitung und empfangen Daten von einem externen Dienst in Stapeln.  Aber was passiert mit der Leistung? <br><br>  F√ºr jede Nachricht wird ein Aufruf von UserRemoteApi ausgef√ºhrt, um Daten im Autorenfeld abzurufen, und ein Aufruf von FileRemoteApi, um alle angeh√§ngten Dateien zu erhalten.  Es scheint alles zu sein.  Angenommen, die Felder forwardFrom und replyTo f√ºr ChatMessage werden abgerufen, sodass keine zus√§tzlichen Aufrufe erforderlich sind.  Die Umwandlung in ChatMessageUI f√ºhrt jedoch zu einer Rekursion, dh die Leistung der Anrufanzahl kann erheblich gesteigert werden.  Nehmen wir an, wir haben nicht viel Verschachtelung und die Kette ist auf drei Nachrichten beschr√§nkt. <br><br>  Infolgedessen erhalten wir zwei bis sechs Anrufe an externe Dienste pro Nachricht und einen JPA-Anruf an das gesamte Nachrichtenpaket.  Die Gesamtzahl der Anrufe variiert zwischen 2 * N + 1 und 6 * N + 1.  Wie viel kostet das in realen Einheiten?  Angenommen, Sie ben√∂tigen 20 Beitr√§ge, um eine Seite zu rendern.  Um sie zu bekommen, ben√∂tigen Sie 4 s bis 10 s.  Schrecklich  Ich m√∂chte die 500 ms treffen.  Und da das Front-End davon getr√§umt hat, einen nahtlosen Bildlauf durchzuf√ºhren, k√∂nnen die Leistungsanforderungen dieses Endpunkts verdoppelt werden. <br><br>  <b>Vorteile:</b> <br><br><ol><li>  Der Code ist pr√§gnant und selbstdokumentierend (Support-Traum). </li><li>  Der Code ist einfach, so dass es fast keine M√∂glichkeiten gibt, in das Bein zu schie√üen. </li><li>  Die Stapelverarbeitung sieht nicht fremd aus und passt organisch in die Logik. </li><li>  Logik√§nderungen werden einfach vorgenommen und sind lokal. </li></ol><br>  <b>Minus:</b> <br><br>  Schreckliche Leistung aufgrund der Tatsache, dass die Pakete sehr klein sind. <br><br>  Dieser Ansatz kann h√§ufig in einfachen Diensten oder in Prototypen gesehen werden.  Wenn die Geschwindigkeit der √Ñnderung wichtig ist, lohnt es sich kaum, das System zu komplizieren.  Gleichzeitig ist die Leistung f√ºr unseren sehr einfachen Service schrecklich, so dass der Anwendungsbereich dieses Ansatzes sehr eng ist. <br><br><h4>  Naive Parallelverarbeitung </h4><br>  Sie k√∂nnen mit der parallelen Verarbeitung aller Nachrichten beginnen. Dadurch wird ein linearer Zeitanstieg abh√§ngig von der Anzahl der Nachrichten vermieden.  Dies ist kein besonders guter Weg, da dies zu einer hohen Spitzenlast des externen Dienstes f√ºhrt. <br><br>  Die Implementierung der Parallelverarbeitung ist sehr einfach: <br><br> <code><font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">)</font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">())</font></code> <br> <br>  Bei paralleler Nachrichtenverarbeitung erhalten wir idealerweise 300‚Äì700 ms, was viel besser ist als bei einer naiven Implementierung, aber immer noch nicht schnell genug. <br><br>  Bei diesem Ansatz werden Anforderungen an userRepository und fileRepository synchron ausgef√ºhrt, was nicht sehr effizient ist.  Um dies zu beheben, m√ºssen Sie die Logik von Anrufen ziemlich stark √§ndern.  Zum Beispiel √ºber CompletionStage (auch bekannt als CompletableFuture): <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">thenCombine</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">)</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">completedFuture</font> <font color="000066">(</font> <i><b>listOf</b></i> <font color="000066">()) <br></font> <font color="000066">)</font> <font color="000066"><b>{</b></font> <font color="000066"><i>author</i></font> <font color="333333">,</font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="000066"><i>author</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="000066"><i>files</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">get</font> <font color="000066">()</font> <font color="333333">!!</font></code> <br> <br>  Es ist ersichtlich, dass der anf√§nglich einfache Zuordnungscode weniger klar geworden ist.  Dies liegt daran, dass wir externe Serviceanrufe von dem Ort trennen mussten, an dem die Ergebnisse verwendet wurden.  Das an sich ist nicht schlecht.  Die Kombination von Anrufen sieht jedoch nicht sehr elegant aus und √§hnelt einer typischen reaktiven "Nudel". <br><br>  Wenn Sie Coroutinen verwenden, sieht alles anst√§ndiger aus: <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>join</b></i> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} }</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="000066">)</font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066">(</font> <font color="170591">author</font> <font color="333333">,</font> <font color="170591">files</font> <font color="000066">)</font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="170591">author</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="170591">files</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font></code> <br> <br>  Wo: <br><br> <code><font color="7f0055"><b>fun</b></font> <font color="333333">&lt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>B</i></font> <font color="333333">&gt;</font> <font color="170591"><b>join</b></font> <font color="000066">(</font> <font color="000066"><i>a</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>b</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>B</i></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>runBlocking</b></i> <font color="000066">(</font> <font color="05314d"><b>IO</b></font> <font color="000066">)</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <i><b>awaitAll</b></i> <font color="000066">(</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>a</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">,</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>b</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>0</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>A</i></font> <i><b>to</b></i> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>1</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>B <br></i></font> <font color="000066"><i>&nbsp;&nbsp;</i></font> <font color="000066"><b>}</b></font></code> <br> <br>  Theoretisch erhalten wir bei einer solchen Parallelverarbeitung 200‚Äì400 ms, was bereits unseren Erwartungen entspricht. <br><br>  Leider findet eine so gute Parallelisierung nicht statt, und die Amortisation ist ziemlich grausam: Wenn nur wenige Benutzer gleichzeitig arbeiten, wird eine Vielzahl von Anfragen auf die Dienste fallen, die immer noch nicht parallel verarbeitet werden, sodass wir zu unseren traurigen 4 s zur√ºckkehren. <br><br>  Mein Ergebnis bei Verwendung eines solchen Dienstes ist 1300-1700 ms f√ºr die Verarbeitung von 20 Nachrichten.  Dies ist schneller als bei der ersten Implementierung, l√∂st das Problem jedoch immer noch nicht. <br><br><div class="spoiler">  <b class="spoiler_title">Alternative Verwendung paralleler Abfragen</b> <div class="spoiler_text">  Was ist, wenn die Stapelverarbeitung nicht in Diensten von Drittanbietern bereitgestellt wird?  Beispielsweise k√∂nnen Sie die fehlende Implementierung der Stapelverarbeitung in Schnittstellenmethoden verbergen: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <b>it</b> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toSet</font> <font color="000066">()) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="000066"><i>it</i></font> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">()) <br></font> <font color="000066">}</font></code> <br> <br>  Dies ist sinnvoll, wenn die Hoffnung besteht, dass die Stapelverarbeitung in zuk√ºnftigen Versionen angezeigt wird. </div></div><br>  <b>Vorteile:</b> <br><br><ol><li>  Einfache Implementierung der gleichzeitigen Nachrichtenverarbeitung. </li><li>  Gute Skalierbarkeit. </li></ol><br>  <b>Nachteile:</b> <br><br><ol><li>  Die Notwendigkeit, den Empfang von Daten von ihrer Verarbeitung in parallelen Verarbeitungsanforderungen f√ºr verschiedene Dienste zu trennen. </li><li>  Erh√∂hte Belastung von Diensten von Drittanbietern. </li></ol><br>  Es ist ersichtlich, dass der Anwendungsbereich in etwa dem des naiven Ansatzes entspricht.  Die Verwendung der parallelen Abfragemethode ist sinnvoll, wenn Sie die Leistung Ihres Dienstes aufgrund der gnadenlosen Ausnutzung anderer mehrmals steigern m√∂chten.  In unserem Beispiel hat sich die Produktivit√§t um das 2,5-fache erh√∂ht, was jedoch eindeutig nicht ausreicht. <br><br><h4>  Caching </h4><br>  Sie k√∂nnen JPA-artiges Caching f√ºr externe Dienste durchf√ºhren, dh empfangene Objekte in der Sitzung speichern, um sie nicht erneut zu empfangen (auch w√§hrend der Stapelverarbeitung).  Sie k√∂nnen diese Caches selbst erstellen, Sie k√∂nnen Spring mit seinem @Cacheable verwenden und Sie k√∂nnen jederzeit einen vorgefertigten Cache wie EhCache manuell verwenden. <br><br>  Das allgemeine Problem h√§ngt mit der Tatsache zusammen, dass Caches nur dann einen guten Sinn ergeben, wenn Treffer vorhanden sind.  In unserem Fall sind Treffer im Autorenfeld (z. B. 50%) sehr wahrscheinlich, und es werden √ºberhaupt keine Treffer in Dateien angezeigt.  Dieser Ansatz wird einige Verbesserungen bringen, aber die Leistung wird sich nicht radikal √§ndern (und wir brauchen einen Durchbruch). <br><br>  Intersession (lange) Caches erfordern eine komplexe Invalidierungslogik.  Im Allgemeinen ist es umso besser, je sp√§ter Sie zu dem Punkt kommen, an dem Sie Leistungsprobleme mit intersessionellen Caches l√∂sen. <br><br>  <b>Vorteile:</b> <br><br><ol><li>  Implementieren Sie das Caching, ohne den Code zu √§ndern. </li><li>  Leistungssteigerung mehrmals (in einigen F√§llen). </li></ol><br>  <b>Nachteile:</b> <br><br><ol><li>  M√∂glichkeit zur Leistungsminderung bei unsachgem√§√üer Verwendung </li><li>  Gro√üer Speicheraufwand, insbesondere bei langen Caches. </li><li>  Komplexe Ung√ºltigmachung, Fehler, die zu schwierigen Problemen in der Laufzeit f√ºhren. </li></ol><br>  Sehr oft werden Caches nur verwendet, um Designprobleme schnell zu beheben.  Dies bedeutet nicht, dass sie nicht verwendet werden m√ºssen.  Es lohnt sich jedoch immer, sie mit Vorsicht zu behandeln und zuerst den daraus resultierenden Leistungsgewinn zu bewerten und erst dann eine Entscheidung zu treffen. <br><br>  In unserem Beispiel haben die Caches eine Leistungssteigerung von rund 25%.  Gleichzeitig haben die Caches viele Nachteile, so dass ich sie hier nicht verwenden w√ºrde. <br><br><h4>  Zusammenfassung </h4><br>  Wir haben uns also die naive Implementierung eines Dienstes angesehen, der die Stapelverarbeitung verwendet, und einige einfache M√∂glichkeiten, dies zu beschleunigen. <br><br>  Der Hauptvorteil all dieser Methoden ist die Einfachheit, aus der sich viele angenehme Konsequenzen ergeben. <br><br>  Ein h√§ufiges Problem bei diesen Methoden ist die schlechte Leistung, haupts√§chlich aufgrund der Paketgr√∂√üe.  Wenn diese L√∂sungen nicht zu Ihnen passen, sollten Sie daher radikalere Methoden in Betracht ziehen. <br><br>  Es gibt zwei Hauptbereiche, in denen Sie nach L√∂sungen suchen k√∂nnen: <br><br><ul><li>  Asynchrone Arbeit mit Daten (erfordert einen Paradigmenwechsel, daher wird dieser Artikel nicht ber√ºcksichtigt) </li><li>  Vergr√∂√üerung der Packungen unter Beibehaltung der synchronen Verarbeitung. </li></ul><br>  Durch die Vergr√∂√üerung der Bundles wird die Anzahl der externen Anrufe erheblich reduziert und gleichzeitig der Code synchron gehalten.  Der n√§chste Teil des Artikels ist diesem Thema gewidmet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460291/">https://habr.com/ru/post/de460291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460279/index.html">10-Milliarden-Vertrag: Wer wird sich mit der Cloud f√ºr das Pentagon befassen?</a></li>
<li><a href="../de460281/index.html">Wie UX Writer zur Produktverbesserung beitr√§gt</a></li>
<li><a href="../de460283/index.html">Neue Do-it-yourself-Programmiersprache</a></li>
<li><a href="../de460285/index.html">Wir bereiten PHP vor. Wie sind while, foreach, array_walk und einige andere be√§ngstigende W√∂rter</a></li>
<li><a href="../de460287/index.html">Runet News Visualisierung</a></li>
<li><a href="../de460295/index.html">Was bedeutet unsicher in Rust?</a></li>
<li><a href="../de460297/index.html">WeakRef - Vorschlag zur Erg√§nzung des ECMAScript-Standards</a></li>
<li><a href="../de460301/index.html">Hochleistungs-LED-Lampen der neuen Generation</a></li>
<li><a href="../de460305/index.html">AERODISK Motor: Katastrophal. Teil 2. Metrocluster</a></li>
<li><a href="../de460307/index.html">Modellierungserfahrung vom Computer Vision Mail.ru-Team</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>