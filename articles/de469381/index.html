<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏻 🤞🏻 👭 Agones, erstellen Sie einen Mehrbenutzer-Spieleserver. Architektur und Installation 🤘🏼 🤩 🍂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit Agones (aus anderen griechischen Ländern - „Konkurrenz“) können Sie einen Spieleservercluster mithilfe von Kubernetes mit automatischer Skalierung...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Agones, erstellen Sie einen Mehrbenutzer-Spieleserver. Architektur und Installation</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469381/"><p>  Mit Agones (aus anderen griechischen Ländern - „Konkurrenz“) können Sie einen Spieleservercluster mithilfe von Kubernetes mit automatischer Skalierung bereitstellen.  Dieses Open-Source- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projekt</a> wurde 2018 erstellt, erhielt bereits 2500 Sterne, war auf Google I / O 2019 und wurde zu unserer großen Überraschung auf Habré noch nicht erwähnt.  Das Thema beschreibt einen kurzen Einblick in die Architektur und Anweisungen zum Starten eines Testservers auf einem lokalen Computer.  Bei Interesse willkommen bei kat, los! </p><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/fce/4ea/af7fce4ea1dbb86b3bac94479a1b1f15.png" alt="Agones Logo"><a name="habracut"></a><br><h3>  Projektbeschreibung </h3><br><p>  Agones ist eine benutzerdefinierte Ressource ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes API Extension</a> ). </p><br><p>  Das Projekt erfordert tatsächlich mehr Aufmerksamkeit, da Sie einen einzelnen Spieleserver (GameServer) oder eine ganze "Flotte" von Servern (Flotten) über Konfigurations-Yaml-Dateien über die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Agones-API</a> ausführen können.  Jeder Server gibt wiederum Warnungen über seinen Lebenszyklus (GameServer-Lebenszyklen) aus und beschreibt den aktuellen Status (Integritätsprüfung, Verbindungsinformationen).  Server im Cluster können automatisch skaliert werden (Fleet Autoscaling), was in die Grundfunktionen von Kubernetes integriert ist.  Darüber hinaus wird im Dashboard eine Statistik mit Prometheus, Grafana oder Stackdriver ausgegeben. Die Metriken werden über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenCensus</a> exportiert, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sodass</a> Sie Ihren eigenen Exporter hinzufügen können.  Dashboard-Beispiel in Stackdriver: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/991/03b/929/99103b9292365163e2b77ae292e4eba2.png" alt="Bild"></p><br><h3>  Architektur, Grundelemente </h3><br><p>  Agones selbst übernimmt die Aufgabe, Spieleserver auf Basis von Kubernetes zu starten, automatisch zu erweitern und zu hosten.  Auf diese Weise können Sie sich auf die Entwicklung des Multiplayer-Spieleservers selbst konzentrieren, anstatt dessen Infrastruktur und weiteren Support zu entwickeln.  Sie können jeden Spieleserver verwenden, der unter Linux ausgeführt werden kann, und er kann in jeder Programmiersprache geschrieben werden. </p><br><p>  Die Agones Kubernetes-API ist in drei Hauptpakete (Pakete) unterteilt, die jeweils Ressourcen enthalten: agones.dev (GameServer, GameServerSet, Fleet), assign.agones.dev (GameServerAllocation), autoscaling.agones.dev (FleetAutoscaler).  Wie bei anderen Kubernetes-Ressourcen werden Yaml-Dateien verwendet, um sie auszuführen. </p><br><p>  Eine kurze Beschreibung jeder Ressource: </p><br><ul><li>  GameServer - Erstellt eine bestimmte Vorlage, mit der Sie die üblichen Pod-Parameter mit einigen Ergänzungen wie hostPort und containerPort für den Spieleserver verwenden können.  Das Agones SDK bietet einen optionalen Beiwagencontainer, mit dem der GameServer ständig kommuniziert </li><li>  GameServerSet - Datenstruktur für mehrere GameServer, die der Beziehung zwischen Depoyment und ReplicaSet sehr ähnlich ist </li><li>  Flotte - erstellt mehrere vorgefertigte GameServer und verwendet GameServerAllocation zum Verteilen von Ressourcen </li><li>  GameServerAllocation - Bittet den GameServer von Fleet um Verwendung und markiert, dass er für Spieler einsatzbereit ist, sodass GameServer nicht automatisch gelöscht wird </li><li>  FleetAutoscaler - erweitert oder reduziert automatisch die Anzahl der Server in Fleet </li></ul><br><p>  Das Diagramm ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von hier</a> ) zeigt den Lebenszyklus der GameServer-Ressource: </p><br><p><img src="https://habrastorage.org/webt/_2/2x/gc/_22xgcnfs_6ercdwmte8hktzynw.png"></p><br><p>  Die violetten Pfeile zeigen das Agones SDK an, rot - die Benutzer-API, blau - den Game-Server-Controller, gelb - den Anwendungs-Controller. </p><br><h3>  Installation </h3><br><p>  In diesem und den folgenden Abschnitten werden Teams mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> auf der offiziellen Website mit einigen Ergänzungen verwendet.  Wir empfehlen die Verwendung von Kubernetes Version 1.12 (von Entwicklern getestet).  Für den Test auf dem lokalen Computer können Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">minikube verwenden</a> , für das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kubectl</a> und ein vom Betriebssystem unterstützter Hypervisor ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hyper-V</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VirtualBox</a> ) erforderlich sind. </p><br><p>  Um den Cluster und Agones zu installieren, müssen Sie die folgenden Befehle ausführen: </p><br><pre><code class="bash hljs">minikube profile agones <span class="hljs-comment"><span class="hljs-comment">#    agones minikube start --kubernetes-version v1.12.10 --vm-driver hyperv #virtualbox minikube status #     kubectl create namespace agones-system #    agones kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/install/yaml/install.yaml</span></span></code> </pre> <br><p>  Der letzte Befehl lädt die Agones-Konfigurationsdatei herunter, mit der benutzerdefinierte Ressourcendefinitionen (CRD) über die Kubernetes-API erstellt werden. </p><br><h3>  GameServer starten </h3><br><p>  Jetzt können Sie den UDP-Server im Cluster mithilfe des vorgefertigten Testservers aus den Beispielen starten, der einfach auf die an ihn gesendete Anfrage reagiert: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># GameServer  kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/examples/simple-udp/gameserver.yaml kubectl get gameservers #  GameServer minikube ip #     kubectl describe gameserver #    GameServer kubectl get gs #  ,   GameServer</span></span></code> </pre> <br><p>  Um zu bestätigen, dass der Server funktioniert, können Sie NetCat verwenden. Für Linux wird das Programm normalerweise mit dem System geliefert. Für Windows müssen Sie es beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> herunterladen.  NetCat muss mit dem Parameter <code>-u</code> (UDP-Anforderung) gestartet werden, wobei die Minikube-Adresse (es ist besser, die Adresse aus dem Befehl <code>minikube ip</code> zu kopieren) und der aktive GameServer-Port angegeben werden: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  Wenn nach dem Ausführen des Befehls in der Konsole die Antwort "ACK: Hallo" angezeigt wird und der Server funktioniert, können Sie ihn mit dem folgenden Befehl deaktivieren, der initialisiert wird: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  Der Serverstatus wird vom <code>kubectl describe gameserver</code> überprüft. Er sollte sich in Shutdown ändern. </p><br><h3>  Änderungen an GameServer vornehmen </h3><br><p>  Im vorherigen Beispiel ändern wir die Serverantwort.  Kopieren Sie zunächst das Projekt-Repository: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:googleforgames/agones.git</code> </pre> <br><p>  <a href="">Ändern Sie</a> in der Datei <a href="">agones / examples / simple-udp / main.go</a> die Zeile 159 in </p><br><pre> <code class="go hljs">respond(conn, sender, <span class="hljs-string"><span class="hljs-string">"ACKNOWLEDGED: "</span></span>+txt+<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)</code> </pre> <br><p>  Führen Sie im Projektstammordner Folgendes aus, um ein Docker-Image zu erstellen und es in minikube zu speichern.  Für Windows müssen Sie zuerst <code>minikube docker-env | Invoke-Expression</code>  <code>minikube docker-env | Invoke-Expression</code> für Linux <code>eval $(minikube docker-env)</code> .  Auf diese Weise können Sie Docker-Bilder direkt in der Minikube erstellen. <br>  Erstellen Sie ein Docker-Image: </p><br><pre> <code class="bash hljs">docker build -t agones-go:modified -f .\examples\simple-udp\Dockerfile .</code> </pre> <br><p>  Dieser Befehl kann einige Zeit dauern, da das gesamte Projekt-Repository in das Image kopiert wird.  Dies kann vermieden werden, indem nur der Ordner sdks, main.go und Dockerfile im Verzeichnis belassen werden. </p><br><p>  Ändern Sie als Nächstes in den <a href="">Beispielen \ simple-udp \ gameserver.yaml</a> Zeile 28 in <code>image: agones-go:modified</code> und erstellen Sie einen neuen GameServer: </p><br><pre> <code class="bash hljs">kubectl create -f .\examples\simple-udp\gameserver.yaml</code> </pre> <br><p>  Überprüfen Sie die Änderungen und schalten Sie den Server aus: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u 172.17.113.72 7331 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u 172.17.113.72 7331</code> </pre> <br><p>  Wenn nach dem Ausführen von Befehlen in der Konsole die Antwort "ACKNOWLEDGED: hello" angezeigt wird, waren die Änderungen erfolgreich. </p><br><h3>  Wir starten den Server lokal </h3><br><p>  Sie können Änderungen für eine bequeme Entwicklung ohne Kubernetes nur mit dem Agones SDK wiederholen.  Während der Spieleserver ausgeführt wird, kommuniziert das SDK über TCP mit einem kleinen gRPC-Server, den Agones in einem Container unter demselben Namespace ausführt.  Ein solcher Container in Kubernetes heißt Beiwagen.  Für die lokale Entwicklung müssen Sie daher den SDK-Prozess starten.  Dazu müssen Sie die Quelldatei mit dem Parameter <code>-local</code> ausführen, wodurch der Modus "Lokaler Modus" aktiviert wird.  In diesem Modus wird der Prozess angewiesen, sich im passiven Modus zu befinden und keine Verbindung herzustellen. Zeigen Sie einfach die Protokolle in der Konsole an, damit Sie sehen können, was das SDK tut, während der Spieleserver ausgeführt wird. </p><br><p>  Sie können den neuesten agonessdk-Server in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Releases des</a> offiziellen Projekt-Repositorys herunterladen.  Standardmäßig wird nach dem Starten des SDK-Servers ein GameServer-Konfigurationsleerzeichen erstellt, das für SDK-Anforderungen von GameServer () und WatchGameServer () verwendet wird.  Beim Start können Sie Ihre eigene Konfigurationsdatei im yaml- oder json-Format angeben. Dazu benötigen Sie den Parameter <code>-file</code> oder dessen verkürzte Version <code>-f</code> zusammen mit dem Parameter <code>-file</code> . </p><br><pre> <code class="plaintext hljs">.\sdk-server --local -f .\examples\simple-udp\gameserver.yaml sdk-server : {"ctlConf":{"Address":"localhost","IsLocal":true,"LocalFile":".\\examples\\simple-udp\\gameserver.yaml","Timeout":0,"Test":""},"grpcPor t":59357,"httpPort":59358,"message":"Starting sdk sidecar","severity":"info","source":"main","time":"2019-09-29T12:45:59.8379817+02:00","version":"1.0.0"} {"filePath":"C:\\agones-release-1.0.0\\examples\\simple-udp\\gameserver.yaml","message":"Reading GameServer configuration","severity":"info","time":"2019-09-29T12:45:59.8479789+02:00"} {"message":"Starting SDKServer grpc service...","severity":"info","source":"main","time":"2019-09-29T12:45:59.8529791+02:00"} {"message":"Starting SDKServer grpc-gateway...","severity":"info","source":"main","time":"2019-09-29T12:46:00.1555756+02:00"}</code> </pre> <br><p>  Fortsetzung folgt... </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469381/">https://habr.com/ru/post/de469381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469369/index.html">Digitale Veranstaltungen in Moskau vom 30. September bis 06. Oktober</a></li>
<li><a href="../de469371/index.html">Beschreibung des Ansatzes zum Organisieren und Testen von Code mit Redux Thunk</a></li>
<li><a href="../de469373/index.html">Die Ergebnisse des Projekts zur Schaffung einer neuronalen Schnittstelle für vollständig gelähmte Patienten wurden in Frage gestellt</a></li>
<li><a href="../de469375/index.html">Warum stellen Mozilla, Coil und Creative Commons 100 Millionen US-Dollar für Open Source-Projekte zur Verfügung?</a></li>
<li><a href="../de469379/index.html">Anwendung formaler Modellvalidierungsmethoden für die Benutzeroberfläche</a></li>
<li><a href="../de469383/index.html">Hyperkonvergente Lösung AERODISK vAIR. Basis - ARDFS-Dateisystem</a></li>
<li><a href="../de469387/index.html">Die Geschichte eines "Entwicklers" oder wie ein Neuling eine Anwendung für iOS schreibt</a></li>
<li><a href="../de469389/index.html">Parametrisierung eines physikalischen Modells durch ein neuronales Netzwerk zur Lösung eines topologischen Optimierungsproblems</a></li>
<li><a href="../de469391/index.html">Audio-Schnittstellen: Ton als Informationsquelle auf der Straße, im Büro und am Himmel</a></li>
<li><a href="../de469393/index.html">Flare-On 2019 Zuschreibung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>