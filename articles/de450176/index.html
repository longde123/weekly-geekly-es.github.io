<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üé± üåÜ Zur Frage der Mengen üåó üë®‚Äçüë¶‚Äçüë¶ ‚èÆÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alice: Warum ist dieser Ort ein sehr seltsamer Ort? 
 Dodo: Und weil alle anderen Orte nicht sehr seltsam sind. Es muss mindestens einen SEHR seltsame...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zur Frage der Mengen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450176/"><h4>  Alice: Warum ist dieser Ort ein sehr seltsamer Ort? <br>  Dodo: Und weil alle anderen Orte nicht sehr seltsam sind.  Es muss mindestens einen SEHR seltsamen Ort geben. <br></h4><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a3/su/r9/a3sur97xweoxvwbgqe_fvjetcai.jpeg"></div><br>  Schauen wir uns also den Text der Vorlagenklasse BitSet an, um ihn an die Anforderungen von MK anzupassen. Die Hauptbereiche der Optimierung wurden zuvor definiert.  Sie k√∂nnen nat√ºrlich Ihre eigene Klasse von Grund auf neu schreiben, aber lassen Sie uns die Gelegenheit, gute L√∂sungen kennenzulernen, nicht vernachl√§ssigen, da die STL-Bibliothek (nicht zu verwechseln mit spl) seit langem bekannt ist und √ºberall verwendet wird.  Zuerst m√ºssen Sie den Quellcode finden. Nach einer kurzen Reise im Internet habe ich gerade das Verzeichnis mit meinem MinGW ge√∂ffnet und nach der erforderlichen Datei gesucht, die ich weiter diskutieren m√∂chte. <br><a name="habracut"></a><br>  Zu Beginn sehen wir etwas mehr als eine Seite mit Copyright und dem Text der Lizenz sowie eine Vielzahl von Warnungen - nun, Sie k√∂nnen dies √ºberspringen, dies ist f√ºr Anw√§lte.  Als n√§chstes kommen die Includes und ich danke den Autoren - jeder wird von einem Kommentar dar√ºber begleitet, was wir aus jeder Datei erhalten m√∂chten - jeder w√ºrde das tun, die Arbeit des <s>Indiana Jones-</s> Forschers w√§re einfacher.  Als n√§chstes kommen die Definitionen, ich bin kein Fan von Code-Sauberkeit und werde nicht streiten - lassen Sie sie sein und sehen Sie sofort die Definition der Anzahl der Bits in der Speichereinheit, die eine lange Zeit ohne Vorzeichen ist.  Ich setze den rutschigen Pfad von Defines fort und suche nach meiner eigenen Speichereinheitsdefinition, die uint8_fast entspricht, obwohl ich verstehe, dass dies eindeutig nicht ausreichen wird.  √úbrigens, ich danke den Autoren sofort noch einmal f√ºr den Stil - am Ende des Moduls r√§umen sie nach sich selbst auf und zerst√∂ren interne Definitionen - ich hatte nicht einmal gehofft, dass ich so etwas in der modernen Produktion sehen w√ºrde. <br><br>  Und hier beginnen leichte Missverst√§ndnisse - zun√§chst definieren sie die Template-Hilfsstruktur struct _Base_bitset (warum genau die Struktur und nicht die Klasse, da sie austauschbar sind), in der sie den Typ f√ºr die Datenspeicherung bestimmen und dieser erneut direkt spezifiziert - wir √§ndern ihn in unseren eigenen.  Als n√§chstes werden zwei Instanzen dieser Hilfsstruktur bestimmt - f√ºr eine Speichereinheit (das ist verst√§ndlich, um die Effizienz des Codes zu erh√∂hen) und f√ºr ein entartetes Beispiel ohne Speicherung (wahrscheinlich zur Fehlerbehandlung), bis wir diesen Code ber√ºhren. <br><br>  Als n√§chstes finden wir das Hauptklassenklassen-Bitset (jetzt die Klasse), das aus der Vorlagenstruktur abgeleitet ist (ja, in C ist es m√∂glich, es ist nicht klar, warum dies zu tun ist, aber es ist m√∂glich), in dem der Speichertyp erneut bestimmt und wieder in unseren ge√§ndert wird.  Aber hier habe ich mich gefragt - warum der Typ nicht von der √ºbergeordneten Struktur geerbt wurde und war erstaunt (ja mit Erstaunen, Vorlagenklassen - das mache ich im Alltag nicht), dass sich die Vererbung von Vorlagenklassen etwas von den normalen unterscheidet.  Das hei√üt, die Vererbung ist genau die gleiche und alle Entit√§ten des Elternteils sind in der Tochterklasse verf√ºgbar (ich hoffe, niemand wird mich f√ºr eine geschlechtsspezifische Chauvinistin halten), aber sie m√ºssen mit einem vollst√§ndigen Namen angegeben werden.  Nun, dies kann immer noch verstanden werden, andernfalls wird der Compiler nicht erraten, welche der instanziierten Optionen angewendet werden soll. Wenn Sie jedoch die in der Klasse definierten Typen verwenden, m√ºssen Sie immer noch das Schl√ºsselwort typename hinzuf√ºgen.  Dies ist keine offensichtliche L√∂sung. Ich war besonders zufrieden mit der Diagnose des Compilers, was bedeutet, dass "vielleicht hatten Sie einen Typ aus der Elternklasse" - ja, danke, Kapit√§n, das habe ich gemeint, ich bin froh, dass wir uns verstehen, aber Einfacher geht es mir nicht.  Eine solche Diagnose findet jedoch in der alten Version von GCC statt. In der aktuellen Nachricht wird klarer: "Vielleicht haben Sie das Schl√ºsselwort typename vergessen."  Das Verst√§ndnis der Diagnosemeldungen des Compilers f√ºr Vorlagenklassen ist im Allgemeinen ein Thema f√ºr ein separates Lied, und dieses Lied ist keineswegs erfreulich. <br><br>  Wenn wir das Konstrukt also nicht st√§ndig in der untergeordneten Klasse verwenden m√∂chten <br><br><pre><code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::_Base_bitset&lt;Nb&gt;::_WordT</code> </pre> <br>  (und wir wollen nicht, neg?) Dann haben wir drei M√∂glichkeiten <br><br>  1) trivial <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _WordT typename _Base_bitset</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;_Nb&gt;::_WordT</span></span></span></span></code> </pre> <br>  2) Offensichtliche Typdefinition auf globaler Ebene und mir hat es besser gefallen <br><br>  3) f√ºr Fans von fremden <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> _Base_bitset&lt;_Nb&gt;::_WordT _WordT;</code> </pre> <br>  (anhaltendes Gef√ºhl einer pr√§chtigen Chromkr√ºcke).  Pers√∂nlich bin ich in allen drei F√§llen mit der direkten Angabe der √ºbergeordneten Klasse nicht zufrieden, da die Implementierung die Vererbungskette nicht ber√ºcksichtigen sollte, aber vielleicht verstehe ich etwas nicht. <br><br>  Es gibt auch eine Methode 4) <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> _WordT = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::_Base_bitset&lt;Nb&gt;::_WordT;</code> </pre> <br>  aber in meiner Version des Compilers funktioniert es nicht, also ist es nicht. <br><br>  Anmerkung zu den R√§ndern (PNP) - In dem wunderbaren Buch ‚ÄûC ++ f√ºr echte Programmierer‚Äú (ich habe es damals versehentlich heruntergeladen und festgestellt, dass es in Echtzeitsystemen C ++ gewidmet ist) hei√üt es √ºber die Sprache ‚ÄûSeine Eleganz ist keineswegs in Einfachheit (die W√∂rter C ++ und Einfachheit schneiden das Ohr mit seinem offensichtlichen Widerspruch), aber in seinen m√∂glichen F√§higkeiten.  F√ºr jedes h√§ssliche Problem gibt es eine Art kluges Idiom, eine elegante Sprachschw√§che, dank der das Problem direkt vor unseren Augen schmilzt. ‚Äú  Da das Buch wirklich wunderbar ist, bedeutet dies, dass das obige Zitat korrekt ist (ich verstehe, dass es hier eine gewisse logische Ausdehnung gibt), aber ich pers√∂nlich sehe das Problem leider, aber es gibt eine Belastung mit einer klugen Sprache. <br><br>  Trotz des verbleibenden Gef√ºhls der leichten Verwirrung ist das Problem gel√∂st und Sie k√∂nnen das Ergebnis genie√üen - aber es war nicht da.  Beim √Ñndern der Gr√∂√üe des Testsatzes von 15 auf 5 ist ein Kompilierungsfehler v√∂llig unerwartet aufgetreten.  Nein, alles ist klar, eine unver√§nderte Instanziierung mit Vorlagenparameter 1 hat funktioniert, aber von au√üen sieht es sehr seltsam aus - wir √§ndern die Konstante und das Programm stoppt die Kompilierung. <br><br>  Sie k√∂nnen diese und eine andere Implementierung nat√ºrlich √§ndern, aber ein solcher Ansatz scheint eine grobe Verletzung des DRY-Prinzips zu sein.  Es gibt m√∂gliche L√∂sungen, und es gibt mehr als eine davon: 1) die offensichtliche - wieder die Definition und 2) die triviale - wieder die Typdefinition auf globaler Ebene, aber in diesem Fall wird sie aus dem Modul herauskommen, was jedoch in der betrachteten Implementierung aus der Grundstruktur herausragt , aber auch das Qualifikationsmerkmal muss nicht geschrieben werden. <br><br>  Daher neige ich zu Option 3) der Basisklasse zur Bestimmung des Typs und der Vererbung aller Instanzen davon.  Dar√ºber hinaus sind die Entit√§ten der √ºbergeordneten Klasse wieder gesch√ºtzt, damit sie nicht hervorstehen.  Dann finde ich eine lustige Eigenschaft, wahrscheinlich sollte C ++ f√ºr seine Flexibilit√§t gelobt werden - f√ºr die Variante ohne Speicher wird der Typ nicht ben√∂tigt, und die Sprache erm√∂glicht die Verwendung der Implementierung ohne Vererbung, obwohl dies in diesem speziellen Fall nicht besonders notwendig ist.  Sofort entdecke ich einen weiteren Nachteil der Bibliothek - in allen drei Varianten werden die Operationen zur Berechnung der Speichereinheitsnummer jedes Mal eingestellt <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> _S_whichword</code> </pre> <br>  und die darin enthaltenen Bitmasken _S_maskbit und sie sind v√∂llig identisch - wir verschieben sie auch in die Basisklasse.  In diesem Fall wird ein "toter" Code erkannt - die _S_whichbyte-Methode, ich wei√ü nicht einmal, was ich tun soll - einerseits erfordern gute Tonregeln das Entfernen, andererseits - im Fall einer Vorlage hat dies keinen Einfluss auf den resultierenden Code.  Ich werde die Regel "etwas nicht verstehen - nicht ber√ºhren" anwenden und diese Methode verlassen. <br><br>  Grunds√§tzlich sind die √Ñnderungen hinsichtlich der Art des Speichers abgeschlossen und Sie k√∂nnen mit dem Testen beginnen.  Und sofort stelle ich einen Mangel an Implementierung fest - f√ºr die MSP430-Architektur werden aus irgendeinem Grund zwei Byte-W√∂rter anstelle von Bytes zugewiesen.  Nat√ºrlich keine doppelten W√∂rter wie zuvor, aber wir k√§mpfen immer noch um den minimalen (in jeder Hinsicht) Code.  Es stellt sich heraus, dass der Compiler sicher ist, dass in dieser Architektur der Typ uint_fast8_t die Gr√∂√üe 2 hat, obwohl das Befehlssystem Byte-Operationen hat und der Compiler selbst diese vollst√§ndig verwendet.  Die Idee, diesen Typ zu verwenden, ist gef√§hrdet und Sie m√ºssen den Datentyp uint8_t direkt festlegen.  Wenn es eine Architektur gibt, in der die Arbeit mit Bytes nicht erfolgreich ist und die Gr√∂√üe des Typs uint_fast8_t von 1 abweicht (keine der im Compiler verf√ºgbaren), muss sie unter der Geschwindigkeit aller anderen leiden. <br><br>  Das Testen der korrigierten Version zeigt die korrekte Funktionsweise auf verschiedenen Architekturen und mit unterschiedlichen Parametern, aber es gibt immer noch eine Frage bei der Berechnung von Bitmasken f√ºr MK ohne entwickelte Verschiebungen, in unserem Fall MSP430 und AVR.  Im Prinzip k√∂nnen Sie das Lesen der Bitmaske aus dem Array einfach zu einer Methode f√ºr alle F√§lle machen, unabh√§ngig von der MK-Architektur.  Die L√∂sung funktioniert ziemlich gut, in entwickelten Architekturen mit Indizierung ist alles in Ordnung, aber es wird immer noch einen Zeitverlust im Vergleich zu schnellen Schichten geben, aber ich m√∂chte nicht mit den Worten ‚ÄûDie Klasse wird schneller sein, sagte er, wir optimieren sagte er. " <br><br>  Daher ben√∂tigen wir eine andere Implementierung f√ºr unsere beiden schwachen Architekturen, die sich von allen anderen in der Gr√∂√üe des Typs uint_fast16_t unterscheiden - es ist 2 gegen√ºber 4 oder 8 f√ºr 64-Bit-Versionen.  Die bedingte Kompilierung wird uns nicht helfen, aber das Setzen der Bedingung in der Hoffnung auf Optimierung ist nicht der Weg der Samurai, die Muster bleiben.  Ich versuche, eine Vorlagenmethode f√ºr die Klasse zu erstellen, aber eine teilweise Spezialisierung ist daf√ºr nicht verf√ºgbar. Es stellt sich heraus, dass dies der Fall sein sollte, und ich finde sogar einen Artikel, in dem angegeben ist, warum dies eine gute L√∂sung ist.  Ehrlich gesagt habe ich immer noch nicht verstanden, warum diese Entscheidung gut ist, h√∂chstwahrscheinlich aufgrund religi√∂ser Erw√§gungen.  Trotzdem wurden wir nicht gefragt, und was noch zu tun ist - Sie k√∂nnen eine benutzerfreundliche Vorlagenfunktion erstellen (es stellte sich heraus, dass dies unm√∂glich ist, und aus dem gleichen Grund - eine teilweise Spezialisierung ist verboten), es gibt eine andere L√∂sung, es sieht lustig aus - eine teilweise Spezialisierung der Methode au√üerhalb des Klassenk√∂rpers.  Sie k√∂nnen sogar eine separate Vorlagenfunktion erstellen und √ºber die Klassenmethoden darauf zugreifen. Ich wei√ü nicht, welche Methode korrekter ist. Ich habe diese ausgew√§hlt.  Ja, sie hat keinen Zugriff auf die internen Einheiten der Klasse, aber in diesem speziellen Fall ist es nicht erforderlich, was bei Bedarf zu tun ist. Ich wei√ü noch nicht: "Wir werden Probleme l√∂sen, sobald sie auftreten." <br><br>  Jetzt haben wir alles, was wir brauchen. Wir sammeln die getesteten Fragmente zusammen und erhalten den Code, der das anf√§ngliche Optimierungsproblem l√∂st.  Gleichzeitig haben wir den Code kompakter gemacht (was verst√§ndlicher bedeutet, obwohl letzteres umstritten ist), zahlreiche Wiederholungen entfernt und √ºberfl√ºssige Entit√§ten beseitigt, die herausragen.  Das einzige, was nicht festgelegt ist, ist eine Mischung aus Strukturen und Klassen, aber hier verstehe ich die Gr√ºnde f√ºr eine solche Implementierung nicht, daher werde ich diesen Teil nur f√ºr den Fall nicht ber√ºhren. <br><br>  Ein zweiter Beitrag wird der Implementierung der zweiten Version des Sets gewidmet sein, und ohne das hat etwas viel geklappt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450176/">https://habr.com/ru/post/de450176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450164/index.html">Wie kann man einem Team helfen, das bei der Arbeit ausbrennt, wenn Sie selbst ausgebrannt sind?</a></li>
<li><a href="../de450166/index.html">Wir laden Entwickler zum Think Developers Workshop ein</a></li>
<li><a href="../de450168/index.html">Internet-Geschichte: Backbone</a></li>
<li><a href="../de450170/index.html">AR, Robotik und Katarakt: Wie wir zur russisch-deutschen Programmierschule gingen</a></li>
<li><a href="../de450172/index.html">IOS Timer</a></li>
<li><a href="../de450178/index.html">Qualit√§t als Verantwortung des Teams. Unsere QS-Erfahrung</a></li>
<li><a href="../de450180/index.html">6 n√ºtzliche Tools, um ein Startup in den USA zu starten</a></li>
<li><a href="../de450182/index.html">Cloud-basierte Abrechnungsmodellierung</a></li>
<li><a href="../de450186/index.html">Ein bisschen Kryptographie: das mysteri√∂se und legend√§re R√§tsel</a></li>
<li><a href="../de450188/index.html">So erledigen Sie 70 Aufgaben an einem Tag: Das Leben in Task-Trackern ist ein gutes Leben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>