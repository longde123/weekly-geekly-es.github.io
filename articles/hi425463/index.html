<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСиЁЯП╛тАНЁЯЪА ЁЯШе ЁЯСиЁЯП┐ рдпреВрдирд┐рдЯреА рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореИрдкреНрд╕: рд╡реЙрдЯрд░, рд▓реИрдВрдбрдорд╛рд░реНрдХ рдФрд░ рдлреЛрд░реНрдЯреНрд╕ рд╡реЙрд▓ тЬНЁЯП╛ тЩея╕П ЁЯНУ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ 

 рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ 

 рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░ 

 12-15 рднрд╛рдЧ: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдпреВрдирд┐рдЯреА рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореИрдкреНрд╕: рд╡реЙрдЯрд░, рд▓реИрдВрдбрдорд╛рд░реНрдХ рдФрд░ рдлреЛрд░реНрдЯреНрд╕ рд╡реЙрд▓</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425463/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">12-15 рднрд╛рдЧ: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 16-19: рд░рд╛рд╕реНрддрд╛ рдЦреЛрдЬрдирд╛, рдЦрд┐рд▓рд╛рдбрд╝реА рджрд╕реНрддреЗ, рдПрдирд┐рдореЗрд╢рди</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 20-23: рдХреЛрд╣рд░реЗ рдХреЗ рдпреБрджреНрдз, рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди, рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдкреАрдврд╝реА</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 24-27: рдЬрд▓ рдЪрдХреНрд░, рдЕрдкрд░рджрди, рдмрд╛рдпреЛрдо, рдмреЗрд▓рдирд╛рдХрд╛рд░ рдирдХреНрд╢рд╛</a> <br><br><h1>  рднрд╛рдЧ 8: рдкрд╛рдиреА </h1><br><ul><li>  рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдкрд╛рдиреА рдбрд╛рд▓реЗрдВред </li><li>  рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЛ рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░реЗрдВред </li><li>  рдлреЛрдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд░реНрдл рдмрдирд╛рдПрдВред </li><li>  рдкрд╛рдиреА рдФрд░ рдирджрд┐рдпреЛрдВ рдХреЛ рдорд┐рд▓рд╛рдПрдВред </li></ul><br>  рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдирджреА рдХрд╛ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкрд╛рдиреА рдореЗрдВ рдбреБрдмреЛ рджреЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a9/73c/b6e/2a973cb6eb97eba7d04a325f3ac89a3e.jpg"></div><br>  <i>рдкрд╛рдиреА рдЖ рд░рд╣рд╛ рд╣реИред</i> <br><a name="habracut"></a><br><h2>  рдЬрд▓ рд╕реНрддрд░ </h2><br>  рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рдкрд╛рдиреА рдХреЗ рд╕рдорд░реНрдерди рдХреЛ рд╕рдорд╛рди рд╕реНрддрд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ред  рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЬрд┐рдирдХреА рдКрдВрдЪрд╛рдИ рдЗрд╕ рд╕реНрддрд░ рд╕реЗ рдиреАрдЪреЗ рд╣реИ, рдкрд╛рдиреА рдореЗрдВ рдбреВрдм рдЬрд╛рддреА рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛ рддрд░реАрдХрд╛ рд╡рд┐рднрд┐рдиреНрди рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдкрд░ рдкрд╛рдиреА рдмрдирд╛рдП рд░рдЦрдирд╛ рд╣реЛрдЧрд╛, рддреЛ рдЪрд▓рд┐рдП рдЬрд▓ рд╕реНрддрд░ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рдмрдирд╛рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рд▓рд┐рдП, <code>HexCell</code> рдХреЛ рдЕрдкрдиреЗ рдЬрд▓ рд╕реНрддрд░ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WaterLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waterLevel == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } waterLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waterLevel;</code> </pre> <br>  рдпрджрд┐ рд╡рд╛рдВрдЫрд┐рдд рд╣реИ, рддреЛ рдЖрдк рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд░рд╛рд╣рдд рдХреА рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдореМрдЬреВрдж рдирд╣реАрдВ рдереАрдВред  рд▓реЗрдХрд┐рди рдЕрдм рдореИрдВ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛ред  рдЕрдВрдбрд░рд╡реЙрдЯрд░ рд░реЛрдб рдЬреИрд╕реА рдЪреАрдЬреЗрдВ рдореБрдЭреЗ рд╕реВрдЯ рдХрд░рддреА рд╣реИрдВред  рд╡реЗ рдРрд╕реЗ рдХреНрд╖реЗрддреНрд░ рдорд╛рдиреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдмрд╛рдврд╝ рд╕реЗ рдШрд┐рд░ рдЧрдП рд╣реИрдВред <br><br><h3>  рдмрд╛рдврд╝ рдХреА рдХреЛрд╢рд┐рдХрд╛рдПрдБ </h3><br>  рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╛рдиреА рдХрд╛ рд╕реНрддрд░ рд╣реИ, рддреЛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╡рд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИрдВред  рдПрдХ рд╕реЗрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИ рдЕрдЧрд░ рдЙрд╕рдХрд╛ рдЬрд▓ рд╕реНрддрд░ рдЙрд╕рдХреА рдКрдВрдЪрд╛рдИ рд╕реЗ рдКрдкрд░ рд╣реИред  рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsUnderwater { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel &gt; elevation; } }</code> </pre> <br>  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рдкрд╛рдиреА рдХрд╛ рд╕реНрддрд░ рдФрд░ рдКрдВрдЪрд╛рдИ рдмрд░рд╛рдмрд░ рд╣реЛрддреА рд╣реИ, рддреЛ рд╕реЗрд▓ рдкрд╛рдиреА рд╕реЗ рдКрдкрд░ рдЙрда рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣реА рд╣реИ, рдкрд╛рдиреА рдХреА рдЕрд╕рд▓реА рд╕рддрд╣ рдЗрд╕ рдКрдВрдЪрд╛рдИ рд╕реЗ рдиреАрдЪреЗ рд╣реИред  рдирджреА рдХреА рд╕рддрд╣реЛрдВ рдХреЗ рд╕рд╛рде, рдЙрд╕реА рдСрдлрд╕реЗрдЯ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ - <code>HexMetrics.riverSurfaceElevationOffset</code> ред  рдЗрд╕рдХрд╛ рдирд╛рдо рдмрджрд▓рдХрд░ рдПрдХ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public const float riverSurfaceElevationOffset = -0.5f; public const float waterElevationOffset = -0.5f;</span></span></code> </pre> <br>  <code>HexCell.RiverSurfaceY</code> рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдирдП рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред  рдлрд┐рд░ рд╣рдо рдмрд╛рдврд╝ рд╡рд╛рд▓реЗ рд╕реЗрд▓ рдХреА рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдкрд░ рдПрдХ рд╕рдорд╛рди рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RiverSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> WaterSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (waterLevel + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><h3>  рдЬрд▓ рд╕рдВрдкрд╛рджрди </h3><br>  рдЬрд▓ рд╕реНрддрд░ рдХрд╛ рд╕рдВрдкрд╛рджрди рдКрдВрдЪрд╛рдИ рдмрджрд▓рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред  рдЗрд╕рд▓рд┐рдП, <code>HexMapEditor</code> рдХреЛ рд╕рдХреНрд░рд┐рдп рдЬрд▓ рд╕реНрддрд░ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдХреНрдпрд╛ рдЗрд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeElevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeWaterLevel; тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyElevation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyWaterLevel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  UI рдХреЗ рд╕рд╛рде рдЗрди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рддрд░реАрдХреЗ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyWaterLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeWaterLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; }</code> </pre> <br>  рдФрд░ рдкрд╛рдиреА рдХреЗ рд╕реНрддрд░ рдХреЛ <code>EditCell</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } тАж } }</code> </pre> <br>  UI рдореЗрдВ рдПрдХ рдЬрд▓ рд╕реНрддрд░ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд▓реЗрдмрд▓ рдФрд░ рдКрдВрдЪрд╛рдИ рд╕реНрд▓рд╛рдЗрдбрд░ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдмрджрд▓реЗрдВред  рдЙрдирдХреА рдШрдЯрдирд╛рдУрдВ рдХреЛ рдЙрдЪрд┐рдд рддрд░реАрдХреЛрдВ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рдпрд╛рдж рд░рдЦреЗрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42b/a13/de4/42ba13de4120b43e460628021c77d99f.png"></div><br>  <i>рдЬрд▓ рд╕реНрддрд░ рд╕реНрд▓рд╛рдЗрдбрд░ред</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">unitypackage</a> <br><br><h2>  рдкрд╛рдиреА рдХрд╛ рддреНрд░рд┐рдХреЛрдг </h2><br>  рдкрд╛рдиреА рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдирдИ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдирдИ рдЬрд╛рд▓реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <em>рд╡рд╛рдЯрд░</em> рд╢реЗрдбрд░ рдмрдирд╛рдПрдВ, <em>рд░рд┐рд╡рд░</em> рд╢реИрдбрд░ рдХреА рдирдХрд▓ рдХрд░реЗрдВред  рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд░рдВрдЧ рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред <br><br><pre> <code class="hljs pgsql">Shader "Custom/Water" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { "RenderType"="Transparent" "Queue"="Transparent" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard alpha #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br>  <em>рдкрд╛рдиреА рдХреА</em> рд╕рд╛рдордЧреНрд░реА рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рдХреЗ рдФрд░ рдЗрд╕реЗ рдПрдХ shader рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рдЗрд╕ shader рдХреЗ рд╕рд╛рде рдПрдХ рдирдИ рд╕рд╛рдордЧреНрд░реА рдмрдирд╛рдПрдБред  рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЗрд╕реЗ рдмрд╛рдж рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/238/283/fd9238283d92bacd26a3ff5dce73b17b.png"></div><br>  <i>рдкрд╛рдиреА рдХреА рд╕рд╛рдордЧреНрд░реАред</i> <br><br>  <em>рдирджрд┐рдпреЛрдВ</em> рдмрдЪреНрдЪреЗ рдХреЛ рджреЛрд╣рд░рд╛рдХрд░ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдПрдХ рдирдпрд╛ рдмрдЪреНрдЪрд╛ рдЬреЛрдбрд╝реЗрдВред  рдЙрд╕реЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЙрд╕реЗ <em>рдкрд╛рдиреА рдХрд╛</em> рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╣рдо рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдХрд░, рдЗрд╕реЗ рдмрджрд▓рдХрд░, рдФрд░ рдлрд┐рд░ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдХреЗ рдХрд░реЗрдВрдЧреЗред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЙрджрд╛рд╣рд░рдг рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдПрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ec/6e6/82f/6ec6e682f16c604d75c0e5b835d5b03e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c5/3f3/eeb/7c53f3eeb282e533f9f0b8a20e813091.png"></div><br>  <i>рдмрд╛рд▓ рд╡рд╕реНрддреБ рдЬрд▓ред</i> <br><br>  рдЗрд╕рдХреЗ рдмрд╛рдж, <code>HexGridChunk</code> рд╡реЙрдЯрд░ рдореЗрд╢ рд╕рдкреЛрд░реНрдЯ <code>HexGridChunk</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); }</code> </pre> <br>  рдФрд░ рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рдмрдЪреНрдЪреЗ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/19a/76a/b4d19a76a745d550314b277fd2c0e13c.png"></div><br>  <i>рд╡рд╛рдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред</i> <br><br><h3>  рдкрд╛рдиреА рдХреЗ рд╣реЗрдХреНрд╕рд╛рдЧреЛрди </h3><br>  рдЪреВрдВрдХрд┐ рдкрд╛рдиреА рдПрдХ рджреВрд╕рд░реА рдкрд░рдд рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдЗрдП рдкреНрд░рддреНрдпреЗрдХ рджрд┐рд╢рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЕрдкрдиреА рддреНрд░рд┐рднреБрдЬ рдкрджреНрдзрддрд┐ рджреЗрдВред  рд╣рдореЗрдВ рдЗрд╕реЗ рдХреЗрд╡рд▓ рддрднреА рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрдм рд╕реЗрд▓ рдкрд╛рдиреА рдореЗрдВ рдбреВрдмрд╛ рд╣реЛред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsUnderwater) { TriangulateWater(direction, cell, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br>  рдирджрд┐рдпреЛрдВ рдХреА рддрд░рд╣, рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреА рдКрдВрдЪрд╛рдИ рд╕рдорд╛рди рдЬрд▓ рд╕реНрддрд░ рд╡рд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдмрд╣реБрдд рднрд┐рдиреНрди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЬрдЯрд┐рд▓ рдкрд╕рд▓рд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд▓рдЧрддреА рд╣реИред  рдПрдХ рд╕рд╛рдзрд╛рд░рдг рддреНрд░рд┐рдХреЛрдг рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a51/72b/99b/a5172b99ba382c6e79abff653e4b7fb2.png"></div><br>  <i>рдкрд╛рдиреА рдХреЗ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиред</i> <br><br><h3>  рдкрд╛рдиреА рдХреЗ рдпреМрдЧрд┐рдХ </h3><br>  рд╣рдо рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдПрдХ рдЪрддреБрд░реНрднреБрдЬ рдХреЗ рд╕рд╛рде рдкрд╛рдиреА рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !neighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 e1 = c1 + bridge; Vector3 e2 = c2 + bridge; water.AddQuad(c1, c2, e1, e2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a6/3af/949/0a63af9496da925e966b008f41f808a8.png"></div><br>  <i>рдкрд╛рдиреА рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдХрдиреЗрдХреНрд╢рдиред</i> <br><br>  рдФрд░ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдХреЛрдиреЛрдВ рдХреЛ рднрд░реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { тАж water.AddQuad(c1, c2, e1, e2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !nextNeighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } water.AddTriangle( c2, e2, c2 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c32/37e/5b4/c3237e5b4e492f9a1c334f90aaa88ee4.png"></div><br>  <i>рдкрд╛рдиреА рдХреЗ рдХреЛрдиреЛрдВ рдХреЗ рдЬреЛрдбрд╝реЛрдВред</i> <br><br>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╛рдиреА рдХреА рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдЬреБрдбрд╝реА рд╣реБрдИ рд╣реИрдВ рдЬрдм рд╡реЗ рдкрд╛рд╕ рд╣реИрдВред  рд╡реЗ рдЕрдкрдиреЗ рдмреАрдЪ рдФрд░ рд╕реВрдЦреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЕрдзрд┐рдХ рдКрдБрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдВрддрд░ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдмрд╛рдж рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗред <br><br><h3>  рд╕реБрд░реАрд▓реЗ рдЬрд▓ рд╕реНрддрд░ </h3><br>  рд╣рдордиреЗ рдЗрд╕ рдмрд╛рдд рдХреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХреА рдХрд┐ рдкрдбрд╝реЛрд╕реА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕рдорд╛рди рдЬрд▓ рд╕реНрддрд░ рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╕рдм рдХреБрдЫ рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЗрд╕ рдзрд╛рд░рдгрд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/a8b/b4f/fcfa8bb4fb960ddc788d358e60f9023f.png"></div><br>  <i>рдЕрд╕рдВрдЧрдд рдЬрд▓ рд╕реНрддрд░ред</i> <br><br>  рд╣рдо рдкрд╛рдиреА рдХреЛ рдЙрд╕реА рд╕реНрддрд░ рдкрд░ рдмрдирд╛рдпреЗ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рдмрд╛рдврд╝ рд╕реЗрд▓ рдХрд╛ рдЬрд▓ рд╕реНрддрд░ рдмрджрд▓рддрд╛ рд╣реИ, рддреЛ рд╣рдо рд╕реНрддрд░реЛрдВ рдХреЛ рд╕рдорддрд▓ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдкреНрд░рдЪрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рддрдм рддрдХ рдЬрд╛рд░реА рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рди рдХрд░реЗрдВ рдЬреЛ рдкрд╛рдиреА рдореЗрдВ рдбреВрдмреЗ рдирд╣реАрдВ рд╣реИрдВред  рдпреЗ рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдЬрд▓ рджреНрд░рд╡реНрдпрдорд╛рди рдХреА рд╕реАрдорд╛рдУрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИрдВред <br><br>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЦрддрд░рд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдЬрд▓реНрджреА рд╕реЗ рд╣рд╛рде рд╕реЗ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИред  рдпрджрд┐ рд╕рдВрдкрд╛рджрди рдЕрд╕рдлрд▓ рд╣реИ, рддреЛ рдкрд╛рдиреА рдкреВрд░реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдХрд╡рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдлрд┐рд░ рд╕рднреА рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рджреЗрд░реА рдореЗрдВ рднрд╛рд░реА рдЙрдЫрд╛рд▓ рдЖрдПрдЧрд╛ред <br><br>  рддреЛ рдЪрд▓рд┐рдП рдЕрднреА рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рдЬрдмрдХрд┐ рдЬрд▓ рд╕реНрддрд░ рдХреА рд╕реНрдерд┐рд░рддрд╛, рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд┐рд╡реЗрдХ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рдкрд╛рдиреА рдХрд╛ рдПрдиреАрдореЗрд╢рди </h2><br>  рдПрдХ рд╕рдорд╛рди рд░рдВрдЧ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдХреБрдЫ рдРрд╕рд╛ рдмрдирд╛рдПрдВрдЧреЗ рдЬреЛ рд▓рд╣рд░реЛрдВ рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред  рдЕрдиреНрдп рд╢реЗрдбреНрд╕ рдХреА рддрд░рд╣, рдЕрдм рд╣рдо рдПрдХ рд╕реБрдВрджрд░ рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпрд╛рд╕ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рддрд░рдВрдЧреЛрдВ рдХреЛ рдирд╛рдорд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/a2f/1f9/ca1a2f1f978cd2f2993a96b44440227b.png"></div><br>  <i>рдПрдХрджрдо рд╕рдкрд╛рдЯ рдкрд╛рдиреАред</i> <br><br>  рдЪрд▓реЛ рд╣рдордиреЗ рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд┐рдпрд╛ред  рд╣рдо рджреБрдирд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде рд╢реЛрд░ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕рдорд╛рди рд░рдВрдЧ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред  рд╕рддрд╣ рдХреЛ рдЪреЗрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, V рд╕рдордиреНрд╡рдп рдореЗрдВ рд╕рдордп рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise.z; fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рд╕реНрдХреНрд░реЙрд▓рд┐рдВрдЧ рдкрд╛рдиреА, рд╕рдордп ├Ч 10ред</i> <br><br><h3>  рджреЛ рджрд┐рд╢рд╛рдПрдБ </h3><br>  рдЕрдм рддрдХ рдпрд╣ рд▓рд╣рд░реЛрдВ рдХреА рддрд░рд╣ рдирд╣реАрдВ рд╣реИред  рджреВрд╕рд░реЗ рд╢реЛрд░ рдХреЗ рдирдореВрдиреЗ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЪрд┐рддреНрд░ рдХреЛ рдЬрдЯрд┐рд▓ рдмрдирд╛рддреЗ рд╣реИрдВ <br>  рдФрд░ рдЗрд╕ рдмрд╛рд░ рдпреВ рдХреЛрдСрд░реНрдбрд┐рдиреЗрдЯ рдХрд░рддреЗ рд╣реБрдПред рд╣рдо рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреИрдЯрд░реНрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╢реЛрд░ рдЪреИрдирд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рддреИрдпрд╛рд░ рддрд░рдВрдЧреЗрдВ рдпреЗ рджреЛ рдирдореВрдиреЗ рдПрдХ рд╕рд╛рде рдвреЗрд░ рд╣реЛрдВрдЧреЗред <br><br><pre> <code class="hljs pgsql"> float2 uv1 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(_MainTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(_MainTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x;</code> </pre> <br>  рдЬрдм рджреЛрдиреЛрдВ рдирдореВрдиреЛрдВ рдХреЛ рд╕рдореЗрдЯрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ 0-2 рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рд╡рд╛рдкрд╕ 0тАУ1 рдкрд░ рд╕реНрдХреЗрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдХреЗрд╡рд▓ рдЖрдзреЗ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рддрд░рдВрдЧреЛрдВ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рдкрд░рд┐рдгрд╛рдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>smoothstep</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдордиреЗ 1 - 2 рдХреЛ 0-1 рдкрд░ рд░рдЦрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдкрд░ рдХреЛрдИ рднреА рд▓рд╣рд░реЗрдВ рджрд┐рдЦрд╛рдИ рди рджреЗрдВред <br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waves = noise1.z + noise2.x; waves = <span class="hljs-keyword"><span class="hljs-keyword">smoothstep</span></span>(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves);</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рджреЛ рджрд┐рд╢рд╛рдПрдБ, рд╕рдордп ├Ч резрежред</i> <br><br><h3>  рдорд┐рд╢реНрд░рдг рдХреА рд▓рд╣рд░реЗрдВ </h3><br>  рдпрд╣ рдЕрднреА рднреА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рд╢реЛрд░ рдкреИрдЯрд░реНрди рд╣реИрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмрджрд▓рддреЗ рдирд╣реАрдВ рд╣реИрдВред  рдпрджрд┐ рдкреИрдЯрд░реНрди рдмрджрд▓реЗ рдЧрдП рддреЛ рдпрд╣ рдЕрдзрд┐рдХ рдкреНрд░рд╢рдВрд╕рдиреАрдп рд╣реЛрдЧрд╛ред  рд╣рдо рд╢реЛрд░ рдирдореВрдиреЛрдВ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЪреИрдирд▓реЛрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рдХреЗ рдЗрд╕реЗ рдорд╣рд╕реВрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдпрд╣ рдЙрд╕реА рддрд░рд╣ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдкрд╛рдиреА рдХреА рдкреВрд░реА рд╕рддрд╣ рдПрдХ рд╕рд╛рде рдмрджрд▓ рдЬрд╛рдПрдЧреА, рдФрд░ рдпрд╣ рдмрд╣реБрдд рд╣реА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рднреНрд░рдо рдХреА рд▓рд╣рд░ рдкреИрджрд╛ рдХрд░реЗрдВрдЧреЗред <br><br>  рд╣рдо рдПрдХ рд╕рд╛рдЗрдирд╕реЙрдЗрдб рдХреА рдорджрдж рд╕реЗ рдПрдХ рдорд┐рд╢реНрд░рдг рд▓рд╣рд░ рдмрдирд╛рдПрдВрдЧреЗ, рдЬреЛ рддрд┐рд░рдЫреЗ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЗ рд╕рд╛рде рдЪрд▓рддреА рд╣реИред  рд╣рдо рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдХреЛ рд╕рдордиреНрд╡рдп рдХрд░рддреЗ рд╣реБрдП рджреБрдирд┐рдпрд╛ рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдФрд░ <code>sin</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд░рд╛рд╢рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдмрдбрд╝реЗ рдкрд░реНрдпрд╛рдкреНрдд рдмреИрдВрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╝реВрдо рдЖрдЙрдЯ рдХрд░реЗрдВред  рдФрд░ рд╣рд╛рдВ, рдЖрдЗрдП рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЪреЗрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдореВрд▓реНрдп рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y);</code> </pre> <br>  рд╕рд╛рдЗрди рд▓рд╣рд░реЗрдВ -1 рдФрд░ 1 рдХреЗ рдмреАрдЪ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рд╣рдореЗрдВ 0-1 рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЖрдк рдЗрд╕реЗ рд▓рд╣рд░ рдХреЛ рдЪреБрдХрддрд╛ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рдкреГрдердХ рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЙрдЯрдкреБрдЯ рдореВрд▓реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдмрджрд▓реЗ рд╣реБрдП рд░рдВрдЧ рдХреЗ рдмрдЬрд╛рдп рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br><br><pre> <code class="hljs pgsql"> sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x; waves = smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); fixed4 c = blendWave; //saturate(_Color + waves);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa3/3d9/d70/aa33d9d70a022df57a0348423181b258.png"></div><br>  <i>рдорд┐рд╢реНрд░рдг рдХреА рд▓рд╣рд░реЗрдВред</i> <br><br>  рдорд┐рдХреНрд╕рд┐рдВрдЧ рддрд░рдВрдЧреЛрдВ рдХреЛ рдХрдо рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рджреЛрдиреЛрдВ рдирдореВрдиреЛрдВ рд╕реЗ рдХреБрдЫ рд╢реЛрд░ рдорд┐рд▓рд╛рдПрдВред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/c8f/697/618c8f697cd2e463d7349030277d1a82.png"></div><br>  <i>рдорд┐рд╢реНрд░рдг рдХреА рд╡рд┐рдХреГрдд рддрд░рдВрдЧреЗрдВред</i> <br><br>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рджреЛрдиреЛрдВ рд╢реЛрд░ рдирдореВрдиреЛрдВ рдХреЗ рджреЛ рдЪреИрдирд▓реЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд┐рд╢реНрд░рдг рд▓рд╣рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЕрдзрд┐рдХрддрдо рднрд┐рдиреНрдирддрд╛ рдХреЗ рд▓рд┐рдП, рдЪрд╛рд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЪреИрдирд▓ рд▓реЗрдВред <br><br><pre> <code class="hljs lisp"> float waves = lerp(<span class="hljs-name"><span class="hljs-name">noise1</span></span>.z, noise1.w, blendWave) + lerp(<span class="hljs-name"><span class="hljs-name">noise2</span></span>.x, noise2.y, blendWave)<span class="hljs-comment"><span class="hljs-comment">; waves = smoothstep(0.75, 2, waves); fixed4 c = saturate(_Color + waves);</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рдорд┐рд╢реНрд░рдг рддрд░рдВрдЧреЛрдВ, рд╕рдордп ├Ч 2ред</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рддрдЯ </h2><br>  рд╣рдореЗрдВ рдЦреБрд▓реЗ рдкрд╛рдиреА рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдореЗрдВ рддрдЯ рдХреЗ рд╕рд╛рде рдкрд╛рдиреА рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рднрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред  рдЪреВрдБрдХрд┐ рд╣рдореЗрдВ рднреВрдорд┐ рдХреА рдЖрдХреГрддрд┐ рдХреЗ рдЕрдиреБрд░реВрдк рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рддрдЯреАрдп рдЬрд▓ рдХреЛ рдПрдХ рдЕрд▓рдЧ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЖрдЗрдП <code>TriangulateWater</code> рдХреЛ рджреЛ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ - рдПрдХ рдЦреБрд▓реЗ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдФрд░ рдПрдХ рддрдЯ рдХреЗ рд▓рд┐рдПред  рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╣рдо рддрдЯ рдХреЗ рд╕рд╛рде рдХрдм рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдкрдбрд╝реЛрд╕реА рд╕реЗрд▓ рдХреЛ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣реА рд╣реИ, <code>TriangulateWater</code> рд╣рдореЗрдВ рдПрдХ рдкрдбрд╝реЛрд╕реА рдорд┐рд▓реЗрдЧрд╛ред  рдпрджрд┐ рдХреЛрдИ рдкрдбрд╝реЛрд╕реА рд╣реИ рдФрд░ рд╡рд╣ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рддрдЯ рд╕реЗ рдирд┐рдкрдЯ рд░рд╣реЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !neighbor.IsUnderwater) { TriangulateWaterShore(direction, cell, neighbor, center); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateOpenWater(direction, cell, neighbor, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// HexCell neighbor = cell.GetNeighbor(direction); // if (neighbor == null || !neighbor.IsUnderwater) { // return; // } Vector3 bridge = HexMetrics.GetBridge(direction); тАж } } void TriangulateWaterShore ( HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center ) { }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f04/799/441/f0479944178dcb5646bbf935700a798e.png"></div><br>  <i>рддрдЯ рдХреЗ рд╕рд╛рде рдХреЛрдИ рддреНрд░рд┐рднреБрдЬ рдирд╣реАрдВ рд╣реИред</i> <br><br>  рдЪреВрдВрдХрд┐ рддрдЯ рд╡рд┐рдХреГрдд рд╣реИ, рд╣рдореЗрдВ рддрдЯ рдХреЗ рд╕рд╛рде рдкрд╛рдиреА рдХреЗ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╢реАрд░реНрд╖ рдФрд░ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдкреНрд░рд╢рдВрд╕рдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); water.AddTriangle(center, e1.v1, e1.v2); water.AddTriangle(center, e1.v2, e1.v3); water.AddTriangle(center, e1.v3, e1.v4); water.AddTriangle(center, e1.v4, e1.v5); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/761/283/bbd76128386859bb388e6e2d3f105ff0.png"></div><br>  <i>рддрдЯ рдХреЗ рд╕рд╛рде рддреНрд░рд┐рдХреЛрдг рдХреЗ рдкреНрд░рд╢рдВрд╕рдХред</i> <br><br>  рдЕрдЧрд▓рд╛ рдкрд╕рд▓рд┐рдпреЛрдВ рдХреА рдПрдХ рдкрдЯреНрдЯреА рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд░рд╛рд╣рдд рдореЗрдВ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдЦреБрдж рдХреЛ рдХреЗрд╡рд▓ рдХреБрдЫ рдХреНрд╖реЗрддреНрд░реЛрдВ рддрдХ рд╕реАрдорд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдирд╣реАрдВ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рддрдЯ рд╕реЗ рдорд┐рд▓рдиреЗ рдкрд░ <code>TriangulateWaterShore</code> рдХрд╣рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдкрдЯреНрдЯреА рдХреА рд╣рдореЗрд╢рд╛ рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИред <br><br><pre> <code class="cs hljs"> water.AddTriangle(center, e1.v4, e1.v5); Vector3 bridge = HexMetrics.GetBridge(direction); EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v5 + bridge ); water.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); water.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); water.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7da/fbc/aa9/7dafbcaa95a4b48509ab68fbf111c703.png"></div><br>  <i>рддрдЯ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд╕рд▓рд┐рдпреЛрдВ рдХреА рдзрд╛рд░рд┐рдпрд╛рдБред</i> <br><br>  рдЗрд╕реА рддрд░рд╣, рд╣рдореЗрдВ рд╣рд░ рдмрд╛рд░ рдХреЛрдгреАрдп рддреНрд░рд┐рднреБрдЬ рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"> water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { water.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/18f/8b1/06418f8b10cc0fc0a4e2276b86375385.png"></div><br>  <i>рддрдЯ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд╕рд▓рд┐рдпреЛрдВ рдХреЗ рдХреЛрдиреЗред</i> <br><br>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рддрдЯ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдкрд╛рдиреА рд╣реИред  рдЗрд╕рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣рдореЗрд╢рд╛ рд░рд╛рд╣рдд рдЬрд╛рд▓ рдХреЗ рдиреАрдЪреЗ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдореЗрдВ рдХреЛрдИ рдЫреЗрдж рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред <br><br><h3>  рдпреБрд╡реА рддрдЯ </h3><br>  рд╣рдо рд╕рдм рдХреБрдЫ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛ рдЕрдЧрд░ рддрдЯреАрдп рдкрд╛рдиреА рдХрд╛ рдЕрдкрдирд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реЛред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдлреЛрдо рдХрд╛ рдкреНрд░рднрд╛рд╡, рдЬреЛ рддрдЯ рдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪрдиреЗ рдкрд░ рдмрдбрд╝рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╢реЗрдбрд░ рдХреЛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рддрдЯ рдХреЗ рдХрд░реАрдм рдЯреБрдХрдбрд╝реЗ рдХрд┐рддрдиреЗ рд╣реИрдВред  рд╣рдо рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЦреБрд▓реЗ рдкрд╛рдиреА рдореЗрдВ рдХреЛрдИ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдлреЛрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдпрд╣ рдХреЗрд╡рд▓ рддрдЯ рдХреЗ рдкрд╛рд╕ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рджреЛрдиреЛрдВ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкрд╛рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдХрд╛рдлреА рднрд┐рдиреНрди рд╣реИрдВред  рдпрд╣ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдЬрд╛рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рд╣рдо HexGridChunk рдореЗрдВ рдПрдХ рдФрд░ рдореЗрд╖ рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); }</code> </pre> <br>  рдпрд╣ рдирдпрд╛ рдЬрд╛рд▓ <code>TriangulateWaterShore</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br>  рдкрд╛рдиреА рдХреА рд╡рд╕реНрддреБ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ, рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд╕реЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред  рд╣рдо рддрдЯреАрдп рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдПрдХ рд╢реЗрдбрд░ рдФрд░ рд╕рд╛рдордЧреНрд░реА рднреА рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдореМрдЬреВрджрд╛ рд╢реЗрдбрд░ рдФрд░ рдкрд╛рдиреА рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рдирдХрд▓ рдХрд░рддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/561/77e/e73/56177ee7331ce092a859a058645f0364.png"></div><br>  <i>рдкрд╛рдиреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдФрд░ рдпреВрд╡реА рд╕рд╛рдордЧреНрд░реАред</i> <br><br>  <em>рд╡рд╛рдЯрд░ рд╢реЛрд░</em> рд╢реЗрдб рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдкрд╛рдиреА рдХреЗ рдмрдЬрд╛рдп рдпрд╣ рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗред <br><br><pre> <code class="hljs lisp"> fixed4 c = fixed4(<span class="hljs-name"><span class="hljs-name">IN</span></span>.uv_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  рдЪреВрдВрдХрд┐ рдЕрднреА рддрдХ рдХреЛрдИ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХ рдареЛрд╕ рд░рдВрдЧ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдпрд╣ рджреЗрдЦрдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рддрдЯ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд▓рдЧ рдЬрд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/630/45c/ec0/63045cec0f1f367bfee191f69cfa11ad.png"></div><br>  <i>рддрдЯ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ рдЬрд╛рд▓ред</i> <br><br>  рдЖрдЗрдП рддрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕рдордиреНрд╡рд┐рдд V рдореЗрдВ рдбрд╛рд▓реЗрдВред рдЬрд▓ рдкрдХреНрд╖ рдкрд░, рдЗрд╕реЗ 0 рдХрд╛ рдорд╛рди рдкреНрд░рджрд╛рди рдХрд░реЗрдВ, рднреВрдорд┐ рдкрдХреНрд╖ рдкрд░ - рдорд╛рди 1ред рдЪреВрдВрдХрд┐ рд╣рдореЗрдВ рдХрд┐рд╕реА рдФрд░ рдЪреАрдЬрд╝ рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рднреА U рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗрд╡рд▓ 0 рд╣реЛрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f4/3fa/f86/8f43faf864c259e21c2ce731d08f43f6.png"></div><br>  <i>рддрдЯреЛрдВ рдкрд░ рд╕рдВрдХреНрд░рдордг рдЧрд▓рдд рд╣реИрдВред</i> <br><br>  рдЙрдкрд░реЛрдХреНрдд рдХреЛрдб рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдХреЛрдгреЛрдВ рдореЗрдВ рдЧрд▓рдд рд╣реИред  рдпрджрд┐ рдЕрдЧрд▓рд╛ рдкрдбрд╝реЛрд╕реА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИ, рддреЛ рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕рд╣реА рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЬрдм рдЕрдЧрд▓рд╛ рдкрдбрд╝реЛрд╕реА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рддреНрд░рд┐рдХреЛрдг рдХрд╛ рддреАрд╕рд░рд╛ рд╢рд┐рдЦрд░ рдЬрдореАрди рдХреЗ рдиреАрдЪреЗ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cs hljs"> waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, nextNeighbor.IsUnderwater ? <span class="hljs-number"><span class="hljs-number">0f</span></span> : <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/9e9/6e6/c2e9e96e63c161d0f71f81e31742af89.png"></div><br>  <i>рддрдЯреЛрдВ рдкрд░ рд╕рдВрдХреНрд░рдордг рд╕рд╣реА рд╣реИрдВред</i> <br><br><h3>  рддрдЯ рдкрд░ рдЭрд╛рдЧ </h3><br>  рдЕрдм рдЬрдм рддрдЯ рдкрд░ рд╕рдВрдХреНрд░рдордг рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд▓рд╛рдЧреВ рд╣реЛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдлреЛрдо рдкреНрд░рднрд╛рд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рддрдЯ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдПрдХ рд╕рдорд╛рди рд░рдВрдЧ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реИред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = shore; fixed4 c = saturate(_Color + foam); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/502/a56/ef5502a56ab665732312be25a6961817.png"></div><br>  <i>рд░реИрдЦрд┐рдХ рдлреЛрдоред</i> <br><br>  рдлреЛрдо рдХреЛ рдЕрдзрд┐рдХ рд░реЛрдЪрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рд╕рд╛рдЗрдирд╕реЙрдЗрдб рдХреЗ рд╡рд░реНрдЧ рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin(shore * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/acf/6d8/c2eacf6d83e9f7c1298cdd7a05e551d0.png"></div><br>  <i>рд▓реБрдкреНрдд рд╣реЛрддреА рд╕рд╛рдЗрдирд╕реЙрдЗрдб рд╕реНрдХреНрд╡рд╛рдпрд░ рдлреЛрдоред</i> <br><br>  рдХрд┐рдирд╛рд░реЗ рдХреЗ рдкрд╛рд╕ рдЖрдиреЗ рдкрд░ рдлреЛрдо рдХреЛ рдмрдбрд╝рд╛ рдХрд░реЗрдВред  рддрдЯ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕рдХреА рд╡рд░реНрдЧрдореВрд▓ рд▓реЗ рдХрд░ рдРрд╕рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/762/675/e98/762675e987d119034cd5b643c86ca672.png"></div><br>  <i>рдХрд┐рдирд╛рд░реЗ рдХреЗ рдкрд╛рд╕ рдЭрд╛рдЧ рдЧрд╛рдврд╝рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред</i> <br><br>  рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рджрд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХреГрддрд┐ рдЬреЛрдбрд╝реЗрдВред  рддрдЯ рдХреЗ рд╕рдореАрдк рдЬрд╛рдиреЗ рдкрд░ рд╡рд┐рдХреГрддрд┐ рдХреЛ рдХрдордЬреЛрд░ рдмрдирд╛рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП рддрдЯ рдХреЛ рд▓рд╛рдЗрди рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31a/7fd/59a/31a7fd59ad215b200571133543f1406b.png"></div><br>  <i>рд╡рд┐рдХреГрддрд┐ рдХреЗ рд╕рд╛рде рдлреЛрдоред</i> <br><br>  рдФрд░, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╣рдо рдЗрд╕ рд╕рдм рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ: рдПрдХ рд╕рд╛рдЗрдирд╕реЙрдЗрдб рдФрд░ рд╡рд┐рдХреГрддрд┐рдпрд╛рдВ рджреЛрдиреЛрдВред <br><br><pre> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam *= foam * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рдПрдирд┐рдореЗрдЯреЗрдб рдлреЛрдоред</i> <br><br>  рдЖрдиреЗ рд╡рд╛рд▓реЗ рдлреЛрдо рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдкреАрдЫреЗ рд╣рдЯрдиреЗ рд╡рд╛рд▓рд╛ рднреА рд╣реИред  рдЖрдЗрдП, рдПрдХ рджреВрд╕рд░реЗ рд╕рд╛рдЗрдирд╕реЙрдЗрдб рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ, рдЗрд╕реЗ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рдЗрд╕реЗ рдХрдордЬрд╝реЛрд░ рдмрдирд╛рдПрдВ рдФрд░ рдЯрд╛рдЗрдо рд╢рд┐рдлреНрдЯ рдЬреЛрдбрд╝реЗрдВред  рд╕рдорд╛рдкреНрдд рдлреЛрдо рдЗрди рджреЛ рд╕рд╛рдЗрдирд╕реЛрдЗрдбреНрд╕ рдХреА рдЕрдзрд┐рдХрддрдо рдорд╛рддреНрд░рд╛ рд╣реЛрдЧреАред <br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion1 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam1 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion2 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam2 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(foam1, foam2) * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рдЖрд╡рдХ рдФрд░ рдЖрд╡рд░реНрддреА рдлреЛрдоред</i> <br><br><h3>  рд▓рд╣рд░реЛрдВ рдФрд░ рдлреЛрдо рдХрд╛ рдорд┐рд╢реНрд░рдг </h3><br>  рдЦреБрд▓реЗ рдФрд░ рддрдЯреАрдп рдкрд╛рдиреА рдХреЗ рдмреАрдЪ рдПрдХ рддреЗрдЬ рд╕рдВрдХреНрд░рдордг рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рддрдЯреАрдп рдкрд╛рдиреА рдореЗрдВ рдЦреБрд▓реА рдкрд╛рдиреА рдХреА рд▓рд╣рд░реЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИрдВред  рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрди рддрд░рдВрдЧреЛрдВ рдХреЛ <em>рд╡рд╛рдЯрд░ рд╢реЛрд░</em> рд╢реЗрдбрд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рд╡реЗрд╡ рдХреЛрдб рдХреЛ рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЗрд╕реЗ <em>Water.cginc</em> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреЗрд╕реНрдЯ рдХрд░реЗрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдлреЛрдо рдФрд░ рддрд░рдВрдЧреЛрдВ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрдб рдбрд╛рд▓рддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рд╢реЗрдбрд░ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ?</b> <div class="spoiler_text">  рдЕрдкрдиреА рдЦреБрдж рдХреА рд╢рд╛рдорд┐рд▓ shader рдлрд╛рдЗрд▓реЗрдВ рдмрдирд╛рдирд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">5 рд░реЗрдВрдбрд░рд┐рдВрдЧ</a> рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">, рдорд▓реНрдЯреАрдкрд▓ рд▓рд╛рдЗрдЯреНрд╕</a> рдореЗрдВ рдХрд╡рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </div></div><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> Foam (<span class="hljs-type"><span class="hljs-type">float</span></span> shore, float2 worldXZ, sampler2D noiseTex) { // <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore); float2 noiseUV = worldXZ + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion1 = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam1 = sin((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-type"><span class="hljs-type">float</span></span> distortion2 = noise.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam2 = sin((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> max(foam1, foam2) * shore; } <span class="hljs-type"><span class="hljs-type">float</span></span> Waves (float2 worldXZ, sampler2D noiseTex) { float2 uv1 = worldXZ; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(noiseTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = worldXZ; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (worldXZ.x + worldXZ.y) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = lerp(noise1.z, noise1.w, blendWave) + lerp(noise2.x, noise2.y, blendWave); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); }</code> </pre> <br>  <em>рд╡рд╛рдЯрд░</em> рд╢реЗрдбрд░ рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдирдИ рд╢рд╛рдорд┐рд▓ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред <br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br>  <em>рд╡реЙрдЯрд░ рд╢реЛрд░</em> рд╢реЗрдбрд░ рдореЗрдВ, рдорд╛рдиреЛрдВ рдХреА рдЧрдгрдирд╛ рдлреЛрдо рдФрд░ рддрд░рдВрдЧреЛрдВ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдХреА рдЬрд╛рддреА рд╣реИред  рдЬрдм рд╣рдо рддрдЯ рдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ, рддрдм рд╣рдо рд▓рд╣рд░реЛрдВ рдХреЛ рдорд╕рд▓ рджреЗрддреЗ рд╣реИрдВред  рддреИрдпрд╛рд░ рдкрд░рд┐рдгрд╛рдо рдЕрдзрд┐рдХрддрдо рдлреЛрдо рдФрд░ рд▓рд╣рд░реЗрдВ рд╣реЛрдЧреАред <br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = saturate(_Color + max(foam, waves)); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>рдлреЛрдо рдФрд░ рддрд░рдВрдЧреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдгред</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рдлрд┐рд░ рд╕реЗ рддрдЯреАрдп рдкрд╛рдиреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </h2><br>  рддрдЯ рдЬрд╛рд▓ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд░рд╛рд╣рдд рдЬрд╛рд▓ рдХреЗ рдиреАрдЪреЗ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред  рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЦрдбрд╝реА рдЪрдЯреНрдЯрд╛рдиреЗрдВ рдЕрдзрд┐рдХрд╛рдВрд╢ рддрдЯреАрдп рдкрд╛рдиреА рдХреЛ рдЫрд┐рдкрд╛рддреА рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдлреЛрдоред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dea/adf/7e3/deaadf7e3290f93b28ed6177c713bbaa.png"></div><br>  <i>рд▓рдЧрднрдЧ рдЫрд┐рдкрд╛ рд╣реБрдЖ рддрдЯреАрдп рдкрд╛рдиреАред</i> <br><br>  рд╣рдо рддрдЯ рдХреА рдкрдЯреНрдЯреА рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдмрдврд╝рд╛рдХрд░ рдЗрд╕реЗ рд╕рдВрднрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдкрд╛рдиреА рдХреЗ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреА рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЕрдЦрдВрдбрддрд╛ рдЧреБрдгрд╛рдВрдХ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╣рдореЗрдВ <code>HexMetrics</code> рдкрд╛рдиреА рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреЛрдг рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рднреАред <br><br>  рдЕрдЦрдВрдбрддрд╛ рдЧреБрдгрд╛рдВрдХ 0.8 рд╣реИред  рдкрд╛рдиреА рдХреЗ рдпреМрдЧрд┐рдХреЛрдВ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рджреЛрдЧреБрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╛рдиреА рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХреЛ 0.6 рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterFactor = <span class="hljs-number"><span class="hljs-number">0.6f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFirstWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] * waterFactor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSecondWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>] * waterFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреЗ рдХреЛрдгреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЗрди рдирдП рддрд░реАрдХреЛрдВ </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstWaterCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondWaterCorner(direction); тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstWaterCorner(direction), center + HexMetrics.GetSecondWaterCorner(direction) ); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/123/b85/fcf/123b85fcffde7ae313f177f76f882ef5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреЗ рдХреЛрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреЗ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рджреЛрдЧреБрдиреА рд╣реЛ рдЧрдИред </font><font style="vertical-align: inherit;">рдЕрдм </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдкрд╛рдиреА рдореЗрдВ рдкреБрд▓ рдмрдирд╛рдиреЗ рдХреА рд╡рд┐рдзрд┐ рднреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterBlendFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> - waterFactor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWaterBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] + corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>]) * waterBlendFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрджрд▓реЛ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рд╡рд╣ рдирдИ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 bridge = HexMetrics.GetWaterBridge(direction); тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { тАж water.AddTriangle( c2, e2, c2 + HexMetrics.GetWaterBridge(direction.Next()) ); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж Vector3 bridge = HexMetrics.GetWaterBridge(direction); тАж HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetWaterBridge(direction.Next()) ); тАж } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99b/756/1fa/99b7561fad8556733ea1f10b2dcdd233.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдореЗрдВ рд▓рдВрдмреЗ рдкреБрд▓ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдФрд░ рдЬрдореАрди рдХреА рдкрд╕рд▓рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рд╣рдореЗрдВ рдлреЛрдо рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реНрдерд╛рди рджреЗрддрд╛ рд╣реИ, рдЕрдм рдФрд░ рднреА рд░рд╛рд╣рдд рдХреЗ рдиреАрдЪреЗ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рд╣рдо рдкрд╛рдиреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдкрд╛рдиреА рдХреА рд░рд┐рдм рдФрд░ рдЬрдореАрди рдХреА рддрд░рдл рдХреА рдЬрдореАрди рдкрд░ рд░рд┐рдм рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХреЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдкрд╛рдиреА рдХреЗ рдХреЛрдиреЛрдВ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЬрдореАрди рдХреЗ рд╡рд┐рдкрд░реАрдд рдЫреЛрд░ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкреБрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдкрдбрд╝реЛрд╕реА рдХреЗ рдХреЗрдВрджреНрд░ рд╕реЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Vector3 bridge = HexMetrics.GetWaterBridge(direction); Vector3 center2 = neighbor.Position; center2.y = center.y; EdgeVertices e2 = new EdgeVertices( center2 + HexMetrics.GetSecondSolidCorner(direction.Opposite()), center2 + HexMetrics.GetFirstSolidCorner(direction.Opposite()) ); тАж HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); if (nextNeighbor != null) { Vector3 center3 = nextNeighbor.Position; center3.y = center.y; waterShore.AddTriangle( e1.v5, e2.v5, center3 + HexMetrics.GetFirstSolidCorner(direction.Previous()) ); тАж }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b29/3f2/01f/b293f201f065b7921f1098484e3b725d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЧрд▓рдд рдХреЛрдиреЗред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдо рдХрд┐рдпрд╛, рдХреЗрд╡рд▓ рдЕрдм рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдХреЛрдгреАрдп рддреНрд░рд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рджреЛ рдорд╛рдорд▓реЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Vector3 center3 = nextNeighbor.Position; // center3.y = center.y; Vector3 v3 = nextNeighbor.Position + (nextNeighbor.IsUnderwater ? HexMetrics.GetFirstWaterCorner(direction.Previous()) : HexMetrics.GetFirstSolidCorner(direction.Previous())); v3.y = center.y; waterShore.AddTriangle(e1.v5, e2.v5, v3); waterShore.AddTriangleUV( new Vector2(0f, 0f), new Vector2(0f, 1f), new Vector2(0f, nextNeighbor.IsUnderwater ? 0f : 1f) ); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e1/f64/db1/4e1f64db1a34a8e6cff0f402f5fc6bd8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рд╕рд╣реА рдХреЛрдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рдЬреНрдпрд╛рджрд╛рддрд░ рдлреЛрдо рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣рд╛ рд╣реИ, рдпрд╣ рдХрд╛рдлреА рд╕реНрдкрд╖реНрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рднрд░рдкрд╛рдИ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЫрд╛рдпрд╛ рдореЗрдВ рддрдЯ рдореВрд▓реНрдп рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЛ рдХрдо рдХрд░рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдереЛрдбрд╝рд╛ рдХрдордЬреЛрд░ рдмрдирд╛ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="hljs lisp"> shore = sqrt(<span class="hljs-name"><span class="hljs-name">shore</span></span>) * <span class="hljs-number"><span class="hljs-number">0.9</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреИрдпрд╛рд░ рдЭрд╛рдЧред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрдирдбреБрдмреНрдмреА рдирджрд┐рдпрд╛рдБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╛рдиреА рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдП, рдХрдо рд╕реЗ рдХрдо рдЙрди рдЬрдЧрд╣реЛрдВ рдкрд░ рдЬрд╣рд╛рдВ рдХреЛрдИ рднреА рдирджрд┐рдпрд╛рдВ рдирд╣реАрдВ рдмрд╣рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рдкрд╛рдиреА рдФрд░ рдирджрд┐рдпрд╛рдБ рдЕрднреА рддрдХ рдПрдХ рджреВрд╕рд░реЗ рдХреЛ рдиреЛрдЯрд┐рд╕ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдирджрд┐рдпрд╛рдБ рдкрд╛рдиреА рдХреЗ рднреАрддрд░ рдФрд░ рдиреАрдЪреЗ рдмрд╣реЗрдВрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/051/1ee/bc5/0511eebc5420c9203475b65ce5c478b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдореЗрдВ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпрд╛рдБред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕ рдХреНрд░рдо рдореЗрдВ рдкрд╛рд░рднрд╛рд╕реА рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рд╡рд╣ рдХреИрдорд░реЗ рд╕реЗ рдЙрдирдХреА рджреВрд░реА рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирд┐рдХрдЯрддрдо рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЕрдВрддрд┐рдо рд░реВрдк рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рд╢реАрд░реНрд╖ рдкрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреИрдорд░рд╛ рдШреБрдорд╛рддреЗ рд╕рдордп, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реЛрдЧрд╛ рдХрд┐ рдХрднреА-рдХрднреА рдирджрд┐рдпрд╛рдБ рдФрд░ рдХрднреА-рдХрднреА рдкрд╛рдиреА рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдКрдкрд░ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдкреНрд░рддрд┐рдкрд╛рджрди рдЖрджреЗрд╢ рдХреЛ рд╕реНрдерд┐рд░ рдмрдирд╛рдХрд░ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЛ рдкрд╛рдиреА рдХреЗ рдКрдкрд░ рдЦреАрдВрдЪрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЭрд░рдиреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдВред </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реИрдбрд░ рдХреА рдХрддрд╛рд░ рдХреЛ рдмрджрд▓рдХрд░ рд╣рдо рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs objectivec"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent+1"</span></span> }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/74e/d91/4bc74ed9179598f5b9e82c3ff0cde851.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЛ рдЕрдВрддрд┐рдо рд░реВрдк рджреЗрддреЗ рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдХреЗ рднреАрддрд░ рдЫрд┐рдкреА рдирджреА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рдирджреА рдХрд╛ рдмрд┐рд╕реНрддрд░ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдкрд╛рдиреА рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╣ рд╕рдХрддрд╛ рд╣реИ, рд╣рдореЗрдВ рдЗрд╕ рдкрд╛рдиреА рдХреЛ рдирд╣реАрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕рд╕реЗ рднреА рдЕрдзрд┐рдХ, рдпрд╣ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдкрдирдбреБрдмреНрдмреА рдирджрд┐рдпреЛрдВ рдХреЗ рдкрд╛рдиреА рдХреЛ рдирджреА рдХреЗ рдЦрдВрдбреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╣реА рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; тАж } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; тАж } }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП, рд╣рдо рдПрдХ рдирджреА рдЦрдВрдб рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдЬрдм рди рддреЛ рд╡рд░реНрддрдорд╛рди рдФрд░ рди рд╣реА рдкрдбрд╝реЛрд╕реА рд╕реЗрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/899/0c7/cf6/8990c7cf6af7bf25596b4ffc05204817.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рдирджрд┐рдпрд╛рдБ рдирд╣реАрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЭрд░рдиреЗ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рдирджрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирджрд┐рдпреЛрдВ рдХреЗ рдЙрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЫреЗрдж рд╣реИрдВ рдЬрд╣рд╛рдБ рд╡реЗ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рд╕реЗ рдорд┐рд▓рддреЗ рд╣реИрдВред рдЙрд╕реА рд╕реНрддрд░ рдкрд░ рдирджрд┐рдпрд╛рдБ рдЬреИрд╕реЗ рдкрд╛рдиреА рдЫреЛрдЯреЗ-рдЫреЛрдЯреЗ рдЫреЗрдж рдпрд╛ рдУрд╡рд░рд▓реЗ рдмрдирд╛рддреА рд╣реИрдВред рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдЕрдзрд┐рдХ рдКрдВрдЪрд╛рдИ рд╕реЗ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд▓рд╛рдкрддрд╛ рдЭрд░рдиреЗред рдЖрдЗрдП рдкрд╣рд▓реЗ рдЙрдирдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░реЗрдВ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЬрд▓рдкреНрд░рдкрд╛рдд рд╡рд╛рд▓рд╛ рдирджреА рдЦрдВрдб рдкрд╛рдиреА рдХреА рд╕рддрд╣ рд╕реЗ рд╣реЛрдХрд░ рдЧреБрдЬрд░рддрд╛ рдерд╛ред рдирддреАрдЬрддрди, рдЙрдиреНрд╣реЛрдВрдиреЗ рдЦреБрдж рдХреЛ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдКрдкрд░ рдФрд░ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдкрд╛рдпрд╛ред рд╣рдореЗрдВ рдкрд╛рдиреА рдХреЗ рд╕реНрддрд░ рд╕реЗ рдКрдкрд░ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рд░рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдмрд╛рдХреА рд╕рдм рдХреЛ рддреНрдпрд╛рдЧ рдХрд░ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХрдбрд╝реА рдореЗрд╣рдирдд рдХрд░рдиреА рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдИ рд╡рд┐рдзрд┐ рдореЗрдВ рдЪрд╛рд░ рдЪреЛрдЯрд┐рдпреЛрдВ, рджреЛ рдирджреА рдХреЗ рд╕реНрддрд░ рдФрд░ рдПрдХ рдЬрд▓ рд╕реНрддрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рд╣рдо рдЗрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рд╣рдо рд╡рд░реНрддрдорд╛рди рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рджреЗрдЦреЗрдВ, рдиреАрдЪреЗ рдЭрд░рдирд╛ред рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реЗ рджреЛ рдЪреЛрдЯрд┐рдпрд╛рдВ рдФрд░ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдХрд┐рдирд╛рд░реЗ рд╢реАрд░реНрд╖ рдкрд░ рд╣реЛрдВрдЧреЗ, рдФрд░ рдирд┐рдЪрд▓реЗ рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterfallInWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterY </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = y1; v3.y = v4.y = y2; rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЛ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕ рд╕рдордп </font><font style="vertical-align: inherit;">рдХрд╣реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">рдЬрдм рдкрдбрд╝реЛрд╕реА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдПрдХ рдЭрд░рдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &gt; neighbor.WaterLevel) { TriangulateWaterfallInWater( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, neighbor.WaterSurfaceY ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдореЗрдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдЭрд░рдиреЗ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрдм рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИ, рдФрд░ рдЕрдЧрд▓реЗ рдПрдХ рдирд╣реАрдВ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !neighbor.IsUnderwater &amp;&amp; neighbor.Elevation &gt; cell.WaterLevel ) { TriangulateWaterfallInWater( e2.v4, e2.v2, e1.v4, e1.v2, neighbor.RiverSurfaceY, cell.RiverSurfaceY, cell.WaterSurfaceY ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рдлрд┐рд░ рд╕реЗ рд╣рдо рдореВрд▓ рдирджреА рдХрд╛ рдЪреМрдЧреБрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛ рд╣рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </font></font><code>TriangulateWaterfallInWater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдирд┐рдЪрд▓реА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рдЬрд▓ рд╕реНрддрд░ рддрдХ рдмрдврд╝рд╛ рджреЗред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдХреЗрд╡рд▓ рд╡рд╛рдИ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрджрд▓рдирд╛ рд╣реА рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЪрдЯреНрдЯрд╛рди рд╕реЗ рдЭрд░рдиреЗ рдХреЛ рдзрдХреНрдХрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЫреЗрдж рдмрди рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЖрдкрдХреЛ рдирд┐рдЪрд▓реЗ рдХреЛрдиреЗ рдХреЛ рдКрдкрд░реА рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдкреНрд░рдХреНрд╖реЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/942/11b/250/94211b250d95b614a5d6be6ff52c9e9e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдорд╛рдиреНрдп рддрд░реАрдХреЗ рд╕реЗред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдЪрд▓реА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рдКрдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдирдХреА рджреВрд░реА рдХреЛ рдЭрд░рдиреЗ рдХреА рдКрдВрдЪрд╛рдИ рд╕реЗ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЗ рдиреАрдЪреЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рдПрдХ рдкреНрд░рдХреНрд╖реЗрдкрдХ рдореВрд▓реНрдп рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╣рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рдЭрд░рдирд╛ рдорд┐рд▓рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рдорд╛рди рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЪреВрдВрдХрд┐ рдирд┐рдЪрд▓реЗ рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдмрджрд▓ рдЧрдИ рд╣реИ, рд╡реЗ рдореВрд▓ рдХреЛрдиреЗ рдХреА рддрд░рд╣ рд╡рд┐рдХреГрдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо рдЕрднреА рднреА рдореВрд▓ рдЭрд░рдиреЗ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЛрдиреЗ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╡рд┐рдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдлрд┐рд░ undistorted рдХреНрд╡рд╛рдб рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; v1 = HexMetrics.Perturb(v1); v2 = HexMetrics.Perturb(v2); v3 = HexMetrics.Perturb(v3); v4 = HexMetrics.Perturb(v4); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuadUnperturbed(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрд╡рд┐рднрд╛рдЬрд┐рдд рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝рдиреЗ рдХреА рдПрдХ рд╡рд┐рдзрд┐ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ quads рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>HexMesh.AddQuadUnperturbed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUnperturbed</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(v1); vertices.Add(v2); vertices.Add(v3); vertices.Add(v4); triangles.Add(vertexIndex); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">3</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc4/605/bdd/dc4605bdd24ed9460b0ca3a310a11fb5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЭрд░рдиреЗ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореБрдВрд╣ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдирджрд┐рдпрд╛рдБ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЗ рд╕рдорд╛рди рдКрдБрдЪрд╛рдИ рдкрд░ рдмрд╣рддреА рд╣реИрдВ, рддреЛ рдирджреА рдХрд╛ рдЬрд╛рд▓ рддрдЯреАрдп рдЬрд╛рд▓ рдХреЛ рдЫреВрддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рд╕рдореБрджреНрд░ рдореЗрдВ рдпрд╛ рд╕рдореБрджреНрд░ рдореЗрдВ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реЛрддреА, рддреЛ рд╕рд░реНрдл рдХреЗ рд╕рд╛рде рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреА рдПрдХ рдзрд╛рд░рд╛ рд╣реЛрддреАред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдРрд╕реЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдПрд╕реНрдЯреНрд░реБрдЕрд░реА рдХрд╣реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/27b/efa/ddd27befa12ec543e2969505365b0d91.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рд╡рд┐рдХреГрдд рдХрд┐рдП рдмрд┐рдирд╛ рддрдЯ рд╕реЗ рдорд┐рд▓рддреА рд╣реИред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рд╣рдореЗрдВ рдореБрдВрд╣ рд╕реЗ рджреЛ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреНрд╡рд╛рдб рдирджрд┐рдпрд╛рдБ рджреВрд╕рд░реЗ рдФрд░ рдЪреМрдереЗ рдкрд╕рд▓рд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИрдВ, рддреАрд╕рд░реЗ рдХреЛ рдЫреЛрдбрд╝рддреА рд╣реИрдВред рдЪреВрдВрдХрд┐ рдкрд╛рдиреА рдХрд╛ рддрдЯ рддреАрд╕рд░реА рдЪреЛрдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХ рдЫреЗрдж рдпрд╛ рдУрд╡рд░рд▓реИрдк рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рдо рдореБрдВрд╣ рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЛ рдмрджрд▓рдХрд░ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реА рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдлреЛрдо рдФрд░ рдирджреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмреАрдЪ рдПрдХ рддреЗрдЬ рд╕рдВрдХреНрд░рдордг рд╣реИред рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдЕрдиреНрдп рд╕рд╛рдордЧреНрд░реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рдирджреА рдФрд░ рдкрд╛рдиреА рдХреЗ рдкреНрд░рднрд╛рд╡реЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рдХрд░рддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдореБрдВрд╣ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪрд▓реЛ рдЙрдирдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВред рдпрд╣ </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдм </font><font style="vertical-align: inherit;">рдХрд╣рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">рдЬрдм рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рдирджреА рдЪрд▓рддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реА рдкрдЯреНрдЯреА рдХреЛ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛрдиреЛрдВ рдкреНрд░рднрд╛рд╡реЛрдВ рдХреЛ рдорд┐рд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЯреНрд░реЗрдкреЛрдЬреЙрдЗрдб рдЖрдХрд╛рд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдкрдХреНрд╖реЛрдВ рдкрд░ рджреЛ рддрдЯреАрдп рддреНрд░рд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { waterShore.AddTriangle(e2.v1, e1.v2, e1.v1); waterShore.AddTriangle(e2.v5, e1.v5, e1.v4); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ece/ca1/fc9/ececa1fc9852f7350a54e00fa71df0b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рд╢реНрд░рдг рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП рдЯреНрд░реЗрдкреЗрдЬрд╝реЙрдЗрдбрд▓ рдЫреЗрджред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирджреА рдкреНрд░рднрд╛рд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдПрдХ рдлреЛрдо рдкреНрд░рднрд╛рд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рднреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдорд┐рд╢реНрд░рдг рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рджреЛ рд╕реЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдПрдХрддрд╛ рдЗрдВрдЬрди рдХреЗ рдЬрд╛рд▓ рдЪрд╛рд░ рдпреВрд╡реА рд╕реЗрдЯ рддрдХ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдмрд╕ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рд╕реЗрдЯ рдХреЗ рд╕рдорд░реНрдерди </font><font style="vertical-align: inherit;">рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors, useUVCoordinates, useUV2Coordinates; [NonSerialized] List&lt;Vector2&gt; uvs, uv2s; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { uv2s = ListPool&lt;Vector2&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">0</span></span>, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">1</span></span>, uv2s); ListPool&lt;Vector2&gt;.Add(uv2s); } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UVs рдХреЗ рджреВрд╕рд░реЗ рд╕реЗрдЯ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо UV рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдХреА рдирдХрд▓ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреА рдЬрд╝рд░реВрд░рдд рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3, Vector3 uv4</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); uv2s.Add(uv4); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMax</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMax)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMax)); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд┐рд╡рд░ рд╢реИрдбрд░ рдлрдВрдХреНрд╢рди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рджреЛ рдкреНрд░рднрд╛рд╡ рдореЗрдВ рдирджреА рдХреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдо </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХреЗ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рд╕реЗ рдХреЛрдб </font><font style="vertical-align: inherit;">рдХреЛ рдирдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдлрд╝рдВрдХреНрд╢рди рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> River (float2 riverUV, sampler2D noiseTex) { float2 uv = riverUV; uv.x = uv.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> + _Time.y * <span class="hljs-number"><span class="hljs-number">0.005</span></span>; uv.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, uv); float2 uv2 = riverUV; uv2.x = uv2.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> - _Time.y * <span class="hljs-number"><span class="hljs-number">0.0052</span></span>; uv2.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.23</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noise.x * noise2.w; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдирдИ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, _MainTex); fixed4 c = saturate(_Color + river); тАж }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореБрдБрд╣ рдХреА рд╡рд╕реНрддреБ </font></font></h3><br><font style="vertical-align: inherit;"></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрд╖ рд╡рд╕реНрддреБ </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рд╕рдорд░реНрдерди </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдореБрдВрд╣ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore, estuaries; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЫрд╛рдпрд╛рджрд╛рд░, рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореБрдВрд╣ рдХреА рдПрдХ рд╡рд╕реНрддреБ рдмрдирд╛рдПрдВ, рддрдЯ рдХреА рдирдХрд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЦрдВрдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ, рдФрд░ рдЗрд╕реЗ UV рдФрд░ UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/540/77a/7fc/54077a7fc8653228cd723ca855330fed.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБ рдЕрдиреБрдорд╛рдиред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореБрдВрд╣ рд╕реЗ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдХреЗ рдЕрдВрдд рдФрд░ рдкрд╛рдиреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рдореЗрдВ рдПрдХ рддреНрд░рд┐рдХреЛрдг рд░рдЦрдХрд░ рдЫреЗрдж рдпрд╛ рдУрд╡рд░рд▓реИрдк рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░рд╛ рдореБрдБрд╣ shader рддрдЯ рдХреА рдЫрд╛рдпрд╛ рдХрд╛ рдПрдХ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдлреЛрдо рдХреЗ рдкреНрд░рднрд╛рд╡ рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП UV рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { тАж estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f02/bb6/f76/f02bb6f768f915d39c05296055cc0b83.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдордзреНрдп рддреНрд░рд┐рднреБрдЬред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдордзреНрдп рддреНрд░рд┐рдХреЛрдг рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдПрдХ рдХреНрд╡рд╛рдб рдЬреЛрдбрд╝рдХрд░ рдкреВрд░реЗ рдЯреНрд░реЗрдкреЛрдЬреЙрдЗрдб рдХреЛ рднрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuad(e1.v2, e1.v3, e2.v1, e2.v2); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef2/672/e7e/ef2672e7e62b9d66463e4fc44dc43b7a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреИрдпрд╛рд░ рд╣реИ рдЯреНрд░реЗрдкреЛрдЬреЙрдЗрдбред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдХреНрд╡рд╛рдб рдУрд░рд┐рдПрдВрдЯреЗрд╢рди рдХреЛ рдмрд╛рдИрдВ рдУрд░ рдореЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ рдЗрд╕рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╡рд┐рдХрд░реНрдг рдХрдиреЗрдХреНрд╢рди рд╣реЛ, рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣рдореЗрдВ рд╕рдордорд┐рдд рдЬреНрдпрд╛рдорд┐рддрд┐ рдорд┐рд▓рддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuad(e2.v1, e1.v2, e2.v2, e1.v3); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd5/dd0/7d1/cd5dd07d1b9f1fb8126e6a5a7c1bc29b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШреБрдорд╛рдпрд╛ рд╣реБрдЖ рдХреНрд╡рд╛рдб, рд╕рдордорд┐рдд рдЬреНрдпрд╛рдорд┐рддрд┐</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХрд╛ рдмрд╣рд╛рд╡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдордзреНрдп рддреНрд░рд┐рднреБрдЬ рдХрд╛ рддрд▓ рдирджреА рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рд╕рдордиреНрд╡рдп U 0.5 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдирджреА рдкрд╛рдиреА рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рдмрд╣рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдмрд╛рдПрдВ рдмрд┐рдВрджреБ рдХреЛ 1 рдХреЗ рдмрд░рд╛рдмрд░ рдпреВ рд╕рдордиреНрд╡рдп рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рджрд╛рдИрдВ рдУрд░ 0 рдХреЗ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдпреВ рд╕рдордиреНрд╡рдп рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред рд╣рдо рд╡рд░реНрддрдорд╛рди рдХреЗ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдЕрдиреБрд░реВрдк 0 рдФрд░ 1 рдХреЛ Y рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреНрд░рд┐рдХреЛрдг рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЪрддреБрд░реНрднреБрдЬ рдХреЛ рдЗрд╕ рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдХреА рдЪреМрдбрд╝рд╛рдИ рд╕реЗ рдЕрдзрд┐рдХ рдЕрдВрдХ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдпреВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд░рдЦрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a98/475/d50/a98475d50fe84d16eeeff5397f6aa43f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UV2 рдЯреНрд░реЗрдкреЛрдЬреЙрдЗрдбред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╣рдо UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реНрдЯреЗрд╕реНрдЯрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ </font><font style="vertical-align: inherit;">рдХреЛ рдЙрдиреНрд╣реЗрдВ </font><font style="vertical-align: inherit;">рд╕реМрдВрдк </font><font style="vertical-align: inherit;">рджреЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрдирдкреБрдЯ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдЬреЛрдбрд╝рдХрд░ рдЗрди рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>float2 uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 uv2_MainTex; float3 worldPos; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = fixed4(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efd/416/d95/efd416d95c7827f264f2f0e8360e6fde.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдм рдХреБрдЫ рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рдЖрдк рдирджреА рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ shader рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); fixed4 c = saturate(_Color + river); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e3/2c9/fda/0e32c9fda58b356534c2070d0b74adae.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдкреНрд░рднрд╛рд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП UV2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдирджрд┐рдпреЛрдВ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИ рдХрд┐ рдЬрдм рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдХрдиреЗрдХреНрд╢рди рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдХрд░рддреЗ рд╣реИрдВ, рддреЛ V рдирджреА рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ 0.8 рд╕реЗ 1 рддрдХ рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕ рдЕрдВрддрд░рд╛рд▓ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ 0 рд╕реЗ 1 рддрдХ рдирд╣реАрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рддрдЯреАрдп рдХрдиреЗрдХреНрд╢рди рд╕рд╛рдзрд╛рд░рдг рд╕реЗрд▓ рдХрдиреЗрдХреНрд╢рди рдХреА рддреБрд▓рдирд╛ рдореЗрдВ 50% рд╣реИред ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдирджреА рдХреЗ рдкрд╛рдареНрдпрдХреНрд░рдо рдХреЗ рд╕рд╛рде рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдлрд┐рдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдорд╛рдиреЛрдВ рдХреЛ 0.8 рд╕реЗ 1.1 рддрдХ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/27d/beb/7c6/27dbeb7c67553163422fd560e64ddb03.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0c/4d9/2e3/b0c4d92e3797274e2534a6921334d184.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдФрд░ рдореБрд╣рд╛рдирд╛ рдХрд╛ рд╕рдордХрд╛рд▓рд┐рдХ рдкреНрд░рд╡рд╛рд╣ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╡рд╛рд╣ рд╕реЗрдЯрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рдирджреА рдПрдХ рд╕реАрдзреА рд░реЗрдЦрд╛ рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЬрдм рдкрд╛рдиреА рдПрдХ рдмрдбрд╝реЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдмрд╣рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд░рдВрдЯ рд╡рдХреНрд░ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдореЛрдбрд╝рдХрд░ рдЗрд╕реЗ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдкрд░реА рдпреВ рд╕рдордиреНрд╡рдп рдХреЛ рдирджреА рдХреА рдЪреМрдбрд╝рд╛рдИ рдХреЗ рдмрд╛рд╣рд░ рд╕реНрдерд┐рд░ рд░рдЦрдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЙрдиреНрд╣реЗрдВ 0.5 рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдмрд╛рдИрдВ рдУрд░ 1.5 рд╣реИ, рджрд╛рдИрдВ рдУрд░ .50.5 рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рд╕рдордп, рд╣рдо рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдиреАрдЪреЗ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдпреВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмрд╛рдПрдВ рдХреЛ 1 рд╕реЗ 0.7 рддрдХ рдФрд░ рджрд╛рдПрдВ рдХреЛ 0 рд╕реЗ 0.3 рддрдХ рдмрджрд▓реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); тАж estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/850/99d/976/85099d97610434a630621e9e06f885ad.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c1/567/f72/0c1567f72c979734719b298c7850b59e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рдХреНрд░рддрд╛ рдкреНрд░рднрд╛рд╡ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдорд╛рди рдЪрд╛рд░ рдмрд┐рдВрджреБрдУрдВ рдХреЗ V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрджрд▓реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкрд╛рдиреА рдирджреА рдХреЗ рдЕрдВрдд рд╕реЗ рдмрд╣рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╡реА рдКрдкрд░реА рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ 1. рддрдХ рдмрдврд╝рд╛рдПрдВрдЧреЗ рдФрд░ рдПрдХ рдмреЗрд╣рддрд░ рд╡рдХреНрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЛ рдирд┐рдЪрд▓реЗ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ 1.15 рддрдХ рдмрдврд╝рд╛рдПрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/86d/320/1fa86d32037da7fab579ce9a195d1e71.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b07/edb/dfe/b07edbdfeb3615b1a597712a6bda5c8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХрд╛ рдШреБрдорд╛рд╡рджрд╛рд░ рдХреЛрд░реНрд╕ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдФрд░ рддрдЯ рдорд┐рдХреНрд╕ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЬреЛ рдХреБрдЫ рднреА рд╣реИ рд╡рд╣ рддрдЯ рдФрд░ рдирджреА рдХреЗ рдкреНрд░рднрд╛рд╡реЛрдВ рдХреЛ рдорд┐рд▓рд╛рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдкреНрд░рдХреНрд╖реЗрдкрд╡рдХреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рддрдЯ рдорд╛рди рд▓реЗрддреЗ рд╣реБрдП рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shoreWater = max(foam, waves); <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> water = lerp(shoreWater, river, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x); fixed4 c = saturate(_Color + water);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдХрдВрдкрд╛рдЗрд▓рд░ рдкреБрди: рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рд╢рд┐рдХрд╛рдпрдд рдХрд░рддрд╛ рд╣реИ </font></font><code>_MainTex_ST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдХрд╛рд░рдг рдЕрдВрджрд░ рд╕рддрд╣ рд╢реЗрдбрд░ рд╕рдВрдХрд▓рдХ рдПрдХрддрд╛ рддреНрд░реБрдЯрд┐ рдПрдХ рд╕рд╛рде рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рд╡рдЬрд╣ рд╕реЗ рд╣реИ </font></font><code>uv_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд╡рд░реНрдХрдЕрд░рд╛рдЙрдВрдб рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рдмрдЬрд╛рдп </font><font style="vertical-align: inherit;">, рд╣рдореЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рджреНрд╡рд┐рддреАрдпрдХ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд╛рдо рдмрджрд▓рдиреЗ </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>riverUV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ shader рдореЗрдВ рдПрдХ рд╡рд░реНрдХрдЯ рдлрд╝рдВрдХреНрд╢рди рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ рдЗрд╕реЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert тАж struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 riverUV; float3 worldPos; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.riverUV = v.texcoord1.xy; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.riverUV, _MainTex); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/904/b40/c98/904b40c98323b2e9f32bd16513344181.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдЯ рдореВрд▓реНрдп рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреНрд░рдХреНрд╖реЗрдкред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрдЯрд░рдкреЛрд▓реЗрд╢рди рд╢реАрд░реНрд╖ рдкрд░ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдХреЛрдиреЗ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрди рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдирджреА рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рддрдЯ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬреЛ рдХрд┐ рдЗрди рджреЛ рдЫреЛрд░реЛрдВ рдкрд░ рд╣реИред рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдкрд╣рд▓реЗ рдпреВрд╡реА рд╕реЗрдЯ рдХрд╛ рдпреВ рд╕рдордиреНрд╡рдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕ рдореВрд▓реНрдп рдХреЛ рд╡рд╣рд╛рдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/e93/432/b34e93432248fb7be818b53aca4d8b20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣реА рдорд┐рд╢реНрд░рдгред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдореБрдВрд╣ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдирджреА, рддрдЯреАрдп рдкрд╛рдиреА рдФрд░ рдлреЛрдо рдХреЗ рдмреАрдЪ рдПрдХ рдЕрдЪреНрдЫрд╛ рдорд┐рд╢реНрд░рдг рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЭрд░рдиреЗ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдЯреАрдХ рдореЗрд▓ рдирд╣реАрдВ рдмрдирд╛рддрд╛ рд╣реИ, рдпрд╣ рдкреНрд░рднрд╛рд╡ рдЭрд░рдиреЗ рдХреЗ рд╕рд╛рде рднреА рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХреНрд╢рди </font></font></i> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">рдпреВрдирд┐рдЯреАрдЬ </font></a><i><font style="vertical-align: inherit;">рдореЗрдВ </font></i></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдорд╛рди</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд▓ рдирд┐рдХрд╛рдпреЛрдВ рд╕реЗ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпрд╛рдБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирджрд┐рдпреЛрдВ рдХреЗ рдЬрд▓ рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдореЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рдЕрд▓рдЧ рджрд┐рд╢рд╛ рдореЗрдВ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕рдорд░реНрдерди рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕реА рдЭреАрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдирджрд┐рдпрд╛рдБ рдмрд╣рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рднреА рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдПрдХ рдирджреА рдкрд╛рдиреА рдХреЗ рд╢рд░реАрд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреА рд╣реИ, рддреЛ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдзрд┐рдХ рдКрдВрдЪрд╛рдИ рдХреА рдУрд░ рдмрд╣рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдПрдХ рдЕрдкрд╡рд╛рдж рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдпрджрд┐ рдЬрд▓ рд╕реНрддрд░ рд▓рдХреНрд╖реНрдп рдмрд┐рдВрджреБ рдХреА рдКрдВрдЪрд╛рдИ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдЬреА рдкрджреНрдзрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдирдИ рдХрд╕реМрдЯреА рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИ рдХрд┐ рдкрдбрд╝реЛрд╕реА рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд▓рдХреНрд╖реНрдп рдмрд┐рдВрджреБ рд╣реИ рдпрд╛ рдирд╣реАрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidRiverDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell neighbor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> neighbor &amp;&amp; ( elevation &gt;= neighbor.elevation || waterLevel == neighbor.elevation ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЕрдкрдиреА рдирдИ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } HexCell neighbor = GetNeighbor(direction); <span class="hljs-comment"><span class="hljs-comment">// if (!neighbor || elevation &lt; neighbor.elevation) { if (!IsValidRiverDestination(neighbor)) { return; } RemoveOutgoingRiver(); тАж }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдкрдХреЛ рд╕реЗрд▓ рдпрд╛ рдЬрд▓ рд╕реНрддрд░ рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп рдирджреА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдирд┐рдЬреА рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ рдЬреЛ рдпрд╣ рдХрд╛рд░реНрдп рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateRivers</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasOutgoingRiver &amp;&amp; !IsValidRiverDestination(GetNeighbor(outgoingRiver)) ) { RemoveOutgoingRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasIncomingRiver &amp;&amp; !GetNeighbor(incomingRiver).IsValidRiverDestination(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ) { RemoveIncomingRiver(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдирдИ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЧреБрдгреЛрдВ </font></font><code>Elevation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рдЧреБрдгреЛрдВ рдореЗрдВ рдХрд░реЗрдВрдЧреЗ </font></font><code>WaterLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { тАж <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { тАж <span class="hljs-comment"><span class="hljs-comment">// if ( // hasOutgoingRiver &amp;&amp; // elevation &lt; GetNeighbor(outgoingRiver).elevation // ) { // RemoveOutgoingRiver(); // } // if ( // hasIncomingRiver &amp;&amp; // elevation &gt; GetNeighbor(incomingRiver).elevation // ) { // RemoveIncomingRiver(); // } ValidateRivers(); тАж } } public int WaterLevel { тАж set { if (waterLevel == value) { return; } waterLevel = value; ValidateRivers(); Refresh(); } }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c04/ca4/b49/c04ca4b49ccff20e71dba70dc1a2bea7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХреА рдЭреАрд▓реЛрдВ рдХреЗ рдмрд╛рд╣рд░ рдЬрд╛рдирд╛ рдФрд░ рдкреНрд░рд╡реЗрд╢ рдХрд░рдирд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреНрд╡рд╛рд░ рдХреЛ рдореЛрдбрд╝реЛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ </font></font><code>HexGridChunk.TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдХрд┐ рдирджрд┐рдпрд╛рдБ рдХреЗрд╡рд▓ рдкрд╛рдиреА рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдирджреА рдХрд╛ рдорд╛рд░реНрдЧ рд╣рдореЗрд╢рд╛ рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкрд╛рдиреА рдХреЗ рд╢рд░реАрд░ рд╕реЗ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдЙрд▓реНрдЯрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ </font></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╡рд╛рд╣ рдХреА рджрд┐рд╢рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЙрд╕реЗ рдПрдХ рдмреВрд▓рд┐рдпрди рдкреИрд░рд╛рдореАрдЯрд░ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЗрд╕ рдкрджреНрдзрддрд┐ рд╕реЗ рдХреЙрд▓ рдХрд░рддреЗ рд╕рдордп рдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗ </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2, cell.IncomingRiver == direction); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ UV2 рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдмрджрд▓рдХрд░ рдирджреА рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирд┐рд╡рд░реНрддрдорд╛рди рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдпреВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: becomes0.5 1.5 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, 0 1 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, 1 0 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ 1.5 and0.5 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд╕рд╛рде, рдЪреАрдЬреЗрдВ рдереЛрдбрд╝реА рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдордиреЗ рдЙрд▓реНрдЯреЗ рдирджреА рдХрдиреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдХрд╛рдо рдХрд┐рдпрд╛ рд╣реИ, рддреЛ 0.8 0 рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ 1 .20.2 рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ 1.1 тИТ0.3 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ 1.15 .30.35 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдорд╛рдорд▓реЗ рдореЗрдВ UV2 рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрд╣реБрдд рдЕрд▓рдЧ рд╣реИрдВ, рдЖрдЗрдП рдЙрдирдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдХреЛрдб рд▓рд┐рдЦреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (incomingRiver) { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>) ); } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХрд╛ рд╕рд╣реА рдкрд╛рдареНрдпрдХреНрд░рдоред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 9: рд░рд╛рд╣рдд рд╕реБрд╡рд┐рдзрд╛рдПрдБ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд░рд╛рд╣рдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдШрдирддреНрд╡ рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдмрдирд╛рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╕реНрддрд░ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдорд┐рд▓рд╛рдПрдВред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рдЗрд▓рд╛рдХреЗ рдореЗрдВ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрдорд╛рд░рддреЛрдВ рдФрд░ рдкреЗрдбрд╝реЛрдВ рдЬреИрд╕реА рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8b/1ec/f84/b8b1ecf8496a03d50c881bbd47c262ad.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдВрдЧрд▓реЛрдВ, рдХреГрд╖рд┐ рднреВрдорд┐ рдФрд░ рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рдмреАрдЪ рд╕рдВрдШрд░реНрд╖ред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝реЗрдВ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рд░рд╛рд╣рдд рдХреЗ рдЖрдХрд╛рд░ рдореЗрдВ рд╡рд┐рд╡рд┐рдзрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдЗрд╕ рдкрд░ рдХреБрдЫ рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдирд┐рд░реНрдЬреАрд╡ рднреВрдорд┐ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдЬреАрд╡рди рдХреЛ рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдРрд╕реА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкреЗрдбрд╝реЛрдВ рдФрд░ рдШрд░реЛрдВ рдХреА рддрд░рд╣ред </font><font style="vertical-align: inherit;">рдпреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рд░рд╛рд╣рдд рдЬрд╛рд▓ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрдВ рдЗрд▓рд╛рдХреЗ рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдмрдирд╛рдиреЗ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдирд╣реАрдВ рд░реЛрдХрддрд╛ рд╣реИред </font></font><br><br> <code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореЗрд╖ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╣ рдмрд╕ рдЕрдкрдиреЗ рдПрдХ рдмрдЪреНрдЪреЗ рдХреЛ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рддреНрд░рд┐рдХреЛрдг рдпрд╛ рдХреНрд╡рд╛рдб рдЬреЛрдбрд╝рдиреЗ </font><font style="vertical-align: inherit;">рдХрд╛ рдЖрджреЗрд╢ рджреЗрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реА рддрд░рд╣, рдЗрд╕рдореЗрдВ рдПрдХ рдмрдЪреНрдЪрд╛ рддрддреНрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЙрди рдкрд░ рд╡рд╕реНрддреБрдУрдВ рдХреА рдирд┐рдпреБрдХреНрддрд┐ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБ рдкреНрд░рдмрдВрдзрдХ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдШрдЯрдХ рдмрдирд╛рдПрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЗ рднреАрддрд░ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЦреНрдпрд╛рд▓ рд░рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрд╕реА рд╕реНрдХреАрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдЙрд╕реЗ рддрд░реАрдХреЗ рджреЗрддреЗ рд╣реИрдВ </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдХрд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╡рд┐рдзрд┐ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд┐рддрд┐ рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рд░рд┐рдХреНрдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЕрднреА рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexFeatureManager</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдРрд╕реЗ рдШрдЯрдХ рдореЗрдВ рдПрдХ рд▓рд┐рдВрдХ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЖрдк рдЗрд╕реЗ рд╕рднреА рдмрдЪреНрдЪреЗ рддрддреНрд╡реЛрдВ рдХреА рддрд░рд╣ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureManager features; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); features.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); features.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдПрдХ рд╡рд╕реНрддреБ рд░рдЦрдХрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } features.AddFeature(cell.Position); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдореИрдиреЗрдЬрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдЧреНрд░рд┐рдб рдЪрдВрдХ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░реАрдлреИрдм рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рдмрдЪреНрдЪрд╛ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдПрдХ рдШрдЯрдХ рджреЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рддрдм рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eeb/1f4/626/eeb1f462652650c6dfe5e3cb34a2ec12.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51b/7ec/8f2/51b7ec8f20b4a79589fd2b464744230b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/c6f/8cd/620c6f8cd7c54c52597fcc289b160c57.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╡рд╕реНрддреБ рдкреНрд░рдмрдВрдзрдХ рдиреЗ рдЦрдВрдб рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдЬреЛрдбрд╝рд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░реАрдлрд╝реИрдм рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдХрд┐рд╕ рднреВ-рднрд╛рдЧ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ? </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдХреНрдпреВрдм рдХрд╛рдлреА рдЙрдкрдпреБрдХреНрдд рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, (3, 3, 3) рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЗ рд╕рд╛рде рдПрдХ рдмрдбрд╝рд╛ рдкрд░реНрдпрд╛рдкреНрдд рдХреНрдпреВрдм рдмрдирд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рднреА рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рд▓рд╛рд▓ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕рдХреЗ рдХреЛрд▓рд╛рдЗрдбрд░ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7a/1b1/315/a7a1b1315e7f2756ac2940dac661f95a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдХреНрдпреВрдмред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рдмрдВрдзрдХреЛрдВ рдХреЛ рдЗрд╕ рдкреНрд░реАрдлрд╝реИрдм рдХреЗ рд▓рд┐рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдореЗрд╢рди рдХрдВрдкреЛрдиреЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рд▓рд┐рдВрдХ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform featurePrefab;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfc/34d/e84/cfc34de84fbc12ac5fde17d7d1d09b58.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлреИрдм рдХреЗ рд╕рд╛рде рдСрдмреНрдЬреЗрдХреНрдЯ рдореИрдиреЗрдЬрд░ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд░рдЪрдирд╛ рддреИрдпрд╛рд░ рд╣реИ, рдФрд░ рд╣рдо рдЗрд▓рд╛рдХреЗ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ! </font><font style="vertical-align: inherit;">рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ prefab рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдПрдБ </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd8/59c/ae5/dd859cae56fa9439e91d0ccb5d659f62.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд▓рд╛рдХреЗ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдгред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╕реЗ, рдЗрд▓рд╛рдХреЗ рдХреЛ рдШрдиреЛрдВ рд╕реЗ рднрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдХрдо рд╕реЗ рдХрдо рдХреНрдпреВрдмреНрд╕ рдХреЗ рдКрдкрд░реА рд╣рд┐рд╕реНрд╕реЗ, рдХреНрдпреЛрдВрдХрд┐ рдпреВрдирд┐рдЯреА рдореЗрдВ рдХреНрдпреВрдм рдореЗрд╖ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рдореВрд▓ рдХреНрдпреВрдм рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╣реИ, рдФрд░ рдиреАрдЪреЗ рд░рд╛рд╣рдд рдХреА рд╕рддрд╣ рдХреЗ рдиреАрдЪреЗ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдкрд░ рдХреНрдпреВрдмреНрд╕ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреА рдКрдБрдЪрд╛рдИ рд╕реЗ рдЖрдзрд╛ рдКрдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/6be/89b/bb06be89b647d5ff29f1894bfdcf199b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рдХреА рд╕рддрд╣ рдкрд░ рдХреНрдпреВрдмреНрд╕ред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рджреВрд╕рд░реА рдЬрд╛рд▓реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</font></font></b> <div class="spoiler_text">       .     ,      ,        .       . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рд╣рдорд╛рд░реА рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╡рд┐рдХреГрдд рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддреЛ рд╣рдо рд╕рд╣реА рдореЗрд╖ рджреЛрд╣рд░рд╛рд╡ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> instance.localPosition = HexMetrics.Perturb(position);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/7ec/a43/9e57eca43cf9127691cb5eb11bc6a11a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдУрдВ рдХреА рд╡рд┐рдХреГрдд рд╕реНрдерд┐рддрд┐ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рд╡рд┐рдирд╛рд╢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рднреА рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдирдИ рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдПрдВ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рд╣рдо рдПрдХ рд╣реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рд╕рд╛рдл рдХрд░рддреЗ рд╕рдордп рдкреБрд░рд╛рдиреА рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рддреЗрдЬрд╝ рддрд░реАрдХрд╛ рдПрдХ рдЧреЗрдо рдХрдВрдЯреЗрдирд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛ рдФрд░ рд╕рднреА рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЕрдкрдиреЗ рдмрдЪреНрдЪреЛрдВ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░, рдЬрдм рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдХрдВрдЯреЗрдирд░ рдХреЛ рдирд╖реНрдЯ рдХрд░ рджреЗрдВрдЧреЗ рдФрд░ рдПрдХ рдирдпрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдХрдВрдЯреЗрдирд░ рдЦреБрдж рдЙрд╕рдХреЗ рдкреНрд░рдмрдВрдзрдХ рдХрд╛ рдПрдХ рдмрдЪреНрдЪрд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> Transform container; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (container) { Destroy(container.gameObject); } container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameObject(<span class="hljs-string"><span class="hljs-string">"Features Container"</span></span>).transform; container.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрднрд╡рддрдГ, рд╣рд░ рдмрд╛рд░ рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдмрдирд╛рдирд╛ рдФрд░ рдирд╖реНрдЯ рдХрд░рдирд╛ рдЕрдХреНрд╖рдо рд╣реИред</font></font></b> <div class="spoiler_text"> , ,   .       .      .   ,  ,      ,    .          <code>HexFeatureManager.Apply</code> .      .  ,    ,       . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рд╕реНрдерд╛рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рд╣рдо рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЦрд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдкрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдкрд╛рдиреА рд╕реЗ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдЕрдЬреАрдм рд▓рдЧрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/01d/e88/ab8/01de88ab8777d38afeb4ca374571a2f1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдПрдВ рд╣рд░ рдЬрдЧрд╣ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдСрдмреНрдЬреЗрдХреНрдЯ </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЦрд╛рд▓реА </font><font style="vertical-align: inherit;">рд░рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЬрд╛рдВрдЪреЗрдВ </font><font style="vertical-align: inherit;">рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рдЦрд╛рд▓реА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell.Position); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5db/b98/75f/5dbb9875f8510c7f9224f8ba10465ae4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд┐рдд рдЖрд╡рд╛рд╕ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╡рд╕реНрддреБ рдкреНрд░рддрд┐ рджрд┐рд╢рд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐ рд╕реЗрд▓ рдХреЗрд╡рд▓ рдПрдХ рд╡рд╕реНрддреБ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрднреА рднреА рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЬрдЧрд╣ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╕реЗрд▓ рдХреЗ рдЫрд╣ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдСрдмреНрдЬреЗрдХреНрдЯ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рдд рдкреНрд░рддрд┐ рджрд┐рд╢рд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рджреВрд╕рд░реЗ рддрд░реАрдХреЗ рд╕реЗ рдХрд░реЗрдВрдЧреЗ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрдм рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓реЗрдЧрд╛ рдХрд┐ рд╕реЗрд▓ рдореЗрдВ рдХреЛрдИ рдирджреА рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЕрднреА рднреА рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИрдВ рдФрд░ рдЕрдЧрд░ рд╕реЗрд▓ рдореЗрдВ рд╕рдбрд╝рдХ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдХреЗрд╡рд▓ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдбрд╝рдХреЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithoutRiver(direction, cell, center, e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } } тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e7/b60/d4b/7e7b60d4b54d2f9a7b3119e78554507a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдИ рд╕реБрд╡рд┐рдзрд╛рдПрдВ, рд▓реЗрдХрд┐рди рдирджрд┐рдпреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдирд╣реАрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╡рд╕реНрддреБрдУрдВ рдмрдирд╛рддрд╛ рд╣реИ! </font><font style="vertical-align: inherit;">рд╡реЗ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдкрд╛рд╕ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдирджрд┐рдпреЛрдВ рд╕реЗ рдмрдЪрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЕрдВрджрд░ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>TriangulateAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕реЗ рдЬрдм рддреНрд░рд┐рдХреЛрдг рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдХреЛрдИ рд╕рдбрд╝рдХ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30c/90a/f9f/30c90af9ffb31cec360ea027fc4f1815.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд╡рд╕реНрддреБрдПрдВ рджрд┐рдЦрд╛рдИ рджреАрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЗрддрдиреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ?</font></font></b> <div class="spoiler_text">       ,    dynamic batching  Unity.    ,       .         batch.     ┬л ┬╗,       .    instancing,          dynamic batching. </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреА рд╡рд┐рд╡рд┐рдзрддрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд╕рднреА рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдореЗрдВ рд╕рдорд╛рди рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИ, рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдкреНрд░рд╛рдХреГрддрд┐рдХ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рд╣рд░ рдПрдХ рдХреЛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореЛрдбрд╝ рджреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b42/8bd/0bc/b428bd0bcb9b27676853f7bb1e491165.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рдкрд░рд┐рдгрд╛рдо рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╡рд┐рд╡рд┐рдз рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд╣рд░ рдмрд╛рд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдЕрдкрдбреЗрдЯ рд╣реЛрдиреЗ рдкрд░, рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдПрдХ рдирдпрд╛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реЛрдЯреЗрд╢рди рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкрдбрд╝реЛрд╕ рдореЗрдВ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдирд╣реАрдВ рдмрджрд▓рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рд╣реИ рдЬреЛ рд╣рдореЗрд╢рд╛ рд╕рдорд╛рди рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкрд░реНрд▓рд┐рди рдврд╛рд▓ рдХрд╛ рд╢реЛрд░ рд╣реИ, рдФрд░ рдпрд╣ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕реБрд╕рдВрдЧрдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдареАрдХ рд╡реИрд╕рд╛ рд╣реА рд╣реИ, рдЬреИрд╕рд╛ рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╕рдордп рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдШреБрдорд╛рд╡реЛрдВ рдХреЛ рд▓рдЧрд╛рддрд╛рд░ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╕рднреА рдореЛрдбрд╝ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рдФрд░ рдорд┐рд╢реНрд░рд┐рдд рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЧреИрд░-рдЧреНрд░реЗрдбрд┐рдПрдВрдЯ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ рдмрд┐рд▓рд┐рдирд┐рдпрд░ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рдмрд┐рдирд╛ рдирдореВрдирд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ, рдпрд╣ рдПрдХ рд╣реИрд╢ рдЧреНрд░рд┐рдб рд╣реИ рдЬреЛ рдврд╛рд▓ рд╢реЛрд░ рдХрд╛ рдЖрдзрд╛рд░ рдмрдирддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИрд╢ рдЯреЗрдмрд▓ рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдлреНрд▓реЛрдЯ рдорд╛рдиреЛрдВ рдХреА рдПрдХ рд╕рд░рдгреА рд╕реЗ рдПрдХ рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╛рд░ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкрд░реНрдпрд╛рдкреНрдд рднрд┐рдиреНрдирддрд╛ рдХреЗ рд▓рд┐рдП 256 рд╕реЗ 256 рдХрд╛ рдЖрдХрд╛рд░ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hashGridSize = <span class="hljs-number"><span class="hljs-number">256</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдорд╛рди рдПрдХ рдЧрдгрд┐рддреАрдп рд╕реВрддреНрд░ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдореЗрд╢рд╛ рд╕рдорд╛рди рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдЕрдиреБрдХреНрд░рдо рдмреАрдЬ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдордп рдХреЗ рд╡рд░реНрддрдорд╛рди рдореВрд▓реНрдп рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЦреЗрд▓ рд╕рддреНрд░ рдореЗрдВ рд╣рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╣рдореЗрд╢рд╛ рд╕рдорд╛рди рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдП, рд╣рдореЗрдВ рдмреАрдЬ рд╡рд┐рдзрд┐ рдХреЛ рдЖрд░рдВрднреАрдХрд░рдг рд╡рд┐рдзрд┐ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдордиреЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреА рдзрд╛рд░рд╛ рдХреЛ рдЖрд░рдВрдн рдХрд░ рджрд┐рдпрд╛ рд╣реИ, рддреЛ рд╣рдо рд╣рдореЗрд╢рд╛ рдЙрд╕реА рдХреНрд░рдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдирдХреНрд╢реЗ рдХреА рдкреАрдврд╝реА рдХреЗ рдмрд╛рдж рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдШрдЯрдирд╛рдПрдВ рднреА рд╣рдореЗрд╢рд╛ рд╕рдорд╛рди рд░рд╣реЗрдВрдЧреАред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛ рдЬрдирд░реЗрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдХреЗ рдЗрд╕рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХрд╛рдо рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрд╕рд╕реЗ рдкреБрд░рд╛рдиреА рд╕реНрдерд┐рддрд┐ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } Random.state = currentState;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрд╢ рдЯреЗрдмрд▓ рдХреЛ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рд╕рдордп </font><font style="vertical-align: inherit;">рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рд╡рд╣ рд╢реЛрд░ рдмреБрдирд╛рд╡рдЯ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╣ рд╣реИ, рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ </font></font><code>HexGrid.Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>HexGrid.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдЙрддреНрдкрдиреНрди рди рдХрд┐рдпрд╛ рдЬрд╛рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> seed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!HexMetrics.noiseSource) { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдмреАрдЬ рдЪрд░ рд╣рдореЗрдВ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рд▓рд┐рдП рдмреАрдЬ рдорд╛рди рдЪреБрдирдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЛрдИ рднреА рдореВрд▓реНрдп рдХреНрдпрд╛ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ 1234 рдХреЛ рдЪреБрдирд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/60c/8b3/5a3/60c8b35a3b6a92b61165ed3a00473076.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреАрдЬ рдХрд╛ рдЪреБрдирд╛рд╡ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИрд╢ рдЯреЗрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдореВрдирд╛ рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬреИрд╕реЗ </font></font><code>SampleNoise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдпрд╣ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП XZ рд╕реНрдерд┐рддрд┐ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣реИрд╢ рдЗрдВрдбреЗрдХреНрд╕ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рдиреЛрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░рдХреЗ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдкреВрд░реНрдгрд╛рдВрдХ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╢реЗрд╖ рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ%?</font></font></b> <div class="spoiler_text">   ,     ,    тАФ  . ,  тИТ4, тИТ3, тИТ2, тИТ1, 0, 1, 2, 3, 4 modulo 3   тИТ1, 0, тИТ2, тИТ1, 0, 1, 2, 0, 1. </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдирдХрд╛рд░рд╛рддреНрдордХ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдХреНрдпреЛрдВрдХрд┐ рдРрд╕реА рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╢реЗрд╖ рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдирдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЗрд╕реЗ рдареАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдЧ рдЗрдХрд╛рдИ рдХреЗ рд▓рд┐рдП рд╣рдо рдЕрдкрдирд╛ рдореВрд▓реНрдп рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдЯреЗрдмрд▓ рдШрдирддреНрд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рдЕрд▓рдЧ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реНрдерд┐рддрд┐ рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЛ рдХрдо рдХрд░рдХреЗ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">4 рдмрд╛рдп 4 рд╡рд░реНрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдореВрд▓реНрдп рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hashGridScale = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.x * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.z * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рди </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдирдИ рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ </font><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд▓рд╛рдХреЗ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реНрдерд┐рд░ рд░рд╣реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hash = HexMetrics.SampleHashGrid(position); Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдХреА рд╕реАрдорд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рд╡рд╕реНрддреБрдУрдВ рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдШреБрдорд╛рд╡ рд╣реЛрддреЗ рд╣реИрдВ, рдлрд┐рд░ рднреА рдПрдХ рдкреИрдЯрд░реНрди рдЙрдирдХреЗ рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд▓ рдореЗрдВ рд╕рд╛рдд рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдпреЛрдЬрдирд╛ рдореЗрдВ рдЕрд░рд╛рдЬрдХрддрд╛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдХреБрдЫ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдХреИрд╕реЗ рддрдп рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕реА рд╡рд╕реНрддреБ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ? </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдПрдХ рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдп рдХреА рдЬрд╛рдБрдЪ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЕрдм, рдПрдХ рд╣реИрд╢ рдореВрд▓реНрдп рдХреЗ рдмрдЬрд╛рдп, рд╣рдореЗрдВ рджреЛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддрд╛рд▓рд┐рдХрд╛ рд╕рд░рдгреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд░ рдХреЗ </font><font style="vertical-align: inherit;">рдмрдЬрд╛рдп рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдирдХрд╛ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font></font><code>Vector2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡реЗрдХреНрдЯрд░ рдСрдкрд░реЗрд╢рди рд╣реИрд╢ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдЗрдП рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдХреЗрд╡рд▓ рджреЛ рдлреНрд▓реЛрдЯ рдорд╛рдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдпреЛрдВ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдереИрддрд┐рдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexHash { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; } }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЗрд╕реЗ рдХреНрд░рдордмрджреНрдз рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ?</font></font></b> <div class="spoiler_text">        ,  ,        Unity. ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдирдИ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HexHash[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexHash[hashGridSize * hashGridSize]; Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = HexHash.Create(); } Random.state = currentState; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рд╣реИрд╢ рдореВрд▓реНрдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд┐рд╕реА рд╡рд╕реНрддреБ рдХреЛ рдЬреЛрдбрд╝рдиреЗ, рдпрд╛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдорд╛рди 0.5 рдХреЗ рдмрд░рд╛рдмрд░ рдпрд╛ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рдЫреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдкрд░, рд╣рдореЗрдВ рд▓рдЧрднрдЧ рдЖрдзреА рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдорд┐рд▓ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рджреВрд╕рд░реЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.b, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e89/e69/761/e89e697613f8eef3d149b07720e8a26a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдШрдирддреНрд╡ 50% рддрдХ рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЦреАрдВрдЪрдирд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд░ рдЬрдЧрд╣ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЙрдиреНрд╣реЗрдВ рд╕рдВрдкрд╛рджрди рдпреЛрдЧреНрдп рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдо рдЕрд▓рдЧ-рдЕрд▓рдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдирд╣реАрдВ рдЦреАрдВрдЪреЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд▓ рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд╕реНрддрд░ рдХреЛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реНрддрд░ рд╕реЗрд▓ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдорд╛рди рд╢реВрдиреНрдп рд╣реИ, рдЕрд░реНрдерд╛рдд, рдСрдмреНрдЬреЗрдХреНрдЯ рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реЛрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдЗрд▓рд╛рдХреЗ рдкрд░ рд▓рд╛рд▓ рдХреНрдпреВрдмреНрд╕ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд╡рд╕реНрддреБрдУрдВ рдХреА рддрд░рд╣ рдирд╣реАрдВ рджрд┐рдЦрддреЗ рд╣реИрдВ, рдЪрд▓реЛ рдЙрдиреНрд╣реЗрдВ рдЗрдорд╛рд░рддреЗрдВ рдХрд╣рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рд╢рд╣рд░реАрдХрд░рдг рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЖрдЗрдП </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг </font><font style="vertical-align: inherit;">рдХреЗ </font><font style="vertical-align: inherit;">рд╕реНрддрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UrbanLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (urbanLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { urbanLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреЗ рд╕реЗрд▓ рдХреЗ рд▓рд┐рдП рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рдХреЛ рд╢реВрдиреНрдп рдХреЗ рдмрд░рд╛рдмрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рд╣рдо рд╡реИрд╕реЗ рднреА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рд╢рд╛рдпрдж рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░ рд╣рдо рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рдЬрд▓ рдирд┐рдХрд╛рдпреЛрдВ, рдЬреИрд╕реЗ рдбреЙрдХ рдФрд░ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдШрдирддреНрд╡ рд╕реНрд▓рд╛рдЗрдбрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд░реНрдерди </font><font style="vertical-align: inherit;">рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рд╕реНрд▓рд╛рдЗрдбрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel; тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyUrbanLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeUrbanLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } тАж } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI рдореЗрдВ рдПрдХ рдФрд░ рд╕реНрд▓рд╛рдЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреБрдХреНрдд рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рд╕реНрдХреНрд░реАрди рдХреЗ рджрд╛рдИрдВ рдУрд░ рдПрдХ рдирдпрд╛ рдкреИрдирд▓ рд▓рдЧрд╛рдКрдВрдЧрд╛ рддрд╛рдХрд┐ рдмрд╛рдПрдВ рдкреИрдирд▓ рдХреЛ рдУрд╡рд░рдлреНрд▓реЛ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХрд┐рддрдиреЗ рд╕реНрддрд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рд╢реВрдиреНрдп, рдХрдо, рдордзреНрдпрдо рдФрд░ рдЙрдЪреНрдЪ рдШрдирддреНрд╡ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реБрдП рдЪрд╛рд░ рдкрд░ рд░рд╣рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02f/e64/996/02fe649968954603df834d2a3b5f633b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95e/9e4/6f5/95e9e46f5ff83a9b7d713e85db86d67a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рд╕реНрд▓рд╛рдЗрдбрд░ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдереНрд░реЗрд╢реЛрд▓реНрдб рдкрд░рд┐рд╡рд░реНрддрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╢рд╣рд░реАрдХрд░рдг рдХрд╛ рд╕реНрддрд░ рд╣реИ, рд╣рдореЗрдВ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдФрд░ рдХрджрдо рдЙрдард╛рдПрдВ рдФрд░ рд╕реЗрд▓ рдХреЛ рд╣реА рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рддреЗрдЬрд╝ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕реЗ 0.25 рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд▓рдВрдШрди рдХреЗ рд▓рд┐рдП рдирдП рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рд╡рд╕реНрддреБ рдХреЗ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдХреЗ рд╕рд╛рде 25% рдмрдврд╝ рдЬрд╛рдПрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= cell.UrbanLevel * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рдо рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } тАж } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd8/7e9/de5/fd87e9de5b6b6ea4b4b490549ae5cbf5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рдШрдирддреНрд╡ рд╕реНрддрд░ рдЦреАрдВрдЪрдирд╛ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдХрдИ prefabs </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реА рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдореЗрдВ рдЕрдВрддрд░ рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рдирд┐рдореНрди рдФрд░ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреЗ рдмреАрдЪ рд╕реНрдкрд╖реНрдЯ рдЕрд▓рдЧрд╛рд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред рдХреБрдЫ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ, рдЗрдорд╛рд░рддреЛрдВ рдХреА рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рдпрд╛ рдХрдо рд╣реЛрдЧреАред рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░реАрдлреИрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдВрддрд░ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЦреЗрддреЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ </font></font><code>featurePrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ prefabs рд╢рд╣рд░реАрдХрд░рдг рдХреА рдПрдХ рд╕рд░рдгреА рд╕реЗ рдмрджрд▓ рджреЗрдВред рдЙрдкрдпреБрдХреНрдд рдкреНрд░реАрдлрд╝реИрдм рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рд╕реЗ рдПрдХ рдХреЛ рдШрдЯрд╛рдПрдВрдЧреЗ рдФрд░ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs">&lt;del&gt;<span class="hljs-comment"><span class="hljs-comment">// public Transform featurePrefab;&lt;/del&gt; public Transform[] urbanPrefabs; public void AddFeature (HexCell cell, Vector3 position) { тАж Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); тАж }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдкреНрд░реАрдлреИрдм рдХреЗ рджреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдмрдирд╛рдПрдВ, рдирд╛рдо рдмрджрд▓реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрджрд▓ рджреЗрдВ рддрд╛рдХрд┐ рд╡реЗ рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрддрд░реЛрдВ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдВред </font><font style="vertical-align: inherit;">рд╕реНрддрд░ 1 рдПрдХ рдХрдо рдШрдирддреНрд╡ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдПрдХ рдЭреЛрдВрдкрдбрд╝реА рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реБрдП, рдПрдХ рдХрд┐рдирд╛рд░реЗ рдХреА рдЗрдХрд╛рдИ рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рде рдПрдХ рдШрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рд▓реЗрд╡рд▓ 2 рдкреНрд░реАрдлреИрдм рдХреЛ 1.5 (1.5, 2, 1.5) рд╕реНрдХреЗрд▓ рдХрд░ рджреВрдВрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рджреЛ рдордВрдЬрд┐рд▓рд╛ рдЗрдорд╛рд░рдд рдЬреИрд╕рд╛ рд▓рдЧреЗред </font><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА 3 рдЗрдорд╛рд░рддреЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рд╕реНрдХреЗрд▓ (2, 5, 2) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b83/4ad/cb6/b834adcb61a34d1e30cdec28925f066f.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4f/41d/552/d4f41d5529d4716924345520ffc36280.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдкреНрд░реАрдлреИрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░реАрдлрд╝реИрдм рдорд┐рдХреНрд╕ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЦреБрдж рдХреЛ рдЗрдорд╛рд░рддреЛрдВ рдХреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рдЦреНрдд рдЕрд▓рдЧрд╛рд╡ рддрдХ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЖрдк рдЙрдиреНрд╣реЗрдВ рдереЛрдбрд╝рд╛ рдорд┐рд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред рдкреНрд░рддрд┐ рд╕реНрддрд░ рдПрдХ рд╕реАрдорд╛ рдХреЗ рдмрдЬрд╛рдп, рдЪрд▓реЛ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рднрд╡рди рдХреЗ рд▓рд┐рдП рддреАрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрддрд░ 1 рдкрд░ рд╣рдо 40% рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╢реЗрдХ рдХреЗ рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпрд╣рд╛рдВ рдХреЛрдИ рджреВрд╕рд░реА рдЗрдорд╛рд░рддреЗрдВ рдирд╣реАрдВ рд╣реЛрдВрдЧреАред рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рд╣рдо рддреАрди рдореВрд▓реНрдпреЛрдВ (0.4, 0, 0) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрддрд░ 2 рдкрд░, рдмрдбрд╝реЗ рднрд╡рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЭрдЯрдХреЛрдВ рдХреЛ рдмрджрд▓реЗрдВ, рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЭрдЯрдХреЛрдВ рдХреЗ рд▓рд┐рдП 20% рдореМрдХрд╛ рдЬреЛрдбрд╝реЗрдВред рд╣рдо рдКрдВрдЪреА рдЗрдорд╛рд░рддреЗрдВ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред рдпрд╣реА рд╣реИ, рд╣рдо рддреАрди рдореВрд▓реНрдпреЛрдВ (0.2, 0.4, 0) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрддрд░ 3 рдкрд░, рд╣рдо рдордзреНрдпрдо рдЗрдорд╛рд░рддреЛрдВ рдХреЛ рд▓рдВрдмреЗ рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ, рд╢реЗрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ, рдФрд░ рд╢реЗрдХ рдХрд╛ рдПрдХ рдФрд░ 20% рдореМрдХрд╛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред рджрд╣рд▓реАрдЬ рдорд╛рди (0.2, 0.2, 0.4) рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╢рд╣рд░реАрдХрд░рдг рдХреЗ рд╕реНрддрд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рде, рд╣рдо рдореМрдЬреВрджрд╛ рдЗрдорд╛рд░рддреЛрдВ рдХреЛ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЦрд╛рд▓реА рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдирдП рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред рдореМрдЬреВрджрд╛ рдЗрдорд╛рд░рдд рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрд╕реА рд╣реИрд╢ рдорд╛рди рдЕрдВрддрд░рд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдпрджрд┐ рд╕реНрддрд░ 1 рдкрд░ 0 рдФрд░ 0.4 рдХреЗ рдмреАрдЪ рдХреЗ рд╣реИрд╢ рд╢реЗрдХ рдереЗ, рддреЛ рд╕реНрддрд░ 3 рдкрд░ рд╕рдорд╛рди рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рдКрдВрдЪреА рдЗрдорд╛рд░рддреЗрдВ рдмрди рдЬрд╛рдПрдВрдЧреАред рд╕реНрддрд░ 3 рдкрд░, рдКрдБрдЪреА рдЗрдорд╛рд░рддреЛрдВ рдХреЛ 0-0.4 рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, 0.4-0.6 рдХреА рд╕реАрдорд╛ рдореЗрдВ рджреЛ рдордВрдЬрд┐рд▓рд╛ рдЗрдорд╛рд░рддреЗрдВ рдФрд░ 0.6-0.8 рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣рд┐рд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рд╕реЗ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рддрдХ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб (0.4, 0.6, 0.8) рдХреЗ рдЯреНрд░рд┐рдкрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд▓реЗрд╡рд▓ 2 рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рддрдм рдмрдиреЗрдВрдЧреЗ (0, 0.4, 0.6), рдФрд░ рд▓реЗрд╡рд▓ 1 рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб (0, 0, 0.4) рдмрди рдЬрд╛рдПрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрди рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдХреЛ рдмрдЪрд╛рддреЗ рд╣реИрдВ</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рд╕рдВрдЧреНрд░рд╣ рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛ рдЖрдкрдХреЛ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рд╕реНрддрд░реЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рд╣рдо рд╕реНрддрд░ 0 рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[][] featureThresholds = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>} }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFeatureThresholds</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> featureThresholds[level]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реЗрдм рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрд╢ рд╕реНрддрд░ рдФрд░ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рд╡рд╛рд▓реА </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реНрддрд░ рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рд╣рдо рдПрдХ рдХреЗ рдмрд╛рдж рдПрдХ рд╕реНрддрд░ рдХрдо рдХрд░рдХреЗ рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рддрдм рд╣рдо рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрдХреНрд░ рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╣реИрд╢ рдорд╛рди рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдордиреЗ рдПрдХ рдкреНрд░реАрдлреИрдм рдкрд╛рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдЧрд░ рд╣рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рд╛, рддреЛ рдЕрд╢рдХреНрдд рд▓реМрдЯ рдЖрдУред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдкреНрд░реАрдлреИрдм рдХреЗ рд▓рд┐рдВрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рд╡реЗ рдЙрдЪреНрдЪ рд╕реЗ рдирд┐рдореНрди рдШрдирддреНрд╡ рдкрд░ рдЬрд╛рдПрдВред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/eb5/80e/4dceb580e2410400a003b2ecad72d5c5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реНрд╡рдирд┐рд░реНрдорд┐рдд рдЖрджреЗрд╢ рдЙрд▓рдЯрд╛ред </font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрдкрдиреА рдирдИ рдкрджреНрдзрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдПрдВ рдФрд░ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рдЬрд╛рд░реА рд░рдЦреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-comment"><span class="hljs-comment">// if (hash.a &gt;= cell.UrbanLevel * 0.25f) { // return; // } // Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a); if (!prefab) { return; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * 0.5f; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(0f, 360f * hash.b, 0f); instance.SetParent(container, false); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d33/6f0/fcb/d336f0fcbf85285b38bb9c3de27ad77f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдмреНрд╕ рдХреЛ рдорд┐рд▓рд╛рдПрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрддрд░ рднрд┐рдиреНрдирддрд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдорд┐рд╢реНрд░рд┐рдд рдЗрдорд╛рд░рддреЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдХреЗрд╡рд▓ рддреАрди рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╢рд╣рд░реАрдХрд░рдг рдШрдирддреНрд╡ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдкрд░ рдкреНрд░реАрдлреИрдмреНрд╕ рдХреЗ рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╣рдо рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдХреЛ рдФрд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдирдП рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рддреАрд╕рд░рд╛ рд╕реА рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ </font></font><code>HexFeatureManager.urbanPrefabs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд░рдгреА рдХреЗ рдПрдХ рд╕рд░рдгреА рдореЗрдВ </font><font style="vertical-align: inherit;">рдмрджрд▓ рджреЗрдВ </font><font style="vertical-align: inherit;">, рдФрд░ рд╡рд┐рдзрд┐ рдореЗрдВ рдПрдХ </font></font><code>PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрд░рд╛рдореАрдЯрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>choice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рд░рдгреА рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдЗрд╕ рд╕рд░рдгреА рдХреА рд▓рдВрдмрд╛рдИ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдкреВрд░реНрдгрд╛рдВрдХ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[][] urbanPrefabs; тАж <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i][(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * urbanPrefabs[i].Length)]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рджреВрд╕рд░реА рд╣реИрд╢ (рдмреА) рдХреЗ рдореВрд▓реНрдп рдкрд░ рд╣рдорд╛рд░реА рдкрд╕рдВрдж рдХреЛ рд╕рд╣реА рдард╣рд░рд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЖрдкрдХреЛ B рд╕реЗ C рдХреА рдУрд░ рдореБрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a, hash.b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.c, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рд░реА рд░рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ </font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рдХрд╛ рдорд╛рди </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ </font><font style="vertical-align: inherit;">рд▓реМрдЯрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рд╕рд░рдгреА рд╕реВрдЪрдХрд╛рдВрдХ рдкрд░реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рд╣реИрд╢ рд╡реИрд▓реНрдпреВрдЬрд╝ рдХреЛ рдереЛрдбрд╝рд╛ рдмрдврд╝рд╛рдПрдБред </font><font style="vertical-align: inherit;">рд╣рдо рдмрд╕ рдЙрди рд╕рднреА рдХреЛ рдорд╛рдкрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рдиреЗ рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рд░рдгреА рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЙрдиреНрд╣реЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реАрдорд╛ рдХреЗ рдЖрд╕-рдкрд╛рд╕ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдХреНрд░рдордмрджреНрдз рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рд░рдгреА рдХреЛ рдПрдирдХреИрдкреНрд╕реБрд▓реЗрдЯ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЙрд╕реЗ рдПрдХ рд╡рд┐рдзрд┐ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рдкрд╕рдВрдж рд╕реЗ рд╕рд░рдгреА рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рдХрдирд╡рд░реНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдкреНрд░реАрдлреИрдм рд▓реМрдЯрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexFeatureCollection { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] prefabs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pick</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefabs[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * prefabs.Length)]; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕реЗ рд╕рдВрдЧреНрд░рд╣ рдХреА рдПрдХ рд╕рд░рдгреА рдореЗрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рд╕реНрдерд╛рди рдкрд░ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public Transform[][] urbanPrefabs; public HexFeatureCollection[] urbanCollections; тАж Transform PickPrefab (int level, float hash, float choice) { if (level &gt; 0) { float[] thresholds = HexMetrics.GetFeatureThresholds(level - 1); for (int i = 0; i &lt; thresholds.Length; i++) { if (hash &lt; thresholds[i]) { return urbanCollections[i].Pick(choice); } } } return null; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдШрдирддреНрд╡ рд╕реНрддрд░ рддрдХ рдХрдИ рдЗрдорд╛рд░рддреЛрдВ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡реЗ рд╕реНрд╡рддрдВрддреНрд░ рд╣реИрдВ, рд╣рдореЗрдВ рдкреНрд░рддрд┐ рд╕реНрддрд░ рд╕рдорд╛рди рд░рд╛рд╢рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдкреНрд░рддрд┐ рд╕реНрддрд░ рджреЛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рдВрдмрд╛ рдирд┐рдЪрд▓рд╛ рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЙрдирдХреЗ рд▓рд┐рдП рддрд░рд╛рдЬреВ (3.5, 3, 2), (2.75, 1.5, 1.5) рдФрд░ (1.75, 1, 1) рдЪреБрдирд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b71/a6e/c9f/b71a6ec9f2c379c223e007dda071c94b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a72/618/81d/a7261881d23703b54aaf22ba59942d2a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрдирддреНрд╡ рд╕реНрддрд░ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреА рдЗрдорд╛рд░рддреЗрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдПрдБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореМрдЬреВрджрд╛ рдпреЛрдЬрдирд╛ рдореЗрдВ, рд╣рдо рдХрд╛рдлреА рдпреЛрдЧреНрдп рд╢рд╣рд░реА рд╕рдВрд░рдЪрдирд╛рдПрдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд░рд╛рд╣рдд рдореЗрдВ рдХреЗрд╡рд▓ рдЗрдорд╛рд░рддреЗрдВ рд╣реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЦреЗрддреЛрдВ рдпрд╛ рдкреМрдзреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреИрд╕реЗ? </font><font style="vertical-align: inherit;">рдЖрдЗрдП </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрддрд░реЛрдВ рдФрд░ рдЙрдирдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡реЗ рдкрд░рд╕реНрдкрд░ рдЕрдирдиреНрдп рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдорд┐рд╢реНрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> FarmLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> farmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (farmLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { farmLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PlantLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> plantLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (plantLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { plantLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel, farmLevel, plantLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЗрд╕рдХреЗ рд▓рд┐рдП </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрд▓рд╛рдЗрдбрд░реНрд╕ </font><font style="vertical-align: inherit;">рдореЗрдВ рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyFarmLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeFarmLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyPlantLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activePlantLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyFarmLevel) { cell.FarmLevel = activeFarmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyPlantLevel) { cell.PlantLevel = activePlantLevel; } тАж } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдиреНрд╣реЗрдВ UI рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/956/70b/f35/95670bf35594faa69fe46201b78080f7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреАрди рд╕реНрд▓рд╛рдЗрдбрд░реНрд╕ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рде рд╣реА, рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрдЧреНрд░рд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureCollection[] urbanCollections, farmCollections, plantCollections;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/001/cec/f5d001cecb2bee3c60a0dad637de7dc9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЗ рддреАрди рд╕рдВрдЧреНрд░рд╣ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореИрдВрдиреЗ рдЦреЗрддреЛрдВ рдФрд░ рдкреМрдзреЛрдВ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рджреЛ рдкреНрд░реАрдлреИрдм рдкреНрд░рддрд┐ рдШрдирддреНрд╡ рд╕реНрддрд░, рд╕рд╛рде рд╣реА рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ред рдЙрди рд╕рднреА рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдХреНрдпреВрдмреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред рдЦреЗрддреЛрдВ рдореЗрдВ рд╣рд▓реНрдХреЗ рд╣рд░реЗ рд░рдВрдЧ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрддреА рд╣реИ, рдкреМрдзреЛрдВ рдореЗрдВ рдЧрд╣рд░реЗ рд╣рд░реЗ рд░рдВрдЧ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдХреГрд╖рд┐ рднреВрдорд┐ рдХреЗ рд╡рд░реНрдЧ рдЖрд╡рдВрдЯрди рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 0.1 рдЗрдХрд╛рдЗрдпреЛрдВ рдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рдЦреЗрдд рдХреНрдпреВрдмреНрд╕ рдмрдирд╛рдПред рдЙрдЪреНрдЪ рдШрдирддреНрд╡ рд╡рд╛рд▓реЗ рддрд░рд╛рдЬреВ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВрдиреЗ (2.5, 0.1, 2.5) рдФрд░ (3.5, 0.1, 2) рдХреЛ рдЪреБрдирд╛ред рдФрд╕рддрди, рд╕рд╛рдЗрдЯреЛрдВ рдХрд╛ рдХреНрд╖реЗрддреНрд░рдлрд▓ 1.75 рдФрд░ 2.5 рдХрд╛ рдЖрдХрд╛рд░ 1.25 рд╣реЛрддрд╛ рд╣реИред рдШрдирддреНрд╡ рдХрд╛ рдирд┐рдореНрди рд╕реНрддрд░ 1 рдХреЗ рдХреНрд╖реЗрддреНрд░ рдФрд░ 1.5 рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде 0.75 рддрдХ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлреИрдм рдкреМрдзреЗ рд▓рдВрдмреЗ рдкреЗрдбрд╝реЛрдВ рдФрд░ рдмрдбрд╝реЗ рдЭрд╛рдбрд╝рд┐рдпреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред рдЙрдЪреНрдЪ рдШрдирддреНрд╡ рдкреНрд░реАрдлреИрдм рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рд╣реИрдВ, (1.25, 4.5, 1.25) рдФрд░ (1.5, 3, 1.5)ред рдФрд╕рдд рддрд░рд╛рдЬреВ (0.75, 3, 0.75) рдФрд░ (1, 1.5, 1) рд╣реИрдВред рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рдкреМрдзреЛрдВ рдХрд╛ рдЖрдХрд╛рд░ (0.5, 1.5, 0.5) рдФрд░ (0.75, 1, 0.75) рд╣реЛрддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдЪрдпрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ рд╣реИрд╢ рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдирд┐рд░реНрдорд╛рдг рдкреИрдЯрд░реНрди рд╣реЛрдВ рдФрд░ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдорд┐рд▓рд╛ рд╕рдХреЗрдВред </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╛рди </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c, d, e; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.d = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.e = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдкрдХреЛ </font></font><code>HexFeatureManager.PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рднрд┐рдиреНрди рд╕рдВрдЧреНрд░рд╣реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЪрдпрдирд┐рдд рдкреНрд░реАрдлрд╝реИрдм рдХреЗ рд╡реЗрд░рд┐рдПрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╣реИрд╢ рдХреЛ рдбреА рдореЗрдВ рдмрджрд▓реЗрдВ, рдФрд░ рдИ рдХреЛ рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рд╣реИрд╢ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexFeatureCollection[] collection, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collection[i].Pick(choice); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); тАж instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдореЗрдВ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлреИрдм рд╢рд╣рд░реАрдХрд░рдг рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рд╣рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЦреЗрддреЛрдВ рд╕реЗ рдПрдХ рдФрд░ рдкреНрд░реАрдлрд╝реИрдм рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣реИрд╢ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ, рдмреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рд╡рд┐рдХрд▓реНрдк рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдлрд┐рд░ рд╕реЗ рдбреА рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣рдо рдХрд┐рд╕ рддрд░рд╣ рдХреЗ рдкреНрд░реАрдлреИрдм рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрдВрдЧреЗ? </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╢реВрдиреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд╕рдВрдж рд╕реНрдкрд╖реНрдЯ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рджреЛрдиреЛрдВ рдореМрдЬреВрдж рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рд╕рдмрд╕реЗ рдХрдо рд╣реИрд╢ рдорд╛рди рдХреЗ рд╕рд╛рде рдкреНрд░реАрдлрд╝реИрдм рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/baf/369/d71/baf369d71420a1ded309880b38d94c53.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реА рдФрд░ рдЧреНрд░рд╛рдореАрдг рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдорд┐рд╢реНрд░рдгред </font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, рд╕реА рд╣реИрд╢ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкреМрдзреЛрдВ рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рд╣реА рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдХреЗрд╡рд▓ рдХреЛрдб рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рд╢рд╣рд░реА рд╡рд╕реНрддреБ рдХреЗ рдмрдЬрд╛рдп рдЧреНрд░рд╛рдореАрдг рдЪреБрдирддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдкреМрдзреЛрдВ рдХреЗ рд╣реИрд╢ рдХреА рддреБрд▓рдирд╛ рдЦреЗрддреЛрдВ рдХреЗ рд╣реИрд╢ рд╕реЗ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рди рдХрд┐ рд╢рд╣рд░реА рд╕реЗред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрд╕ рд╣реИрд╢ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдЪреБрдирдиреЗ рдФрд░ рдЙрд╕рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> usedHash = hash.a; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; usedHash = hash.b; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; usedHash = hash.b; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; usedHash) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/2e2/215/8eb2e2215e6219b08e8bc42612b31493.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╣рд░реА, рдЧреНрд░рд╛рдореАрдг рдФрд░ рдкреМрдзреЛрдВ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдорд┐рд╢реНрд░рдгред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 10: рджреАрд╡рд╛рд░реЗрдВ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдШреЗрд░ рд▓реЗрддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рджреАрд╡рд╛рд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдиреЗ рджреЛ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рд╕реЗ рдмрдЪреЗрдВ рдФрд░ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗрдВред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рджреАрд╡рд╛рд░ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/924/d07/0cd/924d070cd67c3baccf02a0284ef9cdc4.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪреА рджреАрд╡рд╛рд░ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рд▓реБрднрд╛рд╡рдирд╛ рдХреБрдЫ рдирд╣реАрдВ рд╣реИред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░ рдХрд╛ рд╕рдВрдкрд╛рджрди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХрд╣рд╛рдВ рд░рдЦрд╛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдбрд╛рд▓ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╡рд╕реНрддреБрдПрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдордзреНрдп рднрд╛рдЧ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдпрд╣ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдЙрдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЧреБрдЬрд░реЗрдВрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a1/bbb/c11/7a1bbbc1158301bb0091638858fa79fd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЗрдВ рдЗрд▓рд╛рдХреЗ рдХреА рд╡рд╕реНрддреБрдПрдВ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдмрдбрд╝реА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рд╡рд╕реНрддреБрдУрдВ рдХреА рддрд░рд╣, рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕реАрдзреЗ рд╕рдВрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЦрдВрдб рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдШреЗрд░рдиреЗ рдореЗрдВ рд▓рдЧреЗ рд░рд╣реЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░ рд╡рд╛рд▓реА рд╕рдВрдкрддреНрддрд┐ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдЬреНрдЬрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>Walled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╕реНрд╡рд┐рдЪ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рд╕рдВрдкрд╛рджрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдФрд░ рдЙрдирдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рджреЛрдиреЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Walled { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walled; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walled != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { walled = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> walled;</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдкрд╛рджрдХ рд╕реНрд╡рд┐рдЪ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдХреНрд╖реЛрдВ рдХреА "рдлрд╝реЗрдВрд╕" рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрд╡рд┐рдЪ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо </font></font><code>OptionalToggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ </font><font style="vertical-align: inherit;">рдФрд░ рдлрд╝реАрд▓реНрдб </font><font style="vertical-align: inherit;">рдФрд░ рдПрдХ рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> OptionalToggle riverMode, roadMode, walledMode; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWalledMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { walledMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рджреАрд╡рд╛рд░реЗрдВ рд╕реЗрд▓ рд╕реЗ рд╕реЗрд▓ рддрдХ рдирд╣реАрдВ рдЬрд╛рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХреЗ рдмреАрдЪ рд╣реЛрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдбреНрд░реИрдЧ рдПрдВрдб рдбреНрд░реЙрдк рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рджреАрд╡рд╛рд░ рд╕реНрд╡рд┐рдЪ рд╕рдХреНрд░рд┐рдп рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдмрд╕ рдЗрд╕ рд╕реНрд╡рд┐рдЪ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХреА рд╕рдЬреНрдЬрд┐рдд рд╕реНрдерд┐рддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.No) { cell.RemoveRoads(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walledMode != OptionalToggle.Ignore) { cell.Walled = walledMode == OptionalToggle.Yes; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag) { тАж } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо UI рд╕реНрд╡рд┐рдЪ рдХреЗ рдкрд┐рдЫрд▓реЗ рддрддреНрд╡реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ "рдмрд╛рдбрд╝" рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд╕рд╛рде UI рдкреИрдирд▓ рдореЗрдВ рдбрд╛рд▓реВрдВрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ac/f7f/0ca/0acf7f0caaaae171e31d42141fa75947.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрд╡рд┐рдЪ "рдмрд╛рдбрд╝"ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░реЗрдВ рдмрдирд╛рдирд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЖрдХреГрддрд┐ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рд╕реНрдерд┐рд░ рдЖрдХрд╛рд░ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдЙрдирдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реАрдлрд╝реИрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдЕрдиреНрдп рдЗрд▓рд╛рдХреЗ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдореЗрдВ рдПрдХ рдЬрд╛рд▓ рдмрдирд╛рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рд░рд╛рд╣рдд рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдкреНрд░реАрдлрд╝реИрдм рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдПрдХ рдФрд░ рдмрдЪреНрдЪреЗ рдХреЗ рддрддреНрд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рдмрд╛рд▓ рдЬрд╛рд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ рдФрд░ рдирдИ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдХреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреЛ </font><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛ </font><font style="vertical-align: inherit;">рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдХреЛрдиреЗ рдФрд░ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рдЪреАрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рднреА рд╡рд┐рдХрд▓реНрдкреЛрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/615/387/31d/61538731d2eed271c9348c4da2f5d844.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bf/c6e/af5/2bfc6eaf5ff31f5467ab252c00b7bcce.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╣рд╛рдпрдХ рдкреНрд░реАрдлреИрдм рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ рдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдПрдХ рд╢рд╣рд░реА рд╡рд╕реНрддреБ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХреЗ рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрдорд╛рд░рддреЛрдВ рдХреА рд▓рд╛рд▓ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░ рдкреНрд░рдмрдВрдзрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рд░рд╛рд╣рдд рдХреА рд╡рд╕реНрддреБ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдЙрдирд╕реЗ рдирд┐рдкрдЯрдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдкреНрд░рдмрдВрдзрдХ рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реЙрд▓реНрд╕</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">, рдФрд░ рдЗрд╕реЗ </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ </font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh walls; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж walls.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { walls.Apply(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/8f9/0f3/31d8f90f315c7aa43910c67aab6b73cb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реАрд░реНрд╖рд╕реНрде рдкреНрд░рдмрдВрдзрдХ рд╕реЗ рдЬреБрдбрд╝реА рд╣реБрдИ рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рджреАрд╡рд╛рд░реЗрдВ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдмрдЪреНрдЪрд╛ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП?</font></font></b> <div class="spoiler_text">       ,   .             ,    <em>Walls</em>    <em>Hex Grid Chunk</em> . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдкреНрд░рдмрдВрдзрдХ рдХреЛ рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдЗрд╕рдореЗрдВ рджреАрд╡рд╛рд░реЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╣реЛрддреА рд╣реИрдВ, рдЙрд╕реЗ рдХрд┐рдирд╛рд░реЛрдВ рдФрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рдВрдЧрдд рдХреЛрдиреЗ рдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗ рддреНрд░рд┐рднреБрдЬ рдХреЗ рд╕рдордп рдФрд░ рдЙрд╕рдХреЗ рдПрдХ рдкрдбрд╝реЛрд╕реА рдХреЗ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реЛрдЧрд╛ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рджреАрд╡рд╛рд░ рдХреЗ рдкрд╛рд╕ рдХреА рддрд░рдл рд╣реИ, рдФрд░ рджреВрд╕рд░рд╛ рд╕рдмрд╕реЗ рджреВрд░ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдирдИ рд╡рд┐рдзрд┐ рдХреЛ </font></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреНрдп рд╕рднреА рдХрдиреЗрдХреНрдЯрд┐рдВрдЧ рдХрд╛рд░реНрдп рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рдФрд░ рдХреЛрдгреАрдп рддреНрд░рд┐рдХреЛрдг рдХреЗ рд╕рдВрдХреНрд░рдордг рд╕реЗ рдкрд╣рд▓реЗ </font><font style="vertical-align: inherit;">рдХрд╣реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдкреНрд░рдмрдВрдзрдХ рдХреЛ рдЦреБрдж рдХреЗ рд▓рд┐рдП рддрдп рдХрд░рдиреЗ рджреЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рджреАрд╡рд╛рд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { тАж } features.AddWall(e1, cell, e2, neighbor); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { тАж } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рджреАрд╡рд╛рд░ рдЦрдВрдб рдмрдирд╛рдПрдБ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реА рджреАрд╡рд╛рд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрдИ рдХрд┐рдирд╛рд░реЛрдВ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдХрд┐рдирд╛рд░реЗ рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рджреАрд╡рд╛рд░ рддрддреНрд╡ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирд┐рдХрдЯ рд╕реЗрд▓ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЦрдВрдб рд░рд┐рдм рдХреЗ рдмрд╛рдИрдВ рдУрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рджрд╛рдИрдВ рдУрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛ рдПрдХ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдХреЛрдиреЛрдВ рдкрд░ рдЪрд╛рд░ рдХреЛрдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f32/2a0/d7b/f322a0d7bc325b13f65c62cfb76b2d0c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд╕ рдФрд░ рджреВрд░ рдХрд╛ рдХрд┐рдирд╛рд░рд╛ред </font></font></i> <br><br> <code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдкрд╣рд▓реЗ рдФрд░ рдЕрдВрддрд┐рдо рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдХреЗрд╡рд▓ рддрднреА рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдлрд╝реЗрдВрд╕рд┐рдб рд╕реЗрд▓ рдФрд░ рдПрдХ рдиреЙрди-рдлрд╝реЗрдВрд╕ рд╕реЗрд▓ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдз рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рдХрд┐ рдХреМрди рд╕реА рдХреЛрд╢рд┐рдХрд╛ рдЕрдВрджрд░ рд╣реИ рдФрд░ рдЬреЛ рдмрд╛рд╣рд░ рд╣реИ, рдХреЗрд╡рд▓ рдЙрдирдХреЗ рд░рд╛рдЬреНрдпреЛрдВ рдореЗрдВ рдЕрдВрддрд░ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v5, far.v5); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕реЗрдЧрдореЗрдВрдЯ рдПрдХ рдХреНрд╡рд╛рдб рд╣реИ, рдЬреЛ рд░рд┐рдм рдХреЗ рдмреАрдЪ рдореЗрдВ рдЦрдбрд╝рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХреА рдирд┐рдЪрд▓реА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВрдЧреЗ, рдЬреЛ рдмреАрдЪ рд╕реЗ рд╕рдмрд╕реЗ рджреВрд░ рдХреА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХрд┐рддрдиреА рд▓рдВрдмреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП? </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрд╕рдХреА рдКрдВрдЪрд╛рдИ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕реЗрд▓ рдКрдВрдЪрд╛рдИ рдХреЗ рд╕реНрддрд░ рдХрд╛ рдЖрдХрд╛рд░ рджрд┐рдпрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">3f</span></span>;</code> </pre> <br> <code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдКрдБрдЪрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрд╡рд╛рдб рдХреЗ рддреАрд╕рд░реЗ рдФрд░ рдЪреМрдереЗ рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕реЗ рдореЗрд╖ рдореЗрдВ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>walls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 v1, v2, v3, v4; v1 = v3 = left; v2 = v4 = right; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреНрд╡рд╛рдб рд╕реНрдЯреНрд░рд┐рдк рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдПрдХ рд╕рддрдд рджреАрд╡рд╛рд░ рдирд╣реАрдВ рджреЗрдЦреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдХреНрд╡рд╛рдб рдХреЗрд╡рд▓ рдПрдХ рддрд░рдл рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЪреЗрд╣рд░рд╛ рдЙрд╕ рд╕реЗрд▓ рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рд╕реЗ рдЗрд╕реЗ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5a/2f0/442/e5a2f0442a2d1812b73dd2977d80d565.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рддрд░рдлрд╛ рдХреНрд╡рд╛рдб-рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреВрд╕рд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рдордирд╛ рдХрд░ рд░рд╣реЗ рдПрдХ рджреВрд╕рд░реЗ рдХреНрд╡рд╛рдб рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> walls.AddQuad(v1, v2, v3, v4); walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/302/e53/129/302e53129e87c3432848772688e9d896.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреНрд╡рд┐рдкрдХреНрд╖реАрдп рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╕рднреА рджреАрд╡рд╛рд░реЗрдВ рдЕрдкрдиреА рд╕рдВрдкреВрд░реНрдгрддрд╛ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣реА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЛрдиреЛрдВ рдореЗрдВ рдЕрднреА рднреА рдЫреЗрдж рд╣реИрдВ рдЬрд╣рд╛рдВ рддреАрди рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдорд┐рд▓рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рдмрд╛рдж рдореЗрдВ рднрд░реЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЛрдЯреА рджреАрд╡рд╛рд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рджреАрд╡рд╛рд░реЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рджреЛрдиреЛрдВ рддрд░рдл рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХреА рдХреЛрдИ рдореЛрдЯрд╛рдИ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рджреАрд╡рд╛рд░реЗрдВ рдкрддрд▓реА рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд╛рдЧрдЬ, рдФрд░ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдХреЛрдг рдкрд░ рд▓рдЧрднрдЧ рдЕрджреГрд╢реНрдпред </font><font style="vertical-align: inherit;">рддреЛ рдЖрдЗрдП рдЗрдиреНрд╣реЗрдВ рдЧрд╛рдврд╝рд╛ рдХрд░рдХреЗ рдкреВрд░реА рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореЗрдВ рдЙрдирдХреА рдореЛрдЯрд╛рдИ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ 0.75 рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдореВрд▓реНрдп рдЪреБрдирд╛, рдпрд╣ рдореБрдЭреЗ рдЙрдкрдпреБрдХреНрдд рд▓рдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallThickness = <span class="hljs-number"><span class="hljs-number">0.75f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдореЛрдЯрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрдХреНрд╖реЛрдВ рдХреЛ рджреЛ рдХреНрд╡реИрдб рднрд╛рдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рдмрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдПрдХ рдкрдХреНрд╖ рдХреЛ рдкрд╛рд╕ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреА рдУрд░ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рджреВрд╕рд░реЗ рдХреЛ рджреВрд░ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреА рдУрд░ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдСрдлрд╝рд╕реЗрдЯ рд╡реЗрдХреНрдЯрд░ рдмрд░рд╛рдмрд░ рд╣реИ </font></font><code>far - near</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рджреАрд╡рд╛рд░ рдХреЗ рд╢реАрд░реНрд╖ рдХреЛ рд╕рдкрд╛рдЯ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕рдХреЗ рдШрдЯрдХ Y рдХреЛ 0. рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЗ рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рджреЛрдиреЛрдВ рдкрдХреНрд╖реЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХреА </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрдгрдирд╛ </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ рдСрдлрд╕реЗрдЯ рд╡реЗрдХреНрдЯрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallThicknessOffset</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { Vector3 offset; offset.x = far.x - near.x; offset.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; offset.z = far.z - near.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХреЛ рд░рд┐рдм рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕рд╛рде рдЖрдВрджреЛрд▓рди рдХреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреВрд░реА рдкреНрд░рддреНрдпреЗрдХ рдкрдХреНрд╖ рдХреЗ рд▓рд┐рдП рдЖрдзреА рдореЛрдЯрд╛рдИ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд╣реА рджреВрд░реА рдкрд░ рдЪрд▓реЗ рдЧрдП рд╣реИрдВ, рд╣рдо рд╕реНрдХреЗрд▓рд┐рдВрдЧ рд╕реЗ рдкрд╣рд▓реЗ рд╡рд┐рд╕реНрдерд╛рдкрди рд╡реЗрдХреНрдЯрд░ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset.normalized * (wallThickness * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдкрджреНрдзрддрд┐ </font></font><code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">quads рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡рд┐рд╕реНрдерд╛рдкрди рд╡реЗрдХреНрдЯрд░ рдирд┐рдХрдЯрддрдо рд╕реЗ рджреВрд░ рд╕реЗрд▓ рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕реЗ рдкрд╛рд╕ рдХреЗ рдХреНрд╡рд╛рдб рд╕реЗ рдШрдЯрд╛рдПрдВ рдФрд░ рджреВрд░ рддрдХ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 leftThicknessOffset = HexMetrics.WallThicknessOffset(nearLeft, farLeft); Vector3 rightThicknessOffset = HexMetrics.WallThicknessOffset(nearRight, farRight); Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df7/746/08b/df774608b2b06114b4afbc6ec2904e61.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдлрд╝рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╡рд╛рдбреНрд╕ рдЕрдм рдкрдХреНрд╖рдкрд╛рддреА рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рджреАрд╡рд╛рд░ рдХреА рдореЛрдЯрд╛рдИ рд╕рдорд╛рди рд╣реИрдВ?</font></font></b> <div class="spoiler_text">    ,      ┬л-┬╗     .      ,    .       .       ,   .    ,    .  , -      ,     .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рд╢реАрд░реНрд╖ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХреА рдореЛрдЯрд╛рдИ рдКрдкрд░ рд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рджреАрд╡рд╛рд░ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ рдХреНрд╡рд╛рдб рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рдкрд╣рд▓реЗ рдХреНрд╡рд╛рдб рдХреЗ рджреЛ рдКрдкрд░реА рдХреЛрдиреЗ рдХреЛ рдпрд╛рдж рдХрд░рдирд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рджреВрд╕рд░реЗ рдХреНрд╡рд╛рдб рдХреЗ рджреЛ рдКрдкрд░реА рдХреЛрдиреЗ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ред</font></font><br><br><pre> <code class="cs hljs"> Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3); walls.AddQuad(t1, t2, v3, v4);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/15d/627/1d715d627770a9e7a17bf135a461833d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдКрдкрд░ рд╡рд╛рд▓реА рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдиреЛрдВ рдкрд░ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЛрдиреЛрдВ рдореЗрдВ рдЫреЗрдж рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рддреНрд░рд┐рдХреЛрдгреАрдп рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдПрдХ рдЦрдВрдб рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдХреЛрдиреЗ рддреАрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдореЗрдВ рджреАрд╡рд╛рд░ рд╣реЛ рд╕рдХрддреА рд╣реИ рдпрд╛ рдирд╣реАрдВ рднреА рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЖрда рд╡рд┐рдиреНрдпрд╛рд╕ рд╕рдВрднрд╡ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed9/277/8ee/ed92778ee39106d3a448892a124d366c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдг рд╡рд┐рдиреНрдпрд╛рд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдлреЗрдВрд╕ рд╡рд╛рд▓реЗ рд░рд╛рдЬреНрдпреЛрдВ рдХреЗ рдмреАрдЪ рд░рдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рд╕рдВрдЦреНрдпрд╛ рдЫрд╣ рд╣реЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рджреАрд╡рд╛рд░реЛрдВ рдХреА рд╡рдХреНрд░ рдХреЗ рдЕрдВрджрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрд╕ рд╕реЗрд▓ рдХреЛ рдПрдХ рд╕рдВрджрд░реНрдн рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рджреАрд╡рд╛рд░ рдШреБрдорд╛рд╡рджрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реЗрд▓ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рджреАрд╡рд╛рд░ рдмрд╛рдПрдВ рд╕реЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ рдФрд░ рджрд╛рд╣рд┐рдиреА рд╕реЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48e/f68/19a/48ef6819a839339a17d1513f7ca546b5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рд░реЛрд▓реНрд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рд╣рдореЗрдВ рдПрдХ рдРрд╕реА рд╡рд┐рдзрд┐ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛрдиреЗ рдХреЗ рддреАрди рдХреЛрдиреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдо рдЗрд╕ рдЦрдВрдб рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рд╡рд┐рдзрд┐ рдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛ рд╣реИ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рд▓рдВрдЧрд░ рдмрд┐рдВрджреБ рджреЛрдиреЛрдВ рдХреЗ рдкрд╛рд╕ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреА рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдг рдХреЗ рддреАрди рдХреЛрдиреЗ рдФрд░ рдЙрдирдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рд╡рд┐рдзрд┐ рдХрд╛ рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкрджреНрдзрддрд┐ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдХреЛрдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдХрд┐ рд╕рдВрджрд░реНрдн рдмрд┐рдВрджреБ рд╣реИ, рдЕрдЧрд░ рдпрд╣ рдореМрдЬреВрдж рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЙрд╕реЗ рд╕рднреА рдЖрда рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдиреНрдпрд╛рд╕реЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдирдореЗрдВ рд╕реЗ рдЫрд╣ рдХреЛ </font><font style="vertical-align: inherit;">рдХреЙрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 c1, HexCell cell1, Vector3 c2, HexCell cell2, Vector3 c3, HexCell cell3 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell1.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдиреЗ рдХреЗ рдЦрдВрдбреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЛ рдЕрдВрдд рдореЗрдВ рдХреЙрд▓ рдХрд░реЗрдВ </font></font><code>HexGridChunk.TriangulateCorner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 bottom, HexCell bottomCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { тАж features.AddWall(bottom, bottomCell, left, leftCell, right, rightCell); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/e63/304/a8ee63304fce04d4db9dcdf46076b3a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдиреЛрдВ рдХреЗ рд╕рд╛рде рджреАрд╡рд╛рд░реЗрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рдЫреЗрдж рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЫреЗрдж рдмрдВрдж рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдореЗрдВ рдЕрднреА рднреА рдЫреЗрдж рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рджреАрд╡рд╛рд░ рдЦрдВрдбреЛрдВ рдХреА рдКрдВрдЪрд╛рдИ рдЪрд░ рд╣реИред рдЬрдмрдХрд┐ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЦрдВрдб рдирд┐рд░рдВрддрд░ рдКрдВрдЪрд╛рдИ рдХреЗ рд╣реИрдВ, рдХреЛрдиреЗ рдХреЗ рдЦрдВрдб рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рд╣реИрдВред рдЪреВрдВрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХрд┐рдирд╛рд░реЗ рдХреА рдЕрдкрдиреА рдКрдВрдЪрд╛рдИ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдХреЛрдиреЛрдВ рдкрд░ рдЫреЗрдж рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ </font><font style="vertical-align: inherit;">рдмрджрд▓ </font><font style="vertical-align: inherit;">рджреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рд╢реАрд░реНрд╖ рдХреЛрдиреЗ рдХреЗ рд╡рд╛рдИ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftTop = left.y + HexMetrics.wallHeight; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightTop = right.y + HexMetrics.wallHeight; Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9cd/f1d/a88/9cdf1da889ce427e1d519a284532d6a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд▓рдЧреНрди рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░реЗрдВ рдЕрдм рдмрдВрдж рд╣реЛ рдЧрдИ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдк рдЕрднреА рднреА рджреАрд╡рд╛рд░ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рдЫреЗрдж рджреЗрдЦрддреЗ рд╣реИрдВред рдпрд╣ </font><font style="vertical-align: inherit;">рджрд┐рд╢рд╛рддреНрдордХ рдЫрд╛рдпрд╛ рд╕реЗрдЯрд┐рдВрдЧ </font><font style="vertical-align: inherit;">рдХреЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рдЬрдм рдпрд╣ рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╕реНрддреБрдУрдВ рдХреА рддреНрд░рд┐рдХреЛрдг рд╕рддрд╣ рдкрд░ рд╕рд╛рдорд╛рдиреНрдп рдХреЗ рд╕рд╛рде рдПрдХ рдЫрд╛рдпрд╛ рдХреА рдЪрд╛рд▓ рд╣реЛрддреА рд╣реИред рдпрд╣ рдЖрддреНрдо-рдЫрд╛рдпрд╛рдВрдХрди рд╕реЗ рдмрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЫреЗрдж рдмрдирд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рддреНрд░рд┐рдХреЛрдг рдЕрд▓рдЧ-рдЕрд▓рдЧ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рджрд┐рдЦрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЫреЗрдж рдареАрдХ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рд╣рдорд╛рд░реА рджреАрд╡рд╛рд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рд╕рд╛рдорд╛рдиреНрдп рдЫрд╛рдпрд╛ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рдХрдо рдХрд░рдХреЗ рдЗрди рдЫрд╛рдпрд╛ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд╕реНрдЯ рд╢реИрдбреЛрдЬрд╝</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реЗрдВрдбрд░ рд░реЗрдВрдбрд░ рд╡реЙрд▓ </font><font style="vertical-align: inherit;">рдореЛрдб </font><font style="vertical-align: inherit;">рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреВ рд╕рд╛рдЗрдбреЗрдб рдореЗрдВ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред рдпрд╣ рдЫрд╛рдпрд╛ рдбрд╛рд▓реА рд╡рд╕реНрддреБ рдХреЛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рджреАрд╡рд╛рд░ рддреНрд░рд┐рдХреЛрдг рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдЧрд╛, рдЬреЛ рд╕рднреА рдЫреЗрджреЛрдВ рдХреЛ рдмрдВрдж рдХрд░ рджреЗрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b14/9d5/d0b/b149d5d0bb36f049faa5ca9d49261618.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЫреЗрдж рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрд▓рдИрдбреА рджреАрд╡рд╛рд░ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдорд╛рд░реА рджреАрд╡рд╛рд░реЗрдВ рдХрд╛рдлреА рд╕реАрдзреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рд╕рдкрд╛рдЯ рдЗрд▓рд╛рдХреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдмреБрд░рд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдЬреАрдм рд▓рдЧрддрд╛ рд╣реИ рдЬрдм рджреАрд╡рд╛рд░реЗрдВ рдХрдЧрд╛рд░ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рджреАрд╡рд╛рд░ рдХреЗ рд╡рд┐рдкрд░реАрдд рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдПрдХ рдКрдВрдЪрд╛рдИ рд╕реНрддрд░ рдХрд╛ рдЕрдВрддрд░ рд╣реЛрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/065/481/c1a/065481c1a0859ced22d0ae6568acbe86.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓-рдмрдЧрд▓ рдХреА рджреАрд╡рд╛рд░реЛрдВ рдкрд░ рд╕реАрдзреА рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдзрд╛рд░ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реЗ рдХрд┐рдирд╛рд░реЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЦрдВрдб рдмрдирд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдзрд╛рд░ рдкрдЯреНрдЯреА рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╣рдо </font><font style="vertical-align: inherit;">рдПрдЬ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрдЬрди рдореЗрдВ </font><font style="vertical-align: inherit;">рдЪрд╛рд░ рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a96/8aa/0f9/a968aa0f984b31e81dc9edb12e8d31bb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШреБрдорд╛рд╡рджрд╛рд░ рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЗрдВ рдЕрдм рд╡рд┐рдХреГрдд рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рджреЛрд╣рд░рд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реАрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ, рдпрд╣ рдмрд╣реБрдд рдмреЗрд╣рддрд░ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдПрдХ рдлреНрд▓реИрдЯ рд░рд╛рд╣рдд рдкрд░ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рджреАрд╡рд╛рд░реЗрдВ рдмрдирд╛рддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрдореАрди рдкрд░ рджреАрд╡рд╛рд░реЗрдВ рдЦрдбрд╝реА рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдкрд░ рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдЖрдк рдПрдХ рд╕рдорд╕реНрдпрд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рджреАрд╡рд╛рд░реЗрдВ рдЬрдореАрди рдкрд░ рд▓рдЯрдХреА рд╣реБрдИ рд╣реИрдВ! рдпрд╣ рдЭреБрдХрд╛рд╡ рдлреНрд▓реИрдЯ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдЪ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдорддреМрд░ рдкрд░ рдЗрддрдирд╛ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/8f0/a59/0398f0a59aca756824e162c3fba5a891.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╡рд╛ рдореЗрдВ рд▓рдЯрдХрддреА рд╣реБрдИ рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдХрдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдкреВрд░реА рджреАрд╡рд╛рд░ рдХреЛ рдиреАрдЪреЗ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕рдХрд╛ рд╢реАрд░реНрд╖ рд╕рдкрд╛рдЯ рд░рд╣реЗред рдЙрд╕реА рд╕рдордп, рдКрдкрд░реА рддрд░рдл рдХреА рджреАрд╡рд╛рд░ рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рд░рд╛рд╣рдд рдореЗрдВ рдереЛрдбрд╝рд╛ рдХрдо рд╣реЛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдорд╛рд░реЗ рдЕрдиреБрд░реВрдк рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕рд╛ рдкрдХреНрд╖ рдХрдо рд╣реИ - рдирд┐рдХрдЯ рдпрд╛ рджреВрд░ред рд╣рдо рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рдХрдо рдкрдХреНрд╖ рдХреА рдКрдВрдЪрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЗрддрдиреА рдХрдо рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЖрдк рдХреЗрд╡рд▓ 0.5 рд╕реЗ рдХрдо рдХреА рдСрдлрд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдХрдо рд╕реЗ рдЙрдЪреНрдЪ рддрдХ рд╡рд╛рдИ рд╕рдордиреНрд╡рдп рдХреЛ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдХреЗрд╡рд▓ рдХрднреА-рдХрднреА рдХрдЧрд╛рд░ рдХреЗ рдирд┐рдЪрд▓реЗ рдЪрд░рдг рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдПрдХ рдСрдлрд╕реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрдЧрд╛рд░ рдХреЗ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдЪрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдЧрд▓ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рдПрдХ рдЕрд▓рдЧ рджреАрд╡рд╛рд░ рдореЛрдЯрд╛рдИ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдСрдлрд╕реЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/960/61c/817/96061c817bfdc69db9682e0799ba3751.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреАрдЪреА рджреАрд╡рд╛рд░ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП </font><font style="vertical-align: inherit;">, рдЗрд╕ рдкреНрд░рдХреНрд╖реЗрдк рд╕реЗ рдирд┐рдкрдЯрдиреЗ рд╡рд╛рд▓реА </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЗ </font></font><code>WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рде, рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдХреЗ рдФрд╕рдд рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдирд┐рдХрдЯ рдФрд░ рджреВрд░ рдХреЗ рдЫреЛрд░реЛрдВ </font><font style="vertical-align: inherit;">рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╡рд┐рдзрд┐ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ </font></font><code>TerraceLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallElevationOffset = verticalTerraceStepSize; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдХреЛрдиреЗ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ </font><font style="vertical-align: inherit;">рдмрд╛рдзреНрдп </font><font style="vertical-align: inherit;">рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = HexMetrics.WallLerp(nearLeft, farLeft); Vector3 right = HexMetrics.WallLerp(nearRight, farRight); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/a4c/b49/957a4cb498eb8a712064a0b99a4041be.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдореАрди рдкрд░ рдЦрдбрд╝реА рджреАрд╡рд╛рд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░ рд╡рд┐рд░реВрдкрдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реА рджреАрд╡рд╛рд░реЗрдВ рдКрдВрдЪрд╛рдИ рдореЗрдВ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдЕрдЪреНрдЫреЗ рд╕рдордЭреМрддреЗ рдореЗрдВ рд╣реИрдВред рд▓реЗрдХрд┐рди рд╡реЗ рдЕрднреА рднреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡рд┐рдХреГрдд рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЕрдиреБрд░реВрдк рдирд╣реАрдВ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡реЗ рдЙрдирдХреЗ рдХрд░реАрдм рд╣реИрдВред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реБрдЖ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рд╢реАрд░реНрд╖ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ рдпреЗ рдХреЛрдиреЗ рдирд┐рдХрдЯ рдФрд░ рджреВрд░ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдХреЛрдиреЗ рдХреЗ рдмреАрдЪ рдХрд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХреА рд╡рд┐рдХреГрддрд┐ рдереЛрдбрд╝реА рдЕрд▓рдЧ рд╣реЛрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рджреАрд╡рд╛рд░реЗрдВ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдкрд╕рд▓рд┐рдпреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреА рд╣реИрдВ, рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рджреАрд╡рд╛рд░ рдХреЗ рд╢реАрд░реНрд╖ рдХреА рд╡рд┐рдХреГрддрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрддрд╛ рд╣реИ рдЕрдиреНрдпрдерд╛ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рдорд╛рди рдореЛрдЯрд╛рдИ рд╣реЛрддреА рд╣реИред рдпрджрд┐ рд╣рдо рд╡рд┐рдХреГрдд рдХреЛрдиреЗ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рджреАрд╡рд╛рд░реЛрдВ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ undistorted quads рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рдЙрдирдХреА рдореЛрдЯрд╛рдИ рдЕрдзрд┐рдХ рднрд┐рдиреНрди рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { nearLeft = HexMetrics.Perturb(nearLeft); farLeft = HexMetrics.Perturb(farLeft); nearRight = HexMetrics.Perturb(nearRight); farRight = HexMetrics.Perturb(farRight); тАж walls.AddQuadUnperturbed(v1, v2, v3, v4); тАж walls.AddQuadUnperturbed(v2, v1, v4, v3); walls.AddQuadUnperturbed(t1, t2, v3, v4); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b10/fa3/03d/b10fa303dc91a50665bf92b47feed5e7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдЕрд╡рд┐рд░рд▓ рд╢реАрд░реНрд╖ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рджреАрд╡рд╛рд░реЗрдВ рдЕрдм рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдмрджрд▓реЗ рдореЗрдВ рд╡реЗ рдХрдо рдЯреВрдЯ рдЬрд╛рдПрдВрдЧреЗ рдФрд░ рдЕрдзрд┐рдХ рдирд┐рд░рдВрддрд░ рдореЛрдЯрд╛рдИ рд╣реЛрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d38/7f6/b6f/d387f6b6f1c4fed424d2582a8ef5c12c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рд▓рдЧрд╛рддрд╛рд░ рджреАрд╡рд╛рд░ рдХреА рдореЛрдЯрд╛рдИред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░реЛрдВ рдореЗрдВ рдЫреЗрдж </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдордиреЗ рдПрдХ рдирджреА рдпрд╛ рд╕рдбрд╝рдХ рдХреА рджреАрд╡рд╛рд░ рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рджреАрд╡рд╛рд░ рдореЗрдВ рдПрдХ рдЫреЗрдж рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдирджреА рдпрд╛ рд╕рдбрд╝рдХ рдЧреБрдЬрд░ рд╕рдХрддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font><font style="vertical-align: inherit;">рджреЛ рдмреБрд▓рд┐рдпрди рдкреИрд░рд╛рдореАрдЯрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдирджреА рдпрд╛ рд╕рдбрд╝рдХ рдПрдХ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрднрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдЪрд▓реЛ рджреЛрдиреЛрдВ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рджреЛ рдордзреНрдп рдЦрдВрдбреЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { <span class="hljs-comment"><span class="hljs-comment">// Leave a gap. } else { AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); } AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЗрд╕реЗ </font></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЙрд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдорд╛рди рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдмреВрд▓рд┐рдпрди рдЪрд░ рдореЗрдВ рдХреИрд╢ рдХрд░реЗрдВ рдФрд░ рдХреЙрд▓реЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рд╣реА рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRiver = cell.HasRiverThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoad = cell.HasRoadThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1, cell, e2, neighbor, hasRoad); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip(e1, cell.Color, e2, neighbor.Color, hasRoad); } features.AddWall(e1, cell, e2, neighbor, hasRiver, hasRoad); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/d05/425/64cd0542540b5d9347a071d727fe2fa4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдорд╛рд░реНрдЧ рдХреЗ рд▓рд┐рдП рджреАрд╡рд╛рд░реЛрдВ рдореЗрдВ рдЫреЗрджред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдХрд╡рд░ рдХрд░рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреЗ рдирдП рдЙрджреНрдШрд╛рдЯрди рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрди рд╕рдорд╛рдкрди рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдХреНрд╡реИрдбреНрд╕ рдХреЗ рд╕рд╛рде рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдо рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рди рджреЗрдЦ рд╕рдХреЗрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдмрдирд╛рдПрдВ </font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХреЗрд╡рд▓ рджреВрд░-рджреВрд░ рдХреА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░ рдХреЗ рдкрд╛рд╕ рд╕реЗ рджреВрд░ рддрдХ рдЬрд╛рддреЗ рд╣реБрдП, рдЙрд╕реЗ рдПрдХ рдЯреНрд░реИрдХреНрдЯрд░ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallCap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = center.y + HexMetrics.wallHeight; walls.AddQuadUnperturbed(v1, v2, v3, v4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдпрд╣ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдПрдХ рдЫреЗрдж рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рджреВрд╕рд░реЗ рдФрд░ рдЪреМрдереЗ рдЬреЛрдбрд╝реЗ рдХреЗ рдмреАрдЪ рдПрдХ рдЖрд╡рд░рдг рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреМрдереЗ рдЬреЛрдбрд╝реА рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдХреНрд╡рд╛рдб рдЪреЗрд╣рд░рд╛ рдЖрд╡рдХ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { AddWallCap(near.v2, far.v2); AddWallCap(far.v4, near.v4); } тАж } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/413/98c/828/41398c82892a2c1f706ca85c9230813a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдореЗрдВ рдмрдВрдж рдЫреЗрджред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЫреЗрдж рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></b> <div class="spoiler_text">   ,     .        .    ,        . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдФрд░ рдкрд╛рдиреА рд╕реЗ рдкрд░рд╣реЗрдЬ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЖрдЗрдП рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ рдЬрд┐рд╕рдореЗрдВ рдЪрдЯреНрдЯрд╛рди рдпрд╛ рдкрд╛рдиреА рд╣реЛред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЪрдЯреНрдЯрд╛рдиреЗрдВ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдмрдбрд╝реА рджреАрд╡рд╛рд░реЗрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрди рдкрд░ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рджреАрд╡рд╛рд░ рд▓рдЧрд╛рдирд╛ рдЕрддрд╛рд░реНрдХрд┐рдХ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдмреБрд░рд╛ рд▓рдЧреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рджреАрд╡рд╛рд░реЗрдВ рднреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрддрд╛рд░реНрдХрд┐рдХ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рддрдЯ рдХреА рджреАрд╡рд╛рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рдмрдВрдз рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45a/94e/027/45a94e027094c6ebdae0763663d6eb8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдкрд░ рдФрд░ рдкрд╛рдиреА рдореЗрдВ рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдВрдЪ рдХреЗ рд╕рд╛рде рдЗрди рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХрд┐рдирд╛рд░реЛрдВ рд╕реЗ рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рджреАрд╡рд╛рд░ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдЖрдо рдкрд╕рд▓реА рдПрдХ рдЪрдЯреНрдЯрд╛рди рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nearCell.Walled != farCell.Walled &amp;&amp; !nearCell.IsUnderwater &amp;&amp; !farCell.IsUnderwater &amp;&amp; nearCell.GetEdgeType(farCell) != HexEdgeType.Cliff ) { тАж } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/128/baf/75a/128baf75ace7d0cf4ed5f12ef380eec8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╕рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдмрд╛рдзрд╛ рд╡рд╛рд▓реА рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдХреЛрдиреЛрдВ рдореЗрдВ рдЬрдЧрд╣ рдмрдиреА рд░рд╣реАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреАрд╡рд╛рд░ рдХреЗ рдХреЛрдиреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХреЛрдиреЗ рдЦрдВрдбреЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝реЗ рдЕрдзрд┐рдХ рдкреНрд░рдпрд╛рд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рд╕рд░рд▓ рдорд╛рдорд▓рд╛ рддрдм рд╣реИ рдЬрдм рд╕рдорд░реНрдерди рд╕реЗрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрд╕-рдкрд╛рд╕ рдХреЛрдИ рджреАрд╡рд╛рд░ рдЦрдВрдб рдирд╣реАрдВ рд╣реИ рдЬреЛ рдЬреБрдбрд╝рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecc/475/9f3/ecc4759f38ced7802ad8743626f91d51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдкрд╛рдиреА рдХреЗ рднреАрддрд░ рд╕рд╣рд╛рдпрддрд╛ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рджреЛ рдЕрдиреНрдп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИ рдпрд╛ рдПрдХ рдмреНрд░реЗрдХ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерди рд╕реЗрд▓ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реИ, рддреЛ рдЗрд╕ рд░рд┐рдм рдХреЗ рд╕рд╛рде рдХреЛрдИ рджреАрд╡рд╛рд░ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рдХрдо рд╕реЗ рдХрдо рдПрдХ рддрд░рдл рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд╣реИ, рддреЛ рдЗрд╕ рдХреЛрдиреЗ рдореЗрдВ рдПрдХ рджреАрд╡рд╛рд░ рдЦрдВрдб рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдмрд╛рдИрдВ рдпрд╛ рджрд╛рдИрдВ рджреАрд╡рд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдордиреЗ рдмреВрд▓рд┐рдпрди рдЪрд░ рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдбрд╛рд▓ рджрд┐рдпрд╛ рддрд╛рдХрд┐ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛ рд╕рдХреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasLeftWall = !leftCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(leftCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRighWall = !rightCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(rightCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall &amp;&amp; hasRighWall) { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cd/f17/82d/8cdf1782d522d5b9e19e461ee5253436.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХреЛрдгреЛрдВ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдиреЛрдВ рдХреЛ рдмрдВрдж рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдмрд╛рдПрдВ рдпрд╛ рджрд╛рдПрдВ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдХреЛрдИ рджреАрд╡рд╛рд░ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рддреЛ рдХрд╛рдо рдкреВрд░рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рджреАрд╡рд╛рд░ рдХреЗрд╡рд▓ рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рджреАрд╡рд╛рд░ рдореЗрдВ рдПрдХ рдФрд░ рдЫреЗрдж рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕реЗ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallCap(right, pivot); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20e/c4d/176/20ec4d17689500d123fc5fd41d447e88.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рджреАрд╡рд╛рд░реЛрдВ рдХрд╛ рдХрдиреЗрдХреНрд╢рди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рджреАрд╡рд╛рд░реЗрдВ рдЕрдкреВрд░реНрдг рджрд┐рдЦрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬрдм рджреАрд╡рд╛рд░ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдиреАрдЪреЗ рддрдХ рдкрд╣реБрдВрдЪ рдЬрд╛рддреА рд╣реИ, рддреЛ рдпрд╣ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ рдЪрдЯреНрдЯрд╛рди рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдирд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рджреАрд╡рд╛рд░ рдФрд░ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рдПрдХ рд╕рдВрдХреАрд░реНрдг рдЫреЗрдж рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрдЯреНрдЯрд╛рди рдХреЗ рд╢реАрд░реНрд╖ рдкрд░, рдРрд╕реА рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/5c6/9a7/6335c69a7f45dcd1c2a0609503b2504a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЛрдВ рдФрд░ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХреЗ рдЪреЗрд╣рд░реЗ рдХреЗ рдмреАрдЪ рдЫреЗрджред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ рдпрджрд┐ рджреАрд╡рд╛рд░ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдмрд╣реБрдд рдХрд┐рдирд╛рд░реЗ рддрдХ рдЬрд╛рд░реА рд░рд╣реЗред </font><font style="vertical-align: inherit;">рд╣рдо рджреАрд╡рд╛рд░ рдХреЗ рд╡рд░реНрддрдорд╛рди рдЫреЛрд░ рдФрд░ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдХреЛрдиреЗ рдХреЗ рдмреАрдЪ рдПрдХ рдФрд░ рджреАрд╡рд╛рд░ рдЦрдВрдб рдЬреЛрдбрд╝рдХрд░ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЗрд╕ рдЦрдВрдб рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рднрд╛рдЧ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдЕрдВрджрд░ рдЫрд┐рдкрд╛ рд╣реЛрдЧрд╛, рд╣рдо рдЪрдЯреНрдЯрд╛рди рдХреЗ рдЕрдВрджрд░ рдХреА рджреАрд╡рд╛рд░ рдХреА рдореЛрдЯрд╛рдИ рдХреЛ рд╢реВрдиреНрдп рдХрд┐рдП рдмрд┐рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рд╡реЗрдЬ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ: рджреЛ рдХреНрд╡реИрдб рдмрд┐рдВрджреБ рдкрд░ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рдКрдкрд░ рдПрдХ рддреНрд░рд┐рдХреЛрдг рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ </font></font><code>AddWallWedge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ </font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реЗрдЬ рдкреЙрдЗрдВрдЯ </font><font style="vertical-align: inherit;">рдХреЛ рдХреЙрдкреА рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">рдФрд░ рдЬреЛрдбрд╝рдХрд░ </font><font style="vertical-align: inherit;">рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallWedge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far, Vector3 point</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); point = HexMetrics.Perturb(point); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; Vector3 pointTop = point; point.y = center.y; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = pointTop.y = center.y + HexMetrics.wallHeight; <span class="hljs-comment"><span class="hljs-comment">// walls.AddQuadUnperturbed(v1, v2, v3, v4); walls.AddQuadUnperturbed(v1, point, v3, pointTop); walls.AddQuadUnperturbed(point, v2, pointTop, v4); walls.AddTriangleUnperturbed(pointTop, v3, v4); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗ рд░реВрдк рдореЗрдВ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕ рд╡рд┐рдзрд┐ рдЬрдм рджреАрд╡рд╛рд░ рдПрдХ рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рджреАрд╡рд╛рд░ рджреВрд╕рд░реЗ рдкрдХреНрд╖ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрдо рдКрдВрдЪрд╛рдИ рдкрд░ рд╕реНрдерд┐рдд рд╣реИ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрди рд╢рд░реНрддреЛрдВ рдХреЗ рддрд╣рдд рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation &lt; rightCell.Elevation) { AddWallWedge(pivot, left, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rightCell.Elevation &lt; leftCell.Elevation) { AddWallWedge(right, pivot, left); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(right, pivot); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/30f/33a/b5c30f33ac93582e2ce319996d9ed1ac.png"></div><br> <i> ,   .</i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h1>  11:    </h1><br><ul><li>    . </li><li>     . </li><li>     . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/a07/5ea/ef5a075ea4c14c810825388be274f817.jpg"></div><br> <i>  .</i> <br><br><h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдордиреЗ рджреАрд╡рд╛рд░ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рд╛ред рдпреЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕реНрдкрд╖реНрдЯ рдЕрдВрддрд░ рдХреЗ рд╕реАрдзреЗ рд╕рд░рд▓ рджреАрд╡рд╛рд░ рдЦрдВрдб рд╣реИрдВред рдЕрдм рд╣рдо рдЙрдирдХреЗ рд▓рд┐рдП рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рд░реЛрдЪрдХ рдмрдирд╛ рджреЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рджреАрд╡рд╛рд░ рдЦрдВрдбреЛрдВ рдХреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░реАрдлреИрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд▓рд╛рд▓ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рджреЛ рдХреНрдпреВрдмреНрд╕ рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЯреЙрд╡рд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЯреЙрд╡рд░ рдХреЗ рдЖрдзрд╛рд░ рдореЗрдВ 2 рдХрд╛ рдЖрдХрд╛рд░ 2 рдЗрдХрд╛рдЗрдпреЛрдВ рдФрд░ 4 рдЗрдХрд╛рдЗрдпреЛрдВ рдХреА рдКрдВрдЪрд╛рдИ рд╣реИ, рдЕрд░реНрдерд╛рдд рдпрд╣ рджреАрд╡рд╛рд░ рд╕реЗ рдЕрдзрд┐рдХ рдореЛрдЯрд╛ рдФрд░ рдКрдВрдЪрд╛ рд╣реИред рдЗрд╕ рдХреНрдпреВрдм рдХреЗ рдКрдкрд░ рд╣рдо рдЯреЙрд╡рд░ рдХреЗ рд╢реАрд░реНрд╖ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реБрдП рдПрдХ рдпреВрдирд┐рдЯ рдХреНрдпреВрдм рд░рдЦреЗрдВрдЧреЗред рдЕрдиреНрдп рд╕рднреА рдкреНрд░реАрдлрд╝реИрдм рдХреА рддрд░рд╣, рдЗрди рдХреНрдпреВрдмреНрд╕ рдХреЛ рдХреЛрд▓рд╛рдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЯреЙрд╡рд░ рдореЙрдбрд▓ рдореЗрдВ рдХрдИ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрдиреНрд╣реЗрдВ рд░реВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдмрдЪреНрдЪреЗ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдЬрдЧрд╣ рджреЗрдВ рддрд╛рдХрд┐ рдЬрдбрд╝ рдХрд╛ рд╕реНрдерд╛рдиреАрдп рдореВрд▓ рдЯреЙрд╡рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдо рдЙрдирдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд┐рдП рдмрд┐рдирд╛ рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f1/a54/335/2f1a54335d81a6682707e740107362c6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлреИрдм рдЯреЙрд╡рд░ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдПрдХ рд▓рд┐рдВрдХ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f76/df1/c7e/f76df1c7e5b1c808d2ae636f7e823487.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдЯреЙрд╡рд░ рд╕реЗ рд▓рд┐рдВрдХ рдХрд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯрд╛рд╡рд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдкреНрд░рддреНрдпреЗрдХ рджреАрд╡рд╛рд░ рдЦрдВрдб рдХреЗ рдмреАрдЪ рдореЗрдВ рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рд░рдЦрдХрд░ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ рдПрдХ рдЯреЙрд╡рд░ рдмрдирд╛рдПрдВрдЧреЗ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреА рд╕реНрдерд┐рддрд┐ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЗ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдмрд┐рдВрджреБрдУрдВ рдХреА рдФрд╕рдд рд╣реЛрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { тАж Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/559/541/487/559541487b79dd6877b4456dbdf010b1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐ рджреАрд╡рд╛рд░ рдЦрдВрдб рдПрдХ рдЯреЙрд╡рд░ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рджреАрд╡рд╛рд░ рдХреЗ рд╕рд╛рде рдХрдИ рдЯреЙрд╡рд░ рдорд┐рд▓реЗ, рд▓реЗрдХрд┐рди рдЙрдирдХрд╛ рдЙрдиреНрдореБрдЦреАрдХрд░рдг рдирд╣реАрдВ рдмрджрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЙрдирдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рддрд╛рдХрд┐ рд╡реЗ рджреАрд╡рд╛рд░ рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреАрд╡рд╛рд░ рдХреЗ рджрд╛рдПрдВ рдФрд░ рдмрд╛рдПрдВ рдмрд┐рдВрджреБ рд╣реИрдВ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реА рджрд┐рд╢рд╛ рд╕рд╣реА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдЬреНрдЮрд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рджреАрд╡рд╛рд░ рдЦрдВрдб рдХреЗ рдЙрдиреНрдореБрдЦреАрдХрд░рдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЯреЙрд╡рд░ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрд╡рдпрдВ рд░реЛрдЯреЗрд╢рди рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдмрд╕ рд╕рдВрдкрддреНрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ </font></font><code>Transform.right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реЗрдХреНрдЯрд░ </font><font style="vertical-align: inherit;">рдЕрд╕рд╛рдЗрди </font><font style="vertical-align: inherit;">рдХрд░рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХрддрд╛ рдХреЛрдб рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рдмрджрд▓ рджреЗрдЧрд╛ рддрд╛рдХрд┐ рдЗрд╕рдХреА рд╕реНрдерд╛рдиреАрдп рджрд┐рд╢рд╛ рд╕рд╣реА рдкреНрд░реЗрд╖рд┐рдд рд╡реЗрдХреНрдЯрд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d3/2c3/777/5d32c3777d5b63db90ddf9f8fbbf1dee.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рджреАрд╡рд╛рд░ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transform.right рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">     <code>Quaternion.FromToRotation</code>   .   . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 right { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotation * Vector3.right; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { rotation = Quaternion.FromToRotation(Vector3.right, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯрд╛рд╡рд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрдо рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐ рджреАрд╡рд╛рд░ рдЦрдВрдб рдореЗрдВ рдПрдХ рдЯреЙрд╡рд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреВрд▓рд┐рдпрди рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ </font><font style="vertical-align: inherit;">рдкреИрд░рд╛рдореАрдЯрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдХрд░ рдЯреЙрд╡рд░ рдХреЛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдирд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рднреА рдЯреЙрд╡рд░ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> addTower = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (addTower) { Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдХреЛрдиреЛрдВ рдХреЗ рдХреЛрдиреЛрдВ рдореЗрдВ рд░рдЦреЗрдВред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╣рдо рдЙрдирдХреЗ рдмреАрдЪ рдХрд╛рдлреА рдирд┐рд░рдВрддрд░ рджреВрд░реА рд╡рд╛рд▓реЗ рдХрдо рдЯреЙрд╡рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { тАж AddWallSegment(pivot, left, pivot, right, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d60/823/d7b/d60823d7b381eccaf5916bf2bc636061.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЙрд╡рд░ рдХреЗрд╡рд▓ рдХреЛрдиреЛрдВ рдореЗрдВ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдлреА рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рдХрдо рдЖрд╡рдзрд┐рдХ рд╕реНрдерд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рднреВ-рднрд╛рдЧ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде, рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЯреЙрд╡рд░ рдХреЛ рдПрдХ рдХреЛрдиреЗ рдореЗрдВ рд░рдЦрдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдиреЗ рдХреЗ рдХреЗрдВрджреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ рд╣рдо рдПрдХ рд╣реИрд╢ рдорд╛рдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рдереНрд░реЗрд╢реЛрд▓реНрдб рдорд╛рди рд╕реЗ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдореВрд▓реНрдп рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">0.5 рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде, рдЖрдзреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЯреЙрд╡рд░ рдмрдирд╛рдП рдЬрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рд╣рдо рдХрдИ рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рд╕рд╛рде рдпрд╛ рдЙрдирдХреЗ рдмрд┐рдирд╛ рджреАрд╡рд╛рд░реЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallTowerThreshold = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b54/40c/f0f/b5440cf0ffa4f615f2dcbf37532bbb0a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрддрд░рддреАрдм рдЯрд╛рд╡рд░ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдврд▓рд╛рди рд╕реЗ рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЗрд▓рд╛рдХреЗ рдХреЗ рдЖрдХрд╛рд░ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдЯреЙрд╡рд░ рд▓рдЧрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЯреЙрд╡рд░ рдХреА рдврд▓рд╛рдиреЛрдВ рдкрд░ рдЕрддрд╛рд░реНрдХрд┐рдХ рд▓рдЧрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рджреАрд╡рд╛рд░реЗрдВ рдПрдХ рдХреЛрдг рдкрд░ рдЬрд╛рддреА рд╣реИрдВ рдФрд░ рдЯреЙрд╡рд░ рдХреЗ рд╢реАрд░реНрд╖ рд╕реЗ рдХрдЯ рд╕рдХрддреА рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24c/c5e/2dd/24cc5e2ddb97b83d14e0826bc64e3f20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдврд▓рд╛рди рдкрд░ рдЯрд╛рд╡рд░реНрд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдврд▓рд╛рдиреЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рджрд╛рдПрдВ рдФрд░ рдмрд╛рдПрдВ рдХреЛрдиреЗ рдХреА рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╕рдорд╛рди рдКрдВрдЪрд╛рдИ рдкрд░ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ рдЯрд╛рд╡рд░ рд░рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation == rightCell.Elevation) { HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; } AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/770/1b4/fd9/7701b4fd9d0a4952fce2a9e00bbb4571.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдврд▓рд╛рди рдХреА рджреАрд╡рд╛рд░реЛрдВ рдкрд░ рдЕрдзрд┐рдХ рдЯреЙрд╡рд░ рдирд╣реАрдВ рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдордиреЗ рджреАрд╡рд╛рд░реЛрдВ рдФрд░ рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рдЬрдореАрди рдкрд░ рд░рдЦ рджрд┐рдпрд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдо рдврд▓рд╛рди рдкрд░ рджреАрд╡рд╛рд░реЛрдВ рд╕реЗ рдмрдЪрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рджреАрд╡рд╛рд░ рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рд░рд╛рд╣рдд рдЕрднреА рднреА рдЕрд▓рдЧ-рдЕрд▓рдЧ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдкрд░ рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЗрдВ рдЕрдЧреБрд╡рд╛рдИ рдХреЗ рд╕рд╛рде рдЪрд▓ рд╕рдХрддреА рд╣реИрдВ, рдФрд░ рдПрдХ рд╣реА рдКрдВрдЪрд╛рдИ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рдЯреЙрд╡рд░ рдХрд╛ рдЖрдзрд╛рд░ рд╣рд╡рд╛ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4d8/b10/cd24d8b1012804af5d073c3901c874ad.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╡рд╛ рдореЗрдВ рдЯрд╛рд╡рд░реНрд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдврд▓рд╛рди рдкрд░ рджреАрд╡рд╛рд░реЗрдВ рд╣рд╡рд╛ рдореЗрдВ рднреА рд▓рдЯрдХ рд╕рдХрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b6/ae3/d24/8b6ae3d2489f253ae1a78593af0abd6c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреАрд╡рд╛рд░реЗрдВ рд╣рд╡рд╛ рдореЗрдВ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рджреАрд╡рд╛рд░реЛрдВ рдФрд░ рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдХреЛ рдЬрдореАрди рддрдХ рдЦреАрдВрдЪрдХрд░ рддрдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП Y рдСрдлрд╕реЗрдЯ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рдпреВрдирд┐рдЯ рдбрд╛рдЙрди рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдПрдХ рд╣реА рд░рд╛рд╢рд┐ рд╕реЗ рдЯрд╛рд╡рд░реЛрдВ рдХреА рдКрдВрдЪрд╛рдИ рдмрдврд╝рд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">4f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallYOffset = <span class="hljs-number"><span class="hljs-number">-1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдмрджрд▓рддреЗ рд╣реИрдВ </font></font><code>HexMetrics.WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рд╡рд╛рдИ рд╕рдордиреНрд╡рдп рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рдирдИ рдСрдлрд╕реЗрдЯ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v + wallYOffset; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЯреЙрд╡рд░ рдХреЗ рдкреНрд░реАрдлреИрдм рдХреЛ рднреА рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЖрдзрд╛рд░ рдЕрдм рдЬрдореАрди рдХреЗ рдиреАрдЪреЗ рдПрдХ рдЗрдХрд╛рдИ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдмреЗрд╕ рдХреНрдпреВрдм рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдПрдХ рдЗрдХрд╛рдИ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рддрджрдиреБрд╕рд╛рд░ рдХреНрдпреВрдмреНрд╕ рдХреА рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2d/e4e/503/f2de4e50398fbae4ee296737dbe3a922.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecd/5d7/0eb/ecd5d70ebb620e3bae84f17aedb4a2a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдореАрди рдкрд░ рджреАрд╡рд╛рд░реЗрдВ рдФрд░ рдЯрд╛рд╡рд░ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2>  рдкреБрд▓реЛрдВ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирджрд┐рдпрд╛рдБ рдФрд░ рд╕рдбрд╝рдХреЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдбрд╝рдХреЗрдВ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдирджрд┐рдпреЛрдВ рдХреЛ рдкрд╛рд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкреБрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рд╕рд╣реА рд╕рдордп рд╣реИ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╕реНрдХреЗрд▓ рдХреНрдпреВрдм рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдкреНрд░реАрдлреИрдм рдкреБрд▓ рдХреА рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА рдЪреМрдбрд╝рд╛рдИ рдмрджрд▓рддреА рд░рд╣рддреА рд╣реИ, рд▓реЗрдХрд┐рди рджреЛрдиреЛрдВ рдУрд░ рд╕рдбрд╝рдХ рдХреЗрдВрджреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рд▓рдЧрднрдЧ рд╕рд╛рдд рджреВрд░реА рдХреА рдЗрдХрд╛рдЗрдпрд╛рдБ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдПрдХ рдЕрдиреБрдорд╛рдирд┐рдд рдкреИрдорд╛рдиреЗ (3, 1, 7) рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рд▓рд╛рд▓ рд╢рд╣рд░реА рд╕рд╛рдордЧреНрд░реА рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рдХреЛрд▓рд╛рдЗрдбрд░ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЯрд╛рд╡рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреЗ рд░реВрдк рдореЗрдВ, рдШрди рдХреЛ рдЙрд╕реА рд╡рд╕реНрддреБ рдХреЗ рд╕рд╛рде рдореВрд▓ рд╡рд╕реНрддреБ рдХреЗ рдЕрдВрджрд░ рд░рдЦреЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдкреБрд▓ рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рд╕реНрд╡рдпрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реЛрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд▓ рдХреЗ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдПрдХ рд▓рд┐рдВрдХ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower, bridge;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/808/ac6/dc5/808ac6dc523d16d2005da48dcf4d1f65.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд░рд┐рдЬ рдкреНрд░реАрдлреИрдм рдХрд╛ рдХрд╛рдо рд╕реМрдВрдкрд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрд▓реЛрдВ рдХрд╛ рд╕реНрдерд╛рди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд▓ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>HexFeatureManager.AddBridge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреБрд▓ рдХреЛ рдирджреА рдХреЗ рдХреЗрдВрджреНрд░ рдФрд░ рдирджреА рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЕрд╡рд┐рд░рд▓ рд╕рдбрд╝рдХ рдХреЗрдВрджреНрд░реЛрдВ рдХреЛ рд╕рдВрдЪрд╛рд░рд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкреБрд▓ рд░рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br><pre> <code class="cs hljs"> roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд▓ рдХреЛ рдареАрдХ рд╕реЗ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЯрд╛рд╡рд░реЛрдВ рдХреЛ рдореЛрдбрд╝рддреЗ рд╕рдордп рдЙрд╕реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рдбрд╝рдХ рдХреЗрдВрджреНрд░ рдкреБрд▓ рдХреЗ рдЖрдЧреЗ рд╡реЗрдХреНрдЯрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдПрдХ рд╣реА рд╕реЗрд▓ рдХреЗ рднреАрддрд░ рд░рд╣рддреЗ рд╣реИрдВ, рдпрд╣ рд╡реЗрдХреНрдЯрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдХреНрд╖реИрддрд┐рдЬ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕рдХреЗ рдШрдЯрдХ Y рдХреЛ рд╢реВрдиреНрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдХреЗ рдкрд╛рд░ рдкреБрд▓ рдмрдирд╛рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдирджреА рд╡рд┐рдиреНрдпрд╛рд╕реЛрдВ рдХреЗ рд▓рд┐рдП рдкреБрд▓реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рд╕реАрдзреЗ рдФрд░ рдШреБрдорд╛рд╡рджрд╛рд░ рд╣реИрдВред рд╕рдбрд╝рдХреЗрдВ рд╕рдорд╛рдкрди рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рдФрд░ рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рд╕рдбрд╝рдХреЛрдВ рдкрд░ рдХреЗрд╡рд▓ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рд╕реАрдзреЗ рдирджрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВред рдЕрдВрджрд░, </font></font><code>HexGridChunk.TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рдСрдкрд░реЗрдЯрд░ </font></font><code>else if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕реА рдирджрд┐рдпреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрд╣рд╛рдВ рд╣рдо рдкреБрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдХреЗ рдПрдХ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд╣реИрдВред рд╕рдбрд╝рдХ рдХрд╛ рдХреЗрдВрджреНрд░ рдирджреА рд╕реЗ рдЪрд▓рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╕реЗрд▓ рдХрд╛ рдХреЗрдВрджреНрд░ рднреА рдмрджрд▓рддрд╛ рд╣реИред рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рд╕рдбрд╝рдХ рдХрд╛ рдХреЗрдВрджреНрд░ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрд╕реА рджрд┐рд╢рд╛ рдореЗрдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдЬрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред рдпрд╣ рдХреЗрдВрджреНрд░ рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { тАж roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97c/c7f/420/97cc7f42004ba86c6cd0333af352f24b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдкрд░ рдкреБрд▓ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд▓ рджрд┐рдЦрд╛рдИ рджрд┐рдП рд╣реИрдВ! </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкреНрд░рддреНрдпреЗрдХ рджрд┐рд╢рд╛ рдХреЗ рд▓рд┐рдП рдкреБрд▓реЛрдВ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирджреА рдирд╣реАрдВ рдмрд╣рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╕реЗрд▓ рдореЗрдВ рдкреБрд▓ рдХрд╛ рдХреЗрд╡рд▓ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдирджреА рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдПрдХ рджрд┐рд╢рд╛ рдЪреБрдирдХрд░ рдФрд░ рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреБрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдХреЛрдИ рднреА рджрд┐рд╢рд╛ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next()) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдкреБрд▓ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдЬрдм рдирджреА рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдПрдХ рд╕рдбрд╝рдХ рд╣реЛред </font><font style="vertical-align: inherit;">рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реИрдВ рдХрд┐ рд╡рд░реНрддрдорд╛рди рддрд░рдл рдПрдХ рд╕рдбрд╝рдХ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдХрд┐ рдирджреА рдХреЗ рджреВрд╕рд░реА рддрд░рдл рд╕рдбрд╝рдХ рд╣реИ рдпрд╛ рдирд╣реАрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next() &amp;&amp; ( cell.HasRoadThroughEdge(direction.Next2()) || cell.HasRoadThroughEdge(direction.Opposite()) )) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/635/a47/978/635a4797816f9f35297f67224a0ec449.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рддрд░рдл рдХреА рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдмреАрдЪ рдкреБрд▓ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдШреБрдорд╛рд╡рджрд╛рд░ рдирджрд┐рдпреЛрдВ рдкрд░ рдкреБрд▓ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШреБрдорд╛рд╡рджрд╛рд░ рдирджрд┐рдпреЛрдВ рдкрд░ рдкреБрд▓ рдЗрд╕реА рддрд░рд╣ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХреА рдЯреЛрдкреЛрд▓реЙрдЬреА рдереЛрдбрд╝реА рдЕрд▓рдЧ рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рд╡рдХреНрд░ рдХреЗ рдмрд╛рд╣рд░ рд╣реЛрдВрдЧреЗ рддреЛ рд╣рдо рдПрдХ рдкреБрд▓ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдЦрд┐рд░реА рдмреНрд▓реЙрдХ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ </font></font><code>else</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рдСрдлрд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордзреНрдп рджрд┐рд╢рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрд╕ рдСрдлрд╕реЗрдЯ рдХреЛ рджреЛ рдмрд╛рд░ рд╡рд┐рднрд┐рдиреНрди рдкреИрдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдПрдХ рдЪрд░ рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !cell.HasRoadThroughEdge(middle) &amp;&amp; !cell.HasRoadThroughEdge(middle.Previous()) &amp;&amp; !cell.HasRoadThroughEdge(middle.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рдХреНрд░ рдХреЗ рдмрд╛рд╣рд░ рд╡рд┐рд╕реНрдерд╛рдкрди рдкреИрдорд╛рдиреЗ 0.25 рд╣реИ, рдФрд░ рдЕрдВрджрд░ </font></font><code>HexMetrics.innerToOuter * 0.7f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдкреБрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/612/f9e/da9/612f9eda9f9e4cd31ba20dfe2db7687b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШреБрдорд╛рд╡рджрд╛рд░ рдирджрд┐рдпреЛрдВ рдкрд░ рдкреБрд▓ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдирдХрд▓реА рдкреБрд▓реЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдХреЗрд╡рд▓ рдордзреНрдп рджрд┐рд╢рд╛ рд╕реЗ рдкреБрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction == middle) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдлрд┐рд░, рдЖрдкрдХреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╕рдбрд╝рдХ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( direction == middle &amp;&amp; cell.HasRoadThroughEdge(direction.Opposite()) ) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/744/33c/275/74433c2750e413c44d17139982ecff3b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рддрд░рдл рдХреА рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдмреАрдЪ рдкреБрд▓ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрд▓ рд╕реНрдХреЗрд▓рд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдЗрд▓рд╛рдХреЗ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВ, рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдФрд░ рдирджреА рдХреЗ рд╡рд┐рдкрд░реАрдд рдкрдХреНрд╖реЛрдВ рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдХрднреА рдкреБрд▓ рдмрд╣реБрдд рдЫреЛрдЯреЗ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдХрднреА рдмрд╣реБрдд рд▓рдВрдмреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/770/f2c/e53/770f2ce537ab16628c799eceb6ca4ad7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднрд┐рдиреНрди рджреВрд░реА рд▓реЗрдХрд┐рди рдирд┐рд░рдВрддрд░ рдкреБрд▓ рдХреА рд▓рдВрдмрд╛рдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдордиреЗ рд╕рд╛рдд рдЗрдХрд╛рдЗрдпреЛрдВ рдХреА рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рде рдПрдХ рдкреБрд▓ рдмрдирд╛рдпрд╛ рд╣реИ, рдЖрдк рдЗрд╕реЗ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХреА рд╕рд╣реА рджреВрд░реА рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреБрд▓ рдореЙрдбрд▓ рд╡рд┐рдХреГрдд рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреВрд░рд┐рдпрд╛рдВ рдмрд╣реБрдд рднрд┐рдиреНрди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд▓рдВрдмрд╛рдИ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдкреБрд▓реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╡рд┐рд░реВрдкрдг рдЕрдзрд┐рдХ рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдЪрд┐рдд рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдкреБрд▓ рдкреНрд░реАрдлрд╝реИрдм рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓рдВрдмрд╛рдИ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рд▓рдВрдмрд╛рдИ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░реЗрдВрдЧреЗ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bridgeDesignLength = <span class="hljs-number"><span class="hljs-number">7f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдореВрд▓ рд▓рдВрдмрд╛рдИ рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдХреЗ рдкреБрд▓ рдХреЗ Z рдЙрджрд╛рд╣рд░рдг рдХреЗ рд╕рд╛рде рдкреИрдорд╛рдиреЗ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреБрд▓ рдХреЗ рдкреНрд░реАрдлреИрдм рдХреА рдЬрдбрд╝ рдореЗрдВ рдПрдХ рд╣реА рдкреИрдорд╛рдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреБрд▓ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдЦрд┐рдВрдЪреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> length = Vector3.Distance(roadCenter1, roadCenter2); instance.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3( <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, length * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / HexMetrics.bridgeDesignLength) ); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/b73/49c/21eb7349c5e7ae6d5480b2e61d19e046.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрд▓реЛрдВ рдХреА рдмрджрд▓рддреА рд▓рдВрдмрд╛рдИред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрд▓ рдирд┐рд░реНрдорд╛рдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдШрди рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдПрдХ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рдкреБрд▓ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рддреАрди рд╕реНрдХреЗрд▓ рдХрд┐рдП рдЧрдП рдФрд░ рдШреБрдорд╛рдП рдЧрдП рдХреНрдпреВрдмреНрд╕ рдХрд╛ рдПрдХ рдореЛрдЯрд╛ рдзрдиреБрд╖рд╛рдХрд╛рд░ рдкреБрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЖрдк рд╕рдбрд╝рдХ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рд╕рд╣рд┐рдд рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ 3 рдбреА-рдореЙрдбрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреВрд░реА рд╡рд╕реНрддреБ рдереЛрдбрд╝реА рд╕рдВрдХреБрдЪрд┐рдд рдФрд░ рдЦрд┐рдВрдЪреА рд╣реБрдИ рд╣реЛрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eee/83f/3b6/eee83f3b67cf879abe3114117614af08.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a9/741/f7f/8a9741f7f024aa8914e29b12c1ae9d94.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рднрд┐рдиреНрди рд▓рдВрдмрд╛рдИ рдХреЗ рдзрдиреБрд╖рд╛рдХрд╛рд░ рдкреБрд▓ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдорд╛рд░реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╢рд╣рд░реА, рдЧреНрд░рд╛рдореАрдг рдФрд░ рдкреМрдзреЛрдВ рдХреА рд╡рд╕реНрддреБрдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рднрд▓реЗ рд╣реА рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рддреАрди рд╕реНрддрд░ рд╣реИрдВ, рд╕рднреА рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗрд▓ рдХреЗ рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрд╛рдлреА рдЫреЛрдЯреЗ рд╣реИрдВред рдпрджрд┐ рд╣рдореЗрдВ рдорд╣рд▓ рдЬреИрд╕реА рдмрдбрд╝реА рдЗрдорд╛рд░рдд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд▓рд╛рдХреЗ рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБ рдЬреЛрдбрд╝реЗрдВред рдЗрд╕ рддрд░рд╣ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдЗрддрдиреЗ рдмрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдкреВрд░реЗ рд╕реЗрд▓ рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░ рд▓реЗрддреЗ рд╣реИрдВред рдЗрди рд╡рд╕реНрддреБрдУрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╣реИ рдФрд░ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░реАрдлреИрдм рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдорд╣рд▓ рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдШрди рдФрд░ рдЪрд╛рд░ рдХреЛрдиреЗ рд╡рд╛рд▓реЗ рдЯреЙрд╡рд░ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдХреЗрдВрджреНрд░реАрдп рдШрди рдХреЗ рд▓рд┐рдП рд╕реНрдХреЗрд▓ (6, 4, 6) рдПрдХ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдмрдбрд╝реЗ рд▓реЙрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдЧрд╛, рдЬреЛ рдПрдХ рдордЬрдмреВрдд рд╡рд┐рдХреГрдд рдХреЛрд╢рд┐рдХрд╛ рдореЗрдВ рднреА рдлрд┐рдЯ рдмреИрдарддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/9bf/0dc/7e19bf0dc5f1568bf4b21ec467ba9063.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рд▓ рдХрд╛ рдкреНрд░реАрдлреИрдмред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдПрдХ рдЭрд┐рдЧрд░рд╛рдЯ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдКрдкрд░ рд░рдЦреЗ рдЧрдП рддреАрди рдХреНрдпреВрдмреНрд╕ рд╕реЗ рдирд┐рд░реНрдорд┐рддред </font><font style="vertical-align: inherit;">рдирд┐рдЪрд▓реЗ рдХреНрдпреВрдм рдХреЗ рд▓рд┐рдП, рд╕реНрдХреЗрд▓ (8, 2.5, 8) рдЙрдкрдпреБрдХреНрдд рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ad/7d3/291/1ad7d3291224358562b3472f528973a1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝рдм рдЬрд╝рд┐рдЧрдЧреБрд░рд╛рддред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдПрдВ рдХреЛрдИ рднреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЬрд░реВрд░реА рдирд╣реАрдВ рдХрд┐ рд╡рд╛рд╕реНрддреБрджреЛрд╖ рд╣реЛред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджрд╕ рдпреВрдирд┐рдЯ рддрдХ рдХреЗ рд╡рд┐рд╢рд╛рд▓ рд╡реГрдХреНрд╖реЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдореЗрдЧрд╛рдлреНрд▓реЛрд░рд╛ рд╕реЗ рднрд░реЗ рд╕реЗрд▓ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bb/e91/907/1bbe91907deba70f6ab9d02cd13de795.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдореЗрдЧрд╛рдлреНрд▓реЛрд░рд╛ред </font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рдкреНрд░реАрдлрд╝реИрдм рдХреЛ рдЯреНрд░реИрдХ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд░рдгреА рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] special;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕рд░рдгреА рдореЗрдВ рдПрдХ рдорд╣рд▓ рдЬреЛрдбрд╝реЗрдВ, рдлрд┐рд░ рдЬрд╝рд┐рдЧрдЧреБрд░реИрдЯ, рдФрд░ рдлрд┐рд░ рдореЗрдЧрд╛рдлреНрд▓реЛрд░рд╛ред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbc/2e3/e94/bbc2e3e949b25efc800a8f2e799490c7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЕрдиреБрдХреВрд▓рдиред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реЗрд╖ рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЕрдЧрд░ рдпрд╣ рд╡рд╣рд╛рдВ рд╕реНрдерд┐рдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> specialIndex;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдиреНрдп рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреА рддрд░рд╣, рдЖрдЗрдП рд╣рдо рдЗрд╕реЗ рдЗрд╕ рдореВрд▓реНрдп рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рджреЗрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕реЗрд▓ рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдЗрдВрдбреЗрдХреНрд╕ 0. рд╕реЗ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ рдЬреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рд╡рд┐рд╢реЗрд╖ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsSpecial { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╢рд╣рд░реА, рдЧреНрд░рд╛рдореАрдг рдФрд░ рд╕рдВрдпрдВрддреНрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕реНрддрд░реЛрдВ рдХреЗ рд╕рдорд╛рди рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel, activeSpecialIndex; тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel, applySpecialIndex; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplySpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applySpecialIndex = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { activeSpecialIndex = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)index; } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applySpecialIndex) { cell.SpecialIndex = activeSpecialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } тАж } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП UI рдореЗрдВ рдПрдХ рд╕реНрд▓рд╛рдЗрдбрд░ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рддреАрди рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕реНрд▓рд╛рдЗрдбрд░ рдореЗрдВ рдЕрдВрддрд░рд╛рд▓ 0тАУ3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╢реВрдиреНрдп рдХрд╛ рдЕрд░реНрде рд╣реЛрдЧрд╛ рд╡рд╕реНрддреБ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐, рдПрдХ - рдПрдХ рдорд╣рд▓, рджреЛ - рдЭрд┐рдЧреБрд░рдЯ, рддреАрди - рдореЗрдЧрд╛рдлреНрд▓реЛрд░рд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab4/2ea/9bf/ab42ea9bf68565a294f4ded5d2d7ebf0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рд╕реНрд▓рд╛рдЗрдбрд░ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕реМрдВрдк рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реА рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╕ рд╡рд╛рдВрдЫрд┐рдд рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рд╛рдВрдЫрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╢реВрдиреНрдп рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкреНрд░реАрдлрд╝реИрдм рдХреЗ рд╕рд░рдгреА рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпреВрдирд┐рдЯ рдХреЛ рд╕реЗрд▓ рдХреЗ рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рд╕реЗ рдШрдЯрд╛ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓реЛ рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдПрдХ рдордирдорд╛рдирд╛ рд░реЛрдЯреЗрд╢рди рджреЗрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); HexHash hash = HexMetrics.SampleHashGrid(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рд╕реЗрд▓ рдХреЛ рдЯреНрд░рд╛рдИрдЧреБрд▓реЗрдЯ рдХрд░рддреЗ рд╕рдордп, рд╣рдо </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рдБрдЪреЗрдВрдЧреЗ рдХрд┐ рд╕реЗрд▓ рдореЗрдВ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдо рдЕрдкрдиреА рдирдИ рд╡рд┐рдзрд┐ рдХрд╣рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b69/242/657/b692426576e292bbdc9ed0752624db51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБред </font><font style="vertical-align: inherit;">рд╡реЗ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗ рдмрд╣реБрдд рдмрдбрд╝реЗ рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рд╕реЗ рдмрдЪреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдПрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреА рд╣реИрдВ, рд╡реЗ рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЧрдардмрдВрдзрди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЙрдирдХреЗ рдКрдкрд░ рд▓рдЯрдХрд╛рдПрдВрдЧреЗред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a51/92f/cc2/a5192fcc2c5718f33bafc631f60a07a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдкрд░ рд╡рд╕реНрддреБрдПрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдирджрд┐рдпреЛрдВ рдХреЗ рдКрдкрд░ рдмрдирд╛рдП рдЬрд╛рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рдВрдкрддреНрддрд┐ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВ </font></font><code>HexCell.SpecialIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрдВрдбреЗрдХреНрд╕ рддрднреА рдмрджрд▓реЗрдВрдЧреЗ рдЬрдм рд╕реЗрд▓ рдореЗрдВ рдХреЛрдИ рдирджрд┐рдпрд╛рдВ рди рд╣реЛрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { тАж <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдирджреА рдЬреЛрдбрд╝рддреЗ рд╕рдордп, рд╣рдореЗрдВ рд╕рднреА рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдирджреА рдХреЛ рдЙрдиреНрд╣реЗрдВ рдзреЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдзрд┐ рдореЗрдВ </font></font><code>HexCell.SetOutgoingRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ 0 рдкрд░ рд╕реЗрдЯ </font><font style="vertical-align: inherit;">рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { тАж hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; neighbor.incomingRiver = direction.Opposite(); neighbor.specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╕рдбрд╝рдХреЛрдВ рд╕реЗ рдмрдЪрддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА рддрд░рд╣, рд╕рдбрд╝рдХреЗрдВ рднреА рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рдЦрд░рд╛рдм рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рднрдпрд╛рдирдХ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рд╕рдбрд╝рдХреЛрдВ рдХреЛ рднреА рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреБрдЫ рд╕реБрд╡рд┐рдзрд╛рдПрдВ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЬрдмрдХрд┐ рдЕрдиреНрдп рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдЖрд╕рд╛рди рдмрдирд╛рдПрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/ebf/939/b3bebf9399ed016e8d79a4c1ee53ace8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдкрд░ рд╡рд╕реНрддреБрдПрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд╕рдбрд╝рдХ рдХреЛ рд╣рд░рд╛рдиреЗ рджреЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп, рд╣рдо рд╕реЗрд▓ рд╕реЗ рд╕рднреА рд╕рдбрд╝рдХреЛрдВ рдХреЛ рднреА рд╣рдЯрд╛ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { тАж <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RemoveRoads(); RefreshSelfOnly(); } } }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</font></font></b> <div class="spoiler_text">      0,   ,       .            . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдкрд░, рд╣рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдВрдЪ рдХрд░рдиреА рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрд╡рд▓ рддрднреА рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдЬрдм рдХреЛрдИ рднреА рд╕реЗрд▓ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрд▓ рди рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction) &amp;&amp; !IsSpecial &amp;&amp; !GetNeighbor(direction).IsSpecial &amp;&amp; GetElevationDifference(direction) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдиреНрдп рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рдмрдЪреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдорд┐рд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡реЗ рдУрд╡рд░рд▓реИрдк рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЕрд╕реНрд╡рд╕реНрде рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдкрд░ рднреА рдирд┐рд░реНрднрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЙрд╕реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03b/7f1/8fc/03b7f18fc9f9d7543bdb0d9c24a074e2.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╡рд╕реНрддреБ рдЬреЛ рдЕрдиреНрдп рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдЪреНрдЫреЗрдж рдХрд░рддреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЫреЛрдЯреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рджрдмрд╛ рджреЗрдВрдЧреЗ, рдЬреИрд╕реЗ рдХрд┐ рд╡реЗ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдереЗред </font><font style="vertical-align: inherit;">рдЗрд╕ рдмрд╛рд░ рд╣рдо рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } тАж }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рд╕реЗ рдмрдЪреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкрд╛рдиреА рдХреА рднреА рд╕рдорд╕реНрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдмрд╛рдврд╝ рдХреЗ рджреМрд░рд╛рди рд╡рд┐рд╢реЗрд╖ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдмрдиреА рд░рд╣реЗрдВрдЧреА? </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдмрд╛рдврд╝ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЫреЛрдЯреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рднреА рдРрд╕рд╛ рд╣реА рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/479/e79/8d9479e79cb0555c81f562dc32937552.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдореЗрдВ рд╡рд╕реНрддреБрдПрдБред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдмрд╛рдврд╝ рдФрд░ рд╡рд┐рд╢реЗрд╖, рдФрд░ рд╕рд╛рдзрд╛рд░рдг рд╡рд╕реНрддреБрдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреЛрдиреЛрдВ рдСрдкрд░реЗрдЯрд░ </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font><font style="vertical-align: inherit;">рдЬрд╛рдВрдЪрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рдкрд╛рдиреА рдореЗрдВ рд╣реИ, рд╣рдо рдкрд░реАрдХреНрд╖рдг рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рд╣реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХреА рдХрдИ рд╡рд╕реНрддреБрдПрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдВрдЧреАред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi425463/">https://habr.com/ru/post/hi425463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi425449/index.html">рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╡рд┐рдЬреНрдЮрд╛рдкрди рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдирд╛: Yandex.Direct Turbo Pages</a></li>
<li><a href="../hi425453/index.html">рдЕрдВрддрд░рд┐рдХреНрд╖ рдЖрдХреНрд░рдордгрдХрд╛рд░рд┐рдпреЛрдВ рд╕реЗ рд▓реЗрдХрд░ рд╣рд╛рдл рд▓рд╛рдЗрдл 2: рдж рд╕реНрдЯреЛрд░реА рдСрдл рдЧреЗрдо рдбреЗрдЬрдбреЛрдХ</a></li>
<li><a href="../hi425457/index.html">рдмреАрд╕ рдкрд╣реЗрд▓рд┐рдпрд╛рдБ (рдкрд╛рдЧрд▓, рдЕрджреНрднреБрдд рдЬреНрдпрд╛рдорд┐рддрд┐ рдореЗрдВ)</a></li>
<li><a href="../hi425459/index.html">рд╡рд┐рдВрдбреЛрдЬ 1809 рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдирд╛ (рдХрднреА-рдХрднреА) рдПрдХ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИ</a></li>
<li><a href="../hi425461/index.html">рдбреЗрд╡реЛрдкреНрд╕ рдПрдВрдб рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА: рд╕реЗрда рд╡рд╛рд░рдЧреЛ рдФрд░ рд▓рд┐рдЬрд╝ рд░рд╛рдЗрд╕ рдХреЗ рд╕рд╛рде рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░</a></li>
<li><a href="../hi425465/index.html">рдПрдХ рдбрд┐рдЬрд╛рдЗрдирд░ рдХреИрд╕реЗ рдЕрдзрд┐рдХ рдХрдорд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рдиреЗ рдФрд░ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрджрд░реНрд╢ рдЙрдкрдХрд░рдг</a></li>
<li><a href="../hi425467/index.html">рдЗрдВрдЬрди рд░реЗрдиреЙрд▓реНрдЯ рдбреА 4 рдПрдл> рдмреА 4 рдбреА (рдЙрд░реНрдл рдПрд╕рд╕реА)ред рдкреАрдврд╝реАрдЧрдд рдмрджрд▓рд╛рд╡ред рдореЛрдЯрд░ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓рд╛ рджреЗрдЦреЛ</a></li>
<li><a href="../hi425469/index.html">рдЕрдЬрдЧрд░ рд▓реЗрдЦрдХ рдЕрдм рд╡рд┐рдХрд╛рд╕ рдХрд╛ рдиреЗрддреГрддреНрд╡ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдХреНрдпрд╛ рдпрд╣ рднрд╛рд╖рд╛ рдХреЛ рдмреЗрд╣рддрд░ рдпрд╛ рдмрджрддрд░ рдмрдирд╛ рджреЗрдЧрд╛?</a></li>
<li><a href="../hi425471/index.html">рдкрд╛рдпрдерди рдореЗрдВ рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛</a></li>
<li><a href="../hi425473/index.html">рдкрд╛рдЗрдерди рдФрд░ рд╕рдВрдЪрд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдореНрдореЗрд▓рди</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>