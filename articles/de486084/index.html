<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏾‍🤝‍🧑🏻 🙌 🌵 Ersetzen kleinerer Festplatten durch größere Festplatten unter Linux 🍪 🏴󠁧󠁢󠁳󠁣󠁴󠁿 🧙🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits. Im Vorgriff auf den Start einer neuen Gruppe des Linux-Administratorkurses veröffentlichen wir nützliches Material, das von unserem ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ersetzen kleinerer Festplatten durch größere Festplatten unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/486084/">  <i>Hallo allerseits.</i>  <i>Im Vorgriff auf den Start einer neuen Gruppe des <a href="https://otus.pw/RDsq/">Linux-Administratorkurses veröffentlichen wir</a> nützliches Material, das von unserem Studenten sowie dem Kurs-Mentor Roman Travin, dem Spezialisten für technischen Support für Produkte von REG.RU, verfasst wurde.</i> <br><br>  In diesem Artikel werden zwei Fälle beschrieben, in denen Festplatten ausgetauscht und Informationen auf neue, größere Festplatten übertragen werden, wobei das Array und das Dateisystem weiter erweitert werden.  Der erste Fall betrifft den Austausch von Datenträgern mit demselben MBR / MBR- oder GPT / GPT-Markup, der zweite Fall den Austausch von Datenträgern mit MBR-Markierung für Datenträger mit einer Kapazität von mehr als 2 TB, für die ein GPT-Markup mit der Biosboot-Partition erforderlich ist.  In beiden Fällen sind die Datenträger, auf die wir Daten übertragen, bereits auf dem Server installiert.  Das für die Root-Partition verwendete Dateisystem ist ext4. <br><br><hr><a name="habracut"></a><br><h3>  Fall 1: Ersetzen kleinerer Laufwerke durch größere Laufwerke (bis zu 2 TB) </h3><br>  <b>Aufgabe:</b> Ersetzen Sie aktuelle Festplatten durch größere Festplatten (bis zu 2 TB) mit Informationsübertragung.  In diesem Fall verfügen wir über 2 x 240 GB SSD-Festplatten (RAID-1) mit dem installierten System und 2 x 1 TB SATA-Festplatten, auf die Sie das System übertragen müssen. <br><br>  Betrachten Sie das aktuelle Festplattenlayout. <br><br><pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sda2 8:2 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 931,5G 0 disk sdd 8:48 0 931,5G 0 disk</span></span></code> </pre> <br>  Überprüfen Sie den aktuell verwendeten Dateisystemspeicher. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># df -h      % C  devtmpfs 32G 0 32G 0% /dev tmpfs 32G 0 32G 0% /dev/shm tmpfs 32G 9,6M 32G 1% /run tmpfs 32G 0 32G 0% /sys/fs/cgroup /dev/mapper/vg0-root 204G 1,3G 192G 1% / /dev/md126 1007M 120M 837M 13% /boot tmpfs 6,3G 0 6,3G 0% /run/user/0</span></span></code> </pre> <br>  Die Größe des Dateisystems vor dem Ersetzen der Festplatten beträgt 204 GB. Es werden 2 Software-md126-Arrays verwendet, die in <code>/boot</code> <code>md127</code> , und <code>md127</code> , das als <i>physisches Volume</i> für die VG-Gruppe <i>vg0 verwendet wird</i> . <br><br><h4>  1. Entfernen von Festplattenpartitionen aus Arrays </h4><br>  Überprüfen Sie den Status des Arrays <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sda1[0] sdb1[1] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sda2[0] sdb2[1] 233206784 blocks super 1.2 [2/2] [UU] bitmap: 0/2 pages [0KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Das System verwendet 2 Arrays: <code>md126</code> (Einhängepunkt <code>/boot</code> ) - besteht aus den <code>md127</code> <code>/dev/sda1</code> und <code>/dev/sdb1</code> , <code>md127</code> (LVM für <i>Swap</i> und Root des Dateisystems) - besteht aus <code>/dev/sda2</code> und <code>/dev/sdb2</code> . <br><br>  Wir markieren die Partitionen der ersten Festplatte, die in jedem Array verwendet werden, als fehlerhaft. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --fail /dev/sda1 mdadm /dev/md127 --fail /dev/sda2</code> </pre><br>  Wir entfernen Abschnitte des Blocks device / dev / sda aus Arrays. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --remove /dev/sda1 mdadm /dev/md127 --remove /dev/sda2</code> </pre> <br>  Nachdem wir die Festplatte aus dem Array entfernt haben, sehen die Informationen zu Blockgeräten folgendermaßen aus. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 931,5G 0 disk sdd 8:48 0 931,5G 0 disk</span></span></code> </pre> <br>  Der Status von Arrays nach dem Entfernen von Datenträgern. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdb1[1] 1047552 blocks super 1.2 [2/1] [_U] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdb2[1] 233206784 blocks super 1.2 [2/1] [_U] bitmap: 1/2 pages [4KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br><h4>  2. Kopieren der Partitionstabelle auf eine neue Festplatte </h4><br>  Sie können die auf der Festplatte verwendete Partitionstabelle mit dem folgenden Befehl überprüfen. <br><br><pre> <code class="bash hljs">fdisk -l /dev/sdb | grep <span class="hljs-string"><span class="hljs-string">'Disk label type'</span></span></code> </pre><br>  Die Ausgabe für den MBR lautet: <br><br><pre> <code class="bash hljs">Disk label <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: dos</code> </pre> <br>  für GPT: <br><br><pre> <code class="bash hljs">Disk label <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: gpt</code> </pre> <br>  <b>Markup-Tabelle für MBR kopieren:</b> <b><br></b> <br><pre> <code class="bash hljs">sfdisk -d /dev/sdb | sfdisk /dev/sdc</code> </pre> <br>  Bei diesem Befehl ist das <b>erste</b> das Laufwerk, <b>von</b> <b>dem das</b> Markup kopiert wird, und das <b>zweite das zu</b> kopierende Laufwerk. <br><br><blockquote>  <b>ACHTUNG</b> : Bei GPT wird zuerst das Laufwerk angegeben, auf das das Markup kopiert werden <b>soll</b> , und dann das Laufwerk, <b>auf</b> das das Markup vom <b>zweiten</b> Laufwerk kopiert werden soll.  Wenn Sie die Datenträger vertauschen, wird das ursprünglich fehlerfreie Markup überschrieben und zerstört. <br></blockquote><br>  <b>Kopieren der Markup-Tabelle für das GPT:</b> <b><br></b> <br><pre> <code class="bash hljs">sgdisk -R /dev/sd /dev/sdb</code> </pre> <br>  Weisen Sie als Nächstes der Festplatte eine zufällige UUID zu (für GPT). <br><br><pre> <code class="bash hljs">sgdisk -G /dev/sdc</code> </pre> <br>  Nachdem der Befehl ausgeführt wurde, sollten Partitionen auf der Festplatte <code>/dev/sdc</code> werden. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part └─sdc2 8:34 0 222,5G 0 part sdd 8:48 0 931,5G 0 disk</span></span></code> </pre> <br>  Wenn nach der ausgeführten Aktion die Partitionen im System auf der <code>/dev/sdc</code> Platte nicht definiert sind, führen wir den Befehl zum erneuten Lesen der Partitionstabelle aus. <br><br><pre> <code class="bash hljs">sfdisk -R /dev/sdc</code> </pre> <br>  Wenn die aktuellen Datenträger die MBR-Tabelle verwenden und die Informationen auf Datenträger mit einer Kapazität von mehr als 2 TB übertragen werden müssen, müssen neue Datenträger mithilfe des Biosboot-Abschnitts manuell ein GPT-Markup erstellen.  Dieser Fall wird in Teil 2 dieses Artikels behandelt. <br><br><h4>  3. Hinzufügen von Partitionen der neuen Festplatte zum Array </h4><br>  Fügen Sie den entsprechenden Arrays Festplattenpartitionen hinzu. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --add /dev/sdc1 mdadm /dev/md127 --add /dev/sdc2</code> </pre> <br>  Überprüfen Sie, ob Abschnitte hinzugefügt wurden. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk</span></span></code> </pre> <br>  Danach warten wir auf die Synchronisation der Arrays. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdc1[2] sdb1[1] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdc2[2] sdb2[1] 233206784 blocks super 1.2 [2/1] [_U] [==&gt;..................] recovery = 10.6% (24859136/233206784) finish=29.3min speed=118119K/sec bitmap: 2/2 pages [8KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Sie können den Synchronisierungsvorgang mit dem Überwachungsdienstprogramm kontinuierlich überwachen. <br><br><pre> <code class="bash hljs">watch -n 2 cat /proc/mdstat</code> </pre> <br>  Die <code>-n</code> gibt an, in welchen Intervallen in Sekunden der Befehl ausgeführt werden muss, um den Fortschritt zu überprüfen. <br><br>  <b>Wiederholen Sie die Schritte 1 bis 3 für das nächste Ersatzlaufwerk.</b> <br><br>  Wir markieren die Partitionen der zweiten Festplatte, die in jedem Array verwendet werden, als fehlerhaft. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --fail /dev/sdb1 mdadm /dev/md127 --fail /dev/sdb2</code> </pre><br>  Wir entfernen Abschnitte des Blockgerätes <code>/dev/sdb</code> aus Arrays. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --remove /dev/sdb1 mdadm /dev/md127 --remove /dev/sdb2</code> </pre> <br>  Nachdem wir die Festplatte aus dem Array entfernt haben, sehen die Informationen zu Blockgeräten folgendermaßen aus. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk</span></span></code> </pre><br>  Der Status von Arrays nach dem Entfernen von Datenträgern. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdc1[2] 1047552 blocks super 1.2 [2/1] [U_] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdc2[2] 233206784 blocks super 1.2 [2/1] [U_] bitmap: 1/2 pages [4KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Kopieren Sie die MBR-Markup-Tabelle vom Laufwerk <code>/dev/sd</code> auf das Laufwerk <code>/dev/sdd</code> . <br><br><pre> <code class="bash hljs">sfdisk -d /dev/sd | sfdisk /dev/sdd</code> </pre> <br>  Nachdem der Befehl ausgeführt wurde, sollten Partitionen auf dem Laufwerk <code>/dev/sdd</code> . <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk ├─sdd1 8:49 0 1G 0 part └─sdd2 8:50 0 222,5G 0 part</span></span></code> </pre> <br>  Fügen Sie den Arrays Festplattenpartitionen hinzu. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --add /dev/sdd1 mdadm /dev/md127 --add /dev/sdd2</code> </pre> <br>  Überprüfen Sie, ob Abschnitte hinzugefügt wurden. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk ├─sdd1 8:49 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdd2 8:50 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre> <br>  Danach warten wir auf die Synchronisation der Arrays. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdd1[3] sdc1[2] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdd2[3] sdc2[2] 233206784 blocks super 1.2 [2/1] [U_] [&gt;....................] recovery = 0.5% (1200000/233206784) finish=35.4min speed=109090K/sec bitmap: 2/2 pages [8KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre><br><h4>  5. Installieren Sie GRUB auf neuen Laufwerken </h4><br>  Für CentOS: <br><br><pre> <code class="bash hljs">grub2-install /dev/sdX</code> </pre> <br>  Für Debian / Ubuntu: <br><br><pre> <code class="bash hljs">grub-install /dev/sdX</code> </pre> <br>  Dabei ist <code>X</code> der Buchstabe des Blockgeräts.  In diesem Fall installieren Sie GRUB unter <code>/dev/sdc</code> und <code>/dev/sdd</code> . <br><br><h4>  6. Erweiterung des Dateisystems (ext4) der Root-Partition </h4><br>  931,5 GB sind auf den neuen Laufwerken <code>/dev/sdc</code> und <code>/dev/sdd</code> .  Da die Partitionstabelle von kleineren Festplatten kopiert wird, sind auf den Partitionen <code>/dev/sdc2</code> und <code>/dev/sdd2</code> 222,5 GB verfügbar. <br><br><pre> <code class="bash hljs">sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk ├─sdd1 8:49 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdd2 8:50 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</code> </pre> <br>  Es ist notwendig: <br><br><ol><li>  Erweitern Sie Abschnitt 2 auf jedem Laufwerk. </li><li>  Erweitern Sie das md127-Array, </li><li>  Erweitern Sie PV (physikalisches Volumen), </li><li>  LV (Logical-Volume) vg0-root erweitern, </li><li>  Erweitern Sie das Dateisystem. </li></ol><br>  Erweitern Sie mit dem Dienstprogramm <code>/dev/sdc2</code> auf den Maximalwert.  <code>parted /dev/sdc</code> Befehl <code>parted /dev/sdc</code> (1) aus und zeigen die aktuelle Partitionstabelle mit dem Befehl <code>p</code> (2) an. <br><br><img src="https://habrastorage.org/webt/ao/zx/xc/aozxxc_zhq42me4qblnij5bib4y.png"><br><br>  Wie Sie sehen, endet das Ende von Abschnitt 2 mit 240 GB.  Erweitern wir den Abschnitt mit dem Befehl <code>resizepart</code> <code>2</code> , wobei 2 die Abschnittsnummer (3) ist.  Wir geben den Wert in digitalem Format an, zum Beispiel 1000 GB, oder wir verwenden die Angabe der Festplattenfreigabe - 100%.  Wir überprüfen erneut, ob der Abschnitt eine neue Größe hat (4). <br><br>  Wiederholen Sie die obigen Schritte für das Laufwerk <code>/dev/sdd</code> .  Nach dem Erweitern der Partitionen wurden <code>/dev/sdc2</code> und <code>/dev/sdd2</code> gleich 930,5 GB. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 930,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk ├─sdd1 8:49 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdd2 8:50 0 930,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre> <br>  Danach erweitern wir das <i>md127-</i> Array auf das Maximum. <br><br><pre> <code class="bash hljs">mdadm --grow /dev/md127 --size=max</code> </pre> <br>  Überprüfen Sie, ob das Array erweitert wurde.  Jetzt ist seine Größe 930,4 GB geworden. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 931,5G 0 disk ├─sdc1 8:33 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc2 8:34 0 930,5G 0 part └─md127 9:127 0 930,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 931,5G 0 disk ├─sdd1 8:49 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdd2 8:50 0 930,5G 0 part └─md127 9:127 0 930,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre> <br>  Wir führen die Erweiterung des <i>physischen Volumens durch</i> .  Überprüfen Sie vor der Erweiterung den aktuellen Status der PV. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># pvscan PV /dev/md127 VG vg0 lvm2 [222,40 GiB / 0 free] Total: 1 [222,40 GiB] / in use: 1 [222,40 GiB] / in no VG: 0 [0 ]</span></span></code> </pre><br>  Wie Sie sehen, belegt PV <code>/dev/md127</code> 222,4 GB Speicherplatz. <br><br>  Erweitern Sie PV mit dem folgenden Befehl. <br><br><pre> <code class="bash hljs">pvresize /dev/md127</code> </pre> <br>  Überprüfen Sie das Ergebnis der PV-Erweiterung. <br><br>  [ <pre> <code class="bash hljs">root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># pvscan PV /dev/md127 VG vg0 lvm2 [930,38 GiB / 707,98 GiB free] Total: 1 [930,38 GiB] / in use: 1 [930,38 GiB] / in no VG: 0 [0 ]</span></span></code> </pre> <br>  <i>Logisches Volume erweitern</i> .  Überprüfen Sie vor der Erweiterung den aktuellen Status von LV (1). <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lvscan ACTIVE '/dev/vg0/swap' [&lt;16,00 GiB] inherit ACTIVE '/dev/vg0/root' [&lt;206,41 GiB] inherit</span></span></code> </pre> <br>  LV <code>/dev/vg0/root</code> verwendet 206,41 GB. <br><br>  Wir erweitern LV mit dem folgenden Befehl (2). <br><br><pre> <code class="bash hljs">lvextend -l +100%FREE /dev/mapper/vg0-root</code> </pre> <br><br>  Überprüfen Sie die ausgeführte Aktion (3). <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lvscan ACTIVE '/dev/vg0/swap' [&lt;16,00 GiB] inherit ACTIVE '/dev/vg0/root' [&lt;914,39 GiB] inherit</span></span></code> </pre><br>  Wie Sie sehen, betrug der belegte Speicherplatz nach der LV-Erweiterung 914,39 GB. <br><br><img src="https://habrastorage.org/webt/vd/6r/qh/vd6rqhe3wvbukzdfachz7xf4ehk.png"><br><br>  Das LV-Volumen hat zugenommen (4), das Dateisystem belegt jedoch immer noch 204 GB (5). <br><br>  <i>1. Führen Sie die Dateisystemerweiterung durch.</i> <br><br><pre> <code class="bash hljs">resize2fs /dev/mapper/vg0-root</code> </pre> <br>  Wir überprüfen nach dem ausgeführten Befehl die Größe des Dateisystems. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># df -h      % C  devtmpfs 32G 0 32G 0% /dev tmpfs 32G 0 32G 0% /dev/shm tmpfs 32G 9,5M 32G 1% /run tmpfs 32G 0 32G 0% /sys/fs/cgroup /dev/mapper/vg0-root 900G 1,3G 860G 1% / /dev/md126 1007M 120M 837M 13% /boot tmpfs 6,3G 0 6,3G 0% /run/user/0</span></span></code> </pre> <br>  Die Größe des Root-Dateisystems wird auf 900 GB erhöht.  Nachdem Sie die Schritte ausgeführt haben, können Sie die alten Discs entfernen. <br><br><h3>  Fall 2: Ersetzen kleinerer Laufwerke durch größere Laufwerke (mehr als 2 TB) </h3><br>  <b>Aufgabe:</b> Ersetzen Sie aktuelle Datenträger durch größere Datenträger (2 x 3 TB), indem Sie Informationen speichern.  In diesem Fall verfügen wir über 2 x 240 GB SSD-Festplatten (RAID-1) mit dem installierten System und 2 x 3 TB SATA-Festplatten, auf die Sie das System übertragen müssen.  Aktuelle Laufwerke verwenden die MBR-Partitionstabelle.  Da neue Festplatten eine Kapazität von mehr als 2 TB haben, müssen sie die GPT-Tabelle verwenden, da MBR nicht mit Festplatten arbeiten kann, die größer als 2 TB sind. <br><br>  Zeigen Sie das aktuelle Festplattenlayout an. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sda2 8:2 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 2,7T 0 disk sdd 8:48 0 2,7T 0 disk</span></span></code> </pre> <br>  Überprüfen Sie die Partitionstabelle, die auf dem Laufwerk <code>/dev/sda</code> . <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># fdisk -l /dev/sda | grep 'Disk label type' Disk label type: dos</span></span></code> </pre> <br>  Das Laufwerk <code>/dev/sdb</code> verwendet eine ähnliche Partitionstabelle.  Überprüfen Sie den verwendeten Speicherplatz im System. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># df -h      % C  devtmpfs 16G 0 16G 0% /dev tmpfs 16G 0 16G 0% /dev/shm tmpfs 16G 9,5M 16G 1% /run tmpfs 16G 0 16G 0% /sys/fs/cgroup /dev/mapper/vg0-root 204G 1,3G 192G 1% / /dev/md126 1007M 120M 837M 13% /boot tmpfs 3,2G 0 3,2G 0% /run/user/0</span></span></code> </pre> <br>  Wie Sie sehen, ist das Stammverzeichnis des Dateisystems 204 GB.  Überprüfen Sie den aktuellen Status des Software-RAID. <br><br><h4>  1. Installieren Sie die GPT-Partitionstabelle und die Festplattenpartitionierung </h4><br>  Überprüfen Sie das Festplattenlayout nach Sektor. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># parted /dev/sda print : ATA KINGSTON SVP200S (scsi)  /dev/sda: 240GB   (./.): 512B/512B  : msdos Disk Flags:         1 1049kB 1076MB 1075MB primary , raid 2 1076MB 240GB 239GB primary raid</span></span></code> </pre><br>  Auf dem neuen 3-TB-Laufwerk müssen drei Partitionen erstellt werden: <br><br><ol><li>  <code>bios_grub</code> Abschnitt für die GPT-Kompatibilität mit dem BIOS, </li><li>  Die Partition für das RAID-Array, die in <code>/boot</code> eingehängt werden soll. </li><li>  Die Partition für das RAID-Array, auf der sich <i>LV-Root</i> und <i>LV-Swap befinden</i> . </li></ol><br>  Installieren Sie das Dienstprogramm <i>parted mit dem</i> Befehl <code>yum install -y parted</code> (für CentOS), <code>apt install -y parted</code> (für Debian / Ubuntu). <br><br>  Führen Sie mit <i>parted</i> die folgenden Befehle aus, um die Festplatte zu partitionieren. <br><br>  <code>parted /dev/sdc</code> Befehl <code>parted /dev/sdc</code> und wechseln in den Bearbeitungsmodus für das Festplattenlayout. <br><br>  Erstellen Sie eine GPT-Partitionstabelle. <br><br><pre> <code class="bash hljs">(parted) mktable gpt</code> </pre> <br>  Erstelle 1 Sektion <code>bios_grub</code> Sektion und setze ein Flag dafür. <br><br><pre> <code class="bash hljs">(parted) mkpart primary 1MiB 3MiB (parted) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 1 bios_grub on</code> </pre> <br>  Erstellen Sie einen Abschnitt 2 und setzen Sie ein Flag dafür.  Die Partition wird als Block für das RAID-Array verwendet und in <code>/boot</code> . <br><br><pre> <code class="bash hljs">(parted) mkpart primary ext2 3MiB 1028MiB (parted) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 2 boot on</code> </pre> <br>  Wir erstellen einen 3-Abschnitt, der auch als Array-Block verwendet wird, in dem sich LVM befindet. <br><br><pre> <code class="bash hljs">(parted) mkpart primary 1028MiB 100%</code> </pre> <br>  In diesem Fall ist das Setzen des Flags nicht erforderlich, es kann jedoch bei Bedarf mit dem folgenden Befehl gesetzt werden. <br><br><pre> <code class="bash hljs">(parted) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> 3 raid on</code> </pre> <br>  Überprüfen Sie die erstellte Tabelle. <br><br><pre> <code class="bash hljs">(parted) p : ATA TOSHIBA DT01ACA3 (scsi)  /dev/sdc: 3001GB   (./.): 512B/4096B  : gpt Disk Flags:         1 1049kB 3146kB 2097kB primary bios_grub 2 3146kB 1077MB 1074MB primary  3 1077MB 3001GB 3000GB primary</code> </pre><br>  Weisen Sie dem Laufwerk eine neue zufällige GUID zu. <br><br><pre> <code class="bash hljs">sgdisk -G /dev/sdd</code> </pre><br><h4>  2. Entfernen von Partitionen der ersten Festplatte aus Arrays </h4><br>  Überprüfen Sie den Status des Arrays <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sda1[0] sdb1[1] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sda2[0] sdb2[1] 233206784 blocks super 1.2 [2/2] [UU] bitmap: 0/2 pages [0KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Das System verwendet 2 Arrays: md126 (Einhängepunkt / boot) - besteht aus <code>/dev/sda1</code> und <code>/dev/sdb1</code> , <code>md127</code> (LVM für <code>swap</code> und Root des Dateisystems) - besteht aus <code>/dev/sda2</code> und <code>/dev/sdb2</code> . <br><br>  Wir markieren die Partitionen der ersten Festplatte, die in jedem Array verwendet werden, als fehlerhaft. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --fail /dev/sda1 mdadm /dev/md127 --fail /dev/sda2</code> </pre> <br>  Wir entfernen Abschnitte des Blocks device <code>/dev/sda</code> aus Arrays. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --remove /dev/sda1 mdadm /dev/md127 --remove /dev/sda2</code> </pre><br>  Überprüfen Sie den Status des Arrays, nachdem Sie die Festplatte entfernt haben. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdb1[1] 1047552 blocks super 1.2 [2/1] [_U] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdb2[1] 233206784 blocks super 1.2 [2/1] [_U] bitmap: 2/2 pages [8KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre><br><h4>  3. Hinzufügen von Partitionen der neuen Festplatte zum Array </h4><br>  Der nächste Schritt ist das Hinzufügen der Partitionen der neuen Festplatte zu den Arrays zur Synchronisierung.  Wir schauen uns den aktuellen Stand des Festplattenlayouts an. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part └─sdc3 8:35 0 2,7T 0 part sdd 8:48 0 2,7T 0 disk</span></span></code> </pre> <br>  Die <code>/dev/sdc1</code> ist eine <code>bios_grub</code> Partition und nicht an der Erstellung von Arrays beteiligt.  <code>/dev/sdc2</code> nur <code>/dev/sdc2</code> und <code>/dev/sdc3</code> .  Fügen Sie diese Abschnitte den entsprechenden Arrays hinzu. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --add /dev/sdc2 mdadm /dev/md127 --add /dev/sdc3</code> </pre> <br>  Dann warten wir auf die Synchronisation des Arrays. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdc2[2] sdb1[1] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 0/1 pages [0KB], 65536KB chunk md127 : active raid1 sdc3[2] sdb2[1] 233206784 blocks super 1.2 [2/1] [_U] [&gt;....................] recovery = 0.2% (619904/233206784) finish=31.2min speed=123980K/sec bitmap: 2/2 pages [8KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Partitionieren von Festplatten nach dem Hinzufügen von Partitionen zu einem Array. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdb2 8:18 0 222,5G 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc3 8:35 0 2,7T 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 2,7T 0 disk</span></span></code> </pre> <br><h4>  4. Entfernen von Partitionen der zweiten Festplatte aus Arrays </h4><br>  Wir markieren die Partitionen der zweiten Festplatte, die in jedem Array verwendet werden, als fehlerhaft. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --fail /dev/sdb1 mdadm /dev/md127 --fail /dev/sdb2</code> </pre><br>  Wir entfernen Abschnitte des Blocks device <code>/dev/sda</code> aus Arrays. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --remove /dev/sdb1 mdadm /dev/md127 --remove /dev/sdb2</code> </pre><br><h4>  5. Kopieren Sie die GPT-Markup-Tabelle und synchronisieren Sie das Array </h4><br>  Um die GPT-Markup-Tabelle zu kopieren, verwenden wir das Dienstprogramm <code>sgdisk</code> , das im Paket für die Arbeit mit Festplattenpartitionen und der GPT-Tabelle - <code>gdisk</code> . <br><br>  Installieren Sie <code>gdisk</code> für CentOS: <br><br><pre> <code class="bash hljs">yum install -y gdisk</code> </pre> <br>  Installieren Sie die <code>gdisk</code> für Debian / Ubuntu: <br><br><pre> <code class="bash hljs">apt install -y gdisk</code> </pre> <br><blockquote>  <b>ACHTUNG</b> : Bei GPT wird zuerst der Datenträger angegeben, <b>auf den das</b> Markup kopiert wird. Der <b>zweite</b> Datenträger ist der Datenträger, <b>von dem das</b> Markup kopiert wird.  Wenn Sie die Datenträger vertauschen, wird das ursprünglich fehlerfreie Markup überschrieben und zerstört. <br></blockquote><br>  Kopieren Sie die GPT-Markup-Tabelle. <br><br><pre> <code class="bash hljs">sgdisk -R /dev/sdd /dev/sdc</code> </pre> <br>  Partitionieren von Festplatten nach dem Übertragen einer Tabelle auf das Laufwerk <code>/dev/sdd</code> . <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc3 8:35 0 2,7T 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 2,7T 0 disk ├─sdd1 8:49 0 2M 0 part ├─sdd2 8:50 0 1G 0 part └─sdd3 8:51 0 2,7T 0 part</span></span></code> </pre> <br>  Als Nächstes fügen wir jede der an den Software-RAID-Arrays beteiligten Partitionen hinzu. <br><br><pre> <code class="bash hljs">mdadm /dev/md126 --add /dev/sdd2 mdadm /dev/md127 --add /dev/sdd3</code> </pre> <br>  Wir warten auf die Synchronisation des Arrays. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># cat /proc/mdstat Personalities : [raid1] md126 : active raid1 sdd2[3] sdc2[2] 1047552 blocks super 1.2 [2/2] [UU] bitmap: 1/1 pages [4KB], 65536KB chunk md127 : active raid1 sdd3[3] sdc3[2] 233206784 blocks super 1.2 [2/1] [U_] [&gt;....................] recovery = 0.0% (148224/233206784) finish=26.2min speed=148224K/sec bitmap: 2/2 pages [8KB], 65536KB chunk unused devices: &lt;none&gt;</span></span></code> </pre> <br>  Nach dem Kopieren des GPT-Markups auf einen zweiten neuen Datenträger sieht das Markup folgendermaßen aus. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk ├─sda1 8:1 0 1G 0 part └─sda2 8:2 0 222,5G 0 part sdb 8:16 0 223,6G 0 disk ├─sdb1 8:17 0 1G 0 part └─sdb2 8:18 0 222,5G 0 part sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdc3 8:35 0 2,7T 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 2,7T 0 disk ├─sdd1 8:49 0 2M 0 part ├─sdd2 8:50 0 1G 0 part │ └─md126 9:126 0 1023M 0 raid1 /boot └─sdd3 8:51 0 2,7T 0 part └─md127 9:127 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre> <br>  Installieren Sie als Nächstes GRUB auf den neuen Laufwerken. <br><br>  Installation für CentOS: <br><br><pre> <code class="bash hljs">grub2-install /dev/sdX</code> </pre> <br>  Installation für Debian / Ubuntu: <br><br><pre> <code class="bash hljs">grub-install /dev/sdX</code> </pre> <br>  wobei <code>X</code> der Laufwerksbuchstabe ist, in unserem Fall die Laufwerke <code>/dev/sdc</code> und <code>/dev/sdd</code> . <br><br>  Aktualisieren der Informationen zum Array. <br><br>  Für CentOS: <br><br><pre> <code class="bash hljs">mdadm --detail --scan --verbose &gt; /etc/mdadm.conf</code> </pre> <br>  Für Debian / Ubuntu: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"DEVICE partitions"</span></span> &gt; /etc/mdadm/mdadm.conf mdadm --detail --scan --verbose | awk <span class="hljs-string"><span class="hljs-string">'/ARRAY/ {print}'</span></span> &gt;&gt; /etc/mdadm/mdadm.conf</code> </pre> <br>  Aktualisieren des <code>initrd</code> Image: <br>  Für CentOS: <br><br><pre> <code class="bash hljs">dracut -f -v --regenerate-all</code> </pre> <br>  Für Debian / Ubuntu: <br><br><pre> <code class="bash hljs">update-initramfs -u -k all</code> </pre> <br>  Aktualisieren der GRUB-Konfiguration. <br><br>  Für CentOS: <br><br><pre> <code class="bash hljs">grub2-mkconfig -o /boot/grub2/grub.cfg</code> </pre><br>  Für Debian / Ubuntu: <br><br><pre> <code class="bash hljs">update-grub</code> </pre> <br>  Nach den Schritten können Sie die alten Discs entfernen. <br><br><h4>  6. Erweiterung des Dateisystems (ext4) der Root-Partition </h4><br>  Partitionieren von Festplatten vor dem Erweitern des Dateisystems nach dem Verschieben des Systems auf RAID-1-Festplatten (2 x 3 TB). <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk sdb 8:16 0 223,6G 0 disk sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part │ └─md127 9:127 0 1023M 0 raid1 /boot └─sdc3 8:35 0 2,7T 0 part └─md126 9:126 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 2,7T 0 disk ├─sdd1 8:49 0 2M 0 part ├─sdd2 8:50 0 1G 0 part │ └─md127 9:127 0 1023M 0 raid1 /boot └─sdd3 8:51 0 2,7T 0 part └─md126 9:126 0 222,4G 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre> <br>  Die <code>/dev/sdd3</code> <code>/dev/sdc3</code> und <code>/dev/sdd3</code> belegen <code>/dev/sdd3</code> 2,7 TB.  Da wir eine neue Partitionierung von Festplatten mit der GPT-Tabelle erstellt haben, wurde die Größe der 3 Partitionen sofort auf den maximal möglichen Festplattenspeicher festgelegt. In diesem Fall ist das Erweitern der Partition nicht erforderlich. <br><br>  Es ist notwendig: <br><br><ol><li>  Erweitern Sie das md126-Array, </li><li>  Erweitern Sie PV (physikalisches Volumen), </li><li>  LV (Logical-Volume) vg0-root erweitern, </li><li>  Erweitern Sie das Dateisystem. </li></ol><br>  <i>1. <code>md126</code> Array bis zum Maximum.</i> <br><br><pre> <code class="bash hljs">mdadm --grow /dev/md126 --size=max</code> </pre><br>  Nach der Erweiterung des <code>md126</code> Arrays <code>md126</code> Größe des belegten Speicherplatzes auf 2,7 TB. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 223,6G 0 disk sdb 8:16 0 223,6G 0 disk sdc 8:32 0 2,7T 0 disk ├─sdc1 8:33 0 2M 0 part ├─sdc2 8:34 0 1G 0 part │ └─md127 9:127 0 1023M 0 raid1 /boot └─sdc3 8:35 0 2,7T 0 part └─md126 9:126 0 2,7T 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP] sdd 8:48 0 2,7T 0 disk ├─sdd1 8:49 0 2M 0 part ├─sdd2 8:50 0 1G 0 part │ └─md127 9:127 0 1023M 0 raid1 /boot └─sdd3 8:51 0 2,7T 0 part └─md126 9:126 0 2,7T 0 raid1 ├─vg0-root 253:0 0 206,4G 0 lvm / └─vg0-swap 253:1 0 16G 0 lvm [SWAP]</span></span></code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Ausbau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Physikalisches Volumens</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor der Erweiterung prüfen wir den aktuellen Wert des belegten Platzes PV / </font></font><code>dev/md126</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># pvs PV VG Fmt Attr PSize PFree /dev/md126 vg0 lvm2 a-- 222,40g 0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erweitern Sie PV mit dem folgenden Befehl. </font></font><br><br><pre> <code class="bash hljs">pvresize /dev/md126</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfen Sie die abgeschlossene Aktion. </font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># pvs PV VG Fmt Attr PSize PFree /dev/md126 vg0 lvm2 a-- &lt;2,73t 2,51t</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expanding - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klasse logischen Volume vg0-root</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach der Erweiterung von PV überprüfen wir den belegten Raum von VG.</font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># vgs VG #PV #LV #SN Attr VSize VFree vg0 1 2 0 wz--n- &lt;2,73t 2,51t</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfen Sie den von LV belegten Platz. </font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert root vg0 -wi-ao---- &lt;206,41g swap vg0 -wi-ao---- &lt;16,00g</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das vg0-root-Volume nimmt 206,41 GB auf. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweitern Sie LV auf den maximalen Speicherplatz.</font></font><br><br><pre> <code class="bash hljs">lvextend -l +100%FREE /dev/mapper/vg0-root</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfen des LV-Speicherplatzes nach der Erweiterung. </font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert root vg0 -wi-ao---- 2,71t swap vg0 -wi-ao---- &lt;16,00g</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dateisystem erweitern (ext4). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überprüfen Sie die aktuelle Dateisystemgröße.</font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># df -h      % C  devtmpfs 16G 0 16G 0% /dev tmpfs 16G 0 16G 0% /dev/shm tmpfs 16G 9,6M 16G 1% /run tmpfs 16G 0 16G 0% /sys/fs/cgroup /dev/mapper/vg0-root 204G 1,4G 192G 1% / /dev/md127 1007M 141M 816M 15% /boot tmpfs 3,2G 0 3,2G 0% /run/user/0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Volume / dev / mapper / vg0-root belegt nach der LV-Erweiterung 204 GB. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Dateisystem erweitern.</font></font><br><br><pre> <code class="bash hljs">resize2fs /dev/mapper/vg0-root</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfen Sie die Größe des Dateisystems nach seiner Erweiterung. </font></font><br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># df -h      % C  devtmpfs 16G 0 16G 0% /dev tmpfs 16G 0 16G 0% /dev/shm tmpfs 16G 9,6M 16G 1% /run tmpfs 16G 0 16G 0% /sys/fs/cgroup /dev/mapper/vg0-root 2,7T 1,4G 2,6T 1% / /dev/md127 1007M 141M 816M 15% /boot tmpfs 3,2G 0 3,2G 0% /run/user/0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Größe des Dateisystems wird um das gesamte Volume des Volumes erhöht. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486084/">https://habr.com/ru/post/de486084/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486062/index.html">Einfaches Zero-Copy-Rendering hardwarebeschleunigter Videos in QML</a></li>
<li><a href="../de486064/index.html">Erstellen Sie eine animierte Diashow in reinem CSS.</a></li>
<li><a href="../de486066/index.html">Im Zugangsbereich. Finden Sie die Entfernung von einem Punkt zu einem Gebiet und reduzieren Sie Reverse Geocoding-Anforderungen</a></li>
<li><a href="../de486070/index.html">ACL-Schalter im Detail</a></li>
<li><a href="../de486080/index.html">Lassen Sie mich vorstellen: Veeam Availability Suite v10</a></li>
<li><a href="../de486100/index.html">Wie erstelle ich eine dezentrale Anwendung, die sich skalieren lässt? Verwenden Sie weniger Blockchain</a></li>
<li><a href="../de486104/index.html">MVCC in PostgreSQL-7. Autovakuum</a></li>
<li><a href="../de486106/index.html">Adaptive Hintergrundbeleuchtung für Raspberry Pi TV - Ambilight Analog</a></li>
<li><a href="../de486114/index.html">Führende Wissenschaftler auf dem Gebiet der Neurowissenschaften treffen sich auf dem jährlichen Kongress der Neuronet Industry Union</a></li>
<li><a href="../de486116/index.html">Fermat- und Miller-Rabin-Einfachheitstests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>