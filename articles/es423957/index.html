<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèø üôä üë©üèº‚Äçü§ù‚Äçüë®üèΩ Generaci√≥n de tr√°fico de espacio de usuario üë®‚Äçüë©‚Äçüë¶ üë®‚Äç‚öñÔ∏è ü§¶üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Generaci√≥n de tr√°fico con MoonGen + DPDK + Lua en la vista del artista 

 La neutralizaci√≥n de los ataques DDoS en condiciones reales requiere pruebas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generaci√≥n de tr√°fico de espacio de usuario</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qrator/blog/423957/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/d4/ab/qb/d4abqbslioh-eskinpe4jhet0y4.jpeg"></div><br>  <i>Generaci√≥n de tr√°fico con MoonGen + DPDK + Lua en la vista del artista</i> <br><br>  La neutralizaci√≥n de los ataques DDoS en condiciones reales requiere pruebas preliminares y pruebas de varias t√©cnicas.  El equipo y el software de la red deben probarse en condiciones artificiales cercanas a las reales, con flujos de tr√°fico intensivos que simulan ataques.  Sin tales experimentos, es extremadamente dif√≠cil obtener informaci√≥n confiable sobre las caracter√≠sticas y limitaciones espec√≠ficas de cualquier herramienta compleja. <br><br>  En este art√≠culo, revelaremos algunos de los m√©todos de generaci√≥n de tr√°fico utilizados en Qrator Labs. <br><br>  <b>ADVERTENCIA</b> <br><br>  Recomendamos encarecidamente que el lector no intente utilizar las herramientas mencionadas para atacar objetos de infraestructura real.  La organizaci√≥n de los ataques DoS es punible por ley y puede conducir a sanciones severas.  Qrator Labs realiza todas las pruebas en un entorno de laboratorio aislado. <br><a name="habracut"></a><br><h2>  Nivel t√©cnico moderno </h2><br>  Una tarea importante en nuestra √°rea es saturar la interfaz Ethernet 10G con paquetes peque√±os, lo que implica el procesamiento de 14.88 Mpps (millones de paquetes por segundo).  En lo sucesivo, consideramos los paquetes de red Ethernet m√°s peque√±os, 64 bytes, ya que nuestro inter√©s principal es maximizar el n√∫mero de paquetes transmitidos por unidad de tiempo.  Un c√°lculo simple muestra que solo tenemos alrededor de 67 nanosegundos para procesar uno de esos paquetes. <br><br>  Solo para comparar, esta vez est√° cerca de lo que un procesador moderno necesita para obtener un dato de la memoria si pierde el cach√©.  Todo se vuelve a√∫n m√°s complicado cuando comenzamos a trabajar con interfaces Ethernet 40G y 100G e intentamos saturarlas completamente hasta la velocidad de l√≠nea (el m√°ximo rendimiento declarado posible del dispositivo de red). <br><br>  Dado que, en el caso habitual, el flujo de datos pasa a trav√©s de la aplicaci√≥n en el espacio de usuario (espacio de usuario), luego a trav√©s del kernel, y finalmente ingresa al controlador de red (NIC), la idea primera y m√°s directa es intentar configurar la generaci√≥n de paquetes directamente en el kernel.  Un ejemplo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tal soluci√≥n</a> es el m√≥dulo nuclear <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pktgen</a> [2].  Este m√©todo le permite mejorar significativamente el rendimiento, pero no lo suficientemente flexible, ya que el m√°s m√≠nimo cambio en el c√≥digo fuente en el kernel conduce a un largo ciclo de compilaci√≥n, reinicio de los m√≥dulos del kernel o incluso todo el sistema y, de hecho, pruebas, lo que reduce la productividad general (es decir, requiere m√°s tiempo del programador y esfuerzo). <br><br>  Otro enfoque posible es obtener acceso directo desde el espacio de usuario a los b√∫feres de memoria del controlador de red.  Este camino es m√°s complicado, pero vale la pena el esfuerzo para lograr una mayor productividad.  Las desventajas incluyen alta complejidad y baja flexibilidad.  Ejemplos de este enfoque son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">netmap</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PF_RING</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DPDK</a> [4]. <br><br>  Otra forma efectiva, aunque muy costosa de lograr un alto rendimiento es utilizar equipos no universales, sino especializados.  Ejemplo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ixia</a> . <br><br>  Tambi√©n hay soluciones basadas en DPDK que utilizan scripts, lo que aumenta la flexibilidad en el control de los par√°metros del generador y tambi√©n le permite variar el tipo de paquetes generados durante el inicio.  A continuaci√≥n describimos nuestra propia experiencia con una de estas herramientas: MoonGen. <br><br><h2>  Arquitectura MoonGen </h2><br>  Las caracter√≠sticas distintivas de MoonGen son: <br><br><ol><li>  El procesamiento de datos DPDK en el espacio de usuario es la raz√≥n principal del aumento de rendimiento; </li><li>  Lua [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">5</a> ] stack con scripts simples en el nivel superior y enlaces a la biblioteca DPDK escrita en C, en la parte inferior; </li><li>  Gracias a la tecnolog√≠a JIT (justo a tiempo), los scripts Lua funcionan lo suficientemente r√°pido, lo que contradice de alguna manera las ideas generalmente aceptadas sobre la efectividad de los lenguajes de scripting. </li></ol><br>  MoonGen puede considerarse como un envoltorio Lua alrededor de la biblioteca DPDK.  Al menos las siguientes operaciones DPDK son visibles en el nivel de interfaz de usuario de Lua: <br><br><ul><li>  Configurar controladores de red; </li><li>  Asignaci√≥n y acceso directo a agrupaciones y memorias intermedias, que, para fines de optimizaci√≥n, deben asignarse en √°reas alineadas continuas; </li><li>  Acceso directo a colas RSS de controladores de red; </li><li>  API para gestionar flujos computacionales, teniendo en cuenta la heterogeneidad del acceso a la memoria (afinidad NUMA y CPU) [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">12</a> ]. </li></ul><br><img src="https://habrastorage.org/webt/qg/vh/ij/qgvhijgvyv0fe5m9vntekmwggxo.png"><br><br>  Arquitectura MoonGen, esquema del material [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> ]. <br><br><h3>  Moongen </h3><br>  MoonGen es un generador de paquetes de alta velocidad con script basado en la biblioteca DPDK.  Las secuencias de comandos Lua controlan todo el proceso: la secuencia de comandos creada por el usuario es responsable de crear, modificar y enviar paquetes.  Gracias a la muy r√°pida biblioteca de procesamiento de paquetes LuaJIT y DPDK, esta arquitectura le permite saturar una interfaz Ethernet de 10 gigabits con paquetes de 64 bytes utilizando solo un n√∫cleo de la CPU.  MoonGen le permite alcanzar esta velocidad incluso cuando el script Lua modifica cada paquete.  No utiliza trucos como reutilizar el mismo b√∫fer del controlador de red. <br><br>  MoonGen tambi√©n puede recibir paquetes, es decir, verificar qu√© paquetes fueron descartados por el sistema bajo prueba.  Dado que la recepci√≥n de paquetes est√° controlada exclusivamente por un script Lua personalizado, tambi√©n se puede usar para crear scripts de prueba m√°s complejos.  Por ejemplo, puede usar dos instancias de MoonGen para establecer una conexi√≥n entre s√≠.  Dicha configuraci√≥n se puede utilizar, en particular, para probar las llamadas cajas intermedias (equipo entre el punto de env√≠o y recepci√≥n de tr√°fico), por ejemplo, firewalls.  MoonGen se centra en cuatro √°reas principales: <br><br><ul><li>  Alto rendimiento y escalamiento de m√∫ltiples n√∫cleos: m√°s de 20 millones de paquetes por segundo en un solo n√∫cleo de CPU; </li><li>  Flexibilidad: cada paquete se genera en tiempo real basado en un script Lua creado por el usuario; </li><li>  Marcas de tiempo exactas: en hardware ordinario (de productos b√°sicos), la marca de tiempo se realiza con una precisi√≥n de milisegundos; </li><li>  Control exacto de los intervalos entre paquetes enviados: generaci√≥n confiable de los patrones y tipos de tr√°fico requeridos en el hardware ordinario. </li></ul><br><h3>  DPDK </h3><br>  DPDK significa Data Plane Development Kit y consta de bibliotecas cuyas funciones principales son aumentar el rendimiento de generaci√≥n de paquetes de red en una amplia variedad de arquitecturas de procesador central. <br><br>  En un mundo donde las redes de computadoras se est√°n convirtiendo en la base de la comunicaci√≥n humana, el rendimiento, el ancho de banda y la latencia se est√°n convirtiendo en par√°metros cada vez m√°s cr√≠ticos para sistemas como las redes inal√°mbricas y la infraestructura de cable, incluidos todos sus componentes individuales: enrutadores, equilibradores de carga, firewalls;  as√≠ como √°reas de aplicaci√≥n: transferencia de medios (transmisi√≥n), VoIP, etc. <br><br>  DPDK es una forma ligera y conveniente de crear pruebas y scripts.  La transferencia de datos dentro del espacio de usuario es algo que no observamos con tanta frecuencia, principalmente porque la mayor√≠a de las aplicaciones se comunican con el equipo de red a trav√©s del sistema operativo y la pila del n√∫cleo, que es lo opuesto al modelo DPDK. <br><br><h3>  Lua </h3><br>  El objetivo principal de la existencia de Lua es proporcionar herramientas expresivas simples y flexibles que sean expandibles para tareas actuales espec√≠ficas, en lugar de un conjunto de primitivas aplicables en un solo paradigma de programaci√≥n.  Como resultado, el lenguaje base es muy ligero: el int√©rprete completo solo requiere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">180 kB</a> en forma compilada y se adapta f√°cilmente a una amplia gama de posibles implementaciones. <br><br>  Lua es un lenguaje din√°mico.  Es tan compacto que se puede colocar en casi cualquier dispositivo.  Lua admite un peque√±o conjunto de tipos: valores booleanos, n√∫meros (coma flotante de precisi√≥n doble) y cadenas.  Las estructuras de datos convencionales, como las matrices, los conjuntos y las listas, se pueden representar mediante la √∫nica estructura de datos incorporada en Lua: una tabla, que es una matriz asociativa heterog√©nea. <br><br>  Lua utiliza la compilaci√≥n JIT (justo a tiempo), por lo tanto, al ser un lenguaje de script, muestra un rendimiento comparable a los lenguajes compilados como C [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">10</a> ]. <br><br><h2>  ¬øPor qu√© Moongen? </h2><br>  Como empresa especializada en neutralizar los ataques DDoS, Qrator Labs necesita una forma confiable de crear, actualizar y probar sus propias soluciones de seguridad.  Es para la √∫ltima prueba, que se necesitan varios m√©todos para generar tr√°fico que simulan ataques reales.  Sin embargo, no es tan f√°cil simular un ataque de inundaci√≥n peligroso, pero directo, en los niveles 2-3 del modelo OSI, principalmente debido a las dificultades para lograr un alto rendimiento en la generaci√≥n de paquetes. <br><br>  En otras palabras, para una empresa dedicada a la disponibilidad continua y la neutralizaci√≥n de DDoS, simular varios ataques DoS en un entorno de laboratorio aislado es una forma de entender c√≥mo se comportar√°n en realidad los diversos equipos que forman parte de los sistemas de hardware de la empresa. <br><br>  MoonGen es una buena forma de generar valores de tr√°fico cercanos al l√≠mite para el controlador de red con un m√≠nimo de n√∫cleos de CPU.  La transferencia de datos dentro del espacio de usuario mejora significativamente el rendimiento de la pila en cuesti√≥n (MoonGen + DPDK), en comparaci√≥n con muchas otras opciones para generar altos valores de tr√°fico.  El uso de DPDK puro requiere mucho m√°s esfuerzo, por lo que no deber√≠a sorprenderse de nuestro deseo de optimizar el rendimiento.  Tambi√©n admitimos un clon [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">7</a> ] del repositorio original MoonGen para expandir la funcionalidad e implementaci√≥n de nuestras propias pruebas. <br><br>  Para lograr la m√°xima flexibilidad, el usuario establece la l√≥gica para generar paquetes utilizando el script Lua, que es una de las principales caracter√≠sticas de MoonGen.  En el caso del procesamiento de paquetes relativamente simple, esta soluci√≥n funciona lo suficientemente r√°pido como para saturar la interfaz 10G en un solo n√∫cleo de CPU.  Una forma t√≠pica de modificar paquetes entrantes y crear nuevos es trabajar con paquetes del mismo tipo, en los que solo cambian algunos de los campos. <br><br>  Un ejemplo es la prueba l3-tcp-syn-ack-flood, que se describe a continuaci√≥n.  Tenga en cuenta que cualquier modificaci√≥n del paquete puede realizarse en el mismo b√∫fer, donde result√≥ ser el paquete generado o recibido en el paso anterior.  De hecho, tales conversiones de paquetes se realizan muy r√°pidamente, ya que no implican operaciones costosas, como llamadas al sistema, acceso a secciones de memoria potencialmente no almacenadas en cach√© y similares. <br><br><h2>  Pruebas en hardware de Qrator Labs </h2><br>  Qrator Labs realiza todas las pruebas en el laboratorio en diversos equipos.  En este caso, utilizamos los siguientes controladores de interfaz de red: <br><br><ul><li>  Intel 82599ES 10G </li><li>  Mellanox ConnectX-4 40G </li><li>  Mellanox ConnectX-5 100G </li></ul><br>  Observamos por separado que cuando se trabaja con controladores de red que funcionan con est√°ndares superiores a 10G, el problema de rendimiento se agudiza.  Hoy en d√≠a no es posible saturar la interfaz 40G con un n√∫cleo, aunque con un peque√±o n√∫mero de n√∫cleos esto ya es realista. <br><br>  En el caso de los controladores de red fabricados por Mellanox, es posible cambiar algunos par√°metros y configuraciones del dispositivo utilizando la gu√≠a de ajuste [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3</a> ] proporcionada por el fabricante.  Esto le permite aumentar el rendimiento y, en algunos casos especiales, profundizar el comportamiento de la NIC.  Otros fabricantes pueden tener documentos similares para sus propios dispositivos de alto rendimiento destinados a uso profesional.  Incluso si no puede encontrar dicho documento en el dominio p√∫blico, siempre tiene sentido ponerse en contacto directamente con el fabricante.  En nuestro caso, los representantes de la compa√±√≠a Mellanox fueron muy amables y, adem√°s de proporcionar documentaci√≥n, respondieron r√°pidamente a nuestras preguntas, por lo que logramos lograr el 100% de utilizaci√≥n de la tira, lo cual fue muy importante para nosotros. <br><br><h3>  Prueba de inundaci√≥n TCP SYN </h3><br>  L3-tcp-syn-ack-flood es un ejemplo de simulaci√≥n de un ataque como SYN flood [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6</a> ].  Esta es una versi√≥n extendida de Qrator Labs de la prueba l3-tcp-syn-flood del repositorio principal de MoonGen, que se almacena en nuestro clon de repositorio. <br><br>  Nuestra prueba puede ejecutar tres tipos de procesos: <br><br><ol><li>  Genere flujo de paquetes TCP SYN desde cero, variando los campos requeridos, como la direcci√≥n IP de origen, el n√∫mero de puerto de origen, etc. </li><li>  Cree una respuesta ACK v√°lida para cada paquete SYN recibido de acuerdo con TCP; </li><li>  Cree una respuesta SYN-ACK v√°lida para cada paquete ACK recibido de acuerdo con el protocolo TCP. </li></ol><br>  Por ejemplo, el bucle de c√≥digo interno (respectivamente, el "m√°s caliente") para crear respuestas ACK es el siguiente: <br><br><pre><code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tx = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> rx = rxQ:recv(rxBufs) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, rx <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> buf = rxBufs[i] <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pkt = buf:getTcpPacket(ipv4) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pkt.ip4:getProtocol() == ip4.PROTO_TCP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pkt.tcp:getSyn() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (pkt.tcp:getAck() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> synack) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> seq = pkt.tcp:getSeqNumber() <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ack = pkt.tcp:getAckNumber() pkt.tcp:unsetSyn() pkt.tcp:setAckNumber(seq+<span class="hljs-number"><span class="hljs-number">1</span></span>) pkt.tcp:setSeqNumber(ack) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tmp = pkt.ip4.src:get() pkt.ip4.src:set(pkt.ip4.dst:get()) pkt.ip4.dst:set(tmp) ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">-- some more manipulations with packet fields tx = tx + 1 txBufs[tx] = buf end end if tx &gt; 0 then txBufs:resize(tx) txBufs:offloadTcpChecksums(ipv4) -- offload checksums to NIC txQ:send(txBufs) end</span></span></code> </pre> <br>  La idea general de crear un paquete de respuesta es la siguiente.  Primero, debe eliminar el paquete de la cola RX, luego verificar si el tipo de paquete coincide con el esperado.  En caso de coincidencia, prepare una respuesta modificando algunos campos del paquete original.  Finalmente, coloque el paquete creado en la cola TX utilizando el mismo b√∫fer.  Para mejorar el rendimiento, en lugar de tomar paquetes uno por uno y modificarlos uno por uno, los agregamos, extraemos todos los paquetes disponibles de la cola RX, creamos las respuestas correspondientes y los ponemos todos en la cola TX.  A pesar de un n√∫mero bastante grande de manipulaciones en un paquete, el rendimiento sigue siendo alto, principalmente debido al hecho de que Lua JIT compila todas estas operaciones en un peque√±o n√∫mero de instrucciones del procesador.  Muchas otras pruebas, no solo TCP SYN / ACK, funcionan con el mismo principio. <br><br>  La siguiente tabla muestra los resultados de la prueba de inundaci√≥n SYN (generaci√≥n SYN sin intentos de respuesta) utilizando Mellanox ConnectX-4.  Esta NIC tiene dos puertos 40G con un techo de rendimiento te√≥rico de 59.52 Mpps en un puerto y 2 * 50 Mpps para dos puertos.  La implementaci√≥n espec√≠fica de conectar la NIC a PCIe limita un poco el ancho de banda (dando 2 * 50 en lugar de los 2 * 59.52 esperados). <br><table><tbody><tr><td>  <b>n√∫cleos por puerto</b> </td><td>  <b>1 puerto, Mpps</b> </td><td>  <b>2 puertos, Mpps por cada puerto</b> </td></tr><tr><td>  1 </td><td>  20 </td><td>  19 </td></tr><tr><td>  2 </td><td>  38 </td><td>  36 </td></tr><tr><td>  3 </td><td>  56,5 </td><td>  47 </td></tr><tr><td>  4 4 </td><td>  59,5 </td><td>  50 </td></tr></tbody></table><br>  <i>Prueba de inundaci√≥n SYN;</i>  <i>NIC: Mellanox Technologies MT27700 Family (ConnectX-4), puerto dual 40G;</i>  <i>CPU: CPU Intel¬Æ Xeon¬Æ Silver 4114 @ 2.20GHz</i> <br><br>  La siguiente tabla muestra los resultados de la misma prueba de inundaci√≥n SYN realizada en un Mellanox ConnectX-5 con un puerto de 100G. <br><table><tbody><tr><td>  <b>n√∫cleos</b> </td><td>  <b>Mpps</b> </td></tr><tr><td>  1 </td><td>  35 </td></tr><tr><td>  2 </td><td>  69 </td></tr><tr><td>  3 </td><td>  104 </td></tr><tr><td>  4 4 </td><td>  127 </td></tr><tr><td>  5 5 </td><td>  120 </td></tr><tr><td>  6 6 </td><td>  131 </td></tr><tr><td>  7 7 </td><td>  132 </td></tr><tr><td>  8 </td><td>  144 </td></tr></tbody></table><br>  <i>Prueba de inundaci√≥n SYN;</i>  <i>NIC: Mellanox Technologies MT27800 Family (ConnectX-5), solo puerto 100G;</i>  <i>CPU: CPU Intel¬Æ Xeon¬Æ Silver 4114 @ 2.20GHz</i> <br><br>  Tenga en cuenta que en todos los casos alcanzamos m√°s del 96% del techo de rendimiento te√≥rico en un peque√±o n√∫mero de n√∫cleos de procesador. <br><br><h3>  Capture el tr√°fico entrante y gu√°rdelo en archivos PCAP </h3><br>  Otro ejemplo de la prueba es rx-to-pcap, que intenta capturar todo el tr√°fico entrante y guardarlo en un cierto n√∫mero de archivos PCAP [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">8</a> ].  Aunque esta prueba no se refiere espec√≠ficamente a la generaci√≥n de paquetes como tal, sirve como una demostraci√≥n del hecho de que el eslab√≥n m√°s d√©bil para organizar la transferencia de datos a trav√©s del espacio de usuario es el sistema de archivos.  Incluso el sistema de archivos virtual tmpfs ralentiza significativamente la transmisi√≥n.  En este caso, se necesitan 8 n√∫cleos del procesador central para la utilizaci√≥n de 14.88 Mpps, mientras que solo un n√∫cleo es suficiente para recibir (y restablecer o redirigir) la misma cantidad de tr√°fico. <br><br>  La siguiente tabla muestra la cantidad de tr√°fico (en Mpps) que se recibi√≥ y se guard√≥ en los archivos PCAP ubicados en el sistema de archivos ext2 en el SSD (segunda columna) o en el sistema de archivos tmpfs (tercera columna). <br><table><tbody><tr><td>  <b>n√∫cleos</b> </td><td>  <b>en SSD, Mpps</b> </td><td>  <b>en tmpfs, Mpps</b> </td></tr><tr><td>  1 </td><td>  1,48 </td><td>  1,62 </td></tr><tr><td>  2 </td><td>  4 4 </td><td>  4.6 </td></tr><tr><td>  3 </td><td>  6,94 </td><td>  8.1 </td></tr><tr><td>  4 4 </td><td>  9,75 </td><td>  11,65 </td></tr><tr><td>  5 5 </td><td>  12,1 </td><td>  13,8 </td></tr><tr><td>  6 6 </td><td>  13,38 </td><td>  14,47 </td></tr><tr><td>  7 7 </td><td>  14,4 </td><td>  14,86 </td></tr><tr><td>  8 </td><td>  14,88 </td><td>  14,88 </td></tr></tbody></table><br>  <i>Prueba de Rx a pcap;</i>  <i>NIC: Intel 82599ES de 10 Gigabits;</i>  <i>CPU: CPU Intel¬Æ Xeon¬Æ E5-2683 v4 @ 2.10GHz</i> <br><br><h2>  Modificaci√≥n de MoonGen: tman Task Manager </h2><br>  Tambi√©n nos gustar√≠a presentarle al lector nuestra propia extensi√≥n de la funcionalidad MoonGen, que proporciona otra forma de lanzar un grupo de tareas para realizar pruebas.  La idea principal aqu√≠ es separar la configuraci√≥n general y la configuraci√≥n espec√≠fica de cada tarea, lo que le permite ejecutar un n√∫mero arbitrario de tareas diferentes (es decir, scripts Lua) al mismo tiempo.  En nuestro clon del repositorio MoonGen, se presenta la implementaci√≥n de MoonGen con el administrador de tareas [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">9</a> ], aqu√≠ solo enumeraremos brevemente sus funciones principales. <br><br>  La nueva interfaz de l√≠nea de comandos le permite ejecutar m√∫ltiples tareas de diferentes tipos simult√°neamente.  El escenario b√°sico es el siguiente: <br><br><pre> <code class="bash hljs">./build/tman [tman options...] [-- &lt;task1-file&gt; [task1 options...]] [-- &lt;task2-file&gt; [task2 options...]] [-- ...]</code> </pre> <br>  Adem√°s ./build/tman -h proporciona ayuda detallada. <br><br>  Sin embargo, hay una limitaci√≥n: los archivos de trabajo de Lua normales no son compatibles con la interfaz <i>tman</i> .  El <i>archivo de</i> trabajo de <i>tman</i> debe definir claramente los siguientes objetos: <br><br><ul><li>  La funci√≥n de configuraci√≥n (analizador) que describe los par√°metros del trabajo; </li><li>  La funci√≥n de tarea (taskNum, txInfo, rxInfo, args), que describe el proceso de la tarea real.  Aqu√≠ txInfo y rxInfo son matrices de colas RX y TX, respectivamente;  args contiene los par√°metros del administrador de tareas y la tarea misma. </li><li>  Se pueden encontrar ejemplos en examples / tman. </li></ul><br>  El uso del administrador de tareas le brinda m√°s flexibilidad para ejecutar pruebas heterog√©neas. <br><br><h3>  Conclusiones </h3><br>  El m√©todo que ofrece MoonGen result√≥ ser muy adecuado para nuestros objetivos y satisfizo a los empleados con los resultados.  Obtuvimos una herramienta con alto rendimiento, manteniendo el entorno de prueba y el lenguaje bastante simple.  El alto rendimiento de esta configuraci√≥n se logra gracias a dos caracter√≠sticas principales: acceso directo a las memorias intermedias del controlador de interfaz de red y la t√©cnica de compilaci√≥n Just-In-Time en Lua. <br><br>  Como regla, lograr un techo te√≥rico para el rendimiento de un controlador de interfaz de red es una tarea factible.  Como hemos demostrado, un solo n√∫cleo puede ser suficiente para saturar un puerto 10G, mientras que una carga completa de un puerto 100G no presenta un problema particular con un mayor n√∫mero de n√∫cleos. <br><br>  Estamos especialmente agradecidos al equipo de Mellanox por su ayuda con su equipo y al equipo de MoonGen por su reacci√≥n a la correcci√≥n de los errores. <br><br><h2>  Materiales </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MoonGen: un generador de paquetes de alta velocidad programable - Paul Emmerich et al., Internet Measurement Conference 2015 (IMC'15), 2015</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pktgen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gu√≠a de afinaci√≥n de Mellanox</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kit de desarrollo de plano de datos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lua</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Inundaci√≥n Syn</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El clon de Qrator Labs del repositorio MoonGen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Formato de archivo PCAP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Administrador de tareas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lua performance</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Informe de virtualizaci√≥n de funciones de red</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NUMA, acceso a memoria no uniforme</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423957/">https://habr.com/ru/post/es423957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423945/index.html">La Corte Suprema especific√≥ el procedimiento para considerar casos con repost y likes</a></li>
<li><a href="../es423947/index.html">Nuestros datos personales no le cuestan nada</a></li>
<li><a href="../es423949/index.html">Un universo consistente con nuestras creencias actuales puede no ser posible.</a></li>
<li><a href="../es423953/index.html">Funci√≥n humana o tecnolog√≠a para dejar de contratar</a></li>
<li><a href="../es423955/index.html">C√≥mo creamos un producto tecnol√≥gico y ca√≠mos al fondo</a></li>
<li><a href="../es423959/index.html">Estuches submarinos: para robots</a></li>
<li><a href="../es423961/index.html">No te pierdas: un nuevo m√©todo para diagnosticar demencia</a></li>
<li><a href="../es423963/index.html">Pr√≥logo de Kelvin Point</a></li>
<li><a href="../es423965/index.html">Usted compr√≥ SIEM y est√° seguro de que SOC est√° en su bolsillo, ¬øverdad?</a></li>
<li><a href="../es423967/index.html">Toda la verdad sobre RTOS. Art√≠culo # 10. Programador: funciones avanzadas y preservaci√≥n del contexto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>