<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âš“ï¸ ğŸ¥¢ ğŸ¤µğŸ½ ä½¿ç”¨è¿œç¨‹è®¿é—®Windowsæ³¨å†Œè¡¨è‡ªåŠ¨æ§åˆ¶ ğŸ’ ğŸ‘¨ğŸ¿â€âš•ï¸ ğŸ…ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¯¹æ™®é€šç”¨æˆ·çš„è®¡ç®—æœºå’Œè½¯ä»¶çš„æ­£ç¡®ï¼Œæ­£ç¡®æ“ä½œçš„æ”¯æŒæ˜¯æŠ€æœ¯æ”¯æŒå‘˜å·¥å’Œ/æˆ–ç®¡ç†å‘˜çš„æ—¥å¸¸å·¥ä½œã€‚ å¦‚æœå…¬å¸è§„æ¨¡å¾ˆå°ï¼Œå¹¶ä¸”æ¯ä¸ªäººéƒ½åœ¨ä¸€ä¸¤ä¸ªæˆ¿é—´é‡Œï¼Œé€šå¸¸å¾ˆå®¹æ˜“åŠ¨æ‰‹è§£å†³é—®é¢˜æˆ–æ£€æŸ¥æ‚¨çš„éœ€æ±‚ã€‚ 


 ä½†æ˜¯ï¼Œå¦‚æœå…¬å¸è§„æ¨¡è¾ƒå¤§ä¸”ç”¨æˆ·ä½äºå¦ä¸€ä¸ªåŸå¸‚/å›½å®¶/åœ°åŒºçš„ä¸åŒç«™ç‚¹æ€ä¹ˆåŠï¼Ÿ 





 è¿›è¡Œæ­¤ç±»å·¥ä½œçš„ç»å…¸å·¥å…·ä¹‹ä¸€æ˜¯è¿œç¨‹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨è¿œç¨‹è®¿é—®Windowsæ³¨å†Œè¡¨è‡ªåŠ¨æ§åˆ¶</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426873/"><p> å¯¹æ™®é€šç”¨æˆ·çš„è®¡ç®—æœºå’Œè½¯ä»¶çš„æ­£ç¡®ï¼Œæ­£ç¡®æ“ä½œçš„æ”¯æŒæ˜¯æŠ€æœ¯æ”¯æŒå‘˜å·¥å’Œ/æˆ–ç®¡ç†å‘˜çš„æ—¥å¸¸å·¥ä½œã€‚ å¦‚æœå…¬å¸è§„æ¨¡å¾ˆå°ï¼Œå¹¶ä¸”æ¯ä¸ªäººéƒ½åœ¨ä¸€ä¸¤ä¸ªæˆ¿é—´é‡Œï¼Œé€šå¸¸å¾ˆå®¹æ˜“åŠ¨æ‰‹è§£å†³é—®é¢˜æˆ–æ£€æŸ¥æ‚¨çš„éœ€æ±‚ã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœå…¬å¸è§„æ¨¡è¾ƒå¤§ä¸”ç”¨æˆ·ä½äºå¦ä¸€ä¸ªåŸå¸‚/å›½å®¶/åœ°åŒºçš„ä¸åŒç«™ç‚¹æ€ä¹ˆåŠï¼Ÿ </p><br><p><img src="https://habrastorage.org/webt/wt/ie/d-/wtied-3-4doen9ma6k3gbtzee2u.png" alt="å›¾ç‰‡"></p><a name="habracut"></a><br><p> è¿›è¡Œæ­¤ç±»å·¥ä½œçš„ç»å…¸å·¥å…·ä¹‹ä¸€æ˜¯è¿œç¨‹è¿æ¥ï¼ˆä½¿ç”¨RDPï¼ŒTeamViewer / Skypeä¹‹ç±»çš„è½¯ä»¶ä»¥åŠæ¡Œé¢æ¼”ç¤ºç­‰ï¼‰ã€‚ ä½†æ˜¯ï¼Œå®ƒå¹¶éæ²¡æœ‰åŸºæœ¬ç¼ºé™·ï¼š </p><br><ul><li> åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæœ€ç»ˆç”¨æˆ·éƒ½å°†åˆ†æ•£ä»–çš„å·¥ä½œï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”šè‡³æ ¹æœ¬çœ‹ä¸åˆ°ä»–çš„æ¡Œé¢ï¼‰ </li><li> å¦‚æœè¿œç¨‹è®¡ç®—æœºä¸Šæœ‰é”™è¯¯ï¼Œè¿™äº›å·¥å…·å°†æ— æ³•å§‹ç»ˆè¿è¡Œ </li><li> å…¬å¸æ”¿ç­–ç»ä¸æ€»æ˜¯æ¬¢è¿å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼ˆå¯¹äºTeamViewerï¼ŒåŒ…æ‹¬ä¸“æœ‰è½¯ä»¶ï¼‰ </li><li> è¯¥æ–¹æ³•å®é™…ä¸Šä¸æ˜¯è‡ªåŠ¨åŒ–çš„ </li></ul><br><p> æœ€å-åœ¨äº‹ä»¶å·²ç»å‘ç”Ÿæ—¶ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼ˆå¾ˆéš¾æƒ³è±¡ç®¡ç†å‘˜ä¼šä¸æ—¶åœ°â€œé¢„é˜²æ€§åœ°â€è¿æ¥åˆ°æ¯ä¸ªç”¨æˆ·ï¼‰ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿œç¨‹è®¡ç®—æœºçš„æ§åˆ¶ï¼ˆç›‘è§†ï¼‰æœºåˆ¶å¾ˆé‡è¦çš„åŸå› ã€‚ </p><br><p> ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¯¹Windowsæ³¨å†Œè¡¨çš„è¿œç¨‹è®¿é—®ã€‚ å®ƒä»¥åˆ†å±‚æ•°æ®åº“çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œä½¿æ‚¨å¯ä»¥å¿«é€Ÿæ¥æ”¶å¹¶ç´§å‡‘åœ°å­˜å‚¨æ•°æ®ã€‚ ä»–ä»¬ä½¿ç”¨æ³¨å†Œè¡¨æ¥å­˜å‚¨è‡ªå·±çš„è®¾ç½®å’Œå‚æ•°ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿå’ŒåµŒå…¥å¼æœåŠ¡ä»¥åŠå¤§å¤šæ•°ç¬¬ä¸‰æ–¹ç¨‹åºã€‚ å› æ­¤ï¼Œæ³¨å†Œè¡¨çš„å†…å®¹åœ¨è®¸å¤šæ–¹é¢éƒ½ä¼šå½±å“ç³»ç»Ÿçš„è¿è¡Œã€‚ </p><br><p> åŸºäºæ­¤ï¼Œæ³¨å†Œè¡¨å¾ˆå¯èƒ½ç”¨ä½œç›‘è§†çš„â€œæŒ‡ç¤ºå™¨â€ï¼ˆå¦‚æœé”™è¯¯ä¸æ³¨å†Œè¡¨ä¸­çš„é”™è¯¯å‚æ•°ç›¸å…³è”æˆ–æ¨¡æ‹Ÿæœ‰é—®é¢˜çš„æƒ…å†µï¼Œåˆ™å¯ä»¥æ£€æµ‹åˆ°è¯¥é”™è¯¯ï¼‰ã€‚ </p><br><p> è¯¥è§£å†³æ–¹æ¡ˆæä¾›çš„å¦ä¸€ç§å¯èƒ½æ€§æ˜¯å¯¹ç”¨æˆ·è¿›è¡Œç®¡ç†æ§åˆ¶çš„å¯èƒ½æ€§ï¼ˆä¾‹å¦‚ï¼Œè¿œç¨‹é˜…è¯»ä½¿æ‚¨å¯ä»¥çœ‹åˆ°å®‰è£…ä¸éœ€è¦çš„ç¨‹åºå¹¶æ›´æ”¹è®¾ç½®çš„äº‹å®ï¼‰-ä¸è¦å¿˜è®°â€œäººä¸ºå› ç´ â€å¯¹ç³»ç»Ÿçš„å½±å“ã€‚ å®é™…ä¸Šï¼Œè¿™åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SkypeTime</a>é¡¹ç›®çš„æ¡†æ¶ä¸­å¾ˆæœ‰ç”¨ï¼Œåœ¨è¯¥æ¡†æ¶ä¸­å¿…é¡»è·Ÿè¸ªSkype for Businessä¸­çš„è®¾ç½®æ›´æ­£ã€‚ </p><br><p><img src="https://habrastorage.org/webt/eb/jt/9l/ebjt9lhsnvxoead9su8n64gzyqq.jpeg" alt="å›¾ç‰‡"></p><br><p> ä½†æ˜¯æ³¨å†Œè¡¨åŒ…å«æˆåƒä¸Šä¸‡çš„æ¡ç›®ï¼›æ§åˆ¶æ‰€æœ‰è¿™äº›æ¡ç›®éå¸¸å›°éš¾ã€‚ å› æ­¤ï¼Œé¦–å…ˆï¼Œå¿…é¡»é™åˆ¶æ§åˆ¶çš„ä¸»é¢˜-ç¡®å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„å‚æ•°ï¼Œå¹¶æ‰¾å‡ºå¯¹åº”å€¼ä½äºå“ªä¸ªç‰¹å®šæ³¨å†Œè¡¨åˆ†æ”¯ä¸­ã€‚ é€šå¸¸ï¼Œåè€…ä¸éš¾åœ¨æ–‡æ¡£/ Internetä¸­æ‰¾åˆ°ï¼Œæˆ–è€…æ ¹æ®å¯†é’¥åç§°ç‹¬ç«‹ç¡®å®šã€‚ </p><br><p> ç¡®å®šæ§åˆ¶ä¸»é¢˜åï¼Œæ‚¨å¯ä»¥ç›´æ¥é…ç½®è¿œç¨‹è®¿é—®ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šæ¿€æ´»â€œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨â€æœåŠ¡å¹¶æ ¹æ®éœ€è¦é…ç½®é˜²ç«å¢™ï¼Œè¿™å¯ä»¥ä½¿ç”¨ç»„ç­–ç•¥æ–¹ä¾¿åœ°å®Œæˆã€‚ è€ƒè™‘åˆ°å®‰å…¨æ€§è¦æ±‚ï¼Œè®¿é—®éœ€è¦æ¯ä¸ªè®¾å¤‡ä¸Šçš„åŸŸç®¡ç†å‘˜æˆ–æœ¬åœ°ç®¡ç†å‘˜çš„æƒé™ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">é…ç½®è¿œç¨‹è®¿é—®</b> <div class="spoiler_text"><p> è¦æ¿€æ´»æœåŠ¡æœ¬èº«ï¼Œè¯·åœ¨â€œè®¡ç®—æœºé…ç½®â€&gt;â€œé¦–é€‰é¡¹â€&gt;â€œæ§åˆ¶é¢æ¿è®¾ç½®â€&gt;â€œæœåŠ¡â€éƒ¨åˆ†ä¸­ï¼Œè®¾ç½®RpcSsæœåŠ¡çš„å‚æ•°ï¼Œå¦‚å±å¹•å¿«ç…§æ‰€ç¤ºã€‚ </p><br><p><img src="https://habrastorage.org/webt/oy/j8/k-/oyj8k-xbkjvb6yurtx-_ejk_0gc.jpeg" alt="å›¾ç‰‡"></p><br><p> ä»ç„¶éœ€è¦æ·»åŠ é€‚å½“çš„é˜²ç«å¢™ä¾‹å¤–ã€‚ åœ¨åŒä¸€ç­–ç•¥ä¸­ï¼Œåœ¨â€œè®¡ç®—æœºé…ç½®â€&gt;â€œç­–ç•¥â€&gt;â€œ Windowsè®¾ç½®â€&gt;â€œå®‰å…¨è®¾ç½®â€&gt;â€œå…·æœ‰é«˜çº§å®‰å…¨æ€§çš„Windowsé˜²ç«å¢™â€&gt;â€œå…¥ç«™è§„åˆ™â€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªâ€œæ–°è§„åˆ™â€ï¼š <br> è§„åˆ™ç±»å‹-è‡ªå®šä¹‰ </p><br><p><img src="https://habrastorage.org/webt/s1/wo/hk/s1wohkk7ldbibzqrim7qrcki-rs.jpeg" alt="å›¾ç‰‡"></p><br><p> æŒ‡å®šç¨‹åºçš„è·¯å¾„-ï¼…SystemRootï¼…\ system32 \ svchost.exe <br> åœ¨â€œæœåŠ¡â€éƒ¨åˆ†çš„å…¶ä»–è®¾ç½®ä¸­ï¼Œå°†â€œåº”ç”¨åˆ°æœåŠ¡â€è®¾ç½®ä¸ºä»¥ä¸‹ç®€ç§°-Winmgmt </p><br><p><img src="https://habrastorage.org/webt/ef/fg/wv/effgwvovrv1eqr9btfiy-dv9dzo.jpeg" alt="å›¾ç‰‡"></p><br><p> åœ¨æ¥ä¸‹æ¥çš„é¡µé¢ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šTCPè€Œä¸æŒ‡å®šç‰¹å®šç«¯å£å’Œæ‰€æœ‰åœ°å€ </p><br><p><img src="https://habrastorage.org/webt/0z/-5/ef/0z-5ef-xfzxapqdbl8mln_9hu6u.jpeg" alt="å›¾ç‰‡"></p><br><p><img src="https://habrastorage.org/webt/7k/y6/ks/7ky6kso0xwqyamgqb14i3uvkxxi.jpeg" alt="å›¾ç‰‡"></p><br><p> å¹¶å…è®¸åŸŸé…ç½®æ–‡ä»¶çš„è¿æ¥ï¼ˆ <em>Allow Connection</em> ï¼‰ </p><br><p><img src="https://habrastorage.org/webt/ry/hg/e7/ryhge7d26xy8gjkmlneq6cqjg6w.jpeg" alt="å›¾ç‰‡"></p><br><p><img src="https://habrastorage.org/webt/ui/fq/-a/uifq-aqdmohmt-omff0ctcgm1mq.jpeg" alt="å›¾ç‰‡"></p></div></div><br><p> ä½†æ˜¯ï¼Œâ€œæ‰‹åŠ¨â€ï¼ˆå³ä½¿åªæœ‰å¾ˆå°‘çš„æ¡ç›®ï¼‰æ‰‹åŠ¨æ§åˆ¶æ•°åå°å’Œæ•°ç™¾å°è®¡ç®—æœºçš„æ³¨å†Œè¡¨æ˜¯ä¸€é¡¹ä¸æ„‰å¿«è€Œåˆæ¯«æ— æ„ä¹‰çš„ä»»åŠ¡ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ‰§è¡Œæ­¤è¿‡ç¨‹éå¸¸ç®€å•ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹PowerShellè„šæœ¬å¯è®©æ‚¨æ‰¾å‡ºå“ªä¸ªç”¨æˆ·æ›´æ”¹äº†Skype for Businessçš„AwayThresholdå’ŒIdleThresholdå‚æ•°ï¼ˆåˆ‡æ¢åˆ°â€œ Out of Placeâ€å’Œâ€œ Inactiveâ€çŠ¶æ€çš„æ—¶é—´ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">è„šæœ¬ä»£ç </b> <div class="spoiler_text"><pre><code class="hljs mel">Param ( [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"c"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileComputers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"r"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputRPCErrorsFile, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"u"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileUsers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"o"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputFile=<span class="hljs-string"><span class="hljs-string">"output.csv"</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinAway, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"i"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinIdle ) $RPCErrorsArray = @() $result = @() $HKU = <span class="hljs-number"><span class="hljs-number">2147483651</span></span> $RegistryForCheckArray = <span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\13.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\14.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\15.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\16.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Communicator"</span></span> $CurrentComputerNumber = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { $Users = Get-Content $FromFileUsers; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileComputers)) { $Comps = Get-Content $FromFileComputers; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $date = (get-<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>).AddMonths(<span class="hljs-number"><span class="hljs-number">-1</span></span>) $Comps = Get-ADComputer -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> { lastlogontimestamp -ge $date } | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> name | ForEach-Object {$_.name} #$Comps = <span class="hljs-string"><span class="hljs-string">"NB_CY"</span></span> } $ServersCount = ($Comps).Count; Foreach ($Comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $Comps) { $CurrentComputerNumber++ try { Write-Host <span class="hljs-string"><span class="hljs-string">"Checking: $Comp [$CurrentComputerNumber/$ServersCount]"</span></span>; $profiles = Get-WmiObject Win32_UserProfile -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> <span class="hljs-string"><span class="hljs-string">"Loaded=$true and special=$false"</span></span> -ComputerName $Comp -ErrorAction Stop $reg = [wmiclass]<span class="hljs-string"><span class="hljs-string">"\\$Comp\root\default:stdregprov"</span></span> Foreach ($profile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $profiles) { $username = Split-Path $profile.LocalPath -Leaf <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$Users.Contains($username)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } Foreach( $registry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $RegistryForCheckArray) { $hkey = <span class="hljs-string"><span class="hljs-string">"$($profile.sid)\$registry"</span></span> #Write-Host <span class="hljs-string"><span class="hljs-string">"KEY: $hkey"</span></span> $away = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"AwayThreshold"</span></span>).uValue $idle = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"IdleThreshold"</span></span>).uValue $sip = $reg.GetStringValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"ServerSipUri"</span></span>).sValue <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($away) -and [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($idle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(($MinAway -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $away -lt $MinAway) -or ($MinIdle -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $idle -lt $MinIdle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $result += New-Object PsObject -Property @{ <span class="hljs-string"><span class="hljs-string">"PC"</span></span> = $Comp <span class="hljs-string"><span class="hljs-string">"Username"</span></span> = $username <span class="hljs-string"><span class="hljs-string">"SIP"</span></span> = $sip <span class="hljs-string"><span class="hljs-string">"SFB_Away"</span></span> = $away <span class="hljs-string"><span class="hljs-string">"SFB_Idle"</span></span> = $idle } } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_.Exception.GetType().Name -eq <span class="hljs-string"><span class="hljs-string">"COMException"</span></span>) { $RPCErrorsArray += $Comp; } Write-Host <span class="hljs-string"><span class="hljs-string">"Error: ($_.Exception.GetType().Name)"</span></span>; $_.Exception } } $result | Export-csv -Path $OutputFile $result | Format-Table -Property PC,Username,SIP,SFB_Away,SFB_Idle -AutoSize Write-Host <span class="hljs-string"><span class="hljs-string">"Saved to: $OutputFile"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($OutputRPCErrorsFile)) { $RPCErrorsArray | out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> $OutputRPCErrorsFile Write-Host <span class="hljs-string"><span class="hljs-string">"RPC errors saved to: $OutputRPCErrorsFile"</span></span> }</code> </pre> </div></div><br> ä¸ºäº†æ›´åŠ æ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°è¿è¡Œè„šæœ¬ï¼š <br><br>  -cæŒ‡å‘è¦æ£€æŸ¥çš„ä¸»æœºåè®¡ç®—æœºåˆ—è¡¨çš„æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¦‚æœæœªæŒ‡å®šï¼‰-ä»ADä¸­è·å–å…·æœ‰30å¤©æ´»åŠ¨çš„è®¡ç®—æœºã€‚ <br>  -ræŒ‡å‘å°†å†™å…¥å…·æœ‰RPCé”™è¯¯çš„è®¡ç®—æœºçš„ä¸»æœºåçš„æ–‡ä»¶çš„è·¯å¾„ã€‚ <br>  -uå¸¦æœ‰ç”¨æˆ·åˆ—è¡¨çš„æ–‡ä»¶çš„è·¯å¾„ï¼ˆç™»å½•ï¼‰ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™å…¨éƒ¨æ£€æŸ¥ã€‚ <br>  -oè„šæœ¬ç»“æœå°†åœ¨å…¶ä¸­æ‰§è¡Œçš„æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸ºoutput.csvã€‚ <br>  -AwayThresholdå‚æ•°çš„æœ€å°å€¼ï¼Œå…¶å€¼å°äºæŒ‡å®šå€¼çš„è®°å½•å°†ä¸ä¼šè·å¾—è„šæœ¬æ‰§è¡Œçš„ç»“æœã€‚ <br>  -i IdleThresholdå‚æ•°çš„æœ€å°å€¼ï¼Œå…¶å€¼å°äºæŒ‡å®šå€¼çš„è®°å½•å°†ä¸ä¼šè·å¾—è„šæœ¬çš„ç»“æœã€‚ <br><br> æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡å°†è„šæœ¬æ·»åŠ åˆ°Windowsä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆTask Schedulerï¼‰æˆ–é€šè¿‡PowerShellä¸­çš„Sheduled JobåŠŸèƒ½æ¥ä½¿è„šæœ¬è‡ªåŠ¨åŒ–ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN426873/">https://habr.com/ru/post/zh-CN426873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN426853/index.html">â€œç‰©è”ç½‘ä¸­çš„Sä»£è¡¨å®‰å…¨æ€§â€ï¼šä¸–ç•Œä¸Šç¬¬ä¸€éƒ¨ä¿æŠ¤æ™ºèƒ½å°å·¥å…·çš„æ³•å¾‹å·²è·é€šè¿‡-æˆ‘ä»¬äº†è§£æœ¬è´¨æ˜¯ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN426861/index.html">åœ¨å±±ä¸‹è¿›è¡Œäº†ä¸€æ¬¡æ–°çš„æš—ç‰©è´¨æœå¯»</a></li>
<li><a href="../zh-CN426863/index.html">æœ‰å…³å››å…ƒæ•°åŠå…¶ç›Šå¤„çš„ä¿¡æ¯</a></li>
<li><a href="../zh-CN426865/index.html">æ¸…æ™°çš„ä»ªè¡¨æ¿è®¾è®¡ï¼Œç”¨äºå®Œå–„çš„å¹¿å‘Šç®¡ç†ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN426869/index.html">å¦‚ä½•æœ‰æ•ˆåœ°ä¸å¤–å›½å®¢æˆ·è¿›è¡Œè§†é¢‘ä¼šè®®</a></li>
<li><a href="../zh-CN426875/index.html">Tacticoolç§»åŠ¨åœ¨çº¿å°„å‡»è€…å…ƒæœåŠ¡å™¨ä½“ç³»ç»“æ„</a></li>
<li><a href="../zh-CN426879/index.html">ä¸ºä½¿ç”¨é«˜é€Ÿæ¥å£çš„é¡¹ç›®è®¾ç½®ç”µæ°”é™åˆ¶ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN426881/index.html">å¯åŠ¨åœ¨çº¿å¼€å‘äººå‘˜ç¨‹åº</a></li>
<li><a href="../zh-CN426889/index.html">å¦‚ä½•å‚åŠ æœºå™¨å­¦ä¹ æ¯”èµ›ã€‚ Yandexè®²åº§</a></li>
<li><a href="../zh-CN426891/index.html">SAPæµç¨‹æŒ–æ˜æˆ–å¦‚ä½•ç†è§£æ‚¨çš„ä¸šåŠ¡æµç¨‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>