<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé£ üî∂ üö≤ DSL universal. Isso √© poss√≠vel? üò£ üíÖ üé∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O idioma da √°rea de assunto. N√£o sobrecarregado com constru√ß√µes de linguagem de uso geral. Ao mesmo tempo, permite implementar uma l√≥gica muito comple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DSL universal. Isso √© poss√≠vel?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/477902/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gb/rq/r6/gbrqr6yefzzlp8sboskriuwrne0.png"></div><br>  O idioma da √°rea de assunto.  N√£o sobrecarregado com constru√ß√µes de linguagem de uso geral.  Ao mesmo tempo, permite implementar uma l√≥gica muito complexa com apenas algumas linhas.  Tudo isso √© DSL. <br><br>  No entanto, a cria√ß√£o de uma DSL exige que o desenvolvedor seja qualificado.  O uso regular dessa abordagem se transforma em uma rotina de desenvolvimento de outro idioma.  A solu√ß√£o pode ser criar uma ferramenta universal - um mecanismo que ser√° aplic√°vel a tarefas completamente diferentes e f√°ceis de modificar.  Neste artigo, desenvolveremos em C # o mais simples do ponto de vista da implementa√ß√£o, mas ao mesmo tempo um mecanismo de linguagem bastante poderoso, com o qual voc√™ pode resolver uma ampla gama de problemas. <a name="habracut"></a><br><br><h3>  1. Introdu√ß√£o </h3><br><blockquote>  H√° duas maneiras de desenvolver um projeto de aplicativo: simplific√°-lo de modo que seja √≥bvio que ele n√£o tem defici√™ncias ou torn√°-lo t√£o complexo que n√£o possui defici√™ncias √≥bvias.  C.E. R. Hoar (CAR Hoare) </blockquote>  Neste artigo, quero compartilhar uma das t√©cnicas de desenvolvimento que ajuda eu e minha equipe, por um lado, a lidar com a complexidade dos projetos.  E, por outro lado, permite que voc√™ desenvolva rapidamente aplicativos de prot√≥tipo.  √Ä primeira vista, o desenvolvimento de uma linguagem de programa√ß√£o parece muito complicado.  Assim √©, se estamos falando de uma ferramenta universal.  Se o objetivo √© cobrir uma √°rea de assunto estreita, o desenvolvimento de um idioma espec√≠fico geralmente se justifica. <br><br>  Uma vez, me deparei com a tarefa de desenvolver uma implementa√ß√£o de uma linguagem industrial (IEC 61131-3) para incorporar no software do cliente.  No decorrer deste trabalho, fiquei interessado no t√≥pico estrutura de int√©rpretes e, desde ent√£o, escrevo int√©rpretes de l√≠nguas esot√©ricas e n√£o muito lingu√≠sticas como hobby.  No futuro, surgiu um entendimento de como usar int√©rpretes auto-escritos para simplificar a vida cotidiana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yh/j3/wl/yhj3wlkgasabptstq5toj3vasxc.jpeg"></div><br>  O principal objetivo das linguagens de programa√ß√£o s√£s √© simplificar o processo de programa√ß√£o e leitura de um programa.  Escrever em asm √© mais f√°cil do que em c√≥digos de m√°quina, escrever em C √© mais f√°cil do que em asm, em C # √© ainda mais simples e assim por diante. <br><br>  Isso √© alcan√ßado principalmente devido ao m√©todo mais popular de reducionismo - dividindo uma tarefa complexa em componentes simples e reconhec√≠veis - padronizando sua intera√ß√£o e uma certa sintaxe. <br><br>  A linguagem de programa√ß√£o consiste em um conjunto de operadores, que em ess√™ncia √© a base da linguagem, blocos de constru√ß√£o elementares e sintaxe que define a maneira de escrever combina√ß√µes de operadores, bem como a biblioteca padr√£o.  Sequ√™ncias de a√ß√µes elementares de acordo com regras sint√°ticas s√£o agrupadas em fun√ß√µes, fun√ß√µes s√£o agrupadas em classes (se houver OOP), classes s√£o combinadas em bibliotecas e essas, por sua vez, em pacotes.  √â assim que uma linguagem tradicional t√≠pica se parece.  Em princ√≠pio, essas t√©cnicas s√£o suficientes para resolver a maioria das tarefas di√°rias.  No entanto, esse n√£o √© o limite, porque voc√™ pode dar um passo adiante - para um n√≠vel mais alto de abstra√ß√£o e precisar√° ir al√©m dos limites da linguagem usada se ela n√£o suportar a metaprograma√ß√£o na forma de macros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sk/r4/ky/skr4kym02scw_o_neotnxrtmamy.jpeg"></div><br>  Atualmente, a maioria dos projetos se resume a uma combina√ß√£o de componentes prontos e uma parte samopisnogo insignificante de baixo n√≠vel.  A combina√ß√£o de componentes geralmente √© feita por meio de uma linguagem de programa√ß√£o universal - C #, Java, Python e outras.  Embora essas linguagens sejam de alto n√≠vel, elas tamb√©m s√£o universais e, portanto, cont√™m necessariamente constru√ß√µes sint√°ticas para opera√ß√µes de baixo n√≠vel, cria√ß√£o de fun√ß√µes, classes, descri√ß√£o de tipos generalizados, programa√ß√£o ass√≠ncrona e muito mais.  Por esse motivo, a tarefa ‚Äúfa√ßa uma vez, fa√ßa duas, fa√ßa tr√™s‚Äù cresce demais com uma grande quantidade de constru√ß√µes sint√°ticas e pode aumentar at√© centenas de linhas de c√≥digo e muito mais. <br><br>  Voc√™ pode simplificar a reutiliza√ß√£o de componentes se repetir a t√©cnica do reducionismo, mas j√° para esses mesmos componentes.  Isso √© alcan√ßado atrav√©s do desenvolvimento de uma linguagem especializada que possui uma sintaxe simplificada e serve apenas para descrever a intera√ß√£o desses componentes.  Essa abordagem √© chamada YaOP (programa√ß√£o orientada a linguagem) e as linguagens s√£o chamadas DSL (Linguagem Espec√≠fica de Dom√≠nio - uma linguagem espec√≠fica de dom√≠nio). <br><br>  Devido √† falta de constru√ß√µes redundantes, apenas algumas linhas no DSL podem implementar funcionalidades bastante complexas, o que leva a consequ√™ncias positivas: a velocidade de desenvolvimento aumenta, o n√∫mero de erros diminui e o teste do sistema √© simplificado. <br><br>  Se aplicada com sucesso, essa abordagem pode aumentar significativamente a flexibilidade do produto que est√° sendo desenvolvido devido √† possibilidade de escrever scripts compactos que definam e estendem o comportamento do sistema.  Pode haver muitas aplica√ß√µes para essa abordagem, como evidenciado pela preval√™ncia dessa abordagem, porque o DSL est√° em todo lugar.  HTML comum √© uma linguagem de descri√ß√£o de documentos, SQL √© uma linguagem de consulta estruturada, JSON √© uma linguagem de descri√ß√£o de dados estruturada, XAML, PostScript, Emacs Lisp, nnCron e muitos outros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/zo/ew/fwzoewmnmucf6kyeycclx_uibxa.jpeg"></div><br>  Com todas as vantagens, o DSL tem uma desvantagem significativa - altos requisitos para o desenvolvedor do sistema. <br><br>  Nem todo desenvolvedor tem conhecimento e experi√™ncia no desenvolvimento de uma linguagem primitiva.  Mesmo um n√∫mero menor de especialistas pode desenvolver uma linguagem suficientemente flex√≠vel e produtiva.  Existem outros problemas.  Por exemplo, em um determinado momento no desenvolvimento da funcionalidade originalmente estabelecida, pode n√£o ser suficiente e ser√° necess√°rio criar fun√ß√µes ou OOP.  E onde existem fun√ß√µes, a otimiza√ß√£o da recurs√£o da cauda pode ser necess√°ria sem loops, e assim por diante.  Ao mesmo tempo, a compatibilidade com vers√µes anteriores deve ser levada em considera√ß√£o para que os scripts escritos anteriormente continuem funcionando com a nova vers√£o. <br><br>  Outro problema √© que uma linguagem projetada para resolver um problema √© completamente inadequada para outros.  Portanto, voc√™ deve desenvolver uma nova DSL do zero, para que o desenvolvimento de novas linguagens se torne uma rotina.  Isso novamente complica a manuten√ß√£o e reduz a reutiliza√ß√£o de c√≥digo dif√≠cil de compartilhar entre diferentes implementa√ß√µes de DSL e projetos que os utilizam. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rz/0z/cs/rz0zcsehkdtthonxqqhrci4yezu.jpeg"></div><br>  A sa√≠da √© criar uma DSL para criar uma DSL.  Aqui n√£o quero dizer RBNF, mas uma linguagem que pode ser alterada por meios internos para a linguagem da √°rea de assunto.  O principal obst√°culo na cria√ß√£o de uma linguagem flex√≠vel e transform√°vel √© a presen√ßa de um sistema de sintaxe e tipo rigidamente definido.  Durante todo o per√≠odo de desenvolvimento da ind√∫stria de computadores, v√°rias linguagens flex√≠veis sem sintaxe foram propostas, mas elas sobreviveram at√© hoje e as linguagens Forth e Lisp continuam a se desenvolver ativamente.  A principal caracter√≠stica dessas linguagens √© que, devido √† sua estrutura e homo-iconicidade, elas podem, devido aos meios embutidos, alterar o comportamento do int√©rprete e, se necess√°rio, analisar constru√ß√µes sint√°ticas que n√£o foram estabelecidas originalmente. <br><br>  Existem solu√ß√µes para a Forth estendendo sua sintaxe para C ou para Scheme.  "Fort" √© frequentemente criticado pela seq√º√™ncia incomum de argumentos e opera√ß√µes p√≥s-fixada, que √© ditada pelo uso da pilha para passar argumentos.  No entanto, ‚ÄúFort‚Äù tem acesso a um int√©rprete de texto, isso permite ocultar o registro reverso do usu√°rio, se necess√°rio.  E, finalmente, isso √© uma quest√£o de h√°bito, e √© desenvolvido rapidamente. <br><br>  A fam√≠lia de idiomas Lisp conta com macros que permitem inserir DSL, se necess√°rio.  E o acesso ao int√©rprete e ao leitor contribui para a implementa√ß√£o de int√©rpretes metac√≠clicos com recursos de interpreta√ß√£o especificados.  Por exemplo, a implementa√ß√£o do Scheme lisp Racket √© posicionada como um ambiente para o desenvolvimento de linguagens e possui linguagens prontas para a cria√ß√£o de servidores Web, constru√ß√£o de interfaces GUI, linguagem de infer√™ncia e outras. <br><br>  Essa flexibilidade torna esses idiomas bons candidatos ao papel do mecanismo DSL universal. <br><br>  Como resultado, ‚ÄúFort‚Äù e Lisp se desenvolvem principalmente como linguagens de uso geral, embora de nicho - elas recorrem a funcionalidades que podem ser redundantes para uma linguagem DSL.  Mas, ao mesmo tempo, s√£o simples de implementar, o que significa que voc√™ pode desenvolver uma vers√£o limitada com a possibilidade de sua expans√£o.  Isso permitir√° que voc√™ reutilize o n√∫cleo dessa linguagem com pequenas modifica√ß√µes (idealmente - sem) para uma tarefa espec√≠fica. <br><br>  Tamb√©m quero observar que essas linguagens s√£o √≥timas n√£o apenas para escrever scripts, mas tamb√©m para intera√ß√£o interativa com o sistema via REPL.  Que, por um lado, pode ser conveniente para depura√ß√£o e, por outro lado, atua como uma interface acess√≠vel ao usu√°rio com o sistema.  Acredita-se que a interface de texto com o sistema em alguns casos possa ser mais eficaz que a gr√°fica, uma vez que √© muito mais simples de implementar, mais flex√≠vel, permite ao usu√°rio generalizar opera√ß√µes t√≠picas em fun√ß√µes, e assim por diante.  Um exemplo impressionante de uma interface de texto pode ser o Bash.  E se a linguagem √© homo-ic√¥nica, sua constru√ß√£o pode ser relativamente f√°cil de gerar e analisar e, com o m√≠nimo de esfor√ßo, implementar uma linguagem gr√°fica sobre o int√©rprete - isso pode ser √∫til quando o usu√°rio-alvo estiver longe de programar. <br><br>  Atualmente, as linguagens de descri√ß√£o de dados XML e JSON s√£o amplamente usadas como DSL para configura√ß√£o.  Obviamente, essa √© uma √≥tima pr√°tica, mas em alguns casos os dados por si s√≥ n√£o s√£o suficientes e √© necess√°rio, por exemplo, descrever as opera√ß√µes neles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hq/_5/xm/hq_5xmmftlr1yj6xnsmn5-qzoo8.jpeg"></div><br>  Neste post, proponho criar um int√©rprete simples da linguagem Fort e mostrar como adapt√°-la para resolver problemas espec√≠ficos. <br><br>  A linguagem Fort foi escolhida como a mais f√°cil de implementar e usar, embora poderosa o suficiente para us√°-la como DSL para v√°rias tarefas.  De fato, o cora√ß√£o da linguagem √© o int√©rprete de endere√ßo, que mesmo no assembler ocupa apenas algumas linhas, e a maior parte da implementa√ß√£o recai sobre as primitivas, que s√£o mais, mais universal, r√°pida e flex√≠vel a implementa√ß√£o deve ser.  Outra parte importante do idioma √© o int√©rprete de texto, que permite interagir com o int√©rprete de endere√ßo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/93/4s/uh934sq0-dwfzsmyjn2h5n0auvy.jpeg"></div><br><h3>  Int√©rprete de endere√ßo </h3><br>  O elemento b√°sico da linguagem Fort √© uma palavra que √© separada de outras palavras e √°tomos (n√∫meros) por espa√ßos, extremidades de linhas e tabula√ß√µes. <br><br>  Uma palavra tem o mesmo significado e propriedades que uma fun√ß√£o de outras linguagens, por exemplo C. Palavras conectadas na implementa√ß√£o, ou seja, implementadas da mesma maneira que o int√©rprete, s√£o semelhantes aos operadores de outras linguagens.  De fato, um programa em qualquer linguagem de programa√ß√£o nada mais √© do que uma combina√ß√£o de operadores de linguagem e dados.  Portanto, a cria√ß√£o de uma linguagem de programa√ß√£o pode ser considerada como a defini√ß√£o de operadores e como combin√°-los.  Al√©m disso, idiomas como C determinam uma maneira diferente de escrever operadores, que determina a sintaxe do idioma.  Na maioria dos idiomas, a modifica√ß√£o de instru√ß√µes geralmente n√£o √© poss√≠vel - por exemplo, voc√™ n√£o pode alterar a sintaxe ou o comportamento de uma instru√ß√£o if. <br><br>  Na linguagem Fort, todos os operadores e suas combina√ß√µes (palavras do usu√°rio) t√™m o mesmo m√©todo de escrita.  Fort palavras s√£o divididas em primitivo e personalizado.  Voc√™ pode definir uma palavra que sobrecarregar√° o primitivo, alterando assim o comportamento dos primitivos.  Embora, na realidade, a palavra redefinida seja implementada atrav√©s das primitivas definidas inicialmente.  Em nossa implementa√ß√£o, a fun√ß√£o em C # ser√° a primitiva.  Uma palavra definida pelo usu√°rio consiste em uma lista de endere√ßos de palavras a serem executadas.  Como existem dois tipos de palavras, o int√©rprete deve distinguir entre elas.  A separa√ß√£o das primitivas e das palavras do usu√°rio √© realizada pelas mesmas primitivas, cada palavra do usu√°rio come√ßa com uma opera√ß√£o DoList e termina com uma opera√ß√£o Exit. <br><br>  √â poss√≠vel descrever por um longo tempo como ocorre essa separa√ß√£o, mas √© mais f√°cil entender isso estudando a ordem de execu√ß√£o do programa de int√©rpretes.  Para fazer isso, implementamos um int√©rprete m√≠nimo, definimos um programa simples e vemos como ele ser√° executado passo a passo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4l/uq/jw/4luqjwgysqj6iuchqkxdihjof8c.jpeg"></div><br>  Nossa m√°quina forte consiste em mem√≥ria linear, pilha de dados, pilha de retorno, ponteiro de instru√ß√µes, ponteiro de palavras.  Tamb√©m teremos um local separado para armazenar primitivos. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] Mem; <span class="hljs-comment"><span class="hljs-comment">//   public Stack&lt;int&gt; RS; //   public Stack&lt;object&gt; DS; //   public int IP; //   public int WP; //   public delegate void CoreCall(); public List&lt;CoreCall&gt; Core; //  </span></span></code> </pre> <br>  A ess√™ncia da interpreta√ß√£o √© navegar para o endere√ßo na mem√≥ria e executar a instru√ß√£o que √© indicada l√°.  O int√©rprete de endere√ßo inteiro - o cora√ß√£o do idioma - no nosso caso ser√° definido em uma fun√ß√£o Next (). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IP == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; WP = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Mem[IP++]; Core[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Mem[WP]](); } }</code> </pre><br>  Cada palavra de usu√°rio come√ßa com um comando DoList, cuja tarefa √© salvar o endere√ßo de interpreta√ß√£o atual na pilha e definir o endere√ßo de interpreta√ß√£o da pr√≥xima palavra. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RS.Push(IP); IP = WP + <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre><br>  Para sair da palavra, use o comando Exit, que restaura o endere√ßo da pilha de retorno. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IP = RS.Pop(); }</code> </pre><br>  Para uma demonstra√ß√£o visual do princ√≠pio do int√©rprete, apresentamos um comando, que simula trabalhos √∫teis.  Vamos cham√°-lo de Ol√° (). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>); }</code> </pre><br>  Primeiro, voc√™ precisa inicializar a m√°quina e especificar as primitivas para o int√©rprete funcionar corretamente.  Voc√™ tamb√©m deve especificar os endere√ßos das primitivas na mem√≥ria do programa. <br><br><pre> <code class="cs hljs">Mem = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; RS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); DS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(); Core = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;CoreCall&gt;(); Core.Add(Next); Core.Add(DoList); Core.Add(Exit); Core.Add(Hello); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> opNext = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> opDoList = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> opExit = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> opHello = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">// core pointers Mem[opNext] = opNext; Mem[opDoList] = opDoList; Mem[opExit] = opExit; Mem[opHello] = opHello;</span></span></code> </pre><br>  Agora podemos criar um programa simples; no nosso caso, o c√≥digo do usu√°rio come√ßar√° no endere√ßo 4 e consistir√° em dois subprogramas.  A primeira rotina come√ßa no endere√ßo 7 e chama a segunda, que come√ßa no endere√ßo 4 e exibe a palavra Ol√°. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// program Mem[4] = opDoList; // 3)    IP = 9   ,   IP = WP + 1 = 5 Mem[5] = opHello; // 4)     Mem[6] = opExit; // 5)   ,  IP = 9    Mem[7] = opDoList; // 1)     Mem[8] = 4; // 2)     4,  WP = 4 Mem[9] = opExit; // 6)   ,  IP = 0   </span></span></code> </pre><br>  Para executar o programa, primeiro salve o valor 0 na pilha de retorno, pela qual o int√©rprete de endere√ßo interromper√° o ciclo de interpreta√ß√£o, defina o ponto de entrada e, em seguida, inicie o int√©rprete. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> entryPoint = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    IP = 0; //  IP = 0,        WP = entryPoint; //  WP = 7      DoList(); //     ,  IP = 0    Next(); //   </span></span></code> </pre><br>  Conforme descrito, neste int√©rprete, as primitivas ser√£o armazenadas em mem√≥ria separada.  Obviamente, poderia ter sido implementado de maneira diferente: por exemplo, na mem√≥ria do programa, um delegado para a fun√ß√£o de operador foi armazenado.  Por um lado, esse int√©rprete n√£o seria mais f√°cil, mas, por outro, seria claramente mais lento, pois cada etapa da interpreta√ß√£o exigiria verifica√ß√£o, convers√£o e execu√ß√£o de tipos, mais opera√ß√µes s√£o obtidas. <br><br>  Cada palavra de usu√°rio do nosso int√©rprete come√ßa com a primitiva DoList, cuja tarefa √© salvar o endere√ßo atual da interpreta√ß√£o e ir para o pr√≥ximo endere√ßo.  A sa√≠da da sub-rotina √© executada pela opera√ß√£o Exit, que restaura o endere√ßo da pilha de retorno para interpreta√ß√£o adicional.  De fato, descrevemos todo o int√©rprete de endere√ßo.  Para executar programas arbitr√°rios, basta expandi-lo com primitivas.  Mas primeiro voc√™ precisa lidar com um int√©rprete de texto, que fornece uma interface para o int√©rprete de endere√ßo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qp/fw/gt/qpfwgtzzyissc6ujdvq_eq3wdby.jpeg"></div><br><h3>  Int√©rprete de texto </h3><br>  O idioma Fort n√£o tem sintaxe; os programas nele escritos s√£o palavras separadas por espa√ßos, tabula√ß√µes ou extremidades da linha.  Portanto, a tarefa do int√©rprete de texto √© dividir o fluxo de entrada em palavras (tokens), encontrar um ponto de entrada para eles, executar ou gravar na mem√≥ria.  Mas nem todos os tokens est√£o sujeitos √† execu√ß√£o.  Se o int√©rprete n√£o encontrar a palavra, ele tenta interpret√°-la como uma constante num√©rica.  Al√©m disso, o int√©rprete de texto possui dois modos: modo de interpreta√ß√£o e modo de programa√ß√£o.  No modo de programa√ß√£o, os endere√ßos das palavras n√£o s√£o executados, mas s√£o gravados na mem√≥ria, portanto, novas palavras s√£o determinadas. <br><br>  As implementa√ß√µes can√¥nicas do ‚ÄúFort‚Äù geralmente combinam um dicion√°rio (entrada de dicion√°rio) e mem√≥ria de programa, definindo um √∫nico arquivo de c√≥digo na forma de uma lista simplesmente conectada.  Em nossa implementa√ß√£o, apenas o c√≥digo execut√°vel estar√° na mem√≥ria e os pontos de entrada das palavras ser√£o armazenados em uma estrutura separada - um dicion√°rio. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;WordHeader&gt;&gt; Entries;</code> </pre> <br>  Este dicion√°rio define a correspond√™ncia de uma palavra para v√°rios t√≠tulos, para que voc√™ possa definir um n√∫mero arbitr√°rio de rotinas com o mesmo nome e, em seguida, excluir essa defini√ß√£o e come√ßar a usar a antiga.  Al√©m disso, o endere√ßo antigo salvo permite encontrar o nome de uma palavra no dicion√°rio, mesmo que tenha sido redefinida, o que √© especialmente √∫til para gerar um rastreamento de pilha ou depurar para estudar a mem√≥ria.  WordHeader √© uma classe que armazena um endere√ßo de entrada de sub-rotina e um sinalizador de interpreta√ß√£o imediata. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WordHeader</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Address; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Immediate; }</code> </pre><br>  O sinalizador Imediato instrui o int√©rprete que esta palavra deve ser executada no modo de programa√ß√£o e n√£o gravada na mem√≥ria.  Esquematicamente, a l√≥gica do int√©rprete pode ser representada da seguinte forma: a m√£o direita √© SIM, a esquerda √© N√ÉO. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vh/5t/pz/vh5tpzf-atkgovuyyqrqoeitfmo.jpeg"></div><br>  Usaremos o TextReader para ler o fluxo de entrada e o TextWriter para produzi-lo. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextReader Input; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextWriter Output;</code> </pre><br>  A implementa√ß√£o do int√©rprete de acordo com o esquema acima ter√° uma fun√ß√£o: Interpreter (). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Interpreter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> word = ReadWord(Input); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(word)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">// EOF var lookup = LookUp(word); if (IsEvalMode) { if (lookup != null) { Execute(lookup.Address); } else if (IsConstant(word)) { DS.Push(ParseNumber(word)); } else { DS.Clear(); Output.WriteLine($"The word {word} is undefined"); } } else { // program mode if (lookup != null) { if (lookup.Immediate) { Execute(lookup.Address); } else { AddOp(lookup.Address); } } else if (IsConstant(word)) { AddOp(LookUp("doLit").Address); AddOp(ParseNumber(word)); } else { IsEvalMode = true; DS.Clear(); Output.WriteLine($"The word {word} is undefined"); } } } }</span></span></code> </pre><br>  A interpreta√ß√£o √© realizada em um loop, cuja sa√≠da √© realizada ao atingir o final do fluxo de entrada (por exemplo, o final do arquivo), enquanto a fun√ß√£o ReadWord retornar√° uma string vazia.  A tarefa do ReadWord √© retornar a pr√≥xima palavra a cada chamada. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadWord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextReader sr</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = sr.Read(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (IsWhite((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)code) &amp;&amp; code &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { code = sr.Read(); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!IsWhite((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)code) &amp;&amp; code &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { sb.Append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)code); code = sr.Read(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsWhite</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">" \n\r\t"</span></span>.Any(ch =&gt; ch == c); }</code> </pre><br>  Ap√≥s a leitura da palavra, √© feita uma tentativa de encontr√°-la no dicion√°rio.  Se for bem-sucedido, o t√≠tulo da palavra ser√° retornado, caso contr√°rio, nulo. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> WordHeader </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LookUp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> word</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Entries.ContainsKey(word)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Entries[word].Last(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre><br>  Voc√™ pode verificar se o valor digitado √© um n√∫mero pelos dois primeiros caracteres.  Se o primeiro caractere √© um n√∫mero, assumimos que √© um n√∫mero.  Se o primeiro caractere √© um sinal de "+" ou "-" e o segundo √© um d√≠gito, provavelmente este tamb√©m √© um n√∫mero. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsConstant</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> word</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsDigit(word[<span class="hljs-number"><span class="hljs-number">0</span></span>]) || (word.Length &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; (word[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'+'</span></span> || word[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'-'</span></span>) &amp;&amp; IsDigit(word[<span class="hljs-number"><span class="hljs-number">1</span></span>])); }</code> </pre><br>  Para converter uma seq√º√™ncia de caracteres em um n√∫mero, voc√™ pode usar os m√©todos padr√£o Int32.TryParse e Double.TryParse.  Mas eles n√£o diferem na velocidade por v√°rios motivos, ent√£o eu uso uma solu√ß√£o personalizada. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> factor = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sign = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'-'</span></span>) { sign = <span class="hljs-number"><span class="hljs-number">-1</span></span>; str = str.Remove(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'+'</span></span>) { str = str.Remove(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = str.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i--) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str[i] == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) { str = str.Remove(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IntParseFast(str) * factor * sign; } factor *= <span class="hljs-number"><span class="hljs-number">0.1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IntParseFast(str) * sign; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntParseFast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// An optimized int parse method. var result = 0; foreach (var c in value) { if (!(c &gt;= '0' &amp;&amp; c &lt;= '9')) return result; // error result = 10 * result + (c - 48); } return result; }</span></span></code> </pre><br>  O m√©todo ParseNumber pode converter valores inteiros e n√∫meros de ponto flutuante, por exemplo, "1.618". <br><br>  A execu√ß√£o da palavra ocorre da mesma maneira que usamos para executar o interpretador de endere√ßo.  No caso de uma exce√ß√£o, um rastreamento de pilha do interpretador de endere√ßo ser√° impresso. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> address</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address &lt; Core.Count) { <span class="hljs-comment"><span class="hljs-comment">// eval core Core[address](); // invoke core function } else { // eval word IP = 0; // set return address WP = address; // set eval address DoList(); // fake doList Next(); // run evaluator } } catch (Exception e) { Output.WriteLine(e.Message); var wpEntry = Entries.FirstOrDefault(d =&gt; d.Value.Any(en =&gt; en.Address == WP)); var ipEntry = Entries.FirstOrDefault(d =&gt; d.Value.Any(en =&gt; en.Address == SearchKnowAddress(IP))); Output.WriteLine($"WP = {WP:00000} - '{wpEntry.Key}', IP = {IP:00000} - '{ipEntry.Key}'"); if (RS.Any()) { Output.WriteLine("Stack trace..."); foreach (var a in RS) { var ka = SearchKnowAddress(a); var sEntry = Entries.FirstOrDefault(d =&gt; d.Value.Any(en =&gt; en.Address == ka)); Output.WriteLine($"...{a:00000} -- {sEntry.Key}"); } RS.Clear(); DS.Clear(); } else if (address &lt; Core.Count) { var entry = Entries.FirstOrDefault(d =&gt; d.Value.Any(en =&gt; en.Address == address)); Output.WriteLine($"Core word is {entry.Key}"); } IP = WP = 0; } }</span></span></code> </pre><br>  Quando o int√©rprete est√° no modo de compila√ß√£o e a palavra n√£o √© marcada para execu√ß√£o imediata, seu endere√ßo deve ser gravado na mem√≥ria. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddOp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> op</span></span></span><span class="hljs-function">)</span></span> { Mem[Here++] = op; }</code> </pre><br>  A vari√°vel here armazena o endere√ßo da pr√≥xima c√©lula livre.  Como essa vari√°vel deve estar acess√≠vel no ambiente de tempo de execu√ß√£o como uma vari√°vel da linguagem Fort, o valor aqui √© armazenado na mem√≥ria do programa em um determinado deslocamento. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _hereShift; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Here { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Mem[_hereShift]; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; Mem[_hereShift] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; }</code> </pre><br>  Para distinguir entre uma constante num√©rica e um endere√ßo de palavra durante a interpreta√ß√£o, uma compila√ß√£o da palavra doLit √© compilada antes de cada constante durante a compila√ß√£o, que l√™ o pr√≥ximo valor na mem√≥ria e o coloca na pilha de dados. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoLit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DS.Push(Mem[IP++]); }</code> </pre><br>  Descrevemos int√©rpretes de endere√ßo e texto; o desenvolvimento posterior consiste em preencher o n√∫cleo com √°tomos.  Vers√µes diferentes de "Fort" t√™m um conjunto diferente de palavras b√°sicas; a implementa√ß√£o mais minimalista ser√°, talvez, eForth, que cont√©m apenas 31 primitivas.  Como o primitivo √© executado mais rapidamente que as palavras de usu√°rio compostas, as implementa√ß√µes Fort m√≠nimas geralmente s√£o mais lentas que as implementa√ß√µes detalhadas.  Uma compara√ß√£o do conjunto de palavras de v√°rias vers√µes de int√©rpretes pode ser encontrada <a href="http://forthworks.com/forth/papers/compare.pdf">aqui</a> . <br><br>  No int√©rprete descrito aqui, tamb√©m tentei n√£o inflar desnecessariamente o dicion√°rio de palavras b√°sicas.  Mas, para facilitar a integra√ß√£o com a plataforma .net, decidi implementar matem√°tica, opera√ß√µes booleanas e, √© claro, reflex√£o atrav√©s de um conjunto de primitivas.  Ao mesmo tempo, algumas das palavras que geralmente s√£o primitivas nas implementa√ß√µes do Fort est√£o ausentes aqui, implicando a implementa√ß√£o por meio do int√©rprete. <br><br><div class="spoiler">  <b class="spoiler_title">No momento da reda√ß√£o, o conjunto b√°sico √© de 68 palavras.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Core SetCoreWord("nop", Nop); SetCoreWord("next", Next); SetCoreWord("doList", DoList); SetCoreWord("exit", Exit); SetCoreWord("execute", Execute); SetCoreWord("doLit", DoLit); SetCoreWord(":", BeginDefWord); SetCoreWord(";", EndDefWord, true); SetCoreWord("branch", Branch); SetCoreWord("0branch", ZBranch); SetCoreWord("here", GetHereAddr); SetCoreWord("quit", Quit); SetCoreWord("dump", Dump); SetCoreWord("words", Words); SetCoreWord("'", Tick); SetCoreWord(",", Comma); SetCoreWord("[", Lbrac, true); SetCoreWord("]", Rbrac); SetCoreWord("immediate", Immediate, true); // Mem SetCoreWord("!", WriteMem); SetCoreWord("@", ReadMem); SetCoreWord("variable", Variable); SetCoreWord("constant", Constant); // RW SetCoreWord(".", Dot); SetCoreWord(".s", DotS); SetCoreWord("cr", Cr); SetCoreWord("bl", Bl); SetCoreWord("word", ReadWord, true); SetCoreWord("s\"", ReadString, true); SetCoreWord("key", Key); // Comment SetCoreWord("(", Comment, true); SetCoreWord("\\", CommentLine, true); // .net mem SetCoreWord("null", Null); SetCoreWord("new", New); SetCoreWord("type", GetType); SetCoreWord("m!", SetMember); SetCoreWord("m@", GetMember); SetCoreWord("ms@", GetStaticMember); SetCoreWord("ms!", SetStaticMember); SetCoreWord("load-assembly", LoadAssembly); SetCoreWord("invk", invk); // Boolean SetCoreWord("true", True); SetCoreWord("false", False); SetCoreWord("and", And); SetCoreWord("or", Or); SetCoreWord("xor", Xor); SetCoreWord("not", Not); SetCoreWord("invert", Invert); SetCoreWord("=", Eql); SetCoreWord("&lt;&gt;", NotEql); SetCoreWord("&lt;", Less); SetCoreWord("&gt;", Greater); SetCoreWord("&lt;=", LessEql); SetCoreWord("&gt;=", GreaterEql); // Math SetCoreWord("-", Minus); SetCoreWord("+", Plus); SetCoreWord("*", Multiply); SetCoreWord("/", Devide); SetCoreWord("mod", Mod); SetCoreWord("1+", Inc); SetCoreWord("1-", Dec); // Stack SetCoreWord("drop", Drop); SetCoreWord("swap", Swap); SetCoreWord("dup", Dup); SetCoreWord("over", Over); SetCoreWord("rot", Rot); SetCoreWord("nrot", Nrot);</span></span></code> </pre><br></div></div><br>  Para definir novas palavras de usu√°rio, duas palavras do kernel s√£o usadas: ‚Äú:‚Äù e ‚Äú;‚Äù.  A palavra ‚Äú:‚Äù l√™ o nome de uma nova palavra do fluxo de entrada, cria um cabe√ßalho com essa tecla, o endere√ßo da palavra base doList √© adicionado √† mem√≥ria do programa e o int√©rprete √© colocado no modo de compila√ß√£o.  Todas as palavras subsequentes ser√£o compiladas, com exce√ß√£o daquelas marcadas como imediatas. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginDefWord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { AddHeader(ReadWord(Input)); AddOp(LookUp(<span class="hljs-string"><span class="hljs-string">"doList"</span></span>).Address); IsEvalMode = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  A compila√ß√£o termina com a palavra ";", que grava o endere√ßo da palavra "exit" na mem√≥ria do programa e o coloca no modo de interpreta√ß√£o.  Agora voc√™ pode definir palavras personalizadas - por exemplo, loops, uma declara√ß√£o condicional e outras. <br><br><pre> <code class="cs hljs">Eval(<span class="hljs-string"><span class="hljs-string">": ? @ . ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": allot here @ + here ! ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": if immediate doLit [ ' 0branch , ] , here @ 0 , ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": then immediate dup here @ swap - swap ! ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": else immediate [ ' branch , ] , here @ 0 , swap dup here @ swap - swap ! ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": begin immediate here @ ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": until immediate doLit [ ' 0branch , ] , here @ - , ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": again immediate doLit [ ' branch , ] , here @ - , ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": while immediate doLit [ ' 0branch , ] , here @ 0 , ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": repeat immediate doLit [ ' branch , ] , swap here @ - , dup here @ swap - swap ! ;"</span></span>); Eval(<span class="hljs-string"><span class="hljs-string">": // immediate [ ' \\ , ] ;"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// C like comment</span></span></code> </pre><br>  N√£o descreverei o restante das palavras padr√£o aqui - h√° informa√ß√µes suficientes sobre elas na rede sobre os recursos tem√°ticos correspondentes.  Para interagir com a plataforma, defini 9 palavras: <br><br><ul><li>  "Nulo" - empurra nulo para a pilha; </li><li>  "Type" - envia o tipo de classe para a pilha de "word TrueForth.MyClass type"; </li><li>  ‚ÄúNovo‚Äù - pega o tipo da pilha, cria uma inst√¢ncia da classe e a coloca na pilha; os argumentos do construtor, se houver, tamb√©m devem estar na pilha ‚Äúword TrueForth.MyClass type new‚Äù; </li><li>  "M!" - pega uma inst√¢ncia de um objeto, nome do campo, valor da pilha e atribui um valor ao campo especificado; </li><li>  "M @" - seleciona uma inst√¢ncia de um objeto da pilha, o nome do campo e retorna o valor do campo para a pilha; </li><li>  "Ms!" E "ms @" - semelhantes aos anteriores, mas para campos est√°ticos, em vez de uma inst√¢ncia, deve haver um tipo na pilha; </li><li>  "Load-assembly" - pega da pilha, deixa-a na montagem e carrega na mem√≥ria; </li><li>  ‚ÄúInvk‚Äù - pega o delegado, os argumentos da pilha e o chama ‚Äú1133 word SomeMethod word TrueForth.MyClass type new m @ invk‚Äù. </li></ul><br>  Descrevi os principais pontos da implementa√ß√£o da linguagem Fort; essa implementa√ß√£o n√£o busca oferecer suporte aos padr√µes ANSI para a linguagem, pois sua tarefa √© implementar um mecanismo para a constru√ß√£o de DSL e n√£o implementar uma linguagem de uso geral.  Na maioria dos casos, o int√©rprete desenvolvido √© suficiente para criar uma linguagem simples da √°rea de assunto. <br><br>  Existem v√°rias maneiras de usar o int√©rprete acima.  Por exemplo, voc√™ pode criar uma inst√¢ncia do int√©rprete e enviar um script de inicializa√ß√£o para a entrada, na qual as palavras necess√°rias s√£o determinadas.  Este √∫ltimo, atrav√©s da reflex√£o, interage com o sistema. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init4Th</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Interpreter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OForth(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(InitFile)) { Interpreter.Eval(File.ReadAllText(InitFile)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"  </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{InitFile}</span></span></span><span class="hljs-string">  !"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  Exemplo de configura√ß√£o do sistema de distribui√ß√£o de relat√≥rios <br><br><pre> <code class="plaintext hljs">( *****   ***** ) word GetFReporter word ReportProvider.FlexReports.FReporterEntry type new m@ invk constant fr //       :  word ReportProvider.FlexReports.FDailyReport type new ; //       :  word AddReport fr m@ invk ; //          :  [ ' word , ] ; //   :  [ ' word , ] ; //   :  [ ' s" , ] ; //  ,      " :  ; //  :  dup [ ' word , ] swap word MailSql swap m! ; :  dup [ ' word , ] swap word XlsSql swap m! ; ( *****    ***** ) cr s"   " . cr cr    "  08:00  mail@tinkoff.ru   seizure.sql    ,    "  08:00  mail@tinkoff.ru   fixed-errors-top.sql   fixed-errors.sql         WO"  08:00  mail@tinkoff.ru   wo-wait-complect-dates.sql       "  07:30  mail@tinkoff.ru   top-previous-input-errors.sql   previous-input-errors.sql        "  10:00  mail@tinkoff.ru   collection-report.sql       BPM   "  08:00  mail@tinkoff.ru   bpm-inbox-report.sql       ScanDoc3   7 "  07:50  mail@tinkoff.ru   new-sd3-complects-prevew.sql   new-sd3-complects.sql  ( ******************************** ) cr s"  " . cr</code> </pre><br>  Voc√™ pode fazer o contr√°rio: passar objetos prontos para a entrada do int√©rprete pela pilha de dados e interagir com eles atrav√©s do int√©rprete.  Como por exemplo, eu fiz para restaurar as configura√ß√µes do dispositivo para receber digitaliza√ß√µes de documentos, um scanner, uma webcam ou um dispositivo virtual (para depura√ß√£o ou treinamento).  Nesse caso, o conjunto de par√¢metros, configura√ß√µes, a ordem de inicializa√ß√£o de diferentes dispositivos √© muito diferente e √© resolvido trivialmente pelo int√©rprete forte. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interpreter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OForth(); interpreter.DS.Push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Push current instance on DataStack interpreter.Eval("constant arctium"); // Define constant with the instance if (File.Exists(ConfigName)) { interpreter.Eval(File.ReadAllText(ConfigName)); }</span></span></code> </pre><br>  A configura√ß√£o √© gerada programaticamente, acontece algo como isto: <br><br><pre> <code class="plaintext hljs">s" @device:pnp:\\?\usb#vid_2b16&amp;pid_6689&amp;mi_00#6&amp;1ef84f63&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global" s" Doccamera" word Scanning.Devices.PhotoScanner.PhotoScannerDevice type new dup s" 3264x2448, FPS:20, BIT:24" swap word SetSnapshotMode swap m@ invk dup s" 1280x720, FPS:30, BIT:24" swap word SetPreviewMode swap m@ invk word SetActiveDevice arctium m@ invk</code> </pre><br>  A prop√≥sito, os scripts * .ps e * .pdf s√£o gerados de maneira semelhante, porque PostScript e Pdf s√£o essencialmente um subconjunto do "Fort", mas s√£o usados ‚Äã‚Äãexclusivamente para renderizar documentos na tela ou na impressora. <br><br>  √â igualmente f√°cil implementar o modo interativo para console e n√£o apenas aplicativos.  Para fazer isso, voc√™ deve primeiro inicializar o sistema atrav√©s do script preparado e, em seguida, iniciar a interpreta√ß√£o definindo o int√©rprete na entrada padr√£o STDIN. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interpreter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OForth(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> InitFile = <span class="hljs-string"><span class="hljs-string">"Init.4th"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(InitFile)) { interpreter.Eval(File.ReadAllText(InitFile)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"  </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{InitFile}</span></span></span><span class="hljs-string">  !"</span></span>); } interpreter.Eval(Console.In); <span class="hljs-comment"><span class="hljs-comment">// Start interactive console</span></span></code> </pre><br>  O script de inicializa√ß√£o pode ser assim: <br><br><pre> <code class="plaintext hljs">( *****   ***** ) word ComplectBuilder.Program type constant main //     : mode! [ ' word , ] word Mode main ms! ; //    : init word Init main ms@ invk ; //  : load [ ' word , ] word LoadFile main ms@ invk ; //   : start word StartProcess main ms@ invk ; //   : count word Count main ms@ invk ; //   : all count ; //  ( *****  ***** ) init cr cr s"    ,     help" . cr cr ( *****  ***** ) : help s"         :" . cr s" load scandoc_test.csv 0 all start" . cr bl bl s" load scandoc_test.csv --    " . cr bl bl s" 0 all start --  ,  0      all " . cr cr s"     DEV TEST PROD:" . cr s" mode! DEV init" . cr s"     :" . cr s" word Mode main ms@ . cr" . cr ;</code> </pre><br>  Como entrada, pode haver n√£o apenas um console ou texto de um aplicativo TextBox com uma interface do usu√°rio, mas tamb√©m uma rede.  Nesse caso, voc√™ pode implementar um controle interativo simples, por exemplo, um servi√ßo, para depurar, iniciar, parar componentes.  As possibilidades de tal uso s√£o limitadas pela imagina√ß√£o do desenvolvedor e pela tarefa em quest√£o.    ,     UI    -     . <br><br>         .      ,         ,       . <br><br>   ,   : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> word, MulticastDelegate action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(word) || word.Any(c =&gt; <span class="hljs-string"><span class="hljs-string">" \n\r\t"</span></span>.Any(cw =&gt; cw == c))) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"invalid format of word"</span></span>); } DS.Push(action); Eval(<span class="hljs-string"><span class="hljs-string">$": </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{word}</span></span></span><span class="hljs-string"> [ ' doLit , , ] invk ;"</span></span>); }</code> </pre><br>        DS.Push(action),       . ,  ,     [ ],  ,   .  ' Tick         ,      doLit,    ,           .  Comma ¬´,¬ª  doLit,     . <br><br>     ,      .     ,      : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WoConfItem</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ComplectType; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Route; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Deal; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStampQuery; }</code> </pre><br>     ‚Äî   ,   : <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WoConfig</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OForth VM; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;WoConfItem&gt; _conf; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WoConfig</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> confFile</span></span></span><span class="hljs-function">)</span></span> { _conf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;WoConfItem&gt;(); VM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OForth(); <span class="hljs-comment"><span class="hljs-comment">//      VM.Callback("new-conf", new Action(ClearConf)); VM.Callback("{", new Func&lt;WoConfItem&gt;(NewConf)); VM.Callback("}", new Action&lt;WoConfItem&gt;(AddConf)); VM.Callback("complect-type", new Func&lt;WoConfItem,string,WoConfItem&gt;(ConfComplectType)); VM.Callback("route", new Func&lt;WoConfItem,string,WoConfItem&gt;(ConfRoute)); VM.Callback("deal", new Func&lt;WoConfItem,string,WoConfItem&gt;(ConfDeal)); VM.Callback("is-stamp-query", new Func&lt;WoConfItem,bool,WoConfItem&gt;(ConfIsStampQuery)); //  ,   ,       var initScript = new StringBuilder(); initScript.AppendLine(": complect-type [ ' word , ] swap complect-type ;"); initScript.AppendLine(": route [ ' word , ] swap route ;"); initScript.AppendLine(": deal [ ' word , ] swap deal ;"); initScript.AppendLine(": is-stamp-query ' execute swap is-stamp-query ;"); VM.Eval(initScript.ToString()); //   WatchConfig(confFile); } private void ReadConfig(string path) { using (var reader = new StreamReader(File.OpenRead(path), Encoding.Default)) { VM.Eval(reader); } } readonly Func&lt;string, bool&gt; _any = s =&gt; s == "*"; public WoConfItem GetConf(string complectType, string routeId) { return _conf?.FirstOrDefault(cr =&gt; (cr.ComplectType == complectType || _any(cr.ComplectType)) &amp;&amp; (cr.Route == routeId || _any(cr.Route)) ); } public bool IsAllow(string complectType, string routeId) { return GetConf(complectType, routeId) != null; } void WatchConfig(string path) { var directory = Path.GetDirectoryName(path); var fileName = Path.GetFileName(path); //   ,     if (!File.Exists(path)) { if (!Directory.Exists(directory)) { Directory.CreateDirectory(directory); } var sb = new StringBuilder(); sb.AppendLine("\\ WO passport configuration"); sb.AppendLine("new-conf"); sb.AppendLine(""); sb.AppendLine("\\ Config rules"); sb.AppendLine("\\ { -- begin config item, } -- end config item, * -- match any values"); sb.AppendLine("\\ Example:"); sb.AppendLine("\\ { complect-type * route offer deal 100500 is-stamp-query true }"); sb.AppendLine(""); File.WriteAllText(path, sb.ToString(), Encoding.Default); } //   ReadConfig(path); //     var fsWatcher = new FileSystemWatcher(directory, fileName); fsWatcher.Changed += (sender, args) =&gt; { try { fsWatcher.EnableRaisingEvents = false; //        , //     ,   //     Thread.Sleep(1000); ReadConfig(path); } catch (Exception e) { Console.WriteLine(e); } finally { fsWatcher.EnableRaisingEvents = true; } }; fsWatcher.EnableRaisingEvents = true; } //  ,    void ClearConf() { _conf.Clear(); } void AddConf(WoConfItem conf) { _conf.Add(conf); } static WoConfItem NewConf() { return new WoConfItem(); } static WoConfItem ConfComplectType(WoConfItem conf, string complectType) { conf.ComplectType = complectType; return conf; } static WoConfItem ConfRoute(WoConfItem conf, string route) { conf.Route = route; return conf; } static WoConfItem ConfDeal(WoConfItem conf, string deal) { conf.Deal = deal; return conf; } static WoConfItem ConfIsStampQuery(WoConfItem conf, bool isStampQuery) { conf.IsStampQuery = isStampQuery; return conf; } }</span></span></code> </pre><br></div></div><br>  : <br><br><pre> <code class="plaintext hljs">\ WO passport configuration new-conf \ Config rules \ { -- begin config item, } -- end config item, * -- match any values \ Example: \ { complect-type * route offer deal 100500 is-stamp-query true } \ ***** offer ***** { complect-type offer route offer is-stamp-query false deal 5c18e87bfeed2b0b883fd4df } { complect-type KVK route offer is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type offer-cred route offer is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type offer-dep route offer is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type quick-meeting route offer is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type exica route offer is-stamp-query true deal 5d03a894e2f5850001435492 } { complect-type reissue route offer is-stamp-query true deal 5d03a894e2f5850001435492 } \ ***** offer-flow ***** { complect-type KVK route offer-flow is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type offer-cred route offer-flow is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type offer-dep route offer-flow is-stamp-query true deal 5d03a8a1edf8af0001876df0 } { complect-type reissue route offer-flow is-stamp-query true deal 5d03a894e2f5850001435492 }</code> </pre><br> ,     ,       DSL   ‚Äî    . <br><br> ,          ¬´¬ª.          DSL. <br><br> ,     ,   ‚Äî ,   , ,    ,    ‚Äî      .        ,           . <br><br>   ‚Äî         ,             .  ‚Äî  ,       ‚Äî  ! <br><br>       <a href="">,  </a> . <br><br>   <a href="http://rigidus.ru/lrn/forth/jonesforth-1.html">    -</a> . <br><br>  Boa sorte </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477902/">https://habr.com/ru/post/pt477902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477892/index.html">DevOps: resultados de 2019 e pr√≥xima previs√£o da comunidade DevOps</a></li>
<li><a href="../pt477894/index.html">trabalho e desenvolvimento divertido (princ√≠pios) # 0. O que esperar e como ajudar a transformar um desenvolvedor trainee em um junior confiante?</a></li>
<li><a href="../pt477896/index.html">Escolha o segmento de or√ßamento de fones de ouvido com fio</a></li>
<li><a href="../pt477898/index.html">Introdu√ß√£o √† programa√ß√£o orientada a contexto Kotlin</a></li>
<li><a href="../pt477900/index.html">N√∫meros primos - qu√£o grande √© a nossa impot√™ncia?</a></li>
<li><a href="../pt477904/index.html">Procurando programaticamente por c√≥digo comum com oEmbed</a></li>
<li><a href="../pt477906/index.html">Slurm: 50% de desconto nos cursos online da Black Friday</a></li>
<li><a href="../pt477910/index.html">Black Friday 2019 - VDS em Moscou e Amsterd√£, servidores com GPU</a></li>
<li><a href="../pt477912/index.html">Primeiras impress√µes do leitor PocketBook X de 10,3 polegadas com tela E Ink Carta Mobius</a></li>
<li><a href="../pt477914/index.html">Proje√ß√£o no teto: impress√µes ap√≥s uma semana de uso do projetor, coloque ‚Äúno final‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>