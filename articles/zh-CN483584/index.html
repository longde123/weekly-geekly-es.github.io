<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™‰ï¸ ğŸ• âŒ›ï¸ å°†PHPåç«¯ä¼ è¾“åˆ°Redisæµæ€»çº¿å¹¶é€‰æ‹©ç‹¬ç«‹äºæ¡†æ¶çš„åº“ ğŸ—½ ğŸ‘¨ğŸ¿â€âœˆï¸ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰è¨€ 
 æˆ‘çš„ç½‘ç«™æ˜¯æˆ‘çš„çˆ±å¥½ï¼Œæ—¨åœ¨å­˜å‚¨æœ‰è¶£çš„ä¸»é¡µå’Œä¸ªäººç½‘ç«™ã€‚ è¿™ä¸ªè¯é¢˜åœ¨æˆ‘ç¼–ç¨‹ç”Ÿæ¶¯çš„å¼€å§‹å°±å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œé‚£æ—¶æˆ‘å¾ˆé«˜å…´æ‰¾åˆ°ä¼˜ç§€çš„ä¸“ä¸šäººå£«ï¼Œä»–ä»¬ä¼šä¸ºè‡ªå·±ï¼Œè‡ªå·±çš„çˆ±å¥½å’Œé¡¹ç›®åšæ–‡ç« ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå‘ç°å®ƒä»¬çš„ä¹ æƒ¯ä»ç„¶å­˜åœ¨ï¼šåœ¨å‡ ä¹æ¯ä¸ªå•†ä¸šç½‘ç«™ä¸Šï¼Œè€Œä¸æ˜¯éå¸¸ç½‘ç«™ä¸Šï¼Œæˆ‘éƒ½ç»§ç»­åœ¨é¡µè„šä¸­å¯»æ‰¾ä½œè€…é“¾æ¥ã€‚ 

 æƒ³æ³•çš„å®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å°†PHPåç«¯ä¼ è¾“åˆ°Redisæµæ€»çº¿å¹¶é€‰æ‹©ç‹¬ç«‹äºæ¡†æ¶çš„åº“</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483584/"><img src="https://habrastorage.org/webt/wk/hw/mm/wkhwmmingyzwy7-r1esz_9vna54.png"><br><br><h2> å‰è¨€ </h2><br> æˆ‘çš„ç½‘ç«™æ˜¯æˆ‘çš„çˆ±å¥½ï¼Œæ—¨åœ¨å­˜å‚¨æœ‰è¶£çš„ä¸»é¡µå’Œä¸ªäººç½‘ç«™ã€‚ è¿™ä¸ªè¯é¢˜åœ¨æˆ‘ç¼–ç¨‹ç”Ÿæ¶¯çš„å¼€å§‹å°±å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œé‚£æ—¶æˆ‘å¾ˆé«˜å…´æ‰¾åˆ°ä¼˜ç§€çš„ä¸“ä¸šäººå£«ï¼Œä»–ä»¬ä¼šä¸ºè‡ªå·±ï¼Œè‡ªå·±çš„çˆ±å¥½å’Œé¡¹ç›®åšæ–‡ç« ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå‘ç°å®ƒä»¬çš„ä¹ æƒ¯ä»ç„¶å­˜åœ¨ï¼šåœ¨å‡ ä¹æ¯ä¸ªå•†ä¸šç½‘ç«™ä¸Šï¼Œè€Œä¸æ˜¯éå¸¸ç½‘ç«™ä¸Šï¼Œæˆ‘éƒ½ç»§ç»­åœ¨é¡µè„šä¸­å¯»æ‰¾ä½œè€…é“¾æ¥ã€‚ <br><a name="habracut"></a><br><h2> æƒ³æ³•çš„å®æ–½ </h2><br> ç¬¬ä¸€ä¸ªç‰ˆæœ¬åªæ˜¯æˆ‘ä¸ªäººç½‘ç«™ä¸Šçš„htmlé¡µé¢ï¼Œæˆ‘å°†å¸¦æœ‰ç­¾åçš„é“¾æ¥æ”¾åœ¨ulåˆ—è¡¨ä¸­ã€‚ é”®å…¥äº†20é¡µä¸€æ®µæ—¶é—´åï¼Œæˆ‘å¼€å§‹è®¤ä¸ºå®ƒä¸æ˜¯å¾ˆæœ‰æ•ˆï¼Œå› æ­¤å†³å®šå°è¯•ä½¿è¯¥è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚ åœ¨stackoverflowä¸Šï¼Œæˆ‘æ³¨æ„åˆ°è®¸å¤šäººåœ¨å…¶é…ç½®æ–‡ä»¶ä¸­æŒ‡ç¤ºäº†ç«™ç‚¹ï¼Œå› æ­¤æˆ‘å†™äº†ä¸€ä¸ªphpè§£æå™¨ï¼Œä»ç¬¬ä¸€ä¸ªï¼ˆSOä¸Šçš„åœ°å€åˆ°ä»Šå¤©è¿™æ ·çš„åœ°å€ï¼š/ users / 1ï¼‰å¼€å§‹æµè§ˆäº†è¿™äº›é…ç½®æ–‡ä»¶ï¼Œæå–äº†é“¾æ¥ä»æ‰€éœ€çš„æ ‡ç­¾ï¼Œå¹¶å †å åœ¨SQLiteä¸­ã€‚ <br><br> è¿™å¯ä»¥ç§°ä¸ºç¬¬äºŒä¸ªç‰ˆæœ¬ï¼šSQLiteæ¿ä¸­æˆåƒä¸Šä¸‡ä¸ªURLçš„é›†åˆï¼Œè¯¥é›†åˆæ›¿æ¢äº†htmlä¸­çš„é™æ€åˆ—è¡¨ã€‚ æˆ‘åœ¨æ­¤åˆ—è¡¨ä¸Šè¿›è¡Œäº†ç®€å•æœç´¢ã€‚ å› ä¸º åªæœ‰ç½‘å€ï¼Œç„¶åæœç´¢ä»…é’ˆå¯¹å®ƒä»¬ã€‚ <br><br> åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´åï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘æ”¾å¼ƒäº†è¯¥é¡¹ç›®å¹¶è¿”å›äº†è¯¥é¡¹ç›®ã€‚ åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘çš„å·¥ä½œç»éªŒå·²ç»è¶…è¿‡ä¸‰å¹´ï¼Œæˆ‘è§‰å¾—è‡ªå·±å¯ä»¥åšçš„æ›´è®¤çœŸã€‚ å¦å¤–ï¼Œäººä»¬è¿«åˆ‡å¸Œæœ›è‡ªå·±æŒæ¡ç›¸å¯¹è¾ƒæ–°çš„æŠ€æœ¯ã€‚ <br><br><h2> ç°ä»£ç‰ˆæœ¬ </h2><br>  <a href="https://hpdb.ru/">è¯¥é¡¹ç›®å·²</a>éƒ¨ç½²åœ¨dockerä¸­ï¼Œæ•°æ®åº“å·²è½¬ç§»åˆ°mongoDbï¼Œå¹¶ä¸”ç›¸å¯¹è¾ƒæ–°åœ°æ·»åŠ äº†èåœï¼Œèµ·åˆåªæ˜¯ç”¨äºç¼“å­˜ã€‚ ä½œä¸ºåŸºç¡€ï¼Œä½¿ç”¨äº†ä¸€ä¸ªPHPå¾®æ¡†æ¶ã€‚ <br><br><h4> é—®é¢˜ </h4><br> é€šè¿‡æ§åˆ¶å°å‘½ä»¤æ·»åŠ æ–°ç«™ç‚¹ï¼Œè¯¥å‘½ä»¤åŒæ­¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ul><li> é€šè¿‡URLä¸‹è½½å†…å®¹ <br></li><li> æ ‡è®°HTTPSæ˜¯å¦å¯ç”¨ <br></li><li> ä¿ç•™ç½‘ç«™çš„æœ¬è´¨ <br></li><li> æºHTMLå’Œæ ‡å¤´ä¿å­˜åˆ°ç´¢å¼•å†å²è®°å½• <br></li><li> è§£æå†…å®¹ï¼Œæ£€ç´¢æ ‡é¢˜å’Œæè¿° <br></li><li> å°†æ•°æ®ä¿å­˜åˆ°å•ç‹¬çš„é›†åˆä¸­ã€‚ <br></li></ul><br> ä»…å­˜å‚¨ç«™ç‚¹å¹¶å°†å…¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­å°±è¶³å¤Ÿäº†ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a4/914/0f8/5a49140f8a7a27eac0e22c21b24ada69.png"><br><br> ä½†æ˜¯ï¼Œè‡ªåŠ¨å¯¹æ‰€æœ‰å†…å®¹è¿›è¡Œç´¢å¼•ï¼Œåˆ†ç±»å’Œæ’åï¼Œä½¿æ‰€æœ‰å†…å®¹ä¿æŒæœ€æ–°çŠ¶æ€çš„æƒ³æ³•è¾ƒå¼±åœ°é€‚åˆäºæ­¤èŒƒä¾‹ã€‚ å³ä½¿åªæ˜¯æ·»åŠ Webæ–¹æ³•æ¥æ·»åŠ é¡µé¢ï¼Œä¹Ÿéœ€è¦ä»£ç å¤åˆ¶å’Œé˜»æ­¢ï¼Œä»¥é¿å…æ½œåœ¨çš„DDoSã€‚ <br><br> é€šå¸¸ï¼Œå½“ç„¶ï¼Œæ‰€æœ‰æ“ä½œéƒ½å¯ä»¥åŒæ­¥å®Œæˆï¼Œåœ¨Webæ–¹æ³•ä¸­ï¼Œåªéœ€ä¿å­˜URLä»¥ç¡®ä¿å¯æ€•çš„å®ˆæŠ¤ç¨‹åºæ‰§è¡Œåˆ—è¡¨ä¸­URLçš„æ‰€æœ‰ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨è¿™é‡Œï¼Œâ€œè½¬å‘â€ä¸€è¯ä¹Ÿæ˜¯ä¸€æ ·ã€‚ è€Œä¸”ï¼Œå¦‚æœå®ç°äº†é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå¯ä»¥åˆ’åˆ†å¹¶è‡³å°‘å¼‚æ­¥æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚ <br><br><h4> è§£å†³æ–¹æ¡ˆ </h4><br> ä»‹ç»é˜Ÿåˆ—å¹¶ä¸ºæ‰€æœ‰ä»»åŠ¡åˆ›å»ºäº‹ä»¶é©±åŠ¨çš„å¤„ç†ç³»ç»Ÿã€‚ è€Œä¸”å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæˆ‘éƒ½æƒ³å°è¯•Redis Streamsã€‚ <br><br><h2> åœ¨PHPä¸­ä½¿ç”¨Redisæµ </h2><br> å› ä¸º æˆ‘æ²¡æœ‰Symfonyï¼ŒLaravelï¼ŒYiiè¿™ä¸‰å¤§å·¨å¤´çš„æ¡†æ¶ï¼Œæˆ‘æƒ³æ‰¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å›¾ä¹¦é¦†ã€‚ ä½†æ˜¯ï¼Œäº‹å®è¯æ˜ï¼ˆåœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥æ—¶ï¼‰ï¼Œä¸å¯èƒ½æ‰¾åˆ°å„ä¸ªä¸¥è‚ƒçš„å›¾ä¹¦é¦†ã€‚ ä¸é˜Ÿåˆ—ç›¸å…³çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯5å¹´å‰3æ¬¡æäº¤çš„é¢„æµ‹ï¼Œæˆ–è€…æ˜¯ä¸æ¡†æ¶ç›¸å…³çš„ã€‚ <br><br> æˆ‘å¬è¯´è¿‡Symfonyæ˜¯ä¸€äº›æœ‰ç”¨ç»„ä»¶çš„æä¾›è€…ï¼Œå¹¶ä¸”æˆ‘å·²ç»ä½¿ç”¨äº†ä¸€äº›ã€‚ åŒæ ·ä»Laravelï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ä¸œè¥¿ï¼Œä¾‹å¦‚å®ƒä»¬çš„ORMï¼Œè€Œæ— éœ€æ¡†æ¶æœ¬èº«ã€‚ <br><br><h4>  symfony / Messenger </h4><br> ç¬¬ä¸€ä½å€™é€‰äººç«‹å³æ˜¾å¾—å¾ˆç†æƒ³ï¼Œæ¯«æ— ç–‘é—®ï¼Œæˆ‘å®‰è£…äº†å®ƒã€‚ ä½†æ˜¯ï¼Œå¾ˆéš¾åœ¨Symfonyä¹‹å¤–æœç´¢ä½¿ç”¨ç¤ºä¾‹ã€‚ å¦‚ä½•ä»å…·æœ‰é€šç”¨åç§°ï¼Œä¸è¯´ä»»ä½•åç§°ï¼Œå‘é€æ¶ˆæ¯çš„æ€»çº¿ç”šè‡³æ˜¯Redisçš„ç±»çš„å †ä¸­æ”¶é›†æ•°æ®ï¼Ÿ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2b/1bf/ac0/f2b1bfac07a1e307d7b5826a1b191e3d.png"><br><br> å®˜æ–¹ç«™ç‚¹ä¸Šçš„æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œä½†æ˜¯ä»…é’ˆå¯¹Symfonyä½¿ç”¨å…¶æœ€å–œæ¬¢çš„YMLå’Œå…¶ä»–éäº¤å“ä¹æ‰‹çš„é­”æœ¯æ–¹æ³•å¯¹åˆå§‹åŒ–è¿›è¡Œäº†æè¿°ã€‚ æˆ‘å¯¹å®‰è£…è¿‡ç¨‹æ²¡æœ‰å…´è¶£ï¼Œå°¤å…¶æ˜¯åœ¨æ–°å¹´å‡æœŸæœŸé—´ã€‚ ä½†æ˜¯æˆ‘ä¸å¾—ä¸è¿™ä¹ˆåšäº†å¾ˆé•¿æ—¶é—´ã€‚ <br><br> åœ¨æˆªæ­¢æ—¥æœŸç´§è¿«çš„æƒ…å†µä¸‹ï¼Œå°è¯•å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨Symfonyæºå®ä¾‹åŒ–ç³»ç»Ÿä¹Ÿä¸æ˜¯æœ€çç¢çš„ä»»åŠ¡ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc7/de8/991/bc7de89919463a8e7e4bfc5adec9df27.png"><br><br> åå¤ç ”ç©¶å¹¶å°è¯•ç”¨æ‰‹åšæŸäº‹ï¼Œæˆ‘å¾—å‡ºçš„ç»“è®ºæ˜¯æˆ‘æ­£åœ¨æ‹æ–ï¼Œå¹¶å†³å®šå°è¯•å…¶ä»–æ–¹æ³•ã€‚ <br><br><h4> ç…§äº®/æ’é˜Ÿ </h4><br> äº‹å®è¯æ˜ï¼Œè¯¥åº“ä¸LaravelåŸºç¡€ç»“æ„å’Œè®¸å¤šå…¶ä»–ä¾èµ–å…³ç³»ç´§å¯†ç›¸å…³ï¼Œå› æ­¤æˆ‘å¹¶æ²¡æœ‰èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼šå®‰è£…ï¼ŒæŸ¥çœ‹ï¼Œçœ‹åˆ°ä¾èµ–å…³ç³»å¹¶å°†å…¶åˆ é™¤ã€‚ <br><br><h4>  yiisoft / yii2-queue </h4><br> å¥½å§ï¼Œè¿™é‡Œæ˜¯ä»åç§°å¼€å§‹ç«‹å³å‡å®šçš„ï¼Œå†æ¬¡ä¸Yii2ç´§å¯†ç»‘å®šã€‚ æˆ‘ä¸å¾—ä¸ä½¿ç”¨è¿™ä¸ªåº“ï¼Œè€Œä¸”è¿˜ä¸é”™ï¼Œä½†æ˜¯æˆ‘ä¸è®¤ä¸ºå®ƒå®Œå…¨å–å†³äºYii2ã€‚ <br><br><h4> å…¶ä½™çš„ </h4><br> æˆ‘åœ¨githubä¸Šå‘ç°çš„æ‰€æœ‰å…¶ä»–å†…å®¹éƒ½æ˜¯ä¸å¯é çš„è¿‡æ—¶ä¸”åºŸå¼ƒçš„æŠ•å½±ï¼Œæ²¡æœ‰æ˜Ÿæ˜Ÿï¼Œå‰å­å’Œå¤§é‡çš„æäº¤ã€‚ <br><br><h2> è¿”å›symfony / Messengerï¼ŒæŠ€æœ¯ç»†èŠ‚ </h2><br> æˆ‘ä¸å¾—ä¸å¤„ç†è¿™ä¸ªåº“ï¼ŒèŠ±äº†æ›´å¤šæ—¶é—´åï¼Œæˆ‘æ‰èƒ½å¤Ÿåšåˆ°ã€‚ äº‹å®è¯æ˜ï¼Œä¸€åˆ‡éƒ½éå¸¸ç®€æ´æ˜äº†ã€‚ ä¸ºäº†å®ä¾‹åŒ–æ€»çº¿ï¼Œæˆ‘åšäº†ä¸€ä¸ªå°å·¥å‚ï¼Œå› ä¸º æˆ‘æœ‰å‡ ä¸ªè½®èƒï¼Œä¸åŒçš„æ“ä½œå‘˜ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/970/723/ab2/970723ab2c86a6b4adfb35f32208fa76.png"><br><br> åªéœ€å‡ ä¸ªæ­¥éª¤ï¼š <br><br><ul><li> åˆ›å»ºåº”è¯¥å¯ä»¥è°ƒç”¨çš„æ¶ˆæ¯å¤„ç†ç¨‹åº <br></li><li> å°†å®ƒä»¬åŒ…è£…åœ¨HandlerDescriptorä¸­ï¼ˆåº“ä¸­çš„ç±»ï¼‰ <br></li><li> æˆ‘ä»¬å°†è¿™äº›â€œæè¿°ç¬¦â€åŒ…è£…åœ¨HandlersLocatorå®ä¾‹ä¸­ã€‚ <br></li><li> å°†HandlersLocatoræ·»åŠ åˆ°MessageBuså®ä¾‹ <br></li><li> åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†RedisTransportç±»çš„å®ä¾‹ä¼ é€’ç»™SendersLocatorä¸€ç»„SenderInterfaceï¼Œå®ƒä»¬ä»¥æ˜æ˜¾çš„æ–¹å¼è¿›è¡Œé…ç½® <br></li><li> å°†SendersLocatoræ·»åŠ åˆ°MessageBuså®ä¾‹ <br></li></ul><br>  MessageBuså…·æœ‰æ–¹æ³•--dispatchï¼ˆï¼‰ï¼Œè¯¥æ–¹æ³•åœ¨HandlersLocatorä¸­æœç´¢é€‚å½“çš„å¤„ç†ç¨‹åºï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„â€œ SenderInterfaceâ€å°†æ¶ˆæ¯ä¼ é€’ç»™å®ƒä»¬ï¼Œä»¥é€šè¿‡æ€»çº¿å‘é€ï¼ˆRedisæµï¼‰ã€‚ <br><br> åœ¨å®¹å™¨é…ç½®ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºphp-diï¼‰ä¸­ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼é…ç½®æ•´ä¸ªæœåŠ¡å™¨é›†ï¼š <br><br><pre><code class="php hljs">CONTAINER_REDIS_TRANSPORT_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_TRANSPORT_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_STREAM_RECEIVER_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_RECEIVER_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_BUS =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([ \App\Messages\SecretJsonMessages::class =&gt; [CONTAINER_REDIS_TRANSPORT_SECRET], \App\Messages\DaemonLogMessage::class =&gt; [CONTAINER_REDIS_TRANSPORT_LOG], ], $c); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); }, CONTAINER_REDIS_STREAM_CONNECTION_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'secret'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); }, CONTAINER_REDIS_STREAM_CONNECTION_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'log'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); },</code> </pre> <br> å¯ä»¥çœ‹å‡ºï¼Œåœ¨SendersLocatorä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯åˆ†é…äº†ä¸€ä¸ªä¸åŒçš„â€œä¼ è¾“â€ï¼Œæ¯ä¸ªæ¶ˆæ¯ä¸å¯¹åº”çš„æµéƒ½æœ‰è‡ªå·±çš„è¿æ¥ã€‚ <br><br> æˆ‘åšäº†ä¸€ä¸ªå•ç‹¬çš„æ¼”ç¤ºé¡¹ç›®ï¼Œæ¼”ç¤ºäº†ä½¿ç”¨è¿™ç§æ€»çº¿ç›¸äº’é€šä¿¡çš„ä¸‰ä¸ªæ¶é­”çš„åº”ç”¨ç¨‹åºï¼š <a href="https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus">https</a> : <a href="https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus">//github.com/backend-university/products/tree/master/products/02-redis-streams-bus</a> ã€‚ <br><br> ä½†æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å®‰æ’æ¶ˆè´¹è€…ï¼š <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">DaemonLogMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlerDescriptor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">MessageBus</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">HandleMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">SendMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Transport</span></span>\<span class="hljs-title"><span class="hljs-title">Sender</span></span>\<span class="hljs-title"><span class="hljs-title">SendersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../vendor/autoload.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Psr\Container\ContainerInterface $container */</span></span> $container = <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'config/container.php'</span></span>); $handlers = [ DaemonLogMessage::class =&gt; [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerDescriptor( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DaemonLogMessage $m)</span></span></span><span class="hljs-function"> </span></span>{ \error_log(<span class="hljs-string"><span class="hljs-string">'DaemonLogHandler: message handled: / '</span></span> . $m-&gt;getMessage()); }, [<span class="hljs-string"><span class="hljs-string">'from_transport'</span></span> =&gt; CONTAINER_REDIS_TRANSPORT_LOG] ) ], ]; $middleware = []; $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandleMessageMiddleware(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlersLocator($handlers)); $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([<span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; [CONTAINER_REDIS_TRANSPORT_LOG]], $container); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); $bus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); $receivers = [ CONTAINER_REDIS_TRANSPORT_LOG =&gt; $container-&gt;get(CONTAINER_REDIS_STREAM_RECEIVER_LOG), ]; $w = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Symfony\Component\Messenger\Worker($receivers, $bus, $container-&gt;get(CONTAINER_EVENT_DISPATCHER)); $w-&gt;run();</code> </pre><br><h2> åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ­¤åŸºç¡€æ¶æ„ </h2><br> åœ¨åç«¯å®ç°äº†æ€»çº¿åï¼Œæˆ‘ä»æ—§çš„åŒæ­¥å›¢é˜Ÿä¸­é€‰æ‹©äº†å„ä¸ªæ­¥éª¤ï¼Œå¹¶åˆ›å»ºäº†å•ç‹¬çš„å¤„ç†ç¨‹åºï¼Œæ¯ä¸ªå¤„ç†ç¨‹åºéƒ½ä»äº‹è‡ªå·±çš„ä¸šåŠ¡ã€‚ <br><br> ç”¨äºå°†æ–°ç«™ç‚¹æ·»åŠ åˆ°æ•°æ®åº“çš„ç®¡é“å¦‚ä¸‹ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/ccf/202/f1accf2020c51b0ae5e5c39033d7d375.png"><br><br> ä¹‹åï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ·»åŠ æ–°åŠŸèƒ½å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œä¾‹å¦‚ï¼Œæå–å’Œè§£æRssã€‚ å› ä¸º ç”±äºæ­¤è¿‡ç¨‹è¿˜éœ€è¦æºå†…å®¹ï¼Œå› æ­¤rssé“¾æ¥çš„å¤„ç†ç¨‹åº-æå–ç¨‹åºä»¥åŠWebsiteIndexHistoryPersistorä¼šè®¢é˜…æ¶ˆæ¯â€œ Content / HtmlContentâ€ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œç„¶ååœ¨å…¶ç®¡é“ä¸Šè¿›ä¸€æ­¥ä¼ é€’æ‰€éœ€çš„æ¶ˆæ¯ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/641/d52/8cc641d52b4a394c5381967360187ab0.png"><br><br> æœ€åï¼Œç»“æœè¯æ˜äº†å‡ ä¸ªæ¶é­”ï¼Œæ¯ä¸ªæ¶é­”ä»…ä¿æŒä¸å¿…è¦èµ„æºçš„è¿æ¥ã€‚ ä¾‹å¦‚ï¼Œ <i>æœå¯»å™¨</i>å®ˆæŠ¤ç¨‹åºåŒ…å«æ‰€æœ‰éœ€è¦è®¿é—®Internetä»¥è·å¾—å†…å®¹çš„å¤„ç†ç¨‹åºï¼Œè€Œ<i>æŒä¹…æ€§</i>å®ˆæŠ¤ç¨‹åºåˆ™ä¿æŒä¸æ•°æ®åº“çš„è¿æ¥ã€‚ <br><br> ç°åœ¨ï¼Œä¸å†éœ€è¦ä»æ•°æ®åº“ä¸­è¿›è¡Œé€‰æ‹©ï¼Œè€Œæ˜¯å°†æŒä¹…æ€§æ’å…¥åæ‰€éœ€çš„idä»…ä»…é€šè¿‡æ€»çº¿ä¼ é€’ç»™æ‰€æœ‰æ„Ÿå…´è¶£çš„å¤„ç†ç¨‹åºã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483584/">https://habr.com/ru/post/zh-CN483584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483568/index.html">ä»å¤´å¼€å§‹åˆ›å»ºåŸå§‹è®¡ç®—æœº</a></li>
<li><a href="../zh-CN483570/index.html">ä½†æ˜¯ï¼Œå¦‚æœåœ°çƒæ˜¯å¹³å¦çš„å‘¢ï¼Ÿ</a></li>
<li><a href="../zh-CN483574/index.html">éœ‡åŠ¨ç”µå­è®¾å¤‡çš„å¯é æ€§åˆ†æ-æ¦‚è¿°</a></li>
<li><a href="../zh-CN483578/index.html">OpenStreetMapç¬¬493å·ä¸–ç•Œçš„æ–°é—»ï¼ˆ12.24.2019-12.30.2019ï¼‰</a></li>
<li><a href="../zh-CN483580/index.html">VIM-è¿™ä¸ä»…æ˜¯ç¼–è¾‘å™¨ï¼Œè€Œä¸”è¿˜ä¸æ‚¨çš„æ‰€æœ‰å·¥ä½œç¯å¢ƒé›†æˆåœ¨ä¸€èµ·</a></li>
<li><a href="../zh-CN483586/index.html">åœ¨pythonä¸­ä½¿ç”¨zmqï¼Œåˆ›å»ºç®€å•çš„é”®/å€¼å­˜å‚¨çš„åŸºç¡€çŸ¥è¯†</a></li>
<li><a href="../zh-CN483588/index.html">å¦‚ä½•å°è¯•ä½¿ç”¨ILVé˜»æ­¢ä»»ä½•ç«™ç‚¹</a></li>
<li><a href="../zh-CN483590/index.html">æœç´¢ä¸æ˜¯çš„FDCANé”™è¯¯</a></li>
<li><a href="../zh-CN483594/index.html">ç‰©ç†å­¦å®¶çš„æœªæ¥ç»æµå­¦</a></li>
<li><a href="../zh-CN483598/index.html">æ›´å…·éŸ³ä¹æ„Ÿçš„å¤æ´»èŠ‚å½©è›‹ï¼šæˆ‘ä»¬å°†ç»§ç»­è°ˆè®ºå€¾å¬å¬ä¼—çš„ç¤¼ç‰©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>