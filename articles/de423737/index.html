<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍✈️ 👨🏼‍🔬 🤾🏿 Strikte Optimierung der Arbeit mit Marktdaten für den Austausch von Kryptowährungen 🛀🏼 🧜🏿 🙉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Während des Refactorings unseres Krypto-Austauschs wurde beschlossen, das Konzept der Arbeit mit einem Marktdatum zu überarbeiten. Im klassischen Fall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Strikte Optimierung der Arbeit mit Marktdaten für den Austausch von Kryptowährungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423737/"><img src="https://habrastorage.org/webt/-s/kv/zh/-skvzht3f5wmlepdehvx4mhdbpe.jpeg"><br><br>  Während des Refactorings unseres Krypto-Austauschs wurde beschlossen, das Konzept der Arbeit mit einem Marktdatum zu überarbeiten.  Im klassischen Fall wird das Marktdatum auf zwei Arten verteilt: <br><br>  1. REST-Schnittstelle; <br>  2. WEBSocket-Broadcast-Abonnement. <br><br>  Die REST-Methode wird häufig verwendet, um historische Daten abzurufen, während das WEBSocket Live-Informationen online sendet.  In einigen Fällen wird WEBSocket überhaupt nicht verwendet, und Aktualisierungen werden durch regelmäßige Anforderungen über REST durchgeführt. <br><br>  Und anscheinend sind alle glücklich.  Bei näherer Betrachtung wird jedoch der enorme Aufwand eines solchen Konzepts deutlich.  Ihre Masse ruht auf REST.  Um die Funktionsweise der REST-Schnittstelle sicherzustellen, müssen wir ein Backend erstellen, das die Anforderungen hoch ausgelasteter Systeme erfüllt.  Natürlich können Sie hier verschiedene Lösungsoptionen von PHP bis zum jetzt modischen Golang auswählen. <br><br>  Es ist auch erforderlich, eine leicht zugängliche Infrastruktur zu schaffen, Kleinigkeiten wie CI / CD für Dienste zu implementieren und all dies mit den richtigen Spezialisten für Entwicklung, Wartung usw. usw. zu versorgen. <br><br><a name="habracut"></a>  Gleichzeitig ist es das historische Marktdatum, das den größten Teil des Speicherplatzes einnimmt.  Es wird normalerweise in der Datenbank gespeichert.  Dies ermöglicht es uns einerseits, das Problem des Clustering zu lösen, aber bei kritischen Größen wird es zu einer unerträglichen Belastung und stellt das DevOps-Team und die Entwickler vor nicht triviale Aufgaben. <br><br>  Im Allgemeinen ... wird die scheinbare Einfachheit und Konsistenz dieses Konzepts in ein hartes Leben zerschmettert. <br><br>  Separat müssen Sie die Besonderheit des Marktdatums beachten.  Es sammelt sich immer an (wächst).  Das heißt,  In der Sprache des Datenbankprogrammierers fügen wir immer ein und wählen dann aus.  Aber nicht teilbar.  Das heißt,  wunderbare Datenbankfunktionalität für Systematisierung, Optimierung usw.  Die gespeicherten Daten werden nicht beansprucht. <br><br>  Eine weitere wichtige Eigenschaft eines Marktdatums ist seine klar definierte Struktur.  Beispielsweise hat eine Kerze in einem Diagramm nur acht Parameter: <br><br>  1. Der Moment der Zeit; <br>  2. Ausstellung; <br>  3. Der Höchstpreis; <br>  4. den Mindestpreis; <br>  5. Eröffnungspreis; <br>  6. Schlusskurs; <br>  7. Lautstärke; <br>  8. Durchschnittspreis. <br><br>  Gleiches gilt für Deals. <br><br>  Aufgrund dieser Voraussetzungen und der Erfahrung bin ich schnell zu dem Schluss gekommen, dass es korrekter ist, das Marktdatum als strukturierten Strom zu betrachten. <br><br>  Ein Stream mit Kerzen kann beispielsweise als Array von Binärstrukturen betrachtet werden: <br><br> <code>moment: int32 <br> exposition: int32 <br> min: float64 <br> max: float64 <br> open: float64 <br> close: float64 <br> volume: float64 <br> average: float64</code> <br> <br>  Gesamt: 56 Bytes. <br><br>  Beispielsweise wird eine solche Kerze in JSON wie folgt beschrieben: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:<span class="hljs-number"><span class="hljs-number">1501004700</span></span>, <span class="hljs-attr"><span class="hljs-attr">"high"</span></span>:<span class="hljs-number"><span class="hljs-number">0.08053391</span></span>, <span class="hljs-attr"><span class="hljs-attr">"low"</span></span>:<span class="hljs-number"><span class="hljs-number">0.08020004</span></span>, <span class="hljs-attr"><span class="hljs-attr">"open"</span></span>:<span class="hljs-number"><span class="hljs-number">0.08030001</span></span>, <span class="hljs-attr"><span class="hljs-attr">"close"</span></span>:<span class="hljs-number"><span class="hljs-number">0.0803542</span></span>, <span class="hljs-attr"><span class="hljs-attr">"volume"</span></span>:<span class="hljs-number"><span class="hljs-number">48.62169347</span></span>, <span class="hljs-attr"><span class="hljs-attr">"weightedAverage"</span></span>:<span class="hljs-number"><span class="hljs-number">0.08038445</span></span> }</code> </pre> <br>  Gesamt: 167 Bytes. <br><br>  Der Gewinn in der Größe liegt auf der Hand.  Und das ist weniger Verkehr, höhere Liefergeschwindigkeit für den Kunden. <br><br>  Und hier fällt mir natürlich BSON ein.  Das Problem der Notwendigkeit eines Backends wird jedoch nicht gelöst, und das Problem wird im Allgemeinen nicht grundlegend gelöst.  Darüber hinaus wird es von Browsern nicht nativ unterstützt. <br><br>  Ich sah weg.  Das Netzwerk verfügt über viele Ressourcen, die mit Threads arbeiten.  Dies sind Audio- und Videoressourcen.  Sie zeigen alle notwendigen Zeichen: <br><br><ol><li>  mit großen Datenmengen arbeiten; </li><li>  perfekt mit hohen Belastungen umgehen; </li><li>  Sie sind in der Lage, Inhalte online bereitzustellen, ermöglichen jedoch gleichzeitig den Zugriff auf historische Daten. </li></ol><br>  Ich ging etwas tiefer in das Streaming-Video ein, wodurch ich alle oben genannten Probleme bis zum Marktdatum radikal lösen konnte.  Wie sich herausstellte, ist all die Magie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Content-Range-</a> Technologie verborgen, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">standardmäßig</a> unterstützt wird, beispielsweise Nginx.  Sie können auf jeden Bereich einer statischen Ressource (Datei auf dem Server) zugreifen, ohne ein Backend zu verwenden.  Im Allgemeinen geschieht dies wie folgt: Sie verweisen auf die URL, die die Belichtung angibt, die Sie in der Kopfzeile zurückgeben möchten.  Zum Beispiel: Bereich: 100-200.  Ich werde nicht auf die Feinheiten eingehen, Sie können alle Nuancen der Technologie in Fachartikeln finden.  Ich denke, die Essenz ist klar. <br><br>  Tatsächlich können Sie jetzt auf der Vorderseite einen Aufruf an den erforderlichen Teil der Datei organisieren, der beispielsweise Kerzen enthält.  Und da genau bekannt ist, wie viele Bytes eine Kerze benötigt (56 Bytes), können wir den benötigten Offset leicht bestimmen.  Es stimmt, wir müssen noch den Zeitpunkt kennen, ab dem der Zeitplan beginnt.  Und dies lässt sich sehr einfach lösen, indem der Datei ein Header hinzugefügt wird, dessen Größe ebenfalls eine Konstante ist. <br><br>  Das heißt,  Zunächst greift die Front von der Nullposition auf die Datei zu und empfängt sie <br>  Überschrift.  Gleichzeitig gibt nginx die Dateigröße zurück.  Dies bestimmt die Gesamtzahl der Kerzen in der Datei und die Startzeit. <br><br>  Wenn wir nun den Startzeitpunkt kennen und eine klare Vorstellung von der Anzahl der Kerzen haben, können wir jede für einen beliebigen Zeitraum von vorne abrufen, ohne ein Backend zu verwenden. <br><br>  Ah, ja ... ein weiterer Moment ... wir haben einen Parameter wie die Belichtung der Kerze.  Auch hier ist die Lösung einfach: Wir halten mehrere Dateien gleichzeitig für unterschiedliche Belichtungen.  Als zusätzlichen kleinen Bonus wird die Größe der Kerzenstruktur um weitere 4 Bytes reduziert. <br><br>  Im Allgemeinen war die Lösung bereits interessant genug für die Implementierung, aber es stellte sich heraus, dass ich mich nicht schäme zu sagen - sehr coole Gewinne.  Tatsache ist, dass Browser die von der Bereichsmethode empfangenen Daten zwischenspeichern können.  Das heißt,  Wenn dieser Abschnitt der Datei bei der nächsten Frontanforderung an den Server früher vom Browser empfangen wurde, wird er nicht auf Ihren Server übertragen, sondern aus dem Cache entfernt. <br><br>  Aber auch das ist noch nicht alles.  Mit CDN kann das Caching auch über seine Mittel konfiguriert werden.  Das heißt,  Zusammenfassend lässt sich sagen, dass Sie ein System erhalten können, das in der Lage ist, große Mengen des Marktdatums anzugeben und gleichzeitig die Belastung der Infrastruktur und der Server zu minimieren. <br><br>  Natürlich gab es keinen Zweifel mehr an der Treue der Idee?  Jetzt gibt es wirklich kleine Dinge ... Sie müssen die gleichen Dateien generieren. <br><br>  Wie oben erwähnt, betreibt die Börse normalerweise zwei Arten der Lieferung des Marktdatums: REST und WEBSocket.  Letzterer sendet online das aktuelle Marktdatum.  Dies ist normalerweise ein separater Dienst.  Wie die Praxis gezeigt hat, ist es nicht schwierig, diesen Dienst so abzuschließen, dass Daten an die erforderlichen Dateien angehängt werden, und wird buchstäblich mit ein paar Stunden Arbeit des Entwicklers gelöst.  Wir können sagen, dass er sich gleichzeitig mit dem Newsletter anmeldet. <br><br>  Das Problem der Übermittlung von Dateien an Knoten ist ein klassisches Problem bei der Synchronisierung des Dateisystems.  Das DevOps-Team löst es einfach und natürlich.  Zum Beispiel mit rsync. <br><br>  Jetzt können wir sicher sagen - BINGO! <br><br>  Vielleicht stellt sich die Frage: Warum funktionieren alle Krypto-Austausche anders?  Ich habe keine verlässliche Antwort auf diese Frage.  Aber es gibt Gedanken: <br><br><ol><li>  Der Austausch wurde von sympathischen Krypto-Entwicklern erstellt.  Vielleicht hatten sie keine Ahnung von der Arbeit des klassischen Austauschs, berücksichtigten ihre Erfahrungen nicht und verwendeten leicht verfügbare Lösungen, um schnelle Ergebnisse zu erzielen.  Und dies sind Vorlagenlösungen: das gleiche REST und das dazugehörige JSON; </li><li>  wie sie in den Leuten sagen - Funktioniert es?  Nicht anfassen.  - Weil  Technologische Trends wurden bereits von Schlüsselbörsen geschaffen, und neu entstehende Börsen haben sie ausgeliehen. </li></ol><br>  Wenn das Thema für die Community interessant ist, werde ich mit Artikeln über andere nicht standardmäßige Lösungen fortfahren, die in unserem Projekt implementiert wurden.  Wie dies in der Praxis funktioniert, können Sie auf der Austausch-Website sehen (siehe mein Profil).  Ich schlage besonders vor, auf die Arbeit des Diagramms zu achten, das alle Gewinne dieser Technologie klar zeigt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423737/">https://habr.com/ru/post/de423737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423727/index.html">KI, praktischer Kurs. Tiefes Lernen, um Musik zu generieren</a></li>
<li><a href="../de423729/index.html">5 Millionen Konten in ProtonMail-Krypto-Mail registriert</a></li>
<li><a href="../de423731/index.html">Character Computing mit Python. Teil 1. Die Grundlagen</a></li>
<li><a href="../de423733/index.html">Die Auswirkungen der DSGVO auf russische Betreiber personenbezogener Daten</a></li>
<li><a href="../de423735/index.html">Auf der Internet of Things-Konferenz findet die Battle of Startups statt. Wir laden Teilnehmer ein</a></li>
<li><a href="../de423739/index.html">Angular und SEO: Wie kann man sie zu Freunden machen?</a></li>
<li><a href="../de423741/index.html">Abstract CRUD vom Repository zum Controller: Was können Sie noch mit Spring + Generics tun?</a></li>
<li><a href="../de423743/index.html">Unter Kontrolle: VDS Server Disk Monitor Tool</a></li>
<li><a href="../de423745/index.html">Verwenden von Python zum Analysieren der erforderlichen Anforderungen an Entwickler</a></li>
<li><a href="../de423747/index.html">Neue Entwicklungstools mit LEGO Education - von Microsoft, MIT und mehr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>