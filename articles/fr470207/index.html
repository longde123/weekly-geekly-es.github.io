<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔬 🚣🏿 🏽 1C Developer Tales: Epicafe 📠 👨🏽‍🏫 👨🏿‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous aimons tous parler de nos succès et n'aimons pas vraiment parler d'échecs. Mais l'expérience des erreurs a souvent plus de valeur que le profit d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>1C Developer Tales: Epicafe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470207/">  Nous aimons tous parler de nos succès et n'aimons pas vraiment parler d'échecs.  Mais l'expérience des erreurs a souvent plus de valeur que le profit d'une entreprise réussie.  Par conséquent, je voudrais simplement parler de tels cas aujourd'hui.  Alors allons-y ... <br><a name="habracut"></a><br><h2>  Pot, ne cuisine pas! </h2><br>  Cette histoire s'est produite il y a quelques années, au tout début de ma carrière de développeur 1C. <br><br>  Un projet est apparu dans notre entreprise pour optimiser le fonctionnement d'une base très chargée d'un client très important et respecté.  Le client était avec un tel service de sécurité paranoïaque qu'il n'y avait pas et ne pouvait pas y avoir d'accès à distance aux serveurs de l'extérieur.  Pour se connecter aux bases directement à notre bureau, un réseau local séparé avec VPN matériel a été installé et des postes de travail avec un logiciel strictement négocié ont été installés.  Bien sûr, sans les droits d'un administrateur local. <br><br>  Comme tout autre projet de ce type, il a commencé par la collecte de données.  On a supposé que nous collecterions d'abord divers indicateurs dans un délai d'un mois, puis nous nous efforcerions d'optimiser la base d'informations elle-même.  Combien et combien de temps dans cet environnement bureaucratique a pris pour mettre en place le MCC, c'est un sujet pour une histoire distincte.  Mais maintenant, à un moment donné, c'est arrivé, le MCC a été configuré et démarré.  Après cela, l'expert qui a mené ce projet (Dima, salut!), Est monté dans sa voiture de luxe et est allé voyager dans notre vaste pays, puis plus dans les pays voisins.  Mais en fait, je savais encore peu et savais comment, mais j'étais déjà considéré comme un développeur assez responsable.  Par conséquent, avant de partir, Dmitry m'a confié une tâche très importante et sérieuse: 2 fois par jour, au moment de la pointe de charge, je devais me rendre sur cet ordinateur très secret et commencer les mesures dans le MCC, puis les éteindre après une heure.  Les instructions étaient extrêmement simples et claires: <br><br>  - Regardez, vous appuyez sur ce petit bouton vert "play", différentes cartes fonctionnent, attendez une heure, puis vous appuyez sur ce bouton - "stop".  C’est tout. <br><br>  Quoi de plus simple, non?  En vain ai-je étudié pendant 5 ans à la faculté de mathématiques? <br><br>  Toute la semaine, j'ai strictement observé ce rituel le matin et le soir.  Et tout allait bien jusqu'au dernier jour.  Après le déjeuner, vendredi, comme d'habitude, j'ai commencé à collecter des données, puis ... Eh bien, vous savez comment cela se passe ... Vendredi soir, nous devons terminer certaines choses urgentes, terminer certaines tâches, après le travail, emmener ma femme chez ma belle-mère, en cours de route passer dans un magasin, un deuxième, etc.  En général, j'ai quitté le travail, oubliant complètement ce malheureux MCC. <br><br>  Le samedi matin a commencé par un appel.  Nous avons obtenu TOUS les 1C-ème base chez le client.  Achtung et catastrophe!  Notre expert se situe quelque part entre Dzheyrakh et Pasanauri, en dehors de la zone d'accès au réseau.  L'administrateur principal du client est également dans une maison de campagne et inaccessible.  En essayant de savoir par téléphone, quelle est la raison?  D'une manière ou d'une autre, il s'avère que l'espace disque est épuisé, donc le service d'agent 1C s'est levé.  Ici, j'ai déjà commencé à soupçonner quelque chose ... <br><br>  Comme vous vous en souvenez, il n'y a pas d'uddalenka.  L'ordinateur n'est pas seulement isolé d'Internet, mais également en dehors de notre réseau local.  Rien à faire - aller travailler.  Lors de la préparation et de la conduite, les administrateurs se sont rendu compte que la place entière était prise par les journaux du MCC et ont fait ce qu'ils pensaient être le plus raisonnable - ils l'ont coupé via le gestionnaire de tâches.  Allez-y.  Vous ne pouvez pas simplement supprimer les journaux du disque - nous perdrons les données de mesure.  D'une manière ou d'une autre, ils ont trouvé suffisamment d'espace sur le partage réseau et y ont copié les fichiers.  Le travail semble avoir repris. <br><br>  Le dimanche matin a commencé par un appel.  Nous avons obtenu TOUS les 1C-ème base chez le client.  Achtung et la catastrophe en prennent deux!  Toute la panique est terminée - l'endroit est fini.  Mais comment ça?  MCC désactivé?  En toute hâte, je vais retravailler, jeter les bûches pour libérer de l'espace.  Et ils grandissent tous et grandissent, bon sang!  Sous la crainte des exécutions les plus perverses, les administrateurs m'ont interdit de démarrer quoi que ce soit ou de configurer quoi que ce soit.  Pour le reste du dimanche, j'étais assis devant l'ordinateur et je copiais les journaux sur le ballon pour que les bases ne se relèvent plus. <br><br>  Ce n'est que tard dans la nuit que Dima est entré en contact et a déclaré qu'il vous suffit de supprimer un petit fichier sur le serveur 1C.  Plus tard, quelques semaines plus tard, j'ai lu à son sujet dans un livre de "bureau" bien connu, mais ce jour-là, épuisé, le torturé est rentré chez lui pour dormir. <br><br>  Lundi matin, notre compte a été bloqué jusqu'à ce que Dmitry revienne de vacances, et il a été dit très clairement sur mon compte: "Pour que nous ne le revoyions pas!" <br><br>  C'est ainsi que mon premier projet d'optimisation s'est terminé pour moi. <br><br><h2>  Deux fois dans un entonnoir </h2><br>  Grande tenue.  18 bases d'informations de configuration identique, réparties dans tout le pays.  La mise à jour a lieu une fois par semaine et est le même rituel: le fichier de livraison doit être préparé à l'avance, téléchargé sur le cloud, assurez-vous qu'il a été téléchargé dans toutes les succursales (même en 2018, dans certaines régions, Internet est plus lent que le 1C: ERP typique), vérifiez que les sauvegardes ont été créées partout (nous ne semblons pas être responsables de cela, mais l'expérience amère nous a appris à être sûr), puis à chaque branche exécutez le script de mise à jour manuellement et assurez-vous qu'il fonctionne sans erreur.  Souvent, au dernier moment, on découvre qu'une tâche supplémentaire doit être incluse dans la livraison et il s'agit d'une correction mineure, car la prochaine mise à jour n'est que dans une semaine. <br><br>  C'était donc cette fois.  Un développeur expérimenté avec de nombreuses années d'expérience pressé a fait une erreur sur une ligne lors du transfert d'une tâche vers un circuit de combat.  L'erreur s'est avérée critique, elle a été découverte après la mise à jour de toutes les bases de données. <br><br>  Que faire?  Le développeur corrige rapidement le code.  Ne laisse personne tester: <br><br>  - Oui, il y a des ordures ... Je ne peux pas me tromper deux fois sur une même ligne? <br><br>  Une heure plus tard, 18 succursales ont été mises à jour pour la troisième fois. <br><br><h2>  Développeur qui pourrait </h2><br>  L'histoire racontée par un collègue sur Skype. <br>  [Collègue]: Il était une fois un «développeur qui pouvait!»  Il avait une tenue de développement.  Il voulait ouvrir un test, mais a raté, et a ouvert une productive ... <br>  [Collègue]: Mais cela pourrait-il arrêter le «développeur qui pourrait»?  Non! <br>  [I]: Et lors de la mise à jour, il n'a pas compris qu'il y avait des gens assis là, pour ainsi dire?  ))) <br>  [Collègue]: De plus, il voit que le konf est sur support ... Mais pensez-vous que cela pourrait arrêter le "Développeur qui pourrait"?  Non! <br>  [Collègue]: Il supprime la configuration du support (!) Et voit son mod contourner tous les référentiels ... <br>  [I]: Ce n'est pas ça!  Terminer l'histoire, mise à jour dynamique))) <br>  [Collègue]: Mises à jour ... Le système dit: "Il y a 18 sessions actives dans la base de données!".  Mais comment cela pourrait-il arrêter le «développeur qui pourrait»?  Non et non encore! <br>  [Collègue]: Il met à jour la base de données et passe la tâche au test ... <br>  [Collègue]: Le consultant ne trouve pas la tenue ... et alors seulement, après un long moment, il se rend compte qu'il a raté. <br>  [Collègue]: J'ai dû le réprimander ... <br>  [Collègue]: Je l'appelle ... et je ris au téléphone ... <br>  [Collègue]: Je ne comprends tout simplement pas ... COMMENT ??? <br><br><h2>  Effondrement des transports </h2><br>  L'histoire racontée par un collègue et enregistrée à partir de ses paroles. <br><br>  C'est arrivé dans une grande entreprise de logistique.  La plupart des processus métier sont concentrés dans une seule base d'informations.  Utilisateurs compétitifs pour 2012 - environ 3 000 personnes de toutes les régions du pays. <br><br>  Définissez une tâche simple.  Selon lui, il a créé son propre registre d'informations, dans lequel des données sont écrites lorsque certains documents sont publiés.  Bien qu'il n'y ait pas beaucoup de types de documents, le nombre de ces documents par jour est énorme.  En théorie, l'opération d'écriture que j'ai ajoutée au registre ne devrait pas charger lourdement le système.  Mais il y avait une nuance dans l'implémentation de la tâche - lors de l'enregistrement d'un ensemble, la propriété Overwrite était définie sur False.  Autrement dit, chaque document contenant des entrées ajoutées au registre.  Cela était nécessaire selon les conditions du problème, mais n'a pratiquement pas affecté les performances, car  selon les conditions de sélection, il y avait toujours 1 à 10 entrées. <br><br>  Les tests fonctionnels ont réussi.  Nous avons effectué plusieurs dizaines de documents, vérifié que les entrées dans le registre étaient correctes, n'avons rien remarqué de suspect et les avons envoyés au producteur. <br><br>  En ce malheureux vendredi matin, nous avons mis à jour la base de combat et les utilisateurs ont commencé à travailler.  3000 personnes ont rempli joyeusement des documents et le registre a commencé à être rempli de données.  Après avoir vérifié que tout se passait bien, quelques heures plus tard nous sommes rentrés à la maison avec une âme calme (nous travaillons dans différents fuseaux horaires avec les principaux utilisateurs de la base d'informations). <br><br>  Il convient de noter que les serveurs sur lesquels le SI fonctionnait sont presque l'un des plus puissants de Russie utilisés sous 1C.  Mais après quelques heures, «quelque chose s'est mal passé» (c). <br><br>  Les utilisateurs ont commencé à remarquer une baisse des performances du système.  Toutes les opérations ont commencé à ralentir.  Les réponses à toute action se sont allongées.  La charge sur le matériel a régulièrement augmenté.  Pendant que le service informatique comprenait ce qui se passait, le travail dans le système a presque cessé.  L'équipement ne pouvait pas faire face, les files d'attente sur les disques étaient plus longues que dans les bureaux de poste de la Russie.  Si l'équipement était plus faible, le problème serait détecté presque immédiatement.  Mais les serveurs les plus puissants ont résisté héroïquement à mes mains tordues pendant une demi-journée. <br><br>  «D'après les mots» de MSSQL, la demande la plus sévère est soudainement devenue une demande de lecture dans mon registre.  Bien que je n'aie fait aucune lecture.  Un problème a été rapidement découvert dans le code 1C.  J'ai oublié de définir des sélections sur un ensemble d'enregistrements.  Si la propriété "Overwrite" était définie sur "True", je trouverais immédiatement une erreur, car  chaque entrée effacerait tout le registre.  Mais dans notre cas, cela ne s'est pas produit.  Sur l'exemple d'une dizaine de documents, bien entendu, nous n'avons constaté aucune perte de performance.  Mais lorsque le registre a commencé à se remplir de dizaines et de centaines de milliers de lignes - le système a dû à chaque fois vérifier l'intégralité du registre pour rechercher les enregistrements correspondants. <br><br>  À ce moment-là, selon certains utilisateurs, un effondrement du transport s'était déjà produit, car  les voitures n'ont pas reçu de documents de 1C et n'ont pas pu quitter les points de déchargement. <br><br>  Donc, oubliant «juste» de mettre une sélection dans le jeu d'enregistrements, j'ai mis l'une des plus grandes bases de données 1C en Russie. <br><br><h2>  PS Voir aussi: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1C Developer Tales: admin</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470207/">https://habr.com/ru/post/fr470207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470195/index.html">F # 4: Let / Use / Do</a></li>
<li><a href="../fr470197/index.html">Puis-je Haz? Considérez le modèle Has</a></li>
<li><a href="../fr470199/index.html">Mémo à un développeur novice de jeux informatiques</a></li>
<li><a href="../fr470203/index.html">L'aiguille d'approbation du karma, comme miroir de l'évolution de l'Homo</a></li>
<li><a href="../fr470205/index.html">Localisation de jeux dans Unreal Engine 4</a></li>
<li><a href="../fr470215/index.html">CAGR comme une malédiction pour les spécialistes, ou des erreurs dans la prédiction des processus exponentiels</a></li>
<li><a href="../fr470217/index.html">Faux DS18B20 étanche: que faire?</a></li>
<li><a href="../fr470219/index.html">F # 5: Opérateurs</a></li>
<li><a href="../fr470221/index.html">Holivar. Histoire de Runet. Partie 3. Moteurs de recherche: Yandex vs Rambler. Comment ne pas investir</a></li>
<li><a href="../fr470223/index.html">Consignes de conception de jeux mobiles UX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>