<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗣️ 😠 🕰️ كيفية البدء في مشروع الحيوانات الأليفة وعدم الحصول على فوائد 🎷 👇🏼 👋🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL ؛ د 

 توضح المقالة استخدام مشروع الحيوانات الأليفة كوسيلة للحفاظ على المهارات وتحسينها. أنشأ المؤلف مكتبة PHP لتثبيت FIAS من ملفات XML. 
 هدف 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>كيفية البدء في مشروع الحيوانات الأليفة وعدم الحصول على فوائد</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479122/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cz/x-/ln/czx-lnrbjewed61t5fm8k_pjvei.png" alt="كيفية البدء في مشروع الحيوانات الأليفة وعدم الحصول على فوائد"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">TL ؛ د</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  توضح المقالة استخدام مشروع الحيوانات الأليفة كوسيلة للحفاظ على المهارات وتحسينها.  أنشأ المؤلف <a href="https://github.com/liquetsoft/fias-symfony" rel="nofollow">مكتبة PHP</a> لتثبيت <a href="https://fias.nalog.ru/" rel="nofollow">FIAS</a> من ملفات XML. </p></div></div><br><h2 id="cel" style=";text-align:right;direction:rtl">  هدف </h2><br><p style=";text-align:right;direction:rtl">  نادراً ما أقوم بتغيير الوظائف ، وبناءً على الرغبة الطبيعية لكل مؤسسة في العمليات الثابتة ، تتحول أي مهمة إلى روتين.  من ناحية ، من المفيد للشركة الحفاظ على مثل هذه الحالة ، من ناحية أخرى ، هذا يعني بالنسبة لي إما خسارة كاملة أو تقادم المهارات.  PHP يتطور بسرعة ، وبالتالي ، فإن الفجوة المحتملة تنمو بسرعة أيضًا.  أخيرًا ، نعلم جميعًا أنه من الصعب اليوم على المبرمج العثور على وظيفة جيدة دون معرفة Elasticsearch و RabbitMQ و Kafka وغيرها من التقنيات التي لا تظهر غالبًا في عملي اليومي. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  بعد بدء الموقع النموذجي التالي ، قررت أن الوقت قد حان لتغيير شيء ما.  لم أكن أرغب في تغيير عملي ، لكنني تذكرت كيف أوصى المتحدث في أحد المؤتمرات باستخدام مشروعه الاختياري الخاص به ، وهو ما يسمى بمشروع الحيوانات الأليفة ، للتدريب.  تبدو الطريقة مناسبة وقررت تجربتها. </p><br><h2 id="vybor-zadachi" style=";text-align:right;direction:rtl">  اختيار المهمة </h2><br><p style=";text-align:right;direction:rtl">  تبين أن اختيار المهمة هو أصعب جزء من المهمة.  لم يتبادر إلى الذهن أي شيء مميز: بعض الخدمات ، مثل محلل الوظائف الذي يمكن تنفيذه بسهولة على حزمة مألوفة.  لقد تخلت عن فكرة المشروع لعدة أشهر ، حتى رأيت عن طريق الخطأ الأخبار المتعلقة باختراق وزارة المالية.  اقترح استخدام أحد مصادر مصادر البيانات المفتوحة لإنشاء خدمة.  من بين أمور أخرى ، تمت الإشارة إلى نظام عناوين المعلومات الفيدرالي (FIAS) أيضًا.  لسوء الحظ ، فإن hackathon قد انتهت بالفعل بحلول ذلك الوقت. </p><br><p style=";text-align:right;direction:rtl">  لقد تعلمت عن FIAS لأول مرة ، لكن المهمة بدت مثيرة للاهتمام.  الحكم على نفسك: حوالي 30 جيجابايت من ملفات XML ، وحوالي 60 مليون سطر في قاعدة البيانات ، وعلاوة على ذلك ، يمكن أن تثبت المكتبة لاحقًا أنها مفيدة في العمل.  كانت هناك بعض الحلول الجاهزة على جيثب ، لكن هذا لم يمنعني.  على العكس من ذلك ، بناءً على تحليلهم ، قمت بتقديم متطلبات إضافية من شأنها تسليط الضوء على عملي. </p><br><p style=";text-align:right;direction:rtl">  بالنظر إلى المستقبل ، لاحظت أنني واجهت صعوبات أقل بكثير مما توقعت. </p><br><h2 id="formulirovka-zadachi" style=";text-align:right;direction:rtl">  بيان المهمة </h2><br><p style=";text-align:right;direction:rtl">  90 ٪ من النجاح هو البيان الصحيح للمشكلة.  بعد عدة سنوات من عمل القالب ، كان من الصعب للغاية أن تجعل نفسك يصوغ المشكلة بوضوح.  أردت فقط أن أبدأ العمل ، لكن بالفعل في هذه العملية كان من الممكن أن يتخلص كل شيء من تلقاء نفسه.  بعد ساعة من الصراع مع التسويف ، كتبت أخيرًا: إنشاء مكتبة في PHP لاستيراد بيانات FIAS. </p><br><p style=";text-align:right;direction:rtl">  في وقت لاحق ، بعد الذوق ، أضفت بعض المتطلبات الإضافية: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  في PHP دون استخدام أدوات مساعدة من طرف ثالث ، رمز حصري في PHP وملحقات من PECL ، </li><li style=";text-align:right;direction:rtl">  استيراد جميع البيانات من مجموعة FIAS ، </li><li style=";text-align:right;direction:rtl">  دورة التثبيت والتحديث الكاملة: البحث عن الإصدار الضروري ، استلام الأرشيف ، التفريغ ، الكتابة إلى قاعدة البيانات ، </li><li style=";text-align:right;direction:rtl">  أقصى قدر من المرونة: القدرة على تغيير موقع التخزين ، وتعديل البيانات قبل التسجيل ، وتصفية ما يلزم ، وما إلى ذلك ، </li><li style=";text-align:right;direction:rtl">  يجب دمج المكتبة بسهولة في المشروعات القائمة. </li></ul><br><h2 id="fias" style=";text-align:right;direction:rtl">  FIAS </h2><br><p style=";text-align:right;direction:rtl">  لدى FIAS <a href="https://fias.nalog.ru/" rel="nofollow">موقع إلكتروني رسمي</a> يعطينا تعريف وغرض إنشاء نظام </p><br><blockquote style=";text-align:right;direction:rtl">  نظام عناوين المعلومات الفيدرالي (FIAS) هو نظام معلومات الحالة الفيدرالي الذي يوفر تكوين وصيانة واستخدام سجل عناوين الولاية. <br><br>  الغرض من إنشاء FIAS هو تكوين مورد اتحادي واحد يحتوي على معلومات عنوان موثوقة وموحدة ومتاحة للجمهور.  بفضل تطبيق FIAS ، يمكن الحصول على هذه المعلومات مجانًا عبر الإنترنت على بوابة FIAS المسجلة رسميًا. </blockquote><p style=";text-align:right;direction:rtl">  المواد ذات الوصف كافية تمامًا على <a href="https://fias.nalog.ru/Updates.aspx" rel="nofollow">موقع FIAS</a> وعلى <a href="https://habr.com/ru/search/%3Fq%3D%25D0%25A4%25D0%2598%25D0%2590%25D0%25A1">Habré</a> ، لذلك لن أركز على ذلك. </p><br><p style=";text-align:right;direction:rtl">  باختصار.  FIAS يأتي في شكلين: FIAS و KLADR.  تم إهمال الثاني ولم يعد قيد الاستخدام.  يتم تخزين المعلومات إما في DBF أو في XML.  كل تغيير في تكوين FIAS يتميز بنسخة جديدة.  يمكنك طلب إما حزمة تحتوي على بيانات كاملة حالية في الوقت الحالي ، أو تحتوي فقط على تغييرات بين الإصدارين.  توفر الروابط خدمة SOAP.  الحزمة عبارة عن أرشيف RAR يحتوي على ملفات ذات أسماء مشكلة بشكل خاص.  وهي تتكون من بادئة واسم مجموعة بيانات وتاريخ الإنشاء.  يوجد نوعان من البادئات: AS_ للملفات التي يجب إضافة بيانات منها إلى قاعدة البيانات ، و AS <em>DEL</em> للملفات التي يجب حذف بياناتها من قاعدة البيانات. </p><br><p style=";text-align:right;direction:rtl">  FIAS يحتوي على البيانات التالية: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  سجل العناصر المكونة للعناوين (هذا هو الرسم البياني للعناوين: المناطق والمدن والشوارع) ، </li><li style=";text-align:right;direction:rtl">  عناصر العنوان التي تحدد الكائنات القابلة للعنونة (رقم المنزل وبيانات المنزل) ، </li><li style=";text-align:right;direction:rtl">  معلومات حول قطع الأراضي </li><li style=";text-align:right;direction:rtl">  معلومات حول المبنى (شقق ، مكاتب ، غرف ، إلخ) ، </li><li style=";text-align:right;direction:rtl">  معلومات حول المستند المعياري ، والذي هو الأساس لتعيين الاسم لعنصر العنوان. </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">وكذلك العديد من القواميس</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  قائمة بالقيم المحتملة لفترات المنازل (العادية ، حتى ، الفردية) ، </li><li style=";text-align:right;direction:rtl">  قائمة بأوضاع ملاءمة إدخال عنصر العنوان بواسطة مصنف KLADR4.0 ، </li><li style=";text-align:right;direction:rtl">  قائمة الحالات ذات الصلة لإدخال عنصر العنوان وفقا ل FIAS ، </li><li style=";text-align:right;direction:rtl">  قائمة بالأسماء الكاملة والمختصرة لأنواع عناصر العنوان ومستويات التصنيف الخاصة بها ، </li><li style=";text-align:right;direction:rtl">  قائمة أنواع المباني ، </li><li style=";text-align:right;direction:rtl">  قائمة الأنواع المحتملة للملكية </li><li style=";text-align:right;direction:rtl">  قائمة رموز العمليات مع الكائنات عنونة ، </li><li style=";text-align:right;direction:rtl">  قائمة بالظروف المحتملة للعقار </li><li style=";text-align:right;direction:rtl">  قائمة أنواع المباني أو المكاتب ، </li><li style=";text-align:right;direction:rtl">  قائمة أنواع الغرف ، </li><li style=";text-align:right;direction:rtl">  قائمة بالحالات المحتملة (مراكز) لعناوين عناوين الوحدات الإدارية ، </li><li style=";text-align:right;direction:rtl">  أنواع الوثائق التنظيمية. </li></ul></div></div><br><p style=";text-align:right;direction:rtl">  يوصف هيكل البيانات في المستند ، والذي يمكن العثور عليه <a href="https://fias.nalog.ru/Updates.aspx" rel="nofollow">في قسم التحديثات</a> . </p><br><p style=";text-align:right;direction:rtl">  في النهاية ، لدينا خوارزمية تثبيت FIAS بسيطة وخطية إلى حد ما: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الحصول على ارتباط من الأرشيف ورقم الإصدار الحالي من خدمة SOAP ، </li><li style=";text-align:right;direction:rtl">  تحميل الأرشيف ، </li><li style=";text-align:right;direction:rtl">  فك، </li><li style=";text-align:right;direction:rtl">  الكتابة إلى قاعدة البيانات جميع البيانات من الملفات مع البادئة AS_ ، </li><li style=";text-align:right;direction:rtl">  حذف جميع البيانات من الملفات من قاعدة البيانات AS <em>DEL</em> من قاعدة البيانات (نعم ، هذا صحيح ، أثناء التثبيت ، عليك أيضًا حذف بعض البيانات) ، </li><li style=";text-align:right;direction:rtl">  اكتب رقم الإصدار المثبت. </li></ul><br><p style=";text-align:right;direction:rtl">  ولا تقل خوارزمية التحديث البسيطة: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الحصول على قائمة من خدمة SOAP مع أرقام الإصدارات وارتباطات إلى الملفات ذات التغييرات ، </li><li style=";text-align:right;direction:rtl">  إذا كان الإصدار الحالي في قاعدة البيانات المحلية هو الأحدث ، ثم توقف عن التنفيذ ، </li><li style=";text-align:right;direction:rtl">  الحصول على رابط إلى الأرشيف مع التغييرات على الإصدار التالي ، </li><li style=";text-align:right;direction:rtl">  تحميل الأرشيف ، </li><li style=";text-align:right;direction:rtl">  فك، </li><li style=";text-align:right;direction:rtl">  الكتابة إلى قاعدة البيانات جميع البيانات من الملفات مع البادئة AS_ ، </li><li style=";text-align:right;direction:rtl">  إزالة كافة البيانات من قاعدة البيانات من الملفات باستخدام البادئة AS <em>DEL</em> ، </li><li style=";text-align:right;direction:rtl">  اكتب رقم الإصدار المحدّث ، </li><li style=";text-align:right;direction:rtl">  العودة إلى الخطوة الأولى. </li></ul><br><p style=";text-align:right;direction:rtl">  FIAS يترك انطباعات متضاربة.  من ناحية: أتمتة كاملة للعملية برمتها ، تنسيقات مفتوحة ، وثائق جيدة.  من ناحية أخرى: قرار غريب باستخدام RAR الملكية للبيانات المفتوحة ؛  الاختلافات بين الوثائق والواقع (تتعلق أساسًا بالسمات الإلزامية) ، والتي تسبب العديد من المشكلات الصغيرة ولكن غير السارة ؛  في بعض الأحيان تأتي الأرشيفات التي لا يمكن تفريغها في نظام Linux ؛  بعض دلتا بين الإصدارات تشغل 4-5 غيغابايت. </p><br><h2 id="arhitektura" style=";text-align:right;direction:rtl">  هندسة معمارية </h2><br><p style=";text-align:right;direction:rtl">  يجب أن تستند كل مكتبة إلى فكرة أساسية ، وهي مجموعة أساسية ينمو حولها بقية الوظائف.  بدا لي نمط "سلسلة الواجبات" الخيار الأفضل لدور هذه الفكرة.  أولاً ، إنها مثالية: العديد من العمليات المتتالية التي كان يمكن أن يقوم بها الشخص إذا أراد تثبيت FIAS يدويًا واضحة للمطور وتتناسب بشكل جيد مع الفصول الصغيرة المكتوبة بأسلوب SOLID.  ثانياً ، يتم توسيع مثل هذه السلسلة بسهولة مع عمليات جديدة في أي مرحلة تقريبًا ، مما يوفر مرونة جيدة.  ثالثا ، لقد أردت منذ فترة طويلة أن أكتب تنفيذي الخاص. </p><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى العمليات ، قمت بإنشاء العديد من الخدمات التي يمكن نقلها باستخدام DI.  إنها تتيح لك إعادة استخدام الرمز ، واستبدال التطبيق بسهولة لمهام النظام منخفضة المستوى (تنزيل ملف ، تفريغ أرشيف ، الكتابة إلى قاعدة بيانات وغيرها) وتوفير تغطية اختبار جيدة بفضل mocks. </p><br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، تحتوي المكتبة على أربعة أنواع رئيسية من الكائنات ، يتم تحديد مجال المسؤولية لكل منها بوضوح: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  خدمات - توفر أدوات لأداء مهام النظام منخفضة المستوى ، </li><li style=";text-align:right;direction:rtl">  كائن الحالة - يخزن المعلومات للنقل بين العمليات ، </li><li style=";text-align:right;direction:rtl">  العمليات - باستخدام الخدمات والدولة التي تنفذ فيها الجزء الذري من منطق الأعمال ، </li><li style=";text-align:right;direction:rtl">  سلسلة العمليات - ينفذ العمليات وينقل الحالة بينهما. </li></ul><br><p style=";text-align:right;direction:rtl">  باستخدام ربط العمليات والخدمات التي تقدمها المكتبة ، يمكنك بسهولة الحصول على أي سلسلة جديدة أو استكمال السلسلة الحالية باستخدام ملفات التكوين فقط. </p><br><h2 id="freymvorki" style=";text-align:right;direction:rtl">  الأطر </h2><br><p style=";text-align:right;direction:rtl">  مع فترات راحة طويلة وإعادة البناء المستمر ، عملت في المكتبة لمدة عام ونصف. </p><br><p style=";text-align:right;direction:rtl">  أول نسخة مستقرة نسبيا كانت جاهزة في شهرين من العمل في المساء.  في الواقع ، يمكن أن توجد بشكل منفصل عن الإطار وتحتوي على كل ما هو ضروري: برنامج نصي لتشغيله في وحدة التحكم ، وحاوية DI ، ووظيفة إضافية على PDO ، ومسجلاتها الخاصة ، وترحيل بنية قاعدة البيانات - وهو الأمر الذي كنت فخورة به. </p><br><p style=";text-align:right;direction:rtl">  بالطبع ، رفضها زملاؤها بلا رحمة. </p><br><p style=";text-align:right;direction:rtl">  وكانت الحجة الرئيسية ضد هذا عدم وجود دعم للأطر الشعبية.  لا أحد يريد أن يكتب غلاف منفصل للمكتبة.  ولهذا السبب ، ارتكبت الخطأ الأكثر تكلفة في الوقت المناسب: لقد بدأت في دعم كل من الإصدار المستقل والأغلفة الفردية لكل إطار.  تختلف ملفات FIAS الحقيقية عما هو مكتوب في الوثائق.  في كل مرة كان لا بد من إزالة أو إضافة ، على سبيل المثال ، لا شيء خالي في وصف العمود ، كان لا بد لي من إجراء تغييرات على ثلاثة مستودعات.  بسبب شدة العملية ، توقف العمل لمدة ستة أشهر أخرى. </p><br><p style=";text-align:right;direction:rtl">  الشعور بعدم الكمال يعذبني كل هذا الوقت وبعد معركة دامية مع الكسل أجبرتني على العودة إلى تصميم نسخة جديدة.  بادئ ذي بدء ، قررت أن لا أحد يحتاج إلى مكتبة قائمة بذاتها ، مما يعني أنه يجب عليك التخلص من جميع الخدمات التي توفر أطر عمل من الحزمة ، واستبدالها بواجهات.  لذا فقد ذهبنا إلى أسفل السكين: برنامج نصي لتشغيله في وحدة التحكم ، وحاوية DI ، ووظيفة إضافية فوق PDO ، وعمليات ترحيل هيكل قاعدة البيانات والمسجل الخاصة بنا.  بعد ذلك ، قررت إنشاء حزم منفصلة لكل إطار ، والتي ستربط جميع الأجزاء من البرنامج النصي الرئيسي إلى العمل وستوفر تطبيقات محددة للخدمات. </p><br><p style=";text-align:right;direction:rtl">  النقطة الأساسية هي النموذج.  تحديث مجموعات غير متجانسة باستمرار من الكائنات في عدة مستودعات لا تريد.  في الوقت نفسه ، في العمل الرئيسي ، حصلت على مشروع على Symfony.  بعد التعرف السريع عليها ، قررت أن الميزة الأكثر فائدة في SF هي إنشاء الشفرة وستحل كل مشاكلي.  لقد قمت بإنشاء <a href="" rel="nofollow">ملف yaml</a> في الحزمة الرئيسية ، والذي يحتوي على وصف تعريفي لبيانات FIAS.  ثم أضفت مولدات الشفرة التي تنشئ فئات محددة للنماذج بناءً على هذا الوصف: كيانات العقيدة لكائنات Symfony و Eloquent لـ Laravel.  خلال تطوير المولدات الكهربائية ، أدركت أن قوالب الأغصان لم تكن مناسبة لذلك ، واستقرت على حل متخصص - <a href="https://github.com/nette/php-generator" rel="nofollow">Nette PHP Generator</a> . </p><br><p style=";text-align:right;direction:rtl">  كدليل على المفهوم ، قمت بإنشاء حزم <a href="https://github.com/liquetsoft/fias-laravel" rel="nofollow">لارافيل</a> و <a href="https://github.com/liquetsoft/fias-symfony" rel="nofollow">Symfony</a> .  منذ أن عملت لفترة أطول مع الثانية ، سوف أصف كل شيء لاحق في سياقها. </p><br><h2 id="infrastruktura" style=";text-align:right;direction:rtl">  البنية التحتية </h2><br><p style=";text-align:right;direction:rtl">  تمت كتابة معظم مشاريعي القتالية على تقنيات عفا عليها الزمن ، لذلك لا يمكنني استخدام أجهزة تحليل الشفرة الحديثة على أي منها.  للتخلص من الاضطهاد القديم ، قمت بتثبيت وتكوين جميع أدوات التحكم في جودة الشفرة التي يمكنني: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://github.com/vimeo/psalm" rel="nofollow">مزمور</a> لفحص النوع ، </li><li style=";text-align:right;direction:rtl">  <a href="https://scrutinizer-ci.com/" rel="nofollow">Scututinizer</a> لتقييم الجودة العام (يساعد <a href="https://scrutinizer-ci.com/" rel="nofollow">كثيرا في</a> التعقيد السيكلوماتي) </li><li style=";text-align:right;direction:rtl">  <a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer" rel="nofollow">PHP الترميز معايير المثبت</a> لفحص نمط الرمز ، </li><li style=";text-align:right;direction:rtl">  <a href="https://github.com/sebastianbergmann/phpcpd" rel="nofollow">PHP نسخ / لصق الكاشف</a> لإيجاد التكرارات ، </li><li style=";text-align:right;direction:rtl">  <a href="https://github.com/sebastianbergmann/phpunit" rel="nofollow">PHPUnit</a> لتشغيل اختبارات الوحدة. </li></ul><br><p style=";text-align:right;direction:rtl">  التحقق من صحة المتكاملة في جيثب باستخدام <a href="https://travis-ci.org/" rel="nofollow">ترافيس</a> .  كملمس أخير ، أضاف ملف Docker لإنشاء بيئة مطور محلية كاملة مع ملف تكوين يحتوي على الأوامر الرئيسية للحاوية (بدء الاختبارات والاختبارات وإنشاء نماذج وغيرها). </p><br><h2 id="itogi-obucheniya" style=";text-align:right;direction:rtl">  نتائج التعلم </h2><br><h3 id="php-7" style=";text-align:right;direction:rtl">  PHP 7 </h3><br><p style=";text-align:right;direction:rtl">  قبل البدء في العمل في المكتبة ، لم أستخدم أبدًا <a href="https://www.php.net/manual/ru/migration70.new-features.php" rel="nofollow">الميزات الجديدة لـ PHP 7</a> .  إنها جميلة: من الأنواع الصارمة إلى زيادة كبيرة في الإنتاجية.  شكر خاص للمطورين لمشغل الائتلاف الفارغ.  أنا لم أر مثل هذا الانخفاض الخطير في قاعدة الكود بعد إدخال مشغل واحد. </p><br><h3 id="rar" style=";text-align:right;direction:rtl">  RAR </h3><br><p style=";text-align:right;direction:rtl">  من المستغرب ، في PECL كان هناك <a href="https://www.php.net/manual/ru/book.rar.php" rel="nofollow">حزمة للعمل مع RAR</a> .  عادةً ، لا يتم الوثوق بمثل هذه الامتدادات وأحاول تجنبها.  لقد ثبت أنها مستقرة بشكل مثير للريبة: لقد تم تثبيتها في 7.2 دون مشاكل ، وتمكنت من فك المحفوظات الضخمة بسرعة نسبية مع انخفاض استهلاك ذاكرة الوصول العشوائي (يتم تفريغ 6 جيجابايت في 10-20 دقيقة حسب موارد النظام المتاحة).  ما زلت أخشى أن هذا هو بعض مظاهر قانون مورفي. </p><br><h3 id="xmlreader" style=";text-align:right;direction:rtl">  XmlReader </h3><br><p style=";text-align:right;direction:rtl">  قراءة ملفات XML العملاقة ليست مهمة تافهة.  ومرة أخرى ، جاء امتداد PECL للإنقاذ - <a href="https://www.php.net/manual/ru/book.xmlreader.php" rel="nofollow">XmlReader</a> .  لم أكن أدرك على الفور كل قوتها ، لكنني في عدة طرق قمت بتكييفها بالاقتران مع برنامج <a href="https://symfony.com/doc/current/components/serializer.html" rel="nofollow">التسلسل Symfony</a> للحصول على البيانات بسرعة وبشكل اقتصادي من ملفات FIAS.  على جانب المكتبة ، يقوم كائن القارئ بتطبيق واجهة التكرار ، والتي تقوم بإرجاع سلاسل XML بالتسلسل المقابلة لسجل واحد في الملف.  باستخدام متسلسل Symfony ، يتم تحويل هذه السلاسل إلى كائنات.  يمكن قراءة ملف 20 جيجابايت في 3 إلى 4 دقائق أثناء استخدام أكثر من 50 ميغابايت من ذاكرة الوصول العشوائي. </p><br><h3 id="zapis-v-bazu-dannyh" style=";text-align:right;direction:rtl">  الكتابة إلى قاعدة البيانات </h3><br><p style=";text-align:right;direction:rtl">  بالطبع ، بدأت مع المصفوفات الترابطية مع البيانات وأوصاف الجدول الضخمة.  سرعان ما تحول الرمز إلى تجزئة من التكوينات وفئات المحول. </p><br><p style=";text-align:right;direction:rtl">  أظهر سحر كيانات العقيدة كيف يمكن أن تكون الأشياء ذاتية الوصف.  قررت استخدام نفس الطريقة ، لكن في نفس الوقت تخلص من تطبيقي الخاص لكتابة البيانات إلى قاعدة البيانات باستخدام PDO.  بدلاً من ذلك ، قمت بإنشاء واجهة تخزين تصف طرق معالجة الكائنات.  استنادًا إلى فئة الكيان ، يقرر تطبيق تخزين معين بالضبط كيفية ومكان كتابة البيانات.  جعل هذا النهج من السهل توصيل مجموعة واسعة من المخازن: من MySql إلى ملفات CSV. </p><br><h3 id="optimizaciya-vstavki-dannyh" style=";text-align:right;direction:rtl">  تحسين ادراج البيانات </h3><br><p style=";text-align:right;direction:rtl">  قاطعت أول عملية استيراد بعد تجاوزها خلال 48 ساعة.  أصبح من الواضح أنك تحتاج إلى تحسين عملية إدراج البيانات. </p><br><p style=";text-align:right;direction:rtl">  أولاً ، قمت بالتبديل إلى <a href="https://www.postgresql.org/docs/12/datatype-uuid.html" rel="nofollow">أعمدة من نوع ugid</a> للمفاتيح الأساسية <a href="https://www.postgresql.org/docs/12/datatype-uuid.html" rel="nofollow">المضمنة في PostgreSql</a> .  الكتابة إلى عمود uuid مع فهرس أسرع بكثير من الكتابة إلى سلسلة. </p><br><p style=";text-align:right;direction:rtl">  بعد ذلك ، تخلت عن جميع الفهارس غير الهامة والمفاتيح الخارجية ، لأن الاهتمام بسلامة البيانات يقع بالكامل في فريق FIAS. </p><br><p style=";text-align:right;direction:rtl"> بعد ذلك ، قمت بإعادة واجهة التخزين حتى يتمكن البرنامج النصي الخارجي من إبلاغه بشكل صريح عن اكتمال عملية الاستيراد.  سمح ذلك باستخدام الإدراج المجمع ، مما أدى إلى تسريع التسجيل في بعض الأحيان.  <a href="https://www.postgresql.org/docs/current/populate.html" rel="nofollow">أبحث عن المعلومات ،</a> صادفت أيضًا الأمر <a href="https://www.postgresql.org/docs/current/sql-copy.html" rel="nofollow"><code>copy</code></a> مع <a href="https://www.postgresql.org/docs/current/functions-xml.html" rel="nofollow"><code>query_to_xml</code></a> .  كان له عيبان كبيران: أولاً ، يجب أن يكون لدى مستخدم PostgreSql أذونات قراءة للملف ، وهو ما لا يمكنني ضمانه ، وثانيًا ، القدرة على تعديل البيانات داخل البرنامج النصي قبل فقد الكتابة. </p><br><p style=";text-align:right;direction:rtl">  على الرغم من هذه التغييرات ، تجاوز وقت الاستيراد 30 ساعة.  هناك حاجة لتغيير جذري في النهج. </p><br><h3 id="parallelnye-processy" style=";text-align:right;direction:rtl">  عمليات موازية </h3><br><p style=";text-align:right;direction:rtl">  الإنترنت مليء بمقالات حول عدم التزامن في PHP.  سقط خياري على <a href="https://amphp.org/" rel="nofollow">أمبير</a> .  لم ينجح الأمر بشكل متزامن.  أولاً ، تحولت الشفرة بسرعة إلى صفحة مرعبة من عمليات الاسترجاعات والمكالمات غير المرئية (ربما يكون هذا خطأي ، وليس النهج غير المتزامن).  ثانياً ، كان علي أن أتخلى عن استخدام ORMs القياسية لأن هناك حاجة إلى حظر المكالمات إلى قاعدة البيانات من خلال <a href="https://github.com/amphp/mysql" rel="nofollow">إطار خاص</a> .  ثالثًا ، على الرغم من وجود شروط يمكن لـ PostgreSql إدراج صفوف فيها بشكل متوازٍ ، إلا أنه <a href="" rel="nofollow">من</a> <a href="https://wiki.postgresql.org/wiki/Parallel_Query" rel="nofollow">الصعب</a> <a href="" rel="nofollow">للغاية</a> تحقيقها.  نتيجةً لذلك ، بعد 5 ساعات من العملية ، شاهدت كيف تم "مزامنة" جميع طلباتي غير المتزامنة بالقوة من جانب قاعدة البيانات. </p><br><p style=";text-align:right;direction:rtl">  لكن الاستيراد ينقسم بشكل جيد إلى عمليات متوازية: العديد من المهام المستقلة تمامًا التي لا تملك موارد مشتركة يمكنها التنافس عليها ، والبيانات التي يمكنهم تبادلها.  علاوة على ذلك ، في إطار موضوع واحد ، تلقيت رمزًا جميلًا وخطيًا. </p><br><p style=";text-align:right;direction:rtl">  أول قررت لمحاولة تمديد <a href="https://www.php.net/manual/ru/book.parallel.php" rel="nofollow">الموازي</a> .  له عيب واحد قاتل - يجب أن يتم إنشاء المترجم الشفهي مع دعم ZTS (أمان Zend Thread Safety).  نظرًا لأن ZTS لا يعمل في البرامج النصية العادية للويب ، يجب أن يكون لدى المرء نسختان مختلفتان من المترجم الشفهي.  واحد ، بدون ZTS ، للويب ، والثاني ، مع ZTS ، لتثبيت FIAS.  تفوقت زيادة الأداء المحتملة على هذا الإزعاج ، خاصة بالنظر إلى مدى سهولة تجميع حاوية Docker جديدة واستخدامها مع الحاوية القديمة.  لسوء الحظ ، تسبب بدء Symfony داخل خيط جديد في تجاوز سعة مكدس PHP ، ولم أكن على استعداد لرفض حاوية DI وتكوين مناسب. </p><br><p style=";text-align:right;direction:rtl">  وأخيرا ، وجدت <a href="https://symfony.com/doc/current/components/process.html" rel="nofollow">عملية symfony</a> .  في الواقع ، يبدأ عملية جديدة لأمر وحدة التحكم المحددة ويراقب اكتمالها.  اضطررت إلى إضافة سلسلتين إضافيتين.  يقوم الأول بتنزيل الأرشيف وفك حزمه والبدء في عمليات متوازية لمعالجة البيانات.  الثاني يأخذ قائمة بالملفات من وسيطة سطر الأوامر ويكتب محتوياتها في قاعدة البيانات. </p><br><p style=";text-align:right;direction:rtl">  بسبب عدم وجود خبرة في العمليات المتوازية ، يبدو أنني ارتكبت جميع أخطاء مبتدئ. </p><br><p style=";text-align:right;direction:rtl">  على سبيل المثال ، قامت عملية البدء الخاصة بي بالتحقق من اكتمال الأطفال باستخدام حلقة لا نهائية ، وبطبيعة الحال ، كانت تنفق الكثير من موارد المعالج بشكل غير لائق على هذا.  ساعدت نداء النوم بين التكرار. </p><br><p style=";text-align:right;direction:rtl">  في التطبيق الأول ، تم توزيع الملفات بشكل غير متساو بين العمليات.  سقط أكبر اثنين في تيار واحد ، والتي تمت معالجتها لأكثر من 20 ساعة.  في التطبيق الثاني ، أضفت مديرًا خاصًا يوزع الملفات بناءً على الوقت الذي يستغرقه استيرادها.  الآن يتم تحميل العمليات بالتساوي. </p><br><p style=";text-align:right;direction:rtl">  بعد هذه التعديلات ، تمكنت من استيراد الإصدار الكامل من FIAS خلال 16-20 ساعة ، اعتمادًا على موارد الخادم.  ليست جيدة كما نود ، لكنني مستمر في العمل على التحسين.  والخطوة التالية هي الرفض الكامل ل PostgreSql لصالح Elasticsearch. </p><br><h2 id="vyvody" style=";text-align:right;direction:rtl">  النتائج </h2><br><p style=";text-align:right;direction:rtl">  هل كان يستحق كل هذا العناء؟  سنتان من العمل في مكتبة لم تدخل في أي مشروع قتالي؟ </p><br><p style=";text-align:right;direction:rtl">  نعم تماما. </p><br><p style=";text-align:right;direction:rtl">  لقد غيرت وظيفتي على أي حال.  خلال جولة في عشرات المقابلات ، أجبت على العديد من الأسئلة الصعبة فقط بفضل مشروعي للحيوانات الأليفة. </p><br><p style=";text-align:right;direction:rtl">  الذعر الذي يموت به PHP يزداد قوة باستمرار.  لن أخفي حقيقة أنني كنت أفكر في الهجرة إلى لغة أخرى. </p><br><p style=";text-align:right;direction:rtl">  بعد أن رأيت العمل الضخم الذي وضعه فريق PHP في الإصدار 7 ؛  كان مقتنعًا بمثال شخصي عن مدى نضج اللغة ومدى ثراء النظام البيئي الذي نمت فيه ؛  أستطيع أن أقول بأمان أن الشائعات حول وفاة PHP مبالغ فيها إلى حد كبير.  وهذه هي البداية فقط: في المستقبل ننتظر JIT ، عدم التزامن خارج الصندوق وأكثر من ذلك بكثير. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar479122/">https://habr.com/ru/post/ar479122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar479102/index.html">التعرف على Yandex.Maps أو كم أحب الوثائق</a></li>
<li><a href="../ar479106/index.html">كم تكلفة الحيل السحرية</a></li>
<li><a href="../ar479108/index.html">حياة فارس - الساحة على الإنترنت مع عناصر آر بي جي</a></li>
<li><a href="../ar479116/index.html">مرات الظهور عند البحث Y. Direct: لماذا تدفع أكثر 1.5 مرة لكل نقرة</a></li>
<li><a href="../ar479120/index.html">فشل الإقبال: نأتي AgentTesla لتنظيف المياه. الجزء 2</a></li>
<li><a href="../ar479124/index.html">الذكاء الاصطناعي في الخيال العلمي</a></li>
<li><a href="../ar479126/index.html">بيثون في تطوير المحمول</a></li>
<li><a href="../ar479128/index.html">كيف تعمل الخدمة الطبية في المطار</a></li>
<li><a href="../ar479132/index.html">مكون خارجي لمنصة Mobile 1C (BroadcastReceiver)</a></li>
<li><a href="../ar479136/index.html">الحوسبة الكمومية: نهاية blockchain؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>