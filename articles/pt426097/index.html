<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèª ‚óºÔ∏è üë± Arduino Projeto "RoboCar4W Robot Machine" üòò üåô üç∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ entende - explicou o editor -, deve ser divertido, fresco, cheio de aventuras interessantes ... para que o leitor n√£o possa sair. 
 I. Ilf, E. Pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino Projeto "RoboCar4W Robot Machine"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426097/"><p>  <em>Voc√™ entende - explicou o editor -, deve ser divertido, fresco, cheio de aventuras interessantes ... para que o leitor n√£o possa sair.</em> <br>  I. Ilf, E. Petrov <em>"Como foi criado Robinson"</em> . </p><br><p>  Come√ßar com o Arduino, como em qualquer outra plataforma de software ou hardware, √© sempre mais interessante em algum projeto real.  Ao mesmo tempo, programadores escrevem c√≥digo que exibe "Ol√°, mundo", os arduinistas piscam um LED.  E todo mundo √© feliz quando crian√ßas. </p><br><p>  Decidi come√ßar com um projeto avan√ßado, inclusive com a esperan√ßa secreta de arrancar a gera√ß√£o jovem do Counter-Strike (falhou). </p><br><p>  Como voc√™ pode imaginar pelo nome RoboCar4W, o primeiro projeto foi um carro rob√¥ de quatro rodas.  Come√ßando o trabalho, eu j√° tinha experi√™ncia em programa√ß√£o, j√° sabia soldar por um longo tempo, mas nem conhecia as pinagens do Arduino e nem li a documenta√ß√£o.  Estudei toda a sabedoria no decorrer da pe√ßa e o Google para ajudar. </p><a name="habracut"></a><br><p>  Como o projeto em si n√£o √© fundamentalmente novo, essas descri√ß√µes na rede s√£o suficientes, todos os componentes s√£o conhecidos e nenhuma surpresa foi esperada.  Portanto, a id√©ia foi formulada nos termos mais gerais e o objetivo principal era mergulhar no "mundo das coisas" usando o Arduino, como uma plataforma para prototipagem r√°pida.  Nesta obra, talvez algu√©m se reconhe√ßa no in√≠cio da jornada. </p><br><p>  Todo o hardware foi comprado no ebay e, por experi√™ncia pr√≥pria, quero dizer que √© mais f√°cil comprar um kit inicial imediatamente (procure-o nas palavras do Kit inicial do Arduino), em vez de mont√°-lo em detalhes.  Sim, e todos juntos de uma vez.  Foi decidido n√£o brincar, comprar um chassi normal, rodas normais, motores normais, para que fosse "caro". </p><br><p>  O principal segredo para as compras bem-sucedidas no eBay √© comprar de vendedores com melhor classifica√ß√£o e ler atentamente a descri√ß√£o do produto.  Existem muitos artigos sobre isso na Internet. </p><br><p>  Qual placa Arduino escolher? </p><br><p>  Levei o Arduino UNO, muitos projetos com descri√ß√µes para ele.  Mas agora eu pegaria o Arduino Mega 2560, ele tem mais sa√≠das digitais e anal√≥gicas e total compatibilidade em projetos com a UNO. </p><br><h1 id="obschee-opisanie-proekta">  Descri√ß√£o geral do projeto </h1><br><p>  No mundo do desenvolvimento de software, isso tamb√©m √© chamado de "requisitos do sistema". </p><br><p>  A ideia do projeto foi a seguinte.  A primeira vers√£o da m√°quina rob√≥tica chamada RoboCar4W deve executar a√ß√µes simples: </p><br><ul><li>  avan√ßar, recuar, executar curvas </li><li>  medir dist√¢ncia a obst√°culos </li><li>  ser capaz de contornar automaticamente os obst√°culos √† frente. </li></ul><br><p>  A segunda vers√£o da m√°quina deve ser controlada manualmente via bluetooth a partir de um telefone Android. </p><br><p>  Para que voc√™ trabalhe melhor aqui, todo o projeto final do RoboCar4W √© montado (aqui sem bluetooth). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/457/929/cc8/457929cc8554ef727654f53704ece195.jpg" alt="Arduino RoboCar4W"></p><br><p>  Aqui est√° um v√≠deo de ensaios no mar. </p><br><p>  No primeiro v√≠deo, o RoboCar4W dirige automaticamente, evitando obst√°culos em duas vers√µes diferentes do "firmware", ou seja,  esboce, portanto, se algu√©m √© mais perspicaz e notou que o comportamento do rob√¥ em diferentes epis√≥dios √© um pouco diferente. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/a05/27c/f11/a0527cf11325d83a2b91826412b151b9.jpg" alt="Carro rob√¥ RoboCar4W"></a> </p><br><p>  No segundo v√≠deo, o RoboCar4W se move com a ajuda de comandos transmitidos pelo "driver" via Bluetooth a partir de um telefone celular no Android.  "Bluetooth RC Car" est√° instalado no telefone.  Al√©m disso, se houver um obst√°culo pr√≥ximo, o rob√¥ para, ou seja,  for√ßar algo n√£o funcionar√° (no entanto, existe um bot√£o "secreto" que desativa o modo de seguran√ßa). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/173/997/d9c/173997d9c4f497310ab582b11007d468.jpg" alt="Carro rob√¥ RoboCar4W"></a> </p><br><p>  No terceiro v√≠deo, o RoboCar4W mostra um programa de movimento de demonstra√ß√£o pr√©-programado com curvas.  O programa de demonstra√ß√£o √© ativado sob comando no mesmo telefone celular Android.  O rob√¥ apenas anda por um tempo e faz curvas. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/820/a73/9f5/820a739f5e40ca959f0c441e53552e4d.jpg" alt="Carro rob√¥ RoboCar4W"></a> </p><br><h1 id="algoritm-upravleniya-dvizheniem">  Algoritmo de controle de movimento </h1><br><p>  √â um erro chamar nosso m√©todo de "algoritmo para evitar obst√°culos" ou "localiza√ß√£o de caminho".  Estas s√£o disciplinas matem√°ticas separadas, matem√°tica pura.  Se voc√™ gosta muito de matem√°tica, pesquise no google essas frases e receber√° seis meses de leitura. </p><br><p>  Enquanto isso, estamos interessados ‚Äã‚Äãem coisas muito mais f√°ceis.  Portanto, vamos cham√°-lo simplesmente - o algoritmo de controle de movimento de um rob√¥ de 4 rodas.  √â claro que estamos falando de controle autom√°tico sem interven√ß√£o humana. </p><br><p>  Aqui est√° este algoritmo simples, escrito em palavras, para algoritmos mais complexos √© necess√°rio (se voc√™ deseja ou n√£o) compor diagramas de blocos. </p><br><p>  Agora, ao mesmo tempo, observe o c√≥digo-fonte do esbo√ßo <a href="">RoboCar4W-1.ino</a> . </p><br><ol><li>  Medimos a dist√¢ncia do obst√°culo √† frente. </li><li> Se essa dist√¢ncia medida for menor que o valor <code>DST_TRH_BACK</code> (abrevia√ß√£o de limite de dist√¢ncia), paramos e fazemos o inverso ao girar.  O sentido de rota√ß√£o √© escolhido da seguinte forma: se voc√™ virou √† esquerda anteriormente, vire √† direita e vice-versa. </li><li>  Se a dist√¢ncia medida for maior que <code>DST_TRH_BACK</code> , mas menor que <code>DST_TRH_TURN</code> , basta girar.  A dire√ß√£o da rota√ß√£o √© escolhida aleatoriamente. </li><li>  Se voc√™ estiver longe do obst√°culo, siga em frente. </li><li>  Repetimos tudo de novo. </li></ol><br><p>  O que √© bom que n√≥s temos 4 rodas e tra√ß√£o nas quatro rodas?  Podemos executar (programar) v√°rios tipos de voltas: </p><br><ul><li>  Rota√ß√£o suave.  Todas as rodas giram, mas as rodas de um lado giram mais rapidamente. </li><li>  Uma curva acentuada.  As rodas giram apenas em um lado. </li><li>  Invers√£o de marcha no lugar.  Como um trator, as rodas de um lado giram para tr√°s e o outro para a frente. </li></ul><br><p>  Na segunda vers√£o do programa, ao controlar a partir de um telefone Android, o modo de seguran√ßa, quando o rob√¥ tenta evitar colis√µes frontais, pode ser desativado se o programa for pressionado duas vezes. <br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/256/454/2d3256454e390ed508f62d212ffb1d15.jpg" alt="Bot√£o"></p><br><p>  e ligado novamente pressionando-o uma vez. </p><br><p>  <em>Nota importante</em> .  Toda l√≥gica est√° sob o controle do Arduino.  O Android aqui funciona como um console de jogo (sem c√©rebro) do console, sua tarefa √© transmitir estupidamente pressionamentos de bot√£o (ou seja, comandos) via Bluetooth para o Arduino RoboCar4W. </p><br><h1 id="komponenty">  Componentes </h1><br><p>  Inicialmente, a m√°quina inclu√≠a um servoconversor que girava o medidor de dist√¢ncia ultrass√¥nico em um determinado √¢ngulo para medi√ß√µes em tr√™s dire√ß√µes.  Mas durante os testes, devido ao manuseio descuidado, o servo foi queimado; agora, o sensor de dist√¢ncia √© simplesmente rigidamente fixado na frente do gabinete. </p><br><p>  N√£o h√° revestimento de prata, mas o esbo√ßo se tornou um pouco mais f√°cil. </p><br><p>  Para o futuro, compre o servo mais simples e mais barato, n√£o s√£o necess√°rios pot√™ncia especial, velocidade e precis√£o de rota√ß√£o em um determinado √¢ngulo, e √© muito f√°cil desativar um servo, como se viu.  SG90 no valor de US $ 2 √© um bom ajuste. </p><br><p>  Portanto, os componentes do projeto RoboCar4W, uma descri√ß√£o em ingl√™s, s√£o fornecidos para facilitar a pesquisa no ebay e similares: </p><br><ul><li>  Arduino UNO R3 </li><li>  Chassi pronto Plataforma de rob√¥ m√≥vel com tra√ß√£o nas 4 rodas Chassi de carro inteligente Compat√≠vel com Arduino </li><li>  Motores DC com rota√ß√£o nos dois sentidos - 4 unid. </li><li>  Rodas - 4 unid. </li><li>  Placa para controle de 4 motores DC Motor Drive Shield L293D </li><li>  Medidor de dist√¢ncia ultra-s√¥nico HC-SR04 Sensor ultrass√¥nico de medi√ß√£o de dist√¢ncia do m√≥dulo </li><li>  Pilhas Ni-MH 1,2 V - 8 p√ßs. </li><li>  Suporte de caixa de pl√°stico para baterias, Suporte de caixa de bateria 4 pilhas AA - 2 un. </li><li>  Tipo de bateria "Krona" 8,4 V - 1 pc. </li><li>  Interruptor de alavanca opcional - interruptor de alimenta√ß√£o </li></ul><br><p>  Chassis, motores CC e rodas foram adquiridos imediatamente no kit e mesmo com as instru√ß√µes de montagem. </p><br><h1 id="raspinovka">  Pinagem </h1><br><p>  As entradas anal√≥gicas podem ser usadas como pinos digitais das portas de E / S.  Os pinos do Arduino correspondentes √†s entradas anal√≥gicas s√£o numerados de 14 a 19. Isso se aplica apenas aos pinos do Arduino, e n√£o aos n√∫meros f√≠sicos dos pinos do microcontrolador Atmega. </p><br><p>  Voc√™ n√£o precisa desenhar, basta colocar tudo em uma mesa.  Eu fiz assim. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/504/d24/fff/504d24fff6bdc78120e1a28a39848967.png" alt="Pinagem"></p><br><p>  Os pinos D4, D7, D8, D12 estar√£o ocupados se forem utilizados motores DC ou de passo. </p><br><p>  Os pinos D9 (controle servo n¬∫ 1) e D10 (controle servo n¬∫ 2) ser√£o utilizados apenas se forem utilizados servomotores. </p><br><p>  O pino do Arduino n√£o ocupa os pinos do Arduino para controlar o L293D do Motor Drive Shield. </p><br><p>  Os pinos de alimenta√ß√£o de 3,3 V, 5 V e o terra s√£o duplicados na blindagem de acionamento do motor em quantidades suficientes.  Portanto, n√£o h√° necessidade de se preocupar com a escassez. </p><br><p>  Se voc√™ ainda deseja desenhar lindamente, o programa Fritzing gratuito o ajudar√°. </p><br><h1 id="pitanie">  Nutri√ß√£o </h1><br><p>  Este √© o segundo ponto muito importante.  Depende muito da nutri√ß√£o.  Por exemplo, um servo motor ao girar o eixo em um determinado √¢ngulo come√ßa a consumir muita corrente.  Ao mesmo tempo, se o servo for alimentado por um Arduino de 5 V, haver√° um "rebaixamento" de tens√£o e o restante do circuito come√ßar√° a falhar, e o Arduino pode at√© reiniciar ao mesmo tempo. </p><br><p>  De qualquer forma, se voc√™ usar motores na embarca√ß√£o, ser√° necess√°rio um protetor de acionamento do motor (ou um circuito semelhante). </p><br><p>  Portanto, temos 4 motores DC, um servoconversor, a pr√≥pria placa Arduino e v√°rios sensores.  Os motores s√£o os mais glut√¥nicos, mas os sensores podem ser alimentados com sucesso a partir dos conectores da pr√≥pria placa Arduino, ent√£o tudo √© simples com eles.  Por conveni√™ncia, reduzi toda a economia em uma tabela. </p><br><table><thead><tr><th></th><th>  Tens√£o recomendada ou t√≠pica.  Consumo atual </th><th>  Tens√£o m√°xima </th><th>  O que est√° planejado para alimentar </th><th>  Anota√ß√µes </th></tr></thead><tbody><tr><td>  Placa Arduino UNO R3 </td><td>  7 - 12V, 200mA (m√©dia) </td><td>  6 - 20 </td><td>  "Krone 9V" Li-ion 650mAh, 8.4V </td><td>  Conector central </td></tr><tr><td>  Servo Motor MG-995 </td><td>  5-6 V, 0,1 - 0,3A (pico) </td><td>  4.8 - 7.2 </td><td>  Pilhas (5) p√ßs.  Ni-Mh 1.2V = 6V </td><td>  Alimentos apenas de uma fonte separada.  Se voc√™ ligar o Arduino, tudo falhar√°.  Tens√µes da bateria Ni-Mh 4pcs  * 1.2V = 4.8V n√£o √© suficiente.  Alguns argumentam que este servo n√£o deve ser usado em apenas 6 volts. </td></tr><tr><td>  Motores DC (4 unid.) </td><td>  6 - 8V, corrente de 70mA a 250mA </td><td>  3 - 12 </td><td>  baterias (5 + 3) unid.  Ni-Mh 1.2V = 9.6V </td><td>  Voc√™ n√£o poder√° dar partida nos motores normalmente a partir de uma bateria de 9V, portanto nem perca tempo (e baterias)! </td></tr><tr><td>  Escudo de acionamento do motor L293D </td><td>  n√£o √© necess√°rio </td><td>  4.5 - 36 </td><td>  n√£o √© necess√°rio </td><td></td></tr><tr><td>  M√≥dulo Bluetooth HC-0506 </td><td>  3,3 V, 50 mA </td><td>  1.8‚Äî3.6 </td><td>  Com placa de pinos 3.3V Arduino </td><td></td></tr><tr><td>  Medidor de dist√¢ncia ultra-s√¥nico HC-SR04 </td><td>  5 V, 2 mA </td><td>  5 </td><td>  Com placa de pino 5V Arduino </td><td></td></tr></tbody></table><br><p>  Eu n√£o tinha um conversor de tens√£o DC / DC.  O Krona 9V n√£o era uma fonte muito boa de energia, eu j√° tinha. </p><br><p>  Mas me recusei a usar baterias de alta capacidade de √≠on de l√≠tio.  Em primeiro lugar, devido ao alto custo e, em segundo lugar, nas compras online chinesas, √© f√°cil encontrar uma farsa.  Mais precisamente, n√£o √© "f√°cil", mas "sempre".  Al√©m disso, o √≠on de l√≠tio requer tratamento especial e n√£o √© seguro. </p><br><p>  Portanto, como vemos na tabela, precisamos de 3 fontes de energia independentes: </p><br><ul><li>  Para placa Arduino e sensores. </li><li>  Para servomotor. </li><li>  Para 4 motores de corrente cont√≠nua. </li></ul><br><p>  Onde posso conseguir tanto?  De qualquer forma, a pr√≥pria placa Arduino deve ser alimentada por uma fonte separada, como  quando a tens√£o "afunda", por exemplo, ao ligar os motores, a placa pode reiniciar ou simplesmente falhar.  Aqui usamos a bateria do fator de forma Krona 9V, e o conector que ser√° conectado ao Arduino deve estar com uma ‚Äúvantagem no centro‚Äù. </p><br><p>  Para um servomotor e 4 motores DC, voc√™ pode fazer com uma fonte de energia.  O √∫nico problema √© que o servomotor foi projetado para tens√£o 5-6V (m√°ximo 7,2V) e corrente de 100-300mA (pico), e os motores CC precisam de 6-8V (m√°ximo de 12V) e corrente de 250mA. </p><br><p>  Para resolver o problema, existem conversores DC-DC, mas eu n√£o tinha.  Como resultado, apliquei meu diagrama de fia√ß√£o "propriet√°rio" (sem circuitos eletr√¥nicos reduzidos, apenas tens√£o e corrente ecol√≥gicas!): Conectei 8 pe√ßas.  Baterias de 1,2V em s√©rie e torneiras nos lugares certos, conforme mostrado no diagrama. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f13/3f4/b82/f133f4b82dc88cf2de958804735c73b3.png" alt="Nutri√ß√£o"></p><br><p>  6V foram para o servomotor e 9,6 para motores de corrente cont√≠nua.  √â claro que as baterias de 1 a 5 sofrer√£o aumento de carga. </p><br><p>  Para controlar motores servo e CC, usei um Motor Drive Shield de 4 canais baseado no chip L293D. </p><br><h1 id="sborka">  Assembl√©ia </h1><br><p>  A montagem do chassi acabado √© um pequeno problema.  Mas n√£o pense que sem o doping voc√™ conseguir√° tudo imediatamente.  Portanto, prepare arquivos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/f4a/d8b/058f4ad8b7a7b76295d5295dcd63afba.jpg" alt="Assembl√©ia"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bb/d2d/32c/5bbd2d32c5caa7a97d8201bddabae96c.jpg" alt="Assembl√©ia"></p><br><p>  N√£o √© poss√≠vel conectar v√°rios motores normalmente, um servo motor ou um stepper diretamente ao Arduino.  Como os pinos (conclus√µes) do Arduino s√£o de baixa corrente.  Para solucionar o problema, existe um m√≥dulo de controle de acionamento adicional - Motor Drive Shield baseado no chip L293D, que √© um dos chips mais comuns projetados para essa finalidade.  O chip L293D tamb√©m √© conhecido como H-Bridge. </p><br><p>  Usei uma placa que fornece 4 canais para conex√£o em dois chips L293D e um registrador de deslocamento.  Comprado no eBay por US $ 5. </p><br><p>  Esta placa do m√≥dulo de controle do inversor possui as seguintes especifica√ß√µes. </p><br><ul><li>  Escudo de acionamento de motor L293D compat√≠vel com Arduino Mega 1280 e 2560, UNO, Duemilanove, Diecimila </li><li>  Controle de 4 canais </li><li>  motores alimentados de 4.5V a 36V </li><li>  corrente de carga admiss√≠vel 600mA por canal, corrente de pico - 1.2A </li><li>  prote√ß√£o contra superaquecimento </li><li>  2 interfaces com um timer Arduino exato (n√£o haver√° "instabilidade") para conectar servomotores a 5V, se a tens√£o de alimenta√ß√£o precisar ser maior, a conex√£o de alimenta√ß√£o dever√° ser refeita conforme descrito abaixo </li><li>  4 motores coletores CC bidirecionais ou 2 servomotores de passo e 2 podem ser controlados simultaneamente </li><li>  4 motores CC bidirecionais s√£o conectados a um barramento de 8 bits para sele√ß√£o individual de velocidade </li><li>  conex√£o de at√© 2 drives de passo (unipolar ou bipolar), com uma bobina, bobina dupla ou etapas alternadas </li><li>  conector para conectar uma fonte externa para fonte de alimenta√ß√£o separada da l√≥gica de controle e dos motores </li><li>  Bot√£o RESET Arduino </li><li>  A biblioteca Adafruit AFMotor √© usada para gerenciamento. </li></ul><br><p>  O Motor Drive Shield precisa de um pouco de aperfei√ßoamento para que voc√™ possa conectar qualquer coisa depois dele.  Soldamos os conectores necess√°rios no topo, foi o que aconteceu. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/470/943/060/47094306049d3d9ff9dbe393bd203b1a.jpg" alt="Blindagem de acionamento do motor"></p><br><p>  Os motores podem ser conectados a uma fonte de alimenta√ß√£o adicional em rela√ß√£o √† placa Arduino.  Eu recomendo apenas este m√©todo de conex√£o.  Para fazer isso, remova, abra o jumper, como mostra a figura. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a18/6c0/d8b/a186c0d8b3c77c02a7e260411eb1cbd9.jpg" alt="Desativa√ß√£o do acionamento do motor L293D de 4 canais.  Jumper para alimenta√ß√£o externa"></p><br><p>  Nesse caso, o Arduino √© alimentado e os motores s√£o alimentados independentemente um do outro. </p><br><p>  O LED na blindagem do motor acende quando h√° energia para os motores; se n√£o estiver aceso, os motores n√£o funcionar√£o. </p><br><p>  Novo problema. </p><br><p>  A posi√ß√£o do jumper de for√ßa n√£o se aplica aos servos, eles ainda ser√£o alimentados por 5V Arduino.  Como os servomotores geralmente consomem muita corrente e, se a energia √© insuficiente, todo o dispositivo come√ßa a falhar, no "melhor" caso, apenas o servoconversor falha - ele n√£o gira no √¢ngulo definido ou o tempo todo antes de cada turno girar primeiro a 0 graus e somente ent√£o em um determinado √¢ngulo (e se voc√™ conseguir acompanhar).  Portanto, recomendo alimentar o servo tamb√©m a partir de uma fonte de energia adicional.  Para fazer isso, voc√™ precisar√° refazer um pouco o diagrama de conex√£o: retire o fio positivo (geralmente vermelho) do conector padr√£o e conecte-o diretamente ao sinal de adi√ß√£o da fonte de alimenta√ß√£o. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d2f/6ea/fa1/d2f6eafa1d5721a6e36a38429aa4ad9e.jpg" alt="Finaliza√ß√£o para conectar o poder do servomotor"></p><br><p>  Ao conectar uma blindagem de acionamento do motor, n√£o s√£o utilizados pinos anal√≥gicos.  Os pinos digitais 2, 13 n√£o s√£o usados. </p><br><p>  Os seguintes pinos s√£o usados ‚Äã‚Äãapenas se os motores CC ou motores de passo correspondentes estiverem conectados e usados: </p><br><ul><li>  D11: Motor DC n¬∫ 1 / Passo n¬∫ 1 (ativa√ß√£o e controle de velocidade) </li><li>  D3: Motor DC n¬∫ 2 / Passo n¬∫ 1 (ativa√ß√£o e controle de velocidade) </li><li>  D5: Motor DC n¬∫ 3 / Passo n¬∫ 2 (ativa√ß√£o e controle de velocidade) </li><li>  D6: Motor DC # 4 / Stepper # 2 (ativa√ß√£o e controle de velocidade) </li></ul><br><p>  Esses pinos estar√£o ocupados se qualquer DC / stepper for usado: D4, D7, D8, D12. </p><br><p>  Os seguintes pinos ser√£o ocupados apenas se os servomotores apropriados forem utilizados: </p><br><ul><li>  D9: Controle servo n¬∫ 1 </li><li>  D10: Controle servo # 2 </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27f/dd4/746/27fdd474619f83391b6c486a576a31fa.png" alt="Tabela de conex√£o"></p><br><p>  Para come√ßar a usar o Motor Drive Shield, √© necess√°rio baixar e instalar a biblioteca do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adafruit AFMotor</a> . </p><br><p>  Exemplo de c√≥digo para controle de motores: </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;AFMotor.h&gt;</span></span></span><span class="hljs-meta"> //   Adafruit #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt;</span></span></span><span class="hljs-meta"> //     AF_DCMotor motor(1); //   ,    DC    Motor Shiled , ,  frequency Servo servo; //    servo.attach(10); //     9  10 (    Motor Shiled) motor.setSpeed(speed); //   DC   0 ()  255 ( ) motor.run(RELEASE); // DC   motor.run(FORWARD); // DC   motor.run(BACKWARD); // DC   servo.write(90); //    90 .</span></span></code> </pre> <br><p>  O motor DC come√ßou a girar apenas quando indica uma velocidade maior que 100, se menor, apenas vibra.  Voc√™ ter√° que determinar a velocidade m√≠nima do seu motor experimentalmente. </p><br><p>  Para motores conectados a M1 e M2, voc√™ pode definir a frequ√™ncia: MOTOR12_64KHZ, MOTOR12_8KHZ, MOTOR12_2KHZ, MOTOR12_1KHZ.  A maior velocidade de rota√ß√£o √© alcan√ßada em 64KHz, essa frequ√™ncia ser√° ouvida, menor frequ√™ncia e velocidade em 1KHz, mas tamb√©m usa menos energia.  Os motores 3 e 4 sempre funcionam a 1 KHz; outros valores s√£o ignorados.  O padr√£o √© 1KHz em todos os lugares. </p><br><p>  Depois disso, √© necess√°rio executar um teste de motores.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Esbo√ßo para teste pode ser feito aqui</a> .  No in√≠cio do esbo√ßo, altere o n√∫mero do motor em uma linha (ou em linhas) do tipo: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Um esbo√ßo, durante algum tempo, gira o (s) motor (es) para frente ao longo do movimento do rob√¥ e depois para tr√°s.  Observe atentamente se o motor gira nessa dire√ß√£o e, se necess√°rio, altere a polaridade da conex√£o. </p><br><p>  Conectamos o medidor de dist√¢ncia ultrass√¥nico HC-SR04 M√≥dulo ultrass√¥nico.  Pinagem: </p><br><ul><li>  Vcc </li><li>  Trig (T) </li><li>  Eco (r) </li><li>  GND </li></ul><br><p>  O tempo gasto pelo tel√™metro ultrass√¥nico nas medi√ß√µes (determinadas empiricamente): </p><br><ul><li>  240 ms no m√°ximo se a dist√¢ncia for muito longa (fora da faixa) </li><li>  pelo menos 1 ms se a dist√¢ncia for muito curta </li><li>  uma dist√¢ncia de 1,5 m √© determinada em aproximadamente 10 ms </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/de0/071/18e/de007118e81cee628722e426d8e83800.jpg" alt="M√≥dulo ultra-s√¥nico de medidor de dist√¢ncia ultra-s√¥nico HC-SR04"></p><br><p>  Um sensor ultrass√¥nico de tel√™metro, devido √† sua natureza f√≠sica, e n√£o porque a China, em alguns casos, determina mal a dist√¢ncia de um obst√°culo: </p><br><ul><li>  se o obst√°culo √© de forma complexa, o ultrassom √© refletido em √¢ngulos diferentes e o sensor est√° errado, </li><li>  o ultrassom √© perfeitamente absorvido (ou seja, n√£o √© refletido) por m√≥veis ou brinquedos estofados e o sensor acredita que n√£o h√° nada √† sua frente. </li></ul><br><p>  Em outras palavras, para um tel√™metro ultrass√¥nico, seria ideal se todos os obst√°culos estivessem na forma de um plano s√≥lido perpendicular √† dire√ß√£o da radia√ß√£o ultrass√¥nica. </p><br><p>  Alguns problemas podem ser resolvidos com um sensor de dist√¢ncia por infravermelho.  Mas tamb√©m n√£o √© perfeito: </p><br><ul><li>  alcance m√°ximo pequeno comparado ao ultrassom: 0,3-0,8 m versus 4 m </li><li>  grande dist√¢ncia m√≠nima em compara√ß√£o ao ultrassom: 10 cm vs 2 cm </li><li>  depend√™ncia da sensibilidade do sensor na ilumina√ß√£o geral. </li></ul><br><p>  Embora se voc√™ instalar esses rangefinders em um par, a efici√™ncia do trabalho deles aumentar√° significativamente. </p><br><h1 id="podklyuchaem-bluetooth-hc-05">  Conectar Bluetooth HC-05 </h1><br><p>  Como voc√™ pode ver na folha de dados, os pinos principais do HC-05 ‚Äúnu‚Äù: </p><br><ul><li>  Transmiss√£o TX (pino 1) </li><li>  Recep√ß√£o RX (pino 2) </li><li>  Fonte de alimenta√ß√£o 3.3V (pino 12) </li><li>  Terra de GND (pino 13) </li><li>  Indicador de modo PIO8 (pino 31) </li><li>  Status da conex√£o PIO9 (pino 32), se a conex√£o for estabelecida, a sa√≠da ser√° alta </li><li>  PIO11 (pino 34) para ativar o modo de comando AT </li></ul><br><p>  Nosso m√≥dulo √© soldado √† placa Breakout / Base, onde j√° existe um divisor de tens√£o, portanto, ele possui uma faixa de tens√£o de trabalho de 3,3V a 6V. </p><br><p>  Conectamos nosso conjunto de m√≥dulo Bluetooth: </p><br><ul><li>  Arduino (TX) - (RX) HC-05 </li><li>  Arduino (RX) - (TX) HC-05 </li><li>  Arduino (+ 5V) - (VCC) Bluetooth </li><li>  Arduino (GND) - (GND) Bluetooth </li><li>  Os pinos LED, CHAVE n√£o s√£o usados </li></ul><br><p>  Ap√≥s a alimenta√ß√£o do m√≥dulo Bluetooth HC-05, o LED deve piscar, o que significa que o bluetooth est√° funcionando. </p><br><p>  Ligue o bluetooth no celular, encontre o dispositivo com o nome HC-05 e conecte, senha 1234. </p><br><p>  Para testar, preencha um esbo√ßo simples no Arduino: </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Test Arduino + Bluetooth. http://localhost"); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { count++; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Count = "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(count); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><p>  No telefone Android, instale o terminal Bluetooth.  Estamos conectados ao dispositivo HC-05 e observamos na tela do telefone linhas rastejantes com um contador crescente. </p><br><p>  Para que o m√≥dulo possa receber comandos AT, √© necess√°rio coloc√°-lo no modo apropriado - para isso, √© necess√°rio definir a sa√≠da KEY (PIO11) como l√≥gica 1. Em algumas placas Breakout / Base, em vez da sa√≠da KEY, existe uma sa√≠da EN (ENABLE), que pode ou n√£o ser soldado ao pino no pr√≥prio chip.  Isso se aplica apenas aos chips HC05.  Isso √© apenas minha sa√≠da do terminal EN n√£o √© soldada em nenhum lugar.  Portanto, ele pode ser soldado com um fio separado ao terminal KEY (PIO11) do chip.  Ou, durante a opera√ß√£o, para colocar o HC05 no modo de comando AT, provoque um curto-circuito na sa√≠da do chip KEY (PIO11) na sa√≠da de energia Vcc por alguns segundos.  Para o HC06, o pino CHAVE n√£o √© necess√°rio. </p><br><h1 id="programmnoe-obespechenie">  De software </h1><br><p>  Nota  Antes de baixar o programa para o Arduino, verifique se o m√≥dulo Bluetooth n√£o est√° conectado ao Arduino.  Isso causar√° problemas de preenchimento de esbo√ßo.  Apenas desconecte a energia do m√≥dulo Bluetooth ou dos fios que conectam os pinos dos m√≥dulos Arduino e RX, TX. </p><br><p>  No in√≠cio do esbo√ßo, altere os n√∫meros do motor nas linhas do tipo: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <a href="">Esbo√ßo para o modo autom√°tico com download de preven√ß√£o de obst√°culos aqui</a> . </p><br><p>  Se voc√™ substituir a sequ√™ncia </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  em </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p>  Isso ativar√° o modo de depura√ß√£o. </p><br><p>  No modo de depura√ß√£o, o RoboCar4W realmente n√£o dirige ou roda.  Em vez disso, ative o monitor da porta serial e voc√™ ver√° como ele "dirige" virtualmente.  Em vez de um avan√ßo real da unidade, a sequ√™ncia "Forward" ser√° gravada no monitor da porta serial, em vez de reverter com uma curva √† esquerda, "Turn Back L (eft)", etc.  O sensor de dist√¢ncia ultrass√¥nico tamb√©m n√£o faz nada; as dist√¢ncias dos obst√°culos s√£o geradas de forma program√°tica e aleat√≥ria. </p><br><p>  Esse modo de depura√ß√£o √© conveniente se voc√™ alterar o algoritmo de movimento e, em vez de pegar a m√°quina pela sala, basta verificar tudo no modo inativo. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Esbo√ßo Bluetooth para controle manual, fa√ßa o download aqui</a> .  O esbo√ßo n√£o possui o modo de depura√ß√£o, pois tudo √© transparente l√°.  Voc√™ pressiona o bot√£o - o rob√¥ continua. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Programa para Adnroid Bluetooth RC Car</a> . </p><br><p>  Bem, √© isso!  Boa viagem! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/32b/8dc/98f/32b8dc98ff44592014df2bf2f736f9d5.jpg" alt="Boa viagem!"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt426097/">https://habr.com/ru/post/pt426097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt426087/index.html">Assinando um PDF em JS e colando uma assinatura em C # usando o Crypto PRO</a></li>
<li><a href="../pt426089/index.html">Startup americana desenvolveu √≥culos-AdBlock</a></li>
<li><a href="../pt426091/index.html">8 analisadores de log em nuvem para avaliar o ambiente de trabalho</a></li>
<li><a href="../pt426093/index.html">Monetiza√ß√£o de dados do usu√°rio x publicidade no aplicativo: pr√≥s e contras</a></li>
<li><a href="../pt426095/index.html">Semin√°rio on-line aberto ‚ÄúComo n√£o escrever em Python‚Äù</a></li>
<li><a href="../pt426099/index.html">Not√≠cias do Typegram</a></li>
<li><a href="../pt426101/index.html">Integridade de dados na arquitetura de microsservi√ßos - como garantir isso sem transa√ß√µes distribu√≠das e conectividade r√≠gida</a></li>
<li><a href="../pt426103/index.html">Semin√°rio on-line ‚ÄúVoc√™ precisa do Kubernetes‚Äù 15 de outubro √†s 19:00</a></li>
<li><a href="../pt426105/index.html">Minha captura em uma semana</a></li>
<li><a href="../pt426111/index.html">Google ainda vai lan√ßar um servi√ßo de busca censurado na China</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>