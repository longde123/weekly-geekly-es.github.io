<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç¢ ü¶ì ü§ï Tiempo de alta precisi√≥n: c√≥mo trabajar con fracciones de segundo en MySQL y PHP üôèüèæ üçé üí£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez que me sorprend√≠ pensando que cuando trabajo con el tiempo en las bases de datos, casi siempre uso el tiempo exacto al segundo simplemente por...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tiempo de alta precisi√≥n: c√≥mo trabajar con fracciones de segundo en MySQL y PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/469615/"><p><img src="https://habrastorage.org/webt/uu/43/0k/uu430kx8xpmnjcelv7obc41muik.jpeg"></p><br><p>  Una vez que me sorprend√≠ pensando que cuando trabajo con el tiempo en las bases de datos, casi siempre uso el tiempo exacto al segundo simplemente porque estoy acostumbrado y que esta es la opci√≥n descrita en la documentaci√≥n y una gran cantidad de ejemplos.  Sin embargo, ahora esta precisi√≥n est√° lejos de ser suficiente para todas las tareas.  Los sistemas modernos son complejos, pueden constar de muchas partes, tienen millones de usuarios que interact√∫an con ellos, y en muchos casos es m√°s conveniente utilizar una mayor precisi√≥n, cuyo soporte ha existido durante mucho tiempo. </p><br><p>  En este art√≠culo hablar√© sobre formas de usar el tiempo con partes fraccionarias de un segundo en MySQL y PHP.  Fue concebido como un tutorial, por lo que el material est√° dise√±ado para una amplia gama de lectores y en algunos lugares repite la documentaci√≥n.  El valor principal debe ser que recopil√© en un texto todo lo que necesita saber para trabajar con ese tiempo en MySQL, PHP y el marco Yii, y tambi√©n agregu√© descripciones de problemas no obvios que puede encontrar. </p><br><p>  Usar√© el t√©rmino "tiempo de alta precisi√≥n".  En la documentaci√≥n de MySQL ver√° el t√©rmino "segundos fraccionarios", pero su traducci√≥n literal suena extra√±a, pero no encontr√© otra traducci√≥n establecida. </p><a name="habracut"></a><br><h2 id="kogda-stoit-ispolzovat-vremya-vysokoy-tochnosti">  ¬øCu√°ndo usar el tiempo de alta precisi√≥n? </h2><br><p>  Para empezar, mostrar√© una captura de pantalla de la bandeja de entrada de mi bandeja de entrada que ilustra bien la idea: </p><br><p><img src="https://habrastorage.org/webt/bc/tg/gx/bctggxr0qbeetqe9hmmb4zjmbom.png" alt="Dos cartas de un remitente"></p><br><p>  Las letras son la reacci√≥n de la misma persona a un evento.  Un hombre presion√≥ accidentalmente el bot√≥n equivocado, r√°pidamente se dio cuenta de esto y se corrigi√≥.  Como resultado, recibimos dos cartas enviadas aproximadamente al mismo tiempo, que son importantes para ordenar correctamente.  Si el tiempo de env√≠o es el mismo, existe la posibilidad de que las letras se muestren en el orden incorrecto y el destinatario se averg√ºence, porque entonces recibir√° el resultado incorrecto por el que contar√°. </p><br><p>  Encontr√© las siguientes situaciones en las que el tiempo de alta precisi√≥n ser√≠a relevante: </p><br><ol><li>  Desea medir el tiempo entre algunas operaciones.  Aqu√≠ todo es muy simple: cuanto mayor sea la precisi√≥n de las marcas de tiempo en los l√≠mites del intervalo, mayor ser√° la precisi√≥n del resultado.  Si usa segundos completos, puede cometer un error durante 1 segundo (si cae en los bordes de segundos).  Si usa seis decimales, entonces el error ser√° seis √≥rdenes de magnitud m√°s bajo. </li><li>  Tiene una colecci√≥n donde es probable que haya varios objetos con el mismo tiempo de creaci√≥n.  Un ejemplo es un chat familiar para todos, donde la lista de contactos se ordena por la hora del √∫ltimo mensaje.  Si aparece la navegaci√≥n p√°gina por p√°gina, incluso existe el riesgo de perder contactos en los bordes de la p√°gina.  Este problema se puede resolver sin un tiempo de alta precisi√≥n debido a la clasificaci√≥n y paginaci√≥n por un par de campos (tiempo + identificador √∫nico de un objeto), pero esta soluci√≥n tiene sus inconvenientes (al menos la complicaci√≥n de las consultas SQL, pero no solo eso).  Aumentar la precisi√≥n del tiempo ayudar√° a reducir la probabilidad de problemas y sin complicar el sistema. </li><li>  Necesita mantener un historial de cambios de alg√∫n objeto.  Esto es especialmente importante en el mundo del servicio, donde las modificaciones pueden ocurrir en paralelo y en lugares completamente diferentes.  Como ejemplo, puedo trabajar con fotograf√≠as de nuestros usuarios, donde se pueden realizar muchas operaciones diferentes en paralelo (el usuario puede hacer que la foto sea privada o eliminarla, se puede moderar en uno de varios sistemas, recortar para usar como una foto en el chat, etc.). ) </li></ol><br><p>  Debe tenerse en cuenta que uno no puede creer los valores obtenidos en un 100% y la precisi√≥n real de los valores obtenidos puede ser inferior a seis decimales.  Esto se debe al hecho de que podemos obtener un valor de tiempo inexacto (especialmente cuando trabajamos en un sistema distribuido que consta de muchos servidores), el tiempo puede cambiar inesperadamente (por ejemplo, al sincronizar a trav√©s de NTP o al cambiar el reloj), etc. No me detendr√© en todos estos problemas, pero le dar√© un par de art√≠culos donde puede leer m√°s sobre ellos: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚ÄúConceptos err√≥neos de los programadores sobre el tiempo‚Äù</a> (el art√≠culo en s√≠ es muy minimalista, pero adem√°s de los res√∫menes del texto, se pueden encontrar explicaciones en los comentarios); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"La pesada carga del tiempo"</a> . </li></ul><br><h2 id="rabota-so-vremenem-vysokoy-tochnosti-v-mysql">  Trabaja con tiempo de alta precisi√≥n en MySQL </h2><br><p> MySQL admite tres tipos de columnas en las que se puede almacenar el tiempo: <code>TIME</code> , <code>DATETIME</code> y <code>TIMESTAMP</code> .  Inicialmente, solo pod√≠an almacenar valores que eran m√∫ltiplos de un segundo (por ejemplo, 2019-08-14 19:20:21).  En la versi√≥n 5.6.4, que se lanz√≥ en diciembre de 2011, se hizo posible trabajar con la fracci√≥n de segundo.  Para hacer esto, al crear la columna, debe especificar el n√∫mero de lugares decimales, que deben almacenarse en la parte fraccionaria de la marca de tiempo.  El n√∫mero m√°ximo de caracteres admitidos es seis, lo que le permite almacenar un tiempo preciso al microsegundo.  Si intentas usar m√°s caracteres, obtienes un error. </p><br><p>  Un ejemplo: </p><br><pre> <code class="sql hljs">Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ChatContactsList`</span></span> ( <span class="hljs-string"><span class="hljs-string">`chat_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">`title`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`last_message_send_time`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span>; Query OK, 0 rows affected (0.02 sec) Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ChatContactsList`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> last_message_send_time <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; ERROR 1426 (42000): Too-big precision 9 specified for 'last_message_send_time'. Maximum is 6. Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ChatContactsList`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> last_message_send_time <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; Query OK, 0 rows affected (0.09 sec) Records: 0 Duplicates: 0 Warnings: 0 Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ChatContactsList (title, last_message_send_time) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Chat #1'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>()); Query OK, 1 row affected (0.03 sec) Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ChatContactsList; +<span class="hljs-comment"><span class="hljs-comment">---------+---------+-------------------------+ | chat_id | title | last_message_send_time | +---------+---------+-------------------------+ | 1 | Chat #1 | 2019-09-22 22:23:15.000 | +---------+---------+-------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  En este ejemplo, la marca de tiempo del registro insertado tiene una fracci√≥n cero.  Esto sucedi√≥ porque el valor de entrada se indic√≥ al segundo m√°s cercano.  Para resolver el problema, la precisi√≥n del valor de entrada debe ser la misma que el valor en la base de datos.  El consejo parece obvio, pero es relevante, ya que puede surgir un problema similar en aplicaciones reales: nos enfrentamos a una situaci√≥n en la que el valor de entrada ten√≠a tres decimales y seis estaban almacenados en la base de datos. </p><br><p>  La forma m√°s f√°cil de evitar que ocurra este problema es utilizar los valores de entrada con la m√°xima precisi√≥n (hasta microsegundos).  En este caso, al escribir datos en la tabla, el tiempo se redondear√° a la precisi√≥n requerida.  Esta es una situaci√≥n absolutamente normal que no causar√° ninguna advertencia (s): </p><br><pre> <code class="sql hljs">Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> last_message_send_time=<span class="hljs-string"><span class="hljs-string">"2019-09-22 22:23:15.2345"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> chat_id=<span class="hljs-number"><span class="hljs-number">1</span></span>; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ChatContactsList; +<span class="hljs-comment"><span class="hljs-comment">---------+---------+-------------------------+ | chat_id | title | last_message_send_time | +---------+---------+-------------------------+ | 1 | Chat #1 | 2019-09-22 22:23:15.235 | +---------+---------+-------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  Cuando se utiliza la inicializaci√≥n autom√°tica y la actualizaci√≥n autom√°tica de columnas TIMESTAMP utilizando una estructura del formulario <code>DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</code> es importante que los valores tengan la misma precisi√≥n que la columna misma: </p><br><pre> <code class="sql hljs">Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">updated</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>; ERROR 1067 (42000): Invalid default value for 'updated' Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">updated</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>); ERROR 1067 (42000): Invalid default value for 'updated' Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">updated</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); Query OK, 0 rows affected (0.07 sec) Records: 0 Duplicates: 0 Warnings: 0 Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> last_message_send_time=<span class="hljs-string"><span class="hljs-string">'2019-09-22 22:22:22'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> chat_id=<span class="hljs-number"><span class="hljs-number">1</span></span>; Query OK, 0 rows affected (0.00 sec) Rows matched: 1 Changed: 0 Warnings: 0 Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ChatContactsList; +<span class="hljs-comment"><span class="hljs-comment">---------+---------+-------------------------+-------------------------+ | chat_id | title | last_message_send_time | updated | +---------+---------+-------------------------+-------------------------+ | 1 | Chat #1 | 2019-09-22 22:22:22.000 | 2019-09-22 22:26:39.968 | +---------+---------+-------------------------+-------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  Las funciones de MySQL para trabajar con el tiempo permiten trabajar con la parte fraccionaria de unidades de medida.  No los enumerar√© a todos (sugiero buscar en la documentaci√≥n), pero dar√© algunos ejemplos: </p><br><pre> <code class="sql hljs">Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-number"><span class="hljs-number">7.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SECOND</span></span>; +<span class="hljs-comment"><span class="hljs-comment">------------------------+--------------------------+------------------------------+ | NOW(2) | NOW(4) | NOW(4) + INTERVAL 7.5 SECOND | +------------------------+--------------------------+------------------------------+ | 2019-09-22 21:12:23.31 | 2019-09-22 21:12:23.3194 | 2019-09-22 21:12:30.8194 | +------------------------+--------------------------+------------------------------+ 1 row in set (0.00 sec) Test&gt; SELECT SUBTIME(CURRENT_TIME(6), CURRENT_TIME(3)), CURRENT_TIME(6), CURRENT_TIME(3); +-------------------------------------------+-----------------+-----------------+ | SUBTIME(CURRENT_TIME(6), CURRENT_TIME(3)) | CURRENT_TIME(6) | CURRENT_TIME(3) | +-------------------------------------------+-----------------+-----------------+ | 00:00:00.000712 | 21:12:50.793712 | 21:12:50.793 | +-------------------------------------------+-----------------+-----------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  El principal problema asociado con el uso de la parte fraccional de segundos en las consultas SQL es la inconsistencia de precisi√≥n en las comparaciones ( <code>&gt;</code> , <code>&lt;</code> , <code>BETWEEN</code> ).  Puede encontrarlo si los datos en la base de datos tienen una precisi√≥n y en las consultas, otra.  Aqu√≠ hay un peque√±o ejemplo que ilustra este problema: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">#         Test&gt; INSERT INTO ChatContactsList (title, last_message_send_time) VALUES ('Chat #2', '2019-09-22 21:16:39.123456'); Query OK, 0 row affected (0.00 sec) Test&gt; SELECT chat_id, title, last_message_send_time FROM ChatContactsList WHERE title='Chat #2'; +---------+---------+-------------------------+ | chat_id | title | last_message_send_time | +---------+---------+-------------------------+ | 2 | Chat #2 | 2019-09-22 21:16:39.123 | &lt;-     - ,    +---------+---------+-------------------------+ 1 row in set (0.00 sec) Test&gt; SELECT title, last_message_send_time FROM ChatContactsList WHERE last_message_send_time &gt;= '2019-09-22 21:16:39.123456'; &lt;-    ,    INSERT- +---------+-------------------------+ | title | last_message_send_time | +---------+-------------------------+ | Chat #1 | 2019-09-22 22:22:22.000 | +---------+-------------------------+ 1 row in set (0.00 sec) &lt;- Chat #2   - ,     ,    </span></span></code> </pre> <br><p>  En este ejemplo, la precisi√≥n de los valores en la consulta es mayor que la precisi√≥n de los valores en la base de datos, y el problema ocurre "en el borde desde arriba".  En la situaci√≥n opuesta (si el valor de entrada tiene una precisi√≥n menor que el valor en la base de datos) no habr√° problema: MySQL llevar√° el valor a la precisi√≥n deseada tanto en INSERT como en SELECT: </p><br><pre> <code class="sql hljs">Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ChatContactsList (title, last_message_send_time) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Chat #3'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-09-03 21:20:19.1'</span></span>); Query OK, 1 row affected (0.00 sec) Test&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> title, last_message_send_time <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> last_message_send_time &lt;= <span class="hljs-string"><span class="hljs-string">'2019-09-03 21:20:19.1'</span></span>; +<span class="hljs-comment"><span class="hljs-comment">---------+-------------------------+ | title | last_message_send_time | +---------+-------------------------+ | Chat #3 | 2019-09-03 21:20:19.100 | +---------+-------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  La consistencia de la precisi√≥n de los valores siempre debe tenerse en cuenta cuando se trabaja con tiempos de alta precisi√≥n.  Si tales problemas de l√≠mites son cr√≠ticos para usted, entonces debe asegurarse de que el c√≥digo y la base de datos funcionen con el mismo n√∫mero de decimales. </p><br><div class="spoiler">  <b class="spoiler_title">Reflexiones sobre c√≥mo elegir la precisi√≥n en columnas con partes fraccionarias de segundos</b> <div class="spoiler_text"><p>  La cantidad de espacio ocupado por la parte fraccionaria de una unidad de tiempo depende del n√∫mero de caracteres en la columna.  Parece natural elegir significados familiares: tres o seis decimales.  Pero en el caso de tres personajes, no es tan simple.  De hecho, MySQL usa un byte para almacenar dos lugares decimales: </p><br><blockquote><div class="scrollable-table"><table><thead><tr><th>  Precisi√≥n de segundos fraccionarios </th><th>  Requisitos de almacenamiento </th></tr></thead><tbody><tr><td>  0 0 </td><td>  0 bytes </td></tr><tr><td>  1, 2 </td><td>  1 byte </td></tr><tr><td>  3, 4 </td><td>  2 bytes </td></tr><tr><td>  5, 6 </td><td>  3 bytes </td></tr></tbody></table></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Requisitos de almacenamiento de tipo de fecha y hora</a> </blockquote><p>  Resulta que si selecciona tres lugares decimales, entonces no est√° utilizando completamente el espacio ocupado y para la misma sobrecarga podr√≠a tomar cuatro caracteres.  En general, le recomiendo que siempre use un n√∫mero par de caracteres y, si es necesario, "recorte" los innecesarios al imprimir.  La opci√≥n ideal es no ser codicioso y tomar seis decimales.  En el peor de los casos (con el tipo DATETIME), esta columna ocupar√° 8 bytes, es decir, el mismo n√∫mero entero en la columna BIGINT. </p></div></div><br><p>  Ver tambi√©n: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Segundos fraccionarios en valores de tiempo"</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Inicializaci√≥n y actualizaci√≥n autom√°ticas para TIMESTAMP y DATETIME"</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Funciones de fecha y hora"</a> . </li></ul><br><h2 id="rabota-so-vremenem-vysokoy-tochnosti-v-php">  Trabaja con tiempo de alta precisi√≥n en PHP </h2><br><p>  No es suficiente tener un tiempo de alta precisi√≥n en la base de datos; debe poder trabajar con √©l en el c√≥digo de sus programas.  En esta secci√≥n hablar√© sobre tres puntos principales: </p><br><ol><li>  Tiempo de recepci√≥n y formateo: explicar√© c√≥mo obtener la marca de tiempo antes de colocarla en la base de datos, obtenerla desde all√≠ y hacer alg√∫n tipo de manipulaci√≥n. </li><li>  Trabajar con tiempo en PDO: le mostrar√© un ejemplo de c√≥mo PHP admite el formato de tiempo en una biblioteca de base de datos. </li><li>  Trabajar con el tiempo en marcos: hablar√© sobre el uso del tiempo en las migraciones para cambiar la estructura de la base de datos. </li></ol><br><h3 id="poluchenie-i-formatirovanie-vremeni">  Obtener y formatear el tiempo </h3><br><p>  Al trabajar con tiempo, hay varias operaciones b√°sicas que debe poder realizar: </p><br><ul><li>  obtener el punto actual en el tiempo; </li><li>  obteniendo un momento en el tiempo de alguna cadena formateada; </li><li>  agregar un per√≠odo a un punto en el tiempo (o restar un per√≠odo); </li><li>  obteniendo una cadena formateada por un punto en el tiempo. </li></ul><br><p>  En esta parte, te dir√© qu√© posibilidades hay de realizar estas operaciones en PHP. </p><br><p>  La primera forma es trabajar con <strong>una marca de tiempo como n√∫mero</strong> .  En este caso, en el c√≥digo PHP trabajamos con variables num√©ricas, que operamos a trav√©s de funciones como <code>time</code> , <code>date</code> , tiempo de <code>strtotime</code> .  Este m√©todo no puede utilizarse para trabajar con tiempo de alta precisi√≥n, ya que en todas estas funciones las marcas de tiempo son un n√∫mero entero (lo que significa que se perder√° la parte fraccionaria en ellas). </p><br><p>  Estas son las firmas de las principales funciones de la documentaci√≥n oficial: </p><br><blockquote> <code>time ( void ) : int</code> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.php.net/manual/ru/function.time.php</a> <br><br> <code>strtotime ( string $time [, int $now = time() ] ) : int</code> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://php.net/manual/ru/function.strtotime.php</a> <br><br> <code>date ( string $format [, int $timestamp = time() ] ) : string</code> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://php.net/manual/ru/function.date.php</a> <br><br> <code>strftime ( string $format [, int $timestamp = time() ] ) : string</code> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.php.net/manual/ru/function.strftime.php</a> </blockquote><br><div class="spoiler">  <b class="spoiler_title">Un punto interesante sobre la funci√≥n de fecha</b> <div class="spoiler_text"><p>  Aunque es imposible pasar la parte fraccional de un segundo a la entrada de estas funciones, en la l√≠nea de la plantilla de formato pasada a la entrada de la funci√≥n de <code>date</code> , puede configurar caracteres para mostrar milisegundos y microsegundos.  Al formatear, los ceros siempre se devolver√°n en su lugar. </p><br><div class="scrollable-table"><table><thead><tr><th>  Car√°cter en formato de cadena </th><th>  Descripci√≥n </th><th>  Ejemplo de valor de retorno </th></tr></thead><tbody><tr><td>  tu </td><td>  Microsegundos (agregado en PHP 5.2.2).  Tenga en cuenta que date () siempre devolver√° 000000, como  toma un par√°metro entero, mientras que DateTime :: format () admite microsegundos si DateTime se crea con ellos. </td><td>  Por ejemplo: 654321 </td></tr><tr><td>  v </td><td>  Milisegundos (agregado en PHP 7.0.0).  La observaci√≥n es la misma que para ti. </td><td>  Por ejemplo: 654 </td></tr></tbody></table></div><br><p>  Un ejemplo: </p><br><pre> <code class="php hljs">$now = time(); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> date(<span class="hljs-string"><span class="hljs-string">'Ymd H:i:s.u'</span></span>, $now); <span class="hljs-comment"><span class="hljs-comment">// 2019-09-11 21:27:18.000000 print date('Ymd H:i:s.v', $now); // 2019-09-11 21:27:18.000</span></span></code> </pre> </div></div><br><p>  Adem√°s, este m√©todo incluye las <code>hrtime</code> <code>microtime</code> y <code>hrtime</code> , que le permiten obtener una <code>hrtime</code> tiempo con una parte fraccional para el momento actual.  El problema es que no hay una forma lista para formatear una etiqueta y obtenerla de una cadena de un formato espec√≠fico.  Esto se puede resolver implementando independientemente estas funciones, pero no considerar√© esa opci√≥n. </p><br><blockquote>  Si necesita trabajar solo con temporizadores, la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HRTime</a> es una buena opci√≥n, que no considerar√© con m√°s detalle debido a las limitaciones de su uso.  Solo puedo decir que le permite trabajar con tiempo hasta el nanosegundo y garantiza la monoton√≠a de los temporizadores, lo que elimina algunos de los problemas que pueden surgir al trabajar con otras bibliotecas. </blockquote><p>  Para trabajar completamente con partes fraccionarias de un segundo, debe usar el m√≥dulo <strong>DateTime</strong> .  Con ciertas reservas, le permite realizar todas las operaciones enumeradas anteriormente: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    : $time = new \DateTimeImmutable(); //      : $time = new \DateTimeImmutable('2019-09-12 21:32:43.908502'); $time = \DateTimeImmutable::createFromFormat('Ymd H:i:s.u', '2019-09-12 21:32:43.9085'); // / : $period = \DateInterval::createFromDateString('5 seconds'); $timeBefore = $time-&gt;add($period); $timeAfter = $time-&gt;sub($period); //      : print $time-&gt;format('Ymd H:i:s.v'); // '2019-09-12 21:32:43.908' print $time-&gt;format("Ymd H:i:su"); // '2019-09-12 21:32:43.908502'</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">El punto no obvio cuando se usa `DateTimeImmutable :: createFromFormat`</b> <div class="spoiler_text"><p>  La letra <code>u</code> en la cadena de formato significa microsegundos, pero tambi√©n funciona correctamente en el caso de partes fraccionarias de menor precisi√≥n.  Adem√°s, esta es la √∫nica forma de especificar partes fraccionarias de un segundo en una cadena de formato.  Un ejemplo: </p><br><pre> <code class="php hljs">$time = \DateTimeImmutable::createFromFormat(<span class="hljs-string"><span class="hljs-string">'Ymd H:i:s.u'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-09-12 21:32:43.9085'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt;   DateTimeImmutable    2019-09-12 21:32:43.908500 $time = \DateTimeImmutable::createFromFormat('Ymd H:i:s.u', '2019-09-12 21:32:43.90'); // =&gt;   DateTimeImmutable    2019-09-12 21:32:43.900000 $time = \DateTimeImmutable::createFromFormat('Ymd H:i:s.u', '2019-09-12 21:32:43'); // =&gt;  false</span></span></code> </pre> </div></div><br><p>  El principal problema de este m√≥dulo es el inconveniente al trabajar con intervalos que contienen segundos fraccionarios (o incluso la imposibilidad de dicho trabajo).  La <code>\DateInterval</code> aunque contiene la parte fraccionaria de un segundo exacto a los mismos seis decimales, solo puede inicializar esta parte fraccional a trav√©s de <code>DateTime::diff</code> .  El constructor de la clase DateInterval y el m√©todo de f√°brica <code>\DateInterval::createFromDateString</code> solo pueden funcionar con segundos completos y no permiten especificar la parte fraccional: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     -   $buggyPeriod1 = new \DateInterval('PT7.500S'); //       ,    $buggyPeriod2 = \DateInterval::createFromDateString('2 minutes 7.5 seconds'); print $buggyPeriod2-&gt;format('%R%H:%I:%S.%F') . PHP_EOL; //  "+00:02:00.000000"</span></span></code> </pre> <br><p>  Otro problema puede surgir al calcular la diferencia entre dos puntos en el tiempo usando el m√©todo <code>\DateTimeImmutable::diff</code> .  En PHP anterior a la versi√≥n 7.2.12, hab√≠a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">error</a> debido al cual las partes fraccionarias de un segundo exist√≠an por separado de otros d√≠gitos y pod√≠an recibir su propio signo: </p><br><pre> <code class="php hljs">$timeBefore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTimeImmutable(<span class="hljs-string"><span class="hljs-string">'2019-09-12 21:20:19.987654'</span></span>); $timeAfter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTimeImmutable(<span class="hljs-string"><span class="hljs-string">'2019-09-14 12:13:14.123456'</span></span>); $diff = $timeBefore-&gt;diff($timeAfter); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $diff-&gt;format(<span class="hljs-string"><span class="hljs-string">'%R%a days %H:%I:%S.%F'</span></span>) . PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">//  PHP  7.2.12+   "+1 days 14:52:54.135802" //       "+1 days 14:52:55.-864198"</span></span></code> </pre> <br><p>  En general, le aconsejo que tenga cuidado al trabajar con intervalos y cubra cuidadosamente dicho c√≥digo con pruebas. </p><br><p>  Ver tambi√©n: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Fecha y hora"</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Funci√≥n hrtime".</a> </li></ul><br><h3 id="rabota-so-vremenem-vysokoy-tochnosti-v-pdo">  Trabaja con tiempo de alta precisi√≥n en DOP </h3><br><p>  PDO y mysqli son las dos interfaces principales para consultar bases de datos MySQL desde c√≥digo PHP.  En el contexto de una conversaci√≥n sobre el tiempo, son similares entre s√≠, por lo que solo hablar√© de uno de ellos: DOP. </p><br><p>  Cuando se trabaja con bases de datos en PDO, el tiempo aparece en dos lugares: </p><br><ul><li>  como un par√°metro pasado a consultas ejecutadas; </li><li>  como un valor que viene en respuesta a consultas SELECT. </li></ul><br><p>  Es una buena pr√°ctica pasar marcadores de posici√≥n al pasar par√°metros a la solicitud.  Los marcadores de posici√≥n pueden transferir valores desde un conjunto muy peque√±o de tipos: valores booleanos, cadenas y enteros.  No hay un tipo adecuado para la fecha y la hora, por lo que debe convertir manualmente el valor de un objeto de la clase DateTime / DateTimeImmutable en una cadena. </p><br><pre> <code class="php hljs">$now = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTimeImmutable(); $db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PDO(<span class="hljs-string"><span class="hljs-string">'mysql:...'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>, [\PDO::ATTR_ERRMODE =&gt; \PDO::ERRMODE_EXCEPTION]); $stmt = $db-&gt;prepare(<span class="hljs-string"><span class="hljs-string">'INSERT INTO Test.ChatContactsList (title, last_message_send_time) VALUES (:title, :date)'</span></span>); $result = $stmt-&gt;execute([<span class="hljs-string"><span class="hljs-string">':title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Test #1"</span></span>, <span class="hljs-string"><span class="hljs-string">':date'</span></span> =&gt; $now-&gt;format(<span class="hljs-string"><span class="hljs-string">'Ymd H:i:s.u'</span></span>)]);</code> </pre> <br><p>  Usar dicho c√≥digo no es muy conveniente, ya que cada vez que necesita formatear el valor transmitido.  Por lo tanto, en la base de c√≥digo de Badoo, implementamos soporte para marcadores de posici√≥n escritos en nuestro contenedor para trabajar con la base de datos.  En el caso de las fechas, esto es muy conveniente, ya que le permite transferir un valor en diferentes formatos (un objeto que implementa DateTimeInterface, una cadena formateada o un n√∫mero con una marca de tiempo), y todas las transformaciones y comprobaciones necesarias de la correcci√≥n de los valores transferidos ya se realizan dentro.  Como beneficio adicional, al transferir un valor incorrecto, aprendemos sobre el error inmediatamente, y no despu√©s de recibir un error de MySQL al ejecutar la consulta. </p><br><p>  Recuperar datos de los resultados de la consulta parece bastante simple.  Al realizar esta operaci√≥n, PDO devuelve los datos en forma de cadenas, y en el c√≥digo necesitamos procesar a√∫n m√°s los resultados si queremos trabajar con objetos de tiempo (y aqu√≠ necesitamos la funcionalidad para obtener el tiempo de la cadena formateada, de la que habl√© en la secci√≥n anterior). </p><br><pre> <code class="php hljs">$stmt = $db-&gt;prepare(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM Test.ChatContactsList ORDER BY last_message_send_time DESC, chat_id DESC LIMIT 5'</span></span>); $stmt-&gt;execute(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)) { $row[<span class="hljs-string"><span class="hljs-string">'last_message_send_time'</span></span>] = is_null($row[<span class="hljs-string"><span class="hljs-string">'last_message_send_time'</span></span>]) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTimeImmutable($row[<span class="hljs-string"><span class="hljs-string">'last_message_send_time'</span></span>]); <span class="hljs-comment"><span class="hljs-comment">//  -  }</span></span></code> </pre> <br><blockquote>  Nota <br><br>  El hecho de que PDO devuelva datos como cadenas no es del todo cierto.  Al recibir valores, es posible establecer el tipo de valor para la columna utilizando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>PDOStatement::bindColumn</code></a> .  No habl√© sobre esto porque hay el mismo conjunto limitado de tipos que no ayuda con las fechas. </blockquote><p>  Desafortunadamente, hay un problema a tener en cuenta.  En PHP anterior a la versi√≥n 7.3, hay un error debido al cual PDO, cuando el atributo <code>PDO::ATTR_EMULATE_PREPARES</code> est√° <code>PDO::ATTR_EMULATE_PREPARES</code> "corta" la parte fraccional de un segundo cuando se recibe de la base de datos.  Se pueden encontrar detalles y un ejemplo en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci√≥n</a> del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">error en php.net</a> .  En PHP 7.3, este error se corrigi√≥ y advirti√≥ que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este cambio rompe la compatibilidad con versiones anteriores</a> . </p><br><p>  Si est√° utilizando PHP versi√≥n 7.2 o anterior y no puede actualizarlo o habilitar <code>PDO::ATTR_EMULATE_PREPARES</code> , puede <code>PDO::ATTR_EMULATE_PREPARES</code> este error corrigiendo las consultas SQL que devuelven el tiempo con una parte fraccionaria para que esta columna tenga un tipo de cadena.  Esto se puede hacer, por ejemplo, as√≠: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *, <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(last_message_send_time <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> last_message_send_time_fixed <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ChatContactsList <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> last_message_send_time <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  Este problema tambi√©n se puede encontrar al trabajar con el m√≥dulo <code>mysqli</code> : si usa consultas preparadas a trav√©s de una llamada al m√©todo <code>mysqli::prepare</code> , entonces en PHP anterior a la versi√≥n 7.3, no se devolver√° la parte fraccional de un segundo.  Al igual que con PDO, puede solucionar esto actualizando PHP o evitando la conversi√≥n de tiempo a un tipo de cadena. </p><br><p>  Ver tambi√©n: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Consultas preparadas y procedimientos almacenados en DOP"</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Consultas preparadas en mysqli"</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n sobre el m√©todo mysqli_stmt :: bind_param</a> (aqu√≠ se describen los tipos de marcadores de posici√≥n admitidos en mysqli); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Solicitud de agrupaci√≥n a PHP, en la que arreglaron el "truncamiento" de la parte fraccional de segundos</a> . </li></ul><br><h3 id="rabota-so-vremenem-vysokoy-tochnosti-v-yii-2">  Trabaja con tiempo de alta precisi√≥n en Yii 2 </h3><br><p>  La mayor√≠a de los marcos modernos proporcionan una funcionalidad de migraci√≥n que le permite almacenar el historial de cambios en el esquema de la base de datos en el c√≥digo y cambiarlo gradualmente.  Si usa migraciones y desea usar un tiempo de alta precisi√≥n, entonces su marco deber√≠a admitirlo.  Afortunadamente, esto funciona fuera de la caja en todos los marcos principales. </p><br><p>  En esta secci√≥n, mostrar√© c√≥mo se implementa este soporte en Yii (en los ejemplos utilic√© la versi√≥n 2.0.26).  Sobre Laravel, Symfony y otros, no escribir√© para no hacer que el art√≠culo sea interminable, pero me alegrar√° si agrega detalles en los comentarios o nuevos art√≠culos sobre este tema. </p><br><p>  En la migraci√≥n, escribimos c√≥digo que describe los cambios en el esquema de datos.  Al crear una nueva tabla, describimos todas sus columnas utilizando m√©todos especiales de la clase \ yii \ db \ Migration (se declaran en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bandeja SchemaBuilderTrait</a> ).  Para la descripci√≥n de las columnas que contienen la fecha y la hora, los m√©todos de <code>datetime</code> , <code>datetime</code> y <code>datetime</code> son responsables, lo que puede tomar un valor de entrada de precisi√≥n. </p><br><p>  Un ejemplo de una migraci√≥n en la que se crea una nueva tabla con una columna de tiempo de alta precisi√≥n: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">db</span></span>\<span class="hljs-title"><span class="hljs-title">Migration</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m190914_141123_create_news_table</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createTable(<span class="hljs-string"><span class="hljs-string">'news'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;primaryKey(), <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;string()-&gt;notNull(), <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;text(), <span class="hljs-string"><span class="hljs-string">'published'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;timestamp(<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-comment"><span class="hljs-comment">//     ]); } public function down() { $this-&gt;dropTable('news'); } }</span></span></code> </pre> <br><p>  Y este es un ejemplo de migraci√≥n en el que cambia la precisi√≥n en una columna existente: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m190916_045702_change_news_time_precision</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;alterColumn( <span class="hljs-string"><span class="hljs-string">'news'</span></span>, <span class="hljs-string"><span class="hljs-string">'published'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;timestamp(<span class="hljs-number"><span class="hljs-number">6</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;alterColumn( <span class="hljs-string"><span class="hljs-string">'news'</span></span>, <span class="hljs-string"><span class="hljs-string">'published'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;timestamp(<span class="hljs-number"><span class="hljs-number">3</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> <br><p>       ActiveRecord     -  :          ,         DateTime-.  ,     ‚Äî    ¬´¬ª      <code>PDO::ATTR_EMULATE_PREPARES</code> .   Yii    ,        .   ,       ,        PDO. </p><br><p> . : </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    Yii 2</a> ; </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  SchemaBuilderTrait</a> . </li></ul><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p> ,   ,     ‚Äî  ,     .                 ,    ,    . ,    ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469615/">https://habr.com/ru/post/469615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469599/index.html">Desarrollo de un motor 2D de desarrollo en WinForms</a></li>
<li><a href="../469605/index.html">El futuro del Li-Fi: polaritones, excitones, fotones y algo de disulfuro de tungsteno</a></li>
<li><a href="../469607/index.html">Conciencia humana ¬øNo se puede transferir la copia?</a></li>
<li><a href="../469609/index.html">Por favor estar en l√≠nea</a></li>
<li><a href="../469613/index.html">Sobre el sistema nacional de gesti√≥n de datos</a></li>
<li><a href="../469617/index.html">Destruye el monopolio de Estados Unidos en EDA. Innopolis da el primer paso</a></li>
<li><a href="../469619/index.html">Investigaci√≥n: si el comprador entiende que est√° hablando con el bot de chat, entonces la compra no tendr√° lugar</a></li>
<li><a href="../469623/index.html">GitLab 12.3 con firewall de aplicaciones web y an√°lisis de rendimiento</a></li>
<li><a href="../469625/index.html">C√≥mo recopilamos datos sobre campa√±as publicitarias de plataformas en l√≠nea (el camino espinoso hacia el producto)</a></li>
<li><a href="../469629/index.html">El √°tomo pac√≠fico no est√° en todos los hogares: opciones inesperadas para las fuentes de energ√≠a de radion√∫clidos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>