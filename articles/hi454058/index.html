<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП┐тАНЁЯМ╛ ЁЯТА ЁЯСиЁЯП╝тАНЁЯПл C # рдХреЛрдб рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЙрдкрдХрд░рдг ЁЯС╡ЁЯП╗ ЁЯСйЁЯП╜тАНЁЯФз ЁЯзЫЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдПрдХ рддреЗрдЬрд╝-рддрд░реНрд░рд╛рд░, рдмрдбрд╝реЗ рдФрд░ рдЬрдЯрд┐рд▓ рдЙрддреНрдкрд╛рдж рдореЗрдВ, рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЕрдбрд╝рдЪрдиреЗрдВ рдвреВрдВрдврдирд╛ рдЕрдм рдХреЛрдИ рдорд╛рдореВрд▓реА рдХрд╛рдо рдирд╣реАрдВ рд░рд╣ рдЧрдпрд╛ рд╣реИред рдмреЗрд╢рдХ, рдРрд╕реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C # рдХреЛрдб рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЙрдкрдХрд░рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/454058/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mg/wk/br/mgwkbr8kjbcbpm-eyyyo4izz74s.png"></div><br>  рдПрдХ рддреЗрдЬрд╝-рддрд░реНрд░рд╛рд░, рдмрдбрд╝реЗ рдФрд░ рдЬрдЯрд┐рд▓ рдЙрддреНрдкрд╛рдж рдореЗрдВ, рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЕрдбрд╝рдЪрдиреЗрдВ рдвреВрдВрдврдирд╛ рдЕрдм рдХреЛрдИ рдорд╛рдореВрд▓реА рдХрд╛рдо рдирд╣реАрдВ рд░рд╣ рдЧрдпрд╛ рд╣реИред  рдмреЗрд╢рдХ, рдРрд╕реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреЗрдВрдЪрдорд╛рд░реНрдХрдбреЙрдЯрдиреЗрдЯ</a> ред  рдирд┐рд╕реНрд╕рдВрджреЗрд╣, рдпрд╣ рдПрдХ рдЙрдкрдпреЛрдЧреА рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдЙрдкрдХрд░рдг рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред  рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдХреЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд╡рд┐рдзрд┐ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдорд╛рдкрдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдирд┐рдЬреА рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрджрд░ рдХреЛрдб рдХрд╛ рдХреБрдЫ рдЯреБрдХрдбрд╝рд╛ред  рдпрд╣рд╛рдВ, рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдореИрдВ рдирд╛рдорд┐рдд рдЯреВрд▓ рдХреА рдЖрд▓реЛрдЪрдирд╛ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдХреЛрдб рдЕрдВрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореИрдЯреНрд░рд┐рдХреНрд╕ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреЗ рдереЛрдбрд╝реЗ рдЕрд▓рдЧ рддрд░реАрдХреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред  рдмрд╣реБрдд рдЬрдЯрд┐рд▓, рднреНрд░рд╛рдордХ рддрд░реАрдХреЗ рд╣реИрдВ, рд╢рд╛рдЦрд╛рдУрдВ рдХреЗ рд╕рд╛рде, рдЫреЛрд░реЛрдВ рдХреЗ рд╕рд╛рде, рдЕрд╕рд╛рдзрд╛рд░рдг рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдирд╛, рдФрд░ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕реНрдерд╛рди рдХрд╣реАрдВ рдЕрдВрджрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕реЗ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рдмрд╣реБрддрд╛рдпрдд рд╕реЗ рдХрд╡рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдореМрдЬреВрджрд╛ рддрд░реНрдХ рдХреЛ рдЫреВрдиреЗ рдпрд╛ рдлрд┐рд░ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рдиреЗ рдХреА рд╕реНрдкрд╖реНрдЯ рдЗрдЪреНрдЫрд╛ рд╣реИред <br><a name="habracut"></a><br>  рдХреЛрдб рдЕрдиреБрднрд╛рдЧреЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк StopWatch рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдХреБрдЫ рдЗрд╕ рддрд░рд╣: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); sw.Start(); <span class="hljs-comment"><span class="hljs-comment">//   sw.Stop(); Console.WriteLine(sw.Elapsed); //  </span></span></code> </pre> <br>  рд╣рд░ рдмрд╛рд░ рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рд╕реНрдЯреЙрдкрд╡реЙрдЪ рдХреЛ рди рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдЙрдЪреНрдЪ-рдХреНрд░рдо рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдорд╛рдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LambdaMeter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> label, Action act</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); sw.Start(); act(); sw.Stop(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{label}</span></span></span><span class="hljs-string"> : </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{sw.Elapsed}</span></span></span><span class="hljs-string">"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br>  рдФрд░ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs">LambdaMeter(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// TODO something });</span></span></code> </pre><br>  рдЖрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрд▓ рдХреЛ рдЕрдВрджрд░ рдмрд╛рд╣рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TimeInspector</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Meter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Action act, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> label</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); sw.Start(); act(); sw.Stop(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{label}</span></span></span><span class="hljs-string"> : </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{sw.Elapsed}</span></span></span><span class="hljs-string">"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  рдФрд░ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Action(() =&gt; { <span class="hljs-comment"><span class="hljs-comment">// TODO something }).Meter("foo");</span></span></code> </pre><br>  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рд╣рд▓ рд╣реЛ рдЧрдИ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рдпрд╣ рддрдХрдиреАрдХ рдмреЗрд╣рдж рд╕реАрдорд┐рдд рд╣реИред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдорд╛рдкрд╛ рдХреЛрдб рдореЗрдВ рд░рд┐рдЯрд░реНрди рдЖрдЙрдЯрдкреБрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЗрд╕реЗ рдПрдХреНрд╢рди рдореЗрдВ рдирд╣реАрдВ рд▓рдкреЗрдЯ рд╕рдХрддреЗред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ Func рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рд╕рдорд╕реНрдпрд╛ рд╣рд▓ рдирд╣реАрдВ рд╣реЛрдЧреАред  рдиреАрдЪреЗ рдореИрдВ рдПрдХ рдРрд╕реА рддрдХрдиреАрдХ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдЬрд┐рд╕рдХрд╛ рдореИрдВрдиреЗ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛, рдпрд╣ рдХреЛрдб рдореЗрдВ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рдмрджрд▓рд╛рд╡реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЗ рдордирдорд╛рдиреЗ рд╡рд░реНрдЧреЛрдВ рдХреЛ рдорд╛рдкрдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░реЗрдЧрд╛ред  рд╣рдо рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЧрддрд┐ рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдФрд░ рдХреЙрдореНрдкреИрдХреНрдЯ рд▓реЙрдЧрд░ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ; рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдпрд╣ рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реНрдореГрддрд┐ рд▓реАрдХ рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ред  рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдб рдкреВрд░реНрдг рдФрд░ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╣реЛрдиреЗ рдХрд╛ рджрд╛рд╡рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдЙрд╕ рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдПрдХ рдкреНрд░рджрд░реНрд╢рди рд╣реИ рдЬрд┐рд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдФрд░ рдЖрд╕рд╛рди рдЙрдкрдХрд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХреЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЕрдзрд┐рдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдореИрдВ рдпрд╣ рднреА рдиреЛрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ рдиреАрдЪреЗ рджреА рдЧрдИ рдХреЛрдб рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХреА рдЧрдИ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА рдпрд╛ рд╣реЛрд╕реНрдЯ рдирд╛рдоред  рдпреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреБрдЫ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдореЗрд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рдереЗ рдФрд░ рдХреЗрд╡рд▓ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЬреЛ рдХреЛрдИ рднреА рдЕрдкрдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддрд╛ рд╣реИ, рдЙрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреЛрдб рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрддреНрдкрд╛рдж рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдЙрддреНрдкрд╛рдж рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рд╣реБрдЖред <br><br>  C # рдореЗрдВ рдПрдХ рдкреНрд░рд╕рд┐рджреНрдз рдФрд░ рдЙрдкрдпреЛрдЧреА рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рдЙрди рдкреНрд░рдХрд╛рд░реЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЖрдИрдбреАрд╕реЛрдкрд╛рдпрд░реА рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред  рдмрд┐рдВрджреБ рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рдЖрдк рдСрдкрд░реЗрдЯрд░ рдмреНрд▓реЙрдХ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╣реИрдВ, рддреЛ рдбрд┐рд╕реНрдкреЛрдЬрд╝ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ, рдЬрд┐рд╕рдореЗрдВ, рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рд╕рдВрд╕рд╛рдзрди рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рднрд┐рдиреНрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдмреНрд▓реЙрдХ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдХрд╛ рдПрдХ рдорд╛рдк рд╣реЛрдЧрд╛, рдЗрд╕рдХреЗ рдмрд╛рдж рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдХреЛ рдмрдЪрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╡рд░реНрдЧ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкреНрд░рдпреЛрдЧ рдмреНрд▓реЙрдХ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рдордп, рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рд╕реНрдЯреЙрдкрд╡реЙрдЪ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдЬрдм рдмреНрд▓реЙрдХ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдбрд┐рд╕реНрдкреЛрдЬрд╝ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкрд░рд┐рдгрд╛рдо рддрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд▓реЙрдЧ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдмреНрдЬреЗрдХреНрдЯ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХрдерди рд╡рд╛рдХреНрдпрдЧрдд рд╢рд░реНрдХрд░рд╛ рд╣реИ; рдЬрдм рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдХреЛрд╢рд┐рд╢-рдЕрдВрддрд┐рдо рдмреНрд▓реЙрдХ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЛрдб: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeDisposableClass()) { <span class="hljs-comment"><span class="hljs-comment">// TODO something }</span></span></code> </pre><br>  рдПрдХ рджреГрд╢реНрдп рдбрд┐рдЬрд╛рдЗрди рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд: <br><br><pre> <code class="cs hljs">IDisposable obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeDisposableClass(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// TODO something } finally { if (obj != null) { obj.Dispose(); } }</span></span></code> </pre><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдХреЛрд╢рд┐рд╢ рдмреНрд▓реЙрдХ рд╕реЗ рдХрд┐рд╕реА рднреА рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░, рдирд┐рдкрдЯрд╛рди рд╡рд┐рдзрд┐ рдХреА рдЧрд╛рд░рдВрдЯреА рджреА рдЬрд╛рдПрдЧреА рдФрд░ рддреБрд░рдВрдд рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрдмрдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд░рдЦрд╛ рдХреЛрдб рдХрд╛ рддрд░реНрдХ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ред  рд╣рдо рд╕рдм рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ рдПрдХ рдХреЙрд▓ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред  рдЗрд╕ рд╡рд┐рдЪрд╛рд░ рд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдд, рд╣рдо рд╕рдмрд╕реЗ рд╕рд░рд▓ рд░рдирдЯрд╛рдЗрдо рдХреЛрдорд╛рдИрдЬрд╝рд░ рдмрдирд╛рдПрдВрдЧреЗред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Meter</span></span> :<span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Stopwatch _sw; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _label; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Meter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Job</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lable</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Meter(lable); } Meter(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> label) { _label = label; _sw = Stopwatch.StartNew(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _sw.Stop(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_label}</span></span></span><span class="hljs-string"> : </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_sw.Elapsed}</span></span></span><span class="hljs-string">"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  рдФрд░ рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╣рдореЗрдВ рдХреНрдпрд╛ рджреЗрддрд╛ рд╣реИ? <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//       return static int Case0() { using (Meter.Job("case-0")) { return 1; } return 2; } //     yield return static IEnumerable&lt;string&gt; Case1() { yield return "one"; using (Meter.Job("case-1")) { yield return "two"; yield return "three"; } yield return "four"; } //     break static void Case2() { while (true) { using (Meter.Job("case-2")) { // todo something break; } } } //    switch    static int Case3(int @case) { using (Meter.Job("case-3")) { switch (@case) { case 1: using (Meter.Job($"case-3-{@case}")) { // todo something break; } case 2: using (Meter.Job($"case-3-{@case}")) { // todo something return @case; } } return @case; } } //       static void Case4() { try { using (Meter.Job($"case-4")) { // todo something throw new Exception(); } } catch (Exception e) { Console.WriteLine(e); } }</span></span></code> </pre><br>  рд╡рд░реНрдгрд┐рдд рддрдХрдиреАрдХ рдореЗрдВ рдХреНрдпрд╛ рдЧрд╛рдпрдм рд╣реИ?  рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд╡рд┐рд╖рдп рдХрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЦреБрд▓рд╛рд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕рд╛рдВрддреНрд╡рдирд╛ рдореЗрдВ рджрд░реНрдЬ рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рдордЭрджрд╛рд░реА рдирд╣реАрдВ рд╣реИред  рдЬреНрдпрд╛рджрд╛рддрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди <s>рдмрдиреНрд╕</s> рдФрд░ рдорд┐рдирд┐рдордо рдХреЙрдорд┐рдХреНрд╕ рдХреЗ рд╕рд╛рде рд▓реЛрдХрдкреНрд░рд┐рдп рд▓реЛрдХрдкреНрд░рд┐рдп рдЙрдкрдХрд░рдг NLog, Log4Net, Serilog рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдХрд╛рдлреА рд╕рдВрднрд╡ рд╣реИред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЧрдВрднреАрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЕрдзрд┐рдХ рдкрд░рд┐рд╖реНрдХреГрдд рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдХреА рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред <br><br>  рдЖрдк рдкрд░рд┐рдгрд╛рдо рдХреЛ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкрд╛рда рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдб рдХреЗ рдХрдИ рдЯреБрдХрдбрд╝реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╡реЗ рд╕рдВрднрд╡рдд: рдиреЗрд╕реНрдЯреЗрдб рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрдИ рд╕рдорд╛рдирд╛рдВрддрд░ рдзрд╛рдЧреЗред  рдЗрд╕рд▓рд┐рдП, рд▓реЙрдЧ рдХреЛ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рд╣рдо SQLite рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рд╣рдо рдПрдХ рд╡рд░реНрдЧ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╕рдордп рдХреЛ рдорд╛рдкрдиреЗ рдФрд░ рдмрд╛рдж рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogItem</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id; <span class="hljs-comment"><span class="hljs-comment">// Log item unique id public string Label; // User text labl public string Lid; // Log Id public string Method; // Method name public int Tid; // Thread Id public DateTime CallTime; // Start time public TimeSpan Elapsed; // Metering public long ElapsedMs; // Metering miliseconds public long ElapsedTicks; // Metering ticks private Stopwatch _sw; private Logger _cl; public LogItem(Logger cl, string method, string label) { Id = Guid.NewGuid().ToString("N"); _cl = cl; Lid = _cl.LId; Label = label; Method = method; Tid = Thread.CurrentThread.ManagedThreadId; CallTime = DateTime.Now; _sw = new Stopwatch(); _sw.Start(); } public void Dispose() { _sw.Stop(); Elapsed = _sw.Elapsed; ElapsedMs = _sw.ElapsedMilliseconds; ElapsedTicks = _sw.ElapsedTicks; _cl.WriteLog(this); } }</span></span></code> </pre><br>  рд▓рдХрдбрд╝рд╣рд╛рд░рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ LogItem рд╡рд░реНрдЧ рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдкреВрд░рд╛ рдирд╛рдо рдЬрд┐рд╕рдореЗрдВ рдорд╛рдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдордирдорд╛рдирд╛ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде рдПрдХ рд▓реЗрдмрд▓ рд╣реЛрддрд╛ рд╣реИред  рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рд▓реЙрдЧ рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, Tid (рдереНрд░реЗрдб рдЖрдИрдбреА) рдлрд╝реАрд▓реНрдб рдореЗрдВ рдорджрдж рдорд┐рд▓реЗрдЧреА, рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрдк рдПрдХ рдереНрд░реЗрдб рд╕реЗ рдбреЗрдЯрд╛ рд╕рдореВрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рд╛рде рд╣реА, LogItem рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рддреЗ рд╕рдордп, рдорд╛рдк рдкреНрд░рд╛рд░рдВрдн рд╕рдордп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ StopWatch рдкреНрд░рд╛рд░рдВрдн рд╣реЛрддрд╛ рд╣реИред  рдбрд┐рд╕реНрдкреЛрдЬрд╝ рд╡рд┐рдзрд┐ рдореЗрдВ, рд╕реНрдЯреЙрдкрд╡реЙрдЪ рдХреЛ рд░реЛрдХреЗрдВ рдФрд░ рд░рд╛рдЗрдЯрд▓реЙрдЧ рд▓реЙрдЧрд░ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ, рд╡рд░реНрддрдорд╛рди рд╢реВрдЯрд░ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдкрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рднреА рдЖрд╡рд╢реНрдпрдХ LogItem рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдареАрдХ рдХрд░реЗрдВред <br><br>  рд▓рдХрдбрд╝рд╣рд╛рд░реЗ рдХреЗ рдкрд╛рд╕ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рджреЛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╣реЛрддреЗ рд╣реИрдВ: рдПрдХ LogItem рдСрдмреНрдЬреЗрдХреНрдЯ рдЖрд░рдВрдн рдХрд░рдирд╛ рдФрд░ рдорд╛рдк рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдкрд░рд┐рдгрд╛рдо рд░рд┐рдХреЙрд░реНрдб рдХрд░рдирд╛ред  рдЪреВрдБрдХрд┐ рдореБрдЭреЗ рдЕрднреА рднреА рдкрд░рд┐рдгрд╛рдо рди рдХреЗрд╡рд▓ SQLite рдореЗрдВ, рдмрд▓реНрдХрд┐ SQLite рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд╡рд┐рднрд┐рдиреНрди рд╕реНрд╡рд░реВрдкреЛрдВ рдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕реЛрдВ рдХреА рдкрд╛рда рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рднреА рджрд░реНрдЬ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрдВрдЯрд░реИрдХреНрд╢рди рд▓реЙрдЬрд┐рдХ рдХреЛ рдПрдХ рдЕрд▓рдЧ рд╡рд░реНрдЧ рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред  рд▓рдХрдбрд╝рд╣рд╛рд░рд╛ рд╡рд░реНрдЧ рдореЗрдВ, рдХреЗрд╡рд▓ рд╕рд╛рдорд╛рдиреНрдп рд╣рд┐рд╕реНрд╕рд╛ рдмрдЪрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Logger</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LId; <span class="hljs-comment"><span class="hljs-comment">// Log id public string Login; // User login public int Pid; // Process Id public string App; // Application name public string Host; // Host name public string Ip; // Ip address private ConcurrentQueue&lt;dynamic&gt; queue; // Queue log items to save public Dictionary&lt;Type, Action&lt;dynamic&gt;&gt; LogDispatcher; // Different log objects handlers dispatcher public bool IsEnabled = true; public Logger(Dictionary&lt;Type, Action&lt;dynamic&gt;&gt; logDispatcher) { queue = new ConcurrentQueue&lt;dynamic&gt;(); LogDispatcher = logDispatcher; LId = Guid.NewGuid().ToString("N"); Login = WindowsIdentity.GetCurrent().Name; Host = Dns.GetHostName(); Ip = Dns.GetHostEntry(Host).AddressList.FirstOrDefault(f =&gt; f.AddressFamily == System.Net.Sockets.AddressFamily.InterNetwork)?.ToString(); var proc = Process.GetCurrentProcess(); Pid = proc.Id; App = proc.ProcessName; queue.Enqueue(this); // Save the starting of a new measurement new Thread(() =&gt; { // Dequeue and save loop dynamic logItem; while (true) { if (queue.TryDequeue(out logItem)) { var logT = logItem.GetType(); if (LogDispatcher.ContainsKey(logT)) { LogDispatcher[logT](logItem); } } else { Thread.Sleep(500); } }}) { IsBackground = true}.Start(); } public LogItem Watch(int level, string label = null) { return new LogItem(this, GetMethodFullName(level), label); } private static string GetMethodFullName(int level) { var t = new StackTrace().GetFrames()?[level].GetMethod(); if (t == null) return ""; var path = t.ReflectedType != null ? t.ReflectedType.FullName : "_"; return $"{path}.{t.Name}"; } public void WriteLog(LogItem li) { if (IsEnabled) { queue.Enqueue(li); } } }</span></span></code> </pre><br>  рдФрд░ рдЗрд╕рд▓рд┐рдП, рд▓рдХрдбрд╝рд╣рд╛рд░рд╛ рд╡рд░реНрдЧ рдордзреНрдпрд╡рд░реНрддреА рд╣реИ, рдЗрд╕рдХрд╛ рдХрд╛рд░реНрдп рдЙрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд▓реЙрдЧрд┐рдВрдЧ рд╢реБрд░реВ рдХреА рдЧрдИ рд╣реИред  рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧрд┐рди, рдорд╢реАрди рдХрд╛ рдирд╛рдо, рдиреЗрдЯрд╡рд░реНрдХ рдкрддрд╛ рдЖрдИрдбреА рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд╛рдо рд╣реИред  рдпрд╣ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬрдм рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдорд╢реАрди рдкрд░ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдХреЛ рдорд╛рдкрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддред  рд╡рд┐рд╕рдВрдЧрддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗред  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдкрд╛рдардХ рдЗрд╕ рдмрд╛рдд рд╕реЗ рд╕рд╣рдордд рд╣реЛрдВрдЧреЗ рдХрд┐ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдорд╛рдк рдХреЗ рджреМрд░рд╛рди рд▓рдХрдбрд╝рд╣рд╛рд░рд╛ рдХрд╛ рдорд╛рдкрд╛ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдкрд░ рдиреНрдпреВрдирддрдо рдкреНрд░рднрд╛рд╡ рдкрдбрд╝рддрд╛ рд╣реИред  рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕рд╣реЗрдЬрдирд╛ рдХрддрд╛рд░ рдореЗрдВ рдЬреЛрдбрд╝рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдкреГрд╖реНрдарднреВрдорд┐ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЧрддрд┐ рджреЗрддрд╛ рд╣реИ, рдкрд░рд┐рдгрд╛рдо рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ, рдлрд╝рд╛рдЗрд▓ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рдПрдХ рдЧрдВрднреАрд░ рдЦрд╛рдореА рд╣реИ, рдЕрдЧрд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд▓реЙрдЧрд┐рдВрдЧ рдЗрд╡реЗрдВрдЯ рд╣реИрдВ, рддреЛ рдХрддрд╛рд░ рдХреЛ рд╕реНрдкрд┐рди рдХрд░рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬреА рд╕реЗ рднрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЙрдкрд▓рдмреНрдз рд╕рднреА рдореЗрдореЛрд░реА рдХреЛ рдирд╣реАрдВ рд▓реЗрддрд╛ред  рд▓реЗрдХрд┐рди рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХреЛ рднрдбрд╝рдХрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрднреА рднреА рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╡рд┐рднрд┐рдиреНрди рд╡рд░реНрдЧреЛрдВ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдкреНрд░реЗрд╖рдг рдПрдХ рд╢рдмреНрджрдХреЛрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдВрдЬреА рдПрдХ рдкреНрд░рдХрд╛рд░ рд╣реИ, рдорд╛рди рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИред <br><br>  рд▓реЙрдЧрд┐рдВрдЧ рд╡рд░реНрдЧ рдХреЗ рд▓рд┐рдП, рдЬреЛ рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдирдЧреЗрдЯ рдкреИрдХреЗрдЬ System.Data / SQLite рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рдирд┐рд░реНрднрд░рддрд╛ рдХреЛ рд╕рдВрддреБрд╖реНрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SqliteLogger</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> HLTimeCall.Logger _iternalLogger; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _connectionString; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> dbLocker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SqliteLogger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitDb(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispatcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>&gt;&gt;(); dispatcher[<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(HLTimeCall.Logger)] = o =&gt; LogMainRecord(o); dispatcher[<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(HLTimeCall.LogItem)] = o =&gt; LogCall(o); _iternalLogger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HLTimeCall.Logger(dispatcher); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitDb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> databaseFile = <span class="hljs-string"><span class="hljs-string">"TimeCallLogs.db"</span></span>; _connectionString = <span class="hljs-string"><span class="hljs-string">$"Data Source = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Path.GetFullPath(databaseFile)}</span></span></span><span class="hljs-string">;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dbFileName = Path.GetFullPath(databaseFile); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.Exists(dbFileName)) { SQLiteConnection.CreateFile(dbFileName); Bootstrap(); } } <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> DbNames { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TMainRecord = <span class="hljs-string"><span class="hljs-string">"T_MAINRECORD"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TCalllog = <span class="hljs-string"><span class="hljs-string">"T_CALLLOG"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FLid = <span class="hljs-string"><span class="hljs-string">"LID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FLogin = <span class="hljs-string"><span class="hljs-string">"LOGIN"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FPid = <span class="hljs-string"><span class="hljs-string">"PID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FApp = <span class="hljs-string"><span class="hljs-string">"APP"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FHost = <span class="hljs-string"><span class="hljs-string">"HOST"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FIp = <span class="hljs-string"><span class="hljs-string">"IP"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FId = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FLabel = <span class="hljs-string"><span class="hljs-string">"LABEL"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FMethod = <span class="hljs-string"><span class="hljs-string">"METHOD"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FTid = <span class="hljs-string"><span class="hljs-string">"TID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FCallTime = <span class="hljs-string"><span class="hljs-string">"CALL_TIME"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FElapsed = <span class="hljs-string"><span class="hljs-string">"ELAPSED"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FElapsedMs = <span class="hljs-string"><span class="hljs-string">"ELAPSED_MS"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FElapsedTicks = <span class="hljs-string"><span class="hljs-string">"ELAPSED_TICKS"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (dbLocker) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = Connect()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = conn.CreateCommand()) { cmd.Transaction = conn.BeginTransaction(); cmd.CommandType = System.Data.CommandType.Text; cmd.CommandText = <span class="hljs-string"><span class="hljs-string">$"CREATE TABLE </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.TMainRecord}</span></span></span><span class="hljs-string"> (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string"> VARCHAR(45) PRIMARY KEY UNIQUE NOT NULL, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLogin}</span></span></span><span class="hljs-string"> VARCHAR(45), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FPid}</span></span></span><span class="hljs-string"> INTEGER, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FApp}</span></span></span><span class="hljs-string"> VARCHAR(45), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FHost}</span></span></span><span class="hljs-string"> VARCHAR(45), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FIp}</span></span></span><span class="hljs-string"> VARCHAR(45))"</span></span>; cmd.ExecuteNonQuery(); cmd.CommandText = <span class="hljs-string"><span class="hljs-string">$"CREATE TABLE </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.TCalllog}</span></span></span><span class="hljs-string"> (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FId}</span></span></span><span class="hljs-string"> VARCHAR(45) PRIMARY KEY UNIQUE NOT NULL, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLabel}</span></span></span><span class="hljs-string"> VARCHAR(45), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string"> VARCHAR(45) NOT NULL, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FMethod}</span></span></span><span class="hljs-string"> VARCHAR(150), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FTid}</span></span></span><span class="hljs-string"> VARCHAR(45), </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FCallTime}</span></span></span><span class="hljs-string"> DATETIME, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsed}</span></span></span><span class="hljs-string"> TIME, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedMs}</span></span></span><span class="hljs-string"> INTEGER, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedTicks}</span></span></span><span class="hljs-string"> INTEGER)"</span></span>; cmd.ExecuteNonQuery(); cmd.Transaction.Commit(); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> DbConnection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SQLiteConnection(_connectionString); conn.Open(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> conn; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HLTimeCall.<span class="hljs-function"><span class="hljs-function">LogItem </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> label = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _iternalLogger.Watch(<span class="hljs-number"><span class="hljs-number">3</span></span>, label); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateParameter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SQLiteParameter(key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ?? DBNull.Value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogMainRecord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HLTimeCall.Logger logItem</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (dbLocker) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = Connect()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = conn.CreateCommand()) { cmd.Transaction = conn.BeginTransaction(); cmd.CommandType = System.Data.CommandType.Text; cmd.Parameters.Add(CreateParameter(DbNames.FLid, logItem.LId)); cmd.Parameters.Add(CreateParameter(DbNames.FLogin, logItem.Login)); cmd.Parameters.Add(CreateParameter(DbNames.FPid, logItem.Pid)); cmd.Parameters.Add(CreateParameter(DbNames.FApp, logItem.App)); cmd.Parameters.Add(CreateParameter(DbNames.FHost, logItem.Host)); cmd.Parameters.Add(CreateParameter(DbNames.FIp, logItem.Ip)); cmd.CommandText = <span class="hljs-string"><span class="hljs-string">$"INSERT INTO </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.TMainRecord}</span></span></span><span class="hljs-string">(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLogin}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FPid}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FApp}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FHost}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FIp}</span></span></span><span class="hljs-string">)VALUES(:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLogin}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FPid}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FApp}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FHost}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FIp}</span></span></span><span class="hljs-string">)"</span></span>; cmd.ExecuteNonQuery(); cmd.Transaction.Commit(); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogCall</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HLTimeCall.LogItem logItem</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (dbLocker) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = Connect()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = conn.CreateCommand()) { cmd.Transaction = conn.BeginTransaction(); cmd.CommandType = System.Data.CommandType.Text; cmd.Parameters.Add(CreateParameter(DbNames.FId, logItem.Id)); cmd.Parameters.Add(CreateParameter(DbNames.FLabel, logItem.Label)); cmd.Parameters.Add(CreateParameter(DbNames.FLid, logItem.Lid)); cmd.Parameters.Add(CreateParameter(DbNames.FMethod, logItem.Method)); cmd.Parameters.Add(CreateParameter(DbNames.FTid, logItem.Tid)); cmd.Parameters.Add(CreateParameter(DbNames.FCallTime, logItem.CallTime)); cmd.Parameters.Add(CreateParameter(DbNames.FElapsed, logItem.Elapsed)); cmd.Parameters.Add(CreateParameter(DbNames.FElapsedMs, logItem.ElapsedMs)); cmd.Parameters.Add(CreateParameter(DbNames.FElapsedTicks, logItem.ElapsedTicks)); cmd.CommandText = <span class="hljs-string"><span class="hljs-string">$"INSERT INTO </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.TCalllog}</span></span></span><span class="hljs-string">(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FId}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLabel}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FMethod}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FTid}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FCallTime}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsed}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedMs}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedTicks}</span></span></span><span class="hljs-string">)VALUES(:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FId}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLabel}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FLid}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FMethod}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FTid}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FCallTime}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsed}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedMs}</span></span></span><span class="hljs-string">,:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{DbNames.FElapsedTicks}</span></span></span><span class="hljs-string">)"</span></span>; cmd.ExecuteNonQuery(); cmd.Transaction.Commit(); } } } } }</code> </pre><br>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдорд╛рдк рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SqliteLogger рд╡рд░реНрдЧ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рдЖрдкрдХреЛ рдЗрд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдХреЛрдб рдХреА рдЕрдзрд┐рдХ рд▓рд╛рдЗрдиреЗрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдкрд┐рдд рд╣реИрдВред  рдпрд╣рд╛рдВ рд╡рд░реНрдЧ рд▓рдХрдбрд╝рд╣рд╛рд░рд╛ рдмрдирд╛рдиреЗ рдХреЗ рддрдереНрдп рдХреЛ рд▓реЙрдЧ рдХрд░реЗрдЧрд╛ (рдпрд╣ рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИ), рдкрд░рд┐рдгрд╛рдо T_MAINRECORD рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╣рдо рддрд╛рд▓рд┐рдХрд╛ T_CALLLOG рдореЗрдВ рдорд╛рдк рдкрд░рд┐рдгрд╛рдо рднреА рд╕рд╣реЗрдЬреЗрдВрдЧреЗред  LogMainRecord рдФрд░ LogCall рддрд░реАрдХреЗ рдЗрди рджреЛ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ, рдЙрдирдХреЗ рд╕рдВрджрд░реНрдн рдбрд┐рд╕реНрдкреИрдЪрд░ рд╢рдмреНрджрдХреЛрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВред  LogItem рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╡реЙрдЪ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рдХреЗ рдкреНрд░рд╛рд░рдВрдн рдмреНрд▓реЙрдХ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cMeter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqliteLogger(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (cMeter.Watch(<span class="hljs-string"><span class="hljs-string">"   "</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">// TODO }</span></span></code> </pre><br>  рдЕрдм, рдЗрд╕ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╕рдВрджрд┐рдЧреНрдз рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдмреНрд▓реЙрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рджреЗрдВред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдпрд╣ рдПрдХрддреНрд░рд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╣реБрдЖ рд╣реИ, рдЬреЛ рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдХреА рдЬрдЧрд╣ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред  рдореИрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реВрдВ рдХрд┐ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреНрдпрд╛ рдПрдХрддреНрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ? <br><br>  рдЖрдкрдХрд╛ рдзреНрдпрд╛рди, рд╕реМрднрд╛рдЧреНрдп рдФрд░ рддреНрд╡рд░рд┐рдд рдХреЛрдб рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi454058/">https://habr.com/ru/post/hi454058/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi454044/index.html">IPad рдФрд░ iPhone рдкрд░ рд░рдЪрдирд╛рддреНрдордХрддрд╛</a></li>
<li><a href="../hi454046/index.html">рдкреНрд░реЗрд░рдгрд╛ред рдЦреБрдж рд╣реА рдХрд░ рд▓реЛ</a></li>
<li><a href="../hi454048/index.html">рдлрд┐рд░ рд╕реЗ, рдирд╛рдЧрд░рд┐рдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рдПрд╕рдЯреАрдПрд╕рдЖрдИ рдФрд░ рдПрдлрдПрд╕рдПрд╕рдкреА рдХреЛ рдХрд┐рдП рдЧрдП рд╣рдЬрд╛рд░реЛрдВ-рд╣рдЬрд╛рд░реЛрдВ рднреБрдЧрддрд╛рди рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЛрдореЗрди рдореЗрдВ рдереЗ</a></li>
<li><a href="../hi454052/index.html">"рдЖрд╣, рдорд╛рд▓рд┐рдХ, рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЯреЛрдкреА!" - рдкреНрд░рд╕реНрддреБрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдорд╛рд░реНрдЯ рд╣реЗрд▓рдореЗрдЯ</a></li>
<li><a href="../hi454056/index.html">рд╡рд┐рднрд┐рдиреНрди рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░реЛрдВ рдореЗрдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╕рдореВрд╣реЛрдВ рдХреЛ рдХреИрд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдП</a></li>
<li><a href="../hi454060/index.html">рдЧрддрд┐-рд╕реНрд╡рддрдВрддреНрд░ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╕рд░реНрдХрд┐рдЯ рдкрд░ рдПрдХ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдирдЬрд╝рд░</a></li>
<li><a href="../hi454062/index.html">рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдлреЛрди - рдПрдХ рд╕реНрд╡рд┐рд╕ рдЪрд╛рдХреВ рдХреА рддрд░рд╣: рдЗрдиреНрд╡реЗрдВрдЯреНрд░реА рдХреЗ рд▓рд┐рдП, рдЪреИрдЯ, рд╕рдорд░реНрдерди рдХреЙрд▓ рдФрд░ рдкреВрдЫрддрд╛рдЫ</a></li>
<li><a href="../hi454064/index.html">рдПрдЕрд░ рдЗрдВрдбрд┐рдпрд╛ рдХреА рдЕрдирдХрд╣реА рдХрд╣рд╛рдиреА</a></li>
<li><a href="../hi454066/index.html">рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреВрд▓рдиреЗ рдХреЛ рдХреИрд╕реЗ рд░реЛрдХреЗрдВ рдФрд░ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЬрдирд╛ рдХреА рдЬрд╛рдВрдЪ рд╢реБрд░реВ рдХрд░реЗрдВ</a></li>
<li><a href="../hi454070/index.html">рдЖрдиреЗ-рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореЛрдиреЛрд╡рд╛рд▓ рдЪреБрдирдирд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>