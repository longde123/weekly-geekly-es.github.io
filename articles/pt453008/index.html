<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéè ü•Ä üß° De volta ao futuro com o WebAssembly üéóÔ∏è üò® üßôüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Apresento a voc√™ a tradu√ß√£o do artigo "De Volta ao Futuro com o WebAssembly", de Attila V√°g√≥. 

 Esta postagem √© uma tradu√ß√£o de um artigo q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>De volta ao futuro com o WebAssembly</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453008/">  Ol√° Habr!  Apresento a voc√™ a tradu√ß√£o do artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"De Volta ao Futuro com o WebAssembly",</a> de Attila V√°g√≥. <br><br><h4>  Esta postagem √© uma tradu√ß√£o de um artigo que fala sobre as propriedades do WebAssemly e Emscripten.  Artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://">original</a> em ingl√™s. </h4><br>  <i>A autora do artigo, Attila Vago, √© desenvolvedora de software s√™nior da HMH.</i>  <i>Escreve c√≥digo, blogs e outras coisas na Internet.</i>  <i>Uma poliglota de linguagens de programa√ß√£o, uma figura pragm√°tica, apaixonada por JavaScript e de f√°cil acesso.</i>  <i>Pessoa facilmente inspirada e inspiradora, com uma forte depend√™ncia de coisas para nerds, boa comida, cerveja artesanal e Lego.</i>  <i>Usado pelo Mac.</i>  <i>Ele se exercita √†s 6 da manh√£.</i> <br><br><p>  Em 2011, escrevi minha primeira linha independente de c√≥digo n√£o HTML (trabalhei com ele em 2007) e foi escrita no muito bom e velho C ensinado pelo professor David J. Malan da Universidade de Harvard.  Ele permanecer√° para sempre minha inspira√ß√£o n√£o apenas para o estudo da programa√ß√£o, mas tamb√©m para o pensamento sobre software.  Tamb√©m me lembrei de que fazer um sandu√≠che de manteiga de amendoim √© apenas para mim, mas √© uma tarefa incrivelmente dif√≠cil para um computador e igualmente dif√≠cil para uma pessoa que finge ser um computador. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wEdvGqxafq8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><p>  Se voc√™ assistiu ao v√≠deo, pelo menos nos primeiros 18 minutos (eu sei que leva muito tempo, mas a programa√ß√£o leva tempo), ent√£o voc√™ entender√° por que at√© hoje C est√° perto do meu cora√ß√£o.  Para minha decep√ß√£o, nunca aprendi isso, porque, convenhamos, para um desenvolvedor web, C √© a menor das prioridades.  Eu nunca tive um motivo real para me aprofundar nesse idioma, apesar de comprar in√∫meros cursos da Udemy e livros em C, nunca os toquei (mantenha seu olhar cr√≠tico para voc√™, voc√™ tamb√©m) ou minta para mim mesmo que, se eu comprar smart watch Pebble, que funciona em C, n√£o deixe de escrever um c√≥digo para eles.  Sim, com certeza!  Nenhuma dessas raz√µes foi boa o suficiente. </p><br><h4>  O que √© o WebAssembly e como ele supera o JS? </h4><br><p>  O WebAssembly (Wasm para abreviar) √© um formato de instru√ß√£o bin√°rio para uma m√°quina virtual empilhada. </p><blockquote>  ‚ÄúO Wasm foi desenvolvido como uma plataforma port√°til para compilar linguagens de alto n√≠vel, como C / C ++ / Rust, que permite implantar aplicativos de cliente e servidor na Internet‚Äù </blockquote>  - gentilmente explica webassembly.org <p></p><br><p>  Em outras palavras, o que precede significa que voc√™ pode escrever m√≥dulos que funcionam na Internet em um navegador / servidor, mas s√£o escritos em linguagens como C, compiladas em um arquivo bin√°rio e, portanto, incrivelmente r√°pido, porque funcionam diretamente no hardware da m√°quina.  Comparadas a elas, linguagens de script como JavaScript t√™m v√°rios n√≠veis de abstra√ß√£o entre c√≥digo e hardware, o que, entre outras coisas, as torna lentas.  Obviamente, isso nem sempre importa, e cada um deles tem seu pr√≥prio lugar no programa ou mesmo no ecossistema da web. </p><br><p>  Com base nisso, o Wasm by structure (inicialmente) suporta apenas n√∫meros inteiros e de ponto flutuante, o que fornece grande poder de computa√ß√£o e, portanto, √© frequentemente usado para implementa√ß√µes do tipo canvas.  √â importante entender que o WebAssembly n√£o √© uma amea√ßa ao JavaScript - pelo menos ainda n√£o - e, como voc√™ ver√° mais adiante neste artigo, C e JavaScript podem realmente viver muito felizes no mesmo projeto e executar o c√≥digo um do outro.  Sim, algo assim. </p><br><br><h4>  Emscripten "cola" C e JS </h4><br><p>  Agora espere!  Eu sei o que estou dizendo.  Voc√™ n√£o pode dizer coisas como "executar C em JS e vice-versa" e esperar que o mundo n√£o reaja. Por mais estranho que pare√ßa, n√£o estou enganando. Acontece que o Emscripten √© uma cadeia de ferramentas para compilar no asm.js e no WebAssembly, projetado usando LLVM (meu Deus, aprendi metade dessas coisas ao digitar o texto do artigo), que permite executar C e C ++ na Internet na velocidade quase nativa, sem plug-ins. </p><br><p>  Bem, aqui est√° o que voc√™ precisa destacar disso para si mesmo.  O Emscripten ajuda a compilar o c√≥digo C no WebAssembly, fornecendo ferramentas adicionais para facilitar a carga do desenvolvedor no que diz respeito √† comunica√ß√£o entre os dois idiomas e ajuda a iniciar o Wasm em seu projeto da web.  O comando b√°sico de compila√ß√£o para o Emscripten √© o seguinte: </p><br><pre><code class="plaintext hljs">emcc lib/strings.c -s WASM=1 -o public/strings.js</code> </pre> <br>  Enquanto um comando n√£o b√°sico √© executado assim: <br><br><pre> <code class="plaintext hljs">emcc lib/imports.c -s WASM=1 -s EXPORTED_FUNCTIONS="['_getNum', '_main', '_getDoubleNum', '_greet']" -o public/imports.js</code> </pre> <br><p>  Configurar o Emscripten n√£o √© a coisa mais f√°cil, mas n√£o o lan√ßamento de um foguete.  A √∫nica coisa que complica a instala√ß√£o √© que ela tem muitas depend√™ncias como Python, Node, xCode, Git e cMake.  Todas as instru√ß√µes podem ser encontradas na p√°gina de instala√ß√£o e s√£o f√°ceis de seguir. <br>  Portanto, Emscripten: <br><br></p><ul><li>  √© uma √≥tima ferramenta para portabilidade, permitindo compilar projetos existentes escritos em C ou C ++ e execut√°-los em todos os navegadores modernos.  <i>Saia daqui, Internet Explorer!</i> </li><li>  √≥timo para APIs porque converte OpenGL em WebGL e permite que voc√™ use APIs familiares, como SDL ou diretamente HTML5.  <i>Ah sim!</i> </li><li>  E √© extremamente r√°pido: gra√ßas ao LLVM, Emscripten, asm.js e WebAssembly, o c√≥digo √© executado quase na sua pr√≥pria velocidade.  <i>Corra, coelho, corra!</i> <br></li></ul><p></p><br><p>  Nota: Voc√™ n√£o precisa do Emscripten para gerar o Wasm, pois todos os novos navegadores t√™m uma API para oferecer suporte ao Wasm na mesma janela, que executa o Emscripten como a camada superior, o que facilita a vida do desenvolvedor.  Por exemplo, o Emscripten ajustar√° a quantidade de mem√≥ria para voc√™, que pode ser entediante atrav√©s de C. </p><br><h4>  Exemplos ... exemplos est√£o por toda parte! </h4><br><p>  Voc√™ sabe, como se costuma dizer, <i>"uma linha de c√≥digo vale mais que mil palavras"</i> ; - OK, essa √© uma prerrogativa do narrador e tudo isso; portanto, sem mais delongas, vamos dar uma olhada em algum c√≥digo real.  Coment√°rio fora do t√≥pico: naquele dia, n√£o consegui superar a sintaxe C. N√£o compilou metade do tempo, porque meu c√≥digo seria inst√°vel.  E depois de oito anos, fico assim: <i>"Sim, parece JavaScript</i> . <i>"</i> </p><br><p>  Gente, se algu√©m come√ßa a ver o c√≥digo C no meu React, apenas me traga de volta √† realidade, ok? </p><br><p>  Um pouco fora de t√≥pico, aqui est√° o c√≥digo C atual: </p><br><img src="http://habrastorage.org/webt/ck/lg/et/cklgetgfjlx_kvbbco7_mfazc7w.png" alt="imagem"><br><br><p>  E, consequentemente, em JavaScript: </p><br><img src="http://habrastorage.org/webt/tt/co/wk/ttcowkhhzlmtmqlqgst67lulqbg.png" alt="imagem"><br><br><p>  OK, o que exatamente acontece nesses arquivos?  Na verdade, bastante, ent√£o vou listar. <br></p><ol><li>  √â importante entender que <b>main ()</b> , a menos que seja especificado de outra forma, sempre inicia primeiro e tamb√©m compila por padr√£o.  Se voc√™ deseja compilar outra fun√ß√£o, precisar√° defini-la especificamente no sinalizador da matriz <b>EXPORTED_FUNCTIONS</b> , conforme mostrado na se√ß√£o anterior. </li><li>  Voc√™ escreve seu c√≥digo C, como sempre, importando suas bibliotecas regulares, mas, al√©m disso, voc√™ obt√©m o a√ß√∫car sint√°tico do Emscripten, al√©m de mais m√©todos / fun√ß√µes do que com qualquer outra ferramenta. </li><li>  O arquivo <b>imports.js</b> (o nome √© arbitr√°rio, mas sempre o mesmo que o arquivo C) referenciado pelo HTML nada mais √© do que o Emscripten "cola", que √© gerado automaticamente na compila√ß√£o.  N√£o precisa se preocupar com isso, apenas verifique se ele est√° realmente relacionado. </li><li>  <b>Printf</b> √© apenas uma instru√ß√£o C comum que registra uma string no console.  Nada de especial, siga em frente. </li><li>  As linhas 14 e 17 s√£o um anti-padr√£o, mas um bom exemplo de execu√ß√£o de JS no seu c√≥digo C. A √∫nica diferen√ßa real entre <b>emscripten_run_script</b> e <b>emscripten_async_run_script</b> √© que o √∫ltimo permite executar JS em C de forma ass√≠ncrona.  Principalmente com <b>setTimeout ()</b> .  A raz√£o pela qual eu disse que isso √© um anti-padr√£o √© porque √©.  Toda a id√©ia do WebAssembly √© executar C em JS, n√£o JS em C e, portanto, ... </li><li>  As linhas 20 e 24 e suas fun√ß√µes JS associadas em <b>index.html</b> representam o modelo correto, declarando seu JS em seu JS e retornando algo para C. </li><li>  <b>O EM_JS</b> , que lan√ßa o <b>jsFunction</b> , √© simplesmente uma maneira mais f√°cil - de atingir o mesmo objetivo dos pontos 4 e 5. </li></ol><br><p>  O resultado previsto do exposto acima √© o seguinte: </p><br><img src="http://habrastorage.org/webt/xd/lp/ew/xdlpewar42x522efjks9j2tdii4.png" alt="imagem"><br><br><p></p><h4>  Senhoras adiante! </h4><p></p><br><p>  Como em qualquer c√≥digo, o WebAssembly tamb√©m tem uma ordem de execu√ß√£o.  N√£o mexa com a fila!  A ordem neste caso √© padr√£o para a ordem C.  Tudo come√ßa em Main () e sempre que <b>main () est√°</b> pronto, Wasm est√° pronto.  No entanto, o que acontece se voc√™ precisar de uma fun√ß√£o est√°tica para chamar em tempo de execu√ß√£o?  Bem, apenas um pouco de a√ß√∫car sint√°tico Emscripten, e tudo corre como um rel√≥gio: </p><br><img src="http://habrastorage.org/webt/ak/vg/vy/akvgvyjdhbok35-ggr2ktamzsys.png" alt="imagem"><br><br><h4>  Coletamos moscas do bolo </h4><br><p>  Este √© um c√≥digo bem escrito, especialmente as coisas simples ilustradas nas se√ß√µes anteriores, mas todos sabemos que o mundo real √© muito maior que o "Hello World", e metade do tempo de cada desenvolvedor √© gasta para descobrir por que o c√≥digo n√£o est√° fazendo o que deveria.  Os erros s√£o simplesmente inevit√°veis ‚Äã‚Äãe, em certo sentido, fazem parte da vida. </p><br><p>  Quando voc√™ executa C em JS ou em qualquer Wasm, tudo pode se tornar ainda mais deprimente.  Felizmente, o Emscripten vem ao resgate novamente, fornecendo dois m√©todos de depura√ß√£o muito √∫teis: </p><br><pre> <code class="plaintext hljs">// browser debugger gets triggered emscripten_debugger(); // browser console warning with stack-trace emscripten_log(EM_LOG_WARN, ‚Äú'param' your message‚Äù);</code> </pre> <br><h4>  Gonzalez r√°pido se apressa para ajudar </h4><br>  Acredite ou n√£o, os criadores do Emscripten pensaram em tudo.  Um grande recurso - e o √∫ltimo que mencionarei neste artigo, j√° que existem muitos deles para colocar todos em um - √© a base para o desenvolvimento e teste r√°pidos.  Voc√™ pode compilar seu Wasm, criar um projeto e iniciar o servidor de uma s√≥ vez: <p></p><br><pre> <code class="plaintext hljs">emrun --port 7777 --no_browser public/index.html Now listening at http://localhost:7777/</code> </pre> <br>  A p√°gina html que voc√™ est√° executando n√£o √© compat√≠vel com emrun.  As capturas stdout, stderr e exit (returncode) n√£o funcionar√£o.  Recompile o aplicativo com o sinalizador --emrun linker para habilitar isso, ou passe --no_emrun_detect para emrun para ocultar essa verifica√ß√£o. <br><p>  Ok, em dois colegas ... o exemplo acima funciona, mas o pr√≥ximo funciona melhor, o que explica o erro mostrado. </p><br><pre> <code class="plaintext hljs">&lt;b&gt;// compile as emrun project emcc lib/strings.c -s WASM=1 --emrun -o public/index.html // run the emrun server again emrun --port 7777 --no_browser public/index.html&lt;/b&gt;</code> </pre> <br><p>  Eu apenas deixo assim.  Estudando o WebAssembly, comemorei o Dia de S√£o Patr√≠cio e o dia seguinte.  N√£o tenho muita certeza do que acontecer√° a seguir, mas me emocionou o suficiente ficar sentado na frente do monitor por dois dias, tentando entender o b√°sico do WebAssebly, e isso deveria significar algo, certo?  Este √© o c√≥digo C que eu escrevi desde 2011 e √© √≥timo.  Eu acho que o WebAssembly tem um futuro real, mas n√£o tenho certeza se ele assumir√° completamente a rede e matar√° o JS, como alguns pregam.  O que voc√™ acha? </p><br><img src="https://cdn-images-1.medium.com/max/800/1*PM2kQWEmOeAsRwenG-bDAA.png" alt="imagem"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453008/">https://habr.com/ru/post/pt453008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452998/index.html">Android Um widget din√¢mico na forma de cart√µes baseado no StackView (algo como o Tinder)</a></li>
<li><a href="../pt453000/index.html">Loja de Bagagem: BUgHunting. Como encontrar 200 bugs por dia</a></li>
<li><a href="../pt453002/index.html">Novo terminal do Windows: respostas √†s suas perguntas</a></li>
<li><a href="../pt453004/index.html">N√≥s enviamos Habr para Marte, voc√™ tamb√©m pode voar</a></li>
<li><a href="../pt453006/index.html">Termos de TI como um exemplo do processo de cultivo de batatas</a></li>
<li><a href="../pt453010/index.html">Compara√ß√£o de 10 l√¢mpadas hal√≥genas H4 Philips, Osram, PIAA, Koito, Bosch. Os resultados s√£o surpreendentes.</a></li>
<li><a href="../pt453012/index.html">Uma pequena hist√≥ria fotogr√°fica sobre uma viagem ao Observat√≥rio da Montanha do C√°ucaso</a></li>
<li><a href="../pt453014/index.html">EyeWire - continue estudando os segredos do c√©rebro</a></li>
<li><a href="../pt453016/index.html">Top 3D Academy convida para trocar programa de experi√™ncia na f√°brica Foliplast</a></li>
<li><a href="../pt453018/index.html">Estudo da influ√™ncia de v√°rios refletores e dispersores na forma de um feixe de luz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>