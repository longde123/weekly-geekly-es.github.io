<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚öïÔ∏è ‚Ü©Ô∏è üèµÔ∏è SNA Hackathon 2019 üîë üõ¢Ô∏è üï•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Von Februar bis M√§rz 2019 fand ein Wettbewerb zur Rangfolge des sozialen Netzwerk-Feeds SNA Hackathon 2019 statt , bei dem unser Team den ersten Platz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNA Hackathon 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p>  Von Februar bis M√§rz 2019 fand ein Wettbewerb zur Rangfolge des sozialen Netzwerk-Feeds <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SNA Hackathon 2019 statt</a> , bei dem unser Team den ersten Platz belegte.  In diesem Artikel werde ich √ºber die Organisation des Wettbewerbs, die Methoden, die wir ausprobiert haben, und die Catboost-Einstellungen f√ºr das Training mit Big Data sprechen. </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>SNA Hackathon</strong> </p><br><p>  Der Hackathon unter diesem Namen findet zum dritten Mal statt.  Es wird vom sozialen Netzwerk ok.ru organisiert, wobei die Aufgabe und die Daten in direktem Zusammenhang mit diesem sozialen Netzwerk stehen. <br>  SNA (Social Network Analysis) wird in diesem Fall besser nicht als Analyse eines sozialen Graphen verstanden, sondern als Analyse eines sozialen Netzwerks. </p><br><ul><li>  Im Jahr 2014 bestand die Aufgabe darin, die Anzahl der Likes vorherzusagen, die der Beitrag gewinnen w√ºrde. </li><li>  Im Jahr 2016 n√§hert sich das Ziel des VVZ (vielleicht kennen Sie es) der Analyse des sozialen Graphen. </li><li>  Im Jahr 2019 - Rangfolge des Feeds eines Benutzers nach der Wahrscheinlichkeit, dass dem Benutzer der Beitrag gef√§llt. </li></ul><br><p>  Ich kann nicht √ºber 2014 sagen, aber in den Jahren 2016 und 2019 waren neben der F√§higkeit zur Datenanalyse auch F√§higkeiten im Umgang mit Big Data erforderlich.  Ich denke, dass es die Kombination aus maschinellem Lernen und Big-Data-Verarbeitungsaufgaben war, die mich zu diesen Wettbewerben hingezogen hat, und die Erfahrung in diesen Bereichen hat zum Sieg beigetragen. </p><br><p>  <strong>mlbootcamp</strong> </p><br><p>  2019 wurde der Wettbewerb auf der Plattform <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://mlbootcamp.ru organisiert</a> . </p><br><p>  Der Wettbewerb begann online am 7. Februar und bestand aus 3 Aufgaben.  Jeder konnte sich auf der Website registrieren, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Baseline</a> herunterladen und sein Auto f√ºr mehrere Stunden hochladen.  Am Ende der Online-Phase am 15. M√§rz wurden die Top 15 jeder Show f√ºr die Offline-Phase, die vom 30. M√§rz bis 1. April stattfand, in das Mail.ru-B√ºro eingeladen. </p><br><h1 id="zadacha">  Herausforderung </h1><br><p>  Die Quelldaten enthalten Benutzerkennungen (userId) und Post-IDs (objectId).  Wenn dem Benutzer ein Beitrag angezeigt wurde, enthalten die Daten eine Zeile mit Benutzer-ID, Objekt-ID, Benutzerreaktionen auf diesen Beitrag (Feedback) und einer Reihe verschiedener Zeichen oder Links zu Bildern und Texten. </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  ownerId </th><th>  Feedback </th><th>  Bilder </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [mochte, klickte] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [nicht gemocht] </td><td>  [Hash2, Hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [geklickt, erneut geteilt] </td><td>  [hash2] </td></tr></tbody></table><br><p>  Der Testdatensatz enth√§lt eine √§hnliche Struktur, aber das R√ºckmeldungsfeld fehlt.  Ziel ist es, das Vorhandensein einer "Gefallen" -Reaktion im R√ºckkopplungsfeld vorherzusagen. <br>  Die √úbermittlungsdatei hat die folgende Struktur: </p><br><table><thead><tr><th>  userId </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35,61,55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p>  Metrik - durchschnittliche ROC-AUC nach Benutzern. </p><br><p>  Eine detailliertere Beschreibung der Daten finden Sie auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Perfection-Site</a> .  Dort k√∂nnen Sie auch Daten herunterladen, einschlie√ülich Tests und Bilder. </p><br><p>  <strong>Online-B√ºhne</strong> </p><br><p>  In der Online-Phase wurde die Aufgabe in drei Teile unterteilt </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kollaboratives System</a> - umfasst alle Zeichen au√üer Bildern und Texten; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bilder</a> - enth√§lt nur Informationen zu Bildern; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Texte</a> - Enth√§lt nur Informationen zu Texten. </li></ul><br><p>  <strong>Offline-B√ºhne</strong> </p><br><p>  In der Offline-Phase enthielten die Daten alle Attribute, w√§hrend die Texte und Bilder sp√§rlich waren.  Der Datensatz enthielt 1,5-mal mehr Zeilen, von denen es bereits viele gab. </p><br><h1 id="reshenie-zadachi">  Probleml√∂sung </h1><br><p>  Da ich bei der Arbeit einen Lebenslauf mache, habe ich meine Reise in diesem Wettbewerb mit der Aufgabe "Bilder" begonnen.  Die bereitgestellten Daten sind userId, objectId, ownerId (die Gruppe, in der der Beitrag ver√∂ffentlicht wird), Zeitstempel zum Erstellen und Anzeigen des Beitrags und nat√ºrlich das Bild f√ºr diesen Beitrag. <br>  Nachdem mehrere Features basierend auf dem Zeitstempel generiert wurden, bestand die n√§chste Idee darin, die vorletzte Schicht eines imagenet-vortrainierten Neurons zu nehmen und diese Einbettungen zum Boosten zu senden. </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p>  Die Ergebnisse waren nicht beeindruckend.  Einbettungen aus dem Imagenet-Neuron sind irrelevant, dachte ich, ich muss meinen Auto-Encoder ablegen. </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p>  Es hat viel Zeit gekostet und das Ergebnis hat sich nicht verbessert. </p><br><p>  <strong>Feature-Generierung</strong> </p><br><p>  Die Arbeit mit Bildern nimmt viel Zeit in Anspruch, und ich habe beschlossen, etwas Einfacheres zu tun. <br>  Wie Sie sofort sehen k√∂nnen, enth√§lt der Datensatz mehrere kategoriale Zeichen, und um nicht viel zu st√∂ren, habe ich nur Catboost genommen.  Die L√∂sung war ausgezeichnet, ohne Einstellungen kam ich sofort zur ersten Zeile der Rangliste. </p><br><p>  Es gibt viele Daten und sie sind im Parkettformat angelegt. Ohne nachzudenken, nahm ich Scala und fing an, alles in Funken zu schreiben. </p><br><p>  Die einfachsten Funktionen, die mehr Wachstum als Bildeinbettungen erm√∂glichten: </p><br><ul><li>  Wie oft haben sich Objekt-ID, Benutzer-ID und Eigent√ºmer-ID in den Daten getroffen (sollte mit der Popularit√§t korrelieren)? </li><li>  Wie viele Benutzer-ID-Beitr√§ge hat die Eigent√ºmer-ID gesehen (sollte mit dem Interesse des Benutzers an der Gruppe korrelieren)? </li><li>  Wie viele eindeutige Benutzer-IDs wurden von ownerId angesehen (entspricht der Gr√∂√üe der Zielgruppe der Gruppe). </li></ul><br><p>  Aus Zeitstempeln konnte die Tageszeit ermittelt werden, zu der der Benutzer das Band angesehen hat (morgens / Tag / Abend / Nacht).  Durch Kombinieren dieser Kategorien k√∂nnen Sie weiterhin Funktionen generieren: </p><br><ul><li>  Wie oft hat sich die Benutzer-ID abends angemeldet? </li><li>  Wann wird dieser Beitrag oft angezeigt (objectId) und so weiter? </li></ul><br><p>  All dies verbesserte allm√§hlich die Metrik.  Die Gr√∂√üe des Trainingsdatensatzes betr√§gt jedoch etwa 20 Millionen Datens√§tze, sodass das Hinzuf√ºgen von Funktionen das Lernen erheblich verlangsamt. </p><br><p>  Ich habe den Datennutzungsansatz neu definiert.  Obwohl die Daten zeitabh√§ngig sind, habe ich in Zukunft keine expliziten Informationslecks gesehen, dennoch habe ich sie f√ºr den Fall wie folgt gebrochen: </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p>  Das uns zur Verf√ºgung gestellte Trainingsset (Februar und 2 M√§rzwochen) war in zwei Teile unterteilt. <br>  Anhand der Daten der letzten N Tage trainierte er das Modell.  Die oben beschriebenen Aggregationen wurden auf allen Daten einschlie√ülich des Tests aufgebaut.  Gleichzeitig erschienen Daten, auf denen verschiedene Encoder der Zielvariablen aufgebaut werden k√∂nnen.  Der einfachste Ansatz besteht darin, den Code, der bereits neue Funktionen erstellt, wiederzuverwenden und ihn einfach mit Daten zu versorgen, die nicht trainiert werden, und Ziel = 1. </p><br><p>  Somit haben wir √§hnliche Funktionen erhalten: </p><br><ul><li>  Wie oft hat userId einen Beitrag in der ownerId-Gruppe gesehen? </li><li>  Wie oft mochte userId den Beitrag zu ownerId; </li><li>  Der Prozentsatz der Beitr√§ge, denen die Benutzer-ID die Eigent√ºmer-ID gefallen hat. </li></ul><br><p>  Das hei√üt, es stellte sich heraus, dass die <em>mittlere Zielcodierung</em> seitens des Datensatzes nach verschiedenen Kombinationen von kategorialen Merkmalen erfolgt.  Im Prinzip erstellt catboost auch eine Zielcodierung, und unter diesem Gesichtspunkt gibt es keinen Vorteil, aber es wurde beispielsweise m√∂glich, die Anzahl der eindeutigen Benutzer zu z√§hlen, die Beitr√§ge in dieser Gruppe m√∂gen.  Gleichzeitig wurde das Hauptziel erreicht - mein Datensatz nahm mehrmals ab und es war m√∂glich, weiterhin Features zu generieren. </p><br><p>  W√§hrend Catboost Encoder nur entsprechend der gew√ºnschten Reaktion erstellen kann, hat das Feedback andere Reaktionen: erneut geteilt, nicht gemocht, nicht gemocht, geklickt, ignoriert, was manuell erfolgen kann.  Ich habe alle Arten von Aggregaten nachgez√§hlt und Features mit geringer Bedeutung herausgesiebt, um den Datensatz nicht aufzublasen. </p><br><p>  Zu diesem Zeitpunkt war ich mit gro√üem Abstand auf dem ersten Platz.  Die einzige Verlegenheit war, dass die Einbettung der Bilder fast keinen Gewinn brachte.  Die Idee kam, alles f√ºr Catboost zu geben.  Cluster K bedeutet Bilder und erh√§lt eine neue kategoriale Funktion imageCat. </p><br><p>  Hier sind einige Klassen nach dem manuellen Filtern und Zusammenf√ºhren von Clustern, die von KMeans erhalten wurden. </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p>  Basierend auf imageCat generieren wir: </p><br><ul><li>  Neue kategoriale Funktionen: <br><ul><li>  Welche imageCat sah am h√§ufigsten nach userId aus? </li><li>  Welche imageCat wird am h√§ufigsten von ownerId angezeigt? </li><li>  Welches imageCat mochte userId am h√§ufigsten? </li></ul></li><li>  Verschiedene Z√§hler: <br><ul><li>  Wie viele eindeutige imageCat sahen userId aus; </li><li>  Etwa 15 √§hnliche Funktionen plus Zielcodierung wie oben beschrieben. </li></ul></li></ul><br><p>  <strong>Texte</strong> </p><br><p>  Die Ergebnisse des Bildwettbewerbs passten zu mir und ich beschloss, mich in den Texten zu versuchen.  Fr√ºher habe ich nicht viel mit Texten gearbeitet und aus Dummheit einen Tag auf tf-idf und svd get√∂tet.  Dann habe ich mit doc2vec eine Baseline gesehen, die genau das tut, was ich brauche.  Nachdem ich die Parameter von doc2vec leicht angepasst hatte, erhielt ich Texteinbettungen. </p><br><p>  Und dann verwendete er einfach den Code f√ºr die Bilder wieder, in dem er die Bildeinbettungen durch Texteinbettungen ersetzte.  Infolgedessen erreichte ich den 2. Platz im Textwettbewerb. </p><br><p>  <strong>Kollaboratives System</strong> </p><br><p>  Es gab nur einen Wettbewerb, bei dem ich noch keinen ‚ÄûStock gesto√üen‚Äú hatte, aber nach Ansicht der AUC in der Rangliste h√§tten die Ergebnisse dieses speziellen Wettbewerbs den gr√∂√üten Einfluss auf die Offline-Phase haben m√ºssen. <br>  Ich nahm alle Zeichen, die in den Quelldaten enthalten waren, w√§hlte die kategorialen aus und berechnete die gleichen Aggregate wie f√ºr die Bilder, mit Ausnahme der Merkmale aus den Bildern selbst.  Wenn ich es einfach in Catboost stecke, komme ich auf den 2. Platz. </p><br><h1 id="pervye-shagi-optimizacii-catboost">  Die ersten Schritte zur Optimierung von Catboost </h1><br><p>  Ein erster und zwei zweite Pl√§tze haben mir gefallen, aber ich war mir einig, dass ich nichts Besonderes getan habe, was bedeutet, dass wir mit einem Positionsverlust rechnen k√∂nnen. </p><br><p>  Die Aufgabe des Wettbewerbs besteht darin, Beitr√§ge innerhalb des Benutzerrahmens zu bewerten. W√§hrend dieser ganzen Zeit habe ich das Klassifizierungsproblem gel√∂st, dh die falsche Metrik optimiert. </p><br><p>  Ich werde ein einfaches Beispiel geben: </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  Vorhersage </th><th>  Grundwahrheit </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  1 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,5 </td><td>  0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Wir machen eine kleine Permutation </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  Vorhersage </th><th>  Grundwahrheit </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,5 </td><td>  1 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Wir erhalten folgende Ergebnisse: </p><br><table><thead><tr><th>  Modell </th><th>  Auc </th><th>  Benutzer1 AUC </th><th>  User2 AUC </th><th>  mittlere AUC </th></tr></thead><tbody><tr><td>  Variante 1 </td><td>  0,8 </td><td>  1,0 </td><td>  0,0 </td><td>  0,5 </td></tr><tr><td>  Option 2 </td><td>  0,7 </td><td>  0,75 </td><td>  1,0 </td><td>  0,875 </td></tr></tbody></table><br><p>  Wie Sie sehen k√∂nnen, bedeutet die Verbesserung der gesamten AUC-Metrik nicht die Verbesserung der durchschnittlichen AUC-Metrik innerhalb des Benutzers. </p><br><p>  Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kann Ranking-Metriken</a> sofort <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">optimieren</a> .  Ich habe √ºber Ranking-Metriken und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erfolgsgeschichten</a> bei der Verwendung von Catboost gelesen und YetiRankPairwise so eingestellt, dass es f√ºr die Nacht studiert.  Das Ergebnis war nicht beeindruckend.  Nachdem ich festgestellt hatte, dass ich nicht gut gelernt hatte, √§nderte ich die Fehlerfunktion in QueryRMSE, das nach der Dokumentation von catboost schneller konvergiert.  Infolgedessen erzielte ich die gleichen Ergebnisse wie w√§hrend des Klassifikationstrainings, aber die Ensembles dieser beiden Modelle erzielten eine gute Steigerung, was mich in allen drei Wettbewerben auf den ersten Platz brachte. </p><br><p>  5 Minuten vor dem Abschluss der Online-Phase des Collaborative Systems-Wettbewerbs brachte mich Sergey Shalnov auf den zweiten Platz.  Den weiteren Weg gingen wir zusammen. </p><br><h1 id="podgotovka-k-oflayn-etapu">  Vorbereitung auf die Offline-Phase </h1><br><p>  Der Sieg in der Online-Phase war uns auf der RTX 2080 TI-Grafikkarte garantiert, aber der Hauptpreis von 300.000 Rubel und sogar der letzte erste Platz zwangen uns, diese zwei Wochen zu arbeiten. </p><br><p>  Wie sich herausstellte, verwendete Sergey auch Catboost.  Wir tauschten Ideen und Features aus, und ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erfuhr</a> von dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Anna Veronika Dorogush,</a> in dem es Antworten auf viele meiner Fragen gab, und sogar auf diejenigen, die ich noch nicht erschienen war. </p><br><p>  Das Anzeigen des Berichts f√ºhrte mich zu der Idee, dass es notwendig ist, alle Parameter auf den Standardwert zur√ºckzusetzen und die Einstellungen sehr sorgf√§ltig und erst nach dem Korrigieren einer Reihe von Zeichen zu optimieren.  Jetzt dauerte ein Training ungef√§hr 15 Stunden, aber ein Modell schaffte es, die Geschwindigkeit besser zu machen als im Ensemble mit Rangliste. </p><br><p>  <strong>Feature-Generierung</strong> </p><br><p>  Im Wettbewerb "Kollaborative Systeme" wird eine Vielzahl von Merkmalen als wichtig f√ºr das Modell bewertet.  Zum Beispiel ist <em>auditweights_spark_svd</em> das wichtigste Attribut, und es gibt keine Informationen dar√ºber, was es bedeutet.  Ich dachte, es lohnt sich, die verschiedenen Einheiten anhand wichtiger Zeichen zu z√§hlen.  Zum Beispiel die durchschnittlichen auditweights_spark_svd pro Benutzer, pro Gruppe und pro Objekt.  Dasselbe kann aus Daten berechnet werden, f√ºr die kein Training durchgef√ºhrt wird, und Ziel = 1, <em>dh</em> die durchschnittlichen <em>auditweights_spark_svd</em> pro Benutzer f√ºr die Objekte, die ihm gefallen haben.  Neben <em>auditweights_spark_svd gab</em> es mehrere wichtige Anzeichen.  Hier sind einige davon: </p><br><ul><li>  <em>auditweightsCtrGender</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p>  Beispielsweise stellte sich heraus, dass der Durchschnittswert von <em>auditweightsCtrGender</em> nach Benutzer-ID ein wichtiges Merkmal ist, ebenso wie der Durchschnittswert von <em>userOwnerCounterCreateLikes</em> nach Benutzer-ID + Eigent√ºmer-ID.  Dies h√§tte uns dar√ºber nachdenken lassen sollen, wie wir die Bedeutung der Felder verstehen k√∂nnen. </p><br><p>  Weitere wichtige Funktionen waren <em>auditweightsLikesCount</em> und <em>auditweightsShowsCount</em> .  Durch die Aufteilung wurde ein noch wichtigeres Merkmal erhalten. </p><br><p>  <strong>Datenlecks</strong> </p><br><p>  Wettbewerbs- und Produktionsmodelle sind sehr unterschiedliche Aufgaben.  Bei der Vorbereitung der Daten ist es sehr schwierig, alle Details zu ber√ºcksichtigen und keine nicht trivialen Informationen √ºber die Zielvariable im Test zu √ºbertragen.  Wenn wir eine Produktionsl√∂sung erstellen, werden wir versuchen, die Verwendung von Datenlecks beim Training des Modells zu vermeiden.  Aber wenn wir den Wettbewerb gewinnen wollen, sind Datenlecks die besten Eigenschaften. </p><br><p>  Nach Pr√ºfung der Daten k√∂nnen Sie feststellen, dass sich die Werte von <em>auditweightsLikesCount</em> und <em>auditweightsShowsCount</em> <em>gem√§√ü</em> <em>objectId</em> √§ndern. <em>Dies</em> bedeutet, dass das Verh√§ltnis der Maximalwerte dieser Zeichen die <em>Nachkonvertierung</em> viel besser widerspiegelt als das Verh√§ltnis zum Zeitpunkt der Lieferung. </p><br><p>  Das erste Leck, das wir gefunden haben, war <em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> . <br>  Aber was ist, wenn Sie sich die Daten genauer ansehen?  Nach Lieferdatum sortieren und erhalten: </p><br><table><thead><tr><th>  objectId </th><th>  userId </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th>  Ziel (wird gemocht) </th></tr></thead><tbody><tr><td>  1 </td><td>  1 </td><td>  12 </td><td>  3 </td><td>  wahrscheinlich nicht </td></tr><tr><td>  1 </td><td>  2 </td><td>  15 </td><td>  3 </td><td>  vielleicht ja </td></tr><tr><td>  1 </td><td>  3 </td><td>  16 </td><td>  4 </td><td></td></tr></tbody></table><br><p>  Es war √ºberraschend, als ich das erste derartige Beispiel fand und es stellte sich heraus, dass meine Vorhersage nicht wahr wurde.  <em>Angesichts</em> der Tatsache, dass die Maximalwerte dieser Zeichen im Rahmen des Objekts zunahmen, waren wir nicht zu faul und entschieden uns, <em>auditweightsShowsCountNext</em> und <em>auditweightsLikesCountNext</em> zu finden, <em>dh</em> Werte zum n√§chsten Zeitpunkt.  Funktion hinzuf√ºgen <br>  <em>(auditweightsShowsCountNext-auditweightsShowsCount) / (auditweightsLikesCount-auditweightsLikesCountNext)</em> Wir haben rund um die Uhr einen scharfen Sprung gemacht. <br>  √Ñhnliche Lecks k√∂nnten verwendet werden, wenn die folgenden Werte f√ºr <em>userOwnerCounterCreateLikes</em> in userId + ownerId und beispielsweise <em>auditweightsCtrGender</em> in objectId + userGender gefunden w√ºrden.  Wir haben 6 √§hnliche Felder mit Lecks gefunden und so viele Informationen wie m√∂glich daraus gezogen. </p><br><p>  Zu diesem Zeitpunkt hatten wir ein Maximum an Informationen aus kollaborativen Attributen herausgepresst, kehrten jedoch nicht zu Wettbewerben mit Bildern und Texten zur√ºck.  Es gab eine gute Idee zu √ºberpr√ºfen: Wie viel geben Features direkt auf Bilder oder Texte in den entsprechenden Wettbewerben? </p><br><p>  Es gab keine Lecks in den Wettbewerben f√ºr Bilder und Texte, aber zu diesem Zeitpunkt hatte ich die Standardparameter von catboost zur√ºckgegeben, den Code gek√§mmt und einige Funktionen hinzugef√ºgt.  Gesamtergebnis: </p><br><table><thead><tr><th>  L√∂sung </th><th>  Geschwindigkeit </th></tr></thead><tbody><tr><td>  Maximum mit Bildern </td><td>  0,6411 </td></tr><tr><td>  Maximal keine Bilder </td><td>  0,6297 </td></tr><tr><td>  Ergebnis des zweiten Platzes </td><td>  0,6295 </td></tr></tbody></table><br><table><thead><tr><th>  L√∂sung </th><th>  Geschwindigkeit </th></tr></thead><tbody><tr><td>  Maximal mit Texten </td><td>  0,666 </td></tr><tr><td>  Maximum ohne Texte </td><td>  0,660 </td></tr><tr><td>  Ergebnis des zweiten Platzes </td><td>  0,656 </td></tr></tbody></table><br><table><thead><tr><th>  L√∂sung </th><th>  Geschwindigkeit </th></tr></thead><tbody><tr><td>  Maximum in Zusammenarbeit </td><td>  0,745 </td></tr><tr><td>  Ergebnis des zweiten Platzes </td><td>  0,723 </td></tr></tbody></table><br><p>  Es stellte sich heraus, dass es unwahrscheinlich war, dass viele Texte und Bilder herausgedr√ºckt wurden, und nachdem wir einige der interessantesten Ideen ausprobiert hatten, h√∂rten wir auf, mit ihnen zu arbeiten. </p><br><p>  Die weitere Generierung von Funktionen in kollaborativen Systemen brachte kein Wachstum, und wir begannen mit dem Ranking.  In der Online-Phase gab mir das Ensemble aus Klassifikation und Ranking einen kleinen Anstieg, wie sich herausstellte, weil ich die Klassifikation unterausgebildet hatte.  Keine der Fehlerfunktionen, einschlie√ülich YetiRanlPairwise, lieferte sogar genaue Ergebnisse, die LogLoss lieferte (0,745 gegen√ºber 0,725).  Es gab Hoffnung auf eine QueryCrossEntropy, die nicht gestartet werden konnte. </p><br><h1 id="oflayn-etap">  Offline-B√ºhne </h1><br><p>  In der Offline-Phase ist die Datenstruktur gleich geblieben, es wurden jedoch kleine √Ñnderungen vorgenommen: </p><br><ul><li>  Bezeichner userId, objectId, ownerId wurden neu randomisiert; </li><li>  mehrere Zeichen wurden entfernt und einige umbenannt; </li><li>  Daten sind ungef√§hr 1,5 mal gr√∂√üer geworden. </li></ul><br><p>  Zus√§tzlich zu den aufgef√ºhrten Schwierigkeiten gab es ein gro√ües Plus: Dem Team wurde ein gro√üer Server mit RTX 2080TI zugewiesen.  Ich habe htop lange genossen. <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p>  Die Idee war eine - nur um zu reproduzieren, was bereits da ist.  Nachdem wir einige Stunden damit verbracht hatten, die Umgebung auf dem Server einzurichten, begannen wir nach und nach zu √ºberpr√ºfen, ob die Ergebnisse reproduziert wurden.  Das Hauptproblem, mit dem wir konfrontiert sind, ist die Zunahme des Datenvolumens.  Wir haben uns entschlossen, die Last leicht zu reduzieren und den Parameter catboost ctr_complexity = 1 zu setzen.  Dies senkt die Geschwindigkeit ein wenig, aber mein Modell begann zu funktionieren, das Ergebnis war gut - 0,733.  Im Gegensatz zu mir hat Sergei die Daten nicht in zwei Teile geteilt und alle Daten trainiert. Obwohl dies das beste Ergebnis in der Online-Phase ergab, gab es in der Offline-Phase viele Schwierigkeiten.  Wenn wir alle von uns generierten Funktionen nutzen und versuchen, sie in Catboost ‚Äûauf die Stirn‚Äú zu setzen, w√§re im Online-Stadium nichts passiert.  Sergey hat die Typoptimierung durchgef√ºhrt, z. B. float64-Typen in float32 konvertiert.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">In diesem Artikel</a> finden Sie Informationen zur Speicheroptimierung bei Pandas.  Infolgedessen trainierte Sergey alle Daten auf der CPU und es stellte sich heraus, dass es ungef√§hr 0,735 waren. </p><br><p>  Diese Ergebnisse reichten aus, um zu gewinnen, aber wir versteckten unsere tats√§chliche Geschwindigkeit und konnten nicht sicher sein, dass andere Teams nicht dasselbe taten. </p><br><h1 id="bitva-do-poslednego">  Kampf bis zum letzten </h1><br><p>  <strong>Catboost einstellen</strong> </p><br><p>  Unsere L√∂sung wurde vollst√§ndig reproduziert. Wir haben Funktionen f√ºr Textdaten und Bilder hinzugef√ºgt, sodass nur noch die Catboost-Parameter angepasst werden mussten.  Sergey studierte auf der CPU mit einer kleinen Anzahl von Iterationen und ich studierte mit ctr_complexity = 1.  Es war nur noch ein Tag √ºbrig, und wenn Sie nur Iterationen hinzuf√ºgen oder ctr_complexity erh√∂hen, k√∂nnen Sie am Morgen noch schneller werden und den ganzen Tag laufen. </p><br><p>  In der Offline-Phase k√∂nnen die Ergebnisse sehr leicht ausgeblendet werden, indem einfach nicht die beste L√∂sung auf der Website ausgew√§hlt wird.  Wir haben in den letzten Minuten vor dem Abschluss der Einreichungen starke √Ñnderungen in der Rangliste erwartet und beschlossen, nicht aufzuh√∂ren. </p><br><p>  Aus dem Video von Anna habe ich gelernt, dass es zur Verbesserung der Qualit√§t des Modells am besten ist, die folgenden Parameter auszuw√§hlen: </p><br><ul><li>  <em>learning_rate</em> - Der Standardwert wird basierend auf der Gr√∂√üe des Datensatzes berechnet.  Bei einer Verringerung der Lernrate ist es zur Aufrechterhaltung der Qualit√§t erforderlich, die Anzahl der Iterationen zu erh√∂hen. </li><li>  <em>l2_leaf_reg</em> - Regularisierungskoeffizient, Standardwert 3, vorzugsweise von 2 bis 30. Eine Abnahme des Wertes f√ºhrt zu einer Zunahme der √úberanpassung. </li><li>  <em>bagging_temperature</em> - F√ºgt den Gewichten von Objekten in der Auswahl eine Randomisierung hinzu.  Der Standardwert ist 1, bei dem Gewichte aus der Exponentialverteilung ausgew√§hlt werden.  Eine Wertminderung f√ºhrt zu einer Zunahme der √úberanpassung. </li><li>  <em>random_strength</em> - <em>Beeinflusst</em> die Auswahl der Teilungen f√ºr eine bestimmte Iteration.  Je h√∂her die random_strength ist, desto h√∂her ist die Wahrscheinlichkeit, dass ein Split von geringer Bedeutung ausgew√§hlt wird.  Bei jeder nachfolgenden Iteration nimmt die Zuf√§lligkeit ab.  Eine Wertminderung f√ºhrt zu einer Zunahme der √úberanpassung. </li></ul><br><p>  Andere Parameter wirken sich wesentlich weniger auf das Endergebnis aus, daher habe ich nicht versucht, sie auszuw√§hlen.  Eine Trainingsiteration f√ºr mein GPU-Dataset mit ctr_complexity = 1 dauerte 20 Minuten, und die ausgew√§hlten Parameter f√ºr das reduzierte Dataset unterschieden sich geringf√ºgig von den optimalen Parametern f√ºr das gesamte Dataset.  Infolgedessen habe ich ungef√§hr 30 Iterationen f√ºr 10% der Daten und dann ungef√§hr 10 weitere Iterationen f√ºr alle Daten durchgef√ºhrt.  Es stellte sich ungef√§hr Folgendes heraus: </p><br><ul><li>  Ich habe die <em>Lernrate</em> gegen√ºber dem Standard um 40% erh√∂ht. </li><li>  <em>l2_leaf_reg hat</em> dasselbe verlassen; </li><li>  <em>bagging_temperature</em> und <em>random_strength</em> auf 0.8 reduziert. </li></ul><br><p>  Wir k√∂nnen daraus schlie√üen, dass das Modell mit Standardparametern untertrainiert ist. </p><br><p>  Ich war sehr √ºberrascht, als ich das Ergebnis auf der Rangliste sah: </p><br><table><thead><tr><th>  Modell </th><th>  Modell 1 </th><th>  Modell 2 </th><th>  Modell 3 </th><th>  Ensemble </th></tr></thead><tbody><tr><td>  Keine Abstimmung </td><td>  0,7403 </td><td>  0,7404 </td><td>  0,7404 </td><td>  0,7407 </td></tr><tr><td>  Mit Tuning </td><td>  0,7406 </td><td>  0,7405 </td><td>  0,7406 </td><td>  0,7408 </td></tr></tbody></table><br><p>  Ich bin zu dem Schluss gekommen, dass es besser ist, die Auswahl der Parameter durch ein Ensemble mehrerer Modelle mit nicht optimierten Parametern zu ersetzen, wenn Sie keine schnelle Anwendung des Modells ben√∂tigen. </p><br><p>  Sergey war damit besch√§ftigt, die Gr√∂√üe des Datasets zu optimieren, um es auf der GPU auszuf√ºhren.    ‚Äî    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     ‚Äî     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie">  Fazit </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    ‚Äî    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Gegensatz zu anderen Teams hat das Ensemble unserer Modelle stark zugenommen. </font><font style="vertical-align: inherit;">Wir haben uns ausgetauscht und in verschiedenen Sprachen geschrieben. </font><font style="vertical-align: inherit;">Wir hatten einen anderen Ansatz zum Aufteilen von Daten, und ich denke, jeder hatte seine eigenen Fehler.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es ist nicht klar, warum die Ranking-Optimierung schlechtere Ergebnisse lieferte als die Klassifizierungsoptimierung. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ich habe ein wenig Erfahrung mit Texten und ein Verst√§ndnis daf√ºr, wie Empfehlungssysteme gemacht werden. </font></font></li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vielen Dank an die Organisatoren f√ºr die erhaltenen Emotionen, Kenntnisse und Preise. </font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447376/">https://habr.com/ru/post/de447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447366/index.html">Was ist der beste Weg, um ein Projekt zu starten oder wie man sicherstellt, dass es dann keine schmerzhaften Schmerzen gibt</a></li>
<li><a href="../de447368/index.html">Nicht nur Fl√∂he fangen. Warum Geschwindigkeit f√ºr jedes Gesch√§ft so wichtig ist</a></li>
<li><a href="../de447370/index.html">Warum aufgrund eines kaputten Patentsystems immer noch der Schatten von Theranos √ºber uns auftaucht</a></li>
<li><a href="../de447372/index.html">IT-Transformation ist unvermeidlich: Wo soll ich anfangen?</a></li>
<li><a href="../de447374/index.html">Programmgesteuertes Erstellen von Schnittstellenelementen mit PureLayout (Teil 2)</a></li>
<li><a href="../de447380/index.html">Kotlin-Ausnahmen und ihre Merkmale</a></li>
<li><a href="../de447382/index.html">Das Buch "Einheit und C #. Gamedev von der Idee bis zur Umsetzung. 2nd ed</a></li>
<li><a href="../de447384/index.html">Leistungshalbleiter auf der Hut vor der √ñkologie</a></li>
<li><a href="../de447388/index.html">TL; DR-Digest der ITMO University: nicht-klassische Zulassung zur Universit√§t, bevorstehende Veranstaltungen und die interessantesten Materialien</a></li>
<li><a href="../de447390/index.html">AccelStor AFA-Konfigurationsrichtlinien f√ºr VMware vSphere</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>