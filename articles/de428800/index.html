<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎷 🎏 👩🏾‍🍳 Perfektes CSS kochen 🔲 🙆 👩🏾‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Vor nicht allzu langer Zeit wurde mir klar, dass die Arbeit mit CSS in all meinen Anwendungen für Entwickler und Benutzer schmerzhaft i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perfektes CSS kochen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/constanta/blog/428800/">  Hallo Habr! <br><br>  Vor nicht allzu langer Zeit wurde mir klar, dass die Arbeit mit CSS in all meinen Anwendungen für Entwickler und Benutzer schmerzhaft ist. <br><br>  Unter dem Schnitt sind meine Probleme, eine Menge seltsamer Codes und Fallstricke auf dem Weg zur korrekten Arbeit mit Stilen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/ut/5e/hhut5eodm-tw-e1wdqnecn7dxlu.png"></div><a name="habracut"></a><br><h2>  CSS-Problem </h2><br>  In den von mir durchgeführten React- und Vue-Projekten war die Herangehensweise an Stile ungefähr dieselbe.  Das Projekt wird per Webpack zusammengestellt, eine CSS-Datei wird vom Haupteinstiegspunkt importiert.  Diese Datei importiert die restlichen CSS-Dateien, die BEM zum Benennen von Klassen verwenden, in sich. <br><br><pre><code class="plaintext hljs">styles/ indes.css blocks/ apps-banner.css smart-list.css ...</code> </pre> <br>  Ist das bekannt?  Ich habe diese Implementierung fast überall verwendet.  Und alles war in Ordnung, bis einer der Standorte so weit gewachsen war, dass die Probleme mit den Stilen meine Augen stark irritierten. <br><br>  <b>1. Das Problem des Hot-Reload</b> <br>  Das Importieren von Stilen voneinander erfolgte über das Postcss-Plugin oder den Stylus-Loader. <br>  Der Haken ist: <br><br>  Wenn wir Importe über das Postcss- oder Stylus-Loader-Plugin lösen, ist die Ausgabe eine große CSS-Datei.  Selbst bei einer geringfügigen Änderung in einem der Stylesheets werden jetzt alle CSS-Dateien erneut verarbeitet. <br><br>  Die Geschwindigkeit des Hot-Reload wird wirklich beeinträchtigt: Die Verarbeitung von ~ 950 KByte Stiftdateien dauert ca. 4 Sekunden. <br><br><div class="spoiler">  <b class="spoiler_title">Hinweis zum CSS-Loader</b> <div class="spoiler_text">  Wenn der Import von CSS-Dateien über CSS-Loader gelöst worden wäre, wäre ein solches Problem nicht aufgetreten: <br>  CSS-Loader verwandelt CSS in JavaScript.  Es werden alle Stilimporte durch erfordern ersetzt.  Das Ändern einer CSS-Datei wirkt sich dann nicht auf andere Dateien aus, und das Hot-Reload erfolgt schnell. <br><br>  Zum CSS-Loader <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./test.css'</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">html</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* background-color: #a1616e; */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: red; }</code> </pre><br>  Nachher <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> <span class="hljs-comment"><span class="hljs-comment">// imports exports.i(require("-!../node_modules/css-loader/index.js!./test.css"), ""); // module exports.push([module.id, "html, body {\n margin: 0;\n padding: 0;\n width: 100%;\n height: 100%;\n}\n\nbody {\n /* background-color: #a1616e; */\n background-color: red;\n}\n", ""]); // exports</span></span></code> </pre><br></div></div><br>  <b>2. Das Problem der Code-Aufteilung</b> <br><br>  Wenn Stile aus einem separaten Ordner geladen werden, kennen wir nicht den Verwendungskontext der einzelnen Stile.  Mit diesem Ansatz ist es nicht möglich, CSS in mehrere Teile zu zerlegen und diese nach Bedarf zu laden. <br><br>  <b>3. Großartige CSS-Klassennamen</b> <br><br>  Jeder BEM-Klassenname sieht folgendermaßen aus: Blockname__Elementname.  Ein so langer Name wirkt sich stark auf die endgültige CSS-Dateigröße aus: Auf der Habr-Website beispielsweise nehmen CSS-Klassennamen 36% der Größe der Style-Datei ein. <br><br>  Google ist sich dieses Problems bewusst und verwendet in all seinen Projekten seit langem die Namensminimierung: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zb/ft/yx/zbftyxjxnsh-irc6odfc5cszvxk.png" alt="Ein Stück google.com"></div><br>  <font color="#999999"><i>Ein Stück google.com</i></font> <br><br>  All diese Probleme haben mich in Ordnung gebracht, ich habe mich schließlich entschlossen, sie zu beenden und das perfekte Ergebnis zu erzielen. <br><br><h2>  Entscheidungsauswahl </h2><br>  Um alle oben genannten Probleme zu beseitigen, habe ich zwei Lösungen gefunden: CSS In JS (Styled-Components) und CSS-Module. <br><br>  Ich habe keine kritischen Fehler in diesen Lösungen gesehen, aber am Ende fiel meine Wahl aus mehreren Gründen auf CSS-Module: <br><br><ul><li>  Sie können CSS in eine separate Datei einfügen, um JS und CSS separat zwischenzuspeichern. </li><li>  Weitere Optionen für Linterstile. </li><li>  Es ist üblicher, mit CSS-Dateien zu arbeiten. </li></ul><br>  Die Wahl ist getroffen, es ist Zeit zu kochen! <br><br><h2>  Grundeinstellung </h2><br>  Konfigurieren Sie das Webpack ein wenig.  Fügen Sie CSS-Loader hinzu und aktivieren Sie CSS-Module darin: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } }, ], }, ], }, };</code> </pre><br>  Jetzt werden wir CSS-Dateien in Ordner mit Komponenten verteilen.  Innerhalb jeder Komponente importieren wir die erforderlichen Stile. <br><br><pre> <code class="plaintext hljs">project/ components/ CoolComponent/ index.js index.css</code> </pre><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.css */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.contentWrapper</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span> <span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(45, 45, 45, .3); } <span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.contentWrapper}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.title}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.text}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Nachdem wir die CSS-Dateien beschädigt haben, werden beim Hot-Reload nur Änderungen an einer Datei verarbeitet.  Problem Nummer 1 gelöst, Prost! <br><br><h2>  Teilen Sie CSS in Stücke </h2><br>  Wenn ein Projekt viele Seiten hat und der Client nur eine davon benötigt, ist es nicht sinnvoll, alle Daten abzupumpen.  React hat dafür eine großartige reaktionsladbare Bibliothek.  Sie können eine Komponente erstellen, die bei Bedarf die benötigte Datei dynamisch herunterlädt. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* AsyncCoolComponent.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'path/to/Loading'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Loadable({ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-comment"><span class="hljs-comment">/* webpackChunkName: 'CoolComponent' */</span></span><span class="hljs-string"><span class="hljs-string">'path/to/CoolComponent'</span></span>), <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Loading, });</code> </pre><br>  Webpack wandelt die CoolComponent-Komponente in eine separate JS-Datei (Chunk) um, die beim Rendern von AsyncCoolComponent heruntergeladen wird. <br><br>  Gleichzeitig enthält CoolComponent eigene Stile.  CSS liegt bisher als JS-Zeichenfolge darin und wird mit dem Style-Loader als Style eingefügt.  Aber warum schneiden wir die Stile nicht in eine separate Datei? <br><br>  Wir werden unsere eigene CSS-Datei sowohl für die Hauptdatei als auch für jeden der Chunks erstellen. <br><br>  Installieren Sie das Mini-CSS-Extract-Plugin und zaubern Sie mit der Webpack-Konfiguration: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MiniCssExtractPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mini-css-extract-plugin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> test: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ (isDev ? <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span> : MiniCssExtractPlugin.loader), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, }, ], }, ], }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> ...(isDev ? [] : [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MiniCssExtractPlugin({ <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunkFilename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, }), ]), ], };</code> </pre><br>  Das ist alles!  Lassen Sie uns das Projekt im Produktionsmodus zusammenstellen, den Browser öffnen und die Registerkarte Netzwerk anzeigen: <br><br><pre> <code class="plaintext hljs">//    GET /main.aff4f72df3711744eabe.css GET /main.43ed5fc03ceb844eab53.js //  CoolComponent ,   JS  CSS GET /CoolComponent.3eaa4773dca4fffe0956.css GET /CoolComponent.2462bbdbafd820781fae.js</code> </pre><br>  Problem Nummer 2 ist vorbei. <br><br><h2>  Wir minimieren CSS-Klassen </h2><br>  Css-loader ändert die darin enthaltenen Klassennamen und gibt eine Variable mit der Zuordnung lokaler Klassennamen zu global zurück. <br><br>  Nach unserer Grundeinstellung generiert der CSS-Loader einen langen Hash basierend auf dem Namen und dem Speicherort der Datei. <br><br>  Im Browser sieht unsere CoolComponent jetzt folgendermaßen aus: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rs2inRqijrGnbl0txTQ8v"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_2AU-QBWt5K2v7J1vRT0hgn"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_1DaTAH8Hgn0BQ4H13yRwQ0"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Das reicht uns natürlich nicht. <br><br>  Es ist notwendig, dass es während der Entwicklung Namen gibt, unter denen der ursprüngliche Stil gefunden werden kann.  Im Produktionsmodus sollten Klassennamen minimiert werden. <br><br>  Mit Css-Loader können Sie die Änderung von Klassennamen über die Optionen localIdentName und getLocalIdent anpassen.  Im Entwicklungsmodus setzen wir den beschreibenden localIdentName - '[Pfad] _ [Name] _ [Lokal]' und für den Produktionsmodus erstellen wir eine Funktion, die Klassennamen minimiert: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopedName = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/getScopedName'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'style-loader'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : MiniCssExtractPlugin.loader</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">: '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">css</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">', </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">: { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">, ...(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? { localIdentName: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'[path]_[name]_[local]'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, } : { getLocalIdent: (context, localIdentName, localName</span></span></span><span class="hljs-function">) =&gt;</span></span> ( getScopedName(localName, context.resourcePath) ), }), }, }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,        CSS      */</span></span> <span class="hljs-comment"><span class="hljs-comment">//      const incstr = require('incstr'); const createUniqueIdGenerator = () =&gt; { const uniqIds = {}; const generateNextId = incstr.idGenerator({ //  d ,    ad, //      Adblock alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); //       return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); } return uniqIds[name]; }; }; const localNameIdGenerator = createUniqueIdGenerator(); const componentNameIdGenerator = createUniqueIdGenerator(); module.exports = (localName, resourcePath) =&gt; { //   ,     index.css const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  Und hier haben wir in der Entwicklung schöne visuelle Namen: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_content-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_title"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_text"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Und in der Produktion minimierte Klassen: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_f"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_g"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_h"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Das dritte Problem ist überwunden. <br><br><h2>  Entfernen Sie unnötige Cache-Ungültigkeit </h2><br>  Versuchen Sie mit der oben beschriebenen Klassenminimierungstechnik, das Projekt mehrmals zu erstellen.  Achten Sie auf Datei-Caches: <br><br><pre> <code class="plaintext hljs">/*   */ app.bf70bcf8d769b1a17df1.js app.db3d0bd894d38d036117.css /*   */ app.1f296b75295ada5a7223.js app.eb2519491a5121158bd2.css</code> </pre><br>  Es scheint, dass wir nach jedem neuen Build Caches ungültig gemacht haben.  Wie so? <br><br>  Das Problem ist, dass Webpack nicht die Reihenfolge garantiert, in der Dateien verarbeitet werden.  Das heißt, CSS-Dateien werden in einer unvorhersehbaren Reihenfolge verarbeitet. Für denselben Klassennamen mit unterschiedlichen Assemblys werden unterschiedliche minimierte Namen generiert. <br><br>  Um dieses Problem zu beheben, speichern wir die Daten zu den generierten Klassennamen zwischen Assemblys.  Aktualisieren Sie die Datei getScopedName.js ein wenig: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> incstr = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'incstr'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     const { getGeneratorData, saveGeneratorData, } = require('./generatorHelpers'); const createUniqueIdGenerator = (generatorIdentifier) =&gt; { //    const uniqIds = getGeneratorData(generatorIdentifier); const generateNextId = incstr.idGenerator({ alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); //    , //      // (   debounce  ) saveGeneratorData(generatorIdentifier, uniqIds); } return uniqIds[name]; }; }; //     , //          const localNameIdGenerator = createUniqueIdGenerator('localName'); const componentNameIdGenerator = createUniqueIdGenerator('componentName'); module.exports = (localName, resourcePath) =&gt; { const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  Die Implementierung der Datei generatorHelpers.js spielt keine Rolle, aber wenn Sie interessiert sind, ist hier meine: <br><br><div class="spoiler">  <b class="spoiler_title">generatorHelpers.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorDataPath = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function"> =&gt;</span></span> ( path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">`meta/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${generatorIdentifier}</span></span></span><span class="hljs-string">.json`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs.existsSync(path)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(path); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> saveGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier, uniqIds</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(uniqIds, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); fs.writeFileSync(path, data, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { getGeneratorData, saveGeneratorData, };</code> </pre><br></div></div><br>  Die Caches sind zwischen den Builds gleich geworden, alles ist in Ordnung.  Ein weiterer Punkt zu unseren Gunsten! <br><br><h2>  Entfernen Sie die Laufzeitvariable </h2><br>  Da ich mich für eine bessere Entscheidung entschieden habe, wäre es schön, diese Variable bei der Zuordnung von Klassen zu entfernen, da wir alle erforderlichen Daten in der Kompilierungsphase haben. <br><br>  Babel-Plugin-React-CSS-Module helfen uns dabei.  Zum Zeitpunkt der Kompilierung gilt Folgendes: <br><br><ol><li>  Findet den CSS-Import in der Datei. </li><li>  Diese CSS-Datei wird geöffnet und die CSS-Klassennamen werden wie beim CSS-Loader geändert. </li><li>  Es werden JSX-Knoten mit dem styleName-Attribut gefunden. </li><li>  Ersetzt lokale Klassennamen von styleName durch globale. </li></ol><br>  Richten Sie dieses Plugin ein.  Spielen wir mit der Babel-Konfiguration: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ,     const getScopedName = require('path/to/getScopedName'); const isDev = process.env.NODE_ENV === 'development'; module.exports = { /* ... */ plugins: [ /* ... */ ['react-css-modules', { generateScopedName: isDev ? '[path]_[name]_[local]' : getScopedName, }], ], };</span></span></code> </pre><br>  Aktualisieren Sie unsere JSX-Dateien: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"content-wrapper"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Deshalb haben wir die Verwendung der Variablen für die Anzeige von Stilnamen eingestellt. Jetzt haben wir sie nicht mehr! <br><br>  ... oder ist da? <br><br>  Wir werden das Projekt sammeln und die Quellen untersuchen: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.24436cbf94546057cae3.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{ e.exports = { <span class="hljs-string"><span class="hljs-string">"content-wrapper"</span></span>: <span class="hljs-string"><span class="hljs-string">"e_f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"e_g"</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">"e_h"</span></span> } } <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span></code> </pre><br>  Es sieht so aus, als ob die Variable noch vorhanden ist, obwohl sie nirgendwo verwendet wird.  Warum ist das passiert? <br><br>  Das Webpack unterstützt verschiedene Arten von modularen Strukturen. Die beliebtesten sind ES2015 (Import) und CommonJS (erforderlich). <br><br>  ES2015-Module unterstützen im Gegensatz zu commonJS aufgrund ihrer statischen Struktur das Baumschütteln. <br><br>  Sowohl der CSS-Loader als auch der Mini-CSS-Extract-Plugin-Loader verwenden die CommonJS-Syntax, um Klassennamen zu exportieren, sodass die exportierten Daten nicht aus dem Build gelöscht werden. <br><br>  Wir werden unseren kleinen Lader schreiben und die zusätzlichen Daten im Produktionsmodus löschen: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resolve = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">relativePath</span></span></span><span class="hljs-function"> =&gt;</span></span> path.resolve(__dirname, relativePath); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ ...(isDev ? [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>] : [ resolve(<span class="hljs-string"><span class="hljs-string">'path/to/webpack-loaders/nullLoader'</span></span>), MiniCssExtractPlugin.loader, ]), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* nullLoader.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,   module.exports = () =&gt; '// empty';</span></span></code> </pre><br>  Überprüfen Sie die zusammengestellte Datei erneut: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.35f6b05f0496bff2048a.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{} <span class="hljs-comment"><span class="hljs-comment">/* … */</span></span></code> </pre><br>  Sie können erleichtert ausatmen, alles hat funktioniert. <br><br><div class="spoiler">  <b class="spoiler_title">Fehler beim Löschen der Klassenzuordnungsvariablen</b> <div class="spoiler_text">  Zunächst schien es mir am offensichtlichsten, das bereits vorhandene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Null-Loader-</a> Paket zu verwenden. <br><br>  Aber alles stellte sich als nicht so einfach heraus: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*  null-loader */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pitch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; }</code> </pre><br>  Wie Sie sehen können, exportiert der Nulllader neben der Hauptfunktion auch die Pitch-Funktion.  Ich habe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aus der Dokumentation</a> gelernt, dass Pitch-Methoden früher als andere aufgerufen werden und alle nachfolgenden Loader abbrechen können, wenn sie einige Daten von dieser Methode zurückgeben. <br><br>  Mit einem Nulllader sieht die CSS-Produktionssequenz folgendermaßen aus: <br><br><ul><li>  Die Pitch-Methode des Nullladers wird aufgerufen, die eine leere Zeichenfolge zurückgibt. </li><li>  Aufgrund des Rückgabewerts der Pitch-Methode werden nicht alle nachfolgenden Lader aufgerufen. </li></ul><br>  Ich sah die Lösungen nicht mehr und beschloss, meinen eigenen Lader zu bauen. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Verwendung mit Vue.js.</b> <div class="spoiler_text">  Wenn Sie nur eine Vue.js zur Hand haben, aber wirklich die Klassennamen komprimieren und die Laufzeitvariable entfernen möchten, dann habe ich einen großartigen Hack! <br><br>  Wir brauchen nur zwei Plugins: babel-plugin-transform-vue-jsx und babel-plugin-react-css-modules.  Wir benötigen das erste, um JSX in Renderfunktionen zu schreiben, und das zweite, wie Sie bereits wissen, um Namen in der Kompilierungsphase zu generieren. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-string"><span class="hljs-string">'transform-vue-jsx'</span></span>, [<span class="hljs-string"><span class="hljs-string">'react-css-modules'</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//    attributeNames: { styleName: 'class', }, }], ], };</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TextComponent = { render(h) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Lorem ipsum dolor. </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }, mounted() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'I\'m mounted!'</span></span>); }, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> TextComponent;</code> </pre><br></div></div><br><br><h2>  Komprimieren Sie CSS vollständig </h2><br>  Stellen Sie sich vor, das folgende CSS erschien im Projekt: <br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: green; } <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; }</code> </pre><br>  Sie sind ein CSS-Minifier.  Wie würden Sie es drücken? <br><br>  Ich denke, Ihre Antwort lautet ungefähr so: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  Jetzt werden wir überprüfen, was die üblichen Minifikatoren tun.  Geben Sie unseren Code in einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Online-Minifier ein</a> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  Warum konnte er nicht? <br><br>  Der Minifier befürchtet, dass aufgrund einer Änderung der Reihenfolge der Stildeklaration etwas kaputt geht.  Wenn das Projekt beispielsweise diesen Code hat: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component1__title component2__title"</span></span></span><span class="hljs-tag">&gt;</span></span>Some weird title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Wegen dir wird der Titel rot und der Online-Minifier verlässt die richtige Reihenfolge der Stildeklaration und wird grün.  Natürlich wissen Sie, dass es niemals den Schnittpunkt von component1__title und component2__title geben wird, da sie sich in verschiedenen Komponenten befinden.  Aber wie soll man das dem Minifier sagen? <br><br>  Nachdem ich die Dokumentation durchsucht hatte, fand ich die Möglichkeit, den Kontext für die Verwendung von Klassen nur mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">csso anzugeben</a> .  Und er hat keine bequeme Lösung für ein sofort einsatzbereites Webpack.  Um weiter zu gehen, brauchen wir ein kleines Fahrrad. <br><br>  Sie müssen die Klassennamen jeder Komponente in separaten Arrays kombinieren und in csso angeben.  Etwas früher haben wir minimierte Klassennamen nach diesem Muster generiert: '[componentId] _ [classNameId]'.  Klassennamen können also einfach durch den ersten Teil des Namens kombiniert werden! <br><br>  Schnallen Sie sich an und schreiben Sie Ihr Plugin: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cssoLoader = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/cssoLoader'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> plugins: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cssoLoader(), ], };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* cssoLoader.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RawSource = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-sources/lib/RawSource'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopes = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./helpers/getScopes'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isCssFilename = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename</span></span></span><span class="hljs-function"> =&gt;</span></span> /\.css$/.test(filename); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cssoPlugin</span></span></span><span class="hljs-class"> </span></span>{ apply(compiler) { compiler.hooks.compilation.tap(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (compilation) =&gt; { compilation.hooks.optimizeChunkAssets.tapAsync(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (chunks, callback) =&gt; { chunks.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    CSS  chunk.files.forEach((filename) =&gt; { if (!isCssFilename(filename)) { return; } const asset = compilation.assets[filename]; const source = asset.source(); //  ast  CSS  const ast = csso.syntax.parse(source); //        const scopes = getScopes(ast); //  ast const { ast: compressedAst } = csso.compress(ast, { usage: { scopes, }, }); const minifiedCss = csso.syntax.generate(compressedAst); compilation.assets[filename] = new RawSource(minifiedCss); }); }); callback(); }); }); } } /*    sourceMap,     ,       https://github.com/zoobestik/csso-webpack-plugin" */</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopes.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,          ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getComponentId = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">className</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tokens = className.split(<span class="hljs-string"><span class="hljs-string">'_'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   ,   //   [componentId]_[classNameId], //     if (tokens.length !== 2) { return 'default'; } return tokens[0]; }; module.exports = (ast) =&gt; { const scopes = {}; //      csso.syntax.walk(ast, (node) =&gt; { if (node.type !== 'ClassSelector') { return; } const componentId = getComponentId(node.name); if (!scopes[componentId]) { scopes[componentId] = []; } if (!scopes[componentId].includes(node.name)) { scopes[componentId].push(node.name); } }); return Object.values(scopes); };</span></span></code> </pre><br>  Und es war nicht so schwierig, oder?  Normalerweise komprimiert diese Minimierung das CSS zusätzlich um 3-6%. <br><br><h2>  War es das wert? </h2><br>  Natürlich. <br><br>  In meinen Anwendungen trat schließlich ein schnelles Hot-Reload auf, und CSS begann, in Stücke zu zerfallen und durchschnittlich 40% weniger zu wiegen. <br><br>  Dies beschleunigt das Laden der Website und verkürzt die Zeit für das Parsen von Stilen, was nicht nur Benutzer, sondern auch CEOs betrifft. <br><br>  Der Artikel ist stark gewachsen, aber ich bin froh, dass jemand ihn bis zum Ende scrollen konnte.  Danke für deine Zeit! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/wm/b8/cdwmb8ygmq0mysnve4zjina7-iw.png"></div><br><h4>  Verwendete Materialien </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Reduzierung der CSS-Bundle-Größe um 70% durch Ausschneiden der Klassennamen und Verwenden der Bereichsisolierung</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428800/">https://habr.com/ru/post/de428800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428790/index.html">Wir schreiben einen Bot-Chat für VKontakte in Python mit Longpoll. Teil Zwei Doppelschleifen, Ausnahmen und andere Häresien</a></li>
<li><a href="../de428792/index.html">Der neue Apple T2-Chip macht es schwierig, über das eingebaute Mikrofon des Laptops zu hören</a></li>
<li><a href="../de428794/index.html">Überblick über die grundlegenden Methoden der mathematischen Optimierung bei Problemen mit Einschränkungen</a></li>
<li><a href="../de428796/index.html">Echtzeit-Manipulation von Maschen auf Einheit</a></li>
<li><a href="../de428798/index.html">Wie man einen Indie-Entwickler überlebt. Teil 2</a></li>
<li><a href="../de428806/index.html">Consumer Check Analysis: Was sie bei Amazon kaufen</a></li>
<li><a href="../de428808/index.html">Wenig Bequemlichkeit im Studentenleben</a></li>
<li><a href="../de428810/index.html">18 Materialien zur digitalen Technologie in Audio</a></li>
<li><a href="../de428812/index.html">TypeScript: Deserialisieren von JSON in Klassen mit Typüberprüfung für Eigenschaften</a></li>
<li><a href="../de428814/index.html">Produktabgleich mit Elasticsearch für den Preisüberwachungsservice von Wettbewerbern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>