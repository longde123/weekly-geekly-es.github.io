<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê´ üéØ ‚ô¶Ô∏è Erstellen des allgegenw√§rtigen Begr√º√üungsbildschirms unter iOS üåù üí≤ üôÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Ich werde √ºber die Implementierung des Animations√ºbergangs vom Begr√º√üungsbildschirm zu anderen Bildschirmen der Anwendung sprechen. Die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen des allgegenw√§rtigen Begr√º√üungsbildschirms unter iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/456394/"><img src="https://habrastorage.org/webt/po/rm/6t/porm6txa_jiiq2ua9zvrkzw8tey.jpeg"><br><br>  Hallo Habr! <br><br>  Ich werde √ºber die Implementierung des Animations√ºbergangs vom Begr√º√üungsbildschirm zu anderen Bildschirmen der Anwendung sprechen.  Die Aufgabe entstand im Rahmen eines globalen Rebrandings, bei dem der Begr√º√üungsbildschirm und das Erscheinungsbild des Produkts nicht ge√§ndert werden konnten. <br><br>  F√ºr viele Entwickler, die an gro√üen Projekten beteiligt sind, wird das L√∂sen der Probleme beim Erstellen sch√∂ner Animationen zu einem Hauch frischer Luft in der Welt der Fehler, komplexen Funktionen und Hotfixes.  Solche Aufgaben sind relativ einfach zu implementieren, und das Ergebnis ist angenehm f√ºr das Auge und sieht sehr beeindruckend aus!  Es gibt jedoch Zeiten, in denen Standardans√§tze nicht anwendbar sind und Sie dann alle Arten von Problemumgehungen finden m√ºssen. <br><a name="habracut"></a><br>  Auf den ersten Blick scheint die Erstellung von Animationen bei der Aktualisierung des Begr√º√üungsbildschirms am schwierigsten zu sein, und der Rest ist ‚ÄûRoutinearbeit‚Äú.  Die klassische Situation: Zuerst zeigen wir einen Bildschirm und dann √∂ffnen wir mit einem benutzerdefinierten √úbergang den n√§chsten - alles ist einfach! <br><br>  Als Teil der Animation m√ºssen Sie ein Loch in den Begr√º√üungsbildschirm bohren, in dem der Inhalt des n√§chsten Bildschirms angezeigt wird. Das hei√üt, wir m√ºssen auf jeden Fall wissen, welche <code>view</code> unter dem Begr√º√üungsbildschirm angezeigt wird.  Nach dem Starten von Yula wird das Band ge√∂ffnet, sodass es logisch w√§re, eine Verbindung zur <code>view</code> entsprechenden Controllers herzustellen. <br><br>  Was aber, wenn Sie die Anwendung mit einer Push-Benachrichtigung ausf√ºhren, die zum Benutzerprofil f√ºhrt?  Oder eine Produktkarte √ºber einen Browser √∂ffnen?  Dann sollte der n√§chste Bildschirm √ºberhaupt kein Band sein (dies ist weit von allen m√∂glichen F√§llen entfernt).  Und obwohl alle √úberg√§nge nach dem √ñffnen des Hauptbildschirms vorgenommen werden, ist die Animation an eine bestimmte <code>view</code> gebunden, aber welcher Controller? <br><br>  Um <s>Kr√ºcken</s> vieler <code>if-else</code> Bl√∂cke f√ºr jede Situation zu vermeiden, wird der <code>UIWindow</code> auf der <code>UIWindow</code> Ebene <code>UIWindow</code> .  Der Vorteil dieses Ansatzes ist, dass es uns absolut egal ist, was unter dem Splash passiert: Im Hauptfenster der Anwendung kann ein Band geladen, eingeblendet oder ein animierter √úbergang zu einem Bildschirm vorgenommen werden.  Als n√§chstes werde ich detailliert auf die Implementierung unserer gew√§hlten Methode eingehen, die aus den folgenden Schritten besteht: <br><br><ul><li>  Begr√º√üungsbildschirm vorbereiten. <br></li><li>  Animation des Erscheinungsbildes. <br></li><li>  Animation ausblenden. <br></li></ul><br><h2>  Vorbereitung des Begr√º√üungsbildschirms </h2><br>  Zuerst m√ºssen Sie einen statischen Begr√º√üungsbildschirm vorbereiten, dh einen Bildschirm, der sofort beim Start der Anwendung angezeigt wird.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie haben zwei M√∂glichkeiten</a> : <code>LaunchScreen.storyboard</code> Bilder mit unterschiedlichen Aufl√∂sungen f√ºr jedes Ger√§t <code>LaunchScreen.storyboard</code> oder <code>LaunchScreen.storyboard</code> diesen Bildschirm in <code>LaunchScreen.storyboard</code> .  Die zweite Option ist schneller, bequemer und wird von Apple selbst empfohlen. Wir werden sie daher verwenden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gb/nt/dp/gbntdpxhdmuulde5w2eed-pbksg.png" width="300"></div><br>  Alles ist einfach: <code>imageView</code> mit Farbverlaufshintergrund und <code>imageView</code> mit Logo. <br><br>  Wie Sie wissen, kann dieser Bildschirm nicht animiert werden. Sie m√ºssen daher einen anderen, visuell identischen Bildschirm erstellen, damit der √úbergang zwischen ihnen unsichtbar ist.  <code>Main.storyboard</code> Sie in <code>Main.storyboard</code> einen <code>ViewController</code> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/km/hn/j1kmhncns4proxlf8i3hi8pf0su.png" width="300"></div><br>  Der Unterschied zum vorherigen Bildschirm besteht darin, dass es eine andere <code>imageView</code> in die zuf√§lliger Text eingesetzt wird (nat√ºrlich wird er zun√§chst ausgeblendet).  Erstellen Sie nun eine Klasse f√ºr diesen Controller: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logoImageView: <span class="hljs-type"><span class="hljs-type">UIImageView!</span></span> <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textImageView: <span class="hljs-type"><span class="hljs-type">UIImageView!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textImage: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() textImageView.image = textImage } }</code> </pre> <br>  Zus√§tzlich zu den <code>IBOutlet</code> f√ºr die Elemente, die animiert werden sollen, verf√ºgt diese Klasse auch √ºber eine <code>textImage</code> Eigenschaft - ein zuf√§llig ausgew√§hltes Bild wird an sie √ºbergeben.  <code>Main.storyboard</code> wir nun zu <code>Main.storyboard</code> und weisen den entsprechenden Controller auf die <code>SplashViewController</code> Klasse hin.  <code>imageView</code> gleichzeitig eine <code>imageView</code> mit einem Screenshot von Yula in den anf√§nglichen <code>ViewController</code> sodass unter dem <code>ViewController</code> kein leerer Bildschirm angezeigt wird. <br><br>  Jetzt brauchen wir einen Moderator, der f√ºr die Logik des Ein- und Ausblendens des Schr√§gstrichs verantwortlich ist.  Wir schreiben das Protokoll daf√ºr und erstellen sofort eine Klasse: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashPresenterDescription</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismiss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashPresenter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashPresenterDescription</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//     } func dismiss(completion: @escaping () -&gt; Void) { //     } }</span></span></code> </pre> <br>  Das gleiche Objekt w√§hlt Text f√ºr einen Begr√º√üungsbildschirm aus.  Der Text wird als Bild angezeigt, daher m√ºssen Sie die entsprechenden Ressourcen in <code>Assets.xcassets</code> .  Die Namen der Ressourcen sind bis auf die Nummer identisch - sie werden zuf√§llig generiert: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textImage: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> textsCount = <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageNumber = <span class="hljs-type"><span class="hljs-type">Int</span></span>.random(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>...textsCount) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageName = <span class="hljs-string"><span class="hljs-string">"i-splash-text-\(imageNumber)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: imageName) }()</code> </pre> <br>  Es war kein Zufall, dass ich <code>textImage</code> nicht zu einer gew√∂hnlichen Eigenschaft gemacht habe, n√§mlich <code>lazy</code> . Sp√§ter werden Sie verstehen, warum. <br><br>  Ganz am Anfang habe ich versprochen, dass der <code>UIWindow</code> in einem separaten <code>UIWindow</code> angezeigt wird. Dazu ben√∂tigen Sie: <br><br><ul><li>  ein <code>UIWindow</code> erstellen; <br></li><li>  Erstellen Sie einen <code>SplashViewController</code> und machen Sie ihn zu <code>rootViewController</code> `ohm; <br></li><li>  <code>windowLevel</code> <code>.normal</code> so ein, dass <code>windowLevel</code> gr√∂√üer als <code>.normal</code> (der Standardwert) ist, damit dieses Fenster √ºber dem <code>.normal</code> angezeigt wird. <br></li></ul><br>  <code>SplashPresenter</code> in <code>SplashPresenter</code> hinzu: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foregroundSplashWindow: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashViewController = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.splashViewController(with: textImage) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashWindow = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.splashWindow(windowLevel: .normal + <span class="hljs-number"><span class="hljs-number">1</span></span>, rootViewController: splashViewController) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> splashWindow }() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">splashWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(windowLevel: UIWindow.Level, rootViewController: SplashViewController?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashWindow = <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>(frame: <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds) splashWindow.windowLevel = windowLevel splashWindow.rootViewController = rootViewController <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> splashWindow } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">splashViewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with textImage: UIImage?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">SplashViewController?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> storyboard = <span class="hljs-type"><span class="hljs-type">UIStoryboard</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Main"</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewController = storyboard.instantiateViewController(withIdentifier: <span class="hljs-string"><span class="hljs-string">"SplashViewController"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashViewController = viewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span> splashViewController?.textImage = textImage <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> splashViewController }</code> </pre> <br>  Es mag seltsam sein, dass die Erstellung von <code>splashViewController</code> und <code>splashWindow</code> in separaten Funktionen <code>splashWindow</code> ist, aber sp√§ter wird dies n√ºtzlich sein. <br><br>  Wir haben noch nicht begonnen, Animationslogik zu schreiben, und <code>SplashPresenter</code> bereits viel Code.  Daher schlage ich vor, eine Entit√§t zu erstellen, die sich direkt mit Animation befasst (plus dieser Aufteilung der Zust√§ndigkeiten): <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashAnimatorDescription</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateAppearance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateDisappearance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashAnimator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashAnimatorDescription</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> foregroundSplashWindow: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> foregroundSplashViewController: <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(foregroundSplashWindow: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.foregroundSplashWindow = foregroundSplashWindow <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> foregroundSplashViewController = foregroundSplashWindow.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"Splash window doesn't have splash root view controller!"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.foregroundSplashViewController = foregroundSplashViewController } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateAppearance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//     } func animateDisappearance(completion: @escaping () -&gt; Void) { //     }</span></span></code> </pre> <br>  <code>rootViewController</code> wird an den Konstruktor √ºbergeben, und der <code>rootViewController</code> wird der <code>rootViewController</code> "extrahiert", der auch in Eigenschaften wie <code>rootViewController</code> gespeichert wird. <br><br>  Zu <code>SplashPresenter</code> : <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animator: <span class="hljs-type"><span class="hljs-type">SplashAnimatorDescription</span></span> = <span class="hljs-type"><span class="hljs-type">SplashAnimator</span></span>(foregroundSplashWindow: foregroundSplashWindow)</code> </pre> <br>  und seine <code>present</code> und fixen <code>dismiss</code> festlegen: <br><br><pre> <code class="swift hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { animator.animateAppearance() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismiss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { animator.animateDisappearance(completion: completion) }</code> </pre> <br>  Alles, der langweiligste Teil dahinter, Sie k√∂nnen endlich die Animation starten! <br><br><h2>  Aussehensanimation </h2><br>  Beginnen wir mit der Animation des Erscheinungsbilds des Begr√º√üungsbildschirms. Es ist ganz einfach: <br><br><ul><li>  Das Logo wird <code>logoImageView</code> ( <code>logoImageView</code> ). <br></li><li>  Der Text erscheint auf dem Fader und steigt etwas an ( <code>textImageView</code> ). <br></li></ul><br>  Ich <code>UIWindow</code> Sie daran erinnern, dass <code>UIWindow</code> standardm√§√üig <code>UIWindow</code> erstellt wird. Es gibt zwei M√∂glichkeiten, dies zu beheben: <br><br><ul><li>  Rufen Sie die Methode <code>makeKeyAndVisible</code> . <br></li><li>  set Eigenschaft <code>isHidden = false</code> . <br></li></ul><br>  Die zweite Methode ist f√ºr uns geeignet, da wir nicht m√∂chten <code>foregroundSplashWindow</code> dass <code>keyWindow</code> zu <code>keyWindow</code> . <br><br>  In diesem <code>SplashAnimator</code> implementieren <code>SplashAnimator</code> die <code>animateAppearance()</code> -Methode in <code>animateAppearance()</code> : <br><br><pre> <code class="swift hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateAppearance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { foregroundSplashWindow.isHidden = <span class="hljs-literal"><span class="hljs-literal">false</span></span> foregroundSplashViewController.textImageView.transform = <span class="hljs-type"><span class="hljs-type">CGAffineTransform</span></span>(translationX: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, animations: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.foregroundSplashViewController.logoImageView.transform = <span class="hljs-type"><span class="hljs-type">CGAffineTransform</span></span>(scaleX: <span class="hljs-number"><span class="hljs-number">88</span></span> / <span class="hljs-number"><span class="hljs-number">72</span></span>, y: <span class="hljs-number"><span class="hljs-number">88</span></span> / <span class="hljs-number"><span class="hljs-number">72</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.foregroundSplashViewController.textImageView.transform = .identity }) foregroundSplashViewController.textImageView.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.15</span></span>, animations: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.foregroundSplashViewController.textImageView.alpha = <span class="hljs-number"><span class="hljs-number">1</span></span> }) }</code> </pre> <br>  Ich wei√ü nichts √ºber dich, aber ich m√∂chte das Projekt so schnell wie m√∂glich starten und sehen, was passiert ist!  Es bleibt nur <code>AppDelegate</code> zu √∂ffnen, dort die Eigenschaft <code>AppDelegate</code> hinzuzuf√ºgen und die <code>present</code> Methode darauf aufzurufen.  Gleichzeitig rufen wir nach 2 Sekunden "Entlassen" auf <code>dismiss</code> damit wir nicht zu dieser Datei zur√ºckkehren m√ºssen: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> splashPresenter: <span class="hljs-type"><span class="hljs-type">SplashPresenter?</span></span> = <span class="hljs-type"><span class="hljs-type">SplashPresenter</span></span>() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { splashPresenter?.present() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> delay: <span class="hljs-type"><span class="hljs-type">TimeInterval</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: .now() + delay) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.splashPresenter?.dismiss { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.splashPresenter = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  Das Objekt selbst wird nach dem Ausblenden des Splashs aus dem Speicher gel√∂scht. <br><br>  Hurra, du kannst rennen! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tt/rq/fp/ttrqfpp-qx683tpuip5dk-6ga20.gif" width="300"></div><br><h2>  Animation ausblenden </h2><br>  Leider (oder zum Gl√ºck) werden 10 Codezeilen mit der Animation des Versteckens nicht fertig.  Es ist notwendig, ein Durchgangsloch zu machen, das sich noch dreht und vergr√∂√üert!  Wenn Sie dachten, dass dies mit einer Maske m√∂glich ist, dann haben Sie absolut Recht! <br><br>  Wir f√ºgen der <code>layer</code> Hauptanwendungsfensters eine Maske hinzu (wir m√∂chten nicht an einen bestimmten Controller binden).  Lassen Sie es uns sofort tun und gleichzeitig foregroundSplashWindow ausblenden, da weitere Aktionen darunter ausgef√ºhrt werden. <br><br><pre> <code class="swift hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateDisappearance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> window = <span class="hljs-type"><span class="hljs-type">UIApplication</span></span>.shared.delegate?.window, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainWindow = window <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"Application doesn't have a window!"</span></span>) } foregroundSplashWindow.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mask = <span class="hljs-type"><span class="hljs-type">CALayer</span></span>() mask.frame = foregroundSplashViewController.logoImageView.frame mask.contents = <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span>.logoImageBig.cgImage mainWindow.layer.mask = mask }</code> </pre> <br>  Es ist wichtig zu beachten, dass ich <code>isHidden</code> durch die <code>alpha</code> Eigenschaft versteckt habe und nicht <code>isHidden</code> (andernfalls <code>isHidden</code> der Bildschirm).  Ein weiterer interessanter Punkt: Da diese Maske w√§hrend der Animation zunimmt, m√ºssen Sie ein Logo mit h√∂herer Aufl√∂sung verwenden (z. B. 1024 x 1024).  Also habe ich <code>SplashViewController</code> hinzugef√ºgt: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logoImageBig: <span class="hljs-type"><span class="hljs-type">UIImage</span></span> = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"splash-logo-big"</span></span>)!</code> </pre> <br>  √úberpr√ºfen Sie, was passiert ist? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l6/dd/ka/l6ddkai2i4t09lmwf4acyejc6o4.png" width="300"></div><br>  Ich wei√ü, jetzt sieht es nicht sehr beeindruckend aus, aber alles ist vor uns, wir gehen weiter!  Besonders aufmerksam kann man feststellen, dass das Logo w√§hrend der Animation nicht sofort, sondern f√ºr einige Zeit transparent wird.  <code>mainWindow</code> Sie dazu in <code>mainWindow</code> zu allen <code>subviews</code> eine <code>imageView</code> mit einem Logo hinzu, das durch die √úberblendung ausgeblendet wird. <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> maskBackgroundView = <span class="hljs-type"><span class="hljs-type">UIImageView</span></span>(image: <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span>.logoImageBig) maskBackgroundView.frame = mask.frame mainWindow.addSubview(maskBackgroundView) mainWindow.bringSubviewToFront(maskBackgroundView)</code> </pre> <br>  Wir haben also ein Loch in Form eines Logos und unter dem Loch das Logo selbst. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vy/so/dc/vysodczh_epg4meys0hfghxtxgk.png" width="300"></div><br>  Nun zur√ºck zum Ort eines sch√∂nen Verlaufshintergrunds und Textes.  Irgendwelche Ideen, wie das geht? <br>  Ich habe: ein anderes <code>UIWindow</code> unter <code>mainWindow</code> ( <code>mainWindow</code> mit einem kleineren <code>windowLevel</code> nennen wir es <code>backgroundSplashWindow</code> ), und dann sehen wir es anstelle eines schwarzen Hintergrunds.  Und nat√ºrlich hat der <code>rootViewController'</code> einen <code>SplashViewContoller</code> , nur Sie m√ºssen das <code>logoImageView</code> .  Erstellen Sie dazu eine Eigenschaft in <code>SplashViewController</code> : <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logoIsHidden: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  <code>viewDidLoad()</code> in der <code>viewDidLoad()</code> -Methode <code>viewDidLoad()</code> hinzu: <br><br><pre> <code class="swift hljs"> logoImageView.isHidden = logoIsHidden</code> </pre> <br>  <code>SplashPresenter</code> : <code>SplashPresenter</code> in der <code>splashViewController <i>(with textImage: UIImage?)</i></code> <code>logoIsHidden: Bool</code> weiteren <code>logoIsHidden: Bool</code> Parameter hinzu, der an den <code>SplashViewController</code> : <br><br><pre> <code class="swift hljs">splashViewController?.logoIsHidden = logoIsHidden</code> </pre> <br>  Wenn <code>foregroundSplashWindow</code> erstellt wird, muss dementsprechend <code>false</code> an diesen Parameter und <code>true</code> f√ºr <code>backgroundSplashWindow</code> : <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backgroundSplashWindow: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashViewController = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.splashViewController(with: textImage, logoIsHidden: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splashWindow = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.splashWindow(windowLevel: .normal - <span class="hljs-number"><span class="hljs-number">1</span></span>, rootViewController: splashViewController) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> splashWindow }()</code> </pre> <br>  Sie m√ºssen dieses Objekt auch durch den Konstruktor in <code>SplashAnimator</code> (√§hnlich wie bei <code>SplashAnimator</code> ) und dort die Eigenschaften hinzuf√ºgen: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> backgroundSplashWindow: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> backgroundSplashViewController: <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span></code> </pre> <br>  Damit anstelle eines schwarzen Hintergrunds der gleiche Begr√º√üungsbildschirm angezeigt wird, m√ºssen Sie kurz vor dem Ausblenden von <code>foregroundSplashWindow</code> <code>backgroundSplashWindow</code> : <br><br><pre> <code class="swift hljs"> backgroundSplashWindow.isHidden = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Stellen Sie sicher, dass der Plan erfolgreich war: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m0/z8/3o/m0z83orvkiokxp5wtqqopw690-w.png" width="300"></div><br>  Der interessanteste Teil ist jetzt die Animation zum Ausblenden!  Da Sie <code>CALayer</code> und nicht <code>UIView</code> animieren <code>CALayer</code> , <code>UIView</code> wir uns an <code>CoreAnimation</code> um Hilfe zu erhalten.  Beginnen wir mit der Rotation: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRotationAnimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to layer: CALayer, duration: TimeInterval, delay: CFTimeInterval = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> animation = <span class="hljs-type"><span class="hljs-type">CABasicAnimation</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tangent = layer.position.y / layer.position.x <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> angle = -<span class="hljs-number"><span class="hljs-number">1</span></span> * atan(tangent) animation.beginTime = <span class="hljs-type"><span class="hljs-type">CACurrentMediaTime</span></span>() + delay animation.duration = duration animation.valueFunction = <span class="hljs-type"><span class="hljs-type">CAValueFunction</span></span>(name: <span class="hljs-type"><span class="hljs-type">CAValueFunctionName</span></span>.rotateZ) animation.fromValue = <span class="hljs-number"><span class="hljs-number">0</span></span> animation.toValue = angle animation.isRemovedOnCompletion = <span class="hljs-literal"><span class="hljs-literal">false</span></span> animation.fillMode = <span class="hljs-type"><span class="hljs-type">CAMediaTimingFillMode</span></span>.forwards layer.add(animation, forKey: <span class="hljs-string"><span class="hljs-string">"transform"</span></span>) }</code> </pre> <br>  Wie Sie sehen k√∂nnen, wird der Drehwinkel basierend auf der Gr√∂√üe des Bildschirms berechnet, sodass sich Yula auf allen Ger√§ten in die obere linke Ecke dreht. <br><br>  Logo-Skalierungsanimation: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addScalingAnimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to layer: CALayer, duration: TimeInterval, delay: CFTimeInterval = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> animation = <span class="hljs-type"><span class="hljs-type">CAKeyframeAnimation</span></span>(keyPath: <span class="hljs-string"><span class="hljs-string">"bounds"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> width = layer.frame.size.width <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = layer.frame.size.height <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> coefficient: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> = <span class="hljs-number"><span class="hljs-number">18</span></span> / <span class="hljs-number"><span class="hljs-number">667</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> finalScale = <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds.height * coeficient <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> scales = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.85</span></span>, finalScale] animation.beginTime = <span class="hljs-type"><span class="hljs-type">CACurrentMediaTime</span></span>() + delay animation.duration = duration animation.keyTimes = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] animation.values = scales.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { <span class="hljs-type"><span class="hljs-type">NSValue</span></span>(cgRect: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, width: width * $<span class="hljs-number"><span class="hljs-number">0</span></span>, height: height * $<span class="hljs-number"><span class="hljs-number">0</span></span>)) } animation.timingFunctions = [<span class="hljs-type"><span class="hljs-type">CAMediaTimingFunction</span></span>(name: <span class="hljs-type"><span class="hljs-type">CAMediaTimingFunctionName</span></span>.easeInEaseOut), <span class="hljs-type"><span class="hljs-type">CAMediaTimingFunction</span></span>(name: <span class="hljs-type"><span class="hljs-type">CAMediaTimingFunctionName</span></span>.easeOut)] animation.isRemovedOnCompletion = <span class="hljs-literal"><span class="hljs-literal">false</span></span> animation.fillMode = <span class="hljs-type"><span class="hljs-type">CAMediaTimingFillMode</span></span>.forwards layer.add(animation, forKey: <span class="hljs-string"><span class="hljs-string">"scaling"</span></span>) }</code> </pre> <br>  Es lohnt sich, auf <code>finalScale</code> zu <code>finalScale</code> : Die endg√ºltige Skala wird auch in Abh√§ngigkeit von der Gr√∂√üe des Bildschirms (im Verh√§ltnis zur H√∂he) berechnet.  Das hei√üt, mit einer Bildschirmh√∂he von 667 Punkten (iPhone 6) sollte sich Yula um das 18-fache erh√∂hen. <br><br>  Aber zuerst nimmt sie leicht ab (gem√§√ü den zweiten Elementen in den <code>keyTimes</code> <code>scales</code> und <code>keyTimes</code> ).  Das hei√üt, zum Zeitpunkt <code>0.2 * duration</code> (wobei <code>duration</code> die Gesamtdauer der Skalierungsanimation ist) betr√§gt Yulas Skalierung 0,85. <br><br>  Wir sind schon am Ziel!  <code>animateDisappearance</code> Methode <code>animateDisappearance</code> alle Animationen aus: <br><br>  1) Skalierung des Hauptfensters ( <code>mainWindow</code> ). <br>  2) Drehung, Skalierung, Verschwinden des Logos ( <code>maskBackgroundView</code> ). <br>  3) Drehung, Skalierung des ‚ÄûLochs‚Äú ( <code>mask</code> ). <br>  4) Das Verschwinden des Textes ( <code>textImageView</code> ). <br><br><pre> <code class="swift hljs"> <span class="hljs-type"><span class="hljs-type">CATransaction</span></span>.setCompletionBlock { mainWindow.layer.mask = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> completion() } <span class="hljs-type"><span class="hljs-type">CATransaction</span></span>.begin() mainWindow.transform = <span class="hljs-type"><span class="hljs-type">CGAffineTransform</span></span>(scaleX: <span class="hljs-number"><span class="hljs-number">1.05</span></span>, y: <span class="hljs-number"><span class="hljs-number">1.05</span></span>) <span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, animations: { mainWindow.transform = .identity }) [mask, maskBackgroundView.layer].forEach { layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> addScalingAnimation(to: layer, duration: <span class="hljs-number"><span class="hljs-number">0.6</span></span>) addRotationAnimation(to: layer, duration: <span class="hljs-number"><span class="hljs-number">0.6</span></span>) } <span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, delay: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, options: [], animations: { maskBackgroundView.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> }) { <span class="hljs-number"><span class="hljs-number">_</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> maskBackgroundView.removeFromSuperview() } <span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.backgroundSplashViewController.textImageView.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-type"><span class="hljs-type">CATransaction</span></span>.commit()</code> </pre> <br>  Ich habe <code>CATransaction</code> verwendet, um die Animation zu vervollst√§ndigen.  In diesem Fall ist es bequemer als <code>animationGroup</code> , da nicht alle Animationen √ºber <code>CAAnimation</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/io/_a/0c/io_a0ccqkg672rhvlb52tluudgq.gif" width="300"></div><br><h2>  Fazit </h2><br>  So haben wir am Ausgang eine Komponente erhalten, die nicht vom Kontext des Anwendungsstarts abh√§ngt (ob es sich um einen Diplink, eine Push-Benachrichtigung, einen normalen Start oder etwas anderes handelt).  Die Animation funktioniert trotzdem richtig! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie k√∂nnen das Projekt hier herunterladen.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456394/">https://habr.com/ru/post/de456394/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456380/index.html">Tag der offenen T√ºr der Fakult√§t f√ºr Programmierung in der Netologie</a></li>
<li><a href="../de456382/index.html">Zusammenarbeit und Automatisierung im Frontend. Was wir aus 13 Schulen gelernt haben</a></li>
<li><a href="../de456386/index.html">√ñffnen Sie Bibliotheken zur Visualisierung von Audioinhalten</a></li>
<li><a href="../de456388/index.html">Diagnoseentwicklungsdiagramm in PVS-Studio</a></li>
<li><a href="../de456392/index.html">Parsim 25 TB mit AWK und R.</a></li>
<li><a href="../de456398/index.html">Vue-Cli-Plugins, die mit komplexen Daten und eigenschaftsbasierten Tests arbeiten - Ank√ºndigung des Panda-Meetup-Frontends</a></li>
<li><a href="../de456400/index.html">Warum Wettk√§mpfe besser sind als Pauken: Unsere Erfahrung mit Gamification</a></li>
<li><a href="../de456402/index.html">Z√§hne der Weisheit: Pull-Pull</a></li>
<li><a href="../de456404/index.html">Looper - Plugin f√ºr Sketch</a></li>
<li><a href="../de456410/index.html">Verwenden Sie GIT bei der Dokumentation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>