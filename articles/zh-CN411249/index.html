<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖲️ 〰️ 💐 我如何通过时间表和公交车来进行Yandex.Transport的运输 ⏪ 🍯 😞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="由DataArt .NET开发人员Mikhail Aksenov发布 



- Vrnbus项目的网站 （Voronezh巴士）； 
- 电报bot： @vrnbusbot ； 
- Github项目： vrntrans / vrnbus 。 
 一切如何开始 
 2014年秋天，好消息是Yand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我如何通过时间表和公交车来进行Yandex.Transport的运输</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/411249/"><img src="https://habrastorage.org/webt/a0/8u/mi/a08umi6_8yn4eobkvs63zv_s9tq.jpeg"><br><br>  <i>由DataArt .NET开发人员Mikhail Aksenov发布</i> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vrnbus项目的网站</a> （Voronezh巴士）； </li><li> 电报bot： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@vrnbusbot</a> ； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>项目： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vrntrans / vrnbus</a> 。 </li></ul><br><h2> 一切如何开始 </h2><br>  2014年秋天，好消息是Yandex.Transport在沃罗涅日（Voronezh）推出，显示了公共汽车和无轨电车的动向。 在公共汽车站很酷的地方，打开了时间表，然后发现您的巴士将在5分钟内开通。 <br><br> 但是几个月后，一切都在完全可预测的情况下进行了。 由于沃罗涅日从手推车到小巴的所有运输都是现金操作，因此每个驾驶员都希望尽可能多地运送乘客。 结果，他们之间安排了比赛。 <br><br> 驾驶员使用这项新服务在地图上互相跟踪，从而超越并吸引了竞争对手。 一些人开始损失收入，他们开始向路线所有者投诉，然后去找人出售带有GLONASS和GPS的设备，并将有关汽车行驶的数据发送给Yandex。 应车队所有者的要求，他们停止发送信息，公共汽车立即开始从地图上消失。 现在，它们的数量更多了，但这仍然比实际要少得多。 <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/hy/2p/d9/hy2pd9kotq6w2jrb__n5gm8nzx0.jpeg"><br><br> 对于那些懒得进一步阅读的人，我提出了有关此主题的视频报告： <iframe width="560" height="315" src="https://www.youtube.com/embed/1OtHwGqSL04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 其余的-我将以文本形式描述该项目。 <br><br><h2> 从哪里获取数据？ </h2><br> 同时，在沃罗涅日有一个收集所有数据的地方- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">道路交通组织中心</a> （DPC）。 他们的网站上有一个庞大而沉重的Web应用程序，其中包含不可持续的JavaScript和其他工件，而其中的所有内容都带有POST请求，并且不会缓存任何内容。 使用此站点本身，您可以轻松地放置一项收集公共汽车运行数据的服务。 <br><br> 有一个选项可以让您在地图上戳一下，找出巴士何时到达以及它将是什么。 只要您大约停下来（±50米）。 在菜单中，您可以打开路线列表，并确切地看到公交车的去向，但是有一个问题-他们开的很奇怪。 例如，沿着Koltsovskaya街（您无法特别提速的中心街道），公交车以大约200 km / h的速度前后移动。 <br><br><br><h2> 为什么是Python？ </h2><br> 我选择Python是因为它很酷，捆绑了电池，依此类推；还有3.6是因为存在字符串文字的格式化，输入等等。 让我们看一下我基本使用的内容： <br><br><ul><li> 许多人抱怨说，使用各种标点符号来驾驶停车站的确切名称非常困难。 然后，我意识到了模糊搜索的可能性，并为此创建了第一个单元测试。 </li><li> 整个系统托管在Heroku上。 它是免费的，因为我没有数据库-我希望可以使用数据中心数据库。 当我意识到通过Web界面收集的数据还不够时，我就同意中心使用它。 </li><li> 实际上，托管是通过Tornado Web服务器进行的。 我认为对于使用Python遇到Web请求的任何人都是熟悉的。 </li><li> 我需要Pytz软件包，因为Heroku服务器位于不同的时区，并且数据在没有指定时区的情况下传给我。 因此，我本人负责本地化。 </li><li> 为了创建机器人，我使用了推荐的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python-telegram-bot</a>库。 这里的文档非常充足，并且总体而言，该库满足了最低可行产品要求。 最初，整个项目是一个Telegram机器人，该机器人响应发送您的位置信息后发送了公交车时间表。 </li><li>  Firebird，以前是Interbase，是一个开源数据库，我认为你们中的许多人都在使用它。 当然，它不像同一个PostgreSQL那样酷，但是对于大量查询而言，这就足够了。 在我们的情况下，不需要更多。 </li><li>  Cachetools是一个非常简单的模块，允许您缓存计算。 当然，这与网页的Memecached或缓存无关，而与需要长查询记忆的情况有关。 只需接受它，添加适当的装饰器即可，一切正常。 缓存具有不同的选项，我使用的是TTL版本，该版本将数据保存指定的时间，因为我知道数据的更新频率不会超过特定间隔（在我的情况下为30秒）。 </li></ul><br><br><h2> 机器人功能 </h2><br><ul><li>  / nextbus站点名称-预计到达时间； </li><li>  /最后的路线编号，以空格分隔-最后一站； </li><li> 位置发送-未来三站的预计到达时间； </li><li> 免费入场-路线号和到公共汽车的距离（发送位置时）。 </li></ul><br><br> 我试图充分描述这些命令，以使人们不会问如何使用它们。 基本上有两个基本命令：nextbus，当您编写停靠站的名称时，以及发送位置。 <br><br><h2> 网站功能 </h2><br> 我使<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网站</a>尽可能简约。 在第三方库中，我仅使用两个库来支持获取和承诺，因为电话中预装的浏览器的旧版本离不开它们。 如果您不支持这些方法，您将为请求本身获得非常沉重的回调面。 通过获取，一切看起来都更加优雅。 <br><br><img src="https://habrastorage.org/webt/vn/sd/gu/vnsdgutglxminl8j6wi07w4nkp0.jpeg"><br><br> 实际上，这里的功能包括4点： <br><br><ol><li>  <b>到货</b> 您可以观看停靠站。 通过单击按钮（顺便说一句，值得做更多的事情-我会考虑的！），发送您的位置，系统搜索距离您最近的三个停靠站并在其上显示信息。 您可以输入停靠站的名称并获取有关的信息。 由于几乎不需要所有20-30辆可以到达公交车站的公交车，因此可以按路线过滤它们。 </li><li>  <b>巴士</b> 第二页包含有关公共汽车的信息。 这是由于另一个故事将我推向了这个项目。 有一天，我忘记了公共汽车上的帽子，叫做控制室，解释了发生的地方。 调度员建议我在中心接我的公共汽车，他将回去，在终点站转身。 我记得我有来自交通管理中心系统的登录名和密码，但事实证明，我仍然无法通过Web界面跟踪所需汽车的位置。 我把帽子还给我，但困难很大。 <br> 我以为找公车会容易得多。 我写下了路线编号，系统会向您显示线路上的汽车，它们的当前位置以及通过的时间。 即使您知道路线号，但您知道公交车号（这种情况也会发生），您仍然可以找到它。 </li><li>  <b>地图。</b> 无需动画即可在网站上映射。 在这里，您可以从列表中选择总线，也可以手动输入数字，然后进行过滤。 地图上最多可以显示600辆公交车，尽管20辆以后很难在中心找到东西，仅是因为路线都集中在这里。 因此，最好将搜索限制为更严格的参数。 </li><li>  <b>关于项目。</b> 现在该项目有一个网站，还有一个Telegram机器人，社交网络中的群组。 </li></ol><br><br>  *** <br> 幸运的是，Python是一门开箱即用的语言。 对于简单的事情，您甚至不需要下载任何内容，只需仔细阅读文档即可。 <br><br> 当然，这些服务可以在其他已经使用的城市中完成。 在很大程度上取决于本地数据中心，例如在某些地方，在圣彼得堡甚至为开发人员提供了API。 但是，最重要的是想要改变城市的城镇居民。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN411249/">https://habr.com/ru/post/zh-CN411249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN411239/index.html">从小开始的DIY创意：灌输对自制产品的热爱</a></li>
<li><a href="../zh-CN411241/index.html">“开普勒”发现了一个奇怪的超新星：迅速着火，迅速熄灭</a></li>
<li><a href="../zh-CN411243/index.html">废物-到炉子</a></li>
<li><a href="../zh-CN411245/index.html">让我们向宇宙展示自己：文明之后将保留的灯塔</a></li>
<li><a href="../zh-CN411247/index.html">最“聪明”的孩子观看伟易达Kidizoom。 实际情况如何</a></li>
<li><a href="../zh-CN411251/index.html">用户重新发送本地驱动器上的Chrome扫描文件</a></li>
<li><a href="../zh-CN411253/index.html">中子星的合并终结了暗物质和暗能量的替代</a></li>
<li><a href="../zh-CN411255/index.html">以太坊上数百万用户的去中心化应用</a></li>
<li><a href="../zh-CN411257/index.html">在美国，他们制造了一种激光系统，可以用声音吓the敌人</a></li>
<li><a href="../zh-CN411259/index.html">我们将水表连接到智能家居</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>