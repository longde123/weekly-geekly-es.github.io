<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶üèΩ üò• üéΩ Mise en route STM32: Que sont les registres? Comment travailler avec eux? üõÉ ‚óΩÔ∏è üë¥üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Examen continu des questions fondamentales 
 Dans la le√ßon pr√©c√©dente, nous avons examin√© l'utilisation des op√©rations sur les bits et des nombres bin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mise en route STM32: Que sont les registres? Comment travailler avec eux?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/407083/"><h3>  Examen continu des questions fondamentales </h3><br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le√ßon pr√©c√©dente,</a> nous avons examin√© l'utilisation des op√©rations sur les bits et des nombres binaires, jetant ainsi les bases de l'examen d'un nouveau sujet.  Dans cette le√ßon, nous consid√©rerons une autre question: <b>que sont les registres et comment travailler avec eux</b> ? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/75/59cf75a313ee4945548871.png"></div><br><a name="habracut"></a><br><br>  Liste d'articles: <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route √âtudier STM32 ou g√©rer la lumi√®re intelligemment</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route STM32: op√©rations sur les bits</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route STM32: Que sont les registres?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment travailler avec eux?</a> </li></ol><br><br><h3>  M√©moire et registres </h3><br>  L'une des comp√©tences les plus importantes n√©cessaires lorsque vous travaillez avec des microcontr√¥leurs est la capacit√© d'interagir avec les registres.  Voyons par nous-m√™mes <b>ce que c'est</b> ? <br><br>  En g√©n√©ral, un registre est un type sp√©cial de m√©moire √† l'int√©rieur d'un microcontr√¥leur qui est utilis√© pour contr√¥ler le processeur et les p√©riph√©riques.  Chaque registre de l'architecture ARM est une cellule m√©moire et a une longueur de 32 bits, o√π chaque bit peut √™tre repr√©sent√© comme un minuscule commutateur √† l'aide duquel l'un ou l'autre param√®tre du microcontr√¥leur est contr√¥l√©. <br><br>  Chacun des registres a son propre num√©ro de s√©rie - adresse.  L'adresse du registre est indiqu√©e par un nombre de 32 bits repr√©sent√© en notation hexad√©cimale.  En √©crivant √† l'adresse du registre une certaine combinaison de uns et de z√©ros, qui sont g√©n√©ralement pr√©sent√©s en hexad√©cimal, la configuration et le contr√¥le de l'un ou l'autre n≈ìud dans MK sont effectu√©s.  Rappelons que dans un programme pour travailler avec des op√©rations sur les bits, nous pourrions repr√©senter un ensemble arbitraire de uns et de z√©ros comme un nombre hexad√©cimal.  En g√©n√©ral, il convient de noter qu'il existe deux types de registres: les registres √† usage g√©n√©ral et les registres sp√©ciaux.  Les premiers sont situ√©s √† l'int√©rieur du noyau MK et les seconds font partie de la m√©moire RAM. <br><br>  Il convient √©galement de noter que le <b>manuel de r√©f√©rence</b> , que nous avons t√©l√©charg√© dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re le√ßon</a> , est un grand livre de r√©f√©rence sur les registres contenus dans le microcontr√¥leur cible, et la biblioth√®que CMSIS nous permet de fonctionner avec des noms de registres symboliques au lieu d'adresses num√©riques.  Par exemple, nous pouvons acc√©der au registre <b>0x40011018</b> en utilisant simplement le nom symbolique <b>GPIOC_BSSR</b> .  Nous consid√©rerons des exemples sp√©cifiques de configuration lors de l'analyse de notre programme d√®s la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re le√ßon</a> . <br><br>  Ainsi, la structure du registre est g√©n√©ralement d√©crite sous la forme d'un petit tableau indiquant: <br><br><ol><li>  Enregistrer les noms et descriptions de son objectif </li><li>  Enregistrer des adresses ou un d√©calage par rapport √† l'adresse de base </li><li>  Valeurs par d√©faut apr√®s r√©initialisation </li><li>  Type d'acc√®s aux cellules du registre (lecture, √©criture, lecture / √©criture) </li><li>  Valeurs et descriptions des param√®tres des bits enregistr√©s </li></ol><br>  Regardons un exemple de travail avec des registres dans une situation sp√©cifique pour avoir une id√©e g√©n√©rale des principes de configuration du microcontr√¥leur. <br><br><h3>  Analyser le code de la premi√®re le√ßon </h3><br>  Donc, rappelons le probl√®me que nous avons r√©solu dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re le√ßon en</a> utilisant un exemple de code pr√™t √† l'emploi: nous devions √©crire un programme qui assurerait l'inclusion alternative de deux LED sur la carte Discovery (peut-√™tre pas deux si vous avez une version diff√©rente de la carte Discovery) avec un intervalle de temps . <br><br>  Jetons un autre regard sur le code du programme que nous avons utilis√© pour faire sauter notre MK √† deux pattes sur lesquelles se trouvent nos LED: <br><br><div class="spoiler">  <b class="spoiler_title">Code main.c</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f0xx.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> int main(void) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     GPIO */</span></span></span><span class="hljs-meta"> RCC-&gt;AHBENR |= RCC_AHBENR_GPIOCEN; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     PC8  PC9  Output*/</span></span></span><span class="hljs-meta"> GPIOC -&gt;MODER = 0x50000; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  Output type   Push-Pull */</span></span></span><span class="hljs-meta"> GPIOC-&gt;OTYPER = 0; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*      Low */</span></span></span><span class="hljs-meta"> GPIOC-&gt;OSPEEDR = 0; while(1) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   PC8,  PC9 */</span></span></span><span class="hljs-meta"> GPIOC-&gt;ODR = 0x100; for (int i=0; i</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;500000; i++){} //   /*   PC9,  PC8 */ GPIOC-&gt;ODR = 0x200; for (int i=0; i&lt;500000; i++){} //   } }</span></span></span></span></code> </pre> <br></div></div><br>  Tout d'abord, lorsque vous travaillez avec STM32, m√™me pour une t√¢che aussi simple que d'allumer et d'√©teindre la LED, nous devons d'abord r√©pondre √† un certain nombre de questions: <br><br><ol><li>  O√π nos LED sont-elles connect√©es?  Quelle est la conclusion du microcontr√¥leur? </li><li>  Comment activer la synchronisation sur le port GPIO souhait√©? </li><li>  Comment configurer les broches du port GPIO dont nous avons besoin pour que la LED puisse √™tre allum√©e? </li><li>  Comment allumer et √©teindre la LED? </li></ol><br>  Nous leur r√©pondrons dans l'ordre. <br><br><h3>  O√π nos LED sont-elles connect√©es?  Quelle est la conclusion du microcontr√¥leur? </h3><br>  Afin de voir o√π se trouve la carte Discovery, et en particulier les LED dont nous avons besoin, vous devez ouvrir le fichier Schematic, soit celui que nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charg√© depuis le site Web de ST,</a> soit directement depuis Keil: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/114/10d/8d0/11410d8d0dca40668773bfcf8df359a1.png"></div><br>  Sch√©ma d'ouverture, nous verrons un diagramme de tout ce qui est sur la carte - un diagramme ST-Link, une liaison de toute la p√©riph√©rie, et bien plus encore.  En ce moment, nous sommes int√©ress√©s par deux LED, nous recherchons leur d√©signation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/d29/1bb/fdf/d291bbfdf0b84397b47bd5e870588205.png"></div><br>  Comme nous pouvons le voir, nos LED sont connect√©es au port GPIOC sur 8 et 9 broches. <br><br><h3>  Comment activer la synchronisation sur le port GPIO souhait√©? </h3><br>  En g√©n√©ral, tout travail avec des p√©riph√©riques dans les microcontr√¥leurs STM32 se r√©sume √† une s√©quence d'actions standard: <br><br><ol><li>  Activation de la synchronisation du module p√©riph√©rique correspondant.  Cela se fait via le registre RCC en appliquant un signal d'horloge directement √† partir du bus sur lequel se trouve ce module.  Par d√©faut, la synchronisation de tous les p√©riph√©riques est d√©sactiv√©e pour minimiser la consommation d'√©nergie. </li><li>  R√©glage via les registres de contr√¥le, en modifiant les param√®tres sp√©cifiques √† un p√©riph√©rique sp√©cifique </li><li>  D√©marrage direct et utilisation des r√©sultats de fonctionnement du module </li></ol><br>  Autrement dit, pour commencer, nous devons ex√©cuter l'horloge sur le port GPIOC.  Cela se fait directement en acc√©dant au registre RCC charg√© de cadencer tout et de tout et d'activer le signal d'horloge du bus auquel notre port GPIO est connect√©. <br><br>  <b><i>Attention!</i></b>  <b><i>La question concernant le syst√®me d'horloge, ses param√®tres et son utilisation sera discut√©e en d√©tail dans un article s√©par√©.</i></b> <br><br>  Vous trouverez le bus auquel notre port GPIOC est connect√© dans la fiche technique de notre MK dans la section Mappage de la m√©moire du tableau 16. Adresses limites du registre p√©riph√©rique STM32F051xx. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/76e/b23/ba7/76eb23ba707340ec877e6f9184d646cc.png"></div><br>  Comme vous l'avez d√©j√† remarqu√©, le bus dont nous avons besoin est appel√© AHB2.  Afin de vous familiariser avec le registre dans lequel la synchronisation avec le port GPIO du bus AHB dont nous avons besoin est activ√©e, vous devez vous rendre dans la section correspondante du Manuel de r√©f√©rence.  Par le nom des registres, nous pouvons d√©terminer celui dont nous avons besoin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/7a/59cf7aad507f5548915177.png"></div><br>  Nous allons √† ce point et nous voyons notre registre 32 bits, son adresse de d√©calage, sa valeur par d√©faut, la fa√ßon d'acc√©der au registre et de r√©pertorier les responsabilit√©s de chaque bit du registre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/7a/59cf7add48ab9584741618.png"></div><br>  Nous regardons le tableau et voyons quelque chose qui rappelle l'option d'activer la synchronisation sur les ports GPIO.  Acc√©dez √† la description et trouvez l'option dont nous avons besoin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/7a/59cf7aeecd38a192347824.png"></div><br>  Par cons√©quent, si nous d√©finissons 19 bits √† la valeur ¬´1¬ª, cela garantira que le cadencement est activ√© sur le port I / OC, c'est-√†-dire sur notre GPIOC.  De plus, nous devons activer s√©par√©ment un bit du groupe, sans affecter le reste car  nous ne devons pas interf√©rer avec ou modifier d'autres param√®tres inutilement. <br><br>  Sur la base des mat√©riaux de la derni√®re le√ßon, nous savons que pour d√©finir un bit sp√©cifique, vous devez utiliser l'op√©ration logique ¬´OU¬ª pour ajouter la valeur actuelle du registre avec un masque qui contient les bits qui doivent √™tre activ√©s.  Par exemple, ajoutons la valeur par d√©faut du registre RCC-&gt; AHBENR, c'est-√†-dire  0x14 et le nombre 0x80000 activent ainsi l'horloge GPIOC en d√©finissant 19 bits: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/a6/59cfa6b0e049a913888413.png"></div><br><br>  Comment pouvons-nous faire cela √† partir d'un programme?  Tout est assez simple.  Dans ce cas, nous avons deux options: <br><br><ol><li>  Ecrire directement dans le registre la valeur num√©rique du registre directement via son adresse. </li><li>  Configuration √† l'aide de la biblioth√®que CMSIS </li></ol><br>  Il n'y a pas de probl√®me particulier lors de l'√©criture directe d'une valeur dans le registre, mais il y a quelques inconv√©nients importants.  Premi√®rement, un tel code devient illisible et deuxi√®mement, nous ne pouvons pas d√©terminer imm√©diatement √† quel registre telle ou telle adresse fait r√©f√©rence en m√©moire. <br><br>  Autrement dit, nous pourrions adresser les adresses des registres directement √† l'adresse et √©crire ceci: <br><br><pre> <code class="cpp hljs">__IO <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> * register_address = (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *) <span class="hljs-number"><span class="hljs-number">0x40021014</span></span>U; <span class="hljs-comment"><span class="hljs-comment">//      *(__IO uint32_t *)register_address |= 0x80000; //  19    </span></span></code> </pre><br>  La deuxi√®me option me semble la plus attractive, car  La biblioth√®que CMSIS est organis√©e de mani√®re √† ce que le registre soit accessible en utilisant uniquement son nom.  Pendant le pr√©traitement du texte du programme, le pr√©processeur remplacera automatiquement toutes les valeurs num√©riques de l'adresse de registre avant la compilation.  Regardons cette question plus en d√©tail. <br><br>  Je sugg√®re d'ouvrir notre projet, ce que nous avons fait dans la premi√®re le√ßon, ou de t√©l√©charger celui pr√©c√©demment pr√©par√© √† <a href="">partir d'ici</a> et de supprimer tout le contenu du programme, ne laissant que le fichier d'en-t√™te connect√©, la fonction main () et les instructions pour allumer l'horloge (nous en aurons besoin pour une analyse d√©taill√©e du code). <br><br>  Notre code ressemblera √† ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f0xx.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    */</span></span></span><span class="hljs-meta"> int main(void) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*     GPIO */</span></span></span><span class="hljs-meta"> RCC-&gt;AHBENR|=RCC_AHBENR_GPIOCEN; }</span></span></code> </pre><br>  Examinons plus en profondeur la biblioth√®que CMSIS pour la familiarisation. <br><br>  Afin d'aller rapidement √† l'endroit o√π telle ou telle constante ou variable est d√©clar√©e, une fonction pratique est impl√©ment√©e dans Keil.  Faites un clic droit sur la constante dont nous avons besoin, par exemple sur RCC: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/7b/59cf7b95d3c96942859803.png"></div><br>  Et nous sommes transport√©s dans les profondeurs de la biblioth√®que CMSIS, dans laquelle nous verrons que tous les registres disponibles pour le contr√¥le programmatique ont la forme de structures TypeDef, y compris notre RCC: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/80/59cf80e8c73ff245649066.png"></div><br>  Ayant √©chou√© de mani√®re similaire dans RCC_TypeDef, nous verrons une structure dans laquelle tous les champs de notre registre sont d√©crits: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/7c/59cf7c6846eae845513998.png"></div><br>  En cons√©quence, nous pouvons acc√©der en toute s√©curit√© au registre dont nous avons besoin avec un enregistrement de la forme <b>PERIPH_MODULE-&gt; INSCRIPTION</b> et lui affecter une valeur sp√©cifique. <br><br>  Outre la d√©signation mn√©monique des registres, il existe √©galement des d√©signations de bits sp√©cifiques.  Si nous ne d√©clarons pas le param√®tre <b>RCC_AHBENR_GPIOCEN</b> de notre programme, nous verrons √©galement la d√©claration de tous les param√®tres: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/8d/59cf8dd1d23df635371335.png"></div><br>  Ainsi, en utilisant la biblioth√®que CMSIS, nous obtenons un enregistrement concis et lisible du param√®tre dont nous avons besoin dans le registre, gr√¢ce √† l'installation dont nous commen√ßons le cadencement sur le port dont nous avons besoin: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     GPIO */</span></span> RCC-&gt;AHBENR|=RCC_AHBENR_GPIOCEN;</code> </pre><br>  <b><i>En tant que t√¢che:</i></b> d√©terminer, √† l'aide des capacit√©s de Keil, comment l'adresse du registre RCC-&gt; AHBENR a √©t√© obtenue en tant que 0x40021014. <br><br><h3>  Comment configurer les broches GPIO dont nous avons besoin pour pouvoir allumer la LED? </h3><br>  Ainsi, nous savons que les LED dont nous avons besoin sont connect√©es au port GPIOC aux broches PC8 et PC9.  Nous devons les configurer de telle sorte que la LED s'allume.  Je voudrais imm√©diatement faire une r√©serve que nous examinerons les ports GPIO plus en d√©tail dans un autre article et ici nous nous concentrerons sp√©cifiquement sur le travail avec les registres. <br><br>  Tout d'abord, nous devons mettre les broches PC8 et PC9 en mode de sortie.  D'autres param√®tres de port peuvent √™tre laiss√©s par d√©faut.  Acc√©dez au manuel de r√©f√©rence √† la section <b><i>9. E / S √† usage g√©n√©ral (GPIO)</i></b> et ouvrez l'√©l√©ment responsable du mode de fonctionnement des broches du port GPIO et v√©rifiez que le registre MODER est responsable de ce param√®tre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/b6/59cfb6cddbae1280161305.png"></div><br>  A en juger par la description, pour mettre les broches PC8 et PC9 en mode sortie, nous devons √©crire 01 dans les champs correspondants du registre GPIOC. <br><br>  Cela peut √™tre fait par une installation directe en utilisant des valeurs num√©riques: <br><br><ol><li>  Nous formons un num√©ro pour √©crire: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/b9/59cfb9393c701766083772.png"></div></li><li>  Nous attribuons cette valeur √† notre registre: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     PC8  PC9  Output*/</span></span> GPIOC-&gt;MODER |= <span class="hljs-number"><span class="hljs-number">0x50000</span></span>;</code> </pre><br></li></ol><br>  Ou gr√¢ce √† l'utilisation des d√©finitions de la biblioth√®que: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     GPIO */</span></span> GPIOC-&gt;MODER |= GPIO_MODER_MODER8_0 | GPIO_MODER_MODER9_0;</code> </pre><br>  Apr√®s cette instruction, nos broches PC8 et PC9 passeront en mode Sortie. <br><br><h3>  Comment allumer la LED? </h3><br>  Si nous pr√™tons attention √† la liste des registres disponibles pour contr√¥ler le port GPIO, nous pouvons voir le registre ODR: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/be/59cfbea6c1617634943312.png"></div><br>  Chacun des bits correspondants est responsable d'une des broches du port.  Vous pouvez voir sa structure ci-dessous: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/bf/59cfbf1d26664276913966.png"></div><br>  Afin de permettre un changement alternatif des √©tats des LED, il est n√©cessaire d'activer / d√©sactiver 8 et 9 bits avec un certain intervalle de temps.  Autrement dit, affectez alternativement la valeur 0x100 et 0x200 au registre. <br><br>  Nous pouvons le faire en affectant directement des valeurs au registre: <br><br><pre> <code class="cpp hljs">GPIOC-&gt;ODR = <span class="hljs-number"><span class="hljs-number">0x100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  PC8,  PC9 GPIOC-&gt;ODR = 0x200; //  PC9,  PC8</span></span></code> </pre><br>  Nous pouvons gr√¢ce √† l'utilisation des d√©finitions de la biblioth√®que: <br><br><pre> <code class="cpp hljs">GPIOC-&gt;ODR = GPIO_ODR_8; <span class="hljs-comment"><span class="hljs-comment">//  PC8,  PC9 GPIOC-&gt;ODR = GPIO_ODR_9; //  PC9,  PC8</span></span></code> </pre><br>  Mais comme le microcontr√¥leur fonctionne tr√®s rapidement - nous ne remarquerons pas le changement d'√©tat des LED et visuellement il semblera qu'elles s'allument toutes les deux en permanence.  Pour qu'ils clignotent vraiment alternativement, nous introduirons un retard artificiel sous la forme d'un cycle qui am√®nera MK √† des calculs inutiles pendant un certain temps.  Le code suivant se r√©v√©lera: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*   PC8,  PC9 */</span></span> GPIOC-&gt;ODR = GPIO_ODR_8; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">500000</span></span>; i++){} <span class="hljs-comment"><span class="hljs-comment">//   /*   PC9,  PC8 */ GPIOC-&gt;ODR = GPIO_ODR_9; for (int i=0; i&lt;500000; i++){} //  </span></span></code> </pre><br>  Sur ce point, nous pouvons mettre fin √† la connaissance initiale des registres et des m√©thodes de travail avec eux. <br><br><h3>  V√©rification des r√©sultats de notre code </h3><br>  Un petit ajout agr√©able √† la fin de l'article: Keil a un excellent outil de d√©bogage avec lequel nous pouvons √©tape par √©tape ex√©cuter notre programme et afficher l'√©tat actuel de tout bloc p√©riph√©rique.  Pour ce faire, apr√®s avoir t√©l√©charg√© le firmware apr√®s la compilation, nous pouvons cliquer sur le bouton D√©marrer la session de d√©bogage: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/d3/59cfd317272f6379966087.png"></div><br>  L'espace de travail Keil passera en mode d√©bogage.  Nous pouvons contr√¥ler la progression du programme en utilisant ces boutons: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/d3/59cfd38913bf1809956510.png"></div><br>  Et il existe une autre fonction pratique pour travailler avec des p√©riph√©riques en mode d√©bogage, elle vous permet de visualiser l'√©tat actuel des registres et de changer leur √©tat d'un simple clic de souris. <br><br>  Pour l'utiliser, vous devez vous rendre sur l'unit√© p√©riph√©rique correspondante et une fen√™tre s'ouvrira √† droite avec les registres et leur valeur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/d3/59cfd3ca68b84248376432.png"></div><br>  Si vous cliquez sur l'un des √©l√©ments de ce menu, vous verrez l'adresse du registre et sa br√®ve description.  Vous pouvez √©galement afficher la description de chaque param√®tre de registre individuel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cf/d4/59cfd44d011de223116939.png"></div><br>  Essayez d'ex√©cuter ind√©pendamment le programme √©tape par √©tape, allumez / √©teignez les LED n'utilisant pas le programme, mais utilisant ce mode de fonctionnement avec le microcontr√¥leur.  Les possibilit√©s d'imagination sont vastes.  Essayez √©galement de jouer avec la dur√©e des retards, faites clignoter simultan√©ment les deux LED.  En g√©n√©ral, exp√©rimentez!  ) <br><br>  Rendez-vous dans les articles suivants! <br>  Liste d'articles: <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route √âtudier STM32 ou g√©rer la lumi√®re intelligemment</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route STM32: op√©rations sur les bits</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route STM32: Que sont les registres?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment travailler avec eux?</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr407083/">https://habr.com/ru/post/fr407083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr407071/index.html">Les travailleurs ne devraient pas avoir peur de la robococalypse</a></li>
<li><a href="../fr407073/index.html">Demandez √† Ethan: la gravit√© z√©ro est-elle possible?</a></li>
<li><a href="../fr407075/index.html">En Russie, tous les achats en ligne co√ªtent plus cher que 20 ‚Ç¨</a></li>
<li><a href="../fr407079/index.html">Comment √©quipons-nous la blockchain</a></li>
<li><a href="../fr407081/index.html">Portrait du ph√©nom√®ne: impulsion nostalgique - cassettes et magn√©tophones</a></li>
<li><a href="../fr407085/index.html">Les scientifiques m√®nent une guerre contre le vieillissement. Mais alors quoi?</a></li>
<li><a href="../fr407087/index.html">Pilotes Tesla et 2,5 millions de tonnes de CO2</a></li>
<li><a href="../fr407093/index.html">1er octobre - Journ√©e internationale des personnes √¢g√©es</a></li>
<li><a href="../fr407095/index.html">Amour de d√©marrage fou</a></li>
<li><a href="../fr407097/index.html">Les radio-amateurs se plaignent des fausses boutiques en ligne avec des √©quipements radio - soyez prudent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>