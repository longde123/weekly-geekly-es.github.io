<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥ üéõÔ∏è üíáüèΩ Bot para monitorar servi√ßos web em meia hora: telegrama + bash + cron üå©Ô∏è ‚õµÔ∏è üÜó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Äs vezes, voc√™ precisa monitorar rapidamente um novo servi√ßo, mas n√£o h√° infraestrutura / experi√™ncia pronta em m√£os. Neste guia, em meia hora, implem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot para monitorar servi√ßos web em meia hora: telegrama + bash + cron</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483318/"><img src="https://habrastorage.org/webt/ks/-r/l9/ks-rl9jvsn3vka3r5kxkj4jvbxg.jpeg"><br><br>  √Äs vezes, voc√™ precisa monitorar rapidamente um novo servi√ßo, mas n√£o h√° infraestrutura / experi√™ncia pronta em m√£os.  Neste guia, em meia hora, implementaremos uma ferramenta para monitorar qualquer servi√ßo da Web usando apenas as ferramentas internas do ubuntu: bash, cron e curl.  Usaremos o telegrama para enviar alertas. <br><br>  "Cherry on the cake" ser√° o envolvimento emocional dos usu√°rios.  √â verificado nas pessoas - funciona. <br><a name="habracut"></a><br>  Quando criamos um chatbot no servi√ßo de telemedicina Doctor Near para determinar o n√≠vel de estresse do usu√°rio, precis√°vamos de monitoramento.  Em algumas horas, foi feito um miniprojeto, que n√£o apenas funciona muito bem, mas tamb√©m adiciona um feedback positivo. <br><br>  Para come√ßar, obtenha um reposit√≥rio com scripts: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rshekhovtsov/msms.git</code> </pre> <br>  V√° para a pasta msms e trabalhe nela. <br><br>  Se o telegrama estiver bloqueado, use um proxy.  A op√ß√£o mais f√°cil e mais confi√°vel √© a tor√ß√£o: <br><br><pre> <code class="bash hljs">sudo apt install tor sudo apt install torsocks</code> </pre> <br>  Como exemplo, configuraremos o monitoramento da p√°gina inicial do google.com em tr√™s etapas. <br><br><h2>  PASSO 1. Crie um bot no telegrama e obtenha o ID do usu√°rio </h2><br><ul><li>  Na cadeia de pesquisa de contatos no telegrama, procure <a href="https://t.me/botfather" rel="nofollow">@botfather</a> : <br><br><img src="https://habrastorage.org/webt/mf/8r/tx/mf8rtxrovcs-4r8ax2pn7fuxusc.png"><br></li><li>  Come√ßamos com o bot√£o Iniciar, digite o comando / newbot e responde a perguntas.  Voc√™ precisa ter em mente que name √© o nome do bot que ser√° exibido aos usu√°rios, e o nome de usu√°rio √© √∫nico e deve terminar em "bot": <br><br><img src="https://habrastorage.org/webt/gc/q5/fx/gcq5fxjht5xytwso83degwhmslm.png"><br><br>  Entre outras coisas, o bot emitir√° um token secreto para a API HTTP, que voc√™ precisa copiar e salvar no arquivo telegram-api-key.txt na pasta msms. <br></li><li>  Digitamos o nome do nosso bot na linha de pesquisa do telegrama e o executamos. <br></li><li>  Como toque final, adicione-nos √† lista de destinat√°rios de alertas de monitoramento: <br><br><pre> <code class="bash hljs">sudo chmod +x ./recipients-setup.sh torsocks ./recipients-setup.sh</code> </pre> <br>  O script exibir√° uma lista de chamadas recentes para o bot; deve haver uma linha com nosso ID e nome no telegrama.  N√≥s pegamos esse ID e o salvamos no arquivo services / google-recipients.txt.  Formato do arquivo: cada linha √© uma identifica√ß√£o.  Um exemplo: <br><br><pre> <code class="bash hljs">123456789 987654321</code> </pre> </li></ul><br>  Para adicionar um novo destinat√°rio, voc√™ precisa solicitar que ele inicie o bot no telegrama, execute recipients-setup.sh e adicione o ID ao arquivo. <br><br><h2>  PASSO 2. Configure o monitoramento </h2><br>  A descri√ß√£o do servi√ßo ocorre criando um arquivo ini na pasta de servi√ßos.  Cinco par√¢metros precisam ser definidos: <br><br><ol><li>  <b>MSMS_SERVICE_NAME</b> : nome do servi√ßo - ser√° usado em alertas e <b>logs de</b> monitoramento. </li><li>  <b>MSMS_SERVICE_ENDPOINT</b> : o ponto final do servi√ßo em que entraremos em contato com o curl. </li><li>  <b>MSMS_CURL_PARAMS</b> : par√¢metros de curvatura adicionais, veja o exemplo abaixo. </li><li>  <b>MSMS_EXPECTED</b> : resposta esperada do servi√ßo.  Utilizado se a resposta for curta. </li><li>  <b>MSMS_EXPECTED_FILE</b> : nome do arquivo com a resposta esperada do servi√ßo.  Se especificado, substitui MSMS_EXPECTED. </li><li>  <b>MSMS_RECIPIENTS</b> : arquivo com uma lista de destinat√°rios da notifica√ß√£o. </li></ol><br>  A solicita√ß√£o no google.com retorna um html fixo com um redirecionamento; vamos us√°-lo como a resposta esperada do servidor: <br><br><pre> <code class="bash hljs">curl google.com &gt; services/google-response.html</code> </pre> <br>  Crie o arquivo services / google.ini: <br><br><pre> <code class="bash hljs">MSMS_SERVICE_NAME=<span class="hljs-string"><span class="hljs-string">'google front page'</span></span> <span class="hljs-comment"><span class="hljs-comment"># service endpoint MSMS_SERVICE_ENDPOINT='google.com' # curl parameters MSMS_CURL_PARAMS='-s --connect-timeout 3 -m 7' # expected service response MSMS_EXPECTED_FILE='google-response.html' # recipients list file MSMS_RECIPIENTS='google-recipients.txt'</span></span></code> </pre> <br>  No <code>MSMS_CURL_PARAMS</code> voc√™ pode especificar tudo o que a ondula√ß√£o pode fazer, incluindo: <br><br><ol><li>  Desative as mensagens de ondula√ß√£o para n√£o entupir o console e registrar: <code>-s</code> </li><li>  Defina o tempo limite da conex√£o com o servi√ßo que est√° sendo verificado (em segundos): <code>--connect-timeout 3</code> </li><li>  Definir tempo limite da resposta: <code>-m 7</code> </li><li>  Desabilite a verifica√ß√£o de certificado para SSL (por exemplo, se um certificado autoassinado for usado): <code>--insecure</code> </li><li>  Especifique o tipo de solicita√ß√£o http: <code>-X POST</code> </li><li>  Especifique os cabe√ßalhos: <code>-H "Content-Type: application/json"</code> </li><li>  Especifique o corpo da solicita√ß√£o como uma sequ√™ncia ou arquivo.  Exemplo para o arquivo: <code>-d @request.json</code> </li></ol><br>  Desativamos as notifica√ß√µes e definimos o tempo limite de 3 segundos.  em conex√£o e 7 seg.  para receber uma resposta do servi√ßo. <br><br>  <b>Aten√ß√£o</b> : especifique os valores dos par√¢metros entre aspas simples, como no exemplo.  Infelizmente, o bash nesse sentido √© bastante fr√°gil e uma <s>borboleta acidentalmente voada no</s> lugar errado, uma cita√ß√£o, pode levar √† <s>morte do universo com</s> erros dif√≠ceis de diagnosticar. <br><br>  Montamos o monitoramento.  Verifique se est√° tudo bem: <br><br><pre> <code class="bash hljs">sudo chmod +x ./monitoring.sh torsocks ./monitoring.sh</code> </pre> <br>  O script deve exibir uma mensagem do formul√°rio: <br><br><pre> <code class="bash hljs">2020-01-10 12:14:31 health-check <span class="hljs-string"><span class="hljs-string">"google front page"</span></span>: OK</code> </pre> <br><h2>  PASSO 3. Ajuste a programa√ß√£o </h2><br>  Configure um agendamento de monitoramento no cron: <br><br><pre> <code class="bash hljs">sudo crontab -e</code> </pre> <br>  Adicione uma linha para verificar google.com a cada minuto: <br><br><pre> <code class="bash hljs">*/1 * * * * torsocks &lt;   &gt;/monitoring.sh &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre> <br>  Adicione um alerta todos os dias √†s 11h00, confirmando o pr√≥prio monitoramento.  Para fazer isso, passe o par√¢metro DAILY para o script: <br><br><pre> <code class="bash hljs">0 11 * * * torsocks &lt;   &gt;/monitoring.sh DAILY &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre><br>  <code>2&gt;&amp;1</code> - t√©cnica padr√£o que redireciona erros para o fluxo de sa√≠da principal.  Como resultado, eles tamb√©m ser√£o inclu√≠dos no log de monitoramento. <br><br>  Salve as altera√ß√µes e capture-as com o comando: <br><br><pre> <code class="bash hljs"> sudo service cron reload</code> </pre> <br>  Voc√™ pode ler mais sobre como configurar o cron, por exemplo, <a href="https://losst.ru/nastrojka-cron" rel="nofollow">aqui</a> . <br><br>  Assim, a cada minuto, um script de monitoramento ser√° lan√ßado, que ser√° acessado via gol no google.com.br.  Se a resposta recebida for diferente da esperada, o script enviar√° uma notifica√ß√£o no telegrama √† lista de destinat√°rios.  O log de auditoria √© mantido no arquivo Monitoring.log <br><br>  Se voc√™ precisar adicionar outro servi√ßo, simplesmente criamos um novo arquivo ini para ele na pasta services e, se necess√°rio, criamos uma lista separada de destinat√°rios.  Todo o resto funcionar√° automaticamente. <br><br>  Se o servi√ßo verificado ficar indispon√≠vel, um alerta ser√° enviado a cada minuto.  Se voc√™ n√£o conseguir restaurar rapidamente o servi√ßo, poder√° desativar temporariamente as notifica√ß√µes nas propriedades do bot no telegrama. <br><br>  Agora, vamos dar uma olhada nos recursos adicionais e na implementa√ß√£o de scripts. <br><br><h2>  Modelos de mensagens e envolvimento emocional </h2><br>  Para tornar a comunica√ß√£o com o bot mais animada, chamamos Manechka, adicionamos o avatar de imagem correspondente e especialistas em rela√ß√µes p√∫blicas profissionais engajados para criar textos de mensagens.  Voc√™ pode usar nossas realiza√ß√µes ou mudar a seu gosto. <br><br>  Por exemplo, assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zs/kk/nd/zskkndbpynjm9l-o2ujyvblznlw.jpeg"></div><br>  ou mesmo assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ul/nh/e3/ulnhe3lg9gypwy56x53sk-kuegm.png"></div><br>  Porque n√£o <br><br>  O nome e o avatar do bot s√£o definidos via <a href="https://t.me/botfather" rel="nofollow">@botfather</a> . <br>  Os modelos de mensagens est√£o localizados na pasta de <b>modelos</b> : <br><br><ul><li>  <b>curl-fail.txt</b> : mensagem enviada quando curl retornou um c√≥digo de erro diferente de zero.  Geralmente fala da impossibilidade de entrar em contato com o servi√ßo. </li><li>  <b>daily.txt</b> : mensagem di√°ria confirmando que o monitoramento de servi√ßo est√° funcionando. </li><li>  <b>service-fail.txt</b> : mensagem enviada quando a resposta do servi√ßo √© diferente do esperado. </li></ul><br>  Vamos examinar as possibilidades de personaliza√ß√£o usando o exemplo de modelos de mensagens internos. <br>  Os modelos usam emojis.  Infelizmente, o habr n√£o os exibe. <br>  Para selecionar emojis, √© conveniente usar a pesquisa em <a href="https://emojipedia.org/" rel="nofollow">emojipedia.org</a> : <br><br><img src="https://habrastorage.org/webt/wj/uy/_3/wjuy_3icssro1d0hpptoe5xq91e.jpeg"><br><br>  Voc√™ simplesmente copia e cola o caractere apropriado no texto do modelo (este √© o unicode usual). <br><ol><li>  curl-fail.txt: <br><br><pre> <code class="bash hljs">,  ...      \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" \`CURL EXIT CODE: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  Usamos o nome do servi√ßo especificado (vari√°vel <code>MSMS_SERVICE_NAME</code> ) e a vari√°vel de script interna com o c√≥digo de termina√ß√£o de ondula√ß√£o ( <code>EXIT_CODE</code> ).  Tamb√©m formatamos a mensagem usando a marca√ß√£o de marca√ß√£o de <a href="https://core.telegram.org/bots/api" rel="nofollow">telegrama</a> : os caracteres `` '' enquadram o texto de largura fixa.  Como aspas e ap√≥strofes s√£o caracteres oficiais do bash, n√≥s os escapamos com o caractere "\".  Os nomes de vari√°veis ‚Äã‚Äãs√£o precedidos por um sinal "$". <br><br>  Resultado: <br><br><img src="https://habrastorage.org/webt/po/zf/3n/pozf3neoa1bjqxslwqny1ocal2s.jpeg"><br></li><li>  service-fail.txt: <br><br><pre> <code class="bash hljs">,  ...  \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"     ,     : \`</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$RESPONSE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  Resultado: <br><br><img src="https://habrastorage.org/webt/kv/f1/tl/kvf1tlzbrmm3cqdpf70tnm0m2z4.jpeg"><br><br>  Aqui usamos outra vari√°vel de script: <code>RESPONSE</code> .  Ele cont√©m a resposta do servi√ßo. <br></li><li>  daily.txt: <br><br><pre> <code class="bash hljs">, !    , c  : \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"  ...     ?</span></span></code> </pre><br>  Resultado: <br><br><img src="https://habrastorage.org/webt/qs/ox/r_/qsoxr_bkdi8qva9ms1xzwpxugxa.jpeg"><br></li></ol><br>  Vamos seguir para a implementa√ß√£o de scripts. <br><br><h2>  Script de monitoramento </h2><br>  <b>Monitoring.sh</b> faz a descoberta autom√°tica simples - pega todos os arquivos ini da pasta services e para cada um deles executa o script principal com a l√≥gica para verificar e enviar alertas: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd $(dirname "$0")/services for service_ini in $(ls *.ini); do bash ../msms.sh "$1" "$service_ini" done</span></span></code> </pre> <br>  Para gerar uma mensagem di√°ria sobre o status de monitoramento, o script pode receber o par√¢metro DAILY. <br><br>  Observe que, quando o script √© iniciado, a pasta atual muda para servi√ßos.  Isso permite que os arquivos ini especifiquem caminhos de arquivo relativos aos servi√ßos. <br><br><h2>  Script para verificar e enviar alertas </h2><br>  <b>msms.sh</b> cont√©m a l√≥gica b√°sica de verificar um servi√ßo e enviar alertas. <br><br>  Trabalhar com telegrama: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># telegram endpoint TG_API_URL="https://api.telegram.org/bot$(cat ../telegram-api-key.txt)/sendMessage" ################################################################# # send message to telegram # parameter: message text ################################################################# function send_message { for chat_id in $(cat ../$MSMS_RECIPIENTS); do curl -s -X POST --connect-timeout 10 $TG_API_URL -d chat_id=$chat_id -d parse_mode="Markdown" -d text="$1" echo done }</span></span></code> </pre><br>  Criamos um URL para acessar a API REST do telegrama usando a chave privada armazenada no arquivo. <br><br>  A fun√ß√£o send_message usa curl para enviar mensagens para essa API REST, utilizando o ID do destinat√°rio do arquivo especificado em ini.  Nos dados que enviamos, indicamos que usamos marca√ß√£o de mensagem: <code>parse_mode="Markdown"</code> . <br><br>  Imprima a data atual e carregue o arquivo ini. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $(date <span class="hljs-string"><span class="hljs-string">'+%Y-%m-%d %H:%M:%S'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># load variables from .ini file: . $2</span></span></code> </pre><br>  A linha m√°gica <code>. $2</code>  <code>. $2</code> executa o arquivo ini passado como o segundo par√¢metro como um script comum, inserindo os valores especificados nele nas vari√°veis ‚Äã‚Äãde ambiente. <br><br>  Fa√ßa o download da resposta esperada do arquivo se o par√¢metro <code>MSMS_EXPECTED_FILE</code> estiver <code>MSMS_EXPECTED_FILE</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_EXPECTED_FILE</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> MSMS_EXPECTED=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(cat "$MSMS_EXPECTED_FILE")</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  Execute uma verifica√ß√£o de servi√ßo enviando alertas, se necess√°rio: <br><br><pre> <code class="bash hljs">RESPONSE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval curl $MSMS_CURL_PARAMS \"$MSMS_SERVICE_ENDPOINT\")</span></span></span><span class="hljs-string">"</span></span> EXIT_CODE=$? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$EXIT_CODE</span></span> != 0 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: CURL EXIT WITH </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string"> MESSAGE="</span></span>$(cat ../templates/curl-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" elif [[ "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" != "</span></span><span class="hljs-variable"><span class="hljs-variable">$MSMS_EXPECTED</span></span><span class="hljs-string"><span class="hljs-string">" ]]; then echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" MESSAGE="</span></span>$(cat ../templates/service-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" else echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\": OK fi</span></span></code> </pre><br>  Primeiro, atribu√≠mos a vari√°vel <code>RESPONSE</code> ao resultado do comando curl desse servi√ßo. <br><br>  Express√£o <code>EXIT_CODE=$?</code>  coloca o resultado do √∫ltimo comando, ou seja,  enrolar.  Se voc√™ precisar enviar um alerta, o modelo ser√° lido no arquivo correspondente e a correspond√™ncia para os destinat√°rios ser√° <code>send_message</code> usando o <code>send_message</code> . <br><br>  O √∫ltimo bloco processa o par√¢metro DAILY: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"DAILY"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" DAILY MESSAGE="</span></span>$(cat ../templates/daily.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" fi</span></span></code> </pre> <br>  Ele envia uma mensagem confirmando a integridade do pr√≥prio monitoramento. <br><br><h2>  Obtendo uma lista do ID do usu√°rio </h2><br>  <b>recipients-setup.sh</b> chama a API do telegrama para obter as √∫ltimas mensagens endere√ßadas ao bot: <br><br><pre> <code class="bash hljs">curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates \ | python recipients-setup.py</code> </pre> <br>  Ele usa a magia python para listar bem a sa√≠da.  Isso √© opcional, voc√™ pode simplesmente pegar o id desejado do json, que o comando emitir√°: <br><br><pre> <code class="bash hljs">torsocks curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates</code> </pre> <br><h2>  Conclus√£o </h2><br>  Assim, voc√™ pode usar scripts prontos e modelos de mensagens, configurando apenas servi√ßos e listas observ√°veis ‚Äã‚Äãpara notifica√ß√µes;  Voc√™ pode criar uma nova "identidade" para o bot;  e voc√™ pode tomar sua decis√£o com base no proposto. <br><br>  Como op√ß√µes para desenvolvimento adicional, a configura√ß√£o e o gerenciamento do monitoramento no pr√≥prio bot se sugerem, mas aqui voc√™ n√£o pode prescindir do python.  Se algu√©m colocar as m√£os na minha frente - voc√™ sabe onde enviar a solicita√ß√£o pull :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483318/">https://habr.com/ru/post/pt483318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483308/index.html">Experi√™ncia VonmoTrade. Parte 4: Gr√°ficos de negocia√ß√£o</a></li>
<li><a href="../pt483310/index.html">Crie lentes para o Snapchat usando pix2pix</a></li>
<li><a href="../pt483312/index.html">A Grande Teoria do Floco de Neve</a></li>
<li><a href="../pt483314/index.html">Como executar a√ß√µes ass√≠ncronas do Redux usando Redux-Thunk</a></li>
<li><a href="../pt483316/index.html">Introdu√ß√£o r√°pida ao SwiftUI</a></li>
<li><a href="../pt483320/index.html">Cria√ß√£o de um museu medieval de realidade virtual</a></li>
<li><a href="../pt483322/index.html">Desenvolvimento da API REST - qual √© a abordagem Code First?</a></li>
<li><a href="../pt483324/index.html">Processos flex√≠veis na equipe de TI</a></li>
<li><a href="../pt483328/index.html">API REST - O que √© o HATEOAS?</a></li>
<li><a href="../pt483330/index.html">Sobre a opera√ß√£o de um PC usando o exemplo do Windows 10 e o teclado, parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>