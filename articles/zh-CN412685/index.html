<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👦‍👦 🛑 🖕🏿 Unity GPU路径跟踪-第2部分 🥢 🧒🏿 👩🏽‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="“没有什么比模糊概念的清晰形象更糟糕的了。” -摄影师安塞尔·亚当斯（Ansel Adams） 
 在本文的第一部分中，我们创建了一个Whited射线跟踪器，能够跟踪完美的反射和清晰的阴影。 但是我们缺乏模​​糊性的影响：漫反射，光泽反射和柔和阴影。 

 根据已有的代码 ，我们将迭代求解James...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity GPU路径跟踪-第2部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412685/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/d23/f12/209d23f129b3a20b6bf0f9c2e06d9633.png" alt="图片"></div><br><blockquote>  <em>“没有什么比模糊概念的清晰形象更糟糕的了。”</em>  <em>-摄影师安塞尔·亚当斯（Ansel Adams）</em> </blockquote><br> 在本文的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一部分中，</a>我们创建了一个Whited射线跟踪器，能够跟踪完美的反射和清晰的阴影。 但是我们缺乏模​​糊性的影响：漫反射，光泽反射和柔和阴影。 <br><br> 根据<a href="">已有</a>的<a href="">代码</a> ，我们将迭代求解James Cajia在1986年制定<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的渲染方程式</a> ，并将渲染器转换为能够传递上述效果的<em>路径跟踪</em>器。 我们将再次对脚本使用C＃，对着色器使用HLSL。 该代码已上传到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bitbucket</a> 。 <br><a name="habracut"></a><br> 本文比上一篇文章更具数学意义，但请不要惊慌。 我将尝试尽可能清楚地解释每个公式。 这里需要使用公式，以查看发生了什么以及我们的渲染器<em>为何</em>起作用，因此我建议尝试理解它们，如果不清楚，请在原始文章的注释中提问。 <br><cut></cut><br> 下图是使用HDRI Haven网站上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Graffiti Shelter</a>地图绘制的。 本文中的其他图像已使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kiara 9 Dusk</a>卡渲染。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/927/3c6/10d/9273c610dca750b85f8c3ad9a6655897.jpg" alt="图片"></div><br><h1> 渲染方程 </h1><br> 从形式上看，真实感渲染器的任务是求解渲染方程，其编写如下： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">L</span><span class="MJXp-mrow" id="MJXp-Span-3"><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">x</span><span class="MJXp-mrow" id="MJXp-Span-6"><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-8" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-9">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">c</span><span class="MJXp-mtext" id="MJXp-Span-13">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">g</span><span class="MJXp-msubsup" id="MJXp-Span-18"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-20" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-22"><span class="MJXp-mo" id="MJXp-Span-23" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-27" style="vertical-align: -0.4em;">e</span></span><span class="MJXp-mrow" id="MJXp-Span-28"><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">x</span><span class="MJXp-mrow" id="MJXp-Span-31"><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-33" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-34">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">c</span><span class="MJXp-mtext" id="MJXp-Span-38">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">g</span><span class="MJXp-msubsup" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-45" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-47"><span class="MJXp-mo" id="MJXp-Span-48" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-50">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">n</span><span class="MJXp-msubsup" id="MJXp-Span-53"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-55" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">a</span></span></span><span class="MJXp-mrow" id="MJXp-Span-62"><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mrow" id="MJXp-Span-66"><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">x</span><span class="MJXp-mrow" id="MJXp-Span-69"><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-71" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-72">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">c</span><span class="MJXp-mtext" id="MJXp-Span-76">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">g</span><span class="MJXp-msubsup" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-83" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-85"><span class="MJXp-mo" id="MJXp-Span-86" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-87" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-88">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">c</span><span class="MJXp-mtext" id="MJXp-Span-92">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">g</span><span class="MJXp-msubsup" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-99" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-101"><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-103" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-104"><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-106">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">c</span><span class="MJXp-mtext" id="MJXp-Span-110">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">g</span><span class="MJXp-msubsup" id="MJXp-Span-115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-117" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-119">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">t</span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">n</span><span class="MJXp-mrow" id="MJXp-Span-129"><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-131" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">L</span><span class="MJXp-mrow" id="MJXp-Span-133"><span class="MJXp-mo" id="MJXp-Span-134" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">x</span><span class="MJXp-mrow" id="MJXp-Span-136"><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-138" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-139">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">c</span><span class="MJXp-mtext" id="MJXp-Span-143">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">g</span><span class="MJXp-msubsup" id="MJXp-Span-148"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-150" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-152"><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-154" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">d</span><span class="MJXp-mtext" id="MJXp-Span-156">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159">c</span><span class="MJXp-mtext" id="MJXp-Span-160">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">g</span><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-167" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">i</span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="176.61ex" height="2.78ex" viewBox="0 -832 76040 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4C" x="0" y="0"></use><g transform="translate(681,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="1511" y="0"></use><g transform="translate(2083,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(2913,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="4494" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="4979" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="5446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="6129" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="6615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="7960" y="0"></use><g transform="translate(8440,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(9413,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-3D" x="10521" y="0"></use><g transform="translate(11577,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="963" y="-213"></use></g><g transform="translate(12689,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="13519" y="0"></use><g transform="translate(14091,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(14921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="16502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="16987" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="17454" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="18137" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="18623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="19501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="19968" y="0"></use><g transform="translate(20448,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(21421,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-2B" x="22473" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-69" x="23724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6E" x="24069" y="0"></use><g transform="translate(24670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-74" x="0" y="0"></use><g transform="translate(361,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(27586,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-72" x="693" y="-213"></use><g transform="translate(909,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="1739" y="0"></use><g transform="translate(2312,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(3142,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="4722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="5208" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="5674" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="6358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="6843" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="7722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="8188" y="0"></use><g transform="translate(8669,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-69" x="748" y="-213"></use></g><g transform="translate(9543,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(10372,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="11953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="12438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="12905" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="13588" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="14074" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="14952" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="15419" y="0"></use><g transform="translate(15899,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(16872,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g fill="red" stroke="red" transform="translate(17702,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><g transform="translate(19033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="20113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="20598" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="21065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="21748" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="22234" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="23112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="23579" y="0"></use><g transform="translate(24059,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="25183" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-64" x="25617" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="26140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-74" x="26626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="27237" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="27723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="28189" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6E" x="28623" y="0"></use><g transform="translate(29223,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g fill="red" stroke="red" transform="translate(30053,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4C" x="31384" y="0"></use><g transform="translate(32065,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="32895" y="0"></use><g transform="translate(33467,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(34297,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="35878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="36363" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="36830" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="37513" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="37999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="38877" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="39344" y="0"></use><g transform="translate(39824,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-69" x="748" y="-213"></use></g><g transform="translate(40698,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g fill="red" stroke="red" transform="translate(41528,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-64" x="42859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="43632" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="44118" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="44584" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="45268" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="45753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="46632" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="47098" y="0"></use><g transform="translate(47579,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-69" x="748" y="-213"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L（x，\，\ vec \ omega_ {o}）= L_e（x，\，\ vec \ omega_ {o}）+ \ int _ {\ Omega} {f_r（x，\，\ vec \ omega_ {i }，\，\ vec \ omega_ {o}）\，（\ vec \ omega_ {i} \ cdot \ vec n）\，L（x，\，\ vec \ omega_ {i}）\，d \ vec \ omega_ {i}} </script></p><br> 让我们来分析一下。 我们的最终目标是确定屏幕像素的亮度。 渲染方程式为我们提供了照明量 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">L</span><span class="MJXp-mrow" id="MJXp-Span-171"><span class="MJXp-mo" id="MJXp-Span-172" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">x</span><span class="MJXp-mrow" id="MJXp-Span-174"><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-176" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-177">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">c</span><span class="MJXp-mtext" id="MJXp-Span-181">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">g</span><span class="MJXp-msubsup" id="MJXp-Span-186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-188" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-190"><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.792ex" height="2.66ex" viewBox="0 -832 10243.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4C" x="0" y="0"></use><g transform="translate(681,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="1511" y="0"></use><g transform="translate(2083,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(2913,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="4494" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="4979" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="5446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="6129" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="6615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="7960" y="0"></use><g transform="translate(8440,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(9413,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg></span><script type="math/tex" id="MathJax-Element-2"> L（x，\，\ vec \ omega_ {o}）</script> 从一个点来 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> x </script>  （入射点）方向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-194"><span class="MJXp-mtext" id="MJXp-Span-195">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">c</span><span class="MJXp-mtext" id="MJXp-Span-199">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">g</span><span class="MJXp-msubsup" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-206" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">o</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.006ex" height="1.817ex" viewBox="0 -520.7 5169.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="1202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="1885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="2371" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="3249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="3716" y="0"></use><g transform="translate(4196,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> \ vec \ omega_ {o} </script>  （光束下落的方向）。 表面本身可以是发光的光源 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-208"><span class="MJXp-msubsup" id="MJXp-Span-209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-211" style="vertical-align: -0.4em;">e</span></span><span class="MJXp-mrow" id="MJXp-Span-212"><span class="MJXp-mo" id="MJXp-Span-213" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">x</span><span class="MJXp-mrow" id="MJXp-Span-215"><span class="MJXp-mo" id="MJXp-Span-216" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-217" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">c</span><span class="MJXp-mtext" id="MJXp-Span-222">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">g</span><span class="MJXp-msubsup" id="MJXp-Span-227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-229" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-231"><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.79ex" height="2.66ex" viewBox="0 -832 10673.6 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="963" y="-213"></use><g transform="translate(1111,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-78" x="1941" y="0"></use><g transform="translate(2513,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g fill="red" stroke="red" transform="translate(3343,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-76" x="4924" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="5409" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-63" x="5876" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="6559" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6D" x="7045" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-65" x="7923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-67" x="8390" y="0"></use><g transform="translate(8870,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(9843,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg></span><script type="math/tex" id="MathJax-Element-5"> L_e（x，\，\ vec \ omega_ {o}）</script> 在我们的方向。 大多数表面不会，因此它们仅反射来自外部的光。 这就是为什么使用积分的原因。 它累积了来自半球各个方向的照明。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-233"><span class="MJXp-mtext" id="MJXp-Span-234" style="color: red;">\欧</span><span class="MJXp-mrow" id="MJXp-Span-235"><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0.278em; margin-right: 0.278em;">米</span></span><span class="MJXp-mrow" id="MJXp-Span-237"><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0.278em; margin-right: 0.278em;">茄</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.946ex" height="2.66ex" viewBox="0 -832 2990.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g fill="red" stroke="red"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/412685/&amp;usg=ALkJrhiHrpFqwJi27-VNU_dkSPiLX-aoGg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">欧</text></g></g><g transform="translate(1330,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">米</text></g><g transform="translate(2160,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">茄</text></g></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \欧米茄</script> 围绕法线（因此，考虑到<em>从上方</em>而不是<em>从内部</em>落在表面上的照明，这对于半透明材质可能是必需的）。 <br><br> 第一部分是 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-239"><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-242" style="vertical-align: -0.4em;">r</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> f_r </script> 称为双向反射率分布函数（BRDF）。 此功能直观地描述了我们要处理的材料类型：金属或电介质，深色或明亮，光泽或无光泽。  BRDF确定来自 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-243"><span class="MJXp-mtext" id="MJXp-Span-244">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">c</span><span class="MJXp-mtext" id="MJXp-Span-248">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">g</span><span class="MJXp-msubsup" id="MJXp-Span-253"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-255" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">i</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> \ vec \ omega_ {i} </script> 反映在方向上 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-257"><span class="MJXp-mtext" id="MJXp-Span-258">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">c</span><span class="MJXp-mtext" id="MJXp-Span-262">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">g</span><span class="MJXp-msubsup" id="MJXp-Span-267"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-269" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">o</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> \ vec \ omega_ {o} </script>  。 实际上，这是使用三分量矢量来实现的，该矢量的间隔为红色，绿色和蓝色 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-271"><span class="MJXp-mo" id="MJXp-Span-272" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-273">0</span><span class="MJXp-mo" id="MJXp-Span-274" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-275">1</span><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> [0,1] </script>  。 <br><br> 第二部分- <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-277"><span class="MJXp-mrow" id="MJXp-Span-278"><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-280">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283">c</span><span class="MJXp-mtext" id="MJXp-Span-284">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">g</span><span class="MJXp-msubsup" id="MJXp-Span-289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-291" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-293">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">t</span><span class="MJXp-mtext" id="MJXp-Span-298">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">n</span><span class="MJXp-mrow" id="MJXp-Span-303"><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11">（\ vec \ omega_ {i} \ cdot \ vec n）</script> 等于<sup>1</sup> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-305"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">s</span><span class="MJXp-mtext" id="MJXp-Span-309">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> cos \ theta </script> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-315"><span class="MJXp-mtext" id="MJXp-Span-316">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> \ theta </script>  -入射光和表面法线之间的角度 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-322"><span class="MJXp-mtext" id="MJXp-Span-323">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> \ vec n </script>  。 想象一列平行的光线垂直入射在表面上。 现在想象一下，同一条光线以平角入射到表面。 光线将散布在更大的区域上，但这也意味着该区域的每个点都会显得更暗。 需要考虑余弦。 <br><br> 最后，照明本身从 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-328"><span class="MJXp-mtext" id="MJXp-Span-329">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">c</span><span class="MJXp-mtext" id="MJXp-Span-333">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">g</span><span class="MJXp-msubsup" id="MJXp-Span-338"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-340" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341">i</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> \ vec \ omega_ {i} </script> 使用相同的公式递归确定。 也就是说，该点的照明 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> x </script> 取决于来自上半球所有可能方向的入射光。 从一个角度来看每个方向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-344"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> x </script> 还有一点 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">x</span><span class="MJXp-mtext" id="MJXp-Span-348" style="color: red;">\质</span><span class="MJXp-mrow" id="MJXp-Span-349"><span class="MJXp-mo" id="MJXp-Span-350" style="margin-left: 0.278em; margin-right: 0.278em;">数</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> x \质数</script>  ，其亮度再次取决于从该点的上半球所有可能方向射出的光。 重复所有计算。 <br><br> 这是这里发生的情况，这是一个无限递归积分方程，具有无限数量的半球形积分区域。 我们无法直接求解此方程，但是有一个相当简单的解决方案。 <br><br><hr><br>  <sup>1</sup>不要忘记它！ 我们将经常谈论余弦，并且我们将始终牢记标量积。 由于 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-351"><span class="MJXp-mtext" id="MJXp-Span-352">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-353">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355">c</span><span class="MJXp-mrow" id="MJXp-Span-356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357">a</span></span><span class="MJXp-mtext" id="MJXp-Span-358">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">t</span><span class="MJXp-mtext" id="MJXp-Span-363">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-365">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366">c</span><span class="MJXp-mrow" id="MJXp-Span-367"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">b</span></span><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-370">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-371"><span class="MJXp-mo" id="MJXp-Span-372" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-373">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376">c</span><span class="MJXp-mrow" id="MJXp-Span-377"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">a</span></span><span class="MJXp-mtext" id="MJXp-Span-379">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-380"><span class="MJXp-mo" id="MJXp-Span-381" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-382">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-383">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-384"><span class="MJXp-mo" id="MJXp-Span-385" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-386">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-387">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-388">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">c</span><span class="MJXp-mrow" id="MJXp-Span-390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391">b</span></span><span class="MJXp-mtext" id="MJXp-Span-392">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-393"><span class="MJXp-mo" id="MJXp-Span-394" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-395">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-396">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">s</span><span class="MJXp-mrow" id="MJXp-Span-399"><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-401">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-403">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">a</span><span class="MJXp-mrow" id="MJXp-Span-407"><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> \ vec {a} \ cdot \ vec {b} = \ | \ vec {a} \ | \ \ | \ vec {b} \ | \ cos（\ theta）</script>  ，而我们正在处理<em>方向</em> （单位矢量），那么在大多数计算机图形任务中，标量积<em>就是</em>余弦。 <br><br><h2> 蒙特卡洛（Monte Carlo）来营救 </h2><br> 蒙特卡洛积分是一种数值积分技术，可让我们使用有限数量的随机样本近似计算任何积分。 此外，蒙特卡洛（Monte Carlo）保证收敛到正确的决策-我们抽取的样本越多越好。 这是它的一般形式： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-409"><span class="MJXp-msubsup" id="MJXp-Span-410"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411" style="margin-right: 0.05em;">F</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-412" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mtext" id="MJXp-Span-413" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-414"><span class="MJXp-mo" id="MJXp-Span-415" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-416">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-418">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">c</span><span class="MJXp-mrow" id="MJXp-Span-421"><span class="MJXp-mn" id="MJXp-Span-422">1</span></span><span class="MJXp-mrow" id="MJXp-Span-423"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">N</span></span><span class="MJXp-mtext" id="MJXp-Span-425">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427">u</span><span class="MJXp-msubsup" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-434"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-435">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">n</span><span class="MJXp-mo" id="MJXp-Span-432">=</span><span class="MJXp-mn" id="MJXp-Span-433">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-436"><span class="MJXp-mtext" id="MJXp-Span-437">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-439">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-441">c</span><span class="MJXp-mrow" id="MJXp-Span-442"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-443">f</span><span class="MJXp-mrow" id="MJXp-Span-444"><span class="MJXp-mo" id="MJXp-Span-445" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-446"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-448" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-449"><span class="MJXp-mo" id="MJXp-Span-450" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-451"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">p</span><span class="MJXp-mrow" id="MJXp-Span-453"><span class="MJXp-mo" id="MJXp-Span-454" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-457" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-458"><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-20"> F_N \大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ frac {f（x_n）} {p（x_n）}} </script></p><br> 因此，功能的积分 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-460"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">f</span><span class="MJXp-mrow" id="MJXp-Span-462"><span class="MJXp-mo" id="MJXp-Span-463" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-464"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-466" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-467"><span class="MJXp-mo" id="MJXp-Span-468" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> f（x_n）</script> 可以通过对积分域中的随机样本求平均来近似计算。 每个样本除以其选择的概率。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">p</span><span class="MJXp-mrow" id="MJXp-Span-471"><span class="MJXp-mo" id="MJXp-Span-472" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-475" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-476"><span class="MJXp-mo" id="MJXp-Span-477" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> p（x_n）</script>  。 因此，选择频率较高的样品将比选择频率较低的样品具有更大的重量。 <br><br> 对于半球中均匀的样本（每个方向具有相同的被选择概率），样本的概率是恒定的： <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-478"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479">p</span><span class="MJXp-mrow" id="MJXp-Span-480"><span class="MJXp-mo" id="MJXp-Span-481" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-482">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-487">a</span><span class="MJXp-mrow" id="MJXp-Span-488"><span class="MJXp-mo" id="MJXp-Span-489" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-491">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-492">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-494">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">c</span><span class="MJXp-mrow" id="MJXp-Span-496"><span class="MJXp-mn" id="MJXp-Span-497">1</span></span><span class="MJXp-mrow" id="MJXp-Span-498"><span class="MJXp-mn" id="MJXp-Span-499">2</span><span class="MJXp-mtext" id="MJXp-Span-500">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> p（\ omega）= \ frac {1} {2 \ pi} </script>  （因为 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-503"><span class="MJXp-mn" id="MJXp-Span-504">2</span><span class="MJXp-mtext" id="MJXp-Span-505">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-507">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> 2 \ pi </script> 是单个半球的表面积）。 如果将所有这些放在一起，我们将得到以下结果： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509">L</span><span class="MJXp-mrow" id="MJXp-Span-510"><span class="MJXp-mo" id="MJXp-Span-511" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">x</span><span class="MJXp-mrow" id="MJXp-Span-513"><span class="MJXp-mo" id="MJXp-Span-514" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-515" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-516">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-518">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">c</span><span class="MJXp-mtext" id="MJXp-Span-520">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">g</span><span class="MJXp-msubsup" id="MJXp-Span-525"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-527" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-529"><span class="MJXp-mo" id="MJXp-Span-530" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-531" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-532"><span class="MJXp-mo" id="MJXp-Span-533" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-msubsup" id="MJXp-Span-534"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-535" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-536" style="vertical-align: -0.4em;">e</span></span><span class="MJXp-mrow" id="MJXp-Span-537"><span class="MJXp-mo" id="MJXp-Span-538" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">x</span><span class="MJXp-mrow" id="MJXp-Span-540"><span class="MJXp-mo" id="MJXp-Span-541" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-542" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-543">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-545">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">c</span><span class="MJXp-mtext" id="MJXp-Span-547">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-549">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551">g</span><span class="MJXp-msubsup" id="MJXp-Span-552"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-553" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-554" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-556"><span class="MJXp-mo" id="MJXp-Span-557" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-558" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-559">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-561">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563">c</span><span class="MJXp-mrow" id="MJXp-Span-564"><span class="MJXp-mn" id="MJXp-Span-565">1</span></span><span class="MJXp-mrow" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">N</span></span><span class="MJXp-mtext" id="MJXp-Span-568">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570">u</span><span class="MJXp-msubsup" id="MJXp-Span-571"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-577"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-578">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-573"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574">n</span><span class="MJXp-mo" id="MJXp-Span-575">=</span><span class="MJXp-mn" id="MJXp-Span-576">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-579"><span class="MJXp-mtext" id="MJXp-Span-580">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585">r</span><span class="MJXp-mrow" id="MJXp-Span-586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">n</span></span><span class="MJXp-mrow" id="MJXp-Span-592"><span class="MJXp-mn" id="MJXp-Span-593">2</span><span class="MJXp-mtext" id="MJXp-Span-594">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-595">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-596">i</span><span class="MJXp-mtext" id="MJXp-Span-597" style="color: red;">\，</span><span class="MJXp-msubsup" id="MJXp-Span-598"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-600" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mrow" id="MJXp-Span-601"><span class="MJXp-mo" id="MJXp-Span-602" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603">x</span><span class="MJXp-mrow" id="MJXp-Span-604"><span class="MJXp-mo" id="MJXp-Span-605" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-606" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-607">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-609">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">c</span><span class="MJXp-mtext" id="MJXp-Span-611">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">g</span><span class="MJXp-msubsup" id="MJXp-Span-616"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-617" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-618" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-620"><span class="MJXp-mo" id="MJXp-Span-621" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-622" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-623">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-624">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">c</span><span class="MJXp-mtext" id="MJXp-Span-627">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-629">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">g</span><span class="MJXp-msubsup" id="MJXp-Span-632"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-634" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-636"><span class="MJXp-mo" id="MJXp-Span-637" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-638" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-639"><span class="MJXp-mo" id="MJXp-Span-640" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-641">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-644">c</span><span class="MJXp-mtext" id="MJXp-Span-645">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">g</span><span class="MJXp-msubsup" id="MJXp-Span-650"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-652" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-654">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">t</span><span class="MJXp-mtext" id="MJXp-Span-659">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-661">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">n</span><span class="MJXp-mrow" id="MJXp-Span-664"><span class="MJXp-mo" id="MJXp-Span-665" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mtext" id="MJXp-Span-666" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-667">L</span><span class="MJXp-mrow" id="MJXp-Span-668"><span class="MJXp-mo" id="MJXp-Span-669" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-670">x</span><span class="MJXp-mrow" id="MJXp-Span-671"><span class="MJXp-mo" id="MJXp-Span-672" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-673" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-674">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-676">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">c</span><span class="MJXp-mtext" id="MJXp-Span-678">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-682">g</span><span class="MJXp-msubsup" id="MJXp-Span-683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-684" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-685" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-687"><span class="MJXp-mo" id="MJXp-Span-688" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-25"> L（x，\，\ vec \ omega_ {o}）\大约L_e（x，\，\ vec \ omega_ {o}）+ \ frac {1} {N} \ sum_ {n = 0} ^ {N } {\ color {Green} {2 \ pi \，f_r（x，\，\ vec \ omega_ {i}，\，\ vec \ omega_ {o}）\，（\ vec \ omega_ {i} \ cdot \ vec n）} \，L（x，\，\ vec \ omega_ {i}）} </script></p><br> 放射线 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-689"><span class="MJXp-msubsup" id="MJXp-Span-690"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-691" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-692" style="vertical-align: -0.4em;">e</span></span><span class="MJXp-mrow" id="MJXp-Span-693"><span class="MJXp-mo" id="MJXp-Span-694" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">x</span><span class="MJXp-mrow" id="MJXp-Span-696"><span class="MJXp-mo" id="MJXp-Span-697" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-698" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-699">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-700">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-701">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-702">c</span><span class="MJXp-mtext" id="MJXp-Span-703">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">g</span><span class="MJXp-msubsup" id="MJXp-Span-708"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-710" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-711">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-712"><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> L_e（x，\，\ vec \ omega_ {o}）</script> 仅仅是我们的<code>Shade</code>函数返回的值。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-714"><span class="MJXp-mtext" id="MJXp-Span-715">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-716">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-717">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">c</span><span class="MJXp-mrow" id="MJXp-Span-720"><span class="MJXp-mn" id="MJXp-Span-721">1</span></span><span class="MJXp-mrow" id="MJXp-Span-722"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-723">N</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> \ frac {1} {N} </script> 已经在我们的<code>AddShader</code>函数中运行。 乘以 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-724"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725">L</span><span class="MJXp-mrow" id="MJXp-Span-726"><span class="MJXp-mo" id="MJXp-Span-727" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">x</span><span class="MJXp-mrow" id="MJXp-Span-729"><span class="MJXp-mo" id="MJXp-Span-730" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-731" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-732">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-733">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">c</span><span class="MJXp-mtext" id="MJXp-Span-736">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-738">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-740">g</span><span class="MJXp-msubsup" id="MJXp-Span-741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-743" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-745"><span class="MJXp-mo" id="MJXp-Span-746" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> L（x，\，\ vec \ omega_ {i}）</script> 当我们反射光线并进一步追踪时会发生。 我们的任务是赋予方程式绿色部分以生命。 <br><br><h1> 先决条件 </h1><br> 在开始旅程之前，让我们先考虑一些方面：积累样本，确定性场景和着色器随机性。 <br><br><h2> 积累 </h2><br> 由于某些原因，Unity不会将HDR纹理传递给我作为<code>OnRenderImage</code> <code>destination</code> 。  <code>R8G8B8A8_Typeless</code>格式对我<code>R8G8B8A8_Typeless</code> ，因此准确度很快变得太低而无法累积大量样本。 为了解决这个问题，我们将<code>private RenderTexture _converged</code>添加到C＃ <code>private RenderTexture _converged</code> 。 这将是我们的缓冲区，在将结果显示在屏幕上之前，会高度准确地累积结果。 我们以与<code>InitRenderTexture</code>函数中的<code>_target</code>相同的方式初始化/释放纹理。 在“ <code>Render</code>功能中，将blitting加倍： <br><br><pre> <code class="cs hljs">Graphics.Blit(_target, _converged, _addMaterial); Graphics.Blit(_converged, destination);</code> </pre> <br><h2> 确定性场景 </h2><br> 在更改渲染以评估效果时，将其与以前的结果进行比较很有用。 到目前为止，每次重新启动播放模式或重新编译脚本时，我们都会获得一个新的随机场景。 为了避免这种情况，请将<code>public int SphereSeed</code>添加到C＃ <code>public int SphereSeed</code>并在<code>SetUpScene</code>的开头添加以下行： <br><br><pre> <code class="cs hljs">Random.InitState(SphereSeed);</code> </pre> <br> 现在我们可以手动设置种子场景。 输入任何数字，然后再次打开/关闭<code>RayTracingMaster</code> ，直到获得正确的场景为止。 <br><br> 以下参数用于样本图像：Sphere Seed 1223832719，Sphere Radius [5，30]，Spheres Max 10000，Sphere Placement Radius 100。 <br><br><h2> 着色器随机性 </h2><br> 在开始随机采样之前，我们需要向着色器添加随机性。 我将使用在网络上找到的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规范字符串</a> ，为方便起见对其进行了修改： <br><br><pre> <code class="cs hljs">float2 _Pixel; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _Seed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> result = frac(sin(_Seed / <span class="hljs-number"><span class="hljs-number">100.0f</span></span> * dot(_Pixel, float2(<span class="hljs-number"><span class="hljs-number">12.9898f</span></span>, <span class="hljs-number"><span class="hljs-number">78.233f</span></span>))) * <span class="hljs-number"><span class="hljs-number">43758.5453f</span></span>); _Seed += <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br> 直接在<code>CSMain</code>中将<code>_Pixel = id.xy</code>初始化为<code>_Pixel = id.xy</code>以便每个像素可以使用不同的随机值。  <code>_Seed</code>从<code>SetShaderParameters</code>函数中的C＃初始化的。 <br><br><pre> <code class="cs hljs">RayTracingShader.SetFloat(<span class="hljs-string"><span class="hljs-string">"_Seed"</span></span>, Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>);</code> </pre> <br> 此处生成的随机数的质量不稳定。 将来，值得通过分析参数的影响并将其与其他方法进行比较来探索和测试此功能。 但就目前而言，我们将只使用它并希望取得最好的成绩。 <br><br><h1> 半球采样 </h1><br> 让我们重新开始：我们需要在半球中均匀分布的随机方向。  Corey Simon在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">本文</a>中详细描述了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这项</a>艰巨的任务。 很容易适应半球。 着色器代码如下所示： <br><br><pre> <code class="hljs pgsql">float3 SampleHemisphere(float3 normal) { //     <span class="hljs-type"><span class="hljs-type">float</span></span> cosTheta = rand(); <span class="hljs-type"><span class="hljs-type">float</span></span> sinTheta = sqrt(max(<span class="hljs-number"><span class="hljs-number">0.0</span></span>f, <span class="hljs-number"><span class="hljs-number">1.0</span></span>f - cosTheta * cosTheta)); <span class="hljs-type"><span class="hljs-type">float</span></span> phi = <span class="hljs-number"><span class="hljs-number">2</span></span> * PI * rand(); float3 tangentSpaceDir = float3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta); //      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mul(tangentSpaceDir, GetTangentSpace(normal)); }</code> </pre> <br> 方向是针对以正Z轴为中心的半球生成的，因此我们需要对其进行变换，以使其以所需法线为中心。 我们生成一个切线和双法线（两个与法线正交且彼此正交的向量）。 首先，我们选择一个辅助向量来生成切线。 为此，我们取正的X轴，只有在正（近似）与X轴对齐的情况下才返回正Z，然后可以使用矢量乘积生成切线，然后生成双法线。 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">float3x3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTangentSpace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">float3 normal</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       float3 helper = float3(1, 0, 0); if (abs(normal.x) &gt; 0.99f) helper = float3(0, 0, 1); //   float3 tangent = normalize(cross(normal, helper)); float3 binormal = normalize(cross(normal, tangent)); return float3x3(tangent, binormal, normal); }</span></span></code> </pre> <br><h1> 朗伯散射 </h1><br> 现在我们有了统一的随机方向，我们可以继续实施第一个BRDF。 对于漫反射，最常用的是Lambert BRDF，它非常简单： <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-747"><span class="MJXp-msubsup" id="MJXp-Span-748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-750" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mrow" id="MJXp-Span-751"><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">x</span><span class="MJXp-mrow" id="MJXp-Span-754"><span class="MJXp-mo" id="MJXp-Span-755" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-756" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-757">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-758">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-759">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">c</span><span class="MJXp-mtext" id="MJXp-Span-761">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-762">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-764">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">g</span><span class="MJXp-msubsup" id="MJXp-Span-766"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-768" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-770"><span class="MJXp-mo" id="MJXp-Span-771" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-772" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-773">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-774">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776">c</span><span class="MJXp-mtext" id="MJXp-Span-777">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-780">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-781">g</span><span class="MJXp-msubsup" id="MJXp-Span-782"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-783" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-784" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-786"><span class="MJXp-mo" id="MJXp-Span-787" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-788" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-789">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-790">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">c</span><span class="MJXp-mrow" id="MJXp-Span-794"><span class="MJXp-msubsup" id="MJXp-Span-795"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-796" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-797" style="vertical-align: -0.4em;">d</span></span></span><span class="MJXp-mrow" id="MJXp-Span-798"><span class="MJXp-mtext" id="MJXp-Span-799">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> f_r（x，\，\ vec \ omega_ {i}，\，\ vec \ omega_ {o}）= \ frac {k_d} {\ pi} </script> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-802"><span class="MJXp-msubsup" id="MJXp-Span-803"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-804" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-805" style="vertical-align: -0.4em;">d</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> k_d </script>  -这是反照率表面。 让我们将其插入到Monte Carlo渲染方程式中（我将不考虑发射率），看看会发生什么： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">L</span><span class="MJXp-mrow" id="MJXp-Span-808"><span class="MJXp-mo" id="MJXp-Span-809" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-810">x</span><span class="MJXp-mrow" id="MJXp-Span-811"><span class="MJXp-mo" id="MJXp-Span-812" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-813" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-814">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-816">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-817">c</span><span class="MJXp-mtext" id="MJXp-Span-818">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-820">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-822">g</span><span class="MJXp-msubsup" id="MJXp-Span-823"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-824" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-825" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-826">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-827"><span class="MJXp-mo" id="MJXp-Span-828" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-829" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-830"><span class="MJXp-mo" id="MJXp-Span-831" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-832">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-834">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-835">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836">c</span><span class="MJXp-mrow" id="MJXp-Span-837"><span class="MJXp-mn" id="MJXp-Span-838">1</span></span><span class="MJXp-mrow" id="MJXp-Span-839"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-840">N</span></span><span class="MJXp-mtext" id="MJXp-Span-841">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-842">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">u</span><span class="MJXp-msubsup" id="MJXp-Span-844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-850"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-846"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-847">n</span><span class="MJXp-mo" id="MJXp-Span-848">=</span><span class="MJXp-mn" id="MJXp-Span-849">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-852"><span class="MJXp-mtext" id="MJXp-Span-853">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-854">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-857">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858">r</span><span class="MJXp-mrow" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-861">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-865">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-866">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869">t</span></span><span class="MJXp-mrow" id="MJXp-Span-870"><span class="MJXp-mn" id="MJXp-Span-871">2</span><span class="MJXp-msubsup" id="MJXp-Span-872"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-874" style="vertical-align: -0.4em;">d</span></span></span><span class="MJXp-mtext" id="MJXp-Span-875" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-876"><span class="MJXp-mo" id="MJXp-Span-877" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-878">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-879">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881">c</span><span class="MJXp-mtext" id="MJXp-Span-882">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-884">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">g</span><span class="MJXp-msubsup" id="MJXp-Span-887"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-889" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-890">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-891">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-892">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-895">t</span><span class="MJXp-mtext" id="MJXp-Span-896">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-899">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900">n</span><span class="MJXp-mrow" id="MJXp-Span-901"><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-903" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-904">L</span><span class="MJXp-mrow" id="MJXp-Span-905"><span class="MJXp-mo" id="MJXp-Span-906" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-907">x</span><span class="MJXp-mrow" id="MJXp-Span-908"><span class="MJXp-mo" id="MJXp-Span-909" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-910" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-911">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-913">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914">c</span><span class="MJXp-mtext" id="MJXp-Span-915">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-916">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919">g</span><span class="MJXp-msubsup" id="MJXp-Span-920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-921" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-922" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-923">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-924"><span class="MJXp-mo" id="MJXp-Span-925" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-31"> L（x，\，\ vec \ omega_ {o}）\大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ color {BlueViolet} {2 k_d} \，（\ vec \ omega_ {i} \ cdot \ vec n）\，L（x，\，\ vec \ omega_ {i}）} </script></p><br> 让我们立即将此方程式插入着色器。 在<code>Shade</code>函数中，用以下几行替换<code>if (hit.distance &lt; 1.#INF)</code>构造内部的代码： <br><br><pre> <code class="hljs markdown">//   ray.origin = hit.position + hit.normal <span class="hljs-bullet"><span class="hljs-bullet">* 0.001f; ray.direction = SampleHemisphere(hit.normal); ray.energy *</span></span>= 2 <span class="hljs-bullet"><span class="hljs-bullet">* hit.albedo *</span></span> sdot(hit.normal, ray.direction); return 0.0f;</code> </pre> <br> 反射光束的新方向是使用我们的均匀半球样本函数确定的。 光束的能量乘以上述方程式的相应部分。 由于表面不发出任何照明（它仅反射直接或间接从天空接收的光），因此我们返回0。在这里，请不要忘记<code>AddShader</code>对样本<code>AddShader</code>平均值，因此我们无需担心 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-926"><span class="MJXp-mtext" id="MJXp-Span-927">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-929">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-931">c</span><span class="MJXp-mrow" id="MJXp-Span-932"><span class="MJXp-mn" id="MJXp-Span-933">1</span></span><span class="MJXp-mrow" id="MJXp-Span-934"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-935">N</span></span><span class="MJXp-mtext" id="MJXp-Span-936">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">m</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> \ frac {1} {N} \ sum </script>  。  <code>CSMain</code>已包含乘以 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-940"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-941">L</span><span class="MJXp-mrow" id="MJXp-Span-942"><span class="MJXp-mo" id="MJXp-Span-943" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944">x</span><span class="MJXp-mrow" id="MJXp-Span-945"><span class="MJXp-mo" id="MJXp-Span-946" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-947" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-948">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951">c</span><span class="MJXp-mtext" id="MJXp-Span-952">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-953">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-954">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-955">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956">g</span><span class="MJXp-msubsup" id="MJXp-Span-957"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-959" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-960">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-961"><span class="MJXp-mo" id="MJXp-Span-962" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> L（x，\，\ vec \ omega_ {i}）</script>  （下一个反射光束），所以我们还有很多工作要做。 <br><br>  <code>sdot</code>是我为自己定义的辅助函数。 它只是返回带有附加系数的标量积的结果，然后将其限制为区间 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-963"><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-965">0</span><span class="MJXp-mo" id="MJXp-Span-966" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-967">1</span><span class="MJXp-mo" id="MJXp-Span-968" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> [0,1] </script>  ： <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sdot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">float3 x, float3 y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0f</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(dot(x, y) * f); }</code> </pre> <br> 让我们总结到目前为止我们的代码在做什么。  <code>CSMain</code>生成相机的主光线并调用<code>Shade</code> 。 当穿过表面时，此功能又会生成新的光束（在法线周围的半球中均匀地随机分布），并考虑了材料的BRDF和光束能量中的余弦。 在光线与天空的交点处，我们对HDRI（我们唯一的照明源）进行采样并返回照度，该照度乘以射线的能量（即从照相机开始的所有先前交点的结果）。 这是一个简单的示例，融合了收敛的结果。 结果，在每个样本中都考虑到了影响。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-969"><span class="MJXp-mtext" id="MJXp-Span-970">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-971">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-972">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974">c</span><span class="MJXp-mrow" id="MJXp-Span-975"><span class="MJXp-mn" id="MJXp-Span-976">1</span></span><span class="MJXp-mrow" id="MJXp-Span-977"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-978">N</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> \ frac {1} {N} </script>  。 <br><br> 现在该检查工作中的所有内容了。 由于金属不具有漫反射，因此我们现在在C＃脚本的<code>SetUpScene</code>函数<code>SetUpScene</code>其关闭（但仍在此处调用<code>Random.value</code>以保留场景的确定性）： <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> metal = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0.0f</span></span>;</code> </pre> <br> 启动“播放”模式，查看如何清除最初的噪点图像并收敛为漂亮的渲染： <br><br><h1>  Phong镜像 </h1><br> 只需几行代码（和一小部分数学运算）就不错了。 让我们通过使用Phong的BRDF添加镜面反射来优化图片。 方的原始表述存在问题（缺乏关系和节约能源），但幸运的是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">其他人消除了它们</a> 。 增强的BRDF如下所示。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-979"><span class="MJXp-mtext" id="MJXp-Span-980">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-982">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983">c</span><span class="MJXp-mtext" id="MJXp-Span-984">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-985">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-987">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-988">g</span><span class="MJXp-msubsup" id="MJXp-Span-989"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-990" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-991" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-992">r</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> \ vec \ omega_ {r} </script> 是完全反射光的方向，并且 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-993"><span class="MJXp-mtext" id="MJXp-Span-994">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-996">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> \ alpha </script> 是控制粗糙度的Phong指示器： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1000"><span class="MJXp-msubsup" id="MJXp-Span-1001"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1002" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1003" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mrow" id="MJXp-Span-1004"><span class="MJXp-mo" id="MJXp-Span-1005" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1006">x</span><span class="MJXp-mrow" id="MJXp-Span-1007"><span class="MJXp-mo" id="MJXp-Span-1008" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1009" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1010">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1013">c</span><span class="MJXp-mtext" id="MJXp-Span-1014">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1016">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1017">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1018">g</span><span class="MJXp-msubsup" id="MJXp-Span-1019"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1020" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1021" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1022">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1023"><span class="MJXp-mo" id="MJXp-Span-1024" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1025" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1026">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1029">c</span><span class="MJXp-mtext" id="MJXp-Span-1030">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1032">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">g</span><span class="MJXp-msubsup" id="MJXp-Span-1035"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1037" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1039"><span class="MJXp-mo" id="MJXp-Span-1040" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-1041" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1044" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-1045" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1046">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1047">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1049">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1050">c</span><span class="MJXp-mrow" id="MJXp-Span-1051"><span class="MJXp-mtext" id="MJXp-Span-1052">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1057">a</span><span class="MJXp-mo" id="MJXp-Span-1058" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1059">2</span></span><span class="MJXp-mrow" id="MJXp-Span-1060"><span class="MJXp-mn" id="MJXp-Span-1061">2</span><span class="MJXp-mtext" id="MJXp-Span-1062">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1064">i</span></span><span class="MJXp-mtext" id="MJXp-Span-1065" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1066"><span class="MJXp-mo" id="MJXp-Span-1067" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mspace" id="MJXp-Span-1068" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1070">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1071">c</span><span class="MJXp-mtext" id="MJXp-Span-1072">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1074">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1075">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076">g</span><span class="MJXp-msubsup" id="MJXp-Span-1077"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1078" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1079" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1080">r</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1081">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1082">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1083">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1084">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1085">t</span><span class="MJXp-mtext" id="MJXp-Span-1086">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1087">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1088">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1089">c</span><span class="MJXp-mtext" id="MJXp-Span-1090">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1092">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1093">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094">g</span><span class="MJXp-msubsup" id="MJXp-Span-1095"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1096" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1097" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1098">o</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1099"><span class="MJXp-mrow" id="MJXp-Span-1100" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1101" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-1102" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1104">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1105">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1107">a</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-38"> f_r（x，\，\ vec \ omega_ {i}，\，\ vec \ omega_ {o}）= k_s \，\ frac {\ alpha + 2} {2 \ pi} \，（\\ vec \ omega_ { r} \ cdot \ vec \ omega_ {o}）^ \ alpha </script></p><br> 交互式二维<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图</a>显示了当Phong出现时BRDF的外观 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1108"><span class="MJXp-mtext" id="MJXp-Span-1109">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1112">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1114">a</span><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1116">15</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> \ alpha = 15 </script> 对于以45°角入射的光束。 尝试更改值。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1117"><span class="MJXp-mtext" id="MJXp-Span-1118">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1120">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1121">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1123">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> \ alpha </script>  。 <br><br> 将其粘贴到我们的蒙特卡洛渲染方程中： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1124"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1125">L</span><span class="MJXp-mrow" id="MJXp-Span-1126"><span class="MJXp-mo" id="MJXp-Span-1127" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">x</span><span class="MJXp-mrow" id="MJXp-Span-1129"><span class="MJXp-mo" id="MJXp-Span-1130" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1131" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1132">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1134">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">c</span><span class="MJXp-mtext" id="MJXp-Span-1136">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1138">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1139">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1140">g</span><span class="MJXp-msubsup" id="MJXp-Span-1141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1142" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1143" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1144">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1145"><span class="MJXp-mo" id="MJXp-Span-1146" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1147" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1148"><span class="MJXp-mo" id="MJXp-Span-1149" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1150">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1152">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1153">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1154">c</span><span class="MJXp-mrow" id="MJXp-Span-1155"><span class="MJXp-mn" id="MJXp-Span-1156">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1158">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1159">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1160">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161">u</span><span class="MJXp-msubsup" id="MJXp-Span-1162"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1163" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1169">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1165">n</span><span class="MJXp-mo" id="MJXp-Span-1166">=</span><span class="MJXp-mn" id="MJXp-Span-1167">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1170"><span class="MJXp-mtext" id="MJXp-Span-1171">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1172">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1173">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1176">r</span><span class="MJXp-mrow" id="MJXp-Span-1177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1179">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1182">n</span></span><span class="MJXp-mrow" id="MJXp-Span-1183"><span class="MJXp-msubsup" id="MJXp-Span-1184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1185" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1186" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-1187" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1188"><span class="MJXp-mo" id="MJXp-Span-1189" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1190">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1191">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1192">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1193">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195">a</span><span class="MJXp-mo" id="MJXp-Span-1196" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1197">2</span><span class="MJXp-mrow" id="MJXp-Span-1198"><span class="MJXp-mo" id="MJXp-Span-1199" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1200" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1201"><span class="MJXp-mo" id="MJXp-Span-1202" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1203">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1205">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">c</span><span class="MJXp-mtext" id="MJXp-Span-1207">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1210">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211">g</span><span class="MJXp-msubsup" id="MJXp-Span-1212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1213" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1214" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1215">r</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1216">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1218">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1219">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1220">t</span><span class="MJXp-mtext" id="MJXp-Span-1221">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1223">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1224">c</span><span class="MJXp-mtext" id="MJXp-Span-1225">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1228">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1229">g</span><span class="MJXp-msubsup" id="MJXp-Span-1230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1231" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1232" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233">o</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1234"><span class="MJXp-mrow" id="MJXp-Span-1235" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1236" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-1237" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1239">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1240">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242">a</span></span><span class="MJXp-mtext" id="MJXp-Span-1243" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1244"><span class="MJXp-mo" id="MJXp-Span-1245" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1246">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1248">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249">c</span><span class="MJXp-mtext" id="MJXp-Span-1250">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1251">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1252">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1254">g</span><span class="MJXp-msubsup" id="MJXp-Span-1255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1257" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1258">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1259">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1260">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1261">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263">t</span><span class="MJXp-mtext" id="MJXp-Span-1264">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1265">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1266">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1267">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1268">n</span><span class="MJXp-mrow" id="MJXp-Span-1269"><span class="MJXp-mo" id="MJXp-Span-1270" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1271" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1272">L</span><span class="MJXp-mrow" id="MJXp-Span-1273"><span class="MJXp-mo" id="MJXp-Span-1274" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275">x</span><span class="MJXp-mrow" id="MJXp-Span-1276"><span class="MJXp-mo" id="MJXp-Span-1277" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1278" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1279">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1280">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1282">c</span><span class="MJXp-mtext" id="MJXp-Span-1283">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1285">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1286">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1287">g</span><span class="MJXp-msubsup" id="MJXp-Span-1288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1289" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1290" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1291">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1292"><span class="MJXp-mo" id="MJXp-Span-1293" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-41"> L（x，\，\ vec \ omega_ {o}）\大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ color {brown} {k_s \，（\ alpha + 2）\，（\ vec \ omega_ {r} \ cdot \ vec \ omega_ {o}）^ \ alpha} \，（\ vec \ omega_ {i} \ cdot \ vec n）\，L（x，\， \ vec \ omega_ {i}）} </script></p><br> 最后，让我们将其添加到现有的Lambert BRDF中： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1295">L</span><span class="MJXp-mrow" id="MJXp-Span-1296"><span class="MJXp-mo" id="MJXp-Span-1297" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">x</span><span class="MJXp-mrow" id="MJXp-Span-1299"><span class="MJXp-mo" id="MJXp-Span-1300" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1301" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1302">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1303">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1304">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1305">c</span><span class="MJXp-mtext" id="MJXp-Span-1306">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1307">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1308">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1309">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1310">g</span><span class="MJXp-msubsup" id="MJXp-Span-1311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1312" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1313" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1314">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1315"><span class="MJXp-mo" id="MJXp-Span-1316" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1317" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1318"><span class="MJXp-mo" id="MJXp-Span-1319" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1320">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1321">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1322">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1324">c</span><span class="MJXp-mrow" id="MJXp-Span-1325"><span class="MJXp-mn" id="MJXp-Span-1326">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1327"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1328">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1329">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1331">u</span><span class="MJXp-msubsup" id="MJXp-Span-1332"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1333" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1338"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1339">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1334"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1335">n</span><span class="MJXp-mo" id="MJXp-Span-1336">=</span><span class="MJXp-mn" id="MJXp-Span-1337">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1340"><span class="MJXp-mo" id="MJXp-Span-1341" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mtext" id="MJXp-Span-1342">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1343">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1344">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1345">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1346">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1347">r</span><span class="MJXp-mrow" id="MJXp-Span-1348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1349">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1350">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1351">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1352">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1353">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1354">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1355">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1356">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1357">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1358">t</span></span><span class="MJXp-mrow" id="MJXp-Span-1359"><span class="MJXp-mn" id="MJXp-Span-1360">2</span><span class="MJXp-msubsup" id="MJXp-Span-1361"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1362" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1363" style="vertical-align: -0.4em;">d</span></span></span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-1365">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1367">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1368">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1369">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1370">r</span><span class="MJXp-mrow" id="MJXp-Span-1371"><span class="MJXp-mrow" id="MJXp-Span-1372"><span class="MJXp-mo" id="MJXp-Span-1373" style="margin-left: 0.278em; margin-right: 0.278em;">棕</span></span><span class="MJXp-mrow" id="MJXp-Span-1374"><span class="MJXp-mo" id="MJXp-Span-1375" style="margin-left: 0.278em; margin-right: 0.278em;">色</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1376"><span class="MJXp-msubsup" id="MJXp-Span-1377"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1378" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1379" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-1380" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1381"><span class="MJXp-mo" id="MJXp-Span-1382" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1383">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1384">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1386">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1387">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1388">a</span><span class="MJXp-mo" id="MJXp-Span-1389" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1390">2</span><span class="MJXp-mrow" id="MJXp-Span-1391"><span class="MJXp-mo" id="MJXp-Span-1392" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1393" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1394"><span class="MJXp-mo" id="MJXp-Span-1395" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1396">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1397">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1398">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1399">c</span><span class="MJXp-mtext" id="MJXp-Span-1400">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1402">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1404">g</span><span class="MJXp-msubsup" id="MJXp-Span-1405"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1406" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1407" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1408">r</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1409">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1410">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1411">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1413">t</span><span class="MJXp-mtext" id="MJXp-Span-1414">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1415">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1416">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1417">c</span><span class="MJXp-mtext" id="MJXp-Span-1418">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1419">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1420">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1421">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1422">g</span><span class="MJXp-msubsup" id="MJXp-Span-1423"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1424" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1425" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1426">o</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1427"><span class="MJXp-mrow" id="MJXp-Span-1428" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1429" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-1430" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1431">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1432">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1433">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1434">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1435">a</span></span><span class="MJXp-mo" id="MJXp-Span-1436" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mtext" id="MJXp-Span-1437" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1438"><span class="MJXp-mo" id="MJXp-Span-1439" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1440">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1441">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1442">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1443">c</span><span class="MJXp-mtext" id="MJXp-Span-1444">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1445">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1446">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1447">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1448">g</span><span class="MJXp-msubsup" id="MJXp-Span-1449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1450" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1451" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1452">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1453">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1454">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1455">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1456">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1457">t</span><span class="MJXp-mtext" id="MJXp-Span-1458">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1459">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1460">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1461">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1462">n</span><span class="MJXp-mrow" id="MJXp-Span-1463"><span class="MJXp-mo" id="MJXp-Span-1464" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1465" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1466">L</span><span class="MJXp-mrow" id="MJXp-Span-1467"><span class="MJXp-mo" id="MJXp-Span-1468" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1469">x</span><span class="MJXp-mrow" id="MJXp-Span-1470"><span class="MJXp-mo" id="MJXp-Span-1471" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1472" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1473">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1474">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1475">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1476">c</span><span class="MJXp-mtext" id="MJXp-Span-1477">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1478">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1479">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1480">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1481">g</span><span class="MJXp-msubsup" id="MJXp-Span-1482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1483" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1484" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1485">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1486"><span class="MJXp-mo" id="MJXp-Span-1487" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-42"> L（x，\，\ vec \ omega_ {o}）\大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {[\ color {BlueViolet} {2 k_d} + \ color {棕色} {k_s \，（\ alpha + 2）\，（\ vec \ omega_ {r} \ cdot \ vec \ omega_ {o}）^ \ alpha}] \，（\ vec \ omega_ {i} \ cdot \ vec n）\，L（x，\，\ vec \ omega_ {i}）} </script></p><br> 这就是它们与Lambert散射一起在代码中的外观： <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    ray.origin = hit.position + hit.normal * 0.001f; float3 reflected = reflect(ray.direction, hit.normal); ray.direction = SampleHemisphere(hit.normal); float3 diffuse = 2 * min(1.0f - hit.specular, hit.albedo); float alpha = 15.0f; float3 specular = hit.specular * (alpha + 2) * pow(sdot(ray.direction, reflected), alpha); ray.energy *= (diffuse + specular) * sdot(hit.normal, ray.direction); return 0.0f;</span></span></code> </pre> <br> 请注意，我们将标量积替换为稍有不同但等效的标量（反映了 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1488"><span class="MJXp-mtext" id="MJXp-Span-1489">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1490">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1491">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1492">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1493">g</span><span class="MJXp-msubsup" id="MJXp-Span-1494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1495" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1496" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43"> \ omega_o </script> 代替 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1497"><span class="MJXp-mtext" id="MJXp-Span-1498">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1499">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1500">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1501">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1502">g</span><span class="MJXp-msubsup" id="MJXp-Span-1503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1504" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1505" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> \ omega_i </script>  ） 现在，将金属材料重新设置为<code>SetUpScene</code>函数，并检查其工作方式。 <br><br> 尝试不同的值 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1506"><span class="MJXp-mtext" id="MJXp-Span-1507">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1508">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1509">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1510">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1511">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1512">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> \ alpha </script>  ，您可能会注意到一个问题：即使性能低下，收敛也需要大量时间，而在高性能下，噪声尤为明显。 即使经过几分钟的等待，结果仍然不理想，这对于如此简单的场景是无法接受的。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1513"><span class="MJXp-mtext" id="MJXp-Span-1514">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1515">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1516">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1517">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1518">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1519">a</span><span class="MJXp-mo" id="MJXp-Span-1520" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1521">15</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> \ alpha = 15 </script> 和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1522"><span class="MJXp-mtext" id="MJXp-Span-1523">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1524">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1525">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1526">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1527">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1528">a</span><span class="MJXp-mo" id="MJXp-Span-1529" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1530">300</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> \ alpha = 300 </script> 有8192个样本如下所示： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09e/966/17e/09e96617eb6f924b6b5d8e99dea941e4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b6/689/981/1b668998123fb62dba1a3f110e2603f9.png"></div><br> 为什么会这样呢？ 毕竟，在我们进行如此美丽的理想反射之前（ <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1531"><span class="MJXp-mtext" id="MJXp-Span-1532">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1533">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1534">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1535">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1536">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1537">a</span><span class="MJXp-mo" id="MJXp-Span-1538" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-1539">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1540">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1541">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1542">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1543">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1544">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> \ alpha = \ infty </script> 问题是我们生成了<em>均质</em>样本，并根据BRDF为其分配了权重。  Phong值高时，每个人的BRDF很小，但是这些方向非常接近完美反射，因此我们不太可能会使用<em>均质</em>样本随机选择它们。 另一方面， <em>如果</em>我们实际上跨越了这些方向之一，那么BRDF将会很大，可以补偿所有其他小的样本。 结果是非常大的分散。 具有多次镜面反射的路径甚至更糟，并导致图像中可见的噪声。 <br><br><h1> 增强采样 </h1><br> 为了使我们的路径追踪器切实可行，我们需要更改范例。 让我们<em>生成重要的样本</em> ，而不是在它们最终不重要的区域上浪费珍贵的样本（因为它们得到的BRDF和/或余弦值非常低）。 <br><br> 第一步，我们将返回理想的思考，然后看一下如何将这个想法推广。 为此，我们将阴影逻辑分为漫反射和镜面反射。 对于每个样本，我们将随机选择一个或另一个（取决于比率 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1545"><span class="MJXp-msubsup" id="MJXp-Span-1546"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1547" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1548" style="vertical-align: -0.4em;">d</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> k_d </script> 和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1549"><span class="MJXp-msubsup" id="MJXp-Span-1550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1551" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1552" style="vertical-align: -0.4em;">s</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> k_s </script>  ） 在漫反射的情况下，我们将坚持均匀的样本，但对于镜面反射，我们将在唯一重要的方向上明确反射光束。 由于现在在每种反射类型上将花费更少的样本，因此我们需要相应地增加影响，以便获得相同的总值： <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//       hit.albedo = min(1.0f - hit.specular, hit.albedo); float specChance = energy(hit.specular); float diffChance = energy(hit.albedo); float sum = specChance + diffChance; specChance /= sum; diffChance /= sum; //     float roulette = rand(); if (roulette &lt; specChance) { //   ray.origin = hit.position + hit.normal * 0.001f; ray.direction = reflect(ray.direction, hit.normal); ray.energy *= (1.0f / specChance) * hit.specular * sdot(hit.normal, ray.direction); } else { //   ray.origin = hit.position + hit.normal * 0.001f; ray.direction = SampleHemisphere(hit.normal); ray.energy *= (1.0f / diffChance) * 2 * hit.albedo * sdot(hit.normal, ray.direction); } return 0.0f;</span></span></code> </pre> <br>  <code>energy</code>是平均颜色通道的小辅助功能： <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">float3 color</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dot(color, <span class="hljs-number"><span class="hljs-number">1.0f</span></span> / <span class="hljs-number"><span class="hljs-number">3.0f</span></span>); }</code> </pre> <br> 因此，我们在上一部分中创建了一个更漂亮的Whited射线跟踪器，但是现在有了真正的漫反射阴影（这意味着柔和的阴影，环境光遮挡，漫反射的全局照明）： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/674/f18/ee0/674f18ee0fdf1d734ba6272771e65b86.png" alt="图片"></div><br><h1> 重要性样本 </h1><br> 让我们再看一下基本的蒙特卡洛公式： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1553"><span class="MJXp-msubsup" id="MJXp-Span-1554"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1555" style="margin-right: 0.05em;">F</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1556" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1557" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1558"><span class="MJXp-mo" id="MJXp-Span-1559" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1560">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1561">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1562">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1563">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1564">c</span><span class="MJXp-mrow" id="MJXp-Span-1565"><span class="MJXp-mn" id="MJXp-Span-1566">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1567"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1568">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1569">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1570">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1571">u</span><span class="MJXp-msubsup" id="MJXp-Span-1572"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1573" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1578"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1579">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1574"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1575">n</span><span class="MJXp-mo" id="MJXp-Span-1576">=</span><span class="MJXp-mn" id="MJXp-Span-1577">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1580"><span class="MJXp-mtext" id="MJXp-Span-1581">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1582">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1583">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1584">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1585">c</span><span class="MJXp-mrow" id="MJXp-Span-1586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1587">f</span><span class="MJXp-mrow" id="MJXp-Span-1588"><span class="MJXp-mo" id="MJXp-Span-1589" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-1590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1591" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1592" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-1593"><span class="MJXp-mo" id="MJXp-Span-1594" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1596">p</span><span class="MJXp-mrow" id="MJXp-Span-1597"><span class="MJXp-mo" id="MJXp-Span-1598" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-1599"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1600" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1601" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-1602"><span class="MJXp-mo" id="MJXp-Span-1603" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-51"> F_N \大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ frac {f（x_n）} {p（x_n）}} </script></p><br> 如您所见，我们将每个样本（样本）的影响除以选择该特定样本的概率。 到目前为止，我们已经使用了均质的半球样本，因此我们得到了一个常数 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1605">p</span><span class="MJXp-mrow" id="MJXp-Span-1606"><span class="MJXp-mo" id="MJXp-Span-1607" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1608">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1609">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1610">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1611">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1612">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1613">a</span><span class="MJXp-mrow" id="MJXp-Span-1614"><span class="MJXp-mo" id="MJXp-Span-1615" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-1616" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-1617">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1618">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1619">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1620">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1621">c</span><span class="MJXp-mrow" id="MJXp-Span-1622"><span class="MJXp-mn" id="MJXp-Span-1623">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1624"><span class="MJXp-mn" id="MJXp-Span-1625">2</span><span class="MJXp-mtext" id="MJXp-Span-1626">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1627">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1628">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> p（\ omega）= \ frac {1} {2 \ pi} </script>  。 正如我们在上面看到的，例如，在Phong BRDF的情况下，这远非理想之举，Phong BRDF在非常少的方向上很大。 <br><br> 想象一下，我们可以找到与可积分函数完全匹配的概率分布： <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1630">p</span><span class="MJXp-mrow" id="MJXp-Span-1631"><span class="MJXp-mo" id="MJXp-Span-1632" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1633">x</span><span class="MJXp-mrow" id="MJXp-Span-1634"><span class="MJXp-mo" id="MJXp-Span-1635" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-1636" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1637">f</span><span class="MJXp-mrow" id="MJXp-Span-1638"><span class="MJXp-mo" id="MJXp-Span-1639" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1640">x</span><span class="MJXp-mrow" id="MJXp-Span-1641"><span class="MJXp-mo" id="MJXp-Span-1642" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> p（x）= f（x）</script>  。 然后将发生以下情况： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1643"><span class="MJXp-msubsup" id="MJXp-Span-1644"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1645" style="margin-right: 0.05em;">F</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1646" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1647" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1648"><span class="MJXp-mo" id="MJXp-Span-1649" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1650">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1651">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1652">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1653">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1654">c</span><span class="MJXp-mrow" id="MJXp-Span-1655"><span class="MJXp-mn" id="MJXp-Span-1656">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1657"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1658">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1659">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1660">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1661">u</span><span class="MJXp-msubsup" id="MJXp-Span-1662"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1663" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1668"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1669">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1664"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1665">n</span><span class="MJXp-mo" id="MJXp-Span-1666">=</span><span class="MJXp-mn" id="MJXp-Span-1667">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1670"><span class="MJXp-mn" id="MJXp-Span-1671">1</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-54"> F_N \大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {1} </script></p><br> 现在，我们没有任何样本贡献很小。 这些样本将不太可能被选择。 这将大大减少结果的差异并加快渲染的收敛速度。 <br><br> 在实践中，不可能找到理想的分布，因为可积函数的某些部分（在我们的例子中为BRDF×余弦×入射光）是未知的（这对于入射光最为明显），但是根据BRDF×余弦甚至仅根据BRDF的样本分布将有所帮助我们。 此原则称为重要性抽样。 <br><br><h2> 余弦样本 </h2><br> 在以下步骤中，我们需要用根据余弦规则的分布替换样本的均匀分布。 别忘了，我们要生成比例<em>较小</em>的样本，而不是用余弦乘以均匀样本，以<em>减少</em>其影响。 <br><br>  Thomas Poole的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这篇文章</a>描述了如何做到这一点。 我们将<code>alpha</code>参数添加到我们的<code>SampleHemisphere</code>函数中。 该函数确定余弦选择的索引：对于均匀样本，0；对于余弦选择，1；对于较高的Phong值，更高。 在代码中，它看起来像这样： <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">float3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHemisphere</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">float3 normal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alpha</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  ,      float cosTheta = pow(rand(), 1.0f / (alpha + 1.0f)); float sinTheta = sqrt(1.0f - cosTheta * cosTheta); float phi = 2 * PI * rand(); float3 tangentSpaceDir = float3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta); //      return mul(tangentSpaceDir, GetTangentSpace(normal)); }</span></span></code> </pre> <br> 现在每个样本的概率相等 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1672"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1673">p</span><span class="MJXp-mrow" id="MJXp-Span-1674"><span class="MJXp-mo" id="MJXp-Span-1675" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1676">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1677">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1678">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1679">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1680">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1681">a</span><span class="MJXp-mrow" id="MJXp-Span-1682"><span class="MJXp-mo" id="MJXp-Span-1683" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-1684" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-1685">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1686">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1687">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1688">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1689">c</span><span class="MJXp-mrow" id="MJXp-Span-1690"><span class="MJXp-mtext" id="MJXp-Span-1691">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1692">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1693">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1694">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1695">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1696">a</span><span class="MJXp-mo" id="MJXp-Span-1697" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1698">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1699"><span class="MJXp-mn" id="MJXp-Span-1700">2</span><span class="MJXp-mtext" id="MJXp-Span-1701">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1702">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1703">i</span></span><span class="MJXp-mtext" id="MJXp-Span-1704" style="color: red;">\，</span><span class="MJXp-mrow" id="MJXp-Span-1705"><span class="MJXp-mo" id="MJXp-Span-1706" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1707">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1708">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1709">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1710">c</span><span class="MJXp-mtext" id="MJXp-Span-1711">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1712">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1713">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1714">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1715">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1716">a</span><span class="MJXp-mtext" id="MJXp-Span-1717">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1718">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1719">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1720">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1721">t</span><span class="MJXp-mtext" id="MJXp-Span-1722">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1723">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1724">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1725">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1726">n</span><span class="MJXp-msubsup" id="MJXp-Span-1727"><span class="MJXp-mrow" id="MJXp-Span-1728" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1729" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-1730" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1731">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1732">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1733">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1734">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1735">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> p（\ omega）= \ frac {\ alpha + 1} {2 \ pi} \，（\ vec \ omega \ cdot \ vec n）^ \ alpha </script>  。 这个方程式的优点可能不会立即显现出来，但是过一会儿您就会理解它。 <br><br><h2> 兰伯特样本的重要性 </h2><br> 首先，我们将优化漫反射渲染。 在我们的均匀分布中，已经使用了Lambert常数BRDF，但是我们可以通过添加余弦来对其进行改进。 样本的余弦概率分布（其中 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1736"><span class="MJXp-mtext" id="MJXp-Span-1737">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1738">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1739">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1740">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1741">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1742">a</span><span class="MJXp-mo" id="MJXp-Span-1743" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1744">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56"> \ alpha = 1 </script>  ）相等 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1745"><span class="MJXp-mtext" id="MJXp-Span-1746">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1747">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1748">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1749">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1750">c</span><span class="MJXp-mrow" id="MJXp-Span-1751"><span class="MJXp-mrow" id="MJXp-Span-1752"><span class="MJXp-mo" id="MJXp-Span-1753" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-1754">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1755">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1756">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1757">c</span><span class="MJXp-mtext" id="MJXp-Span-1758">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1759">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1760">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1761">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1762">g</span><span class="MJXp-msubsup" id="MJXp-Span-1763"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1764" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1765" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1766">i</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1767">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1768">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1769">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1770">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1771">t</span><span class="MJXp-mtext" id="MJXp-Span-1772">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1773">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1774">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1775">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1776">n</span><span class="MJXp-mrow" id="MJXp-Span-1777"><span class="MJXp-mo" id="MJXp-Span-1778" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1779"><span class="MJXp-mtext" id="MJXp-Span-1780">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1781">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1782">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> \ frac {（\ vec \ omega_ {i} \ cdot \ vec n）} {\ pi} </script>  ，它简化了漫反射的蒙特卡洛公式： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1784">L</span><span class="MJXp-mrow" id="MJXp-Span-1785"><span class="MJXp-mo" id="MJXp-Span-1786" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1787">x</span><span class="MJXp-mrow" id="MJXp-Span-1788"><span class="MJXp-mo" id="MJXp-Span-1789" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1790" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1791">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1792">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1793">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1794">c</span><span class="MJXp-mtext" id="MJXp-Span-1795">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1796">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1797">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1798">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1799">g</span><span class="MJXp-msubsup" id="MJXp-Span-1800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1801" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1802" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1803">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1804"><span class="MJXp-mo" id="MJXp-Span-1805" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1806" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1807"><span class="MJXp-mo" id="MJXp-Span-1808" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1809">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1810">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1811">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1812">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1813">c</span><span class="MJXp-mrow" id="MJXp-Span-1814"><span class="MJXp-mn" id="MJXp-Span-1815">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1816"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1817">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1818">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1819">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1820">u</span><span class="MJXp-msubsup" id="MJXp-Span-1821"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1822" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1827"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1828">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1823"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1824">n</span><span class="MJXp-mo" id="MJXp-Span-1825">=</span><span class="MJXp-mn" id="MJXp-Span-1826">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1829"><span class="MJXp-mtext" id="MJXp-Span-1830">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1831">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1832">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1833">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1834">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1835">r</span><span class="MJXp-mrow" id="MJXp-Span-1836"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1837">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1838">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1839">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1840">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1841">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1842">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1843">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1844">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1845">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1846">t</span></span><span class="MJXp-mrow" id="MJXp-Span-1847"><span class="MJXp-msubsup" id="MJXp-Span-1848"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1849" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1850" style="vertical-align: -0.4em;">d</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1851" style="color: red;">\，</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1852">L</span><span class="MJXp-mrow" id="MJXp-Span-1853"><span class="MJXp-mo" id="MJXp-Span-1854" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1855">x</span><span class="MJXp-mrow" id="MJXp-Span-1856"><span class="MJXp-mo" id="MJXp-Span-1857" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1858" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1859">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1860">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1861">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1862">c</span><span class="MJXp-mtext" id="MJXp-Span-1863">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1864">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1865">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1866">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1867">g</span><span class="MJXp-msubsup" id="MJXp-Span-1868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1869" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1870" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1871">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1872"><span class="MJXp-mo" id="MJXp-Span-1873" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-58-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-58"> L（x，\，\ vec \ omega_ {o}）\大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ color {BlueViolet} {k_d} \，L（x ，\，\ vec \ omega_ {i}）} </script></p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   ray.origin = hit.position + hit.normal * 0.001f; ray.direction = SampleHemisphere(hit.normal, 1.0f); ray.energy *= (1.0f / diffChance) * hit.albedo;</span></span></code> </pre> <br> 这将加快我们的漫反射底纹。 现在让我们进入真正的问题。 <br><br><h2>  Fongov重要性抽样 </h2><br> 对于Phong BRDF，此过程类似。 这次我们得到两个余弦的乘积：渲染方程式中的标准余弦（如漫反射的情况）乘以BRDF固有余弦。 我们只会处理最后一个。 <br><br> 让我们将上述示例中的概率分布插入到Phong方程中。 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lafortune和Willems中</a>找到详细的结论<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">：使用修改后的Phong反射模型进行基于物理的渲染（1994）</a> ： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1874"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1875">L</span><span class="MJXp-mrow" id="MJXp-Span-1876"><span class="MJXp-mo" id="MJXp-Span-1877" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1878">x</span><span class="MJXp-mrow" id="MJXp-Span-1879"><span class="MJXp-mo" id="MJXp-Span-1880" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-1881" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1882">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1883">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1884">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1885">c</span><span class="MJXp-mtext" id="MJXp-Span-1886">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1887">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1888">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1889">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1890">g</span><span class="MJXp-msubsup" id="MJXp-Span-1891"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1892" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1893" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1894">o</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1895"><span class="MJXp-mo" id="MJXp-Span-1896" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mtext" id="MJXp-Span-1897" style="color: red;">\大</span><span class="MJXp-mrow" id="MJXp-Span-1898"><span class="MJXp-mo" id="MJXp-Span-1899" style="margin-left: 0.278em; margin-right: 0.278em;">约</span></span><span class="MJXp-mtext" id="MJXp-Span-1900">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1901">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1902">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1903">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1904">c</span><span class="MJXp-mrow" id="MJXp-Span-1905"><span class="MJXp-mn" id="MJXp-Span-1906">1</span></span><span class="MJXp-mrow" id="MJXp-Span-1907"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1908">N</span></span><span class="MJXp-mtext" id="MJXp-Span-1909">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1910">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1911">u</span><span class="MJXp-msubsup" id="MJXp-Span-1912"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1913" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1918"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1919">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-1914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1915">n</span><span class="MJXp-mo" id="MJXp-Span-1916">=</span><span class="MJXp-mn" id="MJXp-Span-1917">0</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1920"><span class="MJXp-mtext" id="MJXp-Span-1921">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1922">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1923">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1924">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1925">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1926">r</span><span class="MJXp-mrow" id="MJXp-Span-1927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1928">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1929">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1930">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1931">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1932">n</span></span><span class="MJXp-mrow" id="MJXp-Span-1933"><span class="MJXp-msubsup" id="MJXp-Span-1934"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1935" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1936" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-1937" style="color: red;">\，</span><span class="MJXp-mtext" id="MJXp-Span-1938">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1939">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1940">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1941">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1942">c</span><span class="MJXp-mrow" id="MJXp-Span-1943"><span class="MJXp-mtext" id="MJXp-Span-1944">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1945">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1946">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1947">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1948">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1949">a</span><span class="MJXp-mo" id="MJXp-Span-1950" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1951">2</span></span><span class="MJXp-mrow" id="MJXp-Span-1952"><span class="MJXp-mtext" id="MJXp-Span-1953">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1954">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1955">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1956">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1957">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1958">a</span><span class="MJXp-mo" id="MJXp-Span-1959" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1960">1</span></span></span><span class="MJXp-mtext" id="MJXp-Span-1961" style="color: red;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-1962"><span class="MJXp-mo" id="MJXp-Span-1963" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\， （</font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-mtext" id="MJXp-Span-1961" style="color: red;"><font style="vertical-align: inherit;"> </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1965"><font style="vertical-align: inherit;">V </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1966"><font style="vertical-align: inherit;">ê </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1967"><font style="vertical-align: inherit;">ç </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1969"><font style="vertical-align: inherit;">ö </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1970"><font style="vertical-align: inherit;">米</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1971"><font style="vertical-align: inherit;">é </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1972"><font style="vertical-align: inherit;">克</font></span><span class="MJXp-msubsup" id="MJXp-Span-1973"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1974" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">一个</font></span></span><span class="MJXp-msubsup" id="MJXp-Span-1973"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1975" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1976"><font style="vertical-align: inherit;">我</font></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1978"><font style="vertical-align: inherit;"> ç </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1979"><font style="vertical-align: inherit;">d </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1980"><font style="vertical-align: inherit;">ö </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1981"><font style="vertical-align: inherit;">吨</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1983"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1984"><font style="vertical-align: inherit;">È </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1985"><font style="vertical-align: inherit;">Ç </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1986"><font style="vertical-align: inherit;">Ñ </font></span><span class="MJXp-mrow" id="MJXp-Span-1987"><span class="MJXp-mo" id="MJXp-Span-1988" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;">）</font></span></span><span class="MJXp-mtext" id="MJXp-Span-1989" style="color: red;"><font style="vertical-align: inherit;"> \，</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1990"><font style="vertical-align: inherit;">大号</font></span><span class="MJXp-mrow" id="MJXp-Span-1991"><span class="MJXp-mo" id="MJXp-Span-1992" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;">（</font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1993"><font style="vertical-align: inherit;"> X </font></span><span class="MJXp-mrow" id="MJXp-Span-1994"><span class="MJXp-mo" id="MJXp-Span-1995" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;">，</font></span></span><span class="MJXp-mtext" id="MJXp-Span-1996" style="color: red;"><font style="vertical-align: inherit;"> \，</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1998"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1999"><font style="vertical-align: inherit;">È </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2000"><font style="vertical-align: inherit;">Ç </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2002"><font style="vertical-align: inherit;">ö </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2003"><font style="vertical-align: inherit;">米</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2004"><font style="vertical-align: inherit;">é </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2005"><font style="vertical-align: inherit;">克</font></span><span class="MJXp-msubsup" id="MJXp-Span-2006"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2007" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">一个</font></span></span><span class="MJXp-msubsup" id="MJXp-Span-2006"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2008" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2009"><font style="vertical-align: inherit;">我</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-2010"><span class="MJXp-mo" id="MJXp-Span-2011" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;">）</font></span></span></font><span class="MJXp-mtext" id="MJXp-Span-1964">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1965"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1966"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1967"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-1968">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1969"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1970"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1971"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1972"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-1973"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1974" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1975" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1976"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mtext" id="MJXp-Span-1977">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1978"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1979"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1980"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1981"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-1982">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1983"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1984"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1985"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1986"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-1987"><span class="MJXp-mo" id="MJXp-Span-1988" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-1989" style="color: red;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1990"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-1991"><span class="MJXp-mo" id="MJXp-Span-1992" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1993"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-1994"><span class="MJXp-mo" id="MJXp-Span-1995" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-1996" style="color: red;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-1997">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1998"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1999"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2000"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-2001">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2002"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2003"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2004"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2005"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-2006"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2007" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2008" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2009"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-2010"><span class="MJXp-mo" id="MJXp-Span-2011" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"></font></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-59"> L（x，\，\ vec \ omega_ {o}）\大约\ frac {1} {N} \ sum_ {n = 0} ^ {N} {\ color {brown} {k_s \，\ frac {\ alpha + 2} {\ alpha + 1}} \，（\ vec \ omega_ {i} \ cdot \ vec n）\，L（x，\，\ vec \ omega_ {i}）} </script></p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   float alpha = 15.0f; ray.origin = hit.position + hit.normal * 0.001f; ray.direction = SampleHemisphere(reflect(ray.direction, hit.normal), alpha); float f = (alpha + 2) / (alpha + 1); ray.energy *= (1.0f / specChance) * hit.specular * sdot(hit.normal, ray.direction, f);</span></span></code> </pre> <br> 这些更改足以消除Phong中的任何高性能问题，并使我们的渲染在更合理的时间内收敛。 <br><br><h1> 用料 </h1><br> 最后，让我们扩展场景的生成范围，为球体的平滑度和发射率创建变化的值！ 在C＃脚本的<code>struct Sphere</code> ，添加<code>public float smoothness</code>和<code>public Vector3 emission</code> 。 由于我们更改了结构的大小，因此在创建计算缓冲区时需要更改步骤（4×浮点数，还记得吗？）。 使<code>SetUpScene</code>函数插入用于平滑度和<code>SetUpScene</code>值。 <br><br> 在着色器中，将两个变量都添加到<code>struct Sphere</code>和<code>struct RayHit</code> ，然后在<code>struct RayHit</code>进行初始化。 最后，在<code>IntersectGroundPlane</code> （硬编码，粘贴任何值）和<code>IntersectSphere</code> （从<code>Sphere</code>获取值）中设置两个值。 <br><br> 我想以与标准Unity着色器相同的方式使用平滑度值，这与相当随意的Fong指数不同。 这是可以在<code>Shade</code>函数中使用的良好转换： <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmoothnessToPhongAlpha</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pow(<span class="hljs-number"><span class="hljs-number">1000.0f</span></span>, s * s); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> alpha = SmoothnessToPhongAlpha(hit.smoothness);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/7f8/88a/aa97f888aba1c109fdee1d2aa333672c.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f8/874/761/9f8874761f5433acdfdaebcf08d59a2e.png"></div><br> 通过在<code>Shade</code>返回值来使用发射率： <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hit.emission;</code> </pre> <br><h1> 结果 </h1><br> 深吸一口气。 放松并等待，直到图像变成如此美丽的图画： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/d23/f12/209d23f129b3a20b6bf0f9c2e06d9633.png" alt="图片"></div><br>  <strong>恭喜你！</strong> 您设法通过了数学表达式的丛林。 我们实现了一个路径跟踪器，该路径执行扩散和镜像着色，通过重要性了解了采样，并立即应用了此概念，以便渲染在数分钟而不是数小时或数天内收敛。 <br><br> 与上一篇相比，本文在复杂性方面迈出了巨大的一步，但也显着提高了结果的质量。 使用数学计算会花费一些时间，但它本身就是合理的，因为它可以极大地加深您对正在发生的事情的理解，并使您可以扩展算法而不会破坏物理可靠性。 <br><br> 感谢您的阅读！ 在第三部分中，我们（一会儿）将离开采样和阴影的丛林，返回文明，与Moller和Trumbor先生见面。 我们将需要与他们谈谈三角形。 <br><br>  <b>关于作者：</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">David Curie</a>是“三眼游戏”的开发商，大众汽车公司的虚拟工程实验室程序员，计算机图形学研究员和重金属音乐家。 <br><br><div style="text-align:center;"><img width="20%" height="20%" src="https://habrastorage.org/getpro/habr/post_images/def/4d6/b93/def4d6b933ae1e274ee1c8c511fc0e7b.png" alt="图片"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN412685/">https://habr.com/ru/post/zh-CN412685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN412675/index.html">比特币和以太坊中的Multisig合约和地址</a></li>
<li><a href="../zh-CN412677/index.html">追溯矩阵</a></li>
<li><a href="../zh-CN412679/index.html">在10分钟内创建一个用于文本识别的Android应用程序。 移动视觉CodeLab</a></li>
<li><a href="../zh-CN412681/index.html">十进制算术的二进制计算</a></li>
<li><a href="../zh-CN412683/index.html">在哪里以及如何学习机器学习？</a></li>
<li><a href="../zh-CN412687/index.html">实施IdM。 程序和技术手段-从基础到IdM</a></li>
<li><a href="../zh-CN412689/index.html">预测性IT分析简化了分布式应用程序监视</a></li>
<li><a href="../zh-CN412691/index.html">在Facebook或取证历史上开玩笑5年</a></li>
<li><a href="../zh-CN412693/index.html">编写易于删除和调试的代码</a></li>
<li><a href="../zh-CN412695/index.html">单元测试的整体情况</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>