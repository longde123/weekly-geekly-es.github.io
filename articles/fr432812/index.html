<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎅🏿 👎🏾 🦗 Nous écrivons des robots de trading en utilisant le cadre graphique StockSharp. Partie 1 🏇🏼 👿 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans notre blog, nous écrivons beaucoup sur les technologies et les outils utiles liés à la négociation d'actions. L'un d'eux est la plate-forme gratu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous écrivons des robots de trading en utilisant le cadre graphique StockSharp. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iticapital/blog/432812/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/f-/uo/a9/f-uoa9b5v33o_a22qip5tgvjg6o.png"></a> <br><br>  Dans notre blog, nous écrivons beaucoup sur les technologies et les outils utiles liés à la négociation d'actions.  L'un d'eux est la plate-forme gratuite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StockSharp</a> , qui peut être utilisée pour le développement professionnel de terminaux de trading et de robots de trading en C #.  Dans cet article, nous montrerons comment utiliser le cadre graphique inclus dans S # .API afin de créer un terminal de trading avec la possibilité d'exécuter des stratégies algorithmiques. <a name="habracut"></a><br><br><h2>  Ce qui est nécessaire </h2><br><ol><li>  Visual Studio 2017 (Communauté, version gratuite), nous y programmerons. </li><li>  Connexion au trading sur la bourse, dans les exemples de ce texte, l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SMARTcom d'ITI Capital est utilisée</a> . </li></ol><br><h2>  Création de projet </h2><br>  Créez une nouvelle application WPF dans Visual Studio: <br><br><img src="https://habrastorage.org/webt/nq/j3/sb/nqj3sbywjx9_xny7tjyac_kn3pc.png"><br><br>  Ensuite, vous devez ajouter la bibliothèque S # .API.  Vous pouvez découvrir comment procéder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans la documentation</a> .  La meilleure option est d'installer à l'aide de Nuget. <br><br>  Étant donné que tous les éléments graphiques S # .API sont basés sur DevExpress et que les bibliothèques DevExpress sont fournies avec S # .API, il serait stupide de ne pas les utiliser.  Passons à l'éditeur de fenêtre MainWindow.xaml: <br><br><img src="https://habrastorage.org/webt/ni/q2/zz/niq2zzalyspdk8ztdf9uatdfnps.png"><br><br>  Remplacez Window par DXWindow, nous en aurons besoin pour utiliser différents schémas de couleurs: <br><br><img src="https://habrastorage.org/webt/ok/jo/h1/okjoh1ouxpadw48b2scjw8x1df4.png"><br><br>  Visual Studio lui-même nous proposera d'insérer les bibliothèques nécessaires. <br><br>  Nous diviserons la fenêtre en trois parties - en haut, il y aura une bande avec des boutons pour configurer les connexions et les connexions, en bas, il y aura une fenêtre avec des journaux et au milieu tous les autres panneaux.  La façon la plus simple de casser une fenêtre est d'utiliser LayoutControl de DevExpress. <br><br>  Dans les trois parties résultantes, nous ajouterons les éléments dont nous avons besoin. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dx:DXWindow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ShellNew.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dxlc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"800"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LayoutControlRoot"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutControl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dx:DXWindow</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  Configuration d'une connexion à un connecteur </h2><br>  Ajoutez deux boutons, l'un est le bouton des paramètres de connexion et le second est le bouton de connexion.  Pour ce faire, utilisez le bouton SimpleButton de DevExpress.  Les boutons seront situés en haut de l'application.  Dans chaque bouton, nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plaçons</a> les images familières de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S # .Designer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S # .Data</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S # .Terminal</a> . <br><br><pre> <code class="cs hljs">&lt;dx:DXWindow x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.MainWindow"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> Title=<span class="hljs-string"><span class="hljs-string">"MainWindow"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"450"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"25"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutItem Width=<span class="hljs-string"><span class="hljs-string">"40"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"SettingsButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SettingsButton_Click"</span></span> &gt; &lt;Image Source=<span class="hljs-string"><span class="hljs-string">"{xaml:ThemedIcons Key=Settings}"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"16"</span></span> /&gt; &lt;/dx:SimpleButton&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Width=<span class="hljs-string"><span class="hljs-string">"40"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"ConnectButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"ConnectButton_Click"</span></span> &gt; &lt;Image Source=<span class="hljs-string"><span class="hljs-string">"{xaml:ThemedIcons Key=Connect}"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"16"</span></span> /&gt; &lt;/dx:SimpleButton&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;!--  --&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/dx:DXWindow&gt;</code> </pre> <br>  Dans le coin supérieur droit du formulaire d'écran, nous verrons l'image suivante: <br><br><img src="https://habrastorage.org/webt/6w/yo/wd/6wyowd9ztiixrpaygfcs-v6eaj4.png"><br><br>  Double-cliquez sur chaque bouton pour créer des gestionnaires d'événements pour cliquer sur le bouton.  Dans le code MainWindow, vous devez déclarer le connecteur, ainsi que l'emplacement et le nom de fichier dans lesquels les paramètres du connecteur seront stockés. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Connector Connector; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _dir = <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _settingsFile = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\connection.xml"</span></span>;</code> </pre> <br>  Dans le gestionnaire d'événements pour avoir cliqué sur le bouton des paramètres du connecteur, nous ouvrirons la fenêtre de configuration du connecteur et l'enregistrerons dans un fichier. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SettingsButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Connector.Configure(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSerializer&lt;SettingsStorage&gt;().Serialize(Connector.Save(), _settingsFile); } }</code> </pre><br>  Dans le constructeur, nous vérifierons s'il existe un répertoire et un fichier avec les paramètres du connecteur, et s'il y en a un, nous le chargerons dans le connecteur: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); Connector = new Connector(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  La plupart des objets S # .API ont des méthodes Save et Load qui peuvent être utilisées pour enregistrer et charger cet objet à partir d'un fichier XML. <br><br>  Dans le gestionnaire de méthode en cliquant sur le bouton de connexion, nous connectons le connecteur. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Connector.Connect(); }</code> </pre> <br>  Vous pouvez maintenant exécuter le programme et le vérifier. <br><br><h2>  Définir un thème sombre </h2><br>  De nombreux traders préfèrent les thèmes sombres aux applications de trading.  Par conséquent, nous assombrissons immédiatement le thème du programme.  Car vous devez trouver le fichier App.xaml: <br><br><img src="https://habrastorage.org/webt/dc/el/xz/dcelxz29jsvbpysoimfdml5lp1m.png"><br><br>  Et remplacez Application par un graphique: ExtendedBaseApplication, et Visual Studio lui-même nous proposera d'insérer les bibliothèques nécessaires. <br><br><pre> <code class="cs hljs">&lt;charting:ExtendedBaseApplication x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.App"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:charting=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> StartupUri=<span class="hljs-string"><span class="hljs-string">"MainWindow.xaml"</span></span>&gt; &lt;/charting:ExtendedBaseApplication&gt;</code> </pre> <br>  Et dans le fichier App.xaml.cs vous devez supprimer ": Application". <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ShellNew</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Interaction logic for App.xaml </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public partial class App { } }</span></span></code> </pre> <br>  Dans le constructeur de MainWindow, écrivez <code>ApplicationThemeHelper.ApplicationThemeName = Theme.VS2017DarkName;</code> <br><br>  Code complet en ce moment: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Connector Connector; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _dir = <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _settingsFile = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\connection.xml"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- ApplicationThemeHelper.ApplicationThemeName = Theme.VS2017DarkName; //---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); Connector = new Connector(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //---------------------------------------------------------------------------------- InitializeComponent(); } private void SettingsButton_Click(object sender, RoutedEventArgs e) { if (Connector.Configure(this)) { new XmlSerializer&lt;SettingsStorage&gt;().Serialize(Connector.Save(), _settingsFile); } } private void ConnectButton_Click(object sender, RoutedEventArgs e) { Connector.Connect(); } }</span></span></code> </pre> <br>  Exécutez pour vérifier le sujet sombre: <br><br><img src="https://habrastorage.org/webt/mk/lh/3v/mklh3vcxuf88y7zil2ub58n_js4.png"><br><br><h2>  Créer une barre d'outils </h2><br>  Ajoutez un dossier dans lequel nous allons stocker tous les contrôles que nous avons créés et appelez-le XAML.  Ajoutez-y notre premier UserControll, donnez-lui le nom SecurityGridControl. <br><br><img src="https://habrastorage.org/webt/y9/ye/oi/y9yeoioudundf5rke7k2vwh9wau.png"><br><br>  Nous y ajoutons un élément SecurityPicker.  Il affichera les outils disponibles.  Par analogie avec la fenêtre principale, nous utiliserons le LayoutControl de DevExpress. <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.SecurityGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Passons au concepteur de la fenêtre principale et changeons la partie centrale en vue signets.  Dans l'un des signets, nous placerons le contrôleur que nous avons créé avec SecurityPicker: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Maintenant que nous avons la barre d'outils, nous devons lui donner une source de données, dans notre cas, c'est un connecteur.  Vous pouvez simplement <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code> dans le constructeur <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code> <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code>  . <br><br>  Mais vous ne devez pas obstruer MainWindow avec du code qui ne s’y applique pas.  Par conséquent, nous allons créer la variable statique Instance et lui affecter MainWindow dans le constructeur MainWindow: <br><br><pre> <code class="cs hljs">… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MainWindow Instance; … Instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; …</code> </pre> <br>  Maintenant, n'importe où dans notre programme, nous pouvons accéder aux propriétés de MainWindow via le code MainWindow.Instance.XXX. <br><br>  Dans le constructeur SecurityGridControl, de cette façon, nous spécifions Connector comme source de données: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecurityGridControl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; }</code> </pre> <br>  Exécutez pour vérifier: <br><br><img src="https://habrastorage.org/webt/kv/yc/ez/kvycezcrwoqeghzdaw2puoagmmc.png"><br><br><h2>  Ajout de journalisation </h2><br>  Le programme, le connecteur ou le robot doivent être contrôlés.  Pour cela, S # .API a une classe LogManager spéciale.  Cette classe reçoit des messages des sources et les transmet aux auditeurs.  Dans notre cas, les sources seront le connecteur, les stratégies, etc., et l'auditeur sera un fichier et un panneau de journalisation. <br><br>  Dans le code MainWindow, nous déclarons l'objet LogManager et l'endroit où il sera stocké: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> LogManager LogManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _logsDir = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\Logs\"</span></span>;</code> </pre> <br>  Dans le constructeur MainWindow, créez un LogManager, définissez la source du connecteur et le fichier d'écoute pour celui-ci: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- LogManager = new LogManager(); LogManager.Sources.Add(Connector); LogManager.Listeners.Add(new FileLogListener { SeparateByDates = SeparateByDateModes.SubDirectories, LogDirectory = _logsDir }); //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  Par analogie avec la barre d'outils, créez un panneau de journalisation dans le dossier XAML, ajoutez un autre UserControl.  Donnez-lui le nom MonitorControl.  Ajoutez-y l'élément Monitor. <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MonitorControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:Monitor x:Name=<span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Dans le constructeur MonitorControl, définissez LogManager sur Monitor en tant qu'écouteur: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MonitorControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.LogManager.Listeners.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GuiLogListener(Monitor)); }</code> </pre> <br>  Ajoutez le MonitorControl créé au bas de MainWindow: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowVerticalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;!--  --&gt; &lt;myxaml:MonitorControl x:Name=<span class="hljs-string"><span class="hljs-string">"MonitorControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Exécutez pour vérifier: <br><br><img src="https://habrastorage.org/webt/ky/xg/mw/kyxgmwzz8wd1cnl91bhpt1007be.png"><br><br><h2>  Créer un panneau en verre </h2><br>  Par analogie avec les panneaux précédents, créez un panneau en verre, ajoutez un autre UserControl au dossier XAML.  Donnez-lui le nom MarketDepthControl. <br><br>  Dans MainWindow, nous avons déjà utilisé LayoutControl, dans ce contrôle, nous utiliserons également LayoutControl.  Nous divisons le panneau en deux parties horizontalement: <br><br><pre> <code class="cs hljs"> &lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MarketDepthControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;dxlc:LayoutGroup&gt; &lt;!--Left--&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;!--Rigth--&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br>  Ajoutez SecurityPicker sur le côté gauche - nous l'avons rencontré lorsque nous avons créé la barre d'outils. <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> SecuritySelected=<span class="hljs-string"><span class="hljs-string">"SecPicker_SecuritySelected"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt;       .     : &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span> SelectionChanged=<span class="hljs-string"><span class="hljs-string">"MarketDepth_SelectionChanged"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  MarketDepthControl doit définir une valeur MaxHeight, sinon l'application ne démarre pas. <br><br>  Sous le verre, nous allons placer les éléments de la tâche du portefeuille, le prix et le volume de la commande: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Portfolio"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;xaml:PortfolioComboBox x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioComboBox"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Price"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditPrice"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Volume"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditVolume"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt;</code> </pre> <br>  Il convient de noter la propriété Label de LayoutItem, elle vous permet de définir le texte devant l'élément.  Ainsi que l'élément SpinEdit de DevExpress dans lequel il est pratique de définir des valeurs numériques.  Ces éléments se présentent comme suit: <br><br><img src="https://habrastorage.org/webt/gr/ix/9j/grix9jsfrxcmaftyx6bpdylnxi4.png"><br><br>  Ci-dessous, nous placerons les boutons d'achat et de vente: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Buy"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"BuyButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"BuyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Sell"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"SelltButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SelltButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Code complet: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MarketDepthControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> xmlns:dxe=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/editors"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;dxlc:LayoutGroup&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> SecuritySelected=<span class="hljs-string"><span class="hljs-string">"SecPicker_SecuritySelected"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span> SelectionChanged=<span class="hljs-string"><span class="hljs-string">"MarketDepth_SelectionChanged"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Portfolio"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;xaml:PortfolioComboBox x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioComboBox"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Price"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditPrice"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Volume"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditVolume"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Buy"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"BuyButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"BuyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Sell"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"SelltButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SelltButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br>  Dans le constructeur MarketDepthControl, définissez la source des outils pour SecurityPicker et la source des portefeuilles pour PortfolioComboBox, dans notre cas, ce sera Connector: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MarketDepthControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; PortfolioComboBox.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); }</code> </pre> <br>  Créez un gestionnaire d'événements de sélection d'outils dans SecurityPicker.  Nous y vérifions si l'outil reçu n'est pas égal à zéro.  S'il n'est pas égal à zéro, nous sauvegardons l'outil reçu dans une variable locale, il nous sera utile lors de la mise à jour du verre.  Ensuite, nous nettoyons et enregistrons l'outil reçu dans le connecteur pour recevoir un verre en utilisant la méthode RegisterMarketDepth.  En utilisant la méthode GetMarketDepth, nous obtenons le verre actuel de l'instrument afin de mettre à jour MarketDepthControl avec lui. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Security _selectedSecurity; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecPicker_SecuritySelected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Security security</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (security == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _selectedSecurity = security; MainWindow.Instance.Connector.RegisterMarketDepth(_selectedSecurity); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marketDepth = MainWindow.Instance.Connector.GetMarketDepth(_selectedSecurity); MarketDepth.UpdateDepth(marketDepth); }</code> </pre> <br>  Pour que le verre soit constamment mis à jour dans le constructeur MarketDepthControl, nous nous abonnons à l'événement de changement de verre MarketDepthChanged sur le connecteur.  Dans le gestionnaire de cet événement, nous vérifierons à quel outil appartient le verre reçu et s'il appartient à l'outil sélectionné dans SecurityPicker, nous le mettons à jour: MarketDepthControl. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MarketDepthControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; PortfolioComboBox.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); MainWindow.Instance.Connector.MarketDepthChanged += Connector_MarketDepthChanged; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connector_MarketDepthChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MarketDepth marketDepth</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_selectedSecurity == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || marketDepth.Security != _selectedSecurity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; MarketDepth.UpdateDepth(marketDepth); }</code> </pre> <br>  Dans la partie centrale de MainWindow, ajoutez le panneau MarketDepthControl créé: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MyTrades"</span></span>&gt; &lt;myxaml:MyTradeGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span>&gt; &lt;myxaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepthControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  À ce stade, vous pouvez exécuter le programme et vérifier le fonctionnement de la mise à jour des lunettes. <br>  Créez un gestionnaire d'événements pour cliquer sur les boutons d'achat et de vente.  Dans chaque gestionnaire, nous créons une commande, nous y indiquons l'outil sélectionné dans SecurityPicker, le portefeuille sélectionné dans PortfolioComboBox, le volume et le prix du SpinEdit correspondant.  Enregistrez l'application dans Connector à l'aide de la méthode RegisterOrder. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuyButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Order order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order() { Security = _selectedSecurity, Portfolio = PortfolioComboBox.SelectedPortfolio, Volume = SpinEditVolume.Value, Price = SpinEditPrice.Value, Direction = StockSharp.Messages.Sides.Buy, }; MainWindow.Instance.Connector.RegisterOrder(order); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelltButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Order order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order() { Security = _selectedSecurity, Portfolio = PortfolioComboBox.SelectedPortfolio, Volume = SpinEditVolume.Value, Price = SpinEditPrice.Value, Direction = StockSharp.Messages.Sides.Sell, }; MainWindow.Instance.Connector.RegisterOrder(order); }</code> </pre> <br>  Les deux processeurs ne diffèrent que dans le sens de l'application. <br><br>  Faisons en sorte que la valeur SpinEditPrice change en fonction du prix du devis sélectionné lors de la sélection de devis dans un verre.  Pour ce faire, créez un gestionnaire d'événements SelectionChanged pour MarketDepthControl.  Dans lequel nous mettrons à jour la valeur de SpinEditPrice au prix du devis sélectionné si le devis sélectionné n'est pas égal à zéro. <br><br><pre> <code class="plaintext hljs">private void MarketDepth_SelectionChanged(object sender, GridSelectionChangedEventArgs e) { if (MarketDepth.SelectedQuote == null) return; SpinEditPrice.Value = MarketDepth.SelectedQuote.Price; }</code> </pre> <br>  Exécutez pour vérifier: <br><br><img src="https://habrastorage.org/webt/p9/15/of/p915of4vabbulkuyg8zjlvxzsei.png"><br><br><h2>  Sauvegarde des données du marché </h2><br>  Pour enregistrer des portefeuilles, des outils, des plateformes, nous avons besoin de la classe CsvEntityRegistry.  Il est nécessaire de refaire l'emplacement de stockage de l'entité et d'appeler la méthode Init pour les charger. <br><br><pre> <code class="cs hljs"> _csvEntityRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CsvEntityRegistry(_csvEntityRegistryDir); _csvEntityRegistry.Init();</code> </pre> <br>  Pour économiser des bougies, des offres, etc.  nous avons besoin de StorageRegistry: <br><br><pre> <code class="cs hljs"> _storageRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StorageRegistry { DefaultDrive = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalMarketDataDrive(_storageRegistryDir), };</code> </pre> <br>  Nous avons également besoin du registre SnapshotRegistry des magasins d'instantanés: <br><br><pre> <code class="cs hljs">_snapshotRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SnapshotRegistry(_snapshotRegistryDir);</code> </pre> <br>  Tout cela, nous le transmettons au connecteur lors de sa création: <br><br><pre> <code class="cs hljs">Connector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Connector(_csvEntityRegistry, _storageRegistry, _snapshotRegistry) { IsRestoreSubscriptionOnReconnect = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, StorageAdapter = { DaysLoad = TimeSpan.FromDays(<span class="hljs-number"><span class="hljs-number">3</span></span>) }, }; Connector.LookupAll();</code> </pre> <br>  Ici, nous avons également indiqué que le connecteur se reconnectera lorsque la connexion sera déconnectée et indiquera également le nombre de jours d'historique à télécharger.  String Connector.LookupAll ();  demande les données disponibles: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); _csvEntityRegistry = new CsvEntityRegistry(_csvEntityRegistryDir); _csvEntityRegistry.Init(); _storageRegistry = new StorageRegistry { DefaultDrive = new LocalMarketDataDrive(_storageRegistryDir), }; _snapshotRegistry = new SnapshotRegistry(_snapshotRegistryDir); Connector = new Connector(_csvEntityRegistry, _storageRegistry, _snapshotRegistry) { IsRestoreSubscriptionOnReconnect = true, StorageAdapter = { DaysLoad = TimeSpan.FromDays(3) }, }; Connector.LookupAll(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  Après avoir chargé l'application, en allant dans le dossier Data, nous verrons que de nouveaux dossiers sont apparus: <br><br><img src="https://habrastorage.org/webt/ur/5a/jx/ur5ajx_3klmkbkcfzkyrqqamuza.png"><br><br>  Lors de la reconnexion, les barres d'outils et les portefeuilles seront déjà remplis. <br><br>  Nous avons approché en douceur la fin de la première partie.  À ce stade, le programme vous permet d'afficher toutes les données de marché dont nous disposons.  La partie suivante démontrera les plus délicieux - à savoir, le commerce en mode manuel et automatique. <br><br>  <i>À suivre ...</i> <br><br>  <b>Auteur</b> : Ivan Zalutsky </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432812/">https://habr.com/ru/post/fr432812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432802/index.html">Six plates-formes d'apprentissage de programmation automatisées gratuites</a></li>
<li><a href="../fr432804/index.html">Toute la vérité sur RTOS. Article # 24. Files d'attente: services auxiliaires et structures de données</a></li>
<li><a href="../fr432806/index.html">Superintelligence: une idée qui hante les gens intelligents</a></li>
<li><a href="../fr432808/index.html">Salaires en AI: où il y a plus d'argent et qui ils cherchent en Russie</a></li>
<li><a href="../fr432810/index.html">Premières amendes pour le GDPR: qui a déjà été puni</a></li>
<li><a href="../fr432814/index.html">Intégration de Cake et TeamCity</a></li>
<li><a href="../fr432816/index.html">AXIS M3046-V vs IDIS DC-D3212X: Comparez les caméras CCTV</a></li>
<li><a href="../fr432818/index.html">Traceur maison: conseils pour les débutants, travailler avec grbl-firmware</a></li>
<li><a href="../fr432820/index.html">Test dynamique des applications Android</a></li>
<li><a href="../fr432822/index.html">Je gâche le code de ma vie pour les développeurs et je ne veux plus le faire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>