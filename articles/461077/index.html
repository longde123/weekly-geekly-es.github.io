<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèø üîÇ üõ¥ ¬øC√≥mo se cocinan los pentesters? Pruebas de entrada para pasantes de seguridad digital üòÄ üèùÔ∏è ‚õ©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Summer of Hack 2019 en Digital Security ya est√° en pleno apogeo, lo que significa que es hora de contar c√≥mo reclutamos personas. 



 Bajo el corte, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo se cocinan los pentesters? Pruebas de entrada para pasantes de seguridad digital</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/461077/">  <b>Summer of Hack 2019</b> en Digital Security ya est√° en pleno apogeo, lo que significa que es hora de contar c√≥mo reclutamos personas. <br><br><img src="https://habrastorage.org/webt/iv/ef/ud/ivefudzwssbwskpfaxaxkczsxvu.jpeg"><br><br>  Bajo el corte, material voluminoso e interesante sobre c√≥mo seleccionamos j√≥venes especialistas para nuestra pasant√≠a "Summer of Hack 2019", y espec√≠ficamente para el Departamento de Auditor√≠a de Seguridad. <br><br>  Considere lo que, en nuestra opini√≥n, un pentester deber√≠a saber para hacer su trabajo con √©xito. <br><br>  Analicemos una serie de tareas dif√≠ciles que torturamos a los chicos, incluso en nombre de uno de ellos. <br><a name="habracut"></a><br>  Quiz√°s la parte m√°s interesante de la selecci√≥n para una pasant√≠a en el departamento de auditor√≠a de seguridad fue nuestro perfil.  Todos los a√±os nos reunimos en todo el departamento y discutimos qu√© habilidades, en nuestra opini√≥n, requieren un especialista moderno en el campo de la seguridad pr√°ctica, recordamos las tareas m√°s interesantes que tuvieron que resolverse este a√±o y escribimos √°reas de conocimiento sin las cuales es dif√≠cil imaginar un auditor exitoso.  Cuando se bromean todos los chistes y se cuentan las historias, el resultado final sigue siendo un conjunto de ideas. <br><br>  Este a√±o, nos guiamos por los siguientes requisitos: <br><br><ul><li>  Conocimientos b√°sicos de las aplicaciones web del dispositivo y ataques contra ellos; </li><li>  Conocimientos b√°sicos de protecci√≥n basada en navegador y mecanismos de control de acceso (s√≠, el mismo SOP y CORS, sin ellos); </li><li>  Habilidades b√°sicas de lectura de c√≥digos y la capacidad de ver la l√≥gica detr√°s de esto; </li><li>  Comprender el funcionamiento de las redes inform√°ticas y el enrutamiento en ellas; </li><li>  Experiencia con sistemas similares a Linux; </li><li>  La capacidad de no tener miedo a la tecnolog√≠a desconocida.  La capacidad de googlear y sistematizar la informaci√≥n recibida; </li><li>  Y una pizca de Android (aunque no es necesario, pero este es nuestro peque√±o capricho). </li></ul><br>  Despu√©s se desarrollaron las preguntas.  Parcialmente, los tomamos prestados de las preguntas que hicimos en las entrevistas, pero m√°s de la mitad estaban especialmente preparados para este cuestionario.  Nuestros expertos dedicaron su tiempo personal a preparar vertederos de tr√°fico, discutiendo sobre c√≥mo formular mejor la pregunta y qu√© vulnerabilidades eran "demasiado espec√≠ficas, por qu√© atormentar a los alumnos".  Para tal celo, no podemos evitar quitarnos el sombrero (blanco, por supuesto). <br><br>  El an√°lisis de cada pregunta consta de dos partes.  La primera parte es la respuesta de uno de nuestros alumnos: Danila <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Korgik_0</a> Leontyeva (es el autor de la publicaci√≥n), y la segunda son los comentarios de especialistas que estaban acumulando el cuestionario. <br><br><hr><br>  <i>Hola Habr!</i> <i><br><br></i>  <i>Primero, una peque√±a digresi√≥n l√≠rica.</i> <i><br></i>  <i>M√°s espec√≠ficamente, "¬øC√≥mo me enter√© de Summ3r 0f h4ck".</i> <i><br></i>  <i>Escuch√© sobre el anuncio de la pasant√≠a en un discurso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Denis Rybin</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ilya Bulatov</a> en la conferencia RuCTF2019.</i> <i><br><br></i>  <i>Literalmente, despu√©s de 4 d√≠as, se public√≥ una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci√≥n</a> en habr sobre la apertura de un conjunto de pasant√≠as.</i> <i><br><br></i>  <i>Y en la tarde del mismo d√≠a abr√≠ la tarea, en el departamento de auditor√≠a de seguridad, y me sumerg√≠ en el trabajo.</i>  <i>Hoy compartir√© con el lector qu√© dificultades tuve que enfrentar y qu√© opci√≥n de soluci√≥n podr√≠a ofrecer.</i> <br><br><hr><br><h1>  <strong><font color="#cc0000">No 1.</font></strong>  <strong><font color="#cc0000">C√≥digo fuente php</font></strong> </h1><br>  Examina el c√≥digo.  Describa los defectos que ve y c√≥mo los solucionar√≠a. <br><br><img src="https://habrastorage.org/webt/ne/0x/ku/ne0xkuq_5uz955i1rypa8or5spk.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">An√°lisis de trabajo</b> <div class="spoiler_text">  Cuarta l√≠nea: use el hash md5. <br>  Problema: md5 puede ser brutalizado en un tiempo razonable usando hashcat. <br>  ¬øC√≥mo arreglarlo? <br><br>  Usar m√°s algoritmos de hash "intensivos en recursos". <br>  En este caso, debe rechazar por completo las cookies del usuario y vincular toda la l√≥gica a phpsession. <br><br>  5ta l√≠nea - Inyecciones PostgreSQL. <br>  ¬øC√≥mo arreglarlo? <br>  Usando una declaraci√≥n preparada. <br>  Implementaci√≥n de una declaraci√≥n preparada para verificar el inicio de sesi√≥n <br><br><pre><code class="plaintext hljs">$query = "SELECT username FROM login WHERE username=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($username)); $username = $stmt-&gt;fetchColumn(); if($username == FALSE) { die(" !"); }</code> </pre> <br>  L√≠nea 11: una serie de decisiones fallidas. <br><br><ol><li>  Demasiada vida de sesi√≥n.  Todo un a√±o es mucho.  Si la cookie se secuestra con √©xito, es posible que el atacante tenga acceso prolongado a la cuenta de usuario. </li><li>  Falta la bandera httpOnly.  Si se establece en VERDADERO, solo se podr√° acceder a las cookies a trav√©s del protocolo HTTP.  Es decir, las cookies en este caso no estar√°n disponibles para lenguajes de script como JavaScript. </li><li>  Sin cookie hashing. </li><li>  Falta de establecer la bandera segura.  El indicador de seguridad indica que se debe enviar una cookie desde el cliente a trav√©s de una conexi√≥n HTTPS segura.  Si se establece en VERDADERO, la cookie del cliente se enviar√° al servidor solo si se establece una conexi√≥n segura. </li></ol><br>  ¬øC√≥mo arreglarlo? <br>  Por defecto, en php, la duraci√≥n de la sesi√≥n es de solo 24 minutos, implementemos esto. <br>  Establezca la bandera de seguridad, httpOnly. <br><br>  En este caso, debe rechazar la cookie de usuario extra√±o y vincular toda la l√≥gica a phpsession. <br><br>  18 line - XSS (Scripting entre sitios en ingl√©s - "scripts entre sitios"). <br>  ¬øC√≥mo arreglarlo?  Convierta todos los caracteres posibles a las entidades HTML correspondientes. <br><br><pre> <code class="plaintext hljs">$query = htmlentities($query, ENT_QUOTES, "UTF-8");</code> </pre> <br>  Indicaremos expl√≠citamente la codificaci√≥n para evitar su sustituci√≥n por UTF-7. <br><br><pre> <code class="plaintext hljs">header("Content-Type: text/html; charset=utf-8");</code> </pre> <br>  L√≠nea 20 - defectos del sistema de autenticaci√≥n y almacenamiento de sesi√≥n. <br><br>  Problema: si configura el ID de usuario codificado en base64 en el usuario de cookies, ¬°puede iniciar sesi√≥n en su cuenta! <br><br>  ¬øC√≥mo arreglarlo?  Al autorizar al usuario, registramos la sesi√≥n en la base de datos y al instalar la sesi√≥n verificamos su presencia en la base de datos. <br><br><pre> <code class="plaintext hljs"> $query = "SELECT sessions FROM login WHERE sessions=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($_COOKIE["user"])); $session = $stmt-&gt;fetchColumn(); if($session == TRUE) { do_login($_COOKIE["user"]); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comentario experto D:</b> <div class="spoiler_text"><blockquote>  La primera pregunta con la que el cuestionario se reuni√≥ con futuros pasantes se refer√≠a a las vulnerabilidades web principales y ampliamente conocidas.  La √∫nica dificultad aqu√≠ es la necesidad de verlos en el c√≥digo fuente en PHP.  Sin embargo, nadie estableci√≥ la tarea de "ocultar errores". <br><br>  Aqu√≠ hay una lista de vulnerabilidades que se pueden detectar en este listado en orden de frecuencia de detecci√≥n: <br><br>  <b>El hashing de contrase√±as usando el algoritmo MD5 fue</b> notado incluso por candidatos lejos de la web.  Sin embargo, tambi√©n hubo matices interesantes, por ejemplo, muchos candidatos usaron t√©rminos muy incorrectos, tratando de describir los problemas en sus propias palabras.  Las "vulnerabilidades de algoritmo", las "funciones unidireccionales", "la existencia de colisiones" y otros giros extra√±os entraron en batalla, luego de un examen m√°s detallado, no son m√°s que un conjunto de palabras grandes que no revelan la esencia.  Por supuesto, aqu√≠ fuimos a una reuni√≥n y no encontramos fallas en aquellas personas que se est√°n preparando para emprender el camino para aprender la sabidur√≠a de la seguridad de la informaci√≥n.  Para obtener una "compensaci√≥n", bastar√≠a mencionar la amenaza, que en caso de comprometer la base de datos, los atacantes pueden resolver los hash md5 en un tiempo aceptable y se pueden obtener contrase√±as (o cadenas equivalentes) en texto claro.  Y, por supuesto, muchos mencionaron la falta de sal y fuerza bruta basada en el uso de tablas de arcoiris.  Tambi√©n percibimos dichos comentarios positivamente, especialmente si el encuestado explic√≥ por qu√© esto es una amenaza. <br><br>  <b>Posible inyecci√≥n de SQL.</b>  Es dif√≠cil agregar algo;  Al realizar una llamada a la base de datos, la entrada del usuario de inicio de sesi√≥n y contrase√±a se concatena directamente con la solicitud.  Si es poco probable que pueda manipular el valor de la contrase√±a en esta etapa (se le quita un hash), entonces introducir una inyecci√≥n en el nombre de usuario no ser√° dif√≠cil para un atacante potencial. <br><br>  <b>Salida de informaci√≥n de depuraci√≥n innecesaria que conduce a un ataque XSS.</b>  Al leer cuidadosamente la lista, se podr√≠a prestar atenci√≥n a la llamada de eco, que muestra la solicitud generada a la base de datos en comentarios HTML en la p√°gina.  Por supuesto, tal conclusi√≥n de informaci√≥n adicional a la p√°gina es completamente opcional y, muy probablemente, simplemente olvidada por el desarrollador despu√©s de realizar las pruebas.  Dicha informaci√≥n adicional es muy beneficiosa para el atacante y permite una mejor comprensi√≥n de c√≥mo funciona la aplicaci√≥n.  Sin embargo, desafortunadamente, esto es solo la mitad del problema.  El hecho es que un atacante puede manipular el contenido de la variable de consulta, y su contenido no se puede filtrar ni escapar antes de mostrarse al usuario; existe un posible ataque XSS.  Sin embargo, su explotaci√≥n puede llegar a ser un dolor de cabeza debido a la funci√≥n strtoupper mal ubicada.  El vector inyectado por el atacante estar√° en may√∫scula, y si esto no es un problema para las etiquetas HTML, entonces Javascript est√° muy ofendido por tal atractivo.  Esto se puede verificar f√°cilmente utilizando la consola del navegador. <br><br><img src="https://habrastorage.org/webt/cg/ev/oy/cgevoykot6pzht0mx5ppeqyxwne.png"><br><br>  Bueno, al menos, aparentemente, el atacante tendr√° que recurrir a los llamados "ataques sin script" o t√©cnicas sofisticadas para evitar el filtrado (en este caso, JSFUCK lo har√≠a), por lo que el hecho de un riesgo de seguridad no cancela esto. <br><br>  <b>Un error en la l√≥gica del mecanismo de gesti√≥n de la sesi√≥n</b> fue la parte m√°s interesante de la tarea.  Su descubrimiento requiri√≥ no solo leer la fuente l√≠nea por l√≠nea, sino tambi√©n comprender la l√≥gica de todo el listado.  Uno podr√≠a sentir que algo estaba mal al notar la configuraci√≥n de una cookie que contiene la identificaci√≥n de usuario codificada en base64 en el bloque recordarme.  Un an√°lisis m√°s detallado de la l√≥gica de este mecanismo nos lleva a la idea: "¬øResulta que un atacante que conoce o atraviesa la identificaci√≥n puede iniciar sesi√≥n en cualquier cuenta sin ingresar un nombre de usuario y contrase√±a?".  S√≠, de hecho, un atacante puede generar independientemente un usuario de cookies a su lado y asignarle cualquier valor de identificaci√≥n codificado por base64.  Enviar una solicitud con dicha cookie sin nombre de usuario y contrase√±a activar√≠a la funci√≥n do_login e iniciar√° sesi√≥n en la cuenta de otra persona. <br><br>  La menci√≥n de estas 4 vulnerabilidades en la respuesta de los candidatos influy√≥ directamente en sus puntajes. <br><br>  Sin embargo, mucho depend√≠a de la calidad de la respuesta.  Mencionando formas de rectificar la situaci√≥n, comentarios sobre factores adicionales que afectan la viabilidad de un ataque, el uso de los t√©rminos correctos y la capacidad de estructurar sus pensamientos, comentarios sobre debilidades adicionales o amenazas potenciales: todo esto calienta nuestros corazones y conduce a un aumento en la calificaci√≥n final. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">No 2.</font></strong>  <strong><font color="#cc0000">Jwt</font></strong> </h1><br>  Al investigar una aplicaci√≥n web, descubri√≥ que la aplicaci√≥n utiliza un token JWT como autorizaci√≥n. <br><br>  ¬øQu√© preocupaciones de seguridad ves, qu√© tipo de controles har√≠as? <br><br>  Token JWT: <br><br><pre> <code class="plaintext hljs">eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6InNla2EiL CJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiRmFsc2UiLCJwYX Nzd29yZCI6IjFkMDBjYUgifQ.F7Y1mCAmg5-QFok-rkpLdwe8prCyiKsCyJ-3Z5f7luI</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">An√°lisis de trabajos</b> <div class="spoiler_text">  Tokens web de Dan JSON (JWT). <br>  Su estructura -&gt; [base64url (HEADER)]. [Base64url (PAYLOAD)]. [Base64url (SIGNATURE)] <br>  [base64url (HEADER)] = eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0 <br>  decodificaci√≥n base64url -&gt; {"alg": "None", "typ": "JWT"} <br>  Uno puede notar de inmediato el hecho de que el algoritmo de firma ("alg": "Ninguno") de la firma no se utiliza.  Algunas bibliotecas JWT no admiten el algoritmo "ninguno", es decir, el algoritmo de firma.  Cuando el encabezado alg es "ninguno", el lado del servidor no realizar√° la verificaci√≥n de firma. <br>  Es decir, puede escribir cualquier carga √∫til en base64url, y su firma no ser√° verificada. <br>  Lo que nos permite crear un usuario con derechos de administrador. <br><br>  Adem√°s, el hecho de que la parte de la carga √∫til no utiliza encabezados como aud (define los destinatarios para los que est√° destinado el token JWT) y exp (la vida √∫til del token) simplifica nuestras vidas. <br><br>  Carga √∫til estimada <br>  eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6ImhhY2siLCJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiVHJ1ZSIsInBhc3N3b3JkIjoiaGFjayJ9 <br><br>  carga √∫til de decodificaci√≥n base64url -&gt; {"sub": "1234567890", "nombre": "piratear", "iat": 1516239022, "rol": "nadie", "isAdmin": "Verdadero", "contrase√±a": "piratear" ¬ª} <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comentario experto D:</b> <div class="spoiler_text"><blockquote>  En el trabajo del auditor a menudo hay que lidiar con nuevas tecnolog√≠as, y la capacidad de comprenderlas es muy importante.  Incluyendo esta pregunta en el cuestionario, asumimos que la mayor√≠a de los candidatos apenas escuch√≥ sobre la tecnolog√≠a de los tokens JWT, excepto por el nombre.  Por lo tanto, esta pregunta, en primer lugar, estaba dirigida a la capacidad de buscar y analizar informaci√≥n de fuentes p√∫blicas.  Como resultado, una persona que perdi√≥ la emisi√≥n de Google a pedido de "JWT" ‚Äã‚Äãy "vulnerabilidad jwt" podr√≠a llegar a las siguientes conclusiones: <br><br>  1. Este token no tiene un algoritmo de firma, por lo que un atacante puede modificar cualquier campo dentro del token, lo cual no es asumido por el concepto de tokens JWT. <br><br>  2. Los campos dentro del token contienen la contrase√±a del usuario en texto claro, almacenar dicha informaci√≥n en el token es, como m√≠nimo, una mala pr√°ctica.  En la mayor√≠a de los casos, puede rechazar dicha decisi√≥n y, por lo tanto, aumentar su nivel de seguridad. <br><br>  3. Recordando la falta de una firma y nuestra capacidad para modificar los campos dentro del token, es l√≥gico suponer que cambiar el valor de isAdmin puede aumentar nuestros privilegios a privilegios de administrador. <br><br>  4. Otra idea interesante que pocas personas mencionaron en su respuesta se refiere al hecho de la capacidad de transferir la entrada del usuario en los campos de un token JWT.  En una situaci√≥n normal, un atacante no puede influir en los datos del token de ninguna manera, lo que significa que los desarrolladores a menudo pueden descuidar la introducci√≥n de verificaciones adicionales en el c√≥digo de los controladores.  Esto plantea la idea simple: pero intentemos realizar ataques cl√°sicos no a trav√©s de par√°metros GET / POST, sino a trav√©s de campos de token.  Esto puede dar un resultado inesperadamente bueno.  Este enfoque creativo con la justificaci√≥n correcta de nuestras acciones fue muy apreciado por nosotros al evaluar este y otros temas. <br><br>  Muchos candidatos en sus respuestas organizaron un breve recuento de c√≥mo est√° estructurado el token JWT, y d√≥nde se usa, fue interesante para nosotros leerlo y, sin embargo, antes que nada, evaluamos los aspectos de la respuesta con respecto a la seguridad. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">N√∫mero 3.</font></strong>  <strong><font color="#cc0000">CORS / CSRF / IDOR / ???</font></strong> </h1><br><br>  En la aplicaci√≥n web, la contrase√±a del usuario se cambia mediante la siguiente solicitud (consulte la Opci√≥n 1).  ¬øQu√© amenazas de seguridad potenciales ves?  ¬øQu√© controles llevar√≠as a cabo?  ¬øCambiar√° la situaci√≥n en el caso del siguiente comportamiento (ver Opci√≥n 2)?  Explica tu respuesta. <br><img src="https://habrastorage.org/webt/mr/b-/se/mrb-seaadzkgqbmqvsq-zcqflyo.jpeg"><br><div class="spoiler">  <b class="spoiler_title">An√°lisis de trabajos</b> <div class="spoiler_text">  <b>Opcion 1</b> <br>  "¬øQu√© amenazas de seguridad potenciales ves?" <br><br>  1) Falta de control de acceso. <br>  Si el usuario, un n√∫mero al que se realiza la solicitud de cambio de contrase√±a no se verifica, la contrase√±a se puede cambiar para cualquier usuario registrado en el sistema. <br>  ¬øC√≥mo arreglarlo?  - JSESSION coincidente de la base de datos y el id-shnik solicitado. <br><br>  2) La capacidad de realizar ataques CSRF <br>  Atraemos a un usuario autorizado a un host controlado por nosotros y, despu√©s de hacer una solicitud, a example.com en nombre de la v√≠ctima, para cambiar la contrase√±a. <br>  ¬øC√≥mo arreglarlo?  - Agregar token CSRF. <br><br>  <b>Opci√≥n 2</b> <br>  "¬øQu√© amenazas de seguridad potenciales ves?" <br>  Un defecto en la pol√≠tica de CORS. <br>  Se recomienda que incluya en la lista blanca el encabezado Access-Control-Allow-Origin. <br><br>  ¬øC√≥mo arreglarlo?  - <br><br>  1) Modificar el archivo .htaccess <br><br><pre> <code class="plaintext hljs">&lt;ifmodule mod_headers.c&gt; Header always set Access-Control-Allow-Origin: "https://whitelist.domain.ru" Header always set Access-Control-Allow-Methods "PUT" &lt;/ifmodule&gt;</code> </pre><br>  2) PHP <br><br><pre> <code class="plaintext hljs">&lt;?php header('Access-Control-Allow-Origin: ‚Äúhttps://whitelist.domain.ru‚Äù); header('Access-Control-Allow-Methods: PUT'); ?&gt;</code> </pre><br>  "¬øCambiar√° la situaci√≥n con el siguiente comportamiento?" <br><br>  Si  Como en el segundo caso, se utiliza una solicitud PUT, lo cual es importante, ya que el uso de una solicitud PUT hace que la solicitud CORS sea "dif√≠cil", lo que a su vez nos priva por completo de la oportunidad de realizar un ataque CSRF + la ausencia de un encabezado como Access-Control-Allow-Credentials: true nos priva la capacidad de enviar en el lugar con otros encabezados http y cookies de usuario. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comentario de expertos I:</b> <div class="spoiler_text"><blockquote>  Consideremos, en orden, cu√°les son los principales problemas visibles en las consultas dadas: <br><br>  1) De hecho, dado que el identificador num√©rico del usuario "10012" se observa en la solicitud, ¬øel primer paso es verificar si es posible cambiar la contrase√±a de otro usuario?  ¬øPuede ser suficiente <b>especificar la identificaci√≥n de otra persona</b> ? <br>  Las vulnerabilidades de la clase IDOR son bastante f√°ciles de explotar y a menudo tienen una gran criticidad. <br><br>  2) La solicitud para cambiar la contrase√±a se realiza mediante el m√©todo POST, no se observa el token CSRF y el tipo de contenido es "text / plain".  Existe la posibilidad de <b>fingir tal solicitud.</b> <br><br>  En consecuencia, para cambiar la contrase√±a de la v√≠ctima, es suficiente para que el atacante los convenza de que solo visiten el enlace "malicioso". <br><br>  3) En los encabezados de respuesta, el servidor <b>revela la versi√≥n del software utilizado</b> .  Esto puede denominarse vulnerabilidad en un momento, pero es mejor ocultar tales pancartas: los atacantes pueden encontrar f√°cilmente las conocidas vulnerabilidades de 1 d√≠a en ellas, adem√°s el valor del software utilizado simplifica enormemente la planificaci√≥n de nuevos ataques. <br><br>  4) Estar√≠amos muy contentos de ver la oraci√≥n "¬øQu√© suceder√° si <b>cambiamos el formato de datos de JSON a XML</b> ?" <br><br>  El hecho es que los marcos modernos son inteligentes, omn√≠voros y pueden procesar datos en diferentes formatos.  Y al analizar XML, a menudo se permite una vulnerabilidad XXE peligrosa.  Con su ayuda, el intruso puede "ir" a la red interna, puede leer archivos de configuraci√≥n del servidor y, ocasionalmente, ejecutar RCE. <br><br>  5) Tambi√©n quer√≠a ver un comentario como "¬øPor qu√© <b>no se comprueba el conocimiento de lo antiguo</b> al cambiar la contrase√±a?" <br><br>  En cuanto a la "Variante No. 2", hay una "trampa" en ella: los encabezados CORS se usan aqu√≠, y el Tipo de contenido de la solicitud ya est√° configurado en "aplicaci√≥n / json". <br><br>  El error que cometi√≥ la gran mayor√≠a de los candidatos es la respuesta del formulario "¬°Ese es el asterisco en Allow-Origin, lo que significa que puede enviar solicitudes desde cualquier sitio!" <br><br>  No, no puedes.  En primer lugar, falta el encabezado Allow-Credentials: True, lo que significa que el navegador debe ejecutar la solicitud "con cookies", por lo que la solicitud ser√≠a an√≥nima, sin una sesi√≥n.  Y en segundo lugar, incluso si ese encabezado estuviera presente, el navegador seguir√≠a prohibiendo el env√≠o de cookies, solo por el "asterisco".  Su combinaci√≥n est√° prohibida y se ignora el navegador. <br></blockquote></div></div><br><hr><br><h1>  <strong><font color="#cc0000">Numero 4.</font></strong>  <strong><font color="#cc0000">Volcado de red</font></strong> </h1><br>  Imagine que ingres√≥ a la red interna de la empresa e intercept√≥ el tr√°fico cuyo volcado se adjunta a continuaci√≥n.  Describa qu√© ataques intentar√≠a realizar y con qu√© herramientas. <br><br>  Volcado: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">yadi.sk/d/qkLcfwSCzdxcwg</a> <br><br><div class="spoiler">  <b class="spoiler_title">An√°lisis de trabajos</b> <div class="spoiler_text">  1) Falsificaci√≥n de LLMNR &lt; <br>  Un atacante en la subred local puede escuchar y responder mensajes de difusi√≥n, alegando que el nombre de host solicitado es su propia direcci√≥n IP. <br>  Esto lleva al hecho de que la computadora cliente solicitante est√° conectada a la computadora del atacante y, seg√∫n el protocolo, puede intentar autenticarse. <br><br>  Las utilidades utilizadas son Intercepter-NG, un proyecto en githab VindicateTool. <br><br>  2) abuso de HSRP. <br>  Problem√°tica: cuando el par√°metro "preferencia" se establece en 1, el atacante tiene la oportunidad de "desplazar" a otros enrutadores, debido a la mayor prioridad.  Despu√©s de enviar HSRP a la multidifusi√≥n, el enrutador controlado se convierte en el enrutador principal (enrutador activo) en la red y todo el tr√°fico lo atravesar√°.  De hecho, llegamos a la implementaci√≥n de los ataques mitm. <br><br>  Para este vector de ataque, necesitamos conocer el grupo y la contrase√±a. <br>  Por el volcado de tr√°fico que se nos da, reconocemos el grupo (es - 3) y la contrase√±a.  La contrase√±a en nuestro caso es la predeterminada: Cisco. <br><br>  Las utilidades utilizadas son yersinia, escalofriante. <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Comentario experto X:</b> <div class="spoiler_text"><blockquote>  El objetivo de la pregunta era determinar la familiaridad del aprendiz con las t√©cnicas modernas (y no tan) para llevar a cabo ataques MitM.  Veamos escenarios potenciales basados ‚Äã‚Äãen un volcado de tr√°fico existente: <br><br>  <b>1) suplantaci√≥n de ARP</b> <br>  La suplantaci√≥n de ARP es la forma m√°s antigua y f√°cil de implementar ataques MitM.  Consiste en enviar una solicitud ARP gratuita al host A. <br><br>  La direcci√≥n IP del host B es la direcci√≥n IP, y nuestra direcci√≥n MAC es la direcci√≥n MAC.  Dicha solicitud le permite modificar la tabla ARP en el host A, forz√°ndolo a enviar solicitudes a nuestro dispositivo cuando intente contactar al host B. El host B suele ser la puerta de enlace predeterminada. <br><br>  Herramientas recomendadas: bettercap, arpspoof <br><br>  <b>2) LLMNR, NBNS spoofing</b> <br>  Link-Local Multicast Name Resolution y NetBIOS Name Service son los protocolos utilizados para resolver nombres de host en la red local.  A diferencia del protocolo DNS, no hay un servidor dedicado que almacene toda la informaci√≥n; en cambio, la solicitud se transmite a todos los hosts en la red, si el nombre de host en la solicitud coincide con el nombre de host del dispositivo, enviar√° una respuesta. <br><br>  Como se se√±al√≥ correctamente en la respuesta, el atacante puede responder a tales solicitudes enviando su direcci√≥n IP en la respuesta, lo que conducir√° al hecho de que en el futuro la v√≠ctima se pondr√° en contacto con el dispositivo del atacante en lugar del dispositivo cuyo nombre de host apareci√≥ en la solicitud.  Adem√°s, un atacante puede solicitar la autenticaci√≥n NTLM de la v√≠ctima, lo que hace que el dispositivo de la v√≠ctima env√≠e un hash NTLM, que puede utilizarse para la fuerza bruta. <br><br>  Herramientas recomendadas: respondedor <br><br>  <b>3) WPAD spoofing</b> <br>  La suplantaci√≥n de identidad de WPAD se puede atribuir a un caso especial de suplantaci√≥n de LLMNR y NBNS.  El protocolo Web Proxy Auto Discovery se usa para configurar autom√°ticamente un servidor proxy HTTP. <br><br>  El dispositivo env√≠a una solicitud LLMNR / NBNS con el nombre de host wpad, recibe la direcci√≥n IP correspondiente e intenta acceder al archivo wpad.dat a trav√©s de HTTP, que almacena informaci√≥n sobre la configuraci√≥n del proxy. <br><br>  Como resultado, un atacante puede realizar falsificaciones de LLMNR / NBNS y proporcionar a la v√≠ctima su archivo wpad.dat, como resultado, todo el tr√°fico HTTP y HTTPS pasar√° por el atacante. <br><br>  Herramientas recomendadas: respondedor, mitm6 <br><br>  <b>4) Anuncio de enrutador</b> <br>  Como puede ver en el volcado, hay dispositivos con IPv6 habilitado en la red.  Mientras est√© en la red, puede intentar enviar mensajes al anuncio de enrutador IPv6 de la v√≠ctima para cambiar la puerta de enlace predeterminada o el servidor DNS. <br><br>  Los mensajes de anuncio de enrutador (RA) son parte del mecanismo SLAAC (configuraci√≥n autom√°tica de direcciones sin estado), que es necesario para obtener autom√°ticamente direcciones IPv6 en una red, sin utilizar un servidor DHCPv6 o en conjunto con √©l.  Esto se logra enviando peri√≥dicamente mensajes RA de multidifusi√≥n al enrutador, que contienen la direcci√≥n de puerta de enlace predeterminada, el prefijo de red, la direcci√≥n del servidor DNS y el prefijo de dominio. <br><br>  Herramientas recomendadas: paquete sin procesar <br><br>  <b>5) suplantaci√≥n de identidad DHCP</b> <br>  Adem√°s, en un volcado, las solicitudes de DHCP Discover del mismo dispositivo se repiten en algunos intervalos.  Puede sacar conclusiones sobre la ausencia de un servidor DHCP en esta red y responder a la pr√≥xima solicitud de Discover especificando a la v√≠ctima como una puerta de enlace predeterminada al dispositivo. <br><br>  Herramientas recomendadas: Yersinia <br><br>  <b>6) falsificaci√≥n de HSRP</b> <br>  Adem√°s, los paquetes HSRP se pueden ver en el volcado.  El protocolo de enrutador Hot Standby puede aumentar la disponibilidad de enrutadores que act√∫an como la puerta de enlace predeterminada.          IP-,     -.   Hello -        ,           .           HSRP, ,      ,      HSRP         . <br><br>  : Yersinia <br><br> <b>7) STP-</b> <br> Spanning Tree Protocol      L2-  .    BPDU-,           ,     .          BPDU-,   ,   ,    ,    ,         ,   ,   ,     STP,    ,    . <br><br>  : Yersinia <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ5. NGINX config</font></strong> </h1><br><br>    - nginx.  ,       ? <br><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pastebin.com/nYp7uVbB</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   nginx,          : <br> 1)  86 ,   http  X-Managed      secured,  nginx     /management/ <br> 2)        API  70  105 . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  J:</b> <div class="spoiler_text"><blockquote>        ,          .   nginx    ,     web-,       nginx    web-  /.           nginx ,  , ,     . <br><br> ,     ,   ,            .      ,         . ,    ,     . <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gixy</a> . <br><br> Gixy  4    : <br><br> <b>1) Alias travesal:</b> <br><br>   80     : <br><br><pre> <code class="plaintext hljs">location /static { alias /prod_static/; }</code> </pre><br>     - ,    .  : //host/static../etc/passwd.   -     alias:     ,   /static,   /prod_static/,       : /prod_static/../etc/passwd,      /etc/passwd.    alias traversal  <a href=""></a> <br><br> <b>2) Http Splitting (CRLF injection)</b> <br>    nginx  ,   ,        .       HTTP-. <br> : <a href="https://github.com/yandex/gixy/blob/master/docs/ru/plugins/">github.com/yandex/gixy/blob/master/docs/ru/plugins/httpsplitting.md</a> <br><br> <b>3)   -   </b> <br>   75      ¬´rigin¬ª   .    , -       , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">production.host.evil.com</a> . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/origins.md</a> <br><br> <b>4)     add_header</b> <br>  nginx  :      add_header,       , ,    ,  .      CSP      . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/addheaderredefinition.md</a> <br><hr><br>  ,   gixy,          .       : <br><br> 1)   17     <b>default_type   text/html.</b>     :   ,     ,  nginx    Content-Type,    default_type.   ,         Content-Type: text/html.            HTML-  ,   , , XSS-   . <br><br> <b>2)    POST-</b> <br>  29-30   ,           .  ,   ‚Äú‚Äù POST-.       .  Pero!       SSRF  ,     ,   ,     , . <br><br> <b>3)   php-fpm</b> <br>   48  ,  FastCGI-    unix ,    9000.  ,    ,   .   ,      PHP-. <br><br> <b>4) ‚Äú‚Äù CSP</b> <br>  production.host  Content-Security-Policy,    Javascript,    . <br><br> <b>5) ‚Äú‚Äù CORS</b> <br>   76-77   CORS,          ,       cookie  . <br><br> 6)     ,   86   <b>  </b>  .       secured     /managed. <br><br> 7)      ,    ,        ,    -. ,   ,  ,    /user/{userid}  IDOR. <br><br>   ,       ,    ,     . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ6. Linux Permissions</font></strong> </h1><br>     Linux      ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">  ~ ()  Debian <br> C              ( ,      /etc/passwd). <br> ,      ftp  ,     ~. <br><br>  Un ejemplo: <br> * root@server:~# ls ~ftp <br> * welcome.msg <br>      : <br> * root@server:~# cat ~ftp/welcome.msg <br> * Welcome, archive user %U@%R! <br>   ,    :      : <br> * root@amorale:~# echo ~ftp <br> * /srv/ftp <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>    ,        : <br><br><ul><li>       </li><li>  ACL      </li><li>    </li><li>      </li><li>  capabilities </li></ul><br>   ,      ,   : <br> ‚Äú ,   root‚Äù   . <br><br>      ,     <code>Linux/Unix</code> . <br>    ,        ‚Äú ‚Äù ‚Äî           . <br>   ,     ,    <code>funky_test.txt</code>      <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br> ,    Linux/Unix   : <br><br><ul><li>  - ‚Äî    ‚Äúrwx‚Äù  alice </li><li>   ‚Äî    ‚Äúrw‚Äù   interns </li><li>    ‚Äî    ‚Äúrx‚Äù  others </li></ul><br>          <code>read, write, execute</code> . <br><br> ,     ‚Äî       ,      : <br><br><ul><li>    ,      read </li><li>    ,      read </li><li>     read </li></ul><br>  ,       <code>read</code>            .      ,      execute  . <br><br>            ,    . <br><br>          , ,    .      : <br><br> 1.          ,       ls. <br><br> 2.      ‚Äî <code>POSIX Access Control Lists</code> . <br><br><h4>    c   . </h4><br><h6>  1 </h6><br> ,   <code>alice</code>     <code>interns</code> .      <code>funny_test.txt</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami alice $ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied $</code> </pre><br><h5>  2 </h5><br>   ‚Äî   <code>funky_test.txt</code>  604.    <code>bob</code> ,    <code>interns</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami bob $ id uid=1002(bob) gid=1003(bob) groups=1003(bob),1002(interns) $ ls -la funky_test.txt -rw----r-- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied</code> </pre><br><h5>  </h5><br>    <code>alice</code>       ,  .  , <code>permission_denied</code>    : <br><br><pre> <code class="plaintext hljs">$ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ chmod 777 funky_test.txt $ ls -la funky_test.txt -rwxrwxrwx 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt secret_pass</code> </pre><br>      bob    . <br><br><h5>   </h5><br>    ,          ¬´  ¬ª,  : <br><br><ul><li>  ID      <code>effective UID</code> ‚Äî      </li><li>  GID        <code>effective GID</code> ‚Äî      </li><li>      others. </li></ul><br><h5>   </h5><br>  ,      ‚Äî   ,       ‚Äú‚Äù    ,        ,    , : <br><br><ul><li>    ,   ,          <code>others</code>     </li><li>   ,     ,   <code>others</code>     </li></ul><br>           . <br><br><h4> POSIX Access Control Lists </h4><br>      ‚Äî         /.   ,     ACL,  ,       ‚Äú <code>+</code> ‚Äù <br><br>      POSIX ACLs,    ‚Äî     ,            .      ACL,        . <br><br><h5>  Ejemplo </h5><br>   .        <code>alice</code>   <code>funky_test.txt</code>  ,   <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br>      ACL.  <code>getfacl</code> , ,    ACL,   ,     <code>ls</code> . <br><br><pre> <code class="plaintext hljs">$ getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx group::rw- other::rx</code> </pre><br>   , ACL        .  ,     bob  : <br><br><pre> <code class="plaintext hljs">setfacl -mu:bob:rwx funky_test.txt</code> </pre><br>       ‚Äú <code>+</code> ‚Äù   <br><br><pre> <code class="plaintext hljs">ls -l funky_test.txt -rwxrwxr-x+ 1 alice interns 12  4 13:00 funky_test.txt</code> </pre><br>     : <br><br><pre> <code class="plaintext hljs">getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx user:bob:rwx group::rw- mask::rwx other::rx</code> </pre><br>  ACL     .  : <br><br><ol><li>     .      <code>effective UID</code>  <code>effective GID</code>  ‚Äî  .        ,       ACL,       .  ,     ,   ,  ,         ,    . </li><li>   ACL  <code>mask</code> ,      ACL    <code>owner, group, others</code> </li></ol><br><h5>   </h5><br>  ,         ,  ,     ‚Äî      . <br><br>   ,  ACL,     , : <br><br><ul><li>        ACL,     ; </li><li>   ,         ACL,     . </li></ul><br></blockquote></div></div><br><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ7. Network Dump II</font></strong> </h1><br>            .  ,        ,   ,       . <br><br>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">yadi.sk/d/e3gNme4MBo6tFQ</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   ‚Äî      . <br>      ,     . <br>   ,     . <br><br><img src="https://habrastorage.org/webt/2t/zn/ip/2tznipywtpqwalr5drvxxr4z0sw.png"><br><br>   ,     SMB-,  ,    ,       .       SMB object list (File -&gt; Export objects -&gt; SMB‚Ä¶ ). <br><br>    ‚Äî     . <br><br><img src="https://habrastorage.org/webt/fe/rt/xy/fertxyt0du3kv3qwcmivz1m6opg.png"><br> <i>(  SMB object list)</i> <br><br><img src="https://habrastorage.org/webt/xo/yd/t-/xoydt-qmcbddrx1lkoqmpplyslg.png"><br> <i>(NotTruePass.jpg)</i> <br><br>     . <br><br>        ‚Äú‚Äù    TCP-‚Ä¶     .    .  :( <br><br>    ,        .    . <br><br><img src="https://habrastorage.org/webt/fd/ch/fc/fdchfcsbkrwxmx08ltr_1qnoozg.png"><br> <i>(  desktop.ini)</i> <br><br>     ‚Äú‚Äù     . ,      NTLM,   ,  ,  NTLM      ‚ÄúPass-the-hash‚Äù.               ¬´-¬ª. <br><br>     ‚Äú‚Äù    : <br><br><pre> <code class="plaintext hljs">1)User - 1 Account: IEUser Domain: WIN7 Host: WIN7 hex dump session key - 49 0c 38 3e f8 eb 63 88 79 0f 62 84 09 84 d2 dc 2) User - 2 Account: winwin Domain: WIN7 Host: WIN7 hex dump session key - 8d f6 1b 35 79 a3 78 d3 2e 81 09 f1 95 4f 71 0a 3) User - 3 Account: 192.192.192.29 Domain: WIN7 Host: WIN7 hex dump session key - c3 19 e0 21 1b e2 63 c6 03 9e e7 38 1b 56 f0 d1</code> </pre><br>            .       MSEDGEWIN10. <br><br>    ‚Äî     : <br><br> 1) SMB Relay. <br>           . <br>      ,   MITM- <br> (.             ). <br><br>      ‚Äî        ,      ,  . <br>      .       ,       . <br><br>    ,  ,  ,     . <br><br> 2) NTLM Relay. <br>         ,  NTLM-. <br><br>         ,   NTLM-. <br><br>          . <br>     ,     ,  ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>   ,  ,    : <br><br><ol><li>    (    ) </li><li>        ‚Äî / </li><li>      ,       </li></ol><br>       ,        : <br><br><ol><li>     </li><li>     </li><li>     </li></ol><br>     Wireshark,    <code>Protocol Hierarchy Statistics</code>  <code>Conversations</code> . <br><br> <code>Protocol Hierarchy Statistics</code> ‚Äî           . <br><br><img src="https://habrastorage.org/webt/_3/sy/co/_3sycoln1juvmnzbdlzrug24fgq.png"><br><br> Conversations ‚Äî   ,         . <br><br><img src="https://habrastorage.org/webt/31/xp/r7/31xpr7rmhyghnrctn3acyznwa9w.png"><br><br><img src="https://habrastorage.org/webt/rw/21/_d/rw21_dwv4digkin6kodypnfpl2w.png"><br><br>       : <br><br><ol><li>    (60%) ‚Äî  TCP, ,  , SMB.   Protocol hierarchy  SMB  40%,        TCP,     ,     20%      SMB. </li><li>      192.192.192.128  192.192.192.129.   SMB      . </li></ol><br> <b>  </b> <br><br>    . <br><br>        ‚Äî     SMB. <br><br>        ,    ‚Äî     wireshark ‚Äî  <code>ExportObject</code> . <br>              <code>tcp stream</code> .     ,     ,    <code>tcp stream</code> ,            .           ,      . <br><br>    , ,     ,     ,     .  ,         . <br><br> <b>  .</b> <br>     SMB       . <br><br>    NTLM-     ‚Äúntlmssp‚Äù.    <code>info</code> ,  3    : <br><br><img src="https://habrastorage.org/webt/mm/gn/pj/mmgnpjekpvddsd1f6vdx5ih8hec.png"><br><br> ,        . <br><br><img src="https://habrastorage.org/webt/rk/ix/7m/rkix7mvmxaaxs09m0vvazlblvco.png"><br><br><img src="https://habrastorage.org/webt/tx/zc/hc/txzchc1u7ufdzoqkjxtnrnsvfd0.png"><br><br><img src="https://habrastorage.org/webt/pd/hg/vd/pdhgvdcc_obs9smchhmwidqmawy.png"><br><br>          Net-NTLMv2-,  : <br><br><ul><li> challenge  </li><li> response  </li><li>   </li></ul><br>  <code>Net-NTLMv2</code>       <code>hashcat</code> . <br><br> ,        <code>WIN7\winwin</code>  <code>WIN7\192.192.192.129</code> ‚Äî      ,          .    <code>WIN7\IEUser</code> ‚Äî ,       ,  ,  ,   ,  SMB. <br><br>  <code>Net-NTLM</code>   ,   ,    Wireshark.    ,  PCredz (https://github.com/lgandx/PCredz) <br><br><img src="https://habrastorage.org/webt/jd/gn/zj/jdgnzjzb6pgscawu43bxtf5wc0y.png"><br><br>     <code>IEUser</code> (   )     hashcat. <br><br><img src="https://habrastorage.org/webt/ky/i6/gf/kyi6gfki84pqjj4fgjximusk9qa.png"><br><br> <b>     ,      .</b> <br><br>        6,   ,   <code>SMB/NTLM</code> , <code>DNS</code> . <br><br> ,      ,    <code>NT</code>  <code>LM</code>  <code>NTLMv1 (Net-NTLMv1)</code> , <code>NTLMv2 (Net-NTLMv2)</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     </a> ). <br><br> -    <code>NT</code>  <code>LM</code>  <code>NTLM</code> ,         <code>NTLM</code>  <code>NTLMv1</code>  <code>NTLMv2</code> . ,           .    . <br><br>     ,  <code>NTLMv1/NTLMv2</code> ‚Äî    challenge-response .        ,    . <br><br>  NT  LM ‚Äî   ‚Äú  ‚Äù ‚Äî        . <br><br>      : <br><br><ul><li> PassTheHash ‚Äî ,        ,     .  Pero     ,  <code>NT</code> .  PassTheHash  NTLMv2  ‚Äî   .        ,      ‚Äú‚Äù  ,       ,    . </li><li> NTLM Relay ‚Äî ,        ,     NTLM.      ,    . </li><li> Spoofing,     Windows: LLMNR, NetBios </li><li>     : MS17-010,    /  ,   . </li></ul><br> <b></b> <br><br>     : <br><br><ul><li>    ( ) </li><li>       </li><li>       ,           </li><li>            eternalBlue </li><li>  NTLM relay </li><li>   NTLM relay    ‚Äî   SMB </li><li>       </li><li>   ,     (ARP-spoofing,  DNS   )  </li></ul><br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ8. SSH Pivoting Tricks</font></strong> </h1><br><img src="https://habrastorage.org/webt/ui/gy/a1/uigya1oqcd1poeuc6whph79ehzw.png"><br>      (10.0.10.0/24),      SSH  Linux- (10.0.20.5)    (10.0.20.0/24).   ,         .     ,         ,     //  Linux-. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ,    ,   : <br>    <br> nmap      <br><br>    ? <br><br> : <br><br> 1)  ping. <br>  -&gt; ping -b 10.0.20.255 <br>  ping  ,     ,    . <br>    ,               . <br>           . <br> ,     CentOS 7. <br>        . <br><br><img src="https://habrastorage.org/webt/7y/vu/rn/7yvurntbjwgei1q8rr6yth0kjww.png"><br> <i>(  )</i> <br><br>    ,           .  :( <br><br><img src="https://habrastorage.org/webt/nd/r1/jc/ndr1jchof8-_rzbgh-ru1xg7vh0.png"><br><br> 2)   ARP-  . <br>  -&gt; <br>  Debian ‚Äî arp-scan --interface=/* */ 10.0.0.0/16 <br>  Linux      arp,    ( Debian) -   ,      arp-scan. <br> arp-scan,   ,      ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  KryaKrya:</b> <div class="spoiler_text"><blockquote>       ,           ,  ,      Pivoting.      ,      ,   ,          ,      ,          . <br><br> ,       ping    ,  ARP- (arp -a),    (route).   ,     netcat (nc -h),  ,      (nc -vnz 10.0.20.3 0-1000).    ,      ,        , , ,   ,   -     bash,   python      . <br><br>     ‚Äî    SSH-,   SOCKS-  SSH,          . <br> ssh -D 1337 user@10.0.20.5 -f -N <br><br>            .     nmap  SOCKS-   proxychains    . <br><br> proxychains nmap 10.0.20.0/24 <br> nmap 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br>     nmap       - SOCKS-.     SYN- ( nmap    )  SOCKS-,  SOCKS-    TCP-   ,  SYN-      ,    SYN,    SYN ACK.      CONNECT- (-sT),  nmap      SOCKS-. <br><br> nmap -sT 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br> ,    -  ,         ,        . ,       Linux-,   nmap  -sT  ,     ,     ,      ,    ,    ,        . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ9. Android SSL pinning bypass</font></strong> </h1><br>      Android.  ,        HTTPS. <br><br> 1) ,           HTTP . <br><br> 2)  ,      SSL-pinning,        ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ¬´,           HTTP-.¬ª <br><br>        . <br>        proxy host   wifi. <br><br>  Android     ,  ,      . <br><br>  ‚Äî    (  )   ‚Äî   ( ,  ). <br>  ,      MITM,   Android 6.0,      ,     . <br><br>       6.0,         . <br><br> ¬´ ,      SSL-pinning,        ?¬ª <br><br>  ,    SSL-pinning. <br><br> SSL-pinning ‚Äî   ,    ,   ¬´¬ª      . <br><br>        HTTPS-,   ,  ¬´¬ª.      ,       . <br><br>   ,      MITM-,    . <br><br>   ,      ,     ,       . <br><br>   ‚Äî  Frida. <br> Frida ‚Äî    Dinamic Instrumentation Toolkit,    ,         . <br> , Frida        Javascript. <br>       Frida     ,    , ,  ¬´True¬ª  ¬´False¬ª,     . <br><br>     Frida: <br><br> 1.      ,      .      -. <br><br> 2.      Frida.        Root. <br><br>      . <br>  APK-           .  ,       ,      . <br>      .     apk  META-INF    . <br><br> ‚Äú‚Äù APK-. <br>       APK   smali   Java,     ,     . <br>     ,    ,     . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  I:</b> <div class="spoiler_text"><blockquote> ,     MITM HTTPS       . <br><br>      ,       Proxy   WiFi.      ProxyDroid,    iptables  . <br><br> ,      Root ,         , ? <br><br>    SSL-Pinning,    , ,  ‚ÄúFrida+Objection‚Äù. ,           :) <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ10.    ?</font></strong> </h1><br>          ,       . <br><br>    ‚Äú ‚Äù. ,      ,  dns-rebinding. <br><br>     .  Gracias por su atencion! <br><br><hr><br> <b>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Digital Security</a></b> <br><br>    ,       . <br>       3  (  -      ).      0  5        2.5,   3.1337. <br><br>      .  ,     50 .        ,          ‚Äú <i>   </i> ‚Äù   -   ) <br><br>         .      29 ,     43.5.         24%    . <br><br>    : <br><br><img src="https://habrastorage.org/webt/fn/iq/fb/fniqfb7brnsnuqx08am8vx7xmtq.png"><br><br> ,         ,       ,    ,     ,              .    ,       ,     .         . <br><br>  ,     , ,  ,                  . <br><br> ,  ,          : <br><br><img src="https://habrastorage.org/webt/wn/z_/p9/wnz_p90qafczlytjrpuddurwkbc.jpeg"><br><br>          (  !),    ,          ,   ,         ‚Äú ‚Äù. <br><br>             -     ,        ,        . ,        ,   Summer of Hack 2019. <br><br>     ,                 .                    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461077/">https://habr.com/ru/post/461077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461067/index.html">Las 65 preguntas principales de SQL de las entrevistas de trabajo para las que deber√≠a estar preparado en 2019. Parte 1</a></li>
<li><a href="../461069/index.html">C√°maras IP Nobelic para exteriores: pruebas, tecnolog√≠as y capacidades de los sistemas de videovigilancia Ivideon</a></li>
<li><a href="../461071/index.html">Optimizaci√≥n de consultas de bases de datos en el ejemplo de servicio B2B para constructores</a></li>
<li><a href="../461073/index.html">Conectamos mapas en l√≠nea al navegador en el tel√©fono inteligente. Parte 3 - OverpassTurbo</a></li>
<li><a href="../461075/index.html">Inteligencia empresarial. Objetos inform√°ticos, componentes, herramientas.</a></li>
<li><a href="../461079/index.html">Ciudad sin atascos</a></li>
<li><a href="../461081/index.html">El d√≠a que Dodo se detuvo. Script asincr√≥nico</a></li>
<li><a href="../461083/index.html">Escritura de software con la funcionalidad de las utilidades cliente-servidor de Windows, parte 02</a></li>
<li><a href="../461085/index.html">Cambiar idioma en la aplicaci√≥n de Android</a></li>
<li><a href="../461087/index.html">Generando mazmorras y cuevas para mi juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>