<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéõÔ∏è ü§† ü§≥üèª Guide de notification des abonnements Apple pour iOS. Sont-ils vraiment bons? üë©‚Äçüî¨ üôèüèΩ üë¶üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous avez donc une application avec des abonnements renouvelables automatiquement. Cela fonctionne tr√®s bien, les utilisateurs √©mettent de fa√ßon incon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de notification des abonnements Apple pour iOS. Sont-ils vraiment bons?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/453770/"><p><img src="https://habrastorage.org/getpro/habr/post_images/fa5/f52/a07/fa5f52a07612fe9b040dad35421024ec.jpg"></p><br><p>  Vous avez donc une application avec des abonnements renouvelables automatiquement.  Cela fonctionne tr√®s bien, les utilisateurs √©mettent de fa√ßon incontr√¥lable des abonnements premium et r√©digent des critiques √©logieuses.  La beaut√©! </p><br><p>  Bonjour √† tous, je m'appelle Denis, je suis chef de projet pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apphud</a> , un service d'analyse des abonnements auto-renouvelables pour les applications iOS. </p><br><p>  En tant que chef de projet, il est essentiel que vous vous teniez au courant des principales mesures de produit.  L'un des plus importants est la valeur √† vie (LTV) - le revenu moyen de chaque utilisateur pendant toute la dur√©e d'utilisation de l'application.  Mais comment le calculer dans le cas des abonnements auto-renouvelables sur iOS?  Comment suivre l'heure de renouvellement, d'annulation, de renouvellement d'un abonnement par un utilisateur? <a name="habracut"></a></p><br><p>  Jusqu'√† r√©cemment (c'est-√†-dire jusqu'en 2017), la seule fa√ßon de proc√©der √©tait le soi-disant sondage sur le statut des abonnements.  √Ä tout moment, vous pouvez obtenir des informations sur l'√©tat de l'abonnement en envoyant le re√ßu n√©cessaire √† l'URL: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://buy.itunes.apple.com/verifyReceipt</a> .  Une fois que vous l'avez re√ßu, vous pouvez afficher des informations de base sur l'abonnement, y compris la date de fin.  Certes, vous n'en aurez toujours pas le co√ªt. </p><br><p>  Pour impl√©menter le sondage d'√©tat, vous devez: </p><br><ol><li>  transf√©rer et stocker sur le serveur toutes les v√©rifications de tous les abonnements de chaque utilisateur, </li><li>  impl√©menter une logique de serveur complexe, qui v√©rifiera <strong>r√©guli√®rement</strong> ces v√©rifications. </li></ol><br><p>  C'est compliqu√©.  Mais en 2017, Apple semble r√©soudre ce probl√®me.  √Ä la WWDC, avec une ovation debout, ils pr√©sentent des notifications de mise √† jour du statut des abonnements Apple. </p><br><h2 id="chto-takoe-subscriptions-notifications">  Que sont les notifications d'abonnement? </h2><br><p>  Les notifications de mise √† jour de l'√©tat des abonnements Apple sont un m√©canisme permettant d'envoyer des webhooks √† votre serveur Apple lorsque des √©v√©nements d'abonnement auto-renouvelables se produisent.  Pour les activer, vous devez d'abord configurer votre serveur pour les accepter: le serveur doit prendre en charge le protocole App Transport Security (g√©n√©ralement tout fonctionne par d√©faut).  Apr√®s cela, vous devez vous rendre sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">App Store Connect</a> et dans la section ¬´App Store¬ª des param√®tres de votre application ins√©rer un lien o√π Apple enverra une demande POST chaque fois qu'un √©v√©nement se produit: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/011/e97/844/011e97844357cc016a2a8258bacfd354.png" alt="Configurer les notifications de mise √† jour de l'√©tat des abonnements Apple"></p><br><blockquote>  Notez qu'Apple recommande d'utiliser les notifications d'abonnement conjointement avec l'interrogation de l'√©tat.  Mauvais signe ... </blockquote><p>  C'est fait!  Vous devez maintenant √™tre averti chaque fois qu'un abonnement est √©mis, renouvel√© ou annul√©, par exemple. </p><br><h2 id="raznovidnosti-uvedomleniy">  Vari√©t√©s de notifications </h2><br><p>  Apple envoie 6 types de notifications qui se produisent lors de divers √©v√©nements.  Nous analyserons chacun d'eux. </p><br><h3 id="initial_buy">  INITIAL_BUY </h3><br><p>  Apple envoie cette notification lorsqu'un utilisateur s'inscrit pour la premi√®re fois √† un <strong>groupe d'</strong> abonnement. </p><br><blockquote>  Vous pouvez en savoir plus sur les groupes d'abonnement dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> . </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/bce/b16/6de/bceb166ded34b6e3efe67b0fbd22ae01.png" alt="√âv√©nement INITIAL_BUY"></p><br><h3 id="cancel">  ANNULER </h3><br><p>  Cet √©v√©nement est envoy√© lorsque l'utilisateur annule l'abonnement via l'assistance Apple Care et rembourse l'achat.  Nous soulignons qu'il <strong>ne</strong> s'agit <strong>pas</strong> de l'annulation habituelle de l'abonnement via les param√®tres iOS. </p><br><blockquote> <code>CANCEL</code> √©v√©nement <code>CANCEL</code> n'est pas distribu√© lors d'une annulation normale via les param√®tres iOS. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/52c/692/9ce/52c6929ced9ea6d4d887581722f5612a.png" alt="√âv√©nement CANCEL"></p><br><h3 id="did_change_renewal_status">  DID_CHANGE_RENEWAL_STATUS </h3><br><p>  Cet √©v√©nement a √©t√© ajout√© r√©cemment.  Il est envoy√© lorsque l'utilisateur se d√©connecte ou (encore) active le renouvellement de l'abonnement via les param√®tres iOS, l'application App Store ou le support Apple: </p><br><blockquote>  Ne confondez pas cet √©v√©nement avec l'√©v√©nement <code>CANCEL</code> qui se d√©clenche lorsque vous annulez votre abonnement et remboursez via l'assistance Apple Care. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/987/be2/829/987be28296f3367163ff3af07a4fb29a.png" alt="√âv√©nement DID_CHANGE_RENEWAL_STATUS"></p><br><h3 id="renewal">  RENOUVELLEMENT </h3><br><p>  La premi√®re chose qui vous vient √† l'esprit lorsque vous voyez le nom de cet √©v√©nement: Apple l'envoie lorsque le renouvellement est automatiquement renouvel√©.  Peu importe comment! </p><br><p>  L'√©v√©nement <code>RENEWAL</code> envoy√© lorsque: </p><br><ol><li><p>  l'abonnement de l'utilisateur a √©t√© annul√© automatiquement en <strong>raison de probl√®mes avec la carte bancaire de l'utilisateur ...</strong> </p><br></li><li><p>  et apr√®s cela, l'utilisateur a renouvel√© √† nouveau l'abonnement.  C'est √† ce stade que l'√©v√©nement <code>RENEWAL</code> est <code>RENEWAL</code> . </p><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e56/ed6/4e9/e56ed64e9a4f804a69c32b15df6e614f.jpg"></p><br><blockquote>  Un <code>RENEWAL</code> RENOUVELLEMENT <code>RENEWAL</code> <strong>pas envoy√©</strong> en cas de renouvellement r√©gulier d'un abonnement.  Au lieu de cela, Apple sugg√®re de v√©rifier la v√©rification de l'abonnement via <code>/VerifyReceipt</code> avant et apr√®s le renouvellement pr√©vu, et d'analyser la date d' <code>expiration_date</code> r√©sultante </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/2d9/e2d/544/2d9e2d5440a690903f0182b5c08cc9a4.png" alt="√âv√©nement RENOUVELLEMENT"></p><br><h3 id="interactive_renewal">  INTERACTIVE_RENEWAL </h3><br><p>  Cet √©v√©nement est envoy√© si: </p><br><ol><li><p>  L'utilisateur a annul√© l'abonnement et <strong>quelque temps apr√®s cela ...</strong> </p><br></li><li><p>  abonnement renouvel√© par l'utilisateur.  C'est √† ce moment que <code>INTERACTIVE_RENEWAL</code> envoy√©. </p><br><blockquote>  Le nouvel abonnement (qui est indiqu√© dans la clause 2) peut diff√©rer de la souscription de la clause 1, mais les deux doivent appartenir au m√™me groupe d'achat.  Par exemple, un utilisateur peut se d√©sinscrire du plan tarifaire Bronze et apr√®s un certain temps renouveler son abonnement en choisissant le plan Gold.  Dans ce cas, Apple enverra l'√©v√©nement <code>INTERACTIVE_RENEWAL</code> √† votre serveur (√† condition que les abonnements Bronze et Gold appartiennent au m√™me groupe d'achats).  Vous pouvez en savoir plus sur les groupes d'abonnement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </blockquote><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b0/d77/fe3/7b0d77fe3921cf4bf9c4d9b4a04bec03.png" alt="√âv√©nement INTERACTIVE_RENEWAL"></p><br><h3 id="did_change_renewal_pref">  DID_CHANGE_RENEWAL_PREF </h3><br><p>  <code>DID_CHANGE_RENEWAL_PREF</code> envoy√© lorsqu'un utilisateur passe d'un abonnement √† un autre au sein du m√™me groupe d'achats: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab1/8d5/359/ab18d53594ec3b04615f38598aa0c787.png" alt="√âv√©nement DID_CHANGE_RENEWAL_PREF"></p><br><h3 id="chto-v-itoge">  Quel est le r√©sultat? </h3><br><p>  Apple propose jusqu'√† 6 √©v√©nements, mais aucun d'entre eux n'est envoy√© lors du renouvellement automatique d'un abonnement en mode normal.  Pourquoi ont-ils fait √ßa?  Pas clair.  De plus, les noms de ces √©v√©nements sont trompeurs. </p><br><p>  Le tableau ci-dessous r√©sume les √©v√©nements. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ba/c0f/fc1/3bac0ffc178eaad092d199d6dd0e8d19.png"></p><br><h2 id="kak-ispolzovat-apple-subscriptions-notifications">  Comment utiliser les notifications d'abonnement Apple? </h2><br><p>  √âtant donn√© que l'√©v√©nement le plus important dont vous avez besoin pour calculer LTV - le renouvellement de l'abonnement en mode normal - n'est pas envoy√©, vous devez toujours utiliser le sondage d'√©tat.  Il est possible qu'Apple ajoute cet √©v√©nement dans un proche avenir, mais m√™me si cela se produit, vous ne pouvez toujours pas vous passer de votre propre serveur.  Ce serveur agira comme une ¬´couche¬ª entre Apple et un autre syst√®me d'analyse (par exemple, Amplitude, Flurry ou Mixpanel).  En recevant des √©v√©nements et en v√©rifiant les ch√®ques, vous lui enverrez des informations sur les renouvellements, les annulations et les remboursements. </p><br><blockquote><h1 id="odnazhdy-my-stolknulis-s-etoy-problemoy-i-reshili-razrabotat-servis-kotoryy-by-reshil-eti-problemy-tak-rodilas-ideya-servisa-nad-kotorym-my-seychas-rabotaem--servisa-analitiki-podpisok-dlya-ios-kotoryy-zapolnyaet-bresh-v-otpravke-sobytiy-so-storony-apple">  Une fois que nous avons rencontr√© ce probl√®me et d√©cid√© de d√©velopper un service qui r√©soudrait ces probl√®mes.  L'id√©e est donc n√©e du service sur lequel nous travaillons actuellement - le service d'analyse d'abonnement pour iOS, qui comble le vide dans l'envoi d'√©v√©nements d'Apple. </h1><br></blockquote><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Les notifications d'abonnement Apple ne sont pas aussi bonnes qu'elles le semblent, car ce n'est qu'avec elles que vous ne pouvez pas r√©soudre le probl√®me principal: savoir combien d'argent un utilisateur vous apporte.  Apple pourrait faciliter la vie des d√©veloppeurs √† l'avenir, mais une chose est s√ªre: la mise en ≈ìuvre actuelle des notifications d'abonnement est extr√™mement peu √©vidente et ressemble √† des b√©quilles. </p><br><blockquote>  Vous souhaitez mettre en ≈ìuvre des abonnements dans votre application iOS en 10 minutes?  Int√©grez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apphud</a> et: <br><ul><li>  Faites des achats en utilisant une seule m√©thode; </li><li>  suivre automatiquement l'√©tat de l'abonnement de chaque utilisateur; </li><li>  Int√©grez facilement les offres d'abonnement </li><li>  envoyer des √©v√©nements d'abonnement √† Amplitude, Mixpanel, Slack et Telegram en tenant compte de la devise locale de l'utilisateur; </li><li>  diminuer le taux de d√©sabonnement dans les applications et renvoyer les utilisateurs non abonn√©s. </li></ul><br></blockquote><br><h2 id="chto-pochitat">  Que lire? </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7 choses √† savoir sur les abonnements auto-renouvelables</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide des offres d'introduction sur iOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide des notifications de mise √† jour du statut Apple</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453770/">https://habr.com/ru/post/fr453770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453756/index.html">Probl√®mes de la m√©thodologie actuelle pour d√©terminer les menaces actuelles du FSTEC</a></li>
<li><a href="../fr453760/index.html">Camp d'entra√Ænement en circuit pour r√©servoirs et processeurs</a></li>
<li><a href="../fr453764/index.html">Amn√©sie volontaire: manipulations hippocampiques pour √©liminer les souvenirs douloureux</a></li>
<li><a href="../fr453766/index.html">Radio d√©finie par logiciel - comment √ßa marche? Partie 6</a></li>
<li><a href="../fr453768/index.html">Pr√©sentation des services SMS: services populaires</a></li>
<li><a href="../fr453772/index.html">Project Athena - R√©inventer l'ordinateur portable</a></li>
<li><a href="../fr453776/index.html">Nous pompons des designers dans l'entreprise: du junior au directeur artistique</a></li>
<li><a href="../fr453778/index.html">Comment nous avons cr√©√© une banque en ligne pour les entreprises. Premi√®re partie: changement de marque</a></li>
<li><a href="../fr453780/index.html">Comment choisir un t√©l√©phone Grandstream SIP - en g√©n√©ral et en particulier?</a></li>
<li><a href="../fr453782/index.html">Infinite UIScrollView</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>