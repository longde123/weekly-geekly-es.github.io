<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœŒğŸ» ğŸ§—ğŸ» ğŸ§–ğŸ¿ Bagaimana cara berteman dengan PHPstorm, xDebug dan cabang jarak jauh yang dikompilasi melalui Docker? Terlalu sederhana ... ğŸ© ğŸ†” â¬‡ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, Habr! 

 Setahun yang lalu, proses saya kode debugging di PHP terdiri dari dua baris: 



var_dump($variable); die();  
 Dari waktu ke ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara berteman dengan PHPstorm, xDebug dan cabang jarak jauh yang dikompilasi melalui Docker? Terlalu sederhana ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423337/">  Selamat siang, Habr! <br><br>  Setahun yang lalu, proses saya kode debugging di PHP terdiri dari dua baris: <br><br><pre><code class="php hljs">var_dump($variable); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>();</code> </pre> <br>  Dari waktu ke waktu, tentu saja, saya harus menggunakan konstruksi yang lebih "kompleks": <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data);</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($variable, JSON_UNESCAPED_UNICODE); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br>  Tidak, apa yang kamu!  Saya tahu - di zaman kita, tidak tepat bagi seorang programmer budaya untuk melakukan ini <br><br><div class="spoiler">  <b class="spoiler_title">kerajinan kuno</b> <div class="spoiler_text">  lelucon tentang kerajinan kuno lainnya <br></div></div><br>  Tapi jujur, saya selalu takut pada apa yang tidak saya mengerti.  Termasuk <s>printer</s> xDebug, terutama cara mengkonfigurasi semua ini.  Suatu hari, saya berhasil melakukannya di mobil saya dan di proyek lokal - tidak ada batas untuk sukacita.  Beberapa bulan kemudian, saya menemukan masalah baru, bagaimana cara debug di PHPstorm via xDebug, jika proyek ini dibangun dari jarak jauh oleh buruh pelabuhan via CI. <br><br>  Jika Anda, seperti saya, mengalami kesulitan mengkonfigurasi berbagai hal, selamat datang di kucing, saya akan berbicara tentang pengalaman saya dalam menyiapkan lingkungan debugging dengan kata-kata menakutkan seperti Docker, xDebug, CI. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagi mereka yang tidak suka air dan ingin langsung ke esensi pengaturan.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br><h3>  Mengapa Anda harus menghindari metode debug yang berjamur dan beralih ke teknologi yang memadai? </h3><br>  Saya menipu kucing itu sedikit, saya terlibat dalam debugging artisanal, bukan hanya karena saya takut mengkonfigurasi sesuatu, dan bukan karena itu terlalu bodoh, tetapi hanya karena saya tidak memerlukan sesuatu yang lebih nyaman.  Paling sering, saya mengerjakan proyek secara lokal di komputer saya yang agak kuat, dan tugas-tugasnya tidak begitu rumit sehingga proses debugging mulai menempati posisi yang cukup signifikan. <br><br>  Pada titik tertentu, saya menyadari sendiri bahwa saya merasa tidak nyaman, dan mencoba mencari teman xDebug dan PHPstorm ketika mengerjakan proyek lokal.  Masalahnya adalah bahwa sebagian besar dokumentasi dan panduan yang saya temukan menyiratkan bahwa orang yang membacanya cukup berpengalaman di bidang subjek dan memahami segalanya, dalam kasus saya ini bukan kasusnya dan saya menghabiskan 4-5 pada pengaturan xDebug pertama saya jam 2 siang.  Itu adalah moral yang sangat sulit, saya merasa sangat bodoh.  Namun demikian, ternyata untuk mengkonfigurasi, semuanya berfungsi! <br><br>  Ya, itu menjadi lebih nyaman, secara lokal, di rumah, tetapi pada pekerjaan utama saya melakukan situs dari jarak jauh, dan paling sering saya tidak dapat membongkar situs secara lokal (karena mesin yang lemah atau proses penyebaran yang tidak nyaman), atau memengaruhi pengaturan server karena hosting, oleh karena itu, membuat pengeditan "langsung" dan debugging terlibat dalam html-commenting print_r (pada saat itu pekerjaan itu "normal", meskipun tidak bangga dengan pengalaman ini). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cd1/3af/ffdcd13af6a976ca99ff2f26976458e9.jpg" alt="gambar"><br><br>  Namun, 3 bulan lalu saya pindah ke perusahaan yang lebih dingin dan mulai terlibat dalam proyek yang sangat serius dengan beban yang tinggi.  Dan di sini banyak yang berubah untuk saya.  Infrastruktur dan proses pengembangannya kira-kira sebagai berikut: ada server GitLab, setiap proyek memiliki repositori sendiri, tugas datang ke Jira, Anda membuat cabang dengan nomor tugas, saat membuat cabang menggunakan CI, kotak pasir Anda sendiri dengan situs tempat Anda bekerja dengan tenang secara otomatis dibuat, setiap dorongan pasang kembali cabang, di akhir pekerjaan yang Anda berikan ke ulasan kode, tuangkan cabang ke master. <br><br>  Semuanya keren kecuali untuk satu TETAPI, masing-masing membangun kembali cabang dalam kasus saya membutuhkan waktu sekitar 10 detik.  Dalam proses pengembangan itu sendiri, ini adalah waktu yang tidak signifikan, karena saya telah melewati tahap ketika saya harus memeriksa operabilitas kode hampir setiap baris karena ketidakpastian dan sedikit pengalaman.  Namun, ketika saya beralih ke debugging, 10 detik ini mulai memainkan peran nyata.  Proses debugging tersebut terlihat sebagai berikut: <br><br><ul><li>  Tambahkan 2 baris </li><li>  Pushu melakukan </li><li>  Saya menunggu 10 detik </li><li>  Periksa, lihat apa yang salah </li><li>  Ulangi </li></ul><br>  Menurut perkiraan kasar, cabang siap-gabung memiliki sekitar 20% komitmen bermanfaat dan 80% komitmen debug.  Misalkan saya selesai bekerja pada cabang dengan 300 komit, yang 240 komit pada dasarnya hanya menghabiskan 40 menit waktu kerja saya (dan ini hanya waktu tunggu untuk perakitan cabang, tidak memperhitungkan detik yang menambahkan hingga menit, untuk menambah 2 baris dan kemudian hapus mereka). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9a/810/70f/b9a81070f5d6091988cee3ff3ac88463.png" alt="gambar"><br><br>  Pada titik tertentu saya sudah bosan dan saya memutuskan untuk mengkonfigurasi xDebug untuk membuat proses debug lebih murah.  Sayangnya, kolega saya saat ini tidak menggunakan teknologi ini (saya sedang menunggu lelucon tentang "Saya punya perusahaan keren di mana tidak ada yang menggunakan xDebug"), atau mereka tidak tahu / tidak ingat bagaimana berteman dengan IDE xDebug ketika cabang pergi jarak jauh melalui CI, dan karena saya tidak pernah menghabiskan waktu dan seperti yang saya sebutkan di atas, proses pengaturan sesuatu adalah proses yang cukup menyakitkan bagi saya, itu menghasilkan sekitar 6 jam waktu murni, sehingga akhirnya bekerja, dan saya mengerti prosesnya, dan itu akan cukup nyaman. <br><a name="process"></a><br><h3>  Proses pengaturan </h3><br>  Saya tidak akan menjelaskan secara terperinci tentang cara memasang CI, Docker, secara umum, cara merakit infrastruktur, diasumsikan bahwa ini semua dilakukan dan yang tersisa hanyalah mengatur lingkungan pribadi Anda. <br><br>  Katakanlah repositori kami memiliki struktur seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/3ea/285/56d3ea285e90fed97ea116ac79715381.jpg" alt="gambar"><br><br>  Pertama, kita perlu memeriksa apakah xDebug sendiri ada dalam gambar saat ini, untuk ini Anda dapat menggunakan <b>phpinfo ();</b> <br><br>  Jika xDebug sudah termasuk dalam perakitan - baiklah, jika tidak, maka periksa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sumber ini</a> , yang membantu saya secara langsung dalam pengaturan itu sendiri, bagaimanapun, saya pergi dengan cara yang sedikit berbeda. <br><br><h4>  Konfigurasikan php.ini </h4><br>  Agar semuanya berfungsi pada akhirnya, 2 pengaturan xDebug penting bagi kami: <br><br><ul><li>  xdebug.remote_enable </li><li>  xdebug.remote_host </li></ul><br>  Dalam perakitan akhir cabang jarak jauh, <b>remote_enable</b> harus diaktifkan, dan di <b>remote_host</b> IP komputer Anda di jaringan harus ditetapkan.  Mari sertakan pengaturan ini dalam build kami. <br><br>  Pertama, Anda perlu mencari tahu di mana pengaturan php disimpan, mereka dapat ditemukan di <b>/usr/local/etc/php/conf.d/php.ini</b> , atau file .ini itu sendiri dapat dinamai berbeda, dalam kasus saya adalah <b>/ usr / local / etc / php / conf.d / php-settings.ini</b> .  Anda dapat mengetahui dari pengaturan gambar yang dikumpulkan. <br><br>  Kami membuat pengaturan tambahan di cabang kami melalui file php-settings.ini yang sama, dan menempatkannya di <b>./build_env/php/php-settings.ini</b> <br>  Kami menulis di dalamnya 2 dari pengaturan di atas: <br> <code>xdebug.remote_enable = on <br> xdebug.remote_host = IP...</code> <br> <br>  Selanjutnya, kita perlu menambahkan file ini ke pengaturan gambar "induk".  Saya melakukan ini melalui volume dengan menambahkan baris ke ./build_env/docker-compose/docker-compose.tmpl: <br> <code>- ${PROJECT_DIR}/build_env/php/php-settings.ini:/usr/local/etc/php/conf.d/php-settings.ini</code> <br> <br>  Inilah yang terlihat seperti docker-compose.tmpl di proyek saya: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/dfc/03d/6a9dfc03d0adf60127a3c03ede9b0f3e.jpg" alt="gambar"><br><br>  Lain kali Anda membangun cabang, Anda dapat memeriksa apakah pengaturan baru terikat melalui <b>phpinfo yang</b> sama <b>();</b>  jika ya - bagus, jika tidak - Anda kurang beruntung dan harus pergi dengan cara yang sama seperti yang saya lakukan pertama kali :( <br><br><h4>  Menyesuaikan Pemetaan dalam PHPstorm </h4><br>  Selanjutnya, Anda perlu mengkonfigurasi PHPstorm itu sendiri.  Saya memutuskan untuk tidak menggunakan DBgp Proxy, agar tidak mengkonfigurasi pemetaan di popup setiap saat.  Dalam kasus saya, saya menggunakan templat server yang akan berisi pemetaan yang diperlukan. <br><br>  Pergi ke <b>Pengaturan / Preferensi |</b>  <b>Bahasa &amp; Kerangka Kerja |</b>  <b>Php |</b>  <b>Server</b> <br><br><ol><li>  Buat templat server </li><li>  Nama: CABANG </li><li>  host: apa saja, itu tidak mempengaruhi </li><li>  port: apapun, itu tidak mempengaruhi </li><li>  Debugger: xDebug </li><li>  Letakkan daw di Use path mappings </li><li>  Kami meletakkan pemetaan yang sesuai, folder lokal yang berfungsi harus sesuai dengan folder di server tempat cabang-cabang yang dikumpulkan berada, dalam kasus saya build yang dikumpulkan berada di folder / var / www / builds / your_namespace / your_project / your_branch </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/fb9/268/c0bfb9268a256e387f3464e7ce100cc0.jpg" alt="gambar"><br><br>  Kami menyimpan pengaturan ini, kami akan mengubahnya setiap kali kami bekerja dengan cabang baru.  Misalnya, jika hari ini saya bekerja dengan cabang web-2233, maka saya akan mengubah pemetaan ke <b>/ var / www / builds / build_path / web-2233</b> <br><br><h4>  Tambahkan variabel lingkungan baru sehingga IDE secara otomatis menarik pemetaan </h4><br>  Sekarang hal yang agak penting dan bukan yang paling jelas.  Saat kami memulai debug, PHPstorm perlu memahami file lokal mana yang sesuai dengan file di server jauh.  Jika server tidak memberikan instalasi tertentu, jendela sembul akan muncul di mana Anda perlu memetakan jalur secara manual.  Agar PHPstorm segera mengambil pemetaan dari server dengan nama BRANCH, Anda perlu menambahkan variabel lingkungan <b>PHP_IDE_CONFIG</b> ke perakitan kami <br><br>  Di <b>./build_env/docker-compose/docker-compose.tmpl</b> buat variabel lingkungan baru di lingkungan: <br> <code>PHP_IDE_CONFIG: ${PHP_IDE_CONFIG}</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/793/5d1/274/7935d1274fadf298d10e57a2b6d6aba8.jpg" alt="gambar"><br><br>  Di <b>.gitlab-ci.yml kita</b> mengatur variabel ini: <br> <code>- export PHP_IDE_CONFIG="serverName=BRANCH"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/336/529/676/336529676de2d579e86a5820e02f06dc.jpg" alt="gambar"><br><br><h4>  Selesai! </h4><br>  Kami tidak perlu ekstensi browser, tidak perlu meneruskan URL XDEBUG_SESSION_START = IDE_KEY untuk mendapatkan parameter, kami tidak perlu menambahkan konfigurasi tambahan. <br><br>  Nyalakan penyadapan <img src="https://habrastorage.org/getpro/habr/post_images/f5f/cb7/dbd/f5fcb7dbd0b27a12b5be3ce65f1e9936.jpg" alt="gambar">  dan menyegarkan halaman situs, segera setelah kami menemukan breakpoint pertama, aplikasi akan berhenti di situ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/99c/352/45799c352fe12908ae598f93d1271aeb.jpg" alt="gambar"><br><br>  Terima kasih atas perhatian Anda, saya harap artikel ini akan bermanfaat dan seseorang akan menghemat waktu tanpa menginjak menyapu yang sama seperti saya :) <br><br>  Sumber yang saya gunakan saat pengaturan awal: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://gist.github.com/chadrien/c90927ec2d160ffea9c4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://confluence.jetbrains.com/display/PhpStorm/Docker+Support+in+PhpStorm#DockerSupportinPhpStorm-Debugging aplikasiPHPwebaplikasi berjalan di heDockercontainer</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id423337/">https://habr.com/ru/post/id423337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id423319/index.html">Integrasi kode Vivaldi. Pengembang kami memberi tahu</a></li>
<li><a href="../id423321/index.html">Melindungi repositori GitHub dari komitmen jahat</a></li>
<li><a href="../id423323/index.html">"Kamu harus malas untuk menjadi penguji yang baik."</a></li>
<li><a href="../id423329/index.html">Mempersiapkan wawancara dengan perusahaan Lima Besar</a></li>
<li><a href="../id423335/index.html">Bagaimana cara mengalahkan klik di Y. Direct dan AdWords untuk 600 ribu rubel sebulan</a></li>
<li><a href="../id423339/index.html">Apakah ada kehidupan di bawah Windows 98, bagian satu - tentang perangkat keras</a></li>
<li><a href="../id423341/index.html">Di bawah tekanan publik, Sony mengakui bahwa karya Bach bukan miliknya.</a></li>
<li><a href="../id423343/index.html">Nilai-nilai budaya yang terbuat dari plastik mulai membusuk</a></li>
<li><a href="../id423345/index.html">Perasaan takut</a></li>
<li><a href="../id423347/index.html">Di mana uang saya Bung: bundel desain dan Steam, pelokalan dan distributor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>