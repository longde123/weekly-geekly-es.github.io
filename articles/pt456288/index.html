<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∂ ‚òùüèª üë®üèæ‚Äç‚öñÔ∏è MAM: montagem de front-end sem dor üò∂ üî® ‚ñ™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, meu nome √© Dmitry Karlovsky e eu ... adoro o MAM. MAM domina o m√≥dulo gn√≥stico M , poupando-me a maior parte da rotina. 





 Um m√≥dulo agn√≥stic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MAM: montagem de front-end sem dor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456288/"><p>  Ol√°, meu nome √© Dmitry Karlovsky e eu ... adoro o MAM.  MAM domina o m√≥dulo gn√≥stico <strong>M</strong> , poupando-me a maior parte da rotina. </p><br><p><img src="https://habrastorage.org/webt/m2/5h/ps/m25hpsfevki-o6lwx4v_ukfxvtu.png" alt="M√≥dulo Agn√≥stico T√≠pico"></p><br><p> <strong>Um m√≥dulo agn√≥stico</strong> , diferente do tradicional, n√£o √© um arquivo com uma fonte, mas um diret√≥rio dentro do qual pode haver fontes em v√°rias linguagens: l√≥gica do programa em <code>JS</code> / <code>TS</code> , testes para ele em <code>TS</code> / <code>JS</code> , composi√ß√£o de componentes em <code>view.tree</code> , styles em <code>CSS</code> , localiza√ß√£o no <code>locale=*.json</code> do <code>locale=*.json</code> , imagens, etc., etc.  Se desejado, n√£o √© dif√≠cil fixar o suporte de qualquer outro idioma.  Por exemplo, Stylus para escrever estilos ou HTML para descrever modelos. </p><br><p>  As depend√™ncias entre os m√≥dulos s√£o rastreadas automaticamente, analisando a fonte.  Se o m√≥dulo estiver ativado, ele ser√° ativado como um todo - cada c√≥digo-fonte do m√≥dulo √© transposto e cai no pacote correspondente: scripts - separadamente, estilos - separadamente, testes - separadamente.  Para plataformas diferentes - seus pacotes configur√°veis: para um n√≥ - pr√≥prio, para um navegador - pr√≥prio. </p><br><p>  Automa√ß√£o total, falta de configura√ß√£o e clich√™, tamanhos m√≠nimos de pacotes, bombeamento autom√°tico de depend√™ncias, desenvolvimento de centenas de bibliotecas e aplicativos alienados em uma √∫nica base de c√≥digo, sem dor e sofrimento.  <strong>Uau, que v√≠cio!</strong>  Retire as crian√ßas gr√°vidas e nervosas dos monitores e seja bem-vindo ao submarino! </p><a name="habracut"></a><br><h1 id="filosofiya">  Filosofia </h1><br><p>  O MAM √© um experimento ousado para alterar radicalmente a forma como o c√≥digo √© organizado e o processo de trabalho com ele.  Aqui est√£o os princ√≠pios b√°sicos: </p><br><p>  <strong>Conven√ß√µes em vez de configura√ß√£o.</strong>  Acordos razo√°veis, simples e universais permitem automatizar toda a rotina, mantendo a conveni√™ncia e a uniformidade entre diferentes projetos. </p><br><p>  <strong>A infraestrutura √© separada, o c√≥digo √© separado.</strong>  Uma situa√ß√£o n√£o √© incomum quando voc√™ precisa desenvolver dezenas ou mesmo centenas de bibliotecas e aplicativos.  N√£o implante a infraestrutura de montagem, desenvolvimento, implanta√ß√£o etc. para cada um deles.  Basta perguntar uma vez e depois rebitar aplicativos como tortas. </p><br><p>  <strong>N√£o pague pelo que voc√™ n√£o usa.</strong>  Voc√™ usa algum tipo de m√≥dulo - ele est√° inclu√≠do no pacote com todas as suas depend√™ncias.  N√£o use - n√£o liga.  Quanto menores os m√≥dulos, maior a granularidade e menos c√≥digo desnecess√°rio no pacote. </p><br><p>  <strong>C√≥digo redundante m√≠nimo.</strong>  Dividir o c√≥digo em m√≥dulos deve ser t√£o simples quanto escrever todo o c√≥digo em um √∫nico arquivo.  Caso contr√°rio, o desenvolvedor ter√° pregui√ßa de dividir m√≥dulos grandes em pequenos. </p><br><p>  <strong>Nenhuma vers√£o conflita.</strong>  Existe apenas uma vers√£o - a atual.  N√£o h√° necessidade de gastar recursos no suporte a vers√µes antigas, se voc√™ pode gast√°-los na atualiza√ß√£o da √∫ltima. </p><br><p>  <strong>Mantenha um dedo no pulso.</strong>  O feedback mais r√°pido sobre incompatibilidades n√£o permitir√° que o c√≥digo fique ruim. </p><br><p>  <strong>A maneira mais f√°cil √© a mais certa.</strong>  Se o caminho certo exigir um esfor√ßo adicional, certifique-se de que ningu√©m os procure. </p><br><h1 id="importyeksporty">  Importa√ß√£o / Exporta√ß√£o </h1><br><p>  Abrimos o primeiro projeto lan√ßado usando um sistema de m√≥dulo moderno: <a href="">um m√≥dulo tem menos de 300 linhas, 30 das quais s√£o importadas.</a> </p><br><p>  Mas ainda s√£o flores: <a href="">para uma fun√ß√£o de 9 linhas, s√£o necess√°rias 8 importa√ß√µes.</a> </p><br><p>  E o meu favorito: <a href="">nem uma √∫nica linha de c√≥digo √∫til.</a>  20 linhas de valores de deslocamento do monte de m√≥dulos em um, para que voc√™ possa importar posteriormente de um m√≥dulo, e n√£o de vinte. </p><br><p>  Tudo isso √© um boilerplate, o que leva ao fato de que os desenvolvedores s√£o pregui√ßosos demais para alocar pequenos peda√ßos de c√≥digo em m√≥dulos separados, preferindo m√≥dulos grandes a pequenos.  E mesmo que eles n√£o sejam pregui√ßosos, resultam muitos c√≥digos para importa√ß√£o de m√≥dulos pequenos ou m√≥dulos especiais que importam muitos m√≥dulos para si mesmos e os exportam em massa. </p><br><p>  Tudo isso leva √† baixa granularidade do c√≥digo e ao aumento do tamanho dos pacotes configur√°veis ‚Äã‚Äãcom o c√≥digo n√£o utilizado, o que √© uma sorte o suficiente para estar pr√≥ximo do que √© usado.  Para JS, eles est√£o tentando resolver esse problema complicando o pipeline de montagem adicionando o chamado "tremor de √°rvore", que corta o excesso do que voc√™ importou.  Isso diminui a velocidade da montagem, mas nem tudo √© cortado. </p><br><p>  Id√©ia: <strong>e se n√£o importarmos, apenas pegar e usar, e o pr√≥prio colecionador descobrir o que precisa ser importado?</strong> </p><br><p>  IDEs modernos podem gerar importa√ß√µes automaticamente para as entidades que voc√™ usa.  Se o IDE puder fazer isso, o que impede o coletor de fazer isso?  Basta ter uma conven√ß√£o simples sobre a nomea√ß√£o e localiza√ß√£o dos arquivos, o que seria conveniente para o usu√°rio e compreens√≠vel para a m√°quina.  H√° muito tempo o PHP tem uma conven√ß√£o padr√£o: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PSR-4</a> .  O MAM apresenta o mesmo para arquivos .ts <em>e</em> .jam.js.: os nomes que come√ßam com $ s√£o o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nome</a> completo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de</a> alguma entidade global cujo c√≥digo √© carregado no caminho obtido no FQN, substituindo delimitadores por barras.  Um exemplo simples de dois m√≥dulos: </p><br><p>  <strong>meu / alert / alert.ts</strong> </p><br><pre> <code class="plaintext hljs">const $my_alert = alert // FQN   </code> </pre> <br><p>  <strong>meu / app / app.ts</strong> </p><br><pre> <code class="plaintext hljs">$my_alert( 'Hello!' ) // ,   /my/alert/</code> </pre> <br><p>  Um m√≥dulo inteiro de uma linha - o que poderia ser mais simples?  O resultado n√£o demorou a chegar: a simplicidade de criar e usar m√≥dulos leva a minimizar seu tamanho.  Como resultado, para maximizar a granularidade.  E como uma cereja - minimizando o tamanho dos pacotes sem tremer as √°rvores. </p><br><p>  Um bom exemplo √© a fam√≠lia de m√≥dulos de valida√ß√£o JSON <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/ mol / data</a> .  Se voc√™ usar a fun√ß√£o <code>$mol_data_integer</code> em algum lugar do seu c√≥digo, os m√≥dulos <code>/mol/data/integer</code> e <code>/mol/data/number</code> , dos quais <code>$mol_data_integer</code> depende, ser√£o inclu√≠dos no pacote.  Mas, por exemplo, o coletor <code>/mol/data/email</code> nem l√™ do disco, pois ningu√©m depende disso. </p><br><h1 id="razgrebaya-bardak">  Arrumando uma bagun√ßa </h1><br><p>  Desde que come√ßamos a chutar o Angular, n√£o vamos parar.  Onde voc√™ acha que procura a <code>applyStyles</code> fun√ß√£o <code>applyStyles</code> ?  Voc√™ n√£o vai adivinhar <a href=""><code>/packages/core/src/render3/styling_next/bindings.ts</code></a> .  A capacidade de colocar qualquer coisa em qualquer lugar leva ao fato de que em cada projeto observamos um sistema √∫nico de localiza√ß√£o de arquivos, geralmente n√£o pass√≠vel de l√≥gica.  E se o IDE √© freq√ºentemente salvo pelo ‚Äúsalto para a defini√ß√£o‚Äù, a visualiza√ß√£o do c√≥digo no github ou a revis√£o da solicita√ß√£o de recebimento s√£o privadas dessa oportunidade. </p><br><p>  Ideia: <strong>E se os nomes das entidades corresponderem estritamente √† sua localiza√ß√£o?</strong> </p><br><p>  Para colocar o c√≥digo no arquivo <code>/angular/packages/core/src/render3/stylingNext/bindings.ts</code> , na arquitetura do MAM, voc√™ precisar√° nomear a entidade <code>$angular_packages_core_src_render3_stylingNext_applyStyles</code> , mas √© claro que ningu√©m agir√°, porque h√° muito mais no nome.  Mas os nomes no c√≥digo que eu quero ver s√£o curtos e concisos, para que o desenvolvedor tente excluir todos os desnecess√°rios do nome, deixando apenas o importante: <code>$angular_render3_applyStyles</code> .  E ele estar√° localizado de acordo em <code>/angular/render3/applyStyles/applyStyles.ts</code> . </p><br><p>  Observe como o MAM usa os pontos fracos dos desenvolvedores para alcan√ßar o resultado desejado: cada entidade recebe um nome curto e exclusivo globalmente que pode ser usado em qualquer contexto.  Por exemplo, nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mensagens de confirma√ß√µes,</a> esses nomes permitem capturar de forma r√°pida e precisa o que eles est√£o falando: </p><br><pre> <code class="plaintext hljs">73ebc45e517ffcc3dcce53f5b39b6d06fc95cae1 $mol_vector: range expanding support 3a843b2cb77be19688324eeb72bd090d350a6cc3 $mol_data: allowed transformations 24576f087133a18e0c9f31e0d61052265fd8a31a $mol_data_record: support recursion</code> </pre> <br><p>  Ou, digamos que voc√™ queira <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrar todas as men√ß√µes do m√≥dulo $ mol_fiber na Internet</a> - tornando-o mais f√°cil do que nunca, gra√ßas ao FQN. </p><br><h1 id="ciklicheskie-zavisimosti">  Depend√™ncias c√≠clicas </h1><br><p>  Vamos escrever 7 linhas de c√≥digo simples em um arquivo: </p><br><pre> <code class="plaintext hljs">export class Foo { get bar() { return new Bar(); } } export class Bar extends Foo {} console.log(new Foo().bar);</code> </pre> <br><p>  Apesar da depend√™ncia c√≠clica, ele funciona corretamente.  Dividimos em 3 arquivos: </p><br><p>  <strong>my / foo.js</strong> </p><br><pre> <code class="plaintext hljs">import { Bar } from './bar.js'; export class Foo { get bar() { return new Bar(); } }</code> </pre> <br><p>  <strong>my / bar.js</strong> </p><br><pre> <code class="plaintext hljs">import { Foo } from './foo.js'; export class Bar extends Foo {}</code> </pre> <br><p>  <strong>my / app.js</strong> </p><br><pre> <code class="plaintext hljs">import { Foo } from './foo.js'; console.log(new Foo().bar);</code> </pre> <br><p>  Ops, <code>ReferenceError: Cannot access 'Foo' before initialization</code> .  Que tipo de bobagem?  Para corrigir isso, nosso <code>app.js</code> precisa saber que o <code>foo.js</code> depende do <code>bar.js</code>  Portanto, primeiro precisamos importar <code>bar.js</code> , que importa <code>foo.js</code>  Ap√≥s o qual j√° podemos importar o <code>foo.js</code> sem erros: </p><br><p>  <strong>my / app.js</strong> </p><br><pre> <code class="plaintext hljs">import './bar.js'; import { Foo } from './foo.js'; console.log(new Foo().bar);</code> </pre> <br><p>  Os navegadores, o NodeJS, o Webpack, o Parcel - todos eles funcionam tortamente com depend√™ncias circulares.  E bem, eles simplesmente os proibiriam - seria poss√≠vel complicar imediatamente o c√≥digo para que n√£o haja loops.  Mas eles podem funcionar bem, e ent√£o bam, e dar um erro incompreens√≠vel. </p><br><p>  Ideia: <strong>E se, durante a montagem, colarmos os arquivos na ordem correta, como se todo o c√≥digo estivesse originalmente escrito em um arquivo?</strong> </p><br><p>  Vamos dividir o c√≥digo usando os princ√≠pios do MAM: </p><br><p>  <strong>meu / foo / foo.ts</strong> </p><br><pre> <code class="plaintext hljs">class $my_foo { get bar() { return new $my_bar(); } }</code> </pre> <br><p>  <strong>meu / bar / bar.ts</strong> </p><br><pre> <code class="plaintext hljs">class $my_bar extends $my_foo {}</code> </pre> <br><p>  <strong>meu / app / app.ts</strong> </p><br><pre> <code class="plaintext hljs">console.log(new $my_foo().bar);</code> </pre> <br><p>  Todas as mesmas 7 linhas de c√≥digo originalmente.  E eles simplesmente trabalham sem xamanismo adicional.  O problema √© que o colecionador entende que a depend√™ncia do <code>my/bar</code> no <code>my/foo</code> mais rigorosa do que do <code>my/foo</code> no <code>my/bar</code> .  Isso significa que voc√™ deve incluir esses m√≥dulos no pacote nesta ordem: <code>my/foo</code> , <code>my/bar</code> , <code>my/app</code> . </p><br><p>  Como o colecionador entende isso?  Agora, a heur√≠stica √© simples - pelo n√∫mero de indenta√ß√£o na linha em que a depend√™ncia √© detectada.  Observe que uma depend√™ncia mais forte em nosso exemplo tem recuo zero e uma fraca tem recuo duplo. </p><br><h1 id="raznye-yazyki">  L√≠nguas diferentes </h1><br><p>  Aconteceu que, para coisas diferentes, temos idiomas diferentes para essas coisas diferentes afiadas.  Os mais comuns s√£o: JS, TS, CSS, HTML, SVG, SCSS, Menos, Stylus.  Cada um possui seu pr√≥prio sistema de m√≥dulos, que n√£o interage com outros idiomas de forma alguma.  Escusado ser√° dizer que, cerca de 100500 tipos de idiomas mais espec√≠ficos.  Como resultado, para conectar um componente, voc√™ deve conectar separadamente seus scripts, estilos separados, registrar modelos separadamente, configurar separadamente a implanta√ß√£o dos arquivos est√°ticos necess√°rios, etc., etc. </p><br><p>  Gra√ßas aos carregadores, o Webpack est√° tentando resolver esse problema.  Mas ele tem um ponto de entrada √© um script que j√° conecta arquivos em outros idiomas.  E se n√£o precisarmos de um script?  Por exemplo, temos um m√≥dulo com belos estilos de chapas e queremos que elas tenham as mesmas cores no tema claro e outros no escuro: </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.dark-theme</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: black; } <span class="hljs-selector-class"><span class="hljs-selector-class">.light-theme</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: white; }</code> </pre> <br><p>  Al√©m disso, se dependemos do t√≥pico, um script deve ser carregado para instalar o t√≥pico desejado, dependendo da hora do dia.  Ou seja, o CSS realmente depende do JS. </p><br><p>  Id√©ia: <strong>e se um sistema modular n√£o depender de idiomas?</strong> </p><br><p>  Como no MAM o sistema modular √© separado dos idiomas, as depend√™ncias podem ser cruzadas.  O CSS pode depender do JS, que pode depender do TS, que pode depender de outro JS.  Isso √© alcan√ßado devido ao fato de que as depend√™ncias de origem s√£o detectadas nos m√≥dulos, e os m√≥dulos s√£o totalmente conectados e podem conter c√≥digos de origem em qualquer idioma.  No caso do exemplo de temas, fica assim: </p><br><p>  <strong>/my/table/table.css</strong> </p><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* ,   /my/theme */</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[my_theme="dark"]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: black; } <span class="hljs-selector-attr"><span class="hljs-selector-attr">[my_theme="light"]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: white; }</code> </pre> <br><p>  <strong>/my/theme/theme.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.setAttribute( <span class="hljs-string"><span class="hljs-string">'my_theme'</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getHours() + <span class="hljs-number"><span class="hljs-number">15</span></span> ) % <span class="hljs-number"><span class="hljs-number">24</span></span> &lt; <span class="hljs-number"><span class="hljs-number">12</span></span> ? <span class="hljs-string"><span class="hljs-string">'light'</span></span> : <span class="hljs-string"><span class="hljs-string">'dark'</span></span> , )</code> </pre> <br><p>  A prop√≥sito, usando essa t√©cnica, voc√™ pode implementar seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modernizr</a> , mas sem 300 verifica√ß√µes necess√°rias, porque apenas as verifica√ß√µes das quais o CSS realmente depende ser√£o inclu√≠das no pacote. </p><br><h1 id="mnogo-bibliotek">  Muitas bibliotecas </h1><br><p>  Normalmente, o ponto de entrada para a constru√ß√£o de um pacote configur√°vel √© algum tipo de arquivo.  No caso do Webpack, este √© JS.  Se voc√™ desenvolver muitas bibliotecas e aplicativos alien√°veis, precisar√° de muitos pacotes.  E para cada pacote, voc√™ precisa criar um ponto de entrada separado.  No caso do Parcel, o ponto de entrada √© HTML, que para aplicativos ter√° que ser criado de qualquer maneira.  Mas, para as bibliotecas, isso n√£o √© muito adequado. </p><br><p>  Id√©ia: <strong>E se algum m√≥dulo puder ser montado em um pacote independente sem prepara√ß√£o preliminar?</strong> </p><br><p>  Vamos montar a vers√£o mais recente do construtor de projetos $ mol_build MAM: </p><br><pre> <code class="plaintext hljs">mam mol/build</code> </pre> <br><p>  Agora execute esse coletor e deixe-o se reunir novamente para garantir que ele ainda possa se reunir: </p><br><pre> <code class="plaintext hljs">node mol/build/-/node.js mol/build</code> </pre> <br><p>  Embora n√£o, vamos pedir que ele execute testes junto com o assembly: </p><br><pre> <code class="plaintext hljs">node mol/build/-/node.test.js mol/build</code> </pre> <br><p>  E se tudo correu bem, publique o resultado no NPM: </p><br><pre> <code class="plaintext hljs">npm publish mol/build/-</code> </pre> <br><p>  Como voc√™ pode ver, ao montar o m√≥dulo, um subdiret√≥rio √© criado com o nome <code>-</code> e todos os artefatos de montagem s√£o colocados l√°.  Vamos examinar os arquivos que voc√™ pode encontrar l√°: </p><br><ul><li>  <code>web.dep.json</code> - todas as informa√ß√µes sobre o gr√°fico de depend√™ncia </li><li>  <code>web.js</code> - pacote de scripts do navegador </li><li>  <code>web.js.map</code> - mapas para ele </li><li>  <code>web.esm.js</code> - est√° na forma de um m√≥dulo es </li><li>  <code>web.esm.js.map</code> - e mapas para ele </li><li>  <code>web.test.js</code> - pacote de teste </li><li>  <code>web.test.js.map</code> - e para testes de sorsmap </li><li>  <code>web.d.ts</code> - pacote com tipos de tudo o que est√° no pacote de scripts </li><li>  <code>web.css</code> - pacote com estilos </li><li>  <code>web.css.map</code> - e mapas de classifica√ß√£o para ele </li><li>  <code>web.test.html</code> - ponto de entrada para executar testes de desempenho em um navegador </li><li>  <code>web.view.tree</code> - declara√ß√µes de todos os componentes inclu√≠dos no pacote view.tree </li><li>  <code>web.locale=*.json</code> - pacotes com textos localizados, cada pacote possui seu pr√≥prio pacote </li><li>  <code>package.json</code> - permite publicar imediatamente o m√≥dulo montado no NPM </li><li>  <code>node.dep.json</code> - todas as informa√ß√µes sobre o gr√°fico de depend√™ncia </li><li>  <code>node.js</code> - pacote de scripts do n√≥ </li><li>  <code>node.js.map</code> - sorsmaps para ele </li><li>  <code>node.esm.js</code> - est√° na forma de um m√≥dulo es </li><li>  <code>node.esm.js.map</code> - e sorsmaps para ele </li><li>  <code>node.test.js</code> - o mesmo pacote, mas tamb√©m com testes </li><li>  <code>node.test.js.map</code> - e sorsmaps para ele </li><li>  <code>node.d.ts</code> - pacote com tipos de tudo o que est√° no pacote de scripts </li><li>  <code>node.view.tree</code> - declara√ß√µes de todos os componentes inclu√≠dos no pacote view.tree </li><li>  <code>node.locale=*.json</code> - pacotes <code>node.locale=*.json</code> com textos localizados, cada pacote <code>node.locale=*.json</code> possui seu pr√≥prio pacote <code>node.locale=*.json</code> </li></ul><br><p>  A est√°tica √© simplesmente copiada junto com os caminhos.  Como exemplo, considere um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicativo que exibe seus pr√≥prios c√≥digos-fonte</a> .  Suas fontes est√£o aqui: </p><br><ul><li> <code>/mol/app/quine/quine.view.tree</code> </li> <li> <code>/mol/app/quine/quine.view.ts</code> </li> <li> <code>/mol/app/quine/index.html</code> </li> <li> <code>/mol/app/quine/quine.locale=ru.json</code> </li> </ul><br><p>  Infelizmente, no caso geral, o coletor n√£o pode saber que precisaremos desses arquivos em tempo de execu√ß√£o.  Mas podemos dizer isso colocando um arquivo especial por perto: </p><br><p>  <strong>/mol/app/quine/quine.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">deploy \/mol/app/quine/quine.view.tree deploy \/mol/app/quine/quine.view.ts deploy \/mol/app/quine/index.html deploy \/mol/app/quine/quine.locale=ru.json</code> </pre> <br><p>  Como resultado do assembly <code>/mol/app/quine</code> , eles ser√£o copiados das seguintes maneiras: </p><br><ul><li> <code>/mol/app/quine/-/mol/app/quine/quine.view.tree</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/quine.view.ts</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/index.html</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/quine.locale=ru.json</code> </li> </ul><br><p>  Agora, o diret√≥rio <code>/mol/app/quine/-</code> pode ser definido em qualquer hospedagem est√°tica e o aplicativo estar√° totalmente funcional. </p><br><h1 id="celevye-platformy">  Plataformas alvo </h1><br><p>  JS pode ser executado no cliente e no servidor.  E como √© legal quando voc√™ pode escrever um c√≥digo e ele funcionar√° em qualquer lugar.  No entanto, √†s vezes a implementa√ß√£o da mesma coisa no cliente e no servidor √© fundamentalmente diferente.  E eu quero, por exemplo, uma implementa√ß√£o a ser usada para um n√≥ e outra para um navegador. </p><br><p>  Id√©ia: <strong>e se o objetivo do arquivo estiver refletido em seu nome?</strong> </p><br><p>  O MAM usa um sistema de tags nos nomes dos arquivos.  Por exemplo, o m√≥dulo <code>$mol_state_arg</code> fornece acesso a par√¢metros de aplicativos definidos pelo usu√°rio.  No navegador, esses par√¢metros s√£o definidos atrav√©s da barra de endere√ßo.  E no n√≥, atrav√©s de argumentos de linha de comando.  <code>$mol_sate_arg</code> abstrai o restante do aplicativo dessas nuances implementando ambas as op√ß√µes com uma √∫nica interface, colocando-as em arquivos: </p><br><ul><li>  / mol / estado / arg / arg.  <strong>web</strong> .ts - implementa√ß√£o para navegadores </li><li>  / mol / estado / arg / arg.  <strong>node</strong> .ts - implementa√ß√£o para um n√≥ </li></ul><br><p>  As fontes n√£o identificadas com essas tags s√£o inclu√≠das, independentemente da plataforma de destino. </p><br><p>  Uma situa√ß√£o semelhante √© observada nos testes - eles querem ser armazenados ao lado do restante das fontes, mas n√£o desejam ser inclu√≠dos no pacote configur√°vel que vai para o usu√°rio final.  Portanto, os testes tamb√©m s√£o marcados com uma tag separada: </p><br><ul><li>  / mol / estado / arg / arg.  <strong>test</strong> .ts - testes de m√≥dulo, eles se encaixam no pacote de teste </li></ul><br><p>  Tags podem ser param√©tricas.  Por exemplo, com cada m√≥dulo, podem aparecer textos em v√°rios idiomas e devem ser inclu√≠dos nos pacotes de idiomas correspondentes.  Um arquivo de texto √© um dicion√°rio JSON comum nomeado com o c√≥digo do idioma no nome: </p><br><ul><li>  / mol / app / life / life.  <strong>locale = ru</strong> .json - textos para o idioma russo </li><li>  / mol / app / life / life.  <strong>locale = jp</strong> .json - textos para japon√™s </li></ul><br><p>  Por fim, e se quisermos colocar arquivos por perto, mas desejar que o coletor os ignore e n√£o os inclua automaticamente no pacote?  Basta adicionar no in√≠cio do nome qualquer caractere n√£o alfanum√©rico.  Por exemplo: </p><br><ul><li>  / hyoo / brinquedos / <strong>.</strong>  git - come√ßa com um ponto, ent√£o o coletor ignorar√° esse diret√≥rio </li></ul><br><h1 id="versionirovanie">  Versionamento </h1><br><p>  O Google lan√ßou o AngularJS pela primeira vez e o publicou no NPM como <code>angular</code> .  Ent√£o ele criou uma estrutura completamente nova com um nome semelhante - Angular e a publicou com o mesmo nome, mas j√° a vers√£o 2. Agora, esses dois fogos de artif√≠cio est√£o se desenvolvendo de forma independente.  Somente uma altera√ß√£o de quebra de API ocorre entre as principais vers√µes.  E o outro - <a href="">entre o menor</a> .  E como √© imposs√≠vel colocar duas vers√µes da mesma depend√™ncia no mesmo n√≠vel, n√£o se pode falar de uma transi√ß√£o suave, quando duas vers√µes da biblioteca coexistem simultaneamente por algum tempo no aplicativo. </p><br><p>  Parece que a equipe da Angular j√° entrou em todos os poss√≠veis sorteios.  E mais uma coisa: o c√≥digo da estrutura √© dividido em v√°rios m√≥dulos grandes.  No in√≠cio, eles os fizeram uma vers√£o independente, mas muito rapidamente at√© eles mesmos come√ßaram a ficar confusos sobre quais vers√µes dos m√≥dulos s√£o compat√≠veis entre si, sem falar nos desenvolvedores comuns.  Portanto, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Angular mudou para o versionamento de ponta a ponta</a> , onde a vers√£o principal do m√≥dulo pode ser alterada mesmo sem nenhuma altera√ß√£o no c√≥digo.  O suporte a v√°rias vers√µes de v√°rios m√≥dulos √© um grande problema, tanto para os mantenedores quanto para o ecossistema como um todo.  Afinal, muitos recursos de todos os membros da comunidade s√£o gastos para garantir a compatibilidade com m√≥dulos j√° obsoletos. </p><br><p>  A bela id√©ia do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Semantic Versioning</a> se transforma em realidade dura - voc√™ nunca sabe se algo vai quebrar quando voc√™ altera a vers√£o secund√°ria <a href="">ou mesmo a vers√£o do patch</a> .  Portanto, em muitos projetos, uma vers√£o espec√≠fica da depend√™ncia √© corrigida.  No entanto, essa corre√ß√£o n√£o afeta depend√™ncias transitivas, que podem ser atra√≠das para a vers√£o mais recente ao instalar a partir do zero, mas podem permanecer as mesmas se j√° estiverem instaladas.  Essa confus√£o leva ao fato de que voc√™ nunca pode confiar em uma vers√£o fixa e precisa verificar regularmente a compatibilidade com as vers√µes atuais de depend√™ncias (pelo menos transitivas). </p><br><p>  Mas e os <a href="">arquivos de bloqueio</a> ?  Se voc√™ estiver desenvolvendo uma biblioteca instalada por meio de depend√™ncias, o arquivo de bloqueio n√£o o ajudar√°, porque ser√° ignorado pelo gerenciador de pacotes.  Para a aplica√ß√£o final, o arquivo de bloqueio fornecer√° a chamada "reprodutibilidade de montagens".  Mas sejamos honestos.  Quantas vezes voc√™ precisa criar o aplicativo final a partir da mesma fonte?  Exatamente uma vez.  Recebendo a sa√≠da, independentemente de qualquer NPM, o artefato de montagem: um bin√°rio execut√°vel, cont√™iner de docker ou apenas um archive com todo o c√≥digo necess√°rio para execut√°-lo.  Espero que voc√™ n√£o <code>npm install</code> no prod? </p><br><p>  Alguns acham o uso de arquivos de bloqueio para que o servidor de CI monte exatamente o que o desenvolvedor comprometeu.  Mas espere, o pr√≥prio desenvolvedor pode simplesmente mont√°-lo em sua m√°quina local.  ,    ,  ,    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Continuous Integration</a>       ,     ,    ,  ,   - .  CI        ,            . </p><br><p>        ,     ,  . ,            Angular@4 (  3).  ,     ,  "     "  "     ".      Angular@4     ,      Angular@5.      Angular@6,         .  Angular   TypeScript    .     .  ,   2  ,  ‚Ä¶      ,   business value    ,     ,  ,  ,  . </p><br><p>                   ,    ,       ,   ,       2 .    :      ,  ‚Äî ,  ‚Äî .       3 React, 5 jQuery, 7 lodash. </p><br><p> : <strong>         ‚Äî ?</strong> </p><br><p>         .     -   .     ,       .     ,     .  ,    .  ,       .        ,    .   ,        ,            .      :  issue,    ,  workaround,  pull request,    ,      .          ,    ,    .        .            . </p><br><p>               ,        . ,        ,       .        .        .  :  ,       ,     -.     -      ‚Äî       .  ,            ,    -  .         , ,  ,   NPM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     .  ,      .       . </p><br><p>         ,      ?   ‚Äî   .  <code>mobx</code> ,  <code>mobx2</code>     API  .   ‚Äî    ,    :     ,       .     <code>mobx</code>        <code>mobx2</code> ,      API.         API,     . </p><br><p>        .           ‚Äî .  ,      : </p><br><pre> <code class="plaintext hljs">var pages_count = $mol_atom2_sync( ()=&gt; $lib_pdfjs.getDocument( uri ).promise ).document().numPages</code> </pre> <br><p>  <strong> </strong>   <code>mol_atom2_sync</code>  <code>lib_pdfjs</code> ,      : </p><br><pre> <code class="plaintext hljs">npm install mol_atom2_sync@2.1 lib_pdfjs@5.6</code> </pre> <br><p> ,   , ‚Äî   ,       .        ?    ‚Äî    ,    <code>*.meta.tree</code> ,          : </p><br><p> <strong>/.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">pack node git \https://github.com/nin-jin/pms-node.git pack mol git \https://github.com/eigenmethod/mol.git pack lib git \https://github.com/eigenmethod/mam-lib.git</code> </pre> <br><p>    .             . </p><br><h1 id="integraciya-s-npm">   NPM </h1><br><p> MAM ‚Äî    NPM . ,         ‚Äî . ,    ,     NPM      . </p><br><p>          NPM ,     $node. ,   -        -: </p><br><p> <strong>/my/app/app.ts</strong> </p><br><pre> <code class="plaintext hljs">$node.portastic.find({ min : 8080 , max : 8100 , retrieve : 1 }).then( ( ports : number[] ) =&gt; { $node.express().listen( ports[0] ) })</code> </pre> <br><p>       ,     . -    <code>lib</code>      NPM . ,     NPM- <code>pdfjs-dist</code> : </p><br><p> <strong>/lib/pdfjs/pdfjs.ts</strong> </p><br><pre> <code class="plaintext hljs">namespace $ { export let $lib_pdfjs : typeof import( 'pdfjs-dist' ) = require( 'pdfjs-dist/build/pdf.min.js' ) $lib_pdfjs.disableRange = true $lib_pdfjs.GlobalWorkerOptions.workerSrc = '-/node_modules/pdfjs-dist/build/pdf.worker.min.js' }</code> </pre> <br><p> <strong>/lib/pdfjs/pdfjs.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">deploy \/node_modules/pdfjs-dist/build/pdf.worker.min.js</code> </pre> <br><p>        ,    . </p><br><h1 id="okruzhenie-razrabotchika">   </h1><br><p>          .     <code>create-react-app</code>  <code>angular-cli</code> ,       . , ,   <code>eject</code>       .          .       ,         ,       . </p><br><p> : <strong>      ?</strong> </p><br><p>    MAM      .          . </p><br><p>      MAM  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   MAM </a> ,    : </p><br><pre> <code class="plaintext hljs">git clone https://github.com/eigenmethod/mam.git ./mam &amp;&amp; cd mam npm install npm start</code> </pre> <br><p>   8080   . ,    ‚Äî        MAM. </p><br><p>     (  ‚Äî <code>acme</code> )         (  ‚Äî <code>hello</code>  <code>home</code> ): </p><br><p> <strong>/acme/acme.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">pack hello git \https://github.com/acme/hello.git pack home git \https://github.com/acme/home.git</code> </pre> <br><p>           <code>npm start</code> : </p><br><pre> <code class="plaintext hljs">npm start acme/hello acme/home</code> </pre> <br><p>         .     ‚Äî  . ,  ,   .     ‚Äî   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://t.me/mam_mol</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456288/">https://habr.com/ru/post/pt456288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt456272/index.html">O que √© o Android Lint e como ele ajuda a escrever c√≥digo suportado</a></li>
<li><a href="../pt456274/index.html">Psic√≥logos: rob√¥s sexuais levar√£o a um aumento no n√∫mero de pessoas sem um casal que n√£o precisa de relacionamentos com outras pessoas</a></li>
<li><a href="../pt456276/index.html">O que √© informa√ß√£o?</a></li>
<li><a href="../pt456280/index.html">Introdu√ß√£o ao stm32 ou n√£o repita meus erros</a></li>
<li><a href="../pt456282/index.html">Gr√°ficos multidimensionais em Python - de tridimensionais a seis dimensionais</a></li>
<li><a href="../pt456290/index.html">Telegram Unidade de rede ilimitada. Gr√°tis</a></li>
<li><a href="../pt456294/index.html">Diferen√ßas entre LabelEncoder e OneHotEncoder no SciKit Learn</a></li>
<li><a href="../pt456296/index.html">O mundo da hiperesfera tridimensional. Rastreamento de raios geod√©sicos em um universo fechado com geometria esf√©rica</a></li>
<li><a href="../pt456298/index.html">Tecnologias de microeletr√¥nica nos dedos: Lei de Moore, o marketing se move e por que os nan√¥metros n√£o s√£o os mesmos agora. Parte 2</a></li>
<li><a href="../pt456300/index.html">Encontrando zina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>