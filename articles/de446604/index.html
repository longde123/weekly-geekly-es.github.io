<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ•Ô∏è üë©‚Äçüëß‚Äçüë¶ ‚ôàÔ∏è ESET: Neue Backdoor-Lieferprogramme f√ºr OceanLotus Cybergroup ü§∞ üßíüèΩ üîº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem Beitrag werden wir beschreiben, wie die OceanLotus-Cybergroup (APT32 und APT-C-00) k√ºrzlich einen der √∂ffentlichen Exploits f√ºr CVE-2017-1188...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Neue Backdoor-Lieferprogramme f√ºr OceanLotus Cybergroup</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/446604/">  In einem Beitrag werden wir beschreiben, wie die OceanLotus-Cybergroup (APT32 und APT-C-00) k√ºrzlich einen der √∂ffentlichen Exploits f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CVE-2017-11882 verwendet hat</a> , die Sicherheitsanf√§lligkeit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bez√ºglich</a> Speicherbesch√§digung in Microsoft Office, und wie die Malware der Gruppe in kompromittierten Systemen Persistenz bietet, ohne Spuren zu hinterlassen .  Als n√§chstes beschreiben wir, wie die Gruppe ab Anfang 2019 selbstextrahierende Archive verwendete, um den Code auszuf√ºhren. <br><br>  OceanLotus ist auf Cyberspionage spezialisiert und hat vorrangige Ziele in S√ºdostasien.  Angreifer f√§lschen Dokumente, die die Aufmerksamkeit potenzieller Opfer auf sich ziehen, um sie davon zu √ºberzeugen, eine Hintert√ºr zu √∂ffnen, und arbeiten auch an der Entwicklung von Werkzeugen.  Die Methoden zum Erstellen von K√∂dern variieren bei verschiedenen Angriffen - von Dateien mit "doppelter Erweiterung", selbstextrahierenden Archiven, Dokumenten mit Makros bis hin zu bekannten Exploits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/h9/mc/aph9mchsgkupnlpka6cf7g_u13g.jpeg"></div><br><a name="habracut"></a><h2>  Verwenden eines Exploits im Microsoft Equation Editor </h2><br>  Mitte 2018 startete OceanLotus eine Kampagne mit der Sicherheitsanf√§lligkeit CVE-2017-11882.  Eines der sch√§dlichen Dokumente der Cybergroup wurde von 360 Experten des Threat Intelligence Center (eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Studie auf Chinesisch</a> ) analysiert, einschlie√ülich einer detaillierten Beschreibung des Exploits.  Im folgenden Beitrag eine √úbersicht √ºber ein solches sch√§dliches Dokument. <br><br><h3>  Erste Stufe </h3><br>  <code>FW Report on demonstration of former CNRP in Republic of Korea.doc</code> (SHA-1: <code>D1357B284C951470066AAA7A8228190B88A5C7C3</code> ) √§hnelt dem in der obigen Studie erw√§hnten.  Es ist insofern interessant, als es sich an Benutzer richtet, die an kambodschanischer Politik interessiert sind (CNRP - Kambodschas Nationale Heilspartei, aufgel√∂st Ende 2017).  Trotz der Erweiterung .doc hat das Dokument das RTF-Format (siehe Abbildung unten), enth√§lt Junk-Code und ist auch verzerrt. <br><br><img src="https://habrastorage.org/webt/a-/gt/6y/a-gt6ylnd0rbyzvs8eecjpi04-a.png"><br>  <i>Abbildung 1. Papierkorb in RTF</i> <br><br>  Trotz des Vorhandenseins verzerrter Elemente √∂ffnet Word diese RTF-Datei erfolgreich.  Wie aus Abbildung 2 ersichtlich ist, befindet sich hier die EQNOLEFILEHDR-Struktur bei Offset 0xC00, gefolgt vom MTEF-Header und dem MTEF-Eintrag (Abbildung 3) f√ºr die Schriftart. <br><br><img src="https://habrastorage.org/webt/oh/ks/tb/ohkstbugzx97wthqqqnrdoo27di.png"><br>  <i>Abbildung 2. FONT-Aufzeichnungswerte</i> <br><br><img src="https://habrastorage.org/webt/jy/wj/b5/jywjb5bgsixdqywivkc_ndzcgiu.png"><br>  <i>Abbildung 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FONT-Aufnahmeformat</a></i> <br><br>  Ein √úberlauf im Namensfeld ist m√∂glich, da dessen Gr√∂√üe vor dem Kopieren nicht √ºberpr√ºft wird.  Ein zu langer Name l√∂st eine Sicherheitsanf√§lligkeit aus.  Wie aus dem Inhalt der RTF-Datei ersichtlich ist (Offset 0xC26 in Abbildung 2), wird der Puffer mit Shell-Code gef√ºllt, gefolgt von einem Dummy-Befehl ( <code>0x90</code> ) und der R√ºcksprungadresse <code>0x402114</code> .  Die Adresse ist ein Dialogelement in <code>EQNEDT32.exe</code> , das auf eine <code>RET</code> Anweisung verweist.  Dies f√ºhrt dazu, dass EIP auf den Anfang des Namensfelds zeigt, das den Shellcode enth√§lt. <br><br><img src="https://habrastorage.org/webt/_9/gf/lo/_9gflo6k9zsefvvnq8jdaqosuua.png"><br>  <i>Abbildung 4. Start des Exploit-Shellcodes</i> <br><br>  Die Adresse <code>0x45BD3C</code> speichert eine Variable, die dereferenziert wird, bis sie einen Zeiger auf die aktuell geladene <code>MTEFData</code> Struktur erreicht.  Hier ist der Rest des Shellcodes. <br><br>  Der Zweck des Shell-Codes besteht darin, das zweite Fragment des in ein offenes Dokument eingebetteten Shell-Codes auszuf√ºhren.  Zun√§chst versucht der Quell-Shellcode, den Dateideskriptor des ge√∂ffneten Dokuments zu finden, <code>NtQuerySystemInformation</code> er alle Systemdeskriptoren ( <code>NtQuerySystemInformation</code> mit dem Argument <code>SystemExtendedHandleInformation</code> ) <code>SystemExtendedHandleInformation</code> und pr√ºft, ob die <i>PID</i> des Deskriptors und die <i>PID des</i> <code>WinWord</code> Prozesses <code>WinWord</code> und ob das Dokument mit der Zugriffsmaske <code>0x12019F</code> . <br><br>  Um die Erkennung des richtigen Deskriptors (und nicht des Deskriptors eines anderen ge√∂ffneten Dokuments) zu best√§tigen, wird der Inhalt der Datei mithilfe der Funktion <code>CreateFileMapping</code> angezeigt, und der Shell-Code pr√ºft, ob die letzten vier Bytes des Dokuments " <code>yyyy</code> " (Egg Hunting-Methode) entsprechen.  Sobald eine √úbereinstimmung gefunden wurde, wird das Dokument als <code>ole.dll</code> in einen tempor√§ren Ordner ( <code>GetTempPath</code> ) <code>ole.dll</code> .  Dann werden die letzten 12 Bytes des Dokuments gelesen. <br><br><img src="https://habrastorage.org/webt/w3/lq/xv/w3lqxvqbmerfijoryxi3vkitaao.png"><br>  <i>Abbildung 5. Dokumentende-Markierungen</i> <br><br>  Der 32-Bit-Wert zwischen den Markierungen <code>AABBCCDD</code> und <code>yyyy</code> ist der Versatz des n√§chsten <code>AABBCCDD</code> .  Es wird mit der Funktion <code>CreateThread</code> .  Extrahiert den gleichen Shellcode, den OceanLotus zuvor verwendet hat.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das Python-Emulationsskript, das</a> wir im M√§rz 2018 ver√∂ffentlicht haben, funktioniert immer noch, um die zweite Stufe zu sichern. <br><br><h3>  Zweite Stufe </h3><br><h4>  Komponentenabruf </h4><br>  Datei- und Verzeichnisnamen werden dynamisch ausgew√§hlt.  Der Code w√§hlt zuf√§llig den Namen einer ausf√ºhrbaren Datei oder DLL-Datei in <code>C:\Windows\system32</code> .  Anschlie√üend stellt er eine Anfrage an seine Ressourcen und ruft das Feld <code>FileDescription</code> zur Verwendung als <code>FileDescription</code> .  Wenn dies nicht funktioniert, w√§hlt der Code den Ordnernamen zuf√§llig aus den Verzeichnissen <code>%ProgramFiles%</code> oder <code>C:\Windows</code> (aus GetWindowsDirectoryW) aus.  Es vermeidet die Verwendung eines Namens, der mit vorhandenen Dateien in Konflikt stehen kann, und stellt sicher, dass er nicht die folgenden W√∂rter enth√§lt: <code>windows</code> , <code>Microsoft</code> , <code>desktop</code> , <code>system</code> , <code>syswow64</code> oder <code>syswow64</code> .  Wenn das Verzeichnis bereits vorhanden ist, wird dem Namen "NLS_ {6 Zeichen}" hinzugef√ºgt. <br><br>  Die Ressource <code>0x102</code> analysiert und Dateien werden in <code>%ProgramFiles%</code> oder <code>%AppData%</code> in einem zuf√§llig ausgew√§hlten Ordner <code>%AppData%</code> .  Die Erstellungszeit wurde ge√§ndert und hat dieselben Werte wie <code>kernel32.dll</code> . <br><br>  Hier ist beispielsweise ein Ordner und eine Liste von Dateien, die durch Auswahl der ausf√ºhrbaren Datei <code>C:\Windows\system32\TCPSVCS.exe</code> als Datenquelle erstellt wurden. <br><br><img src="https://habrastorage.org/webt/px/ls/xq/pxlsxqrz8s0beuxfybxu0cvz8dg.png"><br>  <i>Abbildung 6. Extrahieren verschiedener Komponenten</i> <br><br>  Die Struktur der <code>0x102</code> Ressource in der Pipette ist ziemlich kompliziert.  Kurz gesagt, es enth√§lt: <br>  - Dateinamen <br>  - Gr√∂√üe und Inhalt der Dateien <br>  - Komprimierungsformat ( <code>COMPRESSION_FORMAT_LZNT1</code> das von der Funktion <code>COMPRESSION_FORMAT_LZNT1</code> verwendet wird) <br><br>  Die erste Datei wird als <code>TCPSVCS.exe</code> zur√ºckgesetzt. <code>TCPSVCS.exe</code> ist die legitime <code>AcroTranscoder.exe</code> (gem√§√ü <code>FileDescription</code> , SHA-1: <code>2896738693A8F36CC7AD83EF1FA46F82F32BE5A3</code> ). <br><br>  M√∂glicherweise haben Sie bemerkt, dass einige DLL-Dateien gr√∂√üer als 11 MB sind.  Dies liegt daran, dass sich in der ausf√ºhrbaren Datei ein gro√üer zusammenh√§ngender Puffer mit zuf√§lligen Daten befindet.  Es ist m√∂glich, dass dies eine M√∂glichkeit ist, die Erkennung durch einige Sicherheitsprodukte zu vermeiden. <br><br><h4>  Ausdauer </h4><br>  Die <code>0x101</code> Ressource im Dropper enth√§lt zwei 32-Bit-Ganzzahlen, die bestimmen, wie die Persistenz aufrechterhalten werden soll.  Der Wert des ersten gibt an, wie die Malware ohne Administratorrechte die Persistenz beibeh√§lt. <br><br><img src="https://habrastorage.org/webt/f6/aw/1x/f6aw1xtjqv-tfril3uzrx_nzstw.png"><br>  <i>Tabelle 1. Persistenzmechanismus ohne Administratorrechte</i> <br><br>  Der Wert der zweiten Ganzzahl gibt an, wie die Malware w√§hrend ihrer Arbeit als Administrator die Persistenz sicherstellen soll. <br><br><img src="https://habrastorage.org/webt/db/p2/em/dbp2embzyazeoxdnk8h6uji9lm4.png"><br>  <i>Tabelle 2. Persistenzmechanismus mit Administratorrechten</i> <br><br>  Ein Dienstname ist ein Dateiname ohne Erweiterung.  Der Anzeigename ist der Name des Ordners. Wenn er jedoch bereits vorhanden ist, wird ihm die Zeichenfolge ‚Äû <code>Revision 1</code> ‚Äú hinzugef√ºgt (die Anzahl erh√∂ht sich, bis ein nicht verwendeter Name gefunden wird).  Die Bediener stellten sicher, dass die Persistenz durch den Dienst stabil war. Im Falle eines Fehlers sollte der Dienst nach 1 Sekunde neu gestartet werden.  Dann wird der <code>WOW64</code> Wert des neuen Dienstregistrierungsschl√ºssels auf 4 gesetzt, was anzeigt, dass es sich um einen 32-Bit-Dienst handelt. <br><br>  Die geplante Aufgabe wird √ºber mehrere COM-Schnittstellen erstellt: <code>ITaskScheduler</code> , <code>ITask</code> , <code>ITaskTrigger</code> , <code>IPersistFile</code> und <code>ITaskScheduler</code> .  Im Wesentlichen erstellt das Schadprogramm eine versteckte Aufgabe, legt Kontoinformationen zusammen mit Informationen √ºber den aktuellen Benutzer oder Administrator fest und setzt dann den Ausl√∂ser. <br><br>  Dies ist eine t√§gliche Aufgabe mit einer Dauer von 24 Stunden und Intervallen zwischen zwei L√§ufen von 10 Minuten, was bedeutet, dass sie kontinuierlich ausgef√ºhrt wird. <br><br><h4>  B√∂sartiges St√ºck </h4><br>  In unserem Beispiel ist die ausf√ºhrbare Datei <code>TCPSVCS.exe</code> ( <code>AcroTranscoder.exe</code> ) eine legitime Software, die DLLs herunterl√§dt, die damit <code>TCPSVCS.exe</code> werden.  In diesem Fall ist <code>Flash Video Extension.dll</code> von Interesse. <br><br>  Die <code>DLLMain</code> Funktion ruft einfach eine andere Funktion auf.  Einige Fuzzy-Pr√§dikate sind vorhanden: <br><br><img src="https://habrastorage.org/webt/b-/im/fe/b-imfeegcv30g23fj2n9qqowdeu.png"><br>  <i>Abbildung 7. Fuzzy-Pr√§dikate</i> <br><br>  Nach diesen irref√ºhrenden √úberpr√ºfungen empf√§ngt der Code den <code>.text</code> der Datei <code>TCPSVCS.exe</code> , √§ndert seinen Schutz in <code>PAGE_EXECUTE_READWRITE</code> und √ºberschreibt ihn, indem er Dummy-Anweisungen hinzuf√ºgt: <br><br><img src="https://habrastorage.org/webt/dp/e7/fn/dpe7fnpq2lrioo0i15ki742mhro.png"><br>  <i>Abbildung 8. Die Reihenfolge der Anweisungen</i> <br><br>  Am Ende wird der <code>CALL</code> Befehl an die Adresse der von <code>Flash Video Extension.dll</code> exportierten <code>FLVCore::Uninitialize(void)</code> -Funktion hinzugef√ºgt.  Dies bedeutet, dass nach dem Laden der sch√§dlichen DLL, wenn die Laufzeit <code>WinMain</code> in <code>TCPSVCS.exe</code> , der Anweisungszeiger auf NOP zeigt, was zum Aufrufen von <code>FLVCore::Uninitialize(void)</code> , dem n√§chsten Schritt. <br><br>  Die Funktion erstellt einfach einen Mutex, der mit <code>{181C8480-A975-411C-AB0A-630DB8B0A221}</code> gefolgt vom aktuellen Benutzernamen.  Anschlie√üend liest sie die Speicherauszugsdatei mit der Erweiterung * .db3, die positionsunabh√§ngigen Code enth√§lt, und verwendet <code>CreateThread</code> , um den Inhalt auszuf√ºhren. <br><br>  Der Inhalt der * .db3-Datei ist der Shellcode, der √ºblicherweise von der OceanLotus-Gruppe verwendet wird.  Wir haben die Nutzdaten erneut erfolgreich mit dem Emulator-Skript entpackt, das wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf GitHub ver√∂ffentlicht haben</a> . <br><br>  Das Skript ruft die letzte Phase ab.  Diese Komponente ist eine Hintert√ºr, die wir bereits in einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren OceanLotus-Studie</a> analysiert haben.  Dies kann durch die GUID <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}</code> Bin√§rdatei bestimmt werden.  Die Malware-Konfiguration ist weiterhin in der PE-Ressource verschl√ºsselt.  Es hat ungef√§hr die gleiche Konfiguration, aber die C &amp; C-Server unterscheiden sich von den vorherigen: <br><br> <code>- andreagahuvrauvin[.]com <br> - byronorenstein[.]com <br> - stienollmache[.]xyz</code> <br> <br>  OceanLotus demonstriert erneut eine Kombination verschiedener Techniken, um eine Erkennung zu vermeiden.  Sie kehrten mit einem ‚Äûverfeinerten‚Äú √úberblick √ºber den Infektionsprozess zur√ºck.  Durch die Auswahl zuf√§lliger Namen und das Auff√ºllen ausf√ºhrbarer Dateien mit zuf√§lligen Daten wird die Anzahl vertrauensw√ºrdiger IoCs (basierend auf Hashes und Dateinamen) reduziert.  Dar√ºber hinaus m√ºssen Angreifer dank der Verwendung von DLLs von Drittanbietern nur die legitime <code>AcroTranscoder</code> Bin√§rdatei entfernen. <br><br><h2>  Selbstextrahierende Archive </h2><br>  Nach RTF-Dateien wechselte die Gruppe zu selbstextrahierenden Archiven (SFX) mit allgemeinen Dokumentsymbolen, um den Benutzer weiter zu verwirren.  Dies wurde von Threatbook geschrieben ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link auf Chinesisch</a> ).  Nach dem Start werden selbstextrahierende RAR-Dateien ausgegeben und DLLs mit der Erweiterung .ocx ausgef√ºhrt, deren endg√ºltige Nutzlast zuvor dokumentiert wurde. <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> .  Seit Mitte Januar 2019 hat OceanLotus diese Technik wiederverwendet, aber im Laufe der Zeit haben sich einige Konfigurationen ge√§ndert.  In diesem Abschnitt werden wir √ºber Technologie und Ver√§nderungen sprechen. <br><br><h4>  K√∂dererstellung </h4><br>  Das Dokument <code>THICH-THONG-LAC-HANH-THAP-THIEN-VIET-NAM (1).EXE</code> (SHA-1: <code>AC10F5B1D5ECAB22B7B418D6E98FA18E32BBDEAB</code> ) wurde erstmals 2018 gefunden.  Diese SFX-Datei wurde mit Bedacht erstellt - die Beschreibung ( <i>Versionsinfo</i> ) besagt, dass dies ein JPEG-Bild ist.  Das SFX-Skript lautet wie folgt: <br><br><img src="https://habrastorage.org/webt/i7/tg/nz/i7tgnzif_wi8kcy7g3liki3la4e.png"><br>  <i>Abbildung 9. SFX-Befehle</i> <br><br>  Die Malware setzt <code>{9ec60ada-a200-4159-b310-8071892ed0c3}.ocx</code> (SHA-1: <code>EFAC23B0E6395B1178BCF7086F72344B24C04DCC</code> ) sowie das Bild <code>2018 thich thong lac.jpg.</code> <br><br>  Das K√∂derbild ist wie folgt: <br><br><img src="https://habrastorage.org/webt/x2/xh/sn/x2xhsnoscn9jdpm_phc4x5bms4q.jpeg"><br>  <i>Abbildung 10. Das K√∂derbild</i> <br><br>  M√∂glicherweise haben Sie bemerkt, dass die ersten beiden Zeilen im SFX-Skript die OSX-Datei zweimal aufrufen, dies ist jedoch kein Fehler. <br><br><h4>  {9ec60ada-a200-4159-b310-8071892ed0c3} .ocx (ShLd.dll) </h4><br>  Der Ablauf der OSX-Dateisteuerung ist anderen OceanLotus-Komponenten sehr √§hnlich - es gibt viele Sequenzen von <code>JZ/JNZ</code> und <code>PUSH/RET</code> Befehlen, die sich mit Junk-Code abwechseln. <br><br><img src="https://habrastorage.org/webt/hs/1j/yd/hs1jydni8wxcqylyvtvimc7_ckm.png"><br>  <i>Abbildung 11. Verschleierter Code</i> <br><br>  Nach dem Filtern des Junk-Codes sieht der von <code>DllRegisterServer</code> aufgerufene <code>DllRegisterServer</code> Export <code>regsvr32.exe</code> aus: <br><br><img src="https://habrastorage.org/webt/qh/r3/ws/qhr3ws_knbm_pewxrzsqhrpzggi.png"><br>  <i>Abbildung 12. Grundlegender Installationscode</i> <br><br>  Tats√§chlich legt <code>DllRegisterServer</code> Export beim ersten <code>DllRegisterServer</code> den Registrierungswert <code>HKCU\SOFTWARE\Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model</code> f√ºr den verschl√ºsselten Offset in der DLL ( <code>0x10001DE0</code> ) fest. <br><br>  Wenn eine Funktion ein zweites Mal aufgerufen wird, liest sie denselben Wert und wird an dieser Adresse ausgef√ºhrt.  Von hier aus wird eine Ressource gelesen und ausgef√ºhrt und viele Aktionen im RAM ausgef√ºhrt. <br><br>  Der Shellcode ist derselbe PE-Loader, der in fr√ºheren OceanLotus-Kampagnen verwendet wurde.  Es kann mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserem Skript</a> emuliert werden.  Infolgedessen gibt er <code>db293b825dcc419ba7dc2c49fa2757ee.dll</code> , l√§dt es in den Speicher und f√ºhrt <code>DllEntry</code> . <br><br>  Die DLL extrahiert den Inhalt ihrer Ressource, entschl√ºsselt (AES-256-CBC) und entpackt sie (LZMA).  Die Ressource hat ein bestimmtes Format, das leicht zu dekompilieren ist. <br><br><img src="https://habrastorage.org/webt/ge/l4/ss/gel4ssv32blxwcjjlxkc57g0vie.png"><br>  <i>Abbildung 13. Konfigurationsstruktur des Installationsprogramms (KaitaiStruct Visualizer)</i> <br><br>  Die Konfiguration wird explizit festgelegt. Abh√§ngig von der Berechtigungsstufe werden Bin√§rdaten in <code>%appdata%\Intel\logs\BackgroundUploadTask.cpl</code> oder <code>%windir%\System32\BackgroundUploadTask.cpl</code> (oder <code>SysWOW64</code> f√ºr 64-Bit-Systeme) geschrieben. <br><br>  Die Persistenz wird dann sichergestellt, indem eine Aufgabe mit dem Namen <code>BackgroundUploadTask[junk].job</code> , wobei <code>[junk]</code> eine Menge von Bytes <code>0x9D</code> und <code>0xA0</code> . <br><br>  Der Anwendungsname der Aufgabe lautet <code>%windir%\System32\control.exe</code> , und der Parameterwert ist der Pfad zur entladenen Bin√§rdatei.  Die versteckte Aufgabe wird jeden Tag ausgef√ºhrt. <br><br>  Strukturell ist die CPL-Datei eine DLL mit dem internen Namen <code>ac8e06de0a6c4483af9837d96504127e.dll</code> , die die <code>CPlApplet</code> Funktion exportiert.  Diese Datei entschl√ºsselt ihre einzige Ressource <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> , l√§dt dann diese DLL und ruft ihren einzigen <code>DllEntry</code> Export auf. <br><br><h4>  Backdoor-Konfigurationsdatei </h4><br>  Die Backdoor-Konfiguration ist verschl√ºsselt und in ihre Ressourcen eingebettet.  Die Struktur der Konfigurationsdatei ist der vorherigen sehr √§hnlich. <br><br><img src="https://habrastorage.org/webt/as/2f/c8/as2fc8ivbc6_bku2pjs5h-6_qtw.png"><br>  <i>Abbildung 14. Backdoor-Konfigurationsstruktur (KaitaiStruct Visualizer)</i> <br><br>  Trotz der √§hnlichen Struktur wurden die Werte vieler Felder im Vergleich zu den in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserem alten Bericht</a> angegebenen Daten aktualisiert. <br><br>  Das erste Element des bin√§ren Arrays enth√§lt die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von Tencent identifizierte</a> DLL ( <code>HttpProv.dll</code> MD5: <code>2559738D1BD4A999126F900C7357B759</code> ).  Da der Exportname jedoch aus der Bin√§rdatei entfernt wurde, stimmen die Hashes nicht √ºberein. <br><br><h3>  Zus√§tzliche Forschung </h3><br>  Beim Sammeln von Proben haben wir auf einige Merkmale hingewiesen.  Die soeben beschriebene Stichprobe erschien um Juli 2018 und andere m√∂gen sie erst k√ºrzlich Mitte Januar - Anfang Februar 2019.  Ein SFX-Archiv wurde als Infektionsvektor verwendet, wobei ein legitimes K√∂derdokument und eine sch√§dliche OSX-Datei ausgegeben wurden. <br><br>  Obwohl OceanLotus gef√§lschte Zeitstempel verwendet, haben wir festgestellt, dass die Zeitstempel von SFX- und OCX-Dateien immer gleich sind ( <code>0x57B0C36A</code> (14.08.2016 um 19:15 Uhr UTC) und <code>0x498BE80F</code> (02/06/2009 um 7:34 Uhr UTC) ) jeweils).  Dies weist wahrscheinlich darauf hin, dass die Autoren einen bestimmten ‚ÄûKonstruktor‚Äú haben, der dieselben Vorlagen verwendet und einfach einige Merkmale √§ndert. <br><br>  Unter den Dokumenten, die wir seit Anfang 2018 untersucht haben, gibt es verschiedene Namen, die die L√§nder angeben, die f√ºr den Angriff von Interesse sind: <br><br>  <i>- Die neuen Kontaktinformationen von Cambodia Media (neu) .xls.exe</i> <i><br></i>  <i>- ÊùéÂª∫ È¶ô (‰∏™‰∫∫ ÁÆÄÂéÜ) .exe (gef√§lschtes PDF-Dokument eines Lebenslaufs)</i> <i><br></i>  <i>- Feedback, Rallye in den USA vom 28. bis 29. Juli 2018.exe</i> <br><br>  Seit der Entdeckung der Hintert√ºr <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> und der Ver√∂ffentlichung ihrer Analyse durch mehrere Forscher haben wir einige √Ñnderungen in den Malware-Konfigurationsdaten beobachtet. <br><br>  Zun√§chst begannen die Autoren, Namen aus zus√§tzlichen DLL-DLLs ( <code>DNSprov.dll</code> und zwei Versionen von <code>HttpProv.dll</code> ) zu entfernen.  Dann haben die Bediener das Packen der dritten DLL (der zweiten Version von <code>HttpProv.dll</code> ) eingestellt und nur eine eingebettet. <br><br>  Zweitens wurden viele Backdoor-Konfigurationsfelder ge√§ndert, wahrscheinlich um eine Erkennung zu vermeiden, da viele IoCs verf√ºgbar wurden.  Zu den wichtigen von den Autoren modifizierten Bereichen geh√∂ren: <br><br><ul><li>  AppX-Registrierungsschl√ºssel ge√§ndert (siehe IoCs) </li><li>  Mutex-Codierungszeichenfolge ("def", "abc", "ghi") </li><li>  Portnummer </li></ul><br>  Schlie√ülich werden in allen neu analysierten Versionen neue C &amp; Cs im Abschnitt IoCs aufgef√ºhrt. <br><br><h2>  Schlussfolgerungen </h2><br>  OceanLotus entwickelt sich weiter.  Die Cybergroup konzentriert sich auf die Verfeinerung und Erweiterung von Werkzeugen und K√∂dern.  Autoren maskieren b√∂swillige Nutzlasten mithilfe aufmerksamkeitsstarker Dokumente, die f√ºr mutma√üliche Opfer relevant sind.  Sie entwickeln neue Designs und verwenden auch √∂ffentlich verf√ºgbare Tools wie den Equation Editor Exploit.  Dar√ºber hinaus perfektionieren sie Tools, um die Anzahl der auf den Computern der Opfer verbleibenden Artefakte zu verringern und damit die Wahrscheinlichkeit der Erkennung durch Antivirensoftware zu verringern. <br><br><h2>  Kompromissindikatoren </h2><br>  Kompromissindikatoren sowie MITRE ATT &amp; CK-Attribute sind <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Welivesecurity</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf GitHub</a> verf√ºgbar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446604/">https://habr.com/ru/post/de446604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446588/index.html">√úberpr√ºfen des Roslyn-Quellcodes</a></li>
<li><a href="../de446590/index.html">39 neue Funktionen in Java 12</a></li>
<li><a href="../de446592/index.html">√úberpr√ºfen des Quellcodes von Roslyn</a></li>
<li><a href="../de446598/index.html">Neuerstellen von CRT-Schriftarten</a></li>
<li><a href="../de446602/index.html">Maximaler Gleichstrom durch Feldeffekttransistor</a></li>
<li><a href="../de446606/index.html">√úberpr√ºfen Sie, wie gut Sie in der additiven Technologie sind</a></li>
<li><a href="../de446608/index.html">√úberwindung des dritten Gesetzes der organisatorischen Schwerkraft</a></li>
<li><a href="../de446612/index.html">In dem Moment, als wir anfingen, an Innovation zu glauben</a></li>
<li><a href="../de446614/index.html">Virtuelle Linux-Dateisysteme: Warum werden sie ben√∂tigt und wie funktionieren sie? Teil 1</a></li>
<li><a href="../de446616/index.html">Wie wir Cloud FaaS in Kubernetes gemacht und beim Tinkoff Hackathon gewonnen haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>