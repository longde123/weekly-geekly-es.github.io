<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß£ ü•ô üÖøÔ∏è Bendice a Nouveau, o sobre mi tormento con Nvidia Optimus. Parte 1. La belleza de la documentaci√≥n de Arch ‚§µÔ∏è üíÉüèª üìá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de empezar 
 Antes de comenzar la historia principal, me gustar√≠a aclarar algunos puntos. El art√≠culo est√° dirigido principalmente a los propiet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bendice a Nouveau, o sobre mi tormento con Nvidia Optimus. Parte 1. La belleza de la documentaci√≥n de Arch</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414061/"><h2>  Antes de empezar </h2><br>  Antes de comenzar la historia principal, me gustar√≠a aclarar algunos puntos.  El art√≠culo est√° dirigido principalmente a los propietarios de computadoras port√°tiles con tecnolog√≠a Nvidia Optimus que desean instalar GNU / Linux (en adelante, Linux).  El material tiene como objetivo garantizar que el Asia Central antes mencionado se familiarice con las posibles soluciones al problema y facilitar y acelerar su resoluci√≥n.  Adem√°s, el art√≠culo no es menos <b>motivador</b> y tiene como objetivo comprender una verdad simple para las personas: en Linux, como en la vida, siempre hay una soluci√≥n alternativa, y si te rindes, no ser√° <i>(en la mayor√≠a de los casos)</i> mejor. <br><blockquote>  <b><i>Qui quaerit, reperit</i></b> </blockquote>  <i>- refr√°n latino</i> <br><br><h3>  Pr√≥logo </h3><br>  Por el momento yo era un Linuxoid ordinario.  Prob√© diferentes distribuciones, lentamente aprend√≠ cosas nuevas.  Solo porque estaba interesado.  Como regla general, el "conocimiento" se limitaba a Ubuntu y sus bifurcaciones, as√≠ como a Fedora y un par de distribuciones "f√°ciles de usar".  Pero, como dice otro proverbio latino, omnia fluunt, omnia mutantur, es decir, todo fluye, todo cambia, y est√° claro que esto no podr√≠a continuar para siempre. <br><br><h3>  Todo empez√≥ bien </h3><br>  Cabe se√±alar que no ten√≠a mucho espacio para experimentos: una PC <i>relativamente</i> d√©bil, que apenas consigui√≥ GNOME 3, y un Internet lento, lo que complic√≥ enormemente la situaci√≥n general.  Pero luego m√°s para el ni√±o de 12 a√±os y no era necesario.  Al final, estoy cansado de experimentar, instal√© Windows 10 y olvid√© Linux durante unos a√±os. <br><br>  Pas√≥ el tiempo y, despu√©s de aproximadamente 2 a√±os, me di cuenta de que era hora de actualizar mi <s>musgo de hierro para</s> PC y comenc√© a ahorrar dinero.  Se gan√≥ algo de la venta de sus pertenencias, se dio algo, sus padres arrojaron m√°s de la mitad de la cantidad, incluso tuvo <s>que sacrificarse</s> para vender su Xbox (!) <a name="habracut"></a>  para divertir sus preguntas frecuentes para aumentar sus habilidades de Linux.  Esta vez decid√≠ intentar instalar Arch.  Escuch√© que tiene muy buena documentaci√≥n.  Y √©l comenz√≥. <br><br><h3>  La belleza de la documentaci√≥n del arco </h3><br>  La instalaci√≥n fue r√°pida y <i>relativamente</i> indolora.  De nuevo, gracias a la documentaci√≥n.  Despu√©s de instalar el sistema y el DE representado por KDE Plasma, intent√© conectar la computadora port√°til a mi monitor externo, porque el monitor tiene una diagonal de 24 'y la pantalla de la computadora port√°til solo 15.6'.  No pas√≥ nada, no hab√≠a se√±al en el monitor.  Como siempre, comenc√© a buscar en Google.  Y despu√©s de 30 minutos de b√∫squeda, descubr√≠ que el problema era con la tecnolog√≠a Nvidia Optimus. <br><br><h4>  Un poco sobre Nvidia Optimus </h4><br>  Nvidia es una buena compa√±√≠a.  A lo largo de sus 25 a√±os de historia, han implementado muchas soluciones <i>relativamente</i> buenas.  Nvidia Optimus es uno de esos.  El tema es una tecnolog√≠a h√≠brida para garantizar el correcto funcionamiento de dos tarjetas gr√°ficas (generalmente potentes gr√°ficos Nvidia e Intel integrado) en las computadoras port√°tiles.  Si <s>funciona en Windows</s> correctamente configurado, ayuda a ahorrar energ√≠a y recursos de la computadora port√°til.  Todo esto es excelente, pero lo que me impuls√≥ a escribir esta obra fue que esta hermosa tecnolog√≠a en Linux, seg√∫n los desarrolladores, solo funciona <i>parcialmente</i> y, en mi opini√≥n, toma mucho, muchos nervios, tiempo y esfuerzo configurarla. <br><br><h3>  La belleza de la documentaci√≥n de Arch (continuaci√≥n) </h3><br>  Despu√©s de descubrir la verdadera ra√≠z del problema, al principio me alegr√© de haber determinado "d√≥nde est√° enterrado el perro" (solo la tarjeta Nvidia ten√≠a una salida HDMI), y mi primer paso fue leer la documentaci√≥n oficial de Arch.  Su esencia era usar Xorg.conf y .xinitrc para forzar a X a usar solo la tarjeta Nvidia.  Despu√©s de completar estos pasos y reiniciar ... apareci√≥ una pantalla en negro.  La documentaci√≥n dice que en este caso, es necesario verificar si hay s√≠mbolos en .xinitrc, y si no hay ninguno, use la "Configuraci√≥n alternativa", que oblig√≥ a X a usar solo una tarjeta Intel.  Esto no me conven√≠a, ya que la tarjeta Intel ya se usaba por defecto y esta opci√≥n no me conven√≠a.  Tambi√©n hab√≠a opciones para varios DM.  Tampoco encajaban, ya que ninguno de ellos pod√≠a iniciar el servidor X por varias razones. <br>  Describir cada uno de ellos por separado ser√≠a un ejercicio muy largo y sin sentido. <br><br><h3>  Qui quaerit, reperit </h3><br>  Esta expresi√≥n traducida del lat√≠n significa "quien busca, encuentra".  No fue en vano que lo coloqu√© al principio, porque en cuanto a m√≠, esta expresi√≥n se convertir√° en la moraleja ideal para este art√≠culo. <br><br>  Estaba desesperado  Durante dos d√≠as intent√© en vano encontrar una soluci√≥n, busqu√© en foros extranjeros (solo en ellos, ya que en el LOR ortodoxo, la respuesta fue esta: no puedes iniciar X a trav√©s de Nvidia de ninguna manera. Es imposible, reconciliarte).  Pero a√∫n as√≠, en una ma√±ana nublada del tercer d√≠a de b√∫squedas, me encontr√© con un hilo (enlace en el s√≥tano) en el foro de desarrollo de Nvidia, en el que se describ√≠a c√≥mo se implementa Nvidia Optimus en Arch en las computadoras port√°tiles de Dell.  Inmediatamente me di cuenta: ¬°estoy salvado!  Siguiendo los pasos, reinici√© y ... una pantalla en negro.  Por supuesto, estaba molesto, pero luego record√©: no me registr√© en la l√≠nea .xinitrc para ejecutar DE.  Despu√©s de escribir exec startkde, reinici√© nuevamente y funcion√≥.  X se inici√≥ a trav√©s de Nvidia.  Me llev√≥ cuatro largos d√≠as instalar y configurar Arch, ¬°pero lo hice! <br><br><h3>  Debriefing </h3><br>  Ahora analicemos las instrucciones del hilo anterior.  Comencemos: <br><br>  Primero, debe habilitar el soporte KMS (Configuraci√≥n de modo de n√∫cleo, el m√©todo de configuraci√≥n de resoluci√≥n directamente en el n√∫cleo) agregando a los par√°metros del n√∫cleo (archivo / etc / default / grub) en la l√≠nea GRUB_CMDLINE_LINUX_DEFAULT = par√°metro <br><br><pre><code class="bash hljs">nvidia-drm.modeset=1</code> </pre> <br>  Luego creamos un script para el DM (administrador de inicio de sesi√≥n).  Considere la opci√≥n con LightDM.  Creamos el script /etc/lightdm/display_setup.sh con los siguientes contenidos: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh xrandr --setprovideroutputsource modesetting NVIDIA-0 xrandr --auto</span></span></code> </pre> <br>  Con este script, especificamos el proveedor y establecemos la resoluci√≥n de pantalla m√°xima posible. <br><br>  Hagamos que el script creado sea ejecutable: <br><br><pre> <code class="bash hljs">chmod +x /etc/lightdm/display_setup.sh</code> </pre> <br>  Deje que LightDM ejecute el script anterior al inicio.  Primero, edite /etc/lightdm/lightdm.conf: <br><br><pre> <code class="bash hljs">nano /etc/lightdm/lightdm.conf</code> </pre> <br>  Ingrese el par√°metro <br><br><pre> <code class="bash hljs">display-setup-script=/etc/lightdm/display_setup.sh</code> </pre> <br>  Puede ver las instrucciones para SDDM en el hilo que ya he mencionado, enlaces en el s√≥tano. <br><br>  Ahora necesitamos actualizar el microc√≥digo de la CPU (m√°s sobre el microc√≥digo de los enlaces en el s√≥tano): <br><br><pre> <code class="bash hljs">sudo pacman -S intel-ucode</code> </pre> <br>  Despu√©s de actualizar el microc√≥digo, instale varios paquetes de Nvidia: <br><br><pre> <code class="bash hljs">sudo pacman -S lib32-mesa-demos mesa-demos libva-vdpau-driver nvidia nvidia-libgl lib32-nvidia-utils nvidia-settings lib32-opencl-nvidia</code> </pre> <br><blockquote>  <b>Nota:</b> Algunos de los paquetes pueden no estar disponibles.  En este caso, instale todo por separado.  Omita los paquetes que no estar√°n disponibles. </blockquote>  Encienda el demonio nvidia.persistenced, que es responsable de la persistencia (lea m√°s sobre esto en el enlace del s√≥tano) del controlador Nvidia: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> nvidia-persistenced.service</code> </pre> <br>  Configurar autom√°ticamente GRUB: <br><br><pre> <code class="bash hljs">sudo grub-mkconfig -o /boot/grub/grub.cfg</code> </pre> <br>  Cree un disco RAM de arranque: <br><br><pre> <code class="bash hljs">mkinitcpio -p linux</code> </pre> <br>  Compruebe .xinitrc: <br><br><pre> <code class="bash hljs">nano ~/.xinitrc</code> </pre> <br>  Si no se ingres√≥, ingrese <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> gnome-session</code> </pre> <br>  para GNOME y <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> startkde</code> </pre> <br>  para KDE Plasma. <br><br>  Reiniciar: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Despu√©s de reiniciar la computadora port√°til, inicie sesi√≥n con su cuenta y disfrute del mundo de Arch. <br><br><h3>  Sobre Bumblebee y PRIME </h3><br>  Es posible que haya notado que no dije nada sobre las "muletas" que est√°n destinadas a garantizar el <u>correcto</u> funcionamiento de Nvidia Optimus en Linux: Bumblebee y PRIME. <br>  Adem√°s, solo recib√≠ una tarjeta Nvidia con un controlador propietario, Nouveau no funcion√≥ (por eso el art√≠culo se llama "Bless Nouveau". <br>  En cuanto a mi experiencia personal con ellos, es peque√±o y deplorable: ambas muletas en blanco no vieron mi tarjeta gr√°fica Nvidia.  Si est√° interesado en ellos, en el s√≥tano encontrar√° enlaces a materiales sobre ellos. <br><br><h2>  Ep√≠logo </h2><br>  Si lees el art√≠culo completo, entonces eres un h√©roe <i>(bueno, o un moderador)</i> . <br><br>  Al escribir un art√≠culo, trat√© de diluirlo <i>con</i> bromas <i>relativamente</i> divertidas para justificar de alguna manera la ausencia de im√°genes en √©l.  Espero que hayas llegado a Zen despu√©s de leer. <br><br><h3>  Lista de fuentes </h3><br>  Sobre el microc√≥digo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en.wikipedia.org/wiki/</a> Microc√≥digo <br>  Acerca de Bumblebee: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki.archlinux.org/index.php/Bumblebee_</a> (ruso) <br>  Acerca de PRIME: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki.archlinux.org/index.php/PRIME</a> <br>  Tema: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">devtalk.nvidia.com/default/topic/1027679/linux/optimus-support-for-arch-linux-for-dell-i7559-dual-graphics-intel-nvidia-gtx-960m-laptop-/2</a> <br>  Sobre la persistencia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en.wikipedia.org/wiki/Persistency</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414061/">https://habr.com/ru/post/es414061/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414049/index.html">Los principales juegos de E3 2018: Fallout 76, Metro Exodus, Doom Eternal y otros</a></li>
<li><a href="../es414053/index.html">5 conceptos err√≥neos sobre GDPR</a></li>
<li><a href="../es414055/index.html">Trans-PRK: uno de los est√°ndares de correcci√≥n de la visi√≥n</a></li>
<li><a href="../es414057/index.html">Enfriamiento del centro de datos: una canci√≥n de hielo y fuego</a></li>
<li><a href="../es414059/index.html">El porcentaje de matrimonio entre l√°mparas LED. Una selecci√≥n de 27,000 l√°mparas vendidas</a></li>
<li><a href="../es414063/index.html">Comandante de la ma√±ana</a></li>
<li><a href="../es414065/index.html">El mejor tel√©fono inteligente chino "hasta 10 mil rublos" con AliExpress vs Xiaomi Redmi 5</a></li>
<li><a href="../es414067/index.html">Inicie el retargeting m√≥vil con Ajustar: configuraciones, informes y enlaces</a></li>
<li><a href="../es414069/index.html">Restricciones de zumbido durante la Copa Mundial de la FIFA 2018 (FIFA 2018)</a></li>
<li><a href="../es414071/index.html">Desde el monitoreo hasta la gesti√≥n de incidentes. Informe de DevOps Moscow Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>