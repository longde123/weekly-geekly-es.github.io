<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚úàÔ∏è üõ©Ô∏è üë®üèª‚Äç‚öñÔ∏è Exp√©rience de l'utilisation de redux sans r√©ducteurs ‚¨úÔ∏è üë®üèæ‚Äç‚öñÔ∏è üôÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je voudrais partager mon exp√©rience de l'utilisation de redux dans une application d'entreprise. En parlant de logiciels d'entreprise dans le cadre de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exp√©rience de l'utilisation de redux sans r√©ducteurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424613/"><img src="https://habrastorage.org/webt/nn/at/cx/nnatcxzguqw8cg7b1nx315f3c8y.jpeg"><br><br>  Je voudrais partager mon exp√©rience de l'utilisation de redux dans une application d'entreprise.  En parlant de logiciels d'entreprise dans le cadre de l'article, je me concentre sur les fonctionnalit√©s suivantes: <br><br><ul><li>  Tout d'abord, c'est le volume de fonctionnalit√©s.  Ce sont des syst√®mes d√©velopp√©s depuis de nombreuses ann√©es, continuant √† construire de nouveaux modules, ou compliquant ind√©finiment ce qui existe d√©j√†. </li><li>  Deuxi√®mement, souvent, si nous ne consid√©rons pas un √©cran de pr√©sentation, mais le lieu de travail de quelqu'un, un grand nombre de composants attach√©s peuvent √™tre mont√©s sur une seule page. </li><li>  Troisi√®mement, la complexit√© de la logique m√©tier.  Si nous voulons obtenir une application r√©active et agr√©able √† utiliser, une partie importante de la logique devra √™tre faite par le client. </li></ul><br>  Les deux premiers points imposent des restrictions sur la marge de productivit√©.  Plus d'informations √† ce sujet plus tard.  Et maintenant, je propose de discuter des probl√®mes que vous rencontrez en utilisant le redux-workflow classique, en d√©veloppant quelque chose de plus compliqu√© que la liste TODO. <br><a name="habracut"></a><br><h3>  Redux classique </h3><br>  Pour un exemple, consid√©rons l'application suivante: <br><br><img src="https://image.ibb.co/ej3Pwp/1.png" alt="image"><br><br>  L'utilisateur conduit une rime - obtient une √©valuation de son talent.  Le contr√¥le avec l'introduction du verset est contr√¥l√© et le recalcul de l'√©valuation a lieu pour chaque changement.  Il y a aussi un bouton par lequel le texte avec le r√©sultat est r√©initialis√©, et un message est affich√© √† l'utilisateur qu'il peut recommencer depuis le d√©but.  Code source dans ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fil</a> . <br><br>  Organisation du code: <br><br><img src="https://image.ibb.co/dyXv2U/2.png" alt="image"><br><br>  Il y a deux modules.  Plus pr√©cis√©ment, un module est directement poemScoring.  Et la racine de l'application avec des fonctions communes √† l'ensemble du syst√®me est l'application.  L√†, nous avons des informations sur l'utilisateur, affichant des messages √† l'utilisateur.  Chaque module a ses propres r√©ducteurs, actions, contr√¥les, etc. Au fur et √† mesure que l'application se d√©veloppe, les nouveaux modules se multiplient. <br><br>  Une cascade de r√©ducteurs, utilisant redux-immuable, forme l'√©tat enti√®rement immuable suivant: <br><br><img src="https://image.ibb.co/nFrYp9/3.png" alt="image"><br><br>  Comment √ßa marche: <br><br>  1. Contr√¥lez l'action-cr√©ateur d'action: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> at <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/actionTypes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Les constantes des types d'actions sont d√©plac√©es vers un fichier distinct.  Premi√®rement, nous sommes tellement √† l'abri des fautes de frappe.  Deuxi√®mement, l'intellisense sera √† notre disposition. <br><br>  2. Ensuite, il s'agit du r√©ducteur. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logic <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../logic/poem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemScoringReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Immutable.Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logic.onType(state, action.payload); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br>  Le traitement logique est d√©plac√© vers une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonction de cas</a> distinct.  Sinon, le code r√©ducteur deviendra rapidement illisible. <br><br>  3. La logique du traitement des clics en utilisant l'analyse lexicale et l'intelligence artificielle: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, text) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(text)); }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; } };</code> </pre> <br>  Dans le cas du bouton ¬´Nouveau po√®me¬ª, nous avons le cr√©ateur d'action suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newPoem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: appAt.SHOW_MESSAGE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'You can begin a new poem now!'</span></span> }); }; }</code> </pre> <br>  Tout d'abord, envoyez la m√™me action qui r√©initialise notre texte et marque.  Ensuite, envoyez l'action, qui sera intercept√©e par un autre r√©ducteur et afficher un message √† l'utilisateur. <br>  Tout est beau.  Cr√©ons nous-m√™mes des probl√®mes: <br><br><h3>  Les probl√®mes: </h3><br>  Nous avons post√© notre candidature.  Mais nos utilisateurs, voyant qu'on leur a demand√© d'√©crire de la po√©sie, ont naturellement commenc√© √† publier leur travail, ce qui est incompatible avec les normes d'entreprise du langage po√©tique.  En d'autres termes, nous devons mod√©rer les mots obsc√®nes. <br><br>  Ce que nous ferons: <br><br><ul><li>  dans le texte d'entr√©e, il est n√©cessaire de remplacer tous les mots non cultiv√©s par <b>* censur√© *</b> </li><li>  en outre, si l'utilisateur a prononc√© un gros mot, vous devez l'avertir par un message qu'il fait mal. </li></ul><br>  Bon.  Il suffit d'analyser le texte, en plus de calculer le score, pour remplacer les mauvais mots.  Pas de probl√®me.  Et aussi, pour informer l'utilisateur, vous avez besoin d'une liste de ce que nous avons supprim√©.  Le code source est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  On refait la fonction de la logique pour qu'elle, en plus du nouvel √©tat, renvoie les informations n√©cessaires au message √† l'utilisateur (mots remplac√©s): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, reductedText) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(reductedText)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { newState, censoredWords }; }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; }, redactText(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">reductedText</span></span>:text }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> censoredWords = []; obscenseWords.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">badWord</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.reductedText.indexOf(badWord) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.reductedText = result.reductedText.replace(badWord, <span class="hljs-string"><span class="hljs-string">'*censored*'</span></span>); censoredWords.push(badWord); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (censoredWords.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.censoredWords = censoredWords.join(<span class="hljs-string"><span class="hljs-string">' ,'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre> <br>  Appliquons-le maintenant.  Mais comment?  Dans le r√©ducteur, cela n'a plus de sens pour nous de l'appeler, car nous mettrons le texte et l'√©valuation en l'√©tat, mais que devons-nous faire du message?  Afin d'envoyer un message, dans tous les cas, nous devrons envoyer l'action correspondante.  Nous finalisons donc l'action-cr√©ateur. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalState = getState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scoringStateOld = globalState.get(<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        const { newState, censoredWords } = logic.onType(scoringStateOld, text); dispatch({ //        type: at.POEM_TYPE, payload: newState }); if (censoredWords) { //    ,    const userName = globalState.getIn(['app', 'account', 'name']); const message = `${userName}, avoid of using word ${censoredWords}, please!`; dispatch({ type: appAt.SHOW_MESSAGE, payload: message }); } }; }</span></span></code> </pre> <br>  Il est √©galement n√©cessaire de modifier le r√©ducteur, car il n'appelle plus la fonction logique: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state;</code> </pre> <br>  Que s'est-il pass√©: <br><br><img src="https://image.ibb.co/nkmzU9/4.png" alt="image"><br><br>  <b>Et maintenant, la question est.</b>  Pourquoi avons-nous besoin d'un r√©ducteur qui, pour la plupart, retournera simplement la charge utile au lieu d'un nouvel √©tat?  Lorsque d'autres actions apparaissent qui traitent la logique de l'action, sera-t-il n√©cessaire d'enregistrer un nouveau type d'action?  Ou peut-√™tre cr√©er un SET_STATE commun?  Probablement pas, car alors, l'inspecteur sera un g√¢chis.  Nous allons donc produire le m√™me type de bo√Ætier? <br><br>  L'essence du probl√®me est la suivante.  Si le traitement de la logique implique de travailler avec un morceau d'√©tat, dont plusieurs r√©ducteurs sont responsables, alors vous devez √©crire toutes sortes de perversions.  Par exemple, les r√©sultats interm√©diaires des fonctions de cas, qui doivent ensuite √™tre dispers√©es sur diff√©rents r√©ducteurs √† l'aide de plusieurs actions. <br><br>  Une situation similaire, si la fonction case a besoin de plus d'informations que ce qui se trouve dans votre r√©ducteur, vous devez faire son appel √† l'action, o√π il y a acc√®s √† l'√©tat global, puis envoyer le nouvel √©tat en tant que charge utile.  Un r√©ducteur devra √™tre divis√© dans tous les cas, s'il y a beaucoup de logique dans le module.  Et cela cr√©e un grand inconv√©nient. <br><br>  Regardons la situation d'un c√¥t√©.  Dans notre action, nous obtenons un morceau d'√©tat du global.  Ceci est n√©cessaire pour le <i>muter</i> ( <i>globalState.get ('poemScoring');</i> ).  Il s'av√®re que nous savons d√©j√† en action avec quel √©tat du travail se d√©roule.  Nous avons un nouvel √©tat.  Nous savons o√π le mettre.  Mais au lieu de le mettre dans un global, nous l'ex√©cutons avec une sorte de constante de texte tout au long de la cascade de r√©ducteurs afin qu'il passe par chaque commutateur et se substitue une fois.  Moi d√®s la r√©alisation de cela, les rides.  Je comprends que cela est fait pour faciliter le d√©veloppement et r√©duire la connectivit√©.  Mais dans notre cas, il n'a plus de r√¥le. <br><br>  <b>Maintenant, je vais √©num√©rer tous les points que je n'aime pas dans l'impl√©mentation actuelle, si elle doit √™tre mise √† l'√©chelle en profondeur et en profondeur pour une dur√©e illimit√©e</b> : <br><br><ol><li>  Inconv√©nient important lorsque vous travaillez avec un √©tat ext√©rieur au r√©ducteur. </li><li>  Le probl√®me de la s√©paration des codes.  Chaque fois que nous envoyons une action, elle passe par chaque r√©ducteur, passe par chaque cas.  Il est pratique de ne pas d√©ranger lorsque vous avez une petite application.  Mais, si vous avez un monstre qui a √©t√© construit pendant plusieurs ann√©es avec des dizaines de r√©ducteurs et des centaines de cas, alors je commence √† r√©fl√©chir √† la faisabilit√© d'une telle approche.  Peut-√™tre, m√™me avec des milliers de cas, cela n'aura pas d'impact significatif sur les performances.  Mais, sachant qu'en imprimant du texte, chaque presse provoquera un passage √† travers des centaines de cas, je ne peux pas le laisser tel quel.  Tout, le moindre d√©calage, multipli√© par l'infini, tend vers l'infini.  En d'autres termes, si vous n'y pensez pas, t√¥t ou tard, des probl√®mes surgiront. <br><br>  Quelles sont les options? <br><br>  <b>a.</b>  Applications isol√©es avec leurs propres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fournisseurs</a> .  Dans chaque module (sous-application), vous devrez dupliquer les parties g√©n√©rales de l'√©tat (compte, messages, etc.). <br><br>  <b>b.</b>  Utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des r√©ducteurs asynchrones</a> enfichables.  Ce n'est pas recommand√© par Dan lui-m√™me. <br><br>  <b>c.</b>  Utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des filtres d'action</a> dans les r√©ducteurs.  En d'autres termes, chaque envoi doit √™tre accompagn√© d'informations sur le module auquel il est envoy√©.  Et dans les r√©ducteurs de racine des modules, √©crivez les conditions appropri√©es.  J'ai essay√©.  Il n'y a pas eu autant d'erreurs involontaires ni avant ni apr√®s.  Il y a une confusion constante sur la destination de l'action. </li><li>  Chaque fois qu'une action est envoy√©e, il n'y a pas seulement une ex√©cution pour chaque r√©ducteur, mais √©galement la collecte de l'√©tat inverse.  Peu importe si l'√©tat a chang√© dans le r√©ducteur - il sera remplac√© dans combineReducers. </li><li>  Chaque r√©partition oblige mapStateToProps √† √™tre trait√© pour chaque composant attach√© mont√© sur la page.  Si nous divisons les r√©ducteurs, nous devons diviser les r√©partitions.  Est-il essentiel que nous ayons un bouton qui √©crase le texte et affiche le message avec diff√©rentes d√©p√™ches?  Probablement pas.  Mais j'ai une exp√©rience en optimisation, lorsque la r√©duction du nombre d'envois de 15 √† 3 a permis d'augmenter consid√©rablement la r√©activit√© du syst√®me, avec la m√™me quantit√© de logique m√©tier trait√©e.  Je sais qu'il existe des biblioth√®ques qui peuvent combiner plusieurs d√©p√™ches en un seul lot, mais c'est un probl√®me avec l'enqu√™te √† l'aide de b√©quilles. </li><li>  Lors du broyage de d√©p√™ches, il est parfois tr√®s difficile de voir ce qui se passe.  Il n'y a pas un seul endroit, tout est dispers√© sur diff√©rents fichiers.  Il est n√©cessaire de rechercher o√π le traitement est mis en ≈ìuvre en recherchant des constantes dans tous les codes source. </li><li>  Dans le code ci-dessus, les composants et les actions acc√®dent directement √† l'√©tat global: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userName = globalState.getIn([<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>]); ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = state.getIn([<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>, <span class="hljs-string"><span class="hljs-string">'poemText'</span></span>]);</code> </pre> <br>  Ce n'est pas bon pour plusieurs raisons: <br><br>  <b>a.</b>  Les modules devraient id√©alement √™tre isol√©s.  Ils n'ont pas besoin de savoir o√π dans l'√âtat o√π ils vivent. <br><br>  <b>b.</b>  La mention des m√™mes chemins √† diff√©rents endroits est souvent lourde non seulement d'erreurs / fautes de frappe, mais rend √©galement la refactorisation extr√™mement difficile en cas de changement dans la configuration d'un √©tat global, ou de changement dans la fa√ßon dont il est stock√©. <br></li><li>  De plus en plus, en √©crivant une nouvelle action, j'ai eu l'impression que j'√©crivais du code pour le plaisir.  Supposons que nous voulions ajouter une case √† cocher √† la page et refl√©ter son √©tat bool√©en dans l'histoire.  Si nous voulons une organisation uniforme de l'action / des r√©ducteurs, alors nous devons: <br><br>  - Enregistrer une constante de type action <br>  - √âcrire un crat√®re d'action <br>  - Dans le contr√¥le, importez-le et enregistrez-le dans mapDispatchToProps <br>  - Inscrivez-vous dans PropTypes <br>  - Cr√©ez un handleCheckBoxClick dans le contr√¥le et sp√©cifiez-le dans la case √† cocher <br>  - Ajouter un interrupteur dans le r√©ducteur avec un appel de fonction cas <br>  - √âcrire une fonction de cas dans la logique <br><br>  Pour un seul ch√®que de boxe! </li><li>  L'√©tat g√©n√©r√© avec combineReducers est statique.  Peu importe que vous ayez d√©j√† entr√© ou non le module B, cette pi√®ce sera dans l'histoire.  Vide, mais le sera.  Il n'est pas pratique d'utiliser l'inspecteur lorsqu'il y a beaucoup de n≈ìuds vides inutilis√©s dans le steet. </li></ol><br><h3>  Comment nous essayons de r√©soudre certains des probl√®mes d√©crits ci-dessus </h3><br>  Donc, nous avons eu des r√©ducteurs stupides, et dans l'action-craters / logic nous √©crivons des morceaux de code pour travailler avec des structures immuables profond√©ment int√©gr√©es.  Pour m'en d√©barrasser, j'utilise le m√©canisme des s√©lecteurs hi√©rarchiques, qui permettent non seulement d'acc√©der √† l'√©tat souhait√©, mais aussi de le remplacer (setIn pratique).  Je l'ai publi√© dans le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">immutable-selectors</a> . <br><br>  <b>Regardons notre exemple comment cela fonctionne</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> ): <br>  Dans le module poemScoring, nous d√©crivons l'objet s√©lecteurs.  Nous d√©crivons ces champs de l'√©tat auquel nous voulons avoir un acc√®s direct en lecture / √©criture.  L'imbrication et les param√®tres d'acc√®s aux √©l√©ments des collections sont autoris√©s.  Il n'est pas n√©cessaire de d√©crire tous les champs possibles dans notre article. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> extendSelectors <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable-selectors'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectors = { <span class="hljs-attr"><span class="hljs-attr">poemText</span></span>:{}, <span class="hljs-attr"><span class="hljs-attr">score</span></span>:{} }; extendSelectors(selectors, [ <span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> selectors;</code> </pre> <br>  De plus, la m√©thode extendSelectors transforme chaque champ de notre objet en fonction de s√©lecteur.  Le deuxi√®me param√®tre indique le chemin d'acc√®s √† la partie de l'√©tat contr√¥l√©e par le s√©lecteur.  Nous ne cr√©ons pas un nouvel objet, mais changeons l'objet actuel.  Cela nous donne un bonus sous forme d'intelligence de travail: <br><br><img src="https://image.ibb.co/iYdDp9/5.png" alt="image"><br><br>  Quel est notre objet - un s√©lecteur apr√®s son expansion: <br><br><img src="https://image.ibb.co/iAGcGp/5_5.png" alt="image"><br><br>  La fonction <i>selectors.poemText (√©tat)</i> ex√©cute simplement <i>state.getIn (['poemScoring', 'poemText'])</i> . <br><br>  Fonction <i>root (√©tat)</i> - obtient 'poemScoring'. <br><br>  Chaque s√©lecteur a sa propre fonction de <i>remplacement (globalState, newPart)</i> , qui, via setIn, renvoie un nouvel √©tat global avec la pi√®ce correspondante remplac√©e. <br><br>  De plus, un objet <i>plat</i> est ajout√© auquel toutes les touches de s√©lection uniques sont dupliqu√©es.  Autrement dit, si nous utilisons un √©tat profond de la forme <br><br><pre> <code class="javascript hljs">selectors = { <span class="hljs-attr"><span class="hljs-attr">dive</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">in</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">to</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">the</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">deep</span></span>:{} } } } }}</code> </pre> <br>  Vous pouvez approfondir en tant que <i>selectors.dive.in.to the.deep (√©tat)</i> ou en tant que <i>selectors.flat.deep (√©tat)</i> . <br><br>  Allez-y.  Nous devons mettre √† jour l'acquisition des donn√©es dans les contr√¥les: <br><br>  Po√®me: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">text</span></span>:selectors.poemText(state) || <span class="hljs-string"><span class="hljs-string">''</span></span> }; }</code> </pre> <br><br>  Score: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = selectors.score(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { score }; }</code> </pre> <br>  Ensuite, changez le r√©ducteur de racine: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> initialState <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./initialState'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.setState) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.setState; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-comment"><span class="hljs-comment">// return combinedReducers(state, action); // } } export default setStateReducer;</span></span></code> </pre> <br>  Si vous le souhaitez, nous pouvons combiner en utilisant combineReducers. <br><br>  Crat√®re d'action, par exemple, poemTextChange: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Poem typing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">setState</span></span>: logic.onType(getState(), text), <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Nous ne pouvons plus utiliser de constantes de type action, car le type est d√©sormais utilis√© uniquement pour la visualisation dans l'inspecteur.  Dans le projet, nous √©crivons des descriptions en texte int√©gral de l'action en russe.  Vous pouvez √©galement vous d√©barrasser de la charge utile, mais j'essaie de l'enregistrer afin que dans l'inspecteur, si n√©cessaire, je comprenne avec quels param√®tres l'action a √©t√© appel√©e. <br><br>  Et, en fait, la logique elle-m√™me: <br><br><pre> <code class="javascript hljs"> onType(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> poemState = selectors.root(gState) || Immutable.Map(); <span class="hljs-comment"><span class="hljs-comment">//     const newPoemState = poemState //  .set('poemText', reductedText) .set('score', this.calcScore(reductedText)); let newGState = selectors.root.replace(gState, newPoemState); //    if (censoredWords) { //  ,    const userName = appSelectors.flat.userName(gState); const messageText = `${userName}, avoid of using word ${censoredWords}, please!`; newGState = message.showMessage(newGState, messageText); } return newGState; },</span></span></code> </pre> <br>  Dans le m√™me temps, <i>message.showMessage est</i> import√© de la logique du module voisin, qui d√©crit ses s√©lecteurs: <br><br><pre> <code class="javascript hljs"> showMessage(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> selectors.message.text.replace(gState, text); }.</code> </pre> <br>  Ce qui s'av√®re: <br><br><img src="https://image.ibb.co/hviDp9/6.png" alt="image"><br><br>  Notez que nous avons eu un envoi, les donn√©es de deux modules ont chang√©. <br>  Tout cela nous a permis de nous d√©barrasser des r√©ducteurs et des constantes de type action, ainsi que de r√©soudre ou de contourner la plupart des goulots d'√©tranglement d√©crits ci-dessus. <br><br><h4>  Sinon, comment cela peut-il √™tre appliqu√©? </h4><br>  Cette approche est pratique √† utiliser lorsqu'il est n√©cessaire de s'assurer que vos commandes ou modules fournissent un travail avec diff√©rents √©l√©ments d'√©tat.  Disons qu'un po√®me ne nous suffit pas.  Nous voulons que l'utilisateur puisse composer des po√®mes sur deux onglets diff√©rents dans diff√©rentes disciplines (enfants, romantiques).  Dans ce cas, nous ne pouvons pas importer les s√©lecteurs dans la logique / les commandes, mais les sp√©cifier en tant que param√®tre dans la commande externe: <br><br><pre> <code class="javascript hljs"> &lt;Poem selectors = {selectors.hildPoem}/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Poem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectors</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{selectors.romanticPoem}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Et, en outre, passez ce param√®tre aux crat√®res d'action.  Cela suffit pour faire une combinaison complexe de composants et de logique compl√®tement enferm√©e, ce qui facilite la r√©utilisation. <br><br>  <b>Limitations lors de l'utilisation de s√©lecteurs immuables:</b> <br><br>  Il ne fonctionnera pas pour utiliser la cl√© dans l'√©tat "nom", car pour la fonction parent, il y aura une tentative de remplacer la propri√©t√© r√©serv√©e. <br><br><h3>  Quel est le r√©sultat </h3><br>  En cons√©quence, une approche assez flexible a √©t√© obtenue, les relations de code implicites par les constantes de texte ont √©t√© √©limin√©es, la surcharge a √©t√© r√©duite tout en conservant la commodit√© du d√©veloppement.  Il existe √©galement un inspecteur redux pleinement op√©rationnel avec la possibilit√© de voyager dans le temps.  Je n'ai aucune envie de revenir aux r√©ducteurs standards. <br><br>  En g√©n√©ral, c'est tout.  Merci pour votre temps.  Peut-√™tre que quelqu'un sera int√©ress√© pour l'essayer! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424613/">https://habr.com/ru/post/fr424613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424603/index.html">Le livre ¬´Pourquoi avons-nous tort. Penser les pi√®ges en action. Extraits Partie 1</a></li>
<li><a href="../fr424605/index.html">Fonds Zuckerberg: collaboration + technologie + science ouverte</a></li>
<li><a href="../fr424607/index.html">La mont√©e d'H√©lidon</a></li>
<li><a href="../fr424609/index.html">Comment √©tendre Kubernetes</a></li>
<li><a href="../fr424611/index.html">Comment cr√©er un employ√© √† partir d'un pigiste</a></li>
<li><a href="../fr424615/index.html">Sortie de fonction de courbe pour limiter en douceur les param√®tres, les signaux et pas seulement dans Wolfram Mathematica</a></li>
<li><a href="../fr424621/index.html">Super-h√©ros non-film. Qui et comment prot√®ge le chantier de construction du centre de Lakhta contre les incendies?</a></li>
<li><a href="../fr424623/index.html">Traitons le son sur Go</a></li>
<li><a href="../fr424625/index.html">Fuite de code source des services Web Aeroflot</a></li>
<li><a href="../fr424627/index.html">Modification des caisses enregistreuses. Partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>