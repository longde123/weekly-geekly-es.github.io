<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶í üíπ ü§ñ Um, dois, tr√™s! Chatbot do Planilhas Google usando o exemplo de um jogo PvP para Alice üõåüèΩ üë©üèª‚Äçüç≥ üë©üèø‚Äçü§ù‚Äçüë©üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aparentemente, Alice cativou os usu√°rios com uma s√≠ntese de voz inesperadamente de alta qualidade e um bot de bate-papo. Hoje, espera-se que ela tenha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um, dois, tr√™s! Chatbot do Planilhas Google usando o exemplo de um jogo PvP para Alice</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414213/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/rg/em/jergemafxw-e_63-gibe4edxyie.png"></div><br>  Aparentemente, Alice cativou os usu√°rios com uma s√≠ntese de voz inesperadamente de alta qualidade e um bot de bate-papo.  Hoje, espera-se que ela tenha habilidades √∫teis e jogos interessantes com um back-end que possa levar em considera√ß√£o o contexto do usu√°rio e implementar uma ampla variedade de cen√°rios.  Este artigo discute a cria√ß√£o de uma habilidade baseada no Planilhas Google, uma ferramenta familiar para muitos com grande potencial para pequenos chatbots. <br><br>  Jogar com uma pessoa real pode ser mais interessante do que jogar com um personagem virtual; portanto, como exemplo, desenvolveremos um jogo multiplayer para Alice. <br><a name="habracut"></a><br><h2>  Um!  Di√°logo </h2><br>  O jogo come√ßa com as regras.  Eu vim com estas: cada um dos dois jogadores primeiro coloca um tesouro e uma armadilha atr√°s de tr√™s portas e depois abre qualquer uma das portas do oponente.  Abra o tesouro - pegue as moedas do oponente, abra a armadilha - entregue as moedas para ele.  O n√∫mero de moedas, de 1 a 3, √© determinado pelo pr√≥prio jogador.  Atr√°s da porta restante √© uma caixa de Pandora, abertura que voc√™ pode encontrar / perder uma quantidade aleat√≥ria de moedas.  Voc√™ pode jogar com Alice e contra outros usu√°rios. <br><br>  A interface de Alice √© resolvida na forma de um di√°logo, e toda a intera√ß√£o do jogo deve ser implementada por meio de mensagens.  O processamento de cada mensagem pelo servidor do jogo √© representado pelas seguintes etapas: <br><br><ol><li>  restaurar o contexto do usu√°rio; </li><li>  interpreta√ß√£o de consultas em um contexto restaurado; </li><li>  formar uma mensagem de resposta; </li><li>  Salvando um contexto de usu√°rio alterado. </li></ol><br><h3>  Recupere e salve o contexto do usu√°rio </h3><br>  O contexto do usu√°rio inclui seu estado no jogo, incluindo resultados anteriores, uma etapa dentro do script e o oponente atual, al√©m do nome do usu√°rio e outras informa√ß√µes necess√°rias para a l√≥gica do jogo. <br><br>  Em cada solicita√ß√£o, de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acordo com o protocolo</a> , Alice passa o ID do usu√°rio.  Isso √© suficiente para salvar e posteriormente restaurar seu contexto. <br><br>  Como um data warehouse, use o Planilhas Google.  As vantagens objetivas desta solu√ß√£o incluem uso gratuito, visibilidade e facilidade de uso.  O editor de scripts embutido permite descrever a l√≥gica do jogo no Apps Script (baseado em JavaScript), consultando as tabelas de API e publicando-o como um aplicativo da web. <br><br>  Ap√≥s criar a tabela com os cabe√ßalhos necess√°rios, voc√™ pode acessar o editor de scripts: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/rh/bo/jdrhbosnzge_mq5ms5h0oqnsnqo.png"></div><br>  A l√≥gica do jogo pode ser descrita em um projeto no Apps Script, organizando-o como um conjunto de arquivos gs e continue com a publica√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/w0/kn/nkw0kn0ghmmskohgbtk_nefgc3o.png"></div><br>  Ao publicar, voc√™ deve especificar a disponibilidade do aplicativo para usu√°rios an√¥nimos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g1/sw/fq/g1swfqcp998ufhh96b6lvqb64x0.png"></div><br>  Na sa√≠da, voc√™ obter√° o URL do aplicativo Web publicado.  As fun√ß√µes doGet () e doPost () no script processam solicita√ß√µes dos tipos correspondentes para receber e salvar contextos do usu√°rio. <br><br>  Abaixo est√° um diagrama de como trabalhar com as tabelas de API para manipula√ß√£o de dados: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var sheet = SpreadsheetApp.openById("&lt;id &gt;").getSheetByName("&lt; &gt;"); //  var range = sheet.getRange(&lt; &gt;); //   var values = range.getValues(); //    range.setValues(&lt; &gt;);</span></span></code> </pre> <br><h3>  Interpretando uma solicita√ß√£o em um contexto restaurado </h3><br>  No caso geral, a interpreta√ß√£o correta das consultas de texto requer o uso de algoritmos NLU inteligentes.  E, embora esses algoritmos estejam dispon√≠veis em ferramentas simples, como a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">que descrevi por Aimylogic</a> , nesse caso, decidi abandonar o processamento de linguagem natural em favor da simplicidade. <br><br>  No jogo proposto, a intera√ß√£o do jogador com Alice √© limitada a uma d√∫zia de estados poss√≠veis e pode ser reduzida a um pequeno conjunto de inten√ß√µes.  Para simplificar, sempre ofere√ßo ao jogador tr√™s a√ß√µes poss√≠veis: envie "Um", "Dois" ou "Tr√™s".  Para qualquer outra solicita√ß√£o, Alice pede para esclarecer a a√ß√£o. <br><br>  O cen√°rio, neste caso, se resume ao seguinte c√≥digo do Script de aplicativos: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     switch(user.state){ case "start": //       switch(utterance){ case ‚Äú1Ô∏è‚É£ ‚Äù: case ‚Äú2Ô∏è‚É£ ‚Äù: case ‚Äú3Ô∏è‚É£ ‚Äù: //     default: //     } break; //    default: //      }</span></span></code> </pre><br>  Para o usu√°rio, a intera√ß√£o assim resolvida √© representada como a escolha de uma das tr√™s op√ß√µes, cujo significado est√° claramente definido na resposta de cada Alice.  As op√ß√µes em si s√£o representadas pelos bot√µes "Um", "Dois", "Tr√™s", que aceleram significativamente a jogabilidade. <br><br><h3>  Gera√ß√£o de mensagem de resposta </h3><br>  A resposta de Alice consiste em v√°rias partes, cada uma das quais precisa ser formada, incluindo: <br><br><ul><li>  texto a ser exibido na tela; </li><li>  texto para s√≠ntese de fala; </li><li>  conjunto de bot√µes de dica. </li></ul><br>  Recentemente, formulei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conceito de um di√°logo F√ÅCIL</a> , descrevendo os princ√≠pios do design de uma interface de conversa√ß√£o, inclusive para Alice.  O formato de resposta de Alice permite que esses princ√≠pios sejam implementados. <br><br>  Portanto, a separa√ß√£o do texto exibido e do texto falado permite tornar as respostas mais concisas e naturais.  Voc√™ n√£o pode for√ßar Alice a sintetizar texto longo com o qual o usu√°rio j√° est√° familiarizado, al√©m de usar emoji no texto da mensagem e no nome dos bot√µes. <br><br>  Os bot√µes de dicas implementam o princ√≠pio da iniciativa: Alice sempre indica e sugere poss√≠veis a√ß√µes para continuar o di√°logo.  No cen√°rio do jogo proposto, a lista de bot√µes n√£o depende do contexto e √© adicionada a cada mensagem. <br><br>  Portanto, temos uma tabela do Google com dados do usu√°rio que s√£o armazenados e recuperados atrav√©s do URL do aplicativo da web.  O aplicativo √© escrito em Apps Script, interpreta a a√ß√£o do usu√°rio de acordo com seu contexto e gera dados para a mensagem de resposta. <br><br>  Resta conectar-se a Alice ... <br><br><h2>  Dois!  Integra√ß√£o </h2><br>  O Yandex.Dialogs permite que os desenvolvedores adicionem suas habilidades a Alice.  Conectar uma habilidade se resume a tr√™s coisas principais: <br><br><ul><li>  ativa√ß√£o; </li><li>  design; </li><li>  gancho da web. </li></ul><br><h3>  Ativa√ß√£o e design </h3><br>  Para a ativa√ß√£o, √© importante escolher uma frase que Alice reconhe√ßa bem, que atenda aos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">requisitos formais do</a> Yandex.  Se houver n√∫meros no nome da ativa√ß√£o, verifique separadamente a ativa√ß√£o ao digitar no teclado e na voz. <br><br>  O design da habilidade inclui um nome, descri√ß√£o, √≠cone, categoria etc. <br>  Vale considerar que na lista de habilidades do cat√°logo apenas o √≠cone e a frase de ativa√ß√£o s√£o exibidos, e a pesquisa no cat√°logo √© realizada principalmente de acordo com a descri√ß√£o. <br><br><h3>  Obtendo um gancho da web </h3><br>  Um gancho da web √© o endere√ßo para o qual Alice enviar√° mensagens para sua habilidade e aguardar√° uma resposta JSON no formato descrito. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/zy/4t/zazy4tve59hnchb4quwuokqv6ju.png"></div><br><br>  O aplicativo Web criado no Apps Script retorna uma resposta na forma de uma p√°gina html por padr√£o, mas usando o ContentService, ele pode ser for√ßado a retornar o JSON tamb√©m: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ContentService.createTextOutput(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">JSON</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">)) .setMimeType(ContentService.MimeType.JSON);</span></span></code> </pre> <br>  No entanto, ao usar o ContentService, o Google redireciona a solicita√ß√£o do usu√°rio para um URL tempor√°rio, para o qual o Yandex.Dialogs n√£o est√° pronto.  Portanto, o endere√ßo do aplicativo Web como um gancho da Web n√£o √© adequado. <br><br>  Existem servi√ßos gratuitos que oferecem um gancho da web adequado para Alice, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como o Zenbot</a> .  No Zenbot, para o jogo proposto, voc√™ pode escrever um script curto que acesse um aplicativo Web do Google e retorne uma resposta junto com os bot√µes.  A prop√≥sito, dessa forma, o jogo pode ser integrado n√£o apenas a Alice, mas tamb√©m a outros canais. <br><br>  Abaixo est√° um exemplo de script que fornece o jogo "Um, Dois, Tr√™s!"  no bot do Telegram @RazDvaTriBot: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://script.google.com/macros/s/&lt;id -&gt;/exec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">var</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Result"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userId"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$req_telegram_chat"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Utterance"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"channel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telegram"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Answer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'javascript: $Result.text'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Answer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Para maior flexibilidade no processamento de solicita√ß√µes, voc√™ pode escrever seu pr√≥prio servidor usando, por exemplo, o Google App Engine.  Esta ferramenta tamb√©m pode ser usada gratuitamente. <br><br>  Ap√≥s criar um projeto no Google App Engine, a interface do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cloud Shell</a> permite que voc√™ escreva o c√≥digo do servidor em uma p√°gina da Web e implante-o no URL desejado no formato https: // &lt;ID do projeto&gt; .appspot.com, que ser√° o endere√ßo do gancho da Web. <br><br>  A opera√ß√£o do servidor consiste nas seguintes etapas: <br><br><ol><li>  receber dados de solicita√ß√£o de Alice; </li><li>  intera√ß√£o com a aplica√ß√£o web do jogo; </li><li>  enviando uma resposta no formato de Alice. </li></ol><br><h4>  Receber / enviar dados de Alice </h4><br>  De Alice, √© importante obter os identificadores da sess√£o, usu√°rio, mensagem e o texto da solicita√ß√£o.  Abaixo est√° um exemplo em PHP: <br><br><pre> <code class="php hljs"> $data = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>)); $session_id = $data-&gt;session-&gt;session_id; $user_id = $data-&gt;session-&gt;user_id; $utterance = $data-&gt;request-&gt;original_utterance; $messageId = $data-&gt;session-&gt;message_id;</code> </pre><br>  Como resposta, os bot√µes e textos de dicas s√£o retornados ao jogo para exibi√ß√£o e pron√∫ncia: <br><br><pre> <code class="php hljs"> $button1 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button2 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button3 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $yaButtons = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($button1, $button2, $button3); $yaResponse = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; $text, <span class="hljs-string"><span class="hljs-string">'tts'</span></span> =&gt; $tts, <span class="hljs-string"><span class="hljs-string">'buttons'</span></span> =&gt; $yaButtons, <span class="hljs-string"><span class="hljs-string">'end_session'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $yaSession = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'session_id'</span></span> =&gt; $session_id, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span> =&gt; $messageId, <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; $user_id); $yaResult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'response'</span></span> =&gt; $yaResponse, <span class="hljs-string"><span class="hljs-string">'session'</span></span> =&gt; $yaSession, <span class="hljs-string"><span class="hljs-string">'version'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($yaResult);</code> </pre><br><h2>  Tr√™s!  Sincronizar </h2><br>  O envio / recebimento de dados de um aplicativo da web leva tempo e Alice est√° ansiosa para dar uma resposta ao usu√°rio, para que os problemas de sincroniza√ß√£o interfiram no problema. <br><br>  Naturalmente, para grandes projetos, o Planilhas Google n√£o √© adequado como back-end para a habilidade de Alice: o tempo de resposta aumenta com um grande n√∫mero de solicita√ß√µes paralelas.  No entanto, existem recomenda√ß√µes para otimizar o chatbot, que possibilitam a viabiliza√ß√£o de um pequeno projeto em um sistema de di√°logo interativo em tempo real. <br><br>  Tempo limite do protocolo s√≠ncrono de Alice - 1,5 segundos por resposta.  Se o servidor n√£o tiver tempo para responder durante esse per√≠odo, o usu√°rio ver√° uma mensagem triste com o esp√≠rito de "Desculpe, &lt;nome da caixa de di√°logo&gt; n√£o responde".  O sistema n√£o oferece nenhuma pista sobre o que fazer em seguida. <br><br>  Para evitar tal situa√ß√£o, voc√™ pode e deve acelerar o servi√ßo, al√©m de rastrear e processar tempos limite.  As opera√ß√µes mais longas durante a opera√ß√£o do script do jogo s√£o a leitura e grava√ß√£o de dados da tabela.  Portanto, em primeiro lugar, o n√∫mero dessas opera√ß√µes deve ser minimizado e, em segundo lugar, √© desej√°vel paraleliz√°-las. <br><br>  Leia os dados da tabela uma vez o suficiente.  Depois de executar a l√≥gica, o script est√° pronto para dar uma resposta imediata ao usu√°rio, antes do final da grava√ß√£o dos resultados. <br><br>  Um tempo limitado deve receber uma resposta - por exemplo, 1100 ms: <br><br><pre> <code class="php hljs"> $request_params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'userId'</span></span> =&gt; $user_id, <span class="hljs-string"><span class="hljs-string">'utterance'</span></span> =&gt; $utterance, <span class="hljs-string"><span class="hljs-string">'channel'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'alice'</span></span> ); $get_params = http_build_query($request_params); $ctx = stream_context_create(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1.1</span></span> ) )); $answer = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://script.google.com/macros/s/&lt;id -&gt;/exec?'</span></span>. $get_params, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $ctx);</code> </pre><br>  Se a resposta for recebida pela solicita√ß√£o GET dentro do prazo, podemos envi√°-la ao usu√°rio e iniciar o salvamento dos resultados pela solicita√ß√£o POST em segundo plano.  Caso contr√°rio, fornecemos ao usu√°rio um texto stub com bot√µes para continuar e ignoramos os resultados do script para que o usu√°rio possa repetir sua solicita√ß√£o no contexto atual. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($answer === <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) { $text = <span class="hljs-string"><span class="hljs-string">' ,   .'</span></span>; $tts = <span class="hljs-string"><span class="hljs-string">',   .'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $answer = json_decode($answer); $text = $answer-&gt;text; $tts = $answer-&gt;tts; <span class="hljs-comment"><span class="hljs-comment">//   $data2store = $answer-&gt;data; $postdata = json_encode(array( 'data' =&gt; $data2store )); $opts = array('http' =&gt; array( 'method' =&gt; 'POST', 'header' =&gt; 'Content-Type: application/json', 'content' =&gt; $postdata, 'timeout' =&gt; 0.1 ) ); $context = stream_context_create($opts); file_get_contents("https://script.google.com/macros/s/&lt;id -&gt;/exec", false, $context); }</span></span></code> </pre><br><img src="https://habrastorage.org/webt/a1/ez/od/a1ezodgm9tqdt2gudd7vfes9bn0.png" width="320" align="right"><br>  Em um jogo multiplayer para Alice, as tarefas de sincroniza√ß√£o devem ser resolvidas entre os servidores do jogo e o Yandex e entre os jogadores.  Se um jogador quiser jogar contra outro usu√°rio, o pr√≥prio jogo seleciona um oponente - daqueles que queriam jogar recentemente.  Os usu√°rios devem confirmar sua disposi√ß√£o de jogar um com o outro para o jogo come√ßar. <br><br>  Atualmente, a habilidade n√£o pode iniciar o envio de uma mensagem ao usu√°rio de Alice.  Portanto, o script do jogo fornece a verifica√ß√£o da prontid√£o do oponente e os minutos alocados para a rodada do jogo.  Se o oponente atrasar o jogo, o usu√°rio ser√° solicitado a esperar por ele: "Espere mais um pouco pelo oponente?"  Ao concordar em esperar, o usu√°rio inicia outra verifica√ß√£o.  Se o minuto do jogo terminar, o jogo termina. <br><br><h2>  Conclus√£o </h2><br>  As vantagens do Planilhas Google como back-end para um bot de bate-papo, exceto de gra√ßa, incluem o fato de ser uma ferramenta de depura√ß√£o durante o desenvolvimento e, depois disso, se tornar um console de administrador de habilidades com todas as del√≠cias da edi√ß√£o colaborativa de qualquer dispositivo.  Por contras - atrasos na opera√ß√£o simult√¢nea de um grande n√∫mero de usu√°rios. <br><br clear="right">  Espero que este artigo ajude entusiastas e desenvolvedores a criar rapidamente habilidades √∫teis para Alice ou outros canais.  O jogo proposto est√° dispon√≠vel na loja de habilidades Yandex.Dialog chamada ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">One, Two, Three!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jogo multiplayer</a> . ‚Äù <br><br>  Juntamente com as ferramentas de uso geral, existem solu√ß√µes especializadas para o desenvolvimento de bots de bate-papo.  Convido os leitores a participarem de uma pequena pesquisa sobre os servi√ßos que conhe√ßo nesta √°rea.  A lista n√£o inclu√≠a todos os produtos existentes - serei grato por coment√°rios com nomes e cr√≠ticas breves se voc√™ usou outras ferramentas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414213/">https://habr.com/ru/post/pt414213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414201/index.html">C√≥digo Divino (c√≥digo de DEUS)</a></li>
<li><a href="../pt414203/index.html">Fraude ou n√£o fraude? Verificamos a OIC por cinco m√©todos</a></li>
<li><a href="../pt414207/index.html">O problema do inovador, ou por que voc√™ precisa recorrer √† experi√™ncia de outras pessoas</a></li>
<li><a href="../pt414209/index.html">IGNG - Algoritmo Incremental de G√°s Neural Incremental</a></li>
<li><a href="../pt414211/index.html">Desenvolvimento de um servidor TELNET baseado em W5500 e ATMEGA8</a></li>
<li><a href="../pt414215/index.html">Blocos personalizados em chips (Silicon IP): como funciona</a></li>
<li><a href="../pt414217/index.html">Smartphones locais da Vertex: primeiro em qualidade, primeiro em chips, primeiro em design</a></li>
<li><a href="../pt414219/index.html">A experi√™ncia de usar energia solar na regi√£o de Moscou: a favor, contra e quem precisa</a></li>
<li><a href="../pt414221/index.html">Analisando e trabalhando com Codable no Swift 4</a></li>
<li><a href="../pt414223/index.html">C #: compatibilidade com vers√µes anteriores e sobrecarga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>