<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèø üëßüèº üëàüèø Experi√™ncia na transfer√™ncia de um projeto Maven para o Jar Multi-Release: j√° poss√≠vel, mas ainda dif√≠cil ‚ôãÔ∏è üö¥üèø ‚õàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu tenho uma pequena biblioteca StreamEx que estende a API Java 8 Stream. Tradicionalmente, coleciono a biblioteca atrav√©s do Maven e, na maioria das ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experi√™ncia na transfer√™ncia de um projeto Maven para o Jar Multi-Release: j√° poss√≠vel, mas ainda dif√≠cil</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472312/"><p> Eu tenho uma pequena biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">StreamEx</a> que estende a API Java 8 Stream.  Tradicionalmente, coleciono a biblioteca atrav√©s do Maven e, na maioria das vezes, estou feliz com tudo.  No entanto, eu queria experimentar. </p><br><p> Algumas coisas na biblioteca devem funcionar de maneira diferente em diferentes vers√µes do Java.  O exemplo mais impressionante √© o novo m√©todo da API de fluxo, como o <code>takeWhile</code> , que apareceu apenas no Java 9. Minha biblioteca tamb√©m fornece uma implementa√ß√£o desses m√©todos no Java 8, mas quando voc√™ expande a API do fluxo, voc√™ sofre algumas restri√ß√µes que n√£o mencionarei aqui.  Eu gostaria que os usu√°rios do Java 9+ tivessem acesso a uma implementa√ß√£o padr√£o. </p><a name="habracut"></a><br><p>  Para que o projeto continue compilando usando Java 8, isso geralmente √© feito usando ferramentas de reflex√£o: descobrimos se existe um m√©todo correspondente na biblioteca padr√£o e, se assim for, o chamamos e, se n√£o, usamos nossa implementa√ß√£o.  No entanto, decidi usar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API MethodHandle</a> , porque declara menos sobrecarga de chamada.  Voc√™ pode obter o <code>MethodHandle</code> antecipadamente e salv√°-lo em um campo est√°tico: </p><br><pre> <code class="java hljs">MethodHandles.Lookup lookup = MethodHandles.publicLookup(); MethodType type = MethodType.methodType(Stream.class, Predicate.class); MethodHandle method = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { method = lookup.findVirtual(Stream.class, <span class="hljs-string"><span class="hljs-string">"takeWhile"</span></span>, type); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchMethodException | IllegalAccessException e) { <span class="hljs-comment"><span class="hljs-comment">// ignore }</span></span></code> </pre> <br><p>  E ent√£o use-o: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Stream&lt;T&gt;)method.invokeExact(stream, predicate); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Java 8 polyfill }</span></span></code> </pre> <br><p>  Tudo isso √© bom, mas parece feio.  E o mais importante, em todo momento em que √© poss√≠vel uma varia√ß√£o de implementa√ß√µes, voc√™ deve escrever essas condi√ß√µes.  Uma abordagem ligeiramente alternativa √© separar as estrat√©gias do Java 8 e Java 9 como uma implementa√ß√£o da mesma interface.  Ou, para salvar o tamanho da biblioteca, simplesmente implemente tudo para o Java 8 em uma classe n√£o final separada e substitua um herdador pelo Java 9.  Foi feito algo como isto: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    Internals static final VersionSpecific VER_SPEC = System.getProperty("java.version", "").compareTo("1.9") &gt; 0 ? new Java9Specific() : new VersionSpecific();</span></span></code> </pre> <br><p>  Ent√£o, nos pontos de uso, voc√™ pode simplesmente escrever o <code>return Internals.VER_SPEC.takeWhile(stream, predicate)</code> .  Agora toda a m√°gica com al√ßas de m√©todo est√° apenas na classe <code>Java9Specific</code> .  A prop√≥sito, essa abordagem salvou a biblioteca para usu√°rios do Android que j√° haviam reclamado anteriormente que ela n√£o funcionava em princ√≠pio.  A m√°quina virtual Android n√£o √© Java, nem sequer implementa a especifica√ß√£o Java 7. Em particular, n√£o h√° m√©todos com uma assinatura polim√≥rfica como <code>invokeExact</code> , e a pr√≥pria presen√ßa dessa chamada no bytecode quebra tudo.  Agora, essas chamadas s√£o feitas em uma classe que nunca √© inicializada. </p><br><p>  No entanto, tudo isso ainda √© feio.  Uma solu√ß√£o bonita (pelo menos em teoria) √© usar o Multi Release Jar, que acompanha o Java 9 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JEP-238</a> ).  Para fazer isso, parte das classes deve ser compilada no Java 9 e os arquivos de classe compilados colocados no <code>META-INF/versions/9</code> dentro do arquivo Jar.  Al√©m disso, voc√™ precisa adicionar a linha <code>Multi-Release: true</code> ao manifesto.  Em seguida, o Java 8 ignorar√° tudo isso com √™xito e o Java 9 e mais recente carregar√° novas classes em vez de classes com os mesmos nomes localizados no local usual. </p><br><p>  A primeira vez que tentei fazer isso mais de dois anos atr√°s, pouco antes do lan√ßamento do Java 9. Foi muito dif√≠cil e eu parei.  Mesmo a compila√ß√£o do projeto com o compilador Java 9 foi dif√≠cil: muitos plug-ins do Maven simplesmente quebraram devido a APIs internas alteradas <code>java.version</code> string <code>java.version</code> alterado ou qualquer outra coisa. </p><br><p>  Uma nova tentativa este ano foi mais bem sucedida.  Os plug-ins foram em sua maioria atualizados e funcionam adequadamente no novo Java.  A primeira etapa foi traduzida do assembly inteiro para Java 11. Para isso, al√©m de atualizar as vers√µes do plug-in, tive que fazer o seguinte: </p><br><ul><li>  Altere os links do <code>package-info.java</code> <code>&lt;a name="..."&gt;</code> no formato <code>&lt;a name="..."&gt;</code> para <code>&lt;a id="..."&gt;</code> .  Caso contr√°rio, o JavaDoc reclama. </li><li>  Especifique <code>additionalOptions = --no-module-directories</code> no maven-javadoc-plugin.  Sem isso, havia bugs estranhos nos recursos de pesquisa do JavaDoc: diret√≥rios com m√≥dulos n√£o foram criados de qualquer maneira, mas ao mudar para o resultado da pesquisa, <code>/undefined/</code> adicionado ao caminho (Ol√°, JavaScript).  Como esse recurso no Java 8 n√£o era de todo, minha atividade j√° trouxe um bom resultado: o JavaDoc se tornou uma pesquisa. </li><li>  Corrija o plug-in para publicar os resultados da cobertura de teste no Coveralls ( <code>coveralls-maven-plugin</code> ).  Por alguma raz√£o, √© abandonado, o que √© estranho, j√° que o Coveralls vive sozinho e oferece servi√ßos comerciais.  A jaxb-api usada pelo plug-in foi removida do Java 11.  Felizmente, n√£o √© dif√≠cil corrigir o problema usando as ferramentas do Maven: basta registrar explicitamente a depend√™ncia no plug-in: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.eluder.coveralls<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>coveralls-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>javax.xml.bind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jaxb-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ul><br><p>  O pr√≥ximo passo foi a adapta√ß√£o dos testes.  Como o comportamento da biblioteca √© obviamente diferente no Java 8 e Java 9, seria l√≥gico executar testes para ambas as vers√µes.  Agora, estamos executando tudo no Java 11, para que o c√≥digo espec√≠fico do Java 8 n√£o seja testado.  Este √© um c√≥digo bastante grande e n√£o trivial.  Para consertar isso, fiz uma caneta artificial: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> VersionSpecific VER_SPEC = System.getProperty(<span class="hljs-string"><span class="hljs-string">"java.version"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).compareTo(<span class="hljs-string"><span class="hljs-string">"1.9"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !Boolean.getBoolean(<span class="hljs-string"><span class="hljs-string">"one.util.streamex.emulateJava8"</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Java9Specific() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VersionSpecific();</code> </pre> <br><p>  Agora basta passar <code>-Done.util.streamex.emulateJava8=true</code> ao executar os testes, <br>  para testar o que geralmente funciona no Java 8. Agora, adicione um novo bloco <code>&lt;execution&gt;</code> √† configura√ß√£o do <code>maven-surefire-plugin</code> com <code>argLine = -Done.util.streamex.emulateJava8=true</code> e os testes passam duas vezes. </p><br><p>  No entanto, eu gostaria de considerar os testes de cobertura total.  Eu uso o JaCoCo e, se voc√™ n√£o contar nada a ele, a segunda execu√ß√£o simplesmente substituir√° os resultados da primeira.  Como funciona o JaCoCo?  Primeiro, ele executa o destino do <code>prepare-agent</code> , que define a propriedade argLine Maven, assinando algo como <code>-javaagent:blah-blah/.m2/org/jacoco/org.jacoco.agent/0.8.4/org.jacoco.agent-0.8.4-runtime.jar=destfile=blah-blah/myproject/target/jacoco.exec</code> .  Eu quero que dois arquivos exec diferentes sejam formados.  Voc√™ pode hackear dessa maneira.  Inclua <code>destFile=${project.build.directory}</code> configura√ß√£o do <code>prepare-agent</code> .  √Åspero, mas eficaz.  Agora o <code>argLine</code> terminar√° em <code>blah-blah/myproject/target</code> .  Sim, este n√£o √© um arquivo, mas um diret√≥rio.  Mas podemos substituir o nome do arquivo j√° no in√≠cio dos testes.  Retornamos ao <code>maven-surefire-plugin</code> e configuramos <code>argLine = @{argLine}/jacoco_java8.exec -Done.util.streamex.emulateJava8=true</code> para a execu√ß√£o do Java 8 e <code>argLine = @{argLine}/jacoco_java11.exec</code> para a execu√ß√£o do Java 11.  Depois, √© f√°cil combinar esses dois arquivos usando o destino de <code>merge</code> , que o plug-in JaCoCo tamb√©m fornece, e obtemos a cobertura geral. </p><br><p>  <strong>Atualiza√ß√£o:</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">godin</a> nos coment√°rios disse que era desnecess√°rio, voc√™ pode gravar em um arquivo e colar√° automaticamente o resultado no anterior.  Agora n√£o sei por que esse cen√°rio n√£o funcionou para mim inicialmente. </p><br><p>  Bem, estamos bem preparados para mudar para o Jar Multi-Release.  Encontrei v√°rias recomenda√ß√µes sobre como fazer isso.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O primeiro</a> sugeriu o uso de um projeto Maven multi-modular.  N√£o me apetece: esta √© uma grande complica√ß√£o da estrutura do projeto: existem cinco pom.xml, por exemplo.  Brincar por causa de alguns arquivos que precisam ser compilados no Java 9 parece ser demais.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outro</a> sugeriu iniciar a compila√ß√£o atrav√©s do <code>maven-antrun-plugin</code> .  Aqui eu decidi olhar apenas como √∫ltimo recurso.  √â claro que qualquer problema no Maven pode ser resolvido usando o Ant, mas isso √© de alguma forma bastante desajeitado.  Por fim, vi uma recomenda√ß√£o para usar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in</a> de terceiros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">multi-release-jar-maven-plugin</a> .  J√° parecia delicioso e certo. </p><br><p>  O plug-in recomenda colocar c√≥digos-fonte espec√≠ficos para novas vers√µes do Java em diret√≥rios como <code>src/main/java-mr/9</code> , o que eu fiz.  Eu ainda decidi evitar colis√µes nos nomes de classe ao m√°ximo, ent√£o a √∫nica classe (mesmo a interface) que est√° presente no Java 8 e Java 9, tenho o seguinte: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Java 8 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new VersionSpecific(); } // Java 9 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new Java9Specific(); }</span></span></code> </pre> <br><p>  A velha constante mudou-se para um novo local, mas nada realmente mudou.  Somente agora a classe <code>Java9Specific</code> tornou muito mais simples: todos os agachamentos com MethodHandle foram substitu√≠dos com sucesso por chamadas de m√©todo diretas. </p><br><p>  O plugin promete fazer o seguinte: </p><br><ul><li>  Substitua o <code>maven-compiler-plugin</code> padr√£o e compile em duas etapas por uma vers√£o de destino diferente. </li><li>  Substitua o <code>maven-jar-plugin</code> padr√£o e <code>maven-jar-plugin</code> resultado <code>maven-jar-plugin</code> compila√ß√£o pelos caminhos corretos. </li><li>  Adicione a linha <code>Multi-Release: true</code> ao <code>MANIFEST.MF</code> . </li></ul><br><p>  Para que ele funcionasse, foram necess√°rias algumas etapas. </p><br><ol><li><p>  Mude a embalagem do <code>jar</code> para o <code>jar</code> <code>multi-release-jar</code> . </p><br></li><li><p>  Adicione build-extension: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Copie a configura√ß√£o do <code>maven-compiler-plugin</code> .  Eu tinha apenas a vers√£o padr√£o no esp√≠rito de <code>&lt;source&gt;1.8&lt;/source&gt;</code> e <code>&lt;arg&gt;-Xlint:all&lt;/arg&gt;</code> </p><br></li><li><p>  Eu pensei que o <code>maven-compiler-plugin</code> agora pode ser removido, mas o novo plugin n√£o substitui a compila√ß√£o de testes; portanto, a vers√£o Java foi redefinida para o padr√£o (1.5!) E o <code>-Xlint:all</code> argumentos desapareceram.  Ent√£o eu tive que sair. </p><br></li><li><p>  Para n√£o duplicar a origem e o destino dos dois plugins, descobri que ambos respeitam as propriedades de <code>maven.compiler.source</code> e <code>maven.compiler.target</code> .  Eu os instalei e removi as vers√µes das configura√ß√µes do plugin.  No entanto, de repente, descobriu-se que o <code>maven-javadoc-plugin</code> usa o <code>source</code> - <code>source</code> das configura√ß√µes do <code>maven-compiler-plugin</code> para descobrir a URL do JavaDoc padr√£o, que deve ser vinculada ao se referir a m√©todos padr√£o.  E agora ele n√£o respeita <code>maven.compiler.source</code> .  Portanto, tive que retornar <code>&lt;source&gt;${maven.compiler.source}&lt;/source&gt;</code> para as configura√ß√µes do <code>maven-compiler-plugin</code> .  Felizmente, nenhuma outra altera√ß√£o foi necess√°ria para gerar o JavaDoc.  Pode muito bem ser gerado a partir de fontes Java 8, porque todo o carrossel com vers√µes n√£o afeta a API da biblioteca. </p><br></li><li><p>  O <code>maven-bundle-plugin</code> , o que transformou minha biblioteca em um artefato OSGi.  Ele simplesmente se recusou a trabalhar com <code>packaging = multi-release-jar</code> .  Em princ√≠pio, nunca gostei dele.  Ele escreve um conjunto de linhas adicionais no manifesto, ao mesmo tempo estragando a ordem de classifica√ß√£o e adicionando mais lixo.  Felizmente, descobriu-se que n√£o √© dif√≠cil se livrar dele escrevendo tudo √† m√£o.  Apenas, √© claro, n√£o no <code>maven-jar-plugin</code> , mas no novo.  Toda a configura√ß√£o do plugin <code>multi-release-jar</code> acabou se tornando assim (eu defini algumas propriedades como <code>project.package</code> eu mesmo): </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span>-Xlint:all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.name}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span>${project.description}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span>${license.url}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span>${project.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package};version="${project.version}"<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Testes.  N√£o temos mais <code>one.util.streamex.emulateJava8</code> , mas voc√™ pode obter o mesmo efeito modificando os testes de caminho de classe.  Agora, o oposto √© verdadeiro: por padr√£o, a biblioteca funciona no modo Java 8 e, para o Java 9, voc√™ precisa escrever: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/target/classes-9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span>@{argLine}/jacoco_java9.exec<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Um ponto importante: as <code>classes-9</code> devem seguir os arquivos de classes comuns, portanto tivemos que transferir os usuais para os <code>additionalClasspathElements</code> , que s√£o adicionados depois. </p><br></li><li><p>  Fontes.  Vou usar o jar de c√≥digo-fonte e seria interessante incluir fontes do Java 9 para que, por exemplo, o depurador no IDE possa exibi-las corretamente.  N√£o estou muito preocupado com o <code>VerSpec</code> duplicado, porque h√° uma linha que √© executada apenas durante a inicializa√ß√£o.  N√£o h√° problema em deixar apenas a op√ß√£o do Java 8. No entanto, seria bom <code>Java9Specific.java</code> .  Isso pode ser feito adicionando manualmente um diret√≥rio de origem adicional: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.codehaus.mojo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>build-helper-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>add-source<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrce</span></span></span><span class="hljs-tag">&gt;</span></span>src/main/java-mr/9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrce</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Depois de coletar o artefato, conectei-o a um projeto de teste e o verifiquei no depurador IntelliJ IDEA.  Tudo funciona lindamente: dependendo da vers√£o da m√°quina virtual usada para executar o projeto de teste, acabamos em uma fonte diferente durante a depura√ß√£o. </p><br><p>  Seria legal fazer isso pelo pr√≥prio plugin multi-release-jar, ent√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fiz</a> uma sugest√£o. </p><br></li><li><p>  JaCoCo.  Acabou sendo o mais dif√≠cil para ele, e eu n√£o poderia prescindir de ajuda externa.  O fato √© que o plug-in gerava perfeitamente os arquivos exec para Java-8 e Java-9, normalmente os colava em um arquivo; no entanto, ao gerar relat√≥rios em XML e HTML, eles teimosamente ignoravam as fontes do Java-9.  Revistando <a href="">a fonte</a> , vi que ela gera apenas um relat√≥rio para os arquivos de classe encontrados em <code>project.getBuild().getOutputDirectory()</code> .  Esse diret√≥rio, √© claro, pode ser substitu√≠do, mas na verdade eu tenho dois deles: <code>classes</code> e <code>classes-9</code> .  Teoricamente, voc√™ pode copiar todas as classes em um diret√≥rio, alterar o <code>outputDirectory</code> e iniciar o JaCoCo e, em seguida, alterar o <code>outputDirectory</code> volta para n√£o interromper o assembly JAR.  Mas isso parece completamente feio.  Em geral, decidi adiar a solu√ß√£o para esse problema no meu projeto por enquanto, mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escrevi para a equipe</a> da JaCoCo que seria bom poder especificar v√°rios diret√≥rios com arquivos de classe. </p><br><p>  Para minha surpresa, poucas horas depois, um dos desenvolvedores da JaCoCo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">godin</a> veio ao meu projeto e trouxe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">solicita√ß√£o</a> de recebimento, que resolve o problema.  Como isso decide?  Usando Ant, √© claro!  Verificou-se que o plugin Ant para JaCoCo √© mais avan√ßado e pode gerar um relat√≥rio de resumo para v√°rios diret√≥rios de origem e arquivos de classe.  Ele nem precisou de uma etapa de <code>merge</code> separada, porque podia alimentar v√°rios arquivos exec de uma s√≥ vez.  Em geral, Ant n√£o pode ser evitado, que assim seja.  A principal coisa que funcionou e o pom.xml cresceu apenas seis linhas. </p><br><p><img src="https://habrastorage.org/webt/-y/qd/q9/-yqdq9suyxlqtaw2d9dkjoc0rg8.png"></p><br><p>  Eu at√© twitei em cora√ß√µes: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1185422598810800129"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br></li></ol><br><p>  Ent√£o, eu tenho um projeto muito funcional que constr√≥i um lindo Jar Multi-Release.  Ao mesmo tempo, a porcentagem de cobertura aumentou at√© porque removi todos os tipos de <code>catch (NoSuchMethodException | IllegalAccessException e)</code> que eram inating√≠veis no Java 9. Infelizmente, essa estrutura de projeto n√£o √© suportada pelo IntelliJ IDEA, ent√£o tive que abandonar a importa√ß√£o de POM e configurar o projeto no IDE manualmente. .  Espero que, no futuro, ainda exista uma solu√ß√£o padr√£o que seja automaticamente suportada por todos os plugins e ferramentas. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472312/">https://habr.com/ru/post/pt472312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472298/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 385 (14 a 20 de outubro de 2019)</a></li>
<li><a href="../pt472300/index.html">Descida de gradiente estoc√°stico (SGD) para a fun√ß√£o de perda logar√≠tmica (LogLoss) em um problema de classifica√ß√£o bin√°ria</a></li>
<li><a href="../pt472304/index.html">NASA contrata engenheiros para desenvolver rob√¥ human√≥ide de pr√≥xima gera√ß√£o</a></li>
<li><a href="../pt472306/index.html">PHP Digest No. 166 (7 a 21 de outubro de 2019)</a></li>
<li><a href="../pt472310/index.html">Identifica√ß√£o de clientes em sites sem senhas e cookies: solicita√ß√£o de padr√£o</a></li>
<li><a href="../pt472314/index.html">Eu gosto de pessoas de papel√£o</a></li>
<li><a href="../pt472318/index.html">Rastreamento distribu√≠do no Istio</a></li>
<li><a href="../pt472320/index.html">Entrevista com o Zabbix: 12 respostas francas</a></li>
<li><a href="../pt472326/index.html">Nossa ind√∫stria espacial ... E se voc√™ olhar para os problemas da ind√∫stria da perspectiva de um nerd?</a></li>
<li><a href="../pt472334/index.html">Vida por cupons ou como otimizamos o trabalho dos servi√ßos sociais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>