<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÑ üï≥Ô∏è ü§ûüèΩ VMware NSX para los m√°s peque√±os. Parte 6. Configuraci√≥n de VPN üë¶üèæ üß† üòÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Primera parte Introductorio 
 Segunda parte Configurar firewall y reglas NAT 
 Tercera parte Configuraci√≥n de DHCP 
 Parte cuatro Configuraci√≥n de enr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VMware NSX para los m√°s peque√±os. Parte 6. Configuraci√≥n de VPN</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/454004/"><img src="https://habrastorage.org/webt/wq/yu/qy/wqyuqynprr8iaabtcn7nhbkqkje.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Primera parte</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introductorio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Segunda parte</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configurar firewall y reglas NAT</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tercera parte</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuraci√≥n de DHCP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte cuatro</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuraci√≥n de enrutamiento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Quinta parte</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configurar un equilibrador de carga</a> <br><br>  Hoy nos fijamos en las opciones de configuraci√≥n de VPN que nos ofrece NSX Edge. <br><br>  En general, podemos dividir las tecnolog√≠as VPN en dos tipos clave: <br><br><ul><li>  <b>VPN de sitio a sitio.</b>  Con mayor frecuencia, IPSec se usa para crear un t√∫nel seguro, por ejemplo, entre la red de la oficina principal y la red en un sitio remoto o en la nube. <br></li><li>  <b>VPN de acceso remoto.</b>  Se utiliza para conectar usuarios individuales a redes privadas de organizaciones que utilizan software de cliente VPN. </li></ul><br>  NSX Edge nos permite usar ambas opciones. <br>  Lo configuraremos utilizando un banco de pruebas con dos NSX Edge, un servidor Linux con el demonio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">racoon</a> instalado y una computadora port√°til con Windows para probar VPN de acceso remoto. <a name="habracut"></a><br><br><h3>  IPsec </h3><br><ol><li>  En la interfaz de vCloud Director, vaya a la secci√≥n Administraci√≥n y seleccione vDC.  En la pesta√±a Edge Gateways, seleccione el Edge que necesitamos, haga clic con el bot√≥n derecho y seleccione Servicios de Edge Gateway. <br><img src="https://habrastorage.org/webt/gx/g_/7s/gxg_7s4odqm4vy8lgxitl79ahtu.png"></li><li>  En la interfaz NSX Edge, vaya a la pesta√±a VPN VPN-IPsec, luego vaya a la secci√≥n Sitios IPsec VPN y haga clic en + para agregar un nuevo sitio. <br><br><img src="https://habrastorage.org/webt/9w/kw/yz/9wkwyzxy6fwv6mm6tiw30juuemc.png"></li><li>  Rellene los campos obligatorios: <br><ul><li>  <b>Habilitado</b> : activa el sitio remoto. </li><li>  <b>PFS</b> : garantiza que cada nueva clave criptogr√°fica no est√© asociada a ninguna clave anterior. </li><li>  <b>ID local y Local Endpoin</b> t son la direcci√≥n externa de NSX Edge. </li><li>  <b>Subred local</b> s: redes locales que utilizar√°n IPsec VPN. </li><li>  <b>Peer ID y Peer Endpoint</b> : direcci√≥n del sitio remoto. </li><li>  <b>Subredes pares</b> : redes que utilizar√°n VPN IPsec en el lado remoto. </li><li>  <b>Algoritmo de</b> cifrado: algoritmo de cifrado de t√∫nel. </li></ul><br><img src="https://habrastorage.org/webt/fr/2h/af/fr2haf6yil98f0e9p2tpjpsdlu8.png"><br><br><ul><li>  <b>Autenticaci√≥n</b> : c√≥mo autenticaremos una fiesta.  Puede usar la clave previamente compartida o un certificado. </li><li>  <b>Clave precompartida</b> : especifique la clave que se utilizar√° para la autenticaci√≥n y debe coincidir en ambos lados. </li><li>  <b>Grupo Diffie-Hellman</b> : algoritmo de intercambio de claves. </li></ul><br>  Despu√©s de completar los campos obligatorios, haga clic en Conservar. <br><br><img src="https://habrastorage.org/webt/k9/yd/nk/k9ydnkf0ncd8dqajktdkux1wc58.png"></li><li>  Listo <br><br><img src="https://habrastorage.org/webt/z9/ij/ot/z9ijot3wthx7dklptivvra-8pws.png"></li><li>  Despu√©s de agregar el sitio, vaya a la pesta√±a Estado de activaci√≥n y active el Servicio IPsec. <br><br><img src="https://habrastorage.org/webt/p9/oc/la/p9oclawmegzrekhuxslid1cvnzu.png"></li><li>  Despu√©s de aplicar la configuraci√≥n, vaya a la pesta√±a Estad√≠sticas -&gt; IPsec VPN y verifique el estado del t√∫nel.  Vemos que el t√∫nel ha subido. <br><br><img src="https://habrastorage.org/webt/fn/ai/fm/fnaifmaxtxbfs-sumd9t5xyfhn0.png"></li><li>  Verifique el estado del t√∫nel desde la consola de la puerta de enlace Edge: <br><ul><li>  show service ipsec - verifica el estado del servicio. <br><br><img src="https://habrastorage.org/webt/tu/sv/_y/tusv_yq3-jzm_bavjx_fefpv_d0.png"></li><li>  show service ipsec site: informaci√≥n sobre el estado del sitio y los par√°metros acordados. <br><br><img src="https://habrastorage.org/webt/ct/ex/j0/ctexj0sypvimdsgyaogvob0rx1w.png"></li><li>  show service ipsec sa - Verificaci√≥n del estado de la Asociaci√≥n de Seguridad (SA). <br><br><img src="https://habrastorage.org/webt/m2/of/ng/m2ofnggyimplhfnlvfvnec_yawa.png"></li></ul></li><li>  Comprobaci√≥n remota de conectividad del sitio: <br><br><pre><code class="plaintext hljs">root@racoon:~# ifconfig eth0:1 | grep inet inet 10.255.255.1 netmask 255.255.255.0 broadcast 0.0.0.0 root@racoon:~# ping -c1 -I 10.255.255.1 192.168.0.10 PING 192.168.0.10 (192.168.0.10) from 10.255.255.1 : 56(84) bytes of data. 64 bytes from 192.168.0.10: icmp_seq=1 ttl=63 time=59.9 ms --- 192.168.0.10 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 59.941/59.941/59.941/0.000 ms</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Archivos de configuraci√≥n y comandos de diagn√≥stico adicionales del servidor remoto de Linux:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">root@racoon:~# cat /etc/racoon/racoon.conf log debug; path pre_shared_key "/etc/racoon/psk.txt"; path certificate "/etc/racoon/certs"; listen { isakmp 80.211.43.73 [500]; strict_address; } remote 185.148.83.16 { exchange_mode main,aggressive; proposal { encryption_algorithm aes256; hash_algorithm sha1; authentication_method pre_shared_key; dh_group modp1536; } generate_policy on; } sainfo address 10.255.255.0/24 any address 192.168.0.0/24 any { encryption_algorithm aes256; authentication_algorithm hmac_sha1; compression_algorithm deflate; } === root@racoon:~# cat /etc/racoon/psk.txt 185.148.83.16 testkey === root@racoon:~# cat /etc/ipsec-tools.conf #!/usr/sbin/setkey -f flush; spdflush; spdadd 192.168.0.0/24 10.255.255.0/24 any -P in ipsec esp/tunnel/185.148.83.16-80.211.43.73/require; spdadd 10.255.255.0/24 192.168.0.0/24 any -P out ipsec esp/tunnel/80.211.43.73-185.148.83.16/require; === root@racoon:~# racoonctl show-sa isakmp Destination Cookies Created 185.148.83.16.500 2088977aceb1b512:a4c470cb8f9d57e9 2019-05-22 13:46:13 === root@racoon:~# racoonctl show-sa esp 80.211.43.73 185.148.83.16 esp mode=tunnel spi=1646662778(0x6226147a) reqid=0(0x00000000) E: aes-cbc 00064df4 454d14bc 9444b428 00e2296e c7bb1e03 06937597 1e522ce0 641e704d A: hmac-sha1 aa9e7cd7 51653621 67b3b2e9 64818de5 df848792 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=1 pid=7739 refcnt=0 185.148.83.16 80.211.43.73 esp mode=tunnel spi=88535449(0x0546f199) reqid=0(0x00000000) E: aes-cbc c812505a 9c30515e 9edc8c4a b3393125 ade4c320 9bde04f0 94e7ba9d 28e61044 A: hmac-sha1 cd9d6f6e 06dbcd6d da4d14f8 6d1a6239 38589878 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=0 pid=7739 refcnt=0</code> </pre> <br></div></div></li><li>  Todo est√° listo, la VPN IPsec de sitio a sitio est√° configurada y funcionando. <br><br>  En este ejemplo, utilizamos el PSK para autenticar al par, pero tambi√©n es posible una opci√≥n de autenticaci√≥n de certificado.  Para hacer esto, vaya a la pesta√±a Configuraci√≥n global, habilite la autenticaci√≥n de certificado y seleccione el certificado en s√≠. <br><br>  Adem√°s, en la configuraci√≥n del sitio ser√° necesario cambiar el m√©todo de autenticaci√≥n. <br><br><img src="https://habrastorage.org/webt/gv/x0/e8/gvx0e80ogisdslhrxbvcwci54gq.png"><br><br><img src="https://habrastorage.org/webt/uj/uf/xh/ujufxh2n4da4fcfb1hsrnlppv3w.png"><br><br>  Observo que el n√∫mero de t√∫neles IPsec depende del tama√±o de Edge Gateway implementado (lea sobre esto en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primer art√≠culo</a> ). <br><br><img src="https://habrastorage.org/webt/bf/sq/rv/bfsqrvatekltpr2xy1wx4b35t-q.png"></li></ol><br><h3>  VPN SSL </h3><br>  SSL VPN-Plus es una de las opciones para VPN de acceso remoto.  Permite a los usuarios remotos individuales conectarse de forma segura a redes privadas detr√°s de la puerta de enlace NSX Edge.  Se establece un t√∫nel cifrado SSL VPN-plus entre el cliente (Windows, Linux, Mac) y NSX Edge. <br><br><ol><li>  Vamos a configurar  En el panel de control del servicio Edge Gateway, vaya a la pesta√±a SSL VPN-Plus, luego a Configuraci√≥n del servidor.  Seleccionamos la direcci√≥n y el puerto en el que el servidor escuchar√° las conexiones entrantes, habilitaremos el registro y seleccionaremos los algoritmos de cifrado necesarios. <br><br><img src="https://habrastorage.org/webt/o4/nt/hq/o4nthq3cjj_sh1pwpz-5bm0q1oo.png"><br><br>  Aqu√≠ puede cambiar el certificado que usar√° el servidor. <br><br><img src="https://habrastorage.org/webt/ij/ep/eg/ijepegloixlveu3aa9juqhuegzg.png"></li><li>  Una vez que todo est√© listo, encienda el servidor y no olvide guardar la configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/ml/dz/pj/mldzpjn23fhhyljhr7zlre9tdcm.png"></li><li>  A continuaci√≥n, debemos configurar el conjunto de direcciones que enviaremos a los clientes cuando est√©n conectados.  Esta red es independiente de cualquier subred existente en su entorno NSX, no necesita configurarse en otros dispositivos en redes f√≠sicas, excepto las rutas que apuntan a ella. <br><br>  Vaya a la pesta√±a Grupos de IP y haga clic en +. <br><br><img src="https://habrastorage.org/webt/vb/yx/4x/vbyx4xh7xvbp4aacm0_dsrx4lau.png"></li><li>  Elija direcciones, m√°scara de subred y puerta de enlace.  Aqu√≠ puede cambiar la configuraci√≥n de los servidores DNS y WINS. <br><br><img src="https://habrastorage.org/webt/fy/s4/un/fys4unlo2c_-ees8uduwgw--_oa.png"></li><li>  El conjunto resultante. <br><br><img src="https://habrastorage.org/webt/2n/7_/lr/2n7_lrsb5jjtgi9o8vgbkrijck4.png"></li><li>  Ahora agregue las redes a las que tendr√°n acceso los usuarios que se conectan a la VPN.  Vaya a la pesta√±a Redes privadas y haga clic en +. <br><br><img src="https://habrastorage.org/webt/cp/xj/c5/cpxjc55glum1i7qbultrqxeelwq.png"></li><li>  Completamos: <br><br><ul><li>  Red: una red local a la que tendr√°n acceso los usuarios remotos. </li><li>  Enviar tr√°fico, tiene dos opciones: <br>  - sobre t√∫nel: env√≠e tr√°fico a la red a trav√©s del t√∫nel, <br>  - desv√≠o del t√∫nel: env√≠e tr√°fico a la red directamente evitando el t√∫nel. </li><li>  Habilitar la optimizaci√≥n TCP: marque si la opci√≥n sobre t√∫nel est√° seleccionada.  Cuando la optimizaci√≥n est√° habilitada, puede especificar los n√∫meros de puerto para los que desea optimizar el tr√°fico.  El tr√°fico para los puertos restantes de esta red en particular no se optimizar√°.  Si no se especifican los n√∫meros de puerto, se optimiza el tr√°fico para todos los puertos.  Lea m√°s sobre esta caracter√≠stica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li></ul><br><img src="https://habrastorage.org/webt/6z/pm/c7/6zpmc7-cic6jlregwi2ylyt9apu.png"></li><li>  A continuaci√≥n, vaya a la pesta√±a Autenticaci√≥n y haga clic en +.  Para la autenticaci√≥n, utilizaremos un servidor local en NSX Edge. <br><br><img src="https://habrastorage.org/webt/aq/kx/bp/aqkxbp8ux9csyx2bui2o5hxdtjc.png"></li><li>  Aqu√≠ podemos elegir pol√≠ticas para generar nuevas contrase√±as y configurar opciones para bloquear cuentas de usuario (por ejemplo, el n√∫mero de reintentos cuando la contrase√±a se ingresa incorrectamente). <br><br><img src="https://habrastorage.org/webt/oz/gd/mi/ozgdmimubqauqwo6gymipuvv8va.png"><br><br><img src="https://habrastorage.org/webt/cp/6n/fl/cp6nflis843n8edmtjimkmk2gdo.png"></li><li>  Como utilizamos la autenticaci√≥n local, necesitamos crear usuarios. <br><br><img src="https://habrastorage.org/webt/sb/ui/kt/sbuikttq8ew3bu8rhqt4kpiq7ho.png"></li><li>  Adem√°s de cosas b√°sicas como un nombre y una contrase√±a, aqu√≠ puede, por ejemplo, evitar que el usuario cambie la contrase√±a o, por el contrario, obligarlo a cambiar la contrase√±a en el pr√≥ximo inicio de sesi√≥n. <br><br><img src="https://habrastorage.org/webt/ki/am/qw/kiamqwt8jphlg5f0b_b2ifa4-wy.png"></li><li>  Despu√©s de agregar todos los usuarios necesarios, vaya a la pesta√±a Paquetes de instalaci√≥n, haga clic en + y cree el instalador, que descargar√° el empleado remoto para la instalaci√≥n. <br><br><img src="https://habrastorage.org/webt/wg/js/4t/wgjs4tj0efxxlrj9mcpu-gql2z4.png"></li><li>  Haz clic en +.  Seleccionamos la direcci√≥n y el puerto del servidor al que se conectar√° el cliente, y las plataformas para las que desea generar el paquete de instalaci√≥n. <br><br><img src="https://habrastorage.org/webt/gd/sx/i4/gdsxi44atfhzs0yh-wcv8gooqp8.png"><br><br>  Puede especificar la configuraci√≥n del cliente para Windows a continuaci√≥n en esta ventana.  Elegir: <br><br><ul><li>  iniciar cliente al iniciar sesi√≥n: el cliente VPN se agregar√° al inicio en una m√°quina remota; </li><li>  crear icono de escritorio: crear√° un icono de cliente VPN en el escritorio; </li><li>  validaci√≥n del certificado de seguridad del servidor: validar√° el certificado del servidor tras la conexi√≥n. <br>  La configuraci√≥n del servidor est√° completa. </li></ul><br><img src="https://habrastorage.org/webt/7j/po/ia/7jpoiawbsxmetmvijnvnvtu7mfm.png"></li><li>  Ahora descargue el paquete de instalaci√≥n que creamos en el √∫ltimo paso en la PC remota.  Al configurar el servidor, especificamos su direcci√≥n externa (185.148.83.16) y su puerto (445).  Es a esta direcci√≥n que necesitamos ir al navegador web.  En mi caso, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">185.148.83.16</a> : 445. <br><br>  En la ventana de autorizaci√≥n, debe ingresar las credenciales del usuario que creamos anteriormente. <br><br><img src="https://habrastorage.org/webt/w6/5t/b3/w65tb3thu0i3yvh2wkp0dq5enc4.png"></li><li>  Despu√©s de la autorizaci√≥n, vemos una lista de paquetes de instalaci√≥n creados disponibles para descargar.  Hemos creado solo uno, y lo descargamos. <br><br><img src="https://habrastorage.org/webt/62/_m/af/62_mafqhlxpqpqa3wrq5g_9gpvo.png"></li><li>  Hacemos clic en el enlace, comienza la descarga del cliente. <br><br><img src="https://habrastorage.org/webt/du/1n/th/du1nth1rhphihfhpctp1hmnk1es.png"></li><li>  Desempaquete el archivo descargado y ejecute el instalador. <br><br><img src="https://habrastorage.org/webt/np/bs/69/npbs69o4arrddkvwqxrvomnn5l0.png"></li><li>  Despu√©s de la instalaci√≥n, ejecute el cliente, en la ventana de autorizaci√≥n, haga clic en Iniciar sesi√≥n. <br><br><img src="https://habrastorage.org/webt/og/lq/uc/oglqucpuesvmhe8tj9kphxxeqdk.png"></li><li>  En la ventana de verificaci√≥n del certificado, seleccione S√≠. <br><br><img src="https://habrastorage.org/webt/nf/m3/da/nfm3dacakvoreocayzwrmacmjoa.png"></li><li>  Ingresamos las credenciales para el usuario creado previamente y vemos que la conexi√≥n se completa con √©xito. <br><br><img src="https://habrastorage.org/webt/zz/ot/_r/zzot_riaf24alcpw2cmobskcl0c.png"><br><br><img src="https://habrastorage.org/webt/yq/d5/dz/yqd5dzwb3yarbdaqidoxk-g2l2a.png"></li><li>  Verifique las estad√≠sticas del cliente VPN en la computadora local. <br><br><img src="https://habrastorage.org/webt/mf/qi/yi/mfqiyi-qzvx7_aiyptg-jb7yocy.jpeg"><br><br><img src="https://habrastorage.org/webt/qv/no/fr/qvnofrg8hclsrdjrp1lo-pdkdom.jpeg"></li><li>  En la l√≠nea de comandos de Windows (ipconfig / all) vemos que ha aparecido un adaptador virtual adicional y hay conectividad con la red remota, todo funciona: <br><br><img src="https://habrastorage.org/webt/01/hf/5t/01hf5tzh6ej5o-6pq8a4wkms2dq.jpeg"><br><br><img src="https://habrastorage.org/webt/qb/km/he/qbkmhe0m1q1hfrhlceovxla3ldw.png"></li><li>  Y finalmente, un cheque de la consola de Edge Gateway. <br><br><img src="https://habrastorage.org/webt/2e/ot/wr/2eotwriama_etzynpyasqcimg2k.png"></li></ol><br><h3>  VPN L2 </h3><br>  Se necesita L2VPN cuando necesita combinar varios geogr√°ficamente <br>  redes distribuidas en un dominio de difusi√≥n. <br><br>  Esto puede ser √∫til, por ejemplo, al migrar una m√°quina virtual: cuando una VM se mueve a otro sitio geogr√°fico, la m√°quina guardar√° la configuraci√≥n de direccionamiento IP y no perder√° la conectividad con otras m√°quinas ubicadas en el mismo dominio L2. <br><br>  En nuestro entorno de prueba, conectaremos dos sitios entre s√≠, los llamaremos A y B, respectivamente. Tenemos dos NSX y dos redes enrutadas creadas de forma id√©ntica conectadas a diferentes Edge.  La m√°quina A tiene la direcci√≥n 10.10.10.250/24, la m√°quina B tiene la direcci√≥n 10.10.10.2/24. <br><br><ol><li>  En vCloud Director, vaya a la pesta√±a Administraci√≥n, vaya al VDC que necesitamos, vaya a la pesta√±a Redes Org VDC y agregue dos redes nuevas. <br><br><img src="https://habrastorage.org/webt/jh/8x/oa/jh8xoarvrbmyd0cexp1forwc5fo.png"></li><li>  Seleccionamos el tipo de red enrutada y vinculamos esta red a nuestro NSX.  Ponemos la casilla de verificaci√≥n Crear como subinterfaz. <br><br><img src="https://habrastorage.org/webt/ke/fa/gp/kefagptrkwzznjydhktrom9g2ww.png"></li><li>  Como resultado, deber√≠amos obtener dos redes.  En nuestro ejemplo, se denominan red-a y red-b con la misma configuraci√≥n de puerta de enlace y la misma m√°scara. <br><br><img src="https://habrastorage.org/webt/s2/fs/m0/s2fsm0dcmiqyrka4acercwf26ww.png"><br><br><img src="https://habrastorage.org/webt/ev/mr/k8/evmrk8fmiyzemartcv_hjakdhus.png"></li><li>  Ahora pasemos a la configuraci√≥n del primer NSX.  Este ser√° el NSX al que est√° conectada la red A. Actuar√° como un servidor. <br><br>  Vuelva a la interfaz NSx Edge / Vaya a la pesta√±a VPN -&gt; L2VPN.  Habilitamos L2VPN, seleccionamos el modo de funcionamiento del servidor, en la configuraci√≥n global del servidor, especificamos la direcci√≥n IP externa del NSX, en la que se escuchar√° el puerto para el t√∫nel.  Por defecto, el socket se abrir√° en el puerto 443, pero se puede cambiar.  No olvide elegir la configuraci√≥n de cifrado para el futuro t√∫nel. <br><br><img src="https://habrastorage.org/webt/5s/cp/yl/5scpylcprxcu_wmgtvgwxqi3bv0.png"></li><li>  Vaya a la pesta√±a Sitios del servidor y agregue un fest√≠n. <br><br><img src="https://habrastorage.org/webt/9u/az/bm/9uazbmzmfihywslasekwqmrhm1o.png"></li><li>  Encienda la fiesta, configure el nombre, la descripci√≥n, si es necesario, configure el nombre de usuario y la contrase√±a.  Necesitaremos estos datos m√°s adelante cuando configuremos el sitio del cliente. <br><br>  En la direcci√≥n de la puerta de enlace de Egress Optimization, configure la direcci√≥n de la puerta de enlace.  Esto es necesario para que no haya conflicto de direcciones IP, porque la puerta de enlace en nuestras redes tiene la misma direcci√≥n.  Luego presionamos el bot√≥n SELECCIONAR SUB-INTERFACES. <br><br><img src="https://habrastorage.org/webt/lh/y8/t2/lhy8t2pxycomacepgel1vess6jy.png"></li><li>  Aqu√≠ seleccionamos la subinterfaz deseada.  Guarda la configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/_o/hn/3l/_ohn3lperjba15rifdy6yyzvk0u.png"></li><li>  Vemos que el sitio del cliente reci√©n creado apareci√≥ en la configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/sd/p_/lf/sdp_lf6amh08k9aexlsxl724ioc.png"></li><li>  Ahora pasemos a configurar NSX en el lado del cliente. <br><br>  Vamos al lado B de NSX, vamos a VPN -&gt; L2VPN, activamos L2VPN, configuramos el modo L2VPN en modo cliente.  En la pesta√±a Global del cliente, configure la direcci√≥n y el puerto de NSX A, que indicamos anteriormente como IP y puerto de escucha en el lado del servidor.  Tambi√©n es necesario establecer la misma configuraci√≥n de cifrado para que sean coherentes al elevar el t√∫nel. <br><br><img src="https://habrastorage.org/webt/wn/yx/ug/wnyxug_ioltwju3lcqh-fzqk2sy.png"><br><br>  Despl√°cese hacia abajo, seleccione la subinterfaz a trav√©s de la cual se construir√° el t√∫nel para L2VPN. <br>  En la direcci√≥n de la puerta de enlace de Egress Optimization, configure la direcci√≥n de la puerta de enlace.  Establecer ID de usuario y contrase√±a.  Seleccionamos la subinterfaz y no nos olvidamos de guardar la configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/bi/bf/qj/bibfqjjaw-s5rridzyz_vxtb_ng.png"></li><li>  Eso es todo, en realidad.  La configuraci√≥n del cliente y del servidor es casi id√©ntica, con la excepci√≥n de algunos matices. </li><li>  Ahora podemos ver lo que ha ganado nuestro t√∫nel yendo a Estad√≠sticas -&gt; L2VPN en cualquier NSX. <br><br><img src="https://habrastorage.org/webt/dj/uj/iu/djujiuzlvgswhq1osmpajodl4fe.png"></li><li>  Si entramos en la consola de cualquier Edge Gateway ahora, veremos las direcciones de ambas m√°quinas virtuales en cada una de ellas en la tabla arp. <br><br><img src="https://habrastorage.org/webt/uy/si/r8/uysir84foday_fr6xip0tku5sca.png"></li></ol><br><br>  Eso es todo sobre VPN en NSX Edge.  Pregunte si algo no est√° claro.  Esta es tambi√©n la √∫ltima parte de una serie de art√≠culos sobre c√≥mo trabajar con NSX Edge.  Esperamos que hayan sido √∫tiles :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454004/">https://habr.com/ru/post/454004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453994/index.html">Badoo Techleads Meetup # 4. Agotamiento profesional y motivaci√≥n</a></li>
<li><a href="../453996/index.html">Uhhhhhh C√≥mo vender en Internet sin un sitio web</a></li>
<li><a href="../453998/index.html">Aeroexpress: ve al dep√≥sito</a></li>
<li><a href="../454000/index.html">SONRISA NO ES LASIK. Sobre la correcci√≥n de la visi√≥n con l√°ser</a></li>
<li><a href="../454002/index.html">Experimento: C√≥mo enmascarar Tor usando para evitar bloqueos</a></li>
<li><a href="../454006/index.html">Acerca de TI sin v√≠nculos: promociones, retenci√≥n y rotaci√≥n en empresas de la CEI y EE. UU.</a></li>
<li><a href="../454010/index.html">Educaci√≥n superior y continua en TI: resultados del estudio My Circle</a></li>
<li><a href="../454012/index.html">El fin de la era de los dispositivos de reparaci√≥n. C√≥mo Apple y Amazon limpian los viejos comerciantes de electr√≥nica</a></li>
<li><a href="../454016/index.html">3CX v16 Actualizaci√≥n 1, aplicaci√≥n 3CX para iOS Beta y la nueva versi√≥n 3CX Call Flow Designer</a></li>
<li><a href="../454018/index.html">iOS Digest No. 6 (17 de mayo - 30 de mayo)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>