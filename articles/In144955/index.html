<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯзЫЁЯП╝ ЁЯеЯ ЁЯР╕ рдПрдВрдбреНрд░реЙрдЗрдб рдкрд░ .3DS рдлрд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ ЁЯСГЁЯП╜ ЁЯМ┐ ЁЯд┤ЁЯП╗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдпрд╣ рд▓реЗрдЦ рдЧреНрд▓реЛ рдЗрдлрд╝реЗрдХреНрдЯ рдкрд░ рдореЗрд░реА рдкрд┐рдЫрд▓реА рдкреЛрд╕реНрдЯ рдХрд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рд╣реИред рдореИрдВрдиреЗ рдпрд╣ рдмрддрд╛рдиреЗ рдХрд╛ рд╡рд╛рджрд╛ рдХрд┐рдпрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ .3ds рдлрд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИрдВред 

 рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдХреЗ рдмрд╛рд░...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдВрдбреНрд░реЙрдЗрдб рдкрд░ .3DS рдлрд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/144955/">  рдпрд╣ рд▓реЗрдЦ рдЧреНрд▓реЛ рдЗрдлрд╝реЗрдХреНрдЯ рдкрд░ рдореЗрд░реА <a href="http://habrahabr.ru/post/144831/">рдкрд┐рдЫрд▓реА рдкреЛрд╕реНрдЯ</a> рдХрд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рд╣реИред  рдореИрдВрдиреЗ рдпрд╣ рдмрддрд╛рдиреЗ рдХрд╛ рд╡рд╛рджрд╛ рдХрд┐рдпрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ .3ds рдлрд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИрдВред <br><br>  рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдирдХрд╛рд░реА, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="http://en.wikipedia.org/wiki/.3ds">рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛</a> рдкрд░ рдпрд╛ <a href="http://www.enlight.ru/faq3d/articles/75.htm">Demo.design 3D рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ FAQ</a> рдореЗрдВ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рднреА рд╕рд┐рджреНрдзрд╛рдВрдд рд╣реИ (рдФрд░ рдпрд╣ рдмрд┐рдирд╛ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛), рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдо рдЬрд╛рд╡рд╛ рдФрд░ рдПрдВрдбреНрд░реЙрдЗрдб рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдЕрднреНрдпрд╛рд╕, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред <br><br>  рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: <br><ul><li>  рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдореЗрдВ рдХрд╛рдлреА рддреЗрдЬ рд╣реИ (рдлреЛрди рдкрд░ рдПрдХ рджреЛ-рдореЗрдЧрд╛рдмрд╛рдЗрдЯ рдлрд╝рд╛рдЗрд▓ рдХреБрдЫ рд╕реЗрдХрдВрдб рдореЗрдВ рднрд░реА рд╣реБрдИ рд╣реИ); </li><li>  рдкреВрд░реЗ рдореЙрдбрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдирд╛, рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛, рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд▓реЛрдб рдХрд░рдирд╛; </li><li>  рд╕рд╛рдордЧреНрд░реА, рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА; </li><li>  рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдПрдиреАрдореЗрд╢рди рдФрд░ рдкрджрд╛рдиреБрдХреНрд░рдо рд▓реЛрдб рдХрд░рдирд╛ред </li></ul><br>  рдпрд╣рд╛рдБ рдХреНрдпрд╛ <i>рдирд╣реАрдВ</i> рд╣реЛрдЧрд╛: <br><ul><li>  рдЦреБрдж рдХреЛ рд▓реЛрдб рдХрд░рдирд╛ (рдореБрдЭреЗ рдЕрднреА рддрдХ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ); </li><li>  рдХреИрдорд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ (рдлрд┐рд░ рд╕реЗ, рдЗрд╕реЗ рдЬреЛрдбрд╝рдирд╛ рдЖрд╕рд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рдерд╛); </li><li>  <s>рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдЪреМрд░рд╕рд╛рдИ рд╕рдореВрд╣реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ (рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рдЖрд╡рд╢реНрдпрдХ рд╣реИ)</s> (рдпрд╣ рдЕрднреА рднреА рд╣реЛрдЧрд╛); </li><li>  рдПрдиреАрдореЗрд╢рди рдХреЗ рд▓рд┐рдП <a href="http://www.enlight.ru/faq3d/articles/76.htm">рд╡рд┐рднрд╛рдЬрди рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </li></ul><br>  рдкрд┐рдЫрд▓реА рдмрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреВрд░реЗ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрдмрд╛рдПрдВ, рдпрд╣рд╛рдВ рдореИрдВ рдирд╣реАрдВ (рдпрд╣ рдПрдХ рд╣рдЬрд╛рд░ рд▓рд╛рдЗрдиреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ), рдореИрдВ рдХреЗрд╡рд▓ рдореБрдЦреНрдп рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реВрдВрдЧрд╛ рдФрд░ рдкреВрд░реНрдг рд╕реНрд░реЛрдд рдХреЛрдб (рд▓реЗрдЦ рдХреЗ рдЕрдВрдд рдореЗрдВ) рд▓рд┐рдВрдХ рдкреНрд░рджрд╛рди рдХрд░реВрдВрдЧрд╛ред  рдЕрднреА рднреА рджрд┐рд▓рдЪрд╕реНрдкреА рд╣реИ?  рддреЛ рдЪрд▓рд┐рдП рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВред <br><a name="habracut"></a><br><h4>  рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ </h4><br>  рдЕрдЬреАрдм рддрд░рд╣ рд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдпрд╣ рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рдкрдврд╝рдирд╛ рдерд╛ рдЬреЛ рд╕рдмрд╕реЗ рдХрдард┐рди рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдерд╛, рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╕реНрдерд╛рди рдкрд░ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛ рдерд╛ред  рдпрд╣рд╛рдВ рджреЛ рд░реЗрдХ рд╣реИрдВ: рдЧрддрд┐ рдФрд░ рд╢реБрджреНрдзрддрд╛ред  рд╣рдо BufferedInputStream рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдкрдврд╝рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрддрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рд╕рдм рдХреБрдЫ рд╕рд╣реА рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде рдФрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ: рдЬрд╛рд╡рд╛ рдХрд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдбреЗрдЯрд╛ рдмрдбрд╝реЗ-рдПрдВрдбрд┐рдпрди рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП, рдЬрдмрдХрд┐ .3ds рдЫреЛрдЯреЗ-рдПрдВрдбрд┐рдпрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЦреИрд░ ... рд╣рдо рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЖрд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BufferedInputStream file; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filePos = <span class="hljs-number"><span class="hljs-number">0</span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Skip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ file.skip(count); filePos += count; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Seek</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filePos &lt; end) { Skip(end - filePos); filePos = end; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadByte</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ file.read(bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); filePos++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadUnsignedByte</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ file.read(bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); filePos++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (bytes[<span class="hljs-number"><span class="hljs-number">0</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadUnsignedShort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ file.read(bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); filePos += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((bytes[<span class="hljs-number"><span class="hljs-number">1</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | (bytes[<span class="hljs-number"><span class="hljs-number">0</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ file.read(bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); filePos += <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (bytes[<span class="hljs-number"><span class="hljs-number">3</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span> | (bytes[<span class="hljs-number"><span class="hljs-number">2</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | (bytes[<span class="hljs-number"><span class="hljs-number">1</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | (bytes[<span class="hljs-number"><span class="hljs-number">0</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xff</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadFloat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Float.intBitsToFloat(ReadInt()); }</code> </pre> <br><br>  рдПрдХ рдЕрдЪреНрдЫреЗ рддрд░реАрдХреЗ рд╕реЗ, рдпрд╣ рдмрдлрд╝рд░рдб рдЗрдирдкреБрдЯрд╕реНрдЯреНрд░реАрдо рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рдПрдХ рдЕрд▓рдЧ рд╡рд░реНрдЧ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдерд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдореЗрд░реЗ рд▓рд┐рдП рдРрд╕рд╛ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдерд╛ред <br><br>  рдЕрдм рдЖрдк рд╣рд┐рд╕реНрд╕рд╛ рдкрдврд╝рдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП - рдореБрдЦреНрдп рдПрдХ: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Scene3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileLen)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ Scene3D scene = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (filePos &lt; fileLen) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkID = ReadUnsignedShort(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkLen = ReadInt() - <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (chunkID) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CHUNK_MAIN: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (scene == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) scene = ChunkMain(chunkLen); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Skip(chunkLen); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: Skip(chunkLen); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scene; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Scene3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChunkMain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ Scene3D scene = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scene3D(); scene.materials = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Material3D&gt;(); scene.objects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Object3D&gt;(); scene.lights = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Light3D&gt;(); scene.animations = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Animation&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> end = filePos + len; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (filePos &lt; end) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkID = ReadUnsignedShort(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkLen = ReadInt() - <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (chunkID) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CHUNK_OBJMESH: Chunk3DEditor(scene, chunkLen); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CHUNK_KEYFRAMER: ChunkKeyframer(scene, chunkLen); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CHUNK_BACKCOL: scene.background = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[<span class="hljs-number"><span class="hljs-number">4</span></span>]; ChunkColor(chunkLen, scene.background); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CHUNK_AMB: scene.ambient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[<span class="hljs-number"><span class="hljs-number">4</span></span>]; ChunkColor(chunkLen, scene.ambient); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: Skip(chunkLen); } } Seek(end); scene.Compute(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scene; }</code> </pre><br><br>  рдПрдХ рдкреВрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЛрдбрд░ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХрд╛рдлреА рд╕рдЬрд╛рддреАрдп рд╣реИ: рдкреНрд░рддреНрдпреЗрдХ рдЪрдВрдХ рдХреЗ рд▓рд┐рдП - рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЙрди рдЙрдк-рд╡рд┐рдЦрдВрдбреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреЛ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рд╣рдо рдЕрдирд╛рд╡рд╢реНрдпрдХ, - рдХреВрджрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВрдЧреЗ, рддреБрд░рдВрдд рдЕрдЧрд▓реЗ рднрд╛рдЧ рдореЗрдВ рдЪрд▓реЗ рдЬрд╛рдПрдВрдЧреЗред  рдЕрд╡реИрдз рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рдВрд░рдХреНрд╖рдг рдпрд╣рд╛рдВ рдиреНрдпреВрдирддрдо рд╣реИред <br><br><h4>  рд╕рд╛рдордЧреНрд░реА </h4><br>  рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдмреНрд▓реЙрдХ рдЖрдорддреМрд░ рдкрд░ рдкрд╣рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рддрдм рддреНрд░рд┐рдХреЛрдг рдХрд╛ рдмреНрд▓реЙрдХ рдмрд╛рдж рдореЗрдВ рдЗрд╕реЗ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рд╕рд╛рдордЧреНрд░реА рдореЗрдВ рдХрдИ рд░рдВрдЧ (рдкрд░рд┐рд╡реЗрд╢, рдлреИрд▓рд╛рдирд╛, рд╕реНрдкреЗрдХреНрдпреБрд▓рд░) рд╣реЛрддреЗ рд╣реИрдВ, рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдирд╛рдо, рдЪрдХрд╛рдЪреМрдВрдз рдХрд╛ рдкреИрд░рд╛рдореАрдЯрд░, рдмрдирд╛рд╡рдЯ рдХрд╛ рдирд╛рдоред  рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдмрдирд╛рд╡рдЯ рдпрд╣рд╛рдВ рд▓реЛрдб рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдЬреЛрдбрд╝рдирд╛ рдЖрд╕рд╛рди рд╣реИред <br><br><h4>  3 рдбреА рдореЙрдбрд▓ </h4><br>  рдкреНрд░рддреНрдпреЗрдХ 3D рдореЙрдбрд▓ (рджреЗрдЦреЗрдВ ChunkTrimesh рдлрд╝рдВрдХреНрд╢рди) рдирд┐рдореНрди рдбреЗрдЯрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><ul><li>  рд╢реАрд░реНрд╖ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рд╕реВрдЪреА; </li><li>  рддреНрд░рд┐рдХреЛрдг рдХреА рд╕реВрдЪреА; </li><li>  рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ; </li><li>  рд╕реНрдерд╛рдиреАрдп рд╕рдордиреНрд╡рдп рдкреНрд░рдгрд╛рд▓реАред </li></ul><br>  рдпрджрд┐ рдкрд╣рд▓реЗ рддреАрди рдмрд┐рдВрджреБрдУрдВ рдХреЗ рд╕рд╛рде рд╕рдм рдХреБрдЫ рд╕реНрдкрд╖реНрдЯ рд╣реИ, рддреЛ рдЕрдВрддрд┐рдо рдХреБрдЫ рд░рд╣рд╕реНрдпрдордп рджрд┐рдЦрддрд╛ рд╣реИред  рдЖрдЧреЗ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВ рдХрд╣реВрдВрдЧрд╛ рдХрд┐ рдореЗрд░реЗ рд▓рд┐рдП рдпрд╣ рдПрдХ рд╕рдордЭ рд╕реЗ рдмрд╛рд╣рд░ рдХреА рдЗрдХрд╛рдИ рдмрдирд╛ рд╣реБрдЖ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореИрдВрдиреЗ рдЕрднреА рднреА рд╕реАрдЦрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдбреЗрдЯрд╛ рдХреЛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдПред <br><br>  рд╣рдо рдПрдХ рд╕рд░рдгреА рдлреНрд▓реЛрдЯ рдореЗрдВ рдХреЛрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдбрдВрдк рдХрд░реЗрдВрдЧреЗ [], рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП рдЖрда рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ (рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рджреНрд╡рд╛рд░рд╛ рддреАрди, рдкреНрд▓рд╕ рджреЛ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ)ред  рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдХреА рдХреБрдЫ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛: <br><br><pre> <code class="java hljs"> GLES20.glVertexAttribPointer(maPosition, <span class="hljs-number"><span class="hljs-number">3</span></span>, GLES20.GL_FLOAT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); GLES20.glVertexAttribPointer(maNormal, <span class="hljs-number"><span class="hljs-number">3</span></span>, GLES20.GL_FLOAT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>);</code> </pre><br>  рдпрд╣рд╛рдВ, рд╕рдВрдЦреНрдпрд╛ 24 рдмрджрд▓рдХрд░ 32 рд╣реЛ рдЧрдИ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдкрд╣рд▓реЗ рдХреЛрдИ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирд╣реАрдВ рдереЗ, рд▓реЗрдХрд┐рди рдЕрдм рдпрд╣ рд╣реИред <br><br>  рд╕рднреА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ ChunkVector рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЬреЛ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ Y рдФрд░ Z рдЕрдХреНрд╖реЛрдВ рдХреЛ рд╕реНрд╡реИрдк рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChunkVector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] vec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ vec[offset + <span class="hljs-number"><span class="hljs-number">0</span></span>] = ReadFloat(); vec[offset + <span class="hljs-number"><span class="hljs-number">2</span></span>] = ReadFloat(); vec[offset + <span class="hljs-number"><span class="hljs-number">1</span></span>] = ReadFloat(); }</code> </pre><br><br>  рдЦреИрд░, рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдХреБрдЫ рдорд╛рдирдХ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рд░рдВрдЧ рдпрд╛ рдкреНрд░рддрд┐рд╢рдд, рдЙрдирдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреА рд╕реВрдЪреА рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХреЛ рдЪреЗрд╣рд░реЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдФрд░ рдЕрдиреБрд▓рдВрдмреЛрдВ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ), рдФрд░ рджреВрд╕рд░реА рдмрд╛рдд, рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдорд╛рдирджрдВрдб рдЪреЗрд╣рд░реЛрдВ рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдЪреЗрд╣рд░реЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рддреАрди рдХреЛрдиреЗ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж (рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдВрдд рдореЗрдВ, рд╕рднреА рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж) рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдХрд░рддреЗ рд╣реИрдВред  рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдПрдХ рдЧреБрдЪреНрдЫрд╛, рдереЛрдбрд╝рд╛ рдЧрдгрд┐рдд - рдФрд░ рдЖрдк рдХрд░ рд░рд╣реЗ рд╣реИрдВред <br><br>  рдЪреЗрд╣рд░реЛрдВ рдХреА рд╕реВрдЪреА рдХреА рдПрдХ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рдЪрдВрдХ рдХреЗ рдмрд╛рдж, рдРрд╕реЗ рдЪреЗрд╣рд░реЗ рдмрдиреЗ рд░рд╣ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рди рдкрд░ рд╕рд╛рдордЧреНрд░реА рдирд╣реАрдВ рд▓рдЧрд╛рдИ рдЧрдИ рд╣реИред  рдЙрдирдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд░реЗрдВрдбрд░ рдХрд░рддреЗ рд╕рдордп рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ: <br><br><pre> <code class="java hljs"> mAmbient[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mAmbient[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mAmbient[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mAmbient[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; mDiffuse[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mDiffuse[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mDiffuse[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0.587f</span></span>; mDiffuse[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; mSpecular[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0.896f</span></span>; mSpecular[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0.896f</span></span>; mSpecular[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0.896f</span></span>; mSpecular[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mats = obj.faceMats.size(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; mats; j++) { FaceMat mat = obj.faceMats.get(j); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mat.material != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mat.material.ambient != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; scene.ambient != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; k++) mAmbient[k] = mat.material.ambient[k] * scene.ambient[k]; GLES20.glUniform4fv(muAmbient, <span class="hljs-number"><span class="hljs-number">1</span></span>, mAmbient, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> GLES20.glUniform4f(muAmbient, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mat.material.diffuse != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) GLES20.glUniform4fv(muDiffuse, <span class="hljs-number"><span class="hljs-number">1</span></span>, mat.material.diffuse, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> GLES20.glUniform4fv(muDiffuse, <span class="hljs-number"><span class="hljs-number">1</span></span>, mDiffuse, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mat.material.specular != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) GLES20.glUniform4fv(muSpecular, <span class="hljs-number"><span class="hljs-number">1</span></span>, mat.material.specular, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> GLES20.glUniform4fv(muSpecular, <span class="hljs-number"><span class="hljs-number">1</span></span>, mSpecular, <span class="hljs-number"><span class="hljs-number">0</span></span>); GLES20.glUniform1f(muShininess, mat.material.shininess); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GLES20.glUniform4f(muAmbient, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); GLES20.glUniform4fv(muDiffuse, <span class="hljs-number"><span class="hljs-number">1</span></span>, mDiffuse, <span class="hljs-number"><span class="hljs-number">0</span></span>); GLES20.glUniform4fv(muSpecular, <span class="hljs-number"><span class="hljs-number">1</span></span>, mSpecular, <span class="hljs-number"><span class="hljs-number">0</span></span>); GLES20.glUniform1f(muShininess, <span class="hljs-number"><span class="hljs-number">0</span></span>); } GLES20.glDrawElements(GLES20.GL_TRIANGLES, mat.indexBuffer.length, GLES20.GL_UNSIGNED_SHORT, mat.bufOffset * <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre><br><br>  рджреЗрдЦрд╛ред <br><br><h4>  рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд </h4><br>  рд╕рд░реНрд╡рд╡реНрдпрд╛рдкреА рдФрд░ рджрд┐рд╢рд╛рддреНрдордХ рд╣реИрдВред  рджрд┐рд╢рд╛рддреНрдордХ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдлрд┐рд░ рд╕реЗ, рдЬрдм рддрдХ рд╣рдо рдмрд╛рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдПрдХ рдРрд╕реА рдЫрд╛рдпрд╛ рдХреЛ рд▓рд┐рдЦрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИ рдЬреЛ рдирд┐рд░реНрджреЗрд╢ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ), рдореИрдВ рдЪрдХрд╛рдЪреМрдВрдз рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрдж рдХрд╣реВрдВрдЧрд╛ред  рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рд╕реЗ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП shader рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, рдФрд░ рдЗрд╕рдореЗрдВ рдХреБрдЫ рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String vertexShaderCode = <span class="hljs-string"><span class="hljs-string">"precision mediump float;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform mat4 uMVPMatrix;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform mat4 uMVMatrix;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform mat3 uNMatrix;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform vec4 uAmbient;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform vec4 uDiffuse;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform vec4 uSpecular;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"uniform float uShininess;\n"</span></span> + ... <span class="hljs-string"><span class="hljs-string">"vec4 light_point_view_local(vec3 epos, vec3 normal, int idx) {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" vec3 vert2light = uLight[idx].position - epos;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" vec3 ldir = normalize(vert2light);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" vec3 vdir = vec3(0.0, 0.0, 1.0);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" vec3 halfv = normalize(ldir + vdir);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" float NdotL = dot(normal, ldir);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" float NdotH = dot(normal, halfv);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" vec4 outCol = vec4(0.0, 0.0, 0.0, 1.0);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" if (NdotL &gt; 0.0) {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" outCol = uLight[idx].color * uDiffuse * NdotL;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" if (NdotH &gt; 0.0 &amp;&amp; uShininess &gt; 0) {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" outCol += uSpecular * pow(NdotH, uShininess);\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" return outCol;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"}\n"</span></span>;</code> </pre><br><br>  рджрд░рдЕрд╕рд▓, рдПрдирдбреАрдУрдЯреАрдПрдЪ рдХреА рдЧрдгрдирд╛ рдФрд░ рдЖрд╡реЗрджрди рдХреЛ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛ред  рдпрд╣рд╛рдБ uShininess рдФрд░ Material3D рдореЗрдВ shininess рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЖрдпрд╛рдо рд╣реИрдВ, рдореИрдВрдиреЗ рдЙрдирдХреЗ рдмреАрдЪ рд╕рдЯреАрдХ рдкрддреНрд░рд╛рдЪрд╛рд░ рдХрд╛ рдЪрдпрди рдирд╣реАрдВ рдХрд┐рдпрд╛ (рдлрд┐рд░ рд╕реЗ, рдЕрдЧрд░ рдХрд┐рд╕реА рдХреЛ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдРрд╕рд╛ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ)ред <br><br><h4>  рдПрдиреАрдореЗрд╢рди </h4><br>  .3ds рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдмрд╕реЗ рдХрдард┐рди рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╖рдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдПрдирд┐рдореЗрдЯреЗрдб рдкрдЯрд░рд┐рдпреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд┐рдирд╛, рдХреБрдЫ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдФрд░ рдЕрдЧрд░ рд╡рд╕реНрддреБрдПрдВ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдХреНрд▓реЛрди рд╣реИрдВ, рддреЛ рдФрд░ рднреА рдЕрдзрд┐рдХ рддрд╛рдХрд┐ рд╡реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рди рд╣реЛрдВред <br><br>  .3ds рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдПрдХ рд╢реНрд░реЗрдгреАрдмрджреНрдз рдкреЗрдбрд╝ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ "рдкреВрд░реНрд╡рдЬ" рдХреЗ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ "рд╡рдВрд╢рдЬ" рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдкреЗрдбрд╝ рдХреЗ рдХреЛрдиреЗ рдКрдкрд░ рд╕реЗ рдиреАрдЪреЗ рддрдХ рдХреЗ рдХреНрд░рдо рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдЖрд╡реЗрджрди рдХреЛ рдЙрд╕реА рдХреНрд░рдо рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рдЙрддреНрд╕реБрдХ рд╣реИ рдХрд┐ 3 рдбреА рдореЙрдбрд▓ рдХреА .3ds рдлрд╝рд╛рдЗрд▓ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдФрд░ рдХреИрдорд░реЗ рд╕рдорд╛рди рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИрдВ рдЬреЛ рдПрдХ рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдиреАрдореЗрд╢рди рдХреЛ рдЙрд╕реА рддрд░рд╣ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рддрдХ рд╣рдо рдХреЗрд╡рд▓ 3 рдбреА-рдореЙрдбрд▓ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ - рдЙрди рдореЗрдВ рдЖрдВрджреЛрд▓рди, рдШреБрдорд╛рд╡ рдФрд░ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреЗ рдЯреНрд░реИрдХред <br><br>  рдкреНрд░рддреНрдпреЗрдХ рд╡рд╕реНрддреБ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИ: <br><ul><li>  рд╡рд╕реНрддреБ рдХрд╛ рдирд╛рдо; </li><li>  рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╕реНрд╡рдпрдВ рдФрд░ рдЙрд╕рдХреЗ рдкреВрд░реНрд╡рдЬ; </li><li>  рдзреБрд░реА рдмрд┐рдВрджреБ (рдзреБрд░реА, рдЙрд╕ рд╡рд╕реНрддреБ рдХрд╛ рд╕рд╢рд░реНрдд рдХреЗрдВрджреНрд░ рдЬрд┐рд╕рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреБрдорд╛рд╡ рдмрдирд╛ рд╣реЛрддрд╛ рд╣реИ); </li><li>  рд╢рд┐рдлреНрдЯ, рд░реЛрдЯреЗрд╢рди, рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреЗ рдкреНрд░рдореБрдЦ рдлрд╝реНрд░реЗрдореЛрдВ рдХреА рд╕реВрдЪреА, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреИрдорд░рд╛ рдкреИрд░рд╛рдореАрдЯрд░ (рдореИрдВ рдЙрдиреНрд╣реЗрдВ рдЕрдирджреЗрдЦрд╛ рдХрд░рддрд╛ рд╣реВрдВ, рдЬреИрд╕реЗ рдХреИрдорд░реЗ рдЦреБрдж)ред </li></ul><br><br>  рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ рдЯреНрд░реИрдХ рдЙрдмрд╛рдК рд╣реИ, рддреЛ рдЪрд▓рд┐рдП рдмреЗрд╣рддрд░ рддрд░реАрдХреЗ рд╕реЗ рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВред  рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣реИ: <br><ul><li>  рдкреВрд░реНрд╡рдЬ рдкрд░рд┐рд╡рд░реНрддрди рдореИрдЯреНрд░рд┐рдХреНрд╕ (рдЖрдЧрдордирд╛рддреНрдордХ рдкрд░рд┐рдХрд▓реНрдкрдирд╛); </li><li>  рдмрджрд▓рд╛рд╡; </li><li>  рдореЛрдбрд╝ рдХреА рдЧрдард░реА; </li><li>  рд╕реНрдХреЗрд▓рд┐рдВрдЧ; </li><li>  рд╡рд╕реНрддреБ рдХреЗрдВрджреНрд░; </li><li>  рд╕реНрдерд╛рдиреАрдп рд╕рдордиреНрд╡рдп рдкреНрд░рдгрд╛рд▓реА (3D рдореЙрдбрд▓ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рджреЗрдЦреЗрдВ)ред </li></ul><br>  рдпрд╣ рдПрдХ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдпрд╣ рд╕рдм рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИред  рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдФрд░ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рд░рд▓ рд╣реИ: рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдмрд╕ рджреЛ рдлрд╝реНрд░реЗрдореЛрдВ рдХреЗ рдмреАрдЪ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдорд╛рди рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рд╕реЗрдЯ рд╣реЛрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рд╕рднреА рдХреНрд░рдорд╛рдиреБрд╕рд╛рд░ рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП!  рдФрд░ рдореБрдЦреНрдп рдлрд╝реНрд░реЗрдореЛрдВ рдХреЗ рдмреАрдЪ, рд╣рдо рдЙрдЪрд┐рдд рдлреНрд░реЗрдо рдХреА рдЙрдкрдпреБрдХреНрдд рд╕рдВрдЦреНрдпрд╛ рджреНрд╡рд╛рд░рд╛ рдЕрдЧрд▓реЗ рдлреНрд░реЗрдо рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд░реИрдЦрд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рджреЛ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: рд╡рдВрд╢ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╡рд░реНрддрди (рдкрд░рд┐рдгрд╛рдо) рдФрд░ рдореЙрдбрд▓ (рджреБрдирд┐рдпрд╛) рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╡рд░реНрддрдиред  рдкрд╣рд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрджрд╛рдиреБрдХреНрд░рдо рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рджреВрд╕рд░рд╛ - рдЬрдм рдореЙрдбрд▓ рдХрд╛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕рдм рдХрд┐рд╕ рдХреНрд░рдо рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ? <br><br><pre> <code class="java hljs">result = parent.result * move * rotate * scale; world = result * Move(-pivot) * trmatrix;</code> </pre><br>  рдпрд╣ рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЯреНрд░рд╛рдВрд╕рдлрд╝реЙрд░реНрдо рдХреЛ рд╢реАрд░реНрд╖ рдкрд░ "рджрд╛рдПрдВ рд╕реЗ рдмрд╛рдПрдВ" рдХреНрд░рдо рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдУрдкрдирдЬреАрдПрд▓ рдореЗрдВ рдкреНрд░рдерд╛рдЧрдд рд╣реИ)ред  рдпрд╣рд╛рдВ рдЯреНрд░рдореЗрдЯреНрд░рд┐рдХреНрд╕ 3 рдбреА рдореЙрдбрд▓ рдХреЗ рдЪрдВрдХ рдореЗрдВ рдПрдХ рдХрд╛ <i>рдЙрд▓рдЯрд╛ рд╣реИ</i> ред  рдХреБрд▓, рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдордп рдХреЗ рд▓рд┐рдП рд░реВрдкрд╛рдВрддрд░рдг рдЧрдгрдирд╛ рдХреЛрдб (рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп, рд╕рднреА рдлреНрд░реЗрдо рдирдВрдмрд░ 0 рд╕реЗ 1 рддрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдмрджрд▓ рджрд┐рдП рдЧрдП рдереЗ): <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lerp3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] out, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] to, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) out[i] = from[i] + (to[i] - from[i]) * t; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> AnimKey </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findVec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AnimKey[] keys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time)</span></span></span><span class="hljs-function"> </span></span>{ AnimKey key = keys[keys.length - <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// We'll use either first, or last, or interpolated key for (int j = 0; j &lt; keys.length; j++) { if (keys[j].time &gt;= time) { if (j &gt; 0) { float local = (time - keys[j - 1].time) / (keys[j].time - keys[j - 1].time); key = new AnimKey(); key.time = time; key.data = new float[3]; lerp3(key.data, keys[j - 1].data, keys[j].data, local); } else key = keys[j]; break; } } return key; } private void applyRot(float[] result, float[] data, float t) { if (Math.abs(data[3]) &gt; 1.0e-7 &amp;&amp; Math.hypot(Math.hypot(data[0], data[1]), data[2]) &gt; 1.0e-7) Matrix.rotateM(result, 0, (float) (data[3] * t * 180 / Math.PI), data[0], data[1], data[2]); } public void Compute(float time) { int i, n = animations.size(); for (i = 0; i &lt; n; i++) { Animation anim = animations.get(i); Object3D obj = anim.object; float[] result = new float[16]; Matrix.setIdentityM(result, 0); if (anim.position != null &amp;&amp; anim.position.length &gt; 0) { AnimKey key = findVec(anim.position, time); float[] pos = key.data; Matrix.translateM(result, 0, pos[0], pos[1], pos[2]); } if (anim.rotation != null &amp;&amp; anim.rotation.length &gt; 0) { // All rotations that are prior to the target time should be applied sequentially for (int j = anim.rotation.length - 1; j &gt; 0; j--) { if (time &gt;= anim.rotation[j].time) // rotation in the past, apply as is applyRot(result, anim.rotation[j].data, 1); else if (time &gt; anim.rotation[j - 1].time) { // rotation between key frames, apply part of it float local = (time - anim.rotation[j - 1].time) / (anim.rotation[j].time - anim.rotation[j - 1].time); applyRot(result, anim.rotation[j].data, local); } // otherwise, it's a rotation in the future, skip it } // Always apply the first rotation applyRot(result, anim.rotation[0].data, 1); } if (anim.scaling != null &amp;&amp; anim.scaling.length &gt; 0) { AnimKey key = findVec(anim.scaling, time); float[] scale = key.data; Matrix.scaleM(result, 0, scale[0], scale[1], scale[2]); } if (anim.parent != null) Matrix.multiplyMM(anim.result, 0, anim.parent.result, 0, result, 0); else Matrix.translateM(anim.result, 0, result, 0, 0, 0, 0); if (obj != null &amp;&amp; obj.trMatrix != null) { float[] pivot = new float[16]; Matrix.setIdentityM(pivot, 0); Matrix.translateM(pivot, 0, -anim.pivot[0], -anim.pivot[1], -anim.pivot[2]); Matrix.multiplyMM(result, 0, pivot, 0, obj.trMatrix, 0); } else { Matrix.setIdentityM(result, 0); Matrix.translateM(result, 0, -anim.pivot[0], -anim.pivot[1], -anim.pivot[2]); } Matrix.multiplyMM(anim.world, 0, anim.result, 0, result, 0); } }</span></span></code> </pre><br><br>  рдпрд╣ рд╕рдм рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкрд░рд┐рд╖реНрдХреГрдд рдЙрджрд╛рд╣рд░рдгреЛрдВ рдкрд░ рдкрд░реАрдХреНрд╖рдг рдФрд░ рддреНрд░реБрдЯрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдкреВрд░реНрдг рд╕рдЯреАрдХрддрд╛ рдФрд░ рд╡реИрд╕реЗ рднреА рд╢реБрджреНрдзрддрд╛ рд╕реЗ рдбрд░ рд▓рдЧрддрд╛ рд╣реИ, рдпрд╣ рд╕рдм рдмрд╣реБрдд рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╣реИред  рдФрд░ рдпрд╣ рд╕реНрдкреНрд▓рд┐рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рд╣реИ! <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдХрд╛ рдореЙрдбрд▓ рдЪрдХреНрд░ рдЕрдм рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre> <code class="java hljs"> num = scene.animations.size(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; num; i++) { Animation anim = scene.animations.get(i); Object3D obj = anim.object; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; Matrix.multiplyMM(mMVMatrix, <span class="hljs-number"><span class="hljs-number">0</span></span>, mVMatrix, <span class="hljs-number"><span class="hljs-number">0</span></span>, anim.world, <span class="hljs-number"><span class="hljs-number">0</span></span>); Matrix.multiplyMM(mMVPMatrix, <span class="hljs-number"><span class="hljs-number">0</span></span>, mProjMatrix, <span class="hljs-number"><span class="hljs-number">0</span></span>, mMVMatrix, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Apply a ModelView Projection transformation GLES20.glUniformMatrix4fv(muMVPMatrix, 1, false, mMVPMatrix, 0); GLES20.glUniformMatrix4fv(muMVMatrix, 1, false, mMVMatrix, 0); for (j = 0; j &lt; 3; j++) for (k = 0; k &lt; 3; k++) mNMatrix[k*3 + j] = mMVMatrix[k*4 + j]; GLES20.glUniformMatrix3fv(muNMatrix, 1, false, mNMatrix, 0); GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, obj.glVertices); GLES20.glVertexAttribPointer(maPosition, 3, GLES20.GL_FLOAT, false, 32, 0); GLES20.glVertexAttribPointer(maNormal, 3, GLES20.GL_FLOAT, false, 32, 12); GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, 0); ...</span></span></code> </pre><br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдм рдХреБрдЫ рдкрд╣рд▓реЗ рдЬреИрд╕рд╛ рд╣реА рд╣реИред <br><br><h4>  рдирд┐рд╖реНрдХрд░реНрд╖ </h4><br>  рдпрд╣ рд╕рдм, рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬреНрдЮрд╛рди рдХрд╛рдлреА рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдареАрдХ рд╣реИ, рд╕рдмрд╕реЗ рдмреАрдорд╛рд░ рд░реЗрдХ, рдЬрд┐рд╕рдХрд╛ рдореИрдВрдиреЗ рдпрд╣рд╛рдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред  рдпрджрд┐ рдЖрдк рдПрдХ рдмрдирд╛рд╡рдЯ рдбрд╛рдЙрдирд▓реЛрдб рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдореИрдВ рдЗрд╕реЗ рдЕрдкрдиреЗ рд╣реЛрдорд╡рд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝ рджреВрдВрдЧрд╛ред <br><br>  рдареАрдХ рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╡рд╛рджрд╛ рдХрд┐рдП рдЧрдП рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╕реНрд░реЛрдд: <a href="http://pastebin.com/ntB85Jtw">рд╕реАрди 3 рдбреА</a> (рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ) рдФрд░ <a href="http://pastebin.com/A4vhNTuC">рд▓реЛрдб 3 рдбреАрдПрд╕</a> (рд▓реЛрдбрд░)ред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдлрд╛рдЗрд▓реЗрдВ рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб ("/ sdcard /") рдХреА рдЬрдбрд╝ рд╕реЗ рднрд░реА рд╣реБрдИ рд╣реИрдВ, рдореИрдВ рджреГрдврд╝рддрд╛ рд╕реЗ рдЗрд╕реЗ рдХреБрдЫ рдФрд░ рдЙрдЪрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдмрджрд▓рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВред <br><br>  <b>рдЕрдкрдбреЗрдЯ:</b> рдЪреВрдВрдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реА рдкреНрд░рддрд┐рдпрд╛рдВ рдЯреВрдЯреА рд╣реБрдИ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рд╕реНрд░реЛрдд рдХреЛ рдЪреМрд░рд╕рд╛рдИ рд╕рдореВрд╣реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдЬреЛрдбрд╝рд╛ред  рдЗрдВрдбреЗрдХреНрд╕ рдмрдлрд╝рд░реНрд╕ 2-рдмрд╛рдЗрдЯ рд░рд╣рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдУрд╡рд░рдлреНрд▓реЛ рд╕реЗ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ! </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/In144955/">https://habr.com/ru/post/In144955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../In144947/index.html">Aimobilko - рдЕрд╡реИрдз рд░реВрдк рд╕реЗ рдЕрд╡реИрдз?</a></li>
<li><a href="../In144948/index.html">рдПрдЪрдкреА рдИрд╡рд╛ рдбрд┐рд╕реНрдХ рд╕рд░рдгреА - рдЖрд╕рд╛рди!</a></li>
<li><a href="../In144951/index.html">рдореЛрдмрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП HTML5 рдореИрдкреНрд╕</a></li>
<li><a href="../In144952/index.html">рдореЛрдмрд╛рдЗрд▓ рддрдХрдиреАрдХ: рджреБрдирд┐рдпрд╛ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдХрд░рдирд╛</a></li>
<li><a href="../In144954/index.html">Yandex.Maps рдкрд░ рдЙрдкрдЧреНрд░рд╣реЛрдВ рдХреЛ 5 рд╕рд╛рд▓</a></li>
<li><a href="../In144956/index.html">рдУрдкреЗрд░рд╛ рдорд┐рдиреА 7 J2ME, рдмреНрд▓реИрдХрдмреЗрд░реА рдФрд░ S60 рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../In144957/index.html">рд╕реНрдХреНрд░реИрдк рдХреЗ рдЦрд┐рд▓рд╛рдл рдХреЛрдИ рдЪрд╛рд▓ рдирд╣реАрдВ: OpenJDK рд╣реИрдХ рдмрдирд╛рдо рдХрдХреНрд╖рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди</a></li>
<li><a href="../In144958/index.html">рд░реВрд╕ рдореЗрдВ рдкрд╣рд▓реА рдмрд╛рд░ рдорд╣рд┐рд▓рд╛ рдЙрджреНрдпрдорд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП Google рдХрд╛рд░реНрдпрдХреНрд░рдо!</a></li>
<li><a href="../In144959/index.html">рд╕реНрдЯреНрд░реЗрдЯреЛрдЯрд╛рдЗрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рддрд┐рдерд┐ рд╕рдВрд╢реЛрдзрди рдореБрджреНрджрд╛</a></li>
<li><a href="../In144960/index.html">рд╡рд┐рдВрдбреЛрдЬ рд╕рд░реНрд╡рд░ AppFabric рдХрд╛ рдкрд░рд┐рдЪрдпред рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рд╕реЗрд╡рд╛рдПрдБ, рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рдФрд░ WCF рдФрд░ WF рд╕реЗрд╡рд╛рдУрдВ рдХреА рд╕реНрдХреЗрд▓рд┐рдВрдЧ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>