<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç≥ ü§™ üôãüèΩ Etiquetadora para etiquetas labiais - expanda a distor√ß√£o do cilindro programaticamente ü§¥üèº üïï üå∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em nosso aplicativo, h√° um recurso, como o filho da namorada da minha m√£e, Vivino - a defini√ß√£o de vinho de uma fotografia. Sob o cap√¥ - o uso de serv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Etiquetadora para etiquetas labiais - expanda a distor√ß√£o do cilindro programaticamente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424151/">  Em nosso aplicativo, h√° um recurso, como o <s>filho da namorada da minha m√£e,</s> Vivino - a defini√ß√£o de vinho de uma fotografia.  Sob o cap√¥ - o uso de servi√ßos de terceiros, Tineye - para determinar o r√≥tulo mais adequado, o Google Vision - para ler o texto nele.  Este √∫ltimo √© necess√°rio para esclarecer o produto correto, porque  a pesquisa de imagens n√£o leva em considera√ß√£o a import√¢ncia de algumas regi√µes, como regra - s√£o informa√ß√µes textuais - ano e tipo de vinho. <br><br>  No entanto, a precis√£o de ambos os servi√ßos √© visivelmente reduzida devido ao fato de a etiqueta estar distorcida por uma superf√≠cie cil√≠ndrica. <br><br>  Isso √© especialmente percept√≠vel no Google Vision - qualquer texto fora da parte central do r√≥tulo √© praticamente ileg√≠vel, embora uma pessoa o reconhe√ßa facilmente.  Neste artigo, descreverei como reverter a distor√ß√£o e aumentar a precis√£o do reconhecimento do produto. <br><br><img src="https://habrastorage.org/webt/hk/-j/2p/hk-j2p_wkudj1asrh2yllwxcsxc.png"><br><a name="habracut"></a><br>  Antes de tudo, considere o que √© distor√ß√£o. <br><br><img src="https://habrastorage.org/webt/uz/gv/n4/uzgvn4oircmh2r_suij8ofrlrh0.png"><br><br>  A etiqueta retangular, quando colada ao cilindro, tem a forma caracter√≠stica de um barril (b no diagrama acima).  A curva ABC, neste caso, em uma aproxima√ß√£o bastante boa, √© uma elipse, porque  vemos um c√≠rculo (se√ß√£o do cilindro) em √¢ngulo.  As muitas linhas horizontais da etiqueta tamb√©m se transformam em muitas elipses na fotografia. <br><br>  O mais interessante √© que, para expandir o r√≥tulo, basta especificar 6 marcadores (ABCDEF): <br><br><img src="https://habrastorage.org/webt/t2/la/hy/t2lahys1qkcr3-la-6ox-bc0cte.jpeg"><br><br>  E, usando-os, construa uma grade de superf√≠cie completa: <br><br><img src="https://habrastorage.org/webt/b_/om/cc/b_omcchhgmjdtfrxahvm9po67wq.jpeg"><br><br>  Tendo uma grade de superf√≠cie, podemos expandir cada bloco separadamente e obter a superf√≠cie original: <br><br><img src="https://habrastorage.org/webt/up/j8/th/upj8thigpw-fwm_i1a8xmfxx2hg.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O c√≥digo da biblioteca est√° dispon√≠vel no github</a> .  A conveni√™ncia desse m√©todo √© que os par√¢metros de entrada para a transforma√ß√£o inversa s√£o caracter√≠sticas visualmente definidas do r√≥tulo (√¢ngulos e pontos superiores e inferiores), o que permite automatizar completamente o processo. <br><br>  A pr√≥xima parte √© sobre como definir marcadores.  O c√≥digo de trabalho est√° dispon√≠vel apenas parcialmente na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ramifica√ß√£o do github</a> , como  uma solu√ß√£o realmente funcional √© coberta por hacks e xamanismo; portanto, a consci√™ncia simplesmente n√£o permite que essa lata seja carregada no github. <br><br>  Etapa um - converta a imagem em preto e branco. <br><br>  Ent√£o voc√™ precisa obter os contornos da garrafa com a etiqueta.  Para fazer isso, usamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transforma√ß√£o sobel</a> .  Em resumo, esse filtro primeiro desfoca a imagem e depois a subtrai do original.  Como resultado, √°reas uniformes permanecem escuras e as bordas (altera√ß√µes) permanecem claras. <br><br><img src="https://habrastorage.org/webt/jb/cm/rx/jbcmrxypeavsjx7e4f_hkto_c1s.jpeg"><br><br>  A pr√≥xima coisa a fazer √© identificar as duas linhas verticais mais vis√≠veis, que, se voc√™ tiver sorte, s√£o as bordas da garrafa.  Nesse caso, isso √© verdade, mas se voc√™ fotografar uma garrafa ao lado de outras garrafas, esse n√£o ser√° mais o caso. <br><br>  Para determinar essas linhas, use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a transforma√ß√£o Hough</a> .  A ess√™ncia da t√©cnica √© que pegamos muitas linhas que atravessam a tela inteira e consideramos o valor m√©dio dos pixels (por exemplo, pegamos linhas que v√£o da parte superior da imagem para a parte inferior).  Transferimos esses valores para o novo plano de coordenadas e obtemos algo como um mapa de calor.  Neste mapa de calor, estamos procurando dois extremos - eles s√£o as linhas laterais. <br><br>  O diagrama abaixo mostra como a linha esquerda vai para um ponto no novo plano de coordenadas: <br><br><img src="https://habrastorage.org/webt/d2/1b/qz/d21bqzk-hlfbfg7n43esn0_x2ey.png"><br><br>  Com as elipses, √© um pouco mais complicado, mas sabendo que a transforma√ß√£o Hough pode ser aplicada a qualquer curva matematicamente definida, usaremos esse m√©todo novamente, mas desta vez procuraremos muitas curvas el√≠pticas. <br><br>  Mas primeiro voc√™ precisa trazer o problema para uma forma bidimensional.  Sabendo que a garrafa √© centralmente sim√©trica, pegamos o eixo central da coordenada Y e um lado para X. Para os valores no novo plano de coordenadas, pegamos muitas elipses constru√≠das entre o eixo central e o lado.  Isso √© poss√≠vel devido ao fato de que um ponto arbitr√°rio no lado e no eixo central possui apenas um m√©todo de conex√£o.  Talvez isso n√£o seja muito √≥bvio √† primeira vista, mas √© muito mais f√°cil entender se recorrermos √† f√≥rmula param√©trica da elipse: <br><br>  x = a * cos (t) <br>  y = b * sin (t) <br><br><img src="https://habrastorage.org/webt/kk/st/pk/kkstpkiy3-opp98_zabantk4lmc.jpeg"><br><br>  Exatamente da mesma maneira, encontramos os dois extremos procurados que definem duas elipses de r√≥tulo (curvas AB, FE).  Agora que temos todos os par√¢metros de etiqueta necess√°rios (curvas laterais e elipses superior e inferior), podemos aplicar o algoritmo da primeira parte do artigo e executar a transforma√ß√£o inversa. <br><br>  O que pode ser melhorado.  Primeiramente, o algoritmo n√£o leva em considera√ß√£o a distor√ß√£o da perspectiva da elipse em si, como resultado, os fragmentos laterais do r√≥tulo s√£o esticados um pouco mais do que deveriam.  Para fazer uma corre√ß√£o, voc√™ precisa conhecer o √¢ngulo de vis√£o real da c√¢mera ou, pelo menos, usar o mais comum para o telefone (voc√™ pode escolher empiricamente). <br><br>  Em segundo lugar, a transforma√ß√£o Hough funciona bastante inst√°vel em condi√ß√µes dif√≠ceis - por exemplo, quando garrafas adjacentes caem na estrutura e as bordas da garrafa de interesse podem n√£o ser detectadas corretamente. <br><br>  Em terceiro lugar, se o r√≥tulo n√£o tiver uma forma retangular (por exemplo, el√≠ptica), os marcadores ser√£o detectados incorretamente e a transforma√ß√£o distorcer√° a imagem apenas com mais for√ßa. <br><br>  Na pr√°tica, √© muito mais interessante usar uma rede neural para identificar marcadores, porque  ele pode ser treinado usando exemplos complexos para que, no m√≠nimo, o algoritmo n√£o realize transforma√ß√£o se marcadores n√£o puderem ser determinados.  Mas at√© agora eu n√£o tentei usar o neur√¥nio para esta tarefa, ent√£o talvez este seja o t√≥pico de um artigo separado :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424151/">https://habr.com/ru/post/pt424151/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424139/index.html">Os erros e conceitos errados mais comuns ao configurar o DFSR</a></li>
<li><a href="../pt424141/index.html">Design de jogos para a vida. A Economia do Jogo (Parte I)</a></li>
<li><a href="../pt424143/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 271 (de 17 a 23 de setembro)</a></li>
<li><a href="../pt424147/index.html">Telltale √© tudo. Uma pena</a></li>
<li><a href="../pt424149/index.html">Freq√º√™ncia de aquarela de 96 qps: revolu√ß√£o ou formato de tumulto na cinematografia</a></li>
<li><a href="../pt424153/index.html">(N√£o) mudar para a Mold√°via</a></li>
<li><a href="../pt424155/index.html">A s√©rie "First": The Dark Side of Cosmonautics</a></li>
<li><a href="../pt424157/index.html">SDKMAN - Morto, viva ao longo SDKMAN</a></li>
<li><a href="../pt424159/index.html">Esta√ß√µes de descida da miss√£o Hayabusa 2 pousaram com sucesso na superf√≠cie do aster√≥ide 1999 JU3</a></li>
<li><a href="../pt424161/index.html">Resist√™ncia forense 1 ou Last-ikActivityView. Dados de atividade do usu√°rio no Windows 10 e como exclu√≠-lo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>