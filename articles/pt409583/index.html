<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏿 👩‍🔬 🔋 Netflix: o que acontece quando você clica em reproduzir? 🙈 🤹🏾 👨🏼‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo é um capítulo do meu novo livro, Explique a nuvem para uma criança de dez anos . A primeira opção foi escrita especificamente para aqueles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Netflix: o que acontece quando você clica em reproduzir?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409583/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a86/b6d/d36/a86b6dd362d675c80d696decff2ce0e8.jpg"></div><br>  Este artigo é um capítulo do meu novo livro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Explique a nuvem para uma criança de dez anos</a> .  A primeira opção foi escrita especificamente para aqueles que precisam de uma introdução às nuvens.  Depois, fiz algumas atualizações e adicionei alguns capítulos - "Netflix: o que acontece quando você pressiona iniciar?"  e "O que é computação em nuvem?"  - que já estão um pouco além do conhecimento de um iniciante.  Eu acho que eles poderão interessar até pessoas bastante experientes. <br><br>  Portanto, se você precisa de uma boa introdução às nuvens ou conhece alguém que precisa, dê uma olhada.  Eu acho que você vai gostar.  Tenho orgulho do que fiz. <br><br>  Escrevi este capítulo com base em uma dúzia de fontes, às vezes se contradizendo.  Os principais fatos mudam com o tempo e dependem de quem conta a história e de qual público.  Tentei fazer uma história coerente sempre que possível.  Observe que este não é um guia técnico - este é um artigo com imagens grandes.  Por exemplo, eu nunca mencionei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">microsserviços</a> . <br><br>  Netflix parece tão simples.  Clique em "play" e o vídeo aparecerá magicamente.  Simples, certo?  Sim, na verdade não. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/53b/fd6/267/53bfd626796d89f697249e21c064381f.jpg"><br><br>  Após nossas discussões no capítulo "O que é computação em nuvem?"  você pode esperar que o Netflix funcione com vídeo usando a AWS.  Clique em "play" no aplicativo Netflix e o vídeo armazenado no S3 será transmitido diretamente para o seu dispositivo via Internet através da Internet. <br><br>  Uma abordagem perfeitamente razoável - para um serviço que é muito menor. <br><br>  Mas a Netflix está completamente errada.  Tudo é muito mais complicado e interessante do que você imagina. <br><br>  Para entender o porquê, vejamos as estatísticas da Netflix para 2017: <br><br><ul><li>  Mais de 110 milhões de assinantes. </li><li>  Trabalhe em mais de 200 países. </li><li>  Receita de US $ 3 bilhões por trimestre. </li><li>  Adiciona 5 milhões de assinantes por trimestre. </li><li>  Reproduz mais de um bilhão de horas de vídeo semanalmente.  Em comparação, o YouTube reproduz 1 bilhão de horas de vídeo por dia, enquanto o Facebook reproduz 110 milhões de horas de vídeo por dia. </li><li>  Em um dia de 2017, 250 milhões de horas de vídeo foram reproduzidas. </li><li>  Responsável por 37% do pico de tráfego da Internet nos EUA. </li><li>  Planeja gastar US $ 7 bilhões em novos conteúdos em 2018. </li></ul><br><h2>  O que aprendemos? </h2><br>  Netflix é enorme.  É global, tem muitos assinantes, reproduz uma enorme quantidade de vídeos e tem muito dinheiro. <br><br>  Outro fato pertinente é que o Netflix funciona por assinatura.  Os assinantes pagam Netflix mensalmente e podem cancelar a assinatura a qualquer momento.  Quando você pressiona "play" para relaxar no Netflix, seria melhor se esse serviço funcionasse normalmente.  Cancelar inscrição de inscritos insatisfeitos. <br><br><h2>  Dê uma olhada mais profunda </h2><br>  A Netflix é um ótimo exemplo das idéias que discutimos, portanto, este capítulo terá muito mais detalhes do que descrever outros serviços em nuvem.  Uma razão para explorar a Netflix em profundidade é que eles fornecem muito mais informações do que outras empresas.  As comunicações da Netflix são consideradas um importante ativo cultural, e a empresa mantém com mais êxito seus padrões. <br><br>  Eu gostaria de agradecer à Netflix por sua abertura sobre sua arquitetura.  Ao longo dos anos, a empresa deu centenas de palestras e escreveu centenas de artigos sobre os detalhes de seus padrões internos de trabalho.  Isso ajuda a melhorar todo o setor. <br><br>  Outro motivo para esses detalhes detalhados é que o serviço Netflix é simplesmente incrível.  A maioria de nós já o usou - e quem não estaria interessado em olhar nos bastidores e descobrir como isso funciona? <br><br><h2>  Netflix é executado em duas nuvens - AWS e Open Connect </h2><br>  Como a empresa satisfaz os clientes?  Com a ajuda das nuvens.  De fato, duas nuvens diferentes - AWS e Open Connect.  Os dois devem trabalhar juntos sem problemas para produzir muitas horas de conteúdo de vídeo que satisfaça os usuários. <br><br><h2>  Três partes do Netflix: cliente, back-end, rede de entrega de conteúdo </h2><br>  Você pode dividir mentalmente o Netflix em três partes: cliente, back-end, CDN (rede de distribuição de conteúdo). <br><br>  Cliente - uma interface de usuário executada em qualquer dispositivo usado para exibir listas de vídeos e reproduzi-las.  Pode ser um aplicativo móvel em um smartphone, um site em um computador desktop ou até mesmo um aplicativo em uma TV inteligente.  A Netflix controla todos os clientes em todos os dispositivos. <br><br>  Tudo o que acontece antes de você clicar no botão play acontece no back-end em execução na AWS.  Isso inclui coisas como preparar todos os novos vídeos recebidos e processar solicitações de todos os aplicativos, sites, televisores e outros dispositivos. <br><br>  Tudo o que acontece depois de clicar em "play" é processado no Open Connect.  Esta é a rede de entrega de conteúdo da Netflix.  Ele armazena vídeos em vários lugares ao redor do mundo.  Quando você clica em "reproduzir", o fluxo de vídeo vem do Open Connect para o seu dispositivo e é mostrado pelo cliente.  Não se preocupe - falaremos sobre a CDN mais tarde.  Curiosamente, o processo de lançamento de vídeo da empresa não se chama "clique em" reproduzir ", mas" clique em "iniciar" no nome ". Cada setor tem seu próprio jargão. <br><br>  Controlando todas as três áreas - cliente, back-end, CDN - a Netflix alcançou total integração vertical.  A empresa controla sua experiência de assistir a vídeos do início ao fim.  Portanto, ele simplesmente funciona quando você clica em "reproduzir" em qualquer parte do mundo.  Você tem a garantia de obter o conteúdo de que precisa, aquele que deseja assistir e quando quiser. <br><br>  Vamos ver exatamente como isso acontece. <br><br><h2>  Em 2008, a Netflix começou a se mudar para a AWS </h2><br>  O Netflix está em operação desde 1998. No início, era vendido por aluguel de DVDs.  Mas a empresa viu o futuro ao transmitir vídeo sob demanda.  Em 2007, a Netflix lançou seu serviço de vídeo sob demanda, que permitia que os assinantes transmitissem programas de TV e filmes através do site da empresa em computadores pessoais ou através do software especial da empresa em várias plataformas suportadas, incluindo smartphones e tablets, players digitais e jogos decodificadores e TVs inteligentes. <br><br>  O futuro do streaming de vídeo sob demanda pode parecer óbvio.  Em princípio, era.  Pessoalmente, trabalhei em algumas startups tentando emitir vídeos sob demanda.  Eles falharam.  E a Netflix estava esperando pelo sucesso.  A empresa definitivamente funcionou bem, mas chegou tarde ao mercado, o que a ajudou.  Em 2007, a Internet era rápida e barata o suficiente para suportar serviços de streaming de vídeo.  Isso não aconteceu antes.  O advento do tráfego móvel rápido e não muito caro e a introdução de dispositivos móveis poderosos, como smartphones e tablets, tornaram mais fácil e barato assistir a vídeos a qualquer hora e em qualquer lugar.  O momento certo é a chave do sucesso. <br><br><h2>  Netflix começou com seus próprios data centers </h2><br>  O EC2 estava começando em 2007, na mesma época em que o Netflix estava começando.  Portanto, o Netflix não pôde começar a usar o EC2.  A empresa construiu dois data centers localizados nas proximidades.  E eles experimentaram todos os problemas que discutimos nos capítulos anteriores. <br><br>  Construir data centers é muito caro.  Leva tempo para encomendar equipamentos, sua instalação e lançamento.  Imediatamente após o lançamento, eles ficaram sem energia e tudo teve que começar tudo de novo.  O tempo gasto em equipamentos forçou a empresa a adotar uma estratégia de escala vertical. <br><br>  A Netflix escreveu grandes programas que rodavam em computadores grandes.  Essa abordagem é chamada de construção de um monólito.  Um programa fez tudo.  O problema é que, se você crescer tão rápido quanto o Netflix, é muito difícil criar um monólito confiável.  Ele não era confiável. <br><br><h2>  A negação de serviço forçou a Netflix a mudar para a AWS </h2><br>  Em agosto de 2008, a Netflix não pôde enviar DVDs por três dias consecutivos devido a uma falha no banco de dados.  Isso foi inaceitável.  Era necessário resolver alguma coisa.  A experiência de construir data centers ensinou à empresa uma coisa importante: não funcionou bem na construção de data centers.  Ela era boa em entregar vídeos para seus clientes.  Ela precisava se concentrar em melhorias na entrega de vídeo, em vez de melhorias na construção de data centers.  A construção de data centers não era uma vantagem competitiva da empresa - sua vantagem era a entrega de vídeo. <br><br>  Naquela época, a Netflix decidiu mudar para a AWS.  A AWS estava apenas começando, por isso foi uma decisão ousada.  A empresa mudou-se para a AWS porque precisava de uma infraestrutura mais confiável.  A Netflix queria eliminar todas as fraquezas do sistema.  A AWS ofereceu bancos de dados, armazenamento e data centers redundantes altamente confiáveis.  A Netflix precisava de serviços em nuvem para não criar monólitos não confiáveis.  A Netflix queria se tornar um serviço global sem construir seus data centers.  Tais oportunidades em seus antigos datacenters não eram e não poderiam ser. <br><br>  A Netflix escolheu a AWS porque não queria se envolver em trabalho duro indiferenciado.  Trabalho duro indiferenciado é o que precisa ser feito, mas isso não traz nenhuma vantagem para o negócio principal, que consiste em fornecer uma visualização de vídeo de qualidade.  A AWS faz todo esse trabalho duro para a Netflix.  E isso dá aos netflixers a oportunidade de se concentrar em fornecer serviços comerciais valiosos. <br><br>  A mudança de uma empresa de seus data centers para a AWS levou mais de oito anos.  A Netflix aumentou o número de clientes oito vezes durante esse período.  A Netflix agora roda em várias centenas de milhares de cópias do EC2. <br><br><h2>  AWS Netflix mais confiável </h2><br>  Não que a Netflix nunca tenha tido problemas com a AWS, mas, em geral, seu serviço se tornou muito mais confiável do que antes.  Você não verá mais essas reclamações: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af4/f3a/f92/af4f3af926d818952f1562667f6e8662.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/23d/91d/5b2/23d91d5b2ccf5da53507d412ef5ff293.jpg"><br><br>  A empresa se tornou tão confiável quanto tomou medidas extraordinárias para isso.  Opera em três regiões da AWS: Virgínia do Norte, Portland, Oregon e Dublin, Irlanda.  Em cada um deles, o Netflix opera em três zonas de acesso diferentes. <br><br>  A empresa não tem planos de aumentar o número de regiões de trabalho.  Adicionar novas regiões é muito difícil e caro.  A maioria das empresas opera em apenas uma região, sem mencionar duas ou três. <br><br>  A vantagem de trabalhar em três regiões é que uma delas pode cair e as outras duas se encaixam e atendem clientes da região afetada.  A Netflix chama a queda da evacuação da região. <br><br>  Considere um exemplo.  Suponha que você esteja assistindo a um novo episódio de "House of Cards" em Londres, Inglaterra.  Provavelmente, seu dispositivo está conectado à região de Dublin, pois é o mais próximo.  O que acontece quando a região de Dublin cai?  A Netflix deixará de funcionar para você?  Não.  Quando um problema é detectado, o Netflix o redireciona para a Virgínia.  Seu dispositivo se comunicará com a região Virgin em vez de Dublin.  Você pode nem perceber falhas. <br><br>  Com que frequência a região da AWS falha?  Uma vez por mes  Bem, na verdade a região não falha todos os meses.  A Netflix realiza testes mensais.  A cada mês, a Netflix descarta especificamente toda a região, apenas para garantir que seu sistema lide com falhas regionais.  Você pode evacuar a região em seis minutos. <br><br>  A Netflix chama isso de modelo de serviço global.  Cada cliente pode ser atendido de qualquer região.  Isso é incrível.  E isso não acontece automaticamente.  A AWS não possui um molho mágico para lidar com a falha de regiões ou atender clientes de diferentes regiões.  A própria Netflix fez o trabalho.  A empresa é pioneira na criação de sistemas confiáveis ​​usando várias regiões.  Não conheço outras empresas que tomariam essas medidas para garantir a confiabilidade do serviço. <br><br>  Outra vantagem de trabalhar nessas três regiões é que o Netflix pode cobrir o mundo inteiro.  A Netflix realizou verificações e descobriu que, ao iniciar o aplicativo em qualquer lugar do mundo, em qualquer caso, você receberá um serviço rápido de uma dessas regiões. <br><br><h2>  Netflix salva usando a AWS </h2><br>  Isso pode surpreender muitos, mas o AWS para Netflix é mais barato.  O custo da nuvem em termos de visualização do vídeo sai várias vezes menos do que ao usar data centers antigos.  Porque  Devido à elasticidade da nuvem. <br><br>  O Netflix pode adicionar servidores conforme necessário e devolvê-los quando não forem necessários.  Em vez de um monte de computadores adicionais sem fazer nada, apenas aguardando o pico de carga, a empresa usa exatamente quantos computadores forem necessários e quando necessário. <br><br><h2>  O que acontece na AWS antes de você clicar em reproduzir? </h2><br>  Tudo o que não está conectado com o arquivamento do vídeo é processado na AWS.  Isso inclui poder de computação escalável, armazenamento escalável, lógica de negócios, bancos de dados distribuídos escaláveis, processamento e análise de big data, recomendações, transcodificação e centenas de outras funções.  Você não precisa entender todos, mas, como isso pode lhe parecer interessante, explicarei brevemente. <br><br><h2>  Energia e armazenamento escaláveis ​​para computação </h2><br>  O poder de computação escalável é EC2 e o armazenamento é S3.  Não há nada novo para nós aqui.  Seu dispositivo é um iPhone, TV, Xbox, smartphone Android, tablet etc.  - comunica-se com um serviço em execução no EC2.  Seu dispositivo recebe uma lista de filmes em potencial para assistir entrando em contato com um computador executando o EC2.  Informações detalhadas sobre o vídeo que seu dispositivo recebe lá.  Tudo funciona da mesma forma que em outros serviços em nuvem. <br><br><h2>  Bancos de dados distribuídos escaláveis </h2><br>  A Netflix usa o DynamoDB e o Cassandra como bancos de dados distribuídos.  Esses nomes não devem significar nada para você - são apenas bancos de dados de alta qualidade.  Os dados são armazenados no banco de dados.  Informações sobre seu perfil, contas, todos os filmes assistidos - tudo isso é armazenado no banco de dados.  Os bancos de dados distribuídos não funcionam em um computador grande, mas em muitos computadores.  Seus dados são copiados para muitos computadores, para que, mesmo que um ou dois computadores que armazenam seus dados falhem, eles estarão seguros.  Na realidade, todos os dados são copiados nas três regiões.  Por esse motivo, no caso de uma falha na região, seus dados estarão disponíveis em outra região para a qual você será alternado.  E a escala significa que o banco de dados poderá armazenar o máximo de dados que você adicionar a ele.  Essa é uma das principais vantagens dos bancos de dados distribuídos.  Se mais dados chegarem, mais computadores poderão ser adicionados. <br><br><h2>  Processamento e análise de big data </h2><br>  Big data é apenas um monte de dados.  A Netflix coleta muitas informações.  A empresa sabe quem assistiu, quando e onde eles assistiram.  A empresa sabe quais vídeos seus clientes visualizaram, mas não fizeram o pedido.  Ela sabe quantas vezes cada vídeo foi assistido - e muito mais. <br><br>  Coletar e converter todos os dados em um formato padrão é chamado de processamento.  E extrair significado deles - análise.  Os dados são analisados ​​para obter respostas a perguntas específicas. <br><br><h2>  A Netflix personaliza imagens especialmente para você </h2><br>  Aqui está um ótimo exemplo de como a Netflix o atrai a assistir a mais filmes usando os recursos de análise de dados.  Ao navegar pelas listas, escolhendo o que ver, você prestou atenção ao fato de que para cada filme é emitida uma foto?  Esta é a imagem do título. <br><br>  A imagem do título deve intrigá-lo, atrair sua atenção e fazer você escolher este vídeo.  A ideia é que, quanto mais intrigante a imagem, maior a probabilidade de você assistir ao vídeo.  E quanto mais vídeos você assiste, menor a probabilidade de cancelar a inscrição no Netflix. <br><br>  Aqui está um exemplo das várias imagens de título da série Stranger Things: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/368/3d5/31f/3683d531fe4f0fdff525eb466260ed86.jpg"><br><br>  Você pode se surpreender ao ver que cada imagem de cada vídeo é selecionada especificamente para você.  Nem todo mundo vê as mesmas imagens. <br><br>  Anteriormente, todos viram as mesmas imagens do título.  Aqui está como funcionou.  Foi mostrada aos clientes uma imagem selecionada aleatoriamente de um conjunto, como a mostrada na ilustração acima.  O Netflix contou todas as visualizações de vídeo e registrou a imagem exibida ao usuário quando um vídeo foi selecionado.  Suponha, no nosso exemplo da série, que, ao mostrar a foto central da colagem, o vídeo tenha sido assistido 1000 vezes.  E ao mostrar o restante das fotos - apenas uma vez. <br><br>  Como a imagem do grupo era melhor do que as outras para atrair usuários, a Netflix precisou transformá-la na imagem-título da série para sempre.  Isso é chamado de seleção baseada em dados.  O Netflix funciona com base na análise de dados.  Os dados são coletados - nesse caso, o número de visualizações associadas a cada figura - e usados ​​para tomar as melhores decisões - nesse caso, para selecionar uma figura de título. <br><br>  Astuciosamente, mas isso pode ser feito ainda melhor?  Sim, usando ainda mais dados.  Para este tópico, o futuro está na solução de problemas, aprendendo com os dados.  Nós somos pessoas diferentes.  Você acha que as mesmas imagens podem nos motivar?  Provavelmente não.  Temos gostos diferentes, preferências diferentes.  E a Netflix sabe disso - agora, ela personaliza todas as imagens que mostra.  Ela está tentando escolher uma imagem que destaque o aspecto mais importante do vídeo para você.  Como ela faz isso? <br><br>  Lembre-se de que o Netflix registra e conta tudo o que você faz em seu site.  Ela sabe quais filmes você gosta, quais atores você gosta, e assim por diante.  Suponha que entre suas recomendações estava o filme "Caça à Boa Vontade".  A Netflix deve escolher uma imagem de cabeçalho adequada.  O objetivo é mostrar uma imagem que diga que este filme pode ser do seu interesse.  Que imagem você precisa mostrar? <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se você gosta de comédias, a Netflix mostrará uma imagem com Robin Williams. Se você preferir melodramas, a Netflix mostrará uma imagem de Matt Damon e Minnie Driver prestes a se beijar. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c9b/002/6f5/c9b0026f553c8d004e33ae7dfdb58a7c.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apresentando Robin Williams, o serviço informa que é provável que o filme tenha humor e, como a Netflix sabe que você gosta de comédias, este vídeo é ideal para você. Image Matt Damon e Minnie Driver enviam uma mensagem completamente diferente. Se você gosta de comédias e vê esta foto, provavelmente sentirá falta dela. Portanto, escolher a imagem certa é muito importante. Ele envia uma forte mensagem personalizada contando sobre o tema do filme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui está outro exemplo - Pulp Fiction:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1df/d6d/a0c/1dfd6da0c5c128b97f7d4893c4d2f32d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se você assistiu a muitos filmes com Uma Thurman, provavelmente verá a imagem do título com Uma. Se você assistiu a muitos filmes com Travolta, provavelmente verá a imagem do título com John. Veja como escolher a melhor imagem personalizada possível pode aumentar a probabilidade de assistir a um vídeo específico?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Netflix agrada ao seu interesse ao escolher imagens, mas o serviço não deseja mentir para você. Ele não deseja mostrar apenas uma imagem atraente para fazer você assistir a um vídeo que não gosta. Não há incentivo. O serviço não cobra pelo número de visualizações. O serviço tenta minimizar o arrependimento e deseja que você goste do que está assistindo, para selecionar a melhor imagem de título possível. E este é apenas um pequeno exemplo de análise de dados. A Netflix usa essas estratégias em todos os lugares.</font></font><br><br><h2>  Recomendações </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Netflix geralmente mostra de 40 a 50 opções de vídeo, mas o serviço oferece milhares de vídeos. </font><font style="vertical-align: inherit;">Como a Netflix decide o que mostrar? </font><font style="vertical-align: inherit;">Pelo aprendizado de máquina. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso faz parte do processamento e análise de big data que acabamos de falar. </font><font style="vertical-align: inherit;">O serviço examina os dados e prevê o que você pode gostar. </font><font style="vertical-align: inherit;">Em geral, tudo o que você vê na tela do Netflix foi selecionado especificamente para você usando o aprendizado de máquina.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transcodificação do arquivo de origem para o formato necessário </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E assim descobrimos como a Netflix lida com o vídeo. </font><font style="vertical-align: inherit;">Antes de começar a assistir no seu dispositivo favorito, a Netflix deve converter o vídeo no formato que melhor se adequa ao seu dispositivo. </font><font style="vertical-align: inherit;">Esse processo é chamado de transcodificação. </font><font style="vertical-align: inherit;">Ele converte um arquivo de vídeo de um formato para outro, para que o vídeo possa ser assistido em diferentes plataformas e dispositivos. </font><font style="vertical-align: inherit;">A Netflix codifica todos os seus vídeos na AWS em 300.000 processadores simultaneamente. </font><font style="vertical-align: inherit;">Isso é mais do que quase qualquer supercomputador!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fonte de dados Fonte </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem envia vídeos para a Netflix? </font><font style="vertical-align: inherit;">Estúdios e associações de produção. </font><font style="vertical-align: inherit;">A Netflix chama isso de dados brutos. </font><font style="vertical-align: inherit;">O novo vídeo é enviado à equipe de conteúdo para processamento. </font><font style="vertical-align: inherit;">Ele vem em alta resolução, com muitos terabytes de tamanho. </font><font style="vertical-align: inherit;">Para imaginar um terabyte de informação, imagine 60 pilares de papel, cada um com altura igual à Torre Eiffel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de assistir ao vídeo, o Netflix o expõe a um processo severo de várias etapas.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/994/abf/8c5/994abf8c5dfe146ba1d6844a747c37b3.jpg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verificação da qualidade </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, a Netflix gasta muito tempo verificando a qualidade do vídeo. </font><font style="vertical-align: inherit;">Ela procura artefatos digitais, alterações de cores, quadros perdidos que podem aparecer devido a tentativas anteriores de transcodificação ou problemas de transferência de dados. </font><font style="vertical-align: inherit;">Se algum problema for detectado, o vídeo será rejeitado.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transportador de processamento </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de confirmar, a qualidade do vídeo é enviada ao pipeline de processamento. Essa é uma sequência de etapas pelas quais os dados passam antes de serem usados ​​- algo como uma correia transportadora em uma fábrica. Mais de 70 programas de processamento diferentes são usados ​​para criar cada vídeo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O processamento de um único arquivo de vários terabytes é impraticável; portanto, o primeiro passo no pipeline será dividir o vídeo em vários pedaços pequenos. As peças passam ao longo do transportador para que possam ser codificadas em paralelo - ou seja, são processadas simultaneamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostramos paralelização usando um exemplo.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/29f/0ee/c83/29f0eec83a51c561ef380328cf9122fb.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que você tenha cem cães sujos que precisam ser lavados. </font><font style="vertical-align: inherit;">Como será mais rápido fazer isso - se uma pessoa lavar um cão após o outro, ou se você contratar uma centena de lavadoras de cães e lavá-las todas ao mesmo tempo? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, o processo será mais rápido se cem arruelas trabalharem ao mesmo tempo. </font><font style="vertical-align: inherit;">Isso é paralelismo. </font><font style="vertical-align: inherit;">É por isso que a Netflix usa tantos servidores EC2. </font><font style="vertical-align: inherit;">Eles precisam de muitos servidores para processar esses arquivos de vídeo gigantes em paralelo. </font><font style="vertical-align: inherit;">E funciona - a empresa afirma que o arquivo de origem pode ser codificado e enviado para a CDN em apenas 30 minutos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando as peças são codificadas, elas são verificadas para garantir que não apresentem novos problemas. </font><font style="vertical-align: inherit;">Em seguida, eles são coletados novamente em um arquivo e verificados novamente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O resultado é um monte de arquivos </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O processo de codificação cria muitos arquivos. </font></font> Porque<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O objetivo final da Netflix é oferecer suporte a todos os dispositivos conectados à Internet. A empresa começou a operar em 2007 na plataforma Microsoft Windows. Com o tempo, muitos outros dispositivos foram adicionados - Roku, LG, Samsung Blu-ray, Apple Mac, Xbox 360, LG DTV, Sony PS3, Nintendo Wii, Apple iPad, Apple iPad, Apple iPhone, Apple TV, Android, Kindle Fire e Comcast X1.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No total, o Netflix suporta 2.200 dispositivos diferentes. Para cada um deles existe um formato de vídeo com a melhor aparência. Se você assiste à Netflix em um iPhone, verá o vídeo com melhor aparência em um iPhone. A empresa chama todos os vários formatos de vídeo de perfil de codificação. A Netflix também cria arquivos otimizados para diferentes velocidades de rede. Se você assistir a um arquivo em uma rede de alta velocidade, verá um vídeo de melhor qualidade do que se o assistisse em uma rede mais lenta.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Também existem arquivos para vários formatos de áudio. </font><font style="vertical-align: inherit;">O áudio é codificado em diferentes níveis de qualidade e idiomas diferentes. </font><font style="vertical-align: inherit;">Além disso, existem arquivos com legendas. </font><font style="vertical-align: inherit;">Um vídeo pode ter várias legendas em diferentes idiomas. </font><font style="vertical-align: inherit;">Existem várias opções de visualização diferentes para cada vídeo. </font><font style="vertical-align: inherit;">O que você vê depende do seu dispositivo, qualidade da conexão, tarifa de serviço e escolha do idioma.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Então, quantos arquivos existem? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para a série, The Crown Netflix armazena cerca de 1200 arquivos. </font><font style="vertical-align: inherit;">A segunda temporada de Stranger Things tem ainda mais arquivos. </font><font style="vertical-align: inherit;">Foi filmado em resolução 8K e tem nove episódios. </font><font style="vertical-align: inherit;">Os arquivos de origem ocupam muitos terabytes de dados. </font><font style="vertical-align: inherit;">Foram necessárias 190.000 horas de processador para codificar apenas uma temporada. </font><font style="vertical-align: inherit;">O resultado são 9.570 arquivos de vídeo, áudio e texto diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos ver como o Netflix reproduz todos esses arquivos.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Três estratégias diferentes para streaming de vídeo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Netflix possui três estratégias diferentes para reproduzir streaming de vídeo: CDN pequeno, CDN de terceiros e Open Connect. </font><font style="vertical-align: inherit;">Vamos começar com a definição de CDN. </font><font style="vertical-align: inherit;">CDN é uma rede de distribuição de conteúdo. </font><font style="vertical-align: inherit;">Para a Netflix, o conteúdo é, obviamente, os arquivos de vídeo que discutimos na seção anterior. </font><font style="vertical-align: inherit;">Compartilhar significa que os arquivos são copiados de um local central na rede e armazenados em computadores distribuídos em todo o mundo. </font><font style="vertical-align: inherit;">Na Netflix, o local central de armazenamento de arquivos é S3.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por que criar uma CDN? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A idéia é simples: você precisa posicionar o vídeo o mais próximo possível dos usuários, distribuindo computadores em todo o mundo. Quando um usuário quiser assistir a um vídeo, encontre o computador mais próximo dele e organize um fluxo a partir daí para o dispositivo. Os maiores benefícios da CDN são velocidade e confiabilidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine que você está assistindo a um vídeo em Londres e ele está sendo transmitido para você de Portland, Oregon. O fluxo de vídeo precisa passar por muitas redes, incluindo o cabo submarino, para que a conexão seja lenta e não confiável. Ao aproximar o vídeo das pessoas que o assistem, você pode tornar a emoção de assistir a um vídeo mais rápida e confiável.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada local do computador que armazena o vídeo é chamado de ponto de presença (PoP). </font><font style="vertical-align: inherit;">Cada PoP é um local físico com acesso à Internet. </font><font style="vertical-align: inherit;">Existem servidores, roteadores e outros equipamentos de telecomunicações. </font><font style="vertical-align: inherit;">Falaremos sobre PoP mais tarde.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A primeira CDN era muito pequena </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em 2007, quando a Netflix lançou seu serviço de streaming, ele contava com 36 milhões de assinantes em 50 países, que assistiam mais de um bilhão de horas de vídeo por mês e que recebiam vários terabits de dados por segundo. </font><font style="vertical-align: inherit;">Para oferecer suporte ao serviço, a Netflix criou seu próprio CDN simples em cinco locais diferentes nos Estados Unidos. </font><font style="vertical-align: inherit;">O catálogo de vídeos da empresa era pequeno o suficiente e todos os arquivos foram armazenados em todos os lugares.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O segundo CDN era muito grande </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em 2009, a Netflix decidiu usar uma CDN de terceiros. Naquela época, o custo da CDN começou a cair. Usar redes de terceiros foi uma jogada inteligente para a Netflix. Por que perder tempo e esforço construindo suas redes se você pode alcançar imediatamente qualquer lugar do planeta com as CDNs existentes? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Netflix trabalhou para fornecer serviços de CDN a empresas como Akamai, Limelight e Nível 3. Não há nada de errado em usar CDNs de terceiros. De fato, quase todas as empresas fazem isso. Por exemplo, a NFL usou os serviços da Akamai para apresentar competições de futebol americano ao vivo. Sem criar suas próprias CDNs, a Netflix liberou tempo para trabalhar em outros projetos prioritários.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A empresa gastou muito tempo e esforço desenvolvendo clientes mais inteligentes. A Netflix criou algoritmos que se adaptam às mudanças nas condições da rede. Mesmo em caso de erros, sobrecargas na rede ou no servidor, a empresa deseja que os usuários tenham a melhor imagem possível. Uma das tecnologias desenvolvidas pela empresa - mudar para outra fonte de vídeo - por exemplo, para outra CDN ou outro servidor - para obter o melhor resultado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao mesmo tempo, a Netflix gasta muito esforço no suporte a todos os serviços da AWS mencionados anteriormente. A Netflix chama os serviços da AWS de um plano de referência. O plano de controle é um termo de rede para a parte do sistema que controla todo o resto. No seu corpo, seu cérebro é o plano de controle - controla todo o resto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E então a Netflix decidiu que eles poderiam melhorar o serviço desenvolvendo sua própria CDN. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O Open Connect foi perfeito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em 2011, a Netflix percebeu que, em sua escala, precisavam de uma solução CDN dedicada para maximizar a eficiência da rede. </font><font style="vertical-align: inherit;">A distribuição de vídeo é uma competência essencial da empresa e pode ser uma enorme vantagem competitiva. </font><font style="vertical-align: inherit;">Portanto, a Netflix começou a desenvolver o Open Connect, seu próprio CDN especial. </font><font style="vertical-align: inherit;">Tudo começou em 2012. </font><font style="vertical-align: inherit;">O Open Connect tem muitas vantagens:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ela não é tão cara. </font><font style="vertical-align: inherit;">CDNs de terceiros são mais caros. </font><font style="vertical-align: inherit;">Fazer você mesmo significa economizar muito dinheiro.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhor qualidade. </font><font style="vertical-align: inherit;">A Netflix argumentou que, ao controlar todo o caminho do vídeo - transcodificação, CDN, clientes, dispositivos - ele poderia oferecer excelente qualidade de serviço.</font></font></li><li>  .         .          ,     . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDNs de terceiros devem oferecer suporte a usuários que precisam acessar qualquer conteúdo de qualquer lugar do mundo. </font><font style="vertical-align: inherit;">A tarefa da Netflix era muito mais simples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Netflix conhece seus usuários com certeza enquanto se inscrevem. </font><font style="vertical-align: inherit;">Ela sabe quais vídeos transferir. </font><font style="vertical-align: inherit;">Só porque você só precisa transferir grandes fluxos de vídeo, é possível executar várias ações para otimizar redes de maneira inteligente que outras CDNs não podem executar. </font><font style="vertical-align: inherit;">A Netflix também sabe muito sobre seus clientes. </font><font style="vertical-align: inherit;">A empresa sabe quais vídeos eles gostam e quando gostam de assisti-los. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com esse conhecimento, a Netflix construiu uma CDN de alta velocidade. </font><font style="vertical-align: inherit;">Vamos dar uma olhada em como o Open Connect funciona.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abrir dispositivos de conexão </font></font></h2><br>  Lembra como discutimos que os computadores CDN são distribuídos pelo mundo?  A Netflix desenvolveu seu próprio sistema de computador para armazenamento de vídeo.  A Netflix chama de dispositivos Open Connect (Open Connect Appliances, OCA).  Veja como era uma das primeiras instalações da OCA: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b34/0f8/629/b340f86291912cda64508cf51cb6a14f.jpg"><br><br>  Na foto - vários OCA de uma só vez.  Os OCA são agrupados em clusters de vários servidores.  Cada OCA é um servidor rápido e otimizado para saída de arquivos grandes, com muitos discos rígidos ou unidades flash armazenando vídeo.  Veja como é um dos servidores OCA: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcc/2ec/fd7/dcc2ecfd70116f59a8282e5ed2610496.jpg"><br><br>  Para propósitos diferentes, existem vários tipos diferentes de OCA.  Existem grandes OCA capazes de armazenar todo o diretório de vídeos da empresa.  Existem OSAs pequenos que podem armazenar apenas parte do diretório de vídeo.  Os OCAs pequenos são preenchidos com arquivos de vídeo diariamente durante o horário de pico durante o cache proativo. <br><br>  Em termos de equipamento, o OSA não tem nada de extraordinário.  Eles são baseados em componentes de PC convencionais e vários fornecedores os montam em vários pacotes.  Você pode comprar os mesmos computadores, se quiser.  Observe que todos os computadores Netflix estão vermelhos.  A empresa os ordena especificamente para que correspondam à cor do logotipo. <br><br>  Em termos de software, os OSAs usam o FreeBSD OS e o nginx como um servidor web.  Sim, todo OSA é um servidor web.  Os fluxos de vídeo usam nginx.  Se esses nomes não disserem nada a você - não desanime, eu os incluo apenas para completar a figura. <br><br>  O número de OSAs locais depende da confiabilidade que a Netflix deseja obter em um determinado local, a quantidade de tráfego que atende e a porcentagem de tráfego que esse centro pode enviar como um fluxo.  Ao clicar em "reproduzir", você assiste a um fluxo de vídeo proveniente de um OSA específico - como o acima, localizado perto de você. <br><br>  Para uma melhor experiência de visualização, a Netflix gostaria de armazenar em cache o vídeo em sua casa.  Mas, por enquanto, isso é impraticável.  A próxima opção mais conveniente é colocar um mini-Netflix perto de sua casa.  Como isso pode ser feito? <br><br><h2>  Onde a Netflix hospeda o OCA? </h2><br>  A Netflix distribui enormes quantidades de vídeo de milhares de servidores localizados em mais de 1000 data centers em todo o mundo.  Veja este mapa de localização do servidor de vídeo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/989/432/e6e/989432e6e76da6fbc748bf7526e1b0a5.jpg"><br><br>  Outros serviços de vídeo, como YouTube e Amazon, entregam vídeo em suas próprias redes.  Essas empresas literalmente criaram suas próprias redes globais para fornecer vídeo aos usuários.  É muito complicado e caro.  A Netflix adota uma abordagem completamente diferente para criar uma CDN. <br><br>  A Netflix não funciona em sua rede, não funciona em seus próprios data centers.  Em vez disso, os ISPs concordam em hospedar o OCA.  A Netflix oferece aos provedores gratuitamente para integrar seus servidores à sua rede, além disso, coloca o OSA próximo aos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pontos de troca de tráfego</a> (local de troca de internet, IXP). <br><br>  Essa estratégia permite que a Netflix não construa seus próprios datacenters, mas a empresa obtém todas as vantagens de estar nesse centro - apenas pertence a outra pessoa.  Engenhoso!  Vamos dividir os últimos parágrafos em etapas mais simples. <br><br><h2>  Usando o ISP para criar uma CDN </h2><br>  O ISP é seu provedor de serviços de Internet.  É quem fornece a Internet como um serviço.  Pode ser Verizon, Comcast, Beeline ou um dos milhares de outros.  O principal é que os ISPs estão localizados em todo o mundo e estão próximos dos clientes.  Ao hospedar o OCA nos datacenters de ISP, a Netflix também é distribuída em todo o mundo e perto de seus clientes. <br><br><h2>  Usando o IXP para criar uma CDN </h2><br>  Um ponto de troca de tráfego é um datacenter em que o ISP e a CDN trocam tráfego entre redes.  É como ir a uma festa para trocar presentes de Natal com os amigos.  Compartilhar é mais fácil se todos estiverem reunidos em um só lugar. <br><br>  IXP espalhados pelo mundo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/711/42c/f34/71142cf34f7a2e0377a0e678e09f1cf6.jpg"><br><br>  Aqui está a aparência do IXP em Londres: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ac/d18/980/0acd1898087a4b6bb0c6d191b2429f2b.jpg"><br><br>  Se você se aproximar desses cabos de fibra óptica amarelos, eis o que você verá (com base no ponto de troca AMS-IX em Amsterdã): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/90d/656/136/90d656136a66b2ccfb7d519b3729819b.jpg"><br><br>  Cada cabo conecta uma rede à outra.  É assim que redes diferentes trocam tráfego entre si.  IXP é como um intercâmbio rodoviário, apenas com fios: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c85/311/e9f/c85311e9f4c874c23e089313b7cd43f4.jpg"><br><br>  Para a Netflix, essa é outra vantagem.  Os IXPs estão localizados em todo o mundo.  Ao colocar o OSA no IXP, a empresa pode não ter mais seus próprios data centers. <br><br><h2>  Vídeo proativamente armazenado em cache no OSA </h2><br>  A Netflix possui vários vídeos localizados no S3.  Os computadores transmissores de vídeo estão localizados em todo o mundo.  Só falta uma coisa: o vídeo em si!  A Netflix usa um processo chamado cache proativo para copiar com eficiência o vídeo para o OCA. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c1b/c17/728/c1bc17728e459f6fb135da8e8cb59cd1.jpg"><br><br>  O que é cache  cache - cache]?  Este é um local frequentemente localizado na terra onde cartuchos secretos, alimentos e tesouros são armazenados em segredo.  Você sabe como esquilos escondem nozes para o inverno?  Todo lugar onde um esquilo escondeu uma noz é um esconderijo.  No inverno, qualquer esquilo pode encontrar um monte de nozes e mastigá-las.  Os exploradores do Ártico enviam pequenas equipes à frente que armazenam alimentos, combustível e outros suprimentos pelo caminho a seguir.  Uma equipe maior correndo atrás para em cada cache e restaura.  Tanto as proteínas quanto os pesquisadores do Ártico trabalham proativamente;  eles estão fazendo algo com antecedência para se preparar para o futuro. <br><br>  Cada OCA é um cache de vídeo do que você provavelmente deseja assistir.  A Netflix armazena em cache o vídeo, prevendo o que você deseja assistir.  Em todo o mundo, a Netflix sabe com grande certeza que seus clientes adoram assistir.  Lembra que dissemos que a Netflix é uma empresa orientada a dados?  Ela usa dados de popularidade para prever quais vídeos seus clientes provavelmente assistirão amanhã em qualquer lugar.  Por local aqui, entende-se um cluster OSA localizado no ISP ou IXP.  A empresa copia os vídeos previstos para um ou mais OCA em cada um dos locais.  Isso é chamado de layout preliminar.  O vídeo está hospedado no OSA antes que alguém o solicite.  Como resultado, os clientes recebem um excelente serviço.  O vídeo que eles querem assistir já está perto deles, em um formulário pronto para visualização. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/413/f48/a7b/413f48a7b2b1a431181206df70fabca7.jpg"><br><br>  A Netflix trabalha com os chamados  cache vinculado.  Os OCAs pequenos são hospedados pelo ISP ou IXP.  Eles são pequenos demais para caber no catálogo de vídeos inteiro.  Em outros lugares, existem OSAs com quase todo o diretório de vídeos do Netflix.  E em outro lugar, há lugares onde o OSA contém o catálogo inteiro da Netflix.  Eles recebem vídeos do S3. <br><br>  Todas as noites, o OSA acorda e pesquisa o serviço da AWS para saber que tipo de vídeo ele precisa.  O serviço envia a ele uma lista de vídeos que ele deveria ter, construído com base em previsões.  Cada OCA é responsável por ter todos os vídeos nesta lista.  Se um dos OCA em um local tiver um dos vídeos necessários, o OCA em cache copiará esse vídeo dele.  Caso contrário, o vídeo será encontrado e retirado de alguns OSA, localizados não muito longe. <br><br>  Como a Netflix prevê que será popular amanhã, sempre haverá uma desvantagem um dia antes que o vídeo seja necessário no OSA.  Isso significa que o vídeo pode ser copiado em um momento silencioso, fora do pico de carga, o que reduz bastante o uso da largura de banda do ISP. <br><br>  O Open Connect nunca apresenta erros de cache.  Uma falta é quando um vídeo específico é solicitado à OSA e ele responde que não o possui.  Ocorrem erros em outras CDNs porque eles não podem copiar todo o conteúdo em qualquer lugar.  Como o Netflix conhece todos os vídeos que precisam ser armazenados em cache, ele sabe exatamente onde e quais vídeos estão em que momento.  Se um OSA pequeno não tiver o vídeo desejado, ele será garantido por um dos principais OSA. <br><br>  E por que a Netflix não copia todos os seus vídeos para toda a OCA do mundo?  O diretório de vídeo dela é grande demais para isso.  Em 2013, o volume do catálogo excedeu 3 petabytes;  o que ele é hoje, não sei, só posso assumir isso muito mais.  É por isso que a empresa desenvolveu um método para selecionar arquivos de vídeo que precisam ser armazenados em cada OSA, usando dados que prevêem que os assinantes desejarão assistir. <br><br>  Veja um exemplo.  "House of Cards" é um programa muito popular.  Para qual OSA ele deve ser copiado?  Provavelmente, em todos os lugares, como assinantes de todo o mundo querem assistir.  Mas e se o vídeo não for tão popular quanto o House of Cards?  A Netflix decide em quais locais as cópias devem ser armazenadas para melhor atender às necessidades de todos os clientes imediatos. <br><br>  Em um só lugar, os vídeos mais populares são copiados para muitos OSA.  Quanto mais popular o vídeo, mais servidores armazenam uma cópia dele.  Porque  Se um vídeo muito popular tivesse apenas uma cópia, o fluxo de vídeo para todos os clientes sobrecarregaria o servidor. <br><br>  Um vídeo não é considerado preparado para distribuição se for copiado para apenas um OSA.  A Netflix deseja reproduzir o mesmo conteúdo ao mesmo tempo em todo o mundo.  Somente quando houver um número suficiente de OSA com um número suficiente de cópias do vídeo para fornecer a qualidade certa, o vídeo será considerado preparado para visualização. <br><br>  Por exemplo, a segunda temporada do programa Demolidor em 2016 foi a primeira vez que a Netflix lançou todos os episódios da série em todos os dispositivos em todos os países ao mesmo tempo. <br><br><h2>  Posicionamento OSA: por que os provedores precisam disso? </h2><br>  Por que os fornecedores concordam em hospedar clusters OSA?  À primeira vista, isso é muito generoso - mas será interessante descobrir que o lucro pessoal está realmente envolvido aqui.  Para entender isso, precisamos falar sobre como as redes funcionam.  Neste livro, discutimos que o acesso aos serviços em nuvem é via Internet.  No caso da Netflix, isso não é verdade - ao assistir vídeo através do aplicativo Netflix, ele se comunica com a AWS pela Internet.  [não está muito claro que diferença o autor tinha em mente // aprox.  perev.] <br><br>  A Internet é a interconexão de redes.  Você tem um provedor que fornece acesso à Internet.  Eu recebo meu serviço de internet da Comcast.  Isso significa que minha casa está conectada à rede Comcast via fibra ótica.  A rede Comcast pertence a eles - isso não é a Internet, a Internet é outra coisa. <br><br>  Suponha que eu queira fazer uma pesquisa no Google, digite uma solicitação no navegador e pressione Enter.  Meu pedido primeiro passa pela rede Comcast.  O Google não está localizado na rede Comcast.  Em algum momento, minha solicitação deve ir para a Rede do Google.  Para isso, existe a Internet.  A Internet conecta a rede Comcast à rede do Google.  Existem protocolos de roteamento que funcionam da maneira de um controlador de tráfego de rua e tráfego de rede direto.  Quando minha solicitação é enviada à Internet, ela fica fora da rede da Comcast e fora da Rede do Google.  Ele está localizado na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">espinha dorsal da Internet</a> .  A Internet está conectada a partir de muitas redes privadas que decidem interagir entre si.  IXP é uma das maneiras pelas quais as redes se comunicam. <br><br>  Nos EUA, há um mapa de redes de fibra distantes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/204/83b/69a/20483b69a61535edd9aaa59f32f504f4.jpg"><br><br>  A Netflix fez o seguinte com seu Open Connect: hospedava clusters OSA em redes ISP.  Isso significa que, se eu assistir a um vídeo do Netflix, estou conversando com um OSA localizado na rede Comcast.  Todo o meu tráfego de vídeo entra na rede deles e não fica online. <br><br>  A chave para escalar a entrega de vídeo é estar o mais próximo possível do usuário.  Ao fazer isso, você não está usando backbones da Internet.  As solicitações são atendidas na parte local da rede.  Por que isso é bom?  Lembre-se, dissemos que o Netflix já consome mais de 37% do tráfego da Internet nos EUA.  Se o ISP não cooperasse com a empresa, usaria ainda mais a Internet.  A Internet não conseguiu lidar com todo o tráfego.  Os fornecedores precisariam adicionar mais capacidade, o que é muito caro. <br><br>  Agora, quase 100% do conteúdo da Netflix é transmitido nas redes de provedores.  Isso reduz o custo de manutenção da rede, porque não obstrui a Internet.  Ao mesmo tempo, os assinantes do Netflix recebem vídeo de alta qualidade e o desempenho da rede melhora para todos.  Todo mundo ganha. <br><br><h2>  Conexão aberta confiável e resiliente </h2><br>  Já discutimos como o Netflix aumenta a confiabilidade do sistema trabalhando em três regiões da AWS.  A arquitetura Open Connect atinge os mesmos objetivos.  Isso pode não ser óbvio, mas os OCA são independentes um do outro.  As OCAs funcionam como arquipélagos de entrega de vídeo independentes.  Os assinantes que recebem vídeo de um OSA não sofrem com falhas de outro OSA. <br><br>  O que acontece quando o OSA falha?  O programa cliente que você está usando muda instantaneamente para outro OSA e continua a exibição.  O que acontece se muitas pessoas usam OCA em um só lugar?  O programa cliente encontra um OSA menos carregado.  O que acontece se a rede usada para transmitir vídeo estiver sobrecarregada?  A mesma coisa - o programa encontra outro OSA na rede que funciona melhor.  O Open Connect é um sistema muito confiável e tolerante a falhas. <br><br><h2>  Netflix controla o cliente </h2><br>  A Netflix lida de maneira inteligente com falhas, pois controla o cliente em todos os dispositivos.  A própria empresa desenvolve aplicativos para Android e iOS, para que possamos esperar que os controle.  Mas mesmo em plataformas como a Smart TV, onde a Netflix não criou clientes, ainda a controla porque controla o SDK (pacote de desenvolvimento de aplicativos). <br><br>  SDKs são um conjunto de programas de desenvolvimento que permitem criar aplicativos.  Cada aplicativo Netflix faz solicitações da AWS e reproduz vídeos usando o SDK.  Ao controlar o SDK, a Netflix pode se adaptar constantemente e em tempo real a redes lentas, falha de OSA e outros possíveis problemas. <br><br>  E finalmente: é isso que acontece quando você clica em "reproduzir" <br><br>  Percorremos um longo caminho em direção a isso e aprendemos muito.  Aqui está o que sabemos no momento: <br><br><ul><li>  O Netflix pode ser dividido em três partes: back-end, cliente e CDN. </li><li>  Todas as solicitações de clientes são atendidas pela AWS. </li><li>  Todos os vídeos são transferidos do dispositivo Open Connect (OCA) mais próximo para a CDN. </li><li>  A Netflix trabalha com três regiões da AWS e geralmente pode lidar com falhas em qualquer região, para que ninguém perceba. </li><li>  O novo conteúdo é convertido na empresa em vários formatos diferentes, para que você possa escolher a opção mais adequada com base no tipo de dispositivo, qualidade da rede, localização geográfica e taxa de assinantes. </li><li>  Todos os dias, no Open Connect, a empresa distribui vídeos ao redor do mundo sem prever o que os assinantes vão querer assistir em diferentes partes do mundo. </li></ul><br>  Aqui está a imagem que a Netflix descreve usando o processo de reprodução: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/077/f3a/59e/077f3a59eba98e189f19abfcf4c91a9a.jpg"><br><br>  Vamos terminar: <br><br><ul><li>  Você seleciona um vídeo para assistir usando um cliente em execução em algum dispositivo.  O cliente envia uma solicitação de reprodução, indicando qual vídeo você precisa, para o serviço Playback Apps da AWS. </li><li>  Não discutimos isso antes, mas a maior parte do que acontece quando você clica em "reproduzir" está relacionada ao licenciamento.  Nem todas as partes do mundo têm licença para visualizar cada vídeo.  A Netflix deve determinar se você tem uma licença para assistir a um vídeo específico.  Não discutiremos esse tópico chato, mas lembre-se de que isso acontece o tempo todo.  Uma das razões pelas quais a Netflix começou a criar seu próprio conteúdo foi uma tentativa de evitar problemas de licenciamento [e ainda existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">situações absurdas em</a> que a empresa não pode exibir a série de produção da Netflix porque vendeu seus direitos a um provedor de conteúdo local - sem mencionar todos os territórios proibidos para o trabalho de empresas americanas // aprox.  transl.].  A Netflix quer lançar programas para todas as pessoas ao redor do mundo ao mesmo tempo.  Criar seu próprio conteúdo é a maneira mais fácil de evitar problemas de licenciamento. </li><li>  Dadas todas as informações relevantes, o serviço Playback Apps retorna a URL para vários, até dez, servidores OSA.  Esses são os mesmos URLs que você pode ver no seu navegador.  A Netflix usa seu endereço IP e informações do seu provedor para determinar quais clusters OSA são melhores para você. </li><li>  O cliente analisa a situação e seleciona o OCA.  Ele verifica a qualidade da conexão com cada um deles.  Ele se conectará ao OSA mais rápido e confiável.  O cliente realiza essas verificações constantemente durante a reprodução do vídeo. </li><li>  O cliente está tentando escolher a melhor maneira de receber conteúdo do OSA. </li><li>  O cliente se conecta ao OSA e começa a emitir o fluxo de vídeo no seu dispositivo. </li><li>  Ao assistir a um vídeo, você percebeu que a qualidade da imagem está mudando?  Às vezes, haverá pixels e, depois de algum tempo, a imagem volta à alta qualidade novamente?  Isso ocorre porque o cliente se adapta à qualidade da rede.  Se a qualidade diminuir, o cliente reduzirá a qualidade do vídeo.  Se a qualidade cair muito, o cliente mudará para outro OSA. </li></ul><br>  É o que acontece quando você clica em "reproduzir" no Netflix.  Quem pensaria que uma coisa tão simples, como assistir a um vídeo, poderia ser tão complicada? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt409583/">https://habr.com/ru/post/pt409583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt409569/index.html">Descolamento de retina - o que é importante saber sobre ele</a></li>
<li><a href="../pt409571/index.html">Como criar um alienígena - pensamentos sobre o design de espécies exóticas</a></li>
<li><a href="../pt409575/index.html">Divisão por zero, a resposta é infinita para o nosso universo?</a></li>
<li><a href="../pt409579/index.html">Intel NUC Hades Canyon - Um novo crânio com cérebro. E olhos</a></li>
<li><a href="../pt409581/index.html">Tello Inteligente Minidron</a></li>
<li><a href="../pt409585/index.html">Telegram planeja criar sua própria plataforma blockchain</a></li>
<li><a href="../pt409593/index.html">O pop perdeu seu apelo?</a></li>
<li><a href="../pt409595/index.html">Visão geral de plásticos FDM de alta temperatura para impressão 3D industrial</a></li>
<li><a href="../pt409597/index.html">Mars Reconnaissance Orbiter parece detectar gelo em Marte</a></li>
<li><a href="../pt409601/index.html">Revisão 3Dtool da impressora Zenit 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>