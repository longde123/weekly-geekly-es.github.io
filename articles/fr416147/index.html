<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖüèª üê§ üéñÔ∏è Organisation de la navigation dans les applications iOS √† l'aide du Root Controller ü§±üèø üçú ‚õπüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart des applications mobiles contiennent plus d'une douzaine d'√©crans, des transitions complexes, ainsi que des parties de l'application, s√©par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organisation de la navigation dans les applications iOS √† l'aide du Root Controller</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416147/"><img src="https://habrastorage.org/webt/uf/0h/3q/uf0h3qqyj6c6tnvj6fbf4089bye.jpeg"><br><br>  La plupart des applications mobiles contiennent plus d'une douzaine d'√©crans, des transitions complexes, ainsi que des parties de l'application, s√©par√©es par leur signification et leur objectif.  Par cons√©quent, il est n√©cessaire d'organiser la structure de navigation correcte pour l'application, qui sera flexible, pratique, extensible, fournira un acc√®s confortable aux diff√©rentes parties de l'application et fera √©galement attention aux ressources du syst√®me. <br><br>  Dans cet article, nous allons concevoir la navigation dans l'application de mani√®re √† √©viter les erreurs les plus courantes qui entra√Ænent des fuites de m√©moire, ruinent l'architecture et cassent la structure de navigation. <br><a name="habracut"></a><br>  La plupart des applications comportent au moins deux parties: l'authentification (pr√©-connexion) et la partie priv√©e (post-connexion).  Certaines applications peuvent avoir une structure plus complexe, plusieurs profils avec une seule connexion, des transitions conditionnelles apr√®s le d√©marrage de l'application (liens profonds), etc. <br><br>  En pratique, deux approches sont principalement utilis√©es pour naviguer dans l'application: <br><br><ol><li>  Une pile de navigation pour les contr√¥leurs de pr√©sentation (pr√©sents) et les contr√¥leurs de navigation (push), sans possibilit√© de revenir en arri√®re.  Cette approche fait que tous les ViewControllers pr√©c√©dents restent en m√©moire. </li><li>  Utilise la bascule window.rootViewController.  Avec cette approche, tous les ViewControllers pr√©c√©dents sont d√©truits en m√©moire, mais cela ne semble pas le meilleur du point de vue de l'interface utilisateur.  De plus, il ne vous permet pas de vous d√©placer d'avant en arri√®re si n√©cessaire. </li></ol><br>  Voyons maintenant comment vous pouvez cr√©er une structure facilement maintenable qui vous permet de basculer de mani√®re transparente entre les diff√©rentes parties de l'application, sans code spaghetti et navigation facile. <br><br>  Imaginons que nous √©crivons une application compos√©e de: <br><br><ul><li>  L'√©cran principal (√©cran <b>Splash</b> ): c'est le tout premier √©cran que vous voyez, d√®s que l'application d√©marre, vous pouvez ajouter, par exemple, une animation ou faire des requ√™tes API principales. </li><li>  <b>Partie authentification</b> : connexion, enregistrement, r√©initialisation du mot de passe, confirmation par e-mail, etc.  La session de travail de l'utilisateur est g√©n√©ralement enregistr√©e, il n'est donc pas n√©cessaire d'entrer une connexion √† chaque d√©marrage de l'application. </li><li>  <b>Partie principale</b> : la logique m√©tier de l'application principale </li></ul><br>  Toutes ces parties de l'application sont isol√©es les unes des autres et existent chacune dans sa propre pile de navigation.  Par cons√©quent, nous pouvons avoir besoin des transitions suivantes: <br><br><ul><li>  <b>√âcran de d√©marrage -&gt; √©cran d'authentification</b> , si la session en cours de l'utilisateur actif est absente. </li><li>  <b>√âcran de d√©marrage -&gt;</b> √âcran <b>principal</b> , si l'utilisateur s'est d√©j√† connect√© √† l'application plus t√¥t et qu'il y a une session active. </li><li>  <b>√âcran principal -&gt; √©cran d'authentification</b> , au cas o√π l'utilisateur se d√©connecterait </li></ul><br><br>  <b>R√©glage de base</b> <br><br>  Lorsque l'application d√©marre, nous devons initialiser le <i>RootViewController</i> , qui sera charg√© en premier.  Cela peut √™tre fait √† la fois avec du code et via Interface Builder.  Cr√©ez un nouveau projet dans xCode et tout cela sera d√©j√† fait par d√©faut: <i>main.storyboard est</i> d√©j√† li√© √† <i>window.rootViewController</i> . <br><br>  Mais afin de nous concentrer sur le sujet principal de l'article, nous n'utiliserons pas de storyboards dans notre projet.  Par cons√©quent, supprimez <i>main.storyboard</i> et effacez √©galement le champ ¬´Interface principale¬ª sous Cibles -&gt; G√©n√©ral -&gt; Informations de d√©ploiement: <br><br><img src="https://habrastorage.org/webt/kc/ku/cq/kckucqq5vpiklb5p7kyp7rwgqfu.png"><br><br>  <i>Modifions maintenant la</i> m√©thode <i>didFinishLaunchingWithOptions</i> dans <i>AppDelegate</i> pour qu'elle ressemble √† ceci: <br><br><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { window = <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>(frame: <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds) window?.rootViewController = <span class="hljs-type"><span class="hljs-type">RootViewController</span></span>() window?.makeKeyAndVisible() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  Maintenant, l'application lancera d'abord le <i>RootViewController</i> .  Renommez le <i>ViewController de</i> base en <i>RootViewController</i> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController { }</span></span></span></span></code> </pre> <br>  Ce sera le contr√¥leur principal responsable de toutes les transitions entre les diff√©rentes sections de l'application.  Par cons√©quent, nous aurons besoin d'un lien vers celui-ci chaque fois que nous voulons effectuer la transition.  Pour ce faire, ajoutez l'extension √† <i>AppDelegate</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shared: <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIApplication</span></span>.shared.delegate <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rootViewController: <span class="hljs-type"><span class="hljs-type">RootViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> window!.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">RootViewController</span></span> } }</code> </pre> <br>  <i>La r√©cup√©ration forc√©e d'une option dans ce cas est justifi√©e, car le RootViewController ne change pas, et si cela se produit par accident, le plantage de l'application est une situation normale.</i> <i><br></i> <br>  Donc, maintenant nous avons un lien vers le <i>RootViewController</i> de n'importe o√π dans l'application: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rootViewController = <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.shared.rootViewController</code> </pre> <br>  <i>Cr√©ons</i> maintenant quelques contr√¥leurs suppl√©mentaires dont nous avons besoin: <i>SplashViewController, LoginViewController</i> et <i>MainViewController</i> . <br><br>  Splash Screen est le premier √©cran qu'un utilisateur verra apr√®s le d√©marrage de l'application.  √Ä ce stade, toutes les demandes d'API n√©cessaires sont g√©n√©ralement effectu√©es, l'activit√© de session utilisateur est v√©rifi√©e, etc.  Pour afficher les actions d'arri√®re-plan en cours, utilisez <i>UIActivityIndicatorView</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> activityIndicator = <span class="hljs-type"><span class="hljs-type">UIActivityIndicatorView</span></span>(activityIndicatorStyle: .whiteLarge) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() view.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.white view.addSubview(activityIndicator) activityIndicator.frame = view.bounds activityIndicator.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>(white: <span class="hljs-number"><span class="hljs-number">0</span></span>, alpha: <span class="hljs-number"><span class="hljs-number">0.4</span></span>) makeServiceCall() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre> <br>  Afin de simuler des demandes d'API, ajoutez la m√©thode <i>DispatchQueue.main.asyncAfter</i> avec un d√©lai de 3 secondes: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { activityIndicator.startAnimating() <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: <span class="hljs-type"><span class="hljs-type">DispatchTime</span></span>.now() + .seconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.activityIndicator.stopAnimating() } }</code> </pre> <br>  Nous pensons que la session utilisateur est √©galement d√©finie dans ces demandes.  Dans notre application, nous utilisons pour cela <i>UserDefaults</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { activityIndicator.startAnimating() <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: <span class="hljs-type"><span class="hljs-type">DispatchTime</span></span>.now() + .seconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.activityIndicator.stopAnimating() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">UserDefaults</span></span>.standard.bool(forKey: ‚Äú<span class="hljs-type"><span class="hljs-type">LOGGED_IN</span></span>‚Äù) { <span class="hljs-comment"><span class="hljs-comment">// navigate to protected page } else { // navigate to login screen } } }</span></span></code> </pre><br>  <i>Vous n'utiliserez certainement pas UserDefaults pour enregistrer l'√©tat d'une session utilisateur dans la version finale du programme.</i>  <i>Nous utilisons des param√®tres locaux dans notre projet pour simplifier la compr√©hension et ne pas aller bien au-del√† du sujet principal de l'article.</i> <br><br>  Cr√©ez un <i>LoginViewController</i> .  Il sera utilis√© pour authentifier l'utilisateur si la session utilisateur actuelle est inactive.  Vous pouvez ajouter votre interface utilisateur personnalis√©e au contr√¥leur, mais je n'ajouterai ici que le titre de l'√©cran et le bouton de connexion dans la barre de navigation. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() view.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.white title = <span class="hljs-string"><span class="hljs-string">"Login Screen"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> loginButton = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Log In"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: #selector(login)) navigationItem.setLeftBarButton(loginButton, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// store the user session (example only, not for the production) UserDefaults.standard.set(true, forKey: "LOGGED_IN") // navigate to the Main Screen } }</span></span></code> </pre> <br>  Et enfin, cr√©ez le contr√¥leur principal de l'application <i>MainViewController</i> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MainViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = UIColor.lightGray // <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> visually distinguish the protected part title = ‚ÄúMain Screen‚Äù let logoutButton = UIBarButtonItem(title: ‚Äú<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>‚Äù, style: .plain, target: self, action: #selector(logout)) navigationItem.setLeftBarButton(logoutButton, animated: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) } @objc private func logout() { // clear the <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> (example <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the production) UserDefaults.standard.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, forKey: ‚ÄúLOGGED_IN‚Äù) // navigate <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the Main Screen } }</code> </pre> <br>  <b>Navigation racine</b> <br><br>  Revenons maintenant au <i>RootViewController</i> . <br>  Comme nous l'avons dit pr√©c√©demment, <i>RootViewController</i> est le seul objet responsable des transitions entre les diff√©rentes piles de contr√¥leurs ind√©pendants.  Afin de conna√Ætre l'√©tat actuel de l'application, nous allons cr√©er une variable dans laquelle nous allons stocker le <i>ViewController</i> actuel: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> }</code> </pre> <br>  Ajoutez l'initialiseur de classe et cr√©ez le premier <i>ViewController</i> que nous voulons charger au d√©marrage de l'application.  Dans notre cas, ce sera <i>SplashViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } }</code> </pre> <br>  Dans <i>viewDidLoad,</i> ajoutez le <i>viewController</i> actuel au <i>RootViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() addChildViewController(current) <span class="hljs-comment"><span class="hljs-comment">// 1 current.view.frame = view.bounds // 2 view.addSubview(current.view) // 3 current.didMove(toParentViewController: self) // 4 } }</span></span></code> </pre> <br>  Une fois que nous avons ajout√© <i>childViewController</i> (1), nous ajustons sa taille en d√©finissant <i>current.view.frame</i> sur <i>view.bounds</i> (2). <br><br>  Si nous <i>sautons</i> cette ligne, le <i>viewController</i> sera toujours plac√© correctement dans la plupart des cas, mais des probl√®mes peuvent survenir si la taille du <i>cadre</i> change. <br><br>  Ajoutez une nouvelle sous-vue (3) et appelez la m√©thode didMove (toParentViewController :).  Ceci terminera l'op√©ration d'ajout de contr√¥leur.  D√®s que le <i>RootViewController d√©marre</i> , imm√©diatement apr√®s que le <i>SplashViewController est</i> affich√©. <br><br>  Vous pouvez maintenant ajouter plusieurs m√©thodes de navigation dans l'application.  Nous afficherons le <i>LoginViewController</i> sans aucune animation, le <i>MainViewController</i> utilisera l'animation avec une gradation douce et la transition des √©crans lors de la d√©connexion de l'utilisateur aura un effet de diapositive. <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... func showLoginScreen() { let new = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UINavigationController</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoginViewController</span></span></span><span class="hljs-class">()) // 1 addChildViewController(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">) // 2 new.view.frame = view.bounds // 3 view.addSubview(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">) // 4 new.didMove(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toParentViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) // 5 current.willMove(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toParentViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">) // 6 current.view.removeFromSuperview()] // 7 current.removeFromParentViewController() // 8 current = new // 9 }</span></span></code> </pre><br>  Cr√©ez <i>LoginViewController</i> (1), ajoutez comme contr√¥leur enfant (2), d√©finissez le cadre (3).  Ajoutez la vue de <i>LoginController en</i> tant que sous-vue (4) et appelez la m√©thode didMove (5).  Ensuite, pr√©parez le contr√¥leur actuel pour le retrait √† l'aide de la m√©thode willMove (6).  Enfin, supprimez la vue actuelle de superview (7) et supprimez le contr√¥leur actuel de <i>RootViewController</i> (8).  N'oubliez pas de mettre √† jour la valeur du contr√¥leur actuel (9). <br><br>  <i>Cr√©ons maintenant la</i> m√©thode <i>switchToMainScreen</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToMainScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainViewController = <span class="hljs-type"><span class="hljs-type">MainViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: mainViewController) ... }</code> </pre> <br>  L'animation de la transition n√©cessite une m√©thode diff√©rente: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateFadeTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to new: UIViewController, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { current.willMove(toParentViewController: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) addChildViewController(new) transition(from: current, to: new, duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, options: [.transitionCrossDissolve, .curveEaseOut], animations: { }) { completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current.removeFromParentViewController() new.didMove(toParentViewController: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = new completion?() <span class="hljs-comment"><span class="hljs-comment">//1 } }</span></span></code> </pre> <br>  Cette m√©thode est tr√®s similaire √† <i>showLoginScreen</i> , mais toutes les derni√®res √©tapes sont effectu√©es une fois l'animation termin√©e.  Afin de notifier la m√©thode d'appel de la fin de la transition, √† la toute fin nous appelons la fermeture (1). <br><br>  Maintenant, la version finale de la m√©thode <i>switchToMainScreen</i> ressemblera √† ceci: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToMainScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainViewController = <span class="hljs-type"><span class="hljs-type">MainViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: mainViewController) animateFadeTransition(to: mainScreen) }</code> </pre> <br>  Et enfin, cr√©ons la derni√®re m√©thode qui sera responsable de la transition de <i>MainViewController</i> √† <i>LoginViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToLogout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> loginViewController = <span class="hljs-type"><span class="hljs-type">LoginViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logoutScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: loginViewController) animateDismissTransition(to: logoutScreen) }</code> </pre> <br>  La m√©thode <i>AnimateDismissTransition</i> fournit une animation de diapositive: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateDismissTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to new: UIViewController, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { new.view.frame = <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: -view.bounds.width, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, width: view.bounds.width, height: view.bounds.height) current.willMove(toParentViewController: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) addChildViewController(new) transition(from: current, to: new, duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, options: [], animations: { new.view.frame = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bounds }) { completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current.removeFromParentViewController() new.didMove(toParentViewController: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = new completion?() } }</code> </pre><br>  Ce ne sont que deux exemples d'animation, en utilisant la m√™me approche, vous pouvez cr√©er toutes les animations complexes dont vous avez besoin <br><br>  Pour terminer la configuration, ajoutez des appels de m√©thode avec des animations de <i>SplashViewController, LoginViewController</i> et <i>MainViewController</i> : <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SplashViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... private func makeServiceCall() { if </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserDefaults</span></span></span><span class="hljs-class">.standard.bool(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forKey</span></span></span><span class="hljs-class">: ‚Äú</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LOGGED_IN</span></span></span><span class="hljs-class">‚Äù) { // navigate to protected page </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToMainScreen() } else { // navigate to login screen </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToLogout() } } } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoginViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... @objc private func login() { ... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToMainScreen() } } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MainViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... @objc private func logout() { ... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToLogout() } }</span></span></code> </pre><br>  Compilez, ex√©cutez l'application et v√©rifiez son fonctionnement de deux mani√®res: <br><br>  - lorsque l'utilisateur a d√©j√† une session active active (connect√©) <br>  - lorsqu'il n'y a pas de session active et qu'une authentification est requise <br><br>  Dans les deux cas, vous devriez voir une transition vers l'√©cran souhait√©, imm√©diatement apr√®s le chargement de <i>SplashScreen</i> . <br><br><img src="https://habrastorage.org/webt/zq/n5/ss/zqn5ssn9toyzyjhas3wvljnfj9m.gif"><br><br>  En cons√©quence, nous avons cr√©√© un petit mod√®le de test de l'application, avec navigation √† travers ses principaux modules.  Si vous avez besoin d'√©tendre les capacit√©s de l'application, d'ajouter des modules suppl√©mentaires et des transitions entre eux, vous pouvez toujours √©tendre et mettre √† l'√©chelle ce syst√®me de navigation de mani√®re rapide et pratique. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416147/">https://habr.com/ru/post/fr416147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416133/index.html">Centre de donn√©es √† l'√©tranger: Equinix LD8</a></li>
<li><a href="../fr416135/index.html">Application GUI inf√©rieure √† 1 ko</a></li>
<li><a href="../fr416137/index.html">Zabbix comme scanner de s√©curit√©</a></li>
<li><a href="../fr416139/index.html">Authentification forte dans le cadre de la strat√©gie GDPR</a></li>
<li><a href="../fr416143/index.html">Le livre "Une autopsie va montrer!" Analyse pratique des malwares ¬ª</a></li>
<li><a href="../fr416149/index.html">Questions et r√©ponses sur les √©nergies renouvelables, partie 1</a></li>
<li><a href="../fr416151/index.html">Ballon sans dimension. Magie d'analyse de dimension utilitaire</a></li>
<li><a href="../fr416153/index.html">Les avions deviendront-ils plus fiables? Les constructeurs d'avions pr√©sentent des robots aux entreprises</a></li>
<li><a href="../fr416155/index.html">WebSockets dans Angular: cr√©ez un service angulaire pour travailler avec des sockets Web</a></li>
<li><a href="../fr416157/index.html">Dans les bras de Python (femmes uniquement)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>