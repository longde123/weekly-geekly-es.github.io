<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛵️ 💅🏾 🔉 Bagaimana Satu Perubahan Konfigurasi PostgreSQL Meningkatkan Performa Permintaan Lambat 50 Kali 🕢 👆🏾 👆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, orang Khabrovit! Saya membawa perhatian Anda pada terjemahan artikel "Bagaimana perubahan konfigurasi PostgreSQL tunggal meningkatkan kinerja pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana Satu Perubahan Konfigurasi PostgreSQL Meningkatkan Performa Permintaan Lambat 50 Kali</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444018/">  Halo, orang Khabrovit!  Saya membawa perhatian Anda pada terjemahan artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Bagaimana perubahan konfigurasi PostgreSQL tunggal meningkatkan kinerja permintaan lambat sebesar 50x"</a> oleh Pavan Patibandla.  Ini banyak membantu saya untuk meningkatkan kinerja PostgreSQL. <br><br>  Di Amplitude, tujuan kami adalah menyediakan analisis produk interaktif yang mudah digunakan sehingga semua orang dapat menemukan jawaban atas pertanyaan mereka tentang produk.  Untuk memastikan kegunaan, Amplitude harus memberikan jawaban ini dengan cepat.  Oleh karena itu, ketika salah satu pelanggan kami mengeluh tentang berapa lama waktu yang diperlukan untuk memuat daftar drop-down properti acara di antarmuka pengguna Amplitude, kami memulai studi rinci masalah. <br><br>  Dengan melacak penundaan pada level yang berbeda, kami menyadari bahwa butuh 20 detik untuk menyelesaikan satu permintaan PostgreSQL tertentu.  Ini mengejutkan kami, karena kedua tabel memiliki indeks di kolom gabungan. <br><br>  <b>Permintaan lambat</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/baa/ee5/4d3/baaee54d35e5279d4db80032a422ef73.png" alt="gambar"><br><a name="habracut"></a><br>  Rencana eksekusi PostgreSQL untuk kueri ini tidak terduga bagi kami.  Terlepas dari kenyataan bahwa kedua tabel memiliki indeks, PostgreSQL memutuskan untuk melakukan Hash Join dengan pemindaian berurutan dari sebuah tabel besar.  Pemindaian tabel besar secara berurutan menghabiskan sebagian besar waktu permintaan. <br><br>  <b>Rencana Eksekusi Permintaan Lambat</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/31e/57c/9ec/31e57c9ec8e242c349cabeeefe700f2b.png" alt="gambar"><br><br>  Awalnya saya curiga ini mungkin karena fragmentasi.  Tetapi setelah memeriksa data, saya menyadari bahwa data hanya ditambahkan ke tabel ini dan praktis tidak dihapus dari sana.  Karena membersihkan tempat dengan VACUUM tidak akan banyak membantu di sini, saya mulai menggali lebih jauh.  Kemudian saya mencoba permintaan yang sama pada klien lain dengan waktu respons yang baik.  Yang mengejutkan saya, rencana eksekusi permintaan tampak sangat berbeda! <br><br>  <b>Rencana eksekusi untuk permintaan yang sama pada klien lain</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b58/dfd/435/b58dfd435727e9c537467d3e69d6728f.png" alt="gambar"><br><br>  Menariknya, aplikasi A hanya mendapat akses ke data 10 kali lebih banyak daripada aplikasi B, tetapi waktu responsnya 3.000 kali lebih lama. <br><br>  Untuk melihat rencana kueri PostgreSQL alternatif, saya mematikan koneksi hash dan memulai kembali kueri. <br><br>  <b>Rencana eksekusi alternatif untuk kueri lambat</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c46/b16/482/c46b16482a3ea0c42d3ca61022b842df.png" alt="gambar"><br><br>  Baik di sini!  Permintaan yang sama selesai 50 kali lebih cepat saat menggunakan loop bersarang alih-alih bergabung hash.  Jadi mengapa PostgreSQL memilih paket terburuk untuk aplikasi A? <br><br>  Dengan melihat lebih dekat pada perkiraan biaya dan waktu tunggu aktual untuk kedua rencana, estimasi rasio biaya dan waktu tunggu aktual sangat berbeda.  Penyebab utama perbedaan ini adalah perkiraan biaya pemindaian sekuensial.  PostgreSQL memperkirakan bahwa pemindaian berurutan akan lebih baik dari 4000+ pemindaian indeks, tetapi pada kenyataannya, pemindaian indeks 50 kali lebih cepat. <br><br>  Ini mengarahkan saya ke <b>opsi</b> konfigurasi <b>random_page_cost</b> dan <b>seq_page_cost</b> .  Nilai PostgreSQL default adalah <b>4</b> dan <b>1</b> untuk <b>random_page_cost</b> , <b>seq_page_cost</b> , yang dikonfigurasi untuk HDD, di mana akses acak ke disk lebih mahal daripada akses berurutan.  Namun, biaya ini tidak akurat untuk penggunaan kami menggunakan volume <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">EBS gp2</a> , yang merupakan solid state drive.  Untuk penyebaran kami, akses acak dan berurutan hampir sama. <br><br>  Saya mengubah nilai <b>random_page_cost</b> menjadi <b>1</b> dan mencoba <b>kembali</b> permintaan.  Kali ini, PostgreSQL menggunakan Nested Loop, dan kueri berjalan 50 kali lebih cepat.  Setelah perubahan, kami juga melihat penurunan signifikan dalam waktu respons maksimum dari PostgreSQL. <br><br>  <b>Kinerja keseluruhan dari permintaan yang lambat telah meningkat secara signifikan.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/203/587/79b/20358779bdd2b3ddfe7bf964054781c0.png" alt="gambar"><br><br>  Jika Anda menggunakan SSD dan menggunakan PostgreSQL dengan konfigurasi default, saya menyarankan Anda untuk mencoba <b>mengatur random_page_cost</b> dan <b>seq_page_cost</b> .  Anda mungkin terkejut dengan peningkatan kinerja yang dramatis. <br><br>  Saya sendiri, saya akan menambahkan bahwa saya menetapkan parameter minimum <b>seq_page_cost = random_page_cost = 0,1</b> untuk memberikan prioritas pada data dalam memori (cache) dibandingkan operasi prosesor, karena saya telah mengalokasikan sejumlah besar RAM untuk PostgreSQL (ukuran RAM melebihi ukuran database pada disk).  Tidak terlalu jelas mengapa komunitas postgres masih menggunakan pengaturan default yang relevan untuk server dengan sejumlah kecil RAM dan HDD, dan tidak untuk server modern.  Semoga ini akan segera diperbaiki. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444018/">https://habr.com/ru/post/id444018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444004/index.html">CLRium # 5: All-All-All tentang GC dan banyak lagi. Peter dan Moskow</a></li>
<li><a href="../id444006/index.html">Konsol permainan DIY do-it-yourself</a></li>
<li><a href="../id444010/index.html">Gambar .NET Core Container sekarang Diterbitkan ke Microsoft Container Registry</a></li>
<li><a href="../id444014/index.html">Microsoft Membuka Sekolah Bisnis untuk Mempelajari Strategi, Budaya, dan Tanggung Jawab AI</a></li>
<li><a href="../id444016/index.html">Raih lebih banyak dengan Microsoft Game Stack</a></li>
<li><a href="../id444020/index.html">Karting di Uni Soviet: bagaimana hobi pilot Amerika menjadi hobi DIY besar-besaran di Uni Soviet</a></li>
<li><a href="../id444022/index.html">Beego tidak lagi Go</a></li>
<li><a href="../id444024/index.html">Bagaimana menerapkan bahasa pemrograman dalam JavaScript. Bagian 3: juru bahasa CPS</a></li>
<li><a href="../id444026/index.html">MODX Digest # 1.1 (25 Februari - 11 Maret 2019)</a></li>
<li><a href="../id444028/index.html">Memperkenalkan Microsoft Game Stack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>