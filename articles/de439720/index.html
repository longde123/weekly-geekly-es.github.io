<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶🏼 👨‍👨‍👧‍👧 🚁 Einführung in die Programmierung: Ein einfacher 3D-Shooter von Grund auf über das Wochenende, Teil 2 👂🏻 ✋🏻 🔒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir setzen das Gespräch über 3D-Shooter über das Wochenende fort. Wenn überhaupt, dann erinnere ich Sie daran, dass dies die zweite Hälfte ist: 



- ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einführung in die Programmierung: Ein einfacher 3D-Shooter von Grund auf über das Wochenende, Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439720/">  Wir setzen das Gespräch über 3D-Shooter über das Wochenende fort.  Wenn überhaupt, dann erinnere ich Sie daran, dass dies die zweite Hälfte ist: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erster Teil: Wände zeichnen</a> </li><li>  <b>Teil zwei: Bewohnen Sie unsere Welt + Fensterschnittstelle</b> </li></ul><br>  Wie gesagt, ich gebe mein Bestes, um den Wunsch der Schüler zu unterstützen, etwas mit ihren eigenen Händen zu tun.  Insbesondere wenn ich Vorlesungen über die Einführung in die Programmierung halte, lasse ich ihnen als praktische Übungen fast völlige Freiheit.  Es gibt nur zwei Einschränkungen: Die Programmiersprache (C ++) und das Thema des Projekts, dies sollte ein Videospiel sein.  Hier ist ein Beispiel für eines der Hunderte von Spielen, die meine Erstsemester gemacht haben: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Ekomnk1eNFU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Leider wählen die meisten Schüler einfache Spiele wie 2D-Plattformer.  Ich schreibe diesen Artikel, um zu zeigen, dass es nicht schwieriger ist, die Illusion einer dreidimensionalen Welt zu erschaffen, als Mario Broz zu klonen. <br><a name="habracut"></a><br>  Ich erinnere Sie daran, dass wir an einem Punkt angehalten haben, an dem Sie die Wände strukturieren können: <br><br><img src="https://raw.githubusercontent.com/ssloy/tinyraycaster/master/doc/012.gif"><br><br><hr><br><h1>  Stufe 13: Zeichne Monster auf die Karte </h1><br>  Was ist ein Monster in unserem Spiel?  Dies sind seine Koordinaten und Texturnummer: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sprite</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, y; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> tex_id; }; [..] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Sprite&gt; sprites{ {<span class="hljs-number"><span class="hljs-number">1.834</span></span>, <span class="hljs-number"><span class="hljs-number">8.765</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">5.323</span></span>, <span class="hljs-number"><span class="hljs-number">5.365</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">4.123</span></span>, <span class="hljs-number"><span class="hljs-number">10.265</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>} };</code> </pre> <br>  Nachdem wir mehrere Monster definiert haben, zeichnen wir sie zunächst einfach auf die Karte: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/60f/15a/824/60f15a824cec0e8a93ff42f4d7a2722b.png"><br><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> . <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><hr><br><h1>  Stufe 14: Schwarze Quadrate anstelle von Monstern in 3D </h1><br>  Jetzt werden wir Sprites im 3D-Fenster zeichnen.  Dazu müssen wir zwei Dinge bestimmen: die Position des Sprites auf dem Bildschirm und seine Größe.  Hier ist die Funktion, die anstelle jedes Sprites ein schwarzes Quadrat zeichnet: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_sprite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sprite &amp;sprite, FrameBuffer &amp;fb, Player &amp;player, Texture &amp;tex_sprites)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// absolute direction from the player to the sprite (in radians) float sprite_dir = atan2(sprite.y - player.y, sprite.x - player.x); // remove unnecessary periods from the relative direction while (sprite_dir - player.a &gt; M_PI) sprite_dir -= 2*M_PI; while (sprite_dir - player.a &lt; -M_PI) sprite_dir += 2*M_PI; // distance from the player to the sprite float sprite_dist = std::sqrt(pow(player.x - sprite.x, 2) + pow(player.y - sprite.y, 2)); size_t sprite_screen_size = std::min(2000, static_cast&lt;int&gt;(fb.h/sprite_dist)); // do not forget the 3D view takes only a half of the framebuffer, thus fb.w/2 for the screen width int h_offset = (sprite_dir - player.a)*(fb.w/2)/(player.fov) + (fb.w/2)/2 - sprite_screen_size/2; int v_offset = fb.h/2 - sprite_screen_size/2; for (size_t i=0; i&lt;sprite_screen_size; i++) { if (h_offset+int(i)&lt;0 || h_offset+i&gt;=fb.w/2) continue; for (size_t j=0; j&lt;sprite_screen_size; j++) { if (v_offset+int(j)&lt;0 || v_offset+j&gt;=fb.h) continue; fb.set_pixel(fb.w/2 + h_offset+i, v_offset+j, pack_color(0,0,0)); } } }</span></span></code> </pre><br>  Lassen Sie uns herausfinden, wie es funktioniert.  Hier ist das Diagramm: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/472/062/e0d/472062e0d02a32186987ee94f7364cdd.png"><br><br>  In der ersten Zeile betrachten wir den absoluten Winkel sprite_dir (den Winkel zwischen der Richtung vom Spieler zum Sprite und der Abszisse).  Der relative Winkel zwischen dem Sprite und der Blickrichtung wird offensichtlich durch einfaches Subtrahieren von zwei absoluten Winkeln erhalten: sprite_dir - player.a.  Die Entfernung vom Spieler zum Sprite ist trivial zu berechnen, und die Größe des Sprites ist eine einfache Division der Bildschirmgröße durch die Entfernung.  Nun, nur für den Fall, ich schneide zweitausend von oben ab, um keine riesigen Quadrate zu erhalten (dieser Code kann übrigens leicht durch Null geteilt werden).  h_offset und v_offset geben die Koordinaten der oberen linken Ecke des Sprites auf dem Bildschirm an.  dann füllt eine einfache Doppelschleife unser Quadrat mit Schwarz.  Überprüfen Sie mit einem Stift und einem Blatt Papier, ob h_offset und v_offset korrekt berechnet wurden. Bei meinem Commit liegt ein (unkritischer) Fehler vor. Glauben Sie dem Code im Artikel :) Nun, der neuere Code im Repository wurde ebenfalls behoben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/03a/795/77c/03a79577c9c0781121b529494b1dafe1.png"><br><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><hr><br><h1>  Schritt 15: Tiefenkarte </h1><br>  Unsere Quadrate sind auf wundersame Weise gut, aber es gibt nur ein Problem: Das entfernte Monster späht um die Ecke und das Quadrat ist vollständig gezeichnet.  Wie man ist  Sehr einfach.  Wir zeichnen Sprites, <b>nachdem</b> die Wände gezeichnet wurden.  Daher kennen wir für jede Spalte unseres Bildschirms den Abstand zur nächsten Wand.  Wir speichern diese Abstände in einem Array von 512 Werten und übergeben das Array an die Sprite-Rendering-Funktion.  Die Sprites werden auch spaltenweise gezeichnet, sodass wir für jede Spalte des Sprites den Abstand dazu mit dem Wert aus unserem Tiefenarray vergleichen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/1c3/71f/ec81c371f35f7ddff4086a8e1a51268b.png"><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><hr><br><h1>  Stufe 16: Problem mit Sprites </h1><br>  Sie sind großartige Monster geworden, nicht wahr?  Aber zu diesem Zeitpunkt werde ich keine Funktionalität hinzufügen, im Gegenteil, ich werde alles durch Hinzufügen eines weiteren Monsters zerstören: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28f/5a8/9b8/28f5a89b8ea84373d9812c3e3a66d61d.png"><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><hr><br><h1>  Stufe 17: Sprites sortieren </h1><br>  Was war das Problem?  Das Problem ist, dass ich eine beliebige Reihenfolge für das Zeichnen von Sprites haben kann und für jeden von ihnen die Entfernung mit den Wänden vergleiche, aber nicht mit anderen Sprites, sodass die entfernte Kreatur über die nächste kroch.  Ist es möglich, eine Lösung mit einer Tiefenkarte zum Zeichnen von Sprites anzupassen? <br><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text">  Die richtige Antwort lautet "Sie können".  Aber wie?  Schreiben Sie in die Kommentare. <br></div></div><br>  Ich werde den anderen Weg gehen und das Problem dumm in der Stirn lösen.  Ich werde einfach alle Sprites vom entferntesten zum am weitesten entfernten zeichnen.  Das heißt, ich werde die Sprites in absteigender Reihenfolge der Entfernung sortieren und sie in dieser Reihenfolge zeichnen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73c/820/c20/73c820c20c220093733774e6a1553a50.png"><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><hr><br><h1>  Schritt 18: SDL-Zeit </h1><br>  Es ist Zeit für SDL.  Es gibt viele verschiedene plattformübergreifende Fensterbibliotheken, und ich verstehe sie überhaupt nicht.  Persönlich mag ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">imgui</a> , aber aus irgendeinem Grund bevorzugen meine Schüler SDL, also verbinde ich mich damit.  Die Aufgabe für diese Phase ist sehr einfach: Erstellen Sie ein Fenster und zeigen Sie das Bild aus der vorherigen Phase an: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ce/63a/9b5/7ce63a9b5ea3ca1c608fcdcf207d482e.png"><br><br>  Die Änderungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können Sie hier sehen</a> .  Ich gebe keinen Link mehr zum Gitpod, weil  SDL im Browser hat noch nicht gelernt zu starten :( <br><br>  <b>Update: ERLERNT!</b>  <b>Sie können den Code mit einem Klick im Browser ausführen!</b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://gitpod.io/&amp;usg=ALkJrhibdoBgAuWxDm4AQYVqruhB1rn__g#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Im Gitpod öffnen"></a> <br><br><h1>  Schritt 19: Ereignisverarbeitung und -bereinigung </h1><br>  Eine Reaktion auf Tastenanschläge hinzuzufügen ist nicht einmal lustig, ich werde es nicht beschreiben.  Beim Hinzufügen von SDL habe ich die Abhängigkeit von stb_image.h entfernt.  Es ist schön, aber das Kompilieren dauert zu lange. <br><br>  Für diejenigen, die nicht verstehen, sind die Quellen der neunzehnten Stufe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .  Nun, hier ist eine typische Leistung: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zPIVTqVilCM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  Fazit </h1><br>  Mein Code enthält im Moment nur 486 Zeilen, und gleichzeitig habe ich sie überhaupt nicht gespeichert: <br><br><pre> <code class="bash hljs">haqreu@daffodil:~/tinyraycaster$ cat *.cpp *.h | wc -l 486</code> </pre><br>  Ich habe meinen Code nicht geleckt und absichtlich schmutzige Wäsche entsorgt.  Ja, ich schreibe so (und nicht nur ich).  An einem Samstagmorgen habe ich mich einfach hingesetzt und das geschrieben :) <br><br>  Ich habe das fertige Spiel nicht geschafft, meine Aufgabe ist es nur, einen ersten Anstoß für den Flug Ihrer Fantasie zu geben.  Schreiben Sie Ihren eigenen Code, er wird wahrscheinlich besser sein als meiner.  Teilen Sie Ihren Code, teilen Sie Ihre Ideen, senden Sie Pull-Anfragen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439720/">https://habr.com/ru/post/de439720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439710/index.html">Merkmale der Erstellung von Produkten für den US-Markt</a></li>
<li><a href="../de439712/index.html">Öffentliches Beschaffungswesen: das Gleichgewicht zwischen dem italienischen Streik und dem russischen Verbrecher</a></li>
<li><a href="../de439714/index.html">Russen bei Apple: Wie wir einen Vertrag über Millionen mit Beatles und „einigen Jerry“ -Liedern bekommen haben</a></li>
<li><a href="../de439716/index.html">Tails OS oder wie Sie sich online schützen können</a></li>
<li><a href="../de439718/index.html">Anwendungsentwicklung auf Elixir / Phoenix mit Docker</a></li>
<li><a href="../de439722/index.html">Auswirkungen von SVG-Filtern. Teil 2. Gliederungstext mit feMorphology</a></li>
<li><a href="../de439724/index.html">Überblick über AI & ML-Lösungen im Jahr 2018 und Prognosen für 2019: Teil 2 - Tools und Bibliotheken, AutoML, RL, Ethik in AI</a></li>
<li><a href="../de439726/index.html">Lock-in: wahr oder fiktiv?</a></li>
<li><a href="../de439728/index.html">Konfigurieren Sie die vollständige und separate Sicherung und Wiederherstellung von Zimbra OSE ohne Verwendung von Zextras</a></li>
<li><a href="../de439730/index.html">Organisation des Reduzierers durch eine Standardklasse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>