<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèª üîó ‚õèÔ∏è Placa de expans√£o de simula√ß√£o para Raspberry Pi üê∂ üåò ü§µüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante muito tempo, o microcomputador Raspberry Pi entrou na vida de geeks, administradores de sistemas, programadores e engenheiros eletr√¥nicos. Bar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Placa de expans√£o de simula√ß√£o para Raspberry Pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401089/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante muito tempo, o microcomputador Raspberry Pi entrou na vida de geeks, administradores de sistemas, programadores e engenheiros eletr√¥nicos. </font><font style="vertical-align: inherit;">Barato e relativamente poderoso para sua classe, com portas de E / S integradas, ele pode lidar com v√°rias tarefas e atender √†s necessidades do usu√°rio. </font><font style="vertical-align: inherit;">Depois de comprar um Raspberry Pi, eu queria algo para ativar, medir e gerenciar dispositivos externos. </font><font style="vertical-align: inherit;">Um grande n√∫mero de cart√µes de expans√£o est√° sendo vendido atualmente, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Voc√™ pode usar a placa de ensaio com fios para prototipagem r√°pida, mas eu prefiro criar dispositivos por conta pr√≥pria, para tarefas espec√≠ficas. </font><font style="vertical-align: inherit;">Pela primeira vez, eu n√£o usei um pente de duas linhas para todas as sa√≠das, mas me limitei a v√°rias portas de E / S, SPI, I2C e barramento UART. </font><font style="vertical-align: inherit;">Liguei o Raspberry Pi com os fios-alvo para prototipar "m√£e-m√£e". </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/eef/18f/ae2/eef18fae242d47dab3f10bb6a4cfb21b.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse sentido, uma s√©rie de tr√™s placas de prototipagem foi desenvolvida, sendo uma delas a mais simples que discutirei neste artigo.</font></font><a name="habracut"></a> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o o que eu precisava:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhe com o GPIO com entradas e sa√≠das; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciamento de carga; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o de sensores de temperatura no barramento de 1 fio; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medi√ß√£o de tens√£o; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rel√≥gio em tempo real; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Monitoramento e controle de um dispositivo externo via barramento RS485; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fonte de alimenta√ß√£o separada para placa de expans√£o; </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com a lista acima, um circuito el√©trico foi desenvolvido: </font></font><br>
<img src="https://habrastorage.org/files/cc4/136/432/cc41364328f3449094dc0b05a940a987.jpg" alt="imagem"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um circuito de um armazenamento de alta resolu√ß√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O circuito utiliza uma fonte de energia do transformador com dois enrolamentos de sa√≠da. O primeiro enrolamento opera em um regulador de tens√£o linear com uma sa√≠da de 5V, para alimentar o chip do driver RS485 e o rel√≥gio em tempo real. O segundo enrolamento √© usado para alimentar rel√©s e montagem eletromagn√©ticos com transistores Darlington.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sensor de temperatura DS18B20 √© alimentado por + 3.3V a partir da placa Raspberry Pi, a placa possui um conector para conectar sensores externos DS18B20, a mesma tens√£o √© tomada para o ADC e os n√≠veis correspondentes com um rel√≥gio em tempo real. O circuito usa quatro bot√µes S1-S4 para controlar quaisquer a√ß√µes que operam em um n√≠vel l√≥gico baixo. Para controlar as cargas, √© usado o conjunto do transistor DD1 ULN2003 com diodos de prote√ß√£o embutidos. Os rel√©s K1 e K2 s√£o conectados aos pinos 16, 15 do conjunto do transistor, os LEDs para indica√ß√£o s√£o conectados aos pinos 14-12, os pinos 11, 10 s√£o projetados para se conectar a dispositivos externos de acordo com o esquema com um coletor comum ou rel√©s adicionais com uma tens√£o de enrolamento de + 12V.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para medir a tens√£o, s√£o utilizados dois canais de um ADC DD3 MCP3008 de 10 bits com uma interface SPI, com um filtro passa-baixo de entrada. O n√≥ anal√≥gico √© feito primitivamente, para fins acad√™micos ou para depura√ß√£o r√°pida. Se surgir a pergunta sobre a medi√ß√£o qualitativa de um sinal anal√≥gico, voc√™ precisar√° desacoplar o terra digital e anal√≥gico, use uma fonte de refer√™ncia de tens√£o externa. Como alternativa, a parte anal√≥gica pode ser feita da seguinte forma: </font></font><br>
<br>
<img src="https://habrastorage.org/files/d8d/148/dee/d8d148deee074957a46ab433620aea05.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somente ser√° necess√°rio usar o conversor de n√≠vel TTL ‚Üí LVTTL no barramento SPI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rel√≥gio em tempo real DD4 √© produzido no chip DS1307, e o ressonador de quartzo Q1 a 32.768 kHz √© usado para o rel√≥gio. Uma bateria de l√≠tio de 3 volts soldada na placa √© usada para alimentar o chip de RAM do rel√≥gio. O microcircuito √© conectado atrav√©s de um conversor de n√≠vel 5V-3.3V fabricado nos transistores MOS VT2, VT3 ao Raspberry Pi atrav√©s do barramento I2C (o CAD usou a conex√£o com linhas sem conex√£o expl√≠cita). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como driver UART ‚Üí RS485, o chip DD2 ST485 foi usado. As solu√ß√µes de circuito que usam o transistor VT1 permitiram abandonar uma sa√≠da separada para controlar o transceptor. Ele muda para o modo de transmiss√£o somente quando o UART est√° transmitindo dados, o resto do tempo o ST485 est√° no modo de recebimento. O comando de controle do transceptor √© removido do coletor do transistor VT1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m de converter as interfaces, esse esquema tamb√©m desempenha a fun√ß√£o de combinar os n√≠veis LVTTL da interface UART Raspberry Pi com os n√≠veis TTL do driver ST485. </font><font style="vertical-align: inherit;">O sinal recebido do coletor do transistor VT1 eleva o n√≠vel na entrada DI para 5V, e o resistor R16 e o ‚Äã‚Äãdiodo Zener VD8 limitam o n√≠vel da sa√≠da R0 a 3,3V. </font><font style="vertical-align: inherit;">N√£o preste aten√ß√£o no resistor R11, ele permaneceu no circuito durante a depura√ß√£o. </font><font style="vertical-align: inherit;">O RS485 √© testado com o protocolo ModBus RTU a 115200 baud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consequentemente, uma placa de circuito foi desenvolvida:</font></font><br>
<br>
<img src="https://habrastorage.org/files/2ca/501/7a8/2ca5017a8cba4f22b49cb6c8ea588855.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelos 3D da placa de circuito impresso</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/0d3/058/62d/0d305862d003420aa0dfaa41f5a57d78.png"><br>
<img src="https://habrastorage.org/files/cbc/3d6/3b3/cbc3d63b39b44d2aa22887874155660c.bmp"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foto do dispositivo acabado e trabalho com a placa de expans√£o:</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/e60/3b4/9d7/e603b49d769b4fc1888d7350b9dbe63f.jpg"><br>
<br>
<img src="https://habrastorage.org/files/2fb/710/6e3/2fb7106e3cec47ea9de5b947ebc091ed.jpg"><br>
<br>
<img src="https://habrastorage.org/files/132/e3e/4d0/132e3e4d025a47ebb5a982e69ed7c213.jpg"><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variante do esquema de conex√£o com dispositivos externos: </font></font><br>
<img src="https://habrastorage.org/files/4bb/b2f/c3c/4bbb2fc3c13849398f32165e87ce506f.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
para verificar os n√≥s da placa de expans√£o, usei alguns scripts em python (n√£o conhe√ßo essa linguagem, escrevi por tentativa e erro, pesquisando os c√≥digos dos especialistas) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para medir a tens√£o de um potenci√¥metro conectado aos canais ADC, escrevi um simples script:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte python MCP3008</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment"># Example program to read data from MCP3008 10 bit ADC</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spidev
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os<font></font>
 <font></font>
<span class="hljs-comment"><span class="hljs-comment"># Open SPI bus</span></span><font></font>
spi = spidev.SpiDev()<font></font>
spi.open(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)<font></font>
 <font></font>
<span class="hljs-comment"><span class="hljs-comment"># Function to read SPI data from MCP3008 chip</span></span>
<span class="hljs-comment"><span class="hljs-comment"># Channel must be an integer 0-7</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadChannel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(channel)</span></span></span><span class="hljs-function">:</span></span>
  adc = spi.xfer2([<span class="hljs-number"><span class="hljs-number">1</span></span>,(<span class="hljs-number"><span class="hljs-number">8</span></span>+channel)&lt;&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>])<font></font>
  data = ((adc[<span class="hljs-number"><span class="hljs-number">1</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">3</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + adc[<span class="hljs-number"><span class="hljs-number">2</span></span>]
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data<font></font>
 <font></font>
<span class="hljs-comment"><span class="hljs-comment"># Function to convert data to voltage level,</span></span>
<span class="hljs-comment"><span class="hljs-comment"># rounded to specified number of decimal places.</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertVolts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data,places)</span></span></span><span class="hljs-function">:</span></span>
  volts = (data * <span class="hljs-number"><span class="hljs-number">3.3</span></span>) / float(<span class="hljs-number"><span class="hljs-number">1023</span></span>)<font></font>
  volts = round(volts,places)<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> volts<font></font>
 <font></font>
<span class="hljs-comment"><span class="hljs-comment"># Define sensor channels</span></span>
first_channel = <span class="hljs-number"><span class="hljs-number">0</span></span>
second_channel  = <span class="hljs-number"><span class="hljs-number">1</span></span><font></font>
 <font></font>
<span class="hljs-comment"><span class="hljs-comment"># Define delay between readings</span></span>
delay = <span class="hljs-number"><span class="hljs-number">5</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"------------------------------------------------------"</span></span><font></font>
 <font></font>
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>:<font></font>
 <font></font>
  <span class="hljs-comment"><span class="hljs-comment"># Read the first channel data</span></span><font></font>
  first_level = ReadChannel(first_channel)<font></font>
  first_channel_volts = ConvertVolts(first_level,<span class="hljs-number"><span class="hljs-number">2</span></span>)<font></font>
 <font></font>
  <span class="hljs-comment"><span class="hljs-comment"># Read the second channel data</span></span><font></font>
  second_level = ReadChannel(second_channel)<font></font>
  second_channel_volts = ConvertVolts(second_level,<span class="hljs-number"><span class="hljs-number">2</span></span>)<font></font>
  <font></font>
 <font></font>
  <span class="hljs-comment"><span class="hljs-comment"># Print out results</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"------------------------------------------------------"</span></span>
  print(<span class="hljs-string"><span class="hljs-string">"First ADC channel: {} ({}V)"</span></span>.format(first_level,first_channel_volts))<font></font>
  print(<span class="hljs-string"><span class="hljs-string">"Second ADC channel : {} ({}V)"</span></span>.format(second_level,second_channel_volts))<font></font>
 <font></font>
  <span class="hljs-comment"><span class="hljs-comment"># Wait before repeating loop</span></span><font></font>
  time.sleep(delay)<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script a seguir foi usado para trabalhar com term√¥metros DS18B20:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte python DS18B20</font></font></b><div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a><br>
<pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Example program to read data from DS18B20</span></span>
<span class="hljs-comment"><span class="hljs-comment"># This code taken from</span></span>
<span class="hljs-comment"><span class="hljs-comment"># https://kropochev.com/?go=all/raspberry-pi-and-onewire-sensor/</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> glob
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time<font></font>
<font></font>
os.system(<span class="hljs-string"><span class="hljs-string">'modprobe w1-gpio'</span></span>)<font></font>
os.system(<span class="hljs-string"><span class="hljs-string">'modprobe w1-therm'</span></span>)<font></font>
<font></font>
base_dir = <span class="hljs-string"><span class="hljs-string">'/sys/bus/w1/devices/'</span></span>
device_folder = glob.glob(base_dir + <span class="hljs-string"><span class="hljs-string">'10*'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]<font></font>
device_file = device_folder + <span class="hljs-string"><span class="hljs-string">'/w1_slave'</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_temp_raw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    f = open(device_file, <span class="hljs-string"><span class="hljs-string">'r'</span></span>)<font></font>
    lines = f.readlines()<font></font>
    f.close()<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lines<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_temp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span><font></font>
    lines = read_temp_raw()<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> lines[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip()[<span class="hljs-number"><span class="hljs-number">-3</span></span>:] != <span class="hljs-string"><span class="hljs-string">'YES'</span></span>:<font></font>
        time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)<font></font>
        lines = read_temp_raw()<font></font>
    equals_pos = lines[<span class="hljs-number"><span class="hljs-number">1</span></span>].find(<span class="hljs-string"><span class="hljs-string">'t='</span></span>)
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> equals_pos != <span class="hljs-number"><span class="hljs-number">-1</span></span>:<font></font>
        temp_string = lines[<span class="hljs-number"><span class="hljs-number">1</span></span>][equals_pos+<span class="hljs-number"><span class="hljs-number">2</span></span>:]<font></font>
        temp_c = float(temp_string) / <span class="hljs-number"><span class="hljs-number">1000.0</span></span>
        temp_f = temp_c * <span class="hljs-number"><span class="hljs-number">9.0</span></span> / <span class="hljs-number"><span class="hljs-number">5.0</span></span> + <span class="hljs-number"><span class="hljs-number">32.0</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> temp_c, temp_f<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>:<font></font>
    print(read_temp())<font></font>
    time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m documentei as configura√ß√µes no Raspbian:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar dispositivos</font></font></b><div class="spoiler_text"><blockquote> ‚Äî 1 Wire settings:<br>
 ‚Äî Raspbian wheezy<br>
<br>
Enter command in console:<br>
pi@raspberrypi~$ sudo modprobe w1-gpio<br>
pi@raspberrypi~$ sudo modprobe w1_therm<br>
<br>
Then check sensor in system:<br>
pi@raspberrypi ~ $ sudo ls /sys/bus/w1/devices/w1_bus_master1/<br>
<br>
You can see the tabel below entered comman and<br>
there you should find HEX like 28-000002da8328; <br>
This is DS18B20 address;<br>
<br>
Next read the data from DS18B20 sensor using command:<br>
pi@raspberrypi ~ $ cat /sys/bus/w1/devices/w1_bus_master1/28-000002da8328/w1_sla <br>
<br>
And you are going see temperature in console like:<br>
6f 01 4b 46 7f ff 01 10 67: crc=67 YES<br>
6f 01 4b 46 7f ff 01 10 67 t=22937<br>
<br>
t=22937 ‚Äî you should divide this number on 1000 and you will have temperature in Celsius;<br>
<br>
 ‚Äî Raspbian Jezzy<br>
<br>
Enter command:<br>
pi@raspberrypi~$ sudo nano /boot/config.txt<br>
<br>
On next step you should write in config file <br>
dtoverlay=w1-gpio,gpiopin=4 <br>
dtoverlay=w1-gpio-pullup<br>
<br>
Then you should reboot your raspberry Pi;<br>
<br>
 ‚Äî I2C Real Time Clock settings:<br>
 ‚Äî Update your system if it needed and install i2c-tools:<br>
pi@raspberrypi~$ sudo apt-get update<br>
pi@raspberrypi~$ sudo apt-get -y upgrade<br>
pi@raspberrypi~$ sudo apt-get i2c-tools:<br>
<br>
Enter command:<br>
pi@raspberrypi~$ sudo nano /etc/modules<br>
Add these lines:<br>
i2c-bcm2708<br>
i2c-dev<br>
rtc_ds1307<br>
 <br>
Comment one line in file:<br>
pi@raspberrypi~$ sudo nano /etc/modprobe.d/raspi-blacklist.conf<br>
Add # Symbol in beginning of line<br>
<br>
blacklist i2c-bcm2708<br>
________________________________________________________<br>
Reboot system;<br>
Enter command:<br>
pi@raspberrypi~$ sudo lsmod<br>
<br>
You will see lines like:<br>
rtc_ds1307 7715 0<br>
i2c_dev 5277 0 <br>
i2c_bcm2708 4719 0<br>
________________________________________________________<br>
<br>
Get DS1307 address:<br>
pi@raspberrypi~$ sudo i2cdetect -y 1<br>
<br>
You will see table in console:<br>
<br>
0 1 2 3 4 5 6 7 8 9 a b c d e f<br>
00: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî 10: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî --<br>
20: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî --<br>
30: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî UU ‚Äî -- ‚Äî --<br>
40: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî --<br>
50: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî --<br>
60: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî -- 68 ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî 70: ‚Äî -- ‚Äî -- ‚Äî -- ‚Äî --<br>
 <br>
In address 0x3b some device without driver and 0x68 perhaps DS1307 clock address. <br>
<br>
Enter command:<br>
echo ds1307 0x68 &gt; /sys/class/i2c-adapter/i2c-1/new_device<br>
<br>
Read clock:<br>
pi@raspberrypi~$ sudo hwclock -r<br>
<br>
Set time:<br>
pi@raspberrypi~$ sudo hwclock -w<br>
Set system time from RTC:<br>
pi@raspberrypi~$ sudo hwclock -s<br>
<br>
Automatic RTC start;<br>
Add lines in /etc/rc.local file<br>
<br>
echo ds1307 0x68 &gt; /sys/class/i2c-adapter/i2c-1/new_device<br>
sudo hwclock -s<br>
Before last line in file looks like:<br>
<br>
exit 0<br>
 ‚Äî Uart settings:<br>
 ‚Äî Back up files:<br>
cp /boot/cmdline.txt /boot/cmdline.bak<br>
cp /etc/inittab /etc/inittab.bak<br>
<br>
Delete ¬´console=ttyAMA0,115200¬ª  ¬´kgdboc=ttyAMA0,115200¬ª lines from configuration file:<br>
pi@raspberrypi~$ nano /boot/cmdline.txt<br>
<br>
Comment last line looks like ¬´T0:23:respawn:/sbin/getty -L ttyAMA0 115200 vt100: in /etc/inittab file: using # symbol:<br>
pi@raspberrypi~$ nano /etc/inittab<br>
</blockquote><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A placa de circuito era urgentemente necess√°ria, ent√£o eu mesmo a fiz usando a tecnologia LUT e algumas horas de tempo livre. </font><font style="vertical-align: inherit;">Para facilitar o trabalho e economizar tempo, a placa de circuito foi fabricada unilateralmente com jumpers do MGShV 0.5. </font><font style="vertical-align: inherit;">Projeto do circuito DipTrace e PCB, c√≥digos-fonte de teste, lista de componentes e tutorial com comandos para configura√ß√£o no </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reposit√≥rio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no v√≠deo abaixo, √© utilizada a primeira placa de simula√ß√£o, que foi montada em uma placa de ensaio com bot√µes e LEDs em 20 minutos, as seguintes vers√µes apareceram em sua base:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/5uCV_gNWw2Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt401089/">https://habr.com/ru/post/pt401089/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt401077/index.html">China investir√° US $ 168 milh√µes em nuvens para que mais chova no noroeste do pa√≠s</a></li>
<li><a href="../pt401079/index.html">√ìbvio: controle autom√°tico da ilumina√ß√£o do banheiro</a></li>
<li><a href="../pt401083/index.html">Retroclock: o que acontecer√° se o ferro velho for "quebrado" com nitrog√™nio l√≠quido e h√©lio?</a></li>
<li><a href="../pt401085/index.html">Lakhta Terra Incognita: a batalha pela sustentabilidade de um arranha-c√©u</a></li>
<li><a href="../pt401087/index.html">IA: blefar, tirar dinheiro da popula√ß√£o e derrotar a incerteza</a></li>
<li><a href="../pt401091/index.html">7 produtos digitais para desktop estouraram em 2017</a></li>
<li><a href="../pt401093/index.html">Sony Xperia Ear Xea10: assistentes de voz se arrastaram para os ouvidos</a></li>
<li><a href="../pt401095/index.html">O que devo lhe dar, meu caro homem?</a></li>
<li><a href="../pt401097/index.html">–ó–Ω–∞–∫–æ–º—å—Ç–µ—Å—å: –Ω–æ–≤—ã–π Spectrum</a></li>
<li><a href="../pt401101/index.html">Os arquivos exclu√≠dos come√ßaram a retornar √†s pastas do Dropbox. Bug fixed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>