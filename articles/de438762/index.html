<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèª üíµ üé´ DBX: Versuchen Sie, das Kompilieren von MySQL-Abfragen zu vermeiden üèä üêù üèúÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor langer Zeit, als ich gerade anfing, PHP und die Feinheiten des Kompilierens von MySQL-Abfragen zu lernen (2011), hatte ich die Idee, einen Wrapper...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DBX: Versuchen Sie, das Kompilieren von MySQL-Abfragen zu vermeiden</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438762/">  Vor langer Zeit, als ich gerade anfing, PHP und die Feinheiten des Kompilierens von MySQL-Abfragen zu lernen (2011), hatte ich die Idee, einen Wrapper f√ºr MySQLi wie Doctrine zu schreiben, um die Syntax des Zugriffs auf die Datenbank zu vereinfachen.  Es ist bereits 2019 und ich habe beschlossen, mein Fahrrad zum Thema ORM zu teilen. <br><br>  Dies ist also DBX - das MySQL-Datenbankmodul f√ºr PHP, das auf der MySQLi-Bibliothek basiert und auf Abfragen der Strukturbeschreibung der Tabellen und Felder der Datenbank in Form eines regul√§ren Arrays mit der Funktion des statischen Abfrage-Caching und der automatischen Aktualisierung des statischen Hash basiert. <br><a name="habracut"></a><br>  Im Gegensatz zur allgemeinen Vorliebe f√ºr PDO wurde die leichte MySQLi-Funktionalit√§t gew√§hlt, die weicher und einfacher zu programmieren ist und pr√§ziser in die vorgeschlagene DBX-API passt.  Ich habe nicht einmal Composer verwendet, da ich keine Projekte habe, in denen ich andere Abh√§ngigkeiten von Drittanbietern als selbst geschrieben verwende. <br><br>  Betrachten Sie ein Beispiel f√ºr die Deklaration der Struktur einer einfachen Testdatenbank und ihrer Tabellen.  Zuerst verbinden wir die Bibliothek selbst mit der Klasse und senden die Autorisierungsdaten an den Datenbankhost: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'./DBX.php'</span></span>; $dbx_data = [<span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'dbx_test'</span></span>, <span class="hljs-string"><span class="hljs-string">'8889'</span></span>];</code> </pre> <br>  Stellen Sie sich nun vor, wir m√ºssen eine Tabelle in der Datenbank mit der Syntax eines regul√§ren PHP-Arrays beschreiben und erstellen: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * CREATE TABLE EXAMPLE */</span></span> $table_1 = <span class="hljs-string"><span class="hljs-string">'example'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// table name $query_1 = 'c'; // create table sql $fields_1 = [ 'field_id' =&gt; [ 'type' =&gt; 'num', // int 'auto' =&gt; true, // auto increment 'length' =&gt; 255, 'fill' =&gt; true // not null ], 'field_text' =&gt; [ 'type' =&gt; 'text', // varchar 'length' =&gt; 255, 'fill' =&gt; true ], 'field_date' =&gt; [ 'type' =&gt; 'time', // TIMESTAMP 'value' =&gt; date('Ym-d') ] ]; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Die Syntax ist hier einfach.  Ich habe keine starke Eingabe verwendet und nur die Werte TEXT, NUMBER und TYMESTAMP ausgew√§hlt.  F√ºr eine "steuerndere" Tabellenstruktur wird nat√ºrlich ein Schl√ºssel-ID-Feld mit automatischer Inkrementierung verwendet (ich habe in realen Projekten keine F√§lle gesehen, in denen eine automatische Inkrementierung und ein Schl√ºssel das Design von Abfragen und Tabellenbeziehungen beeintr√§chtigen).  Um anzuzeigen, ob das Feld leer sein kann, wird fill =&gt; true angegeben. <br><br>  DataBaseX-Abfragetypen sind sehr einfach und enthalten grundlegende Methoden wie Ausw√§hlen, Einf√ºgen, L√∂schen, Aktualisieren, L√∂schen, Abschneiden usw. <br><br>  Beispiel: Eine Abfrage zum Erstellen einer Tabelle: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// perform queries $dbx::query("c", $table_1, $fields_1);</span></span></code> </pre><br>  Oder eine Abfrage zum Hinzuf√ºgen von Daten und einer Spaltenstruktur k√∂nnte folgenderma√üen aussehen: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// fields values for table_1 example $fields_2 = [ 'field_id' =&gt; [ 'value' =&gt; 456 ], 'field_text' =&gt; [ 'value' =&gt; 'I have to add into my table' ], 'field_date' =&gt; [ 'value' =&gt; date('Ym-d') ] ]; // perform queries $dbx::query('i', $table_1, $fields_2);</span></span></code> </pre><br>  Die Struktur des Arrays erm√∂glicht es eines Tages, die Datenbank zu beschreiben und anschlie√üend nur die Wertefelder zu bearbeiten, um die Daten zu √§ndern, die zum Erstellen von Abfragen verwendet werden. <br><br>  Hier ist ein Beispiel f√ºr eine Update-Anweisung, die ich im folgenden Beispiel entfernen werde: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// fields values for table_1 example $fields_3 = [ 'field_id' =&gt; [ 'value' =&gt; 456 ], 'field_text' =&gt; [ 'new_value' =&gt; 'I was updated', 'criterion_field' =&gt; 'field_id', 'criterion_value' =&gt; 456 ], 'field_date' =&gt; [ 'value' =&gt; date('Ym-d') ] ]; // perform queries $dbx::query('u', $table_1, $fields_3);</span></span></code> </pre><br>  Es schien mir, dass die Verwendung der Felder Criterion_field und Criterion_value das System kompliziert. Daher habe ich eine Abfrage erstellt, die entweder automatisch Daten zur Datenbank hinzuf√ºgt, wenn diese noch nicht erstellt wurden, oder vorhandene Daten aktualisiert.  Ich habe diese Abfrage INJECT QUERY genannt und sie wird mit dem Pr√§fix "in" aufgerufen: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// fields values for table_1 example $fields_2 = [ 'field_id' =&gt; [ 'value' =&gt; 0 ], 'field_text' =&gt; [ 'value' =&gt; 'Yo if field_id = 0 it\'s an insert or if id exists it\'s an update' ], 'field_date' =&gt; [ 'value' =&gt; date('Ym-d') ] ]; // perform queries $dbx::query('in', $table_1, $fields_2);</span></span></code> </pre><br>  Dies funktioniert auf einem niedrigen Niveau wie folgt: <br><br><pre> <code class="php hljs">INSERT INTO `revolver__comments` (`field_id`, `field_content`) VALUES (<span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-string"><span class="hljs-string">'TEST UPDATE'</span></span>) ON DUPLICATE KEY UPDATE `field_id`=<span class="hljs-string"><span class="hljs-string">'5'</span></span>, `field_content`=<span class="hljs-string"><span class="hljs-string">'TEST UPDATE'</span></span>;</code> </pre><br>  Alle anderen Abfragen sind die einfachsten und es macht keinen Sinn, sie zu beschreiben (siehe Beispiele in der Testdatei index.php), aber ich kann nicht anders, als zu zeigen, wie die SELECT-Abfrage funktioniert: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// perform queries $dbx::query('s|field_id|asc|100|0', $table_1, $fields_1); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> // print structure print '&lt;h2&gt;DBX STRUCTURE&lt;/h2&gt;'; print '&lt;pre&gt;&lt;code&gt;'; print_r( $fields_1 ); print '&lt;/code&gt;&lt;/pre&gt;'; // print result print '&lt;h2&gt;DBX QUERY RESULT&lt;/h2&gt;'; print '&lt;pre&gt;&lt;code&gt;'; print_r( $dbx::$result ); print '&lt;/code&gt;&lt;pre&gt;&lt;hr /&gt;'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Hier k√∂nnen Sie mit dem Pr√§fix "s" die Abfrageparameter <b>s | field_id ( <i>order</i> ) | asc ( <i>direction</i> ) | 100 ( <i>limit</i> ) | 0 ( <i>offset</i> ) gruppieren</b> . <br><br>  DBX verf√ºgt unter anderem √ºber eine Besonderheit wie einen integrierten Dateicache, der auf der JSON-Statik basiert.  Jede √Ñnderungsanforderung (INSERT, UPDATE, DELETE, TRUNCATE) bewirkt, dass der Hash in der Cache-Hash-Tabelle berechnet wird, und aktualisiert automatisch den statischen Cache, sodass Sie nicht √ºber die Belastung von SELECT-Abfragen nachdenken k√∂nnen. <br><br>  In Zukunft plane ich, die DBX-Engine zu entwickeln und die Funktionen des SQL-Abfrage-Designers mithilfe des Konfigurationssystems UNION und JOIN zu erweitern sowie neue Datenbankunterst√ºtzung von MySQL 8 basierend auf dem JSON-Strukturtyp hinzuzuf√ºgen. <br><br>  Jetzt wird DBX in meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RevolveR-</a> Content-Management-System verwendet und weist gute Eigenschaften auf (die gesamte Site, sofern ein aktualisierter Cache vorhanden ist, wird mit einer Abfrage an die Datenbank initialisiert und belegt etwa 0,7 MB Interpreter-RAM).  F√ºr mich ist es auch sehr praktisch, die gesamte Datenbankstruktur in einer separaten Datei anzuzeigen, was manchmal den Aufbau und das Design neuer Module beschleunigt. <br><br>  <b>Projekt-Repository: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DBX v1.1.1 auf GitHub</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438762/">https://habr.com/ru/post/de438762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438750/index.html">Zivilisation der Quellen, 4/5</a></li>
<li><a href="../de438752/index.html">Buchhaltung direkt bei der Bank: Wie man einzelne Unternehmer gl√ºcklich macht</a></li>
<li><a href="../de438754/index.html">Wie wir die Netzwerk√ºberwachung f√ºr 14.000 Objekte durchgef√ºhrt haben</a></li>
<li><a href="../de438756/index.html">Sechster Chromcheck, Nachwort</a></li>
<li><a href="../de438758/index.html">Warum √§ndert Google die Standard-URL-Oberfl√§che im Browser?</a></li>
<li><a href="../de438764/index.html">Sechster Chromtest, Nachwort</a></li>
<li><a href="../de438766/index.html">Extrazellul√§re DNA als Biomarker des Alterns und verschiedener Pathologien</a></li>
<li><a href="../de438768/index.html">Wie ich Alice half, nicht auf andere Namen zu antworten. Yandex Praktikum</a></li>
<li><a href="../de438770/index.html">Umgang mit Tastenanschl√§gen, auch als Verkn√ºpfungen bezeichnet, und Debugging</a></li>
<li><a href="../de438772/index.html">HX711 ADC von 3.3V - glauben Sie nicht der chinesischen Dokumentation und nicht nur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>