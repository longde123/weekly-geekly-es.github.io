<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèΩ üë® üî¢ Como o Yandex.Zen, o WordPress Caching Plugin e Hosting aumentaram minha press√£o üë®üèø‚Äçü§ù‚Äçüë®üèæ ü¶Ö üçç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √©, antes, de uma s√©rie de "notas de anfitri√£". Bem, um pouco mais sobre experi√™ncias pessoais e goivagem. 

 Se voc√™ precisar lidar com si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o Yandex.Zen, o WordPress Caching Plugin e Hosting aumentaram minha press√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423005/"><img src="https://habrastorage.org/webt/12/3o/cf/123ocfvpows898t7vrwuhhveguo.jpeg" alt="imagem" width="100%"><br><br>  Este artigo √©, antes, de uma s√©rie de "notas de anfitri√£".  Bem, um pouco mais sobre experi√™ncias pessoais e goivagem. <br><br>  Se voc√™ precisar lidar com sites WordPress com o plug-in de cache WP Super Cache instalado, o artigo poder√° ser √∫til para voc√™.  Caso contr√°rio, isso √© apenas uma pequena hist√≥ria. <br><a name="habracut"></a><br>  Em suma, o come√ßo da hist√≥ria √© este: havia um site.  Not√≠cias e informa√ß√µes tem√°ticas.  Feito por um assistente desconhecido no CMS WordPress.  E feito exatamente como foi permitido naquele momento pelos meios de seu dono.  Com o tempo, o site ganhou popularidade, o n√∫mero de visitantes cresceu.  O site em si "ganhou" em publicidade.  I.e.  quanto mais visitantes, melhor.  Em algum momento, durante os picos de carga, o site come√ßou a aparecer: p√°ginas carregadas lentamente e tudo mais.  Mas, √© claro, at√© o pau bicar, ningu√©m realmente se mexeu.  O galo apareceu no momento em que o site deveria cobrir algum evento que atraiu a aten√ß√£o do p√∫blico.  Os visitantes chegaram, o site caiu e toda a receita estimada estava derretendo diante de nossos olhos.  Devido √†s circunst√¢ncias, tive que atuar como um ressuscitador.  Eu escrevi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um artigo</a> sobre isso ent√£o.  Minha decis√£o foi assustadora (n√£o repita), mas o objetivo principal foi cumprido - os sonhos foram salvos.  Principalmente. <br><br>  Obviamente, ningu√©m estava interessado em repetir uma situa√ß√£o semelhante e trabalhou no site.  Primeiro, eles descobriram os motivos da queda e da alta carga no servidor.  Eles eram comuns: a falta de um site de cache em si e um mecanismo mal implementado para registrar e exibir o n√∫mero de visualiza√ß√µes de artigos.  Este √∫ltimo criou uma carga decente: com cada solicita√ß√£o para a p√°gina do artigo, ele pegava no banco de dados o n√∫mero de visualiza√ß√µes deste artigo, exibia-o e, em seguida, adicionava um e o escrevia de volta ao banco de dados.  Ao mesmo tempo, a tabela <b>wp_postmeta</b> com metadados foi usada para armazenamento (como parece ser chamado no WP).  Em que a massa foi armazenada completamente irrelevante para as vis√µes cont√°beis das informa√ß√µes e que era muito grande. <br><br>  O problema de armazenamento em cache foi resolvido simplesmente: em um ambiente silencioso, o plug-in WP Super Cache era instalado normalmente.  O que muitos, se bem me lembro, me aconselharam a fazer, em vez da muleta sinistra que constru√≠ nos coment√°rios desse artigo meu.  Honestamente, eu ent√£o e agora navegava mal no ecossistema do WordPress e, portanto, essa muleta apareceu.  O plug-in de armazenamento em cache foi instalado e configurado por pessoas que j√° conheciam e saiu da caixa.  Assim, o problema de armazenamento em cache foi resolvido.  Por que esse plugin foi escolhido, n√£o sei ao certo.  Tanto quanto eu entendo, este √© um dos plugins mais populares desse tipo para o WP. <br><br>  Dadas as opini√µes, eles agiram de maneira um pouco diferente.  √â claro que o mecanismo original teve que ser abandonado.  N√£o queria me recusar a levar em conta as opini√µes: pelo menos um bloco exibido como "os artigos mais populares da semana" estava vinculado a ele.  Todos os plug-ins para gravar visualiza√ß√µes, mesmo que fossem "amigos" do plug-in de cache, mostraram-se muito vorazes e, na maioria das vezes, implementaram o mesmo mecanismo com a grava√ß√£o e extra√ß√£o de dados do wp_postmeta.  Para um site pequeno, isso √© bastante adequado.  Para um site com taxas de frequ√™ncia de pico bastante s√≥lidas - n√£o √© mais: glut√£o demais para uma fun√ß√£o t√£o pequena.  Ent√£o, a prop√≥sito, eu apareci hospedagem paga e n√£o utilizada nos pr√≥ximos anos.  O mais f√°cil e mais barato.  As responsabilidades de armazenar, registrar e devolver dados sobre visualiza√ß√µes estavam nele.  Tudo √© ass√≠ncrono, ou seja,  mesmo que caia, o site principal continuar√° exibindo silenciosamente artigos, an√∫ncios e tudo o que deve exibir.  O armazenamento online dos dados de visualiza√ß√£o foi atribu√≠do ao Redis e o armazenamento de longo prazo ao MySQL.  Por isso, est√° girando, n√£o √© realmente necess√°rio e consome 1-2% da carga m√°xima permitida nessa hospedagem. <br><br>  E assim, passa muito tempo.  Novamente noite e novamente uma hist√≥ria antiga.  Um tr√°fego bastante poderoso vai para o site e o site come√ßa a cair.  E, novamente, sou o √∫nico especialista condicional acordado na √°rea.  √â claro que estou surpreso com a repeti√ß√£o de eventos.  Meu primeiro pensamento √© que algu√©m acidentalmente desativou o cache.  Mas n√£o, no c√≥digo fonte da p√°gina do site que o servidor em queda me fornece, vejo sinais de um plug-in de cache funcionando.  Tudo deve ficar bem.  Mas no painel de controle do servidor, vejo que n√£o h√° RAM, o n√∫mero de consultas ao banco de dados √© incr√≠vel e tudo est√° ruim.  Antes de tudo, abro a p√°gina com a descri√ß√£o do plugin, corro rapidamente pelos olhos dela, n√£o encontro nada e deixo essa atividade.  O pr√≥ximo passo √© ver as estat√≠sticas.  Vejo que o fluxo de tr√°fego principal est√° fluindo para o site a partir do Yandex.Zen.  E a solicita√ß√£o que leva o usu√°rio ao site √© assim: <br><br><blockquote>  https://example.com <b>? utm_referrer = https:% 2F% 2Fzen.yandex.com</b> </blockquote><br>  I.e.  Yandex.Zen adiciona sua tag utm ao endere√ßo.  Como o servidor j√° est√° completamente deitado e me d√° apenas 500, por algum motivo, n√£o posso verificar claramente a teoria de que p√°ginas com essa "pondera√ß√£o" n√£o s√£o armazenadas em cache.  Portanto, outra "muleta" nasce (foi substitu√≠da posteriormente): um redirecionamento √© adicionado ao .htaccess, que converte a solicita√ß√£o com tags utm em uma solicita√ß√£o sem elas antes que o WordPress e todos os seus plugins poderosos entrem em jogo.  A m√°quina √© reinicializada e, pronto, tudo funciona: o site carrega rapidamente, o servidor silenciosamente se move em baixas velocidades.  Como nada aconteceu. <br><br>  Ent√£o relaxei e subi calmamente assistindo as configura√ß√µes do plug-in de cache.  Primeiro de tudo, a caixa de sele√ß√£o "N√£o armazenar em cache p√°ginas com par√¢metros GET", que est√° l√°.  Est√° tudo bem, ela n√£o vale a pena.  Al√©m disso, como o experimento mostrou, o plug-in lida com o cache de consultas com qualquer conjunto de par√¢metros arbitr√°rios.  Se essas n√£o s√£o tags utm (na verdade, apenas redirecionei solicita√ß√µes de um determinado tipo e n√£o cortei todas as tags utm). <br><br>  Aqui eu cuidadosamente (usando CTRL + F) olhei para a p√°gina do plugin.  E encontrei no FAQ o glorioso par√°grafo "Como devo usar melhor as ferramentas de rastreamento utm_source no Google Analytics com este plug-in?".  √â claro que, durante o primeiro exame superficial, eu o ignorei com seguran√ßa: parece n√£o haver nada a ver com o problema.  Ao mesmo tempo, a prop√≥sito, n√£o √© muito informativo e n√£o oferece nenhuma solu√ß√£o espec√≠fica. <br><br>  <b>A √∫nica conclus√£o √∫til poss√≠vel no artigo:</b> se voc√™ possui um site WP com o plug-in WP Super Cache, verifique o que ele faz (ou n√£o), se voc√™ enviar uma solicita√ß√£o com os par√¢metros ‚Äú? Utm_referrer = https:% 2F% 2Fzen. yandex.com "etc.  N√£o tenho certeza de que, ao instalar este plug-in, todos leiam suas perguntas frequentes com muito cuidado.  A implementa√ß√£o espec√≠fica, aparentemente, permanece com os propriet√°rios do site: quando olhei pela √∫ltima vez para a atualiza√ß√£o deste plug-in, n√£o vi altera√ß√µes relacionadas √† sua estranha rea√ß√£o √†s tags utm. <br><br>  Mas a hist√≥ria teria sido incompleta (e eu n√£o teria contado) se n√£o houvesse outra confirma√ß√£o da lei de Murphy.  Enquanto nos correspond√≠amos pacificamente com o propriet√°rio do site e observamos como o site funcionava silenciosamente por cerca de uma hora ... o site caiu.  Inesperadamente e finalmente.  N√£o h√° acesso ao painel de controle do servidor, FTP, SSH e tudo o mais n√£o funciona.  Nada funciona  Se antes disso minha press√£o foi levemente aumentada ao resolver o problema que J. Zen e o plug-in de armazenamento em cache criaram (afinal, √© um prazer especial entender e corrigir rapidamente algo de uma maneira f√°cil), ent√£o um ataque de mini-p√¢nico inteiro aconteceu comigo.  E apenas a vaga sensa√ß√£o de que algumas linhas no .htaccess n√£o podem matar tudo uma hora depois de criar essas linhas n√£o permitiu que o ‚Äúmini‚Äù se transformasse em algo mais completo.  Em geral, ap√≥s alguns minutos de troca de mensagens surpresas, entramos na conta pessoal do provedor de hospedagem onde o servidor mora.  E l√°, nos tickets, encontramos um aviso sobre "trabalho t√©cnico de X a Y no MSC".  O mais interessante √© que, nos correios, n√£o importa como pesquisamos, n√£o encontramos nenhuma mensagem do hoster sobre esses trabalhos.  O ingresso tinha pelo menos um dia.  Antes disso, essas mensagens chegavam ao correio e, normalmente, ningu√©m olha para os tickets do servi√ßo de suporte (e do pr√≥prio escrit√≥rio do hoster) normalmente sem necessidade especial.  Portanto, o que aconteceu foi uma grande surpresa.  Depois disso, repreendemos os olhos do hoster, rimos, esperamos at√© que tudo desse certo e fomos dormir. <br><br>  Aqui est√° uma hist√≥ria. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423005/">https://habr.com/ru/post/pt423005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422989/index.html">Um banco de dados n√£o √© apenas um armaz√©m de dados</a></li>
<li><a href="../pt422993/index.html">Gravando TVs OLED em testes reais</a></li>
<li><a href="../pt422995/index.html">Meta de controle de qualidade em Redmadrobot</a></li>
<li><a href="../pt422997/index.html">O livro "PHP Moderno"</a></li>
<li><a href="../pt422999/index.html">Crie seu pr√≥prio conjunto de dados alien√≠genas</a></li>
<li><a href="../pt423007/index.html">‚ÄúMalyavki, mas bom‚Äù: como levamos os alunos a praticar</a></li>
<li><a href="../pt423009/index.html">Diagn√≥stico SENS. Biomarcadores de glica√ß√£o de prote√≠nas</a></li>
<li><a href="../pt423011/index.html">Gerenciamento de microsservi√ßos com Kubernetes e Istio</a></li>
<li><a href="../pt423013/index.html">Como organizar suas depend√™ncias em um aplicativo Vue</a></li>
<li><a href="../pt423015/index.html">Git: erros comuns e como corrigi-los</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>