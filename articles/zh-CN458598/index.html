<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‡ğŸ¼ ğŸ™ğŸ¼ ğŸ”“ åœ¨ç¯å¢ƒåœ°å›¾ä¸Šè¯†åˆ«å…‰æº ğŸ•¢ ğŸ‘‹ â™‹ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡ä»‹ç»äº†è¯¥ç®—æ³•çš„Pythonå®ç°ï¼Œè¯¥ç®—æ³•ä½¿ç”¨ç­‰è§’çŸ©å½¢æŠ•å½±è¯†åˆ«ç¯å¢ƒåœ°å›¾ï¼ˆLDRæˆ–HDRï¼‰ä¸Šçš„å…‰æºã€‚ ä½†æ˜¯ï¼Œåœ¨è¿›è¡Œè¾ƒå°çš„æ›´æ”¹åï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºç®€å•çš„èƒŒæ™¯å›¾åƒæˆ–ç«‹æ–¹å›¾ã€‚ è¯¥ç®—æ³•å¯èƒ½çš„åº”ç”¨ç¤ºä¾‹ï¼šå…‰çº¿è·Ÿè¸ªç¨‹åºï¼Œåœ¨å…¶ä¸­éœ€è¦è¯†åˆ«ä¸»è¦å…‰æºä»¥ä¾¿ä»å®ƒä»¬å‘å‡ºå…‰çº¿ï¼› åœ¨æ …æ ¼åŒ–æ¸²æŸ“å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¯å¢ƒè´´å›¾æ¥æŠ•å°„é˜´å½±ï¼› æ­¤å¤–ï¼Œè¯¥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨ç¯å¢ƒåœ°å›¾ä¸Šè¯†åˆ«å…‰æº</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458598/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a44/e48/451/a44e484510a596be61f83f9c303f25fc.png" alt="å›¾ç‰‡"></div><br> æœ¬æ–‡ä»‹ç»äº†è¯¥ç®—æ³•çš„Pythonå®ç°ï¼Œè¯¥ç®—æ³•ä½¿ç”¨ç­‰è§’çŸ©å½¢æŠ•å½±è¯†åˆ«ç¯å¢ƒåœ°å›¾ï¼ˆLDRæˆ–HDRï¼‰ä¸Šçš„å…‰æºã€‚ ä½†æ˜¯ï¼Œåœ¨è¿›è¡Œè¾ƒå°çš„æ›´æ”¹åï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºç®€å•çš„èƒŒæ™¯å›¾åƒæˆ–ç«‹æ–¹å›¾ã€‚ è¯¥ç®—æ³•å¯èƒ½çš„åº”ç”¨ç¤ºä¾‹ï¼šå…‰çº¿è·Ÿè¸ªç¨‹åºï¼Œåœ¨å…¶ä¸­éœ€è¦è¯†åˆ«ä¸»è¦å…‰æºä»¥ä¾¿ä»å®ƒä»¬å‘å‡ºå…‰çº¿ï¼› åœ¨æ …æ ¼åŒ–æ¸²æŸ“å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¯å¢ƒè´´å›¾æ¥æŠ•å°„é˜´å½±ï¼› æ­¤å¤–ï¼Œè¯¥ç®—æ³•è¿˜å¯ä»¥ç”¨äºèšå…‰æ¶ˆé™¤ç¨‹åºä¸­ï¼Œä¾‹å¦‚ARã€‚ <br><br> è¯¥ç®—æ³•åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š <br><br><ol><li> å°†åŸå§‹å›¾åƒçš„åˆ†è¾¨ç‡é™ä½åˆ°ä¾‹å¦‚1024ã€‚ </li><li> å¦‚æœ‰å¿…è¦ï¼Œå°†å›¾åƒè½¬æ¢ä¸ºäº®åº¦ï¼ˆäº®åº¦ï¼‰ï¼Œå¹¶è¿›è¡Œå›¾åƒæ¨¡ç³Šå¤„ç†ã€‚ </li><li> å‡†è’™ç‰¹å¡ç½—æ–¹æ³•çš„åº”ç”¨ã€‚ </li><li> ä»çƒåæ ‡è½¬æ¢ä¸ºç­‰è·åæ ‡ã€‚ </li><li> æ ¹æ®é‚»å±…çš„äº®åº¦è¿‡æ»¤æ ·æœ¬ã€‚ </li><li> æ ¹æ®æ ·æœ¬çš„äº®åº¦å¯¹å…¶æ’åºã€‚ </li><li> æ ¹æ®æ¬§å‡ é‡Œå¾·åº¦é‡æ ‡å‡†è¿‡æ»¤æ ·æœ¬ã€‚ </li><li> ä½¿ç”¨Bresenhamç®—æ³•åˆå¹¶æ ·æœ¬ã€‚ </li><li> æ ¹æ®å…¶äº®åº¦è®¡ç®—ç…§æ˜é›†ç¾¤çš„ä½ç½®ã€‚ </li></ol><br> æœ‰è®¸å¤šé™ä½å›¾åƒåˆ†è¾¨ç‡çš„ç®—æ³•ã€‚ åŒçº¿æ€§æ»¤æ³¢æ˜¯æœ€å¿«æˆ–æœ€å®¹æ˜“å®ç°çš„ï¼Œæ­¤å¤–ï¼Œå®ƒæœ€é€‚åˆå¤§å¤šæ•°æƒ…å†µã€‚ è¦åŒæ—¶è½¬æ¢LDRå’ŒHDRå›¾åƒçš„äº®åº¦ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†å…¬å¼ï¼š <br><br><pre><code class="python hljs">lum = img[:, :, <span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">0.2126</span></span> + img[:, :, <span class="hljs-number"><span class="hljs-number">1</span></span>] * <span class="hljs-number"><span class="hljs-number">0.7152</span></span> + img[:, :, <span class="hljs-number"><span class="hljs-number">2</span></span>] * <span class="hljs-number"><span class="hljs-number">0.0722</span></span></code> </pre> <br> æ­¤å¤–ï¼Œæ‚¨å¯ä»¥å¯¹äº®åº¦å›¾åƒè¿›è¡Œè½»å¾®çš„æ¨¡ç³Šå¤„ç†ï¼Œä¾‹å¦‚ï¼Œå¯¹äºåˆ†è¾¨ç‡ä¸º1024çš„å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨1-2åƒç´ ï¼Œä»¥æ¶ˆé™¤æ‰€æœ‰é«˜é¢‘ç»†èŠ‚ï¼ˆç‰¹åˆ«æ˜¯åˆ†è¾¨ç‡é™ä½å¼•èµ·çš„ï¼‰ã€‚ <br><a name="habracut"></a><br><h3> ç­‰è·æŠ•å½± </h3><br> ç¯å¢ƒåœ°å›¾ä¸­æœ€å¸¸è§çš„æŠ•å½±æ˜¯ç­‰è·æŠ•å½±<sup>3</sup> ã€‚ æˆ‘çš„ç®—æ³•å¯ä»¥ä¸å…¶ä»–æŠ•å½±é…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ä¸å…¨æ™¯å›¾å’Œç«‹æ–¹å›¾é…åˆä½¿ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»…è€ƒè™‘ç­‰è·æŠ•å½±ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦æ ‡å‡†åŒ–å›¾åƒåæ ‡ï¼š <br><br><pre> <code class="python hljs">pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = x / width pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = y / height</code> </pre> <br> ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨çƒé¢åæ ‡å°†ç¬›å¡å°”åæ ‡è½¬æ¢ä¸ºç¬›å¡å°”åæ ‡ï¼Œå³  Î¸å’ŒÏ†ï¼Œå…¶ä¸­Î¸= x *2Ï€ï¼Œè€ŒÏ†= y *Ï€ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sphereToEquirectangular</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pos)</span></span></span><span class="hljs-function">:</span></span> invAngles = (<span class="hljs-number"><span class="hljs-number">0.1591</span></span>, <span class="hljs-number"><span class="hljs-number">0.3183</span></span>) xy = (math.atan2(pos[<span class="hljs-number"><span class="hljs-number">1</span></span>], pos[<span class="hljs-number"><span class="hljs-number">0</span></span>]), math.asin(pos[<span class="hljs-number"><span class="hljs-number">2</span></span>])) xy = (xy[<span class="hljs-number"><span class="hljs-number">0</span></span>] * invAngles[<span class="hljs-number"><span class="hljs-number">0</span></span>], xy[<span class="hljs-number"><span class="hljs-number">1</span></span>] * invAngles[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (xy[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>, xy[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equirectangularToSphere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pos)</span></span></span><span class="hljs-function">:</span></span> angles = (<span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">0.1591</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">0.3183</span></span>) thetaPhi = (pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-number"><span class="hljs-number">0.5</span></span>, pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">0.5</span></span>) thetaPhi = (thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>] * angles[<span class="hljs-number"><span class="hljs-number">0</span></span>], thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>] * angles[<span class="hljs-number"><span class="hljs-number">1</span></span>]) length = math.cos(thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (math.cos(thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>]) * length, math.sin(thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>]) * length, math.sin(thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>]))</code> </pre> <br><h3> å“ˆé»˜æ–¯åˆ©é‡‡æ · </h3><br> ä¸‹ä¸€æ­¥å°†åº”ç”¨å‡†è’™ç‰¹å¡ç½—æ–¹æ³•ï¼Œä¾‹å¦‚Hammersley <sup>2</sup>é‡‡æ ·ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f9/b07/70f/4f9b0770f72e69ede59e56a25258343d.png"></div><br> æ‚¨å¯ä»¥ä½¿ç”¨å…¶ä»–é‡‡æ ·æ–¹æ³•ï¼Œä¾‹å¦‚Holton <sup>4</sup> ï¼Œä½†æ˜¯Hammersleyé€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ•´ä¸ªçƒä½“ä¸Šæä¾›è‰¯å¥½çš„æ ·æœ¬åˆ†å¸ƒã€‚ å¦‚æœä½¿ç”¨ç®€å•çš„å›¾åƒä»£æ›¿ç¯å¢ƒè´´å›¾ï¼Œåˆ™Holtonå°†æ˜¯é£æœºæ ·æœ¬çš„ä¸é”™é€‰æ‹©ã€‚  Hammersleyé‡‡æ ·çš„å¼ºåˆ¶æ€§è¦æ±‚æ˜¯van der Corputeçš„æ ¹ï¼ˆè¡Œï¼‰å€’ç½®ï¼Œæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§é“¾æ¥<sup>2</sup> ã€‚ è¿™æ˜¯å®ƒçš„å¿«é€Ÿå®ç°ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vdcSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bits)</span></span></span><span class="hljs-function">:</span></span> bits = (bits &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) | (bits &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x55555555</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xAAAAAAAA</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x33333333</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xCCCCCCCC</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x0F0F0F0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xF0F0F0F0</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x00FF00FF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xFF00FF00</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(bits) * <span class="hljs-number"><span class="hljs-number">2.3283064365386963e-10</span></span> <span class="hljs-comment"><span class="hljs-comment"># / 0x100000000 def hammersleySequence(i, N): return (float(i) / float(N), vdcSequence(i))</span></span></code> </pre> <br> ç„¶åï¼Œæˆ‘ä»¬åœ¨çƒä½“ä¸Šä½¿ç”¨å‡åŒ€è¦†ç›–ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sphereSample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u, v)</span></span></span><span class="hljs-function">:</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159265358979</span></span> phi = v * <span class="hljs-number"><span class="hljs-number">2.0</span></span> * PI cosTheta = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * u - <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment"># map to -1,1 sinTheta = math.sqrt(1.0 - cosTheta * cosTheta); return (math.cos(phi) * sinTheta, math.sin(phi) * sinTheta, cosTheta)</span></span></code> </pre> <br> ä¸ºäº†å¯¹Hammersleyè¿›è¡Œé‡‡æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨å›ºå®šæ•°é‡çš„é‡‡æ ·ï¼Œå…·ä½“å–å†³äºå›¾åƒçš„åˆ†è¾¨ç‡ï¼Œç„¶åä»çƒåæ ‡è½¬æ¢ä¸ºç¬›å¡å°”åæ ‡ï¼Œç„¶åè½¬æ¢ä¸ºç­‰è·ï¼š <br><br><pre> <code class="python hljs"> samplesMultiplier = <span class="hljs-number"><span class="hljs-number">0.006</span></span> samples = int(samplesMultiplier * width * height) samplesList = [] <span class="hljs-comment"><span class="hljs-comment"># apply hammersley sampling for i in range(0, samples): xi = hammersleySequence(i, samples) xyz = sphereSample(xi[0], xi[1]) # to cartesian imagePos = sphereToEquirectangular(xyz) luminance = lum[imagePos[0] * width, imagePos[1] * height]</span></span></code> </pre> <br> è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¾ˆå¥½åœ°åˆ†å¸ƒæ ·æœ¬ï¼Œå°†æ£€æŸ¥å…‰æºæ˜¯å¦å­˜åœ¨ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/0a6/470/aa80a64703ef6e38cd0b73f9b02a5852.png"></div><br><h3> è¿‡æ»¤å…‰æº </h3><br> åœ¨ç¬¬ä¸€éè¿‡æ»¤ä¸­ï¼Œæˆ‘ä»¬å°†å¿½ç•¥æ‰€æœ‰æœªè¶…è¿‡äº®åº¦é˜ˆå€¼çš„æ ·æœ¬ï¼ˆå¯¹äºHDRå¡ï¼Œå¯èƒ½ä¼šæ›´é«˜ï¼‰ï¼Œç„¶åæŒ‰ç…§äº®åº¦å¯¹æ‰€æœ‰æ ·æœ¬è¿›è¡Œæ’åºï¼š <br><br><pre> <code class="python hljs"> localSize = int(float(<span class="hljs-number"><span class="hljs-number">12</span></span>) * (width / <span class="hljs-number"><span class="hljs-number">1024.0</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span> samplesList = [] <span class="hljs-comment"><span class="hljs-comment"># apply hammersley sampling for i in range(0, samples): xi = hammersleySequence(i, samples) xyz = sphereSample(xi[0], xi[1]) # to cartesian imagePos = sphereToEquirectangular(xyz) luminance = lum[imagePos [0] * width, imagePos [1] * height] sample = Sample(luminance, imagePos , xyz) luminanceThreshold = 0.8 #do a neighbour search for the maximum luminance nLum = computeNeighborLuminance(lum, width, height, sample.imagePos, localSize) if nLum &gt; luminanceThreshold: samplesList.append(sample) samplesList = sorted(samplesList, key=lambda obj: obj.luminance, reverse=True)</span></span></code> </pre> <br> ä¸‹ä¸€éå°†åŸºäºæ¬§å‡ é‡Œå¾·åº¦é‡å’Œåƒç´ ä¹‹é—´çš„é˜ˆå€¼è·ç¦»ï¼ˆå–å†³äºå›¾åƒçš„åˆ†è¾¨ç‡ï¼‰è¿›è¡Œè¿‡æ»¤-è¿™æ˜¯ä¸€ç§ç©ºé—´æ•°æ®ç»“æ„ï¼Œå¯ç”¨äºæ¶ˆé™¤å¤æ‚åº¦Oï¼ˆN <sup>2</sup> ï¼‰ï¼š <br><br><pre> <code class="python hljs"> euclideanThreshold = int(float(euclideanThresholdPixel) * (width / <span class="hljs-number"><span class="hljs-number">2048.0</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># filter based euclidian distance filteredCount = len(samplesList) localIndices = np.empty(filteredCount); localIndices.fill(-1) for i in range(0, filteredCount): cpos = samplesList[i].pos if localIndices[i] == -1: localIndices[i] = i for j in range(0, filteredCount): if i != j and localIndices[j] == -1 and distance2d(cpos, samplesList[j].pos) &lt; euclideanThreshold: localIndices[j] = i</span></span></code> </pre> <br> æ‰€å¾—æ ·æœ¬ç»è¿‡åˆå¹¶é˜¶æ®µä»¥è¿›ä¸€æ­¥å‡å°‘å…‰æºæ•°é‡ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d39/152/e1e/d39152e1e587c40c3ed29888faf02120.png"></div><br><h3> åˆå¹¶å…‰æº </h3><br> åœ¨æœ€åé˜¶æ®µï¼Œåˆå¹¶å±äºåŒä¸€ç…§æ˜é›†ç¾¤çš„æ ·æœ¬ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Bresenhamç®—æ³•ï¼Œå¹¶ä»äº®åº¦æœ€é«˜çš„æ ·æœ¬å¼€å§‹ï¼Œå› ä¸ºå®ƒä»¬å·²ç»è¢«è®¢è´­ã€‚ å½“æˆ‘ä»¬æ‰¾åˆ°æ»¡è¶³Bresenhamæµ‹è¯•è¦æ±‚çš„å…‰æºæ—¶ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®å…¶è¿è¡Œæƒé‡ä½¿ç”¨å…¶ä½ç½®æ›´æ”¹å…‰æºçš„ä½ç½®ï¼š <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># apply bresenham check and compute position of the light clusters lights = [] finalIndices = np.empty(filteredCount); finalIndices.fill(-1) for i in localIndices: sample = samplesList[i] startPos = sample.pos if finalIndices[i] == -1: finalIndices[i] = i light = Light() light.originalPos = np.array(sample.pos) # position of the local maxima light.worldPos = np.array(sample.worldPos) light.pos = np.array(sample.pos) light.luminance = sample.luminance for j in localIndices: if i != j and finalIndices[j] == -1: endPos = samplesList[j].pos if bresenhamCheck(lum, width, height, startPos[0], startPos[1], endPos[0], endPos[1]): finalIndices[j] = i # compute final position of the light source sampleWeight = samplesList[j].luminance / sample.luminance light.pos = light.pos + np.array(endPos) * sampleWeight light.pos = light.pos / (1.0 + sampleWeight) imagePos = light.pos * np.array([1.0 / width, 1.0 / height) light.worldPos = equirectangularToSphere(imagePos) lights.append(light)</span></span></code> </pre> <br>  BresenhamåŠŸèƒ½ä¼šæ£€æŸ¥äº®åº¦ç›¸åŒçš„è¿ç»­çº¿ã€‚ å¦‚æœå½“å‰åƒç´ ä¸­çš„å¢é‡è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼Œåˆ™æ£€æŸ¥å¤±è´¥ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bresenhamCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lum, imageSize, x0, y0, x1, y1)</span></span></span><span class="hljs-function">:</span></span> dX = int(x1 - x0) stepX = int((dX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) - (dX &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) dX = abs(dX) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> dY = int(y1 - y0) stepY = int((dY &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) - (dY &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) dY = abs(dY) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> luminanceThreshold = <span class="hljs-number"><span class="hljs-number">0.15</span></span> prevLum = lum[x0][y0] sumLum = <span class="hljs-number"><span class="hljs-number">0.0</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dX &gt;= dY): <span class="hljs-comment"><span class="hljs-comment"># delta may go below zero delta = int (dY - (dX &gt;&gt; 1)) while (x0 != x1): # reduce delta, while taking into account the corner case of delta == 0 if ((delta &gt; 0) or (delta == 0 and (stepX &gt; 0))): delta -= dX y0 += stepY delta += dY x0 += stepX sumLum = sumLum + min(lum[x0][y0], 1.25) c = c + 1 if(abs(sumLum / c - prevLum) &gt; luminanceThreshold and (sumLum / c) &lt; 1.0): return 0 else: # delta may go below zero delta = int(dX - (dY &gt;&gt; 1)) while (y0 != y1): # reduce delta, while taking into account the corner case of delta == 0 if ((delta &gt; 0) or (delta == 0 and (stepY &gt; 0))): delta -= dY x0 += stepX delta += dX y0 += stepY sumLum = sumLum + min(lum[x0][y0], 1.25) c = c + 1 if(abs(sumLum / c - prevLum) &gt; luminanceThreshold and (sumLum / c) &lt; 1.0): return 0 return 1</span></span></code> </pre> <br> åº”å½“æŒ‡å‡ºï¼Œå¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥å¯¹Bresenhamæµ‹è¯•è¿›è¡Œæ”¹è¿›ï¼Œè¿™å°†å¯¼è‡´æ›´å¥½åœ°åˆå¹¶æ ·æœ¬ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥è€ƒè™‘ä½äºå›¾åƒè¾¹ç¼˜çš„å…‰æºçš„æ°´å¹³è½¬ç§»ã€‚ æ­¤å¤–ï¼Œå¯ä»¥è½»æ¾æ‰©å±•åŠŸèƒ½ï¼Œä½¿å…¶æ¥è¿‘å…‰æºçš„é¢ç§¯ã€‚ å¦ä¸€ä¸ªæ”¹è¿›ï¼šæ‚¨å¯ä»¥æ·»åŠ è·ç¦»é˜ˆå€¼ï¼Œè¿™æ ·å°±ä¸ä¼šåˆå¹¶è·ç¦»å¤ªè¿œçš„æ ·æœ¬ã€‚ æœ€ç»ˆç»“æœï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/422/4a8/fd9/4224a8fd98cec4203235bb4678ee6826.png"></div><br> è“è‰²è¡¨ç¤ºç…§æ˜é›†ç¾¤çš„å±€éƒ¨æœ€å¤§å€¼ï¼Œè“è‰²è¡¨ç¤ºå…‰æºçš„æœ€ç»ˆä½ç½®ï¼Œçº¢è‰²è¡¨ç¤ºå±äºåŒä¸€ç…§æ˜é›†ç¾¤çš„ä¸€éƒ¨åˆ†å¹¶é€šè¿‡çº¿è¿æ¥çš„æ ·æœ¬ã€‚ <br><br> å…¶ä»–ç»“æœç¤ºä¾‹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a44/e48/451/a44e484510a596be61f83f9c303f25fc.png"></div><br><hr><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Maciej Laskowskiæ£€æµ‹æ•°ç ç…§ç‰‡ä¸­çš„å…‰æº</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å“ˆé»˜æ–¯åˆ©ï¼ˆHammersleyï¼‰æŒ‡å‡ºåŠçƒ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿ç½—Â·é‡Œå¾·çš„ç­‰è§’æŠ•å½±</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é»„å¤©å¿ƒï¼ˆTian-Tsin Wongï¼‰ç”¨Hammersleyå’ŒHaltonç‚¹è¿›è¡Œé‡‡æ ·</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458598/">https://habr.com/ru/post/zh-CN458598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458584/index.html">7æœˆ11æ—¥ï¼ŒGroup-IBç½‘ç»œç ”è®¨ä¼šâ€œé’ˆå¯¹åˆå­¦è€…çš„æ¶æ„è½¯ä»¶åˆ†æï¼šåŸºæœ¬æ–¹æ³•â€</a></li>
<li><a href="../zh-CN458590/index.html">iOSåº”ç”¨ç¨‹åºä¸­çš„æ¶æ„æ–¹æ³•</a></li>
<li><a href="../zh-CN458592/index.html">ä»é«˜Cephå»¶è¿Ÿåˆ°ä½¿ç”¨eBPF / BCCçš„å†…æ ¸è¡¥ä¸</a></li>
<li><a href="../zh-CN458594/index.html">ä¸è¦å¿˜è®°ä½¿ç”¨L7å¹³è¡¡ä¸­çš„é‡å¤è¯·æ±‚æ¥å¢åŠ å¯¹å®¢æˆ·ç«¯åšå‡ºå“åº”çš„æœºä¼š</a></li>
<li><a href="../zh-CN458596/index.html">å°å·§çš„å°ä¹è¶£ï¼ƒ6ï¼šOpenAI Gym-ç©æ¸¸æˆå’Œæ§åˆ¶æœºå™¨äºº</a></li>
<li><a href="../zh-CN458600/index.html">ä»€ä¹ˆæ˜¯ç”µåŠ¨è‡ªè¡Œè½¦ï¼ˆåœ¨ä¸¤ä¸ªåˆ¶é€ å•†çš„äº”ä¸ªå‹å·çš„ä¸¤ä¸ªéƒ¨åˆ†ä¸­è¿›è¡Œçš„å°ç»„å®¡æŸ¥ï¼‰ï¼Œç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN458604/index.html">ä¸ºä»€ä¹ˆä¸¤å®¶æœ€å¤§çš„ç”µå­åˆ¶é€ å•†è”æ‰‹å¼€å±•æ–°çš„GPUé¡¹ç›®</a></li>
<li><a href="../zh-CN458606/index.html">åœ¨2ç§’é’Ÿå†…åœ¨Dockerä¸­è¿è¡ŒOpenVPN</a></li>
<li><a href="../zh-CN458608/index.html">Node.jså¼€å‘äººå‘˜å·¥å…· ä½œä¸šé˜Ÿåˆ—</a></li>
<li><a href="../zh-CN458612/index.html">å®‡å®™ 7å¹´</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>