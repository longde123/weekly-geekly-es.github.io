<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üë©‚Äç‚ù§Ô∏è‚Äçüë® ü•Ä La historia de una animaci√≥n. üí© ‚õÖÔ∏è üë®üèª‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez, el dise√±ador llam√≥ al front-end y pidi√≥ hacer una "telara√±a" detr√°s del vidrio empa√±ado. Pero luego result√≥ que no se trataba de una "telara√±...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La historia de una animaci√≥n.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/450832/">  Una vez, el dise√±ador llam√≥ al front-end y pidi√≥ hacer una "telara√±a" detr√°s del vidrio empa√±ado.  Pero luego result√≥ que no se trataba de una "telara√±a", sino de una cuadr√≠cula hexagonal, y no detr√°s del cristal, sino que se fue en la distancia, y el reverso no estaba familiarizado con WebGL, y tuve que aprender toda la animaci√≥n en el proceso de dibujo.  Ese front-end fue <b>Yuri Artyukh</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">akella</a> ). <br><br><img src="https://habrastorage.org/webt/4b/db/la/4bdblauwhfg83othzzcjlfdjzf0.jpeg"><br><br>  Yuri se ha dedicado a la composici√≥n tipogr√°fica durante mucho tiempo y los domingos registra flujos con an√°lisis de proyectos reales.  No es un profesional en WebGL, no hace mapas en √©l, no escribe en el ensamblador web, pero le gusta aprender algo nuevo.  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FrontendConf</a> RIT ++, Yuri dijo c√≥mo realizar una animaci√≥n desde el dise√±o hasta la entrega al cliente para que todos est√©n contentos y aprendan WebGL en el camino.  La historia proviene de la perspectiva en primera persona e incluye: Three.js, GLSL, Canvas 2D, gr√°ficos y un poco de matem√°tica. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Eq_rXOyOX0I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Telara√±a detr√°s del vidrio empa√±ado </h2><br>  De alguna manera me sent√© y trabaj√© en un proyecto importante.  Luego, el dise√±ador del estudio, en quien los efectos especiales son muy aficionados, llama y pregunta: "¬øPuedes hacer una telara√±a, como si estuviera detr√°s de un vidrio empa√±ado?" <br><br>  Esto, por supuesto, describe inmediatamente todo el problema.  Como result√≥ m√°s tarde, la "telara√±a" detr√°s del vidrio empa√±ado era esta. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/da/0z/bn/da0zbnmw-g-0_jwatgdtvlevqk4.jpeg" width="600"></div><br><br>  Esta es una cuadr√≠cula hexagonal, pero para el dise√±ador, por alguna raz√≥n, una "telara√±a".  Vidrio empa√±ado: esta cuadr√≠cula va en la distancia.  Dificultades de comunicaci√≥n.  ¬øImagina lo dif√≠cil que es ser introvertido y hacer animaciones?  Pero yo soy as√≠ y eso es lo que estoy haciendo. <br><br>  Esta "web" no parece una animaci√≥n, despu√©s de lo cual puedes escribir un informe sobre un caso exitoso, abrir una startup, obtener mil millones de inversiones, tener un mont√≥n de fan√°ticos y lanzar un cohete al espacio.  ¬øDe qu√© se trata todo esto?  Una l√≠nea marr√≥n sobre un fondo blanco gris√°ceo, como dibujada por un mouse.  M√°s tarde result√≥ que deber√≠a ir por los bordes, pero m√°s sobre eso m√°s tarde.  En general, el nombre en clave es "la red detr√°s del vidrio empa√±ado". <br><br>  En el sitio con esta animaci√≥n hab√≠a varias opciones m√°s para la "telara√±a": sobre un fondo gris en la parte superior, sobre un blanco debajo.  Era necesario hacerlo interactivo para que respondiera al movimiento del mouse del usuario. <br><br>  Lo primero que me preguntaron los dise√±adores es qu√© tan dif√≠cil es y cu√°nto costar√°.  Unos pocos pensamientos pasaron por mi cabeza: c√≥mo dibujar una l√≠nea y una Cuadr√≠cula de este tipo, c√≥mo hacer que no disminuya la velocidad, c√≥mo deber√≠a funcionar en absoluto.  Nunca me he encontrado con esto antes.  Pero, como una persona que se dedica al desarrollo, respondi√≥: " <i>Eso es f√°cil, lo haremos ..."</i> <br><br>  Me gusta involucrarme en extra√±as aventuras, porque cuando hago esto, generalmente sufro. <br><br><blockquote>  A trav√©s del sufrimiento viene el crecimiento.  Est√° inevitablemente asociado con el sufrimiento: no puedes ser feliz con todo, vivir felizmente y al mismo tiempo desarrollarte profesionalmente. </blockquote><br><h2>  Three.js </h2><br>  Inmediatamente comenc√© a pensar c√≥mo resolver el problema.  Como todo estaba en 3D, record√© <b>Three.js</b> .  Esta es la biblioteca m√°s popular de la que se habl√≥ en todas las conferencias.  Esta biblioteca hace que WebGL sea m√°s simple, m√°s conveniente y m√°s agradable que solo WebGL nativo. <br><br>  Three.js tiene muchos objetos preparados.  <b>PlaneGeometry</b> es el primer objeto que me pareci√≥ perfecto.  Este es un plano primitivo.  La biblioteca tiene todo tipo de hex√°gonos, dodecaedros, icosaedros, cilindros, pero hay un plano simple de muchos tri√°ngulos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1b/d6/zh/1bd6zhhmntwqmvhlzc6fe8pt5u8.jpeg" width="600"></div><br>  <i>Hay muchos tri√°ngulos, porque necesito ondas detalladas, la superficie debe preocuparse.</i> <br><br>  Si miras dentro de Three.js, entonces, de hecho, este plano es un simple objeto JS con una lista de todas las coordenadas de los puntos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ma/4l/2s/ma4l2so6e_q2_njrkzrjsdibylu.jpeg" width="600"></div><br><br>  En mi caso, tengo un plano de 50 √ó 50 cuadrados, as√≠ que necesitaba 2601 v√©rtices.  ¬øPor qu√© 50 √ó 50 = 2601?  Esto es matem√°tica escolar.  La coordenada z = 0, porque el plano, y = 1, porque esta es la primera fila de v√©rtices de 50 piezas, y x cambia. <br><br>  Pero, ¬øpor qu√© necesito un avi√≥n? ¬øNecesito doblarlo de alguna manera?  Lo primero que puede hacer con una matriz es realizar operaciones matem√°ticas en ella.  Por ejemplo, revise <code>for each</code> ciclo y asigne la coordenada z al valor seno de la coordenada x. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rl/4t/vx/rl4tvxjhweazbjcjjakkaxv38nw.jpeg" width="600"></div><br><br>  Result√≥ algo similar a una onda sinusoidal, porque el valor de la altura de cada v√©rtice ser√° igual al seno de este valor a lo largo del eje x.  Para complicar esto de alguna manera (ahora ser√° un momento matem√°tico dif√≠cil, prep√°rese): agregar√© tiempo al seno, y este lienzo se mover√°, simplemente porque las matem√°ticas funcionan de esta manera.  Si agrega tiempo a la coordenada x, el gr√°fico se mueve horizontalmente.  Si coordinar y, se mover√° verticalmente.  Estaba interesado en el movimiento horizontal: quer√≠a que mi oc√©ano se preocupara. <br><br>  El dise√±ador no esperaba que tuviera una sinusoide que se arrastra de izquierda a derecha.  Quer√≠a que fuera hermoso, como una telara√±a, un oc√©ano o lo que sea que estuviera en su cabeza.  Por lo tanto, la opci√≥n con una sinusoide no encajaba.  Tom√≥ alg√∫n tipo de aleatoriedad.  El avi√≥n no deber√≠a haber sido predecible como una onda sinusoidal.  Pero si llama al azar para cada uno de estos picos, obtenemos la imprevisibilidad. <br><br>  La esencia de la aleatoriedad es que es aleatoria e independiente.  Cada v√©rtice aleatorio no depende de sus vecinos de ninguna manera.  Al azar, no se pasan par√°metros, no le importan los vecinos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xi/_i/-z/xi_i-z1fxtzdkobj8rvyw5zdwum.jpeg" width="600"></div><br><br>  El resultado es una curva rota que se asemeja al oc√©ano o la web solo de forma remota.  M√°s adecuado como ilustraci√≥n para una pel√≠cula sobre "piratas inform√°ticos" y robos cibern√©ticos. <br><br>  Si observa al azar desde el punto de vista de cada punto en la pantalla, se ve como ruido blanco, muchos peque√±os puntos blancos y negros.  Cada punto es blanco y negro: 0 o 1. <br><br>  Pero lo que necesito para crear un oc√©ano de olas deber√≠a verse as√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ko/gf/4r/kogf4rlg2l22xip6a0bnppd2oym.jpeg" width="600"></div><br>  <i>Se asemeja a la niebla, las nubes y las monta√±as.</i> <br><br>  Hay funciones aleatorias que devuelven tales im√°genes.  Se llaman ruidos o <b>ruido</b> : ruido simple, ruido de Perlin.  Perlin en nombre del ruido es el nombre del creador del algoritmo de ruido de gradiente, que devuelve un hermoso aleatorio.  Lo cre√≥ trabajando en los efectos especiales de la primera parte de la pel√≠cula "Tron".  Este algoritmo matem√°tico exist√≠a antes, pero ahora se usa activamente en pel√≠culas y juegos. <br><br>  Cuando se generan mapas aleatorios en "Heroes of Might and Magic III" (para los mayores de 30 a√±os) o en estrategias, generalmente puedes ver algo similar.  Siempre es la misma funci√≥n que devuelve estos ruidos. <br><br>  Hay todo un movimiento "Arte generativo".  Los participantes generan obras de arte, paisajes, utilizando la funci√≥n de ruido.  Por ejemplo, en la imagen a continuaci√≥n, un paisaje pseudo-natural de uno de los artistas.  No est√° claro de inmediato si se trata de las matem√°ticas o la topograf√≠a de una monta√±a.  La tarea del arte generativo es precisamente generar matem√°ticamente un paisaje que no se puede distinguir del presente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qe/lw/ky/qelwkyrefwhms3hhd_gbd7azazs.jpeg" width="600"></div><br><br>  Result√≥ que, a diferencia de la aleatoriedad, esta funci√≥n toma par√°metros, porque los puntos deben depender de los vecinos m√°s cercanos a ellos.  Si utiliza la funci√≥n de ruido en lugar de la aleatoriedad habitual, obtendr√° algo como esto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ce/og/ti/ceogtizjdrzw3kfbrdz6n1cnqra.jpeg" width="600"></div><br>  <i>Blanco y negro es simplemente altura: 0 son valles negros, 1 son picos blancos.</i>  <i>Se convierte en una superficie ondulada.</i> <br><br>  Esta funci√≥n est√° en todos los PL porque es solo un algoritmo: senos, cosenos, multiplicaci√≥n. <br><br>  Puedo hacer la distorsi√≥n de la misma manera pasando por todos los v√©rtices de mi objeto PlaneGeometry, asignando cada valor a la funci√≥n de ruido: <br><br><pre> <code class="javascript hljs">geometry.vertices.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> { vz = noise(vx, vy, time); });</code> </pre> <br>  La funci√≥n ocupa solo 30-40 l√≠neas, pero es matem√°ticamente compleja. <br><br>  Hay funciones de ruido de todas las dimensiones: unidimensional, bidimensional, tridimensional.  En mi caso, esto es ruido tridimensional, porque se le pasan tres par√°metros.  Adem√°s de las coordenadas espaciales del plano xey, transmito el tiempo: la superficie se torcer√° constantemente, cambiar√° su posici√≥n. <br><br><h2>  Three.js!  == GPU </h2><br>  Cuando comenc√© el algoritmo, las ondas comenzaron a moverse.  Cuando hago algo para la Web, siempre miro en el generador de perfiles, y ahora tambi√©n lo busqu√©. As√≠ es como se ve√≠an las olas all√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9r/os/qg/9rosqgaqfwrqwxnnzmxhhw-1szq.jpeg" width="600"></div><br><br>  En la pantalla hay un cuadro dibujado por el navegador.  Los marcos se indican mediante l√≠neas discontinuas grises verticales.  Dentro del marco, 2/3 del tiempo est√° ocupado por la ejecuci√≥n de la funci√≥n de ruido.  Cuando anima algo en la Web, utiliza el marco de animaci√≥n de solicitud, que se ejecuta cada 16 ms, en el mejor de los casos.  El cuadro cada 16 ms cuenta la funci√≥n de ruido para 2600 v√©rtices.  Para cada v√©rtice, se considera un movimiento hacia arriba y hacia abajo y la altura.  En cada cuadro posterior, los valores se vuelven a calcular, porque la superficie debe vivir en el tiempo. <br><br>  Result√≥ que la funci√≥n de ruido, que se volvi√≥ 2600 veces, ya toma 2/3 del marco en mi computadora.  Y este no es todo el marco.  Al desarrollar animaciones, esto ya es una bandera roja. <br><br><blockquote>  Ninguna animaci√≥n debe ocupar m√°s de la mitad del cuadro. </blockquote><br>  Si es m√°s, existe un alto riesgo de perder el marco durante cualquier interacci√≥n, cualquier bot√≥n, cualquier mouseover. <br><br>  Por lo tanto, fue una bandera roja dura.  Me di cuenta de que Three.js no es necesariamente WebGL.  A pesar del hecho de que parec√≠a usar Three.js, dibuj√© todo en 3D, se renderiz√≥ en WebGL, no obtuve un rendimiento fant√°stico de WebGL.  Solo tengo 2.600 v√©rtices, esto no es suficiente para WebGL.  Por ejemplo, en cada mapa hay miles de objetos, cada uno formado por docenas de tri√°ngulos.  Estime la escala: cientos de miles son normales, pero solo hay 2600 picos. <br><br><h2>  Sombreador de v√©rtices </h2><br>  Despu√©s de un problema con los marcos, descubr√≠ que hay sombreadores.  Solo hay dos tipos de ellos: <br><br><ul><li>  Sombreador de v√©rtices; <br></li><li>  Fragmento sombreador. <br></li></ul><br>  Estaba interesado en el sombreador de v√©rtices: el sombreador de v√©rtices.  Si reescribimos la animaci√≥n, entonces se ve as√≠: <br><br><pre> <code class="javascript hljs">position.z = noise( vec3(position.x, position.y, time) );</code> </pre> <br>  <code>Position.z</code> : coordenadas z del componente de cada punto con sus propios tipos de datos.  <code>vec3</code> indica que habr√° tres par√°metros. <br><br><blockquote>  No hay bucle en el sombreador. </blockquote><br>  Antes de eso, en el gui√≥n, puse un <code>for each</code> bucle, y para cada v√©rtice, los c√°lculos se realizaron en un bucle.  La diferencia entre sombreadores y no sombreadores es la ausencia de un ciclo. <br><br><blockquote>  Shader: este es el ciclo. </blockquote><br>  Se ejecuta en paralelo para todos los v√©rtices a la vez.  Este es su significado principal, y misi√≥n, y chip, y misi√≥n. <br><br>  La GPU en la tarjeta de video tiene un n√∫cleo m√°s grande, a diferencia de la CPU del procesador principal.  En el procesador hay muchos menos, pero es capaz de realizar c√°lculos universales m√°s r√°pido.  Hay c√°lculos muy simples disponibles en la tarjeta de video, pero hay muchos n√∫cleos, por lo que le permite paralelizar muchos c√°lculos.  Esto es lo que suele pasar en los sombreadores.  El significado del sombreador de v√©rtices es que el ruido se calcular√° en paralelo para 2600 v√©rtices en el sombreador de la tarjeta de video. <br><br>  Si observa el generador de perfiles, la apariencia de la animaci√≥n no cambiar√°, pero se ver√° as√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k7/xv/et/k7xvetot_x1xphmbrtsfkifz8mc.jpeg" width="600"></div><br><br>  <b>Nada se ejecuta en la CPU en absoluto</b> .  Por supuesto, a continuaci√≥n se agreg√≥ otro hilo en la GPU.  Tambi√©n hay hilos en la GPU, CPU, trabajadores web, pero estos c√°lculos ya se realizar√°n en un hilo separado en la tarjeta de video. <br><br>  Por supuesto, esto no es gratis.  La tarjeta de video en el trabajo se calienta m√°s que el procesador principal.  Por lo tanto, a menudo cuando visitas sitios con animaciones similares, los fan√°ticos comienzan a trabajar para ti.  Esto se debe a que cuando la tarjeta de video est√° encendida, requiere enfriamiento, a diferencia del resto del tiempo.  En los dispositivos m√≥viles, esto es m√°s importante que en las computadoras de escritorio: los tel√©fonos m√≥viles simplemente se agotan m√°s r√°pido.  Pero al mismo tiempo obtienes una ganancia de rendimiento, bastante radical. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/x-/zr/hhx-zrjk_c8ftrd4hjdqhohcn1a.jpeg" width="600"></div><br>  <i>El resultado es una superficie de este tipo: este es el ruido perlin habitual.</i>  <i>Si lo inicia y cambia solo el tiempo, se obtienen olas fr√≠as.</i> <br><br>  Pero eso no es todo.  Todav√≠a estaba obligado a "telara√±a" - una cuadr√≠cula hexagonal en la superficie.  Con experiencia en dise√±o, la forma m√°s simple y obvia es seleccionar un fragmento que pueda repetirse.  Curiosamente, para una cuadr√≠cula hexagonal, no es cuadrada, sino rectangular.  Si repite el patr√≥n como un rect√°ngulo, obtendr√° una cuadr√≠cula.  La biblioteca Three.js le permite superponer png y no aprender todo de WebGL antes de eso.  Cort√© png y lo puse en la superficie, result√≥ algo as√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8n/gc/p0/8ngcp0pi_2s1st4ubwo8sgh8zps.jpeg" width="600"></div><br><br>  A primera vista, lo que necesitas!  Pero solo al principio.  Esto no me conven√≠a, ya que la animaci√≥n era necesaria para el sitio de criptomonedas: todo deber√≠a ser "costoso, rico". <br><br>  Cuando usa texturas png y est√°n cerca de la c√°mara, puede ver que los bordes del elemento m√°s cercano est√°n borrosos.  No hay sensaci√≥n de que la imagen sea clara.  El png parece haberse extendido en el navegador.  El problema es que en WebGL no hay forma de usar texturas vectoriales en el sentido completo de la palabra.  Entonces llor√© y luego le√≠ en Internet que <b>GLSL</b> resuelve este problema. <br><br>  GLSL es un lenguaje tipo C en el que se escriben los sombreadores.  Todos tienen miedo de usarlo, porque estos son sombreadores, WebGL: ¬°nada est√° claro!  Pero descubr√≠ que es posible hacer im√°genes claras en √©l y recurr√≠ al segundo tipo de sombreador. <br><br><h2>  Sombreador de fragmentos </h2><br>  Este sombreador hace lo mismo que el v√©rtice.  Pero, si el v√©rtice construye una superficie de polil√≠nea, realizando c√°lculos para cada v√©rtice, entonces el sombreador Fragmento calcula el color para cada p√≠xel de la superficie. <br><br>  La funci√≥n de <code>fragment shader ‚Äì step(a,b)</code> m√°s b√°sica <code>fragment shader ‚Äì step(a,b)</code> .  Solo devuelve 0 y 1: <br><br><ul><li>  si a&gt; b, entonces 0; <br></li><li>  si a &lt;b, entonces 1. <br></li></ul><br>  Hice una pseudo implementaci√≥n en JS para dejar en claro cu√°n simple es esta funci√≥n. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a &lt; b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br>  Cuando trabajas en WebGL, generalmente en cualquier objeto hay un sistema de coordenadas.  Si es un objeto cuadrado, el sistema de coordenadas es primitivo: puntos (0,0), (0,1), (1,0), (1,1). <br><br>  Se ejecuta un Fragment Shader para cada p√≠xel.  Si Vertex Shader es 2600 veces por cuadro, entonces Fragment Shader se ejecuta tantas veces como haya p√≠xeles.  Tal vez un mill√≥n de veces para cada cuadro, si la superficie es 1000 √ó 1000 px.  Suena aterrador, pero simplemente porque pocas personas est√°n familiarizadas con los recursos de las tarjetas de video en nuestro tiempo. <br><br>  Si utiliza la funci√≥n de paso (a, b) con las coordenadas de estos p√≠xeles, puede ejecutar la funci√≥n de paso con el par√°metro 0.4 y pasar la coordenada x de cada p√≠xel a cada punto. <br><br>  Resulta que todo lo que sea menor que 0.4 ser√° 0, todo lo que sea mayor que 1. En WebGL, los n√∫meros y los colores son uno y lo mismo.  Cada color es un n√∫mero.  Blanco - 1, negro - 0. Hay tres de ellos en RGB, pero sigue siendo 0.0.0 y 1.1.1. <br><br><img src="https://habrastorage.org/webt/0g/yn/u8/0gynu8ekf6ms9lbsxses7zlnsq8.jpeg"><br><br>  Si ejecutamos este paso de funci√≥n m√°s complicado, obtenemos blanco a la izquierda.  Esta funci√≥n se ejecutar√° para cada punto en la pantalla y considerar√° que es 0 o 1. Esto es normal, no se preocupe por esto. <br><br>  Si multiplica estas dos expresiones, obtendr√° una franja blanca vertical.  Si haces lo mismo en un eje diferente, puedes dibujar un cuadrado blanco: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ed/-m/bd/ed-mbd_kkdxv-lfxhmgk4iixr3o.jpeg" width="600"></div><br>  <i>Deber√≠a ser el cl√≠max: ¬°dibujamos un cuadrado blanco!</i> <br><br><blockquote>  Usando combinaciones de una sola funci√≥n, puede dibujar lo que quiera. </blockquote><br>  Si recuerdas, los elementos del patr√≥n estaban en √°ngulo.  Si crea una superficie inclinada, que consiste solo en colores blanco y negro, entonces ser√° acanalada, no alisada.  Las costillas te llaman la atenci√≥n, es feo.  Para que la superficie se vea lisa, no solo se necesitan p√≠xeles en blanco y negro, sino tambi√©n medios tonos grises. <br><br><h3>  Smoothstep </h3><br>  Los sombreadores tienen una funci√≥n de paso suave.  Hace lo mismo que el paso, pero interpola entre 0 y 1 para que haya un gradiente. <br><br><img src="https://habrastorage.org/webt/70/ie/sj/70iesjc9whr9omw98d6vgdegn7u.jpeg"><br>  <i>De izquierda a derecha, despu√©s de la m√°xima compresi√≥n.</i> <br><br>  Si comprime esta funci√≥n tanto como sea posible, obtendr√° una l√≠nea de gradiente m√≠nima.  Esto es justo lo que necesita para generar una l√≠nea perfectamente suave en cualquier √°ngulo en el sombreador Fragment. <br><br>  Entonces pude hacer un cuadrado blanco con bordes lisos.  Si hay un cuadrado blanco, puedes hacer 3 cuadrados blancos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mk/vj/yj/mkvjyjhkpspu2gyr07ljvav8f0e.jpeg" width="600"></div><br>  <i>Los cuadrados se pueden rotar, use las funciones de seno y coseno.</i> <br><br>  Luego tuve que usar papel y una hoja para romper mi patr√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hp/a4/yz/hpa4yzizs2urt92ucauxlgwr3ny.jpeg" width="600"></div><br>  <i>Captura de pantalla de la producci√≥n.</i> <br><br>  All√≠ todo est√° conectado con 23 grados diferentes de multiplicidad, por lo que no fue muy dif√≠cil calcular las coordenadas de todos estos puntos.  Y luego puedes obtener ese patr√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wr/81/kt/wr81ktna90gxloib0ainetldwrk.jpeg" width="600"></div><br><br>  Dibuj√© un fragmento y lo repet√≠ muchas veces.  Puede ver claramente el modo de depuraci√≥n, donde se repite el patr√≥n.  Todos los fragmentos se realizan utilizando las funciones param√©tricas <code>step</code> y <code>smoothstep</code> .  Esto significa que al hacer un patr√≥n para inclinar el plano, puede generar un n√∫mero infinito de estos patrones.  Si dentro del fragmento cambiamos el grosor de la l√≠nea o el tama√±o de los hex√°gonos, obtenemos muchos otros patrones. <br><br>  Torc√≠ los par√°metros y encontr√© un n√∫mero infinito de patrones.  Es como "Arte generativo": no est√° claro lo que se ha hecho, pero es hermoso. <br><br><h3>  SDF </h3><br>  Luego descubr√≠ que tambi√©n <b>hay campos de distancia firmados, que generan im√°genes con un mapa de distancia</b> .  SDF se usa en tarjetas o en juegos de computadora para dibujar textos y objetos, porque es √≥ptimo.  En WebGL, es dif√≠cil dibujar texto de una manera diferente, especialmente suave y contorneado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-k/il/9h/-kil9h7eyazgilry_p6tqdmqvxw.jpeg" width="600"></div><br><br>  Este es un formato matem√°tico que es dif√≠cil de usar fuera de WebGL.  La idea es simple, pero elegante y da un hermoso efecto. <br><br>  Si queremos dibujar una estrella clara, para ello debemos guardar la imagen a la derecha: esta es la imagen generada de la imagen.  Ya existe un algoritmo existente que convierte cualquier imagen clara en una borrosa.  Despu√©s de eso, puede usarse para generar una versi√≥n clara, pero al mismo tiempo no obtenemos una imagen, sino muchas.  A partir de una imagen clara del mismo tama√±o, puede generar lo mismo, pero m√°s grande.  Ser√° con errores, pero el enfoque es matem√°ticamente interesante. <br><br>  Por ejemplo, si toma una imagen con un tama√±o de 128 √ó 128 px, a partir de una imagen en un tama√±o peque√±o puede obtener una imagen clara varias veces m√°s grande que la fuente.  Esta es una de las razones por las que usan SDF: una fuente borrosa a menudo pesa menos que en un formato vectorial optimizado. <br><br>  Por supuesto, hay una limitaci√≥n.  Es imposible aumentar las letras a 1000 px, incluso 100 px se ver√° feo.  Pero, ¬øcon qu√© frecuencia se necesitan fuentes de este tama√±o? <br><br>  Fragmento de sombreado, dibujo de rect√°ngulos, propagaci√≥n: con la ayuda de estas perturbaciones, finalmente logr√© encontrar la superficie deseada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t1/nf/5h/t1nf5hhliercxy0q6axrs4bmosm.jpeg" width="600"></div><br><br><h2>  Nuevas condiciones </h2><br>  Ella estaba como deber√≠a: retorci√©ndose, todos los elementos estaban claros.  Todo estaba como quer√≠a, pero result√≥ que hab√≠a m√°s: <br><br>  <i>- Y deja que se mueva con el mouse y se est√° estableciendo un nuevo camino.</i>  <i>¬°Y los panales est√°n resaltados!</i> <br><br>  Se supuso que cuando el usuario mueve el mouse, metaf√≥ricamente pavimenta su camino espinoso a lo largo de la "telara√±a" rota usando el servicio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/da/0z/bn/da0zbnmw-g-0_jwatgdtvlevqk4.jpeg" width="600"></div><br><br>  No es dif√≠cil describir la tarea en palabras, pero ¬øc√≥mo implementarla?  Lo primero que pens√©, dado que tengo una cuadr√≠cula hexagonal, probablemente ya ha sido estudiada.  Luego me encontr√© con un interesante art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Referencia de cuadr√≠cula hexagonal y gu√≠a de implementaci√≥n</a> ".  En √©l, el autor recolect√≥ materiales durante 20 a√±os.  √âl es genial sin dudas, y el art√≠culo es divino para aquellos a quienes les gustan los algoritmos y las matem√°ticas.  Contiene muchos datos interesantes sobre mallas hexagonales. <br><br>  El art√≠culo es largo, pero contiene enfoques matem√°ticos interesantes: c√≥mo construir un sistema de coordenadas en una cuadr√≠cula hexagonal, c√≥mo numerar estos hex√°gonos y luego referirse a ellos donde se usa.  Resulta que esto siempre estuvo ante mis ojos, porque en los viejos juegos de computadora las redes hexagonales se usan en todas partes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hp/l5/eb/hpl5ebbnsk_y4wwpe68txgddw3a.jpeg" width="600"></div><br>  <i>Si ya est√°s sintonizado con un traste hexagonal, mira el castillo.</i>  <i>En otras texturas, tambi√©n se adivina una cuadr√≠cula hexagonal.</i> <i><br><br></i> <div style="text-align:center;"> <i><img src="https://habrastorage.org/webt/pm/t3/dr/pmt3dricwm2bhfavsrk4alsb_4i.jpeg" width="600"></i> </div> <i><br></i>  <i>En "Civilizaci√≥n" todo es generalmente obvio.</i> <br><br>  Tambi√©n fue interesante saber que si haces una secci√≥n transversal a lo largo de la diagonal de un cubo tridimensional, que consta de muchos cubos peque√±os, entonces, por un lado, estos son cubos y, por otro, hex√°gonos regulares. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yi/or/en/yiorenlgrsykxcxcajtomaq-rf0.jpeg" width="600"></div><br><br>  La secci√≥n transversal de un cubo tridimensional da una cuadr√≠cula hexagonal bidimensional.  Fue divertido aprender que los cubos tridimensionales est√°n de alguna manera conectados con hex√°gonos bidimensionales. <br><br>  En el art√≠culo, incluido, hab√≠a un algoritmo para encontrar el camino a lo largo de la cuadr√≠cula hexagonal.  Tuve que buscar una forma de altura a trav√©s del mouse. <br><br>  Los algoritmos de b√∫squeda de ruta son complejos y simples.  Lo m√°s primitivo es dibujar una l√≠nea entre los puntos y ver en qu√© hex√°gonos cae esta l√≠nea.  Entonces resulta que en los viejos tiempos, las unidades iban del punto A al punto B. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gz/f1/qj/gzf1qjc4ygip7wfnbfam_x3gl1c.jpeg" width="600"></div><br>  <i>Necesitaba algo as√≠.</i> <br><br>  Pero eso no es lo que necesito.  Aqu√≠ el camino se establece a lo largo de las √°reas de hex√°gonos, y necesito a lo largo de los bordes.  Tuve que resolver el problema de manera diferente. <br><br><h3>  Canvas2d </h3><br>  Quiz√°s haya mejores formas, pero la m√≠a es m√°s interesante.  Al principio, dibuj√© <b>Canvas2D</b> para mi depuraci√≥n, paso 1. <br><br><img src="https://habrastorage.org/webt/c0/jb/sx/c0jbsx3mwra1bhrek7v7lsmzs6u.jpeg"><br><br>  Antes de eso, hab√≠a WebGL, Three.js, shaders, ¬°y esto es solo Canvas2D!  Dibuj√© todos los puntos de la cuadr√≠cula hexadecimal en √©l.  Si te fijas bien, estos son los mismos hex√°gonos.  Luego record√© los gr√°ficos que almacenan informaci√≥n sobre c√≥mo se conectan los puntos entre s√≠, y conect√© cada punto con tres vecinos y obtuve un gr√°fico - paso n√∫mero 2. Para esto utilic√© Open Source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Beautiful Graphs</a> . <br><br>  Un gr√°fico es simplemente una colecci√≥n de puntos e informaci√≥n sobre c√≥mo est√°n conectados.  Est√°n bien estudiados, hay muchos buenos algoritmos para todos los gustos para encontrar la ruta desde el punto A al punto B dentro del gr√°fico.  Todas las tarjetas usan este tipo de algoritmos. <br><br>  Se ve algo como esto. <br><br><pre> <code class="javascript hljs">graph = createGraph( ); graph.addNode(..); <span class="hljs-comment"><span class="hljs-comment">// 1000 nodes graph.addLink(..); // 3000 links graph.pathFinder(Start, Finish); //0.01s</span></span></code> </pre> <br>  Construimos un gr√°fico, agregamos 1000 puntos y todas las conexiones entre ellos. Luego, pasamos la <code>id</code> cada punto: el primero est√° conectado al tercero, el tercero al quinto.  No es necesario inventar nada, hay un algoritmo optimizado con una funci√≥n preparada que le permitir√° encontrar este camino. <br><br>  Este algoritmo se ejecuta menos de un marco.  Por supuesto, se necesita alg√∫n tipo de recurso, pero no es necesario ejecutarlo cada 16 ms, sino solo cuando la ruta cambia. <br><br>  As√≠ que pude construir esta ruta en el paso n√∫mero 3. En Canvas2D, comenz√≥ a verse as√≠: la ruta m√°s corta desde el punto A al punto B, todo, como en la vida.  A primera vista parece que este no es el camino m√°s corto, pero resulta que hay muchos caminos m√°s cortos desde el punto A al punto B a lo largo de la cuadr√≠cula hexagonal. <br><br>  En WebGL, todas las im√°genes son n√∫meros.  All√≠ puede transferir texturas en el sombreador, por ejemplo, intent√© transferir png.  No hay diferencia para el navegador: se pasa png o Canvas2D.  Para el navegador Canvas2D, es lo mismo que la imagen terminada, mapa de bits.  Por lo tanto, primero dibuj√© esta imagen en forma de serpiente.      ‚Ññ 4. <br><br>  Canvas2D       .     Canvas2D    ,     ‚Äî        .  ,   .   ,       Canvas2D  3D,  ,       . <br><br>  , ,   WebGL     ‚Äî  ,     ¬´, ¬ª,     . <br><br> ,     ,      Canvas2D,     ,          ,    .     Canvas2D   ,         WebGL,       . <br><br><img src="https://habrastorage.org/webt/z6/uk/kv/z6ukkv00x1pzffhp1ctfd7q7tiw.jpeg"><br> <i> :  ,     ,    .</i> <br><br>   ,   --. ,    ,         ¬´¬ª . <br><br><h2>     ? </h2><br>    : ¬´   ?   ?¬ª  ,     : ¬´,  !¬ª.    ,  .       . <br><br>   ,      WebGL. ,      .          ,     WebGL.     2  ‚Äî ,    . <br><br> , ,    . ,   . <br><br><img src="https://habrastorage.org/webt/yx/0s/kk/yx0skkl_xmwk-ekewducomsgvxs.jpeg">        ,     .   ,   ,  ,     3D   ‚Äî      . <br><br>   ,            .     ,   ,      . <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FrontendConf</a>   .       ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    Canvas</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  RxJS</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JSX  React</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>    30     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> .       ,  ,   . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450832/">https://habr.com/ru/post/450832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450822/index.html">Marcos desaparecidos</a></li>
<li><a href="../450824/index.html">El estado de css</a></li>
<li><a href="../450826/index.html">C√≥mo hablar con el microcontrolador de JS</a></li>
<li><a href="../450828/index.html">Cuando la ciudad se duerme ...</a></li>
<li><a href="../450830/index.html">Nikita Dubko sobre conferencias, s√≠ndrome de impostor y reportajes</a></li>
<li><a href="../450834/index.html">An√°lisis de sitios, ¬øy es generalmente legal en Rusia?</a></li>
<li><a href="../450836/index.html">En rieles detr√°s de las nubes: c√≥mo lavar el vidrio en un rascacielos</a></li>
<li><a href="../450838/index.html">Por qu√© la unidad no se atribuye a los n√∫meros primos, y cu√°ndo generalmente se consideraba un n√∫mero</a></li>
<li><a href="../450840/index.html">La √∫ltima linterna est√° cansada o ¬øEl parpadeo salvar√° a Bielorrusia (upd. Spinner?)</a></li>
<li><a href="../450844/index.html">Introducci√≥n a la asignaci√≥n de ejemplos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>