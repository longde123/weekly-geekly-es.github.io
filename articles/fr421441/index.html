<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≥ üë®üèª‚Äçüè≠ üë∂ Embox commence √† escalader le mont Elbrouz üí™üèª üêü ‚Ñ¢Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ceux qui suivent notre projet ont peut-√™tre remarqu√© qu'un dossier e2k est apparu dans le r√©pertoire avec les architectures, qui contient le support d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Embox commence √† escalader le mont Elbrouz</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421441/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  Ceux qui suivent notre projet ont peut-√™tre remarqu√© qu'un dossier e2k est apparu dans le r√©pertoire avec les architectures, qui contient le support des processeurs domestiques avec l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture Elbrus</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une s√©rie d'</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">articles</a> sur le portage d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Embox</a> sur des plateformes nationales ne serait pas compl√®te sans une histoire sur cette architecture. <br><br>  Je ferai quelques commentaires sur le contenu de l'article.  Premi√®rement, le processus de ma√Ætrise de cette architecture par nos soins est au stade initial, nous avons r√©ussi √† lancer Embox sur cette plateforme, mais nous n'avons pas encore impl√©ment√© bon nombre des parties n√©cessaires, qui seront discut√©es dans de futures publications.  Deuxi√®mement, cette architecture est complexe et <br>  une description d√©taill√©e n√©cessite beaucoup plus de texte que le format ne le permet <br>  un article.  Par cons√©quent, nous vous sugg√©rons de prendre cet article en introduction, <br>  contenant un minimum d'informations techniques sur l'architecture elle-m√™me. <br><br>  Commen√ßons. <br><a name="habracut"></a><br><h3>  Objet de recherche - Disposition du syst√®me embarqu√© sur Elbrus </h3><br>  Puisque nous sommes engag√©s dans Embox (et si quelqu'un ne le sait pas, il se concentre sur les syst√®mes embarqu√©s), nous √©tions principalement int√©ress√©s par l'option que le MTsST lui-m√™me soit positionn√©, y compris pour les syst√®mes embarqu√©s.  Passant √† l'ICST, nous avons d√©couvert que la soci√©t√© souhaitait utiliser ses processeurs pour les syst√®mes embarqu√©s.  L'une des derni√®res solutions pour ce segment est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la carte E4C-COM</a> .  Dans le processus de communication avec le MCST, il est devenu clair que pour le portage et la ma√Ætrise de l'architecture, vous pouvez utiliser n'importe laquelle des machines disponibles, et on nous a donn√© un ordinateur appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Temp√©rament</a> pour une utilisation temporaire.  En g√©n√©ral, un monocube n'est pas tout √† fait ce √† quoi nous sommes habitu√©s dans les syst√®mes embarqu√©s.  En r√®gle g√©n√©rale, les syst√®mes embarqu√©s utilisent des ordinateurs √† carte unique, une puce - un syst√®me sur une puce ou m√™me un microcontr√¥leur, mais le monocube est un ordinateur √† part enti√®re, mais puisqu'il a √©t√© test√© en ¬´climat et m√©canique¬ª, il peut toujours √™tre consid√©r√© comme un syst√®me embarqu√©. <br><br><h3>  Compilateur, construire, remplir l'image </h3><br>  Apr√®s avoir re√ßu l'unit√© centrale, la question s'est naturellement pos√©e - comment remplir l'image.  Le MCST utilise son propre BIOS (chargeur de d√©marrage syst√®me de premier niveau).  Par d√©faut, le syst√®me d'exploitation Elbrus est install√© (c'est-√†-dire Debian avec modifications).  Nous souhaitons lancer notre propre image.  Heureusement, le chargeur MTST peut ex√©cuter des images sur le r√©seau.  Pour ce faire, utilisez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">protocole ATA sur Ethernet</a> . <br><br>  Apr√®s avoir √©t√© aid√© √† monter un stand et √† lancer une image externe sur le r√©seau, nous avons commenc√© √† d√©velopper notre propre image.  Pour ce faire, nous avions besoin d'un compilateur.  Nous n'avons pas trouv√© le compilateur dans le domaine public, mais depuis que nous avons sign√© le NDA, nous avons re√ßu des binaires pour Linux.  Le compilateur s‚Äôest av√©r√© √™tre tout √† fait compatible avec gcc, et nous n‚Äôavons pas eu √† changer quoi que ce soit, √† l‚Äôexception des drapeaux de compilation, que nous avons mis dans un fichier de configuration s√©par√©.  Ce qui est tr√®s pr√©visible, car Linux, bien qu'avec des modifications, est assembl√© par ce compilateur. <br><br><h3>  Quelques questions techniques </h3><br>  Les personnes impliqu√©es dans des activit√©s sp√©cifiques telles que le portage du syst√®me d'exploitation sur une plate-forme savent que la premi√®re chose √† faire est de placer correctement le code du programme en m√©moire.  Autrement dit, √©crivez un script de l'√©diteur de liens (lds) et impl√©mentez le code de d√©marrage.  Nous avons rapidement compris le script de l'√©diteur de liens, mais lors de l'impl√©mentation du code de d√©marrage, nous sommes tomb√©s sur la premi√®re magie, que nous ne comprenions pas compl√®tement.  Le fait est qu'Elbrus a un mode de compatibilit√© x86 et √† 0x00FF0000 il y a un code auquel je donnerai simplement un <a href="">lien</a> , puisque nous l'avons emprunt√© √† l'exemple MCST.  Le script de l'√©diteur de liens contient <br><br><pre><code class="hljs pgsql">.bootinfo : { _bootinfo_start = .; <span class="hljs-comment"><span class="hljs-comment">/* . = 0x1000000 - 0x10000; */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0x00FF0000 */</span></span> *(.x86_boot) . = _bootinfo_start + <span class="hljs-number"><span class="hljs-number">0x10000</span></span>; _bootinfo_end = .; } SECTION_REGION(bootinfo) .text : { _start = .; <span class="hljs-comment"><span class="hljs-comment">/* 0x01000000 */</span></span> *(.e2k_entry);</code> </pre> <br>  Le code de d√©marrage lui-m√™me n'est m√™me pas √©crit en assembleur, mais simplement en <a href="">C.</a>  Il est plac√© dans la section situ√©e √† 0x01000000, ce qui, soit dit en passant, correspond √† l'adresse de d√©part des machines x86 normales - c'est l√† que l'en-t√™te <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">multiboot</a> ou un autre en-t√™te se trouve √† cette adresse. <br><br>  Afin de vous assurer que le code de d√©marrage et les adresses sont corrects, vous devez obtenir une sortie.  Si vous pouvez imprimer n'importe quel caract√®re, il n'y aura probablement aucun probl√®me avec la sortie des cha√Ænes.  En utilisant cette sortie, il sera d√©j√† possible d'utiliser le printf () familier pour le d√©bogage.  De plus, la plupart des plates-formes offrent la possibilit√© de sortir des caract√®res en faisant une simple entr√©e dans un registre sp√©cifique (car le chargeur de d√©marrage a probablement configur√© UART selon les besoins). <br><br>  Notre ordinateur utilise le contr√¥leur de port s√©rie am85c30 (alias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">z85c30,</a> nous avons assez rapidement trouv√© comment imprimer un caract√®re, et cela suffit pour que notre printf fonctionne. Nous avons imm√©diatement fait face √† un probl√®me √©trange - certains des caract√®res imprim√©s par printf semblaient √™tre dupliqu√©s, mais parfois m√©lang√©. Par exemple, lorsque j'ai essay√© de produire Hello, world! Il s'est av√©r√© quelque chose comme Hhelellloo, woworrlldd. Maintenant, il semble √©vident que la question est multic≈ìur, mais au d√©but, nous avons fouill√© dans le pilote lui-m√™me. Dans notre monocub il y a un Elbrus-2C bic≈ìur + (1891VM7YA) (  quatre c≈ìurs DSP ne comptent pas) et le chargeur de d√©marrage active tous les c≈ìurs de processeur. Par cons√©quent, afin de ne pas jouer avec le multic≈ìur (SMP), tous les c≈ìurs, √† l'exception du premier, sont envoy√©s dans une boucle infinie. Pour ce faire, nous avons introduit une variable pour le num√©ro de processeur et l'incr√©mentons √† l'aide de l'ajout atomique Zero core continue de fonctionner, tandis que d'autres noyaux bouclent. <br><br><pre> <code class="hljs cpp"> cpuid = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;last_cpuid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cpuid &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* XXX currently we support only single core */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* copy of trap table */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)<span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;_t_entry, <span class="hljs-number"><span class="hljs-number">0x1800</span></span>); kernel_start();</code> </pre> <br>  L'appel kernel_start () est d√©j√† un transfert de contr√¥le vers notre code. <br>  Nous avons √©galement emprunt√© l'addition atomique, pour nous cela ressemble √† de la magie.  Mais, comme vous le savez, cela fonctionne - ne touchez pas! <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WMB_AFTER_ATOMIC </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x00008001\n"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x30000084\n"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __e2k_atomic32_add(__val, __addr) \ ({ \ int __rval; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n1:"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tldw,0 %[addr], %[rval], mas=0x7"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tadds %[rval], %[val], %[rval]"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t{"</span></span></span><span class="hljs-meta">\ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tstw,2 %[addr], %[rval], mas=0x2"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tibranch 1b ? %%MLOCK"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t}"</span></span></span><span class="hljs-meta"> \ WMB_AFTER_ATOMIC \ : [rval] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=&amp;r"</span></span></span><span class="hljs-meta"> (__rval), [addr] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"+m"</span></span></span><span class="hljs-meta"> (*(__addr)) \ : [val] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ir"</span></span></span><span class="hljs-meta"> (__val) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ __rval; \ })</span></span></code> </pre> <br>  Une autre magie que j'ai d√ª emprunter est un code, qui est requis pour tous les c≈ìurs.  √Ä savoir <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e2k_wait_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ _Pragma (<span class="hljs-string"><span class="hljs-string">"no_asm_inline"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wait \ttrap = %0, ma_c = %1, fl_c = %2, ld_c = %3, "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"st_c = %4, all_e = %5, all_c = %6"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">) : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"memory"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; }</code> </pre> <br>  Par cons√©quent, apr√®s avoir √©crit le code de d√©marrage, nous avons non seulement affich√© des messages √† l'aide de printk, mais √©galement commenc√© √† charger des modules, ce qui n'est g√©n√©ralement pas tr√®s trivial pour les compilateurs pas tout √† fait standard.  Donc, encore une fois, je note que cette fois-ci, la compatibilit√© avec gcc √©tait tr√®s heureuse. <br><br>  L'√©tape suivante consiste g√©n√©ralement √† d√©marrer le contr√¥leur d'interruption et le minuteur, mais pensant que nous devrons impl√©menter non seulement la prise en charge de ces p√©riph√©riques, mais √©galement le code architectural des gestionnaires d'interruption, nous avons d√©cid√© que nous pouvons commencer √† partir de la p√©riph√©rie.  Le monocub a un bus PCIe, pour les programmeurs il ressemble √† un PCI ordinaire.  Nous √©tions principalement int√©ress√©s par deux appareils: un contr√¥leur d'affichage et un contr√¥leur de r√©seau. <br><br>  Le monocube utilise un contr√¥leur graphique de la s√©rie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sm750</a> .  Ceci est un contr√¥leur graphique pour les applications int√©gr√©es, a un support int√©gr√© pour les graphiques 2D.  La puce est soud√©e directement sur la carte m√®re, si je comprends bien.  Les sources du pilote pour Linux peuvent √™tre trouv√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Une fois le pilote trouv√©, il semblait que nos probl√®mes √©taient termin√©s, il ne restait plus qu'√† impl√©menter le contr√¥leur pour PCI.  plus pr√©cis√©ment, les op√©rations de lecture / √©criture de l'espace de configuration PCI pour conna√Ætre les param√®tres.  La mise en ≈ìuvre de ces fonctions a d√ª √™tre emprunt√©e √† nouveau.  En cons√©quence, la lecture des enregistrements se r√©sumait √† des macros comme <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Do load with specified MAS */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \ ({ \ register type res; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ld"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span></span></span><span class="hljs-meta"> \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=r"</span></span></span><span class="hljs-meta"> (res) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas)); \ res; \ }) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \ ({ \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"st"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span></span></span><span class="hljs-meta"> \ : \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((type) (val)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ })</span></span></code> </pre><br>  Il y a une certaine compr√©hension de ce qui se passe.  Elbrus poss√®de plusieurs espaces d'adressage alternatifs, comme, par exemple, dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture SPARC</a> .  L'identification se fait √† l'aide de l'identifiant de l'espace d'adressage.  C'est-√†-dire que la m√™me commande ld arrive √† diff√©rentes adresses internes, elle g√©n√®re √©galement des op√©rations de lecture de diff√©rentes longueurs (8, 16, 32, 64 bits).  Si dans SPARC, il s'agit d'une commande lda / sta distincte, alors dans Elbrus en raison des param√®tres, il s'agit de la commande ld.  Les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fen√™tres de registre ont √©t√©</a> emprunt√©es √† l'architecture SPARC.  Je vais reporter une histoire plus d√©taill√©e pour les articles suivants. <br><br>  En cons√©quence, tout s'est av√©r√© avec PCI.  Nous avons pu obtenir toutes les donn√©es n√©cessaires, nous avons transf√©r√© le pilote graphique, mais nous avons ensuite rencontr√© le probl√®me suivant.  Pour dessiner une image dans la m√©moire vid√©o, vous avez d√ª √©crire deux fois.  Tout indiquait le cache.  Pour r√©soudre ce probl√®me, il √©tait n√©cessaire de traiter avec MMU, et cela, comme on dit, ne peut pas √™tre r√©solu avec la condachka, comme, en principe, de nombreux autres probl√®mes que nous avons rencontr√©s et rencontrerons plus d'une fois au cours du d√©veloppement de cette architecture. <br><br>  Nous avons progress√© dans d'autres directions: les interruptions et les appels syst√®me, mais nous en parlerons √©galement dans les prochains articles de cette sous-s√©rie.  √Ä la fin de cet article, je vais simplement apporter la sortie √† la console (via le port s√©rie). <br><img src="https://habrastorage.org/webt/uc/un/u2/ucunu20_gi-newvjygt_hfiygpe.png"><br><br><h3>  Conclusions </h3><br>  Comme je l'ai dit dans l'introduction, je veux me concentrer principalement non pas sur les d√©tails techniques, mais sur les sentiments g√©n√©raux.  Ainsi, les sentiments sont contradictoires, bien que certainement plus positifs.  D'une part, le processeur existe et est tr√®s int√©ressant en termes de caract√©ristiques architecturales.  Sur la base de ce processeur, des syst√®mes informatiques sont produits, il existe des logiciels de qualit√© assez √©lev√©e.  Comme je l'ai dit, il n'y a pas eu de plaintes concernant le compilateur (jusqu'√† un certain point, que je d√©crirai un peu plus tard), il existe un Linux √† part enti√®re (OS ¬´Elbrus¬ª).  J'ai personnellement vu comment dans l'ICST lui-m√™me, le d√©veloppeur a cr√©√© directement sur le bureau avec l'architecture Elbrus. <br><br>  Mais d'un autre c√¥t√©, je ne comprends pas pourquoi avec une telle pers√©v√©rance ils essaient de faire un remplacement banal d'Intel x86 √† partir de ce processeur.  En effet, nulle part dans le monde n'utilisent des processeurs bas√©s sur l'architecture <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VLIW</a> comme ordinateurs personnels universels.  VLIW, en raison de ses caract√©ristiques architecturales, est un "broyeur de nombres" sympa, ils font du DSP dessus, ils ont fait des serveurs itanium, ils ont fait des cartes graphiques.  Non, avec une pelle, bien s√ªr, vous pouvez creuser un trou pour planter un arbre, mais √ßa vaut le coup. <br><br>  Le principal probl√®me qui entrave le d√©veloppement de l'architecture, √† mon avis, est la nature ferm√©e de tout l'√©cosyst√®me.  Oui, pour obtenir une description du syst√®me de commande, il vous suffit de signer le NDA, mais cela ne suffit pas.  L'architecture est peu famili√®re et tr√®s complexe.  Oui, j'ai toujours pens√© que certains logiciels de base devraient √™tre d√©velopp√©s directement par le fabricant du processeur, ou en √©troite collaboration avec lui.  Selon ce principe, un PC sur Elbrus dispose d'un progiciel avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le syst√®me d'exploitation Elbrus</a> .  Mais il est encore trop na√Øf de croire qu'une entreprise, m√™me grande, peut fournir un support de qualit√© √† tous les composants: un processeur, un compilateur, des outils de d√©veloppement et de d√©bogage, des logiciels syst√®me (diff√©rents OS), des logiciels d'application, ...  m√™me Intel ne peut pas faire √ßa.  Le monde s'oriente depuis longtemps vers ce que l'on appelle la collaboration ou le d√©veloppement conjoint. <br><br>  Permettez-moi de vous donner un exemple d'un probl√®me de compilation sur lequel nous sommes tomb√©s.  √Ä un moment donn√©, le pilote du port s√©rie a cess√© d'afficher des caract√®res et, √† premi√®re vue, rien n'a chang√©.  Il s'est av√©r√© que nous avons supprim√© la fonction de d√©bogage inutilis√©e, que nous avons ins√©r√©e afin de comprendre √† travers le d√©sassembleur comment passer des arguments √† la fonction dans l'assembleur.  Autrement dit, si la fonction est pr√©sente, tout va bien, sinon, la sortie dispara√Æt.  Au d√©but, ils ont p√©ch√© pour l'alignement, mais il s'est av√©r√© que la fonction peut √™tre transf√©r√©e √† la fin de C-Schnick, donc tous les caract√®res du pilote √©taient aux m√™mes endroits qu'auparavant, mais le probl√®me a √©t√© reproduit.  Bien que ce probl√®me n'ait pas √©t√© r√©solu, nous continuons d'enqu√™ter pour montrer aux d√©veloppeurs du compilateur du MCST ou pour comprendre o√π nous avons fait une erreur. <br><br>  √Ä mon avis, le probl√®me ci-dessus aurait pu √™tre √©vit√© s'il y avait plus d'utilisateurs tiers.  Au minimum, le probl√®me serait apparu plus t√¥t, ou, on pourrait simplement google ce que nous avons fait de mal. <br><br>  L'ICST est √©galement conscient du probl√®me de la fermeture, car le processus de d√©couverte de choses non classifi√©es a n√©anmoins commenc√©.  Par exemple, j'ai vu Alt-Linux travailler sur plusieurs PC Elbrus lors de plusieurs conf√©rences.  Voici des photos de l'affichage d'une des conf√©rences de cette ann√©e (d√©sol√© de voir mal, il faisait noir).  Nous nous sommes √©galement li√©s au d√©veloppement.  Nous esp√©rons que nous serons utiles √† l'ICST, car, en fait, certains des points forts de l'architecture Elbrus ne peuvent pas √™tre pris en charge sous Linux (ou les co√ªts sont tr√®s √©lev√©s), par exemple, la m√©moire balis√©e. <br><br><img src="https://habrastorage.org/webt/yy/e9/jr/yye9jr5eg1nw99rppron_47drlw.jpeg" align="right" width="50%"><br><br><img src="https://habrastorage.org/webt/ki/n1/vk/kin1vkulag_gynsmlebiv146das.jpeg" align="left" width="50%">  Un autre point important lorsque nous avons discut√© du probl√®me de la fermeture avec les d√©veloppeurs du MCST, ils ont object√© que, par exemple, les sources du noyau Linux √©taient ouvertes depuis longtemps, mais seuls nous et les d√©veloppeurs Dolomant avons pos√© des questions et les avons utilis√©s d'une mani√®re ou d'une autre. <br><br>  De plus, selon mes informations, le MCST va organiser un stand <br>  accessible √† distance.  Sur lequel il sera possible d'assembler et d'ex√©cuter des logiciels sur un PC avec l'architecture Elbrus.  S'il y a un int√©r√™t similaire et que vous souhaitez utiliser le stand, vous devez contacter, par exemple, moi: d√©crire comment il est pr√©vu de l'utiliser, combien de temps cela prend, etc., car pour partager avec changer le logiciel, vous devez organiser un calendrier.  Je transf√©rerai les donn√©es √† l'ICST ou je relierai ceux qui le souhaitent aux organisateurs. <br><br><hr><br>  Liens utiles: <br><br>  L'adresse postale des utilisateurs est user [at] mcst.ru <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une br√®ve description de l'architecture d'Elbrus</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources d'embox</a> <br><br>  PS Nous montrerons √† tous ceux qui veulent ce que nous avons obtenu au festival <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TechTrain</a> IT <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les</a> 1er et 2 septembre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421441/">https://habr.com/ru/post/fr421441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421429/index.html">LSTM - ANN Prix dynamique dans la vente au d√©tail d'articles m√©nagers</a></li>
<li><a href="../fr421431/index.html">Gestion du temps ou gestion efficace du chaos</a></li>
<li><a href="../fr421433/index.html">Il restait exactement un jour avant le d√©marrage du serveur.</a></li>
<li><a href="../fr421435/index.html">"Pourquoi faisons-nous tous cela?" - Cr√©ateur de Prisma et ancien chef de projet VK √† propos de son nouveau projet secret</a></li>
<li><a href="../fr421439/index.html">Les Japonais ont pr√©sent√© un prototype de processeur pour le supercalculateur exaflops: comment fonctionne la puce</a></li>
<li><a href="../fr421443/index.html">Nouveau sur notre march√©: Pr√©sentation des t√©l√©phones IP Snom D385 et D785</a></li>
<li><a href="../fr421445/index.html">Nous √©crivons un traducteur simple en Lisp - II</a></li>
<li><a href="../fr421447/index.html">Meetup Redmadrobot iOS</a></li>
<li><a href="../fr421451/index.html">Comment prot√©ger votre enfant des d√©chets sur YouTube et cr√©er un lecteur personnalis√© avec une liste blanche de cha√Ænes</a></li>
<li><a href="../fr421453/index.html">Situation: Sonos est devenu public et pourrait ¬´quitter la pi√®ce¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>