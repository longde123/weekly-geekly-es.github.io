<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‡ğŸ» ğŸ‘¸ğŸ¾ ğŸ‘¨ğŸ»â€ğŸŒ¾ Segmentbaum: schnell und einfach ğŸ³ ğŸ™ŒğŸ» ğŸ™†ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Am Vorabend des nÃ¤chsten Starts des Kurses Algorithmen fÃ¼r Entwickler haben wir eine offene Lektion durchgefÃ¼hrt . Sie sprachen Ã¼ber die bekannte Idee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Segmentbaum: schnell und einfach</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/485194/"> <i>Am Vorabend des nÃ¤chsten Starts des Kurses <a href="https://otus.pw/yFoX/">Algorithmen fÃ¼r Entwickler haben</a> wir <a href="https://otus.pw/yFoX/">eine offene Lektion durchgefÃ¼hrt</a> .</i>  <i>Sie sprachen Ã¼ber die bekannte Idee eines Baums von Segmenten, diskutierten, wie man ihn erstellt, aktualisiert und schnell <code>O(log n)</code> die Summe der Zahlen eines beliebigen Segments eines gegebenen Arrays berechnet.</i>  <i>Der Algorithmus ist sehr einfach und wirtschaftlich: Sie benÃ¶tigen <code>O(n)</code> Speicher.</i>  <i>Um das Material zu festigen, lÃ¶sten sie das Olympiadenproblem.</i> <br><br><img src="https://habrastorage.org/webt/fo/p6/54/fop654wv18dcuqqcotigwu5ewji.jpeg"><br><hr><br>  Das Webinar wurde von einem erfahrenen Programmierer und Lehrer sowie dem Kursleiter "Algorithmen fÃ¼r Entwickler", <a href="https://otus.pw/pieR/">Evgeny Volosatov, durchgefÃ¼hrt</a> . <a name="habracut"></a><br><br><h3>  Das Sprichwort </h3><br>  Ein Segmentbaum ist eine Datenstruktur, die ein algorithmisch einfaches und logarithmisches schnelles Auffinden der Summe der Elemente eines Arrays in einem bestimmten Segment ermÃ¶glicht. <br><br>  Stellen Sie sich zum Beispiel vor, Sie mÃ¼ssen die Summe der folgenden Zahlen finden: <br><br><img src="https://habrastorage.org/webt/fn/lv/ni/fnlvniiqc457d4l5ywrjrhd8j5o.png"><br><br>  AuÃŸerdem mÃ¼ssen wir nicht nur die Summe der Zahlen der angegebenen Folge (die Summe der Elemente eines bestimmten Arrays) berechnen, sondern <b>so schnell</b> wie <b>mÃ¶glich die Summe einer Folge dieser Zahlen finden</b> .  Das heiÃŸt, wir kÃ¶nnen ein Intervall (Segment) abfragen und die Antwort so schnell wie mÃ¶glich geben. Wie lautet die Summe der Zahlen aus diesem Intervall: <br><br><img src="https://habrastorage.org/webt/cu/om/vi/cuomviqi_bvqgbhnazokqrmsbmy.png"><br><br>  Was bedeutet es schnell?  Das geht <b>schneller, als wenn wir die Zahlen einfach aufsummieren</b> .  Immerhin kann es Millionen und Abermilliarden von Zahlen geben ... <br><br>  Es war der Wunsch, schnell die Summe der aufeinander folgenden Elemente zu finden, die die Motivation fÃ¼r unser Webinar waren.  DarÃ¼ber hinaus geht es nicht nur um die Summe, sondern auch um andere Aufgaben, beispielsweise die Berechnung einer assoziativen Funktion.  Es handelt sich also um Operationen, deren AusfÃ¼hrung nicht von der Berechnungsreihenfolge abhÃ¤ngt. <br><br>  Kehren wir zu unserer Zeile zurÃ¼ck: <br><br><img src="https://habrastorage.org/webt/fn/lv/ni/fnlvniiqc457d4l5ywrjrhd8j5o.png"><br><br>  Wenn wir das Ergebnis schnell finden mÃ¶chten, mÃ¼ssen wir natÃ¼rlich einige BetrÃ¤ge im Voraus berechnen.  Das erste, was mir in den Sinn kommt, ist das paarweise Falten: <br><br><img src="https://habrastorage.org/webt/ud/oq/tl/udoqtlw0ym7de8nhrqdopsaebcg.png"><br><br>  Wenn Sie nun die Summe der Zahlen ermitteln mÃ¼ssen, kÃ¶nnen wir dies fast sofort tun.  Um beispielsweise die Summe des oben genannten Segments zu ermitteln, mÃ¼ssen Sie <b>lediglich</b> 13 bis 9 addieren. Alles ist elementar: Um die <b>Summe der vier Zahlen zu ermitteln, haben</b> wir <b>nur zwei</b> addiert. <br><br>  Wir erschweren die Aufgabe: <br><br><img src="https://habrastorage.org/webt/be/cg/bf/becgbfbuhk3jfdunnzzxdcjxtha.png"><br><br>  Um die Summe dieses Segments zu ermitteln, mÃ¼ssen wir die Elemente addieren, die auf die eine oder andere Weise unser Segment abdecken: <br><br><img src="https://habrastorage.org/webt/14/22/mk/1422mk7bnint8ldnumlxday9axs.png"><br><br>  NatÃ¼rlich 3 + 13 + 19 = 35. Um die <b>Summe der sieben Zahlen zu ermitteln</b> , haben wir <b>nur drei</b> addiert.  Wenn das Segment aus tausend Elementen bestand, wÃ¼rde es ausreichen, durchschnittlich 10 Elemente hinzuzufÃ¼gen, da wir eine logarithmische KomplexitÃ¤t mit einem Logarithmus zur Basis 2 haben. <br><br><h3>  Voller binÃ¤rer Baum </h3><br>  Ein vollstÃ¤ndiger binÃ¤rer Baum ist ein Baum, von dem jedes Element genau zwei untergeordnete Elemente hat. <br><br>  Um mit einem vollstÃ¤ndigen BinÃ¤rbaum zu arbeiten, kÃ¶nnen und sollten Sie eine Datenstruktur wie ein Array verwenden.  <b>Die Nummerierung dieses Arrays ist von eins bequem</b> .  Wir nummerieren jedes Element des BinÃ¤rbaums mit natÃ¼rlichen Zahlen von 1 bis 2 <sup>n</sup> -1: <br><br><img src="https://habrastorage.org/webt/sk/kk/ec/skkkecryziahrhokilreofurql4.png"><br><br>  Das SchÃ¶ne an diesem Ansatz ist, dass es sehr einfach ist, die Anzahl der Kinder und Eltern zu berechnen. <br>  Die Formel zur Berechnung des "linken Kindes": <i>i * 2</i> , das "rechte": <i>i * 2 + 1</i> . <br><br><img src="https://habrastorage.org/webt/yk/g4/ri/ykg4rio8c3trd8xnxqom8nzyr2o.png"><br><br>  Zum Beispiel berechnen wir die Anzahl der Kinder im fÃ¼nften Element: <br><br><ol><li>  5 x 2 = <b>10</b> ; </li><li>  5 x 2 + 1 = <b>11</b> . </li></ol><br><br>  Und wie kommt es vom â€Kindâ€œ zum â€Elternteilâ€œ?  Wir verwenden die <b>Ganzzahldivision</b> <i>i / 2</i> <br><br>  Ok, und wie kann man feststellen, ob das Kind links oder rechts ist?  Die Antwort lautet wie folgt: <b>Linke Kinder haben gerade Zahlen, rechte Kinder haben ungerade Zahlen</b> . <br><br>  Merke dir diese Punkte. <br><br>  Wir kehren zu unserem Beispiel eines binÃ¤ren Baums zurÃ¼ck und fragen uns, wie wir ihn bauen kÃ¶nnen.  Schauen Sie, wir haben zuerst eine Reihe von Zahlen: <br><br><img src="https://habrastorage.org/webt/u1/mg/nm/u1mgnmf90-a9x8widngxvftscns.png"><br><br>  DafÃ¼r mÃ¼ssen Sie einen BinÃ¤rbaum erstellen.  Wie viel Speicher wird benÃ¶tigt, um den BinÃ¤rbaum zu speichern, an dessen Ende sich diese Elemente befinden? <br><br>  Die Antwort auf diese Frage lautet <i>2n,</i> wenn <i>n</i> eine Zweierpotenz ist. <br><br>  Wir gehen weiter, weil zwei weitere Fragen vor uns auftauchen: <br><br><ol><li>  Aus welchem â€‹â€‹Element mÃ¼ssen die Quellnummern in einem Array eines vollstÃ¤ndigen BinÃ¤rbaums platziert werden? </li><li>  Aus welchem â€‹â€‹Element und in welcher Richtung werden wir beginnen, unseren Baum mit vorberechneten Mengen zu fÃ¼llen? </li></ol><br><br><img src="https://habrastorage.org/webt/2p/7w/ud/2p7wudvrlqpvlwxyxiphho1zs3q.png"><br><br>  Die Antwort auf die erste Frage ist ganz einfach: Wir haben 8 Elemente, insgesamt gibt es 16 Elemente im Array, was bedeutet, dass das erste Element mit 16 - 8 = 8 nummeriert wird. Und wir beginnen mit dem Bauen von links nach rechts und von unten nach oben, beginnend mit Element 7, Werte bei Kindern addieren, so: <br><br><img src="https://habrastorage.org/webt/ec/_4/d9/ec_4d9sy7dtb41tgrr2fhgbkmf8.png"><br><br>  Als nÃ¤chstes mÃ¼ssen Sie festlegen, wie die Summe des gewÃ¼nschten Segments ermittelt werden soll.  Kehren wir zu unserem ersten Beispiel zurÃ¼ck, nummerieren Sie die Elemente und definieren Sie ein Segment. Wir bezeichnen das erste Element in dem Segment, das mit dem Buchstaben L hinzugefÃ¼gt werden soll, und das letzte mit R: <br><br><img src="https://habrastorage.org/webt/w8/wc/1f/w8wc1fkemnpucy4ih5n1pl9rdom.png"><br><br>  Jetzt ist es notwendig, ein weiteres Konzept einzufÃ¼hren, damit der Algorithmus der Aktionen klar ist.  Wir sprechen Ã¼ber das Konzept der Grundelemente und ihrer entsprechenden Grundsegmente.  Das fundamentale Element ist ein beliebiges Element aus dem gesamten Array, und das fundamentale Segment entspricht diesem Element, d. H. Den Elementen aus dem anfÃ¤nglichen Array, die seine unmittelbaren Kinder / Enkel sind.  FÃ¼r das Grundelement mit der Nummer 4 "5" wird das Grundsegment von 8 bis 9 Element sein: ["2";  "3"]: <br><br><img src="https://habrastorage.org/webt/ia/ot/mw/iaotmwpt4cvxbhhsyr5rwbgt_1a.png"><br><br>  Das Grundelement mit der Nummer 10 - â€7â€œ (wir haben es als L bezeichnet) fÃ¤llt mit seinem Grundsegment zusammen.  Ist es mÃ¶glich, dieses grundlegende Segment zu erweitern, ohne LR zu Ã¼berschreiten?  In unserem Fall kÃ¶nnen Sie.  Die Regel fÃ¼r den linken Rand lautet: Wenn es sich um ein linkes untergeordnetes Element handelt, kann das grundlegende Segment erweitert werden. Das neue grundlegende Element ist das Ã¼bergeordnete Element des aktuellen Segments.  Das heiÃŸt, wir kÃ¶nnen Folgendes in das Programm schreiben: <br><br><img src="https://habrastorage.org/webt/dy/j0/pg/dyj0pgxwjnqnmqawzxl5zjoahwg.png"><br><br>  Gehen wir nun zum rechten Element R Ã¼ber. Es ist ein grundlegendes Element und ein linkes Kind, sodass wir den Bereich nicht mehr erweitern kÃ¶nnen (wir gehen Ã¼ber das Segment hinaus).  Daher kÃ¶nnen wir der Antwort dieses Element hinzufÃ¼gen: <br><br><img src="https://habrastorage.org/webt/c9/ng/fi/c9ngfima1u2vx-f-rqc8etaupxo.png"><br><br>  Als NÃ¤chstes mÃ¼ssen Sie das linke Element nach rechts und das rechte nach links verschieben.  FÃ¼r das linke Element mit dem Index L = 10 ist der nÃ¤chste Index 5, da er an das Ã¼bergeordnete Element geht.  Aber es wird zuerst nach rechts und dann nach oben gehen: <br><br><img src="https://habrastorage.org/webt/jd/qu/ll/jdqulls8rhnw5jvpbl-qhqlj1wm.png"><br><br>  Also bewegte sich der Wert von L auf ein hÃ¶heres Niveau und ein wenig nach rechts.  Wie wird R abnehmen?  Mit der Formel (R - 1) / 2. <br><br><img src="https://habrastorage.org/webt/ea/-b/s9/ea-bs9_886die9apr0myvvimrpw.png"><br><br>  Hier ist ein solcher Algorithmus.  Die folgenden Werte der Variablen L und R werden wie folgt verschoben: <br><br><img src="https://habrastorage.org/webt/qq/rn/t_/qqrnt_9szc_kwfmv5gcy_tbfyi4.png"><br><br>  Wenn der Baum nicht 8 Elemente enthÃ¤lt, sondern eine ungÃ¼nstige Zahl, z. B. 12, mÃ¼ssen wir den Baum (der BinÃ¤rbaum muss vollstÃ¤ndig sein) zu 16 hinzufÃ¼gen. <br>  Die Formel zur Berechnung der Anzahl der Elemente (der gesamte Teil des Logarithmus wird genommen): <br><br><img src="https://habrastorage.org/webt/pt/3d/fs/pt3dfscq0ucdhkasro7lva2prrw.png"><br><br>  Nun berechnen wir die assoziative Funktion des Findens des <b>Minimums</b> .  Hier ist unser Baum und schneiden: <br><br><img src="https://habrastorage.org/webt/3c/kb/bw/3ckbbwikljcpgynr1jx40mgpciy.png"><br><br>  Wie oft wird Ihrer Meinung nach Element 5 an unserer Funktion beteiligt sein - eins oder zwei?  NatÃ¼rlich, aber wie wird das im Algorithmus Ã¼berprÃ¼ft?  TatsÃ¤chlich ist dieses Element entweder ein linker oder ein rechter Sohn, was bedeutet, dass die Aktion entweder fÃ¼r L oder R ausgefÃ¼hrt wird. <br><br><img src="https://habrastorage.org/webt/9m/a3/nh/9ma3nh-iiidctwxe1dpbmr1nkaa.png"><br>  + <br><br>  Betrachten Sie nun die Ã„nderungsoperation.  Angenommen, ein Element hat sich geÃ¤ndert, anstelle von 7 ist 0 eingegangen. Damit unser Segmentbaum funktionsfÃ¤hig bleibt, mÃ¼ssen wir alle Ã¼bergeordneten Elemente aktualisieren und ganz nach oben gehen. <br><br><img src="https://habrastorage.org/webt/sx/zu/su/sxzusu9zgp6okgpwrw0qwiwon7a.png"><br><br><h3>  LÃ¶sung des Olympiadenproblems </h3><br>  Eine der Voraussetzungen fÃ¼r solche Aufgaben ist, dass alles schnell gehen soll.  Wir haben also folgende Bedingung: <br><br><img src="https://habrastorage.org/webt/wc/u8/hn/wcu8hnmpigtcnmf8cppibgjdaiw.png"><br><br>  Wir werden es mit dem Wissen Ã¼ber den Baum der Segmente lÃ¶sen.  Als Ergebnis erhalten wir den folgenden C # -Code: <br><br><img src="https://habrastorage.org/webt/nu/_b/ja/nu_bjam45qtkqid1umwdm95tu2s.png"><br><br>  Wir senden es zur ÃœberprÃ¼fung, wir sehen, dass die <a href="https://codeforces.com/gym/100249">Entscheidung getroffen wurde und vollstÃ¤ndig ist</a> , was bedeutet, dass unser Algorithmus funktioniert. <br><br><img src="https://habrastorage.org/webt/5m/dn/ip/5mdnipfigoae-93thzd2w_hftam.png"><br><br>  Das ist alles, wenn Sie mehr Details mÃ¶chten, <a href="https://otus.pw/yFoX/">schauen Sie sich das gesamte Video an</a> .  Sie kÃ¶nnen auch in <a href="https://otus.pw/pieR/">Ruhe</a> die folgenden Artikel des Autors von unserem Lehrer <a href="https://otus.pw/pieR/">Evgeny Volosatov</a> Ã¼ber HabrÃ© <a href="https://otus.pw/pieR/">lesen</a> : <br><br>  - <a href="https://habr.com/ru/company/otus/blog/472040/">Balancieren von rot-schwarzen BÃ¤umen - Drei FÃ¤lle</a> ; <br>  - <a href="https://habr.com/ru/company/otus/blog/476510/">Das Pferd bewegt sich auf Bits.</a>  <a href="https://habr.com/ru/company/otus/blog/476510/">Schach Bitboard</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485194/">https://habr.com/ru/post/de485194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485180/index.html">BenÃ¶tigen wir einen Datensee? Was tun mit dem Data Warehouse?</a></li>
<li><a href="../de485182/index.html">Sennheiser im Jahr 2020 - aktualisierte FunkkopfhÃ¶rer zum JubilÃ¤um</a></li>
<li><a href="../de485184/index.html">Umfrageergebnisse mit Registerkarten</a></li>
<li><a href="../de485186/index.html">Billionen-Dollar-Startup oder wie die erfolgreichsten Valley-Unternehmen geboren wurden</a></li>
<li><a href="../de485190/index.html">Andrew Eun "Leidenschaft fÃ¼r maschinelles Lernen." Ãœbersetzung der Kapitel 47-58</a></li>
<li><a href="../de485196/index.html">AvitoTech On Tour: Besuchen Sie Frontend-Meetings in Kasan</a></li>
<li><a href="../de485198/index.html">Eine andere MÃ¶glichkeit, die Leistung von .NET-Anwendungsmethoden zu messen</a></li>
<li><a href="../de485200/index.html">Mess am Start: Post-Mortem zur Startgeschwindigkeit einer iOS-Anwendung</a></li>
<li><a href="../de485202/index.html">UnterdrÃ¼ckungssystem</a></li>
<li><a href="../de485204/index.html">ZurÃ¼ck zum Anfang: Warum Amazon bald wieder mehr als 1 Billion US-Dollar kapitalisiert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>