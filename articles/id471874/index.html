<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš„ ğŸ“´ ğŸ§ Bagaimana Kami Melewati Pedoman Peninjauan dan Meluncurkan Server di Telepon ğŸ€„ï¸ ğŸ¤´ğŸ½ âœŒğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai, Habr. Nama saya Anton Loginov, saya adalah pengembang iOS di FINCH. 

 Baru-baru ini, kami menghadapi masalah menggunakan antarmuka berbasis web ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana Kami Melewati Pedoman Peninjauan dan Meluncurkan Server di Telepon</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471874/">  Hai, Habr.  Nama saya Anton Loginov, saya adalah pengembang iOS di FINCH. <br><br>  Baru-baru ini, kami menghadapi masalah menggunakan antarmuka berbasis web untuk perjudian.  Dalam pembaruan selanjutnya dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panduan Tinjauan AppStore,</a> kolega dari Cupertino kembali memperketat aturan.  Lebih khusus lagi, sekarang Apple dapat mengarahkan ulang aplikasi jika ada antarmuka berbasis web yang akan diklasifikasikan sebagai perjudian uang sungguhan. <br><a name="habracut"></a><br>  Aplikasi kami sendiri adalah 90% perjudian, dan 10% sisanya digunakan untuk mengiklankan game ini.  Beberapa dari mereka bekerja melalui webView, jadi kami perlu melindungi diri dari pengalihan dengan cara apa pun. <br><br>  Apa yang bisa dilakukan: <br><br><ol><li>  <b>Ambil game-game ini di luar aplikasi utama.</b> <br>  Dengan kata lain, tunda saja yang tak terhindarkan. </li><li>  <b>Gunakan wadah untuk game yang bisa diperbarui tanpa rasa sakit.</b> <br>  Kedengarannya bagus â†’ mencoba menembus â†’ membunuh beberapa hari untuk mempelajari Bereaksi dan Bereaksi Pribumi â†’ menyadari bahwa â€œskiing not goâ€ â†’ tidak terdengar bagus. <br><br>  Ini adalah solusi yang sangat mahal, karena hanya ada sedikit waktu, dan permainan harus ditulis ulang dari awal.  Ini semua tentang perutean internal - ini sepenuhnya terkait dengan urlPathComponents <br></li><li>  <b>Sadari permainan itu secara asli.</b> <br>  Panjang, mahal, dan lagi panjang.  Di masa depan, mereka harus didukung secara berkelanjutan, tetapi kami tidak memiliki peluang seperti itu. </li><li>  <b>Mensimulasikan perilaku server yang akan memberikan situs berbohong lokal dengan permainan.</b> <br>  Kedengarannya gila, tapi ini pilihan yang saya pilih.  Ini cepat, karena modifikasi minimal pada warisan permainan diperlukan. <br>  Kerugian yang diperkirakan termasuk: meningkatkan ukuran perakitan karena situs lokal berbohong, meningkatkan beban pada perangkat dengan memulai server. </li></ol><br>  Saya tidak menemukan artikel tentang HabrÃ© yang akan menjelaskan cara memulai server di telepon.  Setelah memutuskan bahwa kasus ini cukup langka dan menarik, saya memutuskan untuk membicarakannya di sini di HabrÃ©. <br><br><h3>  Persiapan </h3><br>  Sementara vokalis pemberani kami mencoba mengurangi ukuran game sebanyak 16 kali (80 Mb -&gt; 5 Mb) dan mengubah jalur internal menjadi relatif, saya memutuskan perpustakaan dengan memilih GCDWebServer.  Ini adalah kerangka kerja ringan yang dengannya Anda dapat menaikkan server HTTP dalam beberapa baris kode. <br><br>  Setelah memilih perpustakaan, tibalah jam belajar yang panjang dan memahami bagaimana server bekerja di bawah tenda, apa yang terjadi pada titik waktu tertentu, cara mengkonfigurasi server sehingga tidak membuang sumber daya sistem.  Server kami belajar menangkap transisi, memprosesnya, dan saya belajar bekerja dengan server di sisi lain dari barikade. <br><br><h3>  Kustomisasi </h3><br><pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initWebServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//  let webServer = GCDWebServer() //       , ,     GET/POST : webServer.addDefaultHandler( forMethod: HTTPMethod.get.rawValue, request: GCDWebServerDataRequest.self) { [weak self] request in return self?.handle(request: request) } }</span></span></code> </pre> <br><h3>  Mulai </h3><br>  Sebenarnya, kami meresepkan parameter untuk memulai server kami dan menjalankan: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> webServer.start(options: [<span class="hljs-type"><span class="hljs-type">GCDWebServerOption_BindToLocalhost</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-type"><span class="hljs-type">GCDWebServerOption_Port</span></span>: <span class="hljs-number"><span class="hljs-number">8080</span></span>]) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(error.localizedDescription) webServer.start(withPort: <span class="hljs-number"><span class="hljs-number">8080</span></span>, bonjourName: <span class="hljs-string"><span class="hljs-string">"PROJECT_NAME Web Server"</span></span>) }</code> </pre><br><h3>  Proksi </h3><br><img src="https://2.bp.blogspot.com/-sV0wexqcQtE/XXi3viytgtI/AAAAAAAACCE/hOUxDQe1904SyBI_oKcatk27dqG9W7GCACK4BGAYYCw/s1600/WHAT%2BIS%2BA%2BPROXY%2BSERVER%2BAND%2BHOW%2BIT%2BWORK.png" alt="gambar"><br><br>  Modul berkomunikasi secara internal dengan API, tetapi menggunakan baseURL sendiri untuk ini.  Dalam kasus kami, localhost.  Oleh karena itu, perlu untuk mengajarkan server untuk menentukan permintaan yang harus pergi ke API, dan mengubah baseURL mereka. <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: -     ,        Safari</span></span></code> </pre><br>  Berdasarkan hal di atas, perlu untuk mengonfigurasi penangan untuk tugas tertentu: <br><br><ul><li>  Berikan situs itu.  <i>(Ya, semuanya sederhana di sini)</i> ; </li><li>  Berikan beberapa statis dari Bundel.  <i>(Membongkar url permintaan, mengubah baseUrl menjadi bundleUrl, memberikan konten (js / media)</i> ; </li><li>  Dapatkan data terbaru.  <i>(Url yang dibongkar, ubah baseUrl, diminta, dikembalikan)</i> ; </li><li>  Kirim data baru.  <i>(Dan kami tidak memproses permintaan POST, mengacaukannya, mengonfigurasinya, mengirimnya)</i> ; </li></ul><br>  Mari kita lakukan: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: GCDWebServerRequest)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">GCDWebServerResponse?</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1)   if request.url.pathComponents.contains(Endpoint.game.rawValue) { guard let indexURL = bundle.url(forResource: "index", withExtension: "html") else { return sendError(.noHTML(nil)) } do { let data = try Data(contentsOf: indexURL) let htmlString = String(data: data, encoding: .utf8) ?? "" return GCDWebServerDataResponse(html: htmlString) } catch { return sendError(.noHTML(error)) } // 2)   (js etc) } else if request.url.pathComponents.contains(Endpoint.nstatic.rawValue) { guard let resoursePath = bundle.resourcePath else { return sendError(.noJS(nil)) } let relativePath = request.url.pathComponents.joined(separator: "/") let absolutePath = resoursePath + relativePath.dropFirst() let staticURL = URL(fileURLWithPath: absolutePath) do { let data = try Data(contentsOf: staticURL) return GCDWebServerDataResponse(data: data, contentType: ContentType.js.description) } catch { return sendError(.noJS(error)) } // 3)    API } else if request.url.pathComponents.contains(Endpoint.api.rawValue) { var proxyRequest = request //  url,  , ,     let output = URLSession.shared.synchronousDataTask(with: proxyRequest) //    ,      let response = GCDWebServerDataResponse(data: outputData, contentType: ContentType.url.description) //     return response } }</span></span></code> </pre><br><h3>  Kesimpulan </h3><br>  Itu menyenangkan dan gugup.  Pertama, saya belum pernah melakukan hal seperti ini sebelumnya.  Kedua, sampai saat ini kami tidak mengerti bagaimana ide-ide kami akan mempengaruhi aplikasi orang tua. <br><br>  Kami membutuhkan sekitar 32 jam untuk mengimplementasikan: 8 untuk mengoptimalkan ukuran situs, 24 untuk merancang dan menulis fungsi ini. <br><br>  Saat menulis artikel, saya sampai pada kesimpulan bahwa cara yang lebih populer untuk menggunakan teknologi ini adalah untuk mengembangkan asli tanpa menunggu backend siap. <br><br>  Nah, untuk merangkum keuntungan dari pendekatan yang dipilih: <br><br><ul><li>  Hemat waktu backend dengan memberikannya model data </li><li>  Kemampuan untuk menguji perilaku server apa pun </li><li>  Untuk beralih dari Mock ke API asli, kita hanya perlu mematikan penangan tertentu </li></ul><br>  Terima kasih atas perhatian anda  Jika Anda memiliki pengalaman serupa, maka beri tahu kami tentang hal itu di komentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id471874/">https://habr.com/ru/post/id471874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id471864/index.html">Generasi parser PEG</a></li>
<li><a href="../id471866/index.html">Visualisasi parser PEG</a></li>
<li><a href="../id471868/index.html">Genetika cinta: konflik antar gender sebagai dasar kerja sama dalam pasangan burung monogami</a></li>
<li><a href="../id471870/index.html">Penggunaan libdispatch yang efektif</a></li>
<li><a href="../id471872/index.html">Antarmuka dalam C # 8: Asumsi Berbahaya dalam Implementasi Default</a></li>
<li><a href="../id471876/index.html">PDU dan All-All-All: Distribusi Daya Rack</a></li>
<li><a href="../id471878/index.html">Bagaimana cara menulis kontrak pintar untuk WebAssembly di jaringan Ontology? Bagian 1: Karat</a></li>
<li><a href="../id471880/index.html">Ide untuk Geek Halloween, atau waktu untuk memilih GeekMask</a></li>
<li><a href="../id471882/index.html">Daftar terbuka acara PHP, pembicara dan penyelenggara di GitHub</a></li>
<li><a href="../id471884/index.html">10 utilitas ApexSQL gratis untuk mengelola database Microsoft SQL Server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>