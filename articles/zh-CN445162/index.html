<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📗 🖖🏼 💪🏽 Terraform提供商Selectel 🧑🏾‍🤝‍🧑🏾 🚦 ➖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我们启动了正式的Terraform提供商以与Selectel合作。 该产品允许用户通过“基础结构即代码”方法完全实施资源管理。 

 当前，提供商支持服务“虚拟私有云” （以下简称VPC）的资源管理。 将来，我们计划向其中添加Selectel提供的其他服务的资源管理。 

 如您所知，VPC服务基于...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terraform提供商Selectel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/445162/"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br> 我们启动了正式的Terraform提供商以与Selectel合作。 该产品允许用户通过“基础结构即代码”方法完全实施资源管理。 <br><a name="habracut"></a><br> 当前，提供商支持服务<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">“虚拟私有云”</a> （以下简称VPC）的资源管理。 将来，我们计划向其中添加Selectel提供的其他服务的资源管理。 <br><br> 如您所知，VPC服务基于OpenStack。 但是，由于OpenStack并未提供用于服务公共云的本机工具，我们在一组附加的API中实现了缺少的功能，这些API简化了复杂复合对象的管理并简化了工作。  OpenStack中可用的部分功能已禁止直接使用，但可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">我们的API进行</a>访问。 <br><br>  Selectel Terraform提供程序现在可以管理以下VPC资源： <br><br><ul><li> 项目及其配额； </li><li> 用户，他们的角色和令牌； </li><li> 公共子网，包括跨区域和VRRP； </li><li> 软件许可证。 </li></ul><br> 提供者使用我们的公共Go-library与VPC API一起使用。 库和提供程序本身都是开源的，它们是在Github上开发的： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Go-selvpcclient</a>库存储库， </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Terraform提供程序Selectel提供程序</a>存储库。 </li></ul><br> 要管理其他云资源，例如虚拟机，磁盘，Kubernetes群集，可以使用OpenStack Terraform提供程序。 可以在以下链接中找到两家提供商的官方文档： <br><br><ul><li>  Selectel资源文档： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Terraform-provider Selectel</a> ， </li><li>  OpenStack资源文档： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow noopener noreferrer">Terraform提供者OpenStack</a> 。 </li></ul><br><h2> 开始使用 </h2><br> 首先，您需要安装Terraform（说明和安装包的链接可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow noopener noreferrer">官方网站</a>上找到）。 <br><br> 要正常工作，提供程序需要Selectel API密钥，该密钥在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">控制面板中为该帐户创建</a> 。 <br><br> 使用Selectel的清单是使用Terraform或使用我们在Github存储库中可用的一组现成示例创建的： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples</a> 。 <br><br> 带有示例的存储库分为两个目录： <br><br><ul><li>  <strong>模块</strong> ，包含小型可重用模块，这些模块化模块将一组参数作为输入并管理一小部分资源； </li><li>  <strong>examples</strong> ，包含一组完整的互连模块的示例。 </li></ul><br> 安装Terraform，创建Selectel API密钥并熟悉示例之后，我们继续进行实际示例。 <br><br><h2> 使用本地磁盘创建服务器的示例 </h2><br> 考虑创建项目的示例，具有角色的用户和具有本地磁盘的虚拟机： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> 。 <br><br>  <strong>vars.tf</strong>文件描述了调用模块时将使用的所有参数。 其中一些具有默认值，例如，将使用以下配置在<strong>ru-3a</strong>区域中创建服务器： <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br> 在<b>main.tf</b>文件中，Selectel提供程序已初始化： <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br> 此文件还包含将在服务器上安装的SSH密钥的默认值： <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br> 如有必要，您可以指定其他公共密钥。 不必将键指定为文件的路径；您还可以将值添加为字符串。 <br><br> 在该文件中，进一步启动了<strong>project_with_user</strong>和<strong>server_local_root_disk</strong>模块，它们管理必要的资源。 <br><br> 我们将更详细地分析这些模块。 <br><br><h3> 创建具有角色的项目和用户 </h3><br> 第一个模块创建一个项目和一个在该项目中具有角色的用户： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples / modules / vpc / project_with_user</a> 。 <br><br> 创建的用户将能够登录OpenStack并管理其资源。 该模块很简单，仅管理三个实体： <br><br><ul><li>  selectel_vpc_project_v2， </li><li>  selectel_vpc_user_v2， </li><li>  selectel_vpc_role_v2。 </li></ul><br><h3> 使用本地磁盘创建虚拟服务器 </h3><br> 第二个模块管理使用本地磁盘创建服务器所需的OpenStack对象。 <br><br> 您应该注意在此模块中为<strong>openstack_compute_instance_v2</strong>资源指定的一些参数： <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  <strong>ignore_changes</strong>参数允许<strong>您</strong>忽略用于创建虚拟机的映像的<strong>id</strong>属性更改。 在VPC服务中，大多数公共映像每周都会自动更新一次，其<strong>ID</strong>也会更改。 这是由于OpenStack-Glance组件的功能所致，其中图像被视为不可变的实体。 <br><br> 如果创建或修改了使用公共映像的<strong>id</strong>作为<strong>image_id</strong>参数的现有服务器或磁盘，则在更新该映像后，重新启动Terraform清单将重新创建服务器或磁盘。 使用<strong>ignore_changes</strong>参数可以避免这种情况。 <br><br>  <em>注意：</em> <strong><em>ignore_changes</em></strong> <em>参数</em> <em>很久以前就出现在Terraform中：</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">pull＃2525</a> <em>。</em> <br><br> 要成功调整本地磁盘，核心或服务器内存的大小，需要<strong>ignore_resize_confirmation</strong>参数。 此类更改是通过使用<b>调整大小</b>请求的OpenStack Nova组件进行的。 默认情况下，Nova在<b>调整大小</b>请求后将服务器置于<b>verify_resize</b>状态，并等待用户的其他确认。 但是，可以更改此行为，以使Nova无需等待用户的其他操作。 <br><br> 指定的参数允许Terraform不等待服务器的<b>verify_resize</b>状态，并为更改参数后服务器处于活动状态做好准备。 该参数可从OpenStack Terraform提供程序的1.10.0版本获得： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">pull＃422</a> 。 <br><br><h3> 资源创造 </h3><br> 在启动清单之前，应该注意，在我们的示例中，启动了两个不同的提供程序，并且OpenStack提供程序取决于Selectel提供程序的资源，因为如果不在项目中创建用户就无法管理属于它的对象。 不幸的是，出于同样的原因，我们不能只在示例中运行<strong>terraform apply命令</strong> 。 我们将需要首先<strong>申请</strong> <strong>project_with_user</strong>模块，然后再申请其他所有内容。 <br><br>  <em>注意：此问题尚未在Terraform中解决，您可以按照在Github上第<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">2430期</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">第4149</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">期中的</a>讨论进行。</em> <br><br> 要创建资源，我们将转到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk目录</a> ，其内容应如下所示： <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br> 我们使用以下命令初始化模块： <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br> 输出显示Terraform下载了所使用的提供程序的最新版本，并检查了示例中描述的所有模块。 <br><br> 首先，应用<strong>project_with_user</strong>模块。 在这种情况下，您需要手动传输尚未设置的变量的值： <br><br><ul><li>  <strong>sel_account</strong>和您的Selectel帐号； </li><li>  <strong>sel_token</strong>带有Selectel API的密钥； </li><li>  <strong>user_password</strong>和OpenStack用户的密码。 </li></ul><br> 前两个变量的值必须从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">控制面板中获取</a> 。 <br><br> 对于最后一个变量，您可以想到任何密码。 <br><br> 要使用该模块，必须<strong>通过</strong>运行以下命令来替换值<strong>SEL_ACCOUNT</strong> ， <strong>SEL_TOKEN</strong>和<strong>USER_PASSWORD</strong> ： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br> 运行Terraform命令后，它将显示它想要创建哪些资源并需要确认： <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br> 一旦创建了项目，用户和角色，就可以开始创建剩余的资源： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br> 创建资源时，请注意带有外部IP地址的Terraform输出，在该IP地址上可以访问创建的服务器： <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br> 您可以在指定IP上通过SSH使用创建的虚拟机。 <br><br><h3> 资源编辑 </h3><br> 除了通过Terraform创建资源外，还可以对其进行修改。 <br><br> 例如，通过更改<strong>示例/vpc/server_local_root_disk/main.tf文件中</strong>的<strong>server_vcpus</strong>和<strong>server_ram_mb参数</strong>的值，增加服务器的内核和内存的数量： <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br> 之后，我们使用以下命令检查将导致哪些更改： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br> 结果，Terraform对资源<strong>openstack_compute_instance_v2</strong>和<strong>openstack_compute_flavor_v2</strong>进行了更改。 <br><br>  <em>请注意，这将导致重新创建的虚拟机。</em> <br><br> 要应用新的虚拟机配置，请使用我们之前已经运行过的<strong>terraform apply命令</strong> 。 <br><br> 所有创建的对象将显示在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">VPC控制面板中</a> ： <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br> 在我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">示例存储库中，</a>您还可以看到用于创建具有网络驱动器的虚拟机的清单。 <br><br><h2>  Kubernetes集群示例 </h2><br> 在继续下一个示例之前，我们将清除先前创建的资源。 为此，请在项目根目录<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk中，</a>运行以下命令删除OpenStack对象： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br> 接下来，运行Selectel VPC API对象清除命令： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br> 在这两种情况下，您都需要确认所有对象的删除： <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br> 以下示例位于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / kubernetes_cluster目录中</a> 。 <br><br> 本示例创建一个项目，在该项目中扮演角色的用户，并引发一个Kubernetes集群。 在<strong>vars.tf</strong>文件中， <strong>您</strong>可以看到默认值，例如节点数，它们的特征，Kubernetes的版本等。 <br><br> 要创建资源，类似于第一个示例，首先，我们将初始化模块并创建<strong>project_with_user</strong>模块资源，然后创建其余资源： <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br> 我们通过OpenStack Magnum组件继续创建和管理Kubernetes集群。 您可以在我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">以前的文章</a>之一<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">和知识库中</a>了解有关如何使用群集的更多信息。 <br><br> 在群集准备期间，将创建磁盘，虚拟机并安装所有必需的组件。 准备工作大约需要4分钟，此时Terraform将显示​​以下形式的消息： <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br> 安装完成后，Terraform将通知您集群已准备就绪，并显示其标识符： <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br> 要通过kubectl实用程序管理创建的Kubernetes集群，必须获取集群访问文件。 为此，请转到您帐户中项目列表中通过Terraform创建的项目： <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br> 接下来， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">单击</a>格式为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">xxxxxx.selvpc.ru</a>的链接，该链接显示在项目名称下方： <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br> 使用通过Terraform创建的用户名和密码作为登录信息。 如果您没有为我们的示例更改<strong>vars.tf</strong>或<strong>main.tf</strong> ，则该用户的名称<strong>将为tf_user</strong> 。 作为密码，使用变量<strong>TF_VAR_user_password</strong>的值，该值<strong>是</strong>在较早运行<strong>terraform apply</strong>时指定的。 <br><br> 在项目内部，您需要转到<strong>Kubernetes</strong>选项卡： <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br> 这是通过Terraform创建的集群。 您可以在“访问”选项卡上下载<strong>kubectl</strong>的文件： <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br> 该选项卡包含有关安装<strong>kubectl</strong>和使用下载的<strong>config.yaml的说明</strong> 。 <br><br> 启动<strong>kubectl</strong>并设置环境变量<strong>KUBECONFIG后，</strong>可以使用Kubernetes： <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br> 群集节点的数量可以通过Terraform轻松更改。 <br> 在<strong>main.tf</strong>文件中指定了以下值： <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p> 该值从<strong>vars.tf代替</strong> ： </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br> 您可以在<strong>vars.tf中</strong>更改默认值，或直接在<strong>main.tf中</strong>指定所需的值： <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br> 如第一个示例一样，要应用更改，请使用<strong>terraform apply命令</strong> ： <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br> 当节点数更改时，群集将保持可用。 通过Terraform添加节点后，无需额外配置即可使用它： <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2> 结论 </h2><br> 在本文中，我们了解了通过Terraform使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">“虚拟私有云”</a>的基本方法。 如果您使用官方的Terraform提供商Selectel并提供反馈，我们将非常高兴。 <br><br> 可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Github Issues</a>报告Terraform提供程序Selectel的所有发现的错误。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445162/">https://habr.com/ru/post/zh-CN445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445152/index.html">搜索还可以做些什么？ Yandex报告</a></li>
<li><a href="../zh-CN445154/index.html">3月25日至3月31日在莫斯科举行的数字活动</a></li>
<li><a href="../zh-CN445156/index.html">Glenmark紧凑型雾化器：日常生活中有用的东西</a></li>
<li><a href="../zh-CN445158/index.html">3D打印机中的最佳零件方向和支撑配置</a></li>
<li><a href="../zh-CN445160/index.html">我们开发踏板固件来学习演奏巴拉莱卡</a></li>
<li><a href="../zh-CN445164/index.html">平衡网站性能。 第5部分：可用性</a></li>
<li><a href="../zh-CN445166/index.html">您需要了解的有关CSS自动断字的所有信息</a></li>
<li><a href="../zh-CN445168/index.html">招聘者和雇主会喜欢的理想简历</a></li>
<li><a href="../zh-CN445170/index.html">关于JavaScript的三大谎言</a></li>
<li><a href="../zh-CN445172/index.html">带有Chromium的边缘浏览器出现在文件托管服务上</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>