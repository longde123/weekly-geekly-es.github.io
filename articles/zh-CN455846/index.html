<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⌨️ 🏵️ ✋🏼 Julia中的分布式计算 🏙️ ↪️ 👨🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如果以前的文章更有可能成为种子，那么现在是时候在她的计算机上测试Julia的并行化功能了。 
 多核或分布式处理 


 Distributed模块提供了与分布式内存并行计算的实现，这是Julia随附的标准库的一部分。 大多数现代计算机都具有不止一个处理器，并且可以将多台计算机集群。 利用这些多个处...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Julia中的分布式计算</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455846/"><p><img src="https://habrastorage.org/webt/ud/o6/5u/udo65u8kthnpek7hzrcedxgzwtk.jpeg"></p><br><p> 如果<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以前的文章</a>更有可能成为种子，那么现在是时候在她的计算机上测试Julia的并行化功能了。 </p><a name="habracut"></a><br><h2 id="mnogoyadernaya-ili-raspredelennaya-obrabotka"> 多核或分布式处理 </h2><br><p> <code>Distributed</code>模块提供了与分布式内存并行计算的实现，这是Julia随附的标准库的一部分。 大多数现代计算机都具有不止一个处理器，并且可以将多台计算机集群。 利用这些多个处理器的功能，您可以更快地执行许多计算。 性能受两个主要因素影响：处理器本身的速度和其内存访问的速度。 在群集中，很明显，此CPU将对同一台计算机（节点）上的RAM进行最快的访问。 也许更令人惊讶的是，由于主内存和缓存速度的差异，此类问题在典型的多核笔记本电脑上还是很重要的。 因此，良好的多处理器环境应允许您通过特定处理器控制部分内存的“所有权”。  Julia提供了一个基于消息的多处理器环境，该环境允许程序在不同内存域中的多个进程上同时运行。 </p><br><p>  Julia的消息传递实现与其他环境（例如<abbr title="在这种情况下，MPI是指MPI-1标准。从MPI-2开始，MPI标准委员会引入了一套新的通信机制，统称为远程存储器访问（RMA）。">MPI</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">[1]）不同</a> 。  Julia中的通信通常是“单向”的，这意味着程序员只需在两进程操作中显式地控制一个进程即可。 另外，这些操作通常看起来不像“发送消息”和“接收消息”，而是类似于更高级别的操作，例如对用户定义函数的调用。 </p><br><p>  Julia中的分布式编程基于两个原语构建： <em>远程链接</em>和<em>远程调用</em> 。 远程链接是一个对象，可以从任何进程使用它来引用存储在特定进程中的对象。 远程调用是一个进程根据另一个（可能是相同的）进程的某些自变量调用某个函数的请求。 </p><br><p> 远程链接有两种形式： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Future</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RemoteChannel</a> 。 </p><br><p> 远程调用返回<code>Future</code>并立即执行； 进行呼叫的过程继续进行下一个操作，而远程呼叫发生在其他地方。 您可以使用返回的<code>Future</code>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">wait</a>命令来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">等待</a>远程调用完成，也可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">fetch获取</a>结果的完整值。 </p><br><p> 另一方面，我们有重写的RemoteChannels。 例如，多个进程可以引用相同的远程通道来协调其处理。 每个进程都有一个关联的标识符。 提供Julia交互式提示的进程的标识符始终为1。默认情况下，用于并发操作的进程称为“工人”。 如果只有一个进程，则认为进程1是有效的。 否则，除过程1之外的所有其他过程均被视为工作程序。 </p><br><p><img src="https://habrastorage.org/webt/vy/ts/gd/vytsgdo3oi1x52r901ibv8s4z1a.jpeg"></p><br><p> 让我们开始吧。 以<code>julia -pn</code>后记在本地计算机上提供了n个工作流。 通常，n等于机器上的CPU线程（逻辑核心）数量是有意义的。 请注意，-p参数隐式加载Distributed模块。 </p><br><div class="spoiler">  <b class="spoiler_title">如何开始撰写附言？</b> <div class="spoiler_text"><p> 对于Linux用户，控制台操作应该简单明了。 此教育程序适用于没有经验的Windows用户。 <br> 终端Julia（REPL）提供了使用系统命令的功能： </p><br><pre> <code class="plaintext hljs">julia&gt; pwd() #     "C:\\Users\\User\\AppData\\Local\\Julia-1.1.0" julia&gt; cd("C:/Users/User/Desktop") #   julia&gt; run(`calc`) #     #     Windows. #      Process(`calc`, ProcessExited(0))</code> </pre> <br><p> 使用这些命令，您可以从朱莉娅（Julia）开始朱莉娅（Julia），但最好不要被它带走 </p><br><p><img src="https://habrastorage.org/webt/tb/yv/4m/tbyv4me6o0jhsk-5ap3xgdqivsq.png"></p><br><p> 从<em>julia / bin /</em>运行<strong>cmd</strong>并在那里运行<code>julia -p 2</code>命令或爱好者从快捷方式启动的选项会更正确：在桌面上，创建一个包含以下内容的记事本文档<code>C:\Users\User\AppData\Local\Julia-1.1.0\bin\julia -p 4</code> （ <em>指定进程的地址和数量</em> ），并将其保存为文本文件，名称为<em>run.bat</em> 。 在这里，现在您的桌​​面上有一个用于4个核心的Julia启动系统文件。 </p><br><p> 您可以使用另一种方法（特别是对于<em>Jupyter而言</em> ）： </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> </div></div><br><pre> <code class="julia hljs">$ ./julia -p <span class="hljs-number"><span class="hljs-number">2</span></span> julia&gt; r = remotecall(rand, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.18526</span></span> <span class="hljs-number"><span class="hljs-number">1.50912</span></span> <span class="hljs-number"><span class="hljs-number">1.16296</span></span> <span class="hljs-number"><span class="hljs-number">1.60607</span></span></code> </pre><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">remotecall</a>的第一个参数是被调用的函数。 <br>  Julia中的大多数并发程序都没有引用特定的进程或可用的进程数，但是远程调用被视为提供更精确控制的低级接口。 </p><br><p>  <code>remotecall</code>的第二个参数是将要完成工作的进程的标识符，其余参数将传递给被调用的函数。 如您所见，在第一行中，我们要求处理2建立一个随机的2 x 2矩阵，在第二行中，我们要求向其添加1。 两种计算的结果在两个期货r和s中可用。  spawnat宏对第一个参数中指定的过程的第二个参数中的表达式求值。 有时您可能需要一个远程计算的值。 当您从远程对象读取以获取下一个本地操作所需的数据时，通常会发生这种情况。  <code>remotecall_fetch</code>有一个<code>remotecall_fetch</code>函数。 这等效于<code>fetch (remotecall (...))</code> ，但效率更高。 </p><br><p> 请记住， <code>getindex(r, 1,1)</code>等效于<code>r[1,1]</code> ，因此此调用将检索未来<code>r</code>的第一个元素。 </p><br><p>  <code>remotecall</code>远程调用<code>remotecall</code>不是特别方便。  <code>@spawn</code>宏使<code>@spawn</code>变得更容易。 它使用表达式而不是函数，并为您选择在何处执行操作： </p><br><pre> <code class="julia hljs">julia&gt; r = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.38854</span></span> <span class="hljs-number"><span class="hljs-number">1.9098</span></span> <span class="hljs-number"><span class="hljs-number">1.20939</span></span> <span class="hljs-number"><span class="hljs-number">1.57158</span></span></code> </pre> <br><p> 请注意，我们使用<code>1 .+ Fetch(r)</code>代替<code>1 .+ r</code> 这是因为我们不知道代码将在何处执行，因此在一般情况下，可能有必要提取以将<code>r</code>移至加法过程。 在这种情况下， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@spawn</a>足够聪明，可以为拥有<code>r</code>的进程执行计算，因此提取将无法进行操作（不完成任何工作）。  （值得注意的是，spawn不是内置的，而是在Julia中定义为宏。您可以定义自己的此类构造。） </p><br><p> 重要的是要记住，提取后， <code>Future</code>将在本地缓存其值。 进一步的获取调用并不意味着网络的飞跃。 选择所有参考期货后，将删除已删除的存储值。 </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@async</a>与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@spawn</a>相似，但仅在本地进程中运行任务。 我们使用它为每个流程创建一个“提要”任务。 每个任务都会选择下一个必须计算的索引，然后等待该过程完成并重复直到我们用完索引为止。 </p><br><p> 请注意，直到主任务到达<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@sync</a>块的末尾之后， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">供稿</a>器任务才开始执行，然后它通过控制并等待所有本地任务的完成，然后从函数返回。 </p><br><p> 对于v0.7及更高版本，Feeder任务可以通过nextidx共享状态，因为所有任务均在同一进程中执行。 即使任务是一起计划的，在某些情况下（例如异步I / O）也可能需要阻塞。 这意味着上下文切换仅在定义明确的点发生：在这种情况下，当<code>remotecall_fetch</code>时。 这是当前的实现状态，在Julia的将来版本中可能会更改，因为它被设计为能够在M个进程或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">M：N线程中</a>完成多达N个任务。 然后，我们需要一个模型来获取/释放<code>nextidx</code>锁，因为允许多个进程同时读取和写入资源是不安全的。 </p><br><p> 您的代码必须可用于运行它的任何进程。 例如，在Julia提示符下，键入以下内容： </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> rand2(dims...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>*rand(dims...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> julia&gt; rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">0.153756</span></span> <span class="hljs-number"><span class="hljs-number">0.368514</span></span> <span class="hljs-number"><span class="hljs-number">1.15119</span></span> <span class="hljs-number"><span class="hljs-number">0.918912</span></span> julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)) ERROR: <span class="hljs-built_in"><span class="hljs-built_in">RemoteException</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CapturedException</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">"#rand2"</span></span>)) Stacktrace: [...]</code> </pre> <br><p> 进程1知道函数rand2，但是进程2不知道。 通常，您将从文件或包中下载代码，并且在控制加载代码的进程方面具有极大的灵活性。 考虑包含以下代码的<code>DummyModule.jl</code>文件： </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span> DummyModule <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> MyType, f <span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> MyType a::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> f(x) = x^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span> println(<span class="hljs-string"><span class="hljs-string">"loaded"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p> 要在所有进程中引用<code>MyType</code> ，必须在每个进程中加载<code>DummyModule.jl</code> 。 调用<code>include ('DummyModule.jl')</code>仅将其加载到一个进程中。 要将其加载到每个进程中，请使用<code>@everywhere</code>宏（使用julia -p 2运行Julia）： </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include(<span class="hljs-string"><span class="hljs-string">"DummyModule.jl"</span></span>) loaded From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: loaded From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: loaded</code> </pre> <br><p> 与往常一样，这不会使DummyModule可访问任何需要使用或导入的进程。 此外，当DummyModule包含在一个进程的范围内时，则不包含在其他任何进程中： </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> .DummyModule julia&gt; MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) ERROR: On worker <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>: MyType not defined ⋮ julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> DummyModule.MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br><p> 但是，例如，仍然可以将MyType发送到加载DummyModule的进程，即使它不在范围内： </p><br><pre> <code class="julia hljs">julia&gt; put!(<span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>), MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Channel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Any</span></span>}}(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre> <br><p> 也可以在启动时使用-L标志将该文件预加载到多个进程中，并且驱动程序脚本可用于控制计算： </p><br><pre> <code class="julia hljs">julia -p &lt;n&gt; -L file1.jl -L file2.jl driver.jl</code> </pre> <br><p> 上面示例中运行驱动程序脚本的Julia进程的标识符为1，就像提供交互式提示的进程一样。 最后，如果DummyModule.jl不是一个单独的文件，而是一个包，则使用DummyModule将在所有进程中加载​​DummyModule.jl，但只会将其传输到被调用的进程范围内。 </p><br><h2 id="zapusk-i-upravlenie-rabochimi-processami"> 启动和管理工作流程 </h2><br><p> 基本的Julia安装具有对两种类型的群集的内置支持： </p><br><ul><li> 使用-p选项指定的本地集群，如上所示。 </li><li> 使用--machine-file选项集群计算机。 这将使用没有密码的ssh登录名在指定计算机上启动Julia工作流（与当前主机相同的路径）。 </li></ul><br><p><img src="https://habrastorage.org/webt/dr/1b/7y/dr1b7y4ly3ashzsh19-7lwmvwni.jpeg"></p><br><p> 函数<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">addprocs</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rmprocs</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">worker</a>和其他函数可作为软件工具使用，用于在集群中添加，删除和查询进程。 </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p> 在调用<code>addprocs</code>之前，必须将<code>Distributed</code>模块显式加载到主进程中。 它自动适用于工作流程。 请注意，工作人员不要运行启动脚本<code>~/.julia/config/startup.jl</code>也不<code>~/.julia/config/startup.jl</code>其全局状态（例如全局变量，新方法的定义和已加载模块）与任何其他正在运行的进程同步。 可以通过编写自己的<code>ClusterManager</code>来支持其他类型的集群，如下面在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ClusterManager</a>部分中所述。 </p><br><h2 id="deystviya-s-dannymi"> 数据动作 </h2><br><p> 发送消息和移动数据构成了分布式程序中的大部分开销。 减少消息数量和发送的数据量对于实现性能和可伸缩性至关重要。 为此，了解Julia的各种分布式编程结构执行的数据移动非常重要。 </p><br><p>  <code>fetch</code>可以看作是显式的数据移动操作，因为它直接请求将对象移动到本地计算机。  <code>@spawn</code> （以及几个相关的构造）也可以移动数据，但这并不是很明显，因此可以将其称为隐式数据移动操作。 考虑以下两种构建和平方随机矩阵的方法： </p><br><p> 行程时间： </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>); julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> A^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p> 方法二： </p><br><pre> <code class="julia hljs">julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p> 差异似乎微不足道，但实际上由于<code>@spawn</code>的行为， <code>@spawn</code>非常明显。 在第一种方法中，随机矩阵是在本地构建的，然后发送到另一个过程中进行平方。 在第二种方法中，建立一个随机矩阵并将其平方在另一个过程上。 因此，第二种方法发送的数据少于第一种。 在这个玩具示例中，这两种方法很容易区分和选择。 但是，在实际程序中，设计数据移动可能非常昂贵，并且可能需要一些度量。 </p><br><p> 例如，如果第一个过程需要矩阵A，则第一个方法可能会更好。 或者，如果计算A昂贵且仅使用当前进程，则将其转移到另一个进程可能是不可避免的。 或者，如果当前过程在<code>spawn</code>和<code>fetch(Bref)</code>之间没有太多共同点，则最好完全消除并发性。 或想象<code>rand(1000, 1000)</code>更昂贵的操作<code>rand(1000, 1000)</code>取代。 然后可能仅在此步骤中添加另一个<code>spawn</code>语句。 </p><br><h2 id="globalnye-peremennye"> 全局变量 </h2><br><p> 通过spawn远程执行的表达式或使用<code>remotecall</code>指定用于远程执行的闭包可以引用全局变量。  <code>Main</code>模块中的全局绑定与其他模块中的全局绑定有些不同。 考虑以下代码片段： </p><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p> 在这种情况下，必须在远程过程中定义<code>sum</code> 。 请注意， <code>A</code>是在本地工作空间中定义的全局变量。  Worker 2在“ <code>Main</code>部分中没有名为<code>A</code>的变量。 发送工作者2的关闭函数<code>() -&gt; sum(A)</code>导致<code>Main.A</code>在2上定义。即使在<code>remotecall_fetch</code>调用<code>remotecall_fetch</code>后， <code>Main.A</code>仍然存在于工作者2上。 </p><br><p><img src="https://habrastorage.org/webt/kp/iv/xi/kpivxixwcfwqqzi4gv1dyqkjhcw.png"></p><br><p> 具有嵌入式全局引用（仅在主模块中）的远程调用按以下方式管理全局变量： </p><br><ul><li> 如果将新的全局绑定作为远程调用的一部分进行引用，则会在目标工作站上创建它们。 </li><li> 全局常量也被声明为远程节点上的常量。 </li><li> 仅在远程呼叫的情况下且仅当其值已更改时，才将全局变量重新提交给目标员工。 此外，群集不同步节点之间的全局绑定。 例如： </li></ul><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment"># worker 2 A = rand(10,10) remotecall_fetch(()-&gt;sum(A), 3) # worker 3 A = nothing</span></span></code> </pre> <br><p> 执行上面的片段会导致一个事实， <code>Main.A</code>雇员2上的<code>Main.A</code>与雇员3上的<code>Main.A</code>具有不同的值，而节点1上的<code>Main.A</code>的值为零。 </p><br><p> 如您可能理解的那样，尽管与全局变量关联的内存可以在将它们重新分配给主设备时收集，但是由于绑定继续起作用，因此不会为工作人员执行此类操作。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">清楚！</a> 如果不再需要某些全局变量，可以使用它们手动将它们重新分配为<code>nothing</code> 。 作为正常垃圾回收周期的一部分，这将释放与它们关联的所有内存。 因此，在远程调用中访问全局变量时，程序应格外小心。 实际上，只要有可能，最好完全避免它们。 如果必须引用全局变量，请考虑使用<code>let</code>块来本地化全局变量。 例如： </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; remotecall_fetch(()-&gt;A, <span class="hljs-number"><span class="hljs-number">2</span></span>); julia&gt; B = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> B = B remotecall_fetch(()-&gt;B, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; julia&gt; <span class="hljs-meta"><span class="hljs-meta">@fetchfrom</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> InteractiveUtils.varinfo() name size summary ––––––––– ––––––––– –––––––––––––––––––––– A <span class="hljs-number"><span class="hljs-number">800</span></span> bytes <span class="hljs-number"><span class="hljs-number">10</span></span>×<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>} Base <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Core <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Main <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span></code> </pre> <br><p> 显而易见，全局变量<code>A</code>在工作程序2上定义的，但是<code>B</code>作为局部变量编写的，因此，在工作程序2上不存在<code>B</code>的绑定。 </p><br><h2 id="parallelnye-cikly"> 并行循环 </h2><br><p><img src="https://habrastorage.org/webt/zv/m5/q_/zvm5q_scthnveue7fxljwa0dshu.jpeg"></p><br><p> 幸运的是，许多有用的并发计算不需要数据移动。 一个典型的例子是蒙特卡洛模拟，其中几个过程可以同时处理独立的模拟测试。 我们可以使用<code>@spawn</code>将硬币翻转为两个过程。 首先在<code>count_heads.jl</code>编写以下函数： </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> count_heads(n) c::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:n c += rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  count_heads函数仅将n个随机位相加。 这是我们可以在两台计算机上进行一些测试并加总结果的方法： </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include_string(Main, $(read(<span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)), <span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>) julia&gt; a = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; b = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(a)+fetch(b) <span class="hljs-number"><span class="hljs-number">100001564</span></span></code> </pre> <br><p> 此示例演示了功能强大且经常使用的并行编程模式。 在多个过程中独立执行许多迭代，然后使用某些函数将其结果合并。 联合过程称为约简，因为它通常会降低张量等级：将数的向量缩减为一个数，或者将矩阵缩减为一行或一列，依此类推。 在代码中，通常如下所示：模式<code>x = f(x, v [i])</code> ，其中<code>x</code>是电池， <code>f</code>是归约函数，而<code>v[i]</code>是要归约的元素。 </p><br><p> 期望<code>f</code>是关联的，使得操作以什么顺序执行无关紧要。 请注意，我们将此模板与<code>count_heads</code>一起<code>count_heads</code>可能是通用的。 我们使用了两个显式的<code>spawn</code>语句，将并发限制为两个进程。 要在任意数量的进程上运行，我们可以在分布式内存中使用并行<code>for</code>循环操作，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">distributed</a>将其写入Julia，例如： </p><br><pre> <code class="julia hljs">nheads = <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">200000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>(rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>                (   <code>(+)</code> ).          .         . </p><br><p>  ,     <code>for</code>    ,    .  ,      ,          ,      .  ,    ,      . ,       : </p><br><pre> <code class="julia hljs">a = zeros(<span class="hljs-number"><span class="hljs-number">100000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>      ,          .    ,  .  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Shared Arrays</a> ,    ,    : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays a = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  «»      ,      : </p><br><pre> <code class="julia hljs">a = randn(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> f(a[rand(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>)]) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>     <code>f</code>      ,    .    ,    ,    .      ,               <code>Future</code> ,   .     Future    ,    <code>fetch</code> ,      ,   <code>@sync</code> ,  <code>@sync distributed for</code> . </p><br><p>       ,              (,    ,      ).     ,  <em> </em> ,   Julia   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pmap</a> . ,            : </p><br><pre> <code class="julia hljs">julia&gt; M = <span class="hljs-built_in"><span class="hljs-built_in">Matrix</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}[rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]; julia&gt; pmap(svdvals, M);</code> </pre> <br><p> <code>pmap</code>    ,        . , <code>distributed for</code>   ,    , ,    .      <code>pmap</code> ,   <code>distributed</code>   .   <code>distributed for</code>      . </p><br><h2 id="obschie-massivy-shared-arrays">   (Shared Arrays) </h2><br><p><img src="https://habrastorage.org/webt/gg/46/u5/gg46u5y_8bmejazw_ijxwzrbxie.jpeg"></p><br><p> Shared Arrays              .        <a href="">DArray</a> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SharedArray</a>  .  <a href="">DArray</a>         ,            ; ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SharedArray</a>        . </p><br><p> <code>SharedArray</code> —  ,   ,              .  Shared Array    <code>SharedArrays</code> ,         .  <code>SharedArray</code>  (    )   ,        ,       .        <code>SharedArray</code> ,     .  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Array</a> ,      <code>SharedArray</code> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sdata</a> .    <code>AbstractArray</code> <code>sdata</code>    ,    <code>sdata</code>     <code>Array</code> .      : </p><br><pre> <code class="julia hljs"><span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{T,N}(dims::<span class="hljs-built_in"><span class="hljs-built_in">NTuple</span></span>; init=<span class="hljs-literal"><span class="hljs-literal">false</span></span>, pids=<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>[])</code> </pre> <br><p>   <code>N</code> -     <code>T</code>   <code>dims</code>  ,   <code>pids</code> .     ,        ,      <code>pids</code> (  ,       ). </p><br><p>    <code>init</code>   <code>initfn(S :: SharedArray)</code> ,      .   ,      <code>init</code>    ,  . </p><br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[localindices(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; S[<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> julia&gt; S <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SharedArrays.localindices</a>             . ,      ,  : </p><br><pre> <code class="julia hljs">julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[indexpids(S):length(procs(S)):length(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p>        ,    ,    . 例如： </p><br><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(S) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> remotecall_wait(fill!, p, S, p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>    .     <em></em>    <code>pid</code> ,  ,     (    <code>S</code> ),   <code>pid</code> . </p><br><p>            «»: </p><br><pre> <code class="julia hljs">q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>] = q[i,j,t] + u[i,j,t]</code> </pre> <br><p>   ,     ,   , ,  ,   :  <code>q [i,j,t]</code>    ,     <code>q[i,j,t+1]</code>     ,  ,  ,  <code>q[i,j,t]</code>      ,      <code>q[i,j,t+1]</code> .         .     .  ,    <code>(irange, jrange)</code> ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myrange(q::<span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>) idx = indexpids(q) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> idx == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># This worker is not assigned a piece return 1:0, 1:0 end nchunks = length(procs(q)) splits = [round(Int, s) for s in range(0, stop=size(q,2), length=nchunks+1)] 1:size(q,1), splits[idx]+1:splits[idx+1] end</span></span></code> </pre> <br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_chunk!(q, u, irange, jrange, trange) <span class="hljs-meta"><span class="hljs-meta">@show</span></span> (irange, jrange, trange) <span class="hljs-comment"><span class="hljs-comment"># display so we can see what's happening for t in trange, j in jrange, i in irange q[i,j,t+1] = q[i,j,t] + u[i,j,t] end q end</span></span></code> </pre> <br><p>        <code>SharedArray</code> </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> advection_shared_chunk!(q, u) = advection_chunk!(q, u, myrange(q)..., <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><p>      ,       : </p><br><pre> <code class="julia hljs">julia&gt; advection_serial!(q, u) = advection_chunk!(q, u, <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@distributed</a> : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_parallel!(q, u) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>) q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>]= q[i,j,t] + u[i,j,t] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>  ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_shared!(q, u) <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(q) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> remotecall_wait(advection_shared_chunk!, p, q, u) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>    SharedArray    ,     (  <code>julia -p 4</code> ): </p><br><pre> <code class="julia hljs">julia&gt; q = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>)); julia&gt; u = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>));</code> </pre> <br><p>      JIT-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@time</a>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_serial!(q, u); (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">830.220</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">216</span></span> allocations: <span class="hljs-number"><span class="hljs-number">13820</span></span> bytes) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_parallel!(q, u); <span class="hljs-number"><span class="hljs-number">2.495</span></span> seconds (<span class="hljs-number"><span class="hljs-number">3999</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">289</span></span> MB, <span class="hljs-number"><span class="hljs-number">2.09</span></span>% gc time) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_shared!(q,u); From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">125</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">4</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>:<span class="hljs-number"><span class="hljs-number">375</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">126</span></span>:<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">5</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">376</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">238.119</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">2264</span></span> allocations: <span class="hljs-number"><span class="hljs-number">169</span></span> KB)</code> </pre> <br><p>    <code>advection_shared!</code>  ,      ,         . </p><br><h3 id="obschie-massivy-i-raspredelennaya-sborka-musora">       </h3><br><p>    ,          . ,        ,         . <br>    ,     ,   ,  . </p><br><h1 id="parallelnyy-monte-karlo-v-julia">  -  Julia </h1><br><p>  ,             ,    ,        . </p><br><p>         <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mo>=</mo><mn>3.14159265...</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.48ex" height="2.057ex" viewBox="0 -780.1 7526.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-3D" x="851" y="0"></use><g transform="translate(1907,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-34" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-31" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-35" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-39" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-32" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-36" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-35" x="4282" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2E" x="4783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2E" x="5061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2E" x="5340" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi><mo>=</mo><mn>3.14159265...</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">\pi = 3.14159265...</script> ,      ,   -.   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ pi </script> ,     <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi><msup><mi>r</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.033ex" height="2.419ex" viewBox="0 -935.7 3458.5 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-3C0" x="1979" y="0"></use><g transform="translate(2553,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-32" x="638" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>π</mi><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-3">S = \pi r^2</script> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.049ex" height="1.455ex" viewBox="0 -520.7 451.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-72" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> r </script> —  .     -   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ pi </script>    , ..        <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.901ex" viewBox="0 -935.7 3235.6 1249" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-6">[−1,1]^2</script>   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>&amp;#x2212;</mo><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.326ex" height="2.178ex" viewBox="0 -676.4 2292.9 937.7" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2212" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-79" x="1795" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>−</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">x-y</script>    ,    . </p><br><p><img src="https://habrastorage.org/webt/4v/ym/mb/4vymmbllbfnu3prcb3wfu0qqkje.png"></p><br><p>     ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.93ex" height="2.057ex" viewBox="0 -780.1 2553.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-3C0" x="1979" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">S=\pi</script> ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi><mo>=</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.31ex" height="1.937ex" viewBox="0 -728.2 2286.1 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-3D" x="729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-31" x="1785" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">r = 1</script> )    ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.004ex" height="2.057ex" viewBox="0 -780.1 2585.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-3D" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-34" x="2084" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-10">A = 4</script> )  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.657ex" height="2.66ex" viewBox="0 -832 1574.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-2F" x="573" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMAIN-34" x="1074" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-11">\pi/4</script> ,      ,    ,          .  ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> \ pi </script>      ,    .    <code>compute_pi (N)</code> ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> \ pi </script> ,  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">N</script> . </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle n_landed_in_circle = 0 for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end</span></span></code> </pre> <br><p>  ,     ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhjl7V8gnnPbJ5cEYwRYNV60hFQSiQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> \ pi </script>  。      :   ,          ,     25  . </p><br><p>  Julia         <code>Pi.jl</code> (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sublime Text</a> ,          ): </p><br><pre> <code class="julia hljs">C:\Users\User\AppData\Local\Julia-<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\julia -p <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; include(<span class="hljs-string"><span class="hljs-string">"C:/Users/User/Desktop/Pi.jl"</span></span>)</code> </pre> <br><p>       </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br><p>       <em>Jupyter</em> </p><br><div class="spoiler"> <b class="spoiler_title">Pi.jl</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) n_landed_in_circle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end function parallel_pi_computation(N::Int; ncores::Int=4) #       sum_of_pis = @distributed (+) for i=1:ncores compute_pi(ceil(Int, N / ncores)) end return sum_of_pis / ncores # average value end # ceil (T, x)     #  T,     x.</span></span></code> </pre> </div></div><br><p>       ,    : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">6.818123</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.96</span></span> M allocations: <span class="hljs-number"><span class="hljs-number">99.838</span></span> MiB, <span class="hljs-number"><span class="hljs-number">0.42</span></span>% gc time) <span class="hljs-number"><span class="hljs-number">3.141562892</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5.081638</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">62.953</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.141657252</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">3.504871</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.84</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">109.382</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1415942599999997</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">3.093918</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">71.938</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1416889400000003</span></span> julia&gt; <span class="hljs-literal"><span class="hljs-literal">pi</span></span> ? = <span class="hljs-number"><span class="hljs-number">3.1415926535897</span></span>...</code> </pre> <br><p>  <em>JIT</em> - —     .  ,    Julia  . ,             (       Multi-Threading, Atomic Operations, Channels  Coroutines). </p><br><h3 id="poleznye-ssylki">   </h3><br><p>   ,    ,   .  <a href="">MPI.jl</a>      <code>MPI</code> ,  <br> <a href="">DistributedArrays.jl</a>     . <br>       GPU,    : </p><br><ol><li>  (  C) <a href="">OpenCL.jl</a>  <a href="">CUDAdrv.jl</a>     OpenCL   CUDA. </li><li>  (  Julia)  <a href="">CUDAnative.jl</a>     CUDA . </li><li>  ,    ,   <a href="">CuArrays.jl</a>  <a href="">CLArrays.jl</a> </li><li>   ,   <a href="">ArrayFire.jl</a>  <a href="">GPUArrays.jl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> -</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kynseed</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> </li></ol><br><p>  , , .    ! </p><br><p><img src="https://habrastorage.org/webt/f2/4o/pr/f24oprfnnrnguwwb03xcyo__xx4.gif"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455846/">https://habr.com/ru/post/zh-CN455846/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455830/index.html">看一下.NET开发人员的眼光。 第一周</a></li>
<li><a href="../zh-CN455832/index.html">一次SQL调查的历史记录</a></li>
<li><a href="../zh-CN455834/index.html">Linux服务器基准测试：5个开放工具</a></li>
<li><a href="../zh-CN455840/index.html">如何处理多个查询。 组成，还原剂，FP</a></li>
<li><a href="../zh-CN455842/index.html">传播一个单链表。 迅捷版</a></li>
<li><a href="../zh-CN455848/index.html">访问单例时避免未定义行为的技术</a></li>
<li><a href="../zh-CN455852/index.html">窦提升和同时植入</a></li>
<li><a href="../zh-CN455854/index.html">如何在iOS 13中实现上下文菜单</a></li>
<li><a href="../zh-CN455856/index.html">nRF52832上的无线温度，湿度和大气压传感器</a></li>
<li><a href="../zh-CN455858/index.html">最小的有线电视网络。 第9部分：头端</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>