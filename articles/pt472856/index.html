<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüé® üê∞ üéóÔ∏è Como criei um servi√ßo de controle de qualidade a partir de mesas e paus üîí üê† üßöüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Freq√ºentemente, ao pensar em lan√ßar um piloto, os gerentes come√ßam a complicar a situa√ß√£o, a criar roteiros e a aguardar o MVP dos desenvolv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como criei um servi√ßo de controle de qualidade a partir de mesas e paus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/472856/">  Ol√° Habr!  Freq√ºentemente, ao pensar em lan√ßar um piloto, os gerentes come√ßam a complicar a situa√ß√£o, a criar roteiros e a aguardar o MVP dos desenvolvedores, em vez de tomar e testar a ideia por conta pr√≥pria.  Segundo o corte, quero compartilhar a hist√≥ria da cria√ß√£o de um servi√ßo de controle de qualidade com base nos formul√°rios do Google, VK e dezenas de linhas de c√≥digo, nas quais nenhum desenvolvedor ficou ferido, apenas 1 profissional de marketing. <br><br><img src="https://habrastorage.org/webt/z0/h1/0h/z0h10hxua4cagzjcovtbf5t8oja.png"><br><a name="habracut"></a><br><blockquote>  <b>Isen√ß√£o de responsabilidade</b> : neste artigo, estou aguardando exemplos de c√≥digo que lhe causar√£o perguntas, d√∫vidas, talvez at√© l√°grimas e cegueira sangrenta.  Como justificativa, h√° apenas uma coisa a ser dita - esse c√≥digo funcionou como o Papa Carlo e cumpriu sua miss√£o 100%, e alguns scripts ainda funcionam. </blockquote><h2>  Primeira classifica√ß√£o da Pizzaria Dodo </h2><br>  Um dos principais princ√≠pios de nossa empresa - <b>o que n√£o pode ser medido, n√£o existe</b> .  Existe pizza, o que significa que voc√™ precisa avaliar de alguma forma sua qualidade. <br><br>  Tudo come√ßou em 2013.  Naquela √©poca, havia 7 pizzarias na rede.  Ent√£o, em Dodo, eles decidiram lan√ßar um projeto para controlar a qualidade e os padr√µes dos produtos - uma classifica√ß√£o de pizzarias abertas a todos os parceiros. <br><br>  Ele parecia assim. <br><br><img src="https://habrastorage.org/webt/c9/rq/qj/c9rqqjnm6lxlqahi13lral5y7ni.png"><br><br>  Os dados foram retirados de liga√ß√µes de clientes, an√°lises no social.  redes e um pouco do Dodo IS (nosso sistema de informa√ß√£o). <br><br>  Uma vantagem √≥bvia na √©poca - a classifica√ß√£o come√ßou a levar as pizzarias que gerenciavam a trabalhar com qualidade para ficar no topo. <br><br><h2>  Second Mystery Shop Pizzarias </h2><br>  Cerca de um ano depois, percebemos que precis√°vamos avaliar o produto em si e adotamos o famoso modelo - ‚Äúcompradores misteriosos‚Äù.  Naquele momento, fizemos um grande avan√ßo - o primeiro na R√∫ssia decidiu que nossos clientes seriam os compradores misteriosos. <br><br><h4>  O surgimento de um grupo fechado VK </h4><br>  Inicialmente, descobrimos como eles trabalham com compradores misteriosos em ag√™ncias que fornecem esses servi√ßos.  Descobriu-se que eles se comunicam por e-mail ou ligam diretamente para oferecer verifica√ß√£o. <br><br>  Essa op√ß√£o n√£o nos seduziu imediatamente.  Definitivamente n√£o √≠amos telefonar, porque para n√≥s demorou muito tempo, mas para um cliente era doloroso e parecido com o spam.  O correio era usado para correspond√™ncia em massa, mas logo foram abandonados. <br><br>  N√≥s criamos: <br><br><ol><li>  Para comunica√ß√£o com agentes secretos e coordena√ß√£o de verifica√ß√µes, eles usaram a p√°gina usual em VK. </li><li>  Para coletar reportagens fotogr√°ficas, eles formaram um grupo na VK com uma parede aberta. </li><li>  E para pesquisas de servi√ßo, escolhemos os formul√°rios do Google.  O que?  Convenientemente, voc√™ n√£o precisa cortar um servi√ßo separado e ele √© bem exibido no celular. </li><li>  Todas as instru√ß√µes estavam no Google Docs. </li></ol><br>  Tudo est√° no joelho.  Tudo √© como deveria ser para uma startup. <br><br><img src="https://habrastorage.org/webt/0x/bu/2u/0xbu2ung5j6no9ltwyi_re80aqe.jpeg"><br>  <i>Foto de um cliente misterioso.</i>  <i>Sim, eles mediram a largura com uma r√©gua, cortaram a borda da pizza para mostrar o cozimento e a qualidade da massa.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Mais exemplos de reportagens fotogr√°ficas de 2015 est√£o aqui.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-v/fx/nh/-vfxnheu2wvm1gxfcc2epiwqyxw.jpeg"><br><img src="https://habrastorage.org/webt/zd/kk/d0/zdkkd0crvk0xqgdidv9roxanw_c.jpeg"><br><img src="https://habrastorage.org/webt/qk/co/fz/qkcofzsjt7iz2qm0czous0dw84o.jpeg"><br><img src="https://habrastorage.org/webt/ca/zq/5a/cazq5atxyea8vjvdtmprmwnstly.jpeg"><br></div></div><br>  A classifica√ß√£o mudava constantemente, novos crit√©rios de avalia√ß√£o foram adicionados.  Por exemplo, s√£o 131 pontos para avaliar a pizzaria Abakan-1. <br><br><img src="https://habrastorage.org/webt/x9/6c/lj/x96cljo2g-fkxgmsrbbqy8_bcxe.gif"><br><br>  Todo o processo foi que todas as viola√ß√µes nos pontos foram anotadas manualmente, sem automa√ß√£o.  E tudo isso foi feito por um funcion√°rio. <br><br><h4>  A m√°gica das planilhas do Google </h4><br>  Em 2016, aprendemos (amadurecemos) que a humanidade h√° muito tempo inventa outras fun√ß√µes al√©m de = SUM.  E o que pode ser feito usando scripts e fun√ß√µes de importa√ß√£o de dados entre tabelas ... Compila√ß√£o do Direct CRM. <br><br>  Por exemplo, avaliar cada pizzaria na tabela era uma folha, e nela crit√©rios e pontua√ß√µes de avalia√ß√£o.  1 pizzaria = 1 folha.  Quanto mais pizzarias, mais len√ß√≥is.  Toda semana um novo sinal.  Pressionando o bot√£o m√°gico, a folha de modelo na tabela foi expandida em 120 folhas.  Wah, que bom! <br><br><img src="https://habrastorage.org/webt/k-/s9/fv/k-s9fvqwy1wnaomulahpgn7a7no.gif"><br><br>  Esse est√°gio de automa√ß√£o ‚ÄúDodo Controlling‚Äù levou cerca de seis meses.  Mudamos passo a passo: aprendemos algo novo - implementado, aprendemos algo novo - introduzido novamente. <br><br><h2>  Limita√ß√£o como motor do progresso </h2><br>  Desde o in√≠cio, conversamos com compradores misteriosos em nome de uma conta pessoal na VK.  E ent√£o chegou o dia em que nos deparamos com problemas insol√∫veis de p√°ginas pessoais: <br><br><ul><li>  h√° um limite de 10.000 amigos; </li><li>  H√° um limite para o envio de mensagens: √†s vezes n√£o pod√≠amos enviar mensagens, porque a VK nos bloqueou com a frase ‚Äúvoc√™ enviou muitas mensagens, venha amanh√£‚Äù. </li></ul><br>  Normalmente, o VK bloqueava o envio de mensagens por volta das 16:00.  Foi um happy hour quando a equipe p√¥de descansar. <br><br>  Gradualmente, encontramos quase todas as limita√ß√µes do VK e quase conseguimos parar de amar este site.  Mas um milagre aconteceu, e o VK deu aos grupos a oportunidade de conectar widgets de mensagens, bots de bate-papo e outras vantagens. <br><br>  De fato, essa possibilidade era anterior a dezembro de 2016, mas com uma restri√ß√£o cr√≠tica para n√≥s: o grupo poderia responder √† mensagem apenas dentro de 10 dias a partir do momento em que a √∫ltima mensagem fosse enviada pelo cliente.  Quando eles removeram essa restri√ß√£o, a vida de nossa equipe come√ßou a brilhar com novas cores.  Desde ent√£o, come√ßamos o caminho da automa√ß√£o usando a API VK e as planilhas do Google. <br><br><h2>  Medo e √≥dio em um script de usu√°rio </h2><br>  Inicialmente, para se tornar um cliente misterioso, voc√™ precisava preencher um formul√°rio, depois se inscrever no grupo, escrever uma palavra-chave e aguardar a resposta.  Essa espera pode durar at√© 48 horas.  Foi indecentemente longo e o desejo de realizar verifica√ß√µes ap√≥s esse registro desapareceu. <br><br>  Com um novo reposit√≥rio de conhecimentos, decidimos automatizar o registro. <br><br>  T√≠nhamos v√°rios m√©todos de API, um formul√°rio, v√°rias dezenas de tabelas, uma landing page, um bot em PHP, scripts na tabela que foram escritos pelo mais legal comerciante Dodo e o primeiro CFO do Dodo em uma pessoa, dezenas de modelos de mensagens para diferentes situa√ß√µes.  Eu nem sabia que isso era chamado de script de usu√°rio: <br><br><ol><li>  O comprador misterioso preencheu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">question√°rio</a> (esta √© uma vers√£o desatualizada e agora n√£o funciona). </li><li>  Os dados do formul√°rio ca√≠ram primeiro no banco de dados e depois na tabela.  O bot primeiro bateu no banco de dados para verificar os dados sobre o perfil, porque o tempo limite de resposta da placa em dezenas de milhares de linhas era grande e o banco de dados o digeriu facilmente). </li><li>  Ap√≥s preencher o question√°rio no formul√°rio, uma mensagem apareceu na tela: "Obrigado, resta participar do grupo (link) e escreva a palavra de c√≥digo" Sherlock "". </li><li>  Em seguida, o comprador misterioso enviou um pedido para ingressar no grupo e escreveu a palavra de c√≥digo "Sherlock".  A palavra foi o gatilho para executar o script de valida√ß√£o: <br>  - foi enviada uma solicita√ß√£o ao banco de dados se o agente √© adequado para n√≥s por idade; <br>  - nesse caso, a pessoa foi adicionada aos grupos e, na tabela ao lado do question√°rio do candidato, foi colocado o status ‚Äúok / n√£o ok‚Äù; <br>  - Mais dados foram pintados na cor turquesa e isso foi importante.  Ent√£o, com meus olhos, era mais f√°cil entender quem nos conv√©m e com quem podemos falar.  O script pintou perfis inadequados em vermelho; <br>  - Al√©m disso, o comprador secreto foi aceito automaticamente no grupo e uma mensagem foi enviada ao bate-papo com mais etapas e instru√ß√µes. </li></ol><br><img src="https://habrastorage.org/webt/so/ty/se/sotysezhht_urug1ax9cnrvc9-g.png"><br><br>  Essa √© a automa√ß√£o do registro.  Agora, todo o procedimento tornou-se quase simples e compreens√≠vel. <br><br>  Al√©m disso, tudo correu como um rel√≥gio.  Ficou claro que podemos enviar mensagens por meio de tabelas diretamente para o PM para agentes secretos por meio de mensagens em grupo. <br><br><img src="https://habrastorage.org/webt/zn/px/nd/znpxndqiyuxkqp0y6mnhov7fooc.gif"><br><br>  E voc√™ tinha 46 linhas de c√≥digo! <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = SpreadsheetApp.getActiveSpreadsheet().getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = range.getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iarray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>).getValues(); ss.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = range.getRowIndex(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> check = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'L'</span></span> + add).getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (check != <span class="hljs-string"><span class="hljs-string">''</span></span>) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'K'</span></span> + add).setValue(<span class="hljs-string"><span class="hljs-string">""</span></span>).setBackground(<span class="hljs-string"><span class="hljs-string">"#ffff00"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-string"><span class="hljs-string">"message"</span></span> : marray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.74"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload, "muteHttpExceptions" : true, }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.send", options).getContentText()); if (jsonData['error'] != undefined) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange('K' + add).setValue("").setBackground("#ff0000"); } Logger.log(jsonData); var log = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Log'); var int = log.getRange('A1').getValue(); var d = new Date(); log.getRange('B' + int).setValue(d); log.getRange('C' + int).setValue(r[0] + ""); log.getRange('A1').setValue(int + 1); Utilities.sleep(400); }); }</span></span></code> </pre> <br>  Nas tabelas, geramos o texto das mensagens e fizemos correspond√™ncias personalizadas usando a p√°gina de identifica√ß√£o.  Tamb√©m paramos de copiar e enviar mensagens manualmente.  Nos hor√°rios de pico, poder√≠amos enviar at√© 3000 mensagens em 45 minutos usando tabelas.  Se o fiz√©ssemos manualmente, eu n√£o escreveria este artigo, mas continuaria a enviar mensagens. <br><br>  A seguir, dou um exemplo de uma t√°bua milagrosa.  Eu tentei muito criar um UX / UI claro e funcional.  Ao clicar no bot√£o vermelho, uma lista de discuss√£o foi lan√ßada com uma proposta para realizar uma verifica√ß√£o secreta. <br><br><img src="https://habrastorage.org/webt/ht/be/ix/htbeixa27tdtlix28xnzhsmh6xg.png"><br><br><h2>  Mais recursos para automatizar processos infernais </h2><br>  A empresa possui muitos formul√°rios do Google que nos ajudam a coletar algumas m√©tricas de pizzarias continuamente.  Cada formul√°rio possui uma lista de pizzarias que precisam ser atualizadas.  Existem 53 formul√°rios no total, cada um deles atualizado anteriormente manualmente. <br><br>  Um pouco cansados ‚Äã‚Äãdesse trabalho, percebemos que esse neg√≥cio poderia ser automatizado.  Voltei a procurar nosso profissional de marketing, depois de uma ou duas horas tudo estava pronto e apenas 47 linhas de c√≥digo. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forms = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ranges = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).getValues(); forms.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> form = FormApp.openById(forms[i]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sources[i]).getRange(ranges[i]).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = []; values.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el,ei</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (el[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">''</span></span>) { arr.push(el[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = form.getItems()[<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(items[i])].asListItem(); item.setChoiceValues(arr); Logger.log(item.getTitle()); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getSheetByName(<span class="hljs-string"><span class="hljs-string">"    "</span></span>).getRange(<span class="hljs-string"><span class="hljs-string">"A2:C"</span></span>).getValues(); Logger.log(range); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = SpreadsheetApp.getUi(); <span class="hljs-comment"><span class="hljs-comment">// Or DocumentApp or FormApp. ui.createMenu('Custom Menu') .addItem('Change', 'myFunction') .addToUi(); } function update() { var ss = SpreadsheetApp.getActiveSpreadsheet(); var range = ss.getSheetByName(" ").getRange("A2:A"); range.activate(); myFunction(); } function createTimeDrivenTriggers() { ScriptApp.newTrigger('update').timeBased().everyDays(1).create(); }</span></span></code> </pre><br>  Os formul√°rios s√£o diferentes, com diferentes listas de pizzarias e o local da lista de pizzarias no formul√°rio.  Em algum lugar precisamos de estrangeiros, em algum lugar da R√∫ssia. <br><br><img src="https://habrastorage.org/webt/wq/h8/g2/wqh8g2jyt3gmwqopaicz4h2u_h8.png"><br><br>  As colunas B e C informam ao script em qual formul√°rio atualizar e em que local o formul√°rio exibe a lista.  E as colunas D e E, de qual planilha e intervalo voc√™ precisa obter a lista para atualiza√ß√£o. <br><br>  Em seguida, eles acionaram o script para executar o script uma vez por dia e, assim, foram capazes de derrotar o inferno do processo de atualiza√ß√£o de formul√°rios primeiro para o departamento e depois para toda a empresa.  Este script ainda funciona. <br><br><h2>  O caso mais dif√≠cil sobre um caracol </h2><br>  Uma vez quisemos receber grava√ß√µes de √°udio das verifica√ß√µes de entrega. <br><br>  De onde veio a grava√ß√£o de √°udio: compradores misteriosos gravaram a reuni√£o do correio com o cliente como uma mensagem de √°udio no VK.  Normalmente, s√£o 10 a 15 segundos de grava√ß√£o de √°udio. <br><br>  Como os conseguimos: eles pegaram as √∫ltimas 20 mensagens no endere√ßo VK do comprador misterioso, procuraram a palavra "Ulica" entre eles, depois recuaram uma mensagem e pegaram o link para a grava√ß√£o de √°udio.  (Spoiler: n√£o √© a melhor palavra, geralmente eles nos escrevem a palavra "Snail"). <br><br>  J√° existem mais linhas de c√≥digo, prepare-se. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastAudio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange().getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = ss.getActiveRange().getRowIndex(); range.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ri = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cuid = r[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ci = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload1 = { <span class="hljs-string"><span class="hljs-string">"q"</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'peer_id'</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : token, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.73"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options1 = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload1, "muteHttpExceptions" : true }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.search", options1).getContentText()); Logger.log(jsonData); if (jsonData['response']['items'] == undefined) { ss.getRange("B" + ri).setValue(' ').setBackground('#f00'); return; } var cmid = jsonData['response']['items'][0]['id']; var date = new Date((jsonData['response']['items'][0]['date']*1000)); var fdate = Utilities.formatDate(date, "GMT+3", "dd-MM-yyyy HH:mm:ss"); ss.getRange("B" + ri).setValue(fdate); var payload2 = { "user_id" : cuid, "count" : '20', "access_token" : token, "v" : "5.73", }; var options2 = { //   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload2, "muteHttpExceptions" : true }; var jsonData2 = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.getHistory", options2).getContentText()); Logger.log(jsonData2); jsonData2['response']['items'].forEach(function (r,i) { if (r['id'] == cmid) { ci = i + 1; Logger.log(jsonData2['response']['items'][ci]); if (jsonData2['response']['items'][ci] == undefined) { ss.getRange("C" + ri).setValue(" "); } else { if (jsonData2['response']['items'][ci] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc']['url'] != undefined) { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['attachments'][0]['doc']['url']); } else { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['body']); } } } }); }); }</span></span></code> </pre><br><h2>  As planilhas do Google n√£o s√£o flex√≠veis, mas eu sou um codificador </h2><br>  Ent√£o, tudo estava girando e girando, at√© que crescemos at√© 60 mil compradores misteriosos no in√≠cio de 2018. <br><br>  Portanto, j√° enfrentamos restri√ß√µes de tabela.  Ent√£o, uma tabela n√£o pode conter mais de 2 milh√µes de c√©lulas e usamos 1,6 milh√£o de c√©lulas em um dos r√≥tulos de departamento mais ocupados, dos quais 135 mil c√©lulas tinham todos os tipos de fun√ß√µes da tabela. <br><br>  Tal back-end.  Tudo desacelerou terrivelmente e, quando v√°rias pessoas trabalharam juntas, o prato cedeu "O documento √© popular demais, volte mais tarde". <br><br>  Ent√£o ficou claro que eu sou um codificador ruim, o sistema n√£o ret√©m a carga e preciso ser substitu√≠do. <br><br><h2>  E ent√£o o verdadeiro desenvolvedor veio ... </h2><br>  Mas esta √© uma hist√≥ria completamente diferente e iremos escrever sobre isso mais tarde.  Espero que esses exemplos ajudem os gerentes em seus projetos, onde existem muitos processos infernais.  Os processos podem e devem ser automatizados, as tabelas e o zapier (tamb√©m o usamos) podem ajudar e, se houver recursos, n√£o havia solu√ß√µes dom√©sticas no come√ßo. <br><br>  Se voc√™ tem uma pessoa na empresa que sabe algo sobre scripts, ela √© adequada para organizar processos infernais em tablets.  Se voc√™ quiser aprender algo assim, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Telegram</a> tem um excelente canal para isso, do qual peguei informa√ß√µes sobre fun√ß√µes e scripts. <br><br>  Bem, masthead para todos os gerentes - conhecer as tabelas todos os dias economiza tempo ao trabalhar com dados e permite que voc√™ pense e entenda pelo menos um pouco o que o desenvolvedor faz com os dados e o que voc√™ pode fazer com os dados em geral. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472856/">https://habr.com/ru/post/pt472856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472840/index.html">Armazenamento definido por software ou o que matou os dinossauros?</a></li>
<li><a href="../pt472848/index.html">Reflex√µes sobre uma carreira em TI</a></li>
<li><a href="../pt472850/index.html">Profiss√£o ou vida: ganhe um curso de netologia se n√£o tiver medo</a></li>
<li><a href="../pt472852/index.html">O GitLab faz altera√ß√µes para usu√°rios de produtos comerciais e em nuvem</a></li>
<li><a href="../pt472854/index.html">Cria√ß√£o de perfil de interface de usu√°rio do Unity: quem estraga meus lotes?</a></li>
<li><a href="../pt472858/index.html">Python e clientes HTTP r√°pidos</a></li>
<li><a href="../pt472862/index.html">Invalida√ß√£o de cache em cascata. Parte 2</a></li>
<li><a href="../pt472864/index.html">Check Point: otimiza√ß√£o de CPU e RAM</a></li>
<li><a href="../pt472866/index.html">Talism√£ para comunica√ß√£o est√°vel</a></li>
<li><a href="../pt472870/index.html">Por que o Agile fica parado sem transformar as ferramentas de arquitetura e desenvolvimento - apresenta√ß√£o da confer√™ncia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>