<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♑️ 😼 👩🏼‍🎓 OceanLotus：新后门，旧方案 🤸🏻 😦 🙍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OceanLotus小组（又名APT32和APT-C-00）以其在东亚的袭击而闻名。 去年，发表了有关该小组工作的许多研究报告，包括Cyber​​Reason文件， FireEye评论以及对Volexity的水坑攻击的描述 。 我们可以看到，该小组更新了后门，基础设施和感染媒介。 

 OceanL...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OceanLotus：新后门，旧方案</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/421779/">  OceanLotus小组（又名APT32和APT-C-00）以其在东亚的袭击而闻名。 去年，发表了有关该小组工作的许多研究报告，包括<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cyber​​Reason</a>文件， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FireEye</a>评论以及对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Volexity</a>的水坑攻击的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">描述</a> 。 我们可以看到，该小组更新了后门，基础设施和感染媒介。 <br><br>  OceanLotus继续瞄准东亚的公司和政府机构。 根据ESET遥测技术，OceanLotus的优先目标是越南，老挝，柬埔寨和菲律宾。 <br><br> 几个月前，我们发现并分析了他们的最新后门之一。 它实现了一些难以分析和避免检测的工具-我们将在帖子中进行讨论。 <br><br><img src="https://habrastorage.org/webt/4f/mf/dz/4fmfdzgqiqskqku5rz7eeprycti.jpeg"><br><br><a name="habracut"></a><h2> 经销 </h2><br> 攻击者使用不同的方法说服受害者启动恶意投递器。 <br><br><h3> 双重扩展名和虚假的应用程序图标（Word，PDF等） </h3><br> 滴管很可能通过电子邮件附件传播。 我们观察到以下文件名： <br>  <code>Mi17 Technical issues - Phonesack Grp.exe</code> （Mi-17-俄罗斯直升机模型） <br>  <code>Chi tiet don khieu nai gui saigontel.exe</code> （越南语翻译-“索赔细节发送给Saigontel”，Saigontel-越南电信公司） <br>  - <code>Updated AF MOD contract - Jan 2018.exe</code> <br>  <code>remove_pw_Reschedule of CISD Regular Meeting.exe</code> <br>  <code>Sorchornor_with_PM_-_Sep_2017.exe</code> <br>  <code>20170905-Evaluation Table.xls.exe</code> <br>  <code>CV_LeHoangThing.doc.exe</code> （加拿大也有假简历） <br><br> 所有这些文件都有一个共同点-启动受密码保护的诱饵文档。 目前尚不清楚密码是否包含在已发送信件的数据中，或者是否应该打开文档。 <br><br><h3> 假安装程序 </h3><br> 在水坑运动中发现了一些冒充安装程序或软件更新的假安装程序。 一个例子是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Freebuf</a>上360 Labs描述的重新包装的Firefox安装程序。 <br><br> 我们看到的另一个示例称为<code>RobototFontUpdate.exe</code> 。 它可能通过受感染的站点传播，但是我们没有足够的证据。 <br><br> 所有描述的文件，无论是通过邮件分发还是在访问受感染站点时下载，都传递了相同的后门组件。 在一篇<code>RobototFontUpdate.exe</code> ，我们将分析<code>RobototFontUpdate.exe</code>的示例，并展示其如何在系统上执行恶意负载。 <br><br><h2> 技术分析 </h2><br> 安装和执行过程取决于多层混淆，即组件加密，PE文件的重构，shellcode加载和侧加载技术。 后者在ESET <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">先前的Korplug研究中</a>有所描述。 <br><br><h3> 进度审查 </h3><br> 攻击由两部分组成：滴管和运载火箭。 过程的每个部分的每个步骤将在相应的部分中详细说明。 下面的两个图表简要介绍了恶意软件的总体进度。 <br><br><img src="https://habrastorage.org/webt/yn/wa/jd/ynwajd8empdclmahz0mzaarmpxk.png"><br>  <i>图1.滴管的进度</i> <br><br><img src="https://habrastorage.org/webt/gv/ba/jb/gvbajbzaqzd6tmrjpj95nkov-j8.png"><br>  <i>图2.后门进度</i> <br><br> 几乎所有这些组件都被混淆了。 模糊处理基于互补条件对转换命令。 对于每种形式：JZ / JNZ，JP / JNP，JO / JNO等，每对都执行向同一目标的过渡。 该序列中插入了使用堆栈指针但不更改条件标志值的垃圾代码。 事实证明，过渡发生在同一分支内。 由于使用正堆栈指针值，这会在反编译过程中导致问题。 <br><br><img src="https://habrastorage.org/webt/lh/y6/an/lhy6anvm_1feplhj7depx1udiiu.png"><br>  <i>图3.互补条件转换</i> <br><br> 此外，程序的某些基本元素向堆栈添加一个地址，之后它们以JMP / CALL结尾，而其他基本元素添加两个地址并以RET命令结尾。 第二项添加是被调用的函数，第一项是将进行转换的下一个基本程序元素的地址。 因此，程序的基本元素是在没有父对象的情况下创建的。 <br><br><img src="https://habrastorage.org/webt/jc/5j/dw/jc5jdw3rbtwezkp4ylemfursggw.png"><br>  <i>图4. PUSH / JMP技术</i> <br><br> 通过两种混淆技术的组合，获得了“美丽”的图形： <br><br><img src="https://habrastorage.org/webt/3l/pe/3x/3lpe3x_ccjdkh9rm0rpxyykztf0.png"><br>  <i>图5.混淆运行顺序</i> <br><br> 注意垃圾代码非常简单。 如果您知道应用方案，可以在样本分析中将其忽略。 <br><br><h2> 滴管 </h2><br><h3> 步骤1.诱饵文件 </h3><br> 最近几个月，OceanLotus使用了几种诱饵。 其中之一是用于更新<code>Roboto Slab regular</code> TrueType字体的伪造软件。 选择字体似乎有些奇怪，因为它不支持许多东亚语言。 <br><br><img src="https://habrastorage.org/webt/2p/p8/sm/2pp8sm8gjt15kzqakmyooah1pk8.jpeg"><br>  <i>图6. RobototFontUpdate字体更新图标</i> <br><br> 当执行时，二进制文件解密其资源（XOR，128字节，硬编码密钥）并恢复解密的数据（LZMA）。 合法的RobotoSlab-Regular.ttf文件 <br><br>  （SHA1： <code>912895e6bb9e05af3a1e58a1da417e992a71a324</code> ）写入<code>%temp%</code>文件夹，并使用Win32 API <code>ShellExecute</code>函数启动。 <br><br> 执行从资源解密的外壳代码。 执行后，伪造的字体更新将实现另一个应用程序，该应用程序的唯一目的是删除滴管。 此擦除应用程序<code>%temp%\[0-9].tmp.exe</code>为<code>%temp%\[0-9].tmp.exe</code> 。 <br><br><h3> 阶段2. Shell代码 </h3><br> 在每个阶段，使用相同的shellcode。 <br><br>  Shellcode是自定义的PE加载程序。 它将可执行文件还原到内存中-解密所有部分并计算必要的移动和其他缩进。  <code>RtlMoveMemory</code>使用Windows API的三个功能： <code>VirtualAlloc</code> ， <code>RtlMoveMemory</code>和<code>RtlZeroMemory</code> 。 <br><br>  <code>RtlZeroMemory</code>函数用于<code>RtlZeroMemory</code> PE标头中的字段<code>RtlZeroMemory</code> 。 依靠自动内存转储将失败，因为MZ / PE标头已损坏。 <br> 外壳程序代码调用解密的PE登录函数，然后<code>DLLEntry</code>导出<code>DLLEntry</code> 。 <br><br><h3> 第三阶段。真正的滴管 </h3><br> <code>{103004A5-829C-418E-ACE9-A7615D30E125}.dll</code> <br> 此可执行文件通过Windows API在CBC模式下使用AES算法解密资源。 硬编码密钥的大小为256位。 解密后，将压缩的数据解压缩（LZMA算法）。 <br><br> 如果以管理员权限启动该过程，则恶意软件会通过创建服务来提供持久性。 否则，将使用经典的“运行”注册表项（ <code>HKCU\SOFTWARE\Microsoft\ Windows\CurrentVersion\Run;DeviceAssociationService;rastlsc.exe</code> ）。 <br><br> 如果使用管理员权限执行了删除程序代码，它将尝试将以下列出的文件写入文件夹<code>C:\Program Files\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> ，如果没有，则将它们写入<code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code>文件夹<code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> ： <br><br>  <code>rastlsc.exe</code> （SHA1： <code>2616da1697f7c764ee7fb558887a6a3279861fac</code> ，合法应用程序Symantec Network Access Control的<code>dot1xtra.exe</code> ） <br>  <code>SyLog.bin</code> （SHA1： <code>5689448b4b6260ec9c35f129df8b8f2622c66a45</code> ，加密后门） <br>  <code>rastls.dll</code> （SHA1： <code>82e579bd49d69845133c9aa8585f8bd26736437b</code> ， <code>rastlsc.exe</code>的恶意DLL） <br><br> 路径因样本而异，但布局相似。 根据权限，恶意软件会将文件转储到<code>%ProgramFiles%</code>或<code>%appdata%</code> 。 我们还观察到： <br><br>  - <code>\Symantec\CNG Key Isolation\</code> <br>  - <code>\Symantec\Connected User Experiences and Telemetry\</code> <br>  - <code>\Symantec\DevQuery Background Discovery Broker Tasks\</code> <br><br> 这些路径由各种Symantec产品使用。 <br><br> 在实现持久性并将可执行文件实现为合法文件之后， <br>  <code>rastlsc.exe</code>是使用<code>CreateProcessW</code>执行的。 <br><br> 我们还观察到了使用<code>krv</code>参数执行<code>rastlsc.exe</code>的版本（ <code>{BB7BDEC9-B59D-492E-A4AF-4C7B1C9E646B}.dll</code> ）。 我们将在下面更详细地讨论。 <br><br><h2> 后门组件：rastlsc.exe填充 </h2><br>  OceanLotus团队在Symantec产品可执行文件之一中使用了一种古老而著名的技术。 最重要的是使用通过将恶意库写入同一文件夹来加载合法和签名的.exe文件的库的过程。 这将使恶意行为看起来合法，因为在受信任的可执行文件运行时执行了这些操作。 <br><br> 如上所述，将重置并执行合法的<code>rastlsc.exe</code>文件。 <br> 它导入<code>rastls.dll</code>文件，在这种情况下，该文件包含恶意内容。 <br><br><img src="https://habrastorage.org/webt/jy/ga/ax/jygaaxccovxfilcmjrol9rmoklu.jpeg"><br>  <i>图7.来自Symantec的经过数字签名的rastlsc.exe</i> <br><br> 我们还看到使用其他合法且经过签名的可执行文件进行填充，其中包括McAfee的<code>mcoemcpy.exe</code> ，该文件加载了<code>McUtil.dll</code> 。  PlugX以前使用了此技术，引起了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">越南CERT</a> （越南语）的注意。 <br><br><h3> 阶段1.填充库rastls.dll </h3><br>  dll文件的内部名称是<code>{7032F494-0562-4422-9C39-14230E095C52}.dll</code> ，但是我们看到了其他版本，例如<code>{5248F13C-85F0-42DF-860D-1723EEAA4F90}.dll</code> 。 所有导出的函数导致执行相同的函数。 <br><br><img src="https://habrastorage.org/webt/hg/1h/qm/hg1hqmssbsek8-kl8e7dkbzsotq.jpeg"><br>  <i>图8.所有rasltls.dll导出都导致一个函数</i> <br><br> 导出尝试读取位于同一文件夹中的<code>SyLog.bin</code>文件。 其他版本试图打开<code>OUTLFLTR.DAT</code>文件。 如果文件存在，则将使用CBC模式下的AES算法使用硬编码的256位密钥对其进行解密，然后将接收到的压缩数据解压缩（LZMA压缩）。 <br><br>  <code>McUtil.dll</code>变体使用另一种技术。 乍看之下，main函数没有任何恶意作用，但实际上它替代了合法文件<code>mcoemcpy.exe</code> （二进制文件）的<code>.text</code>部分。 它生成一个shellcode，其任务是调用一个函数以从<code>mcscentr.adf</code>文件中读取第二阶段的加密shellcode。 <br><br> 以下伪代码用于创建外壳代码： <br><br> <code>x = False i = 0 <br> buff = genRandom() <br> opc1 = [0x58,0x59,0x5a,0x5b] <br> opc2 = [0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57] <br> opc3 = [0x90,0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48, <br> 0x49,0x4a,0x4b] <br> while i &lt; len(buff): <br> currentChar = buff[i] if currentChar &lt; 0xc8: <br> buff[i] = opc1[currentChar % len(opc1)] <br> else: <br> if x: <br> buff[i] = opc2[currentChar % len(opc2)] <br> else: <br> buff[i] = opc3[currentChar % len(opc3)] x = x == False <br> i+=1</code> <br> <br> 在该图的下面，您可以看到汇编器结果的列表： <br><br><img src="https://habrastorage.org/webt/i8/4y/gg/i84yggcraq46pahxx_g5gzha4_y.png"><br>  <i>图9.生成的shellcode</i> <br><br><h3> 步骤2-4。 再次使用Shellcode，启动器和Shellcode </h3><br>  <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code>解密并下载<code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code>库。 该库将加载资源并尝试启动DeviceAssociationService服务。 解密的信息还包含一个shellcode。 后者解密最后阶段：后门。 <br><br> 变体<code>{92BA1818-0119-4F79-874E-E3BF79C355B8}.dll</code>检查<code>rastlsc.exe</code>以<code>krv</code>作为第一个参数执行。 如果是这样，将创建一个任务，并再次执行<code>rastlsc.exe</code> ，但不带此参数。 <br><br><h3> 阶段5。后门 </h3><br> <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> <br> <br> 首先，恶意软件尝试下载其资源并使用RC4算法对其进行解密。 产生的资源包含用于配置后门的数据。 配置格式并不难找到。 使用Kaitai结构及其结构阻尼器，我们得到以下信息： <br><br><img src="https://habrastorage.org/webt/wv/sq/7r/wvsq7r5rn67px5msvrjogbnoelk.jpeg"><br>  <i>图10.配置结构</i> <br><br>  <b>注意</b> ：除了domain_encoding_str行和httpprov库之外，数据在示例之间有所不同。 注册表项几乎相同，但是它们具有类似的方案： <code>\HKCU\SOFTWARE\Classes\AppX[a-f0-9]{32}</code> ，没什么特别的。 <br><br> 恶意程序会接收用户名（UTF-16）的前10个字节，并使用UTF-16中的三个字母的字符串<code>mutex_encoding_str</code>进行编码，并以十六进制对其进行编码。 结果用作互斥锁的名称。 例如，对于一个名称以<code>abc</code>开头且密钥为<code>vwx</code> ，该互斥锁将为<code>\Sessions\1\BaseNamedObjects\170015001b</code> 。 <br><br> 后门包括一个PE加载器，该加载器将<code>HTTPProv.dll</code>库加载到内存中，调用入口点，然后调用<code>CreateInstance</code>导出函数。 <br><br><h3> 沟通交流 </h3><br> 后门通过端口<code>25123</code>使用标准TCP通信协议。 要获取服务器IP地址，后门首先创建一个特定的DNS查询。 <br><br> 恶意程序从配置中选择三个域之一，并添加一个使用两个值生成的特殊子域。 第一个值是长度为16个字节的计算机名称。 第二个是四字节的版本ID。 以下Python 2代码是一种编码算法： <br><br> <code>letters=domain_encoding_str # “ghijklmnop” hex_pc_name=pc_name.encode(“UTF-16LE”).encode(“hex”) s='' <br> for c in hex_pc_name: <br> if 0x2f &lt; ord(c) &lt; 0x3a: <br> s+=letters[ord(c) - 0x30] <br> else: <br> s+=c</code> <br> <br> 例如，如果计算机名称为<code>random-pc</code> ，并且版本ID为0x0a841523，则将生成以下域： <br> <code>niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.dwarduong[.]com</code> <br> <br> 以下正则表达式可用于标记此后门的C＆C服务器： <br> <code>[ghijklmnopabcdef]{4-60}\.[ghijklmnopabcdef]{8}\.[az]+\.[az]+</code> <br> <br> 如果IP地址属于特定域，则恶意软件尝试通过端口<code>25123</code>建立TCP连接。 每个样本都有三个用于查找C＆C服务器的不同域名。 <br><br> 通信过程通过RC4加密，并使用LZMA压缩。 由于密钥已添加到数据包的开头，因此可以解密流量。 格式如下： <br> <code>[ RC4 (4 )][ ]</code> <br> <br> 每个密钥字节由<code>rand</code>函数生成。 解密和解包数据包后，数据具有以下格式： <br> <code>[dw:][dw:][dw: ][dw: ][dw:] [dw:]</code> <br> <br> 客户端第一次连接到服务器时，将传输UUID，用作会话标识符。 后者作为二进制数据存储在注册表项中： <code>HKCU\SOFTWARE\Classes\ AppXc52346ec40fb4061ad96be0e6cb7d16a\DefaultIcon</code> <br><br> 如前所述，后门还包含一个名为<code>HTTPprov</code>的库。 它用作与服务器通信的替代方法。  DLL文件通过HTTP发送POST请求。 它还使用SOCKS5，SOCKS4a和SOCKS4支持HTTPS和代理。 该库与<code>libcurl</code>静态链接。 <br><br> 初始化之后，将创建一个注册表项-后门命令，以进一步使用HTTP与命令服务器进行通信： <code>HKCU\SOFTWARE\Classes\ CLSID{E3517E26-8E93-458D-A6DF-8030BC80528B}</code> 。 <br><br> 使用标准的客户端应用程序： <code>Mozilla/4.0 ( ; MSIE 8.0; Windows NT 6.0; Trident/4.0)</code> 。 <br><br> 该库的主要特征是针对通用资源标识符的特殊加密算法。  URI的资源部分是使用以下伪代码创建的： <br><br> <code>buffEnd = ((DWORD)genRand(4) % 20) + 10 + buff; while (buff &lt; buffEnd){ <br> b=genRand(16); <br> if (b[0] - 0x50 &gt; 0x50) <br> t=0; <br> else <br> *buf++= UPPER(vowels[b[1] % 5]); <br> v=consonants[b[1]%21]); if (!t) <br> v=UPPER(v); <br> *buff++= v; <br> if (v!='h' &amp;&amp; b[2] - 0x50 &lt; 0x50) <br> *buff++= 'h'; <br> *buff++= vowels[b[4] % 5]; <br> if (b[5] &lt; 0x60) <br> *buff++= vowels[b[6] % 5]; <br> *buff++= consonants[b[7] % 21]; <br> if (b[8] &lt; 0x50) <br> *buff++= vowels[b[9] % 5]; <br> *buff++= '-'; <br> }; <br> *buff='\0';</code> <br> <br>  <b>注意</b> ：为清楚起见，负责检查字符串长度的部分已从代码中删除。 <br><br> 为了从生成的字符串中获取标识符，使用特殊的总和验证算法将两个数字相加： <br><br> <code>checksum=crc32(buff) <br> num2=(checksum &gt;&gt; 16) + (checksum &amp; 0xffff) * 2 <br> num1=(num2 ^ 1) &amp; 0xf <br> URL=GENERATED_DOMAIN+ “/” + num1 + “/” + num2 + “-” + buff</code> <br> <br> 添加<code>HTTPprov</code>库URI生成器，我们得到以下URL： <br> <code>hXXp://niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.aisicoin[.]com/ 13/139756-Ses-Ufali-L</code> <br> <br><h3> 队伍 </h3><br> 收到SESSIONID会话标识符后，后门将制作系统指纹。 该程序包的构造如下（在程序包中缩进-说明）： <br><br>  <i>0x000-</i>字节：每个版本中的值都会更改 <br>  <i>0x001-0x01</i> ：硬编码字节 <br>  <i>0x002-</i>布尔值：特权提升 <br>  <i>0x003</i> -dword：版本ID <br>  <i>0x007-</i>字符串（UTF-16），计算机名称（最大0x20） <br>  <i>0x027-</i>字符串（UTF-16），用户名 <br>  <i>0x079</i> - <code>HKLM\SOFTWARE\Microsoft\Windows NT\ CurrentVersion</code>值中的注册表查询的结果： <code>ProductName</code> ， <code>CSDVersion</code> ， <code>CurrentVersion</code> ， <code>ReleaseId</code> ， <code>CurrentBuildNumber</code>和调用<code>IsWow64Process (x86|x64)</code>的结果<code>IsWow64Process (x86|x64)</code> <br>  <i>0x179-</i>字符串％s（％s）的后续格式； 替换为（ <code>GetVolumeInformationW:VolumeNameBuffer</code> ）， <code>VolumePathNames</code> <br>  <i>0x279-</i>物理磁盘，PhysicalDrive设备的I / O控制IOControl 0x2D1400（IOCTL_STORAGE_QUERY_ PROPERTY）（VolSerialNumber） <br>  <i>0x379</i> - <code>SELECT SerialNumber FROM Win32_BaseBoard</code> <br>  <i>0x3f9-</i>获取当前日期和时间GetSystemTimeAsFileTime <br>  <i>0x400-</i>布尔值：未知 <br>  <i>0x401</i> -dword：解密资源后收到 <br><br> 这是系统指纹的示例： <br><br><img src="https://habrastorage.org/webt/s5/kg/rj/s5kgrj1nop52oeuj-xgop8c7zsa.jpeg"><br>  <i>图11.系统指纹</i> <br><br> 这是一个功能齐全的后门，它为操作员提供了许多功能：操纵文件，注册表和进程，下载其他组件，获取系统的数字指纹。 以下是受支持的命令的编号和说明： <br><br>  0-数字指纹 <br>  1-设置会话ID <br>  2-创建过程并获得结果（使用程序通道） <br>  3-设置连接尝试次数 <br>  4-推迟轮询时间 <br>  5-读取文件或注册表项并考虑MD5 <br>  6-创建流程 <br>  7-在内存中创建文件，注册表项或流 <br>  8-写入注册表 <br>  9-轮询注册表 <br>  10-在系统中搜索文件 <br>  11-将文件传输到另一个目录 <br>  12-从磁盘删除文件 <br>  13-使用功能获取系统中标记的磁盘的列表 <br> <code>GetLogicalDriveStringW</code> <br>  14-创建目录 <br>  15-删除目录 <br>  16-从偏移量读取文件 <br>  17-调用PE加载程序（切换为通过<code>HTTPprov</code>进行通信） <br>  18-[未知] <br>  19-0：轮询注册表中的值；  1：方案实施与实施 <br>  20-设置环境变量 <br>  21-在新线程中启动shellcode <br>  22-返回环境变量 <br> 新版本中的23-如果APPL环境变量不存在，则会自行重启 <br><br><h2> 结论 </h2><br>  OceanLotus保持高度活跃，并继续更新工具包。 <br> 该组织试图隐瞒其活动，为此，攻击者会仔细选择受害者，限制恶意软件的传播，使用多台服务器，以免引起对同一域或IP地址的注意。 尽管实现了组件的解密以及侧加载技术的广泛普及，但由于在这种情况下攻击者的工作被伪装成合法的应用程序，因此可以避免检测。 <br><br><h2> 危害指标（IoC） </h2><br><h3> 样品 </h3><br><h4> 表1：滴管 </h4><br><img src="https://habrastorage.org/webt/4z/vz/kh/4zvzkhbbyci_fp6w6jyedbpn42i.png"><br><br><h4> 表2：库 </h4><br><img src="https://habrastorage.org/webt/0g/9i/2r/0g9i2rys-bufj_lmi9xqb7orl3g.png"><br><br><h3> 联播网 </h3><br><h4>  IP地址 </h4><br> <code>46.183.220.81 <br> 46.183.220.82 <br> 46.183.222.82 <br> 46.183.222.83 <br> 46.183.222.84 <br> 46.183.223.106 <br> 46.183.223.107 <br> 74.121.190.130 <br> 74.121.190.150 <br> 79.143.87.230</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421779/">https://habr.com/ru/post/zh-CN421779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421765/index.html">生产中的Web应用程序是什么？</a></li>
<li><a href="../zh-CN421767/index.html">提供矿工自雇身份</a></li>
<li><a href="../zh-CN421769/index.html">《深度学习R》一书</a></li>
<li><a href="../zh-CN421773/index.html">作为一个技术专家团队创建了他们的公司，第3季（最终飞行！）</a></li>
<li><a href="../zh-CN421775/index.html">神经网络经过训练可以通过无语境的人的任意语音来识别抑郁症</a></li>
<li><a href="../zh-CN421783/index.html">Fun State Management Huex框架</a></li>
<li><a href="../zh-CN421785/index.html">加利福尼亚即将完全拒绝能源生产中的碳排放</a></li>
<li><a href="../zh-CN421787/index.html">项目架构开发，船舶和JavaScript</a></li>
<li><a href="../zh-CN421789/index.html">再次使前端成为“后端”</a></li>
<li><a href="../zh-CN421791/index.html">人工智能的伦理问题</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>