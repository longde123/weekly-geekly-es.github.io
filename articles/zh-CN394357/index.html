<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💄 🧙🏾 🧑🏿‍🤝‍🧑🏼 将Digital Lab NR05链接到物联网 ↖️ 👨🏻‍🎓 🤸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我们将展示如何基于数字实验室套件NR05，组装一种从温度传感器收集数据并将其发送到专门站点以存储和处理此类数据的设备。
 
 正如我们反复指出的那样，“电子工程师”字母表中的“数字实验室”工具包不仅旨在教授微控制器编程的原理并基于这些原理设计电子设备，而且还旨在创建完全完成且有用的设备。在...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>将Digital Lab NR05链接到物联网</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/masterkit/blog/394357/"><img src="https://habrastorage.org/files/90b/243/f5d/90b243f5d2404b3eb90781ec7c8db602.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我们将展示如何基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字实验室套件NR05，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组装一种从温度传感器收集数据并将其发送到专门站点以存储和处理此类数据的设备。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正如我们反复指出的那样，“电子工程师”字母表中的“数字实验室”工具包不仅旨在教授微控制器编程的原理并基于这些原理设计电子设备，而且还旨在创建完全完成且有用的设备。在我们的项目中，我们将使用ThingSpeak，这是一个基于物联网概念的开放项目平台。该平台旨在收集和处理来自各种传感器的数据。 ThingSpeak的主要功能是：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -实时数据收集；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -数学和统计数据处理；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -数据可视化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ThingSpeak平台具有开发的API（应用程序编程接口），这是站点与应用程序之间的接口，不仅允许您发送，存储和访问数据，还提供了处理它们的各种统计方法。例如，我们将考虑一个收集数据的渠道；该平台总共为每个用户提供多达8个渠道。利用每个通道的数据，您可以执行单独的操作并自行决定使用结果。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要访问Internet，我们将使用基于ESP8266芯片且AT固件</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本为0.21</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的Wi-Fi模块</font><font style="vertical-align: inherit;">。这种流行的芯片是构建大量模块的基础，这些模块在输出数量，天线类型，USB接口和其他功能方面在物理上有所不同。原则上，任何基于ESP8266构建的设备都是自给自足的设备，可以连接外部传感器，但这是需要单独考虑的主题。在这种情况下，我们仅将该模块用作无线Internet访问的设备，并且将使用该模块连接到任何访问点并将数据传输到ThingSpeak。可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到将所有AT固件命令与Arduino程序进行比较的所有命令列表</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果版本不适合，应该说几句有关如何检查固件版本以及如何升级模块的信息。为此，请将模块连接到USB-UART适配器，例如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BM8051</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后发出AT + GMR命令。如果固件版本显示为0021，则一切正常。如果不是，则有两种方法：根据命令格式的可能不匹配更改Arduino的程序，或重新刷新模块。 ESP8266闪烁的问题假装在另一篇文章中，因此在这里我们不考虑它们，但建议您参考在专门用于此模块的网站和专门论坛上发布的材料。作为温度传感器，我们使用NR05套件中随附的DS18B20传感器。教程套件包含有关连接和使用此传感器的章节，以及有关读取和显示温度测量值的编程示例。传感器连接到NR05套件扩展板上相应标记的触点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为基于ESP8266的模块，您可以使用Master Kit范围内的多个设备：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MP8266-01</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MP8266-03</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MP8266-07</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MP8266-12E</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MP3508</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最后一个设备是开发人员的面板，并且已“塞满”到最大。它不需要额外的3.3V稳定器和USB-UART适配器即可进行编程-所有这些已经在板上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于其余模块，如有必要，可能需要USB-UART适配器进行闪烁，但是肯定需要3.3V稳定器（例如AMS1117），因为NR05套件中包含的Arduino Nano板中的该电压源无法提供所需的电流。电源ESP8266。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无论如何，在完成的项目中，我们仅使用四个ESP输出：电源，地以及RX和TX与Arduino通信。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arduino程序的一般算法如下：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -检查ESP的准备情况；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -如果准备就绪，请连接到接入点；</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（每分钟重复一次进一步的动作）：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -我们从温度传感器读取数据；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -在扩展卡的指示器上显示当前温度；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -建立与Thingspeak.com网站的连接；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -将当前温度传输到站点的相应通道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于理论，也许足够了。让我们继续练习。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，在Thingspeak.com上免费注册并获得注册后的API密钥，该密钥必须在将数据传输到通道时使用。网站的界面正在发生变化，因此就浏览器中可见内容而言，我们的描述可能略有不一致。但是通常，该界面是直观的，因此在注册和创建新频道时应该不会有任何严重的问题。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，注册后，创建一个新频道：Channels-My Channels-New Channel。必须为频道指定名称和简短说明，并且频道可以是“私人”和“公共”，请自行选择。创建通道后，您可以看到所需的API密钥，我们需要Write API Key才能将数据写入通道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以通过在浏览器行中输入以下行来测试数据记录：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api.thingspeak.com/update?key=yourAPIkey&amp;field1=0</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
字符串（0）中的最后一个字符可以是任何值，它将被写入通道。</font><font style="vertical-align: inherit;">按下Enter键后，站点将使用与通道中记录的值数量相对应的数字进行响应。</font><font style="vertical-align: inherit;">请记住，两次录制之间的最小间隔为15秒。</font><font style="vertical-align: inherit;">现在您可以传输数据，在Arduino中形成类似的行，并使用ESP8266将它们传输到我们的通道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下图显示了这些元件的连接图：</font></font><br>
<br>
<img src="https://habrastorage.org/files/b34/ac6/a70/b34ac6a7016c4e33a06145cd8c8a4570.jpg" width="700"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用了MP8266-07模块，因此我们需要一个稳定器和一个电容器。</font><font style="vertical-align: inherit;">另外，为了使模块正确运行，必须将GPIO15引脚接地，并将CH_PD引脚（芯片选择）连接至3.3V电源。</font><font style="vertical-align: inherit;">该模块甚至可以将内置天线连接到相距约20米的相邻房间中的接入点。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino的草图清单，带有详细的注释：</font></font></b><div class="spoiler_text">//   <br>
#include &lt;DallasTemperature.h&gt;<br>
#include &lt;OneWire.h&gt;<br>
#include &lt;SoftwareSerial.h&gt;<br>
#include &lt;LiquidCrystal.h&gt;<br>
//    , <br>
unsigned long pauseTime = 60000;<br>
//    <br>
unsigned long currentTime;<br>
unsigned long previousTime = 0;<br>
//   D10     D18B20<br>
//      ONE WIRE  <br>
#define ONE_WIRE_BUS 10<br>
OneWire oneWire(ONE_WIRE_BUS);<br>
DallasTemperature sensors(&amp;oneWire);<br>
//      WiFi<br>
#define SSID «»<br>
#define PASS «»<br>
//  IP   thingspeak.com<br>
#define IP «184.106.153.149»<br>
//    GET  API thingspeak.com<br>
String GET = «GET /update?key=API&amp;field1=»;<br>
//      ESP8266   <br>
//  AT-  ;<br>
// (  AT-  v0.21 SDK 0.9.5<br>
// <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">esp8266.ru/esp8266-sdk-0-9-5-v0-21</a> )<br>
SoftwareSerial esp(11, 12); // RX, TX<br>
//     LCD-<br>
LiquidCrystal lcd(A1, A2, A3, 2, 4, 7);<br>
<br>
void setup()<br>
{<br>
// :<br>
esp.begin(9600); // -  ESP8266   9600 <br>
Serial.begin(9600); // -   COM-  ( )<br>
sensors.begin(); //  <br>
lcd.begin(16, 2); // LCD-<br>
lcd.clear();<br>
//   ESP8266  AT<br>
Send(«AT»);<br>
delay(1000);<br>
//    OK,    <br>
if(esp.find(«OK»)){<br>
 Serial.println(«ESP8266 Ready: OK»);<br>
 connectWiFi();<br>
 previousTime = millis() + 2*pauseTime; <br>
}<br>
}<br>
<br>
void loop(){<br>
currentTime = millis(); <br>
if(currentTime — previousTime &gt; pauseTime) {<br>
 //    <br>
 sensors.requestTemperatures();<br>
 float tempC = sensors.getTempCByIndex(0);<br>
 //     <br>
 char buffer[10];<br>
 String temp = dtostrf(tempC, 4, 1, buffer);<br>
 //       thingspeak.com<br>
 updateData(temp);<br>
 lcd.setCursor(0,0);<br>
 lcd.print(temp);<br>
 lcd.print("\xDF"«C»); // \xDF —  <br>
 previousTime = currentTime;<br>
 }<br>
}<br>
<br>
//     ESP8266   thingspeak.com<br>
void updateData(String data){<br>
//       thingspeak.com<br>
String cmd = «AT+CIPSTART=\»TCP\",\"";<br>
cmd += IP;<br>
cmd += "\",80";<br>
Send(cmd);<br>
delay(3000);<br>
if(esp.find(«OK»))<br>
 Serial.println(«CONNECT TO IP: OK»);<br>
else<br>
 Serial.println(«CONNECT TO IP: Error»);<br>
//      <br>
cmd = GET;<br>
cmd += data;<br>
cmd += "\r\n";<br>
esp.print(«AT+CIPSEND=»);<br>
esp.println(cmd.length());<br>
//   ESP8266      <br>
if(esp.find("&gt;")){<br>
 Serial.print("&gt;");<br>
//   <br>
 esp.print(cmd);<br>
 Serial.print(cmd);<br>
 if(esp.find(«OK»)) Serial.println(«DATA SEND: OK»);<br>
 else Serial.println(«DATA SEND: Error»);<br>
 }<br>
else{<br>
 Send(«AT+CIPCLOSE»);<br>
 if(esp.find(«OK»)) Serial.println(«CONNECTION FOR IP CLOSE: OK»);<br>
 else Serial.println(«CONNECTION FOR IP CLOSE: Error»);<br>
}<br>
Serial.println();<br>
}<br>
<br>
//      ESP8266<br>
void Send(String cmd){<br>
Serial.print(«SEND TO ESP8266: „);<br>
esp.println(cmd);<br>
Serial.println(cmd);<br>
}<br>
<br>
//     WiFi<br>
boolean connectWiFi(){<br>
esp.println(“AT+CWMODE=1»);<br>
delay(2000);<br>
String cmd=«AT+CWJAP=\»";<br>
cmd+=SSID;<br>
cmd+="\",\"";<br>
cmd+=PASS;<br>
cmd+="\"";<br>
Send(cmd);<br>
delay(5000);<br>
if(esp.find(«OK»)){<br>
 Serial.println(«CONNECT TO WIFI: OK»);<br>
 return true;<br>
}<br>
else{<br>
 Serial.println(«CONNECT TO WIFI: Error»);<br>
 return false;<br>
}<br>
}<br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有元素都已组装好，程序启动了：</font></font><br>
<br>
<img src="https://habrastorage.org/files/0df/ea1/220/0dfea1220b4141ff9593c29046b8a2c1.jpg" width="700"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是现场的测量结果：</font></font><br>
<br>
<img src="https://habrastorage.org/files/e21/a58/e36/e21a58e363c84b37b19f28f349efaf7b.jpg" width="800"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一个图显示了温度随时间的变化，第二个图是ThingSpeak内置的基于MatLab的可视化工具创建的直方图，显示了过去24小时内的次数测量每个温度值。</font><font style="vertical-align: inherit;">在现场，这种直方图称为“温度变化”，最接近的俄语术语是温度波动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，结合使用Digital Laboratory套件和ThingSpeak平台提供的服务，最多可以在八个通道中收集和处理来自各种传感器的数据。</font><font style="vertical-align: inherit;">例如，使用上一篇文章中所述的四通道电压表电路，您可以监视电池或太阳能电池板的状况，同时在安装地点接收天气信息。</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN394357/">https://habr.com/ru/post/zh-CN394357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN394345/index.html">Google I / O 2016：Android N的新版本，Daydream平台不仅</a></li>
<li><a href="../zh-CN394347/index.html">更新的Raspberry Pi零微机获得相机支持，但仍需花费5美元</a></li>
<li><a href="../zh-CN394349/index.html">在没有酶帮助的情况下从“无生命”的建筑砖中收集RNA是真实的</a></li>
<li><a href="../zh-CN394351/index.html">芝加哥警方预测谁可以开枪和被枪杀</a></li>
<li><a href="../zh-CN394353/index.html">Andy Grove在计算机市场及其参与者上</a></li>
<li><a href="../zh-CN394359/index.html">脑系统</a></li>
<li><a href="../zh-CN394365/index.html">特斯拉正在准备一辆新跑车</a></li>
<li><a href="../zh-CN394367/index.html">网上欺诈研究</a></li>
<li><a href="../zh-CN394371/index.html">2016年Skolkovo机器人国际会议概述</a></li>
<li><a href="../zh-CN394373/index.html">有前途的纳米电机将能够积累并利用光能移动</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>