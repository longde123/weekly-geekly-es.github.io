<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😜 🧚🏻 🤟🏽 Pelajaran malam: menulis highlight sintaksis 🙋🏼 👍🏽 ✅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini saya menjadi tertarik pada bagaimana penyorotan kode diatur dari dalam. Pada awalnya kelihatannya semuanya sangat rumit di sana - pohon ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pelajaran malam: menulis highlight sintaksis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482884/">  Baru-baru ini saya menjadi tertarik pada bagaimana penyorotan kode diatur dari dalam.  Pada awalnya kelihatannya semuanya sangat rumit di sana - pohon sintaksis, rekursi, dan itu saja.  Namun, setelah diperiksa lebih dekat, ternyata tidak ada yang sulit di sini.  Semua pekerjaan dapat dilakukan dalam satu siklus dengan mengintip bolak-balik, apalagi, ekspresi reguler hampir tidak pernah digunakan dalam skrip yang dihasilkan. <br><br>  Halaman Demo: <a href="https://astynk.github.io/highlight.html">Highlighter Kode Javascript</a> <br><a name="habracut"></a><br><h2>  Ide utama </h2><br>  Kami mendeklarasikan variabel <i>status</i> , yang akan menyimpan informasi tentang bagian kode mana yang kita gunakan.  Jika, misalnya, <i>negara</i> sama dengan satu, maka ini berarti bahwa kita berada di dalam string dengan tanda kutip tunggal.  Script akan menunggu kutipan penutup dan mengabaikan yang lainnya.  Hal yang sama dengan menyoroti komentar, regexp, dan elemen lainnya, masing-masing memiliki nilai statusnya sendiri.  Dengan demikian, karakter pembuka dan penutup yang berbeda tidak akan bertentangan;  dengan kata lain, kode seperti ini: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = <span class="hljs-string"><span class="hljs-string">'"\'"'</span></span>;</code> </pre> <br>  akan disorot dengan benar, yaitu, kasus-kasus seperti itu menyebabkan kesulitan paling besar. <br><br><h2>  Memulai </h2><br>  Kami menentukan nilai yang mungkin dari variabel keadaan, serta warna di mana ini atau itu bagian dari kode akan dicat, serta daftar kata kunci Javascript (yang juga akan disorot): <br><br><div class="spoiler">  <b class="spoiler_title">negara const = {...</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> states = { <span class="hljs-attr"><span class="hljs-attr">NONE</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">SINGLE_QUOTE</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 'string' DOUBLE_QUOTE : 2, // "string" ML_QUOTE : 3, // `string` REGEX_LITERAL : 4, // /regex/ SL_COMMENT : 5, // // single line comment ML_COMMENT : 6, // /* multiline comment */ NUMBER_LITERAL : 7, // 123 KEYWORD : 8 // function, var etc. }; const colors = { NONE : '#000', SINGLE_QUOTE : '#aaa', // 'string' DOUBLE_QUOTE : '#aaa', // "string" ML_QUOTE : '#aaa', // `string` REGEX_LITERAL : '#707', // /regex/ SL_COMMENT : '#0a0', // // single line comment ML_COMMENT : '#0a0', // /* multiline comment */ NUMBER_LITERAL : '#a00', // 123 KEYWORD : '#00a', // function, var etc. OPERATOR : '#07f' // null, true etc. }; const keywords = 'async|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|of|package|private|protected|public|return|set|static|super|switch|throw|try|typeof|var|void|while|with|yield|catch|finally'.split('|');</span></span></code> </pre><br></div></div><br>  Selanjutnya, kita membuat fungsi yang akan mengambil garis dengan kode dan mengembalikan HTML yang sudah selesai dengan kode yang disorot.  Untuk menyorot, karakter akan dibungkus SPAN dengan warna yang ditentukan dalam variabel <i>warna</i> . <br><br>  Fungsi hanya akan memiliki satu siklus, yang menganalisis setiap karakter dan menambahkan pembukaan / penutupan SPAN bila perlu. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">highlight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> output = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = states.NONE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; code.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> char = code[i], prev = code[i<span class="hljs-number"><span class="hljs-number">-1</span></span>], next = code[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//     } return output; }</span></span></code> </pre> <br>  Pertama, sorot komentar: single-line dan multi-line.  Jika karakter saat ini dan selanjutnya adalah garis miring, dan mereka tidak berada di dalam garis ( <i>negara</i> adalah 0, yaitu, <i>menyatakan</i> . <i>TIDAK ADA</i> ), maka ini adalah awal dari komentar.  Ubah <i>status</i> dan buka SPAN dengan warna yang diinginkan: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; next == <span class="hljs-string"><span class="hljs-string">'/'</span></span>) { state = states.SL_COMMENT; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.SL_COMMENT + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  diperlukan <i>terus</i> sehingga pemeriksaan berikut tidak berfungsi dan konflik tidak terjadi. <br><br>  Selanjutnya, kita menunggu akhir baris: jika karakter saat ini adalah satu baris dan dalam <i>keadaan</i> komentar satu baris, tutup SPAN dan ubah <i>status</i> menjadi nol: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.SL_COMMENT &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  Demikian pula, kami mencari komentar multi-baris, algoritmenya persis sama, hanya karakter yang Anda cari berbeda: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; next == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) { state = states.ML_COMMENT; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.ML_COMMENT + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.ML_COMMENT &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; prev == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  Penandaan string terjadi dengan cara yang sama, hanya saja harus diperhitungkan bahwa tanda kutip penutup dapat diloloskan dengan backslash, dan dengan demikian, sudah tidak lagi menjadi slash penutup. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'\''</span></span>) { state = states.SINGLE_QUOTE; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.SINGLE_QUOTE + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.SINGLE_QUOTE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'\''</span></span> &amp;&amp; prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  Kode mirip dengan apa yang sudah di atas, hanya sekarang kita tidak mendaftarkan akhir baris jika ada backslash sebelum kutipan. <br><br>  Definisi string yang dikutip ganda terjadi dengan cara yang persis sama, dan tidak masuk akal untuk menguraikannya secara detail.  Untuk melengkapi gambar, saya akan menempatkannya di bawah spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">if (state == States.NONE &amp;&amp; char == '' '') {...</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) { state = states.DOUBLE_QUOTE; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.DOUBLE_QUOTE + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.DOUBLE_QUOTE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'"'</span></span> &amp;&amp; prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'`'</span></span>) { state = states.ML_QUOTE; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.ML_QUOTE + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.ML_QUOTE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'`'</span></span> &amp;&amp; prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br></div></div><br>  Literatur Regexp, yang mudah dikacaukan dengan tanda pembagian, patut dipertimbangkan secara terpisah.  Kami akan kembali ke masalah ini di akhir artikel, tetapi untuk saat ini kami melakukan hal yang sama dengan regexps dengan string. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span>) { state = states.REGEX_LITERAL; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.REGEX_LITERAL + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.REGEX_LITERAL &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { state = states.NONE; output += char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  Ini mengakhiri kasus sederhana ketika awal dan akhir literal dapat ditentukan oleh 1-2 karakter.  Mari kita mulai menyoroti angka: seperti yang Anda tahu, mereka selalu mulai dengan angka, tetapi dapat memiliki huruf dalam komposisi ( <i>0xFF</i> , <i>123n</i> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; <span class="hljs-regexp"><span class="hljs-regexp">/[0-9]/</span></span>.test(char) &amp;&amp; !<span class="hljs-regexp"><span class="hljs-regexp">/[0-9a-z$_]/i</span></span>.test(prev)) { state = states.NUMBER_LITERAL; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.NUMBER_LITERAL + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NUMBER_LITERAL &amp;&amp; !<span class="hljs-regexp"><span class="hljs-regexp">/[0-9a-fnx]/i</span></span>.test(char)) { state = states.NONE; output += <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span> }</code> </pre> <br>  Di sini kita mencari awal angka: karakter sebelumnya tidak boleh berupa angka atau huruf, jika tidak angka-angka dalam nama variabel akan disorot.  Segera setelah karakter saat ini bukan angka atau huruf yang dapat terkandung dalam literal angka, tutup SPAN dan atur <i>status ke</i> nol. <br><br>  Semua jenis literal yang mungkin disorot, pencarian kata kunci tetap ada.  Untuk melakukan ini, Anda memerlukan loop bersarang yang melihat ke depan dan menentukan apakah karakter saat ini adalah awal kata kunci. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; !<span class="hljs-regexp"><span class="hljs-regexp">/[a-z0-9$_]/i</span></span>.test(prev)) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> word = <span class="hljs-string"><span class="hljs-string">''</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (code[i + j] &amp;&amp; <span class="hljs-regexp"><span class="hljs-regexp">/[az]/i</span></span>.test(code[i + j])) { word += code[i + j]; j++; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keywords.includes(word)) { state = states.KEYWORD; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.KEYWORD + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span>; } }</code> </pre> <br>  Di sini kita melihat, karakter sebelumnya tidak boleh dalam nama variabel, jika tidak <i>biarkan</i> kata kunci akan disorot di <i>outlet</i> kata.  Kemudian loop bersarang mengumpulkan kata terpanjang yang mungkin sampai karakter non-alfabet ditemukan.  Jika kata yang diterima ada dalam susunan <i>kata kunci</i> , buka SPAN dan mulailah menyorot kata tersebut.  Segera setelah karakter non-alfabet ditemukan, ini berarti akhir kata - karenanya, tutup SPAN: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.KEYWORD &amp;&amp; !<span class="hljs-regexp"><span class="hljs-regexp">/[az]/i</span></span>.test(char)) { state = states.NONE; output += <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; }</code> </pre> <br>  Hal yang paling sederhana tetap ada - penyorotan operator, di sini Anda dapat membandingkan dengan serangkaian karakter yang dapat terjadi di operator: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; <span class="hljs-string"><span class="hljs-string">'+-/*=&amp;|%!&lt;&gt;?:'</span></span>.indexOf(char) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.OPERATOR + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  Pada akhir loop, jika tidak ada kondisi yang <i>melanjutkan</i> penyebab yang dipicu, kami cukup menambahkan karakter saat ini ke variabel yang dihasilkan.  Ketika awal atau akhir literal atau kata kunci terjadi, kami membuka / menutup SPAN dengan warna;  dalam semua kasus lain - misalnya, ketika garis sudah terbuka, kita hanya membuang satu karakter sekaligus.  Anda juga perlu melindungi kurung sudut bukaan, jika tidak mereka dapat merusak tata letak. <br><br><pre> <code class="javascript hljs">output += char.replace(<span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span> + <span class="hljs-string"><span class="hljs-string">'lt;'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  +      &lt;</span></span></code> </pre> <br><h2>  Perbaikan bug </h2><br>  Semuanya tampak entah bagaimana terlalu sederhana, dan tidak sia-sia: dengan pengujian yang lebih teliti, ada kasus di mana lampu latar tidak bekerja dengan benar. <br><br>  Divisi ini diakui sebagai regexp, untuk membedakan satu dari yang lain, perlu mengubah cara regexp ditentukan.  Kami mendeklarasikan variabel <i>isRegex = true</i> , setelah itu kami akan mencoba untuk “membuktikan” bahwa ini bukan regexp, tetapi sebuah tanda pembagian.  Tidak boleh ada kata kunci atau tanda kurung buka sebelum operasi pembagian - oleh karena itu, kami membuat loop bersarang dan melihat apa yang garis miring hadapi. <br><br><div class="spoiler">  <b class="spoiler_title">Seperti sebelumnya</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span>) { state = states.REGEX_LITERAL; output += <span class="hljs-string"><span class="hljs-string">'&lt;span style="color: '</span></span> + colors.REGEX_LITERAL + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + char; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br></div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.NONE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'/'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> word = <span class="hljs-string"><span class="hljs-string">''</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>, isRegex = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i + j &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { j--; <span class="hljs-comment"><span class="hljs-comment">//        if ('+/-*=|&amp;&lt;&gt;%,({[?:;'.indexOf(code[i+j]) != -1) break; //   ;   -   if (!/[0-9a-z$_]/i.test(code[i+j]) &amp;&amp; word.length &gt; 0) break; //  ,     if (/[0-9a-z$_]/i.test(code[i+j])) word = code[i+j] + word; //   - ,     if (')]}'.indexOf(code[i+j]) != -1) { isRegex = false; break; } } //      -    //  : return /test/g - , plainWord /test/g -  if (word.length &gt; 0 &amp;&amp; !keywords.includes(word)) isRegex = false; if (isRegex) { state = states.REGEX_LITERAL; output += '&lt;span style="color: ' + colors.REGEX_LITERAL + '"&gt;' + char; continue; } }</span></span></code> </pre> <br>  Meskipun pendekatan ini menyelesaikan masalah, itu masih bukan tanpa cacat.  Anda dapat menyesuaikannya sehingga algoritme ini juga menyoroti secara tidak benar, misalnya: <i>jika (a) / regex /</i> atau lebih: <i>1 / / regex / / 2</i> .  Mengapa seseorang yang membagi angka menjadi regexp perlu menyoroti kode - ini adalah pertanyaan lain;  desainnya secara sintaksis benar, meskipun tidak terjadi dalam kehidupan nyata. <br><br>  Ada masalah dengan pewarnaan regexp dalam banyak karya, misalnya di <a href="https://prismjs.com/test.html">prism.js</a> .  Tampaknya, untuk menyoroti regexps yang benar, Anda harus sepenuhnya memahami sintaksisnya, seperti halnya peramban. <br><br>  Bug kedua yang harus saya tangani terkait dengan backslash.  Tanda kutip penutup tidak dikenali dalam string bentuk <i>'tes \\'</i> karena adanya backslash di depannya.  Kembali ke kondisi yang menangkap ujung garis: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == states.SINGLE_QUOTE &amp;&amp; char == <span class="hljs-string"><span class="hljs-string">'\''</span></span> &amp;&amp; prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span>)</code> </pre> <br>  Bagian terakhir dari kondisi ini perlu diubah: jika garis miring terbalik (yaitu, ada garis miring terbalik yang lain sebelum itu), kemudian daftarkan ujung baris. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> closingCharNotEscaped = prev != <span class="hljs-string"><span class="hljs-string">'\\'</span></span> || prev == <span class="hljs-string"><span class="hljs-string">'\\'</span></span> &amp;&amp; code[i<span class="hljs-number"><span class="hljs-number">-2</span></span>] == <span class="hljs-string"><span class="hljs-string">'\\'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... if (state == states.SINGLE_QUOTE &amp;&amp; char == '\'' &amp;&amp; closingCharNotEscaped)</span></span></code> </pre> <br>  Penggantian yang sama harus dilakukan dalam mencari string dengan tanda kutip ganda dan terbalik, serta dalam pencarian regexp. <br><br>  Itu saja, Anda dapat menguji sorot dengan tautan di awal artikel. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482884/">https://habr.com/ru/post/id482884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482872/index.html">Poligon Dunia Lain</a></li>
<li><a href="../id482874/index.html">Kematian Koshchei dalam daftar rekomendasi (dapatkah Anda membuat YouTube nyaman dan aman?)</a></li>
<li><a href="../id482876/index.html">Perhitungan biaya produksi listrik tenaga surya untuk kebutuhan rumah tangga sendiri di pusat Eropa</a></li>
<li><a href="../id482878/index.html">Bagaimana saya mencari definisi "produk"</a></li>
<li><a href="../id482882/index.html">Motor sebagai rem elektromagnetik</a></li>
<li><a href="../id482886/index.html">Analisis Habra: apakah panjang publikasi penting?</a></li>
<li><a href="../id482888/index.html">Meluncurkan server VPN di belakang penyedia NAT</a></li>
<li><a href="../id482892/index.html">Biarkan vs const - apa yang harus digunakan?</a></li>
<li><a href="../id482894/index.html">Generasi prosedural adaptif menggunakan algoritma WaveFunctionCollapse dan distribusi probabilitas apriori</a></li>
<li><a href="../id482896/index.html">OSCP - Pengalaman Saya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>