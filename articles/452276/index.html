<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèø üèÄ üò∏ Ingenier√≠a inversa del cliente de Dropbox üî∫ ‚ùé üé¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR. El art√≠culo habla sobre el desarrollo inverso del cliente de Dropbox, pirateando los mecanismos de ofuscaci√≥n y descompilaci√≥n del cliente en ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ingenier√≠a inversa del cliente de Dropbox</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452276/">  <i>TL; DR.</i>  <i>El art√≠culo habla sobre el desarrollo inverso del cliente de Dropbox, pirateando los mecanismos de ofuscaci√≥n y descompilaci√≥n del cliente en Python, as√≠ como cambiando el programa para activar las funciones de depuraci√≥n que est√°n ocultas en modo normal.</i>  <i>Si solo est√° interesado en el c√≥digo y las instrucciones correspondientes, despl√°cese hasta el final.</i>  <i>Al momento de escribir esto, el c√≥digo es compatible con las √∫ltimas versiones de Dropbox basadas en el int√©rprete CPython 3.6.</i> <br><br><h3>  Introduccion </h3><br>  Dropbox me ha fascinado de inmediato.  El concepto sigue siendo enga√±osamente simple.  Aqu√≠ est√° la carpeta.  Poner archivos all√≠.  Est√° sincronizado  Yendo a otro dispositivo.  Se sincroniza nuevamente.  ¬°La carpeta y los archivos ahora aparecieron all√≠ tambi√©n! <br><br>  La cantidad de trabajo de fondo oculto es realmente sorprendente.  En primer lugar, todos los problemas con los que tiene que lidiar al crear y mantener una aplicaci√≥n multiplataforma para los principales sistemas operativos de escritorio (OS X, Linux, Windows) no desaparecen.  Agregue a esto el soporte de varios navegadores web, varios sistemas operativos m√≥viles.  Y solo estamos hablando del lado del cliente.  Tambi√©n estoy interesado en el backend de Dropbox, que me permiti√≥ lograr tal escalabilidad y baja latencia con la carga de trabajo incre√≠blemente pesada creada por medio bill√≥n de usuarios. <br><a name="habracut"></a><br>  Es por estas razones que siempre me ha gustado ver lo que hace Dropbox bajo el cap√≥ y c√≥mo ha evolucionado a lo largo de los a√±os.  Hace unos ocho a√±os, intent√© por primera vez averiguar c√≥mo funciona realmente el cliente de Dropbox cuando not√© la transmisi√≥n de tr√°fico desconocido mientras estaba en el hotel.  La investigaci√≥n mostr√≥ que esto es parte de la funci√≥n de Dropbox llamada LanSync, que le permite sincronizar m√°s r√°pido si los hosts de Dropbox en la misma LAN tienen acceso a los mismos archivos.  Sin embargo, el protocolo no estaba documentado y quer√≠a saber m√°s.  Por lo tanto, decid√≠ echar un vistazo con m√°s detalle y, como resultado, realic√© ingenier√≠a inversa de casi todo el programa.  Este estudio nunca fue publicado, aunque a veces compart√≠ notas con algunas personas. <br><br>  Cuando abrimos Anvil Ventures, Chris y yo apreciamos una serie de herramientas para el almacenamiento, el intercambio y la colaboraci√≥n de documentos.  Uno de ellos, obviamente, era Dropbox, y para m√≠ esta es otra raz√≥n para desenterrar estudios antiguos y verificarlos en la versi√≥n actual del cliente. <br><br><h3>  Descifrado y desofuscaci√≥n </h3><br>  Primero, descargu√© el cliente para Linux y descubr√≠ r√°pidamente que estaba escrito en Python.  Debido a que la licencia de Python es bastante permisiva, es f√°cil para las personas modificar y distribuir el int√©rprete de Python junto con otras dependencias como el software comercial.  Luego comenc√© la ingenier√≠a inversa para entender c√≥mo funciona el cliente. <br><br>  En ese momento, los archivos con el c√≥digo de bytes estaban en un archivo ZIP combinado con un binario ejecutable.  El binario principal era solo un int√©rprete de Python modificado que se cargaba capturando mecanismos de importaci√≥n de Python.  Cada llamada de importaci√≥n posterior se redirigi√≥ a este binario con un an√°lisis de archivos ZIP.  Por supuesto, es f√°cil extraer este ZIP del binario.  Por ejemplo, la √∫til herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">binwalk la</a> recupera con todos los archivos .pyc compilados en bytes. <br><br>  Entonces no pude romper el cifrado de los archivos .pyc, pero al final tom√© el objeto general de la biblioteca est√°ndar de Python y lo volv√≠ a compilar, inyectando una puerta trasera dentro.  Ahora que el cliente de Dropbox estaba cargando este objeto, pod√≠a ejecutar f√°cilmente c√≥digo arbitrario de Python en un int√©rprete que funcionara.  Aunque descubr√≠ esto por mi cuenta, Florian Leda y Nicolas Raff utilizaron el mismo m√©todo en una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> en Hack.lu en 2012. <br><br>  La capacidad de explorar y manipular c√≥digo en ejecuci√≥n en Dropbox ha revelado mucho.  El c√≥digo utiliz√≥ varios trucos de protecci√≥n para dificultar el volcado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">objetos de c√≥digo</a> .  Por ejemplo, en un int√©rprete de CPython normal, es f√°cil recuperar un c√≥digo de bytes compilado que representa una funci√≥n.  Un simple ejemplo: <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i * i ... &gt;&gt;&gt; f.__code__ &lt;code object f at <span class="hljs-number"><span class="hljs-number">0x109deb540</span></span>, file <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>&gt; &gt;&gt;&gt; f.__code__.co_code <span class="hljs-string"><span class="hljs-string">b'|\x00|\x00\x14\x00S\x00'</span></span> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dis &gt;&gt;&gt; dis.dis(f) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (i) <span class="hljs-number"><span class="hljs-number">2</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (i) <span class="hljs-number"><span class="hljs-number">4</span></span> BINARY_MULTIPLY <span class="hljs-number"><span class="hljs-number">6</span></span> RETURN_VALUE &gt;&gt;&gt;</code> </pre> <br>  Pero en la versi√≥n compilada de <i>Objects / codeobject.c, la</i> propiedad <i>co_code</i> <code>co_code</code> elimin√≥ de la lista abierta.  Esta lista de miembros generalmente se ve as√≠: <br><br><pre> <code class="python hljs"> static PyMemberDef code_memberlist[] = { ... {<span class="hljs-string"><span class="hljs-string">"co_flags"</span></span>, T_INT, OFF(co_flags), READONLY}, {<span class="hljs-string"><span class="hljs-string">"co_code"</span></span>, T_OBJECT, OFF(co_code), READONLY}, {<span class="hljs-string"><span class="hljs-string">"co_consts"</span></span>, T_OBJECT, OFF(co_consts), READONLY}, ... };</code> </pre> <br>  La desaparici√≥n de la propiedad <code>co_code</code> hace que sea imposible volcar estos objetos de c√≥digo. <br><br>  Adem√°s, se han eliminado otras bibliotecas, como el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desensamblador</a> Python est√°ndar.  Al final, todav√≠a logr√© volcar los objetos de c√≥digo en archivos, pero a√∫n as√≠ no pude descompilarlos.  Me llev√≥ un tiempo darme cuenta de que los c√≥digos de operaci√≥n utilizados por el int√©rprete de Dropbox no coinciden con los c√≥digos de operaci√≥n est√°ndar de Python.  Por lo tanto, era necesario comprender los nuevos c√≥digos de operaci√≥n para volver a escribir los objetos de c√≥digo en el bytecode original de Python. <br><br>  Una opci√≥n es la reasignaci√≥n de opcode.  Hasta donde yo s√©, esta t√©cnica fue desarrollada por Rich Smith y presentada en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Defcon 18</a> .  En esa charla, tambi√©n mostr√≥ la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pyREtic</a> para el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo de bytes</a> Python de ingenier√≠a inversa en la memoria.  Parece que el c√≥digo pyREtic es poco compatible y la herramienta est√° dirigida a los binarios "viejos" de Python 2.x.  Para familiarizarse con las t√©cnicas que se le ocurri√≥ a Rich, es muy recomendable ver su actuaci√≥n. <br><br>  El m√©todo de traducci√≥n opcode toma todos los objetos de c√≥digo de la biblioteca est√°ndar de Python y los compara con los objetos extra√≠dos del binario de Dropbox.  Por ejemplo, codifique objetos de <i>hashlib.pyc</i> o <i>socket.pyc</i> , que est√°n en la biblioteca est√°ndar.  Digamos, si cada vez que el <code>0x43</code> operaci√≥n <code>0x43</code> corresponde al c√≥digo de operaci√≥n 0x21 desofuscado, podemos construir gradualmente una tabla de traducci√≥n para reescribir objetos de c√≥digo.  Estos objetos de c√≥digo se pueden pasar a trav√©s del descompilador de Python.  Para volcar, a√∫n necesita un int√©rprete corregido con el objeto <code>co_code</code> correcto. <br><br>  Otra opci√≥n es hackear el formato de serializaci√≥n.  En Python, la serializaci√≥n se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√°lculo de referencias</a> .  La deserializaci√≥n de archivos ofuscados de la manera habitual no funcion√≥.  Al realizar ingenier√≠a inversa del binario en IDA Pro, descubr√≠ el paso de descifrado.  Hasta donde yo s√©, el primero en publicar p√∫blicamente algo sobre este tema fue Hagen Fritch en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">su blog</a> .  All√≠ se refiere a los cambios en las nuevas versiones de Dropbox (cuando Dropbox cambi√≥ de Python 2.5 a Python 2.7).  El algoritmo funciona de la siguiente manera: <br><br><ul><li>  Al desempacar un archivo pyc, se lee un encabezado para determinar la versi√≥n del c√°lculo de referencias.  Este formato no est√° documentado, excepto por la implementaci√≥n de CPython. <br></li><li>  El formato define una lista de tipos que est√°n codificados en √©l.  Tipos <code>True</code> , <code>False</code> , <code>floats</code> , etc., pero el m√°s importante es el tipo para los <code>code object</code> Python anteriores, <code>code object</code> . <br></li><li>  Al cargar el <code>code object</code> , primero se leen dos valores adicionales del archivo de entrada. <br></li><li>  El primero es el valor <code>random</code> 32 bits. <br></li><li>  El segundo es un valor de <code>length</code> 32 bits que indica el tama√±o del objeto de c√≥digo serializado. <br></li><li>  Luego, los valores de <code>rand</code> y <code>length</code> se <code>rand</code> a una funci√≥n RNG simple que genera <code>seed</code> . <br></li><li>  Esta semilla se entrega al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">v√≥rtice de Mersenne</a> , que genera cuatro valores de 32 bits. <br></li><li>  Combinados, estos cuatro valores proporcionan una clave de cifrado para los datos serializados.  El algoritmo de cifrado descifra los datos usando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Algoritmo de cifrado min√∫sculo</a> . </li></ul><br>  En mi c√≥digo, escrib√≠ el procedimiento de desarme Python desde cero.  La parte que descifra los objetos de c√≥digo se parece al fragmento a continuaci√≥n.  Cabe se√±alar que este m√©todo deber√° llamarse de forma recursiva.  El objeto de nivel superior para un archivo pyc es un objeto de c√≥digo que contiene objetos de c√≥digo, que pueden ser clases, funciones o lambdas.  A su vez, tambi√©n pueden contener m√©todos, funciones o lambdas.  ¬°Todos estos son objetos de c√≥digo de la jerarqu√≠a! <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> rand = self.r_long() length = self.r_long() seed = rng(rand, length) mt = MT19937(seed) key = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): key.append(mt.extract_number()) <span class="hljs-comment"><span class="hljs-comment"># take care of padding for size calculation sz = (length + 15) &amp; ~0xf words = sz / 4 # convert data to list of dwords buf = self._read(sz) data = list(struct.unpack("&lt;%dL" % words, buf)) # decrypt and convert back to stream of bytes data = tea.tea_decipher(data, key) data = struct.pack("&lt;%dL" % words, *data)</span></span></code> </pre> <br>  La capacidad de descifrar objetos de c√≥digo significa que despu√©s de deserializar los procedimientos, debe volver a escribir el c√≥digo de bytes real.  Los objetos de c√≥digo contienen informaci√≥n sobre n√∫meros de l√≠nea, constantes y otra informaci√≥n.  El bytecode real est√° en el objeto <code>co_code</code> .  Cuando creamos la tabla de traducci√≥n de opcode, simplemente podemos reemplazar los valores ofuscados de Dropbox con los equivalentes est√°ndar de Python 3.6. <br><br>  Ahora los objetos de c√≥digo est√°n en el formato habitual de Python 3.6, y se pueden pasar al descompilador.  La calidad de los descompiladores de Python ha crecido significativamente gracias al proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incompleto de</a> R. Bernstein6.  La descompilaci√≥n dio un resultado bastante bueno, y pude armar todo en una herramienta que descompila la versi√≥n actual del cliente de Dropbox de la mejor manera posible. <br><br>  Si clonas este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> y sigues las instrucciones, el resultado ser√° algo como esto: <br><br><pre>  ...
     __main__ - INFO - Descompilado exitosamente dropbox / client / features / browse_search / __ init __. pyc
     __main__ - INFO - Descifrar, parchar y descompilar _bootstrap_overrides.pyc
     __main__ - INFO - Descompilado exitosamente _bootstrap_overrides.pyc
     __principal__ - INFORMACI√ìN - Proces√≥ 3713 archivos (3591 se descompil√≥ con √©xito, 122 fallaron)
     opcodemap - ADVERTENCIA - NO escribir mapa de opcode ya que forzar sobrescritura no est√° establecida </pre><br>  Esto significa que ahora tiene un directorio <code>out/</code> con una versi√≥n descompilada del c√≥digo fuente de Dropbox. <br><br><h3>  Habilitar el seguimiento de Dropbox </h3><br>  En el c√≥digo abierto, comenc√© a buscar algo interesante, y el siguiente fragmento me llam√≥ la atenci√≥n.  Los controladores de rastreo en <code>out/dropbox/client/high_trace.py</code> se instalan solo si el ensamblaje no est√° congelado o la clave m√°gica o cookie que restringe la funcionalidad no est√° configurada en la l√≠nea <code>1430</code> . <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">1424</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">install_global_trace_handlers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(flags=None, args=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">1425</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> _tracing_initialized <span class="hljs-number"><span class="hljs-number">1426</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _tracing_initialized: <span class="hljs-number"><span class="hljs-number">1427</span></span> TRACE(<span class="hljs-string"><span class="hljs-string">'!! Already enabled tracing system'</span></span>) <span class="hljs-number"><span class="hljs-number">1428</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1429</span></span> _tracing_initialized = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">1430</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> build_number.is_frozen() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> magic_trace_key_is_set() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> limited_support_cookie_is_set(): <span class="hljs-number"><span class="hljs-number">1431</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">'DBNOLOCALTRACE'</span></span>): <span class="hljs-number"><span class="hljs-number">1432</span></span> add_trace_handler(db_thread(LtraceThread)().trace) <span class="hljs-number"><span class="hljs-number">1433</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">'DBTRACEFILE'</span></span>): <span class="hljs-number"><span class="hljs-number">1434</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  La menci√≥n de compilaciones congeladas se refiere a las compilaciones de depuraci√≥n interna de Dropbox.  Y un poco m√°s arriba en el mismo archivo puedes encontrar tales l√≠neas: <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">272</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_valid_time_limited_cookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cookie)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">273</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">274</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">275</span></span> t_when = int(cookie[:<span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) ^ <span class="hljs-number"><span class="hljs-number">1686035233</span></span> <span class="hljs-number"><span class="hljs-number">276</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-number"><span class="hljs-number">277</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">278</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">279</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> abs(time.time() - t_when) &lt; SECONDS_PER_DAY * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> md5(make_bytes(cookie[:<span class="hljs-number"><span class="hljs-number">8</span></span>]) + <span class="hljs-string"><span class="hljs-string">b'traceme'</span></span>).hexdigest()[:<span class="hljs-number"><span class="hljs-number">6</span></span>] == cookie[<span class="hljs-number"><span class="hljs-number">8</span></span>:]: <span class="hljs-number"><span class="hljs-number">280</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">281</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception: <span class="hljs-number"><span class="hljs-number">282</span></span> report_exception() <span class="hljs-number"><span class="hljs-number">283</span></span> <span class="hljs-number"><span class="hljs-number">284</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">285</span></span> <span class="hljs-number"><span class="hljs-number">286</span></span> <span class="hljs-number"><span class="hljs-number">287</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limited_support_cookie_is_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">288</span></span> dbdev = os.getenv(<span class="hljs-string"><span class="hljs-string">'DBDEV'</span></span>) <span class="hljs-number"><span class="hljs-number">289</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dbdev <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_valid_time_limited_cookie(dbdev) build_number/environment.py</code> </pre> <br>  Como puede ver en el m√©todo <code>limited_support_cookie_is_set</code> en la l√≠nea <code>287</code> , el seguimiento solo est√° habilitado si la variable de entorno denominada <code>DBDEV</code> configurada correctamente en cookies con una vida √∫til limitada.  Bueno, eso es interesante!  Y ahora sabemos c√≥mo generar cookies de tiempo limitado.  A juzgar por el nombre, los ingenieros de Dropbox pueden generar tales cookies y luego habilitar temporalmente el seguimiento en algunos casos cuando es necesario para ayudar a los clientes.  Despu√©s de reiniciar Dropbox o reiniciar la computadora, incluso si la cookie especificada todav√≠a est√° en su lugar, caducar√° autom√°ticamente.  Supongo que esto deber√≠a evitar, por ejemplo, la degradaci√≥n del rendimiento debido al seguimiento continuo.  Tambi√©n dificulta la ingenier√≠a inversa de Dropbox. <br><br>  Sin embargo, un peque√±o script puede simplemente generar y configurar constantemente estas cookies.  Algo como esto: <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 def output_env(name, value): print("%s=%s; export %s" % (name, value, name)) def generate_time_cookie(): t = int(time.time()) c = 1686035233 s = "%.8x" % (t ^ c) h = md5(s.encode("utf-8?") + b"traceme").hexdigest() ret = "%s%s" % (s, h[:6]) return ret c = generate_time_cookie() output_env("DBDEV", c)</span></span></code> </pre> <br>  Luego se crea una cookie basada en el tiempo: <br><br><pre> <code class="python hljs"> $ python3 setenv.py DBDEV=<span class="hljs-number"><span class="hljs-number">38</span></span>b28b3f349714; export DBDEV;</code> </pre> <br>  Luego cargue correctamente la salida de este script en el entorno y ejecute el cliente de Dropbox. <br><br><pre> <code class="python hljs"> $ eval `python3 setenv.py` $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number"><span class="hljs-number">-71.4</span></span><span class="hljs-number"><span class="hljs-number">.108</span></span>/dropbox</code> </pre> <br>  Esto incluye salida de seguimiento, con formato colorido y todo eso.  Se parece a este cliente no registrado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e83/d0a/a4f/e83d0aa4f475709108cb1cfc0cb16d74.png"><br><br><h3>  Implementar nuevo c√≥digo </h3><br>  Todo esto es un poco divertido.  Estudiando m√°s el c√≥digo descompilado, descubrimos <code>out/build_number/environment.pyc</code> .  Hay una funci√≥n que comprueba si una determinada llave m√°gica est√° instalada.  Esta clave no est√° codificada en el c√≥digo, pero se compara con el hash SHA-256.  Aqu√≠ est√° el fragmento correspondiente. <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib, os <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Optional, Text <span class="hljs-number"><span class="hljs-number">3</span></span> _MAGIC_TRACE_KEY_IS_SET = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magic_trace_key_is_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> _MAGIC_TRACE_KEY_IS_SET <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _MAGIC_TRACE_KEY_IS_SET <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> dbdev = os.getenv(<span class="hljs-string"><span class="hljs-string">'DBDEV'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(dbdev, Text): <span class="hljs-number"><span class="hljs-number">10</span></span> bytes_dbdev = dbdev.encode(<span class="hljs-string"><span class="hljs-string">'ascii'</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> bytes_dbdev = dbdev <span class="hljs-number"><span class="hljs-number">13</span></span> dbdev_hash = hashlib.sha256(bytes_dbdev).hexdigest() <span class="hljs-number"><span class="hljs-number">14</span></span> _MAGIC_TRACE_KEY_IS_SET = dbdev_hash == <span class="hljs-string"><span class="hljs-string">'e27eae61e774b19f4053361e523c771a92e838026da42c60e6b097d9cb2bc825'</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _MAGIC_TRACE_KEY_IS_SET</code> </pre> <br>  Este m√©todo se llama varias veces desde diferentes lugares en el c√≥digo para verificar si la clave de rastreo m√°gica est√° configurada.  Trat√© de descifrar el hash SHA-256 con la fuerza bruta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">John the Ripper</a> , pero me llev√≥ demasiado tiempo realizar una b√∫squeda simple, y no pude reducir la cantidad de opciones porque no hab√≠a conjeturas sobre el contenido.  En Dropbox, los desarrolladores pueden tener una clave de desarrollo espec√≠fica codificada, que instalan si es necesario, activando el modo "clave m√°gica" del cliente para el rastreo. <br><br>  Esto me molest√≥ porque quer√≠a encontrar una manera r√°pida y f√°cil de lanzar Dropbox con este conjunto de claves para el seguimiento.  As√≠ que escrib√≠ un procedimiento de c√°lculo de referencias que genera archivos pyc cifrados de acuerdo con el cifrado de Dropbox.  Por lo tanto, pude ingresar mi propio c√≥digo o simplemente reemplazar el hash anterior.  Este c√≥digo en el repositorio de Github est√° en el archivo <code>patchzip.py</code> .  Como resultado, el hash se reemplaza por el hash SHA-256 de <code>ANVILVENTURES</code> .  Luego, el objeto de c√≥digo se vuelve a cifrar y se coloca en un archivo zip, donde se almacena todo el c√≥digo ofuscado.  Esto le permite hacer lo siguiente: <br><br><pre>  $ DBDEV = ANVILVENTURES;  exportar DBDEV;
     $ ~ / .dropbox-dist / dropbox-lnx_64-71.4.108 / dropbox </pre><br>  Ahora todas las funciones de depuraci√≥n se muestran al hacer clic con el bot√≥n derecho en el icono de Dropbox en la bandeja del sistema. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/619/c68/385/619c6838574ff7023a0dbdf27b880b2d.png"></div><br><br>  Al estudiar m√°s a fondo las fuentes descompiladas, en el archivo <code>dropbox/webdebugger/server.py</code> descubr√≠ un m√©todo llamado <code>is_enabled</code> .  Parece que est√° comprobando si habilitar el depurador web incorporado.  En primer lugar, comprueba la llave m√°gica mencionada.  Como reemplazamos el hash SHA-256, simplemente podemos establecer el valor en <code>ANVILVENTURES</code> .  La segunda parte en las l√≠neas <code>201</code> y <code>202</code> verifica si hay una variable de entorno llamada <code>DB&lt;x&gt;</code> que tiene <code>x</code> igual al hash SHA-256.  El valor del entorno establece cookies de tiempo limitado, como ya hemos visto. <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">191</span></span> @classmethod <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cls._magic_key_set: <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls._magic_key_set <span class="hljs-number"><span class="hljs-number">195</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-number"><span class="hljs-number">196</span></span> cls._magic_key_set = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> magic_trace_key_is_set(): <span class="hljs-number"><span class="hljs-number">198</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">199</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.environ: <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var.startswith(<span class="hljs-string"><span class="hljs-string">'DB'</span></span>): <span class="hljs-number"><span class="hljs-number">201</span></span> var_hash = hashlib.sha256(make_bytes(var[<span class="hljs-number"><span class="hljs-number">2</span></span>:])).hexdigest() <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var_hash == <span class="hljs-string"><span class="hljs-string">'5df50a9c69f00ac71f873d02ff14f3b86e39600312c0b603cbb76b8b8a433d3ff0757214287b25fb01'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_valid_time_limited_cookie(os.environ[var]): <span class="hljs-number"><span class="hljs-number">203</span></span> cls._magic_key_set = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">204</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-number"><span class="hljs-number">205</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Usando exactamente la misma t√©cnica, reemplazando este hash con el SHA-256 que se us√≥ antes, ahora podemos cambiar el script <code>setenv</code> previamente escrito a algo como esto: <br><br><pre> <code class="python hljs"> $ cat setenv.py ‚Ä¶ c = generate_time_cookie() output_env(<span class="hljs-string"><span class="hljs-string">"DBDEV"</span></span>, <span class="hljs-string"><span class="hljs-string">"ANVILVENTURES"</span></span>) output_env(<span class="hljs-string"><span class="hljs-string">"DBANVILVENTURES"</span></span>, c) $ python3 setenv.py DBDEV=ANVILVENTURES; export DBDEV; DBANVILVENTURES=<span class="hljs-number"><span class="hljs-number">38</span></span>b285c4034a67; export DBANVILVENTURES $ eval `python3 setenv.py` $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number"><span class="hljs-number">-71.4</span></span><span class="hljs-number"><span class="hljs-number">.108</span></span>/dropbox</code> </pre> <br>  Como puede ver, despu√©s de iniciar el cliente, se abre un nuevo puerto TCP para escuchar.  No se abrir√° si las variables de entorno no est√°n configuradas correctamente. <br><br><pre>  $ netstat --tcp -lnp |  grep dropbox
     tcp 0 0 127.0.0.1:4242 0.0.0.0:* ESCUCHE 1517 / dropbox </pre><br>  M√°s adelante en el c√≥digo, puede encontrar la interfaz de WebSocket en el archivo <code>webpdb.pyc</code> .  Este es un contenedor para las utilidades est√°ndar de Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pdb</a> .  El acceso a la interfaz es a trav√©s de un servidor HTTP en este puerto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalemos el cliente websocket</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prob√©moslo</a> : <br><br><pre>  $ websocat -t ws: //127.0.0.1: 4242 / pdb
     --Volver--
    
     &gt; /home/gvb/dropbox/webdebugger/webpdb.pyc(101)run()-&gt;Ninguno
     &gt;
     (Pdb) de build_number.environment import magic_trace_key_is_set como ms
     (Pdb) ms ()
     Cierto </pre><br>  Por lo tanto, ahora tenemos un depurador completo en el cliente, que en todos los dem√°s aspectos funciona como antes.  Podemos ejecutar c√≥digo arbitrario de Python, pudimos habilitar el men√∫ interno de depuraci√≥n y las funciones de rastreo.  Todo esto ser√° de gran ayuda en el an√°lisis posterior del cliente de Dropbox. <br><br><h3>  Conclusi√≥n </h3><br>  Pudimos realizar ingenier√≠a inversa en Dropbox, escribir herramientas de descifrado e inyecci√≥n de c√≥digo que funcionan con clientes actuales de Dropbox basados ‚Äã‚Äãen Python 3.6.  Realizamos ingenier√≠a inversa de las funciones ocultas individuales y las activamos.  Obviamente, el depurador realmente ayudar√° en la pirater√≠a adicional.  Especialmente con una serie de archivos que no se pueden descompilar con √©xito debido a las desventajas de descompyle6. <br><br><h3>  C√≥digo </h3><br>  El c√≥digo se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en Github</a> .  Instrucciones de uso all√≠.  Este repositorio tambi√©n contiene mi antiguo c√≥digo escrito en 2011.  Deber√≠a funcionar con solo unas pocas modificaciones, siempre que alguien tenga versiones anteriores de Dropbox basadas en Python 2.7. <br><br>  El repositorio tambi√©n contiene scripts para transmitir c√≥digos de operaci√≥n, instrucciones para configurar las variables de entorno de Dropbox y todo lo necesario para cambiar el archivo zip. <br><br><h3>  Agradecimientos </h3><br>  Gracias a Brian de Anvil Ventures por revisar mi c√≥digo.  El trabajo en este c√≥digo continu√≥ durante varios a√±os, de vez en cuando lo actualic√©, introduje nuevos m√©todos y reescrib√≠ fragmentos para restaurarlo para que funcione en nuevas versiones de Dropbox. <br><br>  Como se mencion√≥ anteriormente, un gran punto de partida para las aplicaciones de Python de ingenier√≠a inversa es el trabajo de Rich Smith, Florian Ledoux y Nicolas Raff, as√≠ como Hagen Fritch.  Especialmente su trabajo es relevante para el desarrollo inverso de una de las aplicaciones de Python m√°s grandes del mundo: el cliente de Dropbox. <br><br>  Cabe se√±alar que la descompilaci√≥n del c√≥digo de Python ha avanzado mucho gracias al proyecto de Unpypy6 liderado por R. Bernstein.  Este descompilador ha compilado y mejorado muchos descompiladores de Python diferentes. <br><br>  Tambi√©n muchas gracias a los colegas Brian, Austin, Stefan y Chris por revisar este art√≠culo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452276/">https://habr.com/ru/post/452276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452264/index.html">C√≥mo creamos el sitio para el premio Mascot car</a></li>
<li><a href="../452266/index.html">Bastidores sin servidor</a></li>
<li><a href="../452268/index.html">Ventana anal√≥gica de C # WPF. ShowDialog () o tratar con DispatcherFrame</a></li>
<li><a href="../452270/index.html">La documentaci√≥n de la API de Xamarin ahora est√° disponible p√∫blicamente</a></li>
<li><a href="../452272/index.html">Chica bajo la cascada</a></li>
<li><a href="../452278/index.html">Bluetooth LE no da tanto miedo, ni c√≥mo mejorar la experiencia del usuario sin mucho esfuerzo</a></li>
<li><a href="../452280/index.html">PostgreSQL 11: la evoluci√≥n de la partici√≥n de Postgres 9.6 a Postgres 11</a></li>
<li><a href="../452282/index.html">Elemental, Watson: te integras con Voximplant</a></li>
<li><a href="../452284/index.html">Clasificaci√≥n de la cobertura del suelo utilizando eo-learn. Parte 1</a></li>
<li><a href="../452288/index.html">Situaci√≥n: operadores m√≥viles estadounidenses acusados ‚Äã‚Äãde comercio ilegal de geodatos de suscriptores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>