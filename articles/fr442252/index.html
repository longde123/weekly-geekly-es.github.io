<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üîÜ üßëüèø Cycle de vie du code Python - Mod√®le d'ex√©cution CPython ‚ò∏Ô∏è üë¢ üîê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Le printemps est arriv√©, ce qui signifie qu'il reste moins d'un mois avant le d√©but du cours Python Developer . C'est √† ce cours que s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cycle de vie du code Python - Mod√®le d'ex√©cution CPython</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/442252/">  Bonjour √† tous!  Le printemps est arriv√©, ce qui signifie qu'il reste moins d'un mois avant le d√©but du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours Python Developer</a> .  C'est √† ce cours que sera consacr√©e notre publication d'aujourd'hui. <br><br><img src="https://habrastorage.org/webt/8-/3n/pk/8-3npkdv_2mpp742_k0zytidc_k.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/9g/fe/cn/9gfecnorojbyoxcczknx1pyf--g.png"><br><br>  <i><b>T√¢ches:</b></i> <br><br>  - En savoir plus sur la structure interne de Python; <br>  - Comprendre les principes de construction d'un arbre de syntaxe abstraite (AST); <br>  - √âcrivez du code plus efficace en temps et en m√©moire. <br><br>  <i><b>Recommandations pr√©liminaires:</b></i> <br><br>  - Connaissance de base de l'interpr√®te (AST, jetons, etc.). <br>  - Connaissance de Python. <br>  - Connaissance de base de C. <br><br><pre><code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python --version Python <span class="hljs-number"><span class="hljs-number">3.7</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  <b>Mod√®le d'ex√©cution CPython</b> <br><br>  Python est un langage compil√© et interpr√©t√©.  Ainsi, le compilateur Python g√©n√®re des bytecodes et l'interpr√©teur les ex√©cute.  Au cours de l'article, nous examinerons les probl√®mes suivants: <br><br><ul><li>  Analyse et tokenisation: </li><li>  Transformation en AST; </li><li>  Graphique de flux de contr√¥le (CFG); </li><li>  Bytecode </li><li>  Ex√©cution sur une machine virtuelle CPython. </li></ul><br>  <b>Analyse et tokenisation.</b> <b><br></b>  <b>Grammaire.</b> <br><br>  La grammaire d√©finit la s√©mantique du langage Python.  Il est √©galement utile pour indiquer la fa√ßon dont l'analyseur doit interpr√©ter la langue.  La grammaire Python utilise une syntaxe similaire √† la forme √©tendue Backus-Naur.  Il a sa propre grammaire pour un traducteur de la langue source.  Vous pouvez trouver le fichier de grammaire dans le r√©pertoire "cpython / Grammar / Grammar". <br><br>  Ce qui suit est un exemple de grammaire, <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/cpython/Grammar ÓÇ∞ ÓÇ† master ÓÇ∞ grep <span class="hljs-string"><span class="hljs-string">"simple_stmt"</span></span> Grammar | head -n3 | tail -n1 simple_stmt: small_stmt (<span class="hljs-string"><span class="hljs-string">';'</span></span> small_stmt)* [<span class="hljs-string"><span class="hljs-string">';'</span></span>] NEWLINE</code> </pre> <br>  Les expressions simples contiennent de petites expressions et crochets, et la commande se termine par une nouvelle ligne.  Les petites expressions ressemblent √† une liste d'expressions qui importent ... <br>  Quelques autres expressions :) <br><br><pre> <code class="python hljs">small_stmt: (expr_stmt | del_stmt | pass_stmt | flow_stmt | import_stmt | global_stmt | nonlocal_stmt | assert_stmt) ... del_stmt: <span class="hljs-string"><span class="hljs-string">'del'</span></span> exprlist pass_stmt: <span class="hljs-string"><span class="hljs-string">'pass'</span></span> flow_stmt: break_stmt | continue_stmt | return_stmt | raise_stmt | yield_stmt break_stmt: <span class="hljs-string"><span class="hljs-string">'break'</span></span> continue_stmt: <span class="hljs-string"><span class="hljs-string">'continue'</span></span></code> </pre> <br>  <b>Tokenisation (Lexing)</b> <br><br>  La tokenisation est le processus d'obtention d'un flux de donn√©es de texte et de division en jetons de mots significatifs (pour l'interpr√®te) avec des m√©tadonn√©es suppl√©mentaires (par exemple, o√π le jeton commence et se termine, et quelle est la valeur de cha√Æne de ce jeton). <br><br>  <b>Jetons</b> <br><br>  Un jeton est un fichier d'en-t√™te contenant les d√©finitions de tous les jetons.  Il existe 59 types de jetons en Python (Include / token.h). <br><br>  Voici un exemple de certains d'entre eux, <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#define NAME 1 #define NUMBER 2 #define STRING 3 #define NEWLINE 4 #define INDENT 5 #define DEDENT 6</span></span></code> </pre> <br>  Vous les voyez si vous cassez du code Python en jetons. <br><br>  <b>Tokenisation avec CLI</b> <br><br>  Voici le fichier tests.py <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greetings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">f"Hello </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">"</span></span>) greetings(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>)</code> </pre> <br>  Ensuite, nous le jetons en jetons √† l'aide de la commande python -m tokenize et le r√©sultat suivant est g√©n√©r√©: <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python -m tokenize tests.py <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENCODING <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span> ... <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>: INDENT <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>: NAME <span class="hljs-string"><span class="hljs-string">'print'</span></span> ... <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: DEDENT <span class="hljs-string"><span class="hljs-string">''</span></span> ... <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENDMARKER <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre><br>  Ici, les chiffres (par exemple, 1.4-1.13) montrent o√π le jeton a commenc√© et o√π il s'est termin√©.  Un jeton de codage est toujours le tout premier jeton que nous recevons.  Il donne des informations sur l'encodage du fichier source et, en cas de probl√®me, l'interpr√©teur l√®ve une exception. <br><br>  <b>Tokenisation avec <i>tokenize.tokenize</i></b> <br><br>  Si vous devez tokenize le fichier √† partir de votre code, vous pouvez utiliser le module <i>tokenize</i> de <i>stdlib</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'tests.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> token <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokenize.tokenize(f.readline): ... print(token) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">57</span></span> (ENCODING), string=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), end=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), line=<span class="hljs-string"><span class="hljs-string">''</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">1</span></span> (NAME), string=<span class="hljs-string"><span class="hljs-string">'greetings'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">53</span></span> (OP), string=<span class="hljs-string"><span class="hljs-string">':'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ...</code> </pre> <br>  Le type de jeton est son identifiant dans le fichier d'en-t√™te <i>token.h.</i>  La cha√Æne est la valeur du jeton.  D√©but et fin indiquent respectivement le d√©but et la fin du jeton. <br><br>  Dans d'autres langages, les blocs sont indiqu√©s par des crochets ou des instructions begin / end, mais Python utilise des retraits et des niveaux diff√©rents.  Jetons INDENT et DEDENT et indiquent l'indentation.  Ces jetons sont n√©cessaires pour cr√©er des arbres d'analyse relationnelle et / ou des arbres de syntaxe abstraite. <br><br>  <b>G√©n√©ration de l'analyseur</b> <br><br>  G√©n√©ration de l'analyseur - un processus qui g√©n√®re un analyseur selon une grammaire donn√©e.  Les g√©n√©rateurs d'analyseurs sont appel√©s PGen.  Cpython poss√®de deux g√©n√©rateurs d'analyseurs.  L'un est l'original ( <code>Parser/pgen</code> ) et l'autre est r√©√©crit en python ( <code>/Lib/lib2to3/pgen2</code> ). <br><br>  <i>"Le g√©n√©rateur d'origine √©tait le premier code que j'ai √©crit pour Python"</i> <i><br></i>  <i>-Guido</i> <br><br>  De la citation ci-dessus, il devient clair que <i>pgen</i> est la chose la plus importante dans un langage de programmation.  Lorsque vous appelez pgen (dans <i>Parser / pgen</i> ), il g√©n√®re un fichier d'en-t√™te et un fichier C (l'analyseur lui-m√™me).  Si vous regardez le code C g√©n√©r√©, il peut sembler inutile, car son apparence significative est facultative.  Il contient de nombreuses donn√©es et structures statiques.  Ensuite, nous allons essayer d'expliquer ses principaux composants. <br><br>  <b>DFA (Machine √† √©tats d√©finis)</b> <br><br>  L'analyseur d√©finit un DFA pour chaque terminal non.  Chaque DFA est d√©fini comme un tableau d'√©tats. <br><br><pre> <code class="bash hljs">static dfa dfas[87] = { {256, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, 0, 3, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>}, ... {342, <span class="hljs-string"><span class="hljs-string">"yield_arg"</span></span>, 0, 3, states_86, <span class="hljs-string"><span class="hljs-string">"\000\040\200\000\002\000\000\000\000\040\010\000\000\000\020\002\000\300\220\050\037\000\000"</span></span>}, };</code> </pre> <br>  Pour chaque DFA, il existe un kit de d√©marrage qui montre avec quels jetons un non-terminal sp√©cial peut commencer. <br><br>  <b>Condition</b> <br><br>  Chaque √©tat est d√©fini par un tableau de transitions / ar√™tes (arcs). <br><br><pre> <code class="python hljs">static state states_86[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, arcs_86_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_2}, };</code> </pre> <br>  <b>Transitions (arcs)</b> <br><br>  Chaque tableau de transition a deux nombres.  Le premier nombre est le nom de la transition (√©tiquette d'arc), il fait r√©f√©rence au num√©ro de symbole.  Le deuxi√®me num√©ro est la destination. <br><br><pre> <code class="python hljs">static arc arcs_86_0[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, };</code> </pre><br>  <b>Noms (√©tiquettes)</b> <br><br>  Il s'agit d'un tableau sp√©cial qui mappe l'ID du caract√®re au nom de la transition. <br><br><pre> <code class="python hljs">static label labels[<span class="hljs-number"><span class="hljs-number">177</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"EMPTY"</span></span>}, {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"async"</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"yield"</span></span>}, {<span class="hljs-number"><span class="hljs-number">342</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, };</code> </pre> <br>  Le chiffre 1 correspond √† tous les identifiants.  Ainsi, chacun d'eux obtient des noms de transition diff√©rents, m√™me s'ils ont tous le m√™me identifiant de caract√®re. <br><br>  <i><b>Un exemple simple:</b></i> <br><br>  Supposons que nous ayons un code qui renvoie ¬´Hi¬ª si 1 - vrai: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Hi'</span></span>)</code> </pre> <br>  L'analyseur consid√®re ce code comme single_input. <br><br><pre> <code class="python hljs">single_input: NEWLINE | simple_stmt | compound_stmt NEWLINE</code> </pre> <br>  Ensuite, notre arbre d'analyse commence au n≈ìud racine d'une entr√©e unique. <br><br><img src="https://habrastorage.org/webt/xm/nl/r2/xmnlr287d0_vdkigdsqvtvpwhmi.png"><br><br>  Et la valeur de notre DFA (single_input) est 0. <br><br><pre> <code class="python hljs">static dfa dfas[<span class="hljs-number"><span class="hljs-number">87</span></span>] = { {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>} ... }</code> </pre><br>  Cela ressemblera √† ceci: <br><br><pre> <code class="python hljs">static arc arcs_0_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_0_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_0_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">3</span></span>, arcs_0_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_0_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,</code> </pre>  arcs_0_2}, <br>  }; <br><br>  Ici <code>arc_0_0</code> compose de trois √©l√©ments.  Le premier est <code>NEWLINE</code> , le second est <code>simple_stmt</code> et le dernier est <code>compound_stmt</code> . <br><br>  √âtant donn√© l'ensemble initial de <code>simple_stmt</code> nous pouvons conclure que <code>simple_stmt</code> ne peut pas commencer par <code>if</code> .  Cependant, m√™me si <code>if</code> n'est pas une nouvelle ligne, <code>compound_stmt</code> peut toujours commencer par <code>if</code> .  Ainsi, nous allons du dernier <code>arc ({4;2})</code> et ajoutons le n≈ìud <code>compound_stmt</code> √† l'arbre d'analyse et avant de passer au num√©ro 2, nous passons au nouveau DFA.  Nous obtenons un arbre d'analyse mis √† jour: <br><br><img src="https://habrastorage.org/webt/fv/lc/ac/fvlcacpcaci0gacypn7mwu7ldkm.png"><br><br>  Le nouveau DFA analyse les instructions compos√©es. <br><br><pre> <code class="python hljs">compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt | with_stmt | funcdef | classdef | decorated | async_stmt</code> </pre> <br>  Et nous obtenons ce qui suit: <br><br><pre> <code class="python hljs">static arc arcs_39_0[<span class="hljs-number"><span class="hljs-number">9</span></span>] = { {<span class="hljs-number"><span class="hljs-number">91</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">92</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">95</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">96</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_39_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_39[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">9</span></span>, arcs_39_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_39_1}, };</code> </pre><br>  Seul le premier saut peut commencer par <code>if</code> .  Nous obtenons un arbre d'analyse mis √† jour. <br><br><img src="https://habrastorage.org/webt/kh/q2/ru/khq2rutapnl3op6estdsfaznvwo.png"><br><br>  Ensuite, nous modifions √† nouveau le DFA et les ifs DFA suivants. <br><br><pre> <code class="python hljs">if_stmt: <span class="hljs-string"><span class="hljs-string">'if'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite (<span class="hljs-string"><span class="hljs-string">'elif'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite)* [<span class="hljs-string"><span class="hljs-string">'else'</span></span> <span class="hljs-string"><span class="hljs-string">':'</span></span> suite]</code> </pre> <br>  En cons√©quence, nous obtenons la seule transition avec la d√©signation 97. Elle co√Øncide avec le jeton <code>if</code> . <br><br><pre> <code class="python hljs">static arc arcs_41_0[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_41_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_41_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, }; static arc arcs_41_3[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_4[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">98</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_5[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, }; static arc arcs_41_6[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, }; ...</code> </pre> <br>  Lorsque nous passons √† l'√©tat suivant, en restant dans le m√™me DFA, le prochain arcs_41_1 n'a √©galement qu'une seule transition.  Cela est vrai pour le terminal de test.  Il doit commencer par un nombre (par exemple, 1). <br><br><img src="https://habrastorage.org/webt/f9/my/mh/f9mymh7fay4vovofermpmyfxegi.png"><br><br>  Il n'y a qu'une seule transition dans arc_41_2 qui obtient le jeton deux-points (:). <br><br><img src="https://habrastorage.org/webt/-f/qf/gn/-fqfgnvebdfvjez63wlbowzihdm.png"><br><br>  Nous obtenons donc un ensemble qui peut commencer par une valeur d'impression.  Enfin, passez √† arcs_41_4.  La premi√®re transition dans l'ensemble est une expression elif, la seconde est un autre et la troisi√®me est pour le dernier √©tat.  Et nous obtenons la vue finale de l'arbre d'analyse. <br><br><img src="https://habrastorage.org/webt/oj/_l/ye/oj_lyeqesfzsqv_iohr2yiunnqq.png"><br><br>  <b>Interface Python pour l'analyseur.</b> <b><br></b> <br><br>  Python vous permet de modifier l'arborescence d'analyse des expressions √† l'aide d'un module appel√© analyseur. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Vous pouvez g√©n√©rer un arbre de syntaxe sp√©cifique (Concrete Syntax Tree, CST) √† l'aide de parser.suite. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>parser.suite(code).tolist() [<span class="hljs-number"><span class="hljs-number">257</span></span>, [<span class="hljs-number"><span class="hljs-number">269</span></span>, [<span class="hljs-number"><span class="hljs-number">295</span></span>, [<span class="hljs-number"><span class="hljs-number">297</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'if'</span></span>], [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">':'</span></span>], [<span class="hljs-number"><span class="hljs-number">304</span></span>, [<span class="hljs-number"><span class="hljs-number">270</span></span>, [<span class="hljs-number"><span class="hljs-number">271</span></span>, [<span class="hljs-number"><span class="hljs-number">272</span></span>, [<span class="hljs-number"><span class="hljs-number">274</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'print'</span></span>]], [<span class="hljs-number"><span class="hljs-number">326</span></span>, [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'('</span></span>], [<span class="hljs-number"><span class="hljs-number">334</span></span>, [<span class="hljs-number"><span class="hljs-number">335</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"'Hi'"</span></span>]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">')'</span></span>]]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]</code> </pre> <br>  La valeur de sortie sera une liste imbriqu√©e.  Chaque liste de la structure comporte 2 √©l√©ments.  Le premier est l'id du caract√®re (0-256 - terminaux, 256+ - non-terminaux) et le second est la cha√Æne de jetons pour le terminal. <br><br>  <b>Arbre de syntaxe abstraite</b> <br><br>  En fait, un arbre de syntaxe abstraite (AST) est une repr√©sentation structurelle du code source sous la forme d'un arbre, o√π chaque sommet d√©note diff√©rents types de constructions de langage (expression, variable, op√©rateur, etc.) <br><br>  <b>Qu'est-ce qu'un arbre?</b> <br><br>  Un arbre est une structure de donn√©es qui a un sommet racine comme point de d√©part.  Le sommet racine est abaiss√© de branches (transitions) vers d'autres sommets.  Chaque sommet, √† l'exception de la racine, a un sommet parent unique. <br><br>  Il existe une certaine diff√©rence entre l'arbre de syntaxe abstraite et l'arbre d'analyse. <br><br><img src="https://habrastorage.org/webt/2o/ws/eb/2owsebsx9fqewbfmyxexaid5hm8.png"><br><br>  √Ä droite, un arbre d'analyse de l'expression 2 * 7 + 3.  Il s'agit litt√©ralement d'une image source biunivoque sous la forme d'un arbre.  Toutes les expressions, termes et valeurs y sont visibles.  Cependant, une telle image est trop compliqu√©e pour un simple morceau de code, nous pouvons donc simplement supprimer toutes les expressions syntaxiques que nous devions d√©finir dans le code pour les calculs. <br><br>  Un tel arbre simplifi√© est appel√© arbre de syntaxe abstraite (AST).  Sur la gauche de la figure, il est affich√© exactement pour le m√™me code.  Toutes les expressions de syntaxe ont √©t√© supprim√©es pour une meilleure compr√©hension, mais n'oubliez pas que certaines informations ont √©t√© perdues. <br><br>  <b>Exemple</b> <b><br></b> <br>  Python propose un module AST int√©gr√© pour travailler avec AST.  Pour g√©n√©rer du code √† partir d'arbres AST, vous pouvez utiliser des modules tiers, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Astor</a> . <br><br>  Par exemple, consid√©rez le m√™me code que pr√©c√©demment. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Pour obtenir AST, nous utilisons la m√©thode ast.parse. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>tree = ast.parse(code) &gt;&gt;&gt; tree &lt;_ast.Module object at <span class="hljs-number"><span class="hljs-number">0x7f37651d76d8</span></span>&gt;</code> </pre> <br>  Essayez d'utiliser la m√©thode <code>ast.dump</code> pour obtenir une arborescence de syntaxe abstraite plus lisible. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ast.dump(tree) <span class="hljs-string"><span class="hljs-string">"Module(body=[If(test=Num(n=1), body=[Expr(value=Call(func=Name(id='print', ctx=Load()), args=[Str(s='Hi')], keywords=[]))], orelse=[])])"</span></span></code> </pre> <br>  AST est g√©n√©ralement consid√©r√© comme plus visuel et plus facile √† comprendre que l'arbre d'analyse. <br><br>  <b>Contr√¥le de flux Graf (CFG)</b> <br><br>  Les graphiques de flux de contr√¥le sont des graphiques directionnels qui mod√©lisent le flux d'un programme √† l'aide de blocs de base qui contiennent une repr√©sentation interm√©diaire. <br><br>  En r√®gle g√©n√©rale, CFG est l'√©tape pr√©c√©dente avant d'obtenir les valeurs de code de sortie.  Le code est g√©n√©r√© directement √† partir des blocs de base √† l'aide d'une recherche de profondeur en arri√®re dans CFG, en commen√ßant par les sommets. <br><br>  <b>Bytecode</b> <br><br>  Le bytecode Python est un ensemble interm√©diaire d'instructions qui fonctionnent dans une machine virtuelle Python.  Lorsque vous ex√©cutez le code source, Python cr√©e un r√©pertoire appel√© __pycache__.  Il stocke le code compil√© afin de gagner du temps en cas de red√©marrage de la compilation. <br><br>  Consid√©rons une simple fonction Python dans func.py. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">say_hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, name) print(<span class="hljs-string"><span class="hljs-string">f"How are you </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">?"</span></span>)</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> func <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> say_hello &gt;&gt;&gt; say_hello(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>) Hello Batuhan How are you Batuhan?</code> </pre> <br>  Le <code>say_hello</code> objet <code>say_hello</code> est une fonction. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(say_hello) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Il a l'attribut <code>__code__</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__ &lt;code object say_hello at <span class="hljs-number"><span class="hljs-number">0x7f13777d9150</span></span>, file <span class="hljs-string"><span class="hljs-string">"/home/batuhan/blogs/cpython/exec_model/func.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;</code> </pre> <br>  <b>Objets de code</b> <br><br>  Les objets de code sont des structures de donn√©es immuables qui contiennent les instructions ou les m√©tadonn√©es n√©cessaires pour ex√©cuter le code.  Autrement dit, ce sont des repr√©sentations de code Python.  Vous pouvez √©galement obtenir des objets de code en compilant des arbres de syntaxe abstraite √† l'aide de la m√©thode de <i>compilation</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">""" ... def say_hello(name: str): ... print("Hello", name) ... print(f"How are you {name}?") ... say_hello("Batuhan") ... """</span></span> &gt;&gt;&gt; tree = ast.parse(code, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; code = compile(tree, <span class="hljs-string"><span class="hljs-string">'&lt;string&gt;'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; type(code) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">code</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Chaque objet de code poss√®de des attributs qui contiennent certaines informations (pr√©fix√©es par co_).  Nous n'en mentionnons ici que quelques-uns. <br><br>  <i><b>co_name</b></i> <br><br>  Pour commencer - un nom.  Si une fonction existe, elle doit avoir un nom, respectivement, ce nom sera le nom de la fonction, une situation similaire avec la classe.  Dans l'exemple AST, nous utilisons des modules et nous pouvons dire au compilateur exactement comment nous voulons les nommer.  Qu'ils ne soient qu'un <code>module</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>code.co_name <span class="hljs-string"><span class="hljs-string">'&lt;module&gt;'</span></span> &gt;&gt;&gt; say_hello.__code__.co_name <span class="hljs-string"><span class="hljs-string">'say_hello'</span></span></code> </pre> <br>  <i><b>co_varnames</b></i> <br><br>  Il s'agit d'un tuple contenant toutes les variables locales, y compris les arguments. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_varnames (<span class="hljs-string"><span class="hljs-string">'name'</span></span>,)</code> </pre> <br>  <i><b>co_conts</b></i> <br><br>  Un tuple contenant tous les litt√©raux et les valeurs constantes auxquels nous avons acc√©d√© dans le corps de la fonction.  Il convient de noter la valeur Aucune.  Nous n'avons pas inclus None dans le corps de la fonction, cependant, Python l'a indiqu√©, car si la fonction commence √† s'ex√©cuter puis se termine sans recevoir de valeurs de retour, elle renverra None. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_consts (<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'How are you '</span></span>, <span class="hljs-string"><span class="hljs-string">'?'</span></span>)</code> </pre> <br>  <b>Bytecode (co_code)</b> <br><br>  Ce qui suit est le bytecode de notre fonction. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>bytecode = say_hello.__code__.co_code &gt;&gt;&gt; bytecode <span class="hljs-string"><span class="hljs-string">b't\x00d\x01|\x00\x83\x02\x01\x00t\x00d\x02|\x00\x9b\x00d\x03\x9d\x03\x83\x01\x01\x00d\x00S\x00'</span></span></code> </pre> <br>  Ce n'est pas une cha√Æne, c'est un objet d'octets, c'est-√†-dire une s√©quence d'octets. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(bytecode) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bytes</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Le premier caract√®re imprim√© est ¬´t¬ª.  Si nous demandons sa valeur num√©rique, nous obtenons ce qui suit. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>) <span class="hljs-number"><span class="hljs-number">116</span></span></code> </pre> <br>  116 est identique au bytecode [0]. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>] == ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)</code> </pre><br>  Pour nous, une valeur de 116 ne veut rien dire.  Heureusement, Python fournit une biblioth√®que standard appel√©e dis (from disassembly).  Il est utile lorsque vous travaillez avec la liste des noms d'op√©rations.  Il s'agit d'une liste de toutes les instructions de bytecode, o√π chaque index est le nom de l'instruction. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)] <span class="hljs-string"><span class="hljs-string">'LOAD_GLOBAL'</span></span></code> </pre> <br>  Cr√©ons une autre fonction plus complexe. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiple_it</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: int)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * <span class="hljs-number"><span class="hljs-number">2</span></span> ... &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> &gt;&gt;&gt; bytecode = multiple_it.__code__.co_code</code> </pre> <br>  Et nous d√©couvrons la premi√®re instruction en bytecode. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST</span></span></code> </pre> <br>  L'instruction LOAD_FAST se compose de deux √©l√©ments. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST &lt;0&gt;'</span></span></code> </pre> <br>  L'instruction Loadfast 0 arrive √† rechercher des noms de variables dans un tuple et √† pousser un √©l√©ment avec un index z√©ro dans le tuple de la pile d'ex√©cution. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>multiple_it.__code__.co_varnames[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'a'</span></span></code> </pre> <br>  Notre code peut √™tre d√©mont√© en utilisant dis.dis et convertir le bytecode en une vue famili√®re.  Ici, les nombres (2,3,4) sont les num√©ros de ligne.  Chaque ligne de code en Python est d√©velopp√©e comme un ensemble d'instructions. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.dis(multiple_it) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">2</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> BINARY_MODULO <span class="hljs-number"><span class="hljs-number">6</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> COMPARE_OP <span class="hljs-number"><span class="hljs-number">2</span></span> (==) <span class="hljs-number"><span class="hljs-number">10</span></span> POP_JUMP_IF_FALSE <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> RETURN_VALUE <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">18</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span> BINARY_MULTIPLY <span class="hljs-number"><span class="hljs-number">22</span></span> RETURN_VALUE</code> </pre> <br>  <b>D√©lai de livraison</b> <br><br>  CPython est une machine virtuelle orient√©e pile, pas une collection de registres.  Cela signifie que le code Python est compil√© pour une machine virtuelle avec une architecture de pile. <br><br>  Lors de l'appel d'une fonction, Python utilise deux piles ensemble.  Le premier est la pile d'ex√©cution et le second est la pile de blocs.  La plupart des appels se produisent sur la pile d'ex√©cution;  la pile de blocs conserve une trace du nombre de blocs actuellement actifs, ainsi que d'autres param√®tres li√©s aux blocs et aux √©tendues. <br><br>  Nous attendons avec impatience vos commentaires sur le mat√©riel et vous invitons √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un webinaire ouvert</a> sur le sujet: ¬´Lib√©rez-le: aspects pratiques de la publication d'un logiciel fiable¬ª, qui sera dirig√© par notre enseignant, le programmeur du syst√®me publicitaire de Mail.Ru, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stanislav Stupnikov</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442252/">https://habr.com/ru/post/fr442252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442238/index.html">Utilisation des comptes intelligents Waves: des ench√®res aux programmes de bonus</a></li>
<li><a href="../fr442242/index.html">Derni√®res nouvelles: Inauguration de la plus grande usine de cellules solaires de l'h√©misph√®re occidental</a></li>
<li><a href="../fr442244/index.html">Rust 1.33 Release</a></li>
<li><a href="../fr442248/index.html">La NASA a approuv√© le lancement du test sans pilote de Dragon-2</a></li>
<li><a href="../fr442250/index.html">React and Vue: Forces</a></li>
<li><a href="../fr442256/index.html">D√©fense num√©rique du monde plastique des r√©gulateurs Internet nationaux</a></li>
<li><a href="../fr442258/index.html">Web scraping pour les d√©veloppeurs web: un bref r√©sum√©</a></li>
<li><a href="../fr442260/index.html">10 commandes Git qu'un d√©veloppeur doit savoir</a></li>
<li><a href="../fr442262/index.html">Secret du firmware</a></li>
<li><a href="../fr442264/index.html">√âliminer les opportunit√©s de d√©tournement de trafic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>