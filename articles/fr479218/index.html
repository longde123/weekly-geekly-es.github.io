<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ‘§ ğŸ‘¨ğŸ¼â€âš•ï¸ ğŸ‘©ğŸ¿â€ğŸ”¬ Comment faire un bot qui transforme une photo en bande dessinÃ©e: instructions Ã©tape par Ã©tape pour les nuls ğŸ˜„ ğŸ˜¶ â›½ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PremiÃ¨re partie, complÃ©tÃ©e. 
  Cotans, salut. 
 Je suis Sasha et je me livre aux neurones. 

 Ã€ la demande des travailleurs, j'ai finalement rassemblÃ©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment faire un bot qui transforme une photo en bande dessinÃ©e: instructions Ã©tape par Ã©tape pour les nuls</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479218/">  <i>PremiÃ¨re partie, complÃ©tÃ©e.</i> <i><br></i> <blockquote>  Cotans, salut. <br>  Je suis Sasha et je me livre aux neurones. <br><br>  Ã€ la demande des travailleurs, j'ai finalement rassemblÃ© mes pensÃ©es et dÃ©cidÃ© de couper une sÃ©rie d'instructions courtes et presque pas Ã  pas. <br><br>  Des instructions sur la faÃ§on de former et de dÃ©ployer votre rÃ©seau de neurones Ã  partir de zÃ©ro, tout en se faisant des amis avec le bot de tÃ©lÃ©gramme. <br><br>  Instructions pour les nuls comme moi. </blockquote>  Aujourd'hui, nous allons choisir l'architecture de notre rÃ©seau de neurones, la tester et collecter notre premier ensemble de donnÃ©es d'entraÃ®nement. <br><br><h2>  Choix d'architecture </h2><br>  AprÃ¨s le lancement relativement rÃ©ussi du robot <a href="https://t.me/selfie2animebot" rel="nofollow">selfie2anime</a> (en utilisant le modÃ¨le <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> prÃªt Ã  l'emploi), je voulais faire de mÃªme, mais le mien.  Par exemple, un modÃ¨le qui transforme vos photos en bandes dessinÃ©es. <br><br>  Voici quelques exemples de mon <a href="https://t.me/photo2comicsbot" rel="nofollow">photo2comicsbot</a> , et nous ferons quelque chose de similaire. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/7h/yh/sk/7hyhskjvb1hhlhfyiytr5afcl4q.png"><br><img src="https://habrastorage.org/webt/5c/qd/av/5cqdavi7b-i_fna2ienr4_5hrmu.png"><br><img src="https://habrastorage.org/webt/ej/vy/tn/ejvytnyo92bdr-jmitilezpt60k.png"><br><br>  Comme le modÃ¨le <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> Ã©tait trop lourd pour ma carte vidÃ©o, j'ai attirÃ© l'attention sur une analogie plus ancienne mais moins vorace - <a href="https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix" rel="nofollow">CycleGAN</a> <br><br>  Dans cette implÃ©mentation, il existe plusieurs architectures de modÃ¨le et un affichage visuel pratique du processus d'apprentissage dans le navigateur. <br><br>  CycleGAN, comme les <a href="https://github.com/lengstrom/fast-style-transfer" rel="nofollow">architectures pour le transfert de styles</a> sur une seule image, ne nÃ©cessite pas d'images jumelÃ©es pour la formation.  C'est important, car sinon, il faudrait redessiner toutes les photos nous-mÃªmes en bandes dessinÃ©es pour crÃ©er un ensemble d'entraÃ®nement. <br><br>  La tÃ¢che que nous allons dÃ©finir pour notre algorithme se compose de deux parties. <br>  Ã€ la sortie, nous devrions obtenir une image qui: <br><br>  a) semblable Ã  une bande dessinÃ©e <br>  b) similaire Ã  l'image originale <br><br>  Le point Â«aÂ» peut Ãªtre mis en Å“uvre en utilisant le GAN habituel, oÃ¹ le critique formÃ© sera responsable de Â«ressembler Ã  des bandes dessinÃ©esÂ». <br><br><div class="spoiler">  <b class="spoiler_title">Plus sur GAN</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-g/j-/hq/-gj-hqvnumsgc7k1xuaau7d8tfe.jpeg"><br><br>  Le GAN, ou Generative Adversarial Network, est une paire de deux rÃ©seaux de neurones: Generator et Critic. <br>  Le gÃ©nÃ©rateur convertit l'entrÃ©e, par exemple, d'une photo en bande dessinÃ©e, et le critique compare le rÃ©sultat Â«fauxÂ» rÃ©sultant avec une vraie bande dessinÃ©e.  Le travail du gÃ©nÃ©rateur est de tromper le critique, et vice versa. <br><br>  Dans le processus d'apprentissage, le gÃ©nÃ©rateur apprend Ã  crÃ©er des bandes dessinÃ©es qui sont de plus en plus similaires aux vraies, et le critique apprend Ã  mieux les distinguer. <br></div></div><br>  La deuxiÃ¨me partie est un peu plus compliquÃ©e.  Si nous avions des images jumelÃ©es, oÃ¹ il y aurait des photographies dans l'ensemble Â«AÂ» et dans l'ensemble Â«BÂ», elles Ã©taient, mais redessinÃ©es en bandes dessinÃ©es (c'est-Ã -dire ce que nous voulons obtenir du modÃ¨le), nous pourrions juste pour comparer le rÃ©sultat produit par le gÃ©nÃ©rateur avec l'image appariÃ©e de l'ensemble Â«BÂ» de notre ensemble d'entraÃ®nement. <br><br>  Dans notre cas, les ensembles Â«AÂ» et Â«BÂ» ne sont en aucun cas liÃ©s les uns aux autres.  Dans l'ensemble Â«AÂ» - photos alÃ©atoires, dans l'ensemble Â«BÂ» - bandes dessinÃ©es alÃ©atoires. <br><br>  Il est inutile de comparer une fausse bande dessinÃ©e avec une bande dessinÃ©e alÃ©atoire de l'ensemble Â«BÂ», car cela dupliquera au moins la fonction du critique, sans parler du rÃ©sultat imprÃ©visible. <br><br>  C'est lÃ  que l'architecture CycleGAN vient Ã  la rescousse. <br><br>  En bref, il s'agit d'une paire GAN, dont la premiÃ¨re convertit l'image de la catÃ©gorie "A" (par exemple, une photo) en catÃ©gorie "B" (par exemple, une bande dessinÃ©e), et la seconde en arriÃ¨re, de la catÃ©gorie "B" Ã  la catÃ©gorie "A". <br><br><img src="https://habrastorage.org/webt/jl/0d/eg/jl0deg09yccaa8sez0djtsti4fo.jpeg"><br><br>  Les modÃ¨les sont formÃ©s Ã  la fois sur la base de la comparaison de la photo originale avec celle restaurÃ©e (Ã  la suite du cycle "A" - "B" - "A", "photo-bande dessinÃ©e-photo), et des donnÃ©es des critiques, comme dans un GAN ordinaire. <br><br>  Cela permet de remplir les deux parties de notre tÃ¢che: gÃ©nÃ©rer une bande dessinÃ©e indiscernable des autres bandes dessinÃ©es, et en mÃªme temps similaire Ã  la photo originale. <br><br><h2>  Installation et vÃ©rification du modÃ¨le </h2><br>  Pour mettre en Å“uvre notre plan astucieux, nous avons besoin de: <br><br><ul><li>  Carte graphique compatible CUDA avec 8 Go de RAM </li><li>  Linux OS </li><li>  Miniconda / Anaconda avec Python 3.5+ </li></ul><br>  Les cartes vidÃ©o avec moins de 8 Go de RAM peuvent Ã©galement fonctionner si vous Ã©voquez les paramÃ¨tres.  Cela fonctionnera Ã©galement sur Windows, mais plus lentement, j'ai eu une diffÃ©rence d'au moins 1,5-2 fois. <br><br>  <i>Si vous n'avez pas de GPU avec prise en charge CUDA, ou si vous Ãªtes trop paresseux pour tout configurer, vous pouvez toujours utiliser Google Colab.</i>  <i>S'il y a un nombre suffisant de personnes qui le souhaitent, je vais remplir le didacticiel et savoir comment monter tout ce qui suit dans un cloud Google.</i> <br><br>  <a href="https://docs.conda.io/en/latest/miniconda.html" rel="nofollow">Miniconda peut Ãªtre prise ici</a> <br>  <a href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html" rel="nofollow">Instructions d'installation</a> <br><br>  AprÃ¨s avoir installÃ© Anaconda / Miniconda (ci-aprÃ¨s dÃ©nommÃ© conda), crÃ©ez un nouvel environnement pour nos expÃ©riences et activez-le: <br><br>  <i>(Les utilisateurs de Windows doivent d'abord dÃ©marrer Anaconda Prompt Ã  partir du menu DÃ©marrer)</i> <br><br><pre><code class="bash hljs">conda create --name cyclegan conda activate cyclegan</code> </pre> <br>  DÃ©sormais, tous les packages seront installÃ©s dans l'environnement actif sans affecter le reste de l'environnement.  Cela est pratique si vous avez besoin de certaines combinaisons de versions de divers packages, par exemple, si vous utilisez l'ancien code de quelqu'un d'autre et que vous devez installer des packages obsolÃ¨tes sans gÃ¢cher votre vie et votre environnement de travail principal. <br><br>  Ensuite, suivez simplement les instructions README.MD de la distribution: <br><br>  Enregistrez la distribution CycleGAN: <br><br>  <i>(ou tÃ©lÃ©chargez simplement l'archive depuis GitHub)</i> <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pytorch-CycleGAN-and-pix2pix</code> </pre> <br>  Installez les packages nÃ©cessaires: <br><br><pre> <code class="bash hljs">conda install numpy pyyaml mkl mkl-include setuptools cmake cffi typing conda install pytorch torchvision -c pytorch conda install visdom dominate -c conda-forge</code> </pre> <br>  TÃ©lÃ©chargez l'ensemble de donnÃ©es fini et le modÃ¨le correspondant: <br><br><pre> <code class="bash hljs">bash ./datasets/download_cyclegan_dataset.sh horse2zebra bash ./scripts/download_cyclegan_model.sh horse2zebra</code> </pre> <br>  Faites attention aux photos qui se trouvent dans le jeu de donnÃ©es tÃ©lÃ©chargÃ©. <br><br>  Si vous ouvrez les fichiers de script du paragraphe prÃ©cÃ©dent, vous pouvez voir qu'il existe d'autres jeux de donnÃ©es et modÃ¨les prÃªts Ã  l'emploi pour eux. <br><br>  Enfin, testez le modÃ¨le sur l'ensemble de donnÃ©es tÃ©lÃ©chargÃ©: <br><br><pre> <code class="bash hljs">python test.py --dataroot datasets/horse2zebra/testA --name horse2zebra_pretrained --model <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --no_dropout</code> </pre><br>  Les rÃ©sultats seront enregistrÃ©s dans le dossier / results / horse2zebra_pretrained / <br><br><h2>  CrÃ©ation d'un ensemble d'entraÃ®nement </h2><br>  Une Ã©tape tout aussi importante aprÃ¨s avoir choisi l'architecture du futur modÃ¨le (et recherchÃ© une implÃ©mentation terminÃ©e sur github) est de compiler un ensemble de donnÃ©es, ou un ensemble de donnÃ©es, sur lequel nous formerons et testerons notre modÃ¨le. <br><blockquote>  Presque tout dÃ©pend des donnÃ©es que nous utilisons.  Par exemple, <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> pour le bot <a href="https://t.me/selfie2animebot" rel="nofollow">selfie2anime a</a> Ã©tÃ© formÃ© sur les selfies fÃ©minines et les visages fÃ©minins de l'anime.  Par consÃ©quent, avec des photos masculines, elle se comporte au moins drÃ´le, remplaÃ§ant les hommes barbus brutaux par des petites filles avec un col haut.  Sur la photo, votre humble serviteur aprÃ¨s avoir appris qu'il regardait un anime. <br><br><img src="https://habrastorage.org/webt/iz/b1/yl/izb1yltkkhenla6oo5ajvbqrujg.jpeg"><br><br>  Comme vous l'avez dÃ©jÃ  compris, il vaut la peine de sÃ©lectionner les photos / bandes dessinÃ©es que vous souhaitez utiliser en entrÃ©e et en sortie.  Envisagez-vous de traiter des selfies - ajoutez des selfies et des gros plans de visages de bandes dessinÃ©es, des photos de bÃ¢timents - ajoutez des photos de bÃ¢timents et des pages de bandes dessinÃ©es avec des bÃ¢timents. <br></blockquote>  Comme exemples de photos, j'ai utilisÃ© <a href="" rel="nofollow">DIV2K</a> et <a href="" rel="nofollow">Urban100</a> , aromatisÃ©s avec des photos d'Ã©toiles Google pour amÃ©liorer la diversitÃ©. <br><br>  J'ai pris des bandes dessinÃ©es de l'univers Marvel, la page entiÃ¨re, jetant des publicitÃ©s et des annonces oÃ¹ l'image ne ressemble pas Ã  une bande dessinÃ©e.  Je ne peux pas joindre le lien pour des raisons Ã©videntes, mais Ã  la demande de Marvel Comics, vous pouvez facilement trouver des options numÃ©risÃ©es sur vos sites prÃ©fÃ©rÃ©s avec des bandes dessinÃ©es, si vous savez ce que je veux dire. <br><br>  Il est important de faire attention au dessin, il diffÃ¨re selon les sÃ©ries et le jeu de couleurs. <br><br><img src="https://habrastorage.org/webt/qn/na/7e/qnna7eye4d7reejujjdafcv682a.png"><br><br>  J'ai eu beaucoup de deadpool et spiderman, donc la peau devient trÃ¨s rouge. <br><br>  Une liste incomplÃ¨te d'autres jeux de donnÃ©es publics peut Ãªtre trouvÃ©e <a href="http://datasets.visionbib.com/info-index.html" rel="nofollow">ici</a> . <br><br>  La structure des dossiers dans notre ensemble de donnÃ©es doit Ãªtre la suivante: <br><br>  selfie2comics <br>  â”œâ”€â”€ trainA <br>  â”œâ”€â”€ trainB <br>  â”œâ”€â”€ testA <br>  â””â”€â”€ testB <br><br>  trainA - nos photos (environ 1000pcs) <br>  testA - quelques photos pour les tests de modÃ¨les (30 piÃ¨ces suffiront) <br>  trainB - nos bandes dessinÃ©es (environ 1000 pcs.) <br>  testB - bandes dessinÃ©es pour les tests (30pcs.) <br><br>  Il est conseillÃ© de placer le jeu de donnÃ©es sur un SSD, si possible. <br><br>  C'est tout pour aujourd'hui, dans le prochain numÃ©ro, nous commencerons Ã  former le modÃ¨le et Ã  obtenir les premiers rÃ©sultats! <br><br>  Assurez-vous d'Ã©crire si quelque chose ne va pas avec vous, cela aidera Ã  amÃ©liorer le leadership et Ã  soulager la souffrance des lecteurs suivants. <br><br>  Si vous avez dÃ©jÃ  essayÃ© de former le modÃ¨le, n'hÃ©sitez pas Ã  partager les rÃ©sultats dans les commentaires.  A trÃ¨s bientÃ´t! <br><br>  <a href="https://habr.com/ru/post/483168/">â‡¨ Partie suivante</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479218/">https://habr.com/ru/post/fr479218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479200/index.html">Compression d'image fractale</a></li>
<li><a href="../fr479202/index.html">C ++ et mÃ©thodes numÃ©riques: intÃ©gration approximative de Newton-Cotes</a></li>
<li><a href="../fr479210/index.html">Qu'adviendra-t-il des achats dans les magasins en ligne Ã©trangers Ã  partir du 1er janvier 2020</a></li>
<li><a href="../fr479214/index.html">Une sÃ©lection d'Ã©vÃ©nements gratuits Ã  venir pour les dÃ©veloppeurs Ã  Moscou # 2</a></li>
<li><a href="../fr479216/index.html">Pandora DXL 3000 Second Wind ou comment j'ai vissÃ© ma propre tÃ©lÃ©mÃ©trie</a></li>
<li><a href="../fr479220/index.html">Nano-neurone - 7 fonctions JavaScript simples montrant comment la machine peut "apprendre"</a></li>
<li><a href="../fr479222/index.html">Le condensÃ© de matÃ©riaux intÃ©ressants pour le dÃ©veloppeur mobile # 325 (du 2 au 8 dÃ©cembre)</a></li>
<li><a href="../fr479226/index.html">Habr-analysis: ce que les utilisateurs commandent en cadeau Ã  Habr</a></li>
<li><a href="../fr479230/index.html">Documentez votre API express avec des annotations fanfaronnades</a></li>
<li><a href="../fr479232/index.html">DÃ©veloppement d'applications MQ JMS sur Spring Boot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>