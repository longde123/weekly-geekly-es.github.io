<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👧 👨🏼‍⚕️ 👩🏿‍🔬 Comment faire un bot qui transforme une photo en bande dessinée: instructions étape par étape pour les nuls 😄 😶 ⛽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Première partie, complétée. 
  Cotans, salut. 
 Je suis Sasha et je me livre aux neurones. 

 À la demande des travailleurs, j'ai finalement rassemblé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment faire un bot qui transforme une photo en bande dessinée: instructions étape par étape pour les nuls</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479218/">  <i>Première partie, complétée.</i> <i><br></i> <blockquote>  Cotans, salut. <br>  Je suis Sasha et je me livre aux neurones. <br><br>  À la demande des travailleurs, j'ai finalement rassemblé mes pensées et décidé de couper une série d'instructions courtes et presque pas à pas. <br><br>  Des instructions sur la façon de former et de déployer votre réseau de neurones à partir de zéro, tout en se faisant des amis avec le bot de télégramme. <br><br>  Instructions pour les nuls comme moi. </blockquote>  Aujourd'hui, nous allons choisir l'architecture de notre réseau de neurones, la tester et collecter notre premier ensemble de données d'entraînement. <br><br><h2>  Choix d'architecture </h2><br>  Après le lancement relativement réussi du robot <a href="https://t.me/selfie2animebot" rel="nofollow">selfie2anime</a> (en utilisant le modèle <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> prêt à l'emploi), je voulais faire de même, mais le mien.  Par exemple, un modèle qui transforme vos photos en bandes dessinées. <br><br>  Voici quelques exemples de mon <a href="https://t.me/photo2comicsbot" rel="nofollow">photo2comicsbot</a> , et nous ferons quelque chose de similaire. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/7h/yh/sk/7hyhskjvb1hhlhfyiytr5afcl4q.png"><br><img src="https://habrastorage.org/webt/5c/qd/av/5cqdavi7b-i_fna2ienr4_5hrmu.png"><br><img src="https://habrastorage.org/webt/ej/vy/tn/ejvytnyo92bdr-jmitilezpt60k.png"><br><br>  Comme le modèle <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> était trop lourd pour ma carte vidéo, j'ai attiré l'attention sur une analogie plus ancienne mais moins vorace - <a href="https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix" rel="nofollow">CycleGAN</a> <br><br>  Dans cette implémentation, il existe plusieurs architectures de modèle et un affichage visuel pratique du processus d'apprentissage dans le navigateur. <br><br>  CycleGAN, comme les <a href="https://github.com/lengstrom/fast-style-transfer" rel="nofollow">architectures pour le transfert de styles</a> sur une seule image, ne nécessite pas d'images jumelées pour la formation.  C'est important, car sinon, il faudrait redessiner toutes les photos nous-mêmes en bandes dessinées pour créer un ensemble d'entraînement. <br><br>  La tâche que nous allons définir pour notre algorithme se compose de deux parties. <br>  À la sortie, nous devrions obtenir une image qui: <br><br>  a) semblable à une bande dessinée <br>  b) similaire à l'image originale <br><br>  Le point «a» peut être mis en œuvre en utilisant le GAN habituel, où le critique formé sera responsable de «ressembler à des bandes dessinées». <br><br><div class="spoiler">  <b class="spoiler_title">Plus sur GAN</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-g/j-/hq/-gj-hqvnumsgc7k1xuaau7d8tfe.jpeg"><br><br>  Le GAN, ou Generative Adversarial Network, est une paire de deux réseaux de neurones: Generator et Critic. <br>  Le générateur convertit l'entrée, par exemple, d'une photo en bande dessinée, et le critique compare le résultat «faux» résultant avec une vraie bande dessinée.  Le travail du générateur est de tromper le critique, et vice versa. <br><br>  Dans le processus d'apprentissage, le générateur apprend à créer des bandes dessinées qui sont de plus en plus similaires aux vraies, et le critique apprend à mieux les distinguer. <br></div></div><br>  La deuxième partie est un peu plus compliquée.  Si nous avions des images jumelées, où il y aurait des photographies dans l'ensemble «A» et dans l'ensemble «B», elles étaient, mais redessinées en bandes dessinées (c'est-à-dire ce que nous voulons obtenir du modèle), nous pourrions juste pour comparer le résultat produit par le générateur avec l'image appariée de l'ensemble «B» de notre ensemble d'entraînement. <br><br>  Dans notre cas, les ensembles «A» et «B» ne sont en aucun cas liés les uns aux autres.  Dans l'ensemble «A» - photos aléatoires, dans l'ensemble «B» - bandes dessinées aléatoires. <br><br>  Il est inutile de comparer une fausse bande dessinée avec une bande dessinée aléatoire de l'ensemble «B», car cela dupliquera au moins la fonction du critique, sans parler du résultat imprévisible. <br><br>  C'est là que l'architecture CycleGAN vient à la rescousse. <br><br>  En bref, il s'agit d'une paire GAN, dont la première convertit l'image de la catégorie "A" (par exemple, une photo) en catégorie "B" (par exemple, une bande dessinée), et la seconde en arrière, de la catégorie "B" à la catégorie "A". <br><br><img src="https://habrastorage.org/webt/jl/0d/eg/jl0deg09yccaa8sez0djtsti4fo.jpeg"><br><br>  Les modèles sont formés à la fois sur la base de la comparaison de la photo originale avec celle restaurée (à la suite du cycle "A" - "B" - "A", "photo-bande dessinée-photo), et des données des critiques, comme dans un GAN ordinaire. <br><br>  Cela permet de remplir les deux parties de notre tâche: générer une bande dessinée indiscernable des autres bandes dessinées, et en même temps similaire à la photo originale. <br><br><h2>  Installation et vérification du modèle </h2><br>  Pour mettre en œuvre notre plan astucieux, nous avons besoin de: <br><br><ul><li>  Carte graphique compatible CUDA avec 8 Go de RAM </li><li>  Linux OS </li><li>  Miniconda / Anaconda avec Python 3.5+ </li></ul><br>  Les cartes vidéo avec moins de 8 Go de RAM peuvent également fonctionner si vous évoquez les paramètres.  Cela fonctionnera également sur Windows, mais plus lentement, j'ai eu une différence d'au moins 1,5-2 fois. <br><br>  <i>Si vous n'avez pas de GPU avec prise en charge CUDA, ou si vous êtes trop paresseux pour tout configurer, vous pouvez toujours utiliser Google Colab.</i>  <i>S'il y a un nombre suffisant de personnes qui le souhaitent, je vais remplir le didacticiel et savoir comment monter tout ce qui suit dans un cloud Google.</i> <br><br>  <a href="https://docs.conda.io/en/latest/miniconda.html" rel="nofollow">Miniconda peut être prise ici</a> <br>  <a href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html" rel="nofollow">Instructions d'installation</a> <br><br>  Après avoir installé Anaconda / Miniconda (ci-après dénommé conda), créez un nouvel environnement pour nos expériences et activez-le: <br><br>  <i>(Les utilisateurs de Windows doivent d'abord démarrer Anaconda Prompt à partir du menu Démarrer)</i> <br><br><pre><code class="bash hljs">conda create --name cyclegan conda activate cyclegan</code> </pre> <br>  Désormais, tous les packages seront installés dans l'environnement actif sans affecter le reste de l'environnement.  Cela est pratique si vous avez besoin de certaines combinaisons de versions de divers packages, par exemple, si vous utilisez l'ancien code de quelqu'un d'autre et que vous devez installer des packages obsolètes sans gâcher votre vie et votre environnement de travail principal. <br><br>  Ensuite, suivez simplement les instructions README.MD de la distribution: <br><br>  Enregistrez la distribution CycleGAN: <br><br>  <i>(ou téléchargez simplement l'archive depuis GitHub)</i> <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pytorch-CycleGAN-and-pix2pix</code> </pre> <br>  Installez les packages nécessaires: <br><br><pre> <code class="bash hljs">conda install numpy pyyaml mkl mkl-include setuptools cmake cffi typing conda install pytorch torchvision -c pytorch conda install visdom dominate -c conda-forge</code> </pre> <br>  Téléchargez l'ensemble de données fini et le modèle correspondant: <br><br><pre> <code class="bash hljs">bash ./datasets/download_cyclegan_dataset.sh horse2zebra bash ./scripts/download_cyclegan_model.sh horse2zebra</code> </pre> <br>  Faites attention aux photos qui se trouvent dans le jeu de données téléchargé. <br><br>  Si vous ouvrez les fichiers de script du paragraphe précédent, vous pouvez voir qu'il existe d'autres jeux de données et modèles prêts à l'emploi pour eux. <br><br>  Enfin, testez le modèle sur l'ensemble de données téléchargé: <br><br><pre> <code class="bash hljs">python test.py --dataroot datasets/horse2zebra/testA --name horse2zebra_pretrained --model <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --no_dropout</code> </pre><br>  Les résultats seront enregistrés dans le dossier / results / horse2zebra_pretrained / <br><br><h2>  Création d'un ensemble d'entraînement </h2><br>  Une étape tout aussi importante après avoir choisi l'architecture du futur modèle (et recherché une implémentation terminée sur github) est de compiler un ensemble de données, ou un ensemble de données, sur lequel nous formerons et testerons notre modèle. <br><blockquote>  Presque tout dépend des données que nous utilisons.  Par exemple, <a href="https://github.com/taki0112/UGATIT" rel="nofollow">UGATIT</a> pour le bot <a href="https://t.me/selfie2animebot" rel="nofollow">selfie2anime a</a> été formé sur les selfies féminines et les visages féminins de l'anime.  Par conséquent, avec des photos masculines, elle se comporte au moins drôle, remplaçant les hommes barbus brutaux par des petites filles avec un col haut.  Sur la photo, votre humble serviteur après avoir appris qu'il regardait un anime. <br><br><img src="https://habrastorage.org/webt/iz/b1/yl/izb1yltkkhenla6oo5ajvbqrujg.jpeg"><br><br>  Comme vous l'avez déjà compris, il vaut la peine de sélectionner les photos / bandes dessinées que vous souhaitez utiliser en entrée et en sortie.  Envisagez-vous de traiter des selfies - ajoutez des selfies et des gros plans de visages de bandes dessinées, des photos de bâtiments - ajoutez des photos de bâtiments et des pages de bandes dessinées avec des bâtiments. <br></blockquote>  Comme exemples de photos, j'ai utilisé <a href="" rel="nofollow">DIV2K</a> et <a href="" rel="nofollow">Urban100</a> , aromatisés avec des photos d'étoiles Google pour améliorer la diversité. <br><br>  J'ai pris des bandes dessinées de l'univers Marvel, la page entière, jetant des publicités et des annonces où l'image ne ressemble pas à une bande dessinée.  Je ne peux pas joindre le lien pour des raisons évidentes, mais à la demande de Marvel Comics, vous pouvez facilement trouver des options numérisées sur vos sites préférés avec des bandes dessinées, si vous savez ce que je veux dire. <br><br>  Il est important de faire attention au dessin, il diffère selon les séries et le jeu de couleurs. <br><br><img src="https://habrastorage.org/webt/qn/na/7e/qnna7eye4d7reejujjdafcv682a.png"><br><br>  J'ai eu beaucoup de deadpool et spiderman, donc la peau devient très rouge. <br><br>  Une liste incomplète d'autres jeux de données publics peut être trouvée <a href="http://datasets.visionbib.com/info-index.html" rel="nofollow">ici</a> . <br><br>  La structure des dossiers dans notre ensemble de données doit être la suivante: <br><br>  selfie2comics <br>  ├── trainA <br>  ├── trainB <br>  ├── testA <br>  └── testB <br><br>  trainA - nos photos (environ 1000pcs) <br>  testA - quelques photos pour les tests de modèles (30 pièces suffiront) <br>  trainB - nos bandes dessinées (environ 1000 pcs.) <br>  testB - bandes dessinées pour les tests (30pcs.) <br><br>  Il est conseillé de placer le jeu de données sur un SSD, si possible. <br><br>  C'est tout pour aujourd'hui, dans le prochain numéro, nous commencerons à former le modèle et à obtenir les premiers résultats! <br><br>  Assurez-vous d'écrire si quelque chose ne va pas avec vous, cela aidera à améliorer le leadership et à soulager la souffrance des lecteurs suivants. <br><br>  Si vous avez déjà essayé de former le modèle, n'hésitez pas à partager les résultats dans les commentaires.  A très bientôt! <br><br>  <a href="https://habr.com/ru/post/483168/">⇨ Partie suivante</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479218/">https://habr.com/ru/post/fr479218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479200/index.html">Compression d'image fractale</a></li>
<li><a href="../fr479202/index.html">C ++ et méthodes numériques: intégration approximative de Newton-Cotes</a></li>
<li><a href="../fr479210/index.html">Qu'adviendra-t-il des achats dans les magasins en ligne étrangers à partir du 1er janvier 2020</a></li>
<li><a href="../fr479214/index.html">Une sélection d'événements gratuits à venir pour les développeurs à Moscou # 2</a></li>
<li><a href="../fr479216/index.html">Pandora DXL 3000 Second Wind ou comment j'ai vissé ma propre télémétrie</a></li>
<li><a href="../fr479220/index.html">Nano-neurone - 7 fonctions JavaScript simples montrant comment la machine peut "apprendre"</a></li>
<li><a href="../fr479222/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 325 (du 2 au 8 décembre)</a></li>
<li><a href="../fr479226/index.html">Habr-analysis: ce que les utilisateurs commandent en cadeau à Habr</a></li>
<li><a href="../fr479230/index.html">Documentez votre API express avec des annotations fanfaronnades</a></li>
<li><a href="../fr479232/index.html">Développement d'applications MQ JMS sur Spring Boot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>