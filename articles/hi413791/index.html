<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯРР ЁЯХЭ ЁЯеЫ рдЬреЗрдПрд╕ рдореЗрдВ рдЧрдгрдирд╛ рдХреА рдХреНрд╡рд╛рдВрдЯрдо рдпрд╛рдВрддреНрд░рд┐рдХреА ЁЯТд ЁЯУД ЁЯС╖ЁЯП╗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣реИрд▓реЛ, рдореЗрд░рд╛ рдирд╛рдо рджрд┐рдорд┐рддреНрд░реА рдХрд╛рд░реНрд▓реЛрд╡реНрд╕реНрдХреА рд╣реИ рдФрд░ рдореИрдВ ... рдмреЗрд░реЛрдЬрдЧрд╛рд░ред рдЗрд╕рд▓рд┐рдП, рдореЗрд░реЗ рдкрд╛рд╕ рд╕рдВрдЧреАрдд, рдЦреЗрд▓, рд░рдЪрдирд╛рддреНрдордХрддрд╛, рднрд╛рд╖рд╛рдПрдВ, рдЬреЗрдПрд╕-рд╕рдореНрдореЗрд▓рди рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░ рд╡рд┐рдЬреНрдЮрд╛рди рдЦреЗрд▓рдиреЗ рдХреЗ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЬреЗрдПрд╕ рдореЗрдВ рдЧрдгрдирд╛ рдХреА рдХреНрд╡рд╛рдВрдЯрдо рдпрд╛рдВрддреНрд░рд┐рдХреА</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413791/"><p> рд╣реИрд▓реЛ, рдореЗрд░рд╛ рдирд╛рдо рджрд┐рдорд┐рддреНрд░реА рдХрд╛рд░реНрд▓реЛрд╡реНрд╕реНрдХреА рд╣реИ рдФрд░ рдореИрдВ ... рдмреЗрд░реЛрдЬрдЧрд╛рд░ред  рдЗрд╕рд▓рд┐рдП, рдореЗрд░реЗ рдкрд╛рд╕ рд╕рдВрдЧреАрдд, рдЦреЗрд▓, рд░рдЪрдирд╛рддреНрдордХрддрд╛, рднрд╛рд╖рд╛рдПрдВ, рдЬреЗрдПрд╕-рд╕рдореНрдореЗрд▓рди рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░ рд╡рд┐рдЬреНрдЮрд╛рди рдЦреЗрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЦрд╛рд▓реА рд╕рдордп рд╣реИред  рдореИрдВ рдЖрдкрдХреЛ рдХрдИ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдХреА рдЫреЛрдЯреА <code>$mol_fiber</code> рдореЗрдВ рд▓рдВрдмреА рдЧрдгрдирд╛ рдХреЗ рдЕрд░реНрдз-рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╡рд┐рднрд╛рдЬрди рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдирд╡реАрдирддрдо рд╢реЛрдз рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реВрдВ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд▓рдШреБ рдкреБрд╕реНрддрдХрд╛рд▓рдп <code>$mol_fiber</code> ред  рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ, рд╣рдо рдЙрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд░реЗрдЦрд╛рдВрдХрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рд╣рд▓ рдХрд░реЗрдВрдЧреЗред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/787/033/fb0/787033fb0e7d49cad98ce046a4e2380a.gif" alt="рдХреНрд╡рд╛рдВрдЯрд╛!"></p><br><p>  рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реЛрд▓реАрдЬреЗрдПрд╕ 2018 рдкрд╛рдЗрдЯрд░</a> рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдкреЙрдирд╛рдо рдХреЗ</a> рдкреНрд░рджрд░реНрд╢рди рдХрд╛ рдПрдХ рдкрд╛рда рд╕рдВрд╕реНрдХрд░рдг рд╣реИред  рдЖрдк рдЗрд╕реЗ рдпрд╛ рддреЛ <a href="">рдПрдХ рд▓реЗрдЦ рдХреЗ рд░реВрдк рдореЗрдВ рдкрдврд╝</a> рд╕рдХрддреЗ <a href="">рд╣реИрдВ</a> , рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕реЗ рдкреНрд░рд╕реНрддреБрддрд┐ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ рдЦреЛрд▓ рд╕рдХрддреЗ рд╣реИрдВ</a> , рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рд╡реАрдбрд┐рдпреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ</a> ред </p><a name="habracut"></a><br><h1 id="issue-low-responsiveness">  рдореБрджреНрджрд╛: рдХрдо рдЬрд╡рд╛рдмрджреЗрд╣реА </h1><br><p>  рдпрджрд┐ рд╣рдо рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб 60 рдлреНрд░реЗрдо рд╕реНрдерд┐рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рднреА рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ 16 рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдХреА рдПрдХ рдЯреНрд░рд┐рдлрд╝рд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдо рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рд▓реЗрддреЗ рд╣реИрдВ?  рддрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рд▓реИрдЧрд┐рдВрдЧ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдЧрд╛, рдПрдиреАрдореЗрд╢рди рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рдпреВрдПрдХреНрд╕ рдЧрд┐рд░рд╛рд╡рдЯ рдХреА рддрд░рд╣ рд╣реЛрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9f8/b6f/431/9f8b6f43150f6aa318daf6bd7bde9e56.gif" alt="рдХрдо рдЬрд╡рд╛рдмрджреЗрд╣реА"></p><br><h1 id="issue-no-escape">  рдореБрджреНрджрд╛: рдХреЛрдИ рдмрдЪ рдирд╣реАрдВ </h1><br><p>  рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЬрдм рд╣рдо рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкрд░рд┐рдгрд╛рдо рд╣рдорд╛рд░реЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд░рд╣ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рд╕реНрдХреНрд░реЙрд▓ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдЦреАрдВрдЪрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рд░рд╣ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд╖реЗрддреНрд░ рдХреЛ рд░реЗрдВрдбрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рдкрд┐рдЫрд▓реА рд░реЗрдВрдбрд░рд┐рдВрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/28d/4d9/12f/28d4d912fb979ddb97ac61f3bb314756.jpg" alt="рдкреВрд░реНрд╡ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ"></p><br><p>  рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рдХрд┐ рд╣рдо рдХрд┐рддрдиреЗ рд╕рдордп рддрдХ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдХрд┐рд╕реА рднреА рд╕рдордп рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдп рдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реБрдЖ рд╣реИред </p><br><h1 id="im-fast-and-i-know-it">  рдореИрдВ рддреЗрдЬ рд╣реВрдВ рдФрд░ рдореИрдВ рдЗрд╕реЗ рдЬрд╛рдирддрд╛ рд╣реВрдВ </h1><br><p>  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдорд╛рд░рд╛ рдХрд╛рдо рдПрдХ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдХрдИ, рд▓реЗрдХрд┐рди рдПрдХ рдзрд╛рд░рд╛ рд╣реЛ?  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдЕрдкрдиреЗ рддрд╛рдЬреЗ рдЦрд░реАрджреЗ рд╣реБрдП рдкреАрд▓реЗ рдХрдорд▓ рдкрд░ рдЧрд╛рдбрд╝реА рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдФрд░ рд░реЗрд▓рд╡реЗ рдХреНрд░реЙрд╕рд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред  рдЬрдм рдпрд╣ рдореБрдлрд╝реНрдд рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдПрдХ рджреВрд╕рд░реЗ рд╡рд┐рднрд╛рдЬрди рдореЗрдВ рдкрд░реНрдЪреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди .. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fcc/078/f2b/fcc078f2b90d03703c61d42ffe53701f.jpg" alt="рд╢рд╛рдВрдд рдХрд╛рд░"></p><br><h1 id="issue-no-concurrency">  рд╕рдорд╕реНрдпрд╛: рдХреЛрдИ рд╕рдВрдЧрддрд┐ рдирд╣реАрдВ </h1><br><p>  рдЬрдм рдХреНрд░реЙрд╕рд┐рдВрдЧ рдкрд░ рдПрдХ рдХрд┐рд▓реЛрдореАрдЯрд░ рдЯреНрд░реЗрди рдХрд╛ рдХрдмреНрдЬрд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЦрдбрд╝реЗ рд╣реЛрдХрд░ рджрд╕ рдорд┐рдирдЯ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд┐ рдЖрдкрдиреЗ рд╕реНрдкреЛрд░реНрдЯреНрд╕ рдХрд╛рд░ рдЦрд░реАрджреА рд╣реИ, рд╣реИ рдирд╛? </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0fe/ed1/d50/0feed1d50bc38d61f26f11d28f80a87c.gif" alt="рддреЗрдЬ рдкреНрд░рддреАрдХреНрд╖рд╛ рдзреАрдореА"></p><br><p>  рдФрд░ рдЕрдЧрд░ рдпрд╣ рдЯреНрд░реЗрди рдкреНрд░рддреНрдпреЗрдХ 100 рдореАрдЯрд░ рдХреА 10 рдЯреНрд░реЗрдиреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реЛ рдЬрд╛рддреА рд╣реИ рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рдлрд┐рд╕рд▓рдиреЗ рдореЗрдВ рдХрдИ рдорд┐рдирдЯ рд▓рдЧреЗрдВрдЧреЗ рддреЛ рдпрд╣ рдХрд┐рддрдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛!  рдЖрдкрдХреЛ рддрдм рдЗрддрдиреА рджреЗрд░ рдирд╣реАрдВ рд╣реЛрдЧреАред </p><br><p>  рддреЛ рдЕрдм рдЬреЗрдПрд╕ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдХреНрдпрд╛ рд╣реИ? </p><br><h1 id="solution-workers">  рд╕рдорд╛рдзрд╛рди: рд╢реНрд░рдорд┐рдХ </h1><br><p>  рдкрд╣рд▓реА рдмрд╛рдд рдЬреЛ рдорди рдореЗрдВ рдЖрддреА рд╣реИ: рдЪрд▓реЛ рдмрд╕ рд╕рднреА рдЬрдЯрд┐рд▓ рдЧрдгрдирд╛рдУрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдзрд╛рдЧреЗ рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ?  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ WebWorkers рдХреЗ рд▓рд┐рдП рдПрдХ рддрдВрддреНрд░ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f6b/005/e78/f6b005e7836243e1434af86e1cc337cc.png" alt="рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рддрд░реНрдХ"></p><br><p>  рдпреВрдЖрдИ рд╕реНрдЯреНрд░реАрдо рд╕реЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рд╡рд╣рд╛рдВ рдЙрдиреНрд╣реЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкреГрд╖реНрда рдкрд░ рдХреНрдпрд╛ рдФрд░ рдХреИрд╕реЗ рдмрджрд▓рдирд╛ рд╣реИ, рдЗрд╕рдХреЗ рдирд┐рд░реНрджреЗрд╢ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд╛рдкрд╕ рджреЗ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдпреВрдЖрдИ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рдХреА рдПрдХ рдмрдбрд╝реА рдкрд░рдд рд╕реЗ рдмрдЪрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рднреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣рд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдирдП рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><h1 id="workers-issues-deserialization">  рд╢реНрд░рдорд┐рдХ: рдореБрджреНрджреЗ: (рдбреА) рд╕реАрд░рд┐рдпрд▓ </h1><br><p>  рдзрд╛рд░рд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдЙрди рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рднреЗрдЬрдХрд░ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдмрд╛рдЗрдЯ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдХреНрд░рдордмрджреНрдз рд╣реЛрддреЗ рд╣реИрдВ, рджреВрд╕рд░реА рдзрд╛рд░рд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рд╡рд╣рд╛рдВ рдЙрдиреНрд╣реЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕рдм рдПрдХ рдереНрд░реЗрдб рдХреЗ рднреАрддрд░ рдПрдХ рд╕реАрдзреА рд╡рд┐рдзрд┐ рдХреЙрд▓ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдзреАрдорд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e9f/c76/7db/e9fc767db4a76ac2079610a2df590eaa.jpg" alt="(рджреЗ) рдХреНрд░рдордмрджреНрдзрддрд╛"></p><br><h1 id="workers-issues-asynchronous-only">  рд╢реНрд░рдорд┐рдХ: рдореБрджреНрджреЗ: рдХреЗрд╡рд▓ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ </h1><br><p>  рд╕рдВрджреЗрд╢ рд╕рдЦреНрддреА рд╕реЗ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░реЗрд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рдФрд░ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рдЬреЛ рдореИрдВ рдЖрдкрд╕реЗ рдкреВрдЫрддрд╛ рд╣реВрдВ рд╡рд╣ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдХрд┐рд╕реА рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рд╕реЗ рдПрдХ ui рдШрдЯрдирд╛ рдХреЗ рдЖрд░реЛрд╣рдг рдХреЛ рд░реЛрдХ рдирд╣реАрдВ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рддрдХ рд╣реИрдВрдбрд▓рд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддрдм рддрдХ рдпреВрдЖрдИ рдереНрд░реЗрдб рдореЗрдВ рдШрдЯрдирд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдкрдирд╛ рдЬреАрд╡рди рдЪрдХреНрд░ рдкреВрд░рд╛ рдХрд░ рд▓реЗрдЧреАред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/083/1c9/d42/0831c9d4270c8a64e17febb2d509ec56.png" alt="рд╕рдВрджреЗрд╢ рдХреА рдХрддрд╛рд░"></p><br><h1 id="workers-issues-limited-apis">  рд╢реНрд░рдорд┐рдХ: рдореБрджреНрджреЗ: рд╕реАрдорд┐рдд рдПрдкреАрдЖрдИ </h1><br><p>  рдХрд╛рд░реНрдпрдХрд░реНрддрд╛рдУрдВ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдкреАрдЖрдИ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВред </p><br><ul><li>  рдбреЛрдо, рд╕реАрдПрд╕рдПрд╕рдУрдПрдо </li><li>  рдХреИрдирд╡рд╛рд╕ </li><li>  рдЬрд┐рдпреЛрд▓реЛрдХреЗрд╢рди </li><li>  рдЗрддрд┐рд╣рд╛рд╕ рдФрд░ рд╕реНрдерд╛рди </li><li>  HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рд┐рдВрдХ рдХрд░реЗрдВ </li><li>  XMLHttpRequest.responseXML </li><li>  рдЦрд┐рдбрд╝рдХреА </li></ul><br><h1 id="workers-issues-cant-cancel">  рд╢реНрд░рдорд┐рдХ: рдореБрджреНрджреЗ: рд░рджреНрдж рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ </h1><br><p>  рдФрд░ рдлрд┐рд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╡реЛрдХрд░ рдореЗрдВ рдЧрдгрдирд╛ рдХреЛ рд░реЛрдХрдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/064/059/e49/064059e49ab01b803d84001dc2111da8.jpg" alt="рд░реЛрдХреЛ!"></p><br><p>  рд╣рд╛рдВ, рд╣рдо рдкреВрд░реЗ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡рд╣ рдЗрд╕рдореЗрдВ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд░реЛрдХ рджреЗрдЧрд╛ред <br>  рд╣рд╛рдВ, рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдХреЛ рдПрдХ рдЕрд▓рдЧ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╣реБрдд рд╕рдВрд╕рд╛рдзрди рдЧрд╣рди рд╣реИред </p><br><h1 id="solution-react-fiber">  рд╕рдорд╛рдзрд╛рди: рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░ </h1><br><p>  рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдХрдИ рд╕реБрдиреЗ рд╣реБрдП рдлреЗрд╕рдмреБрдХ рдиреЗ рд╡реАрд░рддрд╛рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рд░рд┐рдПрдХреНрдЯ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрд╛, рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрд╕реВрдЪрдХ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдП рдЧрдП рдЫреЛрдЯреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдореЗрдВ рд╕рднреА рдЧрдгрдирд╛рдУрдВ рдХреЛ рддреЛрдбрд╝ рджрд┐рдпрд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/079/4f3/de4/0794f3de41b63342f7298e82f7d6bdb2.png" alt="рдореБрд╢реНрдХрд┐рд▓ рд╡рд┐рдХрд▓рд╛рдВрдЧрддрд╛ Fi рддрд░реНрдХ"></p><br><p>  рдореИрдВ рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдКрдВрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рд╖рдп рд╣реИред  рдореИрдВ рдХреЗрд╡рд▓ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдкрд░ рдзреНрдпрд╛рди рджреВрдВрдЧрд╛, рдЬрд┐рдирдХреА рд╡рдЬрд╣ рд╕реЗ рдпрд╣ рдЖрдкрдХреЗ рдЕрдиреБрд░реВрдк рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ .. </p><br><h1 id="react-fiber-react-required">  рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░: рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ </h1><br><p>  рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдЕрдЧрд░ рдЖрдк рд░рд┐рдПрдХреНрдЯ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдПрдВрдЧреБрд▓рд░, рд╡реАрдпреВ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░ рдЖрдкрдХреЗ рд▓рд┐рдП рдмреЗрдХрд╛рд░ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/015/01e/1fa/01501e1fa047ab219dbaf0cd140e7002.jpg" alt="рдкрд░реНрдпрд╛рдкреНрдд рдПрд╡рд░реАрд╡реЗрдпрд░!"></p><br><h1 id="react-fiber-only-rendering">  рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░: рдХреЗрд╡рд▓ рдкреНрд░рддрд┐рдкрд╛рджрди </h1><br><p>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ - рдХреЗрд╡рд▓ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд░рдд рдХреЛ рдХрд╡рд░ рдХрд░рддрд╛ рд╣реИред  рдЖрд╡реЗрджрди рдХреЗ рдЕрдиреНрдп рд╕рднреА рдкрд░рддреЛрдВ рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкрд░рд┐рдорд╛рдг рдХреЗ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a82/3f5/c3e/a823f5c3e063d3961f64b0c18b25aa1b.gif" alt="рдЗрддрдиреА рдЬрд▓реНрджреА рдирд╣реАрдВ!"></p><br><p>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдлрд╛рдЗрдмрд░ рдЖрдкрдХреЛ рддрдм рдирд╣реАрдВ рдмрдЪрд╛рдПрдЧрд╛ рдЬрдм рдЖрдкрдХреЛ рдЬрд╝рд░реВрд░рдд рд╣реЛ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдореБрд╢реНрдХрд┐рд▓ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдбреЗрдЯрд╛ рдХреЗ рдПрдХ рдмрдбрд╝реЗ рдмреНрд▓реЙрдХ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред </p><br><h1 id="react-fiber-quantization-is-disabled">  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдлрд╛рдЗрдмрд░: рдорд╛рддреНрд░рд╛ рдХрд╛ рдард╣рд░рд╛рд╡ рдЕрдХреНрд╖рдо рд╣реИ </h1><br><p>  рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерд┐рдд рд╕рдорд░реНрдерди рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдпрд╣ рдЕрднреА рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдмрдВрдж рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд┐рдЫрдбрд╝реЗ рд╕рдВрдЧрддрддрд╛ рдХреЛ рддреЛрдбрд╝рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/498/f7b/4be/498f7b4be46edbbbf0884a71bccc89a8.jpg" alt="рд╡рд┐рдкрдгрди рдЬрд╛рд▓"></p><br><p>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг рдЕрднреА рднреА рдПрдХ рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рдЪреАрдЬ рд╣реИред  рд╕рд╛рд╡рдзрд╛рди! </p><br><h1 id="react-fiber-debug-is-pain">  рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░: рдбреАрдмрдЧ рджрд░реНрдж рд╣реИ </h1><br><p>  рдЬрдм рдЖрдк рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг рдЪрд╛рд▓реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЙрд▓рд╕реНрдЯреИрдХ рдЖрдкрдХреЗ рдХреЛрдб рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рдЬреЛ рдбреАрдмрдЧрд┐рдВрдЧ рдХреЛ рдмрд╣реБрдд рдЬрдЯрд┐рд▓ рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕ рдореБрджреНрджреЗ рдкрд░ рд▓реМрдЯреЗрдВрдЧреЗред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3dd/725/bd5/3dd725bd5c728f4ecc43f167f2724f63.jpg" alt="рдбреАрдмрдЧрд┐рдВрдЧ рдХрд╛ рд╕рд╛рд░рд╛ рджрд░реНрдж"></p><br><h1 id="solution-quantization">  рд╕рдорд╛рдзрд╛рди: рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг </h1><br><p>  рдЖрдЗрдП, рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдиреБрдХрд╕рд╛рди рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХреЗрдВред  рд╣рдо рдПрдХ рд╕реНрдЯреНрд░реАрдо рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ рд░рд╣рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЫреЛрдЯреА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд▓рдВрдмреА рдЧрдгрдирд╛рдУрдВ рдХреЛ рддреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдмреАрдЪ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЙрди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреГрд╖реНрда рдкрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдФрд░ рд╣рдо рдШрдЯрдирд╛рдУрдВ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдВрдЧреЗред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a98/9c5/e9e/a989c5e9e41bc35a36a656a7ce19d610.png" alt="рдЪрд╛рд░реНрдЯ"></p><br><p>  рдКрдкрд░ рдЖрдк рдПрдХ рд▓рдВрдмреА рдЧрдгрдирд╛ рджреЗрдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдиреЗ рдкреВрд░реА рджреБрдирд┐рдпрд╛ рдХреЛ 100ms рд╕реЗ рдЕрдзрд┐рдХ рд░реЛрдХ рджрд┐рдпрд╛ред  рдФрд░ рдиреАрдЪреЗ рд╕реЗ - рдПрдХ рд╣реА рдЧрдгрдирд╛, рд▓реЗрдХрд┐рди рд▓рдЧрднрдЧ 16ms рдХреЗ рд╕рдордп рдХреЗ рд╕реНрд▓рд╛рдЗрд╕ рдореЗрдВ рдЯреВрдЯ рдЧрдИ, рдЬрд┐рд╕рдиреЗ рдФрд╕рддрди 60 рдлреНрд░реЗрдо рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рджрд┐рдпрд╛ред  рдЪреВрдБрдХрд┐ рд╣рдо рдЖрдо рддреМрд░ рдкрд░ рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЧрдгрдирд╛ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ 16ms рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рдЕрдЧреНрд░рд┐рдо рд░реВрдк рд╕реЗ рдирд╣реАрдВ рддреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рд░рдирдЯрд╛рдЗрдо рддрдВрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдореЗрдВ рд▓рдЧрдиреЗ рд╡рд╛рд▓реЗ рд╕рдордп рдХреЛ рдорд╛рдкрддрд╛ рд╣реИ рдФрд░ рдЬрдм рдХреНрд╡рд╛рдВрдЯрдо рдкрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрдЧрд▓реЗ рдПрдиреАрдореЗрд╢рди рдлреНрд░реЗрдо рддрдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХ рджреЗрддрд╛ рд╣реИред  рдЖрдЗрдП, рдЗрд╕ рддрд░рд╣ рдХреЗ рдирд┐рд▓рдВрдмрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреНрдпрд╛ рддрдВрддреНрд░ рд╣реИрдВ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪреЗрдВред </p><br><h1 id="concurrency-fibers--stackfull-coroutines">  рдХрдВрд╕реАрд▓рд░: рдлрд╛рдЗрдмрд░ - рд╕реНрдЯреИрдХрдлреБрд▓ рдХреЛрд░рдЯрд╛рдЗрди </h1><br><p>  рдЧреЛ рдФрд░ рдбреА рдЬреИрд╕реА рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ "рдПрдХ рд╕реНрдЯреИрдХ рдХреЗ рд╕рд╛рде рдХреЛрд░рдЯрд╛рдЗрди" рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рдореБрд╣рд╛рд╡рд░реЗ рд╣реИрдВ, рдпрд╣ рдПрдХ "рдлрд╛рдЗрдмрд░" рдпрд╛ "рдлрд╛рдЗрдмрд░" рднреА рд╣реИред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Future } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fibers'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> one = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> Future.wait( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">future</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout( future.return ) ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> two = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> one() + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> three = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> two() + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> four = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> three() + <span class="hljs-number"><span class="hljs-number">1</span></span> Future.task( four ).detach()</code> </pre> <br><p>  рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдЖрдк <code>one</code> рдлрд╝рдВрдХреНрд╢рди рджреЗрдЦрддреЗ рд╣реИрдВ, рдЬреЛ рд╡рд░реНрддрдорд╛рди рдлрд╛рдЗрдмрд░ рдХреЛ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИред  <code>two</code> , <code>three</code> рдФрд░ <code>four</code> рдХрд╛рд░реНрдп рдирд┐рдпрдорд┐рдд рд╕рдордХрд╛рд▓рд┐рдХ рдХрд╛рд░реНрдп рд╣реИрдВ рдЬреЛ рдлрд╛рдЗрдмрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВред  рдЗрдирдореЗрдВ рдЖрдк рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рд╕рднреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдФрд░ рдЕрдВрдд рдореЗрдВ, рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рдкрд░, рд╣рдо рдмрд╕ рдПрдХ рдЕрд▓рдЧ рдлрд╛рдЗрдмрд░ рдореЗрдВ <code>four</code> рдлрд╝рдВрдХреНрд╢рди рдЪрд▓рд╛рддреЗ рд╣реИрдВред </p><br><p>  рдлрд╛рдЗрдмрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдХрд╛рдлреА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рд╕рдорд░реНрдерди рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд░рдирдЯрд╛рдЗрдо рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдХрд┐ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЬреЗрдПрд╕ рджреБрднрд╛рд╖рд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, NodeJS рдХреЗ рд▓рд┐рдП рдПрдХ рджреЗрд╢реА <code>node-fibers</code> рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╣реИ рдЬреЛ рдЗрд╕ рд╕рдорд░реНрдерди рдХреЛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдХреЛрдИ рднреА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрд┐рд╕реА рднреА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред </p><br><h1 id="concurrency-fsm--stackless-coroutines">  рдХрдВрд╕реАрдбрд░: FSM - рд╕реНрдЯреИрдХрд▓реЗрд╕ рдХреЛрд░рдЖрдЙрдЯреНрд╕ </h1><br><p>  C # рдФрд░ рдЕрдм JS рдЬреИрд╕реА рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ "рд╕реНрдЯреИрдХрд▓реЗрд╕ рдХреЙрд░рдЖрдЙрдЯреНрд╕" рдпрд╛ "рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдлрд╝рдВрдХреНрд╢рдВрд╕" рдХрд╛ рд╕рдорд░реНрдерди рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдлрд╝рдВрдХреНрд╢рди рд╣реБрдб рдХреЗ рддрд╣рдд рдПрдХ рд░рд╛рдЬреНрдп рдорд╢реАрди рд╣реИрдВ рдФрд░ рд╕реНрдЯреИрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рд╢реЗрд╖ рдХреАрд╡рд░реНрдб "рдПрд╕рд┐рдВрдХреНрд╕" рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдЙрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЬрд╣рд╛рдВ рд╡реЗ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ - "рдкреНрд░рддреАрдХреНрд╖рд╛"ред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> one = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout( done ) ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> two = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> ()=&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">await</span></span></span></span><span class="hljs-function"><span class="hljs-params"> one(</span></span></span><span class="hljs-function">) ) + 1 </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">three</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> two() ) + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> four = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> ()=&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> three() ) + <span class="hljs-number"><span class="hljs-number">1</span></span> four()</code> </pre> <br><p>  рдЪреВрдВрдХрд┐ рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рд╕рдордп рдЧрдгрдирд╛ рдХреЛ рд╕реНрдердЧрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЖрд╡реЗрджрди рдореЗрдВ рд▓рдЧрднрдЧ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рди рдХреЗрд╡рд▓ рдХреЛрдб рдХреА рдЬрдЯрд┐рд▓рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рднреА рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдкреАрдЖрдИ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрдИ рдХреЙрд▓рдмреИрдХ рдЕрднреА рднреА рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЙрд▓рдмреИрдХ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдПрдХ рд╣рдбрд╝рддрд╛рд▓реА рдЙрджрд╛рд╣рд░рдг рдХрд┐рд╕реА рднреА рд╕рд░рдгреА рдХреА <code>reduce</code> рд╡рд┐рдзрд┐ рд╣реИред </p><br><h1 id="concurrency-semi-fibers---restarts">  Concurrency: рдЕрд░реНрдз-рддрдВрддреБ - рдкреБрдирд░рд╛рд░рдВрдн </h1><br><p>  рдЖрдЗрдП рдлрд╛рдЗрдмрд░ рдХреЗ рд╕рдорд╛рди рдХреБрдЫ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ, рдХреЗрд╡рд▓ рдЙрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреЛ рдХрд┐рд╕реА рднреА рдЖрдзреБрдирд┐рдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИрдВ редред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_async , $mol_fiber_start } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber/web'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> one = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> $mol_fiber_async( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">back</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout( back ) ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> two = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> one() + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> three = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> two() + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> four = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> three() + <span class="hljs-number"><span class="hljs-number">1</span></span> $mol_fiber_start( four )</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдордзреНрдпрд╡рд░реНрддреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд░реБрдХрд╛рд╡рдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдкрддрд╛ рд╣реИ - рдпрд╣ рдирд┐рдпрдорд┐рдд рдЬреЗрдПрд╕ рд╣реИред  рдирд┐рд▓рдВрдмрди рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЗрд╡рд▓ <code>one</code> рдлрд╝рдВрдХреНрд╢рди рдЬрд╛рдирддрд╛ рд╣реИред  рдЧрдгрдирд╛ рдХреЛ рдирд┐рд░рд╕реНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд╣ рдХреЗрд╡рд▓ рдПрдХ рдЕрдкрд╡рд╛рдж рдХреЗ рд░реВрдк рдореЗрдВ <code>Promise</code> рдлреЗрдВрдХрддреА рд╣реИред  рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рдкрд░, рд╣рдо <code>four</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рдЕрд▓рдЧ рдЫрджреНрдо рдлрд╛рдЗрдмрд░ рдореЗрдВ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдЕрдВрджрд░ рдлреЗрдВрдХреЗ рдЧрдП рдЕрдкрд╡рд╛рджреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЕрдЧрд░ <code>Promise</code> рдЖрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХреЗ <code>resolve</code> рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдлрд╛рдЗрдмрд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рддрд╛ рд╣реИред </p><br><h1 id="figures">  рдЖрдВрдХрдбрд╝реЗ </h1><br><p>  рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЫрджреНрдо рдлрд╛рдЗрдмрд░ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдПрдХ рдореБрд╢реНрдХрд┐рд▓ рдХреЛрдб рд▓рд┐рдЦреЗрдВрдЧреЗред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/dce/e56/26a/dcee5626ad6c81048ca43a54a2825fe4.svg" alt="рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рдХрд╛рд╕ рдЪрд╛рд░реНрдЯ"></p><br><p>  рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдпрд╣рд╛рдВ <code>step</code> рдлрд╝рдВрдХреНрд╢рди рдХрдВрд╕реЛрд▓ рдХреЛ рдХреБрдЫ рд▓рд┐рдЦрддрд╛ рд╣реИ рдФрд░ 20ms рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЕрдиреНрдп рдХрдбрд╝реА рдореЗрд╣рдирдд рдХрд░рддрд╛ рд╣реИред  рдФрд░ <code>walk</code> рдлрдВрдХреНрд╢рди рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд▓реЙрдЧ рдХрд░рддреЗ рд╣реБрдП рджреЛ рдмрд╛рд░ <code>step</code> рдХрд╣рддрд╛ рд╣реИред  рдмреАрдЪ рдореЗрдВ, рдпрд╣ рджрд┐рдЦрд╛рдПрдЧрд╛ рдХрд┐ рдЕрдм рдХрдВрд╕реЛрд▓ рдореЗрдВ рдХреНрдпрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдФрд░ рджрд╛рдИрдВ рдУрд░ рд╕реНрдпреВрдбреЛрдлрд╛рдЗрдмрд░ рд╡реГрдХреНрд╖ рдХреА рдЕрд╡рд╕реНрдерд╛ рд╣реИред </p><br><h1 id="mol_fiber-no-quantization">  $ mol_fiber: рдХреЛрдИ рдорд╛рддреНрд░рд╛рдХрд░рдг рдирд╣реАрдВ </h1><br><p>  рдЖрдЗрдП рдЗрд╕ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ .. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/aa0/8aa/d4e/aa08aad4e3770368fd787aba5e8fcf81.svg" alt="рдкрд░рд┐рдзреАрдпрдХрд░рдг рдХреЗ рдмрд┐рдирд╛"></p><br><p>  рдЕрдм рддрдХ, рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рдФрд░ рд╕реНрдкрд╖реНрдЯ рд╣реИред  рдмреЗрд╢рдХ, рдЫрджреНрдо рдлрд╛рдЗрдмрд░ рдкреЗрдбрд╝ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред  рдФрд░ рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдХреЛрдб 40 рдПрдордПрд╕ рд╕реЗ рдЕрдзрд┐рдХ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдмреЗрдХрд╛рд░ рд╣реИред </p><br><h1 id="mol_fiber-cache-first">  $ mol_fiber: рдкрд╣рд▓реЗ рдХреИрд╢ </h1><br><p>  рдЪрд▓реЛ рджреЛрдиреЛрдВ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд░рдг рдореЗрдВ рд▓рдкреЗрдЯрддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕реЗ рдЫрджреНрдо рдлрд╛рдЗрдмрд░ рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ редред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1f2/7e3/2f9/1f27e32f982035e32f59c4100aac3dd0.svg" alt="рдХреИрд╢ рднрд░рдирд╛"></p><br><p>  рдпрд╣рд╛рдВ рдпрд╣ рдЗрд╕ рддрдереНрдп рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ <code>walk</code> рдлрд╛рдЗрдмрд░ рдХреЗ рдЕрдВрджрд░ <code>one</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП, рдПрдХ рдЕрд▓рдЧ рдлрд╛рдЗрдмрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдкрд╣рд▓реА рдХреЙрд▓ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдХреИрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рджреВрд╕рд░реЗ рдХреЗ рдмрдЬрд╛рдп, <code>Promise</code> рдХреЛ рдлреЗрдВрдХ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдЕрдкрдирд╛ рд╕рдордп рдЯреБрдХрдбрд╝рд╛ рд╕рдорд╛рдкреНрдд рдХрд░ рджрд┐рдпрд╛ рдерд╛ред </p><br><h1 id="mol_fiber-cache-second">  $ mol_fiber: рдХреИрд╢ рджреВрд╕рд░рд╛ </h1><br><p>  рдкрд╣рд▓реЗ рдлреНрд░реЗрдо рдореЗрдВ рдлреЗрдВрдХ рджреЗрдВ, <code>Promise</code> рдЕрдЧрд▓реЗ рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рд╕реЗ <code>walk</code> рдлрд╛рдЗрдмрд░ рдХрд╛ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2ec/d06/80b/2ecd0680bb11b2b425c2464e8d119362.svg" alt="рдХреИрд╢реЗ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╣рдо рдлрд┐рд░ рд╕реЗ "рд╕реНрдЯрд╛рд░реНрдЯ" рдФрд░ "рдкрд╣рд▓реА рдмрд╛рд░" рдХрдВрд╕реЛрд▓ рдкрд░ рд▓реМрдЯ рдЖрдП, рд▓реЗрдХрд┐рди "рдкрд╣рд▓реА рд╢реБрд░реБрдЖрдд" рдЕрдм рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдлрд╛рдЗрдмрд░ рдореЗрдВ рдкрд╣рд▓реЗ рднрд░реЗ рд╣реБрдП рдХреИрд╢ рдХреЗ рд╕рд╛рде рд╣реИ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдЗрд╕рдХрд╛ рд╣реИрдВрдбрд▓рд░ рдЕрдзрд┐рдХ рд╣реИ рдирд╣реАрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЬрдм <code>walk</code> рдлрд╛рдЗрдмрд░ рдХрд╛ рдХреИрд╢ рднрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рднреА рдПрдореНрдмреЗрдбреЗрдб рдлрд╛рдЗрдмрд░ рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдЙрди рддрдХ рдХрднреА рдирд╣реАрдВ рдкрд╣реБрдВрдЪреЗрдЧрд╛ред </p><br><p>  рддреЛ <code>first begin</code> рдПрдХ рдмрд╛рд░ рдкреНрд░рд┐рдВрдЯ рдХреНрдпреЛрдВ <code>first begin</code> <code>first done</code> рдФрд░ <code>first done</code> рджреЛ <code>first done</code> ?  рдпрд╣ рд╕рдм рдЖрд▓рд╕реНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред  <code>console.log</code> - рдиреЙрди-рдЖрдЗрдбрдореНрдкреЛрдЯреЗрдВрдЯ рдСрдкрд░реЗрд╢рди, рдЖрдк рдЗрд╕реЗ рдХрд┐рддрдиреА рдмрд╛рд░ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдХрдИ рдмрд╛рд░ рдпрд╣ рдХрдВрд╕реЛрд▓ рдореЗрдВ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЬреЛрдбрд╝ рджреЗрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЬреЛ рдлрд╛рдЗрдмрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╛рдЗрдмрд░ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ, рд╡рд╣ рдмреЗрдХрд╛рд░ рд╣реИ, рдпрд╣ рдХреЗрд╡рд▓ рдкрд╣рд▓реА рдХреЙрд▓ рдкрд░ рд╣реИрдВрдбрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдмрд╛рдж рдореЗрдВ рдХрд┐рд╕реА рднреА рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд╛рдЗрдб рдЗрдлреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдЕрдЧреНрд░рдгреА, рдХреИрд╢ рд╕реЗ рддреБрд░рдВрдд рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИред </p><br><h1 id="mol_fiber-idempotence-first">  $ mol_fiber: рдкрд╣рд▓реЗ рдмреЗрд░реЛрдЬрдЧрд╛рд░реА </h1><br><p>  рдЪрд▓реЛ рдПрдХ рдлрд╛рдЗрдмрд░ рдореЗрдВ <code>console.log</code> рд▓рдкреЗрдЯрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдмреЗрдХрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреИрд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рддрд╛ рд╣реИ .. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/340/552/c63/340552c63f8356ee7b680ae76558ec90.svg" alt="рдордирднрд╛рд╡рди рдХреИрд╢ рднрд░рдирд╛"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдм рдлрд╛рдЗрдмрд░ рдЯреНрд░реА рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <code>log</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдВ рд╣реИрдВред </p><br><h1 id="mol_fiber-idempotence-second">  $ mol_fiber: idempotence рджреВрд╕рд░рд╛ </h1><br><p>  <code>walk</code> рдлрд╛рдЗрдмрд░ рдХреЗ рдЕрдЧрд▓реЗ рдкреБрдирд░рд╛рд░рдВрдн рдореЗрдВ, <code>log</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрд╛рд░-рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ <code>console.log</code> рдХреЛ рдХреЙрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдЬреИрд╕реЗ рд╣реА рд╣рдо рдПрдХ рдЦрд╛рд▓реА рдХреИрд╢ рдХреЗ рд╕рд╛рде рдлрд╛рдЗрдмрд░ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, <code>console.log</code> рдХреЙрд▓ рдлрд┐рд░ <code>console.log</code> рд╢реБрд░реВ рд╣реЛ <code>console.log</code> ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b32/2ac/e0b/b322ace0b34b91d3db8c52cbf78599f5.svg" alt="рдмреЗрдХрд╛рд░ рдХреЗ рдХреИрд╢ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ"></p><br><p>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдВрд╕реЛрд▓ рдореЗрдВ рдЕрдм рд╣рдо рдХреБрдЫ рднреА рдирд╣реАрдВ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ - рдмрд┐рдирд╛ рдХрд┐рд╕реА рдлрд╛рдЗрдмрд░ рдФрд░ рдкрд░рд┐рдорд╛рдг рдХреЗ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдореЗрдВ рдЬреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><h1 id="mol_fiber-break">  $ рдореЛрд▓_рдлрд╛рдЗрдмрд░: рдмреНрд░реЗрдХ </h1><br><p>  рдХреИрд╕реЗ рд╣реЛрддреА рд╣реИ рдЧрдгрдирд╛ рдореЗрдВ рдмрд╛рдзрд╛?  рдХреНрд╡рд╛рдВрдЯрдо рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, рдПрдХ рд╕рдордп рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред  рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдлрд╛рдЗрдмрд░ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдЬрд╛рдБрдЪ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдЙрд╕ рддрдХ рдкрд╣реБрдБрдЪ рдЧрдП рд╣реИрдВред  рдФрд░ рдпрджрд┐ рдЖрдк рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ, рддреЛ <code>Promise</code> рд╣реИ, рдЬреЛ рдЕрдЧрд▓реЗ рдлреНрд░реЗрдо рдореЗрдВ рд╣рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирдИ рдорд╛рддреНрд░рд╛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ редред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() &gt; $mol_fiber.deadline ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>( $mol_fiber.schedule ) }</code> </pre> <br><h1 id="mol_fiber-deadline">  $ mol_fiber: рд╕рдордп рд╕реАрдорд╛ </h1><br><p>  рдХреНрд╡рд╛рдВрдЯрдо рдХреЗ рд▓рд┐рдП рд╕рдордп рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рд╡рд░реНрддрдорд╛рди рд╕рдордп рдореЗрдВ 8 рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред  рдареАрдХ 8 рдХреНрдпреЛрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╢реЙрдЯ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 16 рдЬрд┐рддрдиреЗ рд╣реИрдВ?  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдХрд┐рддрдиреА рджреЗрд░ рддрдХ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдордп рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдХреБрдЫ рднреА рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдФрд░ рдлрд┐рд░ 8ms рдХреНрд╡рд╛рдВрдЯрд╛ рдХреЗ рд╕рд╛рде рд╣рдо рдПрдХ рд╣реА рдлреНрд░реЗрдо рдореЗрдВ рдПрдХ рдФрд░ рдХреНрд╡рд╛рдВрдЯрдо рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдиреНрдпреВрдирддрдо рдкреНрд░реЛрд╕реЗрд╕рд░ рдбрд╛рдЙрдирдЯрд╛рдЗрдо рдХреЗ рд╕рд╛рде рдХреНрд╡рд╛рдВрдЯрд╛ рдХреА рдПрдХ рддрдВрдЧ рдкреИрдХрд┐рдВрдЧ рджреЗрдЧрд╛ред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> now = <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quant = <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> elapsed = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max( <span class="hljs-number"><span class="hljs-number">0</span></span> , now - $mol_fiber.deadline ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resistance = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min( elapsed , <span class="hljs-number"><span class="hljs-number">1000</span></span> ) / <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 .. 100 ms $mol_fiber.deadline = now + quant + resistence</span></span></code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рд╕рд┐рд░реНрдл рд╣рд░ 8ms рдкрд░ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХрддреЗ рд╣реИрдВ, рддреЛ рдЕрдкрд╡рд╛рдж рдмрдВрдж рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде рдбрд┐рдмрдЧрд┐рдВрдЧ рдирд░рдХ рдХреА рдПрдХ рдЫреЛрдЯреА рд╢рд╛рдЦрд╛ рдореЗрдВ рдмрджрд▓ рдЬрд╛рдПрдЧреАред  рдЗрд╕ рдбрд┐рдмрдЧрд░ рдореЛрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдХреБрдЫ рддрдВрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдХреЗрд╡рд▓ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд░реВрдк рд╕реЗ рд╕рдордЭрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рдПрдХ рд╕реЗрдХрдВрдб рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рдЦрдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдФрд░ рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рдирд┐рдпрдВрддреНрд░рдг рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд░ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдЖрдпрд╛, рддреЛ рдпрд╛ рддреЛ рдбрд┐рдмрдЧрд░ рдмрдВрдж рд╣реЛ рдЧрдпрд╛, рдпрд╛ рдПрдХ рднрд╛рд░реА рдЧрдгрдирд╛ рд╣реБрдИред  рджреЛрдиреЛрдВ рдХреБрд░реНрд╕рд┐рдпреЛрдВ рдкрд░ рдмреИрдардиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдмреАрддреЗ рд╣реБрдП рд╕рдордп рдХрд╛ 10% рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди 100 рдПрдордПрд╕ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВред  рдпрд╣ рдПрдлрдкреАрдПрд╕ рдХреЛ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдкрд░рд┐рдорд╛рдгреАрдХрд░рдг рдХреЗ рдХрд╛рд░рдг рдкрд░рд┐рдорд╛рдг рдХреЗ рдПрдХ рдХреНрд░рдо рд╕реЗ рдбрд┐рдмрдЧрд░ рдХреА рд░реЛрдХ рдЖрд╡реГрддреНрддрд┐ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред </p><br><h1 id="debug-trycatch">  рдбрд┐рдмрдЧ: рдХреЛрд╢рд┐рд╢ / рдкрдХрдбрд╝ </h1><br><p>  рдЪреВрдВрдХрд┐ рд╣рдо рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЖрдкрдХреЛ рдХреНрдпрд╛ рд▓рдЧрддрд╛ рд╣реИ, рдЗрд╕ рдХреЛрдб рдХреЗ рдХрд┐рд╕ рд╕реНрдерд╛рди рдкрд░ рдбреАрдмрдЧрд░ рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ? </p><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> new Error( <span class="hljs-string"><span class="hljs-string">'Something wrong'</span></span> ) // [<span class="hljs-number"><span class="hljs-number">1</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { foo() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error ) { handle( error ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error // [<span class="hljs-number"><span class="hljs-number">2</span></span>] }</code> </pre> <br><p>  рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдЙрд╕реЗ рд░реЛрдХрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдХрд┐ рдЕрдкрд╡рд╛рдж рдкрд╣рд▓реА рдмрд╛рд░ рдХрд╣рд╛рдВ рдлреЗрдВрдХрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╡рд╣ рдХреЗрд╡рд▓ рд╡рд╣реАрдВ рд░реБрдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЙрд╕реЗ рдкрд┐рдЫрд▓реА рдмрд╛рд░ рдлреЗрдВрдХрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдЬрд╣рд╛рдВ рд╣реБрдЖ рдерд╛, рд╡рд╣рд╛рдВ рд╕реЗ рдмрд╣реБрдд рджреВрд░ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЛ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдкрд╡рд╛рджреЛрдВ рдХреЛ рдХрднреА рднреА рдХреЛрд╢рд┐рд╢-рдХреИрдЪ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ рдкрдХрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд▓реЗрдХрд┐рди рдЕрдкрд╡рд╛рдж рдХреЗ рдмрд┐рдирд╛ рднреА рдпрд╣ рдЕрд╕рдВрднрд╡ рд╣реИред </p><br><h1 id="debug-unhandled-events">  рдбрд┐рдмрдЧ: рдЕрдЦрдВрдбрд┐рдд рдШрдЯрдирд╛рдПрдБ </h1><br><p>  рдЖрдорддреМрд░ рдкрд░, рд░рдирдЯрд╛рдЗрдо рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдШрдЯрдирд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ рдЕрдирдХреИрдкреНрдб рдЕрдкрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рд╣реЛрддреА рд╣реИред </p><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>( <span class="hljs-string"><span class="hljs-string">'Something wrong'</span></span> ) } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener( <span class="hljs-string"><span class="hljs-string">'error'</span></span> , event =&gt; handle( event.error ) ) foo()</code> </pre> <br><p>  рдмреЛрдЭрд┐рд▓рддрд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдореЗрдВ рдРрд╕реА рдЦрд╛рдореА рд╣реИ рдХрд┐ рд╕рднреА рдЕрдкрд╡рд╛рдж рдпрд╣рд╛рдВ рдЖрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рд╕рдордЭрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХрд┐ рдпрд╣ рдШрдЯрдирд╛ рдХрд┐рд╕ рдлрд╛рдЗрдмрд░ рдФрд░ рдлрд╛рдЗрдмрд░ рд╕реЗ рд╣реБрдИ рд╣реИред </p><br><h1 id="debug-promise">  рдбрд┐рдмрдЧ: рд╡рд╛рджрд╛ </h1><br><p>  рдЕрдкрд╡рд╛рджреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рджреЗ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреЗ рддрд░реАрдХреЗ рд╣реИрдВред </p><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>( <span class="hljs-string"><span class="hljs-string">'Something wrong'</span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> { foo() } ).catch( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> handle( error ) )</code> </pre> <br><p>  рд╡рд╛рджрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд░рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рддреБрд░рдВрдд, рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рдкрдХрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдбрд┐рдмрдЧрд░ рдХреЛ рдЗрд╕рдХреА рдШрдЯрдирд╛ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд░реЛрдХ рджреЗрддрд╛ рд╣реИред  рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж, рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ, рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рддреНрд░реБрдЯрд┐ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕ рдлрд╛рдЗрдмрд░ рдиреЗ рд╡рд┐рдлрд▓рддрд╛ рджреА рдФрд░ рдХреМрди рд╕реА рд╡рд┐рдлрд▓рддрд╛ред  рдпрд╣ рдареАрдХ $ mol_fiber рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рддрдВрддреНрд░ рд╣реИред </p><br><h1 id="stack-trace-react-fiber">  рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕: тАЛтАЛрд░рд┐рдПрдХреНрд╢рди рдлрд╛рдЗрдмрд░ </h1><br><p>  рдЖрдЗрдП рдПрдХ рдирдЬрд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рдореЗрдВ рдЖрдкрдХреЛ рд░рд┐рдПрдХреНрдЯ рдлрд╛рдЗрдмрд░ рд╕реЗ .. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/074/97d/d53/07497dd53b67863fe121c9cc7d314f96.png" alt="рдЦрд╛рд▓реА рдвреЗрд░"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдмрд╣реБрдд рд╕реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдорд┐рд▓рддреА рд╣реИред  рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧреА рд╕реЗ, рдХреЗрд╡рд▓ рдЕрдкрд╡рд╛рдж рдХреЗ рдмрд┐рдВрджреБ рдФрд░ рдШрдЯрдХреЛрдВ рдХреЗ рдирд╛рдо рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ рдЕрдзрд┐рдХ рд╣реИрдВред  рдмрд╣реБрдд рдХреБрдЫ рдирд╣реАрдВред </p><br><h1 id="stack-trace-mol_fiber">  рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕: тАЛтАЛ$ mol_fiber </h1><br><p>  $ Mol_fiber рдореЗрдВ, рд╣рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧреА рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рдорд┐рд▓рддрд╛ рд╣реИ: рдХреЛрдИ рд╣рд┐рдореНрдордд рдирд╣реАрдВ, рдХреЗрд╡рд▓ рдЖрд╡реЗрджрди рдХреЛрдб рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдмрд┐рдВрджреБ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╣ рдПрдХ рдЕрдкрд╡рд╛рдж рдЖрдпрд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5b8/99d/8cc/5b899d8ccd70b5489cf87fea439beb5a.png" alt="рд╕рд╛рдордЧреНрд░реА рддрдирд╛рд╡"></p><br><p>  рдпрд╣ рдЖрдВрддреЛрдВ рдХреЗ рдореВрд▓ рдвреЗрд░, рд╡рд╛рджреЛрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╣рдЯрд╛рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ, рдХрдВрд╕реЛрд▓ рдореЗрдВ рддреНрд░реБрдЯрд┐ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╣рд┐рдореНрдордд рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рджрд┐рд▓рдЪрд╕реНрдк рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реИред </p><br><h1 id="mol_fiber-handle">  $ mol_fiber: рд╕рдВрднрд╛рд▓ </h1><br><p>  рддреЛ, рдПрдХ рдХреНрд╡рд╛рдВрдЯрдо рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░реЛрдорд┐рд╕ рдХреЛ рдлреЗрдВрдХ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="hljs javascript">limit() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() &gt; $mol_fiber.deadline ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>( $mol_fiber.schedule ) } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  рд▓реЗрдХрд┐рди, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд╛рджрд╛ рдмрд┐рд▓реНрдХреБрд▓ рдХреБрдЫ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ - рдПрдХ рдлрд╛рдЗрдмрд░ рдХреЗ рд▓рд┐рдП, рдЖрдо рддреМрд░ рдкрд░ рдмреЛрд▓ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рдХрд┐ рдХреНрдпрд╛ рдЙрдореНрдореАрдж рдХрд░реЗрдВ: рдЕрдЧрд▓рд╛ рдлреНрд░реЗрдо, рдбреЗрдЯрд╛ рд▓реЛрдбрд┐рдВрдЧ рдХрд╛ рдкреВрд░рд╛ рд╣реЛрдирд╛ рдпрд╛ рдХреБрдЫ рдФрд░ .. </p><br><pre> <code class="hljs javascript">fail( error : <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( error <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> listener = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.then( listener , listener ) } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  рдлрд╛рдЗрдмрд░ рдХреЗрд╡рд▓ рд╡рд╛рджреЛрдВ рдФрд░ рдкреБрдирд░рд╛рд░рдВрдн рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╡рд╛рджреЛрдВ рдХреЛ рдлреЗрдВрдХрдирд╛ рдФрд░ рдкрдХрдбрд╝рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдкреИрдХреЗрдЬ рдореЗрдВ рдХрдИ рдЙрдкрдпреЛрдЧреА рдЖрд╡рд░рдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </p><br><h1 id="mol_fiber-functions">  $ mol_fiber: рдлрд╝рдВрдХреНрд╢рди </h1><br><p>  рдХрд┐рд╕реА рднреА рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рдмреЗрдХрд╛рд░ рдлрд╛рдЗрдмрд░ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рдЗрд╕реЗ <code>$mol_fiber_func</code> рдореЗрдВ <code>$mol_fiber_func</code> ред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_func <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fiberize } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber/web'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> log = fiberize( <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log ) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> main = fiberize( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> { log( getData( <span class="hljs-string"><span class="hljs-string">'goo.gl'</span></span> ).data ) } )</code> </pre> <br><p>  рдпрд╣рд╛рдВ рд╣рдордиреЗ <code>console.log</code> рдЗрдореНрдкреЛрдЯреЗрдВрдЯ рдмрдирд╛рдпрд╛, рдФрд░ <code>main</code> рдиреЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдмреАрдЪ рдореЗрдВ рд░реБрдХрдирд╛ рд╕рд┐рдЦрд╛рдпрд╛ред </p><br><h1 id="mol_fiber-error-handling">  $ mol_fiber: рддреНрд░реБрдЯрд┐ рд╕реЗ рдирд┐рдкрдЯрдиреЗ </h1><br><p>  рд▓реЗрдХрд┐рди рдЕрдкрд╡рд╛рджреЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рдХреИрд╕реЗ рджрд┐рдпрд╛ рдЬрд╛рдП рдЕрдЧрд░ рд╣рдо <code>try-catch</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?  рдлрд┐рд░ рд╣рдо <code>$mol_fiber_catch</code> рд╕рд╛рде рддреНрд░реБрдЯрд┐ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ... </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_func <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fiberize , $mol_fiber_catch <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> onError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getConfig = fiberize( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> { onError( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">user</span></span> : <span class="hljs-string"><span class="hljs-string">'Anonymous'</span></span> }) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getData( <span class="hljs-string"><span class="hljs-string">'/config'</span></span> ).data } )</code> </pre> <br><p>  рдпрджрд┐ рд╣рдо рдЗрд╕рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╕реЗ рдХреБрдЫ рдЕрд▓рдЧ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╡рд░реНрддрдорд╛рди рдлрд╛рдЗрдмрд░ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрдЧрд╛ред  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдпрджрд┐ рд╕рд░реНрд╡рд░ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рддреЛ <code>getConfig</code> рдлрд╝рдВрдХреНрд╢рди рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ <code>getConfig</code> рдХреЛ рд╡рд╛рдкрд╕ рдХрд░ рджреЗрдЧрд╛ред </p><br><h1 id="mol_fiber-methods">  $ mol_fiber: рд╡рд┐рдзрд┐рдпрд╛рдБ </h1><br><p>  рдмреЗрд╢рдХ, рдЖрдк рди рдХреЗрд╡рд▓ рдлрд╝рдВрдХреНрд╢рди рд▓рдкреЗрдЯ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдПрдХ рдбреЗрдХреЛрд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_method <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber/web'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mover</span></span></span><span class="hljs-class"> </span></span>{ @action move() { sendData( <span class="hljs-string"><span class="hljs-string">'ya.ru'</span></span> , getData( <span class="hljs-string"><span class="hljs-string">'goo.gl'</span></span> ) ) } }</code> </pre> <br><p>  рдпрд╣рд╛рдБ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ Google рд╕реЗ рдбреЗрдЯрд╛ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕реЗ рдпреИрдВрдбреЗрдХреНрд╕ рдкрд░ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ред </p><br><h1 id="mol_fiber-promises">  $ mol_fiber: рд╡рд╛рджреЗ </h1><br><p>  рд╕рд░реНрд╡рд░ рд╕реЗ рдбреЗрдЯрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдлрд╝рдВрдХреНрд╢рди <code>fetch</code> рдФрд░ рдХрд▓рд╛рдИ рдХреЗ рдПрдХ рдлреНрд▓рд┐рдХ рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВред </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_sync <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sync } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber/web'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getData = sync( fetch )</code> </pre> <br><p>  рдпрд╣ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╕рднреА рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдЕрдиреБрд░реЛрдз рдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдЬрдм рддрдВрддреБрдУрдВ рдХрд╛ рдПрдХ рдкреЗрдбрд╝ рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдзрд┐рдХ рднреНрд░рдорд┐рдд <code>API</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><h1 id="mol_fiber-cancel-request">  $ mol_fiber: рдЕрдиреБрд░реЛрдз рд░рджреНрдж рдХрд░реЗрдВ </h1><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_async <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber/web'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> uri : string </span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">back</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbortController(); fetch( uri , { <span class="hljs-attr"><span class="hljs-attr">signal</span></span> : controller.signal } ).then( back( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> res ) , back( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error } ) , ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> controller.abort() } ) }</code> </pre> <br><p>  <code>async</code> рдЖрд╡рд░рдг рдХреЗ рд▓рд┐рдП рджрд┐рдпрд╛ рдЧрдпрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ <code>back</code> рд░реИрдкрд░ рдХреЛ рдЗрд╕реЗ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЖрдкрдХреЛ рдХреЙрд▓рдмреИрдХ рдХреЛ рд▓рдкреЗрдЯрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдЗрди рдХреЙрд▓рдмреИрдХ рдореЗрдВ, рдЖрдкрдХреЛ рдпрд╛ рддреЛ рдореВрд▓реНрдп рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХрдирд╛ рд╣реЛрдЧрд╛ред  рдХреЙрд▓рдмреИрдХ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЬреЛ рднреА рд╣реЛ, рдпрд╣ рдлрд╛рдЗрдмрд░ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рднреА рд╣реЛрдЧрд╛ред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдВрдд рдореЗрдВ рд╣рдо рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ рдЬреЛ рдлрд╛рдЗрдмрд░ рдХреЗ рд╕рдордп рд╕реЗ рдкрд╣рд▓реЗ рд╡рд┐рдирд╛рд╢ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><h1 id="mol_fiber-cancel-response">  $ mol_fiber: рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд░рджреНрдж рдХрд░реЗрдВ </h1><br><p>  рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЧрд┐рд░ рдЬрд╛рдиреЗ рдкрд░ рдЧрдгрдирд╛ рдХреЛ рд░рджреНрдж рдХрд░рдирд╛ рднреА рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдЗрдП <code>midleware</code> рдкрд░ рдПрдХ рдЖрд╡рд░рдг рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдЬреЛ рдПрдХ рдлрд╛рдЗрдмрд░ рдмрдирд╛рдПрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдореВрд▓ <code>midleware</code> рдЪрд▓реЗрдЧрд╛ред     ,    ,       ,      . </p><br><pre> <code class="hljs coffeescript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { $mol_fiber_make <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Fiber } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mol_fiber'</span></span> const middle_fiber = middleware =&gt; ( req , res ) =&gt; { const fiber = Fiber( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> middleware( req , res ) ) req.<span class="hljs-literal"><span class="hljs-literal">on</span></span>( <span class="hljs-string"><span class="hljs-string">'close'</span></span> , <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> fiber.destructor() ) fiber.start() } app.get( <span class="hljs-string"><span class="hljs-string">'/foo'</span></span> , middle_fiber( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( req , res )</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something } ) )</code> </pre> <br><h1 id="mol_fiber-concurrency"> $mol_fiber: concurrency </h1><br><p>       ,         .  ,    3 :    ,     ,   - .. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/257/b87/a50/257b87a5095cecaf0e53da2234666a62.png" alt="рддреЗрдЬ рдФрд░ рдзреАрдореА рдЧрддрд┐ рд╕реЗ рдЕрдиреБрд░реЛрдз"></p><br><p>      :      ,    .       .       ,       ,   . </p><br><h1 id="mol_fiber-properties"> $mol_fiber: properties </h1><br><p>  ,    .. </p><br><blockquote> <strong>Pros:</strong> <br><ul><li> Runtime support isn't required </li><li> Can be cancelled at any time </li><li> High FPS </li><li> Concurrent execution </li><li> Debug friendly </li><li> ~ 3KB gzipped </li></ul><br><br> <strong>Cons:</strong> <br><ul><li> Instrumentation is required </li><li> All code should be idempotent </li><li> Longer total execution </li></ul><br></blockquote><p> $mol_fiber тАФ   ,         .  тАФ ,            .      , ,    .  ,   ,     ,     ,      .  ,          .        . </p><br><h1 id="links"> Links </h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">nin-jin.github.io/slides/fibers/</a> тАФ this slides </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">mol.js.org/fiber</a> тАФ $mol_fiber online demo </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">github.com/eigenmethod/mol/tree/master/fiber</a> тАФ $mol_fiber documentation </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">t.me/mam_mol</a> тАФ lovely $mol chat </li></ul><br><h1 id="call-back"> Call back </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d35/cd4/554/d35cd4554553fa35a7d756cbf9737949.jpg" alt="рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛"></p><br><p> <strong></strong> :   , ,        ) </p><br><p> <strong></strong> :  ,       . </p><br><p> <strong></strong> :  .    ,        . </p><br><p> <strong></strong> :    .   ,        .   ,    . </p><br><p> <strong></strong> :   ,            .     ,      ) </p><br><p> <strong></strong> :    ,     . </p><br><p> <strong></strong> :    -      .   ,        ,     . </p><br><p> <strong></strong> :       .  ,  ,     . </p><br><p> <strong></strong> :  ,     .     16ms,     ?  16  8 ,      8,   .      ,       .            ,    ┬л┬╗. </p><br><p> <strong></strong> :      тАФ       .  рдзрдиреНрдпрд╡рд╛рдж! </p><br><p> <strong></strong> :    .    ,   .  ! </p><br><p> <strong></strong> :  ,         .        . </p><br><p> <strong></strong> :  ,     ,            ,      ,     ,     / ,            . </p><br><p> <strong></strong> :  ,     . </p><br><p> <strong></strong> :  . </p><br><p> <strong></strong> :         ,     .      mol. </p><br><p> <strong></strong> :    ,     ,    . ,  ,  ,   . </p><br><p> <strong></strong> :   . </p><br><p> <strong></strong> :       ,     .   ,     $mol,    ,  . </p><br><p> <strong></strong> :  ,  ,      .            тАФ .  . </p><br><p> <strong></strong> :  -   ,         . </p><br><p> <strong></strong> :       $mol    ,        .  (pdf,  )  ,      . </p><br><p> <strong></strong> :     ,   .   ,     . </p><br><p> <strong></strong> :   ,    )       . </p><br><p> <strong></strong> :   .  . </p><br><p> <strong></strong> : In some places I missed what the reporter was saying. The conversation was about how to use the "Mola" library and "why?". But how it works remains a mystery for me.To smoke an source code is for the overhead. </p><br><p> <strong> </strong> :  ,  . </p><br><p> <strong> </strong> :  .         ,    .       .        . </p><br><p> <strong> </strong> :     :     .   -      (,   ).           ,   :          16? </p><br><p> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЛ-рд╕реЛ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : рдореИрдВрдиреЗ рдлрд╛рдЗрдмрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдореИрдВрдиреЗ рдлрд╛рдЗрдмрд░ рдХреЗ рдХрд╛рдо рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЛ рд╕реБрдирд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдмрд┐рд▓рдХреБрд▓ рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рд╛ рдХрд┐ рдШрд░ рдкрд░ mol_fiber рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ ... рдЫреЛрдЯреЗ рдЙрджрд╛рд╣рд░рдг рдмрд╣реБрдд рдЕрдЪреНрдЫреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди 60fps рдкрд░ рддреЗрдЬреА рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ 30fps рдХреЗ рд╕рд╛рде рдмрдбрд╝реЗ рдЖрд╡реЗрджрди рдкрд░ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - рдХреЛрдИ рд╕рдордЭ рдирд╣реАрдВ рдереАред </font><font style="vertical-align: inherit;">рдЕрдм, рдЕрдЧрд░ рд▓реЗрдЦрдХ рдиреЗ рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдФрд░ рдХрдо рдЖрдВрддрд░рд┐рдХ рдореЙрдбреНрдпреВрд▓ рдбрд┐рдЬрд╛рдЗрди - рд░реЗрдЯрд┐рдВрдЧ рдЕрдзрд┐рдХ рд╣реЛрдЧреАред</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi413791/">https://habr.com/ru/post/hi413791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi413779/index.html">Arduino рдкрд░ рдЯрд╛рдЗрдорд░ рдФрд░ рдорд▓реНрдЯреАрдЯрд╛рд╕реНрдХрд┐рдВрдЧ</a></li>
<li><a href="../hi413781/index.html">рд╡рд┐рдЬреНрдЮрд╛рдкрди рдмреНрд▓рдбрд╣рд╛рдЙрдВрдб рдХреИрд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЖрдкрдХреЗ рдирд┐рд╢рд╛рди рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi413783/index.html">рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рд╕рд┐рддрд╛рд░реЗ рдХреИрд╕реЗ рдорд░рддреЗ рд╣реИрдВ: рд╕реБрдкрд░рдиреЛрд╡рд╛, рд╣рд╛рдЗрдкрд░рдиреЛрд╡рд╛, рдпрд╛ рдкреНрд░рддреНрдпрдХреНрд╖ рдкрддрди?</a></li>
<li><a href="../hi413787/index.html">рдХреЛрдгреАрдп: ngx- рдЕрдиреБрд╡рд╛рджред рд╡реЗрдмрдкреИрдХ рдХреЗ рд╕рд╛рде рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдореЗрдВ рд╕реБрдзрд╛рд░</a></li>
<li><a href="../hi413789/index.html">рдлреНрд▓реЛрд░рд┐рдбрд╛ рдореЗрдВ, рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрдХ рд╡рд░реНрд╖ рдХреЗ рд▓рд┐рдП рдПрдлрдмреАрдЖрдИ рдЖрдзрд╛рд░ рдкрд░ рд╣рдерд┐рдпрд╛рд░ рдЦрд░реАрджрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдкрд╛рд╕рд╡рд░реНрдб рднреВрд▓ рдЧрдП рдереЗ</a></li>
<li><a href="../hi413793/index.html">рдкреЙрдк рд╕рдВрд╕реНрдХреГрддрд┐ рдореЗрдВ рдСрдбрд┐рдпреЛ рдХреИрд╕реЗрдЯ: рдХреНрдпреЛрдВ рдЕрдкреНрд░рдЪрд▓рд┐рдд рдзреНрд╡рдирд┐ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдкреНрд░рд╛рд░реВрдк рдХреЛ рдлрд┐рд░ рд╕реЗ рдлреИрд╢рдиреЗрдмрд▓ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ</a></li>
<li><a href="../hi413795/index.html">рдордиреЛрд░рдВрдЬрди рдЙрджреНрдпреЛрдЧ IaaS рдкрд░ рдХреНрдпреЛрдВ рдЬрд╛ рд░рд╣рд╛ рд╣реИ: рдХреЗрд╕ рд╕реНрдЯрдбреА</a></li>
<li><a href="../hi413797/index.html">EA рдиреЗ E3 рдкрд░ C & C рдХрд╛ рдирдпрд╛ рднрд╛рдЧ рдкреЗрд╢ рдХрд┐рдпрд╛ред рдФрд░ рдЗрд╕реЗ рджреЗрдЦрдирд╛ рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ рджрд░реНрджрдирд╛рдХ рд╣реИ</a></li>
<li><a href="../hi413799/index.html">рд░рд╛рд╕реНрдкрдмреЗрд░реА рдкрд╛рдИ рдиреНрдпреВрд░рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдмреА рдХрд╛рдЙрдВрдЯрд┐рдВрдЧ</a></li>
<li><a href="../hi413801/index.html">"рд░реЛрд╕рдХреЛрд╕рдореЛрд╕" рдПрдХ рд▓реЗрдЬрд░ рддреЛрдк ... рдПрдХ рдСрдкреНрдЯрд┐рдХрд▓ рдЯреЗрд▓реАрд╕реНрдХреЛрдк рдХрд╛ рд░реАрдореЗрдХ рдмрдирд╛рдиреЗ рдХреА рдкреЗрд╢рдХрд╢ рдХрд░рддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>