<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♎️ 😰 🎧 Sourcery pour convertir automatiquement en structures d'objets Realm 🐶 👨🏼‍✈️ 🔷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sur Internet , et même sur Habré , il y a un tas d'articles sur la façon de travailler avec Realm. Cette base de données est assez pratique et nécessi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sourcery pour convertir automatiquement en structures d'objets Realm</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460867/">  Sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Internet</a> , et même sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Habré</a> , il y a un tas d'articles sur la façon de travailler avec Realm.  Cette base de données est assez pratique et nécessite un minimum d'effort pour écrire du code, si vous pouvez l'utiliser.  Cet article décrira la méthode de travail à laquelle je suis arrivé. <br><a name="habracut"></a><br><h2>  Les problèmes </h2><br><h4>  Optimisation du code </h4><br>  Évidemment, chaque fois que vous écrivez du code d'initialisation pour un objet Realm et appelez les mêmes fonctions pour lire et écrire des objets, cela ne vous convient pas.  Vous pouvez l'envelopper dans l'abstraction. <br><br>  Exemple d'objet d'accès aux données: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DAO</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">O</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">persist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with object: O)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> realm = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">Realm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? realm.write { realm.add(object, update: .all) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(by key: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">O?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> realm = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">Realm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> realm.object(ofType: <span class="hljs-type"><span class="hljs-type">O</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forPrimaryKey: key) } }</code> </pre> <br>  Utilisation: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> yourObjectDAO = <span class="hljs-type"><span class="hljs-type">DAO</span></span>&lt;<span class="hljs-type"><span class="hljs-type">YourObject</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = <span class="hljs-type"><span class="hljs-type">YourObject</span></span>(key) yourObjectDAO.persist(with: object) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> allPersisted = yourObjectDAO.read(by: key)</code> </pre><br>  Vous pouvez ajouter de nombreuses méthodes utiles au DAO, par exemple: pour supprimer, lire tous les objets du même type, trier, etc. Ils fonctionneront tous avec n'importe lequel des objets du domaine. <br><br><h4>  Accessible à partir d'un thread incorrect </h4><br>  Realm est une base de données sécurisée pour les threads.  Le principal inconvénient qui en résulte est l'impossibilité de transférer un objet de type Realm.Object d'un thread à un autre. <br><br>  Code: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.global(qos: .background).async { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> objects = yourObjectDAO.read(by: key) <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.sync { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(objects) } }</code> </pre><br>  Cela donnera une erreur: <br><br><pre> <code class="plaintext hljs">Terminating app due to uncaught exception 'RLMException', reason: 'Realm accessed from incorrect thread.'</code> </pre><br>  Bien sûr, vous pouvez travailler avec l'objet tout le temps dans un seul fil, mais en réalité cela crée certaines difficultés qu'il vaut mieux contourner. <br><br>  Pour la solution, il est «pratique» de convertir Realm.Object en structures qui seront tranquillement transférées entre différents threads. <br><br>  Objet de domaine: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BirdObj</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">primaryKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"id"</span></span> } }</code> </pre><br>  Structure: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bird</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> }</code> </pre><br>  Pour convertir des objets en structures, nous utiliserons des implémentations de protocoles <br>  Traducteur: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Translator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Object</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toAny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with object: Object)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Any</span></span> }</code> </pre><br>  Pour Bird, cela ressemblera à ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BirdTranslator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Translator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> any = any <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">Bird</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = <span class="hljs-type"><span class="hljs-type">BirdObj</span></span>() object.id = any.id object.name = any.name <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> object } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toAny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with object: Object)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Any</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">BirdObj</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Bird</span></span>(id: object.id, name: object.name) } }</code> </pre><br>  Il reste maintenant à modifier légèrement le DAO pour qu'il accepte et renvoie des structures, pas des objets de domaine. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DAO</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">O</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translator: <span class="hljs-type"><span class="hljs-type">Translator</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(translator: <span class="hljs-type"><span class="hljs-type">Translator</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.translator = translator } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">persist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> realm = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">Realm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = translator.toObject(with: any) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? realm.write { realm.add(object, update: .all) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(by key: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Any?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> realm = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">Realm</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = realm.object(ofType: <span class="hljs-type"><span class="hljs-type">O</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forPrimaryKey: key) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translator.toAny(with: object) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } }</code> </pre><br>  Le problème semble être résolu.  Maintenant, le DAO renverra une structure Bird qui peut être librement déplacée entre les threads. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> birdDAO = <span class="hljs-type"><span class="hljs-type">DAO</span></span>&lt;<span class="hljs-type"><span class="hljs-type">BirdObj</span></span>&gt;(translator: <span class="hljs-type"><span class="hljs-type">BirdTranslator</span></span>()) <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.global(qos: .background).async { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bird = birdDAO.read(by: key) <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.sync { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(bird) } }</code> </pre><br><h4>  Une énorme quantité du même type de code. </h4><br>  Après avoir résolu le problème du transfert d'objets entre les threads, nous en avons rencontré un nouveau.  Même dans notre cas le plus simple, avec une classe de deux champs, nous devons écrire 18 lignes de code supplémentaires.  Imaginez s'il n'y a pas 2 champs, par exemple 10, et certains d'entre eux ne sont pas des types primitifs, mais des entités qui doivent également être transformées.  Tout cela crée un tas de lignes du même type de code.  Un changement trivial dans la structure des données dans la base de données vous oblige à grimper en trois endroits. <br><br>  Le code de chaque entité est toujours, dans son essence, le même.  La différence en elle ne dépend que des domaines des structures. <br><br>  Vous pouvez écrire la génération automatique, qui analysera nos structures en émettant Realm.Object et Translator pour chacune.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La sourcerie</a> peut vous y aider.  Il y avait déjà un article sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habra</a> sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mocking</a> avec son aide. <br><br>  Afin de maîtriser cet outil à un niveau suffisant, j'avais suffisamment de descriptions de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">balises</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modèles et de filtres</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pochoirs</a> (sur la base desquels Sourcery a été créé) et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de Sourcery elle-même</a> . <br><br>  Dans notre exemple spécifique, la génération de Realm.Object pourrait ressembler à ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RealmSwift #1 {% for type in types.structs %} #2 final class {{ type.name }}Obj: Object { #3 {% for variable in type.storedVariables %} {% if variable.typeName.name == "String" %} @objc dynamic var {{variable.name}}: String = "" {% endif %} {% endfor %} override static func primaryKey() -&gt; String? { return "id" } } {% endfor %}</code> </pre><br>  # 1 - Nous passons par toutes les structures. <br>  # 2 - Pour chacun, nous créons notre propre objet de classe héritière. <br>  # 3 - Pour chaque champ avec le type type == String, créez une variable avec le même nom et type.  Ici, vous pouvez ajouter du code pour des primitives telles que Int, Date et les plus complexes.  Je pense que l'essence est claire. <br><br>  Le code de génération de Translator est similaire. <br><br><pre> <code class="swift hljs">{% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types.structs %} <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span></span>{{ type.name }}<span class="hljs-type"><span class="hljs-type">Translator</span></span>: <span class="hljs-type"><span class="hljs-type">Translator</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with entity: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> entity = entity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! {{ type.name }} <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = {{ type.name }}<span class="hljs-type"><span class="hljs-type">Obj</span></span>() {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> variable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> type.storedVariables %} object.{{variable.name}} = entity.{{variable.name}} {% endfor %} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> object } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toAny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with object: Object)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Any</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! {{ type.name }}<span class="hljs-type"><span class="hljs-type">Obj</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Bird</span></span>( {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> variable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> type.storedVariables %} {{variable.name}}: object.{{variable.name}}{%<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> not forloop.last%},{%endif%} {% endfor %} ) } } {% endfor %}</code> </pre><br>  Il est préférable d'installer Sourcery via le gestionnaire de dépendances, en indiquant la version afin que ce que vous écrivez fonctionne de la même manière pour tous et ne se casse pas. <br><br>  Après l'installation, il nous reste à écrire une ligne de code bash pour l'exécuter dans le projet BuildPhase.  Il doit être généré avant que les fichiers de votre projet ne commencent à se compiler. <br><br><img src="https://habrastorage.org/webt/im/g6/nu/img6nuoqb607uqn248a4cizjtog.png"><br><br><h2>  Conclusion </h2><br>  L'exemple que j'ai donné était assez simplifié.  Il est clair que dans les grands projets, les fichiers comme .stencil seront beaucoup plus volumineux.  Dans mon projet, ils occupent un peu moins de 200 lignes, tout en générant 4000 et en ajoutant, entre autres, la possibilité de polymorphisme dans Realm. <br>  En général, je n'ai pas rencontré de retard dû à la conversion de certains objets en d'autres. <br>  Je serai heureux de toute rétroaction et critique. <br><br><h2>  Les références </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Realm swift</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github Sourcery</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation Sourcery</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Balises et filtres de gabarit intégrés au gabarit</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Se moquer rapidement avec Sourcery</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Création d'une application ToDo à l'aide de Realm et Swift</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460867/">https://habr.com/ru/post/fr460867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460857/index.html">Comment Namecoin Blockchain Research a prédit les cyber-attaques RTM</a></li>
<li><a href="../fr460859/index.html">Conférence IThink # 3 à Kharkov - basée sur la WWDC 2019</a></li>
<li><a href="../fr460861/index.html">Portée lexicale JavaScript et fermeture</a></li>
<li><a href="../fr460863/index.html">Détails du crash de Cloudflare 2 juillet 2019</a></li>
<li><a href="../fr460865/index.html">Les gens sur la lune. Les sources</a></li>
<li><a href="../fr460869/index.html">Reconnaissance d'objets en temps réel sur iOS à l'aide de YOLOv3</a></li>
<li><a href="../fr460873/index.html">Pourquoi Turok: Dinosaur Hunter pour N64 a des années d'avance sur son temps</a></li>
<li><a href="../fr460875/index.html">Comment nous, chez QIWI, sommes arrivés à un style commun d'interaction entre View et ViewModel au sein de MVVM</a></li>
<li><a href="../fr460877/index.html">Kubernetes-adventure Dailymotion: construction d'infrastructures dans les nuages ​​+ sur site</a></li>
<li><a href="../fr460879/index.html">DUMP Kazan 2019 - Conférence des développeurs du Tatarstan. Nous acceptons les demandes de rapports</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>