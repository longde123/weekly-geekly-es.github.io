<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‚ ğŸ† â™‘ï¸ çŸ³å¢¨çƒ¯-Pythonå†é™©å¹´ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘©ğŸ» ğŸˆ ğŸ¥’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="çŸ³å¢¨çƒ¯-Pythonå†é™©å¹´ 





å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯pythonå¼€å‘äººå‘˜ã€‚ å»å¹´ï¼Œæˆ‘ä½¿ç”¨äº†graphene-python + django ORMï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘å°è¯•åˆ›å»ºæŸç§å·¥å…·æ¥ç®€åŒ–ä½¿ç”¨çŸ³å¢¨çƒ¯çš„å·¥ä½œã€‚ ç»“æœï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªå°çš„graphene-frameworkä»£ç åº“å’Œä¸€ç»„æˆ‘æƒ³åˆ†äº«çš„è§„åˆ™ã€‚ 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>çŸ³å¢¨çƒ¯-Pythonå†é™©å¹´</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461939/"><h1 id="god-priklyucheniy-s-graphene-python"> çŸ³å¢¨çƒ¯-Pythonå†é™©å¹´ </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c77/e6d/8c3/c77e6d8c390320295743710d11babfac.png" alt="å›¾ç‰‡"></p><br><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯pythonå¼€å‘äººå‘˜ã€‚ å»å¹´ï¼Œæˆ‘ä½¿ç”¨äº†graphene-python + django ORMï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘å°è¯•åˆ›å»ºæŸç§å·¥å…·æ¥ç®€åŒ–ä½¿ç”¨çŸ³å¢¨çƒ¯çš„å·¥ä½œã€‚ ç»“æœï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªå°çš„<code>graphene-framework</code>ä»£ç åº“å’Œä¸€ç»„æˆ‘æƒ³åˆ†äº«çš„è§„åˆ™ã€‚ </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/getpro/habr/post_images/458/645/f18/458645f180f8fff23bcbd543065d8c11.png" alt="å›¾ç‰‡"></p><br><p> ä»€ä¹ˆæ˜¯çŸ³å¢¨çƒ¯-pythonï¼Ÿ </p><br><p> æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">graphene-python.org</a> ï¼Œåˆ™ï¼š </p><br><blockquote>  Graphene-Pythonæ˜¯ç”¨äºä½¿ç”¨Pythonè½»æ¾åˆ›å»ºGraphQL APIçš„åº“ã€‚ å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯æä¾›ä¸€ä¸ªç®€å•ä½†åŒæ—¶å¯æ‰©å±•çš„APIï¼Œä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚ </blockquote><p>  <strong>å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯æä¾›ä¸€ä¸ªç®€å•ä½†åŒæ—¶å¯æ‰©å±•çš„APIï¼Œä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚</strong> </p><br><p> æ˜¯çš„ï¼Œå®é™…ä¸ŠçŸ³å¢¨çƒ¯æ˜¯ç®€å•ä¸”å¯æ‰©å±•çš„ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œå¯¹äºå¤§å‹ä¸”å¿«é€Ÿå¢é•¿çš„åº”ç”¨æ¥è¯´ï¼Œå®ƒå¤ªç®€å•äº†ã€‚ ç®€çŸ­çš„æ–‡æ¡£ï¼ˆæˆ‘æ”¹ç”¨äº†æºä»£ç -æ›´ä¸ºå†—é•¿ï¼‰ï¼ŒåŠ ä¸Šç¼ºå°‘ç¼–å†™ä»£ç çš„æ ‡å‡†ï¼Œå› æ­¤è¯¥åº“ä¸æ˜¯æ‚¨ä¸‹ä¸€ä¸ªAPIçš„æœ€ä½³é€‰æ‹©ã€‚ </p><br><p> æ— è®ºå¦‚ä½•ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæˆ‘å†³å®šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼Œå¹¶è§£å†³äº†å¤§å¤šæ•°é—®é¢˜ï¼ˆç”±äºçŸ³å¢¨çƒ¯å…·æœ‰ä¸°å¯Œçš„æœªè®°å½•ç‰¹å¾ï¼‰ã€‚ æˆ‘çš„æŸäº›è§£å†³æ–¹æ¡ˆçº¯ç²¹æ˜¯æ¶æ„æ€§çš„ï¼Œæ— éœ€æ¡†æ¶å³å¯ç›´æ¥ä½¿ç”¨ã€‚ ä½†æ˜¯ï¼Œå®ƒä»¬çš„å…¶ä½™éƒ¨åˆ†ä»éœ€è¦ä¸€äº›ä»£ç åº“ã€‚ </p><br><p> æœ¬æ–‡ä¸æ˜¯æ–‡æ¡£ï¼Œè€Œæ˜¯ä»æŸç§æ„ä¹‰ä¸Šç®€çŸ­åœ°æè¿°äº†æˆ‘æ‰€èµ°çš„é“è·¯ä»¥åŠä»¥ä¸€ç§æˆ–å¤šç§æ–¹å¼è§£å†³çš„é—®é¢˜ï¼Œå¹¶ç®€è¦è¯´æ˜äº†é€‰æ‹©çš„ç†ç”±ã€‚ åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å…³æ³¨çªå˜åŠå…¶ç›¸å…³çš„å†…å®¹ã€‚ </p><br><p> æœ¬æ–‡çš„ç›®çš„æ˜¯è·å¾—<strong>ä»»ä½•æœ‰æ„ä¹‰çš„åé¦ˆ</strong> ï¼Œå› æ­¤æˆ‘å°†ç­‰å¾…è¯„è®ºä¸­çš„æ‰¹è¯„ï¼ </p><br><p>  <em>æ³¨æ„ï¼šåœ¨ç»§ç»­é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨ç†Ÿæ‚‰GraphQLã€‚</em> </p><br><hr><br><h2 id="mutacii"> å˜å¼‚ </h2><br><blockquote> å…³äºGraphQLçš„å¤§å¤šæ•°è®¨è®ºéƒ½é›†ä¸­åœ¨è·å–æ•°æ®ä¸Šï¼Œä½†æ˜¯ä»»ä½•è‡ªé‡å¹³å°éƒ½éœ€è¦ä¸€ç§æ–¹æ³•æ¥ä¿®æ”¹å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®ã€‚ </blockquote><p> è®©æˆ‘ä»¬ä»çªå˜å¼€å§‹ã€‚ </p><br><p> è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> post_id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, post_id, title, content, image_urls, allow_comments, contact_email)</span></span></span><span class="hljs-function">:</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: post = get_post_by_id(post_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> PostNotFound: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, errors=[<span class="hljs-string"><span class="hljs-string">'post_not_found'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> is_email(contact_email): errors.append(<span class="hljs-string"><span class="hljs-string">'contact_email_not_valid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post.owner != info.context.user: errors.append(<span class="hljs-string"><span class="hljs-string">'not_post_owner'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, title, content, image_urls, allow_comments, contact_email) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=bool(errors), errors=errors)</code> </pre> <br><p>  <code>UpdatePostMutation</code>ä½¿ç”¨ä¼ è¾“çš„æ•°æ®æ›´æ”¹å…·æœ‰ç»™å®š<code>id</code>çš„å¸–å­ï¼Œå¹¶åœ¨ä¸æ»¡è¶³æŸäº›æ¡ä»¶çš„æƒ…å†µä¸‹è¿”å›é”™è¯¯ã€‚ </p><br><p> åªéœ€æŸ¥çœ‹ä¸€ä¸‹æ­¤ä»£ç ï¼Œç”±äºä»¥ä¸‹åŸå› ï¼Œå®ƒçš„ä¸å¯æ‰©å±•æ€§å’Œä¸å¯æ”¯æŒæ€§å°±å˜å¾—å¯è§ï¼š </p><br><ol><li>  <code>mutate</code>å‡½æ•°çš„å‚æ•°å¤ªå¤šï¼Œå³ä½¿æˆ‘ä»¬æƒ³æ·»åŠ æ›´å¤šè¦ç¼–è¾‘çš„å­—æ®µï¼Œå…¶æ•°é‡ä¹Ÿä¼šå¢åŠ ã€‚ </li><li> ä¸ºäº†ä½¿çªå˜åœ¨å®¢æˆ·ç«¯çœ‹èµ·æ¥ç›¸åŒï¼Œå®ƒä»¬å¿…é¡»è¿”å›<code>errors</code>å’Œ<code>ok</code> ï¼Œä»¥ä¾¿å®ƒä»¬çš„çŠ¶æ€ä»¥åŠå§‹ç»ˆå¯ä»¥ç†è§£çš„å†…å®¹ã€‚ </li><li> åœ¨<code>mutate</code>å‡½æ•°ä¸­æœç´¢å’Œæ£€ç´¢<em>å¯¹è±¡</em> ã€‚ ç¦é£Ÿä¸­æœ‰çªå˜åŠŸèƒ½ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¸åº”å‘ç”Ÿçªå˜ã€‚ </li><li> æ£€æŸ¥å˜å¼‚ä¸­çš„æƒé™ã€‚ å¦‚æœç”¨æˆ·æ— æƒæ‰§è¡Œæ­¤æ“ä½œï¼ˆç¼–è¾‘æŸäº›å¸–å­ï¼‰ï¼Œåˆ™ä¸åº”å‘ç”Ÿçªå˜ã€‚ </li><li> ä¸€ä¸ªæ— ç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå¯¹äºé¡¶çº§å­—æ®µï¼Œå§‹ç»ˆä¸º<code>None</code>çš„<em>æ ¹</em> ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„å˜ä½“ï¼‰ã€‚ </li><li> ä¸€ç»„æ— æ³•é¢„æµ‹çš„é”™è¯¯ï¼šå¦‚æœæ‚¨æ²¡æœ‰æºä»£ç æˆ–æ–‡æ¡£ï¼Œé‚£ä¹ˆæ‚¨å°†ä¸çŸ¥é“æ­¤çªå˜ä¼šè¿”å›å“ªäº›é”™è¯¯ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šåæ˜ åœ¨æ–¹æ¡ˆä¸­ã€‚ </li><li> ç›´æ¥åœ¨<code>mutate</code>æ–¹æ³•ä¸­æ‰§è¡Œçš„æ¨¡æ¿é”™è¯¯æ£€æŸ¥å¤ªå¤šï¼Œè¿™æ¶‰åŠ<em>æ›´æ”¹</em>æ•°æ®ï¼Œè€Œä¸æ˜¯å„ç§æ£€æŸ¥ã€‚ ç†æƒ³çš„<code>mutate</code>åº”è¯¥ç”±ä¸€è¡Œç»„æˆ-è°ƒç”¨åç¼–è¾‘åŠŸèƒ½ã€‚ </li></ol><br><p> ç®€è€Œè¨€ä¹‹ï¼Œ <strong><code>mutate</code>åº”è¯¥ä¿®æ”¹data</strong> ï¼Œè€Œä¸è¦å¤„ç†ç¬¬ä¸‰æ–¹ä»»åŠ¡ï¼Œä¾‹å¦‚è®¿é—®å¯¹è±¡å’ŒéªŒè¯è¾“å…¥ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š </p><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> post = Utils.update_post(post, **input) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(post=post)</code> </pre> <br><p> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸Šå‡ ç‚¹ã€‚ </p><br><hr><br><h3 id="polzovatelskie-tipy"> è‡ªå®šä¹‰ç±»å‹ </h3><br><p>  <code>email</code>å­—æ®µæ˜¯ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’çš„ï¼Œè€Œå®ƒæ˜¯<em>ç‰¹å®šæ ¼å¼</em>çš„<em>å­—ç¬¦ä¸²</em> ã€‚  APIæ¯æ¬¡æ”¶åˆ°ç”µå­é‚®ä»¶æ—¶ï¼Œéƒ½å¿…é¡»æ£€æŸ¥å…¶æ­£ç¡®æ€§ã€‚ å› æ­¤ï¼Œæœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Email</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.String)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><p> è¿™ä¼¼ä¹å¾ˆæ˜æ˜¾ï¼Œä½†å€¼å¾—ä¸€æã€‚ </p><br><hr><br><h3 id="vhodnye-tipy"> è¾“å…¥ç±»å‹ </h3><br><p> ä½¿ç”¨è¾“å…¥ç±»å‹è¿›è¡Œçªå˜ã€‚ å³ä½¿å®ƒä»¬ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹é‡å¤ä½¿ç”¨ã€‚ ç”±äºè¾“å…¥ç±»å‹çš„åŸå› ï¼ŒæŸ¥è¯¢å˜å¾—æ›´å°ï¼Œä»è€Œä½¿å®ƒä»¬æ›´æ˜“äºé˜…è¯»å’Œç¼–å†™ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostInput</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.InputObjectType)</span></span></span><span class="hljs-class">:</span></span> title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p> è‡³ï¼š </p><br><pre> <code class="plaintext hljs">mutation( $post_id: ID!, $title: String!, $content: String!, $image_urls: String!, $allow_comments: Boolean!, $contact_email: Email! ) { updatePost( post_id: $post_id, title: $title, content: $content, image_urls: $image_urls, allow_comments: $allow_comments, contact_email: $contact_email, ) { ok } }</code> </pre> <br><p> ä¹‹åï¼š </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: UpdatePostInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p> çªå˜ä»£ç æ›´æ”¹ä¸ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... if not errors: post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation(errors=errors)</span></span></code> </pre> <br><hr><br><h3 id="bazovyy-klass-mutaciy"> åŸºç¡€çªå˜ç±»åˆ« </h3><br><p> å¦‚ç¬¬2æ®µæ‰€è¿°ï¼Œ <em>çªå˜å¿…é¡»è¿”å›<code>errors</code>å¹¶å¯ä»¥<code>ok</code>ä»¥ä¾¿å§‹ç»ˆå¯ä»¥äº†è§£å…¶çŠ¶æ€å’ŒåŸå› </em> ã€‚ è¿™å¾ˆç®€å•ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºç±»ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MutationPayload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) query = graphene.Field(<span class="hljs-string"><span class="hljs-string">'main.schema.Query'</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_ok</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> len(self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> []) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_errors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}</code> </pre> <br><p> ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š </p><br><ul><li>  <code>resolve_ok</code>æ–¹æ³•å·²<code>resolve_ok</code> ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…è‡ªå·±è®¡ç®—<code>ok</code> ã€‚ </li><li>  <code>query</code>å­—æ®µæ˜¯æ ¹<code>Query</code> ï¼Œå®ƒä½¿æ‚¨å¯ä»¥ç›´æ¥åœ¨å˜å¼‚è¯·æ±‚ä¸­æŸ¥è¯¢æ•°æ®ï¼ˆå˜å¼‚å®Œæˆåå°†è¯·æ±‚æ•°æ®ï¼‰ã€‚ <br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok query { profile { totalPosts } } } }</code> </pre> </li></ul><br><p> å½“å®¢æˆ·ç«¯åœ¨çªå˜å®Œæˆåæ›´æ–°ä¸€äº›æ•°æ®å¹¶ä¸”ä¸æƒ³è®©æ”¯æŒè€…è¿”å›æ•´ä¸ªé›†åˆæ—¶ï¼Œè¿™éå¸¸æ–¹ä¾¿ã€‚ æ‚¨ç¼–å†™çš„ä»£ç è¶Šå°‘ï¼Œç»´æŠ¤èµ·æ¥å°±è¶Šå®¹æ˜“ã€‚ æˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»è¿™é‡Œ</a>æ¥å—äº†è¿™ä¸ªæƒ³æ³•ã€‚ </p><br><p> ä½¿ç”¨åŸºæœ¬çªå˜ç±»ï¼Œä»£ç å˜ä¸ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="kornevye-mutacii"> æ ¹çªå˜ </h3><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬çš„å˜æ›´è¯·æ±‚å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p> åœ¨å…¨çƒèŒƒå›´å†…åŒ…å«æ‰€æœ‰çªå˜ä¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ åŸå› å¦‚ä¸‹ï¼š </p><br><ol><li> éšç€çªå˜æ•°é‡çš„å¢åŠ ï¼Œæ‰¾åˆ°æ‰€éœ€çš„çªå˜å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚ </li><li> ç”±äºæœ‰ä¸€ä¸ªåç§°ç©ºé—´ï¼Œå› æ­¤å¿…é¡»åœ¨çªå˜åç§°ä¸­åŒ…å«â€œå…¶æ¨¡å—çš„åç§°â€ï¼Œä¾‹å¦‚<code>update</code> <strong><code>Post</code></strong> ã€‚ </li><li> æ‚¨å¿…é¡»å°†<code>id</code>ä½œä¸ºå‚æ•°ä¼ é€’ç»™çªå˜ã€‚ </li></ol><br><p> æˆ‘å»ºè®®ä½¿ç”¨<em>æ ¹çªå˜</em> ã€‚ ä»–ä»¬çš„ç›®æ ‡æ˜¯é€šè¿‡å°†çªå˜åˆ†æˆå•ç‹¬çš„èŒƒå›´å¹¶ä»è®¿é—®å¯¹è±¡å’Œè®¿é—®å¯¹è±¡çš„é€»è¾‘ä¸­é‡Šæ”¾çªå˜æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ </p><br><p> æ–°è¯·æ±‚å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { post(id: $id) { update(input: $input) { ok } } }</code> </pre> <br><p> è¯·æ±‚å‚æ•°ä¿æŒä¸å˜ã€‚ ç°åœ¨ï¼Œæ›´æ”¹åŠŸèƒ½åœ¨<code>post</code>å†…éƒ¨è¢«â€œè°ƒç”¨â€ï¼Œå®ƒå…è®¸å®ç°ä»¥ä¸‹é€»è¾‘ï¼š </p><br><ol><li> å¦‚æœæ²¡æœ‰å°†<code>id</code>ä¼ é€’åˆ°<code>post</code> ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›<code>{}</code> ã€‚ è¿™ä½¿æ‚¨å¯ä»¥ç»§ç»­åœ¨å…¶ä¸­æ‰§è¡Œçªå˜ã€‚ ç”¨äºä¸éœ€è¦æ ¹å…ƒç´ çš„çªå˜ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºå¯¹è±¡ï¼‰ã€‚ </li><li> å¦‚æœä¼ é€’äº†<code>id</code> ï¼Œåˆ™æ£€ç´¢ç›¸åº”çš„å…ƒç´ ã€‚ </li><li> å¦‚æœæœªæ‰¾åˆ°å¯¹è±¡ï¼Œ <code>None</code>è¿”å›<code>None</code> ï¼Œä»è€Œå®Œæˆè¯·æ±‚ï¼Œä¸è°ƒç”¨è¯¥çªå˜ã€‚ </li><li> å¦‚æœæ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œåˆ™æ£€æŸ¥ç”¨æˆ·çš„æƒé™ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ </li><li> å¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œ <code>None</code>è¿”å›<code>None</code>å¹¶ä¸”è¯·æ±‚å®Œæˆï¼Œä¸ä¼šè°ƒç”¨è¯¥çªå˜ã€‚ </li><li> å¦‚æœç”¨æˆ·å…·æœ‰æƒé™ï¼Œåˆ™è¿”å›æ‰¾åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å˜å¼‚å°†å…¶ä½œä¸ºæ ¹ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ¥æ”¶ã€‚ </li></ol><br><p> å› æ­¤ï¼Œçªå˜ä»£ç æ›´æ”¹ä¸ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, **input.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(errors=errors)</code> </pre> <br><ul><li> ç°åœ¨ï¼Œçªå˜çš„æ ¹ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ˜¯<code>Post</code>ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šæ‰§è¡Œçªå˜ã€‚ </li><li> æˆæƒæ£€æŸ¥å·²ç§»è‡³æ ¹çªå˜ä»£ç ã€‚ </li></ul><br><p> æ ¹çªå˜ä»£ç ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostMutationRoot</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationRoot)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = Post has_permission = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, user: post.owner == user update = UpdatePostMutation.Field()</code> </pre> <br><hr><br><h3 id="interfeys-oshibok"> é”™è¯¯ç•Œé¢ </h3><br><p> ä¸ºäº†ä½¿ä¸€ç»„é”™è¯¯å¯é¢„æµ‹ï¼Œå®ƒä»¬å¿…é¡»åæ˜ åœ¨è®¾è®¡ä¸­ã€‚ </p><br><ul><li> ç”±äºå˜å¼‚ä¼šè¿”å›å¤šä¸ªé”™è¯¯ï¼Œå› æ­¤é”™è¯¯åº”åˆ—ä¸ºæ¸…å•ã€‚ </li><li> ç”±äºé”™è¯¯ç”±ä¸åŒçš„ç±»å‹è¡¨ç¤ºï¼Œå› æ­¤å¯¹äºç‰¹å®šçš„çªå˜ï¼Œå¿…é¡»å­˜åœ¨ç‰¹å®š<code>Union</code>é”™è¯¯<code>Union</code> ã€‚ </li><li> ä¸ºäº†ä½¿é”™è¯¯å½¼æ­¤ä¹‹é—´ä¿æŒç›¸ä¼¼ï¼Œå®ƒä»¬å¿…é¡»å®ç°æ¥å£ï¼Œæˆ‘ä»¬å°†å…¶<code>ErrorInterface</code> ã€‚ è®©å®ƒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼š <code>ok</code>å’Œ<code>message</code> ã€‚ </li></ul><br><p> å› æ­¤ï¼Œé”™è¯¯å¿…é¡»æ˜¯<code>[SomeMutationErrorsUnion]!</code>ç±»å‹<code>[SomeMutationErrorsUnion]!</code>  ã€‚  <code>SomeMutationErrorsUnion</code>æ‰€æœ‰å­ç±»å‹<code>SomeMutationErrorsUnion</code>å¿…é¡»å®ç°<code>ErrorInterface</code> ã€‚ </p><br><p> æˆ‘ä»¬å¾—åˆ°ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotAuthenticated</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleTooShort</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleAlreadyTaken</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [NotAuthenticated, TitleIsTooShort, TitleAlreadyTaken, ]</code> </pre> <br><p> çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä»£ç å¤ªå¤šã€‚ æˆ‘ä»¬ä½¿ç”¨å…ƒç±»åŠ¨æ€ç”Ÿæˆè¿™äº›é”™è¯¯ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ErrorMetaclass)</span></span></span><span class="hljs-class">:</span></span> errors = [ <span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [PostErrors.not_authenticated, PostErrors.title_too_short, PostErrors.title_already_taken, ]</code> </pre> <br><p> å°†è¿”å›çš„é”™è¯¯çš„å£°æ˜æ·»åŠ åˆ°çªå˜ä¸­ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() errors = graphene.List(UpdatePostMutationErrors, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="proverka-na-nalichie-oshibok"> æ£€æŸ¥é”™è¯¯ </h3><br><p> åœ¨æˆ‘çœ‹æ¥ï¼Œé™¤äº†<em>æ”¹å˜æ•°æ®</em>ä¹‹å¤–ï¼Œ <code>mutate</code>æ–¹æ³•ä¸åº”è¯¥å…³å¿ƒä»»ä½•å…¶ä»–äº‹æƒ…ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä¸ºæ­¤åŠŸèƒ½æ£€æŸ¥å…¶ä»£ç ä¸­çš„é”™è¯¯ã€‚ </p><br><p> çœç•¥å®ç°ï¼Œç»“æœå¦‚ä¸‹ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(DefaultMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> root_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> authentication_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-comment"><span class="hljs-comment">#   ,    True   # An iterable of tuples (error_class, checker) checks = [ ( PostErrors.title_too_short, lambda post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, lambda post, input: Post.objects.filter(title=input.title).exists() ), ] def mutate(post, info, input): post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation()</span></span></code> </pre> <br><p> åœ¨å¯åŠ¨<code>mutate</code>å‡½æ•°ä¹‹å‰ï¼Œ <code>mutate</code>è°ƒç”¨æ¯ä¸ª<em>æ£€æŸ¥å™¨</em> ï¼ˆ <code>checks</code>æ•°ç»„çš„æˆå‘˜çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼‰ã€‚ å¦‚æœè¿”å›<code>True</code> ï¼Œåˆ™æ‰¾åˆ°ç›¸åº”çš„é”™è¯¯ã€‚ å¦‚æœæ²¡æœ‰å‘ç°é”™è¯¯ï¼Œåˆ™è°ƒç”¨<code>mutate</code>å‡½æ•°ã€‚ </p><br><p> æˆ‘å°†è§£é‡Šï¼š </p><br><ul><li>  Checkå‡½æ•°é‡‡ç”¨ä¸<code>mutate</code>å‡½æ•°ç›¸åŒçš„å‚æ•°ã€‚ </li><li> å¦‚æœå‘ç°é”™è¯¯ï¼ŒéªŒè¯å‡½æ•°åº”è¿”å›<code>True</code> ã€‚ </li><li> æˆæƒæ£€æŸ¥å’Œæ ¹å…ƒç´ çš„å­˜åœ¨éå¸¸æ™®éï¼Œå¹¶åœ¨<code>Meta</code>æ ‡å¿—ä¸­åˆ—å‡ºã€‚ </li><li>  <code>authentication_required</code>æ·»åŠ æˆæƒæ£€æŸ¥æ˜¯å¦ä¸º<code>True</code> ã€‚ </li><li>  <code>root_required</code>æ·»åŠ ä¸€ä¸ªâ€œ <code>root is not None</code> â€æ£€æŸ¥ã€‚ </li><li> ä¸å†éœ€è¦<code>UpdatePostMutationErrors</code> ã€‚ å¯èƒ½ä¼šæ ¹æ®<code>checks</code>æ•°ç»„çš„é”™è¯¯ç±»åˆ«å³æ—¶åˆ›å»ºä¸€ä¸ªå¯èƒ½çš„é”™è¯¯å¹¶é›†ã€‚ </li></ul><br><hr><br><h3 id="dzheneriki"> æ³›å‹ </h3><br><p> ä¸Šä¸€èŠ‚ä¸­ä½¿ç”¨<code>DefaultMutation</code>æ·»åŠ äº†<code>pre_mutate</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿æ‚¨å¯ä»¥åœ¨æ£€æŸ¥é”™è¯¯ä¹‹å‰æ›´æ”¹è¾“å…¥å‚æ•°ï¼Œå¹¶ç›¸åº”åœ°è°ƒç”¨çªå˜ã€‚ </p><br><p> è¿˜æœ‰ä¸€ä¸ªé€šç”¨å…¥é—¨å·¥å…·åŒ…ï¼Œå¯ç®€åŒ–ä»£ç å¹¶ä½¿å·¥ä½œæ›´è½»æ¾ã€‚ <br>  <em>æ³¨æ„ï¼šå½“å‰é€šç”¨ä»£ç ç‰¹å®šäºdjango ORM</em> </p><br><h4 id="createmutation"> åˆ›å»ºå˜å¼‚ </h4><br><p> éœ€è¦<code>model</code>æˆ–<code>create_function</code> ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>create_function</code>å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="python hljs">model._default_manager.create(**data, owner=user)</code> </pre> <br><p> è¿™å¯èƒ½çœ‹èµ·æ¥ä¸å®‰å…¨ï¼Œä½†æ˜¯è¯·ä¸è¦å¿˜è®°graphqlä¸­æœ‰å†…ç½®çš„ç±»å‹æ£€æŸ¥ä»¥åŠçªå˜æ£€æŸ¥ã€‚ </p><br><p> å®ƒè¿˜æä¾›äº†ä¸€ä¸ª<code>post_mutate</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨<code>create_function</code>ä¹‹åå¸¦æœ‰å‚æ•°<code>(instance_created, user)</code>è¢«è°ƒç”¨ï¼Œå…¶ç»“æœå°†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ </p><br><h4 id="updatemutation"> æ›´æ–°çªå˜ </h4><br><p> å…è®¸æ‚¨è®¾ç½®<code>update_function</code> ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_update_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.__dict__.update(data) instance.save() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance</code> </pre> <br><p>  <code>root_required</code>é»˜è®¤ä¸º<code>True</code> ã€‚ </p><br><p> å®ƒè¿˜æä¾›äº†ä¸€ä¸ª<code>post_mutate</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨<code>update_function</code>ä¹‹åä½¿ç”¨å‚æ•°<code>(instance_updated, user)</code>è¿›è¡Œè°ƒç”¨ï¼Œå…¶ç»“æœå°†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ </p><br><p> è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼ </p><br><p> æœ€ç»ˆä»£ç ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(UpdateMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> checks = [ ( PostErrors.title_too_short, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: Post.objects.filter(title=input.title).exists() ), ]</code> </pre> <br><h4 id="deletemutation">  DeleteMutation </h4><br><p> å…è®¸æ‚¨è®¾ç½®<code>delete_function</code> ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_delete_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.delete()</code> </pre> <br><hr><br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p> æœ¬æ–‡ä»…è€ƒè™‘ä¸€ä¸ªæ–¹é¢ï¼Œå°½ç®¡æˆ‘è®¤ä¸ºè¿™æ˜¯æœ€å¤æ‚çš„ã€‚ æˆ‘å¯¹è§£æå™¨å’Œç±»å‹ä»¥åŠçŸ³å¢¨çƒ¯-pythonä¸­çš„å¸¸è§„å†…å®¹æœ‰ä¸€äº›æƒ³æ³•ã€‚ </p><br><p> æˆ‘å¾ˆéš¾ç§°è‡ªå·±ä¸ºç»éªŒä¸°å¯Œçš„å¼€å‘äººå‘˜ï¼Œå› æ­¤ï¼Œæˆ‘å°†å¾ˆé«˜å…´æ”¶åˆ°ä»»ä½•åé¦ˆå’Œå»ºè®®ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°</a> ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461939/">https://habr.com/ru/post/zh-CN461939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461923/index.html">åœ£å½¼å¾—å ¡çš„JetBrainså¼€æ”¾æ—¥ï¼šè§†é¢‘</a></li>
<li><a href="../zh-CN461927/index.html">ä¸»åŠ¨æ’åå­¦ä¹ </a></li>
<li><a href="../zh-CN461929/index.html">åœ¨Linuxä¸Šç›‘è§†å’Œæ£€æŸ¥SSDçŠ¶æ€</a></li>
<li><a href="../zh-CN461935/index.html">å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨Postgresï¼šåšæ³•ï¼ŒåŠŸèƒ½ï¼Œç»†å¾®å·®åˆ«</a></li>
<li><a href="../zh-CN461937/index.html">å¸•é‡‘æ£®å®šå¾‹ä»¥åŠå¦‚ä½•ç ´è§£</a></li>
<li><a href="../zh-CN461941/index.html">æŒ‰æ‘©ä¸€ä¸‹</a></li>
<li><a href="../zh-CN461945/index.html">2019å¹´8æœˆITé¢†åŸŸHRä¸“ä¸šäººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
<li><a href="../zh-CN461949/index.html">AppCode 2019.2ï¼šSwift 5.1ï¼Œé€šè¿‡æµ‹è¯•åˆ†æä»£ç è¦†ç›–ç‡ï¼Œæ˜¾ç¤ºåæ±‡ç¼–ä»£ç ç­‰</a></li>
<li><a href="../zh-CN461951/index.html">Veeamæ’ä»¶ï¼Œç”¨äºå¤‡ä»½å’Œæ¢å¤SAP HANAæ•°æ®åº“</a></li>
<li><a href="../zh-CN461955/index.html">äº¤æ¢ä»£å¸æˆ–å¦‚ä½•åœ¨2019å¹´åŠ å¼ºåŠ å¯†è´§å¸æŠ•èµ„ç»„åˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>