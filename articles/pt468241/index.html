<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÅ üë®üèº‚Äçüîß üéÆ TR-069 na Mikrotik. Testando Freeacs como um servidor de configura√ß√£o autom√°tica para o RouterOS üëÜüèª üöà üë®üèæ‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, tentarei descrever passo a passo o processo de instala√ß√£o do servidor de teste de um excelente projeto Freeacs para um estado totalmente...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TR-069 na Mikrotik. Testando Freeacs como um servidor de configura√ß√£o autom√°tica para o RouterOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468241/">  Neste artigo, tentarei descrever passo a passo o processo de instala√ß√£o do servidor de teste de um excelente projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Freeacs</a> para um estado totalmente funcional, e mostrarei t√©cnicas pr√°ticas para trabalhar com o mikrotik: configura√ß√£o atrav√©s de par√¢metros, execu√ß√£o de script, atualiza√ß√£o, instala√ß√£o de m√≥dulos adicionais, etc. <br><br>  O objetivo do artigo √© incentivar os colegas a abandonar o gerenciamento de dispositivos de rede usando terr√≠veis ancinhos e muletas, na forma de scripts auto-escritos, Cara, Ansible, etc. E, nesse sentido, causar fogos de artif√≠cio e grande alegria nas pra√ßas. <br><a name="habracut"></a><br><h4>  0. Escolha </h4><br>  Por que freeacs, n√£o genie-acs, mencionados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mikrotik-wiki</a> , s√£o mais animados? <br>  Porque, de acordo com genie-acs do mikrotik, existem publica√ß√µes dos espanh√≥is.  Aqui est√£o os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pdf</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo</a> da MUM do ano passado.  As caravanas autom√°ticas nos slides s√£o legais, mas eu gostaria de me afastar do conceito de escrever scripts, executar scripts, executar scripts ... <br><br><h4>  1. Instale freeacs </h4><br>  Vamos instal√°-lo no Centos7 e, como os dispositivos transmitem muitos dados e o ACS est√° trabalhando ativamente com o banco de dados - n√£o seremos gananciosos com recursos.  Para um trabalho confort√°vel, alocamos 2 n√∫cleos de CPU, 4 GB de RAM e 16 GB de armazenamento r√°pido SSD RAID10.  Vou instalar freeacs no cont√™iner Proxmox VE lxc e voc√™ pode trabalhar em qualquer ferramenta conveniente para voc√™. <br>  Lembre-se de definir a hora correta na m√°quina com o ACS. <br><br>  O sistema ser√° um teste, por isso n√£o seremos inteligentes e usaremos o script de instala√ß√£o gentilmente fornecido. <br><br><pre><code class="bash hljs">wget https://raw.githubusercontent.com/freeacs/freeacs/master/scripts/install_centos.sh chmod +x install_centos.sh ./ install_centos.sh</code> </pre> <br>  Assim que o script for conclu√≠do, voc√™ poder√° acessar imediatamente a interface da Web na m√°quina IP, com as credenciais admin / freeacs <br><br><img src="https://habrastorage.org/webt/uf/w0/xn/ufw0xnstxoxejymip04wkk17sca.png"><br>  <i>Aqui est√° uma interface minimalista t√£o agrad√°vel e como tudo foi legal e r√°pido</i> <br><br><h4>  2. Configura√ß√£o inicial de freeacs </h4><br>  A unidade de controle b√°sica do ACS √© uma unidade ou CPE (Customer Premises Equipment).  E o mais importante, o que precisamos para gerenciar unidades √© o tipo de unidade, ou seja,  modelo de equipamento que define um conjunto de par√¢metros personaliz√°veis ‚Äã‚Äãda unidade e seu software.  Mas enquanto n√£o sabemos como obter o novo tipo de unidade, √© melhor perguntar √† pr√≥pria unidade ativando o Modo de descoberta. <br><br>  Na produ√ß√£o, esse modo √© absolutamente imposs√≠vel de usar, mas precisamos iniciar o mecanismo em breve e ver os recursos do sistema.  Todas as configura√ß√µes b√°sicas s√£o armazenadas em / opt / freeacs- *.  Portanto, abra <br><br><pre> <code class="bash hljs"> vi /opt/freeacs-tr069/config/application-config.conf</code> </pre> <br>  n√≥s encontramos <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  e mude para <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  Al√©m disso, gostar√≠amos de aumentar o tamanho m√°ximo de arquivo com o qual o nginx e o mysql trabalhar√£o.  Para o mysql, adicione a linha em /etc/my.cnf <br><br><pre> <code class="bash hljs">max_allowed_packet=32M</code> </pre> <br>  e para nginx, em /etc/nginx/nginx.conf, adicione <br><br><pre> <code class="bash hljs">client_max_body_size 32m;</code> </pre> <br>  para a se√ß√£o http.  Caso contr√°rio, podemos trabalhar com firmware n√£o mais que 1M. <br><br>  N√≥s reiniciamos e estamos prontos para trabalhar com dispositivos. <br><br>  E no papel do dispositivo (CPE), teremos o <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hAP</a></b> kid <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ACAP lite</a></b> . <br><br>  Antes da conex√£o de teste, √© aconselh√°vel configurar manualmente o CPE para a configura√ß√£o m√≠nima de trabalho, para que os par√¢metros que voc√™ deseja configurar no futuro n√£o estejam vazios.  Para o roteador, voc√™ pode habilitar minimamente o cliente dhcp no ether1, instalar o pacote tr-069client e definir senhas. <br><br><h4>  3. N√≥s conectamos o Mikrotik </h4><br>  √â recomend√°vel conectar todas as unidades usando um n√∫mero de s√©rie v√°lido como login.  Ent√£o tudo ficar√° claro para voc√™ nos logs.  Algu√©m aconselha usar o WAN MAC - n√£o acredite.  Algu√©m usa um par de login / senha comum para todos - ignore-os. <br><br>  Abrimos o log tr-069 para monitorar as "negocia√ß√µes" <br><br><pre> <code class="bash hljs">tail -f /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/freeacs-tr069/tr069-conversation.log</code> </pre> <br>  Abra o winbox, item de menu TR-069. <br>  URL do ACS: <code>http://10.110.0.109/tr069/prov</code> (substitua pelo seu IP) <br>  Nome de usu√°rio: 9249094C26CB (copie o serial do sistema&gt; routerboard) <br>  Senha: 123456 (n√£o √© necess√°rio para a descoberta, mas a ser) <br>  Intervalo de informa√ß√µes peri√≥dicas que n√£o mudamos.  Emitiremos essa configura√ß√£o por meio de nosso ACS <br><br>  Abaixo est√£o as configura√ß√µes para inicializa√ß√£o da conex√£o remota, mas n√£o pude trabalhar com o mikrotik para fazer isso acontecer.  Embora a solicita√ß√£o remota funcione com telefones prontos para uso.  Ser√° necess√°rio entender. <br><br><img src="https://habrastorage.org/webt/xo/xp/sx/xoxpsxqyjlnpjcuph3xhjjanrpc.png"><br><br>  Depois de clicar no bot√£o Aplicar, os dados ser√£o trocados no terminal e, na interface da Web do Freeacs, voc√™ poder√° ver nosso roteador com o tipo de unidade criado automaticamente "hAPaclite". <br><br><img src="https://habrastorage.org/webt/ov/sc/nu/ovscnujrn-t5deekdeqgbpl-y6e.png"><br><br>  O roteador est√° conectado.  Voc√™ pode ver o tipo de unidade criado automaticamente.  Abra o <code>Easy Provisioning &gt; Unit Type &gt; Unit Type Overview &gt; hAPaclite</code> .  O que h√° n√£o s√≥!  At√© 928 par√¢metros (eu espiei no shell).  Seja muito ou pouco, descobriremos mais tarde, mas por enquanto apenas uma r√°pida olhada.  √â isso que o Tipo de unidade significa.  Esta √© uma lista de par√¢metros suportados com chaves, mas sem valores.  Os valores s√£o definidos nos n√≠veis abaixo - Perfis e Unidades. <br><br><h4>  4. Configure o Mikrotik </h4><br>  √â hora de baixar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o</a> guia da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interface da web</a> Este guia de 2011 √© como uma garrafa de bom vinho envelhecido.  Vamos abrir e sair para respirar. <br><br>  E n√≥s mesmos, na interface da web, clique no l√°pis ao lado de nossa unidade e entre no modo de configura√ß√£o da unidade.  √â assim: <br><br><img src="https://habrastorage.org/webt/it/3l/tf/it3ltfcesvywjovfuqgurxoj_co.png"><br><br>  Examine brevemente o que √© interessante nesta p√°gina: <br><br>  <i>Bloco de configura√ß√£o da unidade</i> <br><br><ul><li>  Perfil: este √© o perfil dentro do Tipo de Unidade.  A hierarquia √© a seguinte: <code>UnitType &gt; Profile &gt; Unit</code> .  Ou seja, podemos obter, por exemplo, perfis <code>hAPaclite &gt; hotspot</code> e <code>hAPaclite &gt; branch</code> , mas dentro do modelo do dispositivo </li></ul><br>  <i>Provisionamento de bot√£o</i> <br>  As dicas sugerem que todos os bot√µes no bloco de provisionamento podem aplicar instantaneamente a configura√ß√£o por meio de ConnectionRequestURL.  Mas, como eu disse acima, isso n√£o funciona, ent√£o, ap√≥s clicar nos bot√µes, voc√™ precisar√° reiniciar o cliente tr-069 no mikrotik para iniciar manualmente a provis√£o. <br><br><ul><li>  Freq / Spread: Quantas vezes por semana para entregar ¬±% de configura√ß√£o para reduzir a carga no servidor e nos canais de comunica√ß√£o.  Por padr√£o, custa 7/20, ou seja,  todos os dias ¬± 20% e uma dica como essa em segundos.  Embora n√£o fa√ßa sentido alterar a frequ√™ncia de entrega, tk.  haver√° excesso de ru√≠do nos logs e nem sempre a aplica√ß√£o esperada das configura√ß√µes </li></ul><br>  <i>Bloquear hist√≥rico de provisionamento</i> (√∫ltimas 48 horas) <br><br><ul><li>  Parece uma hist√≥ria, como uma hist√≥ria, mas ao clicar no t√≠tulo, voc√™ acessa uma ferramenta conveniente de pesquisa de banco de dados, com regexp e buns </li></ul><br>  <i>Bloco de par√¢metros</i> <br><br>  O bloco maior e mais importante, onde, de fato, os par√¢metros para esta unidade s√£o definidos e lidos.  Agora vemos apenas os par√¢metros mais importantes do sistema, sem os quais o ACS n√£o pode trabalhar com a unidade.  Mas lembramos que temos <i>928</i> em Tipo de unidade.  Vamos examinar todos os valores e decidir o que tudo isso come com o Mikrotik. <br><br><h4>  4.1 Leia os par√¢metros </h4><br>  No bloco de provisionamento, clique no bot√£o Ler tudo.  No bloco - uma inscri√ß√£o vermelha.  A coluna do <i>valor CPE (atual)</i> aparece √† direita.  Nas configura√ß√µes do sistema, o ProvisioningMode mudou para READALL. <br><br><img src="https://habrastorage.org/webt/eu/tg/no/eutgnogavgnitu8wwhvtb7w4qcw.png"><br><br>  E ... nada acontecer√°, exceto a mensagem no System.X_FREEACS-COM.IM.Message <code>Kick failed at...</code> <br><br>  Reinicie o cliente TR-069 ou reinicie o roteador e continue atualizando a p√°gina do navegador at√© obter os par√¢metros nos ret√¢ngulos cinza alegres √† direita <br>  Se algu√©m quiser tomar um gole do antigo temperado - este modo no manual √© descrito como 10.2 Modo de inspe√ß√£o.  Acende e funciona um pouco errado, mas a ess√™ncia √© descrita bastante <br><br><img src="https://habrastorage.org/webt/em/ut/g1/emutg1mnfctnq7vh5uoqr48wwiu.png"><br><br>  O modo READALL ser√° desativado ap√≥s 15 minutos, e tentaremos descobrir o que √© √∫til e o que pode ser corrigido "on the fly" enquanto estiver nesse modo. <br><br>  Voc√™ pode alterar endere√ßos IP, ativar / desativar interfaces, regras de firewall, que t√™m coment√°rios (caso contr√°rio, uma bagun√ßa completa), Wi-Fi, etc. <br><br>  Ou seja, ainda n√£o √© poss√≠vel configurar o mikrotik sane apenas com o TR-069.  Mas voc√™ pode monitorar muito bem.  Estat√≠sticas dispon√≠veis sobre interfaces e seu status, mem√≥ria livre etc. <br><br><h4>  4.2 Par√¢metros de entrega </h4><br>  Vamos agora tentar entregar os par√¢metros ao roteador, via tr-069, de uma maneira "natural".  A primeira v√≠tima ser√° Device.DeviceInfo.X_MIKROTIK_SystemIdentity.  N√≥s o encontramos nos par√¢metros da unidade Todos.  Aparentemente - n√£o est√° definido.  Isso significa que qualquer unidade pode ter qualquer identidade.  Pare com isso! <br>  D√™ uma cutucada na coluna criar, defina o nome Mr.White e pressione o bot√£o Atualizar par√¢metros.  O que vai acontecer a seguir voc√™ j√° adivinhou.  Na pr√≥xima sess√£o de comunica√ß√£o com a sede, o roteador deve alterar sua identidade. <br><br><img src="https://habrastorage.org/webt/yn/an/e8/ynane8pm3vt76wuvhwtfoqtxvis.png"><br><br>  Mas isso n√£o √© suficiente para n√≥s.  √â bom ter sempre um par√¢metro como o Identity sempre √† m√£o ao procurar a unidade desejada.  N√≥s cutucamos o nome do par√¢metro e colocamos l√° o daws Display (D) e Searchable (S).  A chave de par√¢metro muda para RWSD (lembre-se, nomes e chaves s√£o definidos no n√≠vel mais alto do tipo de unidade) <br><br><img src="https://habrastorage.org/webt/40/yf/zg/40yfzgpolinlrvj6aqq0zxlw0js.png"><br><br>  O valor agora n√£o √© apenas exibido na lista de pesquisa geral, mas tamb√©m est√° dispon√≠vel para pesquisa em <code>Support &gt; Search &gt; Advanced form</code> <br><br><img src="https://habrastorage.org/webt/sd/p_/1g/sdp_1gntzb5ly1wnzrd0uvwbrza.png"><br><br>  Iniciamos a provis√£o e analisamos a identidade.  Ol√° Sr.White!  Agora voc√™ n√£o poder√° alterar sua identidade enquanto o tr-069client estiver em execu√ß√£o <br><br><img src="https://habrastorage.org/webt/by/oc/j4/byocj4kosk_jiekvn8jgkuzi-y0.png"><br><br><h4>  4.3 Executamos scripts </h4><br>  Como descobrimos que n√£o h√° como eles n√£o, vamos execut√°-los. <br><br>  Mas, antes de come√ßarmos a trabalhar com arquivos, precisamos corrigir a diretiva <code>public.url</code> no arquivo <code>/opt/freeacs-tr069/config/application-config.conf</code> <br>  Afinal, ainda temos uma configura√ß√£o de teste instalada por um script.  N√£o esquece? <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># --- Public url (used for download f. ex.) --- public.url = "http://10.110.0.109" public.url: ${?PUBLIC_URL}</span></span></code> </pre> <br><br>  Reinicie o ACS e v√° direto para <code>Files &amp; Scripts</code> . <br><br><img src="https://habrastorage.org/webt/cb/ah/wk/cbahwkm8ckqb0r0gg3q2xsaiumi.png"><br><br>  Mas o que estamos abrindo agora pertence ao tipo de unidade, ou seja,  globalmente para todos os roteadores hAP ac lite, seja um roteador de filial, hotspot ou capsman.  Ainda n√£o precisamos de um n√≠vel t√£o alto, portanto, antes de trabalhar com scripts e arquivos, voc√™ deve criar um perfil.  Voc√™ pode cham√°-lo como a "posi√ß√£o" do dispositivo. <br><br>  Vamos fazer do nosso beb√™ um servidor de hor√°rio.  Postagem decente com um pacote de software separado e um pequeno n√∫mero de par√¢metros.  V√° para <code>Easy Provisioning &gt; Profile &gt; Create Profile</code> e crie um perfil de servidor de horas em Unit Type: <i>hAPaclite</i> .  N√£o possu√≠mos par√¢metros no perfil padr√£o; portanto, n√£o h√° nada para <i>copiar Copiar par√¢metros de: "n√£o copie ..."</i> <br><br><img src="https://habrastorage.org/webt/vf/9y/nc/vf9yncecit2scfc9pezngwg9sz0.png"><br><br>  Ainda n√£o h√° par√¢metros, mas ser√° poss√≠vel definir os que mais tarde queremos ver em nossos servidores de hor√°rio, remendados do hAPaclite.  Por exemplo, os endere√ßos comuns dos servidores NTP. <br>  Vamos para a configura√ß√£o da unidade e para o perfil do servidor de horas <br><br>  Finalmente, vamos a <code>Files &amp; Scripts</code> , criamos scripts e aqui estamos esperando por p√£es surpreendentemente convenientes. <br><br>  Para executar o script na unidade, precisamos selecionar <i>Tipo: TR069_SCRIPT</i> e o <i>Nome</i> e o <i>Nome do destino</i> devem ter a extens√£o .alter <br>  Ao mesmo tempo, para scripts, diferentemente do software, voc√™ pode carregar o arquivo finalizado ou simplesmente grav√°-lo / edit√°-lo no campo <i>Conte√∫do.</i>  Vamos tentar escrever aqui. <br><br>  E para ver imediatamente o resultado - adicione um roteador vlan ao ether1 <br><br><pre> <code class="bash hljs">/interface vlan add interface=ether1 name=vlan1 vlan-id=1</code> </pre> <br><img src="https://habrastorage.org/webt/jr/lh/7s/jrlh7sk9y_benjwmujnnv1ypk_u.png"><br><br>  Dirija, clique em <i>Upload</i> e pronto.  Nosso script <code>vlan1.alter</code> esperando nos bastidores. <br><br>  Bem, dirigiu?  N√£o.  Tamb√©m devemos adicionar um grupo ao nosso perfil.  Os grupos n√£o est√£o inclu√≠dos na hierarquia do equipamento, mas s√£o necess√°rios para procurar unidades no UnitType ou Profile e s√£o necess√°rios para executar scripts por meio do Advanced Provisioning.  Geralmente, os grupos s√£o associados a locais e t√™m uma estrutura aninhada.  Vamos fazer um grupo na R√∫ssia. <br><br><img src="https://habrastorage.org/webt/mz/73/bj/mz73bjayacypyy98f3thi1oe8ng.png"><br><br>  Imagine que fomos capazes de restringir a pesquisa de "Servidores de todos os tempos do mundo no hAPaclite" para "Servidores de todos os tempos da R√∫ssia no hAPaclite".  Ainda existe uma enorme camada de tudo de interessante nos grupos, mas n√£o temos tempo.  J√° dirigi para scripts. <br><br><pre> <code class="plaintext hljs">Advanced Provisioning &gt; Job &gt; Create Job</code> </pre> <br><img src="https://habrastorage.org/webt/si/yh/b4/siyhb4rjztp3yyqi__zgetxhigi.png"><br><br>  Como estamos no modo Avan√ßado, aqui voc√™ pode especificar v√°rias condi√ß√µes diferentes para iniciar o trabalho, comportamento de erro, novas tentativas e tempos limite.  Eu recomendo ler tudo isso em manuais ou discuti-lo mais tarde ao implement√°-lo na produ√ß√£o.  Por enquanto, basta inserir n1 nas regras de parada para que a tarefa pare assim que for conclu√≠da em nossa 1 unidade. <br><br>  N√≥s preenchemos o necess√°rio, e resta apenas correr! <br><br><img src="https://habrastorage.org/webt/xn/mw/3m/xnmw3mthgxsoyrj1jv7widfjfai.png"><br><br>  Pressione INICIAR e aguarde.  Agora, o contador de dispositivos mortos por um script subdesenvolvido funcionar√° rapidamente!  N√£o √© claro.  Essas tarefas s√£o realizadas por um longo tempo, e essa √© a diferen√ßa entre os scripts Ansible e assim por diante.  As pr√≥prias unidades solicitam tarefas de acordo com um cronograma ou conforme aparecem na rede, o ACS mant√©m o controle de quais unidades j√° receberam tarefas, e como elas terminaram, e escreve isso nos par√¢metros da unidade.  Existe uma unidade em nosso grupo e, se houvesse 1001, o administrador executaria essa tarefa e iria pescar <br><br>  Vamos l√°.  Reinicie o roteador j√° ou reinicie o cliente TR-069.  Tudo deve correr bem e Mr.White receber√° uma nova vlan.  E nossa atribui√ß√£o de regra de parada entrar√° no status PAUSADO.  Ou seja, ainda pode ser reiniciado ou alterado.  Se voc√™ clicar em FINISH, a tarefa ser√° gravada no arquivo morto. <br><br><h4>  4.4 Atualizar software </h4><br>  Este √© um ponto muito importante, pois o firmware micr√≥tico √© modular, mas a adi√ß√£o de m√≥dulos n√£o altera a vers√£o geral do firmware do dispositivo.  Nosso ACS √© normal e n√£o estou acostumado. <br>  Agora, faremos isso no estilo r√°pido e sujo e colocaremos o m√≥dulo NTP no firmware geral imediatamente, mas assim que a vers√£o for atualizada no dispositivo, n√£o poderemos adicionar outro m√≥dulo da mesma maneira. <br>  Na produ√ß√£o, √© melhor n√£o aplicar esse truque e instalar m√≥dulos opcionais para o Tipo de Unidade apenas com scripts. <br><br>  Portanto, a primeira coisa que precisamos fazer √© preparar os pacotes de software das vers√µes e arquitetura necess√°rias e coloc√°-lo em algum servidor da web acess√≠vel.  Para o teste, qualquer pessoa que o Mr.White possa alcan√ßar, e para a produ√ß√£o, √© melhor montar um espelho de atualiza√ß√£o autom√°tica do software necess√°rio, o que n√£o √© assustador para colocar na web <br>  Importante!  Lembre-se de sempre incluir um pacote com tr-069client nas atualiza√ß√µes! <br><br>  Como se viu, o comprimento do caminho para os pacotes √© muito importante!  Quando tentei usar algo como <code>http://192.168.0.237/routeros/stable/mipsbe/routeros-mipsbe-6.45.6.npk</code> , o mikrotik entrou em uma conex√£o c√≠clica com o recurso, dando ao TRFERCOMPLETE o log tr-069.  E passei uma certa quantidade de c√©lulas nervosas tentando descobrir o que estava errado.  Portanto, enquanto colocamos na raiz, at√© o esclarecimento <br><br>  Portanto, devemos ter tr√™s arquivos npk dispon√≠veis via http.  Acabou assim para mim <br><br><pre> <code class="bash hljs">http://192.168.0.241/routeros-mipsbe-6.45.6.npk http://192.168.0.241/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk http://192.168.0.241/routeros/stable/mipsbe/tr069-client-6.45.6-mipsbe.npk</code> </pre> <br>  Agora, ele precisa ser emitido no arquivo xml com FileType = "1 Firmware Upgrade Image", que alimentamos os microtics.  Seja o nome ros.xml <br><br>  Seguimos as instru√ß√µes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mikrotik-wiki</a> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"links"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/routeros-mipsbe-6.45.6.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/tr069-client-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  A falta de nome de <code>Username/Password</code> para acessar o servidor de download √© impressionante.  Voc√™ pode tentar inserir isso como na cl√°usula A.3.2.8 do protocolo tr-069: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.237/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span>user<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span>pass<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ou pergunte diretamente ao Mikrotik oficial, bem como o tamanho m√°ximo do caminho para * .npk <br><br>  Vamos aos <code>Files &amp; Scripts</code> conhecidos por n√≥s e criamos um arquivo como SOFTWARE com <b>Nome:</b> ros.xml, <b>Nome do destino:</b> ros.xml e <b>Vers√£o:</b> 6.45.6 <br>  Aten√ß√£o!  A vers√£o aqui deve ser especificada no formato em que √© exibida no dispositivo e passada no par√¢metro <code>System.X_FREEACS-COM.Device.SoftwareVersion</code> . <br><br>  Selecionamos nosso arquivo xm para download e pronto. <br><br><img src="https://habrastorage.org/webt/th/w7/0-/thw70-pm9bruivrrcogyx1v2vig.png"><br><br>  Agora, temos v√°rias maneiras de atualizar seu dispositivo.  Atrav√©s do Assistente no menu principal, atrav√©s de Provisionamento avan√ßado e tarefas com o tipo SOFTWARE, ou simplesmente acesse a configura√ß√£o da unidade e clique em Atualizar.  Escolhemos a maneira mais f√°cil e, mesmo assim, o artigo est√° inchado. <br><br><img src="https://habrastorage.org/webt/le/jk/fg/lejkfgwuolymtutzfswkpcnwel0.png"><br><br>  Clique no bot√£o, inicie a provis√£o e pronto.  O programa de teste est√° conclu√≠do.  Agora podemos fazer mais com o mikrotik. <br><br><h4>  5. Conclus√£o </h4><br>  Quando comecei a escrever, eu queria primeiro descrever a conex√£o do telefone IP e usar o exemplo dele para explicar o qu√£o legal pode ser quando o tr-069 funciona com facilidade e sem esfor√ßo.  Mas ent√£o, √† medida que progredia e vasculhava os materiais, pensei que, para quem conectasse o Mikrotik, nenhum telefone seria assustador para estudos independentes. <br><br>  Em princ√≠pio, os Freeacs que testamos j√° podem ser usados ‚Äã‚Äãna produ√ß√£o, mas para isso voc√™ precisa configurar a seguran√ßa, SSL, configurar o Mikrotik para configura√ß√£o autom√°tica ap√≥s a redefini√ß√£o, depurar a adi√ß√£o correta do tipo de unidade, desmontar o trabalho de servi√ßos da web e shell de fus√£o e muito mais.  Tente, invente e escreva uma sequela! <br><br>  Obrigado a todos pela aten√ß√£o!  Terei o maior prazer em altera√ß√µes e coment√°rios! <br><br>  Lista de materiais utilizados e links √∫teis: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O t√≥pico do f√≥rum que encontrei no in√≠cio das pesquisas sobre o t√≥pico</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TR-069 Altera√ß√£o 6 do Protocolo de Gerenciamento da CPE WAN</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wiki Freeacs</a> <br>  <a href="">Par√¢metros tr-069 no Mikrotik e sua conformidade com os comandos do terminal</a> <br><br>  Atualiza√ß√£o 10.13.2019: <br><br>  Examinando as informa√ß√µes sobre o projeto FreeACS, deparei-me com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">patch</a> muito interessante proposto por poloneses que t√™m o FreeACS servindo dispositivos 20K. <br><br>  O patch foi feito para diferentes vers√µes de hardware, mas no caso de microtics, permitir√° criar v√°rios tipos de unidades para os mesmos roteadores com um conjunto diferente de m√≥dulos de software. <br>  Por exemplo, hAPaclite-ntp, hAPaclite-ups, etc.  E, consequentemente, para contornar a restri√ß√£o "one model == one firmware" </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468241/">https://habr.com/ru/post/pt468241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468231/index.html">A seguran√ßa no AEM √© um problema de plataforma ou implementa√ß√£o?</a></li>
<li><a href="../pt468233/index.html">A maneira de digitar a verifica√ß√£o de 4 milh√µes de linhas de c√≥digo Python. Parte 1</a></li>
<li><a href="../pt468235/index.html">A maneira de digitar a verifica√ß√£o de 4 milh√µes de linhas de c√≥digo Python. Parte 2</a></li>
<li><a href="../pt468237/index.html">A maneira de digitar a verifica√ß√£o de 4 milh√µes de linhas de c√≥digo Python. Parte 3</a></li>
<li><a href="../pt468239/index.html">Escolhendo a estrutura de dados correta no Swift</a></li>
<li><a href="../pt468245/index.html">N√£o precisamos de corre√ß√µes de tradu√ß√£o: nosso tradutor sabe melhor como isso deve ser traduzido</a></li>
<li><a href="../pt468251/index.html">N√£o h√° futuro</a></li>
<li><a href="../pt468253/index.html">Controle deslizante de imagem simples em CSS e Javascript</a></li>
<li><a href="../pt468259/index.html">Cinco destaques do Helm Summit 2019 em Amsterd√£</a></li>
<li><a href="../pt468261/index.html">Um novo jogo com uma atmosfera antiga no Three.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>