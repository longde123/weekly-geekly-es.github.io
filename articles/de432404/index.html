<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¼ğŸ¾ ğŸ‘ğŸ¼ ğŸ¦Œ Backup fÃ¼r Linux schreibt keine Briefe ğŸ‰ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ¥Ÿ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 Heute mÃ¶chte ich darÃ¼ber sprechen, wie Veeam Agent fÃ¼r Linux Ã¼ber die Befehlszeile verwaltet wird und welche MÃ¶glichkeiten sich i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Backup fÃ¼r Linux schreibt keine Briefe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/432404/">  Hallo allerseits! <br><br>  Heute mÃ¶chte ich darÃ¼ber sprechen, wie <b>Veeam Agent fÃ¼r Linux</b> Ã¼ber die Befehlszeile verwaltet wird und welche MÃ¶glichkeiten sich in den HÃ¤nden eines erfahrenen Programmierers ergeben. <br><br>  Ich wurde durch einen Kommentar zu einem frÃ¼heren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> aufgefordert, einen Artikel zu schreiben.  Um die Ãœberraschung des Benutzers zu paraphrasieren: "Nun, wie so?  Der Server schreibt keine Briefe, die besagen, dass er gespeichert wurde! â€œ  DarÃ¼ber hinaus ist er laut Analysten nicht der einzige, sonst wÃ¤re der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thread</a> nicht im Forum erschienen.  Und da die Leute schreiben, bedeutet das, dass jemand es braucht! <br><br>  In dem Artikel werde ich erklÃ¤ren, warum diese Funktion nicht im Produkt enthalten ist.  Aber wir werden hier nicht aufhÃ¶ren, wir werden diese Funktion hinzufÃ¼gen!  Wir sind Programmierer, also schreiben wir einen Brief und erstellen einen Bericht in Form einer HTML-Seite. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8d/yu/df/8dyudfduto6pqilljl-ay1qc2jk.png"></div><br>  DarÃ¼ber hinaus werde ich meiner Meinung nach die nÃ¼tzlichsten Befehle zeigen, die die Arbeit des Administrators erleichtern kÃ¶nnen. <br><br>  Machen Sie sich bereit: viel Code, keine Bilder. <br><a name="habracut"></a><br>  Beantworten wir zunÃ¤chst die Frage: "Warum schreibt Veeam Agent fÃ¼r Linux keine Briefe?" <br><br>  Sie mÃ¶gen die Antworten vielleicht nicht, beschuldigen Sie mich nicht.  Tatsache ist jedoch, dass mehr oder weniger groÃŸe Unternehmensbenutzer dies nicht benÃ¶tigen, und hier ist der Grund: <br><br><ul><li> Um mit E-Mails arbeiten zu kÃ¶nnen, mÃ¼ssen Sie entweder den smpt-Server auf dem lokalen Computer installieren oder einen im Netzwerk verwenden.  Bei der einfachsten Implementierung (Befehl <code>mail</code> ) mÃ¼ssen Sie das Paket <i>mailutils</i> installieren.  Und viele Systemadministratoren mÃ¶chten keine potenzielle SicherheitslÃ¼cke auf ihrem Produktionsserver in Form eines Dienstes erstellen, der Briefe Ã¼berall hin senden kann.  Ja, und die MÃ¶glichkeit liegt mÃ¶glicherweise nicht an den geschlossenen Ports, der UnabhÃ¤ngigkeit von Subnetzen usw. </li><li>  Zweitens macht es keinen Sinn, zu versuchen, es zu verwenden, da sich das <i>Mailutils-</i> Paket <i>mÃ¶glicherweise</i> (aus dem ersten Grund) nicht auf dem System befindet.  Andernfalls kÃ¶nnen wir eine Funktion erhalten, die anscheinend vorhanden ist, aber "out of the box" funktioniert nicht. Dies bedeutet, dass im Forum ein Thread zu einem Thema wie "So konfigurieren Sie den Server so, dass E-Mails gesendet werden" angezeigt wird. </li><li>  Und drittens ist im Allgemeinen keine zusÃ¤tzliche Benachrichtigung erforderlich, da mehr oder weniger groÃŸe Unternehmenskunden <b>Veeam Backup &amp; Replication verwenden</b> .  Die Konsole sammelt Informationen zu allen Sicherungen, die in bekannten Repositorys erstellt wurden.  Ãœberzeugen Sie sich selbst. <br></li></ul><br>  In der Version von <b>Veeam Backup &amp; Replication 9.5 Update 4</b> ist es mÃ¶glich, dieses Produkt kostenlos zu verwenden, jedoch mit einer EinschrÃ¤nkung fÃ¼r die gewarteten virtuellen / physischen Maschinen. <br>  Wenn Sie bis zu 3 (einschlieÃŸlich) physische Server haben, sind kostenlose VBR-Funktionen mehr als genug fÃ¼r Sie. <br><br>  Wenn Sie mehr als 3 Computer haben, gibt es keine MÃ¶glichkeit, die Software zu bezahlen, aber Sie mÃ¶chten Ihre Server trotzdem zentral Ã¼berwachen. Ich empfehle, einige Skripte selbst hinzuzufÃ¼gen.  Ich mag es, mich in Python zu amÃ¼sieren, nachdem ich fÃ¼r C / C ++ gearbeitet habe. <br><br>  <code>veeamconfig</code> wir den <code>veeamconfig</code> .  Das <code>veeamconfig</code> Team bietet Zugriff auf alle Funktionen des Produkts.  Zweifellos ist die pseudografische Schnittstelle, die mit der <i>ncurses-Bibliothek</i> erstellt wurde, fÃ¼r das Auge viel angenehmer. Wenn Sie jedoch Programme mit etwas Neuem verknÃ¼pfen mÃ¼ssen, ist die CLI unser Alles. <br><br>  Die Beschreibung der Befehle von <b>Veeam Agent fÃ¼r Linux</b> gilt fÃ¼r Version 3.0.  Ich habe frÃ¼here Versionen nicht Ã¼berprÃ¼ft, daher kann es Unterschiede geben. <br><br>  Die CLI-OberflÃ¤che in <b>Veeam Agent fÃ¼r Linux ist</b> sehr praktisch und gut dokumentiert.  <code>veeamconfig --help</code> Sie einfach <code>veeamconfig --help</code> und Sie erhalten eine Liste der verfÃ¼gbaren Befehle: <br><br><pre> <code class="plaintext hljs">$sudo veeamconfig --help Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig [command] Commands: repository - Backup repositories management vbrserver - Veeam Backup and Replication servers management job - Backup jobs management backup - Backups management point - Restore points management license - License management agreement - End User License Agreement management config - Import/export configuration schedule - Jobs schedule configuration cloud - Cloud provider management mode - Operation mode session - Sessions management ui - User interface aap - Application-aware processing version, --version, -v - Product version help, --help, -h - Short help</code> </pre><br>  Um zu sehen, was Sie mit jedem Befehl tun kÃ¶nnen, rufen <code>veeamconfig config --help</code> einfach <code>veeamconfig config --help</code> .  Wir bekommen: <br><br><pre> <code class="plaintext hljs">Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig config [command] Commands: import - Import repositories and jobs into database export - Export repositories and jobs from database grabLogs - Collect support logs bundle patchiso - Create custom Veeam Recovery Media adding all hardware drivers from this system help, --help, -h - Short help</code> </pre><br>  Hier sehen wir <code>grabLogs</code> log collection.  Auf diese Weise kÃ¶nnen Sie schnell alle erforderlichen Protokolle fÃ¼r den Support sammeln.  Dies ist fÃ¼r den Fall, dass etwas schief geht. <br><br>  Es gibt auch ein interessantes Team, das in Version 3.0 erschienen ist: <br><br><pre> <code class="plaintext hljs">$ sudo veeamconfig agreement --help Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig agreement [command] Commands: acceptEula - Accept Veeam End User License Agreements acceptThirdPartyLicenses - Accept Veeam 3rd party License Agreement show - Show End User License Agreements acceptance status help, --help, -h - Short help</code> </pre><br>  Tatsache ist, dass der Benutzer ab Version 3.0 den Lizenzvereinbarungen ausdrÃ¼cklich zustimmen muss.  Es sieht ungefÃ¤hr so â€‹â€‹aus: <br><br><pre> <code class="plaintext hljs">$ sudo veeamconfig job list I accept Veeam Software End User License Agreement: /usr/share/doc/veeam/EULA (yes/no | y/n): yes I accept the terms of the following 3rd party software components license agreements: /usr/share/doc/veeam/3rd_party (yes/no | y/n):</code> </pre><br>  Dementsprechend kann der Betrieb Ihrer Skripte gestÃ¶rt sein.  Um nicht jede Maschine zu betreten und diesen Vorgang nicht manuell durchzufÃ¼hren, wurden die folgenden Befehle bereitgestellt: <br><br><pre> <code class="plaintext hljs">veeamconfig agreement acceptEula veeamconfig agreement acceptThirdPartyLicenses</code> </pre><br>  Sie ermÃ¶glichen es Ihnen, Lizenzvereinbarungen ohne weitere Fragen zu akzeptieren. <br><br>  Aber wir sind vom Thema des Schreibens eines Briefes abgewichen. <br><br>  FÃ¼r die Ãœberwachung des <code>veeamconfig session list</code> benÃ¶tigen wir den Befehl <code>veeamconfig session list</code> .  Es gibt etwas aus wie: <br><br><pre> <code class="plaintext hljs">Job name Type ID State Started at Finished at bj-home Backup {dbe48e88-3df7-4712-a472-09af8fed4e80} Success 2018-12-05 15:43 2018-12-05 15:44 bj-home Backup {c178a799-2935-4bd6-883b-b11278000076} Success 2018-12-05 16:26 2018-12-05 16:26 bj-home Backup {3405dad3-0016-4a00-933e-60ef66b30324} Success 2018-12-06 06:00 2018-12-06 06:00</code> </pre><br>  Nun, hier gibt es Informationen, wann der Server gesichert wurde und was der Erfolg war.  GrundsÃ¤tzlich ist es bereits mÃ¶glich, den â€Auspuffâ€œ in einer Datei zu sammeln und per Brief zu versenden.  In einem Jahr kann der Buchstabe jedoch um ungefÃ¤hr 365 Zeilen wachsen.  Und die Suche nach einem fehlerhaften <i>Staat</i> kann mÃ¼hsam erscheinen.  Daher werden wir diesen â€Auspuffâ€œ analysieren und eine normale Liste erhalten, mit der Sie bereits etwas tun kÃ¶nnen. <br><br>  Den gesamten Code finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CSession</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> subproccall( [<span class="hljs-string"><span class="hljs-string">"veeamconfig"</span></span>, <span class="hljs-string"><span class="hljs-string">"session"</span></span>, <span class="hljs-string"><span class="hljs-string">"list"</span></span>] ) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CSessionInfoList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, list)</span></span></span><span class="hljs-function">:</span></span> self.list = list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.list @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> text = CSession.List() lines = text.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) list = [] <span class="hljs-comment"><span class="hljs-comment"># session info list for line in lines: if len(line) == 0: continue words = line.split() if len(words) == 0: continue if words[0] == "Job": continue if words[0] == "Total": continue try: jobName = words[0] type = words[1] id = words[2] state = words[3] startTime = words[4] + " " + words[5] finishTime = words[6] + " " + words[7] list.append(CSessionInfo(id, type, jobName, state, startTime, finishTime)) except: print "Failed to parse [", line, "]" return CSessionInfoList(list)</span></span></code> </pre><br>  Nun, jetzt machen wir einen Brief und schicken ihn uns. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMailsessions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"---"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Sending statistic to administrator:"</span></span> sessions = veeamlpb.session.CSessionInfoList.Get() recipient = <span class="hljs-string"><span class="hljs-string">"dear.admin@company.com"</span></span> subject = <span class="hljs-string"><span class="hljs-string">"VAL status notification"</span></span> text = <span class="hljs-string"><span class="hljs-string">"Statistic:\n"</span></span> inx = <span class="hljs-number"><span class="hljs-number">0</span></span>; successCount = <span class="hljs-number"><span class="hljs-number">0</span></span> warningCount = <span class="hljs-number"><span class="hljs-number">0</span></span> errorCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessions.List(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>): successCount += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> (sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Warning"</span></span>): warningCount += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: errorCount += <span class="hljs-number"><span class="hljs-number">1</span></span> text += str(successCount)+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+str(warningCount)+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+str(errorCount)+<span class="hljs-string"><span class="hljs-string">" Success/Warning/Error\n"</span></span> text += <span class="hljs-string"><span class="hljs-string">"Last 10 session:\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> reversed(sessions.List()): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inx == <span class="hljs-number"><span class="hljs-number">10</span></span>: text += <span class="hljs-string"><span class="hljs-string">"...\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; text += str(inx)+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.State()+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.JobName()+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.StartTime()+<span class="hljs-string"><span class="hljs-string">" / "</span></span>+sessionInfo.FinishTime() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> <span class="hljs-comment"><span class="hljs-comment">#text += inx += 1 text += "\n" text += "--------------------------------------------------------------------------------\n" text += " Yours sincerely, Veeam Agent for Linux Monitor\n" print text os.system("echo '"+text+"' | mail -s '"+subject+"' "+recipient)</span></span></code> </pre><br>  Als Ergebnis kÃ¶nnen wir nach der Installation von <i>mailutils</i> einen Brief des Formulars erhalten: <br><br><pre> <code class="plaintext hljs">Statistic: 3/0/0 Success/Warning/Error Last 10 session: 0 | Success | bj-home | 2018-12-06 06:00 / 2018-12-06 06:00 1 | Success | bj-home | 2018-12-05 16:26 / 2018-12-05 16:26 2 | Success | bj-home | 2018-12-05 15:43 / 2018-12-05 15:44 -------------------------------------------------------------------------------- Yours sincerely, Veeam Agent for Linux Monitor</code> </pre><br>  Der Brief zeigt nur die letzten 10 Sitzungen an.  Gleichzeitig werden am Anfang des Briefes Informationen Ã¼ber die Anzahl der erfolgreichen und nicht sehr Sitzungen angezeigt.  Es reicht aus, sich die Zahlen im Brief zu Beginn des Arbeitstages anzusehen, die Post zu Ã¼berprÃ¼fen und an einer Kaffeemaschine zu nippen, um zu verstehen, dass die Nachtsicherungen erfolgreich waren. <br><br>  Wenn Sie etwas Offensichtlicheres benÃ¶tigen, kÃ¶nnen Sie Informationen zu den Sitzungen im XML-Format anfordern und auf Ihren Server Ã¼bertragen.  Kombinieren Sie dort die erhaltenen Daten zu einer einzigen Ãœbersichtstabelle, in der alle erforderlichen Informationen in einem fÃ¼r Sie geeigneten oder praktikablen Format angezeigt werden. <br>  Wir bekommen die XML-paar Zeilen: <br><br><pre> <code class="python hljs">sessionList = veeamlpb.session.CSessionList() text = sessionList.ToXml()</code> </pre><br>  Speichern Sie die resultierende Datei <br><br><pre> <code class="python hljs">sessionListFileName = <span class="hljs-string"><span class="hljs-string">"session_list.xml"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Store XML to file: "</span></span>,sessionListFileName sessionListXmlFile = open(sessionListFileName, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) sessionListXmlFile.write(text) sessionListXmlFile.close()</code> </pre><br>  Dann senden wir das empfangene XML an den Server.  Eine alternative Option ist ebenfalls mÃ¶glich: Der Server sammelt XMLs von Computern, die gesichert werden.  Wer der Initiator ist, ist uns noch nicht wichtig.  Es ist wichtig, dass XML-Dateien auf dem Server mit Sitzungslisten aller Computer erfasst werden.  Ich habe die erste Option gewÃ¤hlt: <br><br><pre> <code class="python hljs">hostname = os.uname()[<span class="hljs-number"><span class="hljs-number">1</span></span>] target = <span class="hljs-string"><span class="hljs-string">"user@admin-desktop:/home/user"</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"scp ./"</span></span>+sessionListFileName+<span class="hljs-string"><span class="hljs-string">" "</span></span>+target+<span class="hljs-string"><span class="hljs-string">"/backups/"</span></span>+hostname+<span class="hljs-string"><span class="hljs-string">"/session_list.xml"</span></span>)</code> </pre><br>  Auf der Serverseite mÃ¼ssen nun die empfangenen Daten verarbeitet und eine schÃ¶ne HTML-Seite erstellt werden. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> veeamlpb <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xml.etree.ElementTree <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> xml <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> hosts = [] backupsDirectory = <span class="hljs-string"><span class="hljs-string">"/home/user/backups"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(backupsDirectory): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">".."</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isdir(os.path.join(backupsDirectory,item)): hosts.append(item) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"item: "</span></span>,item <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(hosts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> backupSessionMap = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hosts: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"found host: "</span></span>, host sessionInfoFile = os.path.join(os.path.join(backupsDirectory,host), <span class="hljs-string"><span class="hljs-string">"session_list.xml"</span></span>) sessionList = veeamlpb.session.CSessionInfoList.FromXmlFile(sessionInfoFile) backupSessionMap[host] = sessionList <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessionList.List(): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Session:"</span></span>,sessionInfo.ToString() html = xml.Element(<span class="hljs-string"><span class="hljs-string">"html"</span></span>) body = xml.SubElement(html, <span class="hljs-string"><span class="hljs-string">"body"</span></span>, {<span class="hljs-string"><span class="hljs-string">"style"</span></span>:<span class="hljs-string"><span class="hljs-string">"background-color: #00b336;"</span></span>}) xml.SubElement(body,<span class="hljs-string"><span class="hljs-string">"h1"</span></span>).text = <span class="hljs-string"><span class="hljs-string">"Report at "</span></span>+datetime.datetime.now().strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span></span>) xml.SubElement(body,<span class="hljs-string"><span class="hljs-string">"h2"</span></span>).text = <span class="hljs-string"><span class="hljs-string">"Statistic:"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hosts: sessionList = backupSessionMap[host] success=<span class="hljs-number"><span class="hljs-number">0</span></span> warning=<span class="hljs-number"><span class="hljs-number">0</span></span> error=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(sessionList.List()) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessionList.List(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>: success +=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Warning"</span></span>: warning +=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: error +=<span class="hljs-number"><span class="hljs-number">1</span></span> latestSessionInfo = sessionList.List()[<span class="hljs-number"><span class="hljs-number">-1</span></span>] attr = {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> latestSessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>: <span class="hljs-comment"><span class="hljs-comment">#attr["style"] = "background-color: #00b336;" attr["style"] = "background-color: #005f4b; color: white;" elif latestSessionInfo.State() == "Warning": attr["style"] = "background-color: #93ea20;" else: attr["style"] = "background-color: #ba0200; color: white;" xml.SubElement(xml.SubElement(body,"p"),"span", attr).text = \ host + " - "+str(success)+"/"+str(warning)+"/"+str(error)+" Success/Warning/Error" for host in hosts: sessionList = backupSessionMap[host] xml.SubElement(body,"h2").text = host+":" tableStyle =xml.SubElement(body,"style") tableStyle.attrib["type"] = "text/css" tableStyle.text = "TABLE {border: 1px solid green;} TD{ border: 1px solid green; padding: 4px;}" table = xml.SubElement(body,"table") thead = xml.SubElement(table, "thead") xml.SubElement(thead, "th").text = "Number" xml.SubElement(thead, "th").text = "State" xml.SubElement(thead, "th").text = "Job name" xml.SubElement(thead, "th").text = "Start at" xml.SubElement(thead, "th").text = "Complete at" tbody = xml.SubElement(table, "tbody") inx = 0 for sessionInfo in reversed(sessionList.List()): if inx == 10: break; tr = xml.SubElement(tbody,"tr") xml.SubElement(tr, "td").text = str(inx) attr ={} if sessionInfo.State() == "Success": pass elif sessionInfo.State() == "Warning": attr["style"] ="background-color: #93ea20;" else: attr["style"] ="background-color: #ba0200; color: white;" xml.SubElement(tr, "td", attr).text = sessionInfo.State() xml.SubElement(tr, "td").text = sessionInfo.JobName() xml.SubElement(tr, "td").text = sessionInfo.StartTime() xml.SubElement(tr, "td").text = sessionInfo.FinishTime() inx += 1 xml.ElementTree(html).write("summary.html", encoding='utf-8', method='html') return 0 exit(main())</span></span></code> </pre><br>  Infolgedessen ist der Bericht fertig: <br><br><img src="https://habrastorage.org/webt/sk/yd/-x/skyd-xbv3cxvadto3fpw9vc3y6s.png"><br><br>  Ich hatte keine Aufgabe, ein schÃ¶nes Produkt herzustellen.  Die Aufgabe bestand darin zu zeigen, dass die Frage des Sammelns von Statistiken in Skripten in ein bis zwei Tagen gelÃ¶st werden kann. <br><br>  Wenn Sie die hier vorgestellten Ideen entwickeln, kÃ¶nnen Sie im Prinzip einen â€Open Backup Monitor fÃ¼r Veeam Agent fÃ¼r Linuxâ€œ erstellen.  Meiner Meinung nach ein gutes Thema fÃ¼r Kursarbeiten in Python oder vielleicht sogar fÃ¼r ein Diplom oder nur eine Ausrede, um das Programmieren in einem Open-Source-Projekt zu Ã¼ben.  Stimmen Sie zu, es ist besser, das Programmieren zu Ã¼ben, als ein Elf der 80. Stufe zu werden. <br><br>  Der gesamte Code ist unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.github.com/CodeImp/veeampy/</a> zu finden.  Download, Verwendung, ErgÃ¤nzung und Gabel auf die Gesundheit. <br><br>  Bitte beachten Sie, dass der Code unter der GPL-2-Lizenz verteilt wird, Fehler enthalten kann und vieles mehr.  In der OpenSource-Welt ist alles wie gewohnt.  Vergessen Sie also nicht, vor dem Einsatz in der Produktion in einem Testlabor zu fahren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432404/">https://habr.com/ru/post/de432404/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar486156/index.html">ÙƒÙ…Ø§ Ø¹Ù„Ù…Øª ØŒ Ø«Ù… ÙƒØªØ¨ Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙÙŠ Ø¨ÙŠØ«ÙˆÙ†</a></li>
<li><a href="../ar486158/index.html">ØªØµÙˆØ± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ© (Ù†Ù…Ø§Ø°Ø¬ seq2seq Ù…Ø¹ Ø¢Ù„ÙŠØ© Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…)</a></li>
<li><a href="../ar486164/index.html">ÙÙŠØ±ÙˆØ³ ÙƒÙˆØ±ÙˆÙ†Ø§ 2019-nCoV. Ø£Ø³Ø¦Ù„Ø© ÙˆØ£Ø¬ÙˆØ¨Ø© Ø¹Ù† Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ ÙˆØ§Ù„ØªØ·Ù‡ÙŠØ±</a></li>
<li><a href="../ar486174/index.html">Ù„Ø¯ÙŠ ØµÙØ± Ø¯ÙˆØ±Ø§Ù†</a></li>
<li><a href="../de432402/index.html">Hey HR, wo ist mein Souvenir?</a></li>
<li><a href="../de432408/index.html">Fintech Digest: Vorbereitung fÃ¼r die Trennung kleiner Banken von Visa und Mastercard, einem Rentenrechner und nicht nur</a></li>
<li><a href="../de432410/index.html">EntitÃ¤ten im DDD-Stil mit Entity Framework Core</a></li>
<li><a href="../de432412/index.html">Highload ++: So helfen Sie dem ERP-System, 500.000 Anfragen pro Sekunde zu bewÃ¤ltigen</a></li>
<li><a href="../de432414/index.html">Alte Geheimnisse fÃ¼r schnelles Debuggen: Animieren des Quellcodes</a></li>
<li><a href="../de432416/index.html">AbhÃ¤ngige Typen - Die Zukunft der Programmiersprachen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>