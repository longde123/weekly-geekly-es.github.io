<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÉ üè¨ üëâüèº Como escrevemos, a interface do nosso pr√≥prio painel de controle de hospedagem: estrutura e backdoors üí¥ üòê üò∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No √∫ltimo artigo, falamos sobre como surgiu a id√©ia de escrever nosso pr√≥prio painel de controle de hospedagem e sobre a estrutura geral do painel fin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como escrevemos, a interface do nosso pr√≥prio painel de controle de hospedagem: estrutura e backdoors</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/465285/"><img src="https://habrastorage.org/webt/mt/pj/hx/mtpjhxpebii_0okylhb3xp4zzcc.png"><br>  No √∫ltimo artigo, falamos sobre como surgiu a id√©ia de escrever nosso pr√≥prio painel de controle de hospedagem e sobre a estrutura geral do painel finalizado. <br><br>  Hoje, nosso desenvolvedor de front-end Artysh dir√° como ele escreveu o front-end deste painel: qual estrutura foi escolhida, qual antipadr√£o √© considerado uma boa forma e como se defender contra backdoors se voc√™ usar bibliotecas prontas. <br><a name="habracut"></a><br><h2>  Escolha da estrutura: por que voc√™ estava procurando por uma nova </h2><br>  O painel anterior foi implementado em sua pr√≥pria estrutura, escrita em jQuery.  Sentamos no VMManager, exigindo muitas melhorias: em termos de interface e funcionalidade, era dif√≠cil manter esse c√≥digo.  A adi√ß√£o de novas funcionalidades ao painel pela frente levou muito tempo.  √â claro que, se desejar, voc√™ pode implementar uma boa estrutura em jQuery (eu ainda amo jQuery) ou at√© mesmo uma apar√™ncia de CMS, mas essa n√£o era a melhor op√ß√£o: come√ßar com uma documenta√ß√£o insuficiente em uma estrutura auto-escrita e terminar com a arquitetura n√£o totalmente correta do pr√≥prio aplicativo. <br><br>  O painel antigo foi implementado como um aplicativo de p√°gina √∫nica e foi a√≠ que suas boas qualidades terminaram.  Depois de resolver outro quebra-cabe√ßa para adicionar um bot√£o √† lista, percebi que precisava de uma alternativa.  A escolha recaiu sobre Vue. <br><br><h3>  Porqu√™ SPA? </h3><br>  O aplicativo de p√°gina √∫nica √© a escolha ideal para um painel de controle.  O painel de controle em termos de renderiza√ß√£o √© uma coisa bastante simples, esse trabalho pode ser facilmente confiado ao navegador do usu√°rio.  Al√©m disso, a otimiza√ß√£o de SEO n√£o √© importante para o painel, por isso, temos um site principal.  Bem, os usu√°rios do painel percebem o tempo necess√°rio para o carregamento inicial de todos os scripts necess√°rios devido √†s especificidades desses pr√≥prios usu√°rios.  Novamente, o back-end que obtivemos foi um servi√ßo RestAPI cl√°ssico - para fornecer uma API aberta aos nossos clientes no futuro. <br><br>  O aplicativo SPA acabou sendo t√£o leve que funciona bem com o navegador de telefones e tablets - acabamos de fazer um layout adapt√°vel e n√£o precisamos criar um aplicativo separado. <br><br><h3>  Por que Vue? </h3><br>  H√° 3 anos, o Vue era uma estrutura relativamente jovem, mas mesmo assim eles conversaram e escreveram muito sobre isso, e quando o lan√ßamento da vers√£o 2.0 foi lan√ßado, decidimos apostar nele - e est√°vamos certos.  No in√≠cio, eles planejavam substituir gradualmente alguns componentes escritos em jQuery e Vue, facilitando a execu√ß√£o.  Por√©m, depois que os componentes bastante volumosos foram reescritos, eles decidiram que era melhor reescrever o aplicativo inteiro no Vue. <br>  Este seria um passo arriscado e decidimos adot√°-lo por 4 raz√µes: <br><br><ol><li>  Vue √© uma estrutura declarativa simples, que at√© os codificadores podem entender.  Se for o caso, √© f√°cil encontrar um desenvolvedor para ele ou apenas ensinar a um amigo.  Isso significa que n√£o teremos problemas em encontrar um novo desenvolvedor e entrar no projeto se um bonde me cruzar (louvor aos deuses, eles n√£o est√£o na minha cidade). </li><li>  O Vue √© objetivamente bom para escrever aplicativos SPA. </li><li>  Eu tive a experi√™ncia de desenvolver o React diante dos meus olhos e sugeri que a popularidade do Vue tamb√©m aumentasse.  Agora, a estrutura est√° inclu√≠da no TOP-3 das estruturas JS populares (isso √© f√°cil de verificar com uma consulta de pesquisa), perdendo apenas para React e Angular.  Ele tem um bom apoio, um ecossistema desenvolvido e uma grande comunidade. </li><li>  Velocidade de desenvolvimento.  Pessoalmente, imediatamente comecei a perceber o Vue como um tipo de construtor e o desenvolvimento ocorre rapidamente: se eu precisar, por exemplo, de um selecionador de datas, provavelmente no Vue j√° existe, √© livre para usar e testar pela comunidade.  Acabei de instalar o componente no projeto, escrevo uma tag e tudo funciona.  De fato, nosso painel consiste em 70 a 80% das bibliotecas conclu√≠das.  Quero dizer o uso do componente, n√£o o tamanho da base de c√≥digo, que pode ser verificada com um comando como: npx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">intrinsic</a> / loc </li></ol><br>  Ao implementar um projeto, voc√™ sempre leva em considera√ß√£o suas perspectivas, principalmente as perspectivas de desenvolvimento.  E o fato de os ecossistemas Vue j√° possu√≠rem ferramentas como Weex, Quasar Framework ou Nuxt para mim expandem significativamente os horizontes do desenvolvimento de nossos pain√©is. <br><br>  No Habr√©, h√° um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo maravilhoso sobre o Vue</a> , criado por seu criador, e vou falar sobre alguns recursos do nosso aplicativo. <br><br><h2>  Vuex Sync com servi√ßo RestAPI </h2><br>  Parte dos dados de armazenamento global da Vuex em nosso aplicativo √© sincronizada com o RestAPI por meio de solicita√ß√µes comuns nos endere√ßos correspondentes.  Por que fizemos isso?  Bem, pelo menos para que as principais configura√ß√µes do usu√°rio n√£o estejam vinculadas a um navegador espec√≠fico de um dispositivo espec√≠fico.  Voc√™ pode entrar em nosso painel no computador de sua esposa ou em um clube de jogos e, ao mesmo tempo, entrar no mesmo ambiente familiar que voc√™ tinha em seu pr√≥prio carro. <br><br>  Al√©m disso, quando a sincroniza√ß√£o era apenas com o localStorage, alguns navegadores perdiam o conte√∫do do localStorage durante as atualiza√ß√µes - ele foi completamente exclu√≠do.  Sim, e recentemente houve uma tend√™ncia a restringir a pol√≠tica de armazenamento de dados do usu√°rio em cookies, por exemplo, uma fun√ß√£o no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WebKit Intelligent Tracking Prevention</a> - por uma hora eles chegar√£o ao localStorage. <br><br><h2>  Barramento de evento </h2><br>  Sim, usamos o barramento de evento global.  Como em qualquer outro aplicativo grande com muitos componentes, mais cedo ou mais tarde √© necess√°rio estabelecer a intera√ß√£o entre componentes n√£o relacionados.  Mesmo atrav√©s do armazenamento global.  √â claro que, se houver um relacionamento pai-filho, a intera√ß√£o deles ser√° organizada de maneira padr√£o pelas propriedades dos props em uma dire√ß√£o e o m√©todo $ emit na outra, ou pelo armazenamento, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conforme descrito nas recomenda√ß√µes da Vue</a> . <br><br>  Mas a documenta√ß√£o tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descreve a possibilidade de usar o barramento de eventos global</a> .  Temos v√°rios formul√°rios no projeto com diferentes conjuntos de campos e, em alguns casos (existem alguns deles, mas todos s√£o fundamentais), voc√™ precisa de alguma forma reagir de uma maneira especial para alterar o valor do campo.  N√£o faz sentido armazenar os valores de todos os campos de cada formul√°rio no armazenamento global: <br><br><ol><li>  Em primeiro lugar, devido √† rara necessidade </li><li>  Em segundo lugar, todos os nossos formul√°rios s√£o gerados dinamicamente e o conjunto de campos para qualquer formul√°rio pode mudar drasticamente. </li></ol><br>  Ent√£o eu decidi usar o mecanismo de barramento de eventos.  Ao mesmo tempo, nada impede que voc√™ use seu emissor de eventos - o principal √© usar esse mecanismo com cuidado, apenas para situa√ß√µes excepcionais e limpar tudo com cuidado. <br><br><h2>  Intera√ß√£o RestAPI com o painel </h2><br>  Para tornar a interface mais responsiva na estrutura jQuery antiga, os coment√°rios do RestAPI para o aplicativo cliente foram emulados por meio de um sistema de timer astuto: ele executou pesquisas RestAPI em um determinado intervalo e redesenhou os n√≥s do DOM que afetavam as altera√ß√µes. <br><br>  Essa n√£o era uma solu√ß√£o ideal: em todos os navegadores modernos, os temporizadores congelam quase completamente quando a guia se torna inativa e recebe baixa prioridade.  Como resultado, uma solicita√ß√£o para o servi√ßo RestAPI pode ser adiada e receber dados j√° irrelevantes. <br><br>  Para resolver esse problema em um novo painel, decidi usar o pacote do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≥dulo Nchan</a> para o servidor da web Nginx e os novos recursos das interfaces HTML5 - EventSource e WebWorker. <br><br>  O m√≥dulo Nchan suporta o envio de mensagens atrav√©s do Websocket, EventSource e Long-Polling.  Realizei v√°rios testes e decidi usar o EventSource: as mensagens podem ser apenas texto e as mensagens fluem apenas em uma dire√ß√£o (do servidor).  Isso resolveu completamente a tarefa. <br><br>  Agora a interface EventSource opera em um thread de segundo plano separado do WebWorker, independentemente da atividade da guia.  No mesmo encadeamento, uma fila de mensagens primitivas √© organizada para que nada seja perdido.  A fila √© enviada para o thread principal do aplicativo, que, por sua vez, produz os redesenhos necess√°rios da interface quando √© conveniente e permite o navegador. <br><br><h2>  Backdoors: como e por que verifico a seguran√ßa dos componentes </h2><br>  Antes de conectar a biblioteca, √© obrigat√≥rio verificar se h√° seguran√ßa: houve um caso em que um componente introduziu especificamente um backdoor, o que permitiu acessar o site e fazer o download de dados. <br><br>  Por√©m, mais frequentemente, as brechas de seguran√ßa parecem mais prov√°veis ‚Äã‚Äãdevido √† neglig√™ncia dos desenvolvedores.  Nos mercados de aplicativos, h√° uma equipe que verifica os componentes quanto √† seguran√ßa, mas n√£o √© muito complicado e √© melhor verificar as bibliotecas manualmente. <br><br>  Eu sempre verifico os pacotes quanto aos ganchos de pr√©-instala√ß√£o, instala√ß√£o e p√≥s-instala√ß√£o no campo "scripts" do arquivo "package.json".  Al√©m disso, uso analisadores de pacotes est√°ticos, como <a href="">aposentar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">snyk</a> e o comando "audit" do gerenciador de pacotes npm. <br><br>  Os avisos de seguran√ßa v√™m em n√≠veis diferentes, geralmente durante a verifica√ß√£o, quando n√£o s√£o cr√≠ticos.  √Äs vezes, para tratar uma biblioteca, basta atualizar - os pr√≥prios desenvolvedores da biblioteca monitoram a seguran√ßa. <br><br>  Se uma biblioteca se comprometeu uma vez, √© melhor substitu√≠-la - isso √© um sinal de falta de confiabilidade; portanto, com os avisos, escolho procurar outra biblioteca. <br><br>  Ap√≥s o pacote ter passado na an√°lise, definitivamente corrigirei sua vers√£o.  Se voc√™ precisar de uma vers√£o diferente - o pacote passa na an√°lise novamente.  Sim, leva tempo, mas vale a pena. <br><br>  At√© agora, os backdoors nunca chegaram √† nossa produ√ß√£o. <br><br><h2>  Muitos muitos coment√°rios </h2><br>  Como eu disse, o Vue foi escolhido por sua simplicidade e declaratividade.  Al√©m disso, escrevo muitos coment√°rios, em quase todas as linhas: para que, nesse caso, o novo desenvolvedor possa entrar facilmente no projeto e para que eu pr√≥prio volte facilmente aos trechos de c√≥digo antigos. <br><br><h2>  Por que eu me apaixonei pelo novo frontend e pelo painel como um todo </h2><br><h4>  Tornou-se mais f√°cil manter o c√≥digo </h4><br>  O desenvolvimento levou meio ano.  Agora, provavelmente, estou mais envolvido no suporte ao painel, meu c√≥digo n√£o pressiona e n√£o esfrega. <br><br><h4>  Os clientes podem obter rapidamente o que solicitaram. </h4><br><img src="https://habrastorage.org/webt/d9/ko/zg/d9kozgyoj_it6a913dxovniuifk.png"><br><br>  Tornou-se r√°pido e conveniente adicionar novos recursos que apareciam no back-end: por exemplo, adicionei o pagamento para pessoas jur√≠dicas em 2 dias e as capturas instant√¢neas em 1 dia. <br><br><h2>  Estou aberto a perguntas </h2><br>  Neste artigo, revelei alguns dos segredos relacionados ao frontend do nosso painel.  Se voc√™ tiver alguma d√∫vida - bem-vindo ao comentar, tentarei responder. <br><br>  E, √© claro, convido voc√™ a expressar sugest√µes para melhorar o painel. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Inscreva-se no nosso desenvolvedor do Instagram </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt465285/">https://habr.com/ru/post/pt465285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt465275/index.html">Alice Obt√©m Habilidade</a></li>
<li><a href="../pt465277/index.html">Analisando e analisando a sem√¢ntica para SEO: 5 modelos gratuitos do Planilhas Google</a></li>
<li><a href="../pt465279/index.html">Reconhecimento de faces usando redes siamesas</a></li>
<li><a href="../pt465281/index.html">Monitoramento Cont√≠nuo de Glicose (NMH) com a Bomba Medtronic 640g</a></li>
<li><a href="../pt465283/index.html">‚ÄúExiste tudo o que √© necess√°rio e nada enfurece‚Äù - a verdade fala pelos l√°bios do cliente</a></li>
<li><a href="../pt465289/index.html">Resumo de eventos para profissionais de RH na √°rea de TI em setembro de 2019</a></li>
<li><a href="../pt465291/index.html">Mais perto do ch√£o: como mudei o coworking para uma casa de aldeia</a></li>
<li><a href="../pt465293/index.html">Como abandonamos a grande hackathon e come√ßamos a fazer viagens para equipes individuais</a></li>
<li><a href="../pt465295/index.html">Como trabalhei na Turquia e conheci o mercado local</a></li>
<li><a href="../pt465297/index.html">"A melhor coisa que fiz na minha carreira √© enviar o trabalho para o inferno". Chris Dancy sobre como transformar a vida em dados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>