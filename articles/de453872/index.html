<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîö üóëÔ∏è ‚ò¢Ô∏è Wiederherstellen von Fotos mithilfe neuronaler Netze üòò üëºüèø üèä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits, ich arbeite als Forschungsprogrammierer im Computer Vision Team der Mail.ru Group. F√ºr den diesj√§hrigen Tag des Sieges haben wir bes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wiederherstellen von Fotos mithilfe neuronaler Netze</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/453872/"><img src="https://habrastorage.org/getpro/habr/post_images/333/44a/c78/33344ac788b63200841180799417f934.jpg"><br><br>  Hallo allerseits, ich arbeite als Forschungsprogrammierer im Computer Vision Team der Mail.ru Group.  F√ºr den diesj√§hrigen Tag des Sieges haben wir beschlossen, ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projekt zur Restaurierung von Milit√§rfotografien durchzuf√ºhren</a> .  Was ist Fotorestaurierung?  Es besteht aus drei Stufen: <br><br><ul><li>  wir finden alle Bildfehler: Br√ºche, Kratzer, L√∂cher; <br></li><li>  √úbermalen Sie die gefundenen Fehler anhand der Pixelwerte um sie herum. <br></li><li>  kolorieren Sie das Bild. <br></li></ul><br>  In diesem Artikel werde ich jede Phase der Wiederherstellung im Detail durchgehen und Ihnen erkl√§ren, wie und wo wir Daten aufgenommen haben, welche Netzwerke wir gelernt haben, was wir getan haben, auf welche Rechen wir getreten sind. <br><a name="habracut"></a><br><h1>  Fehlersuche </h1><br>  Wir m√∂chten alle Pixel im Zusammenhang mit Fehlern im hochgeladenen Foto finden.  Zun√§chst m√ºssen wir verstehen, welche Art von Fotos der Kriegsjahre die Menschen hochladen werden.  Wir wandten uns an die Organisatoren des Immortal Regiment-Projekts, die Daten mit uns teilten.  Nach der Analyse haben wir festgestellt, dass Personen h√§ufig Einzel- oder Gruppenportr√§ts hochladen, die eine m√§√üige oder gro√üe Anzahl von Fehlern aufweisen. <br><br>  Dann war es notwendig, eine Trainingsprobe zu sammeln.  Das Trainingsmuster f√ºr die Segmentierungsaufgabe ist ein Bild und eine Maske, auf der alle Fehler markiert sind.  Am einfachsten ist es, den Markern Fotos zu geben.  Nat√ºrlich sind die Leute gut darin, Fehler zu finden, aber das Problem ist, dass das Markup ein sehr langer Prozess ist. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/a19/892/d5da1989220f10bcaac3944d27d64276.png"><br><br>  Das Markieren von Pixeln im Zusammenhang mit Fehlern in einem Foto kann von einer Stunde bis zu einem ganzen Arbeitstag dauern. Daher ist es schwierig, in wenigen Wochen eine Probe von mehr als 100 Fotos zu sammeln.  Deshalb haben wir versucht, unsere Daten irgendwie zu erg√§nzen und selbst Fehler zu schreiben: Wir haben ein sauberes Foto gemacht, k√ºnstliche Fehler darauf angebracht und eine Maske bekommen, die uns zeigt, welche Teile des Bildes besch√§digt wurden.  Der Hauptteil unserer Trainingsprobe bestand aus 79 manuell markierten Fotos, von denen 11 auf die Testprobe √ºbertragen wurden. <br><br>  Der beliebteste Ansatz f√ºr das Segmentierungsproblem: Nehmen Sie Unet mit einem vorab trainierten Encoder und minimieren Sie die Menge <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>c</mi><mi>e</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.854ex" height="2.057ex" viewBox="0 -780.1 1659.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-63" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-65" x="1193" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>c</mi><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> Bce </script>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bin√§re Kreuzentropie</a> ) und <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.057ex" viewBox="0 -780.1 2858 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-45" x="2093" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> DICE </script>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">S√∏rensen - W√ºrfelkoeffizient</a> ). <br><br>  Welche Probleme treten bei diesem Ansatz beim Problem der Segmentierung von Fehlern auf? <br><br><ul><li>  Auch wenn es uns so vorkommt, als ob das Foto viele M√§ngel aufweist, dass es sehr schmutzig und zeitlich sehr zerrissen ist, ist der von Fehlern eingenommene Bereich immer noch viel kleiner als der unbesch√§digte Teil des Bildes.  Um dieses Problem zu l√∂sen, k√∂nnen Sie das Gewicht der positiven Klasse in erh√∂hen <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>c</mi><mi>e</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.854ex" height="2.057ex" viewBox="0 -780.1 1659.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-63" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-65" x="1193" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>c</mi><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> Bce </script>  und das optimale Gewicht ist das Verh√§ltnis der Anzahl aller reinen Pixel zur Anzahl der zu den Defekten geh√∂renden Pixel. <br></li><li>  Das zweite Problem ist, dass wir viele Positionsinformationen verlieren, wenn wir Unet sofort mit einem vorab trainierten Encoder verwenden, beispielsweise Albunet-18.  Die erste Schicht von Albunet-18 besteht aus einer Faltung mit einem Kern von 5 und einem Schritt von zwei.  Dadurch kann das Netzwerk schnell arbeiten.  Wir haben die Betriebszeit des Netzwerks f√ºr eine bessere Lokalisierung von Fehlern geopfert: Wir haben das maximale Pooling nach der ersten Schicht entfernt, den Schritt auf 1 reduziert und den Faltungskern auf 3 reduziert. <br></li><li>  Wenn wir beispielsweise mit kleinen Bildern arbeiten und ein Bild auf 256 x 256 oder 512 x 512 komprimieren, verschwinden kleine Fehler aufgrund der Interpolation einfach.  Daher m√ºssen Sie mit einem gro√üen Bild arbeiten.  Jetzt in der Produktion segmentieren wir Defekte in Fotografien von 1024 x 1024. Daher war es notwendig, das neuronale Netzwerk in einer gro√üen Anzahl gro√üer Bilder zu trainieren.  Aus diesem Grund gibt es Probleme mit der geringen Gr√∂√üe des Stapels auf einer Grafikkarte. <br></li><li>  W√§hrend des Trainings haben wir ungef√§hr 20 Bilder auf einer Karte.  Aus diesem Grund ist die Sch√§tzung des Mittelwerts und der Varianz in den BatchNorm-Ebenen ungenau.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">In-Place-BatchNorm</a> hilft uns bei der L√∂sung dieses Problems, das zum einen Speicher spart und zum anderen eine Version von Synchronized BatchNorm enth√§lt, mit der Statistiken zwischen allen Karten synchronisiert werden.  Jetzt betrachten wir den Durchschnitt und die Varianz nicht mit 20 Bildern auf einer Karte, sondern mit 80 Bildern von 4 Karten.  Dies verbessert die Netzwerkkonvergenz. <br></li></ul><br>  Am Ende Gewichtszunahme <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>B</mi><mi>c</mi><mi>e</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.854ex" height="2.057ex" viewBox="0 -780.1 1659.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-42" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-63" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-65" x="1193" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>c</mi><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> Bce </script>  Durch √Ñndern der Architektur und Verwenden von In-Place BatchNorm haben wir begonnen, nach Fehlern im Foto zu suchen.  Aber billig k√∂nnten Sie es noch ein bisschen besser machen, indem Sie Test Time Augmentation hinzuf√ºgen.  Wir k√∂nnen das Netzwerk einmal im Eingabebild ausf√ºhren, es dann spiegeln und das Netzwerk erneut ausf√ºhren. Dies kann uns helfen, kleine Fehler zu finden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/95b/702/c7595b702dcb921dac612b0218ce13e4.png"><br><br>  Infolgedessen konvergierte unser Netzwerk in 18 Stunden auf vier GeForce 1080Ti.  Inferenz dauert 290 ms.  Es stellt sich lange genug heraus, aber dies ist der Preis daf√ºr, dass wir gut nach kleinen M√§ngeln suchen.  Validierung <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.057ex" viewBox="0 -780.1 2858 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-45" x="2093" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mi>I</mi><mi>C</mi><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> DICE </script>  gleich 0,35 und <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi><mi>O</mi><mi>C</mi><mi>A</mi><mi>U</mi><mi>C</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.596ex" height="2.057ex" viewBox="0 -780.1 4562 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-4F" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-43" x="1523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-41" x="2283" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-55" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhhDWmkYEg4zmTTrsbni0BpTZPynWQ#MJMATHI-43" x="3801" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>O</mi><mi>C</mi><mi>A</mi><mi>U</mi><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> ROCAUC </script>  - 0,93. <br><br><h1>  Fragmentwiederherstellung </h1><br>  Unet hat uns geholfen, dieses Problem wieder zu l√∂sen.  Zur Eingabe gaben wir ihm das Originalbild und eine Maske, auf der wir saubere R√§ume mit Einheiten markieren, sowie die Pixel, die wir mit Nullen √ºbermalen m√∂chten.  Wir haben die Daten wie folgt gesammelt: Wir haben aus dem Internet einen gro√üen Datensatz mit Bildern, beispielsweise OpenImagesV4, und k√ºnstlich hinzugef√ºgten Fehlern entnommen, deren Form denen des realen Lebens √§hnelt.  Danach trainierten sie das Netzwerk, um die fehlenden Teile zu reparieren. <br><br>  Wie k√∂nnen wir Unet f√ºr diese Aufgabe √§ndern? <br><br>  Sie k√∂nnen die Teilfaltung anstelle der √ºblichen Faltung verwenden.  Ihre Idee ist, dass wir beim Reduzieren eines Bildbereichs mit einem Kernel die Pixelfehler, die sich auf Fehler beziehen, nicht ber√ºcksichtigen.  Dies hilft, das Bild genauer zu machen.  Ein Beispiel aus einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NVIDIA-Artikel</a> .  Im zentralen Bild verwendeten sie Unet mit der √ºblichen Faltung und rechts - mit Teilfaltung: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a5/280/a4b/5a5280a4be71695d16ab08af876c5d23.png"><br><br>  Wir haben das Netzwerk 5 Tage lang trainiert.  Am letzten Tag haben wir BatchNorm eingefroren. Dies hat dazu beigetragen, dass die R√§nder des gemalten Teils des Bildes weniger auff√§llig sind. <br><br>  Das Netzwerk verarbeitet ein Bild von 512 x 512 in 50 ms.  Das Validierungs-PSNR betr√§gt 26,4.  Metriken k√∂nnen in dieser Aufgabe jedoch nicht unbedingt vertraut werden.  Aus diesem Grund haben wir zun√§chst mehrere gute Modelle f√ºr unsere Daten erstellt, die Ergebnisse anonymisiert und dann f√ºr diejenigen gestimmt, die uns besser gefallen haben.  Also haben wir das endg√ºltige Modell gew√§hlt. <br><br>  Ich erw√§hnte, dass wir sauberen Bildern k√ºnstlich Fehler hinzugef√ºgt haben.  W√§hrend des Trainings m√ºssen Sie die maximale Gr√∂√üe der √ºberlagerten Fehler sorgf√§ltig √ºberwachen, da das Netzwerk bei sehr gro√üen Fehlern, die das Netzwerk im Lernprozess noch nie gesehen hat, wild phantasiert und ein absolut nicht anwendbares Ergebnis liefert.  Wenn Sie also gro√üe Fehler √ºbermalen m√ºssen, wenden Sie w√§hrend des Trainings auch gro√üe Fehler an. <br><br>  Hier ist ein Beispiel f√ºr den Algorithmus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abd/6cb/c8c/abd6cbc8c05396042bf83c00516b630e.png"><br><br><h1>  F√§rben </h1><br>  Wir haben die Fehler segmentiert und bemalt, der dritte Schritt ist die Rekonstruktion der Farbe.  Ich m√∂chte Sie daran erinnern, dass es auf den Fotografien des "Unsterblichen Regiments" viele Einzel- oder Gruppenportr√§ts gibt.  Und wir wollten, dass unser Netzwerk gut mit ihnen zusammenarbeitet.  Wir haben uns f√ºr eine eigene Kolorierung entschieden, da keiner der uns bekannten Dienste schnell und gut Portr√§ts malt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/015/bce/bf1/015bcebf15ef1ee069fdf08f16e00542.png"><br><br>  GitHub hat ein beliebtes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> zum Ausmalen von Fotos.  Im Durchschnitt macht er diesen Job gut, aber er hat mehrere Probleme.  Zum Beispiel malt er gerne Kleidung in Blau.  Deshalb haben wir es auch abgelehnt. <br><br>  Also beschlossen wir, ein neuronales Netzwerk f√ºr die Kolorierung zu erstellen.  Die naheliegendste Idee: Nehmen Sie ein Schwarzwei√übild auf und sagen Sie drei Kan√§le voraus: Rot, Gr√ºn und Blau.  Aber im Allgemeinen k√∂nnen wir unsere Arbeit vereinfachen.  Wir k√∂nnen nicht mit der RGB-Darstellung der Farbe arbeiten, sondern mit der YCbCr-Darstellung.  Komponente Y ist die Helligkeit (Luma).  Das heruntergeladene Schwarzwei√übild ist der Y-Kanal, wir werden ihn wiederverwenden.  Es blieb Cb und Cr vorherzusagen: Cb ist der Unterschied in blauer Farbe und Helligkeit, und Cr ist der Unterschied in roter Farbe und Helligkeit. <br><br><img src="https://habrastorage.org/webt/k8/ke/l_/k8kel_xrjco6euolh8ypkchjm8g.jpeg"><br><br>  Warum haben wir die YCbCr-Ansicht gew√§hlt?  Das menschliche Auge ist anf√§lliger f√ºr Helligkeits√§nderungen als f√ºr Farb√§nderungen.  Daher verwenden wir die Y-Komponente (Helligkeit), f√ºr die das Auge anfangs gut empf√§nglich ist, wieder und sagen Cb und Cr voraus, bei denen wir etwas mehr Fehler machen k√∂nnen, da die Menschen weniger ‚Äûfalsche‚Äú Farben bemerken.  Diese Funktion wurde zu Beginn des Farbfernsehens aktiv genutzt, als die Kanalbandbreite nicht ausreichte, um alle Farben vollst√§ndig zu √ºbertragen.  Das Bild wurde auf YCbCr √ºbertragen, unver√§ndert auf die Y-Komponente √ºbertragen und Cb und Cr wurden zweimal komprimiert. <br><br><h1>  So montieren Sie die Grundlinie </h1><br>  Sie k√∂nnen Unet erneut mit einem vorab trainierten Encoder verwenden und den L1-Verlust zwischen dem realen CbCr und dem vorhergesagten minimieren.  Wir m√∂chten Portr√§ts einf√§rben, daher m√ºssen wir zus√§tzlich zu den Fotos von OpenImages Fotos hinzuf√ºgen, die f√ºr unsere Aufgabe spezifisch sind. <br><br>  Wo kann ich Farbfotos von Menschen in Milit√§runiform bekommen?  Es gibt Leute im Internet, die alte Fotos als Hobby oder auf Bestellung malen.  Sie tun dies sehr sorgf√§ltig und versuchen, alle Nuancen vollst√§ndig einzuhalten.  Sie f√§rben die Uniform, Schulterklappen und Medaillen und wenden sich Archivmaterial zu, damit das Ergebnis ihrer Arbeit vertrauensw√ºrdig ist.  Insgesamt haben wir 200 handgemalte Fotos verwendet.  Die zweite n√ºtzliche Datenquelle ist der Standort der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Roten Armee</a> der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arbeiter und Bauern</a> .  Einer seiner Sch√∂pfer wurde w√§hrend des Gro√üen Vaterl√§ndischen Krieges in fast allen m√∂glichen Varianten einer Milit√§runiform fotografiert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f72/999/7d9/f729997d9fd02755fd95967ff09d27ca.png"><br><br>  Auf einigen Fotografien wiederholte er die Posen von Menschen aus ber√ºhmten Archivfotos.  Es ist besonders gut, dass er auf einem wei√üen Hintergrund aufgenommen hat. Dadurch konnten wir die Daten sehr gut erweitern und dem Hintergrund verschiedene nat√ºrliche Objekte hinzuf√ºgen.  Wir haben auch gew√∂hnliche moderne Portr√§ts von Menschen verwendet, die durch Abzeichen und andere Attribute von Kriegskleidung erg√§nzt wurden. <br><br>  Wir haben AlbuNet-50 trainiert - dies ist Unet, in dem AlbuNet-50 als Encoder verwendet wird.  Das Netzwerk lieferte ad√§quate Ergebnisse: Die Haut ist rosa, die Augen sind grau-blau, die Schultergurte sind gelblich.  Das Problem ist aber, dass sie die Bilder mit Flecken bemalt hat.  Dies liegt an der Tatsache, dass es aus Sicht des L1-Fehlers manchmal rentabler ist, nichts zu tun, als zu versuchen, eine Farbe vorherzusagen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/435/4a9/63c/4354a963c4cd2789c434002e44fdda26.png"><br>  <i>Wir vergleichen unser Ergebnis mit einem Foto von Ground Truth - manuelle Kolorierung des K√ºnstlers unter dem Spitznamen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klimbim</a></i> <br><br>  Wie kann man dieses Problem l√∂sen?  Wir brauchen einen Diskriminator: ein neuronales Netzwerk, an das wir Bilder f√ºr die Eingabe liefern und das sagt, wie realistisch dieses Bild aussieht.  Unten ist ein Foto handgemalt und das zweite von einem neuronalen Netzwerk.  Welches denkst du? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/253/86a/abd/25386aabd9080c14daf71b60d9968453.png"><br><br><div class="spoiler">  <b class="spoiler_title">Die Antwort</b> <div class="spoiler_text">  Das linke Foto wird manuell gemalt. <br></div></div><br>  Als Diskriminator verwenden wir den Diskriminator aus dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Self-Attention GAN</a> .  Dies ist ein kleines Faltungsnetzwerk, in dessen letzten Schichten die sogenannte Selbstaufmerksamkeit eingebaut ist.  Es erm√∂glicht Ihnen, mehr auf die Bilddetails zu achten.  Wir verwenden auch die spektrale Normalisierung.  Die genaue Erkl√§rung und Motivation finden Sie im Artikel.  Wir haben ein Netzwerk mit einer Kombination aus L1-Verlust und dem vom Diskriminator zur√ºckgegebenen Fehler trainiert.  Jetzt malt das Netzwerk die Details des Bildes besser und der Hintergrund ist konsistenter.  Ein weiteres Beispiel: Links ist das Ergebnis des Netzwerks, das nur mit L1-Verlust trainiert wurde, rechts - mit L1-Verlust und einem Diskriminatorfehler. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/724/ada/aa4724ada4e0bbdc52dbcaadd5bb3fdc.png"><br><br>  Bei vier Geforce 1080Ti dauerte das Training zwei Tage.  Das Netzwerk hat in 30 ms im Bild 512 x 512 gearbeitet. Die Validierungs-MSE betrug 34,4.  Wie beim Inpainting-Problem k√∂nnen Metriken nicht vollst√§ndig als vertrauensw√ºrdig eingestuft werden.  Daher haben wir 6 Modelle ausgew√§hlt, die die besten Metriken f√ºr die Validierung hatten, und blind f√ºr das beste Modell gestimmt. <br><br>  Nachdem wir das Modell in der Produktion eingef√ºhrt hatten, setzten wir die Experimente fort und kamen zu dem Schluss, dass es besser ist, nicht den L1-Verlust pro Pixel, sondern den Wahrnehmungsverlust zu minimieren.  Um dies zu berechnen, m√ºssen Sie die Netzwerkvorhersage und das Quellfoto √ºber das VGG-16-Netzwerk ausf√ºhren, die Attributkarten auf den unteren Ebenen verwenden und sie gem√§√ü MSE vergleichen.  Dieser Ansatz malt mehr Bereiche und hilft, ein farbenfroheres Bild zu erhalten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db9/303/509/db93035094c4906cf82c246151432cbc.jpg"><br><br><h1>  Schlussfolgerungen und Schlussfolgerung </h1><br>  Unet ist ein cooles Modell.  Beim ersten Segmentierungsproblem ist beim Training und Arbeiten mit hochaufl√∂senden Bildern ein Problem aufgetreten. Daher verwenden wir In-Place BatchNorm.  Bei der zweiten Aufgabe (Inpainting) haben wir anstelle der √ºblichen Faltung die Teilfaltung verwendet, um bessere Ergebnisse zu erzielen.  Im Kolorierungsproblem f√ºr Unet haben wir ein kleines Diskriminatornetzwerk hinzugef√ºgt, das den Generator f√ºr ein unrealistisch aussehendes Bild bestraft und Wahrnehmungsverlust verwendet. <br><br>  Die zweite Schlussfolgerung ist, dass Accessoren wichtig sind.  Und das nicht nur beim Markieren von Bildern vor dem Training, sondern auch zur Validierung des Endergebnisses, denn bei Problemen mit Lackfehlern oder Kolorierungen m√ºssen Sie das Ergebnis noch mit Hilfe einer Person validieren.  Wir geben dem Benutzer drei Fotos: das Original mit den entfernten Fehlern, das mit den entfernten Fehlern eingef√§rbt ist, und nur das eingef√§rbte Foto, falls der Algorithmus zum Auffinden und Malen von Fehlern falsch ist. <br><br>  Wir haben einige Fotos des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Military Album-</a> Projekts gemacht und sie mit unseren neuronalen Netzen verarbeitet.  Hier sind die erzielten Ergebnisse: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a51/ade/15e/a51ade15e9cee54ec8269dc1e22df0af.jpg"><br><br>  Und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> k√∂nnen Sie sie in der Originalaufl√∂sung und in jeder Phase der Verarbeitung sehen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453872/">https://habr.com/ru/post/de453872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453862/index.html">Warum sollten Sie Pathlib verwenden</a></li>
<li><a href="../de453864/index.html">Das Verwenden einer Maus und einer Tastatur auf Konsolen ist Betrug?</a></li>
<li><a href="../de453866/index.html">API-Anfrage mit React Hooks, HOC oder Render Prop</a></li>
<li><a href="../de453868/index.html">Ber√ºhren Sie den Mini-Schalter mit Glasscheibe am nRF52832</a></li>
<li><a href="../de453870/index.html">Wir schreiben Reverse socks5 Proxy auf Powershell. Teil 1</a></li>
<li><a href="../de453874/index.html">Vom russischen Roulette zum sicheren LOTO: So sch√ºtzen Sie das Personal des Rechenzentrums</a></li>
<li><a href="../de453876/index.html">Wie bei Yandex.Practicum gewann das Front-End-Desync: eine akrobatische Nummer mit Redux-Saga, postMessage und Jupyter</a></li>
<li><a href="../de453882/index.html">Ein guter Leitfaden zum Beruf eines L√∂sungsarchitekten (+ Liste n√ºtzlicher Links)</a></li>
<li><a href="../de453884/index.html">HYIP Kamera oder DSLR Ersatz?</a></li>
<li><a href="../de453886/index.html">Programm funktioniert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>