<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•¢ üê¶ üòÇ Serveur Web CentOS 8 avec php7, node.js et redis üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üòó üôä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 
 Cela fait 2 jours que la nouvelle version du syst√®me d'exploitation CentOS est sortie, √† savoir CentOS 8. Et jusqu'√† pr√©sent, il y a peu d'a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serveur Web CentOS 8 avec php7, node.js et redis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469097/"><h2>  Pr√©face </h2><br>  Cela fait 2 jours que la nouvelle version du syst√®me d'exploitation CentOS est sortie, √† savoir CentOS 8. Et jusqu'√† pr√©sent, il y a peu d'articles sur Internet sur la fa√ßon dont quelque chose y est fait, j'ai donc d√©cid√© de combler cette lacune.  De plus, je vais vous expliquer non seulement comment installer cette paire de programmes, mais aussi comment je vois g√©n√©ralement l'installation de Linux dans un environnement virtuel dans le monde moderne pour les t√¢ches courantes, y compris le partitionnement de disque et plus encore. <br><br>  Mais au d√©but, je veux expliquer bri√®vement pourquoi vous devriez passer √† cette version √† partir de toutes les pr√©c√©dentes, et il y a deux raisons √† cela: <br><a name="habracut"></a><br><ol><li>  php7!  Dans la version pr√©c√©dente de CentOS, "Orthodox" php5.4 √©tait install√© ... <br><br>  Eh bien, si c'est un peu plus s√©rieux, alors beaucoup de packages ont saut√© sur plusieurs versions en vrac.  Nous (les fans d'OS de type redhat) sommes enfin entr√©s, sinon dans le futur, du moins dans le pr√©sent.  Et les supporters d'Ubuntu ne se moqueront plus de nous et ne nous piqueront pas les doigts, enfin ... du moins pendant un certain temps;). </li><li>  Transition de miam √† dnf.  La principale diff√©rence est que d√©sormais travailler avec plusieurs versions de packages est officiellement pris en charge.  Ici, dans le chiffre huit, cela ne m'a jamais encore √©t√© utile, mais cela semble prometteur. </li></ol><br><h2>  Cr√©ation d'une machine virtuelle </h2><br>  Les hyperviseurs sont diff√©rents et je n'ai aucune raison d'affiner le lecteur pour un lecteur sp√©cifique, je vais vous parler des principes g√©n√©raux. <br><br><h3>  La m√©moire </h3><br>  Tout d'abord ... Pour installer le syst√®me CentOS √† partir de 7, c'est s√ªr, et √† mon avis √† 6, c'√©tait comme √ßa aussi ("mais ce n'est pas pr√©cis"), un <i>minimum de</i> 2 Go de RAM est requis.  Par cons√©quent, je vous conseille de commencer et de donner autant. <br><br>  Mais si cela, apr√®s l'installation, la quantit√© de m√©moire peut √™tre r√©duite.  √Ä 1 Go, le syst√®me nu fonctionne tr√®s bien, j'ai v√©rifi√©. <br><br><h3>  Conduire </h3><br>  Pour une installation normale, cr√©ez un disque virtuel de 20 √† 30 Go.  C'est suffisant pour le syst√®me.  Et un deuxi√®me disque pour les donn√©es.  Il peut √™tre ajout√© √† la fois au stade de la cr√©ation d'une machine virtuelle et apr√®s.  J'ajoute g√©n√©ralement plus tard. <br><br><h3>  CPU </h3><br>  Sur un c≈ìur, un syst√®me nu ne ralentit pas.  Et comme les ressources sont librement √©volutives, je ne vois aucun int√©r√™t √† en donner plus au stade de l'installation (√† moins que vous ne connaissiez id√©alement les exigences et que vous soyez trop paresseux pour entrer dans le configurateur une fois de plus) <br><br>  Le reste peut g√©n√©ralement √™tre laiss√© par d√©faut. <br><br><h2>  L'installation elle-m√™me </h2><br>  Donc ... Nous lan√ßons l'installateur ... Personnellement, je ne mets ces services depuis longtemps que sous forme de machines virtuelles, donc je ne d√©crirai pas toutes sortes d'enregistrements de distribution sur une cl√© USB - je monte simplement l'ISO en tant que CD dans mon hyperviseur pr√©f√©r√©, je l'ai t√©l√©charg√© et je l'ai conduit. <br><br>  L'installation de base est assez typique, je ne me concentrerai que sur quelques points. <br><br><h3>  S√©lection de la source </h3><br>  Depuis la sortie de la huiti√®me version, le miroir de Yandex est rest√© allong√© toute la journ√©e.  Eh bien, c'est-√†-dire qu'il augmente p√©riodiquement, puis recommence √† afficher une erreur.  Je suis s√ªr que la question est une charge excessive sur le service.  Par cons√©quent, pour indiquer la source, j'ai personnellement d√ª, au lieu de saisir l'adresse habituelle, aller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , s√©lectionner le miroir que j'aime l√†-bas et entrer manuellement l'adresse dans la fen√™tre du programme d'installation.  Il est important de se rappeler que vous devez sp√©cifier le chemin d'acc√®s au dossier o√π se trouve le <b>r√©pertoire repodata</b> .  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mirror.corbina.net/pub/Linux/centos/8/BaseOS/x86_64/os</a> . <br><br><h3>  Panne de disque </h3><br>  Cette question est plut√¥t religieuse √† mon avis.  Chaque administrateur a sa propre position √† ce sujet.  Mais je partage toujours mon point de vue sur la question. <br><br>  Oui, en principe, vous pouvez allouer toute la place √† la racine et travailler, le plus souvent c'est m√™me assez bien.  Pourquoi alors cl√¥turer un jardin avec diff√©rentes sections?  - Les principales raisons de cela, √† mon avis 2: les quotas et la portabilit√©. <br><br>  Par exemple, si quelque chose s'est mal pass√© et que des erreurs sont survenues dans la section principale des donn√©es, je veux quand m√™me pouvoir charger le syst√®me et effectuer des mesures de r√©animation.  Par cons√©quent, j'alloue personnellement une partition distincte sous / boot.  L√† r√©side le noyau et le chargeur de d√©marrage.  Habituellement, 500 m√©gaoctets suffisent, mais dans de rares cas cela peut prendre plus, et √©tant donn√© que nous sommes d√©j√† habitu√©s √† mesurer l'espace avec des t√©raoctets, j'alloue 2 Go pour cette section.  Et ici, il est important que cela ne puisse pas √™tre fait lvm. <br><br>  Vient ensuite la racine du syst√®me.  Pour une installation normale, je n'ai jamais eu besoin de plus de 4 Go par syst√®me, mais lors d'√©v√©nements planifi√©s, j'utilise souvent le r√©pertoire / tmp pour d√©compresser les distributions, et je ne vois pas l'int√©r√™t de le mettre en surbrillance dans une section distincte - il nettoie automatiquement dans les syst√®mes modernes, donc il ne se remplit pas .  Donc, sous la racine, j'alloue 8 Go. <br><br>  Swap ... Dans l'ensemble, il y a peu d'avantages pratiques.  Si vous avez commenc√© √† utiliser swap sur le serveur, aujourd'hui dans le monde r√©el, cela signifie seulement que le serveur a besoin d'ajouter plus de RAM.  Sinon, les probl√®mes de performances sont garantis (ou certains programmes ont une fuite de m√©moire).  Par cons√©quent, cette section est uniquement √† des fins de diagnostic.  Par cons√©quent, 2 Go est un grand nombre.  Oui, peu importe la quantit√© de m√©moire du serveur.  Oui, j'ai lu tous les articles o√π il est √©crit sur le rapport m√©moire / volume d'√©change ... √Ä mon humble avis, ils sont obsol√®tes.  Depuis 10 ans de pratique, cela ne m'a jamais √©t√© utile.  Il y a 15 ans, je les utilisais, oui. <br><br>  Tout le monde peut d√©cider d'allouer / √† la maison dans une section distincte √† mon humble avis.  Si quelqu'un utilise activement ce r√©pertoire sur le serveur, il est pr√©f√©rable de le mettre en surbrillance.  Si personne - aucune raison. <br><br>  Ensuite, / var.  √Ä mon avis, il est n√©cessaire de le distinguer.  Pour commencer, vous pouvez vous limiter √† un nombre de 4 Go, puis comment cela se passe.  Et oui, par "comment √ßa se passe", je veux dire que <br><br><ol><li>  Premi√®rement, vous pouvez toujours monter un autre disque dans le sous-r√©pertoire / var (que je montrerai plus tard avec un exemple) </li><li>  Deuxi√®mement, nous avons LVM - vous pouvez toujours ajouter.  Et g√©n√©ralement, vous devez ajouter quand trop de journaux commencent √† y couler.  Mais je n'ai jamais pu pr√©dire ce chiffre √† l'avance, alors je commence avec 2 Go, puis regarde. </li></ol><br>  L'espace non allou√© restera libre dans le groupe de volumes, vous pourrez donc toujours l'utiliser plus tard. <br><br><h4>  LVM </h4><br>  <b>Il</b> est logique de cr√©er <b>toutes les</b> partitions √† l'exception de / boot dans LVM.  Oui, y compris l'√©change.  Oui, l'√©change pour toutes les astuces doit se faire au d√©but du disque, et dans le cas de LVM, son emplacement ne peut pas √™tre d√©termin√© en principe.  Mais comme je l'ai √©crit ci-dessus, votre syst√®me <i>ne devrait pas du tout</i> utiliser swap.  Par cons√©quent, peu importe o√π il se trouve.  Eh bien, pas en 95, nous vivons, honn√™tement! <br><br>  De plus, dans LVM, il existe plusieurs entit√©s de base avec lesquelles vous devez pouvoir vivre: <br><br><ul><li>  volume physique </li><li>  groupe de volumes </li><li>  volume logique </li></ul><br>  Les volumes physiques sont regroup√©s, chaque volume physique √©tant dans un seul groupe, et le groupe peut √™tre sur plusieurs volumes physiques √† la fois. <br>  Et les volumes logiques sont chacun dans le m√™me groupe. <br><br>  Mais ... Nous, bon sang, sommes encore une fois le 21e si√®cle dans la cour.  Et les serveurs sont virtuels.  Cela n'a aucun sens de leur appliquer les m√™mes m√©canismes que ceux appliqu√©s aux m√©canismes physiques.  Et pour le virtuel, il est important d'avoir des donn√©es distinctes du syst√®me!  Ceci est tr√®s important en particulier pour la possibilit√© de basculer rapidement les donn√©es vers une autre machine virtuelle (par exemple, lors du passage √† un nouveau syst√®me d'exploitation) et en g√©n√©ral toutes sortes d'avantages utiles (sauvegardes s√©par√©es par sections utilisant l'hyperviseur par exemple).  Par cons√©quent, un groupe de volumes est utilis√© pour le syst√®me et n√©cessairement un autre est utilis√© pour les donn√©es!  Cette s√©paration logique aide beaucoup dans la vie! <br><br>  Si vous n'avez cr√©√© qu'un seul disque dur virtuel lors de la cr√©ation d'une machine virtuelle, c'est la fin de la configuration.  Et si deux, alors ne marquez pas encore le second. <br><br>  <b>Nous commen√ßons l'installation.</b> <br><br><h2>  Apr√®s l'installation </h2><br>  Ainsi, le syst√®me fra√Æchement install√© a finalement d√©marr√©.  La premi√®re chose √† v√©rifier est Internet. <br><br><pre><code class="bash hljs">ping ya.ru</code> </pre> <br>  Y a-t-il une r√©ponse?  - Tr√®s bien, appuyez sur Ctrl-C. <br>  Sinon, allez configurer le r√©seau, il n'y a pas de vie sans √ßa, mais mon article ne parle pas de √ßa. <br><br>  Maintenant, si nous ne sommes pas d√©j√† sous la racine, nous allons sous la racine, car pour taper <i>tant</i> de commandes avec sudo personnellement, je suis fauch√© (et les administrateurs parano√Øaques me pardonneront): <br><br><pre> <code class="bash hljs">sudo -i</code> </pre> <br>  Maintenant, la premi√®re chose que nous tapons <br><br><pre> <code class="bash hljs">dnf -y update</code> </pre> <br>  Et si vous lisez cet article en 2019, rien ne se passera probablement, mais cela valait la peine d'√™tre essay√©. <br><br><h3>  Configurez maintenant le lecteur restant </h3><br>  Supposons que nous avions une partition xvda avec un syst√®me, alors le disque de donn√©es sera xvdb.  Ok <br><br>  La plupart des astuces commencent par les mots "Lancer fdisk et cr√©er une partition ..." <br><br>  Ce <i>n'est donc pas vrai</i> ! <br><br>  Je vais r√©p√©ter la cr√™pe, car c'est important!  Dans ce cas, travailler avec LVM, qui occupe un tout, laisser un disque virtuel cr√©er des partitions dessus est dangereux!  Chaque mot est important dans cette phrase.  Si nous travaillons sans LVM - c'est n√©cessaire.  Si nous disons sur le syst√®me de disque et les donn√©es - c'est n√©cessaire.  Si pour une raison quelconque, nous devons laisser la moiti√© du disque vide - √©galement n√©cessaire.  Mais g√©n√©ralement, toutes ces hypoth√®ses sont purement th√©oriques.  Parce que si nous d√©cidons d'ajouter des emplacements √† la section existante, la fa√ßon la plus simple de le faire est avec cette configuration.  Et la facilit√© d'administration l'emporte tellement que nous nous dirigeons d√©lib√©r√©ment vers cette configuration. <br><br>  Et la commodit√© est que si vous souhaitez d√©velopper la section de donn√©es, vous ajoutez simplement de l'espace √† la section virtuelle, puis d√©veloppez le groupe avec vgextend et c'est tout!  Dans de rares cas, quelque chose d'autre peut √™tre requis, mais au moins vous n'avez pas √† √©tendre au d√©but celui logique, ce qui est d√©j√† bien.  Et puis, pour √©tendre ce volume lui-m√™me, il est recommand√© de supprimer celui existant au d√©but, puis d'en cr√©er un nouveau en haut ... Ce qui n'est pas tr√®s joli et ne peut pas √™tre fait en direct, et l'expansion selon le sc√©nario que j'ai sp√©cifi√© peut √™tre effectu√©e √† la vol√©e sans m√™me d√©monter la partition. <br><br>  Au total, nous cr√©ons un volume physique, puis un groupe de volumes, y compris celui-ci puis une section pour notre serveur: <br><br><pre> <code class="bash hljs">pvcreate /dev/xvdb vgcreate data /dev/xvdb lvcreate -n www -L40G data mke2fs -t ext4 /dev/mapper/data-www</code> </pre><br>  Ici, au lieu de la lettre majuscule "L" (et de la taille en Go), vous pouvez en sp√©cifier une petite puis indiquer la taille relative au lieu de la taille absolue, par exemple, pour utiliser la moiti√© de l'espace actuellement disponible dans le groupe de volumes, vous devez sp√©cifier "-l + 50% FREE" <br><br>  Et la derni√®re commande formate la partition dans le syst√®me de fichiers ext4 (qui jusqu'√† pr√©sent, dans ma pratique, montre la plus grande stabilit√© au cas o√π tout casse, donc je le pr√©f√®re). <br><br>  Montez maintenant la partition au bon endroit.  Pour ce faire, ajoutez la ligne correcte √† / etc / fstab: <br><br><pre> <code class="bash hljs">/dev/mapper/data-www /var/www ext4 defaults 1 2</code> </pre> <br>  Et on tape <br><br><pre> <code class="bash hljs">mount /var/www</code> </pre> <br>  Si une erreur appara√Æt - nous sonnons l'alarme!  Parce que cela signifie que nous avons une erreur dans / etc / fstab.  Et qu'au prochain red√©marrage, nous aurons de tr√®s gros probl√®mes.  Le syst√®me peut ne pas d√©marrer du tout, ce qui est souvent tr√®s triste pour les services cloud.  Par cons√©quent, vous devez soit corriger d'urgence la derni√®re ligne ajout√©e, soit la supprimer compl√®tement!  C'est pourquoi nous n'avons pas commenc√© √† √©crire la commande de montage manuellement - alors nous n'aurions pas eu une excellente occasion de v√©rifier la configuration des appareils directs. <br><br>  Maintenant, nous mettons en fait tout ce que nous voulions et ouvrons les ports sous le Web: <br><br><pre> <code class="bash hljs">dnf groupinstall <span class="hljs-string"><span class="hljs-string">"Development Tools"</span></span> dnf -y install httpd @nodejs @redis php firewall-cmd --add-service http --permanent firewall-cmd --add-service https --permanent</code> </pre><br>  En option, vous pouvez √©galement mettre la base de donn√©es ici, mais personnellement, j'essaie de la garder s√©par√©e du serveur Web.  Bien que la garder proche soit plus rapide, oui.  La vitesse des adaptateurs r√©seau virtuels est g√©n√©ralement de l'ordre du gigabit et lorsque vous travaillez sur la m√™me machine, l'acc√®s se produit presque instantan√©ment.  Mais moins s√ªr.  Ici pour qui est le plus important. <br><br>  Ajoutez maintenant le param√®tre au fichier de configuration (cr√©ez une nouvelle id√©ologie CentOS moderne comme celle-ci) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"vm.overcommit_memory = 1"</span></span>&gt; /etc/sysctl.d/98-sysctl.conf</code> </pre> <br>  Red√©marrez le serveur. <br>  Dans les commentaires, j'ai √©t√© r√©primand√© pour vous avoir conseill√© de d√©sactiver SeLinux, donc je vais le r√©parer et √©crire sur le fait qu'apr√®s cela, vous devez vous rappeler de configurer SeLinux. <br>  <b>En fait, faites du profit!</b>  <b>:)</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469097/">https://habr.com/ru/post/fr469097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469079/index.html">Python dans Visual Studio Code: mise √† jour de l'extension de septembre</a></li>
<li><a href="../fr469085/index.html">Nous retirons le logiciel du microcontr√¥leur prot√©g√© par mot de passe Renesas M16C</a></li>
<li><a href="../fr469087/index.html">MVCC dans PostgreSQL-2. Fourches, limes, pages</a></li>
<li><a href="../fr469093/index.html">Comparaison de biblioth√®ques CLI moins populaires et peu utilis√©es: falaise, plac, plumbum et autres (partie 2)</a></li>
<li><a href="../fr469095/index.html">Mises √† jour de ML.NET et de Model Builder publi√©es: Quoi de neuf</a></li>
<li><a href="../fr469099/index.html">Tester les t√¢ches lors de l'entretien avec le d√©veloppeur - est-ce que cela a du sens?</a></li>
<li><a href="../fr469101/index.html">Apprendre l'anglais: comment apprendre √† parler en tant que locuteur natif</a></li>
<li><a href="../fr469109/index.html">Jouets en bois, troisi√®me partie - 1989</a></li>
<li><a href="../fr469111/index.html">Remplacer l'objet par var: qu'est-ce qui pourrait mal tourner?</a></li>
<li><a href="../fr469115/index.html">Guide Discovery.js: D√©marrage rapide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>