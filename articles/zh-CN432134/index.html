<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👦 🔅 🌚 Unity3D中基于声音和音乐的环境生成。 第2部分。从音乐创建2D轨道 🧑🏻‍🤝‍🧑🏻 🏕️ 🚴🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="注解 


 大家好 相对最近，我写了一篇文章，在Unity3D中基于声音和音乐生成环境 ，其中给出了一些游戏示例，这些示例使用了基于音乐生成内容的机制，还谈到了此类游戏的基本方面。 文章中几乎没有代码，我保证会有续集。 在这里，就在您的面前。 这次，我们将尝试根据您的音乐，以Hill Climb的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity3D中基于声音和音乐的环境生成。 第2部分。从音乐创建2D轨道</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya"> 注解 </h2><br><p> 大家好 相对最近，我写了一篇文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，在Unity3D中基于声音和音乐生成环境</a> ，其中给出了一些游戏示例，这些示例使用了基于音乐生成内容的机制，还谈到了此类游戏的基本方面。 文章中几乎没有代码，我保证会有续集。 在这里，就在您的面前。 这次，我们将尝试根据您的音乐，以Hill Climb的风格创建2D竞赛的音轨。 让我们看看我们得到了.. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie"> 引言 </h2><br><p> 我提醒您，本系列文章是为初学者和刚开始使用声音的开发人员设计的。 如果您在脑海中进行快速的傅立叶变换，那么您可能会感到无聊。 </p><br><p> 这是我们今天的路线图： </p><br><ol><li> 考虑什么是离散化。 </li><li> 找出我们可以从Audio Clip Unity获得的数据 </li><li> 了解如何处理这些数据。 </li><li> 找出我们可以从这些数据中生成什么。 </li><li> 了解如何利用所有这些（或者类似游戏的东西）制作游戏 </li></ol><br><p> 所以走吧！ </p><br><h2 id="diskretizaciya-analogovogo-singala"> 模拟僧伽罗语的离散化 </h2><br><p> 众所周知，为了在数字系统中使用信号，我们需要对其进行转换。 转换步骤之一是对信号进行采样，其中将模拟信号分为多个部分（临时报告），然后为每个报告分配选定时刻的振幅值。 <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p> 字母T表示采样周期。 周期越短，信号转换将越准确。 但大多数情况下，他们谈论的是相反的情况：采样率（这是F = 1 / T是合乎逻辑的）。  8,000 Hz足以用于电话信号，例如，DVD音频格式的选项之一需要192,000 Hz的采样频率。 数字录音（在游戏编辑器，音乐编辑器中）的标准是44 100 Hz-这是CD音频的频率。 </p><br><p> 振幅的数值存储在所谓的样本中，我们将与它们一起工作。 样本的值是float，可以是-1到1。经过简化，看起来像这样。 </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno"> 声波渲染（静态） </h2><br><h3 id="bazovaya-informaciya"> 基本资料 </h3><br><p> 波形（或音频形式，在普通人中为“鱼”）是声音信号随时间变化的视觉表示。 该波形可以向我们显示声音在哪个点上发生了有源相位，以及在哪里衰减。 通常，每个通道的波形分别显示，例如： </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p> 想象一下，我们已经有了一个AudioSource和一个可以在其中工作的脚本。 让我们看看Unity可以给我们带来什么。 </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov"> 选择报告数 </h3><br><p> 在继续之前，我们需要谈谈声音的渲染深度。 以每秒44100 Hz的采样频率，我们能够处理44100个报告。 假设我们需要渲染10秒长的轨道。 我们将用像素宽度的线条绘制每个报告。 事实证明，我们的波形长为441,000像素。 您会得到一个很长，很细且几乎无法理解的声波。 但是，您可以在其中看到每个特定的报告！ 无论您如何绘制，都将极大地加载系统。 </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p> 如果您不制作专业音频软件，则不需要这种准确性。 对于一般的音频图片，我们可以将所有采样分成更大的周期，例如，取每100个采样的平均值。 然后我们的wave将具有非常独特的形式： </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p> 当然，这并不是完全准确的，因为您可以跳过可能需要的体积峰值，因此您可以尝试的不是平均值，而是该分段的最大值。 这将产生稍微不同的图像，但是您的峰值不会消失。 </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh"> 准备接收音频 </h3><br><p> 让我们将样本的准确性定义为质量，将最终报告的数目定义为sampleCount。 </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p> 下面是计算所有数字的示例。 </p><br><p> 接下来，我们需要自己获取样本。 可以使用<strong>GetData</strong>方法从音频剪辑中完成此操作。 </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p> 此方法将一个数组写入示例。  offsetSamples-负责读取数据数组的起点的参数。 如果从头开始读取数组，则应该为零。 </p><br><p> 要记录样本，我们需要为它们准备一个数组。 例如，像这样： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p> 为什么我们将长度乘以通道数？ 现在我告诉... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Unity音频频道信息 </h3><br><p> 许多人都知道，在声音上，我们通常使用两个声道：左声道和右声道。 有人知道有2.1系统以及5.1和7.1，其中声源从四面八方环绕。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wiki上对</a>频道的主题进行了很好的描述。 这在Unity中如何工作？ </p><br><p> 下载文件时，打开剪辑时，您可以找到以下图像： </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p> 此处仅显示了我们有两个渠道，您甚至可以注意到它们彼此不同。  Unity依次记录这些通道的样本。 原来这张图： <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>L</mi><mn>1</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>1</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>2</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>2</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>3</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>3</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>4</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>4</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>5</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>5</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>6</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>6</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>7</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>7</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>L</mi><mn>8</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.954ex" height="2.66ex" viewBox="0 -832 33132.8 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-31" x="963" y="-213"></use></g><g transform="translate(1413,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(2243,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-31" x="1074" y="-213"></use></g><g transform="translate(3457,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(4287,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-32" x="963" y="-213"></use></g><g transform="translate(5422,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(6252,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-32" x="1074" y="-213"></use></g><g transform="translate(7466,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(8296,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-33" x="963" y="-213"></use></g><g transform="translate(9431,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(10261,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-33" x="1074" y="-213"></use></g><g transform="translate(11474,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(12304,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-34" x="963" y="-213"></use></g><g transform="translate(13440,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(14270,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-34" x="1074" y="-213"></use></g><g transform="translate(15483,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(16313,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-35" x="963" y="-213"></use></g><g transform="translate(17449,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(18279,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-35" x="1074" y="-213"></use></g><g transform="translate(19492,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(20322,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-36" x="963" y="-213"></use></g><g transform="translate(21457,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(22287,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-36" x="1074" y="-213"></use></g><g transform="translate(23501,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(24331,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-37" x="963" y="-213"></use></g><g transform="translate(25466,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(26296,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-37" x="1074" y="-213"></use></g><g transform="translate(27509,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(28339,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-38" x="963" y="-213"></use></g><g transform="translate(29475,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(30305,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-38" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-2E" x="31518" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-2E" x="31963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-2E" x="32409" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgYnMQgdSpcPdJA0CYsXpv-6X-m8A#MJMAIN-5D" x="32854" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>L</mi><mn>1</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>1</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>2</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>2</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>3</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>3</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>4</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>4</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>5</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>5</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>6</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>6</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>7</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>7</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>L</mi><mn>8</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> [L_1，R_1，L_2，R_2，L_3，R_3，L_4，R_4，L_5，R_5，L_6，R_6，L_7，R_7，L_8，R_8 ...] </script></p><br><p> 这就是为什么我们在数组中需要的空间比仅是样本数大两倍的原因。 </p><br><p> 如果选择“强制到单声道”剪辑选项，则声道将为一个，所有声音将位于中央。 您的wave的预览将立即更改。 </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh"> 接收音频数据 </h3><br><p> 这是我们得到的： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p> 总计，如果音轨走了10秒并且是两个通道，那么我们得到以下信息： </p><br><ul><li> 剪辑中的样本数（myAudio.clip.sample）= 44100 * 10 = 441000 </li><li> 两个通道的样本数组很长（samples.Length）= 441000 * 2 = 882000 </li><li> 报告数量（sampleCount）= 44100/100 = 441 </li><li> 最终数组的长度= samples.Length / sampleCount = 2000 </li></ul><br><p> 结果，我们将使用2000点，这足以吸引我们。 现在，您需要发挥想象力，并考虑如何使用这些数据。 </p><br><h3 id="otrisovka-audioinformacii"> 渲染音频信息 </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv"> 使用调试工具创建简单的音轨 </h4><br><p> 众所周知，Unity具有显示各种Debug信息的便捷方式。 基于这些工具的聪明开发人员可以为编辑器进行非常强大的扩展。 我们的案例显示了Debug方法的非典型用法。 </p><br><p> 为了绘制，我们需要一条线。 我们可以借助将根据数组值创建的向量来完成此操作。 请注意，要制作精美的镜像音频形式，我们需要“粘合”可视化的两个部分。 </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p> 接下来，只需使用Debug.DrawLine绘制矢量即可。 任何颜色都可以选择。 所有这些方法都必须在Update中调用，因此我们将在每一帧更新信息。 </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p> 如果需要，可以添加“滑块”，以显示正在播放的曲目的当前位置。 该信息可以从“ AudioSource.timeSamples”字段获得。 </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p> 总计，这是我们的脚本： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p> 结果如下： </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d"> 使用PolygonCollider2D创建平滑的音景 </h4><br><p> 在继续本节之前，我要注意以下几点：当然，沿着由音乐生成的轨道行驶很有趣，但是从游戏性的角度来看，这实际上是没有用的。 这就是为什么： </p><br><ol><li> 为了使轨道可以通过，我们需要对数据进行平滑处理。 所有的高峰都消失了，您几乎停止了“感觉音乐” </li><li> 通常，音乐曲目是高度压缩的，并且代表一个音砖，不适合2D游戏。 </li><li> 我们的运输速度尚未解决的问题，应该适合于轨道的速度。 我想在下一篇文章中考虑这个问题。 </li></ol><br><p> 因此，作为实验，这种类型的生成非常有趣，但是很难基于此生成真实的游戏功能。 无论如何，我们继续。 </p><br><p> 因此，我们需要使用我们的数据制作PolygonCollider2D。 这很容易做到。  PolygonCollider2D有一个接受Vector2 []的公共点字段。 首先，我们需要将点转移到所需类型的向量上。 让我们做一个函数，将样本数组转换为向量数组： </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> 之后，只需将我们得到的向量数组传递给对撞机： </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p> 我们看一下结果。 这是我们旅程的开始……嗯……看起来不太顺利（暂时不要考虑可视化，以后再发表评论）。 </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p> 我们的音频形式过于清晰，因此音轨显得很奇怪。 需要使其平滑。 在这里，我们使用移动平均算法。 您可以在文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">《移动平均算法（简单移动平均）》中</a>了解有关Habr的更多信息。 </p><br><p> 在Unity中，该算法的实现方式如下： </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p> 我们修改路径创建： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p> 正在检查... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p> 现在我们的轨迹看起来很正常。 我使用的窗口宽度为10。您可以修改此参数以选择所需的平滑度。 </p><br><p> 这是此部分的完整脚本： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p> 正如我在本节开头所说的那样，通过这种平滑处理，我​​们不再感觉到音轨，此外，机器的速度与音乐速度（BPM）无关。 我们将在本系列文章的下一部分中分析此问题。 此外，我们将在此讨论特殊主题。 节拍下的效果。 顺便说一句，我从这笔<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">免费资产中</a>拿了一台打字机。 </p><br><p> 也许很多人在看屏幕截图时都想知道我是如何绘制曲目的？ 毕竟，对撞机是不可见的。 </p><br><p> 我利用Internet的智慧，找到了一种方法，可以将多边形对撞机变成可以分配任何材质的网格，并且线条渲染器将绘制出时尚的轮廓。 此方法在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>详细介绍。 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Unity Community</a>上使用Triangulator。 </p><br><h2 id="zavershenie"> 完成时间 </h2><br><p> 我们从本文中学到的内容是音乐游戏的基本草图。 是的，到目前为止，这种形式有点难看，但是您可以放心地说：“伙计们，我让机器沿着音轨走了！”。 为了使它成为一个真正的游戏，您需要付出很多努力。 以下是我们可以在此处执行的操作的列表： </p><br><ol><li> 将机器的速度绑定到BPM轨道。 播放器只能控制汽车的倾斜度，而不能控制速度。 然后在整个过程中，音乐会变得更加强烈。 </li><li> 做一个位检测器，并添加特价。 在节拍下将起作用的效果。 此外，您可以向汽车车身添加动画，动画将随着拍子的跳动而反弹。 这完全取决于您的想象力。 </li><li> 而不是移动平均线，您需要更熟练地处理轨迹并获取数据数组，以使峰不会消失，但是创建轨迹很容易。 </li><li> 好吧，当然，您需要使游戏玩法有趣。 您可以在每次击中放置硬币位，添加危险区域等。 </li></ol><br><p> 我们将在本系列文章的其余部分中研究所有这些以及更多内容。 谢谢大家的阅读！ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432134/">https://habr.com/ru/post/zh-CN432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432120/index.html">联想将因安装Superfish恶意软件向笔记本电脑所有者支付830万美元赔偿</a></li>
<li><a href="../zh-CN432122/index.html">LLDB中的Xcode和高级调试：第2部分</a></li>
<li><a href="../zh-CN432128/index.html">拐杖，纳尼亚语，忍者之旅：初创企业的三个蒂姆利德痛苦</a></li>
<li><a href="../zh-CN432130/index.html">在Tutu.ru办公室进行移动开发的秋季技巧</a></li>
<li><a href="../zh-CN432132/index.html">莎士比亚（William Shakespeare）：将十四行诗翻译成俄语很困难</a></li>
<li><a href="../zh-CN432136/index.html">冷却数据中心中的CPU-3D激光打印将有帮助</a></li>
<li><a href="../zh-CN432138/index.html">让我们谈谈指标，作为评估程序员工作的一种方式</a></li>
<li><a href="../zh-CN432142/index.html">蜂箱监控和开放项目</a></li>
<li><a href="../zh-CN432144/index.html">我们如何通过1C在欧洲的SAP商店与在俄罗斯的收银台进行集成</a></li>
<li><a href="../zh-CN432146/index.html">Zimbra协作套件可作为Microsoft Exchange的有价值的替代品</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>