<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÑ üëçüèæ üë©üèæ‚Äçüéì Multifunktionaler DIY Logger. Teil 1 üì• üë®üèª‚Äçüé® üö≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich bin der Besitzer eines wunderbaren Ger√§ts - GPS-Logger Holux M-241. Das Ding ist sehr praktisch und n√ºtzlich auf Reisen. Mit Hilfe eines Loggers s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Multifunktionaler DIY Logger. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401899/"><img src="https://habrastorage.org/getpro/geektimes/post_images/65a/f4c/1c8/65af4c1c8bd4dd394b6a6d2939c6d211.jpg" alt="Bild"><br><br>  Ich bin der Besitzer eines wunderbaren Ger√§ts - GPS-Logger Holux M-241.  Das Ding ist sehr praktisch und n√ºtzlich auf Reisen.  Mit Hilfe eines Loggers schreibe ich einen GPS-Track einer Reise, auf dem Sie sich dann detailliert zurechtfinden und die aufgenommenen Fotos an GPS-Koordinaten anh√§ngen k√∂nnen.  Er hat auch einen kleinen Bildschirm, auf dem zus√§tzliche Informationen angezeigt werden - Stunden, aktuelle Geschwindigkeit, H√∂he und Richtung, Kilometerz√§hler und vieles mehr.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier habe</a> ich mal eine kurze Rezension geschrieben. <br><br>  Mit all den Vorteilen eines St√ºcks Eisen begann ich daraus zu wachsen.  Ich vermisse ein paar kleine, aber n√ºtzliche Extras: ein paar Kilometerz√§hler, die die vertikale Geschwindigkeit anzeigen und die Parameter eines Streckenabschnitts messen.  Es scheint wie kleine Dinge, aber die Firma Holux fand dies nicht n√ºtzlich genug f√ºr die Implementierung in die Firmware.  Au√üerdem mag ich einige Parameter der Hardware nicht und einige Dinge sind in 10 Jahren veraltet ... <br><br>  Irgendwann wurde mir klar, dass ich selbst einen Logger mit den Funktionen erstellen kann, die ich ben√∂tige.  Gl√ºcklicherweise sind alle notwendigen Komponenten recht billig und erschwinglich.  Ich begann meine Implementierung basierend auf Arduino zu machen.  Unter dem Schnitt ein Bautagebuch, in dem ich versuchte, meine technischen L√∂sungen zu malen. <br><a name="habracut"></a><br><h1>  Funktionen definieren </h1><br>  Viele werden sich fragen, warum ich meinen eigenen Logger bauen muss, wenn sicher etwas f√ºr namhafte Hersteller bereit ist.  M√∂glicherweise.  Um ehrlich zu sein, habe ich nicht wirklich danach gesucht.  Aber sicher wird etwas fehlen.  In jedem Fall ist dieses Projekt ein Fan f√ºr mich.  Warum bauen wir nicht unser Traumger√§t? <br><br>  Also, f√ºr das, was ich an meinem Holux M-241 sch√§tze. <br><br><ul><li>  <b>Der Bildschirm</b> bildet eine ‚ÄûBlack Box‚Äú, deren Ergebnisse erst nach der Reise verf√ºgbar sind. Dies ist ein sehr praktisches Tool, dessen Messwerte hier und jetzt verf√ºgbar sind.  Ein Bildschirm erm√∂glicht fast alle Funktionen dieser Liste. </li><li>  <b>Eine Uhr</b> ist an sich n√ºtzlich.  Auf GPS-Reisen ist der Logger, der an einer Schnur um den Hals baumelt, oft n√§her als ein Handy in der Tasche oder im Rucksack.  Die Uhr unterst√ºtzt alle Zeitzonen (allerdings mit manueller Umschaltung) </li><li>  <b>Mit der POI-Schaltfl√§che</b> k√∂nnen Sie die aktuelle Koordinate auf der Spur markieren.  Zum Beispiel, um eine Landmarke zu notieren, die aus dem Fenster des Busses gerutscht ist und √ºber die ich sp√§ter googeln m√∂chte. </li><li>  Mit dem <b>Kilometerz√§hler k√∂nnen</b> Sie die zur√ºckgelegte Strecke von einem bestimmten Punkt aus messen.  Zum Beispiel die pro Tag zur√ºckgelegte Strecke oder die L√§nge einer Strecke. </li><li>  <b>Aktuelle Geschwindigkeit, H√∂he und Richtung</b> helfen Ihnen, sich im Weltraum zu befinden </li><li>  <b>Die √úberlebensf√§higkeit von 12 bis 14 Stunden mit</b> einer AA-Batterie erm√∂glicht es Ihnen in den meisten F√§llen, nicht √ºber Probleme bei der Stromversorgung nachzudenken.  Das hei√üt,  Fast immer genug Geb√ºhr f√ºr einen ganzen Reisetag. </li><li>  <b>Kompakt und einfach zu bedienen</b> - die Dinge in der modernen Welt sind sehr sch√∂n </li></ul><br>  Einige Dinge k√∂nnten jedoch etwas besser gemacht werden: <br><br><ul><li>  Das Stromversorgungssystem f√ºr <b>AA-Batterien wird</b> von vielen als eindeutiges Plus bezeichnet - eine Batterie h√§lt lange und Sie k√∂nnen die Versorgung in jeder Wildnis wieder auff√ºllen.  Sie k√∂nnen sich f√ºr mindestens einen Monat autonomes Campen eindecken. <br><br>  Aber f√ºr mich ist die Akkulaufzeit reine H√§morrhoiden.  Sie m√ºssen eine Handvoll Batterien mit sich f√ºhren und wer wei√ü, wie hochwertig sie sind (pl√∂tzlich lagen sie 5 Jahre lang auf einem Regal und waren bereits selbstentladen).  Mit Batterien ist die Blutung noch gr√∂√üer.  Mein Ladeger√§t kann nur paarweise aufgeladen werden.  Wir m√ºssen die Batterien entladen, damit sie den gleichen Entladungsgrad haben.  Infolgedessen erinnern Sie sich nie daran, wo bereits entladen wurde und wo noch nicht. <br><br>  W√§hrend 6 Jahren mit dem Logger bin ich nur mitten im Nirgendwo ohne Strom gelandet.  In der Regel bekomme ich mindestens einmal am Tag Zugang zur Steckdose.  In diesem Fall w√§re die eingebaute Lithiumbatterie viel praktischer.  In extremen F√§llen habe ich eine Paverbank. <br><br></li><li>  <b>Die Anzeige des Entladungsgrades</b> erfolgt sehr dumm - die Anzeige beginnt zu blinken, wenn der Akku entladen wird.  Dar√ºber hinaus kann es in 5 Minuten sterben und vielleicht eine weitere Stunde arbeiten.  Es ist sehr leicht, diesen Moment zu verpassen und einen Teil des Protokolls zu verlieren. <br><br></li><li>  Als Luftfahrtinteressierte w√§re es f√ºr mich sehr interessant, die <b>aktuelle Vertikalgeschwindigkeit</b> zu beobachten. <br><br></li><li>  <b>Ein paar Kilometerz√§hler</b> - es ist oft interessant, mehr als eine Strecke zu messen.  Zum Beispiel die pro Tag und f√ºr die gesamte Reise zur√ºckgelegte Strecke. <br><br></li><li>  Der Kilometerz√§hler wird zur√ºckgesetzt, wenn Sie das Ger√§t ausschalten oder den Akku austauschen.  Das ist furchtbar unangenehm.  Wenn Sie in einem Caf√© eine Mahlzeit eingenommen haben, kann der GPS-Logger nicht ausgeschaltet werden, da der Wert zur√ºckgesetzt wird.  Er muss es eingeschaltet lassen und f√§hrt weiter Kilometer und frisst die Batterie.  Es w√§re viel bequemer, den Kilometerz√§hler <b>anzuhalten</b> und <b>die Werte</b> zwischen den Einschl√ºssen zu <b>speichern</b> . <br><br></li><li>  <b>Messung von Standortparametern</b> .  Beim Skifahren interessiert mich zum Beispiel die L√§nge der Abfahrt, die H√∂he, die Durchschnitts- und H√∂chstgeschwindigkeit auf der Baustelle und die aufgewendete Zeit.  Was Sie wissen m√∂chten, ist sofort und nicht zu Hause, wenn Sie den Titel herunterladen. <br><br></li><li>  <b>Die Genauigkeit</b> ist schlecht.  Wenn Sie sich schnell bewegen - sonst nichts.  Wenn die Geschwindigkeit auf der Strecke jedoch gering ist, sind ‚ÄûGer√§usche‚Äú + - 50 m deutlich sichtbar.  Und f√ºr eine Stunde Stehen k√∂nnen Sie fast einen Kilometer ‚Äûbestehen‚Äú.  Der Nutzen der Technologie seit 10 Jahren ist weit fortgeschritten und moderne Empf√§nger bieten eine viel gr√∂√üere Genauigkeit. <br><br></li><li>  <b>Die Geschwindigkeit beim Zusammenf√ºhren von</b> Tracks betr√§gt nur 38.400. Nein, es ist 2017 nicht ernst, den COM-Port zum √úbertragen gro√üer Datenmengen zu verwenden.  Das Zusammenf√ºhren von 2 Megabyte internem Flash dauert mehr als 20 Minuten. <br><br>  Dar√ºber hinaus kann nicht jedes Programm das Format zusammengef√ºhrter Spuren verarbeiten.  Das native Dienstprogramm ist sehr elend.  Gl√ºcklicherweise gibt es BT747, mit dem der Track angemessen zusammengef√ºhrt und in ein verdauliches Format konvertiert werden kann. <br><br></li><li>  <b>Die Gr√∂√üe des Flash-Laufwerks betr√§gt</b> nur 2 MB.  Einerseits reicht dies f√ºr eine zweiw√∂chige Reise mit Sparpunkten alle 5 Sekunden.  Aber zuerst das interne Paketformat <br>  erfordert Konvertierung und erlaubt zweitens nicht, die Lautst√§rke zu erh√∂hen </li><li>  <b>Massenspeicherger√§t ist</b> aus irgendeinem Grund jetzt nicht in Mode.  Moderne Schnittstellen versuchen, das Vorhandensein von Dateien zu verbergen.  Ich bin seit 25 Jahren mit Computern besch√§ftigt und die direkte Arbeit mit Dateien ist f√ºr mich viel bequemer als auf jede andere Weise. </li></ul><br>  Hier gibt es nichts, was ohne nennenswerten Aufwand nicht realisiert werden k√∂nnte. <br><br>  Alles andere.  Ich benutze es nicht selbst, aber pl√∂tzlich ist jemand n√ºtzlich: <br><br><ul><li>  Zeigt die aktuellen Koordinaten (Breite, L√§nge) an. </li><li>  Auf der linken Seite des Bildschirms sind verschiedene Symbole gezeichnet, an deren Essenz ich mich ohne Handbuch nicht erinnern kann. </li><li>  Es gibt Schaltmeter / km - Fu√ü / Meilen. </li><li>  Der Bluetooth-Logger kann ohne GPS mit Mobiltelefonen verbunden werden. </li><li>  Der absolute Abstand zum Punkt. </li><li>  Protokollierung nach Zeit (alle N Sekunden) oder nach Entfernung (alle X Meter). </li><li>  Unterst√ºtzung f√ºr verschiedene Sprachen. </li></ul><br><h1>  W√§hle Eisen </h1><br>  Die Anforderungen sind mehr oder weniger definiert.  Es ist Zeit zu verstehen, wie all dies umgesetzt werden kann.  Die Hauptkomponenten, die ich haben werde, sind: <br><br><ul><li>  <b>Mikrocontroller</b> - Ich habe keine Pl√§ne f√ºr ausgefeilte Rechenalgorithmen, daher ist die Verarbeitungsleistung des Kernels nicht besonders wichtig.  Ich habe auch keine besonderen Anforderungen an die Bef√ºllung - ein Satz Standardperipherieger√§te reicht aus. <br><br>  Zur Hand war nur eine Streuung verschiedener Arduinoes sowie ein paar stm32f103c8t6.  Ich habe mich f√ºr AVR entschieden, das ich auf der Ebene der Controller / Register / Peripherieger√§te gut kenne.  Wenn ich auf Einschr√§nkungen sto√üe, gibt es einen Grund, den STM32 zu sp√ºren. <br><br></li><li>  <b>Der GPS-Empf√§nger wurde</b> aus den Modulen NEO6MV2, Beitan BN-800 und Beitan BN-880 ausgew√§hlt.  Seit einiger Zeit gegoogelte Foren.  Erfahrene Leute sagten, dass der erste Empf√§nger das letzte Jahrhundert ist.  Die beiden anderen unterscheiden sich nur in der Position der Antenne - beim BN-800 h√§ngt sie am Draht und beim BN-880 wird sie mit einem Sandwich auf das Hauptmodul geklebt.  Nahm einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BN-880</a> . <br><br></li><li>  <b>Bildschirm</b> - Das Original verwendet ein 128 x 32 LCD mit Hintergrundbeleuchtung.  Ich habe nicht genau das gleiche gefunden.  Ich habe eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OLED 0,91 Zoll auf dem SSD1306-Controller</a> und einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1,2-Zoll-LCD-Bildschirm auf dem ST7565R-Controller gekauft</a> .  Ich habe mich entschlossen, von vorne zu beginnen, weil  Es ist einfacher, eine Verbindung mit einem Standardkamm gem√§√ü I2C oder SPI herzustellen.  Es ist jedoch im Vergleich zum Original etwas kleiner und funktioniert auch aus Gr√ºnden der Kraftstoffeffizienz nicht, um das Bild st√§ndig anzuzeigen.  Das zweite Display sollte weniger gefr√§√üig sein, aber Sie m√ºssen einen kniffligen Stecker daf√ºr l√∂ten und herausfinden, wie die Hintergrundbeleuchtung mit Strom versorgt wird. </li></ul><br>  Von den kleinen Dingen: <br><br><ul><li>  Kn√∂pfe kauften einmal eine ganze Tasche; </li><li>  Schild mit f√ºr SD-Karte - auch zur Hand herumliegen; </li><li>  Ich habe ein Paar verschiedene Laderegler f√ºr Lithiumbatterien gekauft, aber ich habe es immer noch nicht verstanden. </li></ul><br>  Ich habe beschlossen, das Board ganz am Ende zu entwerfen, wenn die Firmware fertig ist.  Zu diesem Zeitpunkt werde ich endlich √ºber die Hauptkomponenten und das Schema f√ºr ihre Aufnahme entscheiden.  In der ersten Phase entschied ich mich f√ºr das Debuggen auf dem Steckbrett, indem ich die Komponenten mit Patchkabeln verband. <br><br>  Aber zuerst m√ºssen Sie sich f√ºr ein sehr wichtiges Thema entscheiden - die Ern√§hrung der Komponenten.  Es schien mir vern√ºnftig, alles von 3,3 V: GPS und dem Bildschirm nur darauf zu betreiben und zu wissen, wie man arbeitet.  Dies ist auch die native Spannung f√ºr USB und SD.  Zus√§tzlich kann die Schaltung mit einer Lithiumdose betrieben werden. <br><br>  Die Wahl fiel auf den Arduino Pro Mini, der in der 8MHz / 3.3V-Version zu finden ist.  Aber sie hatte kein USB an Bord - ich musste einen USB-UART-Adapter verwenden. <br><br><h1>  Erste Schritte </h1><br>  Urspr√ºnglich wurde das Projekt in Arduino IDE erstellt.  Aber um ehrlich zu sein, meine Sprache traut sich nicht, es als IDE zu bezeichnen - wie ein Texteditor mit einem Compiler.  Auf jeden Fall kann ich nach Visual Studio, in dem ich seit 13 Jahren arbeite, in der Arduino IDE nichts Ernstes ohne Tr√§nen und Matyuk tun. <br><br>  Zum Gl√ºck gibt es ein kostenloses Atmel Studio, in das sogar Visual Assist sofort integriert ist !!!  Das Programm wei√ü alles, was ben√∂tigt wird, alles ist vertraut und an seinem Platz.  Nun, fast alles (ich habe nicht gefunden, wie man nur eine Datei kompiliert, um beispielsweise die Syntax zu √ºberpr√ºfen) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/bfc/b08/98f/bfcb0898f136628896be3b6769eda34f.png" alt="Bild"><br><br>  Vom Bildschirm aus gestartet - Dies ist erforderlich, um das Skelett der Firmware zu debuggen und es dann mit Funktionen zu f√ºllen.  Er blieb bei der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten verf√ºgbaren Bibliothek f√ºr Adafruit SSD1306 stehen</a> .  Sie wei√ü alles, was ben√∂tigt wird und bietet eine sehr einfache Oberfl√§che. <br><br>  Spielte mit Schriftarten.  Es stellte sich heraus, dass eine Schriftart bis zu 8 KB gro√ü sein kann (die Gr√∂√üe der Buchstaben betr√§gt 24pt) - in einem 32-KB-Controller kann man nicht besonders herumlaufen.  Zum Anzeigen der Zeit werden beispielsweise gro√üe Schriftarten ben√∂tigt. <br><br><div class="spoiler">  <b class="spoiler_title">Beispielcode f√ºr Schriftarten</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Adafruit_GFX.h&gt; #include &lt;Adafruit_SSD1306.h&gt; #include &lt;gfxfont.h&gt; #include &lt;fonts/FreeMono12pt7b.h&gt; #include &lt;fonts/FreeMono18pt7b.h&gt; ... #include &lt;fonts/FreeSerifItalic24pt7b.h&gt; #include &lt;fonts/FreeSerifItalic9pt7b.h&gt; #include &lt;fonts/TomThumb.h&gt; struct font_and_name { const char * PROGMEM name; GFXfont * font; }; #define FONT(name) {#name, &amp;name} const font_and_name fonts[] = { // FONT(FreeMono12pt7b), FONT(FreeMono18pt7b), /* FONT(FreeMono24pt7b), FONT(FreeMono9pt7b), FONT(FreeMonoBold12pt7b), ... FONT(FreeSerifItalic9pt7b), FONT(TomThumb)*/ }; const unsigned int fonts_count = sizeof(fonts) / sizeof(font_and_name); unsigned int current_font = 0; extern Adafruit_SSD1306 display; void RunFontTest() { display.clearDisplay(); display.setCursor(0,30); display.setFont(fonts[current_font].font); display.print("12:34:56"); display.setCursor(0,6); display.setFont(&amp;TomThumb); display.print(fonts[current_font].name); display.display(); } void SwitchToNextFont() { current_font = ++current_font % fonts_count; }</span></span></span></span></code> </pre> <br></div></div><br>  Schriftarten mit der Bibliothek sind sehr ungeschickt.  Die Monospace-Schrift stellte sich als sehr breit heraus - die Zeile ‚Äû12:34:56‚Äú passt nicht, Serif - alle Zahlen haben unterschiedliche Gewichte.  Es sei denn, die Standardschriftart 5x7 in der Bibliothek sieht essbar aus. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b7a/67f/676/b7a67f676d061bdb4920985b0c46692a.jpg" alt="Bild"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/9de/e19/69f/9dee1969f16ad50138756b9dab906d4d.jpg" alt="Bild"><br><br>  Es stellte sich heraus, dass diese Schriftarten von einigen Open-Source-ttf-Schriftarten konvertiert wurden, die einfach nicht f√ºr kleine Aufl√∂sungen optimiert sind. <br><br>  Ich musste meine Schriften zeichnen.  Genauer gesagt, graben Sie zuerst einzelne Symbole aus den fertigen aus.  Das Symbol ':' in der ASCII-Tabelle ist direkt nach den Zahlen sehr n√ºtzlich und kann in einem Block gekauft werden.  Es ist auch praktisch, dass Sie eine Schriftart nicht f√ºr alle Zeichen erstellen k√∂nnen, sondern nur f√ºr einen Bereich, z. B. von 0x30 ('0') bis 0x3a (':').  T.O.  Bei FreeSans18pt7b stellte sich heraus, dass nur f√ºr die erforderlichen Zeichen eine sehr kompakte Schriftart erstellt wurde.  Richtig, ich musste die Breite leicht anpassen, damit der Text in die Breite des Bildschirms passte. <br><br><div class="spoiler">  <b class="spoiler_title">Unterschrift FreeSans18pt7b</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// This font consists only of digits and ':' to display current time. // The font is very based on FreeSans18pt7b.h //</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> 25 pixel height is too much for displaying time. Create another 22px font const uint8_t TimeFontBitmaps[] PROGMEM = { /* 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE9, 0x20, 0x3F, 0xFC, 0xE3, 0xF1, 0xF8, 0xFC, 0x7E, 0x3F, 0x1F, 0x8E, 0x82, 0x41, 0x00, 0x01, 0xC3, 0x80, ... 0x03, 0x00, 0xC0, 0x60, 0x18, 0x06, 0x03, 0x00, 0xC0, 0x30, 0x18, 0x06, 0x01, 0x80, 0xC0, 0x30, 0x00, */0x07, 0xE0, 0x0F, 0xF8, 0x1F, 0xFC, 0x3C, 0x3C, 0x78, 0x1E, 0x70, 0x0E, 0x70, 0x0E, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x0F, 0x70, 0x0E, 0x70, 0x0E, 0x78, 0x1E, 0x3C, 0x3C, 0x1F, 0xF8, 0x1F, 0xF0, 0x07, 0xE0, 0x03, 0x03, 0x07, 0x0F, 0x3F, 0xFF, 0xFF, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0xE0, 0x1F, 0xF8, 0x3F, 0xFC, 0x7C, 0x3E, 0x70, 0x0F, 0xF0, 0x0F, 0xE0, 0x07, 0xE0, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x0F, 0x00, 0x1E, 0x00, 0x3C, 0x00, 0xF8, 0x03, 0xF0, 0x07, 0xC0, 0x1F, 0x00, 0x3C, 0x00, 0x38, 0x00, 0x70, 0x00, 0x60, 0x00, 0xE0, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x07, 0xF0, 0x07, 0xFE, 0x07, 0xFF, 0x87, 0x83, 0xC3, 0x80, 0xF3, 0x80, 0x39, 0xC0, 0x1C, 0xE0, 0x0E, 0x00, 0x07, 0x00, 0x0F, 0x00, 0x7F, 0x00, 0x3F, 0x00, 0x1F, 0xE0, 0x00, 0x78, 0x00, 0x1E, 0x00, 0x07, 0x00, 0x03, 0xF0, 0x01, 0xF8, 0x00, 0xFE, 0x00, 0x77, 0x00, 0x73, 0xE0, 0xF8, 0xFF, 0xF8, 0x3F, 0xF8, 0x07, 0xF0, 0x00, 0x00, 0x38, 0x00, 0x38, 0x00, 0x78, 0x00, 0xF8, 0x00, 0xF8, 0x01, 0xF8, 0x03, 0xB8, 0x03, 0x38, 0x07, 0x38, 0x0E, 0x38, 0x1C, 0x38, 0x18, 0x38, 0x38, 0x38, 0x70, 0x38, 0x60, 0x38, 0xE0, 0x38, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x1F, 0xFF, 0x0F, 0xFF, 0x8F, 0xFF, 0xC7, 0x00, 0x03, 0x80, 0x01, 0xC0, 0x00, 0xE0, 0x00, 0x70, 0x00, 0x39, 0xF0, 0x3F, 0xFE, 0x1F, 0xFF, 0x8F, 0x83, 0xE7, 0x00, 0xF0, 0x00, 0x3C, 0x00, 0x0E, 0x00, 0x07, 0x00, 0x03, 0x80, 0x01, 0xC0, 0x00, 0xFC, 0x00, 0xEF, 0x00, 0x73, 0xC0, 0xF0, 0xFF, 0xF8, 0x3F, 0xF8, 0x07, 0xE0, 0x00, 0x03, 0xE0, 0x0F, 0xF8, 0x1F, 0xFC, 0x3C, 0x1E, 0x38, 0x0E, 0x70, 0x0E, 0x70, 0x00, 0x60, 0x00, 0xE0, 0x00, 0xE3, 0xE0, 0xEF, 0xF8, 0xFF, 0xFC, 0xFC, 0x3E, 0xF0, 0x0E, 0xF0, 0x0F, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0x60, 0x07, 0x70, 0x0F, 0x70, 0x0E, 0x3C, 0x3E, 0x3F, 0xFC, 0x1F, 0xF8, 0x07, 0xE0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x06, 0x00, 0x0E, 0x00, 0x1C, 0x00, 0x18, 0x00, 0x38, 0x00, 0x70, 0x00, 0x60, 0x00, 0xE0, 0x00, 0xC0, 0x01, 0xC0, 0x01, 0x80, 0x03, 0x80, 0x03, 0x80, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x0E, 0x00, 0x0E, 0x00, 0x0E, 0x00, 0x0C, 0x00, 0x1C, 0x00, 0x1C, 0x00, 0x07, 0xF0, 0x0F, 0xFE, 0x0F, 0xFF, 0x87, 0x83, 0xC7, 0x80, 0xF3, 0x80, 0x39, 0xC0, 0x1C, 0xE0, 0x0E, 0x78, 0x0F, 0x1E, 0x0F, 0x07, 0xFF, 0x01, 0xFF, 0x03, 0xFF, 0xE3, 0xE0, 0xF9, 0xC0, 0x1D, 0xC0, 0x0F, 0xE0, 0x03, 0xF0, 0x01, 0xF8, 0x00, 0xFC, 0x00, 0xF7, 0x00, 0x73, 0xE0, 0xF8, 0xFF, 0xF8, 0x3F, 0xF8, 0x07, 0xF0, 0x00, 0x07, 0xE0, 0x1F, 0xF8, 0x3F, 0xFC, 0x7C, 0x3C, 0x70, 0x0E, 0xF0, 0x0E, 0xE0, 0x06, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x0F, 0x70, 0x0F, 0x78, 0x3F, 0x3F, 0xFF, 0x1F, 0xF7, 0x07, 0xC7, 0x00, 0x07, 0x00, 0x06, 0x00, 0x0E, 0x70, 0x0E, 0x70, 0x1C, 0x78, 0x3C, 0x3F, 0xF8, 0x1F, 0xF0, 0x07, 0xC0, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x80 /*, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xB6, 0xD6, 0x00, 0x00, 0x80, 0x03, 0xC0, 0x07, 0xE0, 0x0F, 0xC0, 0x3F, 0x80, 0x7E, 0x00, 0xFC, 0x01, 0xF0, 0x00, 0xE0, 0x00, ... 0x38, 0x38, 0xF8, 0xF0, 0xE0, 0x38, 0x00, 0xFC, 0x03, 0xFC, 0x1F, 0x3E, 0x3C, 0x1F, 0xE0, 0x1F, 0x80, 0x1E, 0x00 */ }; //TODO Recalc offset numbers const GFXglyph TimeFontGlyphs[] PROGMEM = { { 449-449, 16, 25, 19, 2, -24 }, // 0x30 '0' { 499-449, 8, 25, 19, 4, -24 }, // 0x31 '1' { 524-449, 16, 25, 19, 2, -24 }, // 0x32 '2' { 574-449, 17, 25, 19, 1, -24 }, // 0x33 '3' { 628-449, 16, 25, 19, 1, -24 }, // 0x34 '4' { 678-449, 17, 25, 19, 1, -24 }, // 0x35 '5' { 732-449, 16, 25, 19, 2, -24 }, // 0x36 '6' { 782-449, 16, 25, 19, 2, -24 }, // 0x37 '7' { 832-449, 17, 25, 19, 1, -24 }, // 0x38 '8' { 886-449, 16, 25, 19, 1, -24 }, // 0x39 '9' { 936-449, 3, 19, 7, 2, -20 }, // 0x3A ':' }; const GFXfont TimeFont PROGMEM = { (uint8_t *)TimeFontBitmaps, (GFXglyph *)TimeFontGlyphs, 0x30, 0x3A, 20 };</span></span></code> </pre> </div></div><br>  Es stellte sich heraus, dass die 18pt-Schrift tats√§chlich 25 Pixel hoch ist.  Aus diesem Grund passt er leicht auf eine andere Inschrift <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/543/aee/2e5/543aee2e5c6515307a4c969a3bfff374.jpg" alt="Bild"><br><br>  Die invertierte Anzeige hilft √ºbrigens zu verstehen, wo sich die Grenzen des Zeichenbereichs tats√§chlich befinden und wie die Linie relativ zu diesem Rand liegt - die Anzeige hat sehr gro√üe Rahmen. <br><br>  Googelte lange Zeit fertige Schriftarten, aber sie passten weder in Gr√∂√üe, Form noch Inhalt.  Zum Beispiel im Internet eine 8x12-Schriftwelle (Speicherausz√ºge von VGA-Kartenzeichengeneratoren).  Tats√§chlich sind diese Schriftarten jedoch 6 x 8, d. H.  Viele Weltraumspazierg√§nge - bei einer so geringen Aufl√∂sung und Gr√∂√üe wie meiner ist dies von entscheidender Bedeutung. <br><br>  Ich musste meine eigenen Schriftarten zeichnen, da das Schriftformat der Adafruit-Bibliothek sehr einfach ist.  Ich habe das Bild in Paint.net vorbereitet - ich habe einfach die Buchstaben in der richtigen Schrift gezeichnet und sie dann mit einem Bleistift ein wenig korrigiert.  Ich habe das Bild als PNG gespeichert und es dann schnell an das Python-Skript gesendet, das auf meinem Knie geschrieben ist.  Dieses Skript hat einen halbfertigen Code generiert, der bereits punktweise in der IDE direkt in den Hex-Codes regiert. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/618/78f/f7e/61878ff7eff21be033fdbc56183a4f5e.png" alt="Bild"><br><br>  So sieht beispielsweise der Prozess zum Erstellen einer monospaced Schriftart 8x12 mit kleinem Buchstaben- und Zeilenabstand aus.  Jedes Zeichen am Ende war ungef√§hr 7x10 gro√ü und belegte standardm√§√üig 10 Bytes.  Es w√§re m√∂glich, jedes Zeichen in 8-9 Bytes zu packen (die Bibliothek erlaubt dies), aber ich habe mich nicht darum gek√ºmmert.  Dar√ºber hinaus k√∂nnen Sie in diesem Formular einzelne Pixel direkt im Code bearbeiten. <br><br><div class="spoiler">  <b class="spoiler_title">Schriftart 8x12</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// A simple 8x12 font (slightly modifier Courier New) const uint8_t Monospace8x12Bitmaps[] PROGMEM = { 0x1e, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21, 0x1e, //0 0x18, 0x68, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x7f, //1 0x3e, 0x41, 0x41, 0x01, 0x02, 0x0c, 0x10, 0x20, 0x41, 0x7f, //2 0x3e, 0x41, 0x01, 0x01, 0x0e, 0x02, 0x01, 0x01, 0x41, 0x3e, //3 0x02, 0x06, 0x0a, 0x12, 0x12, 0x22, 0x3f, 0x02, 0x02, 0x0f, //4 0x7f, 0x41, 0x40, 0x40, 0x7e, 0x01, 0x01, 0x01, 0x41, 0x3e, //5 0x1e, 0x21, 0x40, 0x40, 0x5e, 0x61, 0x41, 0x41, 0x41, 0x3e, //6 0x7f, 0x41, 0x01, 0x02, 0x02, 0x04, 0x04, 0x04, 0x08, 0x08, //7 0x1e, 0x21, 0x21, 0x21, 0x1e, 0x21, 0x21, 0x21, 0x21, 0x1e, //8 0x1e, 0x21, 0x21, 0x21, 0x23, 0x1d, 0x01, 0x01, 0x22, 0x1c, //9 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, //: }; const GFXglyph Monospace8x12Glyphs[] PROGMEM = { { 0, 8, 10, 8, 0, -11 }, // 0x30 '0' { 10, 8, 10, 8, 0, -11 }, // 0x31 '1' { 20, 8, 10, 8, 0, -11 }, // 0x32 '2' { 30, 8, 10, 8, 0, -11 }, // 0x33 '3' { 40, 8, 10, 8, 0, -11 }, // 0x34 '4' { 50, 8, 10, 8, 0, -11 }, // 0x35 '5' { 60, 8, 10, 8, 0, -11 }, // 0x36 '6' { 70, 8, 10, 8, 0, -11 }, // 0x37 '7' { 80, 8, 10, 8, 0, -11 }, // 0x38 '8' { 90, 8, 10, 8, 0, -11 }, // 0x39 '9' { 100, 8, 10, 8, 0, -11 }, // 0x3A ':' }; const GFXfont Monospace8x12Font PROGMEM = { (uint8_t *)Monospace8x12Bitmaps, (GFXglyph *)Monospace8x12Glyphs, 0x30, 0x3A, 12 };</span></span></code> </pre><br></div></div><br><h1>  Rahmen </h1><br>  Das Originalger√§t bietet eine sehr einfache und bequeme Oberfl√§che.  Informationen werden in Kategorien gruppiert, die auf einzelnen Seiten (Bildschirmen) angezeigt werden.  Mit der Schaltfl√§che k√∂nnen Sie durch die Seiten bl√§ttern und mit der zweiten Schaltfl√§che das aktuelle Element ausw√§hlen oder die in der Signatur unter der Schaltfl√§che angegebene Aktion ausf√ºhren.  Dieser Ansatz erscheint mir sehr praktisch und es besteht keine Notwendigkeit, etwas zu √§ndern. <br><br>  Ich mag die Sch√∂nheit von OOP, weil ich sofort eine kleine Benutzeroberfl√§che geblendet habe. Jede Seite implementiert die Benutzeroberfl√§che nach Bedarf.  Die Seite kann sich selbst zeichnen und implementiert die Reaktion auf die Schaltfl√§chen. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> {</span></span> Screen * nextScreen; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Screen(); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Screen() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOkButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> PROGMEM </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelButtonText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> PROGMEM </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOkButtonText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span></span>; };</code> </pre> <br>  Schaltfl√§chen k√∂nnen je nach aktuellem Bildschirm verschiedene Aktionen ausf√ºhren.  Daher habe ich den oberen Rand des Bildschirms mit einer H√∂he von 8 Pixel den Beschriftungen f√ºr die Schaltfl√§chen zugewiesen.  Der Text f√ºr die Signaturen h√§ngt vom aktuellen Bildschirm ab und wird von den virtuellen Funktionen getSelButtonText () und getOkButtonText () zur√ºckgegeben.  Auch im Header werden weiterhin Serviceelemente wie GPS-Signalst√§rke und Batterieladung angezeigt.  Die verbleibenden ¬æ Bildschirme stehen f√ºr n√ºtzliche Informationen zur Verf√ºgung. <br><br>  Wie gesagt, die Bildschirme k√∂nnen umgedreht werden, was bedeutet, dass irgendwo eine Liste von Objekten f√ºr verschiedene Seiten vorhanden sein sollte.  An welchen mehr als einem Bildschirm k√∂nnen Sie wie in einem Untermen√º verschachteln.  Ich habe sogar die ScreenManager-Klasse gestartet, die diese Listen verwalten sollte, aber dann fand ich die L√∂sung einfacher. <br><br>  Jeder Bildschirm hat also einfach einen Zeiger auf den n√§chsten.  Wenn Sie auf dem Bildschirm das Untermen√º aufrufen k√∂nnen, wird dem Bildschirm dieses Untermen√ºs ein weiterer Zeiger hinzugef√ºgt <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> {</span></span> Screen * nextScreen; ‚Ä¶ }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentScreen</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Screen { Screen * childScreen; ‚Ä¶ };</code> </pre> <br>  Standardm√§√üig ruft der Schaltfl√§chenhandler einfach die Bildschirm√§nderungsfunktion auf und √ºbergibt ihr den gew√ºnschten Zeiger.  Die Funktion erwies sich als trivial - sie schaltete nur den Zeiger auf den aktuellen Bildschirm.  Um die Verschachtelung der Bildschirme sicherzustellen, habe ich einen kleinen Stapel erstellt.  Der gesamte Bildschirmmanager passt also in 25 Zeilen und 4 kleine Funktionen. <br><br><pre> <code class="cpp hljs">Screen * screenStack[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> screenIdx = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span><span class="hljs-function"> </span></span>{ screenStack[screenIdx] = screen; } <span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> screenStack[screenIdx]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enterChildScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span><span class="hljs-function"> </span></span>{ screenIdx++; <span class="hljs-comment"><span class="hljs-comment">//TODO limit this screenStack[screenIdx] = screen; } void backToParentScreen() { if(screenIdx) screenIdx--; }</span></span></code> </pre> <br>  Der Code zum F√ºllen dieser Strukturen sieht zwar nicht besonders gut aus, wurde aber bisher nicht besser erfunden. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCurrentTimeScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TimeZoneScreen * tzScreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); tzScreen = tzScreen-&gt;addScreen(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>)); tzScreen = tzScreen-&gt;addScreen(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// TODO Add real timezones here CurrentTimeScreen * screen = new CurrentTimeScreen(); screen-&gt;addChildScreen(tzScreen); return screen; }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Der Gedanke</b> <div class="spoiler_text">  Die Strukturierung hat sich nat√ºrlich als sch√∂n herausgestellt, aber ich f√ºrchte, sie frisst viel Ged√§chtnis.  Sie m√ºssen gegen sich selbst gehen und eine gro√üe statische Tabelle mit Zeigern zafigachit. <br></div></div><br>  Mach weiter.  Bei der Implementierung der Schnittstelle wollte ich so etwas wie ein Meldungsfeld erstellen, eine kurze Nachricht, die ein oder zwei Sekunden lang angezeigt und dann ausgeblendet wird.  Wenn Sie beispielsweise die POI-Taste (Point of Interest) auf dem Bildschirm mit den aktuellen Koordinaten dr√ºcken, ist es hilfreich, dem Benutzer zus√§tzlich zum Schreiben des Punkts auf die Spur die Meldung ‚ÄûWegpunkt gespeichert‚Äú anzuzeigen (im Originalger√§t wird nur f√ºr eine Sekunde ein zus√§tzliches Symbol angezeigt).  Wenn der Akku fast leer ist, k√∂nnen Sie den Benutzer mit einer Meldung ‚Äûaufmuntern‚Äú. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/aa5/dec/17b/aa5dec17b1b4b298b764fce33b8441db.jpg" alt="Bild"><br><br>  Da die Daten von GPS st√§ndig eingehen, kann von keinen Sperrfunktionen gesprochen werden.  Daher musste ich eine einfache Zustandsmaschine (Zustandsmaschine) erfinden, die in der Funktion loop () ausw√§hlt, was zu tun ist - den aktuellen Bildschirm oder das aktuelle Meldungsfeld anzeigen. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> State { IDLE_DISPLAY_OFF, IDLE, MESSAGE_BOX, BUTTON_PRESSED, };</code> </pre> <br>  Es ist auch bequem, Tastendr√ºcke mit der Zustandsmaschine zu handhaben.  Vielleicht w√§re es durch Interrupts richtig, aber es hat sich auch als gut herausgestellt.  Das funktioniert so: Wenn eine Taste im IDLE-Status gedr√ºckt wurde, merken Sie sich die Zeit, zu der sie gedr√ºckt wurde, und wechseln Sie in den Status BUTTON_PRESSED.  In diesem Zustand warten wir, bis der Benutzer die Schaltfl√§che losl√§sst.  Hier k√∂nnen wir die Dauer berechnen, zu der die Taste gedr√ºckt wurde.  Kurze Antworten (&lt;30 ms) werden einfach ignoriert - h√∂chstwahrscheinlich handelt es sich um einen Kontaktsprung.  Lange Fahrten k√∂nnen bereits als Tastendruck interpretiert werden. <br><br>  Ich plane, sowohl kurzes Dr√ºcken von Tasten f√ºr normale Aktionen als auch langes (&gt; 1c) f√ºr spezielle Funktionen zu verwenden.  Zum Beispiel startet / pausiert ein kurzes Dr√ºcken den Kilometerz√§hler, ein langes Dr√ºcken setzt den Z√§hler auf 0 zur√ºck. <br><br>  Vielleicht werden andere Staaten hinzugef√ºgt.  So √§ndern sich beispielsweise im urspr√ºnglichen Logger nach dem Umschalten auf die n√§chste Seite die Werte auf dem Bildschirm h√§ufig und nach einigen Sekunden seltener - einmal pro Sekunde.  Dies kann durch Hinzuf√ºgen eines weiteren Status erfolgen. <br><br>  Als der Rahmen fertig war, begann ich bereits, GPS anzuschlie√üen.  Aber hier gab es Nuancen, die mich veranlassten, diese Aufgabe zu verschieben. <br><br><h1>  Firmware-Optimierung </h1><br>  Bevor ich weitermache, muss ich mich von einigen technischen Details ablenken lassen.  Tatsache ist, dass ich ungef√§hr an diesem Ort anfing, mit zunehmendem Speicherverbrauch zu sto√üen.  Es stellte sich heraus, dass die Zeile, die zu Beginn der Firmware ohne den Modifikator PROGMEM r√ºcksichtslos deklariert wurde, in den Arbeitsspeicher kopiert wird und dort w√§hrend der gesamten Laufzeit Speicherplatz beansprucht. <br><br><div class="spoiler">  <b class="spoiler_title">Verschiedene Architekturen</b> <div class="spoiler_text">  Kurzgesagt.  Auf gro√üen Computern wird die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Von Neumann-Architektur verwendet,</a> bei der sich Code und Daten im selben Adressraum befinden.  Das hei√üt,  Daten aus RAM und ROM werden auf die gleiche Weise gelesen. <br><br>  Mikrocontroller verwenden normalerweise die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Harvard-Architektur</a> , bei der Code und Daten getrennt sind.  T.O.  Sie m√ºssen verschiedene Funktionen verwenden, um Speicher und Flash zu lesen.  Aus Sicht der C / C ++ - Sprache sehen Zeiger gleich aus, aber beim Schreiben eines Programms m√ºssen wir genau wissen, auf welchen Speicher unser Zeiger genau zeigt, und die entsprechenden Funktionen aufrufen. </div></div><br>  Gl√ºcklicherweise haben sich Bibliotheksentwickler bereits teilweise darum gek√ºmmert.  Die Hauptklasse der Anzeigebibliothek - Adafruit_SSD1306 - wird von der Print-Klasse der Arduino-Standardbibliothek geerbt. <br><br>  Dies bietet uns eine ganze Reihe verschiedener Modifikationen der Druckmethode - zum Drucken von Zeichenfolgen, einzelnen Zeichen, Zahlen und etwas anderem.  Es hat also 2 separate Funktionen zum Drucken von Zeilen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> print(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> __FlashStringHelper *); <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> print(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[]);</code> </pre><br>  Der erste wei√ü, dass Sie eine Zeile von einem Flash-Laufwerk drucken m√ºssen, und l√§dt sie Zeichen f√ºr Zeichen.  Der zweite druckt Zeichen aus dem RAM.  Tats√§chlich nehmen beide Funktionen einen Zeiger auf eine Zeichenfolge nur aus unterschiedlichen Adressr√§umen. <br><br>  Lange habe ich im Arduino-Code nach diesem __FlashStringHelper gesucht, um zu lernen, wie man die gew√ºnschte print () -Funktion aufruft.  Es stellte sich heraus, dass die Jungs den Trick gemacht hatten: Sie deklarierten diesen Typ einfach mit der Vorw√§rtsdeklaration (ohne den Typ selbst zu deklarieren) und schrieben ein Makro, das blitzschnell Zeiger auf Zeilen in den Typ __FlashStringHelper umwandelte.  Nur damit der Compiler die erforderliche √ºberladene Funktion ausw√§hlt <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> __</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlashStringHelper</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> F(string_literal) (reinterpret_cast</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;const __FlashStringHelper *&gt;(PSTR(string_literal)))</span></span></span></span></code> </pre><br>  So k√∂nnen Sie wie folgt schreiben: <br><br><pre> <code class="cpp hljs">display.print(F(‚ÄúString in flash memory‚Äù));</code> </pre> <br><br>  Aber du kannst nicht so schreiben <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> text[] PROGMEM = <span class="hljs-string"><span class="hljs-string">"String in flash memory"</span></span>; display.print(F(text));</code> </pre> <br>  Und anscheinend bietet die Bibliothek nichts, was auf diese Weise getan werden k√∂nnte.  Ich wei√ü, dass es nicht gut ist, private Bibliotheksst√ºcke in meinem Code zu verwenden, aber was soll ich tun?  Ich zeichnete mein Makro, das tat, was ich brauchte. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> USE_PGM_STRING(x) reinterpret_cast</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;const __FlashStringHelper *&gt;(x)</span></span></span></span></code> </pre><br>  Die Hutzeichnungsfunktion sah also folgenderma√üen aus: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Screen::drawHeader() { display.setFont(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); display.setCursor(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); display.print(<span class="hljs-string"><span class="hljs-string">'\x1e'</span></span>); display.print(USE_PGM_STRING(getSelButtonText())); display.setCursor(<span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); display.print(<span class="hljs-string"><span class="hljs-string">'\x1e'</span></span>); display.print(USE_PGM_STRING(getOkButtonText())); }</code> </pre> <br>  Nun, da ich mich mit den Low-Level-Teilen der Firmware befasst habe, habe ich mich entschlossen, genauer zu untersuchen, wie das alles im Inneren funktioniert. <br><br>  Im Allgemeinen m√ºssen die Leute, die sich Arduino ausgedacht haben, ein Denkmal errichten.  Sie bildeten eine einfache und bequeme Plattform f√ºr Prototyping und Handwerk.  Eine gro√üe Anzahl von Menschen mit minimalen Kenntnissen in Elektronik und Programmierung konnte in die Welt von Arduino eintreten.  Aber all dies ist glatt und sch√∂n, wenn Sie M√ºll wie Blinker mit LEDs oder das Ablesen des Thermometers machen.  Sobald Sie etwas Ernstes anschwingen, m√ºssen Sie sofort tiefer verstehen, als Sie von Anfang an wollten. <br><br>  Nach jeder hinzugef√ºgten Bibliothek oder Klasse habe ich festgestellt, wie schnell der Speicherverbrauch w√§chst.  Zu diesem Zeitpunkt war ich mit mehr als 14 KB 32 KB Flash und 1300 Byte RAM (von 2 KB) besch√§ftigt.  Jede unachtsame Bewegung erh√∂hte die bereits verwendete um weitere 10 Prozent.  Aber ich habe GPS- und SD / FAT32-Bibliotheken immer noch nicht wirklich verbunden, und die Katze selbst hat geweint.  Ich musste den Disassembler- <s>Checker</s> in die <s>Hand nehmen</s> und untersuchen, was der Compiler tat. <br><br>  Ich habe insgeheim gehofft, dass der Linker nicht verwendete Funktionen ausl√∂st.  Es stellte sich jedoch heraus, dass einige von ihnen der Linker fast vollst√§ndig einf√ºgt.  In der Firmware habe ich die Strichzeichnungsfunktionen und einige andere aus der Bibliothek f√ºr die Arbeit mit dem Bildschirm gefunden, obwohl ich sie im Code zu diesem Zeitpunkt offensichtlich nicht aufgerufen habe.  Implizit sollten sie auch nicht aufgerufen werden - warum brauche ich eine Strichzeichnungsfunktion, wenn ich nur Buchstaben aus Bitmaps zeichne?  Mehr als 5,2 KB aus heiterem Himmel (und das z√§hlt keine Schriftarten). <br><br>  Neben der Anzeigesteuerungsbibliothek fand ich auch: <br><br><ul><li>  2,6 kb - auf SoftwareSerial (ich habe es irgendwann in das Projekt gezogen) </li><li>  1,6 kb - I2C </li><li>  1,3 kb - HardwareSerial </li><li>  2 kb - TinyGPS </li><li>  2,5 kb auf dem eigentlichen Arduino (Initialisierung, Pins, alle Arten von Tabellen, der Haupttimer f√ºr die Funktionen millis () und delay ()), </li></ul><br>  Die Zahlen sind sehr bezeichnend, wie  Der Optimierer mischt ernsthaft Code.  Einige Funktionen k√∂nnen an einer Stelle beginnen, und dann kann eine andere aus einer anderen Bibliothek, die von der ersten aufgerufen wird, unmittelbar darauf folgen.  Dar√ºber hinaus k√∂nnen sich am anderen Ende des Blitzes separate Zweige dieser Funktionen befinden. <br><br>  Auch im Code habe ich gefunden: <br><br><ul><li>  Bildschirmsteuerung durch SPI (obwohl ich es √ºber I2C verbunden habe) </li><li>  Methoden von Basisklassen, die selbst nicht aufgerufen werden, weil  in den Erben neu definiert </li><li>  Destruktoren, die niemals vom Design her aufgerufen werden </li><li>  Zeichenfunktionen (und nicht alle - Teil der Funktionen, die der Linker noch ausgef√ºhrt hat) </li><li>  malloc / free w√§hrend in meinem Code alle Objekte im Wesentlichen statisch sind </li></ul><br>  Aber nicht nur der Verbrauch von Flash-Speicher, sondern auch SRAM w√§chst sprunghaft: <br><br><ul><li>  130 Bytes - I2C </li><li>  100 Bytes - SoftwareSerial </li><li>  157 Bytes - Seriell </li><li>  558 Bytes - Anzeige (von denen 512 der Bildspeicher ist) </li></ul><br>  Nicht weniger unterhaltsam war der Abschnitt .data.  Es gibt ungef√§hr 700 Bytes und dieses Ding wird zu Beginn von einem Flash in den RAM geladen.  Es stellte sich heraus, dass im Speicher und zusammen mit den Initialisierungswerten Pl√§tze f√ºr Variablen reserviert sind.  Hier leben die Variablen und Konstanten, die Sie vergessen haben, als const PROGMEM zu deklarieren. <br><br>  Darunter befand sich ein kr√§ftiges Array mit einem ‚ÄûBegr√º√üungsbildschirm‚Äú des Bildschirms - den Anfangswerten des Bildpuffers.  Theoretisch k√∂nnen Sie, wenn Sie den Bildschirm display () unmittelbar nach dem Start erstellen, die Blume und die Adafruit-Inschrift sehen, aber in meinem Fall ist es sinnlos, Flash-Speicher daf√ºr zu verwenden. <br><br>  Der Abschnitt .data enth√§lt auch vtables.  Sie werden von einem Flash-Laufwerk in den Speicher kopiert, anscheinend aus Gr√ºnden der Laufzeiteffizienz.  Aber Sie m√ºssen ein ziemlich gro√ües St√ºck RAM opfern - √ºber ein Dutzend Klassen mit mehr als 150 Bytes.  Dar√ºber hinaus scheint es keinen Compiler-Schl√ºssel zu geben, der unter Leistungseinbu√üen virtuelle Tabellen im Flash-Speicher bel√§sst. <br><br>  Was tun?  Ich wei√ü es noch nicht.  Es wird davon abh√§ngen, wie der Verbrauch weiter wachsen wird.  F√ºr gut gefundene Pfosten m√ºssen gnadenlos repariert werden.  H√∂chstwahrscheinlich muss ich alle Bibliotheken explizit in mein Projekt einbeziehen und sie dann gr√ºndlich behandeln.  M√∂glicherweise m√ºssen Sie einige der Teile anders umschreiben, um das Ged√§chtnis zu optimieren.  Oder wechseln Sie zu leistungsf√§higerer Hardware.  Auf jeden Fall wei√ü ich jetzt √ºber das Problem Bescheid und es gibt eine Strategie, wie man es behebt. <br><br>  <b>UPDATE:</b> <br>  Geringe Fortschritte bei der Ressourceneffizienz.  Ich mache ein Update f√ºr diesen Teil, weil  im n√§chsten m√∂chte ich mich auf ganz andere dinge konzentrieren. <br><br>  In Kommentaren gibt es einige Verwirrung √ºber die Verwendung von C ++.  Insbesondere, warum ist er so schlecht und h√§lt vtable in wertvollem RAM?  Im Allgemeinen sind virtuelle Funktionen, Konstruktoren und Destruktoren Overhead.  Warum?  Lass es uns herausfinden! <br><br>  Hier finden Sie Statistiken zum Speicher zu einem bestimmten Zeitpunkt des Projekts <br>  Programmgr√∂√üe: 15 458 Byte (verwendet 50% eines Maximums von 30 720 Byte) (2,45 Sekunden) <br>  Minimale Speichernutzung: 1258 Byte (61% eines Maximums von 2048 Byte) <br><br>  Experiment Nr. 1 - Umschreiben auf C. <br><br>  Ich warf Klassen, schrieb alles auf Tabellen mit Zeigern auf Funktionen um.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da Bildschirme tats√§chlich immer dieselbe Struktur haben, sind alle Datenelemente zu normalen globalen Variablen geworden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statistik nach dem Refactoring </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmgr√∂√üe: 14 568 Byte (verwendet 47% eines Maximums von 30 720 Byte) (2,35 Sekunden) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimale Speichernutzung: 1176 Byte (57% eines Maximums von 2048 Byte) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamt. Gewann 900 Bytes Flash und 80 Bytes RAM. Was genau den Blitz √ºbrig lie√ü, grub nicht. 80 Byte RAM sind nur so gro√ü wie die von vtable. Alle anderen Daten (Klassenmitglieder) blieben irgendwie erhalten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich muss sagen, dass ich nicht alles verdorben habe - ich wollte nur das gro√üe Ganze sehen, ohne viel Zeit damit zu verbringen. Nach dem Refactoring habe ich verschachtelte Screenshots "verloren". Mit ihnen w√§re der Verbrauch etwas h√∂her.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Wichtigste bei diesem Experiment ist jedoch, dass sich die Qualit√§t des Codes erheblich verschlechtert hat. Der Code einer Funktion ist auf mehrere Dateien verteilt. F√ºr einige Daten gab es "einen Eigent√ºmer" nicht mehr, einige Module begannen, in die Erinnerung anderer zu klettern. Der Code ist pauschal und h√§sslich geworden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiment Nr. 2 - Bytes aus C ++ quetschen </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe mein Experiment zur√ºckgesetzt und beschlossen, alles als Klassen zu belassen. Nur dieses Mal werden die Bildschirme f√ºr statisch verteilte Objekte ausgef√ºhrt. Die Struktur der Seiten auf meinen Bildschirmen ist festgelegt. Sie k√∂nnen es bei der Kompilierung angeben, ohne new / delete zu verwenden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmgr√∂√üe: 15 408 Byte (verwendet 50% eines Maximums von 30 720 Byte) (2,60 Sekunden) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimale Speichernutzung: 1273 Byte (62% eines Maximums von 2048 Byte)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der RAM-Verbrauch hat leicht zugenommen. </font><font style="vertical-align: inherit;">Aber das ist in der Tat zum Besseren. </font><font style="vertical-align: inherit;">Der Anstieg des RAM-Verbrauchs erkl√§rt sich aus der Bewegung von Objekten vom Heap in einen statisch verteilten Speicherbereich.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich wurden Objekte zuvor erstellt, dies ging jedoch nicht in die Statistik. </font><font style="vertical-align: inherit;">Und jetzt werden diese Objekte explizit ber√ºcksichtigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber den Blitzverbrauch deutlich zu reduzieren, hat nicht funktioniert. </font><font style="vertical-align: inherit;">Der Code enth√§lt weiterhin die Konstruktoren selbst, die beim Start noch aufgerufen werden.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Compiler konnte sie nicht im Voraus ausf√ºhren und alle Werte in vorab zugewiesene Bereiche einf√ºgen. Und es gab immer noch Destruktoren im Code, obwohl dem Igel klar ist, dass Objekte niemals gel√∂scht werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um zumindest ein wenig zu sparen, habe ich alle Destruktoren in der Hierarchie und insbesondere den virtuellen Destruktor in der Basisklasse gel√∂scht. Die Idee war, ein paar Bytes in jeder vtable freizugeben. Und dann erwartete mich eine √úberraschung: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmgr√∂√üe: 14 704 Bytes (verwendet 48% eines Maximums von 30 720 Bytes) (2,94 Sekunden) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimale Speichernutzung: 1211 Bytes (59% eines Maximums von 2048 Bytes)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es stellte sich heraus, dass die vtable nicht um einen Zeiger ging, sondern bereits um 2. Au√üerdem hatten beide mit dem Destruktor zu tun. </font><font style="vertical-align: inherit;">Nur ein Destruktor ist leer (anscheinend f√ºr Objekte auf dem Stapel) und der andere mit einem freien Aufruf, der f√ºr Objekte auf dem Heap sichtbar ist (-12 Byte RAM). </font><font style="vertical-align: inherit;">Au√üerdem sind die mit der H√ºfte verkn√ºpften Variablen (8 Byte) und die Beschriftungen von Objekten, die nie erstellt wurden (Bildschirm, ParentScreen - 40 Byte), weg. Der </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash-Verbrauch ist erheblich gesunken - um 700 Byte. </font><font style="vertical-align: inherit;">Nicht nur die Destruktoren selbst, sondern auch die Implementierungen malloc / free / new / delete sind verschwunden. </font><font style="vertical-align: inherit;">700 Bytes f√ºr einen leeren virtuellen Destruktor! </font><font style="vertical-align: inherit;">700 Bytes, Carl! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das w√ºrde nicht hin und her gehen, hier sind alle Zahlen an einem Ort</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> War </font></font></th><th>  C. </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C ++ </font></font></th></tr><tr><td>  Flash </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15 458 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14.568 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14.704 </font></font></td></tr><tr><td>  RAM </td><td>  1258 </td><td>  1176 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1211 </font></font></td></tr></tbody></table></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit: Der Verbrauch in C ++ war fast der gleiche wie in C. Gleichzeitig sind Kapselung, Vererbung und Polymorphismus Macht. </font><font style="vertical-align: inherit;">Ich bin bereit, dies mit einem gewissen Anstieg des Verbrauchs zu √ºberbezahlen. </font><font style="vertical-align: inherit;">Vielleicht kann ich einfach nicht sch√∂n in C schreiben, aber warum, wenn ich sch√∂n in C ++ schreiben kann?</font></font><br><br><h1>  Nachwort </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfangs wollte ich am Ende des Projekts einen Artikel schreiben. </font><font style="vertical-align: inherit;">Da sich die Notizen jedoch im Verlauf der Arbeit mit hoher Geschwindigkeit ansammeln, droht der Artikel sehr gro√ü zu sein. </font><font style="vertical-align: inherit;">Also habe ich beschlossen, es in mehrere Teile zu teilen. </font><font style="vertical-align: inherit;">In diesem Teil habe ich √ºber die Vorbereitungsphasen gesprochen: Verstehen, was ich wirklich will, Auswahl einer Plattform, Implementierung eines Anwendungsframeworks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im n√§chsten Teil m√∂chte ich mit der Implementierung der Grundfunktionalit√§t fortfahren - mit GPS arbeiten. </font><font style="vertical-align: inherit;">Ich habe bereits einige interessante Rechen gesehen, von denen ich erz√§hlen m√∂chte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seit mehr als 10 Jahren habe ich nicht ernsthaft f√ºr Mikrocontroller programmiert. </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass ich durch die F√ºlle an Ressourcen gro√üer Computer etwas verw√∂hnt wurde und es in den Realit√§ten von ATMega32 eng ist. </font><font style="vertical-align: inherit;">Daher musste ich √ºber verschiedene Sicherungsoptionen nachdenken, z. B. das Trimmen der Funktionalit√§t von Bibliotheken oder das Neugestalten der Anwendung im Namen einer effizienten Speichernutzung. </font><font style="vertical-align: inherit;">Ich schlie√üe auch die M√∂glichkeit nicht aus, auf leistungsst√§rkere Controller umzusteigen - ATMega64 oder etwas aus der STM32-Reihe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Artikel entpuppt sich stilistisch als Bauzeitschrift. </font><font style="vertical-align: inherit;">Und ich freue mich √ºber konstruktive Kommentare - es ist noch nicht zu sp√§t, etwas zu √§ndern. </font><font style="vertical-align: inherit;">Wer m√∂chte, kann sich meinem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt auf dem Github anschlie√üen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Ende des ersten Teils. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweiter Teil</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de401899/">https://habr.com/ru/post/de401899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de401889/index.html">Legend√§re Verst√§rker der 80er - 90er Jahre: Lamm-Paradoxe, Johnsons Monster, integraler Killer f√ºr "warme Lampen"</a></li>
<li><a href="../de401891/index.html">3D-Scannen und 3D-Druck in Aktion (f√ºr Motorradfahrer)</a></li>
<li><a href="../de401893/index.html">Woher kommen Wasser und Sauerstoff auf der ISS?</a></li>
<li><a href="../de401895/index.html">Angreifer werden erfinderischer bei der Erstellung von Skimmern</a></li>
<li><a href="../de401897/index.html">News Pack f√ºr SLS und Orion</a></li>
<li><a href="../de401901/index.html">Mondscheinfenster zum Universum</a></li>
<li><a href="../de401903/index.html">Wie Kl√§nge unseren Schlaf und unsere Produktivit√§t beeinflussen</a></li>
<li><a href="../de401905/index.html">Apple Power Mac G4 Cube und seine Zeitgenossen in einer kleinen Fotobewertung</a></li>
<li><a href="../de401907/index.html">Roboterautos m√ºssen lernen, Menschen zu verstehen.</a></li>
<li><a href="../de401909/index.html">Selbstgemachtes Sicherheitssystem basierend auf Produkten f√ºr ein Smart Home von Nootekhnika</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>