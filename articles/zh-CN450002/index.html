<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â˜ªï¸ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘©ğŸ» ğŸ•µğŸ¿ ä½¿ç”¨PVS-StudioæŸ¥æ‰¾LLVM 8ä¸­çš„é”™è¯¯ ğŸ‘• ğŸ™‰ ğŸ‘¨ğŸ¼â€ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è‡ªä¸Šæ¬¡é€šè¿‡PVS-Studioæ£€æŸ¥LLVMé¡¹ç›®çš„ä»£ç ä»¥æ¥å·²ç»æœ‰ä¸¤å¹´äº†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹PVS-Studioæ˜¯å¦ä»ç„¶æ˜¯æ£€æµ‹é”™è¯¯å’Œå®‰å…¨æ¼æ´çš„å·¥å…·ä¸­çš„é¢†å¯¼è€…ã€‚ æˆ‘ä»¬å°†é€šè¿‡æ‰«æLLVM 8.0.0ç‰ˆæœ¬ä¸­çš„æ–°é”™è¯¯æ¥å®ç°ã€‚ 

 å¿…é¡»å†™çš„æ–‡ç«  
 å¦ç™½è¯´ï¼Œæˆ‘ä¸æƒ³å†™è¿™ç¯‡æ–‡ç« ã€‚ è°ˆè®ºæˆ‘ä»¬å·²ç»å¤šæ¬¡æ£€æŸ¥ï¼ˆ 1ï¼Œ2ï¼Œ3 ï¼‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨PVS-StudioæŸ¥æ‰¾LLVM 8ä¸­çš„é”™è¯¯</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/450002/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f2/8d4/5bf/2f28d45bf369270d9330bfbe2ea78f00.png" alt="PVS-Studioå’ŒLLVM 8.0.0"></div><br> è‡ªä¸Šæ¬¡é€šè¿‡PVS-Studioæ£€æŸ¥LLVMé¡¹ç›®çš„ä»£ç ä»¥æ¥å·²ç»æœ‰ä¸¤å¹´äº†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹PVS-Studioæ˜¯å¦ä»ç„¶æ˜¯æ£€æµ‹é”™è¯¯å’Œå®‰å…¨æ¼æ´çš„å·¥å…·ä¸­çš„é¢†å¯¼è€…ã€‚ æˆ‘ä»¬å°†é€šè¿‡æ‰«æLLVM 8.0.0ç‰ˆæœ¬ä¸­çš„æ–°é”™è¯¯æ¥å®ç°ã€‚ <br><a name="habracut"></a><br><h2> å¿…é¡»å†™çš„æ–‡ç«  </h2><br> å¦ç™½è¯´ï¼Œæˆ‘ä¸æƒ³å†™è¿™ç¯‡æ–‡ç« ã€‚ è°ˆè®ºæˆ‘ä»¬å·²ç»å¤šæ¬¡æ£€æŸ¥ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1ï¼Œ2ï¼Œ3</a> ï¼‰çš„é¡¹ç›®å¹¶ä¸æœ‰è¶£ã€‚ æˆ‘å®æ„¿é€‰æ‹©æ–°çš„ä¸œè¥¿ï¼Œä½†åˆ«æ— é€‰æ‹©ã€‚ <br><br> æ¯æ¬¡å‘è¡Œæ–°ç‰ˆæœ¬çš„LLVMæˆ–æ›´æ–°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Clang Static Analyzeræ—¶</a> ï¼Œæˆ‘ä»¬éƒ½ä¼šæ”¶åˆ°ä»¥ä¸‹å†…å®¹çš„ç”µå­é‚®ä»¶ï¼š <br><br>  <i>å˜¿ï¼Œæ–°ç‰ˆæœ¬çš„Clang Static Analyzeræœ‰äº†æ–°çš„è¯Šæ–­ï¼</i>  <i>PVS-Studioä¼¼ä¹å˜å¾—ä¸é‚£ä¹ˆé‡è¦äº†ã€‚</i>  <i>Clangå¯ä»¥æ£€æµ‹åˆ°æ¯”ä»¥å‰æ›´å¤šçš„bugï¼Œç°åœ¨æ­£èµ¶ä¸ŠPVS-Studioã€‚</i>  <i>ä½ è¯´ä»€ä¹ˆ</i> <br><br> ä¸ºæ­¤ï¼Œæˆ‘å¾ˆä¹æ„å›åº”ï¼š <br><br>  <b>æˆ‘ä»¬ä¹Ÿæ²¡æœ‰é—²é€›ï¼</b> æˆ‘ä»¬å¤§å¤§æé«˜äº†PVS-Studioçš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒ-æˆ‘ä»¬ä»ç„¶æ˜¯æœ€å¥½çš„ã€‚ <br><br> ææ€•è¿™æ˜¯ä¸€ä¸ªä¸å¥½çš„ç­”æ¡ˆã€‚ å®ƒæ²¡æœ‰æä¾›è¯æ®ï¼Œè¿™å°±æ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åŸå› ã€‚ å› æ­¤ï¼Œæˆ‘å†æ¬¡æ£€æŸ¥äº†LLVMï¼Œå‘ç°äº†å¤§é‡çš„å„ç§é”™è¯¯ã€‚ æˆ‘æœ€å–œæ¬¢çš„é‚£äº›å°†è¿›ä¸€æ­¥è®¨è®ºã€‚  Clang Static Analyzeræ— æ³•æ£€æµ‹åˆ°è¿™äº›é”™è¯¯ï¼ˆæˆ–ä½¿è¿‡ç¨‹éå¸¸éº»çƒ¦ï¼‰ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ã€‚ è€Œä¸”ï¼Œé¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘åªèŠ±äº†ä¸€ä¸ªæ™šä¸Šå°±æŠŠæ‰€æœ‰è¿™äº›é”™è¯¯è®°å½•ä¸‹æ¥äº†ã€‚ <br><br> ä¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« èŠ±äº†æˆ‘å‡ ä¸ªæ˜ŸæœŸæ‰èƒ½å®Œæˆã€‚ æˆ‘åªæ˜¯æ— æ³•è®©è‡ªå·±æŠŠæ”¶é›†åˆ°çš„ææ–™å†™æˆæ–‡å­—:)ã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‚¨æƒ³çŸ¥é“PVS-Studioé‡‡ç”¨äº†ä»€ä¹ˆæŠ€æœ¯æ¥æ£€æµ‹é”™è¯¯å’Œæ¼æ´ï¼Œè¯·çœ‹ä¸€ä¸‹è¿™ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a> ã€‚ <br><br><h2> æ–°çš„å’Œç°æœ‰çš„è¯Šæ–­ </h2><br> æ­£å¦‚æˆ‘å·²ç»è¯´è¿‡çš„ï¼ŒLLVMçš„è®¸å¤šæ£€æŸ¥ä¸­çš„æœ€åä¸€æ¬¡æ˜¯åœ¨ä¸¤å¹´å‰å®Œæˆçš„ï¼Œåæ¥å‘ç°çš„é”™è¯¯å·²ç”±ä½œè€…ä¿®å¤ã€‚ æœ¬æ–‡å°†æ˜¾ç¤ºé”™è¯¯çš„æ–°éƒ¨åˆ†ã€‚ æ€ä¹ˆä¼šæœ‰æ–°çš„é”™è¯¯ï¼Ÿ æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š <br><br><ol><li>  LLVMé¡¹ç›®æ­£åœ¨ä¸æ–­å‘å±•ï¼› ä½œè€…ä¿®æ”¹ç°æœ‰ä»£ç å¹¶æ·»åŠ æ–°ä»£ç ã€‚ ä¿®æ”¹çš„é›¶ä»¶å’Œæ–°é›¶ä»¶è‡ªç„¶éƒ½å…·æœ‰æ–°çš„é”™è¯¯ã€‚ å¯¹äºå®šæœŸè€Œä¸æ˜¯æ—¶å¸¸è¿›è¡Œé™æ€åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰åŠ›çš„è®ºæ®ã€‚ æˆ‘ä»¬çš„æ–‡ç« æ ¼å¼éå¸¸é€‚åˆå±•ç¤ºPVS-Studioçš„åŠŸèƒ½ï¼Œä½†ä¸æé«˜ä»£ç è´¨é‡æˆ–é™ä½é”™è¯¯ä¿®å¤æˆæœ¬æ— å…³ã€‚ å®šæœŸä½¿ç”¨é™æ€åˆ†æï¼ </li><li> æˆ‘ä»¬ä¿®æ”¹å¹¶æ”¹è¿›äº†ç°æœ‰çš„è¯Šæ–­ç¨‹â€‹â€‹åºï¼Œä½¿åˆ†æä»ªèƒ½å¤Ÿæ£€æµ‹åˆ°ä»¥å‰æ— æ³•å‘ç°çš„é”™è¯¯ã€‚ </li><li>  PVS-Studioå·²é€šè¿‡ä¸¤å¹´å‰ä¸å­˜åœ¨çš„æ–°è¯Šæ–­ç¨‹åºå¾—åˆ°äº†å¢å¼ºã€‚ æˆ‘å°†è¿™äº›è­¦å‘Šåˆ†ä¸ºä¸€ä¸ªå•ç‹¬çš„éƒ¨åˆ†ï¼Œä»¥ä¾¿æ›´æ¸…æ¥šåœ°çœ‹åˆ°PVS-Studioçš„è¿›åº¦ã€‚ </li></ol><br><h2> ç°æœ‰è¯Šæ–­ç¨‹åºå‘ç°çš„ç¼ºé™· </h2><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>1ï¼šå¤åˆ¶ç²˜è´´</b> <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShouldUpgradeX86Intrinsic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Function *F, StringRef Name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Name == <span class="hljs-string"><span class="hljs-string">"addcarryx.u32"</span></span> || <span class="hljs-comment"><span class="hljs-comment">// Added in 8.0 .... Name == "avx512.mask.cvtps2pd.128" || // Added in 7.0 Name == "avx512.mask.cvtps2pd.256" || // Added in 7.0 Name == "avx512.cvtusi2sd" || // Added in 7.0 Name.startswith("avx512.mask.permvar.") || // Added in 7.0 // &lt;= Name.startswith("avx512.mask.permvar.") || // Added in 7.0 // &lt;= Name == "sse2.pmulu.dq" || // Added in 7.0 Name == "sse41.pmuldq" || // Added in 7.0 Name == "avx2.pmulu.dq" || // Added in 7.0 .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V501</a> [CWE-570]åœ¨â€œ ||â€çš„å·¦ä¾§å’Œå³ä¾§æœ‰ç›¸åŒçš„å­è¡¨è¾¾å¼â€œ Name.startswithï¼ˆâ€œ avx512.mask.permvarã€‚â€ï¼‰â€ æ“ä½œå‘˜ã€‚ è‡ªåŠ¨å‡çº§.cpp 73 <br><br> å‡ºç°â€œ avx512.mask.permvarâ€ã€‚ å­å­—ç¬¦ä¸²è¢«æ£€æŸ¥ä¸¤æ¬¡ã€‚ ç¬¬äºŒä¸ªæ¡ä»¶æ˜¾ç„¶æ˜¯æ£€æŸ¥å…¶ä»–å†…å®¹ï¼Œä½†æ˜¯ç¨‹åºå‘˜å¿˜è®°æ›´æ”¹å¤åˆ¶çš„è¡Œã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>2ï¼šé”™åˆ«å­—</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CXNameRefFlags { CXNameRange_WantQualifier = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, CXNameRange_WantTemplateArgs = <span class="hljs-number"><span class="hljs-number">0x2</span></span>, CXNameRange_WantSinglePiece = <span class="hljs-number"><span class="hljs-number">0x4</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnnotateTokensWorker::HandlePostPonedChildCursor( CXCursor Cursor, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> StartTokenIndex) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> flags = CXNameRange_WantQualifier | CXNameRange_WantQualifier; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV501åœ¨â€œ |â€çš„å·¦ä¾§å’Œå³ä¾§æœ‰ç›¸åŒçš„å­è¡¨è¾¾å¼â€œ CXNameRange_WantQualifierâ€ æ“ä½œå‘˜ã€‚  CIndex.cpp 7245 <br><br> ç”±äºè¾“å…¥é”™è¯¯ï¼Œå‘½åçš„å¸¸é‡<i>CXNameRange_WantQualifier</i>è¢«ä½¿ç”¨äº†ä¸¤æ¬¡ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>3ï¼šå¯¹è¿ç®—ç¬¦ä¼˜å…ˆçº§çš„æ··æ·†</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PPCTTIImpl::getVectorInstrCost(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Opcode, Type *Val, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Index) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ISD == ISD::EXTRACT_VECTOR_ELT &amp;&amp; Index == ST-&gt;isLittleEndian() ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V502</a> [CWE-783]ä¹Ÿè®¸â€œï¼Ÿï¼šâ€æ“ä½œç¬¦çš„å·¥ä½œæ–¹å¼ä¸é¢„æœŸçš„ä¸åŒã€‚  'ï¼Ÿï¼š'è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ä½äº'=='è¿ç®—ç¬¦ã€‚  PPCTargetTransformInfo.cpp 404 <br><br> æˆ‘å‘ç°è¿™ä¸ªé”™è¯¯éå¸¸å¯çˆ±ã€‚ æ˜¯çš„ï¼Œæˆ‘çŸ¥é“æˆ‘çš„å£å‘³å¾ˆå¥‡æ€ª:)ã€‚ <br><br> æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§</a> ï¼ŒåŸå§‹è¡¨è¾¾å¼çš„è®¡ç®—å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs">(ISD == ISD::EXTRACT_VECTOR_ELT &amp;&amp; (Index == ST-&gt;isLittleEndian())) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br> ä½†æ˜¯ï¼Œä»å®é™…çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§æƒ…å†µæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¯ä»¥å°†å…¶ç®€åŒ–ä¸ºï¼š <br><br><pre> <code class="cpp hljs">(ISD == ISD::EXTRACT_VECTOR_ELT &amp;&amp; Index == ST-&gt;isLittleEndian())</code> </pre> <br> è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ ç¨‹åºå‘˜å¿…é¡»è¦æ£€æŸ¥<i>ç´¢å¼•</i>ä¸º0/1çš„<i>ç´¢å¼•</i>å˜é‡ã€‚ è¦ä¿®å¤ä»£ç ï¼Œä¸‰å…ƒè¿ç®—ç¬¦åº”æ”¾åœ¨æ‹¬å·ä¸­ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ISD == ISD::EXTRACT_VECTOR_ELT &amp;&amp; Index == (ST-&gt;isLittleEndian() ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre> <br> ä¸‰å…ƒè¿ç®—ç¬¦å®é™…ä¸Šéå¸¸æ£˜æ‰‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é€»è¾‘é”™è¯¯ã€‚ å°å¿ƒä½¿ç”¨å®ƒï¼Œä¸è¦çŠ¹è±«åœ¨å®ƒå‘¨å›´åŠ ä¸Šå…¶ä»–æ‹¬å·ã€‚ åœ¨â€œå½“å¿ƒï¼Ÿï¼šè¿ç®—ç¬¦å¹¶å°†å…¶æ‹¬åœ¨æ‹¬å·ä¸­â€éƒ¨åˆ†ä¸­å°†åœ¨æ­¤è¯¦ç»†è®¨è®ºè¯¥ä¸»é¢˜ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>4ï¼Œ5ï¼šç©ºæŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs">Init *TGParser::ParseValue(Record *CurRec, RecTy *ItemType, IDParseMode Mode) { .... TypedInit *LHS = dyn_cast&lt;TypedInit&gt;(Result); .... LHS = dyn_cast&lt;TypedInit&gt;( UnOpInit::get(UnOpInit::CAST, LHS, StringRecTy::get()) -&gt;Fold(CurRec)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!LHS) { Error(PasteLoc, Twine(<span class="hljs-string"><span class="hljs-string">"can't cast '"</span></span>) + LHS-&gt;getAsString() + <span class="hljs-string"><span class="hljs-string">"' to string"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V522</a> [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œ LHSâ€ã€‚  TGParser.cpp 2152 <br><br> å¦‚æœ<i>LHS</i>æŒ‡é’ˆæ°å¥½ä¸ºç©ºï¼Œåˆ™ç¨‹åºåº”ç”Ÿæˆè­¦å‘Šã€‚ ç›¸åï¼Œå®ƒå°†å–æ¶ˆå¼•ç”¨éå¸¸ç©ºçš„æŒ‡é’ˆï¼š <i>LHS-&gt; getAsStringï¼ˆï¼‰</i> ã€‚ <br><br> é”™è¯¯å¤„ç†ç¨‹åºåŒ…å«é”™è¯¯çš„æƒ…å†µå¾ˆå¸¸è§ï¼Œå› ä¸ºå¼€å‘äººå‘˜æ— æ³•æ­£ç¡®æµ‹è¯•å®ƒä»¬ã€‚ é™æ€åˆ†æå™¨ä¼šæ£€æŸ¥æ‰€æœ‰å¯è®¿é—®çš„ä»£ç ï¼Œæ— è®ºå®é™…æ‰§è¡Œçš„é¢‘ç‡æ˜¯å¤šå°‘ã€‚ è¿™æ˜¯é™æ€åˆ†æå¦‚ä½•è¡¥å……å…¶ä»–ä»£ç æµ‹è¯•å’Œä¿æŠ¤æ‰‹æ®µçš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ <br><br> è¿˜å¯ä»¥æ‰¾åˆ°<i>RHS</i>æŒ‡é’ˆçš„ç±»ä¼¼æ•…éšœå¤„ç†ç¨‹åºï¼šV522 [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œ RHSâ€ã€‚  TGParser.cpp 2186 <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>6ï¼šç§»åŠ¨åä½¿ç”¨æŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Expected&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; ExtractBlocks(....) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Module&gt; ProgClone = CloneModule(BD.getProgram(), VMap); .... BD.setNewProgram(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(ProgClone)); <span class="hljs-comment"><span class="hljs-comment">// &lt;= MiscompiledFunctions.clear(); for (unsigned i = 0, e = MisCompFunctions.size(); i != e; ++i) { Function *NewF = ProgClone-&gt;getFunction(MisCompFunctions[i].first); // &lt;= assert(NewF &amp;&amp; "Function not found??"); MiscompiledFunctions.push_back(NewF); } .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV522 [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œ ProgCloneâ€ã€‚ é”™è¯¯ç¼–è¯‘.cpp 601 <br><br> æ™ºèƒ½æŒ‡é’ˆ<i>ProgClone</i>é¦–å…ˆé‡Šæ”¾å¯¹è±¡æ‰€æœ‰æƒï¼š <br><br><pre> <code class="cpp hljs">BD.setNewProgram(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(ProgClone));</code> </pre> <br> å®é™…ä¸Šï¼Œ <i>ProgClone</i>å·²æˆä¸ºç©ºæŒ‡é’ˆ-å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œç©ºæŒ‡é’ˆä¼šè¿›ä¸€æ­¥å–æ¶ˆå¼•ç”¨ï¼š <br><br><pre> <code class="cpp hljs">Function *NewF = ProgClone-&gt;getFunction(MisCompFunctions[i].first);</code> </pre> <br> ä½†è¿™ä¸ä¼šå‘ç”Ÿï¼ è¯·æ³¨æ„ï¼Œå¾ªç¯å®é™…ä¸Šæ ¹æœ¬ä¸æ‰§è¡Œã€‚ <br><br> é¦–å…ˆæ¸…é™¤äº†<i>MiscompiledFunctions</i>å®¹å™¨ï¼š <br><br><pre> <code class="cpp hljs">MiscompiledFunctions.clear();</code> </pre> <br> ç„¶ååœ¨å¾ªç¯æ¡ä»¶ä¸­ä½¿ç”¨å…¶å¤§å°ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, e = MisCompFunctions.size(); i != e; ++i) {</code> </pre> <br> æ˜¾ç„¶ï¼Œå¾ªç¯ä¸ä¼šå¼€å§‹ã€‚ æˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œä»£ç çš„å¤–è§‚ä¹Ÿæœ‰æ‰€ä¸åŒã€‚ <br><br> æˆ‘çŒœæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯è‡­åæ˜­è‘—çš„é”™è¯¯å¥‡å¶æ ¡éªŒï¼Œå…¶ä¸­ä¸€ä¸ªé”™è¯¯å……å½“äº†å¦ä¸€ä¸ªé”™è¯¯çš„ä¼ªè£…:)ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>7ï¼šç§»åŠ¨åä½¿ç”¨æŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Expected&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; TestOptimizer(BugDriver &amp;BD, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Module&gt; Test, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Module&gt; Safe) { outs() &lt;&lt; <span class="hljs-string"><span class="hljs-string">" Optimizing functions being tested: "</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Module&gt; Optimized = BD.runPassesOn(Test.get(), BD.getPassesToRun()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Optimized) { errs() &lt;&lt; <span class="hljs-string"><span class="hljs-string">" Error running this sequence of passes"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" on the input program!\n"</span></span>; BD.setNewProgram(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(Test)); <span class="hljs-comment"><span class="hljs-comment">// &lt;= BD.EmitProgressBitcode(*Test, "pass-error", false); // &lt;= if (Error E = BD.debugOptimizerCrash()) return std::move(E); return false; } .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV522 [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œæµ‹è¯•â€ã€‚ é”™è¯¯ç¼–è¯‘cpp 709 <br><br> è¿™ä¸å‰é¢çš„æƒ…å†µç›¸ä¼¼ã€‚ é¦–å…ˆç§»åŠ¨å¯¹è±¡çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨å®ƒï¼Œå°±å¥½åƒä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿä¸€æ ·ã€‚ åœ¨å°†ç§»åŠ¨è¯­ä¹‰æ·»åŠ åˆ°C ++ä¹‹åï¼Œæ­¤é”™è¯¯å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚ é‚£å°±æ˜¯æˆ‘å–œæ¬¢è¿™ç§è¯­è¨€çš„åŸå› ï¼ æ‚¨å°†è·å¾—æ–°çš„å°„å‡»æ–¹å¼ï¼Œè¿™æ„å‘³ç€PVS-Studioå°†å§‹ç»ˆæœ‰å·¥ä½œè¦åšï¼š)ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>8ï¼šç©ºæŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FunctionDumper::dump(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PDBSymbolTypeFunctionArg &amp;Symbol) { <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> TypeId = Symbol.getTypeId(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> Type = Symbol.getSession().getSymbolById(TypeId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Type) Printer &lt;&lt; <span class="hljs-string"><span class="hljs-string">"&lt;unknown-type&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Type-&gt;dump(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV522 [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œç±»å‹â€ã€‚  233.ç¬¬233ç«  <br><br> å°±åƒé”™è¯¯å¤„ç†ç¨‹åºä¸€æ ·ï¼Œæ‰“å°è°ƒè¯•æ•°æ®çš„æµ‹è¯•åŠŸèƒ½é€šå¸¸ä¹Ÿæ— æ³•è·å¾—è¶³å¤Ÿçš„æµ‹è¯•è¦†ç›–ç‡ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ è¯¥åŠŸèƒ½ä¸æ˜¯åœ¨å¸®åŠ©ç”¨æˆ·è§£å†³ä»–ä»¬çš„é—®é¢˜ï¼Œè€Œæ˜¯åœ¨ç­‰å¾…ä»–ä»¬è§£å†³é—®é¢˜ã€‚ <br><br> å›ºå®šä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Type) Type-&gt;dump(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Printer &lt;&lt; <span class="hljs-string"><span class="hljs-string">"&lt;unknown-type&gt;"</span></span>;</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>9ï¼šç©ºæŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SearchableTableEmitter::collectTableEntries( GenericTable &amp;Table, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Record *&gt; &amp;Items) { .... RecTy *Ty = resolveTypes(Field.RecType, TI-&gt;getType()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Ty) <span class="hljs-comment"><span class="hljs-comment">// &lt;= PrintFatalError(Twine("Field '") + Field.Name + "' of table '" + Table.Name + "' has incompatible type: " + Ty-&gt;getAsString() + " vs. " + // &lt;= TI-&gt;getType()-&gt;getAsString()); .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV522 [CWE-476]å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ç©ºæŒ‡é’ˆâ€œ Tyâ€ã€‚  SearchableTableEmitter.cpp 614 <br><br> æˆ‘è®¤ä¸ºæ‚¨ä¸éœ€è¦å¯¹æ­¤å‘è¡¨ä»»ä½•è¯„è®ºã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>10ï¼šé”™åˆ«å­—</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FormatTokenLexer::tryMergeCSharpNullConditionals() { .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;Identifier = *(Tokens.end() - <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;Question = *(Tokens.end() - <span class="hljs-number"><span class="hljs-number">1</span></span>); .... Identifier-&gt;ColumnWidth += Question-&gt;ColumnWidth; Identifier-&gt;Type = Identifier-&gt;Type; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Tokens.erase(Tokens.end() - 1); return true; }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V570</a>ä¸ºå…¶åˆ†é…äº†â€œæ ‡è¯†ç¬¦-&gt;ç±»å‹â€å˜é‡ã€‚ æ ¼å¼ä»¤ç‰ŒLexer.cpp 249 <br><br> ç»™å˜é‡èµ‹å€¼æœ¬èº«æ˜¯æ²¡æœ‰æ„ä¹‰çš„æ“ä½œã€‚ ç¨‹åºå‘˜å¿…é¡»å…·æœ‰ä»¥ä¸‹ç›®çš„ï¼š <br><br><pre> <code class="cpp hljs">Identifier-&gt;Type = Question-&gt;Type;</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>11ï¼šå¯ç–‘çš„ä¼‘æ¯</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SystemZOperand::print(raw_ostream &amp;OS) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Kind) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KindToken: OS &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Token:"</span></span> &lt;&lt; getToken(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KindReg: OS &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Reg:"</span></span> &lt;&lt; SystemZInstPrinter::getRegisterName(getReg()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V622</a> [CWE-478]è€ƒè™‘æ£€æŸ¥â€œ switchâ€è¯­å¥ã€‚ ç¬¬ä¸€ä¸ªâ€œ caseâ€è¿ç®—ç¬¦å¯èƒ½ä¼šä¸¢å¤±ã€‚ ç³»ç»ŸZAsmParser.cpp 652 <br><br> å¼€å¤´æœ‰ä¸€ä¸ªéå¸¸å¯ç–‘çš„<i>break</i>è¯­å¥ã€‚ è¿™é‡Œä¸åº”è¯¥æœ‰åˆ«çš„ä¸œè¥¿å—ï¼Ÿ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>12ï¼šè§£å¼•ç”¨åæ£€æŸ¥æŒ‡é’ˆ</b> <br><br><pre> <code class="cpp hljs">InlineCost AMDGPUInliner::getInlineCost(CallSite CS) { Function *Callee = CS.getCalledFunction(); Function *Caller = CS.getCaller(); TargetTransformInfo &amp;TTI = TTIWP-&gt;getTTI(*Callee); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Callee || Callee-&gt;isDeclaration()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> llvm::InlineCost::getNever(<span class="hljs-string"><span class="hljs-string">"undefined callee"</span></span>); .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V595</a> [CWE-476]åœ¨é’ˆå¯¹nullptréªŒè¯äº†â€œè¢«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è°ƒç”¨</a>è€…â€æŒ‡é’ˆä¹‹å‰ï¼Œå·²ä½¿ç”¨è¯¥æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š172ï¼Œ174ã€‚AMDGPUInline.cpp 172 <br><br> è°ƒç”¨<i>getTTI</i>å‡½æ•°æ—¶ï¼Œé¦–å…ˆå–æ¶ˆå¼•ç”¨è¢«è°ƒç”¨æ–¹æŒ‡é’ˆã€‚ <br><br> ç„¶åå‘ç°åº”è¯¥æ£€æŸ¥æŒ‡é’ˆçš„<i>nullptr</i> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Callee || Callee-&gt;isDeclaration())</code> </pre> <br> å¤ªæ™šäº†... <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>13-å¦....ï¼šå–æ¶ˆå¼•ç”¨åæ£€æŸ¥æŒ‡é’ˆ</b> <br><br> å‰é¢çš„ç¤ºä¾‹ä¸æ˜¯å”¯ä¸€çš„ã€‚ åœ¨æ­¤ä»£ç æ®µä¸­å‘ç°äº†ç›¸åŒçš„é—®é¢˜ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Value *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optimizeDoubleFP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CallInst *CI, IRBuilder&lt;&gt; &amp;B, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isBinary, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isPrecise = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... Function *CalleeFn = CI-&gt;getCalledFunction(); StringRef CalleeNm = CalleeFn-&gt;getName(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= AttributeList CalleeAt = CalleeFn-&gt;getAttributes(); if (CalleeFn &amp;&amp; !CalleeFn-&gt;isIntrinsic()) { // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV595 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹å‰ï¼Œå·²ä½¿ç”¨äº†'CalleeFn'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š1079ã€1081ã€‚SimplifyLibCalls.cpp 1079 <br><br> è€Œè¿™ä¸ªï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Sema::InstantiateAttrs(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MultiLevelTemplateArgumentList &amp;TemplateArgs, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Decl *Tmpl, Decl *New, LateInstantiatedAttrVec *LateAttrs, LocalInstantiationScope *OuterMostScope) { .... NamedDecl *ND = dyn_cast&lt;NamedDecl&gt;(New); CXXRecordDecl *ThisContext = dyn_cast_or_null&lt;CXXRecordDecl&gt;(ND-&gt;getDeclContext()); <span class="hljs-comment"><span class="hljs-comment">// &lt;= CXXThisScopeRAII ThisScope(*this, ThisContext, Qualifiers(), ND &amp;&amp; ND-&gt;isCXXInstanceMember()); // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV595 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹å‰ï¼Œå·²ä½¿ç”¨äº†'ND'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š532ã€534ã€‚SemaTemplateInstantiateDecl.cpp 532 <br><br> åœ¨è¿™é‡Œï¼š <br><br><ul><li>  V595 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹å‰ï¼Œå·²ä½¿ç”¨äº†'U'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š404ã€407ã€‚DWARFFormValue.cpp 404 </li><li>  V595 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹å‰ï¼Œå·²ä½¿ç”¨äº†'ND'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š2149ï¼Œ2151ã€‚SemaTemplateInstantiate.cpp 2149 </li></ul><br> ç„¶åï¼Œæˆ‘å¯¹è·Ÿè¸ªV595è­¦å‘Šå¤±å»äº†å…´è¶£ï¼Œå› æ­¤ï¼Œé™¤äº†ä¸Šé¢æ˜¾ç¤ºçš„é”™è¯¯ä¹‹å¤–ï¼Œæˆ‘æ— æ³•å‘Šè¯‰æ‚¨æ˜¯å¦è¿˜æœ‰å…¶ä»–æ­¤ç±»é”™è¯¯ã€‚ æˆ‘æ•¢æ‰“èµŒã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>17ã€18ï¼šå¯ç–‘çš„è½¬å˜</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processLogicalImmediate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Imm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> RegSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;Encoding)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Size = RegSize; .... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> NImms = ~(Size<span class="hljs-number"><span class="hljs-number">-1</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V629</a> [CWE-190]è€ƒè™‘æ£€æŸ¥'ã€œï¼ˆå¤§å°-1ï¼‰&lt;&lt; 1'è¡¨è¾¾å¼ã€‚  32ä½å€¼çš„ä½ç§»ï¼Œéšåæ‰©å±•ä¸º64ä½ç±»å‹ã€‚  260 AArch64AddressingModes.h <br><br> è¿™æ®µä»£ç å®é™…ä¸Šå¯èƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥ç¡®å®å¾ˆå¥‡æ€ªï¼Œéœ€è¦æ£€æŸ¥ã€‚ <br><br> å‡è®¾<i>Size</i>å˜é‡çš„å€¼ä¸º16ï¼› é‚£ä¹ˆ<i>NImms</i>å˜é‡å°†è·å¾—ä»¥ä¸‹å€¼ï¼š <br><br>  11111111111111111111111111111111111111111111111111111111111111100000000 <br><br> ä½†å®é™…ä¸Šå®ƒå°†è·å¾—ä»·å€¼ï¼š <br><br>  0000000000000000000000000000000000000000001111111111111111111111111100000 <br><br> å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæ‰€æœ‰è®¡ç®—éƒ½æ˜¯åœ¨32ä½æ— ç¬¦å·ç±»å‹ä¸Šå®Œæˆçš„ï¼Œç„¶åæ‰éšå¼æå‡ä¸º<i>uint64_t</i> ï¼Œå¹¶å°†æœ€é«˜æœ‰æ•ˆä½æ¸…é›¶ã€‚ <br><br> è¯¥é—®é¢˜å¯ä»¥è§£å†³å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> NImms = ~<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>&gt;(Size<span class="hljs-number"><span class="hljs-number">-1</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br> æ­¤ç±»å‹çš„å¦ä¸€ä¸ªé”™è¯¯ï¼šV629 [CWE-190]è€ƒè™‘æ£€æŸ¥'Immr &lt;&lt; 6'è¡¨è¾¾å¼ã€‚  32ä½å€¼çš„ä½ç§»ï¼Œéšåæ‰©å±•ä¸º64ä½ç±»å‹ã€‚  AArch64AddressingModes.h 269 <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>19ï¼š</b> <b><i>è¿˜æœ‰å…¶ä»–</i></b> <b>å…³é”®è¯</b> <b><i>å—</i></b> <b>ï¼Ÿ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AMDGPUAsmParser::cvtDPP(MCInst &amp;Inst, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OperandVector &amp;Operands) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Op.isReg() &amp;&amp; Op.Reg.RegNo == AMDGPU::VCC) { <span class="hljs-comment"><span class="hljs-comment">// VOP2b (v_add_u32, v_sub_u32 ...) dpp use "vcc" token. // Skip it. continue; } if (isRegOrImmWithInputMods(Desc, Inst.getNumOperands())) { // &lt;= Op.addRegWithFPInputModsOperands(Inst, 2); } else if (Op.isDPPCtrl()) { Op.addImmOperands(Inst, 1); } else if (Op.isImm()) { // Handle optional arguments OptionalIdx[Op.getImmTy()] = I; } else { llvm_unreachable("Invalid operand type"); } .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V646</a> [CWE-670]è€ƒè™‘æ£€æŸ¥åº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚ å¯èƒ½ç¼ºå°‘â€œ elseâ€å…³é”®å­—ã€‚  AMDGPUAsmParser.cpp 5655 <br><br> è¿™ä¸æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ ç”±äºç¬¬ä¸€ä¸ª<i>if</i>è¯­å¥çš„<i>then</i>å—ä»¥<i>continue</i>ç»“å°¾ï¼Œå› æ­¤æ˜¯å¦å…·æœ‰<i>else</i>å…³é”®å­—æ— å…³ç´§è¦ã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè¡Œä¸ºéƒ½æ˜¯ç›¸åŒçš„ã€‚ ä½†æ˜¯ï¼Œç¼ºå°‘<i>å…¶ä»–å†…å®¹</i>ä¼šä½¿ä»£ç çš„å¯è¯»æ€§é™ä½ï¼Œå› æ­¤æœ‰æ½œåœ¨çš„å±é™©ã€‚ å¦‚æœæœ‰ä¸€å¤©<i>ç»§ç»­</i>æ¶ˆå¤±ï¼Œè¡Œä¸ºå°†å‘ç”Ÿå·¨å¤§å˜åŒ–ã€‚ æˆ‘å¼ºçƒˆå»ºè®®æ·»åŠ <i>else</i> ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>20ï¼šå››ä¸ªç›¸åŒçš„é”™åˆ«å­—</b> <br><br><pre> <code class="cpp hljs">LLVM_DUMP_METHOD <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Symbol::dump(raw_ostream &amp;OS) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isUndefined()) Result += <span class="hljs-string"><span class="hljs-string">"(undef) "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isWeakDefined()) Result += <span class="hljs-string"><span class="hljs-string">"(weak-def) "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isWeakReferenced()) Result += <span class="hljs-string"><span class="hljs-string">"(weak-ref) "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isThreadLocalValue()) Result += <span class="hljs-string"><span class="hljs-string">"(tlv) "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Kind) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SymbolKind::GlobalSymbol: Result + Name.str(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; case SymbolKind::ObjectiveCClass: Result + "(ObjC Class) " + Name.str(); // &lt;= break; case SymbolKind::ObjectiveCClassEHType: Result + "(ObjC Class EH) " + Name.str(); // &lt;= break; case SymbolKind::ObjectiveCInstanceVariable: Result + "(ObjC IVar) " + Name.str(); // &lt;= break; } OS &lt;&lt; Result; }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <br><br><ul><li>  V655 [CWE-480]å­—ç¬¦ä¸²å·²è¿æ¥ï¼Œä½†æœªä½¿ç”¨ã€‚ è€ƒè™‘æ£€æŸ¥â€œ Result + Name.strï¼ˆï¼‰â€è¡¨è¾¾å¼ã€‚  Symbol.cpp 32 </li><li>  V655 [CWE-480]å­—ç¬¦ä¸²å·²è¿æ¥ï¼Œä½†æœªä½¿ç”¨ã€‚ è€ƒè™‘æ£€æŸ¥'Result +â€œï¼ˆObjC Classï¼‰â€ + Name.strï¼ˆï¼‰'è¡¨è¾¾å¼ã€‚  Symbol.cpp 35 </li><li>  V655 [CWE-480]å­—ç¬¦ä¸²å·²è¿æ¥ï¼Œä½†æœªä½¿ç”¨ã€‚ è€ƒè™‘æ£€æŸ¥'Result +â€œï¼ˆObjC Class EHï¼‰â€ + Name.strï¼ˆï¼‰'è¡¨è¾¾å¼ã€‚  Symbol.cpp 38 </li><li>  V655 [CWE-480]å­—ç¬¦ä¸²å·²è¿æ¥ï¼Œä½†æœªä½¿ç”¨ã€‚ è€ƒè™‘æ£€æŸ¥â€œç»“æœ+â€œï¼ˆObjC IVarï¼‰â€ + Name.strï¼ˆï¼‰â€è¡¨è¾¾å¼ã€‚  Symbol.cpp 41 </li></ul><br> ç¨‹åºå‘˜ä¸å°å¿ƒä½¿ç”¨äº†+è¿ç®—ç¬¦è€Œä¸æ˜¯+ =ï¼Œå¹¶æœ€ç»ˆå¾—åˆ°äº†å››ä¸ªæ— æ„ä¹‰çš„æ„é€ ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>21ï¼šæœªå®šä¹‰çš„è¡Œä¸º</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getReqFeatures</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;StringRef, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &amp;FeaturesMap, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;Record *&gt; &amp;ReqFeatures)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;R : ReqFeatures) { StringRef AsmCondString = R-&gt;getValueAsString(<span class="hljs-string"><span class="hljs-string">"AssemblerCondString"</span></span>); SmallVector&lt;StringRef, <span class="hljs-number"><span class="hljs-number">4</span></span>&gt; Ops; SplitString(AsmCondString, Ops, <span class="hljs-string"><span class="hljs-string">","</span></span>); assert(!Ops.empty() &amp;&amp; <span class="hljs-string"><span class="hljs-string">"AssemblerCondString cannot be empty"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;Op : Ops) { assert(!Op.empty() &amp;&amp; <span class="hljs-string"><span class="hljs-string">"Empty operator"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FeaturesMap.find(Op) == FeaturesMap.end()) FeaturesMap[Op] = FeaturesMap.size(); } } }</code> </pre> <br> å°è¯•è‡ªè¡Œå‘ç°é”™è¯¯ã€‚ æˆ‘æ·»åŠ äº†å›¾åƒï¼Œä»¥ä¾¿æ‚¨ä¸ä¼šç«‹å³çœ‹åˆ°ç­”æ¡ˆï¼š <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5d/183/d4e/d5d183d4e2d3107bc512e52d893fda25.png" alt="???"></div><br><br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V708</a> [CWE-758]ä½¿ç”¨äº†å±é™©çš„æ„é€ ï¼š'FeaturesMap [Op] = <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FeatureMap.size</a> ï¼ˆï¼‰'ï¼Œå…¶ä¸­'FeaturesMap'æ˜¯'map'ç±»çš„ã€‚ è¿™å¯èƒ½å¯¼è‡´ä¸ç¡®å®šçš„è¡Œä¸ºã€‚  RISCVCompressInstEmitter.cpp 490 <br><br> é”™è¯¯çš„è¡Œæ˜¯è¿™ä¸€è¡Œï¼š <br><br><pre> <code class="cpp hljs">FeaturesMap[Op] = FeaturesMap.size();</code> </pre> <br> å¦‚æœæœªæ‰¾åˆ°<i>Op</i>å…ƒç´ ï¼Œåˆ™ç¨‹åºå°†åœ¨æ˜ å°„ä¸­åˆ›å»ºä¸€ä¸ªæ–°å…ƒç´ ï¼Œå¹¶ä¸ºå…¶åˆ†é…è¯¥æ˜ å°„ä¸­å…ƒç´ çš„æ€»æ•°ã€‚ æ‚¨åªæ˜¯ä¸çŸ¥é“åœ¨æ·»åŠ æ–°å…ƒç´ ä¹‹å‰è¿˜æ˜¯ä¹‹åå°†è°ƒç”¨<i>size</i>å‡½æ•°ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>22-æ²¡æœ‰</b>  <b>24ï¼šé‡å¤çš„ä½œä¸š</b> <br><br><pre> <code class="cpp hljs">Error MachOObjectFile::checkSymbolTable() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MachO::nlist STE = getSymbolTableEntry(SymDRI); NType = STE.n_type; <span class="hljs-comment"><span class="hljs-comment">// &lt;= NType = STE.n_type; // &lt;= NSect = STE.n_sect; NDesc = STE.n_desc; NStrx = STE.n_strx; NValue = STE.n_value; } .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V519</a> [CWE-563]è¿ç»­ä¸¤æ¬¡ä¸º'NType'å˜é‡åˆ†é…å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š1663ã€1664ã€‚MachOObjectFile.cpp 1664 <br><br> æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯çœŸæ­£çš„é”™è¯¯-è€Œæ˜¯é‡å¤çš„ä½œä¸šã€‚ ä½†è¿™ä»ç„¶æ˜¯ä¸€ä¸ªç¼ºé™·ã€‚ <br><br> å…¶ä»–ä¸¤ç§æƒ…å†µï¼š <br><br><ul><li>  V519 [CWE-563]è¿ç»­ä¸¤æ¬¡ä¸º'B.NDesc'å˜é‡åˆ†é…å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š1488ã€1489ã€‚llvm-nm.cpp 1489 </li><li>  V519 [CWE-563]è¿ç»­ä¸¤æ¬¡ä¸ºå˜é‡åˆ†é…å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š59ï¼Œ61ã€‚coff2yaml.cpp 61 </li></ul><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>25-æ²¡æœ‰</b>  <b>27ï¼šæ›´å¤šé‡å¤çš„ä½œä¸š</b> <br><br> è¿™äº›å¤„ç†é‡å¤åˆ†é…çš„ç‰ˆæœ¬ç•¥æœ‰ä¸åŒã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Vectorizer::vectorizeLoadChain( ArrayRef&lt;Instruction *&gt; Chain, SmallPtrSet&lt;Instruction *, <span class="hljs-number"><span class="hljs-number">16</span></span>&gt; *InstructionsProcessed) { .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Alignment = getAlignment(L0); .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> NewAlign = getOrEnforceKnownAlignment(L0-&gt;getPointerOperand(), StackAdjustedAlignment, DL, L0, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, &amp;DT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewAlign != <span class="hljs-number"><span class="hljs-number">0</span></span>) Alignment = NewAlign; Alignment = NewAlign; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV519 [CWE-563]'Alignment'å˜é‡è¿ç»­ä¸¤æ¬¡è¢«èµ‹å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š1158ã€1160ã€‚LoadStoreVectorizer.cpp 1160 <br><br> è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ä»£ç æ®µï¼Œå®ƒå¯èƒ½åŒ…å«é€»è¾‘é”™è¯¯ã€‚ é¦–å…ˆæ ¹æ®æ¡ä»¶ä¸º<i>Alignment</i>å˜é‡åˆ†é…å€¼ï¼Œç„¶åå†æ¬¡ä¸ºå…¶åˆ†é…å€¼ï¼Œä½†æ— éœ€ä»»ä½•äº‹å…ˆæ£€æŸ¥ã€‚ <br><br> ç±»ä¼¼ç¼ºé™·ï¼š <br><br><ul><li>  V519 [CWE-563]'æ•ˆæœ'å˜é‡è¿ç»­ä¸¤æ¬¡è¢«èµ‹å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š152ï¼Œ165ã€‚WebAssemblyRegStackify.cpp 165 </li><li>  V519 [CWE-563]'ExpectNoDerefChunk'å˜é‡å·²è¿ç»­ä¸¤æ¬¡åˆ†é…å€¼ã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ æ£€æŸ¥è¡Œï¼š4970ï¼Œ4973ã€‚SemaType.cpp 4973 </li></ul><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>28ï¼šå§‹ç»ˆä¸ºçœŸçŠ¶æ€</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPrefixes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct InternalInstruction* insn)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> byte = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> nextByte; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (byte == <span class="hljs-number"><span class="hljs-number">0xf3</span></span> &amp;&amp; (nextByte == <span class="hljs-number"><span class="hljs-number">0x88</span></span> || nextByte == <span class="hljs-number"><span class="hljs-number">0x89</span></span> || nextByte == <span class="hljs-number"><span class="hljs-number">0xc6</span></span> || nextByte == <span class="hljs-number"><span class="hljs-number">0xc7</span></span>)) { insn-&gt;xAcquireRelease = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextByte != <span class="hljs-number"><span class="hljs-number">0x90</span></span>) <span class="hljs-comment"><span class="hljs-comment">// PAUSE instruction support // &lt;= break; } .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a> [CWE-571]è¡¨è¾¾å¼'nextByteï¼= 0x90'å§‹ç»ˆä¸ºtrueã€‚  X86DisassemblerDecoder.cpp 379 <br><br> æ”¯ç¥¨æ²¡æœ‰æ„ä¹‰ã€‚  <i>nextByte</i>å˜é‡ä»ä¸ç­‰äº<i>0x90</i> ï¼šä»é€»è¾‘<i>ä¸Šè®²ï¼Œ</i>å®ƒä»…æ¥è‡ªä¸Šä¸€ä¸ªæ£€æŸ¥ã€‚ è¿™ä¸€å®šæ˜¯é€»è¾‘é”™è¯¯ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>29-å¦....ï¼šå§‹ç»ˆä¸ºçœŸ/å‡æ¡ä»¶</b> <br><br> å…³äºæ•´ä¸ªæ¡ä»¶ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a> ï¼‰æˆ–éƒ¨åˆ†æ¡ä»¶ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V560</a> ï¼‰å§‹ç»ˆä¸ºçœŸæˆ–å‡çš„è­¦å‘Šå¾ˆå¤šã€‚ è¿™äº›ä¸æ˜¯çœŸæ­£çš„é”™è¯¯ï¼Œè€Œæ˜¯é€šå¸¸ä»…ä»…æ˜¯é”™è¯¯çš„ä»£ç ï¼Œå®æ‰©å±•çš„å½±å“ç­‰ç­‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä»åº”æ£€æŸ¥æ‰€æœ‰æ­¤ç±»è­¦å‘Šï¼Œå› ä¸ºå…¶ä¸­æŸäº›è­¦å‘Šå¯èƒ½æŒ‡å‘çœŸæ­£çš„é€»è¾‘é”™è¯¯ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µçœ‹èµ·æ¥ä¸æ­£ç¡®ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DecodeStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecodeGPRPairRegisterClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MCInst &amp;Inst, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> RegNo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Address, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *Decoder)</span></span></span><span class="hljs-function"> </span></span>{ DecodeStatus S = MCDisassembler::Success; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RegNo &gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MCDisassembler::Fail; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((RegNo &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) || RegNo == <span class="hljs-number"><span class="hljs-number">0xe</span></span>) S = MCDisassembler::SoftFail; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V560</a> [CWE-570]æ¡ä»¶è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†å§‹ç»ˆä¸ºfalseï¼šRegNo == 0xeã€‚  ARMDisassembler.cpp 939 <br><br>  <i>0xE</i>å¸¸æ•°æ˜¯åè¿›åˆ¶æ•°å­—14ã€‚æ£€æŸ¥<i>RegNo == 0xe</i>æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¦‚æœ<i>RegNo&gt; 13</i> ï¼Œåˆ™å‡½æ•°å°†è¿”å›ã€‚ <br><br> æˆ‘çœ‹åˆ°äº†å¾ˆå¤šå…¶ä»–çš„V547å’ŒV560è­¦å‘Šï¼Œä½†æ˜¯åƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V595ä¸€æ ·</a> ï¼Œæˆ‘å¯¹æ£€æŸ¥å®ƒä»¬å¹¶ä¸æ„Ÿåˆ°å…´å¥‹ï¼Œå› ä¸ºæˆ‘å·²ç»æœ‰è¶³å¤Ÿçš„ææ–™å†™ä¸€ç¯‡æ–‡ç« äº†ï¼šï¼‰ã€‚ å› æ­¤ï¼Œåœ¨LLVMä¸­æ²¡æœ‰æ­¤ç±»é”™è¯¯æ€»æ•°ã€‚ <br><br> è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆæ£€æŸ¥è¿™äº›è­¦å‘Šå¾ˆæ— èŠã€‚ å¯¹ä»¥ä¸‹ä»£ç å‘å‡ºè­¦å‘Šæ—¶ï¼Œåˆ†æä»ªå®Œå…¨æ­£ç¡®ã€‚ ä½†è¿™ä»ç„¶ä¸æ˜¯é”™è¯¯ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> UnwrappedLineParser::parseBracedList(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ContinueOnSemicolons, tok::TokenKind ClosingBraceKind) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasError = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... HasError = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ContinueOnSemicolons) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !HasError; .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV547 [CWE-570]è¡¨è¾¾å¼'ï¼HasError'å§‹ç»ˆä¸ºfalseã€‚  UnwrappedLineParser.cpp 1635 <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>30ï¼šå¯ç–‘çš„å›æŠ¥</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isImplicitlyDef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MachineRegisterInfo &amp;MRI, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MachineRegisterInfo::def_instr_iterator It = MRI.def_instr_begin(Reg), E = MRI.def_instr_end(); It != E; ++It) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (*It).isImplicitDef(); } .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V612</a> [CWE-670]å¾ªç¯å†…æ— æ¡ä»¶çš„â€œè¿”å›â€ã€‚  R600OptimizeVectorRegisters.cpp 63 <br><br> å®ƒå¯èƒ½æ˜¯é”™è¯¯æˆ–ç‰¹å®šçš„ç¼–ç æŠ€æœ¯ï¼Œæ—¨åœ¨ä¸å…¶ä»–ç¨‹åºå‘˜äº¤æµä¸€äº›æƒ³æ³•ã€‚ å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒä»€ä¹ˆä¹Ÿæ²¡è¯´ï¼Œåªæ˜¯é‚£æ˜¯ä¸€æ®µéå¸¸å¯ç–‘çš„ä»£ç ã€‚ è¯·ä¸è¦å†™è¿™æ ·çš„ä»£ç :)ã€‚ <br><br> æ„Ÿåˆ°ç´¯äº†å—ï¼Ÿ å¥½ï¼Œè¯¥å–äº›èŒ¶æˆ–å’–å•¡äº†ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a2/f86/58f/8a2f8658fdacb0dde918807666d1cd39.png" alt="å’–å•¡"></div><br><br><h2> æ–°è¯Šæ–­ç¨‹åºå‘ç°çš„ç¼ºé™· </h2><br> æˆ‘è®¤ä¸º30ä¸ªç¤ºä¾‹è¶³ä»¥æ»¡è¶³ç°æœ‰çš„è¯Šæ–­è¦æ±‚ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥é€šè¿‡æ–°çš„è¯Šæ–­æ‰¾åˆ°æœ‰è¶£çš„ä¸œè¥¿ï¼Œè¿™äº›è¯Šæ–­æ˜¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šæ¬¡</a>æ£€æŸ¥ä¹‹åæ·»åŠ çš„ã€‚ åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼ŒC ++åˆ†æå™¨æ¨¡å—æ‰©å±•äº†66ç§æ–°çš„è¯Šæ–­ç¨‹åºã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>31ï¼šæ— æ³•è®¿é—®çš„ä»£ç </b> <br><br><pre> <code class="cpp hljs">Error CtorDtorRunner::run() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> CtorDtorMap = ES.lookup(JITDylibSearchList({{&amp;JD, <span class="hljs-literal"><span class="hljs-literal">true</span></span>}}), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(Names), NoDependenciesToRegister, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Error::success(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CtorDtorMap.takeError(); CtorDtorsByPriority.clear(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Error::success(); }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V779</a> [CWE-561]æ£€æµ‹åˆ°æ— æ³•è®¿é—®çš„ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  ExecutionUtils.cpp 146 <br><br> å¦‚æ‚¨æ‰€è§ï¼Œ <i>if</i>è¯­å¥çš„ä¸¤ä¸ªåˆ†æ”¯éƒ½ä»¥<i>return</i>è¯­å¥ç»“å°¾ï¼Œè¿™æ„å‘³ç€<i>CtorDtorsByPriority</i>å®¹å™¨å°†æ°¸è¿œä¸ä¼šè¢«æ¸…é™¤ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>32ï¼šæ— æ³•è®¿é—®çš„ä»£ç </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> LLParser::ParseSummaryEntry() { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Lex.getKind()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> lltok::kw_gv: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ParseGVEntry(SummaryID); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> lltok::kw_module: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ParseModuleEntry(SummaryID); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> lltok::kw_typeid: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ParseTypeIdEntry(SummaryID); <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; // &lt;= default: return Error(Lex.getLoc(), "unexpected summary kind"); } Lex.setIgnoreColonInIdentifiers(false); // &lt;= return false; }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV779 [CWE-561]æ£€æµ‹åˆ°æ— æ³•è®¿é—®çš„ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  LLParser.cpp 835 <br><br> è¿™ä¸ªå¾ˆæœ‰è¶£ã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ParseTypeIdEntry(SummaryID); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre> <br> è¿™æ®µä»£ç ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå¥‡æ€ªçš„ã€‚  <i>break</i>è¯­å¥æ˜¯ä¸å¿…è¦çš„ï¼Œå¯ä»¥å®‰å…¨åœ°åˆ é™¤ã€‚ ä½†è¿™ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ <br><br> è¯¥è­¦å‘Šç”±ä»¥ä¸‹å‡ è¡Œè§¦å‘ï¼š <br><br><pre> <code class="cpp hljs">Lex.setIgnoreColonInIdentifiers(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br> ç¡®å®ï¼Œæ­¤ä»£ç ä¸å¯è®¿é—®ã€‚  <i>switch</i>è¯­å¥çš„æ‰€æœ‰å¤§å°å†™æ ‡ç­¾éƒ½ä»¥<i>return</i>ç»“å°¾ï¼Œè€Œæ¯«æ— æ„ä¹‰çš„å•ç‹¬<i>ä¸­æ–­</i>çœ‹èµ·æ¥ä¸å†é‚£ä¹ˆæ— å®³äº†ï¼ å¦‚æœå…¶ä¸­ä¸€ä¸ªåˆ†æ”¯çš„ç»“å°¾æ˜¯<i>ä¼‘æ¯</i>è€Œä¸æ˜¯<i>è¿”å›ï¼Œè¯¥</i>æ€ä¹ˆåŠï¼Ÿ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>33ï¼šæ„å¤–æ¸…é™¤æœ€é«˜æœ‰æ•ˆä½</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStubAlignment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arch == Triple::systemz) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } Expected&lt;<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span>&gt; RuntimeDyldImpl::emitSection(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ObjectFile &amp;Obj, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SectionRef &amp;Section, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsCode) { .... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> DataSize = Section.getSize(); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StubBufSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) DataSize &amp;= ~(getStubAlignment() - <span class="hljs-number"><span class="hljs-number">1</span></span>); .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V784</a>ä½æ©ç çš„å¤§å°å°äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°ã€‚ è¿™å°†å¯¼è‡´ä¸¢å¤±æ›´é«˜çš„ä½ã€‚ è¿è¡Œç³»ç»ŸDyld.cpp 815 <br><br> æ³¨æ„ï¼Œ <i>getStubAlignment</i>å‡½æ•°è¿”å›ä¸€ä¸ª<i>æ— ç¬¦å·</i>å€¼ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¡¨è¾¾å¼å°†å¦‚ä½•æ±‚å€¼ï¼Œå‡è®¾å‡½æ•°å°†è¿”å›å€¼8ï¼š <br><br>  ã€œï¼ˆgetStubAlignmentï¼ˆï¼‰-1ï¼‰ <br><br>  ã€œï¼ˆ8u-1ï¼‰ <br><br>  0xFFFFFFF8u <br><br> ç°åœ¨è¯·æ³¨æ„ï¼Œ <i>DataSize</i>å˜é‡çš„ç±»å‹ä¸º64ä½æ— ç¬¦å·ã€‚ å› æ­¤ï¼Œäº‹å®è¯æ˜ï¼Œæ‰§è¡Œæ“ä½œDataSizeï¼†0xFFFFFFF8å°†å¯¼è‡´æ¸…é™¤è¯¥å€¼çš„æ‰€æœ‰32ä¸ªæœ€é«˜æœ‰æ•ˆä½ã€‚ æˆ‘ä¸è®¤ä¸ºç¨‹åºå‘˜æƒ³è¦é‚£æ ·ã€‚ ä¹Ÿè®¸ä»–ä»¬çš„æ„æ€æ˜¯DataSizeï¼†0xFFFFFFFFFFFFFFFFFFF8uã€‚ <br><br> è¦ä¿®å¤è¯¥é”™è¯¯ï¼Œåº”æŒ‰ä»¥ä¸‹æ–¹å¼é‡å†™ä»£ç ï¼š <br><br><pre> <code class="cpp hljs">DataSize &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>&gt;(getStubAlignment()) - <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br> æˆ–åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs">DataSize &amp;= ~(getStubAlignment() - <span class="hljs-number"><span class="hljs-number">1U</span></span>LL);</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>34ï¼šé”™è¯¯çš„æ˜¾å¼ç±»å‹è½¬æ¢</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scaleShuffleMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Scale, ArrayRef&lt;T&gt; Mask, SmallVectorImpl&lt;T&gt; &amp;ScaledMask)</span></span></span><span class="hljs-function"> </span></span>{ assert(<span class="hljs-number"><span class="hljs-number">0</span></span> &lt; Scale &amp;&amp; <span class="hljs-string"><span class="hljs-string">"Unexpected scaling factor"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NumElts = Mask.size(); ScaledMask.assign(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;(NumElts * Scale), <span class="hljs-number"><span class="hljs-number">-1</span></span>); .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V1028</a> [CWE-190]å¯èƒ½çš„æº¢å‡ºã€‚ è€ƒè™‘å°†'NumElts * Scale'è¿ç®—ç¬¦çš„ç±»å‹è½¬æ¢ä¸º'size_t'ç±»å‹ï¼Œè€Œä¸æ˜¯ç»“æœç±»å‹ã€‚  1577å¹´ <br><br> åœ¨å°†ç±»å‹ä¸º<i>intçš„</i>å˜é‡ç›¸ä¹˜æ—¶ï¼Œä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢æ¥é¿å…æº¢å‡ºã€‚ ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¸èµ·ä½œç”¨ï¼Œå› ä¸ºé¦–å…ˆä¼šå‘ç”Ÿä¹˜æ³•ï¼Œç„¶åæ‰å°†32ä½ç»“æœæå‡ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><i>size_t</i></a>ç±»å‹ã€‚ <br><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>35ï¼šé”™è¯¯çš„å¤åˆ¶ç²˜è´´</b> <br><br><pre> <code class="cpp hljs">Instruction *InstCombiner::visitFCmpInst(FCmpInst &amp;I) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!match(Op0, m_PosZeroFP()) &amp;&amp; isKnownNeverNaN(Op0, &amp;TLI)) { I.setOperand(<span class="hljs-number"><span class="hljs-number">0</span></span>, ConstantFP::getNullValue(Op0-&gt;getType())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;I; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!match(Op1, m_PosZeroFP()) &amp;&amp; isKnownNeverNaN(Op1, &amp;TLI)) { I.setOperand(<span class="hljs-number"><span class="hljs-number">1</span></span>, ConstantFP::getNullValue(Op0-&gt;getType())); <span class="hljs-comment"><span class="hljs-comment">// &lt;= return &amp;I; } .... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V778</a> [CWE-682]æ‰¾åˆ°äº†ä¸¤ä¸ªç±»ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨â€œ Op1â€å˜é‡è€Œä¸æ˜¯â€œ Op0â€ã€‚  InstCombineCompares.cpp 5507 <br><br> è¿™ä¸ªæ–°çš„å¾ˆé…·çš„è¯Šæ–­ç¨‹åºå¯ä»¥æ£€æµ‹ä½¿ç”¨å¤åˆ¶ç²˜è´´ç¼–å†™ä»£ç ç‰‡æ®µçš„æƒ…å†µï¼Œæ‰€æœ‰åç§°æ›´æ”¹åéƒ½ä¿å­˜ä¸€ä¸ªã€‚ <br><br> æ³¨æ„ï¼Œåœ¨ç¬¬äºŒä¸ªå—ä¸­ï¼Œé™¤ä¸€ä¸ªä»¥å¤–çš„æ‰€æœ‰<i>Op0</i>éƒ½æ›´æ”¹ä¸º<i>Op1</i> ã€‚ ä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!match(Op1, m_PosZeroFP()) &amp;&amp; isKnownNeverNaN(Op1, &amp;TLI)) { I.setOperand(<span class="hljs-number"><span class="hljs-number">1</span></span>, ConstantFP::getNullValue(Op1-&gt;getType())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;I; }</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>36ï¼šå˜é‡æ··åˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Status</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode; Status() : Mask(<span class="hljs-number"><span class="hljs-number">0</span></span>), Mode(<span class="hljs-number"><span class="hljs-number">0</span></span>){}; Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { Mode &amp;= Mask; }; .... };</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V1001</a> [CWE-563]åˆ†é…äº†'Mode'å˜é‡ï¼Œä½†åœ¨åŠŸèƒ½ç»“æŸæ—¶æœªä½¿ç”¨ã€‚  SIModeRegister.cpp 48 <br><br> å‡½æ•°å‚æ•°çš„åç§°ä¸ç±»æˆå‘˜çš„åç§°ç›¸åŒæ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºæ‚¨å¯èƒ½ä¼šæ··æ·†å®ƒä»¬ã€‚ æ‚¨åœ¨è¿™é‡Œçœ‹åˆ°çš„å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ ä»¥ä¸‹è¡¨è¾¾å¼æ¯«æ— æ„ä¹‰ï¼š <br><br><pre> <code class="cpp hljs">Mode &amp;= Mask;</code> </pre> <br> å‚æ•°å·²æ›´æ”¹ï¼Œä½†æ­¤åä»æœªä½¿ç”¨è¿‡ã€‚ è¯¥ä»£ç æ®µå¯èƒ½åº”å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Mode &amp;= Mask; };</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>37ï¼šå˜é‡æ··åˆ</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionBase</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> Size = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SymbolTableSection</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SectionBase { .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SymbolTableSection::addSymbol(Twine Name, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> Bind, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> Type, SectionBase *DefinedIn, <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> Value, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> Visibility, <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> Shndx, <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> Size) { .... Sym.Value = Value; Sym.Visibility = Visibility; Sym.Size = Size; Sym.Index = Symbols.size(); Symbols.emplace_back(llvm::make_unique&lt;Symbol&gt;(Sym)); Size += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;EntrySize; }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV1001 [CWE-563]åˆ†é…äº†'Size'å˜é‡ï¼Œä½†åœ¨åŠŸèƒ½ç»“æŸæ—¶æœªä½¿ç”¨ã€‚  Object.cpp 424 <br><br> è¿™ä¸å‰é¢çš„ç¤ºä¾‹ç›¸ä¼¼ã€‚ æ­£ç¡®ç‰ˆæœ¬ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Size += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;EntrySize;</code> </pre> <br>  <b>ç‰‡æ®µç¼–å·</b>  <b>38-æ²¡æœ‰</b>  <b>47ï¼šç¼ºå°‘æŒ‡é’ˆæ£€æŸ¥</b> <br><br> æˆ‘ä»¬ç¨æ—©çœ‹äº†ä¸€äº›<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V595</a>è­¦å‘Šçš„ç¤ºä¾‹ã€‚ å®ƒæ£€æµ‹åˆ°çš„æƒ…å†µæ˜¯æŒ‡é’ˆå…ˆè¢«å–æ¶ˆå¼•ç”¨ç„¶åæ‰è¢«æ£€æŸ¥ã€‚ æ–°çš„è¯Šæ–­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V1004</a>ä¸æ­¤ç›¸åï¼Œå®ƒä¹Ÿå¯ä»¥æ£€æµ‹å¤§é‡é”™è¯¯ã€‚ å®ƒæŸ¥æ‰¾å·²æµ‹è¯•çš„æŒ‡é’ˆï¼Œå¿…è¦æ—¶ä¸å†å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚ è¿™æ˜¯åœ¨LLVMçš„ä»£ç ä¸­å‘ç°çš„ä¸€äº›æ­¤ç±»é”™è¯¯ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGEPCost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Type *PointeeType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value *Ptr, ArrayRef&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value *&gt; Operands)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Ptr != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= assert(....); BaseGV = dyn_cast&lt;GlobalValue&gt;(Ptr-&gt;stripPointerCasts()); } bool HasBaseReg = (BaseGV == nullptr); auto PtrSizeBits = DL.getPointerTypeSizeInBits(Ptr-&gt;getType()); // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV1004 [CWE-476]åœ¨é’ˆå¯¹nullptrè¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†'Ptr'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š729ã€738ã€‚TargetTransformInfoImpl.h 738 <br><br>  <i>Ptr</i>å¯ä»¥ä¸º<i>nullptr</i> ï¼Œç”±æ£€æŸ¥æŒ‡ç¤ºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Ptr != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>)</code> </pre> <br> ä½†æ˜¯ï¼Œå–æ¶ˆäº†å¯¹åŒä¸€æŒ‡é’ˆçš„å¼•ç”¨ï¼Œè€Œæ— éœ€è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€æŸ¥ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> PtrSizeBits = DL.getPointerTypeSizeInBits(Ptr-&gt;getType());</code> </pre> <br> å¦ä¸€ä¸ªç±»ä¼¼çš„æƒ…å†µã€‚ <br><br><pre> <code class="cpp hljs">llvm::DISubprogram *CGDebugInfo::getFunctionFwdDeclOrStub(GlobalDecl GD, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Stub) { .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> *FD = dyn_cast&lt;FunctionDecl&gt;(GD.getDecl()); SmallVector&lt;QualType, <span class="hljs-number"><span class="hljs-number">16</span></span>&gt; ArgTypes; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FD) <span class="hljs-comment"><span class="hljs-comment">// &lt;= for (const ParmVarDecl *Parm : FD-&gt;parameters()) ArgTypes.push_back(Parm-&gt;getType()); CallingConv CC = FD-&gt;getType()-&gt;castAs&lt;FunctionType&gt;()-&gt;getCallConv(); // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV1004 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†â€œ FDâ€æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š3228ã€3231ã€‚CGDebugInfo.cpp 3231 <br><br> æ³¨æ„<i>FD</i>æŒ‡é’ˆã€‚ è¯¥é”™è¯¯å¾ˆç®€å•ï¼Œå› æ­¤å¯¹æ­¤æ²¡æœ‰è¯„è®ºã€‚ <br><br> è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computePolynomialFromPointer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value &amp;Ptr, Polynomial &amp;Result, Value *&amp;BasePtr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DataLayout &amp;DL)</span></span></span><span class="hljs-function"> </span></span>{ PointerType *PtrTy = dyn_cast&lt;PointerType&gt;(Ptr.getType()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!PtrTy) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= Result = Polynomial(); BasePtr = nullptr; } unsigned PointerBits = DL.getIndexSizeInBits(PtrTy-&gt;getPointerAddressSpace()); // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼šV1004 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†'PtrTy'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š960ã€965ã€‚InterleavedLoadCombinePass.cpp 965 <br><br> æ‚¨å¦‚ä½•é¿å…è¿™æ ·çš„é”™è¯¯ï¼Ÿ åœ¨æ£€æŸ¥ä»£ç æ—¶è¦éå¸¸å°å¿ƒï¼Œå¹¶å®šæœŸé€šè¿‡PVS-Studioè¿›è¡Œæ£€æŸ¥ã€‚ <br><br> æˆ‘è®¤ä¸ºæˆ‘ä»¬ä¸åº”è¯¥ç ”ç©¶è¿™ç§ç±»å‹çš„å…¶ä»–ç¤ºä¾‹ï¼Œå› æ­¤è¿™é‡Œåªæ˜¯è­¦å‘Šåˆ—è¡¨ï¼š <br><ul><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrè¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†â€œ Exprâ€æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š1049ã€1078ã€‚DebugInfoMetadata.cpp 1078 </li><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†'PI'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š733ã€753ã€‚LegacyPassManager.cpp 753 </li><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†â€œ StatepointCallâ€æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š4371ã€4379ã€‚Verifier.cpp 4379 </li><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrå¯¹å…¶è¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†â€œ RVâ€æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š2263ï¼Œ2268ã€‚TGParser.cpp 2268 </li><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrè¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†'CalleeFn'æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š1081ã€1096ã€‚SimplifyLibCalls.cpp 1096 </li><li>  V1004 [CWE-476]åœ¨é’ˆå¯¹nullptrè¿›è¡ŒéªŒè¯ä¹‹åï¼Œä¸å®‰å…¨åœ°ä½¿ç”¨äº†â€œ TCâ€æŒ‡é’ˆã€‚ æ£€æŸ¥è¡Œï¼š1819ã€1824ã€‚Driver.cpp 1824 </li></ul><br>  <b>ç‰‡æ®µç¼–å·</b>  <b>48-æ²¡æœ‰</b>  <b>60ï¼šä¸é‡è¦ï¼Œä½†ä»ç„¶æ˜¯ç¼ºé™·ï¼ˆæ½œåœ¨çš„å†…å­˜æ³„æ¼ï¼‰</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;IRMutator&gt; createISelMutator() { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;IRMutationStrategy&gt;&gt; Strategies; Strategies.emplace_back( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InjectorIRStrategy(InjectorIRStrategy::getDefaultOps())); .... }</code> </pre> <br>  PVS-Studioè¯Šæ–­æ¶ˆæ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V1023</a> [CWE-460]é€šè¿‡â€œ emplace_backâ€æ–¹æ³•å°†æ²¡æœ‰æ‰€æœ‰è€…çš„æŒ‡é’ˆæ·»åŠ åˆ°â€œç­–ç•¥â€å®¹å™¨ä¸­ã€‚ å‘ç”Ÿå¼‚å¸¸æ—¶ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚  llvm-isel-fuzzer.cpp 58 <br><br> æ‚¨ä¸èƒ½ç®€å•åœ°ç¼–å†™<i>xxx.push_backï¼ˆæ–°Xï¼‰</i>ä»¥å°†å…ƒç´ é™„åŠ åˆ°ç±»å‹<i>std :: vector &lt;std :: unique_ptr &lt;X &gt;&gt;</i>çš„å®¹å™¨ä¸­ï¼Œå› ä¸ºæ²¡æœ‰ä»<i>X *</i>éšå¼è½¬æ¢ä¸º<i>std :: unique_ptr &lt; X&gt;</i> ã€‚ <br><br> æµè¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ç¼–å†™<i>xxx.emplace_backï¼ˆæ–°Xï¼‰ï¼Œ</i>å› ä¸ºå®ƒæ˜¯å¯ç¼–è¯‘çš„ï¼š <i>emplace_back</i>æ–¹æ³•ç›´æ¥ä»å‚æ•°æ„é€ å…ƒç´ ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ˜¾å¼æ„é€ å‡½æ•°ã€‚ <br><br> ä½†æ˜¯è¯¥è§£å†³æ–¹æ¡ˆå¹¶ä¸å®‰å…¨ã€‚ å¦‚æœå‘é‡å·²æ»¡ï¼Œå°†é‡æ–°åˆ†é…å†…å­˜ã€‚ è¯¥æ“ä½œå¯èƒ½å¤±è´¥ï¼Œå¹¶æœ€ç»ˆå¼•å‘<i>std :: bad_alloc</i>å¼‚å¸¸ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŒ‡é’ˆå°†ä¸¢å¤±å¹¶ä¸”ç¨‹åºå°†æ— æ³•åˆ é™¤åˆ›å»ºçš„å¯¹è±¡ã€‚ <br><br> ä¸€ä¸ªæ›´å®‰å…¨çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ª<i>unique_ptr</i> ï¼Œå®ƒå°†ä¿ç•™æŒ‡é’ˆï¼Œç›´åˆ°å‘é‡å°è¯•é‡æ–°åˆ†é…å†…å­˜ä¸ºæ­¢ï¼š <br><br><pre> <code class="cpp hljs">xxx.push_back(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;X&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> X))</code> </pre> <br>  C ++ 14æ ‡å‡†å…è®¸æ‚¨ä½¿ç”¨â€œ std :: make_uniqueâ€ï¼š <br><br><pre> <code class="cpp hljs">xxx.push_back(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;X&gt;())</code> </pre> <br> è¿™ç§ç±»å‹çš„ç¼ºé™·åœ¨LLVMä¸­ä¸èµ·ä½œç”¨ã€‚ å¦‚æœå†…å­˜åˆ†é…å¤±è´¥ï¼Œç¼–è¯‘å°†ä»…ç»ˆæ­¢ã€‚ å°±æ˜¯è¯´ï¼Œè¿™å¯¹äºå…·æœ‰è¾ƒé•¿<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­£å¸¸è¿è¡Œæ—¶é—´çš„</a>åº”ç”¨ç¨‹åºå¯èƒ½éå¸¸å…³é”®ï¼Œå› ä¸ºå½“å‘ç”Ÿå†…å­˜åˆ†é…å¤±è´¥æ—¶ï¼Œè¿™äº›åº”ç”¨ç¨‹åºä¸èƒ½ç®€å•åœ°ç»ˆæ­¢ã€‚ <br><br> å› æ­¤ï¼Œå³ä½¿è¯¥ä»£ç å¯¹LLVMè€Œè¨€å¹¶ä¸å±é™©ï¼Œæˆ‘è®¤ä¸ºæˆ‘ä»ç„¶åº”è¯¥å‘æ‚¨ä»‹ç»æ­¤é”™è¯¯æ¨¡å¼ä»¥åŠPVS-Studioç°åœ¨å¯ä»¥æ£€æµ‹åˆ°å®ƒçš„äº‹å®ã€‚ <br><br> å…¶ä»–ç±»ä¼¼æƒ…å†µï¼š <br><br><ul><li>  V1023 [CWE-460]é€šè¿‡'emplace_back'æ–¹æ³•å°†æ²¡æœ‰æ‰€æœ‰è€…çš„æŒ‡é’ˆæ·»åŠ åˆ°'Passes'å®¹å™¨ä¸­ã€‚ å‘ç”Ÿå¼‚å¸¸æ—¶ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚  PassManager.h 546 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'AAs' container by the 'emplace_back' method. A memory leak will occur in case of an exception. AliasAnalysis.h 324 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Entries' container by the 'emplace_back' method. A memory leak will occur in case of an exception. DWARFDebugFrame.cpp 519 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'AllEdges' container by the 'emplace_back' method. A memory leak will occur in case of an exception. CFGMST.h 268 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'VMaps' container by the 'emplace_back' method. A memory leak will occur in case of an exception. SimpleLoopUnswitch.cpp 2012 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Records' container by the 'emplace_back' method. A memory leak will occur in case of an exception. FDRLogBuilder.h 30 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'PendingSubmodules' container by the 'emplace_back' method. A memory leak will occur in case of an exception. ModuleMap.cpp 810 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Objects' container by the 'emplace_back' method. A memory leak will occur in case of an exception. DebugMap.cpp 88 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Strategies' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-isel-fuzzer.cpp 60 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 685 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 686 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 688 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 689 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 690 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 691 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 692 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 693 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Modifiers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. llvm-stress.cpp 694 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Operands' container by the 'emplace_back' method. A memory leak will occur in case of an exception. GlobalISelEmitter.cpp 1911 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Stash' container by the 'emplace_back' method. A memory leak will occur in case of an exception. GlobalISelEmitter.cpp 2100 </li><li> V1023 [CWE-460] A pointer without owner is added to the 'Matchers' container by the 'emplace_back' method. A memory leak will occur in case of an exception. GlobalISelEmitter.cpp 2702 </li></ul><br><h2> ç»“è®º </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å†™ä¸‹äº†60æ¡è­¦å‘Šï¼Œç„¶ååœæ­¢äº†ã€‚</font><font style="vertical-align: inherit;">PVS-Studioæ˜¯å¦åœ¨LLVMä¸­å‘ç°äº†å…¶ä»–é”™è¯¯ï¼Ÿ</font><font style="vertical-align: inherit;">æ˜¯çš„ï¼Œç¡®å®å¦‚æ­¤ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å½“æˆ‘å†™ä¸‹ç¤ºä¾‹æ—¶ï¼Œå¤œå¹•é™ä¸´ï¼Œæ‰€ä»¥æˆ‘å†³å®šæ”¾å¼ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¸Œæœ›æ‚¨å–œæ¬¢é˜…è¯»æœ¬æ–‡ï¼Œå¹¶é¼“åŠ±æ‚¨è‡ªå·±å°è¯•ä½¿ç”¨PVS-Studioåˆ†æä»ªã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¿é—®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤é¡µé¢</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹è½½åˆ†æä»ªå¹¶è·å¾—è¯•ç”¨å¯†é’¥ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€é‡è¦çš„æ˜¯ï¼Œå®šæœŸä½¿ç”¨é™æ€åˆ†æã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€æ¬¡æ€§æ£€æŸ¥</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¦‚æˆ‘ä»¬ä¸ºæ™®åŠé™æ€åˆ†æå’Œæ¨å¹¿PVS-Studioæ‰€åšçš„</font><b><font style="vertical-align: inherit;">æ£€æŸ¥ï¼‰</font></b><font style="vertical-align: inherit;">å¹¶éæ­£å¸¸æƒ…å†µã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¥æ‚¨æ”¹å–„ä»£ç çš„è´¨é‡å’Œå¯é æ€§ï¼</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450002/">https://habr.com/ru/post/zh-CN450002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN449992/index.html">NodeMCUç®€å•é©±åŠ¨ç¨‹åºæ¨¡å‹ï¼ˆSDMï¼‰å±•ç¤ºï¼šåŠ¨æ€ç”¨æˆ·ç•Œé¢</a></li>
<li><a href="../zh-CN449994/index.html">æ–½è€å¾·æ›¼çš„å…«ä¸ªé»„é‡‘æ³•åˆ™å°†å¸®åŠ©æ‚¨åˆ›å»ºæ›´å¥½çš„ç•Œé¢</a></li>
<li><a href="../zh-CN449996/index.html">äº†è§£FFTç®—æ³•</a></li>
<li><a href="../zh-CN449998/index.html">å¸¸è§é—®é¢˜è§£ç­”ï¼šæ—…è¡Œè€…æå®¢åœ¨æ—…è¡Œä¹‹å‰éœ€è¦äº†è§£å“ªäº›ç–«è‹—</a></li>
<li><a href="../zh-CN450000/index.html">ï¼ˆä»å³åˆ°å·¦ï¼ˆé€šè¿‡çª¥é•œ</a></li>
<li><a href="../zh-CN450004/index.html">å¿«é€Ÿçš„C / C ++ç¼“å­˜ï¼Œçº¿ç¨‹å®‰å…¨</a></li>
<li><a href="../zh-CN450006/index.html">å†·æ°´æœºç»„æ•°æ®ä¸­å¿ƒå†·å´ï¼šé€‰æ‹©å“ªç§å†·å´æ¶²ï¼Ÿ</a></li>
<li><a href="../zh-CN450008/index.html">ä½¿ç”¨PVS-Studioåˆ†æä»ªæŸ¥æ‰¾LLVM 8ä¸­çš„é”™è¯¯</a></li>
<li><a href="../zh-CN450010/index.html">ç…§ç‰‡çš„å­˜å‚¨ï¼Œå¤‡ä»½å’Œåˆ†ç±»</a></li>
<li><a href="../zh-CN450016/index.html">ä»å¤´å¼€å§‹åˆ›å»ºæ­£å¼çš„éªŒè¯ç³»ç»Ÿã€‚ ç¬¬1éƒ¨åˆ†ï¼šPHPå’ŒPythonä¸­çš„å­—ç¬¦è™šæ‹Ÿæœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>