<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÄüèø üïØÔ∏è üë∞üèº Esc√°ner l√°ser de ingenier√≠a inversa Leuze RS4 üë®üèª‚Äçüç≥ ü§® üõÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anteriormente, habl√© sobre ingenier√≠a inversa de un sensor de distancia l√°ser . Esta vez hablaremos de un dispositivo m√°s complejo: un esc√°ner l√°ser L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Esc√°ner l√°ser de ingenier√≠a inversa Leuze RS4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/396357/"><img src="https://habrastorage.org/files/09a/d9e/f75/09ad9ef7519d415f9d003991043d22b1.jpg" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, habl√© sobre ingenier√≠a inversa de un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensor de distancia l√°ser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta vez hablaremos de un dispositivo m√°s complejo: un esc√°ner l√°ser Leuze RS4. </font><font style="vertical-align: inherit;">Al igual que el sensor, este esc√°ner vino a m√≠ en un estado roto, por lo que tuve que abordar la restauraci√≥n de su trabajo y, en el proceso, mejorar algunas de sus caracter√≠sticas y, de hecho, rehacerlo en otro dispositivo.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© es este esc√°ner l√°ser?</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leuze RS4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un esc√°ner de seguridad l√°ser, es decir, est√° dise√±ado para evitar que las personas entren en √°reas peligrosas en el lugar de trabajo, para evitar colisiones de veh√≠culos de producci√≥n, etc. Tiene caracter√≠sticas bastante decentes: rango m√°ximo: 15/50 m (dependiendo del modo de operaci√≥n ), la precisi√≥n de medici√≥n de la distancia en todo el rango de medici√≥n es de 5 mm, la resoluci√≥n angular es de 0,36 grados, la velocidad de exploraci√≥n es de 25 rpm (25000 mediciones / seg).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar que este esc√°ner se coloca precisamente como un dispositivo de seguridad, es decir, almacena la ubicaci√≥n de las zonas de alarma y advertencia en la memoria, y cuando un objeto ingresa a estas zonas, una de las teclas se abre en el esc√°ner. Para configurar la ubicaci√≥n de las zonas, el esc√°ner se puede conectar a una computadora y observar la ubicaci√≥n de los obst√°culos en la pantalla. Incluso hay un paquete ROS que le permite recibir datos de este esc√°ner.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tengo un esc√°ner sin estuche, desmontado en sus componentes. El esc√°ner se estrell√≥ debido a un fuerte golpe en el cuerpo; en qu√© dej√≥ de funcionar exactamente, todav√≠a no lo entend√≠a: tal vez la √≥ptica estaba desalineada, el contacto en uno de los conectores se apag√≥, o el sensor del codificador se movi√≥, o algo m√°s. Trat√© de ensamblar todas las partes juntas, el esc√°ner se vio en el software nativo, pero el escaneo no comenz√≥. Entonces, solo tengo una forma de iniciarlo: restaurar el circuito del esc√°ner lo m√°s completamente posible y escribir mi propio firmware de microcontrolador del esc√°ner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve√≠an las partes: </font><font style="vertical-align: inherit;">
aqu√≠ deber√≠an ubicarse en el estuche (foto de la documentaci√≥n, se puede ver que el dise√±o y la electr√≥nica son ligeramente diferentes):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/52c/f37/092/52cf370928ab5d8ee92ff63432d49fbb.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/77f/2b8/395/77f2b839587cb43a293ea58c34270b1c.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n una parte importante del esc√°ner es el espejo de exploraci√≥n (resaltado en azul en la foto de arriba) instalado en su centro: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama esquem√°tico del esc√°ner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/74e/9e5/8bd/74e9e58bdd529e60b5a823df47fdc6db.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se puede ver en el diagrama, toda la electr√≥nica del esc√°ner consta de m√≥dulos (placas) separados conectados por conectores y bucles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchos m√≥dulos: m√≥dulo de fuente de alimentaci√≥n (DC-DC), m√≥dulo de interfaz, m√≥dulo de procesador, m√≥dulo de fotodetector (APD), m√≥dulo l√°ser. Adem√°s, tambi√©n hay un m√≥dulo codificador y dos tableros con forma de herradura, que al principio parec√≠an extra√±os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, vale la pena prestarles atenci√≥n:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/957/fd1/ab6/957fd1ab64924ab5285c3442bae9e0fe.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, una de las placas contiene LED, y la segunda contiene fotodiodos. Inicialmente, pens√© que era alg√∫n tipo de codificador, o alg√∫n tipo de mecanismo para controlar la radiaci√≥n l√°ser. Sin embargo, m√°s tarde, despu√©s de leer la documentaci√≥n del esc√°ner y examinar las fotograf√≠as en detalle, me di cuenta de que este es un sistema para monitorear el estado de la superficie del vidrio protector del esc√°ner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los agujeros para los LED son visibles en la foto: </font></font><br>
<br>
<img src="https://habrastorage.org/files/d08/12c/0e5/d0812c0e54544f7d9d6439be016575c7.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
al medir el nivel de se√±al de los fotodiodos, puede estimar el nivel de transmisi√≥n del vidrio protector. Obviamente, este sistema no es cr√≠tico para el esc√°ner, por lo que no utilic√© estas placas en el futuro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√≥dulo procesador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la parte m√°s dif√≠cil del esc√°ner. As√≠ es como se ve la electr√≥nica del m√≥dulo desde dos lados:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por primera vez que mir√© el tablero, inmediatamente me di cuenta de que el esc√°ner usa el m√©todo de tiempo de vuelo para medir la distancia (TOF): el chip con la marca m√°s grande result√≥ ser " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACAM TDC-GPX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", del que ya hab√≠a o√≠do hablar. TDC - "Time-to-Digital Converter", es decir, un chip especializado dise√±ado para medir intervalos de tiempo con muy alta precisi√≥n, es el que se usa para medir el tiempo de "vuelo" de un pulso l√°ser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n a bordo se encontraba un microcontrolador Infineon C167 con un chip de memoria FLASH externo (que agrad√≥) y ASIC (que molest√≥ enormemente). En m√°s detalle sobre este m√≥dulo, lo contar√© a continuaci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de potencia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene un convertidor DC-DC aislado galv√°nicamente personalizado con varios voltajes de salida y varios condensadores: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/7c9/30a/1f5/7c930a1f510a7df150eb89654c4c82dd.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el voltaje de alimentaci√≥n del convertidor es de 24V. Su caracter√≠stica principal es que proporciona un alto voltaje (~ 230V), que es necesario para el funcionamiento del l√°ser y el fotodetector, a un conector peque√±o separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n emite los siguientes voltajes al conector principal: + 5V, -5V, ~ 15V, aislados galv√°nicamente del resto + 5V para la interfaz RS232. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte √≥ptica del esc√°ner</font></font></b><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/b2c/f7d/4af/b2cf7d4af2cf9f75fe2659845d9887fb.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primera vista, no est√° muy claro d√≥nde est√°n las √≥pticas del esc√°ner. En este caso, una peque√±a ventana con un espejo en el centro de la foto sirve para emitir el rayo l√°ser, y una gran superficie brillante a su alrededor es la superficie del filtro de luz de interferencia instalado frente a la lente del fotodetector. Este filtro transmite solo la radiaci√≥n cuya longitud de onda est√° cerca de la longitud de onda del l√°ser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se muestra en la documentaci√≥n del esc√°ner: </font></font><br>
<br>
<img src="https://habrastorage.org/files/a6a/58d/c01/a6a58dc01c2a434398d2e8e4b35ccd3b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la lente en s√≠ est√° montada dentro de una carcasa de pl√°stico negro, por lo que es problem√°tico verla. Al final de esta carcasa, opuesto a lo que se ve en la foto de arriba, el </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√≥dulo l√°ser</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodetector son</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fijos </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">m√≥dulo l√°ser</font></b></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/17a/c09/dcf/17ac09dcf9e6e59b2383d155d932e7a3.jpg" alt="imagen"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vista del m√≥dulo l√°ser (algunos de los detalles est√°n marcados por m√≠ durante el dibujo del circuito): </font><font style="vertical-align: inherit;">
Como puede ver, la circuiter√≠a de este m√≥dulo es bastante simple, por lo que podr√≠a restaurar completamente su circuito: </font><font style="vertical-align: inherit;">
una gran parte redonda en el tablero es un emisor l√°ser especializado. </font><font style="vertical-align: inherit;">Desafortunadamente, no hab√≠a marcas en √©l, por lo que no se pudo encontrar documentaci√≥n. </font><font style="vertical-align: inherit;">
A partir de la descripci√≥n en el esc√°ner puede encontrar: "Longitud de onda de luz l√°ser - 905 nm", "Clase de l√°ser - 1", "Duraci√≥n del pulso - 0.003 ¬µs", "Frecuencia de repetici√≥n - 25 kHz". </font><font style="vertical-align: inherit;">
Lo que fue posible entender restaurando el circuito del m√≥dulo y analizando su funcionamiento:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/c28/71a/a61/c2871aa619e574fe9cb8f01b7c3e21db.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2d7/2c5/176/2d72c51767c4c239419dbcf2d35ff249.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El emisor l√°ser se alimenta constantemente con una tensi√≥n de alimentaci√≥n de 143 V, limitada por diodos zener.</font></font></li>
<li>       ,    ¬´3¬ª .   ,     ,     .</li>
<li>   ,        ,    .        ( )    ¬´¬ª .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el control del l√°ser se realiza en una l√≠nea: "LASER_PULSE". La mayor parte del tiempo en la l√≠nea debe ser de nivel "alto". Cuando se aplica un pulso negativo, el disparador DD1 se restablece a 0 en su borde anterior, y en el borde posterior, el disparador comienza a "esperar" la se√±al del fotodiodo y comienza el l√°ser. Cuando aparece una se√±al del fotodiodo, el disparador cambia a 1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede notar dos cables coaxiales utilizando los conectores conectados al m√≥dulo. Se utilizan para transmitir la se√±al diferencial del disparador al chip TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n en este m√≥dulo hay cinco LED. El m√≥dulo procesador los controla. </font><font style="vertical-align: inherit;">
M√≥dulo </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodetector</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El m√≥dulo en s√≠ se ve as√≠: </font><font style="vertical-align: inherit;">
Fotograf√≠a del propio fotodetector cerca de:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/a91/704/ae2/a91704ae269a7ce0761135bf935d1de8.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/444/bb5/671/444bb5671b8daa4ba612f2e35b331ada.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El letrero de alto voltaje en la esquina de la placa muestra claramente que aqu√≠ </font><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">usa un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodiodo de avalancha (APD)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : requieren un voltaje bastante alto para funcionar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, no hab√≠a marcas visibles en el cuerpo del fotodetector. Por el emblema en el fotodiodo mismo (en el centro), solo era posible determinar que fue fabricado por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacific Silicon Sensor (primer sensor)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, no hab√≠a m√°s informaci√≥n sobre √©l, tal vez est√° hecho a medida. Se puede ver en la foto que este fotodetector es un h√≠brido, es decir contiene un amplificador incorporado: es claramente visible sobre el fotodiodo. Obviamente, el amplificador y el fotodiodo necesitan energ√≠a: se alimenta a trav√©s de los terminales inferiores (los condensadores est√°n soldados a ellos). Un gran misterio fue el peque√±o detalle a la izquierda del fotodiodo, al que hay tres conductores. La investigaci√≥n adicional mostr√≥ que este es un sensor t√©rmico anal√≥gico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo es mucho m√°s complicado que el anterior, utiliza una placa de circuito impreso multicapa, al menos 4 capas, con la mayor√≠a de las l√≠neas de se√±al ubicadas en la capa externa de la placa, lo que facilita enormemente su an√°lisis. En este m√≥dulo, restaur√© aproximadamente el 80% del circuito, el resto no era realmente necesario para m√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El circuito resultante del m√≥dulo fotodetector: </font><font style="vertical-align: inherit;">
en la parte superior del circuito hay una fuente de alto voltaje lineal ajustable para un fotodiodo de avalancha. Puede generar un voltaje estable de al menos 150 V. Esta fuente est√° controlada por el DA1 DAC (LTC1451).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/5d6/508/5ea/5d65085eade00ed5135fbf19a85bb783.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el esc√°ner se basa en un buscador de rango pulsado, la tarea principal del m√≥dulo fotodetector es detectar r√°pidamente una se√±al l√°ser suficientemente d√©bil reflejada por un obst√°culo. Dado que el nivel de la se√±al de luz es muy peque√±o, solo se puede detectar utilizando un fototodiodo de avalancha, que tiene su propia ganancia. En este caso, la se√±al del fotodiodo se amplifica adicionalmente por un amplificador integrado integrado en el fotodetector. Debido al hecho de que el amplificador est√° integrado en el cuerpo del fotodetector, se reduce la influencia de la interferencia en la se√±al √∫til. La se√±al generada por el fotodetector (OUT_B) se transmite a un determinado chip DA4, que, al parecer, es otro amplificador de alta frecuencia. Despu√©s de eso, la se√±al se transmite a la entrada directa del comparador de alta velocidad D1 (MAX9601).La se√±al de referencia del divisor de resistencia (aproximadamente 50 mV) se alimenta a la entrada inversa de este comparador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La se√±al en la salida del comparador es diferencial, se transmite a trav√©s de un cable coaxial directamente a la placa del m√≥dulo del procesador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la se√±al de la salida del amplificador DA4 se transmite a alg√∫n tipo de detector de pico, que "recuerda" el nivel m√°ximo del pulso recibido. No comenc√© a restaurar el circuito de este nodo, y dibuj√© en el circuito solo su etapa de salida (chip U1), cuya se√±al tambi√©n se transmite al m√≥dulo del procesador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las partes del esc√°ner que me resulta menos clara es el transistor Q3 instalado en la salida del amplificador de RF. A juzgar por los circuitos, es necesario para permitir la atenuaci√≥n de la se√±al en la salida del amplificador. Este transistor puede controlarse utilizando una se√±al de la placa del procesador (l√≠nea 10 - "digi").</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede notar que la placa tiene un chip EEPROM. Todas las salidas de se√±al de este chip est√°n conectadas a la placa del procesador. Aparentemente, en este microcircuito se almacenaron algunos par√°metros, √∫nicos para cada placa de fotodetector, y se registraron al probar la placa. En particular, esto puede ser una curva de la dependencia de la ganancia APD de la tensi√≥n de alimentaci√≥n, la dependencia de la tensi√≥n en la salida del sensor de temperatura en su temperatura y otras caracter√≠sticas similares. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver que la potencia del fotodetector se puede controlar configurando ciertos niveles en las l√≠neas CLK, CS, CS2 conectadas al DAC y EEPROM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La placa contiene varios circuitos dise√±ados para controlar su estado. Puede controlar el nivel de voltaje del APD, su temperatura (l√≠nea 7) y el umbral del comparador. Estos voltajes son convertidos por amplificadores operacionales DA3-DA5 y transmitidos a la placa del m√≥dulo procesador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volviendo al</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
m√≥dulo </font><b><font style="vertical-align: inherit;">procesador</font></b><font style="vertical-align: inherit;"> Este m√≥dulo es el m√°s complejo de todos, contiene una gran cantidad de microcircuitos de m√∫ltiples salidas, la placa de circuito impreso es nuevamente de cuatro capas y la mayor√≠a de las l√≠neas de se√±al est√°n separadas en las capas internas, lo que complica significativamente la restauraci√≥n del circuito. </font><font style="vertical-align: inherit;">
Muy a menudo result√≥ que las pistas cambiaron a otro lado del tablero. Para buscar r√°pidamente d√≥nde est√° conectada una determinada pista, tuve que usar un pincel as√≠, conectado a un mult√≠metro (en modo de marcaci√≥n):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/281/d5d/e1c/281d5de1cb6b8e4c16daf6d4f1690f99.jpg" alt="imagen"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Restablec√≠ aproximadamente el 70% del esquema, el resto no lo necesitaba realmente. Diagrama de bloques del m√≥dulo procesador: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/08d/3f6/60f/08d3f660f31927fd38ae94b82a953714.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diagrama resultante del m√≥dulo procesador: a </font><font style="vertical-align: inherit;">
pesar de que llamo a este m√≥dulo "m√≥dulo procesador" en todas partes, en realidad se basa en el </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">microcontrolador Infineon SAK-C167CR-L33M</font></a><font style="vertical-align: inherit;"> . Tiene 144 pines y est√° construido sobre la arquitectura bastante antigua C166. Este microcontrolador no tiene su propia memoria no vol√°til; es necesario conectarle una memoria externa a trav√©s de un bus paralelo. Para estos fines, el esc√°ner tiene un chip de memoria Flash M29F400B (512K x 8 / 256K x 16). Adem√°s, dos chips RAM est√°n conectados al microcontrolador: IS61C6416AL-12 (64K x 16) y K6R4016C1D (256K x 16).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/f5d/fef/0a7/f5dfef0a7e036ce6af8872997538b420.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver que el bus de direcciones est√° conectado a todos los microcircuitos de memoria con un desplazamiento de un bit: las l√≠neas de memoria A0 est√°n conectadas a la l√≠nea A1 del microcontrolador. Esto se debe al hecho de que las direcciones se establecen en el bus de direcciones en bytes, pero el controlador y la memoria son de 16 bits. Para que el controlador escriba bytes individuales en la RAM sin afectar los bytes vecinos en una palabra de 16 bits, los chips de memoria tienen l√≠neas especiales UBn, LBn. Esta soluci√≥n es muy com√∫n en dispositivos con buses paralelos y se describe en detalle en la documentaci√≥n del controlador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero otra soluci√≥n en el m√≥dulo del procesador no me qued√≥ completamente clara. Si observa el chip de memoria flash U1, notar√° que la l√≠nea A14 del chip est√° conectada a tierra. La l√≠nea de bus de direcci√≥n del controlador A15 correspondiente no est√° conectada al chip en absoluto. El resultado es que el controlador solo tiene acceso a la mitad de la memoria Flash. Una situaci√≥n completamente similar con el chip RAM2 (DD3). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con el chip RAM1 (DD2), la situaci√≥n es algo diferente: la l√≠nea del controlador A15 tampoco est√° conectada a √©l, pero al mismo tiempo todas las entradas de direcci√≥n de este chip est√°n conectadas al bus de direcciones, de modo que el controlador tiene acceso a toda la memoria del chip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora debe prestar atenci√≥n al nodo en los elementos l√≥gicos DX1, DX2, DD4. </font><font style="vertical-align: inherit;">Son estos microcircuitos los que determinan cu√°l de los microcircuitos de memoria es seleccionado por el microcontrolador. </font><font style="vertical-align: inherit;">Se puede ver que est√°n controlados por las siguientes se√±ales:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRn - se√±al de grabaci√≥n, nivel activo - bajo. </font><font style="vertical-align: inherit;">En esta l√≠nea, el microcontrolador establece un nivel bajo cuando necesita escribir algunos datos en la memoria RAM externa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A15 es la misma l√≠nea de bus de datos que no est√° conectada directamente a ninguno de los chips de memoria.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSn0 es una se√±al de selecci√≥n de chip especializada, el nivel activo es bajo. </font><font style="vertical-align: inherit;">Esta l√≠nea est√° conectada al decodificador de direcciones integrado en el controlador. </font><font style="vertical-align: inherit;">Despu√©s de un reinicio, el controlador est√° bajo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM2_CE: conectado al GPIO del controlador con un elevador al suelo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La l√≥gica del funcionamiento de este nodo est√° bien descrita en la tabla: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f49/171/c32/f49171c3210acdcfbac396e81b568a46.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, dependiendo del estado de la l√≠nea RAM2_CE, el microcontrolador funcionar√° con memoria Flash o con el microcircuito RAM2 (DD3), y los espacios de direcciones para ellos coinciden. Vale la pena se√±alar que la capacidad de memoria de estos microcircuitos es la misma. Quiz√°s esto se haga para simplificar la actualizaci√≥n del firmware del dispositivo. Hay otra opci√≥n: la RAM instalada es 3 veces m√°s r√°pida que la memoria Flash, por lo que despu√©s de iniciar el controlador puede copiar el contenido de FLASH a RAM2, despu√©s de lo cual el programa se ejecuta desde √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero el alto nivel en la l√≠nea A15 determina claramente que el controlador funcionar√° con el chip RAM (DD2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, resulta que la memoria FLASH y RAM1 se alternan en el espacio de direcciones del controlador:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/130/d7a/ee6/130d7aee659a1839be0296586fe25024.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El √°rea de RAM que ya se encontr√≥ se resalta en rojo: al acceder a ella, el controlador en realidad obtendr√° acceso a los datos ubicados en las direcciones (0x8000-0xFFFF). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci√≥n del compilador no es trivial y, como mencion√© anteriormente, se pierde la mitad de Flash / RAM2. No est√° claro por qu√© los desarrolladores del esc√°ner no cambiaron entre los chips FLASH y RAM utilizando la l√≠nea CSnX especializada del controlador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya mencion√©, el controlador usado no tiene memoria Flash, y por lo tanto, Fuse-bits. Para configurar algunos par√°metros del controlador: ancho y direcci√≥n del bus de datos, los par√°metros PLL se utilizan resistencias desplegables conectadas al bus de datos. El controlador en s√≠ tiene resistencias Pull-Up incorporadas de alta resistencia (&gt; 100 KOhm) conectadas a todo el bus. Por lo tanto, debido a las resistencias externas, se establece una cierta combinaci√≥n de se√±ales en el bus, que el controlador lee cuando se enciende. Determina la configuraci√≥n necesaria del controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, estamos hablando de resistencias R3-R6. La configuraci√≥n seleccionada de las resistencias es consistente con las conexiones de se√±al de bus resultantes y proporciona una velocidad de reloj del controlador de 33 MHz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La se√±al de pulso del codificador espejo se alimenta a la entrada del temporizador "T2IN" del microcontrolador a trav√©s del elemento l√≥gico OR D6. La segunda entrada de este chip est√° conectada al GPIO del controlador, lo que le permite desactivar el suministro de pulsos a la entrada del temporizador. Por qu√© se necesita una soluci√≥n de este tipo y por qu√© es imposible apagar el temporizador mediante programaci√≥n, todav√≠a no lo entiendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora debe prestar atenci√≥n al chip TDC (DD1). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El esc√°ner tiene un chip TDC-GPX, el m√°s "avanzado" de todos los que est√° en el rango de ACAM. La precisi√≥n reclamada de medir intervalos de tiempo de hasta 10 ps RMS. El microcircuito tiene 8 canales de entrada de l√≠neas LVTTL y 2 canales de LVECL (diferencial).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este esc√°ner, para obtener la m√°xima precisi√≥n en la medici√≥n del tiempo, son las entradas LVECL las que se utilizan para recibir se√±ales del m√≥dulo l√°ser y el m√≥dulo fotodetector utilizando cuatro cables coaxiales. Las se√±ales del m√≥dulo l√°ser se env√≠an a las entradas de DStart / DStartN y comienzan el conteo de tiempo. Las se√±ales del m√≥dulo fotodetector se env√≠an a las entradas DStop1 / DStop1N, DStop2 / DStop2N y detienen el conteo de tiempo. Como se puede ver en el diagrama, las se√±ales de parada se aplican inmediatamente a dos canales TDC, con polaridad inversa. Debido a esto, es posible medir no solo la duraci√≥n del "vuelo" del pulso de luz, sino tambi√©n el ancho del pulso recibido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDC-GPX tiene un bus de datos de 28 bits, pero se puede cambiar al modo de 16 bits, que es lo que se usa en el esc√°ner. El bus de direcciones es de 4 bits, tambi√©n se desplaza en 1 bit, como con los chips de memoria. Los chips DD8, DD9, U2 se utilizan para generar se√±ales de control del chip y hacer coincidir los niveles: el microcontrolador funciona desde 5V y TDC, desde 3.3V. En general, el sistema de alimentaci√≥n TDC es bastante complejo, incluso hay un ajuste autom√°tico de la tensi√≥n de alimentaci√≥n. Debido a su complejidad, no comenc√© a dibujar su diagrama; sospecho que no es muy diferente de una hoja de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La programaci√≥n del microcontrolador y TDC se discutir√° m√°s adelante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencion√© anteriormente, un chip ASIC personalizado con las inscripciones "LEUZE98" y "WATCHDOG" est√° instalado en la placa. Lo que es es desconocido. Se puede ver que un oscilador de cristal de 20 MHz est√° conectado a este microcircuito. Despu√©s de que pude programar el microcontrolador, me asegur√© de que el ASIC no interfiera con su funcionamiento y no restaur√© el diagrama de conexi√≥n del ASIC. Hasta donde entiendo, este chip se comunica con el controlador a trav√©s de un bus paralelo. Es posible que sea el ASIC el que genera la se√±al de reinicio RESETn, que restablece el controlador y el TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, era necesario tratar algunas cadenas con m√°s detalle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final result√≥ que, la se√±al de control l√°ser "LASER_PULSE" puede ser generada tanto por el microcontrolador como por el ASIC utilizando un nodo en los transistores T1, T2. En este caso, cuando se enciende, el ASIC abre el transistor T1, de modo que el controlador no puede controlar el l√°ser. Debido a esto, tuve que quitar la resistencia R24, y el controlador comenz√≥ a controlar normalmente el l√°ser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La se√±al de control del motor espejo line_motor1 tambi√©n vino del ASIC (a trav√©s del diodo D2). Debido a esto, tuve que cortar la pista en el tablero y conectar esta se√±al directamente a la salida libre del controlador GPIO - P3.15.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s extra√±o es que la l√≠nea CS2 conectada al DAC instalado en la placa de circuito del m√≥dulo fotodetector tambi√©n result√≥ estar conectada al ASIC. Debido a esto, el controlador no pudo establecer de manera independiente el voltaje de suministro APD y encender el amplificador APD. Tal vez esto se hizo para aumentar la confiabilidad del esc√°ner: una configuraci√≥n incorrecta de DAC puede provocar el fallo del APD. Tambi√©n tuve que conectar esta l√≠nea al pin GPIO gratuito del controlador P3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bien sabido que es el ASIC el que controla los tres LED montados en el m√≥dulo l√°ser. Desde el controlador se controlan dos LED m√°s que muestran el estado del esc√°ner (la presencia de un obst√°culo en el √°rea de trabajo): l√≠neas LN1, LN2. Estas l√≠neas tambi√©n van a la placa del m√≥dulo de interfaz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el esc√°ner puede funcionar en sistemas de seguridad, la placa del procesador tiene una gran cantidad de nodos para diagnosticar su condici√≥n. </font><font style="vertical-align: inherit;">El procesador (y posiblemente ASIC) puede detectar la inclusi√≥n de un l√°ser (usando el chip U3), controlar el nivel de varios voltajes de suministro, voltaje de suministro APD, temperatura APD y el umbral del comparador en la placa del fotodetector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido al hecho de que el voltaje de referencia del controlador ADC es de 4.1V, una parte de los voltajes medidos se reduce mediante divisores de resistencia, que se pueden ver en el diagrama de la derecha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora vale la pena echar un vistazo m√°s de cerca al m√©todo de generar la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inusual</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se√±al "digi", que mencion√© anteriormente al describir el m√≥dulo del fotodetector.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente diagrama muestra los nodos del m√≥dulo del procesador (parte inferior) y del m√≥dulo del fotodetector (parte superior):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/44d/9b6/e35/44d9b6e356033cbfe9f892c5b9838622.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las flechas muestran la conexi√≥n de los m√≥dulos mediante cables. A continuaci√≥n describir√© el funcionamiento de estos nodos, tal como lo entiendo. En el m√≥dulo fotodetector, la se√±al de la salida APD es amplificada por el chip DA4, despu√©s de lo cual se transfiere al comparador D1. Si el nivel de se√±al en la entrada del comparador es superior a 50 mV, se establece un nivel alto en la salida del comparador. La se√±al de la salida del comparador se transmite al m√≥dulo procesador. En primer lugar, ingresa a la entrada TDC, que cuenta el tiempo desde el comienzo del pulso l√°ser. Pero adem√°s, esta se√±al se alimenta a la entrada de reloj del D-trigger DD1. Siempre se suministra una unidad l√≥gica a la entrada de se√±al de disparo, y el disparo en s√≠ mismo se puede restablecer a cero utilizando la l√≠nea GPIO del controlador BASE5. Por lo tanto, la operaci√≥n del comparador conduce a un disparador instant√°neo "1". Este disparador tiene una salida diferencial,la se√±al desde la cual se alimenta a la entrada del chip D3, que la convierte al formato LVTTL. Esta se√±al se alimenta a la entrada "digi" del m√≥dulo fotodetector. Como mencion√© anteriormente, en mi opini√≥n, la aparici√≥n de esta se√±al conduce a un debilitamiento del nivel de se√±al en la entrada del comparador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pregunta principal es ¬øpor qu√© es necesario y por qu√© es tan dif√≠cil de implementar? ¬øPor qu√© era imposible hacer ambos nodos en la placa del m√≥dulo fotodetector? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo puedo expresar mis suposiciones. Quiz√°s la se√±al necesita ser atenuada para evitar la transici√≥n del comparador o detector de amplitud a saturaci√≥n. Quiz√°s, para reducir la longitud del pulso recibido. Para ambos nodos, simplemente no podr√≠a haber un lugar en la placa del fotodetector. Tambi√©n es posible otra opci√≥n: la se√±al debe debilitarse solo despu√©s de que tenga tiempo de llegar al TDC a trav√©s de cables coaxiales, lo que justifica un dise√±o tan complejo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El estudio mostr√≥ que antes de comenzar un nuevo pulso l√°ser, es necesario reiniciar el gatillo, de lo contrario, los pulsos no son aceptados. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de interfaz</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lamentablemente, no encontr√© una buena foto de este m√≥dulo. Solo hay este: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/394/165/79a/39416579aee7e4e226a1dbc9225386f0.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
es en este m√≥dulo donde se instalan los dos √∫nicos conectores, a los que puede conectarse fuera del esc√°ner. Uno de ellos es RS-232 / RS-422, seg√∫n el segundo, se suministra alimentaci√≥n al esc√°ner, se suministran se√±ales de control y aqu√≠ se conecta un circuito de seguridad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo contiene convertidores y optoacopladores UART-RS232 / RS485 de aislamiento galv√°nico (se instalan en una peque√±a placa separada que se muestra a la derecha), teclas de alimentaci√≥n del circuito de seguridad, circuitos de entrada de las l√≠neas de control del tel√©metro, un circuito de control del motor, un convertidor de se√±al del codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√≥dulo de alimentaci√≥n y el m√≥dulo del procesador, as√≠ como el m√≥dulo del codificador y el motor del espejo est√°n conectados a este m√≥dulo (usando los conectores en la parte inferior del m√≥dulo, no son visibles en la foto).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama parcial del m√≥dulo de interfaz: </font><font style="vertical-align: inherit;">
restaur√© solo una parte del diagrama de circuito de este m√≥dulo (alrededor del 20%), porque no estaba interesado en las teclas y las l√≠neas de entrada necesarias para garantizar la seguridad. Y hay bastantes all√≠, la documentaci√≥n menciona el l√≠mite de corriente en el circuito de seguridad, la supervisi√≥n de cortocircuitos y otras funciones.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/6cb/b3b/711/6cbb3b71160b4d70462c898dac6263a5.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algo extra√±amente hizo el control de la velocidad de rotaci√≥n del motor del espejo. El control de velocidad se implementa cambiando el voltaje del motor; con esto, todo est√° claro. Pero el ajuste de este voltaje en s√≠ se lleva a cabo con la ayuda de cierta cadena integradora en un amplificador operacional. Para aumentar el voltaje, el controlador establece 0 en la l√≠nea line_mot1 para bajarlo: 1. Obviamente, sin retroalimentaci√≥n constante del codificador, el motor se detiene o acelera a la velocidad m√°xima a trav√©s del controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final result√≥ que, el chip convertidor UART-RS232 LTC1387 es bastante lento: a una velocidad de 500 kbit / s, los datos se distorsionaron. Debido a esto, tuve que quitar una placa peque√±a con este chip y conectar el convertidor USB-UART directamente a la placa del m√≥dulo de interfaz.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora que he hablado sobre el dise√±o de todos los m√≥dulos, vale la pena desarrollar el proceso de ingenier√≠a inversa en s√≠.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cuando comenc√© a tratar con la electr√≥nica del esc√°ner, ten√≠a mucho miedo de que un l√°ser o un fotodetector pudieran da√±arse como resultado de un impacto. Al mismo tiempo, no estaba seguro de poder lanzar el m√≥dulo del procesador; el microcontrolador desconocido y el ASIC estaban avergonzados. Por lo tanto, en primer lugar, restaur√© el circuito del m√≥dulo l√°ser y luego el m√≥dulo fotodetector. Despu√©s de que pude entender la circuiter√≠a de estos m√≥dulos y determinar el prop√≥sito de todos los contactos en sus conectores, fue posible pasar al m√≥dulo procesador. Como √∫ltimo recurso, si no pod√≠a iniciarlo, tuve la idea de hacer un an√°logo de este m√≥dulo en microcircuitos STM32 + TDC-GP2.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, para verificar el m√≥dulo, debe ejecutar su propio programa en el microcontrolador Infineon SAK-C167CR instalado en √©l. Nuevamente, vale la pena recordar que este controlador no tiene memoria Flash incorporada. Adem√°s, result√≥ que el controlador no tiene interfaces de depuraci√≥n especializadas (incluido JTAG). Con un alto grado de probabilidad, el firmware se escribe en un Flash externo en el programador de f√°brica. Sin embargo, result√≥ que no todo est√° tan mal: el controlador tiene un cargador de arranque ("Bootstrap Loader"), que funciona en UART. Este gestor de arranque se almacena en el ROM de arranque incorporado del controlador, por lo que debe haber estado en mi controlador. Y funciona de manera bastante peculiar: para activarlo al inicio, debe establecer la l√≠nea de bus de datos P0L.4 en baja,despu√©s de lo cual el controlador comienza a esperar a que aparezca el byte 0x00 del host. Una vez aceptado este byte, el gestor de arranque determina autom√°ticamente la velocidad de transferencia y comienza a esperar 32 bytes de datos que copia en la RAM interna del controlador. Despu√©s de recibir los datos, el controlador comienza la ejecuci√≥n del programa recibido (16 palabras del controlador).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, en estos 32 bytes necesita empujar otro cargador ("preloader"), que recibir√° el cargador principal "Cargador externo" del host, y comenzar√° su ejecuci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ tuve suerte: para este procesador ya hay un programa FLASHit listo para usar que puede hacer todas las operaciones mencionadas autom√°ticamente. El cargador incorporado tiene una gran funcionalidad: con √©l puede determinar autom√°ticamente el modelo de memoria Flash instalada, editar y ver el contenido de los registros del controlador, puede ver el estado de los canales ADC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No pude encontrar ninguna almohadilla de prueba en la placa conectada a la l√≠nea P0L.4 del controlador, por lo que para iniciar el gestor de arranque, tuve que soldar un pin especial a esta l√≠nea. Pegu√© el pin a la caja de uno de los chips de RAM. Para iniciar el gestor de arranque, debe conectar este pin a trav√©s de una resistencia de 8 kŒ© a tierra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de conectar la placa a la computadora y aplicar energ√≠a al m√≥dulo del procesador, el microcontrolador realmente apareci√≥ en FLASHit. Despu√©s de eso, escrib√≠ un peque√±o programa en Keil que cambi√≥ uno de los pines del controlador y lo escribi√≥ en Flash. El programa funcion√≥ bien, ASIC no interfiri√≥ (ten√≠a miedo de alg√∫n tipo de mecanismo de vigilancia incorporado o conflictos en los autobuses), para poder seguir adelante.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, restaur√© el circuito del m√≥dulo del procesador, lo que me permiti√≥ verificar el funcionamiento de todos los m√≥dulos en el ensamblaje. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera vez que verifiqu√© el funcionamiento del m√≥dulo l√°ser, como escrib√≠ antes, para iniciar el pulso l√°ser era necesario aplicar solo una se√±al a este m√≥dulo. El l√°ser funcion√≥: sus flashes se pod√≠an ver usando la c√°mara de un tel√©fono m√≥vil. Adem√°s, usando un osciloscopio, verifiqu√© que el m√≥dulo normalmente forma pulsos de inicio (referencia). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego vino la verificaci√≥n del m√≥dulo del fotodetector. Aqu√≠ tuve que verificar el funcionamiento del DAC, la unidad de generaci√≥n de voltaje de fotodiodo de avalancha y la unidad de control de potencia del amplificador del fotodetector. Todos ganaron, lo que permiti√≥ comprobar el funcionamiento del buscador de rango en s√≠. Para hacer esto, ensambl√© sus m√≥dulos en la forma en que los desarrolladores lo pretendieron:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/462/307/8fe/4623078fe14cf75b455d285680f2ece8.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la fotograf√≠a, los cinco m√≥dulos principales se ensamblan alrededor del sistema √≥ptico. Aqu√≠, en lugar de mi propio espejo giratorio, instal√© un espejo ordinario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, present√© un programa de control l√°ser para UART y configur√© el fotodiodo. Como resultado, cuando comenc√© el l√°ser en la entrada del comparador, ¬°pude realmente detectar pulsos con un osciloscopio cuya amplitud depend√≠a claramente del tipo de obst√°culo frente al espejo! El comparador tambi√©n funcion√≥ bien. La √∫ltima parte importante de la prueba permaneci√≥: la verificaci√≥n del rendimiento de TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El chip TDC-GPX instalado en el esc√°ner tiene un dise√±o bastante complicado y puede funcionar en una gran cantidad de modos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente figura muestra su diagrama estructural:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ab4/c21/6f6/ab4c216f68fe6e7785f763fd7619dc67.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, el chip contiene 8 canales separados, es decir, puede recibir hasta 8 se√±ales de parada. Si los canales son diferenciales, solo se pueden analizar dos se√±ales de parada m√°s una se√±al de inicio. En este caso, el chip le permite combinar los canales de medici√≥n, lo que aumenta la precisi√≥n de los intervalos de tiempo de medici√≥n:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/a22/968/689/a22968689e8450060a016c0db84b9bad.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, no me gust√≥ la documentaci√≥n de este chip. Muchas cosas en √©l se describen de manera bastante superficial, los ejemplos de c√≥digo son incomprensibles. La parte de la hoja de datos dedicada a ajustar la resoluci√≥n de tiempo est√° llena de alg√∫n tipo de "n√∫meros migratorios". Tampoco hay una "Nota de aplicaci√≥n" normal en el chip. Adem√°s, en el esc√°ner mismo, no pude detectar la conexi√≥n de las l√≠neas EF1 / EF1 al controlador. Es a partir de estas l√≠neas que se puede determinar que el microcircuito ha terminado de medir el tiempo. Debido a todo esto, iniciar el TDC me llev√≥ bastante tiempo, pero como resultado todo funcion√≥ como deber√≠a: cuando se inici√≥ el l√°ser, el TDC funcion√≥, y los resultados del TDC dependieron claramente de la distancia al obst√°culo. Por lo tanto, el buscador de rango l√°ser pulsado comenz√≥ a funcionar. Queda por convertir toda la estructura en un esc√°ner l√°ser viable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer paso que necesitaba para llevar a cabo el ajuste: el tel√©metro ensamblado dej√≥ de "ver" obst√°culos despu√©s de unos pocos metros. El sistema √≥ptico parec√≠a intacto, pero tuve que quitar las placas del sistema √≥ptico, de modo que la luz reflejada no fuera enfocada con precisi√≥n por la lente del fotodetector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de la alineaci√≥n, escrib√≠ un programa para el controlador, que no solo determinaba las distancias, sino que tambi√©n med√≠a la amplitud de la se√±al generada por el detector de picos usando el ADC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el proceso de ajuste se redujo a movimientos suaves del fotodetector y las placas l√°ser, y a la b√∫squeda de su posici√≥n en la que la amplitud de la se√±al es m√°xima. Como resultado del ajuste, la amplitud de la se√±al recibida se mejor√≥ significativamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debe prestar atenci√≥n a alguna caracter√≠stica del procesamiento de datos inherente a los tel√©metros de pulso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La se√±al generada por el fotodetector tiene una forma anal√≥gica. Para convertirlo a formato digital, que el TDC procesa a√∫n m√°s, se utiliza un comparador que est√° configurado para cambiar si la se√±al de entrada supera un cierto umbral. Como resultado, debido a la forma compleja de la se√±al de entrada, al cambiar la amplitud de la se√±al, se produce un error al determinar los intervalos de tiempo:</font></font><br>
<br>
<img src="https://img-fotki.yandex.ru/get/198361/14557097.6/0_10da03_2cd9184c_orig.bmp" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se puede ver en el gr√°fico, una se√±al con una amplitud m√°s baja se detectar√° con retraso. Para resolver este problema, existen varios m√©todos, tanto de hardware como de software. Decid√≠ usar la opci√≥n m√°s simple: la correcci√≥n de los resultados de la medici√≥n dependiendo de la amplitud de la se√±al. Al mismo tiempo, tuve que recopilar estad√≠sticas sobre los cambios en los resultados de la medici√≥n del tiempo de los cambios en la amplitud de la se√±al. Para cambiar la amplitud de la se√±al sin cambiar sus otros par√°metros, utilic√© almohadillas de papel en la lente, lo que redujo el flujo de luz incidente en el fotodiodo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado fue esta dependencia: en </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/0db/eee/642/0dbeee642afc3de178445fe45d3e2044.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
base a esta dependencia, form√© una tabla de correcci√≥n, cuyos datos son utilizados por el programa controlador para determinar la distancia al objeto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente paso es iniciar el motor espejo y el codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, ya cit√© una foto de un espejo: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el motor del espejo es sin escobillas, muy similar a los utilizados en los ventiladores m√°s fr√≠os. De √©l salen tres cables: dos de ellos son de alimentaci√≥n, otro es una se√±al de velocidad de pulso. Todos estos cables est√°n conectados al m√≥dulo de interfaz, mientras que la se√±al de velocidad generada por el motor no se utiliza: el control se basa en los datos del codificador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver en la foto, un disco transparente con etiquetas para el codificador se fija en el eje del motor. Puede notar que hay una marca cero en el disco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El codificador se mont√≥ en una placa peque√±a y se cubri√≥ por completo con una pantalla de metal, por lo que no se pudo determinar su marca. Sin embargo, en funci√≥n de su tama√±o y pines, decid√≠ que era un codificador de cuadratura HEDS-9040: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e13/b8a/134/e13b8a134252c787ef4fee9ae23161ae.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cuatro cables pasaron de la placa del codificador al m√≥dulo de interfaz, pero result√≥ que solo se utilizaron tres: dos fuentes de alimentaci√≥n y una se√±al. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n tengo entendido, se instalaron activadores de Schmitt y se instal√≥ algo de l√≥gica en el tablero, combinando datos de los canales A, B e √≠ndice (se√±al de marca cero). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve la se√±al producida por la placa del codificador y la se√±al de √≠ndice tomada directamente del codificador.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fef/43c/dd1/fef43cdd10c0302e460b266ba4a5124b.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se puede ver, durante la se√±al de √≠ndice, se suprimen los pulsos del codificador. Al final result√≥ que, la placa del codificador gener√≥ 500 pulsos por revoluci√≥n, pero el temporizador del controlador T2, al que est√° conectada la l√≠nea del codificador, puede funcionar simult√°neamente en ambos bordes de los pulsos, lo que da 1000 interrupciones por revoluci√≥n del espejo. Este valor corresponde a la resoluci√≥n angular declarada del esc√°ner a 0,36 grados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configur√© el temporizador T2 en "Modo de captura", lo que me permite medir el tiempo entre interrupciones desde el codificador. El tiempo obtenido se utiliza para detectar la posici√≥n "cero" del espejo y para estabilizar la velocidad de rotaci√≥n del motor. Al mismo tiempo, se cuenta el n√∫mero de interrupciones, lo que le permite determinar la posici√≥n del espejo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que el codificador funcion√≥, y logr√© iniciar el control de velocidad del motor, fue posible ensamblar completamente el esc√°ner. Debido a la forma compleja de las placas y la √≥ptica, el dise√±o result√≥ ser bastante elaborado: </font><font style="vertical-align: inherit;">
no fue f√°cil ensamblar dicho dise√±o; la precisi√≥n de la disposici√≥n de las piezas individuales es muy importante para el esc√°ner. Si el eje del espejo no coincidiera con el eje √≥ptico de la parte del tel√©metro, esto podr√≠a llevar al hecho de que el plano de exploraci√≥n estar√≠a fuertemente curvado o inclinado.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/16f/05e/cdd/16f05ecddefcb0016348678d7f587d8b.jpg" alt="imagen"></a><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2e6/71b/812/2e671b81234a099cbbe91cd55f9060c7.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al medir la distancia exacta a los objetos, es importante tener alg√∫n tipo de objeto de "referencia", cuya distancia se conoce con precisi√≥n. Conociendo el "tiempo de vuelo", puede determinar con precisi√≥n el tiempo correspondiente a la distancia cero. Debido a los cambios en la temperatura de los componentes del esc√°ner, este tiempo puede cambiar, por lo que este tiempo debe ser monitoreado constantemente. Para resolver este problema, instal√© una placa especial ennegrecida en el esc√°ner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fcd/d14/a3b/fcdd14a3bbc74d42b8e75a734530e66d.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la placa est√° ennegrecida para que la luz reflejada no "ciegue" el fotodetector. A juzgar por las instrucciones, tambi√©n se instalaron elementos reflectores oscuros y claros en el dise√±o original del esc√°ner. Se utilizaron para controlar el funcionamiento de la parte del tel√©metro del esc√°ner y, muy probablemente, tambi√©n se utilizaron para la calibraci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la foto de arriba, el codificador montado en la placa tambi√©n es claramente visible. Al final result√≥ que, el codificador debe estar colocado con mucha precisi√≥n en relaci√≥n con el disco, y hubo muchos problemas con esto, incluso un peque√±o cambio en el codificador provoc√≥ la p√©rdida de pulsos, especialmente los √≠ndices. Es posible que el esc√°ner deje de funcionar despu√©s de golpear el cuerpo precisamente debido a problemas con el codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, logramos obtener una velocidad de escaneo de hasta 20 revoluciones por segundo. Con un voltaje APD de 135 V, normalmente se detectan distancias de hasta 10-15 m. A un voltaje de 145 V y con filtrado de se√±al adicional, es posible medir distancias de hasta 30 m (aunque no estoy seguro de si esto es seguro para un fotodetector).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar que la velocidad m√°xima de transmisi√≥n en el esc√°ner original es de 115200 bit / s, lo que le permite transferir todos los datos solo a una velocidad de aproximadamente 11 revoluciones por segundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencion√©, en mi firmware transfiero datos a una velocidad de 500 kbit / s, lo que puede aumentar significativamente la cantidad de escaneos transmitidos por segundo. Fue debido al l√≠mite de velocidad UART que no aument√© la velocidad de escaneo a las 25 revoluciones originales por segundo. Observo que en el dise√±o original del esc√°ner, los datos se procesan en el mismo esc√°ner, por lo que la baja velocidad de transferencia de datos no afecta particularmente nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el esc√°ner ahora funciona sin carcasa, fue posible aumentar el √°rea de escaneo a 208 grados contra 190 en el dise√±o original. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visualizaci√≥n de datos recibidos del esc√°ner:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ac1/8ae/f90/ac18aef90d3f6f6b083e373c0c80e144.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, el esc√°ner debe realizar alguna funci√≥n √∫til, as√≠ que decid√≠ verificar su funcionamiento en ROS en SLAM, y comparar los resultados con los resultados de un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esc√°ner l√°ser casero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para hacer esto, lo instal√© en Roomba, en el que previamente se instal√≥ un esc√°ner casero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vista del esc√°ner Leuze instalado en Roomba (el espejo gira para que </font><font style="vertical-align: inherit;">
parezca </font><font style="vertical-align: inherit;">borroso): </font><font style="vertical-align: inherit;">como resultado de la operaci√≥n hector_slam, logramos obtener un mapa de apartamentos de este tipo (las paredes se muestran en amarillo): </font><font style="vertical-align: inherit;">
dado que la aspiradora viaja al nivel del piso, principalmente "ve" los muebles. </font><font style="vertical-align: inherit;">
Pero dicha tarjeta se obtiene si simplemente lleva la aspiradora en las manos al nivel del cintur√≥n: </font><font style="vertical-align: inherit;">
en este caso, las paredes del apartamento son "visibles" con mayor frecuencia.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/dc1/c58/f5a/dc1c58f5a2ecf6eba47a9f880d3aefbc.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4fd/a8e/83d/4fda8e83dee18c10bfbd178f39a8b8e6.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4f4/3d8/ec3/4f43d8ec31a8f1a0a546f9d85c76cee7.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si comparamos la calidad de las tarjetas, est√° claro que las l√≠neas del esc√°ner casero son m√°s "ruidosas". Esto se debe al hecho de que con un esc√°ner casero que utiliza el principio de triangulaci√≥n de operaci√≥n, la precisi√≥n aumenta significativamente con el aumento de la distancia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, a pesar de la muy buena calidad de escaneo, este esc√°ner no es adecuado para un robot aut√≥nomo: tiene dimensiones y consumo de energ√≠a demasiado grandes (aproximadamente 7,2 W).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde m√°s puedo usar un esc√°ner? Anteriormente, cuando hablaba de un esc√°ner casero, a menudo me preguntaban sobre la posibilidad de hacer un esc√°ner 3D, ¬°y es hora de hacerlo! Una velocidad de escaneo bastante alta es √∫til aqu√≠. Por supuesto, por resoluci√≥n, dicho esc√°ner no se puede comparar con esc√°neres que utilizan el principio de triangulaci√≥n de medici√≥n de distancia (con una l√≠nea o proyector l√°ser (SLS)), pero pueden escanear grandes espacios: locales, secciones de calles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para rehacer un esc√°ner 2D en 3D, debe proporcionarle la capacidad de girar a lo largo de otro eje. Decid√≠ hacer mi esc√°ner utilizando el mismo principio de escaneo de haz que en el esc√°ner de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culos Para hacer esto, coloqu√© el esc√°ner Leuze "acostado" para que su plano de escaneo sea perpendicular al piso. Luego, fue necesario realizar una rotaci√≥n lenta y suave de todo el esc√°ner alrededor del eje. La principal dificultad: el esc√°ner debe girar sin latidos ni distorsiones, lo que provocar√° la distorsi√≥n de los escaneos. Al final result√≥ que, en casa, es dif√≠cil hacer un conjunto de rodamiento que pueda proporcionar una rotaci√≥n tan precisa. Por lo tanto, decid√≠ usar el cabezal VHS de la grabadora como unidad de rodamientos: contiene dos rodamientos, est√° hecho con una precisi√≥n muy alta y es capaz de soportar el peso del esc√°ner. El dise√±o resultante es impulsado por un motor paso a paso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El esc√°ner 3D ensamblado se ve as√≠: </font><font style="vertical-align: inherit;">
Vista del esc√°ner montado en un tr√≠pode:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/60d/967/07c/60d96707cb26b50daca5c06bcbee64e5.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/167/77d/118/16777d118478b27a1b5ae56d449304d3.jpg" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la izquierda hay una bater√≠a de 12 V, que tambi√©n es un contrapeso. Dado que el esc√°ner Leuze requiere 24 V para funcionar, tuve que instalar un convertidor CC / CC escalonado montado sobre la base del chip XL6009 en el esc√°ner. El motor paso a paso del esc√°ner est√° controlado por un m√≥dulo en el A4988 y Arduino, que proporciona rotaci√≥n a una velocidad determinada. Tanto el esc√°ner Leuze (a trav√©s del adaptador USB-UART) como el Arduino est√°n conectados a trav√©s de un concentrador USB con un cable a una computadora que captura datos. En la forma actual, la rotaci√≥n del espejo del esc√°ner y la rotaci√≥n de todo el esc√°ner no est√°n sincronizadas: la velocidad de rotaci√≥n del esc√°ner se elige de modo que cuando se gira 0,36 grados, el espejo puede hacer al menos tres revoluciones. Como no hay sincronizaci√≥n de velocidad, tuve que transmitir informaci√≥n de posici√≥n de sincronizaci√≥n del Arduino al esc√°ner Leuze.Esto se implementa de manera bastante simple: cuando Arduino gira el esc√°ner por cada 0.36 grados, cambia el nivel de se√±al en uno de los terminales. Esta se√±al se transmite al m√≥dulo procesador del esc√°ner (al conector no utilizado del sensor de estado de vidrio protector). La informaci√≥n sobre el estado de esta se√±al se transmite al comienzo de cada env√≠o del esc√°ner; por lo tanto, el programa autoescrito para la PC que controla el esc√°ner recibe informaci√≥n sobre el movimiento del esc√°ner y determina el √°ngulo de rotaci√≥n.recibe informaci√≥n sobre el movimiento del esc√°ner y determina el √°ngulo en el que gira.recibe informaci√≥n sobre el movimiento del esc√°ner y determina el √°ngulo en el que gira.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un solo escaneo 3D generado por el esc√°ner contiene aproximadamente 350,000 puntos. </font><font style="vertical-align: inherit;">Por supuesto, esto es significativamente menor que el de los esc√°neres profesionales, pero sigue siendo bastante bueno, especialmente si une varios escaneos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo es un escaneo √∫nico de una habitaci√≥n: </font><font style="vertical-align: inherit;">
Un ejemplo es un escaneo de una habitaci√≥n pegada de varias: La </font><font style="vertical-align: inherit;">
parte escaneada de la entrada: Un </font><font style="vertical-align: inherit;">
video que muestra los resultados del esc√°ner resultante:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/152/e40/f46/152e40f4695ab5321aa7de9f0bf00f45.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/37c/376/a36/37c376a366c09c7b5c94cca47992d5f1.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/592/ebd/33d/592ebd33da93487d27e38a2ca030025e.png" alt="imagen"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3SnqrfDCc70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c√≥digo fuente del programa controlador en Github</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es396357/">https://habr.com/ru/post/es396357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es396343/index.html">¬øLas estrellas finalmente explotan?</a></li>
<li><a href="../es396345/index.html">Impresi√≥n corporativa: muchos m√°s problemas de lo que parece</a></li>
<li><a href="../es396347/index.html">Control de aire acondicionado a trav√©s de wifi</a></li>
<li><a href="../es396349/index.html">"Un amigo de mi amigo dijo ...". Exponiendo chismes y mitos sobre SSD</a></li>
<li><a href="../es396353/index.html">Toque el bot√≥n con luz de fondo de China para manualidades de bricolaje</a></li>
<li><a href="../es396359/index.html">SoftBank compra ARM Holdings por ¬£ 24 mil millones</a></li>
<li><a href="../es396361/index.html">El propietario del Tesla Model S afirma que el piloto autom√°tico de su autom√≥vil el√©ctrico salv√≥ al peat√≥n de la muerte</a></li>
<li><a href="../es396363/index.html">Windows 10 tiene exactamente un a√±o</a></li>
<li><a href="../es396365/index.html">HyperX Alloy FPS: fiabilidad sobre todo</a></li>
<li><a href="../es396367/index.html">Los c√≥digos SMS de autorizaci√≥n de Telegram contin√∫an interceptando</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>