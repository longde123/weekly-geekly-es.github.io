<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ½ ğŸ‘ˆ ğŸï¸ Java / logbackä¸­çš„å•ç‹¬æ–¹æ³•è®°å½• ğŸ‘ğŸ¿ ğŸ’³ ğŸ‘ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æŒ‘æˆ˜èµ› 


 å‡è®¾æˆ‘ä»¬è¦ä»¥ä¸åŒçš„æ–¹å¼è®°å½•æŸä¸ªJavaç±»çš„æ¯ä¸ªæ–¹æ³•ï¼š 


- æ¯ä¸ªæ–¹æ³•éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ï¼Œ 
- ...æ‚¨çš„æ—¥å¿—æ ¼å¼ï¼Œ 
- ...å…¶æœ€ä½è®°å½•çº§åˆ« 
- æˆ‘ä»¬ä½¿ç”¨è‡ªå·±çš„%æ‰©å±•æ—¥å¿—æ ¼å¼ï¼Œ 
- èƒ½å¤ŸåŠ¨æ€æ›´æ–°æ­¤é…ç½®ã€‚ 


 æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•æ»¡è¶³è¿™äº›è¦æ±‚ã€‚ ä¸ºäº†ä¿æŒç®€å•æ€§ï¼Œä»…é€šè¿‡æ–¹æ³•æ‰§è¡Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java / logbackä¸­çš„å•ç‹¬æ–¹æ³•è®°å½•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463601/"><p><img src="https://habrastorage.org/webt/yo/jt/7_/yojt7_vw5yer5hnszjbyhljpijq.jpeg" alt="å·´ç‰¹å†™ä¸€äº›æ—¥å¿—"></p><br><h2 id="zadacha"> æŒ‘æˆ˜èµ› </h2><br><p> å‡è®¾æˆ‘ä»¬è¦ä»¥ä¸åŒçš„æ–¹å¼è®°å½•æŸä¸ªJavaç±»çš„æ¯ä¸ªæ–¹æ³•ï¼š </p><br><ul><li> æ¯ä¸ªæ–¹æ³•éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ï¼Œ </li><li>  ...æ‚¨çš„æ—¥å¿—æ ¼å¼ï¼Œ </li><li>  ...å…¶æœ€ä½è®°å½•çº§åˆ« </li><li>æˆ‘ä»¬ä½¿ç”¨è‡ªå·±çš„<code>%</code>æ‰©å±•æ—¥å¿—æ ¼å¼ï¼Œ </li><li> èƒ½å¤ŸåŠ¨æ€æ›´æ–°æ­¤é…ç½®ã€‚ </li></ul><a name="habracut"></a><br><p> æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•æ»¡è¶³è¿™äº›è¦æ±‚ã€‚ ä¸ºäº†ä¿æŒç®€å•æ€§ï¼Œä»…é€šè¿‡æ–¹æ³•æ‰§è¡Œæ—¥å¿—è®°å½•çš„åˆ†ç¦»ã€‚ å®é™…ä¸Šï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸€ä¸ªåˆ†å±‚çš„é™å®šé…ç½®ï¼Œä¾‹å¦‚<code></code> â†’ <code></code> â†’ <code></code> â†’ <code></code> ...ã€‚ä¸‹é¢æ˜¯å®Œæ•´æºä»£ç çš„é“¾æ¥ã€‚ </p><br><h2 id="klientskiy-kod"> å®¢æˆ·ä»£ç  </h2><br><pre> <code class="java hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThingService</span></span></span><span class="hljs-class"> </span></span>{ log = LoggerFactory.getLogger(); getThing() { log.debug(<span class="hljs-string"><span class="hljs-string">"getThing..."</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; one.log } listThings() { log.debug("listThings..."); // =&gt; another.log } }</span></span></code> </pre> <br><h2 id="logback"> é€€å› </h2><br><p> å¯¹äºå®ç°ï¼Œé€‰æ‹©äº†ä¸€ä¸ªå¯é çš„â€œ logbackâ€æ—¥å¿—è®°å½•åº“ï¼Œè¯¥åº“æä¾›äº†æœ‰è¶£çš„è‡ªå®šä¹‰å¯èƒ½æ€§ï¼š </p><br><pre> <code class="plaintext hljs">ch.qos.logback:logback-classic:1.2.3</code> </pre> <br><p> å®ƒæ—¢å¯ä»¥é€šè¿‡XMLé…ç½®è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡Javaè¿›è¡Œé…ç½®ï¼Œå¯ä»¥å°†æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·ï¼š </p><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureLogback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> JoranException </span></span>{ LoggerContext lc = LoggerFactory.getILoggerFactory(); lc.reset(); <span class="hljs-comment"><span class="hljs-comment">// reset prev config JoranConfigurator configurator = new JoranConfigurator(); configurator.setContext(lc); configurator.doConfigure("config.xml"); // any data source StatusPrinter.printInCaseOfErrorsOrWarnings(lc); //   : Logger root = LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME); root.setLevel(Level.INFO); //  }</span></span></code> </pre> <br><p> å…³äºæ—¥å¿—çš„ç®€è¦ä»‹ç»ï¼š </p><br><ol><li> ç¨‹åºå‘˜æ‹‰<em>è®°å½•å™¨</em> ï¼Œ </li><li> è®°å½•å™¨å°†åˆ†é…ç»™ä»–çš„<em>é™„åŠ ç¨‹åº</em>æ‹‰å‡ºï¼Œ </li><li> é™„åŠ å™¨è€ƒè™‘å¹¶è°ƒç”¨<em>ç¼–ç å™¨</em> ï¼Œ </li><li> ç¼–ç å™¨ä¼šç²¾ç¡®æ ¼å¼åŒ–æ—¥å¿—çš„ä¸€è¡Œï¼Œ </li><li> ä¸ºæ­¤ï¼Œä»–æ‹‰å‡ºäº†ä¸€ç³»åˆ—<em>è½¬æ¢å™¨</em> ï¼Œæ¯ä¸ª<em>è½¬æ¢å™¨</em>éƒ½æ­ç¤ºäº†å…¶<code>%</code> ï¼Œ </li><li> æˆåŠŸã€‚ </li></ol><br><p> ä¸ºç®€å•èµ·è§ï¼Œé€‰æ‹©äº†çº¯Javaé…ç½®ã€‚ å¦‚æœç‰¢è®°XMLé…ç½®ï¼Œè¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆæ˜æ˜¾ã€‚ ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºè‡ªå·±çš„é™„åŠ ç¨‹åº/ç¼–ç å™¨å¹¶æ³¨å†Œå®ƒä»¬-ç™»å½•åå°†ä»å®ƒä»¬çš„è‚ é“ä¸­è°ƒç”¨å®ƒä»¬ã€‚ å¿…é¡»è®°ä½ï¼Œå‡ ä¹æ‰€æœ‰åˆ›å»ºçš„å¯¹è±¡éƒ½å¿…é¡»ä½¿ç”¨<code>start()</code>æ–¹æ³•<code>start()</code> ã€‚ æŠ½è±¡ç¤ºä¾‹ï¼š </p><br><pre> <code class="java hljs"> Logger rootLogger = LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME); LoggerContext lc = rootLogger.getLoggerContext(); lc.reset(); <span class="hljs-comment"><span class="hljs-comment">// reset prev config var encoder = new PatternLayoutEncoder(); encoder.setContext(lc); encoder.setPattern("%-5level %message%n"); encoder.start(); var appender = new ConsoleAppender&lt;ILoggingEvent&gt;(); appender.setContext(lc); appender.setEncoder(encoder); appender.start(); rootLogger.setLevel(Level.DEBUG); rootLogger.addAppender(appender);</span></span></code> </pre> <br><h2 id="otdelyaem-loggiruemye-metody-drug-ot-druga"> å½¼æ­¤åˆ†å¼€çš„è®°å½•æ–¹æ³• </h2><br><p> è¿™æ ·ï¼Œåœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹å‰ï¼Œç™»å½•å¯ä»¥å°†ä¸€ç§æ–¹æ³•ä¸å¦ä¸€ç§æ–¹æ³•åŒºåˆ†å¼€æ¥ï¼Œå°†å…¶åç§°ä¿å­˜åœ¨<code>ThreadLocal</code> Mapped Diagnostic Contextä¸­ã€‚ æ­¤å¤–ï¼Œåœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥ä»<code>MDC</code>ç±»è·å–è¿™äº›å€¼ï¼Œå› ä¸ºæ—¥å¿—è®°å½•ä»£ç å°†åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”è¯¥æ•°æ®ä¹Ÿå°†ä¸ä¼šå­˜åœ¨-æˆ‘ä»¬é€šè¿‡<code>ILoggingEvent.getMDCPropertyMap()</code>è·å¾—å®ƒä»¬ã€‚ </p><br><p> åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­£å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">vooft</a>æ­£ç¡®æŒ‡å‡ºçš„é‚£æ ·ï¼Œæ‚¨éœ€è¦æ”¯æŒè°ƒç”¨å †æ ˆï¼Œè€Œä¸æ˜¯è¦†ç›–MDCå€¼ï¼Œè€Œæ˜¯å°†å…¶è¿”å›åˆ°å‰ä¸€å¸§ï¼Œè¿™æ˜¯é€šè¿‡å¼•å…¥æ–°çš„<code>ThreadLocal</code> ã€‚ åŸç†å›¾ç¤ºä¾‹ï¼š </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MDC.put(MDC_KEY_METHOD, currentMethod); <span class="hljs-comment"><span class="hljs-comment">// 1.  currentMethod    // 2.    // 3.       AOP, . } finally { String previousMethod = //     MDC.put(previousMethod); }</span></span></code> </pre> <br><h2 id="svoy-log-fayl-na-kazhdyy-metod"> æ¯ç§æ–¹æ³•éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ </h2><br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªï¼Œä¸è¦å¿˜è®°æ³¨å†Œè‡ªå·±çš„é™„åŠ ç¨‹åºï¼š </p><br><pre> <code class="java hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiAppender</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppenderBase</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoggingEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ILoggingEvent event)</span></span></span><span class="hljs-function"> </span></span>{ method = event.getMDCPropertyMap().get(MDC_KEY_METHOD); Appender appender = getOrCreateAppender(method); appender.doAppend(event); }</code> </pre> <br><p> ä»–æœ¬äººå‡ ä¹ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œåªå°†æ—¥å¿—è®°å½•åˆ°ä¸€ç»„å®é™…æ–‡ä»¶é™„åŠ ç¨‹åºä¸­ï¼Œæ¯ç§æ–¹æ³•å‡ä¸€ä¸ªã€‚ å§”æ´¾ä¸€ä½ï¼Œæœ€åˆé€‚ã€‚ æŒ‰éœ€åˆ›å»ºâ€œçœŸå®â€é™„åŠ å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"> fileAppender = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAppender&lt;ILoggingEvent&gt;(); fileAppender.setContext(lc); fileAppender.setAppend(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); fileAppender.setEncoder(getOrCreateEncoderByMethod(lc, method)); fileAppender.setFile(logFileByMethod.get(method)); fileAppender.start();</code> </pre> <br><h2 id="svoy-format-na-kazhdyy-metod"> æ¯ç§æ–¹æ³•éƒ½æœ‰è‡ªå·±çš„æ ¼å¼ </h2><br><p> ä¸ºæ­¤ï¼Œè¯·ä¿ç•™<code>Encoder</code>ç±»å‹çš„è‡ªåŠ¨åˆ›å»ºå¯¹è±¡çš„ç¼“å­˜ï¼š </p><br><pre> <code class="java hljs"> Map&lt;String, String&gt; patternByMethod = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  ;  Encoder getOrCreateEncoderByMethod(LoggerContext lc, String method) { String pattern = patternByMethod.get(method); encoder = new PatternLayoutEncoder(); encoder.setContext(lc); encoder.setPattern(pattern); encoder.start(); return encoder; }</span></span></code> </pre> <br><h2 id="kazhdomu-metodu-svoy-uroven-loggirovaniya"> æ¯ç§æ–¹æ³•éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—è®°å½•çº§åˆ« </h2><br><p>  <code>MultiAppender</code>å‘<code>MultiAppender</code>ç±»æ·»åŠ ä¸€ä¸ªæ£€æŸ¥ï¼šå¦‚æœäº‹ä»¶çº§åˆ«<code>MultiAppender</code>ä¸ºè¯¥æ–¹æ³•æŒ‡å®š<code>MultiAppender</code>é˜ˆå€¼ï¼Œåˆ™ä»…å°†å…¶è®°å½•ï¼š </p><br><pre> <code class="java hljs"> Map&lt;String, Level&gt; levelByMethod = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ILoggingEvent event)</span></span></span><span class="hljs-function"> </span></span>{ Level minLevel = levelByMethod.get(methodName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getLevel().levelInt &gt;= minLevel.levelInt) { appender.doAppend(event); }</code> </pre> <br><p> åŸåˆ™ä¸Šï¼Œå¯ä»¥å°†æ­¤é€»è¾‘æ”¾å…¥è¿‡æ»¤å™¨ä¸­ã€‚ </p><br><h2 id="rasshirenie-formata-svoimi-peremennymi"> ç”¨å˜é‡æ‰©å±•æ ¼å¼ </h2><br><p> ä¸ºäº†ä¸å›´å¢™èŠ±å›­ï¼Œè€Œè¦åˆ©ç”¨ç»è¿‡éªŒè¯çš„logbackåŸºç¡€ç»“æ„ï¼Œæ‚¨éœ€è¦å®šä¹‰è‡ªå·±çš„è½¬æ¢å™¨ç±»ï¼Œç¡®ä¿å®Œå…¨å…¬å¼€ï¼Œä»¥ä¾¿å¯ä»¥ä»å¤–éƒ¨å®ä¾‹åŒ–å®ƒã€‚ å¦‚æœæ‚¨éœ€è¦<code>MDC</code> ï¼Œè¯·ä»æ´»åŠ¨ä¸­è·å–å®ƒã€‚  <code>%custom</code>å˜é‡å¤„ç†ç¨‹åºä»æ­¤å¤„å¼€å§‹ï¼š </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomConverter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassicConverter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ILoggingEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// mdc = event.getMDCPropertyMap(); return "variable-expanded"; } }</span></span></code> </pre> <br><p> åœ¨å¸¸è§„é…ç½®è¿‡ç¨‹ä¸­ï¼Œæ³¨å†Œå¤„ç†ç¨‹åºï¼š </p><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configurePatterns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoggerContext lc)</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, String&gt; rules = lc.getObject(CoreConstants.PATTERN_RULE_REGISTRY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rules == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, String&gt;(); lc.putObject(CoreConstants.PATTERN_RULE_REGISTRY, rules); } rules.put(<span class="hljs-string"><span class="hljs-string">"custom"</span></span>, CustomConverter.class.getName()); }</code> </pre> <br><p> æˆ‘ä»¬å°†ä½¿ç”¨ä¾‹å¦‚<code>PatternLayoutEncoder</code>ä½œä¸ºç¼–ç å™¨ï¼Œå®ƒå°†æå–æ‰€æœ‰å†…å®¹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>%custom</code>å˜é‡å°†æ‰©å±•ä¸ºå­—ç¬¦ä¸²<code>"variable-expanded"</code> ã€‚ </p><br><h2 id="obnovlenie-konfiga-na-letu"> å³æ—¶æ›´æ–°é…ç½® </h2><br><p> å¼€ç®±å³ç”¨æœ‰è¿™æ ·çš„æœºä¼šï¼šå†æ¬¡è°ƒç”¨é…ç½®å™¨å‡½æ•°å°±è¶³å¤Ÿäº†ï¼Œä¸è¦å¿˜è®°åœ¨é‚£é‡Œæ‰§è¡Œ<code>LoggerContext::reset()</code>å¹¶æ¸…é™¤ç´¯ç§¯çš„ç¼“å­˜ã€‚ </p><br><h2 id="mnogopotochnost"> å¤šçº¿ç¨‹ </h2><br><p> å¦‚æœæˆ‘ä»¬é…ç½®çš„æ–¹æ³•ä½¿æ–°çº¿ç¨‹æ ©æ ©å¦‚ç”Ÿï¼Œé‚£ä¹ˆï¼Œå½“ç„¶ï¼ŒæŒ‡å®šçš„æ—¥å¿—è®°å½•è§„åˆ™å°†ä¸é€‚ç”¨äºå®ƒä»¬-çº¿ç¨‹local'yä¸ä¼šå•ç‹¬å‡ºç°åœ¨æ–°çº¿ç¨‹ä¸­ã€‚ å› æ­¤ï¼Œå¦‚æœè¦å°†æ–¹æ³•è®¾ç½®åº”ç”¨äºæ–°çš„æµï¼Œåˆ™å¿…é¡»åœ¨æ­¤å¤„å¤åˆ¶<code>MDC</code> ï¼š </p><br><pre> <code class="java hljs"> Map&lt;String, String&gt; mdcOrig = MDC.getCopyOfContextMap(); ExecutorService es = Executors.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">1</span></span>); es.submit(() -&gt; threadWorker(mdcOrig)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">threadWorker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, String&gt; parentMdc)</span></span></span><span class="hljs-function"> </span></span>{ MDC.setContextMap(parentMdc); log.error(<span class="hljs-string"><span class="hljs-string">"expected to appear in method2*.log"</span></span>); }</code> </pre> <br><h2 id="primer-celikom"> æ•´ä¸ªä¾‹å­ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/zencd/logback-setup</a> </p><br><h2 id="literatura"> æ–‡å­¦ä½œå“ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹ç™»å½•æ‰‹å†Œ</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN463601/">https://habr.com/ru/post/zh-CN463601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN463587/index.html">ConfigureAwaitï¼Œåº”è¯¥å½’å’äºè°å’Œæ€ä¹ˆåŠï¼Ÿ</a></li>
<li><a href="../zh-CN463591/index.html">BlueKeep-2-Windowsçš„æ‰€æœ‰æ–°ç‰ˆæœ¬ç°åœ¨éƒ½å®¹æ˜“å—åˆ°æ”»å‡»</a></li>
<li><a href="../zh-CN463595/index.html">æˆ‘ä»¬æ§åˆ¶ç½‘ç»œæ‘„åƒå¤´çš„ç„¦ç‚¹æˆ–å°‘é‡Cï¼ƒå’ŒSTM32</a></li>
<li><a href="../zh-CN463597/index.html">åœ¨Reactä¸­ä½¿ç”¨Context APIåˆ›å»ºå“åº”å¼åº”ç”¨ç¨‹åºè®¾è®¡</a></li>
<li><a href="../zh-CN463599/index.html">â€œè¿™æ˜¯ä¸€åœºå™©æ¢¦â€ï¼šå®‡èˆªå‘˜å°±å¥½è±ååœ¨æ‹æ‘„å¤ªç©ºç”µå½±æ—¶çŠ¯çš„é”™è¯¯åˆ†äº«çœ‹æ³•</a></li>
<li><a href="../zh-CN463605/index.html">æŠ€æœ¯çŸ¥è¯†åˆ†å­-æ¥è‡ªæ·±ç©º</a></li>
<li><a href="../zh-CN463607/index.html">å¸¦æœ‰React Contextå’Œhookçš„Reduxå†…ç½®æ›¿ä»£æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN463609/index.html">Directum Clubçš„æ¨èç³»ç»Ÿã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼Œåä½œ</a></li>
<li><a href="../zh-CN463611/index.html">ç¥å¥‡çš„æ’ä»¶ï¼Œå·ã€‚ 2.ç»ƒä¹ </a></li>
<li><a href="../zh-CN463613/index.html">Dockeré•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨å¸¸è§„Dockerfileåœ¨werfä¸­æ„å»º</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>