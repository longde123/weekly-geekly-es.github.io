<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Ä üõåüèª ü§§ Zuverl√§ssigkeit World of Tanks Server üå± üåï üë™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das heutige Thema - die Zuverl√§ssigkeit von World of Tanks Server - ist eher rutschig. Die Zuverl√§ssigkeit des Spiels ist ein Kompromiss, daher muss b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zuverl√§ssigkeit World of Tanks Server</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418977/"><p>  Das heutige Thema - die Zuverl√§ssigkeit von World of Tanks Server - ist eher rutschig.  Die Zuverl√§ssigkeit des Spiels ist ein Kompromiss, daher muss bei der Spieleentwicklung alles schnell und schnell erledigt werden.  Die Last auf den Servern ist gro√ü, und Benutzer neigen dazu, etwas aus Interesse zu brechen.  <strong>Levon Avakyan</strong> von RIT ++ sagte, was Wargaming tut, um Zuverl√§ssigkeit zu gew√§hrleisten. </p><br><p>  Wenn es um Zuverl√§ssigkeit geht, werden normalerweise st√§ndig √úberwachung, Stresstests usw. erw√§hnt.  Darin liegt nichts √úbernat√ºrliches, und der Bericht war Panzerspezifischen Momenten gewidmet. </p><br><img src="https://habrastorage.org/webt/x6/id/gr/x6idgr4r-xse32m9p4kqkps8ndi.jpeg"><br><br><p>  <strong>√úber den Sprecher:</strong> Levon Avakyan arbeitet f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wargaming</a> als Leiter von WoT Game Services und Reliability und befasst sich mit den Problemen der Zuverl√§ssigkeit von Panzerservern. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/x-Uk5xBsstA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Heute werde ich dar√ºber sprechen, wie wir dies tun, einschlie√ülich dessen, worum es beim World Of Tanks-Server geht, woraus er besteht, worauf er aufgebaut ist, damit Sie das Thema der Konversation verstehen.  Weiter werden wir √ºberlegen, was im Server selbst und um ihn herum schief gehen kann, da das Spiel bereits mehr als der Server ist.  Und wir werden auch ein wenig √ºber die Prozesse sprechen, da viele vergessen, dass ein gut etablierter Prozess in der Produktion nicht nur zum Erfolg von Ressourcen beitr√§gt (viele Praktiken stammen aus der realen Produktion), sondern auch die Qualit√§t und Zuverl√§ssigkeit der L√∂sung beeintr√§chtigt. <br><br><img src="https://habrastorage.org/webt/qa/oj/17/qaoj17globztvoj2lxan-yry9-a.jpeg"><br>  Wenn es um Zuverl√§ssigkeit geht, werden normalerweise st√§ndig √úberwachung, Stresstests usw. erw√§hnt.  Ich habe es hier nicht aufgenommen, weil ich es langweilig finde.  Wir haben darin nichts √úbernat√ºrliches entdeckt.  Ja, wir haben auch ein √úberwachungssystem. Wir f√ºhren Stresstests mit Stresstests durch, um die Zuverl√§ssigkeit des Systems zu erh√∂hen und zu wissen, wo es abfallen kann.  Aber heute werde ich dar√ºber sprechen, was spezifischer f√ºr Panzer ist. <br><br>
<h2>  BigWorld-Technologie <br></h2><br>  Dies ist eine Backend-Engine sowie ein Toolkit zum Erstellen von MMOs. <br><br>  Diese ziemlich alte BigWorld Server-Engine (entstanden in den sp√§ten 90ern - fr√ºhen 2000ern) besteht aus einer Reihe verschiedener Prozesse, die das Spiel unterst√ºtzen.  Prozesse werden in einem Cluster gestartet, der in einem Netzwerk von Maschinen miteinander verbunden ist.  Die Prozesse, die miteinander interagieren, zeigen dem Benutzer eine Art Spielmechanik. <br><br>  Die Engine hei√üt BigWorld, weil es sehr gut ist, Spiele darauf zu machen, in denen es ein gro√ües Feld (Raum) gibt, auf dem milit√§rische Operationen (Schlachten) stattfinden.  F√ºr Panzer passt das perfekt. <br><br>  In Bezug auf die Zuverl√§ssigkeit wurden die folgenden Hauptmerkmale in BigWorld investiert: <br><br><ul><li>  <strong>Lastausgleich.</strong>  Die Engine weist Ressourcen zu und versucht, zwei Ziele zu erreichen: <br><ol><li>  benutze so wenig Maschinen wie m√∂glich; </li><li>  Laden Sie gleichzeitig Ihre Anwendungen nicht so, dass ihre Auslastung einen bestimmten Grenzwert √ºberschreitet. </li></ol></li><li>  <strong>Skalierbarkeit.</strong>  Wir haben das Auto zum Cluster hinzugef√ºgt und Prozesse darauf gestartet - was bedeutet, dass Sie mehr Schlachten z√§hlen und Spieler akzeptieren k√∂nnen. <br></li><li>  <strong>Hohe Verf√ºgbarkeit.</strong>  Wenn zum Beispiel ein Auto gefallen ist oder bei einem der Spielprozesse, die dem Spiel selbst dienen, ein Fehler aufgetreten ist, besteht kein Grund zur Sorge - das Spiel wird es nicht bemerken, wird an einem anderen Ort wiederhergestellt und funktioniert. </li><li>  <strong>Bewahren Sie die Datenintegrit√§t und -konsistenz.</strong>  Dies ist die zweite Stufe der Fehlertoleranz.  Wenn es mehrere Cluster gibt, wie in Tanks, und eine Katastrophe im Rechenzentrum oder auf dem Hauptkanal aufgetreten ist, bedeutet dies nicht, dass wir die Spieldaten, die die Person gespielt hat, vollst√§ndig verlieren.  Wir werden uns erholen, die Konsistenz wird sein. </li></ul><br>  <strong>Die Prozesse in unserem System und ihre Funktionen</strong> <br><br><ul><li>  <strong>CellApp</strong> ist der Prozess, der f√ºr die Verarbeitung des Spielraums oder eines Teils davon verantwortlich ist. <br></li></ul>  Wie gesagt, BigWorld arbeitet mit bestimmten R√§umen, die wir in Zellen teilen.  Jede bestimmte Zelle unseres Spielraums wird von einer bestimmten Anwendung berechnet. <br><br><ul><li>  <strong>CellAppMgr</strong> - der Prozess, der die Arbeit von CellApp koordiniert, Lastenausgleich. <br></li></ul>  CellApp kann viele sein, dementsprechend muss es einen Prozess geben, der sie steuert. <br><br><ul><li>  <strong>BaseApp</strong> verwaltet Entit√§ten und isoliert Clients von der Arbeit mit CellApp. </li></ul>  Eines der grundlegenden Dinge in BigWorld ist das Konzept der Entit√§t - zum Beispiel das Konto eines Spielers.  Alles, was wir auf dem Schlachtfeld tun, tun wir mit dieser Entit√§t.  CellApps berechnen Physik und Spielmechanik, z. B. Schie√üen.  BaseApp arbeitet mit Entit√§ten.  Es dient dem Konto, Tank usw. <br><br><ul><li>  <strong>ServiceApp</strong> ist eine spezialisierte BaseApp, die eine Art Service implementiert. </li></ul>  Dies ist eine vereinfachte Version von BaseApp, einem Prozess, der verschiedene Servicearbeiten ausf√ºhrt.  Zum Beispiel sollte jemand in der Lage sein, aus RabbitMQ zu lesen.  Hier geht es nicht um Spielentit√§ten, sondern auch um ben√∂tigt. <br><br><ul><li>  <strong>BaseAppMgr</strong> verwaltet BaseApp und ServiceApp, da es auch viele davon gibt. </li><li>  <strong>LoginApp</strong> erstellt neue Verbindungen von Clients und Proxys f√ºr Benutzer auf BaseApp. </li><li>  <strong>DBApp</strong> implementiert eine Speicherzugriffsschnittstelle (Datenbanken).  Wir arbeiten mit Percona, aber es kann sich um eine andere Datenbank handeln. </li><li>  <strong>DBAppMgr</strong> koordiniert die Arbeit von DBApp. </li><li>  <strong>InterClusterMgr</strong> verwaltet die Intercluster-Kommunikation. </li><li>  <strong>Reviewer</strong> ist ein Prozessinspektor, der Prozesse neu starten kann. </li><li>  <strong>Bwmachined</strong> <strong>&nbsp;</strong>  - Ein Daemon, der auf jedem Computer im Cluster ausgef√ºhrt wird, um seine Arbeit zu koordinieren.  Es erm√∂glicht allen BaseApp-Managern, miteinander zu kommunizieren. </li></ul><br><img src="https://habrastorage.org/webt/z9/dq/he/z9dqhes39d5hjaah6aq4igy6kzg.jpeg"><br><br>  So sehen Panzer von innen aus, wenn auch nur ganz kurz: <br><br><ul><li>  Kunden verbinden sich √ºber das Internet und melden sich bei LoginApp an. </li><li>  LoginApp autorisiert sie mit DBApp und gibt eine Adresse von BaseApp aus. </li><li>  Weitere Kunden spielen auf ihnen. </li></ul><br>  All dies ist auf viele Maschinen verteilt, von denen jede √ºber eine BWMachineD verf√ºgt, die all dies verwalten, orchestrieren usw. kann. <br><br><h2>  √ñkosystem der Panzerwelt <br></h2><br>  Was ist da?  Es scheint, dass es einen Spieleserver gibt und die Spieler - einen Panzer gew√§hlt, zum Spielen gegangen sind.  Aber leider (oder freudig) entwickelt sich das Spiel weiter und die Spielmechanik des ‚Äûeinfachen Schie√üens‚Äú reicht nicht mehr aus.  Dementsprechend wurde der Spieleserver mit verschiedenen Diensten √ºberwachsen, von denen einige im Allgemeinen im Server nicht m√∂glich waren, w√§hrend wir andere speziell herausnahmen, um die Geschwindigkeit der Bereitstellung von Inhalten f√ºr den Spieler zu erh√∂hen.  Das hei√üt, es ist schneller, einen kleinen Dienst in Python zu schreiben, der eine Art Spielmechanik ausf√ºhrt, als dies innerhalb des Servers auf allen BaseAPPs, Support-Clustern usw. der Fall ist. <br><br>  Einige Dinge, zum Beispiel Zahlungssysteme, wurden urspr√ºnglich ausgegeben.  Wir ertragen andere, weil Wargaming schlie√ülich mehr als ein Spiel entwickelt.  Dies ist eine Trilogie: Panzer, Flugzeuge, Schiffe, und es gibt Blitz und Pl√§ne f√ºr neue Spiele.  Wenn sie sich in BigWorld befinden, k√∂nnen sie nicht bequem in anderen Produkten verwendet werden. <br><br>  Alles ging ziemlich schnell und chaotisch, was zu einigen Zootechnologien f√ºhrte, die in unserem Tank-√ñkosystem verwendet werden. <br><br>  Schl√ºsseltechnologien und Protokolle: <br><br>  1. Python 2.7, 3.5; <br><br>  2. Erlang; <br><br>  3. Scala; <br><br>  4. JavaScript; <br><br>  Frameworks <br><br>  5. Django; <br><br>  6. Falke; <br><br>  7. asyncio; <br><br>  Lagerung: <br><br>  8. Postgres; <br><br>  9. Percona. <br><br>  10. Memcached und Redis zum Zwischenspeichern. <br><br>  Alles in allem ist dies f√ºr den Spieler der Panzerserver: <br><br><ul><li>  Einzelautorisierungspunkt; </li><li>  Chat </li><li>  Clans; </li><li>  Zahlungssystem; </li><li>  Turniersystem; </li><li>  Metaspiele (globale Karte, befestigte Gebiete); </li><li>  Panzerportal, Clanportal; </li><li>  Content Management etc. </li></ul><br>  Aber wenn Sie schauen, sind dies etwas andere Dinge, die auf verschiedenen Technologien geschrieben sind.  Dies verursacht einige Zuverl√§ssigkeitsprobleme. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  Das Diagramm zeigt unseren Panzerserver zusammen mit seinem √ñkosystem.  Es gibt einen Spieleserver, Webdienste (intern und extern), einschlie√ülich ganz spezieller Dienste, die sich im Backend-Netzwerk befinden und Dienstfunktionen ausf√ºhren, sowie Dienste f√ºr diese, die die Schnittstellen tats√§chlich implementieren.  Zum Beispiel gibt es einen Clan-Dienst mit einem eigenen Clan-Portal, mit dem Sie diesen Clan verwalten k√∂nnen, es gibt ein Portal des Spiels selbst usw. <br><br>  Durch diese Trennung m√ºssen wir uns weniger um die Sicherheit k√ºmmern, da niemand Zugriff auf das interne Netzwerk hat - weniger Probleme.  Dies f√ºhrt jedoch zu zus√§tzlichen Anstrengungen, da wir Proxys ben√∂tigen, die Zugriff gew√§hren, wenn wir sie nach drau√üen schieben m√ºssen. <br><br>  Ich habe bereits gesagt, dass wir die Entscheidung getroffen haben, einige der Spielelogiken und andere Dinge vom Server zu entfernen.  Es gab eine Aufgabe, irgendwie alles in den Client aufzunehmen.  Wir haben ein wunderbares Client-Gateway, mit dem ein Tank-Client √ºber einige der APIs dieser internen Dienste direkt auf einen Server zugreifen kann - dieselben Clans oder APIs unserer Metaspiele. <br><br>  Au√üerdem haben wir das Chromium Embedded Framework (CEF) in den Tank-Client integriert.  Wir haben jetzt den gleichen Browser.  Der Spieler unterscheidet ihn nicht vom Spielfenster.  Auf diese Weise k√∂nnen Sie mit der gesamten Infrastruktur arbeiten und die Arbeit mit dem Spieleserver umgehen. <br><br>  Wir haben viele Cluster - so ist es passiert - ich sage Ihnen warum.  So sieht die GUS-Region aus. <br><br><img src="https://habrastorage.org/webt/rc/w4/ri/rcw4rignlicjgsjz8oeepp9cipa.jpeg"><br><br>  Alles ist in den Rechenzentren verteilt.  Je nachdem, wo der Ping besser ist, stellen die Spieler eine Verbindung zum Standort her.  Das gesamte √ñkosystem l√§sst sich jedoch nicht so skalieren, sondern haupts√§chlich in Europa und Moskau. Dies f√ºhrt auch zu Problemen mit der Zuverl√§ssigkeit - zus√§tzliche Latenz und Weiterleitung. <br><br>  So sieht das World of Tanks-√ñkosystem aus. <br><br>  Was kann mit all dieser Wirtschaft schief gehen?  Alles was du willst!  Und geht J. Aber nehmen wir es auseinander. <br><br><h2>  Wichtige Fehlerquellen innerhalb eines Clusters <br></h2><br><h4>  Ausfall einer einzelnen Maschine oder eines einzelnen Prozesses <br></h4><br>  Die einfachste Option, die wir vorhersagen k√∂nnen, ist der Ausfall einer Maschine oder eines Prozesses innerhalb eines Clusters.  Wir haben Cluster von 10 bis 100 Autos - etwas kann herausfliegen.  Wie gesagt, BigWorld selbst bietet sofort einsatzbereite Mechanismen, mit denen wir zuverl√§ssiger arbeiten k√∂nnen. <br><br><img src="https://habrastorage.org/webt/-3/tl/-q/-3tl-qfzv-9slfdcdbymwl--s3a.jpeg"><br><br>  Standardschema: Es gibt BaseApps, die auf verschiedene Computer verteilt sind.  Auf dieser BaseApp gibt es Entit√§ten, die Statusentit√§ten enthalten.  Jede BaseApp sichert sich mit Round Robin auf anderen. <br><br>  Angenommen, wir hatten eine Datei und einige BaseApp sind gestorben, oder die gesamte Maschine ist gestorben - es ist okay!  Die verbleibenden BaseApps haben diese Entit√§ten verlassen, sie werden wiederhergestellt und das Gameplay f√ºr den Spieler wird nicht leiden. <br><br><img src="https://habrastorage.org/webt/mm/ix/tp/mmixtp-1r1cmzro9zznc1o76a2g.jpeg"><br><br>  CellAPPs machen genau das Gleiche. Das einzige ist, dass sie ihre Zust√§nde auch auf BaseApps und nicht auf anderen CellAPPs speichern. <br><br>  Es scheint ein zuverl√§ssiger Mechanismus zu sein, aber ... <br><br><h5>  Sie m√ºssen f√ºr alles bezahlen <br></h5><br>  Im Laufe der Zeit begannen wir Folgendes zu beobachten. <br><br>  ‚Ä¢ Das Erstellen von Sicherungskopien von Entit√§ten beansprucht immer mehr Systemressourcen und Netzwerkverkehr. <br><br>  Tats√§chlich beginnt der Sicherungsprozess selbst, die Stabilit√§t des Systems zu beeintr√§chtigen, wenn innerhalb des Clusters der gr√∂√üte Teil des Netzwerks damit besch√§ftigt ist, Kopien an Round Robins zu √ºbertragen. <br><br>  ‚Ä¢ Die Gr√∂√üe von Entit√§ten nimmt mit der Zeit zu, wenn neue Attribute und Spielmechaniken hinzugef√ºgt werden. <br><br>  Das Unangenehmste ist jedoch, dass die Gr√∂√üe dieser Einheiten wie eine Lawine w√§chst.  Zum Beispiel f√ºhrt ein Spieler eine Aktion aus (kauft Spieleigenschaft), und dieser Vorgang wurde langsamer.  Wir haben es noch nicht abgeschlossen, aber √Ñnderungen an diesen Attributen gespeichert.  Das hei√üt, das System ist so schlecht, und wir beginnen immer noch, die Gr√∂√üe der Sicherung zu erh√∂hen, die durchgef√ºhrt werden muss.  Es gibt einen Schneeballeffekt. <br><br>  ‚Ä¢ Die Systemstabilit√§t nimmt insgesamt ab <br><br>  Aufgrund der Tatsache, dass wir versuchen, dem Sturz einer Maschine oder eines Prozesses zu entkommen, verringern wir die Stabilit√§t des gesamten Systems. <br><br>  <strong>Was haben wir getan, um damit umzugehen</strong> ?  Wir haben f√ºr jedes Unternehmen entschieden, hervorzuheben, was wirklich gesichert werden muss.  Wir haben die Attribute in ver√§nderbare und unver√§nderliche Attribute unterteilt und kopieren nicht die gesamte Entit√§t, sondern sichern nur die ver√§nderlichen Attribute.  Auf diese Weise haben wir einfach die Menge an Informationen reduziert, die wirklich ben√∂tigt werden, um Eisen zu halten.  Wenn Sie nun ein neues Attribut hinzuf√ºgen, sollte derjenige, der dies tut, klarer sehen, wo er es zuordnen soll.  Aber im Allgemeinen hat uns dies die Situation gerettet. <br><br>  Um ganz ehrlich zu sein, wurde dieser Mechanismus in BigWorld festgelegt, aber in Tanks wurde er irgendwann bis zum Ende nicht mehr unterst√ºtzt, und nicht jede Entit√§t kann sich von ihrer Sicherung erholen.  In Ships zum Beispiel unterst√ºtzen Jungs dies.  Dort k√∂nnen Sie die Maschinen sicher ausschalten - die Informationen werden einfach auf anderen Maschinen wiederhergestellt, und der Client bemerkt nichts.  Leider ist dies in Tanks nicht immer der Fall, aber wir werden die R√ºckgabe all dieser Funktionen erreichen, damit es so funktioniert, wie es sollte. <br><br><h4>  Ausfall des Rechenzentrums.  Multi-Cluster <br></h4><br>  Wenn pl√∂tzlich nicht 1-2 Autos fielen und wir anfingen, das gesamte Rechenzentrum, dh den Cluster, vollst√§ndig zu verlieren, welche Eigenschaften sollte das System haben, damit das Spiel in einer solchen Situation nicht f√§llt? <br><br><ul><li>  Jeder Cluster muss unabh√§ngig sein, dh: <br><ol><li>  muss eine eigene Datenbank haben; </li><li>  Der Cluster verarbeitet nur seine R√§ume (Kampfarenen). </li></ol>  Wenn also einige Arenen getroffen werden, funktionieren andere immer noch. </li><li>  Cluster m√ºssen miteinander kommunizieren, damit man zum zweiten sagen kann: ‚ÄûIch bin gefallen!‚Äú  Wenn es steigt, werden die Daten aus den gespeicherten Kopien wiederhergestellt. </li><li>  Es ist auch w√ºnschenswert, dass Sie den Benutzer von Cluster zu Cluster √ºbertragen k√∂nnen. </li></ul><br>  Im Moment sieht das Schema unseres Multi-Clusters so aus. <br><br><img src="https://habrastorage.org/webt/ov/qd/2u/ovqd2ufkauofi1ybo1wduomewtu.jpeg"><br><br>  Wir haben einen zentralen Cluster und sogenannte Peripherieger√§te, auf denen die eigentlichen Schlachten ausgetragen werden.  CellApp wird nicht auf dem zentralen Cluster ausgef√ºhrt, ansonsten ist es genau das gleiche wie alle anderen.  Es ist der zentrale Punkt der Kontoverarbeitung: Sie steigen dort auf, werden an die Peripherie gesendet, und an der Peripherie spielt bereits eine Person.  Das hei√üt, der Ausfall eines der Cluster f√ºhrt nicht zu einem Verlust der Funktionsf√§higkeit des gesamten Spiels.  Selbst der Ausfall des zentralen Clusters erm√∂glicht es neuen Spielern nicht, sich anzumelden, aber diejenigen, die bereits an der Peripherie spielen, k√∂nnen das Spiel fortsetzen. <br><br>  Die Tatsache, dass alles √ºber den zentralen Cluster f√ºr uns funktioniert, hat sich herausgestellt, da die BigWorld-Technologie im Allgemeinen selbst davon ausgeht, dass es einen speziellen Interclaster-Manager f√ºr den Verwaltungsprozess gibt.  In der Tat k√∂nnen solche Inter-Claster-Manager etwas angehoben werden. <br><br>  In der Vergangenheit brauchten Panzer einen Multi-Cluster, da die Online-Lawine zunahm.  Als wir den H√∂hepunkt von 200.000 Spielern erreichten, wurde der eingehende Datenverkehr von ihnen einfach nicht mehr √ºber das Netzwerk im Rechenzentrum platziert.  Wir mussten buchst√§blich eine L√∂sung finden, damit die Spieler in mehrere Rechenzentren eingef√ºhrt werden konnten. <br><br>  Tats√§chlich haben wir nur gewonnen, weil wir jetzt einen Multi-Cluster haben.  Es ist auch f√ºr Spieler n√ºtzlich geworden, da Ping, dh die Erreichbarkeit √ºber das Netzwerk, das Gameplay stark beeinflusst.  Wenn die Verz√∂gerung mehr als 50-70 ms betr√§gt, wirkt sich dies bereits auf die Qualit√§t des Spiels selbst aus, da in Tanks absolut alles auf dem Server berechnet wird.  Es gibt keine Berechnungen auf dem Client.  Denken Sie daher daran, dass praktisch nichts zu tun ist.  Nat√ºrlich werden dort einige Mods gemacht, aber sie beeinflussen den Prozess selbst nicht.  Sie k√∂nnen versuchen zu erraten, was passieren wird, aber die Spielmechanik selbst beeinflussen - nein. <br><br>  Aufgrund dieses Ansatzes ist unser <strong>zentraler Cluster zu einem Fehlerpunkt geworden</strong> .  Alles war f√ºr ihn geschlossen.  Wir haben uns entschieden - da diese Maschinen und eine gro√üe Wildlagerbasis dort stehen, lassen Sie unsere Peripherieger√§te sich ausschlie√ülich mit K√§mpfen befassen.  Dann m√ºssen wirklich keine gro√üen Mengen an Informationen gespeichert werden - es werden Schlachten gespielt und gespielt - lassen Sie uns dort alles sperren. <br><br>  Um absolut alles neu zu schreiben, um dem Konzept eines zentralen Clusters zu entkommen, gibt es jetzt keine Zeit, keinen besonderen Wunsch.  Aber wir haben uns zun√§chst entschieden, periphere Cluster zu lehren, miteinander zu kommunizieren.  Dann haben wir ein Loch in sie ges√§gt, damit sie √ºber Dienste von Drittanbietern beeinflusst werden k√∂nnen. <br><br>  Um beispielsweise eine Schlacht fr√ºher zu erstellen, musste dem zentralen Cluster mitgeteilt werden, dass eine Schlacht an einem Teil der Peripherie erstellt werden muss.  Durch interne Mechanismen bewegten sich die Entit√§ten, die Essenz der Arena wurde geschaffen usw. <br><br>  <strong>Jetzt ist es m√∂glich, die Peripherie direkt zu umgehen und den zentralen Cluster zu umgehen.</strong>  Also entfernen wir die zus√§tzliche Arbeit von ihm.  Bisher besteht jedoch kein Wunsch, vollst√§ndig auf ein Schema umzusteigen, bei dem alle Cluster fast Peer-to-Peer sind und dies alles von einigen Prozessen gesteuert wird, nicht jedoch vom Cluster. <br><br>  Ich erinnere Sie daran, dass wir zus√§tzlich zum Spielcluster mit seinen BaseApps, CellApps und anderen ein √ñkosystem haben. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  Wir versuchen sicherzustellen, dass die Leistung des √ñkosystems das Gameplay nicht beeinflusst.  Im schlimmsten Fall funktioniert das Turniersystem beispielsweise nicht, aber Sie k√∂nnen zuf√§llig spielen - die meisten Leute spielen ohnehin zuf√§llig.  Ja, wir haben die Qualit√§t verringert, aber im Allgemeinen k√∂nnen Sie mehrere Stunden ohne Turniere √ºberleben. <br><br>  Das passiert nicht immer.  Erstens gibt es bereits solche Webdienste, die tief in das Spiel eingebettet sind.  Ein einzelner Autorisierungspunkt ist beispielsweise ein Dienst, mit dem Sie sich im Web oder an einem Ort anmelden und tats√§chlich im gesamten Wargaming-Universum angemeldet sein k√∂nnen. <br><br>  Das zweite Beispiel ist ein Dienst, der Spielek√§ufe und -transaktionen bedient.  Es musste auch nur ins Spiel gebracht werden, weil wir eine Spur der Eink√§ufe des Spielers brauchten.  Tatsache ist, dass wir in einigen Regionen verpflichtet sind, dem Kunden Informationen dar√ºber anzuzeigen, welche Spieleigenschaft f√ºr echtes Geld gekauft wurde und welche f√ºr Spielgeld.  Das System hat dies anfangs nicht angenommen, niemand hat es vor 5 Jahren ausgelegt, aber das <strong>Gesetz ist hart: Sie m√ºssen es tun - tun Sie es</strong> . <br><br><h2>  Fehlerstellen des World of Tanks-√ñkosystems <br></h2><br><h3>  Problem Nummer 1. Erh√∂hte Last <br></h3><br>  Wir haben einen Multi-Cluster, in dem 10 Cluster mit einer gro√üen Anzahl von Maschinen.  Die Spieler spielen sie und das Web ist klein.  In jedem Rechenzentrum kauft niemand mehr f√ºnf Maschinen.  Gleichzeitig bieten wir die gleiche Funktionalit√§t und alles, was ben√∂tigt wird, direkt im Client.  Dies ist das Hauptproblem. <br><br><blockquote>  Interaktivit√§t und Reaktivit√§t der Schnittstelle sind die Hauptursache f√ºr eine erh√∂hte Belastung des √ñkosystems. <br></blockquote><br>  Ich werde zwei Beispiele aus dem Clandienst nennen: <br><br><ol><li>  Sie m√∂chten einen anderen Spieler in den Clan einladen.  Nat√ºrlich m√∂chte ich, dass der Eingeladene sofort eine Benachrichtigung erh√§lt und er sich Ihnen anschlie√üen kann.  Um dies zu implementieren, muss der Clan-Dienst den Client irgendwie benachrichtigen oder den Client von Zeit zu Zeit den Webdienst fragen lassen: ‚ÄûHat sich etwas ge√§ndert?  Habe ich neue Einladungen? "  Dies ist die erste Option, von der die zus√§tzliche Last kommen kann. </li><li>  Panzer haben ein befestigtes Regime.  Angenommen, es wird nicht von einer Person gespielt, sondern von mehreren.  Alle Spieler haben ein offenes Fenster mit befestigten Bereichen.  Der Kommandant baute das Geb√§ude.  Es ist ratsam, dass f√ºr alle, die dieses Fenster ge√∂ffnet haben, das Geb√§ude sofort angezeigt wird. </li></ol><br>  Die Entscheidung in der Stirn mit der Umfrage ist nicht sehr gut.  Tats√§chlich funktioniert es, es ist nur so, dass Sie so viele Kapazit√§ten daf√ºr zuweisen m√ºssen, dass diese Funktion keinen Gewinn f√ºr das Unternehmen bringt.  Und wenn die Funktion keinen Gewinn bringt, m√ºssen Sie dies nicht tun. <br><br><blockquote>  Mein pers√∂nlicher Rat, wie man damit umgeht: Der beste Weg, um das System unter Last zuverl√§ssiger zu machen, besteht darin, die Last im Allgemeinen irgendwie logisch zu reduzieren. </blockquote><br>  Sie sollten sich nicht mit Eisen niederlassen, sich neue Systeme einfallen lassen, etwas optimieren - je gr√∂√üer die Last, desto mehr Artefakte erscheinen, von denen Sie nicht loskommen k√∂nnen.  Dar√ºber hinaus treten Artefakte auch auf immer niedrigeren Abstraktionsebenen auf - zuerst mit Anwendungen, dann mit verschiedenen Webdiensten, dann gelangen Sie zum Netzwerk (Cisco usw.).  Auf einer bestimmten Ebene k√∂nnen Sie die Probleme einfach nicht l√∂sen. <br><br>  Wenn Sie sorgf√§ltig √ºberlegen, k√∂nnen sie einfach vermieden werden. <br><br>  Als erstes haben wir <strong>gelernt, wie man Clients √ºber einen Spieleserver</strong> mithilfe seiner Infrastruktur <strong>benachrichtigt</strong> .  Wenn beispielsweise eine Einladung zum Clan eingeht, teilen wir dem Server mit: "Wir haben solche und solche Personen eingeladen", und dann findet der Cluster-Cluster selbst die Person, an die die Benachrichtigung gesendet werden soll, insbesondere da sie eine Verbindung haben.  Das hei√üt, wir dr√§ngen vom Service und nicht jemand sch√ºttet uns st√§ndig aus.    ,          ,       .   ,   ,    . <br><br>  ‚Äî  <strong>Web-sockets (nginx-pushstream)</strong> . ,      Web-sockets.   ,      Chromium Embedded Framework ‚Äî  ,   , Web-sockets   Nginx.   pushstream,     Web-sockets       . <br><br><h3>  ‚Ññ 2.    <br></h3><br>  ,    ,   ,  <strong> ‚Äî  </strong> .    ,    ,    ‚Äî    . <strong>    ,    </strong> ,   . <br><br>   ?  : -  , - ,             ,    .   - , , .    . <br><br>        . <br><br><img src="https://habrastorage.org/webt/ul/8f/6m/ul8f6mjlivwkgkswzl-cwtxlx-o.jpeg"><br><br>  ,      <strong>120      </strong> <strong>Game Play</strong> .    .         ,     ,      .      ,          .    . <br><br> <strong> </strong> <br><br>  3  ,   : <br><br><ol><li> HTTP API; </li><li> RabbitMQ ‚Äî  ; </li><li> Apache Kafka     . </li></ol><br>     ,    ,  ,  ,      ,    .     ,  -  ‚Äî ,    .          ,      . <br><br> <strong> </strong> <br><br> <strong>1. HTTP</strong> <br><br>    ‚Äî  HTTP.   ,  ,   -,      .      : <br><br><ul><li>      (  ,     ). <br></li></ul><br> ,    ,       .    ,   , ,  Django,    100  200 ,    API,  .    ,   ,   - 30-40 ,     ,   .   ,   ‚Äî     . <br><br><ul><li>      . <br></li></ul><br>  ,    ,   HTTP, ‚Äî       .      .   ‚Äî  ‚Äî  .   , <strong> ,  , ,  </strong> . <br><br><ul><li>     . <br></li></ul><br>     .   .  - ,   - API ‚Äî    API,        . <br><br>      ‚Äî      ,      . ,   ,      . ,      10 ,  -     100    500. ,    HTTP     .    nginx'   ,       ‚Äî  . <br><br>  ,    HTTP  ,         . <br><br> <strong>2. RabbitMQ</strong> <br><br>    RabbitMQ     BigWord     . <br><br><ul><li>     . <br></li></ul><br>         ‚Äî -  ,   ,  , . <br><br><ul><li>   ¬´¬ª,    ,        . <br></li></ul><br>    :      .    ,     API: ¬´      N    ‚Äî    ¬ª.    ,      , , ,  ‚Äî          .      ,      . <br><br>  ¬´¬ª,   ¬´¬ª,    ‚Äî       . <br><br><ul><li>     . <br></li></ul><br> RabbitMQ  ,      , ,      ,      ,   ,      ,   . <br><br><blockquote>   ‚Äî    RabbitMQ     . </blockquote><br> <strong>3. Kafka</strong> <br><br>     ,    ,     ‚Äî   Kafka.   ,   RabbitMQ   -     . <br><br><ul><li>     . <br></li></ul><br>     ,       ,    ,    .  ,  ,        .      .   Kafka. ,    ‚Äî    ,    . <br><br><ul><li>     . <br></li></ul><br>    ,     .        ,    ,     -  ‚Äî     . <br><br>  Kafka   ,    ,        ,    -   ,       .      . <br><br><h2>    <br></h2><br>      ‚Äî    . <br><br><img src="https://habrastorage.org/webt/ke/ty/oc/ketyocondz4qhsiguntwchhmonq.jpeg"><br><br> : <br><br><ul><li>   <strong> </strong> .         ,   - ,   .. </li><li>   <strong> </strong> ‚Äî  , , , . </li><li>      ‚Äî <strong>      </strong> ,    .       ,    ,   . </li></ul><br>     .     , , ,   entity.   .    ,     ,       . <br><br><h2> DLC <br></h2><br>    ,   DLC (Development Lifecycle) ‚Äî ,  ,   . <br><br><img src="https://habrastorage.org/webt/3c/5t/c2/3c5tc2hlxbrgpdtjts88yxrcp3e.jpeg"><br><br>     ,  ,   . DLC   ,        ,          .       ,  . ,      ,       ,     . <br><br>           DLC,       .     ,        ,    ,  . <br><br>     DLC,   ,    : <br><br> ‚Ä¢ <strong>   (      ).</strong> <br><br>     ,    ,    ¬´- ,   ¬ª,   .     ,       , ,    ,    . <br><br> ‚Ä¢        :   SRE. <br><br>    ,  solution-, technical-owner, reability- ‚Äî       ,   -  ,    game-    .    , ,     ,       .   - ,      ,    ,      ,   .    ,     . <br><br> ‚Ä¢ <strong>SRE    .</strong> <br><br>        ‚Äî  -   .          ,        .    ,  SRE     -.    SRE  ,     : ¬´    ,       ,    ,     ‚Äî   !¬ª      ,   . <br><br>        QA ,    , -  , ,    ‚Äî    . <br><br><h2>  <br></h2><br> BigWorld Technology  ¬´¬ª       .      ,  .         .  ¬´ ¬ª,    . <br><br>  ¬´  ¬ª     ,     ,    .   ‚Äî ¬´¬ª (, ) ‚Äî     .      ,        . , -  . <br><br> <i>:         ++.    ,    40        ,    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a>  ,      .</i> <br><br><blockquote>  RootConf   ‚Äî   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOpsConf Russia</a> .        DevOps <b>1  2   </b> ,  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> ,       . ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a>    ‚Äî    ! <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418977/">https://habr.com/ru/post/de418977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418963/index.html">DoBot Magician Desktop-Roboter Bewertung</a></li>
<li><a href="../de418969/index.html">Wie sind die letzten Tage des Rennens auf 1 Billion US-Dollar? (UPD .: Apple hat gewonnen)</a></li>
<li><a href="../de418971/index.html">Jupiters Strahlungskarten sind der Schl√ºssel zu neuen Erkundungen in Europa</a></li>
<li><a href="../de418973/index.html">Treffen Sie DevOpsConf Russia</a></li>
<li><a href="../de418975/index.html">Wie man den Erfolg misst. √úberwachungsstrategien und ihre Beziehung zu gesch√§ftlichen Problemen</a></li>
<li><a href="../de418979/index.html">Als ich durch das Land flog, implementierte ich ein Projekt f√ºr mehrere tausend Jobs</a></li>
<li><a href="../de418981/index.html">Numerische Methoden zur L√∂sung elliptischer Gleichungen</a></li>
<li><a href="../de418985/index.html">Analytik und Design als Ganzes</a></li>
<li><a href="../de418987/index.html">Firefox umgeht den Schutz in der neuen Google Mail-Oberfl√§che problemlos</a></li>
<li><a href="../de418991/index.html">Mikrofilm wird f√ºr ein halbes Jahrtausend existieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>