<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💏 🙎🏿 🧓🏿 ¿Qué es Android Lint y cómo te ayuda a escribir código compatible? 🌠 ♉️ 🙋🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando el desarrollador no es lo suficientemente cuidadoso, las cosas pueden salir muy mal. Por ejemplo, las omisiones clásicas del desarrollador son ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¿Qué es Android Lint y cómo te ayuda a escribir código compatible?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456272/"><p><img src="https://habrastorage.org/getpro/habr/post_images/b08/d73/2dc/b08d732dcbca4d0f30e476bbf65deeb8.jpg" alt="¿Qué es Android Lint y cómo te ayuda a escribir código compatible?"></p><br><p>  Cuando el desarrollador no es lo suficientemente cuidadoso, las cosas pueden salir muy mal.  Por ejemplo, las omisiones clásicas del desarrollador son el uso de una nueva versión de la API que no es compatible con el código anterior, la ejecución de acciones que requieren permisos especiales del usuario y lagunas en la localización de la aplicación.  Y estos son solo algunos de ellos. </p><br><p>  Además, Java y Kotlin, como cualquier otro lenguaje de programación, tienen sus propias construcciones que pueden conducir a un bajo rendimiento. </p><br><h2 id="privet-lint">  Hola pelusa </h2><br><p> Utilizamos una herramienta llamada Lint (o Linter) para evitar tales problemas.  Lint es una herramienta de análisis de código estático que ayuda a los desarrolladores a detectar posibles problemas antes de que el código se compile. <a name="habracut"></a>  Lint realiza múltiples comprobaciones del código fuente, que pueden detectar problemas como variables no utilizadas o argumentos de funciones, simplificación de condiciones, alcance incorrecto, variables o funciones indefinidas, código mal optimizado, etc.  Cuando hablamos del desarrollo de Android, hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cientos de cheques Lint listos para usar</a> . </p><br><p>  Pero a veces necesitamos encontrar problemas específicos en nuestro código que no estén cubiertos por estas verificaciones existentes. </p><br><h2 id="privet-polzovatelskie-proverki-lint">  Hola cheques personalizados Lint </h2><br><p>  Antes de comenzar a codificar, definamos nuestro objetivo y veamos cómo implementarlo paso a paso con la API de Lint.  El objetivo es crear una verificación para detectar una llamada de método incorrecta para un objeto.  La idea de esta prueba es determinar si el método de instalación del oyente en el componente Ver es tal que interrumpirá varios clics consecutivos en el componente para que podamos evitar abrir la misma Actividad o acceder a la red varias veces. </p><br><p>  Las comprobaciones de usuario de Lint se escriben como parte del módulo estándar Java (o Kotlin).  La forma más fácil de comenzar es crear un proyecto simple basado en Gradle (no tiene que ser un proyecto de Android). </p><br><p> Luego agregue las dependencias Lint.  En el archivo <code>build.gradle</code> de su módulo, agregue: </p><br><pre> <code class="plaintext hljs">compileOnly "com.android.tools.lint:lint-api:$lintVersion" compileOnly "com.android.tools.lint:lint-checks:$lintVersion"</code> </pre> <br><p>  Ahora hay un truco que aprendí al investigar este tema.  <code>lintVersion</code> debe ser <code>gradlePluginVersion + 23.0.0</code> .  <code>gradlePluginVersion</code> es una variable definida en el archivo <code>build.gradle</code> a nivel de proyecto.  Y en este momento, la última versión estable es 3.3.0.  Esto significa que <code>lintVersion</code> debería ser 26.3.0. </p><br><p>  Cada verificación de pelusa consta de 4 partes: </p><br><ul><li>  <strong>El problema</strong> es el problema en nuestro código que estamos tratando de prevenir.  Cuando falla la comprobación de pelusa, esto se informa al desarrollador. </li><li>  <strong>Detector</strong> es una herramienta de búsqueda de problemas que proporciona la API de Lint. </li><li>  <strong>Una implementación</strong> es un área donde puede surgir un problema (archivo fuente, archivo XML, código compilado, etc.). </li><li>  <strong>Un registro</strong> es un registro de verificación de pelusa personalizado que se utilizará con un registro existente que contiene verificaciones predefinidas. </li></ul><br><h2 id="realizaciya">  Implementación </h2><br><p>  Comencemos creando una implementación para nuestra validación personalizada.  Cada implementación consta de una clase que implementa un detector y un alcance. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> correctClickListenerImplementation = Implementation(CorrectClickListenerDetector::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Scope.JAVA_FILE_SCOPE)</span></span></span></span></code> </pre> <br><p>  Recuerde que <code>Scope.JAVA_FILE_SCOPE</code> también funcionará para las clases de Kotlin. </p><br><h2 id="problema">  El problema </h2><br><p>  El siguiente paso es usar esta implementación para determinar el problema.  Cada problema consta de varias partes: </p><br><ul><li>  <strong>ID</strong> es un identificador único. </li><li>  <strong>Descripción</strong> : una declaración breve (5-6 palabras) del problema. </li><li>  <strong>Explicación Una</strong> explicación completa de un problema con una sugerencia sobre cómo solucionarlo. </li><li>  <strong>Categoría</strong> : la categoría del problema (rendimiento, traducción, seguridad, etc.). </li><li>  <strong>Prioridad</strong> : la importancia del problema, en el rango de 1 a 10, donde 10 es el más alto.  Esto se usará para ordenar los problemas en el informe creado cuando se lanzó Lint. </li><li>  Gravedad: la gravedad del problema (fatal, error, advertencia, información o ignorar). </li><li>  <strong>Una implementación</strong> es una implementación que se utilizará para detectar este problema. </li></ul><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ISSUE_CLICK_LISTENER = Issue.create( id = <span class="hljs-string"><span class="hljs-string">"UnsafeClickListener"</span></span>, briefDescription = <span class="hljs-string"><span class="hljs-string">"Unsafe click listener"</span></span>, explanation = <span class="hljs-string"><span class="hljs-string">"""" This check ensures you call click listener that is throttled instead of a normal one which does not prevent double clicks. """</span></span>.trimIndent(), category = Category.CORRECTNESS, priority = <span class="hljs-number"><span class="hljs-number">6</span></span>, severity = Severity.WARNING, implementation = correctClickListenerImplementation )</code> </pre> <br><h2 id="detektor">  Detector </h2><br><p>  La API de Lint ofrece interfaces para cada área que puede definir en una implementación.  Cada una de estas interfaces proporciona métodos que puede anular y acceder a partes del código que le interesan. </p><br><ul><li>  <strong>UastScanner</strong> : archivos Java o Kotlin (UAST: <em>árbol de sintaxis abstracta unificada (árbol de sintaxis abstracta unificada</em> rusa)). </li><li>  <strong>ClassScanner</strong> - archivos compilados (bytecode). </li><li>  <strong>BinaryResourceScanner</strong> : recursos binarios como mapas de bits o archivos <code>res/raw</code> . </li><li>  <strong>ResourceFolderScanner</strong> : carpetas de recursos (no archivos específicos en ellas). </li><li>  <strong>XmlScanner</strong> : archivos XML. </li><li>  <strong>GradleScanner</strong> : archivos de Gradle. </li><li>  <strong>OtherFileScanner</strong> : todo lo demás. </li></ul><br><p>  Además, la clase <code>Detector</code> es una clase base que tiene implementaciones vacías de todos los métodos proporcionados por cada una de las interfaces anteriores, por lo que no necesita implementar la interfaz completa en caso de que necesite un solo método. </p><br><p>  Ahora estamos listos para implementar un detector que verificará la llamada al método correcto para el objeto. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> REPORT_MESSAGE = <span class="hljs-string"><span class="hljs-string">"Use setThrottlingClickListener"</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *   ,        *     ,      . */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorrectClickListenerDetector</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Detector</span></span></span></span>(), Detector.UastScanner { <span class="hljs-comment"><span class="hljs-comment">/** * ,  ,      . *         , *          , *      ,   . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApplicableUastTypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> UElement&gt;&gt;? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listOf&lt;Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> UElement&gt;&gt;(UCallExpression::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) } /** *      </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UAST</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">*    UAST   .    UElementHandler</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">*   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">    </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">*    </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type"> </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type"></span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type"></span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">  .. *        </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">   *    .     —  </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">  *   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">      . */ override fun createUastHandler</span></span></span></span>(context: JavaContext): UElementHandler? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: UElementHandler() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitCallExpression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(node: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">UCallExpression</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.methodName != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; node.methodName?.equals(<span class="hljs-string"><span class="hljs-string">"setOnClickListener"</span></span>, ignoreCase = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { context.report(ISSUE_CLICK_LISTENER, node, context.getLocation(node), REPORT_MESSAGE, createFix()) } } } } <span class="hljs-comment"><span class="hljs-comment">/** *    ,    *   IDE,      . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: LintFix { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fix().replace().text(<span class="hljs-string"><span class="hljs-string">"setOnClickListener"</span></span>).with(<span class="hljs-string"><span class="hljs-string">"setThrottlingClickListener"</span></span>).build() } }</code> </pre> <br><h2 id="reestr">  El registro </h2><br><p>  Lo último que debemos hacer es agregar problemas a nuestro registro y decirle a Lint que hay un registro de problemas especial que debe usar junto con el estándar. </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyIssueRegistry</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IssueRegistry</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> issues: List&lt;Issue&gt; = listOf(ISSUE_CLICK_LISTENER) }</code> </pre> <br><p>  En el nivel del módulo <code>build.gradle</code> : </p><br><pre> <code class="plaintext hljs">jar { manifest { attributes("Lint-Registry-v2": "co.infinum.lint.MyIssueRegistry") } }</code> </pre> <br><p>  donde <code>co.infinum.lint</code> es un paquete de la clase <code>MyIssueRegistry</code> .  Ahora puede ejecutar la tarea <code>jar</code> utilizando el script <code>gradlew</code> , y la biblioteca debería aparecer en el directorio <code>build/libs</code> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aquí hay</a> otro ejemplo de verificación de usuario de Lint, donde puede ver cómo procesar archivos XML. </p><br><h2 id="ispolzovanie">  Uso </h2><br><p>  Su nuevo cheque de pelusa está listo para usar en el proyecto.  Si esta verificación se puede aplicar a todos los proyectos, puede colocarla en la carpeta <code>~/.android/lint</code> (puede crearla si aún no existe). </p><br><p>  Además, puede poner su cheque en un módulo separado en su proyecto y habilitar este módulo como cualquier otra dependencia utilizando el método <code>lintChecks</code> . </p><br><h2 id="stoit-li-ono-togo">  ¿Vale la pena? </h2><br><p>  Lint es una herramienta realmente buena que todo desarrollador debería usar.  Ser capaz de detectar problemas potenciales con su código temprano es muy útil.  Aunque las comprobaciones personalizadas no son fáciles de escribir, principalmente debido a la complejidad de la API, definitivamente valen la pena y pueden ahorrarle mucho tiempo y esfuerzo en el futuro. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456272/">https://habr.com/ru/post/456272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456260/index.html">Charla de economía justa</a></li>
<li><a href="../456262/index.html">Radio definida por software: ¿cómo funciona? Parte 9</a></li>
<li><a href="../456264/index.html">Cree archivos binarios de Android con código fuente y NDK de Android. Bombeamos la utilidad screencap</a></li>
<li><a href="../456266/index.html">El resumen de materiales interesantes para el desarrollador móvil # 302 (del 10 al 16 de junio)</a></li>
<li><a href="../456270/index.html">Redis Stream - Fiabilidad y escalabilidad de sus sistemas de mensajería</a></li>
<li><a href="../456274/index.html">Psicólogos: los robots sexuales conducirán a un aumento en el número de personas sin pareja que no necesitan relaciones con otras personas</a></li>
<li><a href="../456276/index.html">¿Qué es la información?</a></li>
<li><a href="../456280/index.html">Comenzar con stm32 o no repetir mis errores</a></li>
<li><a href="../456282/index.html">Gráficos multidimensionales en Python: de tridimensional a seis dimensional</a></li>
<li><a href="../456288/index.html">MAM: montaje frontend sin dolor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>