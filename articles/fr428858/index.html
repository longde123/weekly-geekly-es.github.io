<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∞üèΩ üßñüèª üè∏ Conf√©rence DEFCON 17. Riez de vos virus! Partie 1 üèñÔ∏è ‚òÇÔ∏è üçÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Michael: Je souhaite la bienvenue √† tout le monde, je suis Michael Lai, voici Matthew Richard, vous pouvez l'appeler Matt ou Richard, car il a deux no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conf√©rence DEFCON 17. Riez de vos virus! Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/428858/"> <b>Michael: Je</b> souhaite la bienvenue √† tout le monde, je suis Michael Lai, voici Matthew Richard, vous pouvez l'appeler Matt ou Richard, car il a deux noms, mais cela n'a pas d'importance. <br><br>  <b>Matt:</b> Le sujet de notre conversation d'aujourd'hui est le ridicule des logiciels malveillants, et c'est exactement ce que nous essayons de faire. <br><br><img src="https://habrastorage.org/webt/dg/yd/dw/dgyddwjbkvhvkngc1lug68ifhb8.jpeg"><br><br>  Donc, tous ceux qui √©crivent le code ne le font pas bien, les gens font beaucoup d'erreurs.  Et tous ceux qui utilisent le virus ne le font pas correctement.  Il y a aussi des gens qui √©chouent dans ces deux cas.  Alors asseyez-vous plus confortablement, d√©tendez-vous et √©coutez, peut-√™tre que ces informations vous seront utiles. <br><br>  Au cas o√π, nous avons inclus des √©l√©ments techniques factuels dans la pr√©sentation afin que vous appreniez au moins quelque chose si la conversation ne vous semble pas dr√¥le.  Je note que ce n'est que notre opinion, qui peut ne pas co√Øncider avec celle de nos employeurs. <a name="habracut"></a><br><br>  <b>Michael: La</b> premi√®re histoire s'appelle "Ch√©rie, j'ai r√©duit l'entropie!"  Elle raconte comment l'auteur de Silent Banker, un algorithme de chiffrement tr√®s complexe, a oubli√© de cr√©er l'entropie en utilisant PRNG - un g√©n√©rateur de nombres pseudo al√©atoires.  Sur la diapositive, vous voyez un extrait de code Zeus de septembre 2007 dans lequel PRNG est utilis√© pour emp√™cher la d√©tection bas√©e sur le hachage.  La g√©n√©ration consiste √† lancer cette variable globale appel√©e ddTickCount: tout d'abord, elle la place dans le registre EAX, d'o√π la fonction est appel√©e pour la premi√®re fois.  Ensuite, il est v√©rifi√© si la valeur de la fonction est √©gale √† z√©ro, et si elle n'est pas √©gale, alors TickCount est appel√© pour g√©n√©rer SEED, c'est-√†-dire pour initier un nombre pseudo-al√©atoire, √† l'aide de la commande GetTickCount. <br><br><img src="https://habrastorage.org/webt/eq/lo/pv/eqlopvhuevvaq3r9k1oqbkdygy0.jpeg"><br><br>  Nous n'avons pas √©t√© surpris lorsque nous avons vu les similitudes avec ce code dans le fichier binaire Silent Banker de f√©vrier 2008.  Il utilise PRNG pour g√©n√©rer des noms de fichiers temporaires.  Ici aussi, il y a la m√™me variable globale ddTickCount, qui v√©rifie s'il y a un z√©ro, et si c'est le cas, alors un nombre pseudo-al√©atoire est initi√© √† l'aide de GetTickCount.  Tout d'abord, avant de voir msvsrt rand, le g√©n√©rateur de nombres pseudo-al√©atoires utilis√© par la fonction rand () de la biblioth√®que Microsoft C Runtime Windows, je pensais qu'il y avait une connexion entre l'auteur Zeus et l'auteur Silent Banker, uniquement bas√©e sur des nombres HEX cod√©s en dur dans un fichier binaire .  Mais en fait, ils √©taient tous deux li√©s statiquement √† msvsrt. <br><br>  Nous arrivons maintenant √† la recette du d√©sastre.  Il s'agit d'un extrait de code de la version Silent Banker de juillet 2008, publi√© quelques mois apr√®s la version de f√©vrier. <br><br><img src="https://habrastorage.org/webt/z9/wh/fr/z9whfrngqr3rhppqfx1xdficwio.jpeg"><br><br>  Ils ont mis √† jour leur code et publi√© une nouvelle version de Silent Banker, qui √©tait consid√©rablement diff√©rente de ce que nous avons vu plus t√¥t.  Dans ce programme, PRNG est utilis√© pour g√©n√©rer une cl√© de chiffrement.  Ici, vous ne voyez plus qu'une variable globale appel√©e CurrentSeed est v√©rifi√©e pour une √©galit√© √† z√©ro et qu'un nombre pseudo-al√©atoire est g√©n√©r√© en fonction de cela, il est simplement utilis√© dans ce code. <br><br><img src="https://habrastorage.org/webt/tz/ig/ny/tzignymsyqo08w5wjth2zugzo38.jpeg"><br><br>  Il est possible que quelque part dans le fichier binaire, m√™me avant cet endroit, la valeur de cette variable globale soit g√©n√©r√©e sous la forme d'un certain type de nombre.  Je passe donc au d√©montage de ce code et vois si la valeur CurrentSeed est utilis√©e ailleurs dans le programme avant d'√™tre utilis√©e dans cette fonction rand ().  Vous voyez qu'initialement dd part de z√©ro, et nous allons v√©rifier les r√©f√©rences crois√©es √† cette variable. <br><br><img src="https://habrastorage.org/webt/xb/gw/uh/xbgwuhestru6xn4re261ayainnk.jpeg"><br><br>  Dans la colonne T, la valeur w signifie qu'il n'y a qu'une seule op√©ration valide pour cette variable globale dans tout le fichier binaire - c'est la fonction rand elle-m√™me.  Je vais passer en revue ces choses couramment car elles ont d√©j√† √©t√© mentionn√©es lors de la DefCon de l‚Äôann√©e derni√®re.  Sur la diapositive ¬´Recipe for Disaster¬ª, la ligne Seed the PRNG, ou ¬´Initiation of a Pseudo Random Number Generator¬ª, est affich√©e en gris pour indiquer que l'auteur de Silent Banker n'a pas effectu√© cette initiation. <br><br><img src="https://habrastorage.org/webt/bp/aj/n9/bpajn9ym0w4nhtdxaboum9cm2oe.jpeg"><br><br>  L'√©tape suivante consiste √† g√©n√©rer une cl√© de 16 octets, effectuant 1000 appels syst√®me √† la fonction MyRand ().  Ensuite, √† partir d'une cl√© de 16 octets, ils g√©n√®rent un nombre de 8 octets - la cl√©, √† l'aide d'une formule sp√©cifique. <br><br>  Apr√®s cela, ils g√©n√®rent un autre num√©ro de 8 octets pour cr√©er une cl√© secondaire √† partir du premier num√©ro de 8 octets, y ajoutent une valeur arbitraire √† partir du fichier de configuration INI et obtiennent une cl√© tertiaire, qui est √©galement un nombre de 8 octets.  Enfin, ils utilisent une fonction math√©matique de pr√©cision arbitraire pour transformer une cl√© de 8 octets en une cl√© de 32 octets. <br><br>  Apr√®s cela, ils chiffrent les donn√©es vol√©es telles que le mot de passe de l'utilisateur √† l'aide de la cl√© d'origine de 16 octets.  Mais ils ne transmettent pas ce nombre de ¬´16¬ª octets √† ¬´leur¬ª attaquant avec les donn√©es vol√©es, car envoyer la cl√© avec le message chiffr√© n'est pas une bonne id√©e.  Au lieu de cela, l'auteur de Silent Banker place un num√©ro de 32 octets dans les donn√©es vol√©es et l'envoie au destinataire, qui devrait avoir un programme qui reconvertit ce num√©ro en cl√© d'origine de 16 octets.  Cependant, nous n'avons pas ce programme! <br><br>  La diapositive suivante montre une recette pour utiliser cette catastrophe avec le num√©ro 1 - le manque d'un g√©n√©rateur PRNG - √† votre avantage. <br><br><img src="https://habrastorage.org/webt/al/wp/lm/alwplmsbxy8ej3auux-aa0v6qbk.jpeg"><br><br>  Pour commencer, nous assimilons la valeur de PRNG √† z√©ro.  Nous pouvons automatiser les quatre √©tapes suivantes √† l'aide d'un script Python pour le d√©bogueur, car nous avons une formule qui calcule une cl√© de 16 octets, une cl√© de 8 octets, la cl√© de 8 octets suivante et une cl√© de 32 octets.  Cette formule n'est pas dans le code C, mais nous l'avons parce que nous avons une copie du fichier binaire Silent Banker dans laquelle elle existe. <br><br>  Je vais vous montrer une d√©monstration du fonctionnement de ce script Python.  Nous avons un bon sc√©nario: ici, j'ai Silent Banker et un d√©bogueur ind√©pendant auquel je suis attach√©, ainsi qu'Internet Explorer, dans lequel s'ex√©cute Silent Banker.  J'ai not√© quatre fonctionnalit√©s qui g√©n√®rent des cl√©s de cryptage.  J'inclus ce script Python montr√© dans la diapositive pr√©c√©dente, que j'invoque avec la commande bang keygen.  Vous pouvez voir que le d√©bogueur "perd" simplement ces quelques fonctions que je veux effectuer pour cette d√©mo 5 fois.  Mais dans la vraie vie, nous avons effectu√© cette action 5000 fois pour obtenir un plus grand jeu de cl√©s. <br><br>  Sur le panneau de journal, vous pouvez voir que pour chaque it√©ration de la boucle, une cl√© primaire de 16 octets est sortie, qui est ensuite associ√©e √† une cl√© de 32 octets.  En m√™me temps que le script imprime des informations dans le journal, un fichier texte est √©galement cr√©√© sur le disque, qui comprend des paires de cl√©s associ√©es de 16 et 32 ‚Äã‚Äãoctets.  Il s'agit simplement d'un fichier hexad√©cimal HEX, nous pouvons donc utiliser notre script Python pour traiter ce fichier, nous avons √©galement un r√©pertoire de journaux que nous avons r√©cup√©r√© √† partir du n≈ìud de commande et de contr√¥le vol√©. <br><br><img src="https://habrastorage.org/webt/3l/s8/q5/3ls8q5neoqhw_1vzzbx9iadyvuy.jpeg"><br><br>  En haut, vous voyez plusieurs certificats de cl√©s priv√©es chiffr√©es, et en dessous, plusieurs fichiers texte contenant des donn√©es chiffr√©es.  Nous pouvons simplement ex√©cuter le programme et rechercher √† l'int√©rieur de ces fichiers texte en extrayant cette cl√© de 32 octets et la cl√© d'origine de 16 octets qui lui est associ√©e. <br><br>  D√®s que le programme trouve une cl√© de 16 octets, il d√©chiffre les informations qu'il contient et les pr√©sente sous la forme d'un fichier texte.  Vous voyez ce fichier √† l'√©cran et il est impossible de le lire. <br><br><img src="https://habrastorage.org/webt/_l/65/sk/_l65skt8szevodoual8wimixbhi.jpeg"><br><br>  Mais alors nous avons un tas de fichiers temporaires .tmp lisibles, d'o√π nous pouvons obtenir ces informations et les renvoyer aux propri√©taires "l√©gitimes".  Ainsi, tout le travail acharn√© pour prot√©ger les informations a √©t√© fait par Silent Banker en vain car ils ont oubli√© de lancer un g√©n√©rateur de nombres pseudo-al√©atoires. <br><br><img src="https://habrastorage.org/webt/bm/kj/qn/bmkjqnl8fuofa6yhjzjfhg2golq.jpeg"><br><br>  Maintenant, je vais montrer la meilleure partie de ce qui pr√©c√®de - c'est la fonction Silent Banker, que j'ai appel√©e Why_Not_Use_This (pourquoi ne pas l'utiliser?). <br><br><img src="https://habrastorage.org/webt/nz/yi/-l/nzyi-lwhkvyqil67khx6wt6zeiy.jpeg"><br><br>  En fait, √† l'int√©rieur de leur propre programme, ils ont la fonction GetCursorPos (d√©terminer la position du curseur) pour g√©n√©rer l'entropie, qui peut √™tre utilis√©e pour lancer PRNG, et nous pouvons v√©rifier les r√©f√©rences crois√©es √† cette fonction √† l'int√©rieur du programme. <br><br><img src="https://habrastorage.org/webt/eb/7z/pu/eb7zpunaanojkiys5gc6wx8cgvi.jpeg"><br><br>  Nous voyons qu'il est utilis√© dans 10 √† 15 autres endroits du code.  Ainsi, il s'av√®re que les auteurs de Silent Banker n'ont pas oubli√© d'ins√©rer un g√©n√©rateur de nombres pseudo-al√©atoires dans le programme, ils ont simplement oubli√© d'ex√©cuter cette fonction dans le processus de cryptage en utilisant l'op√©rateur d'appel. <br><br><img src="https://habrastorage.org/webt/lp/_n/e-/lp_ne-pmgawe-72jw9_x0fvj6ym.jpeg"><br><br>  La diapositive suivante s'intitule "√áa s'est √©chapp√© ..." et elle montre comment ce programme fonctionnerait si l'auteur n'avait rien oubli√©. <br><br><img src="https://habrastorage.org/webt/x0/wn/kb/x0wnkb_6crrojmz0r7twgomdav0.jpeg"><br><br>  L'histoire suivante, intitul√©e ¬´DES ou pas DES¬ª, concerne un auteur de malware qui ne sait m√™me pas comment utiliser correctement l'interface de programmation Windows ou ne sait pas quelle est la taille maximale de la cl√© DES.  Par cons√©quent, en raison de la taille non valide de cette cl√©, son cheval de Troie est utilis√© par d√©faut avec l'op√©rateur logique xor. <br><br>  Ainsi, pour la fonction d'interface du programme CryptDeriveKey, les deux octets faibles du param√®tre dwFlags, indicateurs qui d√©finissent l'apparence de l'URL r√©sultante, d√©terminent la taille de votre cl√© de chiffrement. <br><br><img src="https://habrastorage.org/webt/2a/jt/-q/2ajt-qrub9dk2qkyhbea_panhly.jpeg"><br><br>  Donc, si les octets faibles sont 0080, la cl√© de chiffrement que nous demandons sera une cl√© RC4 de 128 bits.  C'est la m√™me chose que de se tirer une balle dans le pied, et je vais vous montrer pourquoi. <br><br><img src="https://habrastorage.org/webt/02/fm/ev/02fmevcyb9eos_-2a5qcpofweqq.jpeg"><br><br>  Sur la diapositive, vous voyez une ligne avec la mauvaise taille de la cl√© dwFlags 128 bits - 800000 et une ligne avec la mauvaise valeur MSCryptoAPI.  Je vais vous montrer le d√©montage de cette chose.  Vous voyez une fonction appel√©e ¬´initialisation du sous-syst√®me de chiffrement¬ª: le cheval de Troie appelle le contexte chiffr√©, puis cr√©e un conteneur pour le hachage MD5, puis cr√©e un hachage MD5 du mot de passe cod√© en dur dans le fichier binaire et essaie d'utiliser la sortie de cette fonction de hachage pour cr√©er une cl√© DES de 128 bits.  Cependant, aucune cl√© n'est cr√©√©e dans ce cas, car il n'existe pas de cl√© DES 128 bits. <br><br><img src="https://habrastorage.org/webt/cp/kv/os/cpkvosn5t2fsqsxbgd3kjdrb5-c.jpeg"><br><br>  Si l'une de ces fonctions API √©choue, elle saute √† cet endroit, que j'ai marqu√© en jaune, et affiche un message indiquant que la cl√© ne peut pas √™tre re√ßue.  Et cet endroit est ici, o√π il d√©place la valeur qui est en ebp et √† ce moment-l√† 0, c'est-√†-dire directement dans cette valeur bool√©enne bUseMSCryptoAPI. <br><br>  Voyons quel effet cela provoque lors de l'ex√©cution du programme.  Nous suivrons cet √©l√©ment de la structure du code pour voir o√π il est utilis√© dans le programme et comment se comporte cette exposition de cheval de Troie lorsque la fonction est vraie et lorsque la blessure est fausse. <br><br><img src="https://habrastorage.org/webt/-4/0d/m1/-40dm1wrxg7y9pjzfdyv5wp_ov8.jpeg"><br><br>  Nous voyons que la valeur logique est v√©rifi√©e dans la fonction que j'ai appel√©e chiffrer les donn√©es, ¬´chiffrement des donn√©es¬ª, et si c'est vrai, il s'agit de ce bloc, o√π le chiffrement DES et CryptEncrypt MSAPI sont utilis√©s. <br><br><img src="https://habrastorage.org/webt/bf/14/oz/bf14oz0sgb2bwpj9fkorcziwhhw.jpeg"><br><br>  Cependant, si cette valeur est 0, et comme nous le savons, elle sera toujours au d√©but z√©ro, la fonction va √† ce bloc, qui par d√©faut est xor. <br><br><img src="https://habrastorage.org/webt/3i/y2/go/3iy2gollhuccdcjwuclgygehxsq.jpeg"><br><br>  J'√©tais curieux de savoir √† quel moment l'auteur du programme malveillant a d√©cid√© de sauvegarder tout cela.  Peut-√™tre que les gens le poussaient d'en haut, il a donc √©t√© oblig√© de se d√©barrasser des logiciels malveillants, mais √† la derni√®re minute, il s'est rendu compte que son DES ne fonctionnait pas, il a donc utilis√© xor pour l'enregistrement de sauvegarde.  Dans l'ensemble, c'√©tait assez dr√¥le, donc la morale de cette histoire est de toujours faire des sauvegardes! <br><br>  L'histoire suivante s'intitule ¬´Qu'avez-vous fait de quoi?¬ª.  J'ai essay√© de trouver un terme d√©crivant le fonctionnement du cryptage du cheval de Troie Coreflood et j'ai d√©cid√© de l'appeler ¬´cryptage d√©pendant de l'emplacement¬ª.  Bref, les auteurs de ce cheval de Troie ont invent√© une nouvelle m√©thode de cryptage.  J'ai pens√©, peut-√™tre que quelqu'un a d√©j√† √©crit un article √† ce sujet et que √ßa devrait √™tre "google"?  Google m'a donn√© un lien vers un site de brevets am√©ricain o√π quelqu'un a d√©pos√© un brevet pour le "cryptage d√©pendant de l'emplacement".  Ce sch√©ma est assez d√©routant, il faudra donc beaucoup de temps pour l'√©tudier.  Voici comment cela fonctionne: je vous envoie un message crypt√©, et pour le d√©crypter et le lire, vous devez prendre un appareil GPS et vous rendre √† un point avec la latitude et la longitude que j'ai indiqu√©es.  En r√®gle g√©n√©rale, le chiffrement est un compromis entre s√©curit√© et convivialit√©, mais il n'y a ni l'un ni l'autre dans cette m√©thode. <br><br><img src="https://habrastorage.org/webt/ff/s5/bk/ffs5bkfdwagmbngmoms8efnmcje.jpeg"><br><br>  Ce n'est certainement pas s√ªr et vous oblige √† aller l√† o√π l'exp√©diteur pointe pour lire le message.  Matt a plaisant√© en disant que si vous vous battez en ligne par e-mail et que vous voulez vraiment vous d√©barrasser de quelqu'un, envoyez-lui un message crypt√© qu'il peut lire quelque part en Irak, et vous n'aurez plus de probl√®mes avec lui. <br><br>  Comment cette m√©thode est-elle utilis√©e dans le cheval de Troie Coreflood?  La diapositive montre un fragment de code √† partir duquel il s'ensuit qu'apr√®s que le cheval de Troie a vol√© des informations sur l'utilisateur, il les chiffre et les √©crit sur le disque afin que le cheval de Troie puisse plus tard recevoir ces informations et t√©l√©charger la commande et le contr√¥le sur son site Web. <br><br>  Cette fonction est appel√©e SetFilePointer (d√©finir le pointeur de fichier) et sa valeur de retour est dWord, indiquant le d√©calage dans le fichier sur lequel le pointeur a √©t√© d√©fini s'il a √©t√© d√©pass√©.  Ensuite, la fonction prend le nombre d'octets pour crypter nNumberOfBitesToWrite et le d√©place vers le registre ecx.  Elle prend ensuite le pointeur de donn√©es pour le chiffrement et le d√©place vers le registre edx. <br><br><img src="https://habrastorage.org/webt/rg/lp/tu/rglptunvnn4tddlxgtivifxdg6w.jpeg"><br><br>  Apr√®s cela, l'op√©rateur xor est utilis√©, ce qui place chaque octet dans le tampon al et ah, ce qui signifie des octets de bas et haut niveau renvoy√©s par SetFilePointer.  Ainsi, la cl√© de chiffrement dans ce sch√©ma est le d√©calage dans le fichier dans lequel les donn√©es existent.  C'est tout simplement incroyable! <br><br>  La diapositive suivante est intitul√©e ¬´Comment r√©initialiser un vidage de m√©moire¬ª.  Il repr√©sente le programme dumpCore que je viens d'√©crire et qui vient de sortir.  Vous pouvez le t√©l√©charger, il y a tout le code source.  Ce programme vous aidera si l'ordinateur est infect√© par le virus Coreflood, qui, pour une raison quelconque, n'a pas pu acc√©der au serveur de commande et de contr√¥le pour t√©l√©charger les donn√©es vol√©es.  Vous pouvez donc obtenir ces fichiers qu'il a enregistr√©s sur le disque et les d√©crypter en utilisant mon programme pour savoir ce qui vous a √©t√© vol√©, par exemple, si vous devez en informer le client. <br><br>  Les journaux des donn√©es vol√©es sont encercl√©s en rouge sur la diapositive. <br><br><img src="https://habrastorage.org/webt/xb/ib/c6/xbibc6gjkihoami36sqhcopedky.jpeg"><br><br>  Ce qui est toujours int√©ressant dans Coreflood: bien qu'il ait un algorithme de chiffrement assez faible, il essaie toujours de transf√©rer toutes les informations vol√©es sur la configuration informatique de la victime, toutes les informations cibles des banques et des coop√©ratives de cr√©dit, etc.  Ainsi, une autre fa√ßon de supprimer un vidage de m√©moire est appel√©e ¬´Comment supprimer un vidage de m√©moire √† l'aide de Wireshark¬ª.  Wireshark est un programme qui analyse le trafic r√©seau Ethernet ou le flux de donn√©es TCP. <br><br><img src="https://habrastorage.org/webt/ii/9h/4d/ii9h4d6emu0hiquq3xs1hxab78i.jpeg"><br><br>  La diapositive suivante montre le fonctionnement de Coreflood.  Ce sont des DLL qui sont entr√©es dans Explorer et Internet Explorer.  Ils modifient le registre, n√©cessitent un red√©marrage de l'application, mais ne n√©cessitent pas de red√©marrage du syst√®me.  Il existe diff√©rentes fa√ßons d'injecter ces DLL dans un processus. <br><br><img src="https://habrastorage.org/webt/ak/gk/hb/akgkhblgwmnu5tq_l2fcg7wrags.jpeg"><br><br>  La fa√ßon dont le virus p√©n√®tre dans l'ordinateur de l'utilisateur est importante pour les pirates qui souhaitent envahir le virus: faut-il un red√©marrage du syst√®me pour que le logiciel malveillant ait un effet, ou suffit-il que l'utilisateur red√©marre simplement l'application, dans ce cas, l'Explorateur. <br><br>  Et maintenant, c'est calme pour que personne n'entende! <br><br><img src="https://habrastorage.org/webt/yk/-q/97/yk-q97lw3wqjqp741oiik2yxudu.jpeg"><br><br>  C'est le code que nous avons reconstruit en utilisant la r√©tro-ing√©nierie.  Cela montre comment Coreflood arr√™te manuellement Explorer afin que les modifications prennent effet imm√©diatement.  Vous savez probablement ce qui se passe lorsque l'explorateur √©choue sur l'ordinateur - la barre des t√¢ches dispara√Æt, les fen√™tres de toutes les applications ouvertes, toutes les ic√¥nes du bureau disparaissent, puis, une √† une, elles commencent √† revenir √† leur place. <br><br>  Les auteurs de Coreflood √©taient √©videmment au courant de cela, ils ont donc plac√© un appel syst√®me √† cet endroit pour d√©finir le mode d'erreur "correct" du conducteur juste avant l'appel OpenProcess. <br><br>  Que fait la fonction SetErrorMode?  Il emp√™che une d√©faillance sp√©cifique des notifications envoy√©es au syst√®me qui cr√©ent une petite fen√™tre contextuelle et envoient un message d'erreur qui a conduit √† la fermeture de l'application.  Tout ce qu'ils ont fait avec ce message d'erreur √©tait d'emp√™cher une fen√™tre contextuelle d'appara√Ætre √† l'utilisateur avant l'√©chec d'Explorer.  Dites-moi ce qui semble plus suspect √† l'utilisateur: une petite fen√™tre pop-up accompagn√©e de la disparition de tout ce qui appara√Æt √† l'√©cran puis r√©appara√Æt, ou de la disparition et de l'apparition de tout sans aucun message d'erreur?  Je vous entends dire: ¬´les deux √©v√©nements¬ª. <br><br>  La diapositive suivante que j'ai intitul√©e ¬´Avec les bras et les jambes, mais sans t√™te¬ª.  Coreflood, lorsqu'il est charg√© en tant que dll, n'appara√Æt pas dans la liste des modules charg√©s.  Il alloue un peu de m√©moire sur le tas et se copie √† cet endroit du tas - je l'ai mis dans un cadre rouge. <br><br><img src="https://habrastorage.org/webt/ns/zf/em/nszfemfch9kulz_ualmhjd-5cf4.jpeg"><br><br>  Puis il supprime son en-t√™te PE, donc si vous rencontrez un ordinateur infect√© par ce cheval de Troie, dites alors: "ma prochaine √©tape devrait √™tre de vider ce fichier ex√©cutable et de le t√©l√©charger vers l'IDA pour analyse", mais il est tr√®s difficile de vider le fichier ex√©cutable, s'il n'y a pas son en-t√™te PE.  Ainsi, lorsque Coreflood appelle virtual alloc, il d√©finit l'indicateur mem de haut en bas, ce qui oblige le syst√®me √† renvoyer l'adresse la plus √©lev√©e et non la plus basse disponible.  Cela permet au cheval de Troie de masquer les guillemets d'ouverture / de fermeture dans une zone de m√©moire sup√©rieure du mode utilisateur parmi les autres DLL du syst√®me.  Par cons√©quent, la prochaine d√©mo que j'ai intitul√©e "Comment rendre inutile tout ce qui est cach√©." <br><br><img src="https://habrastorage.org/webt/wz/h8/1u/wzh81uifnp2xp6vl-xak505logk.jpeg"><br><br>  Lorsque vous rencontrez quelque chose comme Coreflood qui utilise la furtivit√© et qu'il n'y a pas d'outils pr√™ts √† l'emploi pour travailler avec de tels virus, vous devez cr√©er le v√¥tre. <br>  Si vous √™tes familier avec le d√©ballage, l'utilisation d'un d√©bogueur est courante pour vous.  Surtout s'il n'y a pas de d√©compresseur automatique, car ce n'est pas un algorithme commun.  Dans ce cas, vous pouvez utiliser le d√©bogueur pour acc√©der au point d'entr√©e d'origine, puis supprimer le vidage du cheval de Troie √† l'aide de ProcDump ou d'un autre utilitaire.       PE     Import Reconstructor,  ,          ,     . <br><br>      ,    .           .       Volatility,       Internet Explorer  .    ,   Coreflood,       ,    .  ,      7FF81000. <br><br><img src="https://habrastorage.org/webt/-d/zw/9b/-dzw9b_qihk8hpoouzgomi3hv2c.jpeg"><br><br>       ,    HEX    ,     Coreflood.    ,      ,          .               . <br><br> ,     ,  Coreflood,       Volatility  .     ,     ID  Internet Explorer.     ,   ,   PID  1732.     Malfind,      ,      ,         ,   .          VAD  ,  ,     .    ,    . <br><br><img src="https://habrastorage.org/webt/aq/mg/_m/aqmg_mfa2sy70g_y-pk77lw-hek.jpeg"><br><br>   ,      ,      7FF81000. ,          Fix IAT,     PID 1732 Internet Explorer      ,   Coreflood. <br><br>     dll,    Internet Explorer,             ,   RBA ,    ,   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il d√©sassemble ensuite toutes les informations, √† partir de la zone de m√©moire √† 7FF81000, et recherche les appels syst√®me qui conduisent √† l'une de ces fonctions export√©es. </font><font style="vertical-align: inherit;">Ainsi, il recr√©e la table des adresses import√©es m√™me sans en-t√™tes PE. </font><font style="vertical-align: inherit;">Vous voyez que le r√©sultat √©mis par lui ressemble au r√©sultat d'Import Reconstructor: il y a un module, la premi√®re fonction et chaque fonction import√©e des modules. </font><font style="vertical-align: inherit;">La sortie de ce script Fix IAT n'est pas ex√©cutable, vous pouvez donc l'ouvrir dans la visionneuse de modification PE et voir que la table d'importation a √©t√© correctement restaur√©e.</font></font><br><br><img src="https://habrastorage.org/webt/yz/9w/no/yz9wno8uv0z5jpt5922gwrhvofw.jpeg"><br><br>  21:15 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conf√©rence DEFCON 17. Riez de vos virus!</font></font></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2e partie</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OeG4KBWB-EY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Merci de rester avec nous.  Aimez-vous nos articles?  Vous voulez voir des mat√©riaux plus int√©ressants?  Soutenez-nous en passant une commande ou en le recommandant √† vos amis, une <b>r√©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la v√©rit√© sur VPS (KVM) E5-2650 v4 (6 c≈ìurs) 10 Go DDR4 240 Go SSD 1 Gbps √† partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 c≈ìurs) 10 Go DDR4 240 Go SSD 1 Gbit / s jusqu'en d√©cembre gratuitement</b> en payant pour une p√©riode de six mois, vous pouvez commander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV √† partir de 249 $</a> aux Pays-Bas et aux √âtats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©ation d'un b√¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428858/">https://habr.com/ru/post/fr428858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428848/index.html">Notes du fournisseur IoT: comment cr√©er un r√©seau LoRa dans une ville sans r√©seau en une journ√©e?</a></li>
<li><a href="../fr428850/index.html">Gestion du d√©veloppement dans un grand projet</a></li>
<li><a href="../fr428852/index.html">Diffusion ouverte de la salle principale HighLoad ++ 2018</a></li>
<li><a href="../fr428854/index.html">Comment couper la lumi√®re dans un petit centre de donn√©es: un moyen peu co√ªteux de d√©ployer une urgence</a></li>
<li><a href="../fr428856/index.html">Une merveilleuse astuce pour faire du mainteneur de projet open source un jour</a></li>
<li><a href="../fr428860/index.html">Conf√©rence DEFCON 17. Riez de vos virus! 2e partie</a></li>
<li><a href="../fr428864/index.html">Rendons le Web encore meilleur</a></li>
<li><a href="../fr428866/index.html">7 principes de design, attitude face aux tendances du design, portfolio UX-designer, ...</a></li>
<li><a href="../fr428868/index.html">Fichiers JAR √† plusieurs versions - mauvais ou bon?</a></li>
<li><a href="../fr428870/index.html">Mrr: FRP total pour React</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>