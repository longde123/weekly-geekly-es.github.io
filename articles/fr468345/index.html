<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚ÄçüöÄ üñêüèº üö∂ GitHub lance ses tentacules dans la gestion des CI / CD et des artefacts üêé üåº üë®‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En mai 2019, GitHub a annonc√© la sortie du service Registry Registry. Suite √† cela, d√©j√† en ao√ªt, un soutien pour CI / CD en Actions a √©t√© annonc√© . 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GitHub lance ses tentacules dans la gestion des CI / CD et des artefacts</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468345/"><p>  En mai 2019, GitHub a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">annonc√© la</a> sortie du service Registry Registry.  Suite √† cela, d√©j√† en ao√ªt, un soutien pour CI / CD en Actions a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">annonc√©</a> . </p><br><p>  Dans l'article, je vais vous dire quels types de services sont et comment cela peut √™tre utilis√© sur l'exemple d'un petit projet pour animaux de compagnie sur GitHub. </p><br><p><img src="https://habrastorage.org/webt/7s/te/zf/7stezfizd-3i3zlnp0xbay3ttou.png"></p><a name="habracut"></a><br><h2 id="chto-eto-za-servisy-takie">  De quels types de services s'agit-il? </h2><br><p>  GitHub Actions est une plateforme qui vous permet de g√©rer le cycle de vie du logiciel, dont le code source est h√©berg√© sur GitHub.  En fait, TravisCI, CircleCI et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreuses autres</a> plateformes CI / CD gratuites ont re√ßu un nouveau concurrent en la personne d'Actions. </p><br><p>  Le registre de packages GitHub est le r√©f√©rentiel central des artefacts; cinq types d'artefacts sont actuellement pris en charge. </p><br><p> <em>Types d'artefacts pris en charge dans les actions</em> </p><br><div class="scrollable-table"><table><thead><tr><th>  Support dans les actions </th><th>  Analogique </th><th>  La langue </th></tr></thead><tbody><tr><td>  Forfaits NPM </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.npmjs.com/</a> </td><td>  Javascript </td></tr><tr><td>  Images Docker </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://hub.docker.com/</a> </td><td>  - </td></tr><tr><td>  Artefacts Maven </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://mvnrepository.com/</a> </td><td>  Java </td></tr><tr><td>  Forfaits Nuget </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.nuget.org/</a> </td><td>  .NET </td></tr><tr><td>  Gemmes rubis </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://rubygems.org/</a> </td><td>  Rubis </td></tr></tbody></table></div><br><p>  C'est une opportunit√© pratique d'avoir tous les artefacts en un seul endroit, car il n'est pas toujours conseill√© de d√©ployer votre serveur Nexus ou Artifactory. </p><br><p>  GitHub devient de plus en plus similaire √† GitLab, et quelque part il a d√©j√† d√©pass√© un adversaire, par exemple, GitLab ne prend <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas encore en</a> charge les packages NuGet et les gemmes Ruby.  En fait, si auparavant pour les projets open source, vous deviez connecter des int√©grations externes √† GitHub, maintenant tous les ≈ìufs sont dans le m√™me panier.  Ici, laissez tout le monde d√©cider si c'est bon ou mauvais, mais au moins c'est pratique. </p><br><h2 id="kak-poprobovat">  Comment essayer? </h2><br><p>  Les deux services sont actuellement en mode b√™ta, vous pouvez vous inscrire pour un test b√™ta sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pages</a> . </p><br><p>  La migration √† partir d'autres services est tr√®s simple, j'ai migr√© plusieurs de mes projets favoris de TravisCI et DockerHub vers Actions et Package Registry respectivement. </p><br><p>  Je vais vous montrer √† quoi cela ressemble dans un exemple.  Le projet est le plus courant, j'en ai parl√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet</a> article.  Rien de compliqu√©, le code LaTeX habituel, √† l'aide duquel des artefacts sont collect√©s (2 fichiers PDF), ils sont publi√©s dans les versions de GitHub.  Afin de ne pas t√©l√©charger un tas de packages LaTeX, j'ai √©crit un Dockerfile afin que vous puissiez travailler facilement sous n'importe quel syst√®me d'exploitation. </p><br><h3 id="package-registry">  Registre des packages </h3><br><p>  Pour commencer √† travailler avec Package Registry au lieu de DockerHub, vous devez prendre seulement deux √©tapes simples. <br>  Nous cr√©ons un jeton dans les param√®tres GitHub (le jeton doit avoir le droit d'√©crire et de lire des artefacts). </p><br><p><img src="https://habrastorage.org/webt/7z/aj/p_/7zajp_bcvr7zvdvup4ocwkavs9s.png"><br>  <em>Page de cr√©ation de jeton</em> </p><br><p>  Et puis nous pouvons nous authentifier avec le jeton cr√©√© et pousser des artefacts, c'est aussi simple que cela: </p><br><pre><code class="bash hljs">docker login docker.pkg.github.com --username amet13 docker tag docker-latex:0.0.1 docker.pkg.github.com/amet13/master-thesis/docker-latex:0.0.1 docker push docker.pkg.github.com/amet13/master-thesis/docker-latex:0.0.1</code> </pre> <br><p>  Veuillez noter que j'ai sp√©cifiquement indiqu√© mon surnom sur GitHub en minuscules, sinon vous obtiendrez une erreur de Docker: </p><br><pre> <code class="plaintext hljs">Error parsing reference: "docker.pkg.github.com/Amet13/master-thesis/docker-latex:0.0.1" is not a valid repository/tag: invalid reference format: repository name must be lowercase</code> </pre> <br><p>  Voici √† quoi cela ressemble dans l'interface Web de GitHub: </p><br><p><img src="https://habrastorage.org/webt/il/n1/lk/iln1lkji7xcbwutpodohhtu6mac.png"><br>  <em>Page de registre des packages pour les images Docker</em> </p><br><p>  En plus des instructions pour t√©l√©charger la derni√®re image, des statistiques de t√©l√©chargement sont disponibles, la possibilit√© de t√©l√©charger une couche Docker distincte via l'interface Web, l'historique de t√©l√©chargement d'image est disponible. </p><br><h3 id="actions">  Actions </h3><br><p>  Les actions sont un peu plus compliqu√©es, mais pour ceux qui ont d√©j√† travaill√© avec un autre syst√®me CI / CD, ce ne sera pas difficile √† comprendre.  La configuration dans Actions est d√©crite par YAML d√©clarative, bien que HCL ait √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilis√©</a> auparavant. </p><br><p>  Quelques concepts de base (je ne traduirai pas intentionnellement les d√©finitions, je pense que tout est clair ici): </p><br><ul><li>  Workflow - un processus qui g√®re le cycle de vie du logiciel (build, test, package, release, deploy) pour le r√©f√©rentiel </li><li>  Fichier de workflow - le fichier dans lequel le workflow est d√©crit, il est situ√© √† la racine du r√©f√©rentiel dans le r√©pertoire <code>.github/workflows/</code> </li><li>  Le travail est √† chaque ex√©cution du workflow, le travail est d√©clench√©, √† un moment donn√©, beaucoup de travaux peuvent √™tre d√©marr√©s </li><li>  √âtape - chaque t√¢che a une √©tape, √† chaque √©tape, vous pouvez ex√©cuter des commandes ou des actions </li><li>  Action - un ¬´plug-in¬ª √©crit par quelqu'un, une liste de nombreuses actions peut √™tre trouv√©e dans le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">awesome-actions</a> </li><li>  Environnement virtuel - l'environnement sur lequel Job s'ex√©cute (en fait, c'est une machine virtuelle sous Windows, macOS ou Linux) </li><li>  Runner est un environnement d√©ploy√© pour lancer un Job, un seul Job peut √™tre ex√©cut√© sur Runner √† la fois </li><li>  √âv√©nement - un √©v√©nement qui d√©clenche le Workflow, par exemple, Push, Pull Request, Webhook, Cron Job, etc. </li><li>  Artefact - artefacts (binaires, images, journaux, etc.) </li></ul><br><p><img src="https://habrastorage.org/webt/li/o5/wo/lio5wo4cvnajpzvw29ohncr2v20.png"><br>  <em>Voici √† quoi ressemble la page Liste des travaux dans Workflow.</em> </p><br><p>  Limitations et interdictions: </p><br><ul><li>  20 workflows par r√©f√©rentiel </li><li>  1 000 demandes d'API par heure pour toutes les actions du r√©f√©rentiel </li><li>  temps de travail maximum - 6 heures </li><li>  20 Jobs peuvent travailler en parall√®le dans le r√©f√©rentiel (pour tous les Workflows) </li><li>  il est interdit d'utiliser des Actions pour l'extraction de crypto-monnaie et l'informatique sans serveur </li></ul><br><p>  La documentation la plus r√©cente est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce lien</a> . </p><br><p><img src="https://habrastorage.org/webt/vt/up/tn/vtuptngx2wtzrzoz8g_odzyases.png"><br>  <em>Et voici les journaux de l'un des Job</em> </p><br><h3 id="primer">  Exemple </h3><br><p>  Revenons √† l'exemple, <a href="">voici √†</a> quoi ressemble ma config, nous allons l'analyser plus en d√©tail par parties. </p><br><p>  Sp√©cifiez un nom pour Workflow et d√©crivez sur quel d√©clencheur il doit se d√©clencher (une liste de tous les d√©clencheurs est d√©crite dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> ): </p><br><pre> <code class="plaintext hljs">name: master-thesis on: [push]</code> </pre> <br><p>  Sur quel environnement virtuel ex√©cuter le travail: </p><br><pre> <code class="plaintext hljs">jobs: build: # ubuntu-latest, ubuntu-18.04, or ubuntu-16.04 # windows-latest, windows-2019, or windows-2016 # macOS-latest or macOS-10.14 runs-on: ubuntu-latest</code> </pre> <br><p>  La premi√®re √©tape, dans le <code>name:</code> sp√©cifiez le nom de l'√©tape (facultatif), et dans <code>uses:</code> quelle action nous voulons utiliser, dans ce cas, clonez le r√©f√©rentiel: </p><br><pre> <code class="plaintext hljs"> steps: - name: Checkout repo uses: actions/checkout@v1</code> </pre> <br><p>  √Ä l'√©tape suivante, nous n'utilisons pas Action, mais uniquement un ensemble de nos commandes o√π nous nous connectons au Registre de packages, collectons l'image Docker et la poussons dans le r√©f√©rentiel d'images.  Dans le bloc <code>env:</code> d√©finissons les variables d'environnement, nous prenons l'une d'entre elles des secrets: </p><br><pre> <code class="plaintext hljs"> - name: Build docker image and push it to the registry env: GITHUB_TOKEN: ${{ secrets.GH_TOKEN }} DOCKER_IMAGE_ORIGIN: "docker.pkg.github.com/amet13/master-thesis/docker-latex" run: | # Pull submodules git submodule init git submodule update --remote # Login to GitHub Packages and build Docker image docker login docker.pkg.github.com -u amet13 -p ${GITHUB_TOKEN} docker pull ${DOCKER_IMAGE_ORIGIN}:latest docker build -t ${DOCKER_IMAGE_ORIGIN}:${GITHUB_SHA} . # Generate PDF artifacts docker run --rm -i \ -v ${PWD}:/master-thesis:Z ${DOCKER_IMAGE_ORIGIN}:${GITHUB_SHA} \ bash -c "latexmk -xelatex -synctex=1 -jobname=master-thesis main.tex" docker run --rm -i \ -v ${PWD}:/master-thesis:Z ${DOCKER_IMAGE_ORIGIN}:${GITHUB_SHA} \ bash -c "cd presentation/ &amp;&amp; latexmk -xelatex -synctex=1 -jobname=presentation main.tex" # Publish Docker image to GitHub Packages (with latest tag) docker tag ${DOCKER_IMAGE_ORIGIN}:${GITHUB_SHA} ${DOCKER_IMAGE_ORIGIN}:latest docker push ${DOCKER_IMAGE_ORIGIN}:${GITHUB_SHA} docker push ${DOCKER_IMAGE_ORIGIN}:latest</code> </pre> <br><p>  Je suis s√ªr que dans un avenir proche, une action appara√Ætra qui marquera et poussera automatiquement les images au lieu d'√©crire manuellement les commandes Docker. </p><br><p><img src="https://habrastorage.org/webt/bg/gw/oa/bggwoan0cceznbnkt5e_xqga1yo.png"><br>  <em>Ajout d'un secret contenant un jeton Github</em> </p><br><p>  L'√©tape suivante apr√®s la cr√©ation des fichiers PDF consiste √† cr√©er une version sur GitHub et √† inclure les artefacts collect√©s dans cette version.  Pour cr√©er automatiquement une version, nous utilisons une action <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tierce</a> , dans laquelle dans le bloc <code>if:</code> vous pouvez sp√©cifier la condition de lancement de l'√©tape - uniquement lors de la cr√©ation de la balise: </p><br><pre> <code class="plaintext hljs"> - name: Create GitHub release with artifacts uses: softprops/action-gh-release@v1 if: startsWith(github.ref, 'refs/tags/') with: files: | master-thesis.pdf presentation/presentation.pdf name: "Build ${GITHUB_SHA}" env: GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}</code> </pre> <br><h2 id="itogi">  R√©sum√© </h2><br><p>  Malgr√© le statut b√™ta, les deux services fonctionnent bien, je suis s√ªr que beaucoup de choses seront termin√©es. <br>  √Ä certains moments, cela peut √™tre g√™nant, il n'y a pas de variables globales, mais cela peut √™tre fait avec des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">b√©quilles</a> . </p><br><p>  J'ai aim√© l'approche GitHub pour abandonner HCL au profit de YAML.  J'ai √©galement aim√© la prise en charge de nombreux types d'h√¥tes, qui sont des limites tr√®s modestes (pour l'instant), voyons comment cela se passe.  En g√©n√©ral, pour de simples pipelines dans des r√©f√©rentiels publics sur GitHub, un tel groupe fonctionnera tr√®s bien. </p><br><p>  <em>La traduction de cet article est d√©j√† sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">support</a> .</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468345/">https://habr.com/ru/post/fr468345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468333/index.html">Comment d√©boguer et profiler n'importe quel fichier EXE √† l'aide de Visual Studio</a></li>
<li><a href="../fr468337/index.html">Utilisation de cron pour Android et ajout d'un script shell pour l'ex√©cution automatique au d√©marrage de l'appareil</a></li>
<li><a href="../fr468339/index.html">Pr√©sentation du th√®me sombre pour Visual Studio App Center</a></li>
<li><a href="../fr468341/index.html">Azure Cloud Shell sur Windows Terminal</a></li>
<li><a href="../fr468343/index.html">Jeff Bezos: ¬´Aller dans l'espace pour le bien de la Terre¬ª</a></li>
<li><a href="../fr468347/index.html">MetricKit. Analyse des performances des applications iOS</a></li>
<li><a href="../fr468351/index.html">Microstructure du march√© et s√©lection adverse</a></li>
<li><a href="../fr468363/index.html">Mon magnum opus du monde du jeu mobile</a></li>
<li><a href="../fr468367/index.html">Amazon annonce un plan de r√©chauffement climatique</a></li>
<li><a href="../fr468369/index.html">Comment j'ai cr√©√© ¬´WildMAN¬ª - une parodie de nombreux jeux 8 bits et que j'ai r√©cemment port√© sur Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>