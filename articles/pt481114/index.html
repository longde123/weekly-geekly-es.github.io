<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛐 👨🏾‍🚀 🌃 Seccomp em Kubernetes: 7 coisas que você precisa saber desde o início 😊 👨🏼‍💼 🙇🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : Apresentando a tradução de um artigo por um engenheiro de segurança de aplicativos sênior da empresa britânica ASOS.com. Com ela, ele in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seccomp em Kubernetes: 7 coisas que você precisa saber desde o início</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/481114/"> <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Apresentando a tradução de um artigo por um engenheiro de segurança de aplicativos sênior da empresa britânica ASOS.com.</i>  <i>Com ela, ele inicia uma série de publicações sobre como melhorar a segurança no Kubernetes através do uso do seccomp.</i>  <i>Se os leitores gostarem da introdução, seguiremos o autor e continuaremos com seus futuros materiais sobre este tópico.</i> <br><br><img src="https://habrastorage.org/webt/-u/nv/vk/-unvvkiylrs9ucbym-l4bsobtr8.png"><br><br>  Este artigo é a primeira de uma série de publicações sobre como criar perfis seccomp no espírito do SecDevOps sem recorrer à magia e à bruxaria.  Na primeira parte, falarei sobre os conceitos básicos e internos da implementação do seccomp no Kubernetes. <br><br>  O ecossistema Kubernetes oferece uma ampla variedade de maneiras para garantir a segurança e o isolamento dos contêineres.  Este artigo é sobre o Secure Computing Mode, também conhecido como <b>seccomp</b> .  Sua essência está nas chamadas do sistema de filtragem disponíveis para execução dos contêineres. <a name="habracut"></a><br><br>  Por que isso é importante?  Um contêiner é apenas um processo em execução em uma máquina específica.  E ele usa o kernel em pé de igualdade com outros aplicativos.  Se os contêineres pudessem fazer chamadas do sistema, muito em breve o malware seria aproveitado para contornar o isolamento do contêiner e afetar outros aplicativos: interceptar informações, alterar configurações do sistema etc. <br><br>  Os perfis seccomp determinam quais chamadas do sistema devem ser permitidas ou negadas.  O tempo de execução do contêiner os ativa durante seu lançamento, para que o kernel possa controlar sua execução.  O uso desses perfis permite limitar o vetor de ataque e reduzir os danos se algum programa dentro do contêiner (ou seja, suas dependências ou suas dependências) começar a fazer o que não é permitido. <br><br><h2>  Compreendendo o básico </h2><br>  O perfil base seccomp inclui três elementos: <code>defaultAction</code> , <code>architectures</code> (ou <code>archMap</code> ) e <code>syscalls</code> : <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"defaultAction"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ERRNO"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"architectures"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86_64"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X32"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"syscalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"arch_prctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"sched_yield"</span></span>, <span class="hljs-string"><span class="hljs-string">"futex"</span></span>, <span class="hljs-string"><span class="hljs-string">"write"</span></span>, <span class="hljs-string"><span class="hljs-string">"mmap"</span></span>, <span class="hljs-string"><span class="hljs-string">"exit_group"</span></span>, <span class="hljs-string"><span class="hljs-string">"madvise"</span></span>, <span class="hljs-string"><span class="hljs-string">"rt_sigprocmask"</span></span>, <span class="hljs-string"><span class="hljs-string">"getpid"</span></span>, <span class="hljs-string"><span class="hljs-string">"gettid"</span></span>, <span class="hljs-string"><span class="hljs-string">"tgkill"</span></span>, <span class="hljs-string"><span class="hljs-string">"rt_sigaction"</span></span>, <span class="hljs-string"><span class="hljs-string">"read"</span></span>, <span class="hljs-string"><span class="hljs-string">"getpgrp"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ALLOW"</span></span> } ] }</code> </pre> <br>  <i>( <a href="https://gist.github.com/pjbgf/ef974f57693bb193f39e8add8a7040d7">medium-basic-seccomp.json</a> )</i> <br><br>  <code>defaultAction</code> determina o destino padrão de qualquer chamada do sistema não especificada na seção <code>syscalls</code> .  Para simplificar a tarefa, focamos em dois valores principais que serão usados: <br><br><ul><li>  <code>SCMP_ACT_ERRNO</code> - bloqueia a execução de uma chamada do sistema, </li><li>  <code>SCMP_ACT_ALLOW</code> - permite. </li></ul><br>  A seção <code>architectures</code> lista as arquiteturas de destino.  Isso é importante, pois o próprio filtro, aplicado no nível do kernel, depende dos identificadores de chamadas do sistema, e não dos nomes registrados no perfil.  Antes de usar, o tempo de execução do contêiner mapeia-os para identificadores.  O ponto é que as chamadas do sistema podem ter IDs completamente diferentes, dependendo da arquitetura do sistema.  Por exemplo, a chamada do sistema <code>recvfrom</code> (usada para obter informações de um soquete) possui ID = 64 em sistemas x64 e ID = 517 em x86.  <a href="">Aqui</a> você pode encontrar uma lista de todas as chamadas do sistema para arquiteturas x86-x64. <br><br>  A seção <code>syscalls</code> lista todas as chamadas do sistema e indica o que fazer com elas.  Por exemplo, você pode criar uma lista de permissões definindo <code>defaultAction</code> como <code>SCMP_ACT_ERRNO</code> e atribuir chamadas à seção <code>SCMP_ACT_ALLOW</code> a <code>SCMP_ACT_ALLOW</code> .  Assim, você só permite chamadas registradas na seção <code>syscalls</code> e proíbe todas as outras.  Para a lista negra, você deve alterar os valores e ações <code>defaultAction</code> para o oposto. <br><br>  Agora, algumas palavras devem ser ditas sobre as nuances que não são tão óbvias.  Observe que as recomendações abaixo vêm do fato de você estar implantando uma linha de aplicativos de negócios no Kubernetes e é importante que eles trabalhem com o mínimo de privilégios. <br><br><h2>  1. AllowPrivilegeEscalation = false </h2><br>  Há um parâmetro <code>AllowPrivilegeEscalation</code> no <code>securityContext</code> contêiner.  Se estiver definido como <code>false</code> , os contêineres começarão com o bit <a href="https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt"><code>no_new_priv</code></a> definido como ( <code>on</code> ).  O significado desse parâmetro é óbvio no nome: ele não permite que o contêiner inicie novos processos com privilégios maiores do que aqueles que possui. <br><br>  Um efeito colateral desse parâmetro definido como <code>true</code> (o valor padrão) é que o tempo de execução do contêiner aplica o perfil seccomp no início do processo de inicialização.  Portanto, todas as chamadas do sistema necessárias para iniciar os processos internos do tempo de execução (por exemplo, configurando identificadores de usuário / grupo, eliminando alguns recursos) devem ser permitidas no perfil. <br><br>  O contêiner que executa o <code>echo hi</code> banal <code>echo hi</code> precisará das seguintes permissões: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"defaultAction"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ERRNO"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"architectures"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86_64"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X32"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"syscalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"arch_prctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"brk"</span></span>, <span class="hljs-string"><span class="hljs-string">"capget"</span></span>, <span class="hljs-string"><span class="hljs-string">"capset"</span></span>, <span class="hljs-string"><span class="hljs-string">"chdir"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>, <span class="hljs-string"><span class="hljs-string">"execve"</span></span>, <span class="hljs-string"><span class="hljs-string">"exit_group"</span></span>, <span class="hljs-string"><span class="hljs-string">"fstat"</span></span>, <span class="hljs-string"><span class="hljs-string">"fstatfs"</span></span>, <span class="hljs-string"><span class="hljs-string">"futex"</span></span>, <span class="hljs-string"><span class="hljs-string">"getdents64"</span></span>, <span class="hljs-string"><span class="hljs-string">"getppid"</span></span>, <span class="hljs-string"><span class="hljs-string">"lstat"</span></span>, <span class="hljs-string"><span class="hljs-string">"mprotect"</span></span>, <span class="hljs-string"><span class="hljs-string">"nanosleep"</span></span>, <span class="hljs-string"><span class="hljs-string">"newfstatat"</span></span>, <span class="hljs-string"><span class="hljs-string">"openat"</span></span>, <span class="hljs-string"><span class="hljs-string">"prctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"read"</span></span>, <span class="hljs-string"><span class="hljs-string">"rt_sigaction"</span></span>, <span class="hljs-string"><span class="hljs-string">"statfs"</span></span>, <span class="hljs-string"><span class="hljs-string">"setgid"</span></span>, <span class="hljs-string"><span class="hljs-string">"setgroups"</span></span>, <span class="hljs-string"><span class="hljs-string">"setuid"</span></span>, <span class="hljs-string"><span class="hljs-string">"stat"</span></span>, <span class="hljs-string"><span class="hljs-string">"uname"</span></span>, <span class="hljs-string"><span class="hljs-string">"write"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ALLOW"</span></span> } ] }</code> </pre> <br>  <i>( <a href="https://gist.github.com/pjbgf/018658f1aeea1ef696b451bde8c33a8f">hi-pod-seccomp.json</a> )</i> <br><br>  ... em vez destes: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"defaultAction"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ERRNO"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"architectures"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86_64"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X86"</span></span>, <span class="hljs-string"><span class="hljs-string">"SCMP_ARCH_X32"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"syscalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"arch_prctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"brk"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>, <span class="hljs-string"><span class="hljs-string">"execve"</span></span>, <span class="hljs-string"><span class="hljs-string">"exit_group"</span></span>, <span class="hljs-string"><span class="hljs-string">"futex"</span></span>, <span class="hljs-string"><span class="hljs-string">"mprotect"</span></span>, <span class="hljs-string"><span class="hljs-string">"nanosleep"</span></span>, <span class="hljs-string"><span class="hljs-string">"stat"</span></span>, <span class="hljs-string"><span class="hljs-string">"write"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"SCMP_ACT_ALLOW"</span></span> } ] }</code> </pre> <br>  <i>( <a href="https://gist.github.com/pjbgf/7c860ad818e3724d65a96ffdae5da808">hi-container-seccomp.json</a> )</i> <br><br>  Mas, novamente, por que isso é um problema?  Pessoalmente, eu evitaria colocar na lista branca as seguintes chamadas do sistema (se elas não forem realmente necessárias): <code>capset</code> , <code>set_tid_address</code> , <code>setgid</code> , <code>setgroups</code> e <code>setuid</code> .  No entanto, a dificuldade real é que, ao permitir processos sobre os quais você não tem absolutamente nenhum controle, você vincula perfis à implementação do tempo de execução do contêiner.  Em outras palavras, um dia você pode encontrar o fato de que, após atualizar o ambiente de tempo de execução do contêiner (por você ou, mais provavelmente, pelo provedor de serviços em nuvem), os contêineres pararão repentinamente. <br><br>  <b>Dica 1</b> : execute contêineres com <code>AllowPrivilegeEscaltion=false</code> .  Isso reduzirá o tamanho dos perfis seccomp e os tornará menos sensíveis às alterações no tempo de execução do contêiner. <br><br><h2>  2. Configurando perfis seccomp no nível do contêiner </h2><br>  O perfil seccomp pode ser definido no nível do pod: <br><br><pre> <code class="plaintext hljs">annotations: seccomp.security.alpha.kubernetes.io/pod: "localhost/profile.json"</code> </pre> <br>  ... ou no nível do contêiner: <br><br><pre> <code class="plaintext hljs">annotations: container.security.alpha.kubernetes.io/&lt;container-name&gt;: "localhost/profile.json"</code> </pre> <br>  <i>Observe que a sintaxe acima será alterada quando o Kubernetes seccomp <a href="https://github.com/kubernetes/enhancements/pull/1148">se tornar GA</a> (este evento é esperado na próxima versão do Kubernetes - 1.18 - aprox. Transl.).</i> <br><br>  Poucas pessoas sabem que o Kubernetes sempre teve um <a href="https://github.com/kubernetes/kubernetes/issues/84623">bug</a> que fazia com que os perfis seccomp fossem aplicados ao <a href="https://www.ianlewis.org/en/almighty-pause-container">contêiner de pausa</a> .  O tempo de execução compensa parcialmente essa desvantagem, mas esse contêiner não desaparece dos pods, pois é usado para configurar sua infraestrutura. <br><br>  O problema é que esse contêiner sempre começa com <code>AllowPrivilegeEscalation=true</code> , levando aos problemas <code>AllowPrivilegeEscalation=true</code> no parágrafo 1, e isso não pode ser alterado. <br><br>  Ao aplicar perfis seccomp no nível do contêiner, você evita essa interceptação e pode criar um perfil que será "aguçado" para um contêiner específico.  Isso terá que ser feito até que os desenvolvedores consertem o bug e a nova versão (talvez 1,18?) Fique disponível para todos. <br><br>  <b>Dica 2</b> : defina perfis seccomp no nível do contêiner. <br><br>  Em um sentido prático, essa regra geralmente serve como uma resposta universal à pergunta: "Por que meu perfil seccomp funciona com o <code>docker run</code> , mas não funciona após a implantação em um cluster Kubernetes?" <br><br><h2>  3. Use o tempo de execução / padrão como último recurso </h2><br>  O Kubernetes possui duas opções para perfis internos: <code>runtime/default</code> e <code>docker/default</code> .  Ambos são implementados pelo tempo de execução do contêiner, não pelo Kubernetes.  Portanto, eles podem diferir dependendo do tempo de execução usado e de sua versão. <br><br>  Em outras palavras, como resultado da alteração do tempo de execução, o contêiner pode acessar outro conjunto de chamadas do sistema que podem ser usadas ou não.  A maioria dos tempos de execução usa <a href="">uma implementação do Docker</a> .  Se você deseja usar esse perfil, verifique se ele combina com você. <br><br>  O <code>docker/default</code> perfil <code>docker/default</code> está obsoleto desde o Kubernetes 1.11, portanto, evite usá-lo. <br><br>  Na minha opinião, o perfil de <code>runtime/default</code> é perfeito para a finalidade para a qual foi criado: proteger os usuários dos riscos associados à execução do <code>docker run</code> em suas máquinas.  No entanto, se falarmos sobre aplicativos de negócios executados em clusters do Kubernetes, ousaria afirmar que esse perfil é muito aberto e que os desenvolvedores devem se concentrar na criação de perfis para seus aplicativos (ou tipos de aplicativos). <br><br>  <b>Dica # 3</b> : Crie perfis seccomp para aplicativos específicos.  Se isso não for possível, lide com perfis para tipos de aplicativos, por exemplo, crie um perfil avançado que inclua todas as APIs de aplicativos da web Golang.  Somente como último recurso, use o tempo de execução / padrão. <br><br>  Nas próximas publicações, mostrarei como criar perfis secccomp no espírito do SecDevOps, automatizar e testá-los em pipelines.  Em outras palavras, você não terá desculpas para não mudar para perfis para aplicativos específicos. <br><br><h2>  4. Não confinado NÃO é uma opção </h2><br>  Desde a <a href="https://www.cncf.io/blog/2019/08/06/open-sourcing-the-kubernetes-security-audit/">primeira auditoria de segurança do Kubernetes,</a> o <a href="https://github.com/kubernetes/kubernetes/issues/81115">seccomp foi desativado</a> por padrão.  Isso significa que, se você não especificar um <code>PodSecurityPolicy</code> que o habilitará no cluster, todos os pods para os quais o perfil seccomp não está definido funcionarão no modo <code>seccomp=unconfined</code> . <br><br>  Trabalhar nesse modo significa que uma camada inteira de isolamento é perdida, o que fornece proteção de cluster.  Essa abordagem não é recomendada pelos profissionais de segurança. <br><br>  <b>Dica # 4</b> : Nenhum contêiner em um cluster deve funcionar no modo <code>seccomp=unconfined</code> , especialmente em ambientes de produção. <br><br><h2>  5. "Modo de auditoria" </h2><br>  Este ponto não é exclusivo do Kubernetes, mas ainda se enquadra na categoria de "o que você deve saber antes de começar". <br><br>  Aconteceu que a criação de perfis seccomp sempre foi um negócio complicado e foi amplamente baseado em tentativa e erro.  O fato é que os usuários simplesmente não têm a oportunidade de testá-los em ambientes de produção sem arriscar "abandonar" o aplicativo. <br><br>  Após o advento do kernel Linux 4.14, tornou-se possível executar partes do perfil no modo de auditoria, registrando informações sobre todas as chamadas do sistema no syslog, mas não as bloqueando.  Você pode ativar este modo usando o parâmetro <code>SCMT_ACT_LOG</code> : <br><br>  <i><b>SCMP_ACT_LOG</b> : o seccomp não afetará a operação de um encadeamento que faz uma chamada do sistema se não se enquadrar em nenhuma regra do filtro, mas as informações sobre a chamada do sistema serão registradas.</i> <br><br>  Aqui está um exemplo de estratégia para usar esse recurso: <br><br><ol><li>  Permitir chamadas do sistema que são necessárias. </li><li>  Sistemas de chamada em bloco que se sabe não serem úteis. </li><li>  Registre informações sobre todas as outras chamadas no log. </li></ol><br>  Um exemplo simplificado é o seguinte: <br><br><pre> <code class="plaintext hljs">{ "defaultAction": "SCMP_ACT_LOG", "architectures": [ "SCMP_ARCH_X86_64", "SCMP_ARCH_X86", "SCMP_ARCH_X32" ], "syscalls": [ { "names": [ "arch_prctl", "sched_yield", "futex", "write", "mmap", "exit_group", "madvise", "rt_sigprocmask", "getpid", "gettid", "tgkill", "rt_sigaction", "read", "getpgrp" ], "action": "SCMP_ACT_ALLOW" }, { "names": [ "add_key", "keyctl", "ptrace" ], "action": "SCMP_ACT_ERRNO" } ] }</code> </pre> <br>  <i>( <a href="https://gist.github.com/pjbgf/fa4f7a89937c486d940ac8ccf48379c9">medium-mixed-seccomp.json</a> )</i> <br><br>  Mas lembre-se de que você precisa bloquear todas as chamadas que são conhecidas por não serem utilizadas e que podem prejudicar o cluster.  Uma boa base para a listagem é a <a href="https://docs.docker.com/engine/security/seccomp/">documentação</a> oficial do <a href="https://docs.docker.com/engine/security/seccomp/">Docker</a> .  Ele explica em detalhes quais chamadas do sistema estão bloqueadas no perfil padrão e por quê. <br><br>  No entanto, há uma captura.  Embora o <code>SCMT_ACT_LOG</code> suportado pelo kernel Linux desde o final de 2017, ele entrou recentemente apenas no ecossistema Kubernetes.  Portanto, para usar esse método, você precisará do kernel Linux 4.14 e da versão runC não inferior à <a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0-rc9">v1.0.0-rc9</a> . <br><br>  <b>Dica 5</b> : você pode criar um perfil de modo de auditoria para teste em produção combinando listas em preto e branco e registrar todas as exceções. <br><br><h2>  6. Use listas brancas </h2><br>  Criar listas brancas requer esforços adicionais, pois você precisa identificar todas as chamadas que o aplicativo possa precisar, mas essa abordagem melhora significativamente a segurança: <br><br><blockquote>  <i>É altamente recomendável que você use a abordagem da lista de permissões, pois é mais simples e mais confiável.</i>  <i>A lista negra precisará ser atualizada sempre que uma chamada do sistema potencialmente perigosa (ou sinalizador / opção perigosa, se estiverem na lista negra) for adicionada.</i>  <i>Além disso, você pode alterar frequentemente a apresentação de um parâmetro sem alterar sua essência e, assim, contornar as limitações da lista negra.</i> </blockquote><br>  Para aplicativos Go, desenvolvi uma ferramenta especial que acompanha o aplicativo e coleta todas as chamadas feitas em tempo de execução.  Por exemplo, para o seguinte aplicativo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fmt.Println(<span class="hljs-string"><span class="hljs-string">"test"</span></span>) }</code> </pre> <br>  ... execute <code>gosystract</code> assim: <br><br><pre> <code class="bash hljs">go install https://github.com/pjbgf/gosystract gosystract --template=<span class="hljs-string"><span class="hljs-string">'{{- range . }}{{printf "\"%s\",\n" .Name}}{{- end}}'</span></span> application-path</code> </pre> <br>  ... e obtenha o seguinte resultado: <br><br><pre> <code class="plaintext hljs">"sched_yield", "futex", "write", "mmap", "exit_group", "madvise", "rt_sigprocmask", "getpid", "gettid", "tgkill", "rt_sigaction", "read", "getpgrp", "arch_prctl",</code> </pre> <br>  Até agora, este é apenas um exemplo - detalhes sobre as ferramentas serão mais detalhados. <br><br>  <b>Dica # 6</b> : permita apenas chamadas que você realmente precisa e bloqueie todos os outros. <br><br><h2>  7. Estabeleça as bases (ou prepare-se para comportamentos inesperados) </h2><br>  O kernel monitorará a conformidade com o perfil, não importa o que você registrou nele.  Mesmo que isso não seja exatamente o que eu queria.  Por exemplo, se você bloquear o acesso a chamadas como <code>exit</code> ou <code>exit_group</code> , o contêiner não poderá concluir o trabalho corretamente e mesmo um comando simples como <code>echo hi</code> <a href="https://github.com/kubernetes/kubernetes/issues/85191">suspenderá</a> por um período indeterminado.  Como resultado, você obterá alta utilização da CPU no cluster: <br><br><img src="https://habrastorage.org/webt/32/no/rt/32nortxic_d8czgqc5jnbzrb-ps.png"><br><br>  Nesses casos, o utilitário <code>strace</code> pode ser útil - mostrará qual é o problema: <br><br><img src="https://habrastorage.org/webt/hg/l3/eh/hgl3ehuqz8a6eprrsycubq_n6hu.png"><br> <i><code>sudo strace -c -p 9331</code></i> <br> <br>  Verifique se os perfis contêm todas as chamadas do sistema que o aplicativo precisa enquanto está em execução. <br><br>  <b>Dica 7</b> : Preste atenção às pequenas coisas e verifique se todas as chamadas necessárias do sistema estão incluídas na lista branca. <br><br>  Com isso, a primeira parte de uma série de artigos sobre o uso do seccomp no Kubernetes no espírito do SecDevOps chega ao fim.  Nas partes a seguir, falaremos sobre por que isso é importante e como automatizar o processo. <br><br><h2>  PS do tradutor </h2><br>  Leia também em nosso blog: <br><br><ul><li>  " <a href="https://habr.com/ru/company/flant/blog/474012/">Segurança para contêineres do Docker</a> "; </li><li>  “ <a href="https://habr.com/ru/company/flant/blog/465141/">33+ Ferramentas de segurança Kubernetes</a> ”; </li><li>  “ <a href="https://habr.com/ru/company/flant/blog/440504/">Docker e Kubernetes em ambientes exigentes de segurança</a> ”; </li><li>  " <a href="https://habr.com/ru/company/flant/blog/436300/">9 Práticas recomendadas de segurança do Kubernetes</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481114/">https://habr.com/ru/post/pt481114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481102/index.html">Lançamento do kit de ferramentas de interface do usuário .NET entre plataformas AvaloniaUI 0.9</a></li>
<li><a href="../pt481104/index.html">Misturando OpenJDK e NodeJS: interações entre idiomas e arquitetura vertical</a></li>
<li><a href="../pt481106/index.html">Como LANIT filmou uma comédia DIY em seu escritório</a></li>
<li><a href="../pt481110/index.html">Playme VEGA review: gravador combinado com tela sensível ao toque e montagem em espelho</a></li>
<li><a href="../pt481112/index.html">O que o "chiclete" de 5700 anos vai dizer sobre a pessoa que o mastigou?</a></li>
<li><a href="../pt481116/index.html">Publique automaticamente postagens da comunidade VKontakte no Discord</a></li>
<li><a href="../pt481118/index.html">Anônimo Papai Noel 2019-2020: pós com presentes de Ano Novo</a></li>
<li><a href="../pt481120/index.html">Onde e como os servidores de borda são aplicados?</a></li>
<li><a href="../pt481122/index.html">Antipatterns PostgreSQL: passando conjuntos e seleções para SQL</a></li>
<li><a href="../pt481124/index.html">Dicas para escrever código de auto-documentação</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>