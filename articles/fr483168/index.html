<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≥ ü§∑üèº üëãüèª Comment faire un bot qui transforme une photo en bande dessin√©e. Deuxi√®me partie Formation mod√®le üò¢ üèº üå´Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚á® La premi√®re partie 
 ‚á® Troisi√®me partie 

 Bonjour encore! 

 Comme vous pouvez le voir, les vacances ont quelque peu paralys√© la chronologie des ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment faire un bot qui transforme une photo en bande dessin√©e. Deuxi√®me partie Formation mod√®le</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483168/">  <a href="https://habr.com/ru/post/479218/">‚á® La premi√®re partie</a> <br>  <a href="https://habr.com/ru/post/485824/">‚á® Troisi√®me partie</a> <br><br>  Bonjour encore! <br><br>  Comme vous pouvez le voir, les vacances ont quelque peu paralys√© la chronologie des articles. <br>  Je pense que beaucoup pendant cette p√©riode ont r√©ussi, sinon √† former pleinement leur mod√®le, au moins √† exp√©rimenter avec diff√©rents ensembles de donn√©es. <br><blockquote>  1. Mettez la distribution <br>  2. T√©l√©chargement d'images <br>  3. ??? <br>  4. Profit! <br></blockquote>  Si vous n'√©tiez pas √† la hauteur de ces r√©seaux de neurones, ou si vous commencez √† lire cet article, alors, comme on dit, il n'y a pas de temps pour expliquer, nous prenons le kit de distribution, t√©l√©chargeons les photos n√©cessaires, et c'est parti! <br><a name="habracut"></a><br>  Des instructions d√©taill√©es figurent <a href="https://habr.com/ru/post/479218/">dans l'article pr√©c√©dent de la s√©rie</a> . <br><br><h2>  La premi√®re cr√™pe est grumeleuse </h2><br>  Lorsque j'ai form√© le mod√®le pour <a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a> pour la premi√®re fois, sans plus tarder, je viens de mettre environ 1000 pages de bandes dessin√©es dans un ensemble de donn√©es. <br>  Oui, ainsi que des couvertures, des annonces et d'autres charges. <br><br>  √Ä l'entr√©e, cela ressemblait √† ceci: <br><br><img src="https://habrastorage.org/webt/vs/7t/p8/vs7tp8lqmuevcrv_3cpuzbyaef4.png"><br><br>  Le r√©sultat est correspondant: <br><br><img src="https://habrastorage.org/webt/2s/sf/5s/2ssf5st8mk1oge_9rrfbyepmlhk.png"><br><br><img src="https://habrastorage.org/webt/7x/dl/kp/7xdlkpn70yzd8qfljqusgn6jy5y.png"><br><br><img src="https://habrastorage.org/webt/ll/ll/v8/llllv8gmtfys_udt5euohplcjzw.png"><br><br><div class="spoiler">  <b class="spoiler_title">Plus d'images</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tl/ey/8e/tley8enuh1qlcjt3nc7e9-wnzse.png"><br><br><img src="https://habrastorage.org/webt/2u/cz/5n/2ucz5nwpenvhonfh84m080tj_t0.png"><br><br><img src="https://habrastorage.org/webt/o7/qb/xt/o7qbxtxqcrgdcih_4m-ysiksd_e.png"><br><br><img src="https://habrastorage.org/webt/xc/-8/yl/xc-8ylyfuk71me4v59xxvn3qhj4.png"><br><br><img src="https://habrastorage.org/webt/ys/zx/vm/yszxvm-2hc8xt6rjsvvxcpuyy3w.png"><br><br><img src="https://habrastorage.org/webt/jl/p9/3t/jlp93trm26hwitdzgmdt_kylhfw.png"><br><br><img src="https://habrastorage.org/webt/3l/fb/y6/3lfby6xuenl47xlggsv9n2p9hss.png"><br><br><img src="https://habrastorage.org/webt/bq/mt/sd/bqmtsdr7xedmcxsogpa4j8olk8c.png"><br><br></div></div><br>  Le mod√®le transmet parfaitement les diff√©rences g√©n√©rales entre les bandes dessin√©es et les photos: <br><br><ul><li>  √âtalonnage de couleur typique </li><li>  S√©lection des contours </li><li>  Blocage </li><li>  Nuage de texte </li></ul><br>  En principe, cette option peut √™tre tout √† fait suffisante pour la production. <br><br>  Mais je me demandais quels r√©sultats peuvent √™tre obtenus sur un ensemble de donn√©es plus ¬´propre¬ª. <br><br><h2>  Prenez deux </h2><br>  Pour l'exp√©rience suivante, j'ai laiss√© les pages avec un bloc, et du reste j'ai d√©coup√© les plus grandes pi√®ces, constitu√©es d'un bloc, afin de se d√©barrasser des lignes de s√©paration verticales et horizontales dans le mod√®le final. <br><blockquote>  Si vous apportez des modifications √† votre jeu de donn√©es, par exemple, supprimez ou ajoutez des photos, n'oubliez pas d'enregistrer la version pr√©c√©dente.  Vous aurez un endroit o√π retourner en cas de probl√®me. </blockquote>  Le deuxi√®me ensemble de donn√©es ressemblait √† ceci: <br><br><img src="https://habrastorage.org/webt/ww/j9/8f/wwj98fxmy0d15c0xgxfz8w9bfs4.png"><br><br>  Le r√©sultat, comme on dit, est √©vident: <br><br><img src="https://habrastorage.org/webt/zn/b3/sc/znb3sczf0ypubx8jya-uryrqbxm.png"><br><br><img src="https://habrastorage.org/webt/xp/n9/zv/xpn9zvimruobxodr4wa2vhrutxk.png"><br><br><img src="https://habrastorage.org/webt/xh/nf/sp/xhnfspsgqrkxvuvhdkj7vaqz5yy.png"><br><br><div class="spoiler">  <b class="spoiler_title">Plus d'images</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ag/6b/pw/ag6bpwlw1xefb9o8igrdixarhqc.png"><br><br><img src="https://habrastorage.org/webt/h7/xb/di/h7xbdiuyzdmukmjalf3o6rdou8e.png"><br><br><img src="https://habrastorage.org/webt/by/j8/zk/byj8zkaujwhx52po8xqw37un2oo.png"><br><br><img src="https://habrastorage.org/webt/pl/po/0y/plpo0yucjtvt0sbfc-pefnxz940.png"><br><br><img src="https://habrastorage.org/webt/65/4f/el/654fellkdx6_ebimev8ardha_e0.png"><br><br><img src="https://habrastorage.org/webt/zj/9u/vq/zj9uvqeres9m1kr2nmzcpgt-8uc.png"><br></div></div><br>  Les lignes de division ont disparu, mais avec elles l'expressivit√© laiss√©e dans les nuages ‚Äã‚Äãavec le texte: elles ont commenc√© √† se rencontrer beaucoup moins souvent dans l'ensemble de donn√©es et ont cess√© d'√™tre la caract√©ristique principale. <br><br>  L'espace vide qui √©tait auparavant rempli de texte est maintenant rempli de bruit psych√©d√©lique. <br><br><h2>  La troisi√®me fois est un charme </h2><br>  J'ai d√©cid√© de me d√©barrasser compl√®tement du texte, ne laissant que les parties de la bande dessin√©e o√π il ne se trouve pas.  Personne n'a surv√©cu: pas de nuage, pas de titres ou de noms de s√©ries. <br><br>  Jeu de donn√©es apr√®s le ¬´g√©nocide linguistique¬ª: <br><br><img src="https://habrastorage.org/webt/zu/pw/az/zupwaz8q1toeo9qvqncmfamino8.png"><br><br>  Le r√©sultat final: <br><br><img src="https://habrastorage.org/webt/9s/o2/qg/9so2qgo6e6jpkdazfsqf2wlu1-w.png"><br><br><img src="https://habrastorage.org/webt/gs/nr/7p/gsnr7pfyfu4bcowe0bpyqlqn1vc.png"><br><br><img src="https://habrastorage.org/webt/me/vs/m6/mevsm6y3hlgvrvsa8qce0xhenqa.png"><br><br><div class="spoiler">  <b class="spoiler_title">Plus d'images</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/hn/ua/uvhnuapobrpzdu8fxhyjqnz-ozg.png"><br><br><img src="https://habrastorage.org/webt/w1/gu/2e/w1gu2enojimz-lrpkzrzlkvihv8.png"><br><br><img src="https://habrastorage.org/webt/_e/j0/91/_ej091msilwm4hhlmbl3j7nw6sq.png"><br><br><img src="https://habrastorage.org/webt/ql/o6/th/qlo6thuiesfbqx_f2yx6yanf4ne.png"><br><br><img src="https://habrastorage.org/webt/cm/xg/4t/cmxg4tu9jp4-6dcjvjp2nwei3gq.png"><br></div></div><br>  D'une part, il y a moins d'artefacts, d'autre part, l'expressivit√© a disparu.  √âtant donn√© que dans la formation GAN, la qualit√© du r√©sultat est largement d√©termin√©e par vous et moi, il n'y a pas de recette unique pour un bon mod√®le. <br><br>  La beaut√© est dans l'≈ìil du spectateur, alors n'ayez pas peur d'exp√©rimenter et de choisir ce que vous aimez le plus. <br><br><h2>  √Ä l'arme! </h2><br>  Eh bien, nous avons d√©j√† parl√© des principaux pi√®ges et des m√©thodes pour y faire face, il est temps de passer aux choses s√©rieuses. <br><br>  Acc√©dez au dossier dans lequel nous avons t√©l√©charg√© la distribution.  Permettez-moi de vous rappeler qu'il s'appelait <b>pytorch-CycleGAN-and-pix2pix</b> <br><br>  Puisque nous avons des instructions pour les nuls, nous ne toucherons pas au code de distribution, car tous les param√®tres n√©cessaires peuvent √™tre d√©finis √† partir de la ligne de commande. <br><br>  Dans cette distribution, l'entra√Ænement par d√©faut se d√©roule sur deux cents √©poques, avec une att√©nuation lin√©aire du rythme d'apprentissage apr√®s la centi√®me √©poque. <br><blockquote>  La r√©solution maximale que ma carte de huit gigaoctets √©tait capable de ma√Ætriser √©tait de 400x400.  La formation compl√®te m'a pris environ 33 heures, nous allons donc utiliser un petit hack de vie.  Tout d'abord, nous formerons le mod√®le en images 128x128, puis 256x256, et ce n'est qu'au stade final que nous lui montrerons notre magnifique 400x400. <br>  La premi√®re √©tape durera 100 √©poques, la deuxi√®me et la troisi√®me - 50 chacune, ce qui nous permettra de r√©duire le temps d'entra√Ænement de pr√®s de moiti√©. <br><br>  Comme le montre la pratique, le r√©sultat de cette approche n'est pas pire, et parfois meilleur, que lors d'un entra√Ænement imm√©diat √† une r√©solution maximale. </blockquote>  Peut-√™tre assez de th√©orie, il est temps de passer √† la pratique. <br><br>  √Ä l'invite de commande, entrez. <br><br><h3>  Premi√®re √©tape </h3><br><pre><code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 128 --load_size 180 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 4</code> </pre> <br>  <i>N'oubliez pas de remplacer les accolades par vos propres valeurs.</i> <i><br></i> <br>  Nous analyserons plus en d√©tail certains param√®tres: <br><br><pre> <code class="bash hljs">--batch_size {number}</code> </pre> <br>  Ce param√®tre est responsable du nombre d'images trait√©es par cycle, affectant positivement la vitesse et n√©gativement sur la gourmandise du mod√®le. <br><br>  √Ä chaque √©tape, s√©lectionnez le maximum --batch_size, qui ne provoque pas d'erreurs en raison du manque de m√©moire GPU. <br><br><pre> <code class="bash hljs">-- dataroot {dataset root folder}</code> </pre> <br>  - dossier avec notre jeu de donn√©es.  √Ä l'int√©rieur, il devrait y avoir les dossiers trainA, trainB, testA, testB, comme d√©crit dans l'article pr√©c√©dent. <br><br><pre> <code class="bash hljs">--name {model name}</code> </pre> <br>  - Le nom de votre projet.  Cela peut √™tre arbitraire, mais je recommande d'inclure l'architecture du mod√®le, la r√©solution maximale et le nom de l'ensemble de donn√©es dans le nom. <br>  Par exemple: "resnet9_128to400_comics8" <br>  Ainsi, vous pouvez distinguer les exp√©riences avec divers param√®tres et donn√©es. <br><br>  La premi√®re √©tape de la formation peut √™tre arr√™t√©e √† la centi√®me √®re. <br><br>  Vous pouvez observer la progression depuis le navigateur: <a href="http://localhost/" rel="nofollow">localhost</a> : 8097 / <br>  (ou un autre lien qui sera visible dans la console) <br><br><h3>  √âtape deux </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 256 --load_size 290 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 2 --epoch 100 --epoch_count 0 --continue_train</code> </pre> <br>  Il est important d'indiquer l'√©poque √† laquelle nous avons termin√© nos √©tudes dans la premi√®re √©tape. <br>  "--Epoch 100" signifie que nous chargerons le mod√®le √† partir du point de contr√¥le de la centi√®me √®re <br>  ¬´--Epoch_count 0¬ª signifie que nous allons commencer l'entra√Ænement √† partir de z√©ro, avec la vitesse d'apprentissage maximale. <br><br>  La deuxi√®me √©tape de la formation peut √™tre arr√™t√©e √† la 50e √®re. <br><br><h3>  Troisi√®me √©tape </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 400 --load_size 430 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 1 --epoch 50 --epoch_count 0 --continue_train</code> </pre> <br><br>  La troisi√®me √©tape de l'entra√Ænement peut √™tre arr√™t√©e √† la 50e √®re, mais c'est une question de go√ªt.  Vous pouvez terminer jusqu'√† la fin et choisir le r√©sultat interm√©diaire que vous aimez.  Il est important de se rappeler que le r√©sultat sur la 200e √®re peut √™tre pire que sur la 150e. <br><br><h2>  Maintenant, sortez et voyez ce que vous avez fait </h2><br>  Pendant l'entra√Ænement, le mod√®le et les r√©sultats interm√©diaires seront enregistr√©s dans un dossier <br>  / pytorch-CycleGAN-and-pix2pix / checkpoints / {nom du mod√®le} <br><br>  Pour tester le mod√®le, entrez simplement la ligne de commande: <br><br><pre> <code class="bash hljs">python test.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --netG resnet_9blocks --crop_size 512 --load_size 580 --epoch {epoch name}</code> </pre> <br>  Vous pouvez voir le r√©sultat sur un jeu de donn√©es de test pour n'importe quel point de contr√¥le, il suffit de le sp√©cifier comme {nom de l'√©poque}.  Si {nom d'√©poque} n'est pas sp√©cifi√©, le dernier point de contr√¥le sera pris. <br><br>  Le r√©sultat sera enregistr√© dans le dossier: <br> <code>/pytorch-CycleGAN-and-pix2pix/results/{model name}/test_{epoch name}</code> <br> <blockquote>  Afin de ne pas confondre quel mod√®le sur quel ensemble de donn√©es donne quel r√©sultat, <br>  commencez √† tenir un petit journal.  Enregistrer les donn√©es de r√©f√©rence et les r√©sultats d'apprentissage. <br><br>  Par exemple, la ligne de commande et l'√©poque √† laquelle vous avez atteint.  Ces donn√©es sont suffisantes pour enregistrer les param√®tres d'entra√Ænement et l'ensemble de donn√©es sur lequel nous nous sommes entra√Æn√©s. <br><br>  Apr√®s tout, quelle est la diff√©rence entre une exp√©rience scientifique et une farce?  Le fait que tout soit document√© avec nous! </blockquote>  C'est tout pour aujourd'hui!  Dans le prochain article, nous apprendrons comment exporter un mod√®le fini et l'h√©berger dans le cloud. <br><br>  N'ayez pas peur d'exp√©rimenter.  Assurez-vous d'essayer plusieurs ensembles de donn√©es diff√©rents, de comparer les r√©sultats et de les partager dans les commentaires! <br><br>  A tr√®s bient√¥t! <br><br>  <a href="https://habr.com/ru/post/485824/">‚á® Partie suivante</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483168/">https://habr.com/ru/post/fr483168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483148/index.html">Nous discutons de jumeaux num√©riques et de simulation avec le fondateur d'une soci√©t√© de conseil</a></li>
<li><a href="../fr483154/index.html">J'ai d√©pens√© 40 000 $ et j'ai ruin√© une excellente id√©e pour une startup</a></li>
<li><a href="../fr483156/index.html">Mettez le chat sur ses pieds</a></li>
<li><a href="../fr483160/index.html">Espace 2020: Mars, constellations de satellites et nouvelles fus√©es</a></li>
<li><a href="../fr483166/index.html">D√©tection automatique de l'encodage de texte</a></li>
<li><a href="../fr483170/index.html">Base de donn√©es Messenger (partie 2): nous partitionnons le ¬´profit¬ª</a></li>
<li><a href="../fr483172/index.html">Comment localiser une application ou un jeu? Dix principales sources d'apprentissage en ligne gratuites</a></li>
<li><a href="../fr483174/index.html">Enregistrez et transf√©rez le son d'un appareil √† l'autre √† l'aide de la connectivit√© Multipeer</a></li>
<li><a href="../fr483176/index.html">Base de donn√©es Messenger (partie 1): nous concevons le cadre de base</a></li>
<li><a href="../fr483178/index.html">Voici une mise √† jour sur la version Flutter 1.9 coupl√©e √† la programmation Dart 2.5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>