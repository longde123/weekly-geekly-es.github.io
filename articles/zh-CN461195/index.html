<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋🏾 👰 👶🏿 红外接口，Raspberry和LIRC ♦️ 🤖 ⛸️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我现在的任务是学习如何向房屋中的空调和其他设备发送命令。 最初，这些设备仅具有IR遥控器。 为了解决这个问题，我有一个Raspberry Pi和IR收发器护罩。 在本文中，您可以找到配置，团队，技巧和一些理论。 从该软件将是LIRC（Linux红外远程控制）和Python。 


 我在Google...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>红外接口，Raspberry和LIRC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461195/"><p> 我现在的任务是学习如何向房屋中的空调和其他设备发送命令。 最初，这些设备仅具有IR遥控器。 为了解决这个问题，我有一个Raspberry Pi和IR收发器护罩。 在本文中，您可以找到配置，团队，技巧和一些理论。 从该软件将是LIRC（Linux红外远程控制）和Python。 </p><a name="habracut"></a><br><p> 我在Google的帮助下找到了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LIRC</a> 。 在研究过程中，我发现LIRC可与IR信号的发送器和接收器一起使用，可以对接收到的信号进行解码并在这方面执行一些操作。 现在，我不需要信号接收，但是将来可能会有用。 如果您自己弄乱LIRC，强烈建议您阅读《 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LIRC配置指南》</a> 。 </p><br><h3 id="konfiguraciya"> 构型 </h3><br><pre><code class="bash hljs">apt-get update apt-get install lirc</code> </pre> <br><pre> <code class="plaintext hljs"># /etc/modules (  ) lirc_dev lirc_rpi gpio_in_pin=18 gpio_out_pin=17</code> </pre> <br><pre> <code class="plaintext hljs"># /etc/lirc/hardware.conf (   ,  ) LIRCD_ARGS="--uinput --listen" LOAD_MODULES=true DRIVER="default" DEVICE="/dev/lirc0" MODULES="lirc_rpi"</code> </pre> <br><pre> <code class="plaintext hljs"># /boot/config.txt (       lirc,  ) dtoverlay=lirc-rpi,gpio_in_pin=18,gpio_out_pin=17</code> </pre><br><pre> <code class="plaintext hljs"># /etc/lirc/lirc_options.conf (    ) driver = default device = /dev/lirc0</code> </pre> <br><pre> <code class="bash hljs">reboot sudo /etc/init.d/lircd status</code> </pre> <br><h3 id="zapis"> 记录 </h3><br><p> 首先，您需要使用所有必需命令的数据序列创建一个配置文件。 我继续将此文件<code>lircd.conf</code> ，但是在每个设备本身上，它都在<code>/etc/lirc/lircd.conf.d</code>目录中创建了自己的文件<code>my_device_name.lircd.conf</code> 。 </p><br><p> 文件格式<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>描述。 如果您有遥控器，则可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">irrecord</a>实用程序将其传输的信号写入文件。 </p><br><pre> <code class="bash hljs">/etc/init.d/lircd stop irrecord -d /dev/lirc0 ~/my_device.lircd.conf mv ~/my_device.lircd.conf /etc/lirc/lircd.conf.d/</code> </pre> <br><p>  <code>irrecord</code>分析序列并尝试确定协议和时间参数。 在某些情况下， <code>irrecord</code>分析失败，因此可以保存原始格式的序列，为此有一个<code>--force</code>开关。 </p><br><p> 但是，即使使用<code>--force</code> <code>irrecord</code>尝试分析某些内容，并且可能也会失败。 然后，您可以使用<code>mode2</code>记录序列并自己创建文件。 </p><br><p>  <code>mode2</code>顺序打印存在和不存在信号的持续时间，由此构成发送的数据。 持续时间以微秒（1e-6秒）为单位。 在原始格式中，lircd.conf中指示了相同的持续时间，以“ pulse”开头（不需要前导“ space”）。 因此，应始终有奇数个数字（它的开始和结束均以信号“脉冲”的存在为准）。 </p><br><p> 为了自动化，我制作了一个脚本记录脚本，要求输入命令名称，运行<code>mode2</code> 5秒钟，记住并最终以准备用于lircd.conf的格式打印结果（请参见破坏器下方）。 </p><br><div class="spoiler">  <b class="spoiler_title">剧本</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 import io import sys import os r = """begin remote name DEVICE_NAME_CHANGE_ME flags RAW_CODES eps 30 aeps 100 gap 19037 begin raw_codes """ while True: print() print("enter the command name, or just press Enter to finish") a = sys.stdin.readline().rstrip("\n\r") if not a: break first_space = True n = 0 r += " name " + a + "\n" for line in os.popen('timeout 5s mode2 -d /dev/lirc0 2&gt; /dev/null').read().split('\n'): words = line.split() if len(words) &lt; 2: continue if words[0] != 'space' and words[0] != 'pulse': continue if first_space and words[0] == 'space': first_space = False continue if n % 4 == 0: r += "\n " r += words[1] + " " n = n+1 if n &gt; 5: print ("got", n, "values, looks good") else: print ("no signal, something went wrong") r += "\n\n" r += """ end raw_codes end remote """ print() print(r) print()</span></span></code> </pre> </div></div><br><p>  <code>irrecord --analyse</code>文件后，您可以尝试使用<code>irrecord --analyse</code>再次“识别”它。 这并不总是成功的，不要急于扔掉旧文件。 我的统计数据是这样的：LG电视的遥控器很容易理解，所有空调和吸尘器都需要手动创建，然后由<code>--analyse</code>处理<code>--analyse</code> 。 </p><br><p> 仅作为示例： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这是我的吸尘器的文件外观</a> 。 </p><br><h4 id="standartnye-imena-komand"> 标准团队名称 </h4><br><p> 为了达到预期的目的，LIRC应该将接收和识别的IR信号转换为<em>Linux输入</em>事件。 因此，默认情况下，要求我们在标准列表中的lircd.conf中具有命令名称。 您可以看到有效名称的列表： </p><br><pre> <code class="bash hljs">irrecord --list-namespace</code> </pre> <br><p> 空调不属于这种模式。 可以通过在写入时添加参数来关闭名称要求： </p><br><pre> <code class="bash hljs">irrecord --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-namespace ....</code> </pre> <br><h3 id="otladka"> 侦错 </h3><br><p> 检查接收器帮助<code>mode2</code>实用程序，该实用程序将打印所有可见信号。 </p><br><pre> <code class="bash hljs">/etc/init.d/lircd stop mode2 -d /dev/lirc0</code> </pre> <br><p> 检查传输是否最简单，如果有另一个接收器和<code>mode2</code>正在运行。 在特别无望的情况下，您可以更改GPIO输出上的值，并用测试仪或示波器检查信号的去向。  <code>gpio</code>团队是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">connectionpi</a>软件包的一部分。 </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> sleep 1; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> gpio -g toggle 17 <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p> 您可以使用<code>journalctl</code>查看日志，特别是，这可以让您查看配置文件中的错误： </p><br><pre> <code class="bash hljs">journalctl -b 0 /usr/sbin/lircd</code> </pre> <br><h3 id="otpravka-komand"> 发送命令 </h3><br><p> 有一个<code>irsend</code>实用程序，用于传输记录的命令。 她可以显示已知设备的列表，以及每个设备的已知命令的列表。 请注意以下示例中的“空参数”，在此处需要它们。 </p><br><p>  <code>irsend</code>是<code>irsend</code>的客户端，因此如果出现问题，请查看日志（请参见上文）。 </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   irsend LIST "" "" #     LG_TV irsend LIST LG_TV "" #   ON irsend SEND_ONCE LG_TV ON</span></span></code> </pre> <br><p> 从理论上讲，还有另一种可能性-通过其套接字发送命令以<em>Lircd</em> 。 我不明白 </p><br><h3 id="vyzov-iz-python"> 从Python呼叫 </h3><br><p> 几乎所有库都只是<code>irsend</code>的工具包。 我发现的唯一一个通过套接字为API编译客户端的库在Raspberry上不起作用（需要另一个版本的lircd）。 因此，它们没有什么意义；我可以自己调用该命令： </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> subprocess subprocess.call([<span class="hljs-string"><span class="hljs-string">"irsend"</span></span>, <span class="hljs-string"><span class="hljs-string">"send_once"</span></span>, <span class="hljs-string"><span class="hljs-string">"BEDROOM_AC"</span></span>, <span class="hljs-string"><span class="hljs-string">"OFF"</span></span>])</code> </pre> <br><h3 id="hardware"> 硬体 </h3><br><img src="https://habrastorage.org/webt/ra/6g/qw/ra6gqwfqx5ksnzpyoaqefa4c6_4.png" alt="红外帽" align="left"><br><p> 我使用现成的板， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">亚马逊</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AliExpress</a>上有很多。 您可以像“ Raspberry IR Shedd”一样搜索它。 从上面的配置可以看出，它使用GPIO 17进行输出，并使用GPIO 18进行输入。 </p><br><p> 板上有一个用于放置第二个（附加）LED D2的位置，默认情况下未安装该位置。 当使用两个LED时，它们串联连接。 因此，在没有LED D2的情况下，必须关闭跳线SJ1。 我很惊讶地发现跳线最初在我的所有板上都是打开的。 我不得不修改烙铁。 </p><br><div class="spoiler">  <b class="spoiler_title">给希望看的人放大的照片</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/mw/zx/cv/mwzxcvky2udvljqqbz1kgff8ytg.jpeg" alt="IRDA帽子"></p></div></div><br><h3 id="itogi"> 总结 </h3><br><p> 它的工作原理是：信号已发送，设备可以看到并对其做出正确反应。 </p><br><p> 在很大程度上取决于二极管发射器的位置，它必须准确地对准接收器。 一台固定的发射器无法控制房间中的所有设备。 为每个小工具克隆基于Raspberry Pi的解决方案非常昂贵，您需要修改发射器以“覆盖更大的区域”，或者找到更便宜的平台。 </p><br><p>  LIRC最初是为了将IR信号转换为输入设备的标准Linux事件而创建的。 因此，对他而言，一个按钮就是一个代码是很自然的。 对于某些设备（大多数空调）不是这样：单击任何按钮时，遥控器都会传输一个数据包，其中包含设备的完整状态（开机，运行模式，温度，风扇运行模式，时间，计时器等）。 无法基于LIRC中的多个参数构建多组件程序包，因此，它作为开箱即用的快速工具很有用，但是您将不得不寻找其他东西。 尽管在大多数情况下，使用常规风扇设置且没有奇异模式的录制数据已足够。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461195/">https://habr.com/ru/post/zh-CN461195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461179/index.html">为什么费马大定理的证明不需要改进</a></li>
<li><a href="../zh-CN461181/index.html">我们介绍IdM。 实施工程师的观点</a></li>
<li><a href="../zh-CN461185/index.html">JsonDiscovery：更改在浏览器中查看JSON的体验</a></li>
<li><a href="../zh-CN461191/index.html">6月16日夏季DIYorDIE聚会的录音</a></li>
<li><a href="../zh-CN461193/index.html">与您一起PhysTech.Science：消除认知扭曲并理解心灵的秘密</a></li>
<li><a href="../zh-CN461197/index.html">有关严酷的俄罗斯IT和数字化受害者的故事</a></li>
<li><a href="../zh-CN461199/index.html">如何在Rutoken上使用GOST-2012密钥在Linux中使用PAM模块进行本地身份验证</a></li>
<li><a href="../zh-CN461201/index.html">Android应用中的主题和样式</a></li>
<li><a href="../zh-CN461205/index.html">最佳测试管理系统2019</a></li>
<li><a href="../zh-CN461207/index.html">系统管理员，今天是我们的一天</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>