<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíö üêç ü§® Zabbix als Sicherheitsscanner üå∑ ü§µüèº üî©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Wir alle kennen und lieben Produkte f√ºr Schwachstellenbewertungsprozesse wie Nessus , Qualys , Max Patrol und alle m√∂glichen anderen OpenVAS . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix als Sicherheitsscanner</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vulners/blog/416137/"><p>  Hallo!  Wir alle kennen und lieben Produkte f√ºr Schwachstellenbewertungsprozesse wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nessus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Qualys</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Max Patrol</a> und alle m√∂glichen anderen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenVAS</a> .  Eine der Hauptaufgaben, die sie l√∂sen, ist die Kontrolle √ºber versionierte Schwachstellen. </p><br><p>  Dies ist ein ziemlich einfacher Vorgang zum Vergleichen installierter Softwareversionen mit dem Bereich "enth√§lt keine bekannten Schwachstellen".  Nun, dann entscheiden die Verantwortlichen f√ºr Informationssicherheit zusammen mit der Entwicklung und den Administratoren, welche Risiken eingegangen werden k√∂nnen und was heute gepatcht werden muss. </p><br><p>  Es gibt viele verschiedene Tools zur L√∂sung dieses Problems, aber aus unserer Sicht haben alle ein gemeinsames Problem: Sie erfordern eine separate problematische Bereitstellung und erzeugen ein anderes Tool mit einem Root-Konto in Ihrer Infrastruktur.  Aber f√ºr eine so einfache Aktion wie das Sammeln von Informationen √ºber installierte Root-Pakete ist es schlie√ülich nicht erforderlich!  In der Regel sind in der Infrastruktur bereits Systeme implementiert, mit denen Daten, die Zusammenarbeit und die Remote-Ausf√ºhrung von Befehlen auf Servern konsolidiert werden k√∂nnen.  Aus diesem Grund haben wir uns entschlossen, ein Tool zu erstellen, mit dem mit wenigen Klicks ein Linux-System zur √úberwachung von Sicherheitsl√ºcken in unserer Umgebung mit minimalen √Ñnderungen an der Produktion bereitgestellt werden kann. </p><br><p>  Was wird in den meisten Lebensmittelsystemen eingesetzt?  Nat√ºrlich √úberwachung.  Und ziemlich oft ist es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zabbix</a> .  Also lasst uns loslegen und es befestigen! </p><a name="habracut"></a><br><h1 id="v-odnoy-ruke-zabbix">  In einer Hand Zabbix </h1><br><p>  Alles ist einfach: Ein verteiltes Agentensystem, Dashboards zur Visualisierung, ein Mehrbenutzerzugriffssystem und das Ausf√ºhren von Aktionen nach festgelegten Kriterien wurden bereits ohne uns durchgef√ºhrt.  Wir m√ºssen das Rad nicht neu erfinden und alles von Grund auf neu machen. </p><br><p>  Zabbix hat gen√ºgend Rechte, um Informationen √ºber Pakete zu erhalten, wo sie auch abgelegt werden k√∂nnen.  Es bleibt, sie zu kombinieren und zur Analyse an die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vulners-API</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">senden</a> .  Und dann das erworbene Wissen √ºber Schwachstellen verarbeiten. </p><br><p>  Beginnen wir jedoch mit einer kurzen Einf√ºhrung dar√ºber, was Zabbix kann und was wir tun m√ºssen. </p><br><p>  <strong>Zabbix-Agenten</strong> sind auf dem Server installiert und erm√∂glichen: </p><br><ul><li>  Holen Sie sich eine breite Palette von Betriebssystemmetriken </li><li>  F√ºhren Sie Skripte und Programme aus und erhalten Sie das Ergebnis ihrer Ausf√ºhrung. </li><li>  F√ºhren Sie alle Befehle in einem separaten Prozess (Fork) aus, unabh√§ngig von den Prozessen des Zabbix-Agenten. </li><li>  mit mehreren Zabbix-Servern gleichzeitig arbeiten; </li><li>  Arbeiten Sie hinter einer Firewall, stellen Sie eine Verbindung zum Server her oder umgekehrt, und warten Sie auf eingehende Verbindungen. </li></ul><br><p>  <strong>Der Zabbix-Server</strong> empf√§ngt √úberwachungsmetriken als Eingabe, schreibt sie in die Datenbank und f√ºhrt die weitere Verarbeitung durch. </p><br>  Durch die Analyse der erhaltenen Daten und basierend auf einer ziemlich flexiblen Logik kann er verschiedene Aktionen ausf√ºhren: <br><br><ul><li>  Senden Sie Benachrichtigungen auf verschiedenen Kan√§len (Mail, SMS, Instant Messenger usw.). </li><li>  Stellen Sie √ºber SSH oder IPMI eine Verbindung zu Servern her und f√ºhren Sie verschiedene Befehle auf diesen aus. </li><li>  Oder f√ºhren Sie verschiedene Korrekturbefehle auf Servern aus, indem Sie Zabbix-Agentenverbindungen zu ihnen herstellen. </li></ul><br><p>  <strong>Die Weboberfl√§che ist</strong> in PHP geschrieben und erm√∂glicht es Ihnen, von Zabbix gesammelte Metriken, Diagramme, ausgel√∂ste Warnungen zu Problemen sowie vom √úberwachungssystem ausgef√ºhrte Befehle und Aktionen anzuzeigen. </p><br><p>  Die Zabbix-Administration erfolgt ebenfalls √ºber die Weboberfl√§che. </p><br><p>  <strong>Die Zabbix-API</strong> ist eine webbasierte API und Teil der Weboberfl√§che.  Es verwendet das JSON-RPC-Protokoll. </p><br><ul><li>  Erm√∂glicht das Empfangen, Erstellen, Konfigurieren und L√∂schen von Objekten im √úberwachungssystem. </li><li>  Mit der API k√∂nnen Sie das √úberwachungssystem problemlos in verschiedene externe Systeme integrieren. </li></ul><br><p>  Zabbix wei√ü jedoch nichts √ºber Schwachstellen!  Aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vulners</a> kennt sie :) </p><br><h2 id="v-drugoy-ruke-vulners">  In der anderen Hand der Vulners </h2><br><ul><li>  Vulnerability Data Aggregator aus √ºber 115 Quellen </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Praktische API f√ºr verschiedene Scanmethoden</a> </li><li>  Stellt Daten in einer normalisierten, maschinenlesbaren Form bereit </li><li>  Sehr schnell </li><li>  Erm√∂glicht die Korrelation von Daten aus verschiedenen Quellen </li></ul><br><p>  Wir haben versucht, sie miteinander zu integrieren, und genau das ist daraus geworden. </p><br><h1 id="zabbix-threat-control">  Zabbix-Bedrohungskontrolle </h1><br><p>  Dies ist ein Open Source Zabbix <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plugin,</a> das in Python geschrieben wurde und das: </p><br><ul><li>  Zeigt Informationen zu Schwachstellen in Ihrer Infrastruktur in der Zabbix-Weboberfl√§che an. </li><li>  Zeigt die Bedrohungsstufe jeder Sicherheitsanf√§lligkeit gem√§√ü dem CVSS-Standard an. </li><li>  Und es bietet leicht anwendbare Methoden, um die gefundenen Schwachstellen zu beseitigen. </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CVSS</a> ist ein offener Industriestandard zur Bewertung der Schwachstellenkritikalit√§t.  In der Tat - 10-Punkte-Skala. </p><br>  Mit dieser Technik k√∂nnen Sie Schwachstellen in verschiedenen Systemen und mit unterschiedlichen Eigenschaften auf einen einzigen Nenner bringen, was die Priorisierung erkannter Probleme vereinfacht. <br><br>  Wir haben beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zabbix Moscow Meetup</a> √ºber dieses Plugin gesprochen.  F√ºr diejenigen, die nicht gerne lesen, sondern gerne zuschauen - gibt es einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Videobericht</a> . <br><br><h2 id="konsolidiruyte-informaciyu-ob-uyazvimostyah">  Informationen zu Sicherheitsl√ºcken konsolidieren </h2><br><p>  Das Ergebnis des Plugins in Zabbix ist wie folgt: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/70c/a22/394/70ca22394ca3092373bf8529d0c69025.png" alt="Dashboard"><br>  Dies ist ein Dashboard in Zabbix.  Darauf werden von links nach rechts folgende Informationen angezeigt: </p><br><ul><li>  Verteilung der CVSS-Punktzahl nach Servern.  Das Kreisdiagramm zeigt die Beziehung - wie viele Server wir mit kritischen Schwachstellen haben, wie viele unkritische Schwachstellen bekannte Schwachstellen haben oder √ºberhaupt nicht. </li><li>  Der mittlere CVSS-Wert der gesamten Infrastruktur.  Es wird in Form eines Diagramms angezeigt, mit dem Sie die Dynamik seiner √Ñnderung beobachten k√∂nnen. </li><li>  Liste der anf√§lligen Pakete mit einem Index der Auswirkungen der Sicherheitsanf√§lligkeit auf die Infrastruktur. </li><li>  Eine vollst√§ndige Liste der anf√§lligen Server mit einer Bedrohungsstufe f√ºr jeden von ihnen. </li><li>  Liste der Sicherheitsbulletins, die in der Infrastruktur ‚Äûgefunden‚Äú wurden. </li></ul><br><p>  Nachfolgend ausf√ºhrlicher √ºber die interessantesten: </p><br><p>  <strong>Informationen zu anf√§lligen Servern:</strong> </p><br><p><img src="https://habrastorage.org/webt/hb/nm/5m/hbnm5mgchmq1yfj9mxfzkdepwxu.gif" alt="Gastgeber"></p><br><p>  Das Bedienfeld zeigt eine Liste aller Server mit einer Sicherheitsl√ºcke √ºber kritisch an.  Das akzeptable Mindestma√ü an Kritikalit√§t, nach dem der Server als anf√§llig erscheint, wird in den Plugin-Einstellungen angegeben. </p><br><p>  Die folgenden Informationen sind f√ºr jeden Server verf√ºgbar: </p><br><ol><li>  Eigentlich der Name des anf√§lligen Servers. </li><li>  Maximale CVSS-Server-Punktzahl.  Die h√∂chste Punktzahl aller f√ºr diesen Server gefundenen Schwachstellen wird angezeigt. </li><li>  Ein Befehl zum Entfernen aller erkannten Schwachstellen auf diesem Server.  Nach Abschluss dieses Vorgangs erhalten wir einen Server, auf dem keine versionierten Schwachstellen bekannt sind. </li></ol><br><p>  Die Daten werden mit CVSS-Sortierung von maximal bis minimal dargestellt.  Auf diese Weise k√∂nnen Sie die Server, die die meiste Aufmerksamkeit erfordern, immer ganz oben auf der Liste halten. </p><br><p>  <strong>Das folgende Fenster zeigt die anf√§lligen Pakete:</strong> </p><br><p><img src="https://habrastorage.org/webt/0q/75/em/0q75emnx6roeuhvz3ltalvwrbio.gif" alt="Pakete"></p><br><p>  Hier haben wir f√ºr jedes anf√§llige Paket in unserer Infrastruktur eine kurze Zusammenfassung: </p><br><ol><li>  Der Name des anf√§lligen Pakets. </li><li>  Sicherheitsanf√§llige <em>Version des</em> Pakets. </li><li>  Die Anzahl der Server, auf denen die anf√§llige Version des Pakets installiert ist. </li><li>  CVSS-Punktzahl f√ºr diese Paketversion. </li><li>  Index der Auswirkungen dieser Sicherheitsanf√§lligkeit auf die Infrastruktur. </li><li>  Eine Liste aller Server, auf denen eine anf√§llige Version des Pakets erkannt wird. </li><li>  Link zum Security Bulletin.  Erm√∂glicht es Ihnen zu lesen und zu verstehen, wie kritisch diese Sicherheitsanf√§lligkeit in unserer Situation ist. </li><li>  Das Team behebt die Sicherheitsanf√§lligkeit in diesem Paket. </li></ol><br><p>  Die Daten werden nach Wirkungsindex sortiert dargestellt, von maximal bis minimal. </p><br><p>  <em>Der Auswirkungsindex</em> ist die Anzahl der betroffenen Server multipliziert mit dem CVSS-Schwachstellenwert.  Es kommt h√§ufig vor, dass eine Sicherheitsanf√§lligkeit mit einer nicht so hohen Punktzahl in der Infrastruktur viel weiter verbreitet und daher m√∂glicherweise gef√§hrlicher ist. </p><br><h2 id="vybirayte-strategii-ustraneniya-uyazvimostey">  W√§hlen Sie Vulnerability Management-Strategien </h2><br><p>  Sie k√∂nnen jedoch nicht einfach alle Pakete auf allen Servern auf die neueste Version aktualisieren, wodurch vorhandene Schwachstellen beseitigt werden. </p><br><p>  In jeder Infrastruktur, die aus mehr als mehreren Servern besteht, gibt es viele Einschr√§nkungen: die Abh√§ngigkeit einer Software von der Version einer anderen, das Risiko einer Funktionsbeeintr√§chtigung usw. </p><br><p>  Daher haben Sie immer die Wahl, welche Pakete wir problemlos aktualisieren k√∂nnen.  Welche Pakete erfordern einen separaten Arbeitsplan f√ºr die Umsetzung von Ausgleichsma√ünahmen.  Und durch was wir Risiken eingehen k√∂nnen. </p><br><p>  Mit dem im Plugin vorgeschlagenen Ansatz k√∂nnen Sie die Strategie zur Beseitigung von Schwachstellen ausw√§hlen, die zu Ihnen passt: </p><br><ul><li>  <strong>Eine Sicherheitsanf√§lligkeit in der gesamten Infrastruktur:</strong> Wenn eine bestimmte Sicherheitsanf√§lligkeit f√ºr Sie von entscheidender Bedeutung ist, erhalten Sie √ºber das Plugin Informationen dar√ºber, wo diese Sicherheitsanf√§lligkeit in Ihrer Infrastruktur vorhanden ist und wie sie sofort in der gesamten Infrastruktur behoben werden kann. </li><li>  <strong>Alle Schwachstellen auf einem bestimmten Server:</strong> Wenn Sie beispielsweise einen vollst√§ndig sicheren Server in der DMZ oder hinter dem Unternehmensrand ben√∂tigen, erhalten Sie mithilfe des Plug-Ins Informationen dar√ºber, wie Sie alle darauf gefundenen Schwachstellen beseitigen k√∂nnen. </li></ul><br><h2 id="ustranyayte-naydennye-uyazvimosti">  Behobene Schwachstellen behoben </h2><br><p>  Es reicht jedoch nicht aus, zu wissen, welche Schwachstellen wir haben und wie und welche behoben werden k√∂nnen.  Dies ist auch notwendig! </p><br><p>  Systeme wie Puppet oder Ansible werden h√§ufig f√ºr das zentrale Konfigurationsmanagement und Software-Updates verwendet.  Sie k√∂nnen den Befehl fix verwenden, der die Sicherheitsanf√§lligkeit behebt, und sie mithilfe solcher Systeme zentral ausf√ºhren. </p><br><p>  Wenn Ihre Infrastruktur solche Systeme nicht verwendet, k√∂nnen Sie mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zabbix Threat Control</a> Schwachstellen direkt √ºber die Zabbix-Weboberfl√§che beseitigen. </p><br><p><img src="https://habrastorage.org/webt/f5/i7/pj/f5i7pjelugjzoildcxmb-qkttfc.png"></p><br><p>  Hierzu verwendet das Plugin die Standard-Zabbix-Funktionalit√§t: Best√§tigung von Ereignissen und Ausf√ºhrung von Remote-Befehlen: </p><br><ol><li>  Sobald das Problem von einem autorisierten Benutzer √ºber die Weboberfl√§che best√§tigt wurde; </li><li>  Es wird ein Remote-Befehl gestartet, der auf dem Zielserver oder einer Liste von Servern ausgef√ºhrt wird. Ein Fix-Befehl, der die Sicherheitsanf√§lligkeit behebt. </li></ol><br><h2 id="kak-eto-rabotaet">  Wie funktioniert es? </h2><br><p><img src="https://habrastorage.org/webt/io/mf/li/iomflipmyk5lxwmn8qbntuswufs.gif"></p><br><ol><li>  Der Zabbix-Server erh√§lt √ºber Zabbix-Agenten Informationen zu Paketen und zum Betriebssystem aller Server in der Infrastruktur. </li><li>  Das Plugin (unter Verwendung der Zabbix-API) empf√§ngt einen Betriebssystembericht, der zuvor vom Zabbix-Server erstellt wurde.  Das Plugin empf√§ngt nichts direkt von den Servern.  Und zu diesem Zeitpunkt ist kein direkter Kontakt mit ihnen erforderlich. </li><li>  Nachdem die von Zabbix erhaltenen Informationen verarbeitet wurden, gibt das Plugin sie an Vulners weiter.  Daraus erh√§lt er eine Liste der gefundenen Schwachstellen, deren Kritikalit√§t und einen Weg, sie zu beseitigen. </li><li>  Das Plugin verarbeitet die empfangenen Daten, aggregiert sie zur Erstellung von Statistiken und generiert Datenpakete zur √úbertragung an Zabbix. </li><li>  Das Plugin √ºbertr√§gt Zabbix-Daten im erforderlichen √úberwachungssystemformat.  Er tut dies mit dem Dienstprogramm zabbix-sender.  Danach haben Sie bereits alles √ºber die gefundenen Schwachstellen √ºberwacht, die auf dem zuvor gezeigten Dashboard angezeigt werden. </li><li>  Nach Best√§tigung des Problems wird ein Remote-Befehl ausgef√ºhrt, der an das Plugin √ºbergeben wird: <br><ul><li>  Der Name der Person, die es initiiert hat </li><li>  Fix Vulnerability Fix Team </li><li>  Serverliste </li></ul></li><li>  Nachdem Sie all diese Zabbix Threat Control erhalten haben: <br><ul><li>  √úberpr√ºft, ob der Korrekturbefehl von denjenigen initiiert wird, die ihn ben√∂tigen.  Von dem, der nicht gebraucht wird - er akzeptiert den Befehl nicht :) </li><li>  F√ºhrt den an ihn √ºbertragenen Befehl auf der erforderlichen Anzahl von Servern aus. </li></ul></li></ol><br><p> Standardm√§√üig sendet das Plugin mit dem Dienstprogramm zabbix-get einen Fix-Befehl an anf√§llige Server und greift mit dem Parameter <code>nowait</code> auf den Zabbix-Agenten auf dem Zielserver zu.  Diese Verbindungsmethode erm√∂glicht die Aktualisierung von Paketen im Hintergrund, ohne an die Prozesse des zabbix-Agenten gebunden zu sein.  Es ist auch m√∂glich, den Befehl √ºber eine einfache SSH-Verbindung auf dem Zielserver auszuf√ºhren.  Die Art und Weise, wie Fixbefehle ausgef√ºhrt werden, ist in der Konfigurationsdatei des Plugins als Option ausgew√§hlt. </p><br><p>  Und als Ergebnis der Arbeit - das Fehlen anf√§lliger Server, Ihr guter Schlaf und Ihre gute Laune :) </p><br><h2 id="ustanovka">  Installation </h2><br><p>  Wir haben dar√ºber gesprochen, was <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zabbix Threat Control ist</a> , warum es ben√∂tigt wird und wie es funktioniert.  Jetzt erfahren Sie, wie Sie es installieren und konfigurieren! </p><br><h3 id="zavisimosti">  Abh√§ngigkeiten </h3><br><p>  Um zu funktionieren, ben√∂tigt das Plugin nichts √úbernat√ºrliches.  Auf dem <strong>Zabbix-Server,</strong> auf dem wir den Plan festlegen, muss Folgendes sein: </p><br><ul><li>  <strong>zabbix v3.4</strong> f√ºr die Verwendung von benutzerdefinierten Dashboards (sie wurden nur in dieser Version <strong>angezeigt</strong> ). </li><li>  <strong>zabbix-sender wird</strong> ben√∂tigt, um Schwachstellendaten an das √úberwachungssystem zu senden. </li><li>  <strong>zabbix-get</strong> sendet Fix-Befehle, die Schwachstellen an Server beheben. </li><li>  <strong>Python v3</strong> mit Modulen: <strong>pyzabbix, jpath, Anforderungen</strong> zum Ausf√ºhren der Haupt-Plugin-Skripte. </li></ul><br><p>  Auf allen <strong>Servern, f√ºr die nur</strong> nach Schwachstellen gesucht werden muss: </p><br><ul><li>  <strong>zabbix-agent</strong> zum sammeln von daten und zum <strong>ausf√ºhren von skripten</strong> . </li><li>  <strong>Python v2</strong> zum Ausf√ºhren des Skripts zum Sammeln des Betriebssystemberichts. </li></ul><br><h3 id="ustanovka-plagina-iz-paketov">  Installieren des Plugins aus Paketen </h3><br><p>  Verbinden Sie das Repository zun√§chst mit Paketen: </p><br><p>  <strong>Drehzahlverteilungen</strong> </p><br><pre> <code class="bash hljs"> rpm -Uhv https://repo.vulners.com/redhat/vulners-repo.rpm</code> </pre> <br><p>  <strong>DEB-</strong> Verteilungen </p><br><pre> <code class="bash hljs"> wget https://repo.vulners.com/debian/vulners-repo.deb dpkg -i vulners-repo.deb</code> </pre> <br><p>  Danach installieren wir auf dem Zabbix-Server das Hauptpaket, das die gesamte Logik des Plug-Ins und des Pakets enth√§lt, das √ºber das Betriebssystem berichtet: </p><br><p>  <strong>Drehzahlverteilungen</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  <strong>DEB-</strong> Verteilungen </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Auf allen anderen Servern, auf denen nach Sicherheitsl√ºcken gesucht werden muss, installieren wir ein Paket, das Betriebssystemberichte generiert: </p><br><p>  <strong>Drehzahlverteilungen</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-host</code> </pre> <br><p>  <strong>DEB-</strong> Verteilungen </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-host</code> </pre> <br><h3 id="ustanovka-iz-ishodnikov">  Installation von der Quelle </h3><br><p>  Wenn Sie die Installation von der Quelle bevorzugen, ist dies auch sehr einfach: </p><br><p>  Auf dem Zabbix-Server installieren wir die Hauptskripte, die die gesamte Logik des Plug-Ins und des Skripts bereitstellen, das √ºber das Betriebssystem berichtet: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># main mkdir -p /opt/monitoring/zabbix-threat-control cp zabbix-threat-control/ztc* /opt/monitoring/zabbix-threat-control/ chown -R zabbix:zabbix /opt/monitoring/zabbix-threat-control chmod 640 /opt/monitoring/zabbix-threat-control/ztc_config.py touch /var/log/zabbix-threat-control.log chown zabbix:zabbix /var/log/zabbix-threat-control.log chmod 664 /var/log/zabbix-threat-control.log # host cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><p>  Auf allen anderen Servern, auf denen nach Sicherheitsl√ºcken gesucht werden muss, installieren wir nur ein Skript, das √ºber das Betriebssystem berichtet: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># host mkdir -p /opt/monitoring/ cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><h2 id="nastroyka">  Anpassung </h2><br><p>  Nach der Installation m√ºssen Sie das Plugin konfigurieren und ein √úberwachungssystem f√ºr den Betrieb vorbereiten.  Im Folgenden werden alle erforderlichen Aktionen Schritt f√ºr Schritt beschrieben. </p><br><h3 id="nastraivaem-servera-trebuyuschie-skanirovaniya">  Konfigurieren von Servern, die gescannt werden m√ºssen </h3><br><p>  Sie m√ºssen den Zabbix-Agenten aktivieren, um Remote-Befehle ausf√ºhren zu k√∂nnen.  √Ñndern Sie dazu auf allen Servern, f√ºr die ein Scan erforderlich ist, die Parameter in der Konfigurationsdatei des zabbix-agent wie folgt: </p><br><pre> <code class="hljs">EnableRemoteCommands=1 LogRemoteCommands=1</code> </pre> <br><p>  Die Konfigurationsdatei des zabbix-Agenten befindet sich normalerweise hier: <code>/etc/zabbix/zabbix_agentd.conf</code> </p><br><p>  Wenn Sie die Funktionalit√§t verwenden m√∂chten, um mithilfe von <em>Zabbix Threat Control</em> gefundene Schwachstellen zu beseitigen, m√ºssen Sie dem zabbix-Benutzer erlauben, die Pakete zu <strong>aktualisieren</strong> (aber nicht zu installieren oder zu deinstallieren). </p><br>  <code>/etc/sudoers</code> Datei <code>/etc/sudoers</code> die folgende Zeile <code>/etc/sudoers</code> : <br><p>  Bei <strong>RPM-</strong> Verteilungen sieht die Zeile folgenderma√üen aus: </p><br><pre> <code class="hljs pgsql">zabbix <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>) NOPASSWD: /usr/bin/yum -y <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> *</code> </pre> <br><p>  F√ºr <strong>DEB-</strong> Distributionen etwas anders: </p><br><pre> <code class="hljs powershell">zabbix ALL=(ALL) NOPASSWD: /usr/bin/apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> -<span class="hljs-literal"><span class="hljs-literal">-assume</span></span><span class="hljs-literal"><span class="hljs-literal">-yes</span></span> install -<span class="hljs-literal"><span class="hljs-literal">-only</span></span><span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span> *</code> </pre> <br><h3 id="podklyuchaemsya-k-vulners">  Stellen Sie eine Verbindung zu Vulners her </h3><br><p>  Um die Vulners-API verwenden zu k√∂nnen, ben√∂tigen Sie einen API-Schl√ºssel.  Um es zu bekommen: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Melden Sie</a> sich bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vulners.com an</a> </li><li>  Wechseln Sie in Ihrem Konto zur Registerkarte KEYS API </li><li>  W√§hlen Sie im Bereich "Scope" die Option "Scannen" und dr√ºcken Sie "GENERATE NEW KEY". </li></ul><br><p>  Sie erhalten einen API-Schl√ºssel, der folgenderma√üen aussieht: RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K9269B0K86K6XQQQR32O6007NUK </p><br><p><img src="https://habrastorage.org/webt/bu/r1/_8/bur1_85domk9m6gkzoaxsghzoqa.png"></p><br><p>  Jetzt m√ºssen Sie den Vulners-API-Schl√ºssel zur Plugin-Konfigurationsdatei <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><p>  Ein Beispiel: </p><br><pre> <code class="hljs 1c">vuln_api_key = 'RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K<span class="hljs-number"><span class="hljs-number">9269</span></span>B0K86K6XQQQR32O<span class="hljs-number"><span class="hljs-number">6007</span></span>NUK'</code> </pre> <br><h3 id="podklyuchaemsya-k-zabbix">  Stellen Sie eine Verbindung zu Zabbix her </h3><br><p>  Damit das Plugin eine Verbindung zu Zabbix herstellen kann, m√ºssen Sie die folgenden Daten in der Konfigurationsdatei angeben: <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><ul><li>  Zabbix-Webschnittstellenadresse f√ºr die Arbeit mit der Zabbix-API; </li><li>  Benutzername und Passwort, unter denen wir eine Verbindung zur Zabbix-API herstellen. </li></ul><br>  Dom√§nenname und Port des Zabbix-Servers zum Senden von Daten mit dem Dienstprogramm zabbix-sender. <br><br><p>  Ein Beispiel: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">zbx_pass</span></span> = <span class="hljs-string"><span class="hljs-string">'yourpassword'</span></span> zbx_user = <span class="hljs-string"><span class="hljs-string">'yourlogin'</span></span> zbx_url = <span class="hljs-string"><span class="hljs-string">'https://zabbixfront.yourdomain.com'</span></span> zbx_server_fqdn = <span class="hljs-string"><span class="hljs-string">'zabbixserver.yourdomain.com'</span></span> zbx_server_port = <span class="hljs-string"><span class="hljs-string">'10051'</span></span></code> </pre> <br><h3 id="podgotavlivaem-zabbix">  Zabbix vorbereiten </h3><br><p>  Sie m√ºssen in Zabbix Objekte erstellen, die das Plugin bereitstellen.  F√ºhren Sie dazu das Skript <code>/opt/monitoring/zabbix-threat-control/ztc_create.py</code> .  Das Skript √ºberpr√ºft, ob das Plugin korrekt konfiguriert ist, und erstellt es mithilfe der API in Zabbix: </p><br><ol><li>  <strong>Hostgruppe,</strong> zu der Hosts mit Schwachstellen hinzugef√ºgt werden. </li><li>  <strong>Die Vorlage,</strong> mit der der Betriebssystembericht von allen Servern erfasst wird. </li><li>  <strong>Hosts</strong> zum Anzeigen von Schwachstellen nach Paketen, Servern, Bulletins und allgemeinen Statistiken. </li><li>  <strong>Eine Aktion</strong> zum Ausf√ºhren von Befehlen zur Behebung von Remote-Schwachstellen. </li><li>  <strong>Dashboard</strong> zur einfachen Anzeige all dieser Informationen. </li></ol><br><p><img src="https://habrastorage.org/webt/mh/p1/qe/mhp1qeyu_r-c-zvxhtrthl0bzyg.gif"></p><br><p>  Nachdem Sie alle Objekte in Zabbix erstellt haben, zeigt das Skript Folgendes an: </p><br><ul><li>  Link zum erstellten Dashboard in Zabbix, auf dem Schwachstellen angezeigt werden. </li><li>  Der Zeitpunkt, zu dem der Infrastruktur-Scan nach Schwachstellen gestartet wird. </li></ul><br><p>  Nachdem alle erforderlichen Objekte in Zabbix erstellt wurden, m√ºssen Sie zur Zabbix-Weboberfl√§che gehen und die soeben vom Skript erstellte Vorlage "Vulners OS-Report" mit allen Servern verkn√ºpfen, die nach Schwachstellen durchsucht werden m√ºssen. </p><br><p><img src="https://habrastorage.org/webt/0h/px/im/0hpxim3eoxm9zxk-_isvvvkpycu.png"></p><br><p>  Danach muss noch gewartet werden, bis das Plugin zu dem bei der Installation angegebenen Zeitpunkt gestartet wird. </p><br><h2 id="skaniruem">  Scannen! </h2><br><p>  Das Hauptdatenverarbeitungsskript ( <code>ztc.py</code> ) wird einmal t√§glich automatisch √ºber "Service Item ..." auf dem Host "Vulners - Statistics" zu dem im Skript angegebenen Zeitpunkt gestartet. </p><br><p>  Sie k√∂nnen die Startzeit des Plugins nach Belieben √§ndern, indem Sie das "Planungsintervall" in diesem Datenelement √§ndern.  In diesem Fall muss auch die Erfassungszeit der Statistiken in den drei Datenelementen der Vorlage "Vulners OS-Report" angepasst werden. Die Metriken in der Vorlage sollten 10 ... 15 Minuten fr√ºher funktionieren als die Hauptmetrik "Service Item ..." auf dem Host "Vulners - Statistics". </p><br><p>  Die Zeit, in der alle Schwachstellendaten verarbeitet werden, h√§ngt von der Anzahl der Server in der Infrastruktur und der Anzahl der darauf installierten Pakete ab.  F√ºr die Verarbeitung von 1000 Servern werden ca. 30 Minuten aufgewendet. </p><br><h1 id="plany">  Pl√§ne </h1><br><p>  Dies ist nur die erste Version des Zabbix Threat Control-Plugins.  Und wir entwickeln es weiter. </p><br>  Die Pl√§ne: <br><br><ul><li>  F√ºgen Sie Informationen zu Dashboards in der CVE-Infrastruktur hinzu. </li><li>  Verweigern Sie die Installation von Skripten auf Agenten und sammeln Sie alle erforderlichen Informationen zum Betriebssystem und zu den Paketen mithilfe der im Zabbix-Agenten integrierten Datenelementschl√ºssel. </li></ul><br><p>  Und da es Open Source ist - machen Sie mit!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pull Anfragen willkommen :)</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416137/">https://habr.com/ru/post/de416137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416127/index.html">CUDA und Remote-GPU</a></li>
<li><a href="../de416129/index.html">Wie KI lernt, Katzenbilder zu erzeugen</a></li>
<li><a href="../de416131/index.html">Wie man mit PD in der Russischen F√∂deration umgeht und nicht gegen das Gesetz verst√∂√üt</a></li>
<li><a href="../de416133/index.html">Rechenzentrum im Ausland: Equinix LD8</a></li>
<li><a href="../de416135/index.html">GUI-Anwendung kleiner als 1 kb</a></li>
<li><a href="../de416139/index.html">Starke Authentifizierung als Teil der GDPR-Strategie</a></li>
<li><a href="../de416143/index.html">Das Buch "Eine Autopsie wird zeigen!" Praktische Malware-Analyse ¬ª</a></li>
<li><a href="../de416147/index.html">Organisation der Navigation in iOS-Anwendungen mit dem Root Controller</a></li>
<li><a href="../de416149/index.html">Fragen und Antworten zu erneuerbaren Energien, Teil 1</a></li>
<li><a href="../de416151/index.html">Dimensionsloser Ballon. Utilitaristische Dimensionsanalyse Magie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>