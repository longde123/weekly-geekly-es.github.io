<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌈 🧖 👨🏼‍🚒 Verwendung von Control Inversion in JavaScript und Reactjs zur Vereinfachung der Codebehandlung 👩🏿‍🤝‍👩🏽 🧑🏾‍🤝‍🧑🏽 🔼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inversion of Control ist ein ziemlich einfach zu verstehendes Programmierprinzip, das gleichzeitig Ihren Code erheblich verbessern kann. Dieser Artike...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwendung von Control Inversion in JavaScript und Reactjs zur Vereinfachung der Codebehandlung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485012/"><p><img src="https://habrastorage.org/getpro/habr/post_images/ca6/d2e/e7c/ca6d2ee7cdf0a14a1357e78d9f266507.webp" alt="Verwendung von Control Inversion in JavaScript und Reactjs zur Vereinfachung der Codebehandlung"></p><br><p>  <em>Inversion of Control ist ein ziemlich einfach zu verstehendes Programmierprinzip, das gleichzeitig Ihren Code erheblich verbessern kann.</em>  <em>Dieser Artikel beschreibt, wie Sie Control Inversion in JavaScript und in Reactjs anwenden.</em> </p><br><p>  Wenn Sie bereits Code geschrieben haben, der an mehreren Stellen verwendet wird, kennen Sie diese Situation: </p><br><ol><li>  Sie erstellen einen wiederverwendbaren Code (es kann sich um eine Funktion, eine React-Komponente, einen React-Hook usw. handeln) und geben ihn frei (für die Zusammenarbeit oder die Veröffentlichung in Open Source). </li><li>  Jemand bittet Sie, neue Funktionen hinzuzufügen.  Ihr Code unterstützt die vorgeschlagene Funktionalität nicht, es könnte jedoch sein, dass Sie eine kleine Änderung vorgenommen haben. </li><li>  Sie fügen Ihrem Code und der zugehörigen Logik ein neues Argument / eine neue Eigenschaft / Option hinzu, damit diese neue Funktion weiterhin funktioniert. </li><li>  Wiederholen Sie die Schritte 2 und 3 mehrmals (oder mehrmals). </li><li> Jetzt ist Ihr wiederverwendbarer Code schwer zu verwenden und zu warten. </li></ol><br><p>  Was genau macht Code zu einem Albtraum?  Es gibt verschiedene Aspekte, die Ihren Code problematisch machen können: </p><a name="habracut"></a><br><ol><li>  <strong>Paketgröße und / oder Leistung:</strong> Nur mehr Code zum Ausführen auf Geräten kann zu einer schlechten Leistung führen.  Manchmal kann dies dazu führen, dass Leute sich einfach weigern, Ihren Code zu verwenden. </li><li>  <strong>Schwierig zu warten:</strong> Früher hatte Ihr wiederverwendbarer Code nur wenige Optionen und konzentrierte sich darauf, eine Sache gut zu machen. Jetzt kann er eine Reihe verschiedener Dinge tun, und Sie müssen alles dokumentieren.  Darüber hinaus werden Ihnen Fragen zur Verwendung Ihres Codes für bestimmte Anwendungsfälle gestellt, die möglicherweise mit Anwendungsfällen vergleichbar sind, für die Sie bereits Unterstützung hinzugefügt haben.  Möglicherweise gibt es sogar zwei fast identische Anwendungsfälle, die sich geringfügig unterscheiden. Sie müssen daher Fragen dazu beantworten, was in einer bestimmten Situation am besten ist. </li><li> <strong>Komplexität der Implementierung</strong> : Jedes Mal, <code>if</code> es sich <em>nicht nur um</em> eine <code>if</code> , besteht jeder Zweig der Logik Ihres Codes gleichzeitig mit den vorhandenen Logikzweigen.  Tatsächlich sind Situationen möglich, in denen Sie versuchen, eine Kombination von Argumenten / Optionen / Requisiten beizubehalten, die noch niemand verwendet. Sie müssen jedoch alle möglichen Optionen in Betracht ziehen, da Sie nicht genau wissen, ob diese Kombinationen von jemandem verwendet werden oder nicht. </li><li>  <strong>Anspruchsvolle API</strong> : Jedes neue Argument / jede neue Option / jedes neue Requisit, das Sie zu Ihrem wiederverwendbaren Code hinzufügen, erschwert die Verwendung, da Sie jetzt über eine umfangreiche README-Datei oder eine Website verfügen, auf der alle verfügbaren Funktionen dokumentiert sind Ihr Code.  Die Verwendung ist nicht bequem, da die Komplexität Ihrer API den Code des Entwicklers durchdringt, der sie verwendet, was den Code kompliziert. </li></ol><br><p>  Infolgedessen leidet jeder.  Es ist erwähnenswert, dass die Umsetzung des endgültigen Programms ein wesentlicher Bestandteil der Entwicklung ist.  Aber es wäre großartig, wenn wir uns mehr Gedanken über die Implementierung unserer Abstraktionen machen würden (siehe <a href="https://kentcdodds.com/blog/aha-programming" rel="nofollow">"AHA-Programmierung"</a> ).  Gibt es eine Möglichkeit, die Probleme mit wiederverwendbarem Code zu reduzieren und dennoch die Vorteile der Verwendung von Abstraktionen zu nutzen? </p><br><h2 id="inversiya-upravleniya">  Kontrollieren Sie die Inversion </h2><br><p>  Die Umkehrung der Kontrolle ist ein Prinzip, das die Erstellung und Verwendung von Abstraktionen wirklich vereinfacht.  Das sagt Wikipedia dazu: </p><br><blockquote>  ... bei der herkömmlichen Programmierung wird Benutzercode, der den Zweck des Programms ausdrückt, in wiederverwendbaren Bibliotheken aufgerufen, um häufige Probleme zu lösen. Bei der Steuerungsumkehrung wird jedoch benutzerdefinierter oder aufgabenspezifischer Code aufgerufen. </blockquote><p>  Stellen Sie es sich folgendermaßen vor: "Reduzieren Sie die Funktionalität Ihrer Abstraktion und sorgen Sie dafür, dass Ihre Benutzer die von ihnen benötigte Funktionalität implementieren können."  Das mag völlig absurd erscheinen, aber wir verwenden Abstraktionen, um komplexe und sich wiederholende Aufgaben zu verbergen und dadurch unseren Code „sauberer“ und „ordentlicher“ zu machen.  Wie wir oben gesehen haben, vereinfachen traditionelle Abstraktionen den Code jedoch nicht immer. </p><br><h1 id="chto-takoe-inversiya-upravleniya-v-kode">  Was ist die Inversion von Management im Code? </h1><br><p>  Als erstes ist hier ein sehr ausgeklügeltes Beispiel: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (element !== null &amp;&amp; element !== undefined) { newArray[newArray.length] = element } } return newArray } // : filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', '']</span></span></code> </pre> <br><p>  Spielen wir nun einen typischen "Abstraktionslebenszyklus", indem wir dieser Abstraktion neue Anwendungsfälle hinzufügen und sie "sinnlos verbessern", um diese neuen Anwendungsfälle zu unterstützen: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter( array, { filterNull = true, filterUndefined = true, filterZero = false, filterEmptyString = false, } = {}, ) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if ( (filterNull &amp;&amp; element === null) || (filterUndefined &amp;&amp; element === undefined) || (filterZero &amp;&amp; element === 0) || (filterEmptyString &amp;&amp; element === '') ) { continue } newArray[newArray.length] = element } return newArray } filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterNull: false}) // [0, 1, 2, null, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterUndefined: false}) // [0, 1, 2, undefined, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterZero: true}) // [1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterEmptyString: true}) // [0, 1, 2, 3, 'four']</span></span></code> </pre> <br><p>  Unser Programm arbeitet also mit nur sechs Anwendungsfällen, aber tatsächlich unterstützen wir jede mögliche Kombination von Funktionen, und es gibt bis zu 25 solcher Kombinationen (wenn ich richtig gerechnet habe). </p><br><p>  Im Allgemeinen ist dies eine ziemlich einfache Abstraktion.  Aber es kann vereinfacht werden.  Es kommt häufig vor, dass die Abstraktion, zu der neue Funktionen hinzugefügt wurden, für die tatsächlich unterstützten Anwendungsfälle erheblich vereinfacht werden kann.  Sobald die Abstraktion etwas unterstützt (z. B. <code>{ filterZero: true, filterUndefined: false }</code> ausführen), haben wir <code>{ filterZero: true, filterUndefined: false }</code> Angst, diese Funktionalität zu entfernen, da der darauf basierende Code möglicherweise <code>{ filterZero: true, filterUndefined: false }</code> . </p><br><p>  Wir schreiben sogar Tests für Anwendungsfälle, die wir tatsächlich nicht haben, einfach weil unsere Abstraktion diese Szenarien unterstützt, und wir müssen dies möglicherweise in Zukunft tun.  Und wenn diese oder andere Anwendungsfälle für uns unnötig werden, entfernen wir ihre Unterstützung nicht, da wir sie einfach vergessen oder glauben, dass sie für uns in Zukunft nützlich sein könnte oder wir einfach Angst haben, etwas zu zerbrechen. </p><br><p>  Okay, schreiben wir nun eine ausführlichere Abstraktion für diese Funktion und wenden die Kontrollinversionsmethode an, um alle Anwendungsfälle zu unterstützen, die wir benötigen: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array, filterFn) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (filterFn(element)) { newArray[newArray.length] = element } } return newArray } filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null &amp;&amp; el !== undefined, ) // [0, 1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined) // [0, 1, 2, null, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null) // [0, 1, 2, undefined, 3, 'four', ''] filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined &amp;&amp; el !== null &amp;&amp; el !== 0, ) // [1, 2, 3, 'four', ''] filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined &amp;&amp; el !== null &amp;&amp; el !== '', ) // [0, 1, 2, 3, 'four']</span></span></code> </pre> <br><p>  Großartig!  Es ist viel einfacher geworden.  Wir haben gerade die Kontrolle über die Funktion übertragen und die Verantwortung für die Entscheidung, welches Element in das neue Array fällt, von der <code>filter</code> auf die Funktion übertragen, die die Filterfunktion aufruft.  Beachten Sie, dass die <code>filter</code> sich immer noch eine nützliche Abstraktion ist, aber jetzt viel flexibler. </p><br><p>  Aber war die vorherige Version dieser Abstraktion so schlecht?  Wahrscheinlich nicht.  Aber seit wir die Kontrolle übernommen haben, können wir jetzt viel mehr einzigartige Anwendungsfälle unterstützen: </p><br><pre> <code class="javascript hljs">filter( [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dog'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dolphin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'eagle'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'elephant'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'robin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'salmon'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, ], animal =&gt; animal.legs === <span class="hljs-number"><span class="hljs-number">0</span></span>, ) <span class="hljs-comment"><span class="hljs-comment">// [ // {name: 'dolphin', legs: 0, mammal: true}, // {name: 'salmon', legs: 0, mammal: false}, // ]</span></span></code> </pre> <br><p>  Stellen Sie sich vor, Sie müssten Unterstützung für diesen Anwendungsfall hinzufügen, ohne eine Steuerungsumkehrung anzuwenden.  Ja, das wäre einfach lächerlich. </p><br><h1 id="plohoy-api">  Schlechte API? </h1><br><p>  Eine der häufigsten Beschwerden, die ich von Leuten in Bezug auf APIs höre, die eine Inversion der Steuerung verwenden, ist: "Ja, aber jetzt ist es schwieriger zu verwenden als zuvor."  Nehmen Sie dieses Beispiel: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  filter([0, 1, undefined, 2, null, 3, 'four', '']) //  filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null &amp;&amp; el !== undefined, )</span></span></code> </pre> <br><p>  Ja, eine der Optionen ist eindeutig einfacher zu bedienen als die andere.  Einer der Vorteile der Steuerelementinversion ist jedoch, dass Sie eine API verwenden können, die die Steuerelementinversion verwendet, um Ihre alte API erneut zu implementieren.  Das ist normalerweise ziemlich einfach.  Z.B: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterWithOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> array, { filterNull = true, filterUndefined = true, filterZero = false, filterEmptyString = false, } = {}, </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter( array, element =&gt; !( (filterNull &amp;&amp; element === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || (filterUndefined &amp;&amp; element === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) || (filterZero &amp;&amp; element === <span class="hljs-number"><span class="hljs-number">0</span></span>) || (filterEmptyString &amp;&amp; element === <span class="hljs-string"><span class="hljs-string">''</span></span>) ), ) }</code> </pre> <br><p>  Cool, was?  Auf diese Weise können wir Abstraktionen über der API erstellen, in der die Steuerelementinversion angewendet wird, und dadurch eine einfachere API erstellen.  Und wenn es in unserer "einfacheren" API nicht genügend Anwendungsfälle gibt, können unsere Benutzer dieselben Bausteine ​​verwenden, mit denen wir unsere High-Level-API erstellt haben, um Lösungen für komplexere Aufgaben zu entwickeln.  Sie müssen uns nicht bitten, <code>filterWithOptions</code> eine neue Funktion <code>filterWithOptions</code> und auf die Implementierung zu warten.  Sie verfügen bereits über Tools, mit denen sie die benötigten Zusatzfunktionen eigenständig entwickeln können. </p><br><p>  Und nur für den Fan: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterByLegCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">array, legCount</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter(array, animal =&gt; animal.legs === legCount) } filterByLegCount( [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dog'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dolphin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'eagle'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'elephant'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'robin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'salmon'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, ], <span class="hljs-number"><span class="hljs-number">0</span></span>, ) <span class="hljs-comment"><span class="hljs-comment">// [ // {name: 'dolphin', legs: 0, mammal: true}, // {name: 'salmon', legs: 0, mammal: false}, // ]</span></span></code> </pre> <br><p>  Sie können spezielle Funktionen für jede Situation erstellen, die bei Ihnen häufig auftritt. </p><br><h2 id="primery-iz-realnoy-zhizni">  Beispiele aus der Praxis </h2><br><p>  Das funktioniert also in einfachen Fällen, aber ist dieses Konzept für das wirkliche Leben geeignet?  Höchstwahrscheinlich verwenden Sie ständig die Kontrollinversion.  Beispielsweise wendet die Funktion <code>Array.prototype.filter</code> die umgekehrte Steuerung an.  Wie die Funktion <code>Array.prototype.map</code> . </p><br><p>  Es gibt verschiedene Muster, mit denen Sie möglicherweise bereits vertraut sind und die nur eine Form der Kontrollinversion darstellen. </p><br><p>  Hier sind zwei meiner Lieblingsmuster, die diese zeigen: <a href="https://kentcdodds.com/blog/compound-components-with-react-hooks" rel="nofollow">"Compound Components"</a> und <a href="https://kentcdodds.com/blog/the-state-reducer-pattern" rel="nofollow">"State Reducers"</a> .  Nachfolgend finden Sie kurze Beispiele, wie diese Muster angewendet werden können. </p><br><h3 id="sostavnye-komponenty-compound-components">  Zusammengesetzte Komponenten </h3><br><p>  Angenommen, Sie möchten eine <code>Menu</code> mit einer Schaltfläche zum Öffnen eines Menüs und einer Liste von Menüelementen erstellen, die angezeigt werden, wenn Sie auf die Schaltfläche klicken.  Wenn das Objekt ausgewählt ist, führt es eine Aktion aus.  Um dies zu implementieren, erstellen sie normalerweise einfach Requisiten: </p><br><pre> <code class="xml hljs">function App() { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">buttonContents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{</span></span></span><span class="hljs-tag"> &lt;&gt;</span></span> Actions <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span><span class="hljs-tag">&gt;</span></span>▾<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> } items={[ {contents: 'Download', onSelect: () =&gt; alert('Download')}, {contents: 'Create a Copy', onSelect: () =&gt; alert('Create a Copy')}, {contents: 'Delete', onSelect: () =&gt; alert('Delete')}, ]} /&gt; ) }</code> </pre> <br><p>  Dies ermöglicht es uns, viele Dinge in den Menüpunkten zu konfigurieren.  Was aber, wenn wir vor dem Menüpunkt Löschen eine Zeile einfügen wollen?  Sollten wir Objekten, die sich auf Gegenstände beziehen, eine spezielle Option hinzufügen?  Nun, ich weiß es nicht, zum Beispiel: <code>precedeWithLine</code> ?  So lala Idee. </p><br><p>  Erstellen Sie möglicherweise einen speziellen Menüeintrag, z. B. <code>{contents: &lt;hr /&gt;}</code> .  Ich denke, es würde funktionieren, aber dann müssten wir Fälle behandeln, in denen es kein <code>onSelect</code> .  Und um ehrlich zu sein, ist dies eine sehr umständliche API. </p><br><p>  Wenn Sie überlegen, wie Sie eine gute API für Benutzer erstellen, die versuchen, etwas anderes zu tun, anstatt nach der <code>if</code> Anweisung zu greifen, versuchen Sie, das Steuerelement zu invertieren.  Was ist, wenn wir die Verantwortung für die Menüvisualisierung auf den Benutzer übertragen?  Wir nutzen eine der Stärken der Reaktion: </p><br><pre> <code class="xml hljs">function App() { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuButton</span></span></span><span class="hljs-tag">&gt;</span></span> Actions <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span><span class="hljs-tag">&gt;</span></span>▾<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuButton</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Download')}&gt;Download<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Copy')}&gt;Create a Copy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Delete')}&gt;Delete<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Ein wichtiger Punkt, auf den Sie achten sollten, ist, dass für den Benutzer kein Zustand der Komponenten sichtbar ist.  Der Status wird implizit zwischen diesen Komponenten geteilt.  Dies ist der Kernwert des Komponentenmusters.  Bei dieser Gelegenheit haben wir dem Benutzer unserer Komponenten eine gewisse Kontrolle über das Rendern gegeben. Jetzt ist das Hinzufügen einer zusätzlichen Zeile (oder etwas anderem) eine einfache und intuitive Aktion.  Keine zusätzliche Dokumentation, keine zusätzlichen Funktionen, kein zusätzlicher Code oder Tests.  Jeder gewinnt. </p><br><p>  Sie können hier mehr über dieses Muster lesen.  Vielen Dank an <a href="https://twitter.com/ryanflorence" rel="nofollow">Ryan Florence</a> , der mir das beigebracht hat. </p><br><h3 id="redyuser-sostoyaniya-state-reducer">  Zustandsreduzierer </h3><br><p>  Ich habe mir dieses Muster ausgedacht, um das Problem der Einstellung der Komponentenlogik zu lösen.  Sie können mehr über diese Situation in meinem Blog <a href="https://kentcdodds.com/blog/the-state-reducer-pattern" rel="nofollow">, The State Reducer Pattern</a> , lesen, aber der wichtigste Punkt ist, dass ich eine Such- / Autovervollständigungs- / Typ-In-Bibliothek namens <code>Downshift</code> und einer der Benutzer der Bibliothek eine Multi-Choice-Komponentenversion entwickelte Aus diesem Grund wollte er, dass das Menü auch nach Auswahl eines Elements geöffnet bleibt. </p><br><p>  Die Logik hinter dem <code>Downshift</code> schlug vor, dass das Menü geschlossen werden sollte, nachdem die Auswahl getroffen wurde.  Ein Bibliotheksbenutzer, der seine Funktionalität ändern musste, schlug vor, prop <code>closeOnSelection</code> .  Ich lehnte dieses Angebot ab, da ich den Weg zum <a href="https://twitter.com/gurlcode/status/1002110517094371328" rel="nofollow">Propalaps</a> bereits gegangen war und es vermeiden wollte. </p><br><p>  Stattdessen habe ich die API so gestaltet, dass Benutzer selbst steuern können, wie Statusänderungen auftreten.  Stellen Sie sich die Statusreduzierung als den Status einer Funktion vor, die jedes Mal aufgerufen wird, wenn sich der Status der Komponente ändert, und dem Anwendungsentwickler die Möglichkeit gibt, die bevorstehende Statusänderung zu beeinflussen. </p><br><p>  Ein Beispiel für die Verwendung der <code>Downshift</code> Bibliothek, damit das Menü nicht geschlossen wird, nachdem der Benutzer auf das ausgewählte Element geklickt hat: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, changes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (changes.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Downshift.stateChangeTypes.keyDownEnter: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Downshift.stateChangeTypes.clickItem: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...changes, <span class="hljs-comment"><span class="hljs-comment">//     Downshift   //       isOpen  highlightedIndex //      isOpen: state.isOpen, highlightedIndex: state.highlightedIndex, } default: return changes } } // ,   // &lt;Downshift stateReducer={stateReducer} {...restOfTheProps} /&gt;</span></span></code> </pre> <br><p>  Nachdem wir diese Requisite hinzugefügt hatten, erhielten wir VIEL weniger Anfragen zum Hinzufügen neuer Einstellungen für diese Komponente.  Die Komponente ist flexibler geworden und es ist für Entwickler einfacher geworden, sie nach Bedarf zu konfigurieren. </p><br><h3 id="render-propsy-render-props">  Requisiten rendern </h3><br><p>  Erwähnenswert ist das Muster <a href="https://reactjs.org/docs/render-props.html" rel="nofollow">"Render Requisiten"</a> .  Dieses Muster ist ein ideales Beispiel für die Verwendung der Umkehrung der Kontrolle, aber wir brauchen es insbesondere nicht.  Lesen Sie hier mehr darüber: <a href="https://kentcdodds.com/blog/react-hooks-whats-going-to-happen-to-render-props" rel="nofollow">Warum brauchen wir nicht mehr so ​​viele Render-Requisiten?</a> </p><br><h2 id="preduprezhdenie">  Warnung </h2><br><p>  Die Umkehrung der Kontrolle ist eine großartige Möglichkeit, um das Problem der falschen Vorstellung darüber, wie Ihr Code in Zukunft verwendet wird, zu umgehen.  Aber bevor ich fertig bin, möchte ich dir einen Rat geben. </p><br><p>  Kommen wir zu unserem weit hergeholten Beispiel zurück: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (element !== null &amp;&amp; element !== undefined) { newArray[newArray.length] = element } } return newArray } // : filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', '']</span></span></code> </pre><br><p>  Was ist, wenn dies alles ist, was wir von der <code>filter</code> benötigen?  Und wir waren nie mit einer Situation konfrontiert, in der wir irgendetwas außer <code>null</code> und <code>undefined</code> filtern mussten?  In diesem Fall würde das Hinzufügen einer Steuerelementinversion für einen einzelnen Anwendungsfall den Code einfach komplizieren und nicht viel Nutzen bringen. </p><br><p>  Wenden Sie wie bei jeder Abstraktion das Prinzip der <a href="https://kentcdodds.com/blog/aha-programming" rel="nofollow">AHA-Programmierung an</a> und vermeiden Sie voreilige Abstraktionen! </p><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>  Ich hoffe, der Artikel hat Ihnen weitergeholfen.  Ich habe gezeigt, wie Sie das Konzept der Kontrollinversion in einer Reaktion anwenden können.  Dieses Konzept gilt natürlich nicht nur für React (wie wir mit der <code>filter</code> ).  <code>if</code> Sie das nächste Mal feststellen, dass Sie der <code>coreBusinessLogic</code> Funktion Ihrer Anwendung eine weitere <code>if</code> hinzufügen, <code>coreBusinessLogic</code> Sie, wie Sie das Steuerelement invertieren und die Logik dahin übertragen können, wo sie verwendet wird Sonderfall). </p><br><p>  Wenn Sie möchten, können Sie mit einem Beispiel aus einem Artikel in <a href="https://codesandbox.io/s/inversion-of-control-qunm8%3Ffontsize%3D14%26hidenavigation%3D1%26theme%3Ddark" rel="nofollow">CodeSandbox spielen</a> . </p><br><p>  Viel Glück und vielen Dank für Ihre Aufmerksamkeit! </p><br><p>  PS.  Wenn dir dieser Artikel gefallen hat, könnte dir dieser Vortrag <a href="https://youtu.be/AiJ8tRRH0f8" rel="nofollow">gefallen</a> : <a href="https://youtu.be/AiJ8tRRH0f8" rel="nofollow">youtube Kent C Dodds - Simply React</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485012/">https://habr.com/ru/post/de485012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485000/index.html">Ist der US-Verkehr teuer oder nicht?</a></li>
<li><a href="../de485002/index.html">Flattern BloC-Muster + Provider + Tests + erinnere mich an den Zustand</a></li>
<li><a href="../de485006/index.html">Buch (des Seins?). Reflexionen über die Natur des Geistes. Teil II</a></li>
<li><a href="../de485008/index.html">Schnelle Eigenschaftenverpackungen</a></li>
<li><a href="../de485010/index.html">Weine nicht, Mädchen! Antwort an den Autor mit vc.ru auf den Brief über Habré</a></li>
<li><a href="../de485014/index.html">Soll ich mich über Interviews beschweren?</a></li>
<li><a href="../de485016/index.html">Verwaltete Datenbanken bei Selectel: Willkommen bei Beta</a></li>
<li><a href="../de485018/index.html">Schreiben von Shadern mit Code in Unity LWRP</a></li>
<li><a href="../de485022/index.html">Playme Sigma: Funktioneller und erschwinglicher DVR</a></li>
<li><a href="../de485024/index.html">Was verbirgt sich hinter den Optimierungen des GraalVM-Compilers?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>