<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕵🏾 🚒 🗯️ تتحلل UICollectionViewCell 👩‍👧‍👦 ↙️ ♠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="بعد مشاهدة Keynote WWDC 2019 والتعرف على SwiftUI ، المصمم لوصف UIs التعريفي في التعليمات البرمجية ، أريد التكهن حول كيفية ملء اللوحات والمجموعات بشكل ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تتحلل UICollectionViewCell</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455421/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  بعد مشاهدة Keynote WWDC 2019 والتعرف على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SwiftUI</a> ، المصمم لوصف <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">UIs</a> التعريفي في التعليمات البرمجية ، أريد التكهن حول كيفية ملء اللوحات والمجموعات بشكل مُعلن.  على سبيل المثال ، مثل هذا: </p><br><pre style=";text-align:right;direction:rtl"><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(objects: Objects)</span></span></span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Widget</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> header = [ <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">25</span></span>).widget, <span class="hljs-type"><span class="hljs-type">Header</span></span>(string: <span class="hljs-string"><span class="hljs-string">" "</span></span>).widget, <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">10</span></span>, separator: .bottom).widget ] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = objects .flatMap({ (object: <span class="hljs-type"><span class="hljs-type">Object</span></span>) -&gt; [<span class="hljs-type"><span class="hljs-type">Widgets</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-type"><span class="hljs-type">Title</span></span>(object: object).widget, <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">1</span></span>, separator: .bottom).widget ] }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> header + body } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> objects: [<span class="hljs-type"><span class="hljs-type">Object</span></span>] = ... <span class="hljs-type"><span class="hljs-type">Builder</span></span> .widgets(objects: objects) .bind(to: collectionView)</code> </pre> <br><p style=";text-align:right;direction:rtl">  في المجموعة ، يتم تقديم هذا على النحو التالي: <a name="habracut"></a></p><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/el/r0/bp/elr0bpuqgbgcm5unfprets9_woc.png" alt="صورة"></div><p></p><br><h1 id="vvedenie" style=";text-align:right;direction:rtl">  مقدمة </h1><br><p style=";text-align:right;direction:rtl">  كما تعلم من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مصادر موثوقة</a> : الغالبية العظمى من وقتهم ، يقضي مطور نظام التشغيل iOS التقليدي العمل مع الأجهزة اللوحية.  إذا افترضنا أن المطورين في المشروع يفتقرون إلى حد كبير وأن الأجهزة اللوحية ليست بسيطة ، فلا يوجد أي وقت لبقية التطبيق.  وهناك شيء يجب القيام به مع هذا ... والحل المحتمل هو تحلل الخلايا. </p><br><p style=";text-align:right;direction:rtl">  تحلل الخلية يعني استبدال خلية واحدة بعدة خلايا أصغر.  مع هذا الاستبدال ، لا شيء بصريا يجب أن يتغير.  على سبيل المثال ، ضع في الاعتبار المنشورات من موجز أخبار VK لنظام التشغيل iOS.  يمكن تقديم منشور واحد كخلية واحدة ، أو كمجموعة من الخلايا - <strong>بدائية</strong> . </p><br><p style=";text-align:right;direction:rtl">  الخلايا المتحللة لن تعمل دائما.  سيكون من الصعب تقسيم الخلية إلى بدائل لها ظل أو تقريب من جميع الجوانب.  في هذه الحالة ، ستكون الخلية الأصلية بدائية. </p><br><h1 id="plyusy-i-minusy" style=";text-align:right;direction:rtl">  إيجابيات وسلبيات </h1><br><p style=";text-align:right;direction:rtl">  باستخدام تحلل الخلايا ، تبدأ الجداول / المجموعات في تكوين بدائل يتم إعادة استخدامها غالبًا: بدائية بنص ، بدائية مع صورة ، بدائية بخلفية ، إلخ.  حساب ارتفاع بدائية واحدة أبسط بكثير وأكثر فعالية من خلية معقدة مع عدد كبير من الحالات.  إذا رغبت في ذلك ، يمكن حساب الارتفاع الديناميكي <code>CTFramesetter</code> أو حتى رسمه في الخلفية (على سبيل المثال ، النص عبر <code>CTFramesetter</code> ). </p><br><p style=";text-align:right;direction:rtl">  من ناحية أخرى ، يصبح العمل مع البيانات أكثر تعقيدًا.  ستكون البيانات مطلوبة لكل بدائي ، ووفقًا لـ <code>IndexPath</code> ، سيكون من الصعب تحديد الخلية الحقيقية التي تنتمي إليها.  سيتعين علينا تقديم طبقات جديدة من التجريد أو حل هذه المشكلات بطريقة أو بأخرى. </p><br><p style=";text-align:right;direction:rtl">  يمكنك التحدث لفترة طويلة عن إيجابيات وسلبيات هذا المشروع ، لكن من الأفضل محاولة وصف طريقة تحلل الخلايا. </p><br><h1 id="vybiraem-instrumenty" style=";text-align:right;direction:rtl">  اختيار الأدوات </h1><br><p style=";text-align:right;direction:rtl">  نظرًا لأن <code>UITableView</code> محدود في قدراته ، وكما ذكرنا سابقًا ، لدينا لوحات معقدة إلى حد ما ، فإن الحل المناسب هو استخدام <code>UICollectionView</code> .  إنه حول <code>UICollectionView</code> الذي سيتم مناقشته في هذا المنشور. </p><br><p style=";text-align:right;direction:rtl">  باستخدام <code>UICollectionView</code> تواجه موقفًا حيث لا يمكن أن تشكل قاعدة <code>UICollectionViewFlowLayout</code> الأساسية الترتيب المطلوب لعناصر المجموعة (لا نأخذ بعين الاعتبار <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>UICollectionViewCompositionalLayout</code></a> الجديد).  في مثل هذه اللحظات ، يتم اتخاذ القرار عادة للعثور على بعض المصادر المفتوحة المصدر <code>UICollectionViewLayout</code> .  ولكن حتى بين الحلول الجاهزة ، قد لا يكون هناك حل مناسب ، على سبيل المثال ، في حالة الصفحة الرئيسية الديناميكية لمتجر كبير عبر الإنترنت أو شبكة اجتماعية.  نحن نفترض الأسوأ ، لذلك <code>UICollectionViewLayout</code> العالمي الخاص <code>UICollectionViewLayout</code> . </p><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى صعوبة اختيار تخطيط ، يجب أن تقرر كيف ستتلقى المجموعة البيانات.  بالإضافة إلى الطريقة المعتادة ، حيث يتوافق كائن (غالبًا <code>UICollectionViewDataSource</code> ) مع بروتوكول <code>UICollectionViewDataSource</code> ويوفر بيانات لمجموعة ، فإن استخدام الأطر التي تعتمد على البيانات يكتسب شعبية.  الممثلون <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الساطعون</a> لهذا النهج هم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CollectionKit</a> و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IGListKit</a> و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RxDataSources</a> وغيرها.  استخدام هذه الأُطُر يبسط العمل مع المجموعات ويوفر القدرة على تحريك تغييرات البيانات ، لأن  خوارزمية الفرق موجودة بالفعل في الإطار.  لأغراض النشر ، سيتم اختيار إطار عمل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RxDataSources</a> . </p><br><h1 id="vidzhet-i-ego-svoystva" style=";text-align:right;direction:rtl">  القطعة وخصائصها </h1><br><p style=";text-align:right;direction:rtl">  نقدم بنية بيانات وسيطة نسميها <strong>عنصر واجهة مستخدم</strong> .  نحن نصف الخصائص الرئيسية التي يجب أن تحتوي عليها القطعة: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يجب أن تمتثل الأداة المصغّرة للبروتوكولات اللازمة لاستخدام إطار العمل المستند إلى البيانات.  تحتوي هذه البروتوكولات عادةً على قيمة مرتبطة (مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>IdentifiableType</code></a> في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RxDataSources</a> ) </li><li style=";text-align:right;direction:rtl">  يجب أن يكون من الممكن تجميع عناصر واجهة تعامل المستخدم للبدائل المختلفة في صفيف.  لتحقيق ذلك ، لا ينبغي أن يكون عنصر واجهة المستخدم القيم المرتبطة.  لهذه الأغراض ، يمكنك استخدام آلية محو الكتابة أو شيء من هذا القبيل. </li><li style=";text-align:right;direction:rtl">  يجب أن تكون القطعة قادرة على حساب حجم البدائية.  بعد ذلك ، عند تكوين <code>UICollectionViewLayout</code> ، يبقى فقط وضع الأولويات بشكل صحيح وفقًا للقواعد المحددة مسبقًا. </li><li style=";text-align:right;direction:rtl">  يجب أن تكون القطعة هي مصنع <code>UICollectionViewCell</code> .  لذلك ، من تطبيق <code>UICollectionViewDataSource</code> كل منطق إنشاء الخلايا وكل ما تبقى هو: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">let cell = widget.widgetCell(collectionView: collectionView, indexPath: indexPath) return cell</code> </pre> </li></ol><br><h1 id="realizaciya-vidzheta" style=";text-align:right;direction:rtl">  تطبيق القطعة </h1><br><p style=";text-align:right;direction:rtl">  لكي تتمكن من استخدام عنصر واجهة المستخدم باستخدام إطار عمل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RxDataSources</a> ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يجب أن تلتزم</a> <code>Equatable</code> و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>IdentifiableType</code></a> .  نظرًا لأن عنصر واجهة المستخدم يمثل بدائية ، فسوف يكون كافياً لأغراض النشر إذا كانت القطعة تعرف نفسها على الامتثال لبروتوكول <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>IdentifiableType</code></a> .  في الممارسة العملية ، سيؤثر هذا على حقيقة أنه عندما تتغير الأداة ، لن يتم إعادة تحميل البدائية ، ولكن سيتم حذفها وإدراجها.  للقيام بذلك ، قدم بروتوكول <code>WidgetIdentifiable</code> الجديد: </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IdentifiableType</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identity: <span class="hljs-type"><span class="hljs-type">Self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  لتتوافق مع <code>WidgetIdentifiable</code> ، تحتاج القطعة إلى الامتثال لبروتوكول <code>Hashable</code> .  سوف تأخذ القطعة <code>Hashable</code> بيانات للتوافق مع البروتوكول من الكائن الذي سيصف بدائية معينة.  يمكنك استخدام <code>AnyHashable</code> "لمسح" عنصر واجهة مستخدم نوع الكائن. </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> underlying: <span class="hljs-type"><span class="hljs-type">AnyHashable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> underlying: <span class="hljs-type"><span class="hljs-type">AnyHashable</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying = underlying } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying.hash(into: &amp;hasher) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> ==</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: Widget, rhs: Widget)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.underlying == rhs.underlying } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  في هذه المرحلة ، يتم تنفيذ أول اثنين من خصائص عنصر واجهة المستخدم.  ليس من الصعب التحقق من ذلك عن طريق جمع عدة عناصر واجهة مستخدم مع أنواع مختلفة من الكائنات في صفيف. </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> widgets = [<span class="hljs-type"><span class="hljs-type">Widget</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>), <span class="hljs-type"><span class="hljs-type">Widget</span></span>(<span class="hljs-number"><span class="hljs-number">100500</span></span>)]</code> </pre> <br><p style=";text-align:right;direction:rtl">  لتنفيذ الخصائص المتبقية ، نقدم بروتوكول جديد <code>WidgetPresentable</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  سيتم استخدام الدالة <code>widgetSize(containerWidth:)</code> في <code>UICollectionViewLayout</code> عند إنشاء سمات الخلايا ، و <code>widgetCell(collectionView:indexPath:)</code> - للحصول على الخلايا. </p><br><p style=";text-align:right;direction:rtl">  إذا كان عنصر واجهة المستخدم <code>WidgetPresentable</code> بروتوكول <code>WidgetPresentable</code> ، فسوف تفي عنصر واجهة المستخدم بجميع الخصائص المشار إليها في بداية المنشور.  ومع ذلك ، فإن الكائن الموجود في عنصر واجهة المستخدم AnyHashable سيتعين استبداله بتكوين <code>WidgetPresentable</code> و <code>WidgetHashable</code> ، حيث لن يكون لـ <code>WidgetHashable</code> قيمة مرتبطة (كما في حالة <code>Hashable</code> ) <code>Hashable</code> نوع الكائن داخل عنصر واجهة المستخدم "محوها": </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetHashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  في الإصدار النهائي ، ستبدو الأداة كما يلي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> underlying: <span class="hljs-type"><span class="hljs-type">WidgetHashable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">WidgetPresentable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> underlying: <span class="hljs-type"><span class="hljs-type">WidgetHashable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">WidgetPresentable</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying = underlying } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying.widgetHash(into: &amp;hasher) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> ==</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: Widget, rhs: Widget)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.underlying.widgetEqual(rhs.underlying) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> underlying.widgetCell(collectionView: collectionView, indexPath: indexPath) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> underlying.widgetSize(containerWidth: containerWidth) } }</code> </pre> <br><h1 id="obekt-primitiva" style=";text-align:right;direction:rtl">  كائن بدائي </h1><br><p style=";text-align:right;direction:rtl">  دعونا نحاول تجميع أبسط البدائية ، والتي ستكون المسافة البادئة لارتفاع معين. </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpacingView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constraint = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.heightAnchor.constraint(equalToConstant: <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(frame: .zero) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.constraint.isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetHashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> spacing = any <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Spacing</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == spacing } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.hash(into: &amp;hasher) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">WidgetCell</span></span>&lt;<span class="hljs-type"><span class="hljs-type">SpacingView</span></span>&gt; = collectionView.cellDequeueSafely(indexPath: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell.view == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { cell.view = <span class="hljs-type"><span class="hljs-type">SpacingView</span></span>() } cell.view?.constraint.constant = height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">CGSize</span></span>(width: containerWidth, height: height) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>WidgetCell&lt;T&gt;</code> هو مجرد فئة فرعية من <code>UICollectionViewCell</code> التي تقبل <code>UIView</code> <code>UICollectionViewCell</code> كطريقة عرض فرعية.  <code>cellDequeueSafely(indexPath:)</code> هي وظيفة تسجل خلية في مجموعة قبل إعادة استخدامها إذا لم يتم تسجيل خلية في المجموعة من قبل.  سيتم استخدام <code>Spacing</code> كما هو موضح في بداية المنشور. </p><br><p style=";text-align:right;direction:rtl">  بعد تلقي صفيف عناصر واجهة المستخدم ، يبقى فقط الربط بـ <code>observerWidgets</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">DataSource</span></span> = <span class="hljs-type"><span class="hljs-type">RxCollectionViewSectionedAnimatedDataSource</span></span>&lt;<span class="hljs-type"><span class="hljs-type">WidgetSection</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSource: <span class="hljs-type"><span class="hljs-type">DataSource</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.makeDataSource() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observerWidgets: (<span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Widgets</span></span>&gt;) -&gt; <span class="hljs-type"><span class="hljs-type">Disposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collectionView.rx.items(dataSource: dataSource) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeDataSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DataSource</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">DataSource</span></span>(configureCell: { (<span class="hljs-number"><span class="hljs-number">_</span></span>, collectionView: <span class="hljs-type"><span class="hljs-type">UICollectionView</span></span>, indexPath: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>, widget: <span class="hljs-type"><span class="hljs-type">Widget</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = widget.widgetCell(collectionView: collectionView, indexPath: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }) } }</code> </pre> <br><h1 id="rezultaty" style=";text-align:right;direction:rtl">  النتائج </h1><br><p style=";text-align:right;direction:rtl">  في الختام ، أود أن أعرض العمل الحقيقي للمجموعة ، والتي بنيت بالكامل على الحاجيات. </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_t/od/tz/_todtzto-dqfqf1nwto9pik694c.gif" alt="صورة"></div><br><p style=";text-align:right;direction:rtl">  كما ترون ، فإن تحلل <code>UICollectionViewCell</code> ممكن وفي الحالات المناسبة يمكن أن تبسط حياة المطور. </p><br><h1 id="zamechaniya" style=";text-align:right;direction:rtl">  تصريحات </h1><br><p style=";text-align:right;direction:rtl">  الكود الوارد في المنشور مبسط للغاية ويجب عدم تجميعه.  كان الهدف هو وصف النهج ، وليس توفير حل جاهز. </p><br><p style=";text-align:right;direction:rtl">  يمكن توسيع بروتوكول <code>WidgetPresentable</code> بوظائف أخرى تعمل على تحسين التخطيط ، على سبيل المثال ، <code>widgetSizeEstimated(containerWidth:)</code> أو <code>widgetSizePredefined(containerWidth:)</code> ، والتي تُرجع الحجم المقدر والثابت ، على التوالي.  تجدر الإشارة إلى أن الدالة <code>widgetSize(containerWidth:)</code> يجب أن ترجع حجم البدائية حتى للحسابات المطلوبة ، على سبيل المثال ، <code>systemLayoutSizeFitting(_:)</code> .  يمكن تخزين هذه الحسابات مؤقتًا من خلال <code>Dictionary</code> و <code>NSCache</code> وما إلى ذلك. </p><br><p style=";text-align:right;direction:rtl">  كما تعلم ، يجب أن تكون جميع أنواع الخلايا التي يستخدمها <code>UICollectionView</code> مسجلة مسبقًا في المجموعة.  ومع ذلك ، لإعادة استخدام التطبيقات المصغّرة بين الشاشات / المجموعات المختلفة وعدم تسجيل جميع معرفات / أنواع الخلايا مقدمًا ، تحتاج إلى الحصول على آلية تسجل خلية قبل استخدامها لأول مرة مباشرةً في كل مجموعة.  في المنشور ، <code>cellDequeueSafely(indexPath:)</code> استخدام <code>cellDequeueSafely(indexPath:)</code> الدالة <code>cellDequeueSafely(indexPath:)</code> لهذا الغرض. </p><br><p style=";text-align:right;direction:rtl">  لا يمكن أن يكون هناك رؤوس أو تذييلات في المجموعة.  في مكانها سوف تكون بدائية.  وجود تكميلية في المجموعة لن يعطي أي مكافآت خاصة في النهج الحالي.  عادةً ما يتم استخدامها عندما يتوافق صفيف البيانات تمامًا مع عدد الخلايا ويكون مطلوبًا إظهار طرق عرض إضافية قبل الخلايا أو بعدها أو فيما بينها.  في حالتنا ، يمكن أيضًا إضافة بيانات طرق العرض الإضافية إلى مجموعة عناصر واجهة المستخدم ورسمها كأولويات. </p><br><p style=";text-align:right;direction:rtl">  داخل نفس المجموعة ، يمكن تحديد موقع عناصر واجهة التعامل مع نفس العناصر.  على سبيل المثال ، <code>Spacing</code> نفسه في بداية ونهاية المجموعة.  سيؤدي وجود هذه الكائنات غير الفريدة إلى اختفاء الرسوم المتحركة في المجموعة.  لجعل مثل هذه الكائنات فريدة من نوعها ، يمكنك استخدام علامات <code>AnyHashable</code> خاصة و <code>AnyHashable</code> <code>#file</code> و <code>#line</code> حيث تم إنشاء الكائن ، إلخ. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar455421/">https://habr.com/ru/post/ar455421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar455407/index.html">السيارات الكهربائية وأعلى مبيعات سيارات الوقود</a></li>
<li><a href="../ar455409/index.html">التوافق الخلفي</a></li>
<li><a href="../ar455411/index.html">أجرى Megaphone تحديثًا فنيًا ... أسماء الشبكات</a></li>
<li><a href="../ar455413/index.html">تحويل الجيب إلى تغذية الأخبار</a></li>
<li><a href="../ar455419/index.html">آبل بيتا على قيد الحياة: التوافه لم يكشف في العرض</a></li>
<li><a href="../ar455425/index.html">إنشاء نفق IPSec GRE بين Mikrotik hEX S و Juniper SRX عبر مودم USB</a></li>
<li><a href="../ar455427/index.html">كيفية تعلمنا للتنبؤ بطلب أحد المستخدمين وتسريع تحميل نتائج البحث</a></li>
<li><a href="../ar455429/index.html">كيف حصلت على الموت سوبر نينتندو</a></li>
<li><a href="../ar455439/index.html">تسمح لك الخوارزمية الجديدة التي أنشأها العلماء بإنشاء "رؤوس حديث" تكاد تكون مثالية مع أشخاص حقيقيين</a></li>
<li><a href="../ar455441/index.html">21 يونيو ، موسكو ، العمل - تحليلات MeetUp # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>