<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯеЗ ЁЯЫ╖ ЁЯСитАНЁЯСж рд╣рдЬрд╛рд░реЛрдВ рдЖрднрд╛рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЗ рд╕рд╛рде рдПрдХ рдЦреЗрд▓ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рд▓реЛрдб рдХрд░реЗрдВ ЁЯСОЁЯП╗ ЁЯСйЁЯП╜тАНЁЯН│ ЁЯЦРЁЯП╜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрдХрд╛рд░, рд╣реЗрдмреНрд░! 

 рдореИрдВ рдПрдХ рдЧреЗрдорд┐рдВрдЧ рдХрдВрдкрдиреА рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдВ рдЬреЛ рдСрдирд▓рд╛рдЗрди рдЧреЗрдо рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреА рд╣реИред рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рд╣рдорд╛рд░реЗ рд╕рднреА рдЦреЗрд▓реЛрдВ рдХреЛ рдХрдИ "рдмрд╛рдЬрд╛рд░реЛрдВ" (рдПрдХ "рдмрд╛рдЬрд╛рд░" рдкреНрд░рдд...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╣рдЬрд╛рд░реЛрдВ рдЖрднрд╛рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЗ рд╕рд╛рде рдПрдХ рдЦреЗрд▓ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рд▓реЛрдб рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445368/">  рдирдорд╕реНрдХрд╛рд░, рд╣реЗрдмреНрд░! <br><br>  рдореИрдВ рдПрдХ рдЧреЗрдорд┐рдВрдЧ рдХрдВрдкрдиреА рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдВ рдЬреЛ рдСрдирд▓рд╛рдЗрди рдЧреЗрдо рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреА рд╣реИред  рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рд╣рдорд╛рд░реЗ рд╕рднреА рдЦреЗрд▓реЛрдВ рдХреЛ рдХрдИ "рдмрд╛рдЬрд╛рд░реЛрдВ" (рдПрдХ "рдмрд╛рдЬрд╛рд░" рдкреНрд░рддрд┐ рджреЗрд╢) рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ "рдмрд╛рдЬрд╛рд░" рдореЗрдВ рдПрдХ рджрд░реНрдЬрди рджреБрдирд┐рдпрд╛ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдмреАрдЪ рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЛ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ, рдпрд╛ рдХрднреА-рдХрднреА рд╡реЗ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ)ред  рдкреНрд░рддреНрдпреЗрдХ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╡реЗрдм / рдРрдк рд╕рд░реНрд╡рд░ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд▓реЛрдб рдХреЛ рджреБрдирд┐рдпрд╛ рднрд░ рдореЗрдВ / рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд▓рдЧрднрдЧ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдФрд░ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдореЗрдВ рдЕрдзрд┐рдХрддрдо 6K-8K рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ (рдпрд╣ рдЕрдзрд┐рдХрддрдо рд╣реИ, рдЕрдзрд┐рдХрддрд░ рдХрдИ рдмрд╛рд░ рдХрдо) рдФрд░ 200-300 рдЕрдиреБрд░реЛрдз рдкреНрд░рддрд┐ рджреБрдирд┐рдпрд╛ рдкреНрд░рддрд┐ рдкреНрд░рд╛рдЗрдо рдЯрд╛рдЗрдо рдорд┐рд▓рддрд╛ рд╣реИред <br><br>  рдмрд╛рдЬрд╛рд░реЛрдВ рдФрд░ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╕рд╛рде рдРрд╕реА рд╕рдВрд░рдЪрдирд╛ рдЕрдкреНрд░рдЪрд▓рд┐рдд рд╣реЛ рд░рд╣реА рд╣реИ, рдЦрд┐рд▓рд╛рдбрд╝реА рдХреБрдЫ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдкрд┐рдЫрд▓реЗ рдЦреЗрд▓реЛрдВ рдореЗрдВ, рд╣рдо рд▓реЛрдЧреЛрдВ рдХреЛ рджреЗрд╢ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдХреЗрд╡рд▓ рдПрдХ / рджреЛ рдмрд╛рдЬрд╛рд░реЛрдВ (рдЕрдореЗрд░рд┐рдХрд╛ рдФрд░ рдпреВрд░реЛрдк) рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ рдХрдИ рджреБрдирд┐рдпрд╛ рдХреЗ рд╕рд╛рдеред  рдЕрдЧрд▓рд╛ рдХрджрдо рдирдИ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рд╕рд╛рде рдЦреЗрд▓реЛрдВ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдФрд░ <b>рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕</b> рдореЗрдВ рдПрдХ рд╣реА рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕рднреА рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рдПрдХреАрдХрд░рдг рдХрд╛ рд╣реЛрдЧрд╛ред <br><br>  рдЖрдЬ рдореИрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝реА рд╕реА рдмрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ рдХрд┐ рдореБрдЭреЗ рдХреИрд╕реЗ рдЪреЗрдХ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рдо рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рдерд╛ рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдСрдирд▓рд╛рдЗрди рдЧреЗрдореЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ (рдЕрдЧрд░ рдпрд╣ 50-200 рд╣рдЬрд╛рд░ рдпреВрдЬрд░реНрд╕ рд╣реИрдВ рддреЛ) рдирдП рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдЕрдЧрд▓рд╛ рдЧреЗрдо рдЦреЗрд▓рдиреЗ рдХреЗ рд▓рд┐рдП "рднреЗрдЬреЗрдВ"ред рдкреВрд░реА рдкреНрд░рдгрд╛рд▓реА, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ ( <b>PostgreSQL 11</b> ) рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдЗрд╕ рддрд░рд╣ рдХреЗ рднрд╛рд░ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░, рдЕрдЧрд░ рдпрд╣ рдирд╣реАрдВ рдкрддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░рд╛ рдЕрдзрд┐рдХрддрдо рдХрд╣рд╛рдВ рд╣реИред  рдореИрдВ рдЖрдкрдХреЛ рдЙрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рдмрддрд╛рдКрдВрдЧрд╛ рдЬреЛ рдЗрддрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ, рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рд╛ред <br><a name="habracut"></a><br><h2>  рдкрд╣рдЪрд╛рди </h2><br>  рдЕрддреАрдд рдореЗрдВ, <b>InnoGames GmbH рдореЗрдВ,</b> рдкреНрд░рддреНрдпреЗрдХ рдЧреЗрдо рдЯреАрдо рдиреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реНрд╡рд╛рджреЛрдВ, рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдУрдВ рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдЕрдХреНрд╕рд░ рдЕрдкрдиреЗ рд╕реНрд╡рд╛рдж рдФрд░ рд░рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреЗрдо рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдпрд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рднреБрдЧрддрд╛рди рдХреЗ рд▓рд┐рдП рдХрдИ рдмрд╛рд╣рд░реА рд╕рд┐рд╕реНрдЯрдо рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ, рдЬреЛ рдкреБрд╢ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди, рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рднреЗрдЬрддреЗ рд╣реИрдВред  рдЗрди рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдбреЗрд╡рд▓рдкрд░реНрд╕ рдиреЗ рдЕрдкрдиреЗ рдЕрдиреВрдареЗ рдЗрдВрдЯрд░рдлреЗрд╕ рднреА рдмрдирд╛рдП рдЬреЛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реЛред <br><br>  рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдореЛрдмрд╛рдЗрд▓ рдЧреЗрдорд┐рдВрдЧ рд╡реНрдпрд╡рд╕рд╛рдп рдореЗрдВ рдмрд╣реБрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреИрд╕рд╛ рд╣реИ</a> рдФрд░, рддрджрдиреБрд╕рд╛рд░, рдмрд╣реБрдд рд╕рд╛рд░реА рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ред  рдпрд╣рд╛рдВ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдкрд░ рдЦрд░реНрдЪ рдХрд┐рдП рдЧрдП рдкреНрд░рддреНрдпреЗрдХ рдбреЙрд▓рд░ рдФрд░ рдКрдкрд░ рд╕реЗ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЗрд╕реЗ рд╡рд╛рдкрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рднреА рдЦреЗрд▓ рдХрдВрдкрдирд┐рдпрд╛рдВ рдмрд╣реБрдд рдмрд╛рд░ "рдмрдВрдж" рдЦреЗрд▓ рдмрдВрдж рдкрд░реАрдХреНрд╖рдг рдХреЗ рдЪрд░рдг рдореЗрдВ рднреА рдХрд░рддреА рд╣реИрдВ, рдЕрдЧрд░ рд╡реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рдЕрдкреЗрдХреНрд╖рд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рддрджрдиреБрд╕рд╛рд░, рдЕрдЧрд▓реЗ рдкрд╣рд┐рдпреЗ рдХреЗ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдкрд░ рд╕рдордп рдЦреЛрдирд╛ рд▓рд╛рднрд╣реАрди рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХ рдПрдХреАрдХреГрдд рдордВрдЪ рдмрдирд╛рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рд╕рднреА рдмрд╛рд╣рд░реА рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рди, рдкреНрд░рддрд┐рдХреГрддрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рд╕рднреА рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдКрдкрд░ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЦреЗрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ рд╣реИ рдФрд░ рдЦреЗрд▓ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ рд╡рд┐рдХрд╛рд╕ рдкрд░ рд╕рдордп рдмрд░реНрдмрд╛рдж рдХрд░рдирд╛ рд╣реИред <br><br>  рдЗрд╕ рдордВрдЪ рдХреЛ <b>GameStarter</b> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/fz/go/g3/fzgog3jsz4rzjqi0zvbwzysz-po.jpeg" alt="рдЫрд╡рд┐"><br><br>  рддреЛ, рдмрд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рд╕рднреА рднрд╡рд┐рд╖реНрдп рдХреЗ рдЗрдирдУрдЧреЗрдореНрд╕ рдЧреЗрдо рдЗрд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдкрд░ рдмрдирд╛рдП рдЬрд╛рдПрдВрдЧреЗ, рдЬрд┐рд╕рдореЗрдВ рджреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИрдВ - рдорд╛рд╕реНрдЯрд░ рдФрд░ рдЧреЗрдо (рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдХреНрдпреВрдПрд▓ 11)ред  рдорд╛рд╕реНрдЯрд░ рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ (рд▓реЙрдЧрд┐рди, рдкрд╛рд╕рд╡рд░реНрдб рдЖрджрд┐) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ, рдХреЗрд╡рд▓ рдЦреЗрд▓ рдореЗрдВ рд▓реЙрдЧрд┐рди / рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рднрд╛рдЧ рд▓реЗрддрд╛ рд╣реИред  рдЦреЗрд▓ - рдЦреЗрд▓ рдХрд╛ рдбреЗрдЯрд╛рдмреЗрд╕, рдЬрд╣рд╛рдВ, рддрджрдиреБрд╕рд╛рд░, рд╕рднреА рдЧреЗрдо рдбреЗрдЯрд╛ рдФрд░ рдЗрдХрд╛рдЗрдпрд╛рдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЬреЛ рдХрд┐ рдЦреЗрд▓ рдХрд╛ рдореВрд▓ рд╣реИ, рдЬрд╣рд╛рдВ рдкреВрд░рд╛ рднрд╛рд░ рдЬрд╛рдПрдЧрд╛ред <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрд╣ рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдкреВрд░реА рд╕рдВрд░рдЪрдирд╛ рд╣рдорд╛рд░реЗ рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рдЦреЗрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрддрдо рдСрдирд▓рд╛рдЗрди рдХреЗ рдмрд░рд╛рдмрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдРрд╕реА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддреА рд╣реИред <br><br><h2>  рдХрд╛рд░реНрдп </h2><br>  рдХрд╛рд░реНрдп рд╕реНрд╡рдпрдВ рдпрд╣ рдерд╛: рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ (PostgreSQL 11), рдкреНрд░рддрд┐рдХреГрддрд┐ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде, рд╕рднреА рд▓реЛрдб рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд▓реЛрдб рдХрд┐рдП рдЧрдП рдЧреЗрдо рдореЗрдВ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдирд┐рдкрдЯрд╛рди рдореЗрдВ рдкреВрд░реЗ PowerEdge M630 рд╣рд╛рдЗрдкрд░рд╡рд╛рдЗрдЬрд░ (HV) рд╣реИрдВред <br>  рдореИрдВ рд╕реНрдкрд╖реНрдЯ рдХрд░реВрдВрдЧрд╛ рдХрд┐ рдЗрд╕ рд╕рдордп рдХрд╛рд░реНрдп <b>рдХреЗрд╡рд▓ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдерд╛</b> , рдореМрдЬреВрджрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЬрд┐рд╕реЗ рд╣рдордиреЗ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреЗ рддрд░реАрдХреЛрдВ рдФрд░ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЕрдиреБрднрд╡ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдмрдирд╛рдпрд╛ рдерд╛ред <br><br>  рдореИрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рддреБрд░рдВрдд рдХрд╣реВрдВрдЧрд╛, рдФрд░ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдиреЗ рдЦреБрдж рдХреЛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рджрд┐рдЦрд╛рдпрд╛, рдПрдХ рджреЛ рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░ред  рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд┐рд╢реЗрд╖ рдЧреЗрдо рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдЪрд░рдг рдореЗрдВ рдереА рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдЦреЗрд▓ рдпрд╛рдВрддреНрд░рд┐рдХреА рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рд╕рд╛рде, рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЕрдиреБрд░реЛрдз рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ рдФрд░ рд▓реЛрдб рд╕реНрд╡рдпрдВ рд╣реА рдХрд╛рдлреА рдмрдврд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдкреНрд░рдХреГрддрд┐ рдмрджрд▓ рд╕рдХрддреА рд╣реИред  рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдкреНрд░рддреНрдпреЗрдХ рдЕрдзрд┐рдХ рдпрд╛ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореАрд▓ рдХреЗ рдкрддреНрдерд░ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рдПред  рд╣рдЬрд╛рд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЗ рд╕рд╛рде рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдмрди рдЧрдпрд╛ рд╣реИред <br><br><h2>  рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ </h2><br>  рдХрд┐рд╕реА рднреА рд▓реЛрдб рдкрд░реАрдХреНрд╖рдг рдХреА рддрд░рд╣, рдпрд╣ рд╕рднреА рдПрдХ рд▓реЛрдб рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред <br>  рд╣рдорд╛рд░реЗ рд╕рдВрднрд╛рд╡рд┐рдд рдореВрд▓реНрдп CCU60 (CCU рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЕрд╡рдзрд┐ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ 60 рдорд┐рдирдЯ) рдХреЛ <b>250,000</b> рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА рдЖрднрд╛рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ (VU) рдХреА рд╕рдВрдЦреНрдпрд╛ CCU60 рд╕реЗ рдХрдо рд╣реИ рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХреЛрдВ рдиреЗ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рджреЛ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд░рд╛рдЙрдВрдб рдЕрдк рдФрд░ <b>150,000</b> рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА VU рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдПрдХ рд▓реЛрдб рдХрд┐рдП рдЧрдП рдЧреЗрдо рд╕реЗ рд▓реА рдЧрдИ рдереА: <br><br><img src="https://habrastorage.org/webt/lv/te/69/lvte69rifceelurn7r3t7trbgs4.png"><br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рд▓реЛрдб <b>150,000</b> VU рдкрд░ ~ <b>20,000 рдЕрдиреБрд░реЛрдз / s рд╣реИ</b> ред <br><br><h2>  рд╕рдВрд░рдЪрдирд╛ </h2><br><h3>  "рд╕реНрдЯреИрдВрдб" рдХреЗ рд▓рдХреНрд╖рдг </h3><br>  рдкрд┐рдЫрд▓реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦ рдореЗрдВ,</a> рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА рд▓реЛрдб рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреА рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХреА рдереАред  рдЖрдЧреЗ, рдореИрдВ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдереЛрдбрд╝рд╛ рджреЛрд╣рд░рд╛ рд╕рдХрддрд╛ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдореИрдВ рдЖрдкрдХреЛ рдХреБрдЫ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдКрдВрдЧрд╛ред <br><br><img src="https://habrastorage.org/webt/zh/hz/eo/zhhzeorw5_gboyuocu9ajmb3ulo.png"><br><br>  рдЖрд░реЗрдЦ рдореЗрдВ, рдиреАрд▓реЗ рд╡рд░реНрдЧ рд╣рдорд╛рд░реЗ рд╣рд╛рдЗрдкрд░рд╡рд┐рдЬрд░ (рдПрдЪрд╡реА) рд╣реИрдВ, рдПрдХ рдХреНрд▓рд╛рдЙрдб рдЬрд┐рд╕рдореЗрдВ рдХрдИ рд╕рд░реНрд╡рд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ (рдбреЗрд▓ рдПрдо 620 - рдПрдо 640)ред  рдкреНрд░рддреНрдпреЗрдХ рдПрдЪрд╡реА рдкрд░, рдПрдХ рджрд░реНрдЬрди рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди (рд╡реАрдПрдо) рдХреЗрд╡реАрдПрдо (рд╡реЗрдм тАЛтАЛ/ рдРрдк рдФрд░ рдорд┐рдХреНрд╕ рдореЗрдВ рдбреАрдмреА) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдХрд┐рд╕реА рднреА рдирдП рд╡реАрдПрдо рдХреЛ рдмрдирд╛рддреЗ рд╕рдордп, рдПрдХ рдЙрдкрдпреБрдХреНрдд рдПрдЪрд╡реА рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕реЗрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрддреБрд▓рди рдФрд░ рдЦреЛрдЬ рд╣реЛрддреА рд╣реИ рдФрд░ рдпрд╣ рд╢реБрд░реВ рдореЗрдВ рдЬреНрдЮрд╛рдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕ рд╕рд░реНрд╡рд░ рдкрд░ рд╣реЛрдЧрд╛ред <br><br><h4>  рдбреЗрдЯрд╛рдмреЗрд╕ (рдЧреЗрдо DB): </h4><br>  рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ db1 рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ M630 рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдЕрд▓рдЧ HV <b>targer_hypervisor</b> рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ред <br><br>  Targer_hypervisor рдХреА рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ: <br><br>  рдбреЗрд▓ M_630 <br>  рдореЙрдбрд▓ рдХрд╛ рдирд╛рдо: Intel┬о Xeon┬о CPU E5-2680 v3 @ 2.50GHz <br>  рд╕реАрдкреАрдпреВ (s): 48 <br>  рдкреНрд░рддрд┐ рдХреЛрд░ рдзрд╛рдЧрд╛ (рдУрдВ): 2 <br>  рдХреЛрд░ (рдПрд╕) рдкреНрд░рддрд┐ рд╕реЙрдХреЗрдЯ: 12 <br>  рд╕реЙрдХреЗрдЯ (рдУрдВ): 2 <br>  рд░реИрдо: 128 рдЬреАрдмреА <br>  рдбреЗрдмрд┐рдпрди рдЬреАрдПрдирдпреВ / рд▓рд┐рдирдХреНрд╕ 9 (рдЦрд┐рдВрдЪрд╛рд╡) <br>  4.9.0-8-amd64 # 1 рдПрд╕рдПрдордкреА рдбреЗрдмрд┐рдпрди 4.9.130-2 (2018-10-27) <br><br><div class="spoiler">  <b class="spoiler_title">рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рдирд┐рд░реНрджреЗрд╢реЛрдВ</b> <div class="spoiler_text">  рдбреЗрдмрд┐рдпрди рдЬреАрдПрдирдпреВ / рд▓рд┐рдирдХреНрд╕ 9 (рдЦрд┐рдВрдЪрд╛рд╡) <br>  4.9.0-8-amd64 # 1 рдПрд╕рдПрдордкреА рдбреЗрдмрд┐рдпрди 4.9.130-2 (2018-10-27) <br>  lscpu <br>  рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░: x86_64 <br>  CPU рдСрдк-рдореЛрдб (s): 32-рдмрд┐рдЯ, 64-рдмрд┐рдЯ <br>  рдмрд╛рдЗрдЯ рдСрд░реНрдбрд░: рд▓рд┐рдЯрд┐рд▓ рдПрдВрдбрд┐рдпрди <br>  рд╕реАрдкреАрдпреВ (s): 48 <br>  рдСрди-рд▓рд╛рдЗрди рд╕реАрдкреАрдпреВ (рдПрд╕) рд╕реВрдЪреА: 0-47 <br>  рдкреНрд░рддрд┐ рдХреЛрд░ рдзрд╛рдЧрд╛ (рдУрдВ): 2 <br>  рдХреЛрд░ (рдПрд╕) рдкреНрд░рддрд┐ рд╕реЙрдХреЗрдЯ: 12 <br>  рд╕реЙрдХреЗрдЯ (рдУрдВ): 2 <br>  NUMA рдиреЛрдб (рдУрдВ): 2 <br>  рд╡рд┐рдХреНрд░реЗрддрд╛ ID: рдЬреЗрдиреБрдЗрдирдЗрдВрдЯреЗрд▓ <br>  рд╕реАрдкреАрдпреВ рдкрд░рд┐рд╡рд╛рд░: 6 <br>  рдореЙрдбрд▓: 63 <br>  рдореЙрдбрд▓ рдХрд╛ рдирд╛рдо: Intel┬о Xeon┬о CPU E5-2680 v3 @ 2.50GHz <br>  рдХрджрдо: реи <br>  рд╕реАрдкреАрдпреВ рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ: 1309.356 <br>  рд╕реАрдкреАрдпреВ рдЕрдзрд┐рдХрддрдо рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ: 3300.0000 <br>  рд╕реАрдкреАрдпреВ рдорд┐рдирдЯ рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ: 1200.0000 <br>  BogoMIPS: 4988.42 <br>  рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди: рд╡реАрдЯреА-рдПрдХреНрд╕ <br>  L1d рдХреИрд╢: 32K <br>  L1i рдХреИрд╢: 32K <br>  L2 рдХреИрд╢: 256K <br>  L3 рдХреИрд╢: 30720K <br>  NUMA рдиреЛрдб0 рд╕реАрдкреАрдпреВ (рдУрдВ): 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,36,36,38,40,42 , 44.46 <br>  NUMA рдиреЛрдб 1 CPU (s): 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43 , 45.47 рд╣реИ <br>  рдЭрдВрдбреЗ: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse2 ss2s ht tm pbe syscall nx pdpe1gb rdtscpm рд▓рдЧрд╛рддрд╛рд░ qtmmopopopopopopopopopopop/live&amp;hl=hi рдирд┐рд░рдВрддрд░ qtmmop рдПрд╕рдПрдордПрдХреНрд╕ рд╕реНрдерд╛ TM2 SSSE3 sdbg FMA cx16 xtpr PDCM pcid рдбреАрд╕реАрдП sse4_1 sse4_2 x2apic MOVBE popcnt tsc_deadline_timer рдПрдИрдПрд╕ xsave AVX f16c rdrand lahf_lm рдПрдмреАрдПрдо рдИрдкреАрдмреА invpcid_single ssbd ibrs ibpb stibp рдХреИрд╕рд░ tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust BMI1 AVX2 smep bmi2 erms invpcid CQM xsaveopt cqm_llc cqm_occup_llc dtherm рдЗрдбрд╝рд╛ arat pln pts flush_l1d <br><br>  / usr / bin / qemu-system-x86_64 --version <br>  QEMU рдПрдореБрд▓реЗрдЯрд░ рд╕рдВрд╕реНрдХрд░рдг 2.8.1 (рдбреЗрдмрд┐рдпрди 1: 2.8 + dfsg-6 + deb9u5) <br>  рдХреЙрдкреАрд░рд╛рдЗрдЯ ┬й 2003-2016 рдлреЗрдмреНрд░рд┐рд╕ рдмреЗрд▓рд╛рд░реНрдб рдФрд░ рдХреНрдпреВрдИрдПрдордпреВ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдбреЗрд╡рд▓рдкрд░реНрд╕ <br></div></div><br>  Db1 рдХреА рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ: <br>  рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░: x86_64 <br>  рд╕реАрдкреАрдпреВ (s): 48 <br>  рд░реИрдо: 64 рдЬреАрдмреА <br>  4.9.0-8-amd64 # 1 рдПрд╕рдПрдордкреА рдбреЗрдмрд┐рдпрди 4.9.144-3.1 (2019-02-19) x86_64_U / рд▓рд┐рдирдХреНрд╕ <br>  рдбреЗрдмрд┐рдпрди рдЬреАрдПрдирдпреВ / рд▓рд┐рдирдХреНрд╕ 9 (рдЦрд┐рдВрдЪрд╛рд╡) <br>  psql (PostgreSQL) 11.2 (рдбреЗрдмрд┐рдпрди 11.2-1.pgdg90 + 1) <br><br><div class="spoiler">  <b class="spoiler_title">рдХреБрдЫ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рд╕рд╛рде PostgreSQL рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди</b> <div class="spoiler_text">  seq_page_cost = 1.0 <br>  random_page_cost = 1.1 # рд╣рдорд╛рд░реЗ рдкрд╛рд╕ SSD рд╣реИ <br>  '/etc/postgresql/11/main/extension.conf' рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ <br>  log_line_prefix = '% t [% p-% l]% q% u @% h' <br>  log_checkpoint = рдкрд░ <br>  log_lock_waits = рдкрд░ <br>  log_statement = ddl <br>  log_min_duration_statement = 100 <br>  log_temp_files = 0 <br>  autovacuum_max_workers = 5 <br>  autovacuum_naptime = 10s <br>  autovacuum_vacuum_cost_delay = 20ms <br>  рд╡реИрдХреНрдпреВрдо_рдХреЛрд╕реНрдЯ_рд▓рд┐рдорд┐рдЯ = 2000 <br>  рдореЗрдиреНрдЯреЗрдиреЗрдВрд╕_рд╡рд░реНрдХ_рдореЗрдо = 128 рдПрдордмреА <br>  synous_commit = рдмрдВрдж <br>  checkpoint_timeout = 30 рдорд┐рдирдЯ <br>  рд╕реБрди_рджрд╛рджрд░реА = '*' <br>  рд╡рд░реНрдХ_рдо = 32 рдПрдордмреА <br>  effective_cache_size = 26214MB # 50% рдЙрдкрд▓рдмреНрдз рдореЗрдореЛрд░реА <br>  share_buffers = 16384MB # 25% рдЙрдкрд▓рдмреНрдз рдореЗрдореЛрд░реА <br>  max_wal_size = 15GB <br>  min_wal_size = 80MB <br>  wal_level = hot_standby <br>  max_wal_senders = 10 <br>  wal_compression = рдкрд░ <br>  рд╕рдВрдЧреНрд░рд╣_рдореЛрдб = рдкрд░ <br>  рдЖрд░реНрдХрд╛рдЗрд╡_рдХрдорд╛рдВрдб = '/ рдмрд┐рди / рд╕рдЪ' <br>  рд╕рдВрдЧреНрд░рд╣_ рд╕рдордп = рез_режреж <br>  hot_standby = on <br>  wal_log_hints = рдкрд░ <br>  hot_standby_feedback = рдкрд░ <br></div></div><br>  <b>hot_standby_feedback</b> рдмрдВрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреВрдХ, рд╣рдордиреЗ рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд░ рджрд┐рдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВ рдПрдХ рд╕рдлрд▓ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдмрдВрдж рдХрд░рдирд╛ рдкрдбрд╝рд╛ред  рдореИрдВ рдмрд╛рдж рдореЗрдВ рд╕рдордЭрд╛рдКрдВрдЧрд╛ рдХреНрдпреЛрдВред <br><br>  рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдореБрдЦреНрдп рд╕рдХреНрд░рд┐рдп рдЯреЗрдмрд▓ (рдирд┐рд░реНрдорд╛рдг, рдЙрддреНрдкрд╛рджрди, game_entity, рдмрд┐рд▓реНрдбрд┐рдВрдЧ, core_inventory_player_resource, рдЙрддреНрддрд░рдЬреАрд╡реА) рдПрдХ рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ (рд▓рдЧрднрдЧ 80GB) рдХреЗ рд╕рд╛рде рдкрд╣рд▓реЗ рд╕реЗ рдЖрдмрд╛рдж рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">db-fill-script.sh</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash --clean TRUNCATE TABLE production CASCADE; TRUNCATE TABLE construction CASCADE; TRUNCATE TABLE building CASCADE; TRUNCATE TABLE grid CASCADE; TRUNCATE TABLE core_inventory_player_resource CASCADE; TRUNCATE TABLE survivor CASCADE; TRUNCATE TABLE city CASCADE; TRUNCATE TABLE game_entity CASCADE; TRUNCATE TABLE player CASCADE; TRUNCATE TABLE core_player CASCADE; TRUNCATE TABLE core_client_device CASCADE; --core_client_device INSERT INTO core_client_device (id, creation_date, modification_date, device_model, device_name, locale, platform, user_agent, os_type, os_version, network_type, device_type) SELECT (1000000000+generate_series(0,999999)) AS id, now(), now(), 'device model', 'device name', 'en_DK', 'ios', 'ios user agent', 'android', '8.1', 'wlan', 'browser'; --core_player INSERT INTO core_player (id, guest, name, nickname, premium_points, soft_deleted, session_id, tracking_device_data_id) SELECT (1000000000+generate_series(0,999999)) AS id, true, 'guest0000000000000000000', null, 100, false, '00000000-0000-0000-0000-000000000000', (1000000000+generate_series(0,999999)) ; --player INSERT INTO player (id, creation_date, modification_date, core_player_id) SELECT (1000000000+generate_series(0,999999)) , now(), now(), (1000000000+generate_series(0,999999)) ; --city INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1000000000+generate_series(0,999999)) , 'city', now(), now(); INSERT INTO city (id, game_design, player_id) SELECT (1000000000+generate_series(0,999999)) , 'city.default', (1000000000+generate_series(0,999999)) ; --survivor INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1001000000+generate_series(0,999999)) , 'survivor', now(), now(); INSERT INTO survivor (id, game_design, owning_entity_id, type) SELECT (1001000000+generate_series(0,999999)) , 'survivor.prod_1', (1000000000+generate_series(0,999999)) , 'survivor'; --core_inventory_player_resource INSERT INTO core_inventory_player_resource (id, creation_date, modification_date, amount, player_id, resource_key) SELECT (1000000000+generate_series(0,1999999)) , NOW(), NOW(), 1000, (1000000000+generate_series(0,1999999)/2) , CONCAT('resource_', (1000000000+generate_series(0,1999999)) % 2); --grid DROP INDEX grid_area_idx; INSERT INTO grid (id, creation_date, modification_date, area, city_id) SELECT (1000000000+generate_series(0,19999999)) , NOW(), NOW(), BOX '0,0,4,4', (1000000000+generate_series(0,19999999)/20) ; create index on grid using gist (area box_ops); --building INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1002000000+generate_series(0,99999999)) , 'building', now(), now(); INSERT INTO building (id, game_design, owning_entity_id, x, y, rotation, type) SELECT (1002000000+generate_series(0,99999999)) , 'building.building_prod_1', (1000000000+generate_series(0,99999999)/100) , 0, 0, 'DEGREES_0', 'building'; --construction INSERT INTO construction (id, creation_date, modification_date, definition, entity_id, start) SELECT (1000000000+generate_series(0,1999999)) , NOW(), NOW(), 'construction.building_prod_1-construction', (1002000000+generate_series(0,1999999)*50) , NOW(); --production INSERT INTO production (id, creation_date, modification_date, active, definition, entity_id, start_time) SELECT (1000000000+generate_series(0,49999999)) , NOW(), NOW(), true, 'production.building_prod_1_production_1', (1002000000+generate_series(0,49999999)*2) , NOW();</span></span></code> </pre> <br></div></div><br>  рдкреНрд░рддрд┐рдХреГрддрд┐: <br><br><pre> <code class="plaintext hljs">SELECT * FROM pg_stat_replication; pid | usesysid | usename | application_name | client_addr | client_hostname | client_port | backend_start | backend_xmin | state | sent_lsn | write_lsn | flush_lsn | replay_lsn | write_lag | flush_lag | replay_lag | sync_priority | sync_state -----+----------+---------+---------------------+--------------+---------------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------ 759 | 17035 | repmgr | xl1db2 | xxxx | xl1db2 | 51142 | 2019-01-27 08:56:44.581758+00 | | streaming | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 00:00:00.000393 | 00:00:00.001159 | 00:00:00.001313 | 0 | async 977 | 17035 | repmgr | xl1db3 |xxxxx | xl1db3 | 42888 | 2019-01-27 08:57:03.232969+00 | | streaming | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 00:00:00.000373 | 00:00:00.000798 | 00:00:00.000919 | 0 | async</code> </pre><br><h4>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рд░реНрд╡рд░ </h4><br>  рдлрд┐рд░, рд╡рд┐рднрд┐рдиреНрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдЙрддреНрдкрд╛рджрдХ HV (prod_hypervisers) рдкрд░, 15 рдРрдк рд╕рд░реНрд╡рд░ рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЧрдП: 8 рдХреЛрд░, 4 рдЬреАрдмреАред  рдореБрдЦреНрдп рдмрд╛рдд рдЬреЛ рдпрд╣ рдХрд╣реА рдЬрд╛ рд╕рдХрддреА рд╣реИ: рдУрдкрдирдЬрдбрдХ 11.0.1 2018-10-16, рд╡рд╕рдВрдд, рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣рд┐рдХрд╛рд░реА рдХреЗ</a> рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рддрдЪреАрдд (hikari.maximum-pool-size: 50) <br><br><h4>  рддрдирд╛рд╡ рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдг </h4><br>  рдкреВрд░реЗ рд▓реЛрдб рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ рдореБрдЦреНрдп рд╕рд░реНрд╡рд░ <b>admin.loadtest</b> рдФрд░ рдХрдИ <b>рдЬрдирд░реЗрдЯрд░</b> <b>N.loadtest</b> рд╕рд░реНрд╡рд░ рд╣реЛрддреЗ рд╣реИрдВ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╡рд╣рд╛рдВ 14 рдереЗ)ред <br><br>  <b>рдЬрдирд░реЗрдЯрд░N.loadtest</b> - "рдирдВрдЧреЗ" рд╡реАрдПрдо рдбреЗрдмрд┐рдпрди рд▓рд┐рдирдХреНрд╕ 9, рд╕реНрдерд╛рдкрд┐рдд рдЬрд╛рд╡рд╛ рдХреЗ рд╕рд╛рде 8. 32 рдХрд░реНрдиреЗрд▓ / 32 рдЧреАрдЧрд╛рдмрд╛рдЗрдЯред  рд╡реЗ рдЧреИрд░-рдЙрддреНрдкрд╛рджрдХ рдПрдЪрд╡реА рдкрд░ рд╕реНрдерд┐рдд рд╣реИрдВ рддрд╛рдХрд┐ рдЧрд▓рддреА рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡реАрдПрдо рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдорд╛рд░ рди рд╕рдХреЗрдВред <br><br>  <b>admin.loadtest</b> - рдбреЗрдмрд┐рдпрди рд▓рд┐рдирдХреНрд╕ 9 <b>рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди</b> , 16 рдХреЛрд░ / 16 рдЧрд┐рдЧреНрд╕, рдпрд╣ рдЬреЗрдирдХреАрдВрд╕, рдЬреЗрдПрд▓рдЯреАрд╕реА рдФрд░ рдЕрдиреНрдп рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╣рддреНрд╡рд╣реАрди рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЪрд▓рд╛рддрд╛ рд╣реИред <br><br>  рдЬреЗрдПрд▓рдЯреАрд╕реА - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреЗрдореАрдЯрд░ рд▓реЛрдб рдкрд░реАрдХреНрд╖рдг рдХреЗрдВрджреНрд░</a> ред  Py / Django рдореЗрдВ рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдЬреЛ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдкреНрд░рдХреНрд╖реЗрдкрдг, рд╕рд╛рде рд╣реА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддреА рд╣реИред <br><br><h3>  рдЯреЗрд╕реНрдЯ рд▓реЙрдиреНрдЪ рдпреЛрдЬрдирд╛ </h3><br><img src="https://habrastorage.org/webt/pb/f_/th/pbf_thx7mwuois96bffvbeehtxk.png"><br><br>  рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ: <br><br><ul><li>  рдкрд░реАрдХреНрд╖рдг <b>рдЬреЗрдирдХрд┐рдВрд╕</b> рд╕реЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЖрд╡рд╢реНрдпрдХ рдиреМрдХрд░реА рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ, рдлрд┐рд░ рдЖрдкрдХреЛ рд╡рд╛рдВрдЫрд┐рдд рдкрд░реАрдХреНрд╖рдг рдкреИрд░рд╛рдореАрдЯрд░ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <ul><li>  рдкрд░реАрдХреНрд╖рд╛ - рдкрд░реАрдХреНрд╖рд╛ рдХреА рдЕрд╡рдзрд┐ </li><li>  <b>RAMPUP</b> - "рд╡рд╛рд░реНрдо-рдЕрдк" рд╕рдордп </li><li>  <b>THREAD_COUNT_TOTAL</b> - рд╡рд░реНрдЪреБрдЕрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ (VU) рдпрд╛ рдереНрд░реЗрдбреНрд╕ рдХреА рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрдЦреНрдпрд╛ </li><li>  <b>TARGET_RESPONSE_TIME</b> рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рдВрдкреВрд░реНрдг рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдУрд╡рд░рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдЗрд╕рдХреА рдорджрдж рд╕реЗ рд╣рдо рд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддрджрдиреБрд╕рд╛рд░ рдкрд░реАрдХреНрд╖рдг рд▓реЛрдб рдХреЛ рдЙрд╕ рд╕реНрддрд░ рдкрд░ рд░рдЦреЗрдЧрд╛ рдЬрд┐рд╕ рдкрд░ рд╕рдВрдкреВрд░реНрдг рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИред </li></ul></li><li>  рд▓рд╛рдВрдЪ </li><li>  рдЬреЗрдирдХрд┐рдиреНрд╕ Gitlab рд╕реЗ рдкрд░реАрдХреНрд╖рдг рдпреЛрдЬрдирд╛ рдХреЛ рдХреНрд▓реЛрди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ JLTC рдХреЛ рднреЗрдЬрддрд╛ рд╣реИред </li><li>  рдЬреЗрдПрд▓рдЯреАрд╕реА рдПрдХ рдкрд░реАрдХреНрд╖рдг рдпреЛрдЬрдирд╛ рдХреЗ рд╕рд╛рде рдереЛрдбрд╝рд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕реАрдПрд╕рд╡реА рд╕рд░рд▓ рд▓реЗрдЦрдХ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ)ред </li><li>  JLTC рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрдЦреНрдпрд╛ (VREAD_COUNT_TOTAL) рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Jmeter рд╕рд░реНрд╡рд░ рдХреА рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред </li><li>  JLTC рдкреНрд░рддреНрдпреЗрдХ рд▓реЛрдбрд░рдЧреЗрдВрдиреЗрдЯрд░ рдПрди рдЬрдирд░реЗрдЯрд░ рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдЬреЗрдореАрдЯрд░ рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред </li></ul><br>  рдкрд░реАрдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди, <b>JMeter- рдХреНрд▓рд╛рдЗрдВрдЯ</b> рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ CSV рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди, рдбреЗрдЯрд╛ рдХреА рдорд╛рддреНрд░рд╛ рдФрд░ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЖрдХрд╛рд░ рдПрдХ <b>рдкрд╛рдЧрд▓</b> рдЧрддрд┐ рд╕реЗ рдмрдврд╝рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - <b>рдбреЗрдорди рдХрд╛</b> рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд┐рдпрд╛ <b>рдЧрдпрд╛</b> рдерд╛ (рдПрдХ рдкреНрд░рдпреЛрдЧ рдХреЗ рд░реВрдк рдореЗрдВ), рдЬреЛ рдЗрд╕реЗ <i>"рдордХреНрдЦреА рдкрд░"</i> рдмрдирд╛рддрд╛ рд╣реИред <br><br><h3>  рдЯреЗрд╕реНрдЯ рдкреНрд▓рд╛рди </h3><br>  рдЖрдк <a href="">рдпрд╣рд╛рдВ</a> рдкрд░реАрдХреНрд╖рдг рдпреЛрдЬрдирд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ <a href="">рд╣реИрдВ</a> ред <br><br>  рдкрдВрдЬреАрдХрд░рдг / рд▓реЙрдЧрд┐рди рдХреЗ рдмрд╛рдж, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ <b>рд╡реНрдпрд╡рд╣рд╛рд░</b> рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдХрдИ <b>рдереНрд░реВрдкреБрдЯ рдирд┐рдпрдВрддреНрд░рдХ</b> рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдЧреЗрдо рдлрд╝рдВрдХреНрд╢рди рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реВрдкреБрдЯ рдирд┐рдпрдВрддреНрд░рдХ рдореЗрдВ, рдПрдХ <b>рдореЙрдбреНрдпреВрд▓ рдирд┐рдпрдВрддреНрд░рдХ рд╣реЛрддрд╛ рд╣реИ</b> , рдЬреЛ рд╕рдВрдмрдВрдзрд┐рдд рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/t0/ws/qp/t0wsqpbkgo-w6dt55gvxd6aw9pm.png"><br><br><h4>  рд╡рд┐рд╖рдп рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ </h4><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рджреМрд░рд╛рди, рд╣рдордиреЗ рдЧреНрд░реВрд╡реА рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдФрд░ рд╣рдорд╛рд░реЗ рдЬрд╛рд╡рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдореИрдВрдиреЗ рдЕрдкрдиреЗ рд▓рд┐рдП рдХреБрдЫ рдЯреНрд░рд┐рдХреНрд╕ рдЦреЛрдЬреЗ (рд╢рд╛рдпрдж рдпрд╣ рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛): <br><br><ul><li>  рдЖрдк рдкрд░реАрдХреНрд╖рдг рдпреЛрдЬрдирд╛ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХрд╣реАрдВ рдкрд░ рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЕрдиреНрдп рдкреНрд░реА-, рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд░ рдФрд░ рдирдореВрдиреЗ рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЕрдзрд┐рдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреНрд░реВрд╡реА рдЕрдЪреНрдЫрд╛рдИ: рдХреНрд▓реЛрдЬрд░ рдореЗрдВ рддрд░реАрдХреЗ рдореЛрдбрд╝реЗрдВ</a> : <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     - def sum(Integer x, Integer y) { return x + y } vars.putObject('sum', this.&amp;sum) //      closure.   . //     sampler`       def sum= vars.getObject('sum'); println sum(2, 2);</span></span></code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">groovy.json.JsonSlurper</a> рдПрдХ рдорд╣рд╛рди рддреЗрдЬ JSON рдкрд╛рд░реНрд╕рд░ рд╣реИред  рд╕рд╛рде рдореЗрдВ groovy, рдпрд╣ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рдХреЛ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.json.JsonSlurper def canBuild = vars.getObject(canBuild); <span class="hljs-comment"><span class="hljs-comment">// ""       def content = jsonSlurper.parseText(response).content def buildings = content[0].buildings //         //               def constructableBuildingDefs = buildings .collect { k,v -&gt; v } .grep{ it.definitions .grep { it2 -&gt; it2['@type'] == 'type.googleapis.com/ConstructionDefinitionDTO'} .grep { it2 -&gt; canBuild(it2) } //   .size() &gt; 0 } if (!constructableBuildingDefs) { return; } Collections.shuffle(constructableBuildingDefs) //       </span></span></code> </pre></li></ul><br><h3>  VU / рдереНрд░реЗрдбреНрд╕ </h3><br>  рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Jenkins рдореЗрдВ рдиреМрдХрд░реА рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп THREAD_COUNT_TOTAL рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ VU рдХреА рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рддрд░рд╣ Jmeter рд╕рд░реНрд╡рд░ рдХреА рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЦреНрдпрд╛ рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ рдЙрдирдХреЗ рд╕рд╛рде VU рдХреА рдЕрдВрддрд┐рдо рд╕рдВрдЦреНрдпрд╛ рд╡рд┐рддрд░рд┐рдд рдХрд░реЗрдВред  рдпрд╣ рднрд╛рдЧ <b>рдирд┐рдпрдВрддреНрд░рдХ / рдкреНрд░рд╛рд╡рдзрд╛рди</b> рдирд╛рдордХ рднрд╛рдЧ рдореЗрдВ JLTC рдХреЗ рд╕рд╛рде рд╕реНрдерд┐рдд рд╣реИред <br><br>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br><ul><li>  рд╣рдо VU <b>рдереНрд░реЗрдбреНрд╕_num</b> рдХреА рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрдЦреНрдпрд╛ рдХреЛ 200-300 рдереНрд░реЗрдб рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдзрд┐рдХ рдпрд╛ рдХрдо рдкрд░реНрдпрд╛рдкреНрдд рдЖрдХрд╛рд░ <b>-Xmsm -Xmxm рдХреЗ</b> рдЖрдзрд╛рд░ рдкрд░ <b>рд╣рдо</b> рдПрдХ <i>рдЬреЗрдореАрдЯрд░-рд╕рд░реНрд╡рд░ рдХреЗ</i> рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдореЗрдореЛрд░реА рд╡реИрд▓реНрдпреВ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рддреЗ рд╣реИрдВ <b>рдЖрд╡рд╢реНрдпрдХ-memory -for_jri</b> (JRI - рдореИрдВ Jmeter- рд╕рд░реНрд╡рд░ рдХреЗ рдмрдЬрд╛рдп Jmeter рджреВрд░рд╕реНрде рдЙрджрд╛рд╣рд░рдг рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реВрдВ)ред </li><li>  рдереНрд░реЗрдбреНрд╕_рдирдо рдФрд░ рдЖрд╡рд╢реНрдпрдХ_рдореЗрдореЛрд░реА_рдлреЛрд░реНрд╕реНрд░реА рд╕реЗ рд╣рдо рдЬреЗрдореАрдЯрд░-рд╕рд░реНрд╡рд░ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛: <b>рд▓рдХреНрд╖реНрдп_рдорд╛рдЙрдВрдЯ_рдЬрдбрд╝реА</b> рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдореЗрдореЛрд░реА рдХрд╛ рдХреБрд▓ рдореВрд▓реНрдп <b>рдкрд╛рддреЗ рд╣реИрдВ</b> : <b>рдЖрд╡рд╢реНрдпрдХ_рдорд┐рдореЛрд░реА_рдЯреЛрдЯрд▓</b> ред </li><li>  рд╣рдо рд╕рднреА loadgeneratorN рдЬрдирд░реЗрдЯрд░ рдХреЛ рдПрдХ-рдПрдХ рдХрд░рдХреЗ рд╕реЙрд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдореЗрдореЛрд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЬреЗрдореАрдЯрд░-рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЬрдм рддрдХ рдЪрд╛рд▓реВ_рдорд╛рдЙрдВрдЯ_рдЬрд╛рд░реА рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдЯрд╛рд░рдЧреЗрдЯ_рдорд╛рдЙрдВрдЯ_рдЬрд╛рд░реА рдХреЗ <b>рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реИ</b> ред </li><li>  (рдпрджрд┐ рдЬрдирд░реЗрдЯрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдХреБрд▓ рдореЗрдореЛрд░реА рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рддреЛ рдкреВрд▓ рдореЗрдВ рдПрдХ рдирдпрд╛ рдЬреЛрдбрд╝реЗрдВ) </li><li>  рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдЬрдирд░реЗрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, <b>рдиреЗрдЯрд╕реНрдЯреИрдЯ</b> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП <b>рд╣рдо</b> рд╕рднреА рд╡реНрдпрд╕реНрдд рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреЛ рдпрд╛рдж рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ (рдЬреЛ рдЕрдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реИрдВ) рдкрд░ рдЬрдореАрдЯрд░-рд╕рд░реНрд╡рд░ рдХреА рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЦреНрдпрд╛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"> netstat_cmd= <span class="hljs-string"><span class="hljs-string">'netstat -tulpn | grep LISTEN'</span></span> stdin, stdout, stderr = ssh.exec_command(cmd1) used_ports = [] netstat_output = str(stdout.readlines()) ports = re.findall(<span class="hljs-string"><span class="hljs-string">'\d+\.\d+\.\d+\.\d+\:(\d+)'</span></span>, netstat_output) ports_ipv6 = re.findall(<span class="hljs-string"><span class="hljs-string">'\:\:\:(\d+)'</span></span>, netstat_output) p.wait() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ports: used_ports.append(int(port)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ports_ipv6: used_ports.append(int(port)) ssh.close() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, possible_jris_on_host + <span class="hljs-number"><span class="hljs-number">1</span></span>): port = int(random.randint(<span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">20000</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> used_ports: port = int(random.randint(<span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">20000</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># ...  Jmeter-    </span></span></code> </pre></li><li>  рд╣рдо рд╕рднреА рдЪрд▓ рд░рд╣реЗ рдЬреЗрдореАрдЯрд░-рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдПрдХ рд╕рдордп рдореЗрдВ рдкрддреЗ рдХреЗ рдкрддреЗ рдкрд░ рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВ: рдкреЛрд░реНрдЯ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП <b>рдЬрдирд░реЗрдЯрд░ 13: 15576, рдЬрдирд░реЗрдЯрд░ 9: 14015, рдЬрдирд░реЗрдЯрд░ 11: 19152, рдЬрдирд░реЗрдЯрд░ 14: 12125, рдЬрдирд░реЗрдЯрд░ 2: 17602</b> </li><li>  рдкрд░реАрдХреНрд╖рдг рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рдкрд░рд┐рдгрд╛рдореА рд╕реВрдЪреА рдФрд░ рдереНрд░реЗрдб_рдкрд░_рд╣реЙрд╕реНрдЯ JMeter-рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">REMOTE_TESTING_FLAG=<span class="hljs-string"><span class="hljs-string">" -R </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$REMOTE_HOSTS_STRING</span></span></span><span class="hljs-string">"</span></span> java -jar -Xms7g -Xmx7g -Xss228k <span class="hljs-variable"><span class="hljs-variable">$JMETER_DIR</span></span>/bin/ApacheJMeter.jar -Jserver.rmi.ssl.disable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -n -t <span class="hljs-variable"><span class="hljs-variable">$TEST_PLAN</span></span> -j <span class="hljs-variable"><span class="hljs-variable">$WORKSPACE</span></span>/loadtest.log -GTHREAD_COUNT=<span class="hljs-variable"><span class="hljs-variable">$THREADS_PER_HOST</span></span> <span class="hljs-variable"><span class="hljs-variable">$OTHER_VARS</span></span> <span class="hljs-variable"><span class="hljs-variable">$REMOTE_TESTING_FLAG</span></span> -Jjmeter.save.saveservice.default_delimiter=,</code> </pre></li></ul><br>  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд░реАрдХреНрд╖рдг 300 Jmeter рд╕рд░реНрд╡рд░, 500 рдзрд╛рдЧреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗ рдПрдХ рд╕рд╛рде рд╣реБрдЖ, рдЬрд╛рд╡рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ Jmeter рд╕рд░реНрд╡рд░ рдХрд╛ рд▓реЙрдиреНрдЪ рдкреНрд░рд╛рд░реВрдк рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛: <br><br><pre> <code class="bash hljs">nohup java -server -Xms1200m -Xmx1200m -Xss228k -XX:+DisableExplicitGC -XX:+CMSClassUnloadingEnabled -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ScavengeBeforeFullGC -XX:+CMSScavengeBeforeRemark -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -Djava.net.preferIPv6Addresses=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -Djava.net.preferIPv4Stack=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -jar <span class="hljs-string"><span class="hljs-string">"/tmp/jmeter-JwKse5nY/bin/ApacheJMeter.jar"</span></span> -Jserver.rmi.ssl.disable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"-Djava.rmi.server.hostname=generator12.loadtest.ig.local"</span></span> -Duser.dir=/tmp/jmeter-JwKse5nY/bin/ -Dserver_port=13114 -s -Jpoll=49 &gt; /dev/null 2&gt;&amp;1</code> </pre> <br><h3>  50ms </h3><br>  рдХрд╛рд░реНрдп рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдХрд┐ рд╣рдорд╛рд░рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдмрдЬрд╛рдп рдЗрд╕реЗ рдУрд╡рд░рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдФрд░ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реНрдерд┐рддрд┐ рдХреЗ рд░реВрдк рдореЗрдВред  рдЗрддрдиреЗ рд╕рд╛рд░реЗ Jmeter рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реНрддрд░ рдкрд░ рд▓реЛрдб рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдирд╣реАрдВ рдорд╛рд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдкрд░реАрдХреНрд╖рдг рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдирд┐рд░реНрджрд┐рд╖реНрдЯ <b>TARGET_RESPONSE_TIME</b> рдкреИрд░рд╛рдореАрдЯрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рд╣рдо рдЗрд╕ рдмрд╛рдд рд╕реЗ рд╕рд╣рдордд рдереЗ рдХрд┐ <b>50ms</b> рдЗрд╖реНрдЯрддрдо рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  JMeter рдореЗрдВ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЯрд╛рдЗрдорд░ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдереНрд░реВрдкреБрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЬреНрдЮрд╛рдд рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрд╕реЗ рдХрд╣рд╛рдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди <b>JSR223- рдЯрд╛рдЗрдорд░</b> рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЖрдк <b>рд╡рд░реНрддрдорд╛рди</b> рд╕рд┐рд╕реНрдЯрдо <b>рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп</b> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рдХреЗ рд╕рд╛рде рдЖ рд╕рдХрддреЗ рд╣реИрдВред  рдЯрд╛рдЗрдорд░ рд╣реА рдореБрдЦреНрдп <b>рд╡реНрдпрд╡рд╣рд╛рд░</b> рдмреНрд▓реЙрдХ рдореЗрдВ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/uv/o8/rb/uvo8rb9ph7mr1xhxkzxccsfa06a.png"><br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      = 0 vars.put('samples', '20'); vars.putObject('respAvg', ${TARGET_RESPONSE_TIME}.0); vars.putObject('sleep', 0.0); //  JSR223-Timer           "" double sleep = vars.getObject('sleep'); double respAvg = vars.getObject('respAvg'); double previous = sleep; double target = ${TARGET_RESPONSE_TIME}; if (respAvg &lt; target) { sleep /= 1.5; } if (respAvg &gt; target) { sleep *= 1.1; } sleep = Math.max(10, sleep); //      sleep = Math.min(20000, sleep); vars.putObject('sleep', sleep); return (int)sleep;</span></span></code> </pre><br><h3>  рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг (рдбреЗрдореЙрди) </h3><br>  рдЧреНрд░рд╛рдлрд╛рдирд╛ рдореЗрдВ рдЧреНрд░рд╛рдл рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХрддреНрд░рд┐рдд рдкрд░реАрдХреНрд╖рд╛ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рд╣реЛрдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдмрд╛рдж рдореЗрдВ JLTC рдореЗрдВ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд╕рдХреЗред <br><br>  рдРрд╕рд╛ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб 16k-20k рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ 4 рдШрдВрдЯреЗ рдореЗрдВ рдпрд╣ рд╕реМ рдЬреАрдмреА рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреА CSV рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдиреМрдХрд░реА рдХреЗ рд╕рд╛рде рдЖрдирд╛ рдЬрд░реВрд░реА рдерд╛ рдЬреЛ рд╣рд░ рдорд┐рдирдЯ рдбреЗрдЯрд╛ рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдореБрдЦреНрдп рдлрд╛рдЗрд▓ рдХреЛ рд╕рд╛рдл рдХрд░рддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/pb/mj/kc/pbmjkcwgjcxupnihgzpzmqd0nvq.png"><br><br>  рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br><ul><li>  рд╣рдо рдбреЗрдЯрд╛ рдХреЛ CSV рдлрд╝рд╛рдЗрд▓ <b>result.jtl</b> рд╕реЗ <b>рдкрдврд╝рддреЗ</b> рд╣реИрдВ, рдЬрд┐рд╕реЗ jmeter-client рджреНрд╡рд╛рд░рд╛ рдЬрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕реЗ рд╕рд╣реЗрдЬреЗрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ (рдЖрдкрдХреЛ рдЗрд╕реЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдЦрд╛рд▓реА рджрд┐рдЦрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рди рдЖрдХрд╛рд░ рдХреА рд╕рдорд╛рди FD рд╣реЛрдЧреА): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(jmeter_results_file, <span class="hljs-string"><span class="hljs-string">'r+'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: rows = f.readlines() f.seek(<span class="hljs-number"><span class="hljs-number">0</span></span>) f.truncate(<span class="hljs-number"><span class="hljs-number">0</span></span>) f.writelines(rows[<span class="hljs-number"><span class="hljs-number">-1</span></span>])</code> </pre></li><li>  рд╣рдо рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓ <b>temp_result.jtl рдкрд░</b> рд░реАрдб рдбреЗрдЯрд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">rows_num = len(rows) open(temp_result_filename, <span class="hljs-string"><span class="hljs-string">'w'</span></span>).writelines(rows[<span class="hljs-number"><span class="hljs-number">0</span></span>:rows_num]) <span class="hljs-comment"><span class="hljs-comment"># avoid last line</span></span></code> </pre> </li><li>  рд╣рдордиреЗ рдлрд╝рд╛рдЗрд▓ <b>temp_result.jtl</b> рдкрдврд╝реАред  рд╣рдо "рдорд┐рдирдЯреЛрдВ" рдореЗрдВ рдкрдврд╝рд╛ рдЧрдпрд╛ рдбреЗрдЯрд╛ рд╡рд┐рддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f.readlines(): row = r.split(<span class="hljs-string"><span class="hljs-string">','</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) == <span class="hljs-number"><span class="hljs-number">13</span></span>: ts_c = int(row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) dt_c = datetime.datetime.fromtimestamp(ts_c/<span class="hljs-number"><span class="hljs-number">1000</span></span>) minutes_data.setdefault(dt_c.strftime(<span class="hljs-string"><span class="hljs-string">'%Y_%m_%d_%H_%M'</span></span>), []).append(r)</code> </pre></li><li>  <b>рдорд┐рдирдЯ_рдбрд╛рдЯрд╛</b> рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдорд┐рдирдЯ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ <b>the_parse /</b> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрд╛ <b>рдЬрд╛рддрд╛</b> рд╣реИред  (рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкрд░реАрдХреНрд╖рдг рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдорд┐рдирдЯ рдореЗрдВ рдЕрдкрдиреА рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рд╣реЛрддреА рд╣реИ, рдлрд┐рд░ рдПрдХрддреНрд░реАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди <b>рдпрд╣</b> рдорд╛рдпрдиреЗ рдирд╣реАрдВ <b>рд░рдЦреЗрдЧрд╛</b> рдХрд┐ рдбреЗрдЯрд╛ рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХрд┐рд╕ рдХреНрд░рдо рдореЗрдВ рдЖрдпрд╛ рд╣реИ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> minutes_data.iteritems(): <span class="hljs-comment"><span class="hljs-comment">#      timestamp (key) temp_ts_file = os.path.join(temp_to_parse_path, key) open(temp_ts_file, 'a+').writelines(value)</span></span></code> </pre></li><li>  рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ, рд╣рдо in_parse рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдпрджрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рдПрдХ рдорд┐рдирдЯ рдХреЗ рднреАрддрд░ рдирд╣реАрдВ рдмрджрд▓рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдПрдХрддреНрд░реАрдХрд░рдг рдФрд░ JLTC рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдореНрдореАрджрд╡рд╛рд░ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(temp_to_parse_path): data_file = os.path.join(temp_to_parse_path, filename) file_mod_time = os.stat(data_file).st_mtime last_time = (time.time() - file_mod_time) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> last_time &gt; <span class="hljs-number"><span class="hljs-number">60</span></span>: logger.info(<span class="hljs-string"><span class="hljs-string">'[DAEMON] File {} was not modified since 1min, adding to parse list.'</span></span>.format(data_file)) files_to_parse.append(data_file)</code> </pre></li><li>  рдпрджрд┐ рдРрд╕реА рдлрд╛рдЗрд▓реЗрдВ (рдПрдХ рдпрд╛ рдХрдИ) рд╣реИрдВ, рддреЛ рд╣рдо рдЙрдиреНрд╣реЗрдВ <b>рдкрд╛рд░реНрд╕_рдПрд╕рд╕реАрд╡реА_рдбреЗрдЯрд╛</b> рдлрд╝рдВрдХреНрд╢рди (рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓) рдореЗрдВ рдкрд╛рд░реНрд╕ рднреЗрдЬрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files_to_parse: logger.info(<span class="hljs-string"><span class="hljs-string">'[DAEMON THREAD] Parse {}.'</span></span>.format(f)) t = threading.Thread( target=parse_csv_data, args=( f, jmeter_results_file_fields, test, data_resolution)) t.start() threads.append(t) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> threads: t.join()</code> </pre></li></ul><br>  рдбреЗрдореЙрди рд╣реА cron.d рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рд╣рд░ рдорд┐рдирдЯ: <br><br>  рдбреЗрдорди рд╣рд░ рдорд┐рдирдЯ cron.d.d рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> <code class="bash hljs">* * * * * root sleep 21 &amp;&amp; /usr/bin/python /var/lib/jltc/manage.py daemon</code> </pre> <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ <i>рдордХреНрдЦреА рдкрд░</i> рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдФрд░ рдордВрдЬреВрд░реА рджреЗ рджреА рд╣реИред <br><br><h2>  рдкрд░рд┐рдгрд╛рдо </h2><br><h3>  рдРрдк </h3><br>  рд╣рдорд╛рд░реЗ 150,000 рдЖрднрд╛рд╕реА рдЦрд┐рд▓рд╛рдбрд╝реА: <br><br><img src="https://habrastorage.org/webt/sv/ex/ep/svexepi9ikzy0unpxur96mty5q8.png"><br><br>  рдкрд░реАрдХреНрд╖рдг 50ms рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рдХреЛ "рдореИрдЪ" рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд▓реЛрдб рдЦреБрдж 16k-18k рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмреАрдЪ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд▓рдЧрд╛рддрд╛рд░ рдХреВрджрддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/-z/98/oi/-z98oi-_8a41hkqbrmz2rvzmryk.png"><br><br>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рд░реНрд╡рд░ рд▓реЛрдб (15 рдРрдк)ред  рджреЛ рд╕рд░реНрд╡рд░ "рдЕрдирд▓рдХреА" рд╣реИрдВ рдЬреЛ M620 рдХреЗ рдзреАрдореЗ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/nc/xy/et/ncxyetqyk_a8mbhjocndd-yxgkm.png"><br><br>  рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп (рдРрдк рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП): <br><br><img src="https://habrastorage.org/webt/zr/a-/gw/zra-gwtq_vqhtfhlrjzzy1osisg.png"><br><br><h3>  рдбрд╛рдЯрд╛рдмреЗрд╕ </h3><br>  Db1 (VM) рдкрд░ CPU рдЙрдкрдпреЛрдЧ: <br><br><img src="https://habrastorage.org/webt/ej/hn/in/ejhnin0jo_7rrzhlj7pqko6udnq.png"><br><br>  рд╣рд╛рдЗрдкрд░рд╡рд┐рдЬрд░ рдкрд░ CPU рдЙрдкрдпреЛрдЧ: <br><br><img src="https://habrastorage.org/webt/uw/ik/tz/uwiktzvcdzydlsjaoexqfbr3tay.png"><br><br>  рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░ рд▓реЛрдб рдХрдо рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рдирд┐рдкрдЯрд╛рди рдореЗрдВ 48 рдЕрд╕рд▓реА рдХреЛрд░ рд╣реИрдВ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рд╛рдЗрдкрд░рд╡рд┐рдЬрд░ рдкрд░ 24 <b>рд╣рд╛рдЗрдкрд░рдереНрд░реЗрдбрд┐рдВрдЧ</b> рдХреЛрд░ рд╣реИрдВред <br><br>  <b>рдЕрдзрд┐рдХрддрдо ~ 250K рдХреНрд╡реЗрд░реАрдЬрд╝ / s</b> рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ (83% рдЪрдпрди, 3% - рдЖрд╡реЗрд╖рдг, 11.6% - рдЕрдкрдбреЗрдЯ (90% HOT), 1.6% рдбрд┐рд▓реАрдЯ) рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/lx/lu/bl/lxlublobhm4nm3c45g9jikcstc4.png"><br><br><img src="https://habrastorage.org/webt/18/jw/gp/18jwgpmebrkyot3ngvarsl_3ysu.png"><br><br>  <b>рдСрдЯреЛрд╡реИрдХреНрдпреБрдо_рд╡реИрдХреНрдпреВрдо_рд╕реЗрд▓реЗ_рдлреИрдХреНрдЯрд░</b> = 0.2 рдХреЗ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХреЗ рд╕рд╛рде, рдореГрдд рдЯреНрдпреВрдкрд▓реНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рддреЗрдЬрд╝реА рд╕реЗ рдмрдврд╝реА (рддрд╛рд▓рд┐рдХрд╛ рдЖрдХрд╛рд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рде), рдЬрд┐рд╕рд╕реЗ рдХрдИ рдмрд╛рд░ рд╢реЙрд░реНрдЯ рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рджрд░реНрд╢рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛ рдЬрд┐рд╕рдиреЗ рдкреВрд░реЗ рдкрд░реАрдХреНрд╖рдг рдХреЛ рдХрдИ рдмрд╛рд░ рдмрд░реНрдмрд╛рдж рдХрд░ рджрд┐рдпрд╛ред  рдореБрдЭреЗ рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ autovacuum_vacuum_scale_factor рдкрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдХреБрдЫ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рд╡реГрджреНрдзрд┐ "рд╡рд╢ рдореЗрдВ" рдХрд░рдирд╛ рдкрдбрд╝рд╛: <br><br><div class="spoiler">  <b class="spoiler_title">рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ ... рд╕реЗрдЯ (рдСрдЯреЛрд╡реИрдХреЛрдо_рд╡реИрдХреНрдпреВрдо_рд╕реЗрд▓реЗ_рдлреИрдХреНрдЯрд░ = ...)</b> <div class="spoiler_text">  ALTER TABLE рдирд┐рд░реНрдорд╛рдг SET (autovacuum_vacuum_scale_factor = 0.10); <br>  рд╡реИрдХрд▓реНрдкрд┐рдХ рдЯреЗрдмрд▓ рдЙрддреНрдкрд╛рджрди SET (autovacuum_vacuum_scale_factor = 0.01); <br>  ALTER TABLE game_entity SET (autovacuum_vacuum_scale_factor = 0.01); <br>  ALTER TABLE game_entity SET (autovacuum_analyze_scale_factor = 0.01); <br>  рд╡реИрдХрд▓реНрдкрд┐рдХ рдЯреЗрдмрд▓ SET (autovacuum_vacuum_scale_factor = 0.01); <br>  рд╡реИрдХрд▓реНрдкрд┐рдХ рдЯреЗрдмрд▓ SET (autovacuum_analyze_scale_factor = 0.01); <br>  ALTER TABLE core_inventory_player_resource SET (autovacuum_vacuum_scale_factor = 0.10); <br>  рдЕрдиреНрдп рддрд╛рд▓рд┐рдХрд╛ рдЙрддреНрддрд░рдЬреАрд╡реА рд╕реЗрдЯ (рдСрдЯреЛрд╡реИрдХреНрдпреВрдо_рд╡реИрдХреБрдо_рд╕реЗрд▓реЗ_рдлреИрдХреНрдЯрд░ = 0.01); <br>  ALTER TABLE рдЙрддреНрддрд░рдЬреАрд╡реА SET (autovacuum_analyze_scale_factor = 0.01); <br></div></div><br><img src="https://habrastorage.org/webt/0s/ja/1e/0sja1e1m3-2gitbmhh8j24t2ktu.png"><br><br>  рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, row_fetched рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рдХрд░реАрдм рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП +, рдЬреЛ рд╣рдо, рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдо рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/e4/k6/zo/e4k6zobp25h5asrmxhmficoea3a.png"><br><br><h4>  hot_standby_feedback </h4><br>  рд╕рдорд╕реНрдпрд╛ <b>hot_standby_feedback</b> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдереА, рдЬреЛ <b>рдореБрдЦреНрдп</b> рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИ рдпрджрд┐ рдЗрд╕рдХреЗ <b>рд╕реНрдЯреИрдВрдбрдмрд╛рдп</b> рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкрд╛рд╕ рд╡рд╛рд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдирд╣реАрдВ рд╣реИред  рдкреНрд░рд▓реЗрдЦрди (https://postgrespro.ru/docs/postgrespro/11/runtime-config-replication) рдХрд╣рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ "рд╣реЙрдЯ рд╕реНрдЯреИрдВрдбрдмрд╛рдп рд╕рд░реНрд╡рд░ рдорд╛рд╕реНрдЯрд░ рдпрд╛ рд╢реНрд░реЗрд╖реНрда рджрд╛рд╕ рдХреЛ рдЙрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ рдЬреЛ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣реЗ рд╣реИрдВред"  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдмрдВрдж рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдорд╛рд░реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдЪрд╛рд▓реВ рдерд╛ред  рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рджреБрдГрдЦрдж рдкрд░рд┐рдгрд╛рдо рд╣реБрдП, рдЕрдЧрд░ 2 рд╕реНрдЯреИрдВрдбрдмрд╛рдп рд╕рд░реНрд╡рд░ рд╣реИрдВ рдФрд░ рд▓реЛрдб рдХреЗ рджреМрд░рд╛рди рдкреНрд░рддрд┐рдХреГрддрд┐ рдЕрдВрддрд░рд╛рд▓ рд╢реВрдиреНрдп (рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░рдгреЛрдВ рд╕реЗ) рд╕реЗ рднрд┐рдиреНрди рд╣реИ, рддреЛ рдЖрдк рдРрд╕реА рддрд╕реНрд╡реАрд░ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдкреВрд░реЗ рдкрд░реАрдХреНрд╖рдг рдХрд╛ рдкрддрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/vl/1l/jd/vl1ljdockxrjlfsoiybq751vo9y.png"><br><br><img src="https://habrastorage.org/webt/qh/4s/m_/qh4sm_hpnunb2w0axzhk90lmf6u.png"><br><br>  рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдЬрдм hot_standby_feedback рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ VACUUM "рдореГрдд" tuples рдХреЛ рд╣рдЯрд╛рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рд╣реИ рдЕрдЧрд░ рд╕реНрдЯреИрдВрдбрдмрд╛рдп рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреГрддрд┐ рд▓реЗрдирджреЗрди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд▓реЗрдирджреЗрди рдЖрдИрдбреА рдореЗрдВ рдкреАрдЫреЗ рд╣реИрдВред  рд╡рд┐рд╕реНрддреГрдд рд▓реЗрдЦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрдпрд╛ PostgreSQL рдореЗрдВ hot_standby_feedback рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд░рддрд╛ рд╣реИ</a> : <br><br><pre> <code class="plaintext hljs">xl1_game=# VACUUM VERBOSE core_inventory_player_resource; INFO: vacuuming "public.core_inventory_player_resource" INFO: scanned index "core_inventory_player_resource_pkey" to remove 62869 row versions DETAIL: CPU: user: 1.37 s, system: 0.58 s, elapsed: 4.20 s тАжтАжтАж... INFO: "core_inventory_player_resource": found 13682 removable, 7257082 nonremovable row versions in 71842 out of 650753 pages &lt;b&gt;DETAIL: 3427824 dead row versions cannot be removed yet, oldest xmin: 3810193429&lt;/b&gt; There were 1920498 unused item pointers. Skipped 8 pages due to buffer pins, 520953 frozen pages. 0 pages are entirely empty. CPU: user: 4.55 s, system: 1.46 s, elapsed: 11.74 s.</code> </pre><br>  рдореГрдд рдЯреБрдкрд▓реНрд╕ рдХреА рдЗрддрдиреА рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдКрдкрд░ рджрд┐рдЦрд╛рдП рдЧрдП рдЪрд┐рддреНрд░ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИред  рдпрд╣рд╛рдБ рджреЛ рдкрд░реАрдХреНрд╖рдг рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде hot_standby_feedback рдЪрд╛рд▓реВ рдФрд░ рдмрдВрдж рд╣реИ: <br><br><img src="https://habrastorage.org/webt/8f/od/n6/8fodn60lohgzsu-twheqysldjzy.png"><br><br>  рдФрд░ рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди рд╣рдорд╛рд░реА рдкреНрд░рддрд┐рдХреГрддрд┐ рдЕрдВрддрд░рд╛рд▓ рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдХреБрдЫ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/et/s0/7h/ets07hkl8skkv5wexxjrgi-3x7m.png"><br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  рдпрд╣ рдкрд░реАрдХреНрд╖рдг, рд╕реМрднрд╛рдЧреНрдп рд╕реЗ (рдпрд╛ рд▓реЗрдЦ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ) рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ рдЦреЗрд▓ рдХреЗ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдХреЗ рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдкрд░ рд╡рд╛рдВрдЫрд┐рдд рднрд╛рд░ рдХреЛ рдЕрд╡рд╢реЛрд╖рд┐рдд рдХрд░рдирд╛ рдХрд╛рдлреА рд╕рдВрднрд╡ рд╣реИ, рдЬреЛ рдЖрдЧреЗ рдХреЗ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдФрд░ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рд╣рд░реА рдмрддреНрддреА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рд╡рд┐рдХрд╛рд╕ рдХреЗ рдмрд╛рдж рдХреЗ рдЪрд░рдгреЛрдВ рдореЗрдВ, рдмреБрдирд┐рдпрд╛рджреА рдирд┐рдпрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ (рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рд╕рд╛рджрдЧреА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдиреБрдХреНрд░рдорд┐рддреЛрдВ рдХреА рдЕрддрд┐рд░реЗрдХ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд╛рде рд╣реА рдЧреИрд░-рдЕрдиреБрдХреНрд░рдорд┐рдд рд░реАрдбрд┐рдВрдЧ, рдЖрджрд┐) рдФрд░ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд, рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЪрд░рдг рдореЗрдВ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВред рдкрд╣рд▓реЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рд╢рд╛рдпрдж рдЬрд▓реНрдж рд╣реА, рдореИрдВ рдПрдХ рд▓реЗрдЦ рд▓рд┐рдЦреВрдВрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░ рдЪреБрдХреЗ рд╣реИрдВред <br><br>  рд╕рднреА рдХреЛ рд╢реБрднрдХрд╛рдордирд╛рдПрдБ! <br><br>  рд╣рдорд╛рд░реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a> рд╕рд┐рд░реНрдл рдорд╛рдорд▓реЗ рдореЗрдВ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi445368/">https://habr.com/ru/post/hi445368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi445356/index.html">DUMP-2019 рдореЗрдВ рдореЛрдмрд╛рдЗрд▓ рд╕реЗрдХреНрд╢рди рдХрд╛ рдЕрд╡рд▓реЛрдХрди: рд░реЛрдЬрдорд░реНрд░рд╛ рдХреЗ рдХрд╛рдо рдореЗрдВ рдЕрдзрд┐рдХрддрдо рдФрд░ рдЙрдкрдпреЛрдЧреА</a></li>
<li><a href="../hi445358/index.html">рдПрдХрддрд╛ рдореЗрдВ рдШрдЯрдирд╛ рдкреНрд░рдгрд╛рд▓реА рдХрд╛ рд╕рдВрдЧрдарди - рдПрдХ рдЧреЗрдо рдбрд┐рдЬрд╛рдЗрдирд░ рдХреА рдЖрдВрдЦреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ</a></li>
<li><a href="../hi445360/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░ рдХреЗ рд▓рд┐рдП 5 рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп: рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдФрд░ рд╕рдорд╛рдзрд╛рди</a></li>
<li><a href="../hi445362/index.html">рдкреБрд╕реНрддрдХ "рд╡рд┐рддрд░рд┐рдд рдкреНрд░рдгрд╛рд▓реАред рдбрд┐рдЬрд╛рдЗрди рдкреИрдЯрд░реНрди</a></li>
<li><a href="../hi445366/index.html">SIMD рдмреНрд▓реЙрдХ рдХреЗ рдХрд╛рд░рдг рдмреИрдХрд▓-рдЯреА 1 рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░ GOST 28147-89 рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рдХреИрд╕реЗ рддреЗрдЬ рдХрд░реЗрдВ</a></li>
<li><a href="../hi445370/index.html">рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ 2 рдореЗрдВ TSDB рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi445372/index.html">рдорд╢реАрди рд╡рд┐рдЬрди рдмрдирд╛рдо рдорд╛рдирд╡ рдЕрдВрддрд░реНрдЬреНрдЮрд╛рди: рдСрдмреНрдЬреЗрдХреНрдЯ рдорд╛рдиреНрдпрддрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрд▓реНрдЧреЛрд░рд┐рджрдо</a></li>
<li><a href="../hi445378/index.html">рд▓реЗрдмрд┐рд░рд┐рдВрде: рд╡рд░реНрдЧреАрдХрд░рдг, рдкреАрдврд╝реА, рд╕рдорд╛рдзрд╛рди рдХреА рдЦреЛрдЬ</a></li>
<li><a href="../hi445380/index.html">рдЖрдзреБрдирд┐рдХ PHP рд╕реБрдВрджрд░ рдФрд░ рдЙрддреНрдкрд╛рджрдХ рд╣реИ</a></li>
<li><a href="../hi445384/index.html">рдЪрд╛рдВрдЧ'рдИ -4 рдорд┐рд╢рди - рд▓реИрдВрдбрд┐рдВрдЧ рдореЙрдбреНрдпреВрд▓ рдФрд░ рдкреБрдирд░рд╛рд╡рд░реНрддрдХ рдЙрдкрдЧреНрд░рд╣ рдкрд░ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдЙрдкрдХрд░рдг</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>