<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèª üï¶ üîÅ Aprendizaje autom√°tico como asistente de monitoreo inteligente üëä üëÉüèº üëèüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habr 

 Home Credit es un sistema grande y muy din√°mico, que a veces es dif√≠cil de seguir. Para ayudar a los empleados a mantenerse al tanto de t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizaje autom√°tico como asistente de monitoreo inteligente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/479712/">  Hola habr <br><br>  Home Credit es un sistema grande y muy din√°mico, que a veces es dif√≠cil de seguir.  Para ayudar a los empleados a mantenerse al tanto de todas las noticias y cambios y mantener el ritmo en todas partes, estamos introduciendo activamente algoritmos de aprendizaje autom√°tico.  En nuestro Banco, los bots de chat ya toman parte del trabajo de los operadores, las opiniones de los clientes son analizadas no solo por expertos, sino tambi√©n por algoritmos inteligentes para procesar el lenguaje natural. <br><br>  Hoy les contar√© c√≥mo ayudamos a los especialistas en la operaci√≥n de servicios bancarios a deshacerse de la necesidad de mirar constantemente los paneles de control de los sistemas de monitoreo, es decir, pidieron ayuda para el aprendizaje autom√°tico.  Eso es lo que tenemos. <br><br><img src="https://habrastorage.org/webt/jd/w9/xp/jdw9xpbwninwrbz9e8p6heid8o0.png" alt="imagen"><br><a name="habracut"></a><br><h2>  ¬øC√≥mo funciona el monitoreo manual? </h2><br>  El lugar de trabajo t√≠pico de un especialista en operaciones se ve como en la imagen de arriba, y √©l pasa la mayor parte de su tiempo mirando los tableros.  Cualquier actividad sospechosa en el sistema, por ejemplo, cuando la red se ha ca√≠do o ha llovido una NullPointerException, atraer√° inmediatamente la atenci√≥n; una investigaci√≥n comenzar√° de inmediato. <br><br>  El hombre no es una m√°quina.  Puede distraerse, ir a cenar, contestar el tel√©fono.  Y cuando el n√∫mero de gr√°ficos excede de cien, se hace dif√≠cil unirlos y llegar al fondo de la esencia. <br><br>  Otro problema es que hay una familia de errores que ocurren constantemente, pero que no afectan seriamente el comportamiento del sistema.  Por ejemplo, un microservicio de terceros se cay√≥ y los paneles se sacudieron notablemente, pero de hecho el sistema est√° fuera de peligro.  A primera vista, no siempre est√° claro c√≥mo el comportamiento anormal es cr√≠tico y qu√© hay detr√°s.  Para establecer los motivos en detalle, debe ir al servidor y profundizar en los registros.  Tal operaci√≥n tiene que hacerse docenas de veces al d√≠a.  Encomendamos al menos parcialmente al auto. <br><br><h2>  Aprendizaje autom√°tico como asistente inteligente </h2><br>  Existen tres fuentes principales de datos: Zabbix, ElasticSearch y un sistema interno de monitoreo de m√©tricas comerciales.  Utilizamos Zabbix para monitorear el hardware, la red y la disponibilidad de varios puntos de entrada a los sistemas.  Con ElasticSearch, analiza y extrae el registro de mensajes.  Varios errores, ejecuciones y consultas se utilizan como m√©tricas.  Los analistas de negocios, sin embargo, monitorean el desempe√±o de los usuarios: la cantidad de transferencias, ventas y otras actividades comerciales.  Los datos se recopilan con una frecuencia de una vez por minuto y se agregan a la base de datos.  Bueno, los datos se recopilan, es hora de escribir un mont√≥n de si para poner el aprendizaje autom√°tico en la batalla. <br><br>  Formulamos el problema de la siguiente manera: teniendo las m√©tricas del sistema en la entrada, clasificaremos el estado final del sistema: regular o anormal.  En este contexto, el problema encaja perfectamente en el paradigma de aprender con un maestro.  Esto significa que todo nuestro conjunto de datos de entrenamiento debe estar etiquetado.  En otras palabras, cada minuto de la operaci√≥n del sistema debe tener una etiqueta de 0 (comportamiento normal) o -1 (comportamiento an√≥malo). <br><br>  En la vida, resulta que no todo es tan color de rosa como nos gustar√≠a.  Como regla general, no todos los incidentes se registran en JIRA, queda mucho en el correo y no va m√°s all√°, y a veces los l√≠mites de tiempo de la anomal√≠a son borrosos o inexactos.  Resulta que construir un conjunto de datos de alta calidad en el campo de datos hist√≥ricos no es una tarea trivial. <br><br>  Si bien los nuevos datos reci√©n comienzan a presentarse, intentemos exprimir el beneficio de lo que ya tenemos.  Para los casos en que los datos no tienen un marcado, se utilizan algoritmos de aprendizaje sin un maestro.  Procederemos por el hecho de que la mayor√≠a de las veces el sistema funciona correctamente, pero ocasionalmente ocurren eventos imprevistos: errores (sin ellos), la base se cay√≥ o, por ejemplo, la excavadora Petr golpe√≥ el cable del centro de datos.  Por lo tanto, reducimos nuestra tarea a la b√∫squeda de anomal√≠as, a saber, la b√∫squeda de un nuevo comportamiento del sistema (Detecci√≥n de novedades). <br>  Para hacer esto, use el algoritmo Bosque aislado.  Ya est√° implementado en la biblioteca sklearn.  Utilizaremos m√©tricas de los sistemas de monitoreo como caracter√≠sticas. <br><br><pre><code class="python hljs">clf = IsolationForest(behaviour=<span class="hljs-string"><span class="hljs-string">'new'</span></span>, max_samples=<span class="hljs-number"><span class="hljs-number">100</span></span>, random_state=rng, contamination=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>)</code> </pre> <br>  Capacitaremos a los bosques aislados sobre datos hist√≥ricos y utilizaremos los nuevos datos que ya hemos logrado marcar para evaluar la calidad.  Por lo tanto, queda por elegir los hiperpar√°metros del modelo y el tama√±o del conjunto de datos para el entrenamiento. <br><br>  Ahora los datos de estado, que se recopilan cada minuto, se ingresan al modelo entrenado y obtienen la etiqueta 0 o -1. <br><br><img src="https://habrastorage.org/webt/2j/wi/ly/2jwilytbwxdl-guvfftwujzbsjs.png" alt="imagen"><br><br>  Un operador puede rastrear solo un horario.  En el eje X - tiempo, en Y - puntaje de anomal√≠a, es decir, qu√© tan fuerte el modelo consideraba anormal el estado del sistema en este momento.  Si el valor de la velocidad ha pasado por la papelera (que el modelo selecciona por s√≠ mismo), el punto se ti√±e de rojo y se registra una anomal√≠a. <br><br>  Ahora sabemos que el sistema funciona en un modo inusual o que una situaci√≥n de emergencia ocurri√≥ en tiempo casi real.  Esto es muy bueno, pero ¬øqu√© pasa con el operador al momento de recibir la se√±al sobre la anomal√≠a?  ¬øQu√© tablero mirar?  Intentemos abrir el "recuadro negro" de nuestro modelo y comprender c√≥mo toma decisiones. <br><br><h2>  Interpretando un modelo usando LIME </h2><br><br>  Existen diferentes enfoques sobre c√≥mo abrir la caja negra de un modelo entrenado y comprender lo que est√° en la mente de la m√°quina.  Con una regresi√≥n log√≠stica o un √°rbol de decisi√≥n, todo est√° claro, no es dif√≠cil de entender sobre la base de la cual se tom√≥ la decisi√≥n.  Con el bosque aislado, las cosas son m√°s complicadas.  En primer lugar, hay un accidente dentro del algoritmo, y en segundo lugar, es un algoritmo de aprendizaje sin un maestro. <br><br>  El primer candidato fue la biblioteca LIME, que utiliza el enfoque agn√≥stico del modelo, que ayuda a interpretar cualquier modelo, lo principal es que la salida del modelo tiene una distribuci√≥n probabil√≠stica entre las clases.  De acuerdo, por supuesto, el resultado no es la probabilidad, pero pronto, pero intentemos normalizarlos en el rango de 0 a 1 y tratarlo como probabilidad.  Por lo tanto, pudimos proporcionar un formato de entrada compatible con LIME. <br>  La forma en que LIME interpret√≥ los resultados fue decepcionante.  En primer lugar, como interpretaci√≥n, hubo varios signos m√°s importantes en la salida y, en la mayor√≠a de los casos, solo uno de ellos realmente reflej√≥ adecuadamente la esencia de la decisi√≥n, el resto agreg√≥ ruido.  El segundo inconveniente fue que la interpretaci√≥n era inestable y a menudo produc√≠a diferentes listas de signos de una carrera a otra.  Para obtener resultados m√°s estables, tuvo que ejecutar la interpretaci√≥n varias veces y de alguna manera promediar los resultados.  Realmente no quer√≠a hacer esto. <br><br><h2>  SHAP - puente de persona a carro </h2><br>  Despu√©s de eso, nuestros ojos se posaron en otra biblioteca para la interpretaci√≥n de modelos: SHAP.  La idea detr√°s de la biblioteca surgi√≥ de la teor√≠a de juegos.  La biblioteca tambi√©n tiene una hermosa visualizaci√≥n.  Despu√©s de mirar los ejemplos, nos dimos cuenta con frustraci√≥n de que SHAP no pod√≠a interpretar el Bosque Aislado, ¬°y realmente quer√≠amos hacerlo!  Pero, por otro lado, SHAP puede diseccionar con seguridad XGBoost.  Pensamos, ¬øy si nos ense√±an a hacer XGBoost lo mismo que puede hacer el Bosque Aislado?  Para hacer esto, tomamos todo nuestro conjunto de datos y lo marcamos con Bosque aislado.  Adem√°s, como objetivo, no tomaron una clase, sino un scor, que se asign√≥ al Bosque Aislado.  ¬°Pronosticaremos seg√∫n todas las m√©tricas la velocidad que proporcionar√≠a el Bosque Aislado, pero solo con XGBoot!  Apenas dicho que hecho.  Ejecutaremos nuestro conjunto de datos etiquetados a trav√©s de XGBoost.  Y ahora, ahora sabe c√≥mo predecir la velocidad de la misma manera que el Bosque Aislado.  ¬°Hurra, ahora podemos usar SHAP! <br><br>  El primer paso es crear un objeto TreeExplainer, pasando el modelo como par√°metro.  A continuaci√≥n, se calculan los valores de shap, que nos permiten dar una explicaci√≥n de c√≥mo el modelo tom√≥ esta o aquella decisi√≥n. <br><br><pre> <code class="python hljs">explainer = shap.TreeExplainer(model) shap_values = explainer.shap_values(X)</code> </pre> <br>  SHAP le permite interpretar tanto el modelo como un todo y los resultados para ejemplos espec√≠ficos.  Por ejemplo, puede obtener una explicaci√≥n para un ejemplo espec√≠fico utilizando el m√©todo force_plot (), que recibe los valores de entrada y los valores del ejemplo en s√≠. <br><br><pre> <code class="python hljs">shap.force_plot(explainer.expected_value,shap_values[<span class="hljs-number"><span class="hljs-number">0</span></span>,:], X.iloc[<span class="hljs-number"><span class="hljs-number">0</span></span>,:])</code> </pre> <br>  Resulta el siguiente gr√°fico, que muestra qu√© caracter√≠sticas del modelo y cu√°nto influyeron en la decisi√≥n. <br><br><img src="https://habrastorage.org/webt/k4/he/-u/k4he-ucq5b7zsyjnyc-rwbpmrtg.png" alt="imagen"><br><br><h2>  Ayudamos a los negocios </h2><br>  Ahora, sabiendo qu√© m√©tricas hicieron una contribuci√≥n significativa a la tasa general de anormalidad, es posible establecer a qu√© nivel surgi√≥ el problema y, lo m√°s importante, si tuvo un impacto en los usuarios finales del sistema. <br><br><img src="https://habrastorage.org/webt/wp/rp/6g/wprp6gc-gzbjzotptcjvb6hlj9a.png" alt="imagen"><br><br>  Cada vez que se detecta una anomal√≠a, se obtiene una lista de m√©tricas que tienen el mayor impacto en la decisi√≥n.  Si la lista incluye m√©tricas que rastrean directamente los indicadores relacionados con el negocio, esto se menciona en la alerta de una manera especial, lo que aumenta autom√°ticamente la prioridad de la anomal√≠a. <br><br>  Este es solo el primer pero importante paso para fortalecer y automatizar el sistema de monitoreo mediante el aprendizaje autom√°tico, que puede aumentar significativamente la velocidad de identificaci√≥n de las causas y la influencia del comportamiento anormal del sistema. <br><br>  <b>Referencias</b> <br><br>  <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html</a> <br>  <a href="https://github.com/marcotcr/lime">github.com/marcotcr/lime</a> <br>  <a href="https://github.com/slundberg/shap">github.com/slundberg/shap</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479712/">https://habr.com/ru/post/479712/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479696/index.html">Algunas palabras sobre Alter Table, o c√≥mo no hacerlo</a></li>
<li><a href="../479700/index.html">CIMON-2: (un) Doomsday, o c√≥mo IBM Watson subi√≥ por encima de las nubes</a></li>
<li><a href="../479702/index.html">Tostadora, Mi c√≠rculo y Freelansim se convierten en parte de Habr</a></li>
<li><a href="../479704/index.html">Escalada de privilegios en el cliente EA Origin Windows (CVE-2019-19247 y CVE-2019-19248)</a></li>
<li><a href="../479708/index.html">Publicaci√≥n no oficial sobre el cambio de marca de Habr + Competition</a></li>
<li><a href="../479714/index.html">Unificaci√≥n de componentes visuales. Parte 1. Estilos</a></li>
<li><a href="../479716/index.html">Otra "primera en el mundo" SuperApp</a></li>
<li><a href="../479718/index.html">Creaci√≥n de una aplicaci√≥n de entorno arduino utilizando CI github</a></li>
<li><a href="../479724/index.html">Tru hackers han terminado</a></li>
<li><a href="../479726/index.html">Vladimir tambi√©n conocido como wowik: "OpenStreetMap necesita ideas que no se pueden realizar en otros sistemas"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>