<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💞 🌪️ 👩🏼 Luncurkan detektor jaringan saraf Anda pada Raspberry Pi menggunakan Neural Compute Stick dan OpenVINO 🧝🏿 🛅 👩🏿‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dengan penyebaran dan pengembangan jaringan saraf, ada kebutuhan yang meningkat untuk menggunakannya pada perangkat dan robot berdaya rendah dan berda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Luncurkan detektor jaringan saraf Anda pada Raspberry Pi menggunakan Neural Compute Stick dan OpenVINO</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436744/">  Dengan penyebaran dan pengembangan jaringan saraf, ada kebutuhan yang meningkat untuk menggunakannya pada perangkat dan robot berdaya rendah dan berdaya rendah.  Perangkat Neural Compute Stick bersama dengan kerangka kerja Intel OpenVINO memungkinkan kami untuk menyelesaikan masalah ini dengan mengambil perhitungan berat jaringan saraf.  Berkat ini, Anda dapat dengan mudah meluncurkan pengklasifikasi jaringan saraf atau detektor pada perangkat berdaya rendah seperti Raspberry Pi dalam waktu yang hampir bersamaan, tanpa konsumsi energi yang sangat meningkat.  Dalam posting ini, saya akan menunjukkan kepada Anda bagaimana menggunakan kerangka kerja OpenVINO (dalam C ++) dan Neural Compute Stick untuk meluncurkan sistem deteksi wajah sederhana pada Raspberry Pi. <br><br>  Seperti biasa, semua kode tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . <br><br><img src="https://habrastorage.org/webt/qu/b_/tj/qub_tj1u6ztw9irfy9ivtaaidcc.jpeg"><br><a name="habracut"></a><br><h3>  Sedikit tentang Neural Compute Stick dan OpenVINO </h3><br>  Pada musim panas 2017, Intel merilis perangkat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Neural Compute Stick</a> (NCS), yang dirancang untuk menjalankan jaringan saraf pada perangkat berdaya rendah, dan setelah beberapa bulan dapat dibeli dan diuji, yang saya lakukan.  NCS adalah modul komputasi kecil dengan casing warna biru (juga bertindak sebagai radiator), yang terhubung ke perangkat utama melalui USB.  Di dalam, antara lain, adalah Intel Myriad <abbr title="Unit pemrosesan visi">VPU</abbr> , yang pada dasarnya adalah prosesor paralel 12-core, dipertajam untuk operasi yang sering terjadi dalam jaringan saraf.  NCS tidak cocok untuk pelatihan jaringan saraf, tetapi kesimpulan dalam jaringan saraf yang sudah terlatih sebanding dengan kecepatan pada GPU.  Semua perhitungan dalam NCS dilakukan pada angka float 16-bit, yang memungkinkan Anda untuk meningkatkan kecepatan.  NCS hanya membutuhkan daya 1 Watt untuk beroperasi, yaitu, pada 5 V, arus hingga 200 mA dikonsumsi pada konektor USB - ini bahkan kurang dari kamera untuk Raspberry Pi (250 mA). <br><br><img src="https://habrastorage.org/webt/8d/u8/ov/8du8ov7hj1-f3vk8sjbenkyupvm.png"><br><br>  Untuk bekerja dengan NCS pertama, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Neural Compute SDK</a> (NCSDK) digunakan: termasuk alat untuk menyusun jaringan saraf dalam format <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Caffe</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TensorFlow</a> ke format NCS, alat untuk mengukur kinerja mereka, serta API Python dan C ++ untuk inferensi. <br><br>  Kemudian versi baru kerangka kerja NCS dirilis: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NCSDK2</a> .  API telah banyak berubah di dalamnya, dan meskipun beberapa perubahan tampak aneh bagi saya, ada beberapa inovasi yang bermanfaat.  Secara khusus, konversi otomatis dari float 32 bit ke float 16 bit ke C ++ ditambahkan (sebelumnya, kruk harus dimasukkan dalam bentuk kode dari Numpy).  Juga muncul antrian gambar dan hasil pemrosesan mereka. <br><br>  Pada Mei 2018, Intel merilis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenVINO</a> (sebelumnya disebut Intel Computer Vision SDK).  Kerangka kerja ini dirancang untuk secara efisien meluncurkan jaringan saraf pada berbagai perangkat: prosesor Intel dan kartu grafis, <abbr title="Array Gerbang-Programmable">FPGA</abbr> , serta Neural Compute Stick. <br><br>  Pada November 2018, versi baru akselerator dirilis: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Neural Compute Stick 2</a> .  Kekuatan komputasi perangkat telah meningkat: dalam deskripsi di situs mereka menjanjikan akselerasi hingga 8x, namun, saya tidak dapat menguji versi perangkat yang baru.  Akselerasi dicapai dengan meningkatkan jumlah core dari 12 menjadi 16, serta menambahkan perangkat komputasi baru yang dioptimalkan untuk jaringan saraf.  Benar, saya tidak menemukan informasi tentang konsumsi daya informasi. <br><br>  Versi kedua NCS sudah tidak kompatibel dengan NCSDK atau NCSDK2: OpenVINO, yang mampu bekerja dengan banyak perangkat lain selain kedua versi NCS, melewati otoritas mereka.  OpenVINO sendiri memiliki fungsionalitas hebat dan mencakup komponen-komponen berikut: <br><br><ol><li>  Pengoptimal Model: Skrip Python yang memungkinkan Anda untuk mengubah jaringan saraf dari kerangka pembelajaran mendalam populer ke dalam format OpenVINO universal.  Daftar kerangka kerja yang didukung: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Caffe</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TensorFlow</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MXNET</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kaldi</a> (kerangka pengenalan suara), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ONNX</a> (format terbuka untuk mewakili jaringan saraf). </li><li>  Mesin Inferensi: C ++ dan Python API untuk inferensi jaringan saraf, disarikan dari perangkat inferensi tertentu.  Kode API akan terlihat hampir identik untuk CPU, GPU, FPGA dan NCS. </li><li>  Satu set plugin untuk perangkat yang berbeda.  Plugin adalah perpustakaan dinamis yang dimuat secara eksplisit dalam kode program utama.  Kami paling tertarik dengan plugin untuk NCS. </li><li>  Serangkaian model pra-terlatih dalam format OpenVINO universal (daftar lengkapnya ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ).  Kumpulan jaringan saraf berkualitas tinggi yang mengesankan: detektor wajah, pejalan kaki, objek;  pengakuan akan orientasi wajah, titik wajah khusus, postur manusia;  resolusi super;  dan lainnya.  Perlu dicatat bahwa tidak semuanya didukung oleh NCS / FPGA / GPU. </li><li>  Pengunduh Model: skrip lain yang menyederhanakan pengunduhan model dalam format OpenVINO melalui jaringan (meskipun Anda dapat dengan mudah melakukannya tanpa itu). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pustaka</a> visi komputer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenCV</a> dioptimalkan untuk perangkat keras Intel. </li><li>  Perpustakaan visi komputer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenVX</a> . </li><li>  Intel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Compute Library untuk Deep Neural Networks</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan</a> Intel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Math Kernel untuk Deep Neural Networks</a> . </li><li>  Alat untuk mengoptimalkan jaringan saraf untuk FPGA (opsional). </li><li>  Program dokumentasi dan sampel. </li></ol><br>  Dalam artikel saya sebelumnya, saya berbicara tentang cara menjalankan detektor wajah YOLO pada NCS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">(artikel pertama)</a> , serta cara melatih detektor wajah SSD Anda dan menjalankannya pada Raspberry Pi dan NCS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">(artikel kedua)</a> .  Dalam artikel ini, saya menggunakan NCSDK dan NCSDK2.  Pada artikel ini saya akan memberi tahu Anda bagaimana melakukan sesuatu yang serupa, tetapi menggunakan OpenVINO, saya akan membuat perbandingan kecil dari kedua pendeteksi wajah dan dua kerangka kerja untuk meluncurkannya, dan saya akan menunjukkan beberapa jebakan.  Saya menulis dalam C ++, karena saya percaya bahwa dengan cara ini Anda dapat mencapai kinerja yang lebih baik, yang akan menjadi penting dalam kasus Raspberry Pi. <br><br><h3>  Instal OpenVINO </h3><br>  Bukan tugas yang paling sulit, meskipun ada kehalusan.  Pada saat penulisan, OpenVINO hanya mendukung Ubuntu 16.04 LTS, CentOS 7.4, dan Windows 10. Saya telah menginstal Ubuntu 18 dan memerlukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kruk kecil</a> untuk menginstalnya.  Saya juga ingin membandingkan OpenVINO dengan NCSDK2, instalasi yang juga memiliki masalah: khususnya, memperketat versi Caffe dan TensorFlow dan sedikit dapat merusak pengaturan lingkungan.  Pada akhirnya, saya memutuskan untuk mengikuti jalur sederhana dan menginstal kedua kerangka kerja ke mesin virtual dengan Ubuntu 16 (saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">VirtualBox</a> ). <br><br>  Perlu dicatat bahwa agar berhasil menghubungkan NCS ke mesin virtual, Anda perlu menginstal add-on guest VirtualBox dan mengaktifkan dukungan USB 3.0.  Saya juga menambahkan filter universal untuk perangkat USB, akibatnya NCS terhubung tanpa masalah (meskipun webcam masih harus terhubung dalam pengaturan mesin virtual).  Untuk menginstal dan mengkompilasi OpenVINO Anda harus memiliki akun Intel, pilih opsi kerangka kerja (dengan atau tanpa dukungan FPGA) dan ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> .  NCSDK bahkan lebih sederhana: mem-boot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari GitHub</a> (jangan lupa untuk memilih cabang ncsdk2 untuk versi baru framework), setelah itu Anda perlu <code>make install</code> . <br><br>  Satu-satunya masalah yang saya temui saat menjalankan NCSDK2 di mesin virtual adalah kesalahan dari bentuk berikut: <br><br><pre> <code class="plaintext hljs">E: [ 0] dispatcherEventReceive:236 dispatcherEventReceive() Read failed -1 E: [ 0] eventReader:254 Failed to receive event, the device may have reset</code> </pre><br>  Itu terjadi pada akhir pelaksanaan program yang benar dan (tampaknya) tidak mempengaruhi apa pun.  Rupanya, ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bug kecil yang terkait dengan VM</a> (ini tidak boleh di Raspberry). <br><br>  Instalasi pada Raspberry Pi sangat berbeda.  Pertama, pastikan Anda telah menginstal Raspbian Stretch: kedua kerangka kerja hanya berfungsi pada OS ini.  NCSDK2 perlu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dikompilasi dalam mode API-only</a> , jika tidak maka akan mencoba untuk menginstal Caffe dan TensorFlow, yang sepertinya tidak akan menyenangkan Raspberry Anda.  Dalam hal OpenVINO, ada versi yang sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dirakit untuk Raspberry</a> , yang Anda hanya perlu membongkar dan mengonfigurasi variabel lingkungan.  Dalam versi ini hanya ada C ++ dan Python API, serta pustaka OpenCV, semua alat lain tidak tersedia.  Ini berarti bahwa untuk kedua kerangka kerja, model harus dikonversi terlebih dahulu pada mesin dengan Ubuntu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Demo deteksi wajah</a> saya berfungsi pada Raspberry dan desktop, jadi saya baru saja menambahkan file jaringan saraf yang dikonversi ke repositori GitHub saya untuk membuatnya lebih mudah untuk disinkronkan dengan Raspberry.  Saya memiliki Raspberry Pi 2 model B, tetapi harus lepas landas dengan model lain. <br><br>  Ada kehalusan lain mengenai interaksi Raspberry Pi dan Neural Compute Stick: jika dalam kasus laptop, cukup dengan memasukkan NCS ke port USB 3.0 terdekat, maka untuk Raspberry Anda harus menemukan kabel USB, jika tidak NSC akan memblokir tiga konektor USB yang tersisa dengan tubuhnya.  Perlu juga diingat bahwa Raspberry memiliki semua versi USB 2.0, sehingga tingkat inferensi akan lebih rendah karena keterlambatan komunikasi (perbandingan detail akan dilakukan nanti).  Tetapi jika Anda ingin menghubungkan dua atau lebih NCS ke Raspberry, kemungkinan besar Anda harus mencari hub USB dengan daya tambahan. <br><br><h3>  Seperti apa bentuk kode OpenVINO </h3><br>  Cukup besar.  Ada banyak tindakan berbeda yang harus dilakukan, mulai dengan memuat plug-in dan diakhiri dengan inferensi itu sendiri - itu sebabnya saya menulis kelas pembungkus untuk detektor.  Kode lengkap dapat dilihat di GitHub, tetapi di sini saya hanya mendaftar poin utama.  Mari kita mulai dengan urutan: <br><br>  Definisi semua fungsi yang kita butuhkan ada di file <code>inference_engine.hpp</code> di namespace <code>InferenceEngine</code> . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;inference_engine.hpp&gt; using namespace InferenceEngine;</span></span></span></span></code> </pre><br>  Variabel berikut akan dibutuhkan setiap saat.  kita membutuhkan <code>inputName</code> dan <code>outputName</code> untuk mengatasi input dan output dari jaringan saraf.  Secara umum, jaringan saraf dapat memiliki banyak input dan output, tetapi dalam detektor kami akan ada satu per satu.  <code>net</code> variabel adalah jaringan itu sendiri, <code>request</code> adalah pointer ke permintaan inferensi terakhir, <code>inputBlob</code> adalah pointer ke array data input dari jaringan saraf.  Variabel yang tersisa berbicara sendiri. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> inputName; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> outputName; ExecutableNetwork net; InferRequest::Ptr request; Blob::Ptr inputBlob; <span class="hljs-comment"><span class="hljs-comment">//input shape int netInputWidth; int netInputHeight; int netInputChannels; //output shape int maxNumDetectedFaces; //return code StatusCode ncsCode;</span></span></code> </pre><br>  Sekarang unduh plugin yang diperlukan - kita membutuhkan plugin yang bertanggung jawab untuk NCS dan NCS2, ini dapat diperoleh dengan nama "MYRIAD".  Biarkan saya mengingatkan Anda bahwa dalam konteks OpenVINO, sebuah plugin hanyalah pustaka dinamis yang terhubung dengan permintaan eksplisit.  Parameter fungsi <code>PluginDispatcher</code> adalah daftar direktori tempat mencari plugin.  Jika Anda mengatur variabel lingkungan sesuai dengan instruksi, baris kosong akan cukup.  Sebagai referensi, plugin terletak di <code>[OpenVINO_install_dir]/deployment_tools/inference_engine/lib/ubuntu_16.04/intel64/</code> <br><br><pre> <code class="cpp hljs">InferencePlugin plugin = PluginDispatcher({<span class="hljs-string"><span class="hljs-string">""</span></span>}).getPluginByDevice(<span class="hljs-string"><span class="hljs-string">"MYRIAD"</span></span>);</code> </pre><br>  Sekarang buat objek untuk memuat jaringan saraf, pertimbangkan deskripsinya dan atur ukuran bets (jumlah gambar yang diproses secara bersamaan).  Jaringan saraf dalam format OpenVINO didefinisikan oleh dua file: .xml dengan deskripsi struktur dan .bin dengan bobot.  Sementara kita akan menggunakan detektor yang sudah jadi dari OpenVINO, nanti kita akan membuatnya sendiri.  Di sini <code>std::string filename</code> adalah nama file tanpa ekstensi.  Anda juga perlu diingat bahwa NCS hanya mendukung ukuran batch 1. <br><br><pre> <code class="cpp hljs">CNNNetReader netReader; netReader.ReadNetwork(filename+<span class="hljs-string"><span class="hljs-string">".xml"</span></span>); netReader.ReadWeights(filename+<span class="hljs-string"><span class="hljs-string">".bin"</span></span>); netReader.getNetwork().setBatchSize(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  Kemudian terjadi hal berikut: <br><br><ol><li>  Untuk memasuki jaringan saraf, atur tipe data ke unsigned char 8 bit.  Ini berarti bahwa kita dapat memasukkan gambar dalam format yang berasal dari kamera, dan InferenceEngine akan menangani konversi (NCS melakukan perhitungan dalam format float 16 bit).  Ini akan mempercepat sedikit pada Raspberry Pi - seperti yang saya mengerti, konversi dilakukan pada NCS, sehingga ada sedikit penundaan dalam mentransfer data melalui USB. </li><li>  Kami mendapatkan nama input dan output, sehingga nanti kami bisa mengaksesnya. </li><li>  Kami mendapatkan deskripsi output (ini adalah peta dari nama output ke pointer ke blok data).  Kami mendapatkan pointer ke blok data dari output (tunggal) pertama. </li><li>  Kami mendapatkan ukurannya: 1 x 1 x jumlah maksimum deteksi x panjang deskripsi deteksi (7).  Tentang format deskripsi deteksi - nanti. </li><li>  Atur format output ke float 32 bit.  Sekali lagi, konversi dari float 16 bit menangani InferenceEngine. </li></ol><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//we can set input type to unsigned char: conversion will be performed on device netReader.getNetwork().getInputsInfo().begin()-&gt;second-&gt;setPrecision(Precision::U8); //get input and output names and their info structures inputName = netReader.getNetwork().getInputsInfo().begin()-&gt;first; outputName = netReader.getNetwork().getOutputsInfo().begin()-&gt;first; OutputsDataMap outputInfo(netReader.getNetwork().getOutputsInfo()); InputsDataMap inputInfo(netReader.getNetwork().getInputsInfo()); DataPtr &amp;outputData = (outputInfo.begin()-&gt;second); //get output shape: (1 x 1 x maxNumDetectedFaces x faceDescriptionLength(7)) const SizeVector outputDims = outputData-&gt;getTensorDesc().getDims(); maxNumDetectedFaces = outputDims[2]; //set input type to float32: calculations are all in float16, conversion is performed on device outputData-&gt;setPrecision(Precision::FP32);</span></span></code> </pre><br>  Sekarang poin yang paling penting: kita memuat jaringan saraf ke dalam plugin (yaitu, di NCS).  Rupanya, mengkompilasi ke format yang diinginkan adalah on the fly.  Jika program macet pada fungsi ini, jaringan saraf mungkin tidak cocok untuk perangkat ini. <br><br><pre> <code class="cpp hljs">net = plugin.LoadNetwork(netReader.getNetwork(), {});</code> </pre><br>  Dan akhirnya - kita akan membuat inferensi percobaan dan mendapatkan ukuran input (mungkin ini bisa dilakukan dengan lebih elegan).  Pertama, kami membuka permintaan untuk inferensi, lalu dari sana kami mendapatkan tautan ke blok data input, dan kami sudah meminta ukuran dari itu. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//perform single inference to get input shape (a hack) request = net.CreateInferRequestPtr(); //open inference request //we need the blob size: (batch(1) x channels(3) x H x W) inputBlob = request-&gt;GetBlob(inputName); SizeVector blobSize = inputBlob-&gt;getTensorDesc().getDims(); netInputWidth = blobSize[3]; netInputHeight = blobSize[2]; netInputChannels = blobSize[1]; request-&gt;Infer(); //close request</span></span></code> </pre><br>  Mari kita coba unggah gambar ke NCS.  Dengan cara yang sama, kita membuat permintaan untuk inferensi, mendapatkan pointer ke blok data darinya, dan dari sana kita mendapatkan pointer ke array itu sendiri.  Selanjutnya, cukup salin data dari gambar kami (ini sudah dikurangi ke ukuran yang diinginkan).  Perlu dicatat bahwa dalam <code>cv::Mat</code> dan <code>inputBlob</code> pengukuran disimpan dalam urutan yang berbeda (di OpenCV, indeks saluran berubah lebih cepat dari semua, di OpenVINO lebih lambat dari semua), sehingga memcpy sangat diperlukan.  Kemudian kita mulai inferensi asinkron. <br><br>  Mengapa tidak sinkron?  Ini akan mengoptimalkan alokasi sumber daya.  Sementara NCS mempertimbangkan jaringan saraf, Anda dapat memproses frame berikutnya - ini akan mengarah pada akselerasi yang terlihat pada Raspberry Pi. <br><br><pre> <code class="cpp hljs">cv::Mat data; ... <span class="hljs-comment"><span class="hljs-comment">//get image somehow //create request, get data blob request = net.CreateInferRequestPtr(); inputBlob = request-&gt;GetBlob(inputName); unsigned char* blobData = inputBlob-&gt;buffer().as&lt;unsigned char*&gt;(); //copy from resized frame to network input int wh = netInputHeight*netInputWidth; for (int c = 0; c &lt; netInputChannels; c++) for (int h = 0; h &lt; wh; h++) blobData[c * wh + h] = data.data[netInputChannels*h + c]; //start asynchronous inference request-&gt;StartAsync();</span></span></code> </pre><br>  Jika Anda terbiasa dengan jaringan saraf, Anda mungkin memiliki pertanyaan tentang pada titik mana kami skala nilai-nilai piksel input dari jaringan saraf (misalnya, kami membawa ke kisaran <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.66ex" viewBox="0 -832 2003.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="1724" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> [0,1] </script>  )  Faktanya adalah bahwa dalam model OpenVINO transformasi ini sudah termasuk dalam deskripsi jaringan saraf, dan ketika menggunakan detektor kami, kami akan melakukan sesuatu yang serupa.  Dan karena konversi ke float dan penskalaan input dilakukan oleh OpenVINO, kita hanya perlu mengubah ukuran gambar. <br><br>  Sekarang (setelah melakukan beberapa pekerjaan yang bermanfaat) kami akan menyelesaikan permintaan inferensi.  Program diblokir hingga hasil eksekusi datang.  Kami mendapatkan pointer ke hasilnya. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> * output; ncsCode = request-&gt;Wait(IInferRequest::WaitMode::RESULT_READY); output = request-&gt;GetBlob(outputName)-&gt;buffer().as&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*&gt;();</code> </pre><br>  Sekarang saatnya untuk memikirkan dalam format apa NCS mengembalikan hasil detektor.  Perlu dicatat bahwa formatnya sedikit berbeda dari apa ketika menggunakan NCSDK.  Secara umum, output detektor adalah empat dimensi dan memiliki dimensi (1 x 1 x jumlah maksimum deteksi x 7), kita dapat mengasumsikan bahwa ini adalah array ukuran ( <code>maxNumDetectedFaces</code> x 7). <br><br>  Parameter <code>maxNumDetectedFaces</code> diatur dalam deskripsi jaringan saraf, dan mudah untuk mengubahnya, misalnya, dalam deskripsi .prototxt dari jaringan dalam format Caffe.  Sebelumnya kami mendapatkannya dari objek yang mewakili detektor.  Parameter ini terkait dengan spesifikasi kelas detektor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SSD (Detektor Tembakan Tunggal)</a> , yang mencakup semua detektor NCS yang didukung.  SSD selalu mempertimbangkan jumlah kotak pembatas yang sama (dan sangat besar) untuk setiap gambar, dan setelah memfilter deteksi dengan tingkat kepercayaan rendah dan menghapus frame yang tumpang tindih menggunakan Penindasan Non-maksimum, mereka biasanya memberikan yang terbaik 100-200.  Inilah tepatnya parameter yang bertanggung jawab. <br><br>  Tujuh nilai dalam deskripsi satu deteksi adalah sebagai berikut: <br><br><ol><li>  nomor gambar dalam kumpulan tempat objek terdeteksi (dalam kasus kami, harus nol); </li><li>  kelas objek (0 - latar belakang, mulai dari 1 - kelas lain, hanya deteksi dengan kelas positif yang dikembalikan); </li><li>  kepercayaan akan adanya deteksi (dalam jangkauan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.66ex" viewBox="0 -832 2003.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="1724" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> [0,1] </script>  ); </li><li>  koordinat x dinormalisasi dari sudut kiri atas kotak pembatas (dalam kisaran <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.66ex" viewBox="0 -832 2003.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="1724" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> [0,1] </script>  ); </li><li>  sama - koordinat-y; </li><li>  lebar kotak pembatas dinormalisasi (dalam kisaran <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.66ex" viewBox="0 -832 2003.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="1724" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> [0,1] </script>  ); </li><li>  juga - tinggi; </li></ol><br><div class="spoiler">  <b class="spoiler_title">Kode untuk mengekstrak kotak pembatas dari keluaran detektor</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_detection_boxes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">* predictions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numPred, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> thresh, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&amp; probs, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;cv::Rect&gt;&amp; boxes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cls = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> id = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//predictions holds numPred*7 values //data format: image_id, detection_class, detection_confidence, //box_normed_x, box_normed_y, box_normed_w, box_normed_h for (int i=0; i&lt;numPred; i++) { score = predictions[i*7+2]; cls = predictions[i*7+1]; id = predictions[i*7 ]; if (id&gt;=0 &amp;&amp; score&gt;thresh &amp;&amp; cls&lt;=1) { probs.push_back(score); boxes.push_back(Rect(predictions[i*7+3]*w, predictions[i*7+4]*h, (predictions[i*7+5]-predictions[i*7+3])*w, (predictions[i*7+6]-predictions[i*7+4])*h)); } } }</span></span></code> </pre><br>  kita belajar <code>numPred</code> dari detektor itu sendiri, dan <code>w,h</code> - ukuran gambar untuk visualisasi. <br></div></div><br>  Sekarang tentang bagaimana skema umum inferensi terlihat secara real time.  Pertama kita menginisialisasi jaringan saraf dan kamera, mulai <code>cv::Mat</code> untuk frame mentah dan satu lagi untuk frame dikurangi menjadi ukuran yang diinginkan.  Kami mengisi frame kami dengan nol - ini akan menambah keyakinan bahwa pada satu awal jaringan saraf tidak akan menemukan apa pun.  Kemudian kita memulai siklus inferensi: <br><br><ul><li>  Kami memuat frame saat ini ke jaringan saraf menggunakan permintaan asinkron - NCS sudah mulai bekerja, dan saat ini kami memiliki kesempatan untuk menjadikan pekerjaan yang bermanfaat sebagai prosesor utama. </li><li>  Kami menampilkan semua deteksi sebelumnya pada bingkai sebelumnya, menggambar sebuah bingkai (jika perlu). </li><li>  Kami mendapatkan bingkai baru dari kamera, kompres ke ukuran yang diinginkan.  Untuk Raspberry, saya sarankan menggunakan algoritma pengubahan ukuran paling sederhana - di OpenCV, ini adalah interpolasi tetangga terdekat.  Ini tidak akan memengaruhi kualitas kinerja detektor, tetapi dapat menambah sedikit kecepatan.  Saya juga cermin bingkai untuk visualisasi yang mudah (opsional). </li><li>  Sekarang saatnya untuk mendapatkan hasil dengan NCS dengan menyelesaikan permintaan inferensi.  Program akan diblokir sampai hasilnya diterima. </li><li>  Kami memproses deteksi baru, pilih bingkai. </li><li>  Sisanya: bekerja dengan penekanan tombol, menghitung frame, dll. </li></ul><br><h3>  Cara mengompilasinya </h3><br>  Dalam contoh InferenceEngine, saya tidak suka file CMake yang besar, dan saya memutuskan untuk menulis ulang semuanya dengan ringkas ke dalam Makefile saya: <br><br><pre> <code class="bash hljs">g++ $(RPI_ARCH) \ -I/usr/include -I. \ -I$(OPENVINO_PATH)/deployment_tools/inference_engine/include \ -I$(OPENVINO_PATH_RPI)/deployment_tools/inference_engine/include \ -L/usr/lib/x86_64-linux-gnu \ -L/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib \ -L$(OPENVINO_PATH)/deployment_tools/inference_engine/lib/ubuntu_16.04/intel64 \ -L$(OPENVINO_PATH_RPI)/deployment_tools/inference_engine/lib/raspbian_9/armv7l \ vino.cpp wrapper/vino_wrapper.cpp \ -o demo -std=c++11 \ `pkg-config opencv --cflags --libs` \ -ldl -linference_engine $(RPI_LIBS)</code> </pre><br>  Tim ini akan bekerja pada Ubuntu dan Raspbian, berkat beberapa trik.  Jalur untuk mencari header dan pustaka dinamis yang saya tunjukkan untuk Raspberry dan mesin Ubuntu.  Dari perpustakaan, selain OpenCV, Anda juga harus menghubungkan <code>libinference_engine</code> dan <code>libdl</code> - perpustakaan untuk secara dinamis menghubungkan perpustakaan lain, diperlukan untuk membuat plugin memuat.  Pada saat yang sama, <code>libmyriadPlugin</code> sendiri tidak perlu ditentukan.  Antara lain, untuk Raspberry I juga menghubungkan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Raspicam</a> untuk bekerja dengan kamera (ini adalah <code>$(RPI_LIBS)</code> ).  Saya juga harus menggunakan standar C ++ 11. <br><br>  Secara terpisah, perlu dicatat bahwa ketika mengkompilasi pada Raspberry, <code>-march=armv7-a</code> diperlukan (ini adalah <code>$(RPI_ARCH)</code> ).  Jika Anda tidak menentukannya, program akan dikompilasi, tetapi akan macet dengan segfault diam.  Anda juga dapat menambahkan optimasi menggunakan <code>-O3</code> , ini akan menambah kecepatan. <br><br><h3>  Apa detektornya? </h3><br>  NCS hanya mendukung pendeteksi SSD Caffe dari kotak, meskipun dengan beberapa trik kotor saya berhasil menjalankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">YOLO dari format Darknet</a> di atasnya.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Single Shot Detector (SSD)</a> adalah arsitektur populer di antara jaringan saraf ringan, dan dengan bantuan enkoder yang berbeda (atau jaringan backbone) Anda dapat secara fleksibel memvariasikan rasio kecepatan dan kualitas. <br><br>  Saya akan bereksperimen dengan berbagai pendeteksi wajah: <br><br><ul><li>  YOLO, diambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> , dikonversi terlebih dahulu ke format Caffe, kemudian ke format NCS (hanya dengan NCSDK).  Gambar 448 x 448. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Detektor Mobilenet</a> + SSD saya, tentang pelatihan yang saya bicarakan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">publikasi sebelumnya</a> .  Saya masih memiliki versi terpangkas dari detektor ini, yang hanya melihat wajah-wajah kecil, dan pada saat yang sama sedikit lebih cepat.  Saya akan memeriksa versi lengkap detektor saya di NCSDK dan OpenVINO.  Gambar 300 x 300. </li><li>  Detektor deteksi wajah-adas-0001 dari OpenVINO: MobileNet + SSD.  Gambar 384 x 672. </li><li>  OpenVINO face-detection-retail-0004 detector: ringan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SqueezeNet</a> + SSD.  Gambar 300 x 300. </li></ul><br>  Untuk detektor dari OpenVINO, tidak ada skala dalam format Caffe atau format NCSDK, jadi saya hanya bisa meluncurkannya di OpenVINO. <br><br><h3>  Ubah detektor Anda menjadi format OpenVINO </h3><br>  Saya memiliki dua file dalam format Caffe: .prototxt dengan deskripsi jaringan dan .caffemodel dengan bobot.  Saya perlu mendapatkan dua file dari mereka dalam format OpenVINO: .xml dan .bin masing-masing dengan deskripsi dan bobot.  Untuk melakukan ini, gunakan skrip mo.py dari OpenVINO (alias Pengoptimal Model): <br><br><pre> <code class="bash hljs">mo.py \ --framework caffe \ --input_proto models/face/ssd-face.prototxt \ --input_model models/face/ssd-face.caffemodel \ --output_dir models/face \ --model_name ssd-vino-custom \ --mean_values [127.5,127.5,127.5] \ --scale_values [127.5,127.5,127.5] \ --data_type FP16</code> </pre><br>  <code>output_dir</code> menentukan direktori di mana file baru akan dibuat, <code>model_name</code> adalah nama untuk file baru tanpa ekstensi, <code>data_type (FP16/FP32)</code> adalah jenis keseimbangan dalam jaringan saraf (NCS hanya mendukung FP16).  <code>mean_values, scale_values</code> menetapkan rata-rata dan skala untuk memproses ulang gambar sebelum diluncurkan ke jaringan saraf.  Konversi spesifik terlihat seperti ini: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-25"><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">l</span><span class="MJXp-msubsup" id="MJXp-Span-32"><span class="MJXp-mtext" id="MJXp-Span-33" style="margin-right: 0.05em;">&nbsp;</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-34" style="vertical-align: -0.4em;">v</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">s</span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0em; margin-right: 0.222em;">​</span><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0em; margin-right: 0.222em;">​</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">n</span><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mtext" id="MJXp-Span-48" style="margin-right: 0.05em;">&nbsp;</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">v</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">s</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mrow" id="MJXp-Span-56"><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">a</span><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mtext" id="MJXp-Span-64" style="margin-right: 0.05em;">&nbsp;</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">v</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">s</span><span class="MJXp-mo" id="MJXp-Span-71" style="margin-left: 0em; margin-right: 0.222em;">​</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0.222em;">​</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.333ex" height="2.66ex" viewBox="0 -832 18657.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-70" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-69" x="893" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-78" x="1238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-65" x="1811" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6C" x="2277" y="0"></use><g transform="translate(2576,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-76" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="3269" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6C" x="3798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-75" x="4097" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-65" x="4669" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-73" x="5136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2212" x="5939" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6D" x="6717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-65" x="7596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="8062" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6E" x="8592" y="0"></use><g transform="translate(9192,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-76" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="9885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6C" x="10415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-75" x="10713" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-65" x="11286" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-73" x="11752" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-29" x="12222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2F" x="12611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-73" x="13112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6B" x="13581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="14103" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6C" x="14632" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="14931" y="0"></use><g transform="translate(15460,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-76" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-61" x="16154" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-6C" x="16683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-75" x="16982" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-65" x="17554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMATHI-73" x="18021" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> (pixel \ _values ​​- mean \ _values) / skala \ _values ​​</script></p><br><br>  Dalam hal ini, nilainya dikonversi dari kisaran <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-mo" id="MJXp-Span-74" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-75">0</span><span class="MJXp-mo" id="MJXp-Span-76" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-77">255</span><span class="MJXp-mo" id="MJXp-Span-78" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.977ex" height="2.66ex" viewBox="0 -832 3004.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="2725" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> [0,255] </script>  dalam jangkauan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-79"><span class="MJXp-mo" id="MJXp-Span-80" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-81">0</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-83">1</span><span class="MJXp-mo" id="MJXp-Span-84" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.66ex" viewBox="0 -832 2003.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/436744/&amp;usg=ALkJrhgG0dCJIgx4XXZjQV1FW_0J7Tsffg#MJMAIN-5D" x="1724" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> [0,1] </script>  .  Secara umum, skrip ini memiliki banyak parameter, beberapa di antaranya khusus untuk kerangka kerja individual, saya sarankan Anda melihat manual untuk skrip. <br><br>  Distribusi OpenVINO untuk Raspberry tidak memiliki model yang sudah jadi, tetapi cukup mudah untuk diunduh. <br><br><div class="spoiler">  <b class="spoiler_title">Misalnya, seperti ini.</b> <div class="spoiler_text"><pre> <code class="bash hljs"> wget --no-check-certificate \ https://download.01.org/openvinotoolkit/2018_R4/open_model_zoo/face-detection-retail-0004/FP16/face-detection-retail-0004.xml \ -O ./models/face/vino.xml; \ wget --no-check-certificate \ https://download.01.org/openvinotoolkit/2018_R4/open_model_zoo/face-detection-retail-0004/FP16/face-detection-retail-0004.bin \ -O ./models/face/vino.bin</code> </pre><br></div></div><br><h3>  Perbandingan detektor dan kerangka kerja </h3><br>  Saya menggunakan tiga opsi perbandingan: 1) Mesin NCS + Virtual dengan Ubuntu 16.04, prosesor Core i7, konektor USB 3.0;  2) NCS + Mesin yang sama, konektor USB 3.0 + kabel USB 2.0 (akan ada lebih banyak penundaan dalam pertukaran dengan perangkat);  3) NCS + Raspberry Pi 2 model B, Raspbian Stretch, konektor USB 2.0 + kabel USB 2.0. <br><br>  Saya memulai detektor saya dengan OpenVINO dan NCSDK2, detektor dari OpenVINO hanya dengan framework asli mereka, YOLO hanya dengan NCSDK2 (kemungkinan besar, itu juga dapat dijalankan pada OpenVINO). <br><br>  Tabel FPS untuk detektor yang berbeda terlihat seperti ini (angka perkiraan): <br><br><table><tbody><tr><th>  Model </th><th>  USB 3.0 </th><th>  USB 2.0 </th><th>  Raspberry pi </th></tr><tr><td>  SSD khusus dengan NCSDK2 </td><td>  10.8 </td><td>  9.3 </td><td>  7.2 </td></tr><tr><td>  SSD longrange khusus dengan NCSDK2 </td><td>  11.8 </td><td>  10.0 </td><td>  7.3 </td></tr><tr><td>  YOLO v2 dengan NCSDK2 </td><td>  5.3 </td><td>  4.6 </td><td>  3.6 </td></tr><tr><td>  SSD khusus dengan OpenVINO </td><td>  10.6 </td><td>  9.9 </td><td>  7.9 </td></tr><tr><td>  OpenVINO deteksi wajah-ritel-0004 </td><td>  15.6 </td><td>  14.2 </td><td>  9.3 </td></tr><tr><td>  OpenVINO face-detection-adas-0001 </td><td>  5.8 </td><td>  5.5 </td><td>  3.9 </td></tr></tbody></table><br><br>  <em>Catatan: kinerja diukur untuk seluruh program demo, termasuk pemrosesan dan visualisasi bingkai.</em> <br><br>  YOLO adalah yang paling lambat dan paling tidak stabil dari semua.  Ini sangat sering melewati deteksi dan tidak dapat bekerja dengan bingkai yang menyala. <br><br>  Detektor yang saya latih bekerja dua kali lebih cepat, lebih tahan terhadap distorsi dalam bingkai, dan bahkan mendeteksi wajah kecil.  Namun, kadang-kadang masih melewatkan deteksi dan kadang-kadang mendeteksi yang salah.  Jika Anda memotong beberapa lapisan terakhir dari itu, itu akan menjadi sedikit lebih cepat, tetapi itu akan berhenti melihat wajah besar.  Detektor yang sama yang diluncurkan melalui OpenVINO menjadi sedikit lebih cepat ketika menggunakan USB 2.0, kualitasnya tidak berubah secara visual. <br><br>  Detektor OpenVINO, tentu saja, jauh lebih unggul daripada YOLO dan detektor saya.  (Saya bahkan tidak akan mulai melatih detektor saya jika OpenVINO ada dalam bentuk saat ini pada waktu itu).  Model retail-0004 secara signifikan lebih cepat dan pada saat yang sama secara praktis tidak ketinggalan, tetapi saya sedikit berhasil mengelabuinya (walaupun kepercayaan terhadap deteksi ini rendah): <br><br><img src="https://habrastorage.org/webt/uj/ap/nl/ujapnlbjzkipljlzklgyvjzked4.png"><br>  <em>Serangan kompetitif kecerdasan alami pada buatan</em> <br><br>  Detektor adas-0001 jauh lebih lambat, tetapi berfungsi dengan gambar besar dan harus lebih akurat.  Saya tidak melihat perbedaannya, tetapi saya memeriksa frame yang cukup sederhana. <br><br><h4>  Kesimpulan </h4><br>  Secara umum, sangat bagus bahwa pada perangkat berdaya rendah seperti Raspberry Pi Anda dapat menggunakan jaringan saraf, dan bahkan dalam waktu yang hampir nyata.  OpenVINO menyediakan fungsionalitas yang sangat luas untuk inferensi jaringan saraf pada banyak perangkat yang berbeda - jauh lebih luas daripada yang saya jelaskan dalam artikel ini.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saya pikir Neural Compute Stick dan OpenVINO akan sangat berguna dalam penelitian robot saya. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436744/">https://habr.com/ru/post/id436744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436716/index.html">Pintu Palsu sebagai bagian dari Pengembangan Pelanggan</a></li>
<li><a href="../id436718/index.html">Pengalaman pribadi: Lima tantangan saat memulai bisnis di AS</a></li>
<li><a href="../id436720/index.html">Ada pendapat: IPv6 gagal - siapa yang berpikir begitu dan mengapa</a></li>
<li><a href="../id436728/index.html">Panduan ML.NET - Aplikasi Pertama dalam 10 Menit</a></li>
<li><a href="../id436742/index.html">Android Robotics hingga 2019: Kisah nyata; dalam 5 bagian; bagian 1</a></li>
<li><a href="../id436746/index.html">Cara menurunkan kinerja dengan meningkatkannya</a></li>
<li><a href="../id436748/index.html">Mengembangkan hexapod dari awal (bagian 3) - kinematika</a></li>
<li><a href="../id436750/index.html">Tren analisis YouTube Rusia untuk 2018</a></li>
<li><a href="../id436752/index.html">Kue itu bohong</a></li>
<li><a href="../id436754/index.html">Q2VKPT: Quake II yang sepenuhnya ditulis ulang dengan pencahayaan realistis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>