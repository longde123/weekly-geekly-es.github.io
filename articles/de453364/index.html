<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è¨ üèïÔ∏è üõÇ Eine Rollout-Geschichte, die alles betraf üß§ üå∞ üßóüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Feinde der Wirklichkeit von 12f-2 

 Ende April, als die wei√üen Wanderer Winterfell belagerten, passierte uns etwas Interessanteres, machten wir einen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine Rollout-Geschichte, die alles betraf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/453364/"><img src="https://habrastorage.org/webt/kc/5y/q_/kc5yq_bh4rgol9q8lebwmzsldca.jpeg"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Feinde der Wirklichkeit</a> von 12f-2</i> <br><br>  Ende April, als die wei√üen Wanderer Winterfell belagerten, passierte uns etwas Interessanteres, machten wir einen ungew√∂hnlichen Roll-out.  Im Prinzip rollen wir st√§ndig neue Funktionen in das Produkt (wie alle anderen auch).  Aber dieser war nicht wie alle anderen.  Das Ausma√ü war so bemessen, dass potenzielle Fehler, die wir machen k√∂nnten, alle unsere Dienste und Benutzer betreffen w√ºrden.  Infolgedessen haben wir alles planm√§√üig in der geplanten und angek√ºndigten Ausfallzeit ohne Konsequenzen f√ºr den Verkauf eingef√ºhrt.  Der Artikel handelt davon, wie wir dies erreicht haben und wie diejenigen, die dies w√ºnschen, dies zu Hause wiederholen k√∂nnen. <br><a name="habracut"></a><br>  Ich werde jetzt nicht unsere architektonischen und technischen Entscheidungen beschreiben, sondern erkl√§ren, wie alles funktioniert.  Dies sind eher Randbemerkungen dar√ºber, wie einer der schwierigsten Rollouts stattgefunden hat, den ich beobachtet habe und an dem ich direkt teilgenommen habe.  Ich gebe nicht vor, vollst√§ndige oder technische Details zu sein, vielleicht erscheinen sie in einem anderen Artikel. <br><br><h2>  Hintergrund + welche Art von Funktionalit√§t ist das? </h2><br>  Wir bauen die Cloud-Plattform <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mail.ru Cloud Solutions</a> (MCS) auf, auf der ich als CTO arbeite.  Und jetzt ist es an der Zeit, eine Verbindung zu unserer Plattform IAM (Identity and Access Management) herzustellen, die eine einheitliche Verwaltung aller Benutzerkonten, Benutzer, Kennw√∂rter, Rollen, Dienste und mehr bietet.  Warum es in der Cloud ben√∂tigt wird, ist eine offensichtliche Frage: Es speichert alle Benutzerinformationen. <br><br>  Normalerweise beginnen solche Dinge zu Beginn eines Projekts aufzubauen.  Aber MCS war historisch gesehen etwas anders.  MCS wurde in zwei Teilen gebaut: <br><br><ul><li>  Openstack mit eigenem Keystone-Autorisierungsmodul, </li><li>  Hotbox (S3-Speicher) basierend auf dem Projekt Cloud Mail.ru, </li></ul><br>  um welche neue Dienste erschienen dann. <br><br>  Im Wesentlichen handelte es sich dabei um zwei verschiedene Arten von Genehmigungen.  Au√üerdem haben wir einige separate Mail.ru-Entwicklungen verwendet, beispielsweise den allgemeinen Mail.ru-Kennwortspeicher sowie einen selbstgeschriebenen OpenID-Connector, der SSO (Pass-Through-Autorisierung) im Horizon-Bereich virtueller Maschinen (native UI OpenStack) aktiviert. <br><br>  IAM zu machen bedeutete f√ºr uns, all dies in einem einzigen System zu kombinieren, ganz unserem eigenen.  Verlieren Sie gleichzeitig keine Funktionalit√§t, schaffen Sie eine Reserve f√ºr die Zukunft, die es uns erm√∂glicht, sie transparent zu √§ndern, ohne sie umzugestalten, und sie hinsichtlich der Funktionalit√§t zu skalieren.  Ebenfalls zu Beginn erschienen die Benutzer als Vorbild f√ºr den Zugriff auf Dienste (zentraler RBAC, rollenbasierte Zugriffskontrolle) und einige andere Kleinigkeiten. <br><br>  Die Aufgabe erwies sich als nicht trivial: Python und Perl, mehrere Backends, unabh√§ngig geschriebene Services, mehrere Entwicklungsteams und Administratoren.  Und vor allem Tausende von Live-Benutzern im Kampfproduktionssystem.  All dies musste geschrieben und vor allem ohne Verluste eingef√ºhrt werden. <br><br><h2>  Was werden wir ausrollen? </h2><br>  Wenn es sehr unh√∂flich ist, haben wir dies in 4 Monaten vorbereitet: <br><br><ul><li>  Sie machten mehrere neue D√§monen, die Funktionen aggregierten, die zuvor in verschiedenen Teilen der Infrastruktur funktionierten.  Anderen Diensten wurde ein neues Backend in Form dieser D√§monen verschrieben. </li><li>  Wir haben unser eigenes zentrales Repository mit Passw√∂rtern und Schl√ºsseln erstellt, das f√ºr alle unsere Dienste verf√ºgbar ist und bei Bedarf frei ge√§ndert werden kann. </li><li>  Von Grund auf haben sie 4 neue Backends f√ºr Keystone geschrieben (Benutzer, Projekte, Rollen, Rollenzuweisungen), die tats√§chlich ihre Basis ersetzten und jetzt als ein einziges Repository unserer Benutzerkennw√∂rter fungieren. </li><li>  Wir haben allen unseren Openstack-Diensten beigebracht, ihre Richtlinien einem Richtliniendienst eines Drittanbieters zuzuweisen, anstatt diese Richtlinien lokal von jedem Server zu lesen (ja, standardm√§√üig funktioniert Openstack so!). </li></ul><br>  Eine solch gro√üe √Ñnderung erfordert gro√üe, komplexe und vor allem synchrone √Ñnderungen in mehreren Systemen, die von verschiedenen Entwicklungsteams geschrieben wurden.  Nach der Montage sollte das gesamte System funktionieren. <br><br>  Wie kann man solche √Ñnderungen einf√ºhren und nicht vermasseln?  Zuerst haben wir uns entschlossen, ein wenig in die Zukunft zu schauen. <br><br><h2>  Rollout-Strategie </h2><br><ul><li>  Die Einf√ºhrung w√§re in mehreren Schritten m√∂glich, dies w√ºrde jedoch die Entwicklungszeit um das Dreifache verl√§ngern.  Au√üerdem h√§tten wir f√ºr einige Zeit eine vollst√§ndige Desynchronisation der Daten in den Datenbanken.  Ich m√ºsste meine eigenen Synchronisationstools schreiben und lange mit mehreren Data Warehouses leben.  Und das birgt eine Vielzahl von Risiken. </li><li>  Alles, was sie transparent f√ºr den Benutzer vorbereiten konnten, wurde im Voraus erledigt.  Es hat 2 Monate gedauert. </li><li>  Wir haben uns mehrere Stunden Ausfallzeit geg√∂nnt - nur f√ºr Benutzeroperationen, um Ressourcen zu erstellen und zu √§ndern. </li><li>  F√ºr die Arbeit aller bereits erstellten Ressourcen waren Ausfallzeiten nicht akzeptabel.  Wir haben geplant, dass die Ressourcen bei der Einf√ºhrung ohne Ausfallzeiten funktionieren und sich auf die Kunden auswirken. </li><li>  Um die Auswirkungen auf unsere Kunden zu verringern, haben wir uns entschlossen, am Sonntagabend den Rollout durchzuf√ºhren, falls etwas schief geht.  Nachts verwalten weniger Kunden virtuelle Maschinen. </li><li>  Wir haben alle unsere Kunden gewarnt, dass w√§hrend des f√ºr die Einf√ºhrung ausgew√§hlten Zeitraums kein Servicemanagement verf√ºgbar sein wird. </li></ul><br><h2>  Exkurs: Was ist Roll-out? </h2><br>  <i>&lt;Vorsicht Philosophie&gt;</i> <br><br>  Jeder IT-Spezialist kann leicht beantworten, was Rollout ist.  Sie legen CI / CD ein und automatisch wird alles an das Produkt geliefert.  :) :) <br><br>  Das ist nat√ºrlich wahr.  Die Schwierigkeit besteht jedoch darin, dass mit modernen Tools zur Automatisierung der Codebereitstellung das Verst√§ndnis des Rollens selbst verloren geht.  Wie vergisst man die epische Erfindung des Rades bei modernen Fahrzeugen?  Alles ist so automatisiert, dass die Einf√ºhrung oft ohne Realisierung des gesamten Bildes erfolgt. <br><br>  Und das ganze Bild ist wie folgt.  Der Rollout besteht aus vier gro√üen Aspekten: <br><br><ol><li>  Codezustellung, einschlie√ülich Daten√§nderung.  Zum Beispiel ihre Migration. </li><li>  Code-Rollback - die M√∂glichkeit, zur√ºckzukehren, wenn etwas schief geht.  Zum Beispiel durch die Erstellung von Backups. </li><li>  Die Zeit jedes Rollout- / Rollback-Vorgangs.  Man muss den Zeitpunkt jeder Operation der ersten beiden Punkte verstehen. </li><li>  Betroffene Funktionalit√§t.  Es ist notwendig, sowohl die erwarteten positiven als auch die m√∂glichen negativen Auswirkungen zu bewerten. </li></ol><br>  All diese Aspekte m√ºssen f√ºr eine erfolgreiche Einf√ºhrung ber√ºcksichtigt werden.  Normalerweise bewerten sie nur den ersten, bestenfalls den zweiten Punkt, und dann wird der Rollout als erfolgreich angesehen.  Aber der dritte und vierte sind noch wichtiger.  Welchem ‚Äã‚ÄãBenutzer wird es gefallen, wenn der Rollout 3 Stunden statt einer Minute dauert?  Oder wenn etwas √úberfl√ºssiges den Rollout beeinflusst?  Oder f√ºhrt eine Ausfallzeit eines Dienstes zu unvorhersehbaren Konsequenzen? <br><br><h2>  Akt 1..n, Vorbereitung auf die Freilassung </h2><br>  Zuerst dachte ich daran, unsere Meetings kurz zu beschreiben: das gesamte Team, seine Teile, jede Menge Diskussionen √ºber Kaffeepunkte, Streitigkeiten, Tests, Brainstorms.  Dann dachte ich, dass es √ºberfl√ºssig w√§re.  Daraus bestehen immer vier Monate Entwicklungszeit, insbesondere wenn Sie nicht etwas schreiben, das st√§ndig geliefert werden kann, sondern ein gro√ües Merkmal eines lebenden Systems.  Dies betrifft alle Dienste, aber Benutzer sollten nichts au√üer der "einen Schaltfl√§che in der Weboberfl√§che" √§ndern. <br><br>  Unser Verst√§ndnis f√ºr die Einf√ºhrung hat sich von jedem neuen Meeting an erheblich ge√§ndert.  Zum Beispiel wollten wir unsere gesamte Abrechnungsbasis aktualisieren.  Sie berechneten jedoch die Zeit und stellten fest, dass dies in einer angemessenen Roll-out-Zeit nicht m√∂glich war.  Wir haben fast eine zus√§tzliche Woche gebraucht, um die Abrechnungsdatenbank zu speichern und zu archivieren.  Und als die erwartete Rollout-Geschwindigkeit danach nicht funktionierte, bestellten sie ein zus√§tzliches, st√§rkeres Eisen, bei dem sie die gesamte Basis schleppten.  Nicht, dass wir dies nicht fr√ºher tun wollten, aber die derzeitige Notwendigkeit der Einf√ºhrung lie√ü uns keine Optionen. <br><br>  Wenn einer von uns Zweifel hatte, dass die Einf√ºhrung die Verf√ºgbarkeit unserer virtuellen Maschinen beeintr√§chtigen k√∂nnte, verbrachten wir eine Woche damit, Tests und Experimente durchzuf√ºhren, den Code zu analysieren und ein klares Verst√§ndnis daf√ºr zu erlangen, dass dies in unserer Produktion nicht passieren w√ºrde, und selbst die zweifelhaftesten Leute stimmten dem zu. <br><br>  In der Zwischenzeit f√ºhrten die Techniker ihre unabh√§ngigen Experimente durch, um den Kunden Anweisungen zum Verbinden zu schreiben, die sich nach der Einf√ºhrung √§ndern sollten.  Sie arbeiteten an einer benutzerfreundlichen UX, bereiteten Anweisungen vor und gaben pers√∂nliche Ratschl√§ge. <br><br>  Wir haben alle m√∂glichen Roll-out-Vorg√§nge automatisiert.  Jede Operation wurde per Skript ausgef√ºhrt, selbst die einfachste, f√ºhrte st√§ndig Tests durch.  Sie diskutierten dar√ºber, wie der Dienst am besten deaktiviert werden kann - senken Sie den D√§mon oder blockieren Sie den Zugriff auf den Dienst mit einer Firewall.  F√ºr jede Phase der Einf√ºhrung wurde eine Checkliste mit Teams erstellt, die st√§ndig aktualisiert wurde.  Wir haben das Gantt-Diagramm f√ºr alle Rollout-Arbeiten mit Zeitangaben erstellt und st√§ndig aktualisiert. <br><br>  Und so ... <br><br><h2>  Letzter Akt vor dem Rollout </h2><br>  ... es ist Zeit auszurollen. <br><br>  Wie das Sprichwort sagt, kann ein Kunstwerk nicht fertiggestellt werden, nur um die Arbeit daran zu beenden.  Es ist notwendig, eine willensstarke Anstrengung zu unternehmen, um zu verstehen, dass Sie nicht alles finden, aber zu glauben, dass Sie alle vern√ºnftigen Annahmen getroffen, alle m√∂glichen F√§lle ber√ºcksichtigt, alle kritischen Fehler geschlossen und alle Teilnehmer alles getan haben, was sie konnten.  Je mehr Code Sie einf√ºhren, desto schwieriger ist es, sich davon zu √ºberzeugen (au√üerdem versteht jeder, dass es unm√∂glich ist, alles vorherzusehen). <br><br>  Wir haben uns f√ºr die Einf√ºhrung entschieden, als wir davon √ºberzeugt waren, dass wir alles getan haben, um alle Risiken f√ºr unsere Benutzer zu schlie√üen, die mit unerwarteten Auswirkungen und Ausfallzeiten verbunden sind.  Das hei√üt - alles kann schief gehen, au√üer: <br><br><ol><li>  Der Einfluss (der uns heilig ist, der wertvollste) auf die Benutzerinfrastruktur, </li><li>  Funktionalit√§t: Die Nutzung unseres Dienstes nach der Einf√ºhrung sollte dieselbe sein wie zuvor. </li></ol><br><h2>  Ausrollen </h2><br><img src="https://habrastorage.org/webt/mx/vt/yq/mxvtyqnl26yvqbxhego52zj9d8c.png"><br>  <i>Zwei rollen, 8 st√∂ren nicht</i> <br><br>  Wir nehmen uns Ausfallzeiten f√ºr alle Anfragen von Benutzern innerhalb von 7 Stunden.  Derzeit haben wir sowohl einen Rollout-Plan als auch einen Rollback-Plan. <br><br><ul><li>  Der Rollout selbst dauert ca. 3 Stunden. </li><li>  2 Stunden - zum Testen. </li><li>  2 Stunden - eine Reserve f√ºr einen m√∂glichen Rollback von √Ñnderungen. </li></ul><br>  F√ºr jede Aktion wurde ein Gantt-Diagramm erstellt, wie viel Zeit es dauert, was nacheinander abl√§uft, was parallel ausgef√ºhrt wird. <br><br><img src="https://habrastorage.org/webt/gl/4v/2p/gl4v2pcxxorqbzzhuvlbdsi0jtg.png"><br>  <i>Ein Ausschnitt aus dem Gantt-Rollout-Diagramm, einer der fr√ºheren Versionen (ohne parallele Ausf√ºhrung).</i>  <i>Das wertvollste Synchronisationswerkzeug</i> <br><br>  Alle Teilnehmer haben ihre Rolle bei der Einf√ºhrung, welche Aufgaben sie erledigen und f√ºr welche sie verantwortlich sind.  Wir versuchen, jede Stufe automatisch zu machen, zur√ºckzusetzen, Feedback zu sammeln und erneut zu rollen. <br><br><h3>  Chronik der Ereignisse </h3><br>  Also kamen am Sonntag, den 28. April, um 22 Uhr 15 Leute zur Arbeit.  Neben den wichtigsten Teilnehmern kamen einige nur, um das Team zu unterst√ºtzen, wof√ºr sie sich besonders bedanken. <br><br>  Unabh√§ngig davon ist es erw√§hnenswert, dass unser Schl√ºsseltester im Urlaub ist.  Es ist unm√∂glich, ohne Tests auszurollen, wir arbeiten an Optionen.  Eine Kollegin erkl√§rt sich bereit, uns au√üerhalb des Urlaubs zu testen, wof√ºr sie vom gesamten Team unermesslich dankbar ist. <br><br>  <b>00:00.</b>  <b>H√∂r auf</b> <br>  Wir stoppen Benutzeranfragen, h√§ngen das Typenschild auf, sagen sie, technische Arbeit.  √úberwachung schreit, aber alles ist normal.  Wir √ºberpr√ºfen, dass nichts gefallen ist, au√üer dass es fallen sollte.  Und wir beginnen mit der Arbeit an der Migration. <br><br>  Jeder hat einen gedruckten Rollout-Plan f√ºr die Punkte, jeder wei√ü, wer was zu welchem ‚Äã‚ÄãZeitpunkt tut.  Nach jeder Aktion √ºberpr√ºfen wir die Zeiten, die sie nicht √ºberschreiten, und alles l√§uft nach Plan.  Diejenigen, die derzeit nicht direkt am Rollout beteiligt sind, bereiten sich darauf vor, indem sie ein Online-Spielzeug (Xonotic, Typ 3 Kwaki) starten, um die Kollegen nicht zu st√∂ren.  :) :) <br><br>  <b>02:00 Uhr</b>  <b>Ausgerollt</b> <br>  Eine angenehme √úberraschung: Wir haben die Einf√ºhrung eine Stunde fr√ºher abgeschlossen, da unsere Datenbanken und Migrationsskripte optimiert wurden.  Der universelle Schrei "ausgerollt!"  Alle neuen Funktionen im Produkt, aber bisher k√∂nnen nur wir die Schnittstelle sehen.  Jeder geht in den Testmodus, sortiert in Haufen und beginnt zu schauen, was am Ende passiert ist. <br><br>  Es hat nicht sehr gut geklappt, wir verstehen dies nach 10 Minuten, wenn nichts verbunden ist und in den Projekten der Teammitglieder nicht funktioniert.  Schnelle Synchronisierung, √Ñu√üerung unserer Probleme, Priorisierung, Aufteilung in Teams und Debuggen. <br><br>  <b>2:30 Uhr morgens</b>  <b>Zwei gro√üe Probleme gegen vier Augen</b> <br>  Wir finden zwei gro√üe Probleme.  Wir haben festgestellt, dass Kunden einige verbundene Dienste nicht sehen und es Probleme mit Partnerkonten geben wird.  Beide sind f√ºr einige Randf√§lle mit unvollst√§ndigen Migrationsskripten verkn√ºpft.  Wir m√ºssen es jetzt reparieren. <br><br>  Wir schreiben Abfragen, die dies beheben, mindestens 4 Augen.  Wir rollen auf das Pre-Gate, um sicherzustellen, dass sie funktionieren und nichts kaputt machen.  Sie k√∂nnen weiter rollen.  Parallel dazu beginnen unsere √ºblichen Integrationstests, bei denen einige weitere Probleme festgestellt werden.  Alle von ihnen sind klein, m√ºssen aber auch repariert werden. <br><br>  <b>03:00 Uhr</b>  <b>-2 Probleme +2 Probleme</b> <br>  Die beiden vorherigen gro√üen Probleme sind behoben, fast alle kleineren auch.  Alle, die nicht mit Korrekturen besch√§ftigt sind, arbeiten aktiv in ihren Konten und berichten, was sie finden.  Wir priorisieren, verteilen nach Befehlen und lassen am Morgen unkritisch. <br><br>  Wenn Sie die Tests erneut ausf√ºhren, werden zwei neue gro√üe Probleme festgestellt.  Nicht alle Servicerichtlinien sind korrekt angekommen, daher werden einige Benutzeranforderungen nicht authentifiziert.  Plus ein neues Problem mit Partnerkonten.  Wir beeilen uns zu sehen. <br><br>  <b>03:20.</b>  <b>Notsynchronisation</b> <br>  Ein neues Problem wurde behoben.  Zum zweiten arrangieren wir eine Notsynchronisation.  Wir verstehen, was passiert: Das vorherige Update hat ein Problem behoben, aber ein anderes erstellt.  Wir machen eine Pause, um herauszufinden, wie man es richtig und ohne Konsequenzen macht. <br><br>  <b>03:30 Uhr</b>  <b>Sechs Augen</b> <br>  Wir sind uns bewusst, wie der Endzustand der Basis aussehen sollte, damit alles f√ºr alle Partner gut ist.  Wir schreiben eine Anfrage in 6 Augen, rollen auf der Vorstange, testen, rollen auf dem Sto√ü. <br><br>  <b>04:00.</b>  <b>Alles arbeitet</b> <br>  Alle Tests bestanden, keine kritischen Probleme sind sichtbar.  Von Zeit zu Zeit funktioniert etwas in einem Team nicht, wir reagieren schnell.  Meistens ist der Alarm falsch.  Aber manchmal hat etwas nicht erreicht, irgendwo funktioniert eine separate Seite nicht.  Wir sitzen, reparieren, reparieren, reparieren.  Ein separates Team startet das letzte gro√üe Feature - die Abrechnung. <br><br>  <b>04:30.</b>  <b>Punkt ohne R√ºckkehr</b> <br>  Der Punkt ohne Wiederkehr n√§hert sich, dh der Zeitpunkt, zu dem wir, wenn wir mit dem Zur√ºckrollen beginnen, die uns gegebenen Ausfallzeiten nicht einhalten werden.  Es gibt Probleme mit der Abrechnung, die alles wei√ü und aufschreibt, aber hartn√§ckig kein Geld von Kunden abschreiben will.  Es gibt mehrere Fehler auf einzelnen Seiten, Aktionen und Status.  Die Hauptfunktionalit√§t funktioniert, alle Tests bestehen erfolgreich.  Wir entscheiden, dass der Rollout stattgefunden hat, wir werden nicht zur√ºckrollen. <br><br>  <b>06:00 Uhr</b>  <b>Wir √∂ffnen √ºberhaupt in der Benutzeroberfl√§che</b> <br>  Fehler sind behoben.  Einige nicht betroffene Benutzer bleiben f√ºr sp√§ter √ºbrig.  Wir √∂ffnen die Schnittstelle f√ºr alle.  Wir beschw√∂ren weiterhin die Abrechnung, warten auf das Feedback der Benutzer und √ºberwachen die Ergebnisse. <br><br>  <b>07:00 Uhr</b>  <b>Probleme beim Laden der API</b> <br>  Es wird deutlich, dass wir eine etwas falsch geplante Auslastung unserer API haben und diese Auslastung testen, wodurch das Problem nicht identifiziert werden konnte.  Infolgedessen schlagen 5% der Anforderungen fehl.  Wir mobilisieren und suchen nach einem Grund. <br><br>  Abrechnung ist hartn√§ckig, will auch nicht arbeiten.  Wir beschlie√üen, es auf sp√§ter zu verschieben, um √Ñnderungen in einem ruhigen Modus vorzunehmen.  Das hei√üt, alle darin enthaltenen Ressourcen werden akkumuliert, aber Abschreibungen von Kunden werden nicht bestanden.  Dies ist nat√ºrlich ein Problem, aber im Vergleich zur allgemeinen Einf√ºhrung scheint es nicht grundlegend zu sein. <br><br>  <b>08:00.</b>  <b>API korrigieren</b> <br>  Wir haben einen Fix f√ºr die Ladung herausgebracht, der ausf√§llt.  Wir fangen an nach Hause zu gehen. <br><br>  <b>10 Uhr morgens</b>  <b>Alle</b> <br>  Alles ist fest.  Bei der √úberwachung und wenn die Kunden ruhig sind, geht das Team nach und nach ins Bett.  Die Abrechnung bleibt bestehen, wir werden sie morgen wiederherstellen. <br><br>  Tags√ºber gab es dann Rollouts, in denen die Protokolle, Benachrichtigungen, R√ºckkehrcodes und benutzerdefinierten Codes einiger unserer Kunden korrigiert wurden. <br><br>  Der Rollout war also erfolgreich!  Es k√∂nnte nat√ºrlich besser sein, aber wir haben Schlussfolgerungen dar√ºber gezogen, was wir nicht genug hatten, um Perfektion zu erreichen. <br><br><h2>  Insgesamt </h2><br>  Innerhalb von zwei Monaten nach der aktiven Vorbereitung auf die Einf√ºhrung wurden 43 Aufgaben erledigt, die einige Stunden bis zu mehreren Tagen dauerten. <br><br>  W√§hrend des Rollouts: <br><br><ul><li>  neue und ver√§nderte D√§monen - 5 Teile, die 2 Monolithen ersetzen; </li><li>  √Ñnderungen innerhalb der Datenbanken - Alle 6 unserer Datenbanken mit Benutzerdaten sind betroffen. Das Entladen von drei alten auf eine neue Datenbank ist abgeschlossen. </li><li>  Frontend komplett √ºberarbeitet; </li><li>  die Anzahl der abgepumpten Codes - 33.000 Zeilen neuen Codes, ‚âà 3.000 Zeilen Code in den Tests, ‚âà 5.000 Zeilen Migrationscode; </li><li>  Alle Daten sind intakt, keine einzige virtuelle Maschine des Kunden hat darunter gelitten.  :) :) </li></ul><br><h2>  Gute Praktiken f√ºr eine gute Einf√ºhrung </h2><br>  Wir wurden in dieser schwierigen Situation von ihnen gef√ºhrt.  Im Allgemeinen ist es jedoch n√ºtzlich, sie bei jeder Einf√ºhrung zu beobachten.  Aber je schwieriger der Rollout, desto gr√∂√üer die Rolle, die sie spielen. <br><br><ol><li>  Das erste, was Sie tun m√ºssen, ist zu verstehen, wie sich Rollout auf Benutzer auswirken oder auswirken kann.  Wird es Ausfallzeiten geben?  Wenn ja, was ist dann Ausfallzeit?  Wie wirkt sich das auf die Benutzer aus?  Was sind die besten und schlechtesten Szenarien?  Und schlie√üen Sie die Risiken. </li><li>  Planen Sie alles.  In jeder Phase m√ºssen Sie alle Aspekte der Einf√ºhrung verstehen: <br><ul><li>  Code-Lieferung; </li><li>  Code-Rollback; </li><li>  Zeit jeder Operation; </li><li>  betroffene Funktionalit√§t. </li></ul></li><li>  Spielen Sie Szenarien, bis alle Roll-out-Phasen sowie die Risiken f√ºr jede Phase klar sind.  Im Zweifelsfall k√∂nnen Sie eine Pause einlegen und die zweifelhafte Phase separat erkunden. </li><li>  Jede Phase kann und sollte verbessert werden, wenn dies unseren Benutzern hilft.  Dies reduziert beispielsweise Ausfallzeiten oder beseitigt einige Risiken. </li><li>  Das Testen des Rollbacks ist viel wichtiger als das Testen der Codebereitstellung.  Es muss √ºberpr√ºft werden, ob das System infolge des Rollbacks in seinen urspr√ºnglichen Zustand zur√ºckkehrt. Best√§tigen Sie dies mit Tests. </li><li>  Alles, was automatisiert werden kann, muss automatisiert werden.  Alles, was nicht automatisiert werden kann, muss auf dem Spickzettel vorab geschrieben werden. </li><li>  Erfolgskriterien aufzeichnen.  Welche Funktionen sollten zu welchem ‚Äã‚ÄãZeitpunkt verf√ºgbar sein?  Wenn dies nicht der Fall ist, starten Sie einen Rollback-Plan. </li><li>  Und vor allem Menschen.  Jeder sollte wissen, was er tut, wof√ºr und was von seinen Aktionen bei der Einf√ºhrung abh√§ngt. </li></ol><br>  Und wenn in einem Satz, dann k√∂nnen Sie mit guter Planung und Ausarbeitung alles ausrollen, was Sie wollen, ohne Konsequenzen f√ºr den Verkauf.  Auch das betrifft alle Ihre Dienstleistungen in prod. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453364/">https://habr.com/ru/post/de453364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453352/index.html">Wie Drohnen in Ghana lebenswichtige Medikamente liefern</a></li>
<li><a href="../de453354/index.html">Klassifizierung der Landbedeckung mittels Eo-Learn. Teil 3</a></li>
<li><a href="../de453356/index.html">Aktuelle Trends und Empfehlungen zur Agglomeration gro√üer Finanzinstitute</a></li>
<li><a href="../de453360/index.html">Stadt ohne Stau</a></li>
<li><a href="../de453362/index.html">HabraConf # 1 - R√ºckw√§rts f√ºr Backend</a></li>
<li><a href="../de453366/index.html">Verwendung von Kommas in Englisch: 15 Regeln und Fehlerbeispiele</a></li>
<li><a href="../de453368/index.html">Datenwiederherstellung aus XtraDB-Tabellen ohne Strukturdatei mithilfe der Byteanalyse der ibd-Datei</a></li>
<li><a href="../de453370/index.html">Konfrontation 2019: Das Jet Security Team belegte den ersten Platz in der Verteidigung</a></li>
<li><a href="../de453374/index.html">Top 10 Chat-, Audio- und Videoanruf-API- und SDK-Anbieter f√ºr Unternehmen</a></li>
<li><a href="../de453376/index.html">Wie k√∂nnen Sie Ihre Zeit und Ihre SSD-Ressourcen vergeblich verschwenden? Leicht und einfach</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>