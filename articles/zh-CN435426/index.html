<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ©ï¸ ğŸ’› ğŸ› ï¸ Microsoft Excelå¦‚ä½•ä¸è¡Œé«˜ä¸€èµ·ä½¿ç”¨ ğŸ› ğŸ¤·ğŸ¾ ğŸ•™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ‰æ—¶æˆ‘å¾ˆæ— èŠï¼Œå¹¶ä¸”é…å¤‡äº†è°ƒè¯•å™¨ï¼Œç„¶åå¼€å§‹ç ”ç©¶ä¸åŒçš„ç¨‹åºã€‚ è¿™æ¬¡ï¼Œæˆ‘çš„é€‰æ‹©è½åœ¨Excelä¸Šï¼Œå¸Œæœ›å¼„æ¸…æ¥šå®ƒå¦‚ä½•å¤„ç†è¡Œçš„é«˜åº¦ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹ï¼Œå¦‚ä½•è€ƒè™‘å•å…ƒæ ¼èŒƒå›´çš„é«˜åº¦ç­‰ã€‚ æˆ‘è§£æäº†Excel 2010ï¼ˆexcel.exeï¼Œ32ä½ï¼Œç‰ˆæœ¬14.0.4756.1000ï¼ŒSHA1 a805cf60a5542f210...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microsoft Excelå¦‚ä½•ä¸è¡Œé«˜ä¸€èµ·ä½¿ç”¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435426/"><p>æœ‰æ—¶æˆ‘å¾ˆæ— èŠï¼Œå¹¶ä¸”é…å¤‡äº†è°ƒè¯•å™¨ï¼Œç„¶åå¼€å§‹ç ”ç©¶ä¸åŒçš„ç¨‹åºã€‚ è¿™æ¬¡ï¼Œæˆ‘çš„é€‰æ‹©è½åœ¨Excelä¸Šï¼Œå¸Œæœ›å¼„æ¸…æ¥šå®ƒå¦‚ä½•å¤„ç†è¡Œçš„é«˜åº¦ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹ï¼Œå¦‚ä½•è€ƒè™‘å•å…ƒæ ¼èŒƒå›´çš„é«˜åº¦ç­‰ã€‚ æˆ‘è§£æäº†Excel 2010ï¼ˆexcel.exeï¼Œ32ä½ï¼Œç‰ˆæœ¬14.0.4756.1000ï¼ŒSHA1 a805cf60a5542f21001b0ea5d142d1cd0ee00b28ï¼‰ã€‚ </p><a name="habracut"></a><br><h2 id="nachnyom-s-teorii"> è®©æˆ‘ä»¬ä»ç†è®ºå¼€å§‹ </h2><br><p> å¦‚æœè½¬åˆ°Microsoft Officeçš„VBAæ–‡æ¡£ï¼Œåˆ™å¯ä»¥çœ‹åˆ°è¡Œé«˜åº¦å¯ä»¥é€šè¿‡ä¸¤ä¸ªå±æ€§ä»¥ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼è·å¾—ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="è¡Œé«˜">RowHeight-</a>è¿”å›æˆ–è®¾ç½®æŒ‡å®šèŒƒå›´å†…çš„ç¬¬ä¸€è¡Œçš„é«˜åº¦ï¼Œä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="è¡Œé«˜">ç£…</a>ä¸ºå•ä½ã€‚ è¯»/å†™Double; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="èº«é«˜">é«˜åº¦</a> -è¿”å›ä¸€ä¸ªDoubleå€¼ï¼Œè¯¥å€¼è¡¨ç¤ºèŒƒå›´çš„é«˜åº¦ï¼ˆä»¥ç£…ä¸ºå•ä½ï¼‰ã€‚ åªè¯»çš„ã€‚ </li></ul><br><p> å¦‚æœæ‚¨ä¹Ÿåœ¨æ­¤å¤„æŸ¥çœ‹ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="Excelè§„æ ¼å’Œé™åˆ¶">Excelè§„èŒƒå’Œé™åˆ¶</a> ã€‚ æ‚¨å¯ä»¥æ‰¾åˆ°æœ€å¤§è¡Œé«˜ä¸º409ç‚¹ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™è¿œéå”¯ä¸€çš„Microsoftå®˜æ–¹æ–‡ä»¶å…·æœ‰è¯¯å¯¼æ€§çš„æƒ…å†µã€‚ å®é™…ä¸Šï¼Œåœ¨Excelä»£ç ä¸­ï¼Œæœ€å¤§è¡Œé«˜è®¾ç½®ä¸º2047åƒç´ ï¼Œä»¥ç‚¹ä¸º1535.25ã€‚ ä¸”æœ€å¤§å­—ä½“å¤§å°ä¸º409.55ç£…ã€‚ ä»…é€šè¿‡åœ¨VBA / Interopä¸­åˆ†é…è¡Œå°±ä¸å¯èƒ½è·å¾—å¦‚æ­¤é«˜çš„è¡Œï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä¸€è¡Œï¼Œåœ¨å…¶ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ä¸­è®¾ç½®Cambria Mathå­—ä½“ï¼Œå¹¶å°†å­—ä½“å¤§å°è®¾ç½®ä¸º409.55ç‚¹ã€‚ ç„¶åï¼ŒExcelåŠå…¶ç‹¡çŒ¾ç®—æ³•å°†æ ¹æ®å•å…ƒæ ¼æ ¼å¼è®¡ç®—è¡Œé«˜ï¼Œè·å–è¶…è¿‡2047åƒç´ ï¼ˆç›¸ä¿¡å•è¯ï¼‰çš„æ•°å­—ï¼Œå¹¶å°†è¡Œè®¾ç½®ä¸ºæœ€å¤§å¯èƒ½çš„é«˜åº¦ã€‚ å¦‚æœé€šè¿‡UIè¯¢é—®è¯¥ç³»åˆ—çš„é«˜åº¦ï¼Œåˆ™Excelä¼šè®¤ä¸ºè¯¥é«˜åº¦æ˜¯409.5ç‚¹ï¼Œä½†æ˜¯å¦‚æœæ‚¨é€šè¿‡VBAè¯·æ±‚è¯¥ç³»åˆ—çš„é«˜åº¦ï¼Œåˆ™æ‚¨ä¼šå¾—åˆ°1535.25ç‚¹ï¼Œç­‰äº2047åƒç´ ã€‚ æ˜¯çš„ï¼Œä¿å­˜æ–‡æ¡£åï¼Œé«˜åº¦ä»å°†é™è‡³409.5ç‚¹ã€‚ å¯ä»¥åœ¨ä»¥ä¸‹è§†é¢‘ä¸­çœ‹åˆ°æ­¤æ“ä½œï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//recordit.co/ivnFEsELLI</a> </p><br><p> æˆ‘åœ¨ä¸Šä¸€æ®µä¸­æåˆ°åƒç´ æ˜¯æœ‰åŸå› çš„ã€‚  Excelå®é™…ä¸Šä»¥æ•´æ•°å½¢å¼å­˜å‚¨å’Œè®¡ç®—å•å…ƒæ ¼çš„å¤§å°ï¼ˆé€šå¸¸ï¼Œå®ƒä¼šå°½å¯èƒ½å¤šåœ°æ‰§è¡Œæ•´æ•°æ“ä½œï¼‰ã€‚ æœ€å¸¸è§çš„æ˜¯åƒç´ ä¹˜ä»¥æŸä¸ªå› å­ã€‚ æœ‰è¶£çš„æ˜¯ï¼ŒExcelä»¥æ™®é€šåˆ†æ•°çš„å½¢å¼å­˜å‚¨å¤–è§‚æ¯”ä¾‹ï¼Œä¾‹å¦‚ï¼Œæ¯”ä¾‹æ¯”ä¾‹75ï¼…å°†è¢«å­˜å‚¨ä¸ºä¸¤ä¸ªæ•°å­—3å’Œ4ã€‚å½“éœ€è¦æ˜¾ç¤ºè¡Œæ—¶ï¼ŒExcelå°†è¡Œé«˜ä½œä¸ºæ•´æ•°åƒç´ ï¼Œä¹˜ä»¥3å¹¶é™¤ä»¥ä¹˜ä»¥4ï¼Œä½†æ˜¯ä»–å°†åœ¨æœ€åæ‰§è¡Œæ­¤æ“ä½œï¼Œç”±æ­¤äº§ç”Ÿçš„æ•ˆæœæ˜¯ï¼Œæ‰€æœ‰å†…å®¹å‡ä»¥å°æ•°å½¢å¼è€ƒè™‘ã€‚ è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œè¯·åœ¨VBAä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š </p><br><pre><code class="vbscript hljs">w.Rows(<span class="hljs-number"><span class="hljs-number">1</span></span>).RowHeight = <span class="hljs-number"><span class="hljs-number">75.375</span></span> Debug.Print w.Rows(<span class="hljs-number"><span class="hljs-number">1</span></span>).Height</code> </pre> <br><p>  VBAä¼šç»™å‡º75ï¼Œå› ä¸º  75.375åƒç´ å°†ä¸º100.5åƒç´ ï¼ŒExcelæ— æ³•æ‰¿å—ï¼Œå¹¶ä¸”ä¼šå°†å°æ•°éƒ¨åˆ†æœ€å¤šå‡å°‘100åƒç´ ã€‚ å½“VBAè¦æ±‚ä»¥ç‚¹ä¸ºå•ä½çš„è¡Œé«˜æ—¶ï¼ŒExcelä¼šè¯šå®åœ°å°†100åƒç´ è½¬æ¢ä¸ºç‚¹å¹¶è¿”å›75ã€‚ </p><br><p> åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬å·²ç»ç”¨Cï¼ƒç¼–å†™äº†ä¸€ä¸ªç±»æ¥æè¿°æœ‰å…³è¡Œé«˜çš„ä¿¡æ¯ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RowHeightInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//    ,   4. public ushort Flags { get; set; } //  }</span></span></code> </pre> <br><p> æ‚¨ç°åœ¨å¿…é¡»è¯´å‡ºæˆ‘çš„è¯ï¼Œä½†æ˜¯åœ¨Excelä¸­ï¼Œè¡Œé«˜åº¦æ˜¯ä»¥è¿™ç§æ–¹å¼å­˜å‚¨çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŒ‡å®šè¡Œé«˜ä¸º75ç‚¹ï¼Œå°†ä»¥åƒç´ ä¸ºå•ä½ï¼Œåˆ™ä¸º100ï¼Œç„¶åå°†400å­˜å‚¨åœ¨Valueä¸­ã€‚æˆ‘è¿˜æ²¡æœ‰å®Œå…¨å¼„æ¸…æ¥šFlagsä¸­çš„æ‰€æœ‰ä½çš„å«ä¹‰ï¼ˆè¦å¼„æ¸…æ¥šFlagsçš„å€¼å¾ˆå›°éš¾è€Œä¸”å¾ˆé•¿ï¼‰ï¼Œä½†æ˜¯æˆ‘è‚¯å®šçŸ¥é“æ‰‹åŠ¨è®¾ç½®é«˜åº¦çš„è¡Œè®¾ç½®ä¸º0x4000ï¼Œéšè—è¡Œçš„è®¾ç½®ä¸º0x2000ã€‚ é€šå¸¸ï¼Œå¯¹äºå…·æœ‰æ‰‹åŠ¨è®¾ç½®çš„é«˜åº¦çš„å¯è§è¡Œï¼ŒFlagsé€šå¸¸ç­‰äº0x4005ï¼Œå¯¹äºæ ¹æ®Flagsæ ¼å¼è®¡ç®—é«˜åº¦çš„è¡Œï¼Œå…¶å€¼ä¸º0xAæˆ–0x800Eã€‚ </p><br><h2 id="sprashivaem-vysotu-ryada"> æˆ‘ä»¬é—®è¡Œé«˜ </h2><br><p> ç°åœ¨ï¼ŒåŸåˆ™ä¸Šï¼Œç°åœ¨æ‚¨å¯ä»¥çœ‹ä¸€ä¸‹excel.exeä¸­çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡å…¶ç´¢å¼•è¿”å›è¡Œé«˜ï¼ˆè¿™è¦å½’åŠŸäºHexRaysçš„æ¼‚äº®ä»£ç ï¼‰ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __userpurge GetRowHeight@&lt;eax&gt;(<span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowIndex@&lt;edx&gt;, SheetLayoutInfo *sheetLayoutInfo@&lt;esi&gt;, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag) { RowHeightInfo *rowHeightInfo; <span class="hljs-comment"><span class="hljs-comment">// eax int result; // ecx if ( sheetLayoutInfo-&gt;dword1A0 ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); if ( rowIndex &lt; sheetLayoutInfo-&gt;MinRowIndexNonDefault ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); if ( rowIndex &gt;= sheetLayoutInfo-&gt;MaxRowIndexNonDefault ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); rowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); if ( !rowHeightInfo ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); result = 0; if ( flag || !(rowHeightInfo-&gt;Flags &amp; 0x2000) ) result = rowHeightInfo-&gt;Value; if ( !(rowHeightInfo-&gt;Flags &amp; 0x4000) ) result |= 0x8000u; return result; }</span></span></code> </pre> <br><p>  dword1A0æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»ç„¶æ²¡æœ‰å¼„æ¸…æ¥šã€‚ æ‰¾ä¸åˆ°è®¾ç½®æ­¤æ ‡å¿—çš„åœ°æ–¹:( <br> å¯¹æˆ‘æ¥è¯´ï¼ŒdefaultRowDelta2ä»ç„¶æ˜¯ä¸ªè°œã€‚ å½“excelæ ¹æ®æ ¼å¼è®¡ç®—è¡Œé«˜æ—¶ï¼Œå®ƒè¡¨ç¤ºä¸ºä¸¤ä¸ªæ•°å­—çš„æ€»å’Œã€‚  defaultRowDelta2æ˜¯æ­¤æ€»å’Œä¸­ç¬¬äºŒä¸ªæ•°å­—ï¼ˆæ ‡å‡†è¡Œé«˜åº¦ï¼‰ã€‚  flagå‚æ•°çš„å€¼ä¹Ÿå¾ˆç¥ç§˜ï¼Œå› ä¸º æ— è®ºæˆ‘åœ¨å“ªé‡Œçœ‹åˆ°åœ¨flagä¸­ä¼ é€’ç»™æ­¤æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼ é€’falseã€‚ <br>  SheetLayoutInfoç±»ä¹Ÿå‡ºç°åœ¨æ­¤æ–¹æ³•ä¸­ã€‚ æˆ‘ä¹‹æ‰€ä»¥è¿™æ ·å‘½åï¼Œæ˜¯å› ä¸ºå®ƒå­˜å‚¨äº†å¤§é‡æœ‰å…³å·¥ä½œè¡¨å¤–è§‚çš„ä¿¡æ¯ã€‚ åœ¨SheetLayoutInfoä¸­ï¼Œæœ‰å¦‚ä¸‹å­—æ®µï¼š </p><br><ul><li>  DefaultFullRowHeightMul4-æ ‡å‡†è¡Œé«˜ï¼› </li><li>  MinRowIndexNonDefault-ç¬¬ä¸€è¡Œçš„ç´¢å¼•ï¼Œé«˜åº¦ä¸åŒäºæ ‡å‡†è¡Œï¼› </li><li>  MaxRowIndexNonDefault-æœ€åä¸€ä¸ªåºåˆ—ä¹‹åçš„åºåˆ—çš„ç´¢å¼•ï¼Œè¯¥åºåˆ—çš„é«˜åº¦ä¸åŒäºæ ‡å‡†ï¼› </li><li>  DefaultRowDelta2ä¸æ ‡å‡†è¡Œé«˜çš„æ€»å’Œç›¸åŒã€‚ </li><li>  GroupIndexDelta-ç¨åä¼šè¯¦ç»†ä»‹ç» </li></ul><br><p> åŸåˆ™ä¸Šï¼Œè¿™ç§æ–¹æ³•çš„é€»è¾‘æ˜¯å¯ä»¥ç†è§£çš„ï¼š </p><br><ol><li> å¦‚æœç³»åˆ—çš„ç´¢å¼•å°äºéæ ‡å‡†é«˜åº¦çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œåˆ™è¿”å›æ ‡å‡†ï¼›å¦åˆ™ï¼Œè¿”å›æ ‡å‡†ã€‚ </li><li> å¦‚æœç³»åˆ—çš„ç´¢å¼•å¤§äºå…·æœ‰éæ ‡å‡†é«˜åº¦çš„æœ€åä¸€ä¸ªç´¢å¼•ï¼Œåˆ™è¿”å›æ ‡å‡†ï¼›å¦åˆ™ï¼Œè¿”å›æ ‡å‡†ã€‚ </li><li> å¦åˆ™ï¼Œæˆ‘ä»¬å°†ä»GetRowHeightCoreæ–¹æ³•è·å–è¯¥ç³»åˆ—çš„rowHeightInfoå¯¹è±¡ï¼› </li><li> å¦‚æœrowHeightInfo == nullï¼Œåˆ™è¿”å›æ ‡å‡†è¡Œé«˜ã€‚ </li><li> å¸¦æœ‰æ ‡å¿—çš„é­”æœ¯ï¼Œä½†æ˜¯é€šå¸¸ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®è¡Œé«˜ï¼Œæˆ‘ä»¬å°†è¿”å›rowHeightInfo.Valueä¸­çš„å†…å®¹ï¼Œå¹¶åœ¨å“åº”ä¸­è®¾ç½®ç¬¬16ä½ã€‚ </li></ol><br><p> å¦‚æœç”¨Cï¼ƒé‡å†™æ­¤ä»£ç ï¼Œåˆ™ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å†…å®¹ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> HiddenRowMask = <span class="hljs-number"><span class="hljs-number">0x2000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> CustomHeightMask = <span class="hljs-number"><span class="hljs-number">0x4000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> DefaultHeightMask = <span class="hljs-number"><span class="hljs-number">0x8000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ushort</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex, SheetLayoutInfo sheetLayoutInfo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> defaultHeight = (<span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span>) (sheetLayoutInfo.DefaultFullRowHeightMul4 | (~(sheetLayoutInfo.DefaultRowDelta2 &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>) &amp; DefaultHeightMask)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &lt; sheetLayoutInfo.MinRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; RowHeightInfo rowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((rowHeightInfo.Flags &amp; HiddenRowMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) result = rowHeightInfo.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((rowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) result |= DefaultHeightMask; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨å¯ä»¥çœ‹ä¸€ä¸‹GetRowHeightCoreå†…éƒ¨å‘ç”Ÿçš„æƒ…å†µï¼š </p><br><pre> <code class="cpp hljs">RowHeightInfo *__<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeightCore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SheetLayoutInfo *sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">signed</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex)</span></span></span><span class="hljs-function"> </span></span>{ RowHeightInfo *result; <span class="hljs-comment"><span class="hljs-comment">// eax RowsGroupInfo *rowsGroupInfo; // ecx int rowInfoIndex; // edx result = 0; if ( rowIndex &lt; sheetLayoutInfo-&gt;MinRowIndexNonDefault || rowIndex &gt;= sheetLayoutInfo-&gt;MaxRowIndexNonDefault ) return result; rowsGroupInfo = sheetLayoutInfo-&gt;RowsGroups[sheetLayoutInfo-GroupIndexDelta + (rowIndex &gt;&gt; 4)]; result = 0; if ( !rowsGroupInfo ) return result; rowInfoIndex = rowsGroupInfo-&gt;Indices[rowIndex &amp; 0xF]; if ( rowInfoIndex ) result = (rowsGroupInfo + 8 * (rowInfoIndex + rowsGroupInfo-&gt;wordBA + rowsGroupInfo-&gt;wordBC - rowsGroupInfo-&gt;wordB8)); return result; }</span></span></code> </pre> <br><ol><li> å†æ¬¡ï¼Œåœ¨å¼€å§‹æ—¶ï¼ŒExcelå°†æ£€æŸ¥è¯¥ç³»åˆ—çš„ç´¢å¼•æ˜¯å¦åœ¨é«˜åº¦å·²ä¿®æ”¹çš„è¡Œä¹‹é—´ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›nullã€‚ </li><li> æŸ¥æ‰¾æ‰€éœ€çš„è¡Œç»„ï¼›å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç»„ï¼Œåˆ™è¿”å›nullã€‚ </li><li> è·å–ç»„ä¸­ç³»åˆ—çš„ç´¢å¼•ã€‚ </li><li> æ­¤å¤–ï¼Œé€šè¿‡ç³»åˆ—çš„ç´¢å¼•ï¼Œå®ƒæ‰¾åˆ°RowHeightInfoç±»çš„æ‰€éœ€å¯¹è±¡ã€‚  wordBAï¼ŒwordBCï¼ŒwordB8-ä¸€äº›å¸¸é‡ã€‚ å®ƒä»¬ä»…éšç€å†å²è€Œæ”¹å˜ã€‚ åŸåˆ™ä¸Šï¼Œå®ƒä»¬ä¸ä¼šå½±å“å¯¹ç®—æ³•çš„ç†è§£ã€‚ </li></ol><br><p> åœ¨è¿™é‡Œå€¼å¾—åç¦»æœ¬ä¸»é¢˜ï¼Œå¹¶æ›´å¤šåœ°ä»‹ç»RowsGroupInfoã€‚  Excelä»¥16ä»¶ä¸ºä¸€ç»„å­˜å‚¨RowHeightInfoï¼Œå…¶ä¸­ä»¥RowsGroupInfoç±»è¡¨ç¤ºçš„ç¬¬iç»„å°†å­˜å‚¨æœ‰å…³ä»iÃ—16åˆ°iÃ—16 + 15ï¼ˆå«ï¼‰çš„è¡Œçš„ä¿¡æ¯ã€‚ </p><br><p> ä½†æ˜¯RowsGroupInfoä¸­çš„è¡Œé«˜ä¿¡æ¯ä»¥æŸç§ä¸å¯»å¸¸çš„æ–¹å¼å­˜å‚¨ã€‚ æœ€æœ‰å¯èƒ½æ˜¯ç”±äºéœ€è¦åœ¨Excelä¸­ç»´æŠ¤å†å²è®°å½•ã€‚ </p><br><p>  RowsGroupInfoä¸­æœ‰ä¸‰ä¸ªé‡è¦å­—æ®µï¼šIndicesï¼ŒHeightInfoså’ŒRowsCountï¼Œç¬¬äºŒä¸ªåœ¨ä¸Šé¢çš„ä»£ç ä¸­ä¸å¯è§ï¼ˆå®ƒåº”è¯¥åœ¨æ­¤è¡Œä¸­ï¼šï¼ˆrowsGroupInfo + 8Ã—ï¼ˆ...ï¼‰ï¼‰ï¼Œå› ä¸ºrowInfoIndexå¯ä»¥é‡‡ç”¨éå¸¸ä¸åŒçš„å€¼ï¼Œæˆ‘å·²ç»çœ‹è¿‡1000å¤šä¸ªï¼Œè€Œä¸”æˆ‘ä¸çŸ¥é“å¦‚ä½•åœ¨IDAä¸­è®¾ç½®è¿™æ ·çš„ç»“æ„ã€‚RowsCountå­—æ®µæ²¡æœ‰å‡ºç°åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½†è¿™æ˜¯ç»„ä¸­å­˜å‚¨äº†å¤šå°‘ä¸ªçœŸæ­£çš„éæ ‡å‡†è¡Œã€‚ <br> å¦å¤–ï¼Œåœ¨SheetLayoutInfoä¸­æœ‰GroupIndexDelta-ç»„çš„å®é™…ç´¢å¼•ä¸å…·æœ‰æ›´æ”¹çš„è¡Œé«˜çš„ç¬¬ä¸€ä¸ªç»„çš„ç´¢å¼•ä¹‹é—´çš„å·®ã€‚ </p><br><p> ç´¢å¼•å­—æ®µå­˜å‚¨ç»„ä¸­ç³»åˆ—çš„æ¯ä¸ªç´¢å¼•çš„RowHeightInfoåç§»é‡ã€‚ å®ƒä»¬æŒ‰é¡ºåºå­˜å‚¨åœ¨æ­¤å¤„ï¼Œä½†æ˜¯åœ¨HeightInfosä¸­ï¼ŒRowHeightInfoå·²æŒ‰æ›´æ”¹é¡ºåºå­˜å‚¨ã€‚ </p><br><p> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„ç©ºç™½è¡¨ï¼Œå¹¶ä¸”ä»¥æŸç§æ–¹å¼æ›´æ”¹äº†è¡Œå·23çš„é«˜åº¦ã€‚æ­¤è¡Œä½äºç¬¬äºŒç»„çš„16è¡Œä¸­ï¼Œç„¶åï¼š </p><br><ol><li>  Excelå°†ç¡®å®šè¯¥ç³»åˆ—çš„ç»„ç´¢å¼•ã€‚ åœ¨å½“å‰æƒ…å†µä¸‹ï¼Œç´¢å¼•å°†ä¸º1ï¼Œå¹¶å°†æ›´æ”¹GroupIndexDelta = -1ã€‚ </li><li> ä¸ºä¸€ç³»åˆ—è¡Œåˆ›å»ºRowsGroupInfoç±»çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶æ”¾åœ¨ç´¢å¼•0ï¼ˆsheetLayoutInfo-&gt; GroupIndexDelta + 1ï¼‰ä¸‹çš„sheetLayoutInfo-&gt; RowsGroupsä¸­ï¼› </li><li> åœ¨RowsGroupInfoä¸­ï¼ŒExcelå°†ä¸º16ä¸ª4å­—èŠ‚ç´¢å¼•åˆ†é…å†…å­˜ï¼Œåˆ†åˆ«ç”¨äºRowsCountï¼ŒwordBAï¼ŒwordBCå’ŒwordB8ç­‰ã€‚ </li><li> ç„¶åï¼ŒExcelé€šè¿‡æŒ‰ä½ä¸è¿ç®—ï¼ˆæ¯”é‡‡ç”¨é™¤æ³•çš„å…¶ä½™éƒ¨åˆ†è¦å¿«å¾—å¤šï¼‰æ¥è®¡ç®—ç»„ä¸­ç³»åˆ—çš„ç´¢å¼•ï¼šrowIndexï¼†0xFã€‚ è¯¥ç»„ä¸­çš„æœŸæœ›ç´¢å¼•ä¸ºï¼š23ï¼†0xF = 7; </li><li> ä¹‹åï¼ŒExcelè·å¾—ç´¢å¼•7çš„åç§»é‡ï¼šoffset = Indices [7]ã€‚ å¦‚æœoffset = 0ï¼Œåˆ™Excelåœ¨RowsGroupIntoçš„æœ«å°¾åˆ†é…8ä¸ªå­—èŠ‚ï¼Œå°†RowsCountå¢åŠ 1ï¼Œç„¶åå°†æ–°çš„åç§»é‡å†™å…¥ç´¢å¼•[7]ã€‚ æ— è®ºå¦‚ä½•ï¼Œæœ€åï¼ŒExceléƒ½ä¼šåœ¨RowsGroupInfoä¸­çš„åç§»å¤„å†™å…¥æœ‰å…³æ–°è¡Œé«˜å’Œæ ‡å¿—çš„ä¿¡æ¯ã€‚ </li></ol><br><p>  Cï¼ƒæœ¬èº«ä¸­çš„RowsGroupInfoç±»çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RowsGroupInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] Indices { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;RowHeightInfo&gt; HeightInfos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RowsGroupInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Indices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[SheetLayoutInfo.MaxRowsCountInGroup]; HeightInfos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;RowHeightInfo&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SheetLayoutInfo.MaxRowsCountInGroup; i++) { Indices[i] = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } } }</code> </pre> <br><p>  GetRowHeightCoreæ–¹æ³•å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RowHeightInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeightCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &lt; sheetLayoutInfo.MinRowIndexNonDefault || rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + (rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rowInfoIndex != <span class="hljs-number"><span class="hljs-number">-1</span></span> ? rowsGroupInfo.HeightInfos[rowInfoIndex] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><p> è¿™å°±æ˜¯SetRowHeightçš„æ ·å­ï¼ˆæˆ‘æ²¡æœ‰ä»excel.exeä¸­åˆ—å‡ºå…¶ä»£ç ï¼‰ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRowHeight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ushort</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newRowHeight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ushort</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, SheetLayoutInfo sheetLayoutInfo</span></span></span><span class="hljs-function">)</span></span> { sheetLayoutInfo.MaxRowIndexNonDefault = Math.Max(sheetLayoutInfo.MaxRowIndexNonDefault, rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); sheetLayoutInfo.MinRowIndexNonDefault = Math.Min(sheetLayoutInfo.MinRowIndexNonDefault, rowIndex); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.RowsGroups.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sheetLayoutInfo.RowsGroups.Add(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); sheetLayoutInfo.GroupIndexDelta = -realGroupIndex; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.GroupIndexDelta + realGroupIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bucketSize = -(sheetLayoutInfo.GroupIndexDelta + realGroupIndex); sheetLayoutInfo.RowsGroups.InsertRange(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo[bucketSize]); sheetLayoutInfo.GroupIndexDelta = -realGroupIndex; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.GroupIndexDelta + realGroupIndex &gt;= sheetLayoutInfo.RowsGroups.Count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bucketSize = sheetLayoutInfo.GroupIndexDelta + realGroupIndex - sheetLayoutInfo.RowsGroups.Count + <span class="hljs-number"><span class="hljs-number">1</span></span>; sheetLayoutInfo.RowsGroups.AddRange(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo[bucketSize]); } RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + realGroupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + realGroupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]; RowHeightInfo rowHeightInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { rowHeightInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowHeightInfo(); rowsGroupInfo.HeightInfos.Add(rowHeightInfo); rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rowHeightInfo = rowsGroupInfo.HeightInfos[rowInfoIndex]; } rowHeightInfo.Value = newRowHeight; rowHeightInfo.Flags = flags; }</code> </pre> <br><h2 id="nemnogo-praktiki"> ä¸€ç‚¹ç»ƒä¹  </h2><br><p> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¹‹åï¼Œæ›´æ”¹äº†ç¬¬23è¡Œçš„é«˜åº¦ï¼ŒExcelå°†çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆæˆ‘å°†ç¬¬23è¡Œçš„é«˜åº¦è®¾ç½®ä¸º75ç‚¹ï¼‰ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">sheetLayoutInfo</b> <div class="spoiler_text"><ul><li>  DefaultFullRowHeightMul4 = 80 </li><li>  DefaultRowDelta2 = 5 </li><li>  MaxRowIndexNonDefault = 24 </li><li>  MinRowIndexNonDefault = 23 </li><li>  GroupIndexDelta = -1 </li><li>  RowsGroups Count = 1 <br><ul><li>  [0] RowsGroupInfo </li><li>  HeightInfosè®¡æ•°= 1 <br><ul><li>  [0] RowHeightInfo </li><li> æ ‡å¿—= 0x4005 </li><li> ä»·å€¼= 100 </li></ul></li><li> æŒ‡æ ‡ <br><ul><li>  [0] = -1 </li><li>  [1] = -1 </li><li>  [2] = -1 </li><li>  [3] = -1 </li><li>  [4] = -1 </li><li>  [5] = -1 </li><li>  [6] = -1 </li><li>  [7] = 0 </li><li>  [8] = -1 </li><li>  [9] = -1 </li><li>  [10] = -1 </li><li>  [11] = -1 </li><li>  [12] = -1 </li><li>  [13] = -1 </li><li>  [14] = -1 </li><li>  [15] = -1 </li></ul></li></ul></li></ul></div></div><br> åœ¨è¿™é‡Œå’Œä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘å°†å¸ƒå±€ä¸€ä¸ªç¤ºæ„å›¾ï¼Œè¯´æ˜Excelå†…å­˜ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•é€šè¿‡è‡ªå†™ç±»åœ¨Visual Studioä¸­ç”Ÿæˆçš„ï¼Œå› ä¸ºä»å†…å­˜ä¸­ç›´æ¥è½¬å‚¨çš„ä¿¡æ¯ä¸å¤šã€‚ <br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•éšè—ç¬¬23è¡Œã€‚ä¸ºæ­¤ï¼Œå°†Flagsè®¾ç½®ä¸º0x2000ã€‚ æˆ‘ä»¬å°†æ”¹å˜ç”Ÿæ´»çš„è®°å¿†ã€‚ ç»“æœå¯ä»¥åœ¨ä»¥ä¸‹è§†é¢‘ä¸­çœ‹åˆ°ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//recordit.co/79vYIbwbzB</a> ã€‚ <br> æ¯å½“æ‚¨éšè—è¡Œæ—¶ï¼ŒExceléƒ½ä¼šæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ <br> ç°åœ¨ï¼Œæˆ‘ä»¬ä¸é€šè¿‡è¡Œæ ¼å¼æ¥æ˜¾å¼è®¾ç½®è¡Œé«˜ã€‚ è®©å•å…ƒæ ¼A20ä¸­çš„å­—ä½“å˜ä¸º40ç‚¹çš„é«˜åº¦ï¼Œç„¶åä»¥ç‚¹ä¸ºå•ä½çš„å•å…ƒæ ¼é«˜åº¦å°†ä¸º45.75ï¼Œå¹¶ä¸”åœ¨Excelå†…å­˜ä¸­å°†æ˜¯è¿™æ ·çš„ï¼š <br><div class="spoiler">  <b class="spoiler_title">sheetLayoutInfo</b> <div class="spoiler_text"><ul><li>  DefaultFullRowHeightMul4 = 80 </li><li>  DefaultRowDelta2 = 5 </li><li>  MaxRowIndexNonDefault = 24 </li><li>  MinRowIndexNonDefault = 20 </li><li>  GroupIndexDelta = -1 </li><li>  RowsGroups Count = 1 <br><ul><li>  [0] RowsGroupInfo </li><li>  HeightInfosè®¡æ•°= 2 <br><ul><li>  [0] RowHeightInfo </li><li> æ ‡å¿—= 0x4005 </li><li> ä»·å€¼= 100 </li><li>  [1] RowHeightInfo </li><li> æ ‡å¿—= 0x800E </li><li> ä»·å€¼= 244 </li></ul></li><li> æŒ‡æ ‡ <br><ul><li>  [0] = -1 </li><li>  [1] = -1 </li><li>  [2] = -1 </li><li>  [3] = -1 </li><li>  [4] = 1 </li><li>  [5] = -1 </li><li>  [6] = -1 </li><li>  [7] = 0 </li><li>  [8] = -1 </li><li>  [9] = -1 </li><li>  [10] = -1 </li><li>  [11] = -1 </li><li>  [12] = -1 </li><li>  [13] = -1 </li><li>  [14] = -1 </li><li>  [15] = -1 </li></ul></li></ul></li></ul></div></div><br><p> æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œå¦‚æœä¸æ˜¯æ ‡å‡†è¡Œï¼ŒExcelæ€»æ˜¯å­˜å‚¨è¡Œé«˜ã€‚ å³ä½¿æœªæ˜ç¡®è®¾ç½®é«˜åº¦ï¼Œè€Œæ˜¯æ ¹æ®å•å…ƒæ ¼æˆ–æ ¼å¼çš„å†…å®¹è®¡ç®—å‡ºçš„é«˜åº¦ï¼ŒExcelä»ç„¶ä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡è®¡ç®—å¹¶å°†ç»“æœæ”¾å…¥é€‚å½“çš„ç»„ä¸­ã€‚ </p><br><h2 id="razbiraemsya-so-vstavkoyudaleniem-ryadov"> æˆ‘ä»¬å¤„ç†è¡Œçš„æ’å…¥/åˆ é™¤ </h2><br><p> è§£ææ’å…¥/åˆ é™¤è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆä¼šå¾ˆæœ‰è¶£ã€‚ åœ¨excel.exeä¸­å¯¹åº”çš„ä»£ç å¹¶ä¸éš¾æ‰¾åˆ°ï¼Œä½†æ˜¯æ²¡æœ‰åæ±‡ç¼–çš„æ¬²æœ›ï¼Œæ‚¨å¯ä»¥çœ‹ä¸€ä¸‹å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">sub_305EC930</b> <div class="spoiler_text"><p> æ ‡å¿—a5ç¡®å®šå½“å‰æ­£åœ¨æ‰§è¡Œå“ªä¸ªæ“ä½œã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __userpurge sub_305EC930@&lt;eax&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a1@&lt;eax&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a2@&lt;edx&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a3@&lt;ecx&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a4, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a5, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a6) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v6; <span class="hljs-comment"><span class="hljs-comment">// esi int v7; // ebx int v8; // edi int v9; // edx int v10; // ecx size_t v11; // eax _WORD *v12; // ebp size_t v13; // eax size_t v14; // eax int v15; // eax unsigned __int16 *v16; // ecx _WORD *v17; // eax _WORD *v18; // ecx int v19; // edx __int16 v20; // bx int v21; // eax _WORD *v22; // ecx int v24; // edx int v25; // eax int v26; // esi int v27; // ebx size_t v28; // eax int v29; // ebp size_t v30; // eax int v31; // esi size_t v32; // eax int v33; // eax unsigned __int16 *v34; // ecx int v35; // eax _WORD *v36; // edx _WORD *v37; // ecx int v38; // eax __int16 v39; // bx int v40; // eax _WORD *v41; // ecx int v42; // [esp+10h] [ebp-48h] int v43; // [esp+10h] [ebp-48h] int v44; // [esp+14h] [ebp-44h] char v45; // [esp+14h] [ebp-44h] int Dst[16]; // [esp+18h] [ebp-40h] int v47; // [esp+5Ch] [ebp+4h] int v48; // [esp+60h] [ebp+8h] v6 = a1; v7 = a1 &amp; 0xF; v8 = a2; if ( !a5 ) { v24 = a4 - a1; v25 = a1 - a3; v43 = a4 - v6; if ( v7 &gt;= v25 ) v7 = v25; v47 = a4 - v7; v26 = v6 - v7; v27 = v7 + 1; v48 = v27; if ( !v8 ) return v27; v28 = 4 * v24; if ( (4 * v24) &gt; 0x40 ) v28 = 64; v45 = v27 + v26; v29 = (v27 + v26) &amp; 0xF; memmove(Dst, (v8 + 4 * v29), v28); v30 = 4 * v27; if ( (4 * v27) &gt; 0x40 ) v30 = 64; v31 = v26 &amp; 0xF; memmove((v8 + 4 * (v47 &amp; 0xF)), (v8 + 4 * v31), v30); v32 = 4 * v43; if ( (4 * v43) &gt; 0x40 ) v32 = 64; memmove((v8 + 4 * v31), Dst, v32); if ( !a6 ) return v48; v33 = v29; if ( v29 &lt; v29 + v43 ) { v34 = (v8 + 4 * v29 + 214); do { Dst[v33++] = *v34 &gt;&gt; 15; v34 += 2; } while ( v33 &lt; v29 + v43 ); } v35 = (v45 - 1) &amp; 0xF; if ( v35 &gt;= v31 ) { v36 = (v8 + 4 * ((v27 + v47 - 1) &amp; 0xF) + 214); v37 = (v8 + 4 * ((v45 - 1) &amp; 0xF) + 214); v38 = v35 - v31 + 1; do { v39 = *v37 ^ (*v37 ^ *v36) &amp; 0x7FFF; v37 -= 2; *v36 = v39; v36 -= 2; --v38; } while ( v38 ); v27 = v48; } v40 = v31; if ( v31 &gt;= v31 + v43 ) return v27; v41 = (v8 + 4 * v31 + 214); do { *v41 = *v41 &amp; 0x7FFF | (LOWORD(Dst[v40++]) &lt;&lt; 15); v41 += 2; } while ( v40 &lt; v31 + v43 ); return v27; } v9 = a1 - a4; v10 = a3 - a1; v42 = a1 - a4; v48 = 16 - v7; if ( 16 - v7 &gt;= v10 ) v48 = v10; if ( !v8 ) return v48; v11 = 4 * v9; if ( (4 * v9) &gt; 0x40 ) v11 = 64; v12 = (v8 + 4 * (a4 &amp; 0xF)); v44 = a4 &amp; 0xF; memmove(Dst, v12, v11); v13 = 4 * v48; if ( (4 * v48) &gt; 0x40 ) v13 = 64; memmove(v12, (v8 + 4 * v7), v13); v14 = 4 * v42; if ( (4 * v42) &gt; 0x40 ) v14 = 64; memmove((v8 + 4 * ((a4 + v48) &amp; 0xF)), Dst, v14); if ( !a6 ) return v48; v15 = a4 &amp; 0xF; if ( v44 &lt; v44 + v42 ) { v16 = (v8 + 4 * v44 + 214); do { Dst[v15++] = *v16 &gt;&gt; 15; v16 += 2; } while ( v15 &lt; v44 + v42 ); } if ( v7 &lt; v48 + v7 ) { v17 = (v8 + 4 * v7 + 214); v18 = v12 + 107; v19 = v48; do { v20 = *v17 ^ (*v17 ^ *v18) &amp; 0x7FFF; v17 += 2; *v18 = v20; v18 += 2; --v19; } while ( v19 ); } v21 = a4 &amp; 0xF; if ( v44 &gt;= v44 + v42 ) return v48; v22 = (v8 + 4 * (v44 + v48) + 214); do { *v22 = *v22 &amp; 0x7FFF | (LOWORD(Dst[v21++]) &lt;&lt; 15); v22 += 2; } while ( v21 &lt; v44 + v42 ); return v48; }</span></span></code> </pre> </div></div><br><p> æ­¤å¤–ï¼Œä»å¤–è§‚ä¸Šï¼Œæ‚¨å¯ä»¥å¤§è‡´äº†è§£é‚£é‡Œå‘ç”Ÿçš„äº‹æƒ…ï¼Œå…¶ä½™çš„å¯ä»¥é€šè¿‡é—´æ¥æ ‡å¿—æ¥ç»“æŸã€‚ <br> æˆ‘ä»¬å°è¯•è¯†åˆ«è¿™äº›é—´æ¥åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œä»¥éšæœºé¡ºåºå°†ç¬¬16è¡Œçš„é«˜åº¦è®¾ç½®ä¸º64ï¼ˆå«ï¼‰ã€‚ ç„¶åï¼Œåœ¨ç´¢å¼•39ä¸‹çš„è¡Œçš„å‰é¢æ’å…¥æ–°è¡Œã€‚ æ–°è¡Œå°†å¤åˆ¶ç¬¬38è¡Œçš„é«˜åº¦ã€‚ <br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ·»åŠ ç³»åˆ—ä¹‹å‰å’Œä¹‹åçš„ç³»åˆ—åˆ†ç»„ä¸­çš„ä¿¡æ¯ï¼Œæˆ‘é‡ç‚¹ä»‹ç»äº†ç²—ä½“çš„åŒºåˆ«ï¼š </p><br><table><thead><tr><th> åœ¨æ·»åŠ è¡Œä¹‹å‰ </th><th> æ·»åŠ ä¸€è¡Œå </th></tr></thead><tbody><tr><td> ç¬¬ä¸€ç»„çš„æ’é‡ï¼š </td><td> ç¬¬ä¸€ç»„çš„æ’é‡ï¼š </td></tr><tr><td>  0Eï¼Œ04ã€07ã€00ã€05ã€0Aï¼Œ09ã€0Fï¼Œ03ã€06ã€08ã€0Dï¼Œ01ã€0Bï¼Œ0Cï¼Œ02 </td><td>  0Eï¼Œ04ã€07ã€00ã€05ã€0Aï¼Œ09ã€0Fï¼Œ03ã€06ã€08ã€0Dï¼Œ01ã€0Bï¼Œ0Cï¼Œ02 </td></tr><tr><td> ç¬¬ä¸€ç»„ä¸­å„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬ä¸€ç»„ä¸­å„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  05ã€2Bï¼Œ35ã€45ã€4Bï¼Œ50ã€5Bï¼Œ6Bï¼Œ7Bï¼Œ8Bï¼ŒA5ï¼ŒABï¼ŒB0ï¼ŒB5ï¼ŒE0ã€100 </td><td>  05ã€2Bï¼Œ35ã€45ã€4Bï¼Œ50ã€5Bï¼Œ6Bï¼Œ7Bï¼Œ8Bï¼ŒA5ï¼ŒABï¼ŒB0ï¼ŒB5ï¼ŒE0ã€100 </td></tr><tr><td> ç¬¬äºŒç»„ä½ç§»ï¼š </td><td> ç¬¬äºŒç»„ä½ç§»ï¼š </td></tr><tr><td>  06ã€02ã€0Eï¼Œ <strong>09ã€01ã€07ã€0Fï¼Œ0C</strong> ï¼Œ00ã€0Aï¼Œ04ã€0Bï¼Œ <strong>03ã€08ã€0Dï¼Œ05</strong> </td><td>  06ã€02ã€0Eï¼Œ <strong>09ã€01ã€07ã€0F</strong> ï¼Œ05ã€0Cï¼Œ00ã€0Aï¼Œ04ã€0Bï¼Œ <strong>03ã€08ã€0D</strong> </td></tr><tr><td> ç¬¬äºŒç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬äºŒç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  10ã€15ã€20ã€25ã€30ã€75ã€85ã€90ã€9Bï¼ŒA0ï¼ŒC5ï¼ŒCBï¼ŒD0ï¼ŒD5ï¼ŒE5ï¼ŒF0 </td><td>  10ã€15ã€20ã€25ã€30ï¼ŒF0ã€85ã€90ã€9Bï¼ŒA0ï¼ŒC5ï¼ŒCBï¼ŒD0ï¼ŒD5ï¼ŒE5ï¼ŒF0 </td></tr><tr><td> ç¬¬ä¸‰ç»„ä½ç§»ï¼š </td><td> ç¬¬ä¸‰ç»„ä½ç§»ï¼š </td></tr><tr><td>  0Cï¼Œ08ã€0Eï¼Œ07ã€0Aï¼Œ01ã€06ã€0Fï¼Œ09ã€0Dï¼Œ00ã€05ã€0Bï¼Œ02ã€04ã€03 </td><td>  03ï¼Œ0Cï¼Œ08ï¼Œ0Eï¼Œ07ï¼Œ0Aï¼Œ01ï¼Œ06ï¼Œ0Fï¼Œ09ï¼Œ0Dï¼Œ00ï¼Œ05ï¼Œ0Bï¼Œ02ï¼Œ04 </td></tr><tr><td> ç¬¬ä¸‰ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬ä¸‰ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  0Bï¼Œ1Bï¼Œ3Bï¼Œ40ã€55ã€60ã€65ã€70ã€80ã€95ï¼ŒBBï¼ŒC0ï¼ŒDBï¼ŒEBï¼ŒF5ï¼ŒFB </td><td>  0Bï¼Œ1Bï¼Œ3Bï¼Œ75ã€55ã€60ã€65ã€70ã€80ã€95ï¼ŒBBï¼ŒC0ï¼ŒDBï¼ŒEBï¼ŒF5ï¼ŒFB </td></tr><tr><td> ç¬¬å››ç»„çš„åç§»é‡ï¼š </td><td> ç¬¬å››ç»„çš„åç§»é‡ï¼š </td></tr><tr><td>  _ </td><td>  <strong>00</strong> </td></tr><tr><td> ç¬¬å››ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬å››ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  _ </td><td>  <strong>40</strong> </td></tr></tbody></table><br><p> è¿™æ˜¯é¢„æœŸçš„ï¼šExcelå°†ç¬¬äºŒè¡Œæ’å…¥ç´¢å¼•ä¸º7ï¼ˆ39ï¼†0xFï¼‰çš„æ–°è¡Œï¼Œå…¶åç§»é‡ä¸º0x05ï¼Œå°†è¡Œé«˜åº¦å¤åˆ¶åˆ°ç´¢å¼•6ï¼Œè€Œæœ€åä¸€è¡Œï¼ˆåç§»é‡ä¸º05ï¼‰è¢«æ¨åˆ°ä¸‹ä¸€è¡Œç»„ï¼Œç„¶åä»é‚£é‡Œå°†æœ€åä¸€è¡Œæ¨åˆ°ç¬¬å››è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚ </p><br><p> ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœåˆ é™¤ç¬¬29è¡Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚ </p><br><table><thead><tr><th> åˆ é™¤è¡Œä¹‹å‰ </th><th> åˆ é™¤è¡Œå </th></tr></thead><tbody><tr><td> ç¬¬ä¸€ç»„çš„æ’é‡ï¼š </td><td> ç¬¬ä¸€ç»„çš„æ’é‡ï¼š </td></tr><tr><td>  0Eï¼Œ04ã€07ã€00ã€05ã€0Aï¼Œ09ã€0Fï¼Œ03ã€06ã€08ã€0Dï¼Œ <strong>01ã€0Bï¼Œ0Cï¼Œ02</strong> </td><td>  0Eï¼Œ04ã€07ã€00ã€05ã€0Aï¼Œ09ã€0Fï¼Œ03ã€06ã€08ã€0Dï¼Œ01ã€0C <strong>ï¼Œ02ã€0B</strong> </td></tr><tr><td> ç¬¬ä¸€ç»„ä¸­å„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬ä¸€ç»„ä¸­å„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  05ã€2Bï¼Œ35ã€45ã€4Bï¼Œ50ã€5Bï¼Œ6Bï¼Œ7Bï¼Œ8Bï¼ŒA5ï¼Œ <strong>AB</strong> ï¼ŒB0ï¼ŒB5ï¼ŒE0ã€100 </td><td>  05ã€2Bï¼Œ35ã€45ã€4Bï¼Œ50ã€5Bï¼Œ6Bï¼Œ7Bï¼Œ8Bï¼ŒA5ã€85ï¼ŒB0ï¼ŒB5ï¼ŒE0ã€100 </td></tr><tr><td> ç¬¬äºŒç»„ä½ç§»ï¼š </td><td> ç¬¬äºŒç»„ä½ç§»ï¼š </td></tr><tr><td>  06ï¼Œ02ï¼Œ0Eï¼Œ09ï¼Œ01ï¼Œ07ï¼Œ0Fï¼Œ05ï¼Œ0Cï¼Œ00ï¼Œ0Aï¼Œ04ï¼Œ0Bï¼Œ03ï¼Œ08ï¼Œ0D </td><td>  02ï¼Œ0Eï¼Œ09ï¼Œ01ï¼Œ07ï¼Œ0Fï¼Œ05ï¼Œ0Cï¼Œ00ï¼Œ0Aï¼Œ04ï¼Œ0Bï¼Œ03ï¼Œ08ï¼Œ0Dï¼Œ <strong>06</strong> </td></tr><tr><td> ç¬¬äºŒç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬äºŒç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  10ã€15ã€20ã€25ã€30ï¼ŒF0ã€85ã€90ã€9Bï¼ŒA0ï¼ŒC5ï¼ŒCBï¼ŒD0ï¼ŒD5ï¼ŒE5ï¼ŒF0 </td><td>  10ã€15ã€20ã€25ã€30ï¼ŒF0ã€75ã€90ã€9Bï¼ŒA0ï¼ŒC5ï¼ŒCBï¼ŒD0ï¼ŒD5ï¼ŒE5ï¼ŒF0 </td></tr><tr><td> ç¬¬ä¸‰ç»„ä½ç§»ï¼š </td><td> ç¬¬ä¸‰ç»„ä½ç§»ï¼š </td></tr><tr><td>  03ï¼Œ0Cï¼Œ08ï¼Œ0Eï¼Œ07ï¼Œ0Aï¼Œ01ï¼Œ06ï¼Œ0Fï¼Œ09ï¼Œ0Dï¼Œ00ï¼Œ05ï¼Œ0Bï¼Œ02ï¼Œ04 </td><td>  0Cï¼Œ08ã€0Eï¼Œ07ã€0Aï¼Œ01ã€06ã€0Fï¼Œ09ã€0Dï¼Œ00ã€05ã€0Bï¼Œ02ã€04ã€03 </td></tr><tr><td> ç¬¬ä¸‰ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬ä¸‰ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  0Bï¼Œ1Bï¼Œ3Bï¼Œ75ã€55ã€60ã€65ã€70ã€80ã€95ï¼ŒBBï¼ŒC0ï¼ŒDBï¼ŒEBï¼ŒF5ï¼ŒFB </td><td>  0Bï¼Œ1Bï¼Œ3Bï¼Œ40ã€55ã€60ã€65ã€70ã€80ã€95ï¼ŒBBï¼ŒC0ï¼ŒDBï¼ŒEBï¼ŒF5ï¼ŒFB </td></tr><tr><td> ç¬¬å››ç»„çš„åç§»é‡ï¼š </td><td> ç¬¬å››ç»„çš„åç§»é‡ï¼š </td></tr><tr><td>  00 </td><td>  00 </td></tr><tr><td> ç¬¬å››ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td><td> ç¬¬å››ç»„ä¸­çš„è¡Œçš„é«˜åº¦å€¼ï¼š </td></tr><tr><td>  <strong>40</strong> </td><td>  <strong>50</strong> </td></tr></tbody></table><br><p> åŸåˆ™ä¸Šï¼Œå½“åˆ é™¤ä¸€è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿåå‘æ“ä½œã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬å››ç»„ç»§ç»­å­˜åœ¨ï¼Œå¹¶ä¸”è¯¥è¡Œçš„é«˜åº¦å€¼è¢«æ ‡å‡†é«˜åº¦å¡«å……ï¼Œå¹¶å¸¦æœ‰ç›¸åº”çš„æ ‡å¿—-0x8005ã€‚ </p><br><p> è¿™äº›æ•°æ®è¶³ä»¥åœ¨Cï¼ƒä¸­é‡ç°æ­¤ç®—æ³•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ’å…¥è¡Œ</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RowHeightInfo etalonRowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); RowHeightInfo newRowHeightInfo = etalonRowHeightInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? etalonRowHeightInfo.Clone() : CreateDefaultRowHeight(sheetLayoutInfo); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = (rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newRowInGroupIndex = (rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (groupIndex = realGroupIndex + sheetLayoutInfo.GroupIndexDelta; groupIndex &lt; sheetLayoutInfo.RowsGroups.Count; groupIndex++, newRowInGroupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == SheetLayoutInfo.MaxGroupsCount) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((newRowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[groupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[newRowInGroupIndex]; RowHeightInfo lastRowHeightInGroup; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span> || rowsGroupInfo.HeightInfos.Count &lt; SheetLayoutInfo.MaxRowsCountInGroup) { lastRowHeightInGroup = GetRowHeightCore(sheetLayoutInfo, ((groupIndex - sheetLayoutInfo.GroupIndexDelta) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>); Array.Copy(rowsGroupInfo.Indices, newRowInGroupIndex, rowsGroupInfo.Indices, newRowInGroupIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span> - newRowInGroupIndex); rowsGroupInfo.HeightInfos.Add(newRowHeightInfo); rowsGroupInfo.Indices[newRowInGroupIndex] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastIndex = rowsGroupInfo.Indices[SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>]; lastRowHeightInGroup = rowsGroupInfo.HeightInfos[lastIndex]; Array.Copy(rowsGroupInfo.Indices, newRowInGroupIndex, rowsGroupInfo.Indices, newRowInGroupIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span> - newRowInGroupIndex); rowsGroupInfo.HeightInfos[lastIndex] = newRowHeightInfo; rowsGroupInfo.Indices[newRowInGroupIndex] = lastIndex; } newRowHeightInfo = lastRowHeightInGroup ?? CreateDefaultRowHeight(sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((newRowHeightInfo.Flags &amp; CustomHeightMask) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; groupIndex != SheetLayoutInfo.MaxGroupsCount) { SetRowHeight(((groupIndex - sheetLayoutInfo.GroupIndexDelta) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + newRowInGroupIndex, newRowHeightInfo.Value, newRowHeightInfo.Flags, sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sheetLayoutInfo.MaxRowIndexNonDefault = Math.Min(sheetLayoutInfo.MaxRowIndexNonDefault + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCount); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">åˆ é™¤è¡Œ</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newRowInGroupIndex = rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (groupIndex = realGroupIndex + sheetLayoutInfo.GroupIndexDelta; groupIndex &lt; sheetLayoutInfo.RowsGroups.Count; groupIndex++, newRowInGroupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex &lt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { sheetLayoutInfo.RowsGroups.Insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); sheetLayoutInfo.GroupIndexDelta++; groupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == SheetLayoutInfo.MaxGroupsCount) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newRowHeightInfo = groupIndex == SheetLayoutInfo.MaxGroupsCount - <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : GetRowHeightCore(sheetLayoutInfo, (groupIndex - sheetLayoutInfo.GroupIndexDelta + <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>); RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newRowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || (newRowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[groupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newRowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { newRowHeightInfo = CreateDefaultRowHeight(sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[newRowInGroupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = newRowInGroupIndex; i &lt; SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { rowsGroupInfo.Indices[i] = rowsGroupInfo.Indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } rowsGroupInfo.HeightInfos.Add(newRowHeightInfo); rowsGroupInfo.Indices[SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = newRowInGroupIndex; i &lt; rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { rowsGroupInfo.Indices[i] = rowsGroupInfo.Indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } rowsGroupInfo.Indices[rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>] = rowInfoIndex; rowsGroupInfo.HeightInfos[rowInfoIndex] = newRowHeightInfo; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rowIndex &lt;= sheetLayoutInfo.MinRowIndexNonDefault) { sheetLayoutInfo.MinRowIndexNonDefault = Math.Max(sheetLayoutInfo.MinRowIndexNonDefault - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> </div></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>æ‚¨å¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°ä¸Šè¿°æ‰€æœ‰ä»£ç </strong></a> </p><br><h2 id="vyvody"> ç»“è®º </h2><br><p> è¿™ä¸æ˜¯Excelä»£ç ç¬¬ä¸€æ¬¡å¯¹æœ‰è¶£çš„æŠ€å·§æ„Ÿåˆ°æƒŠè®¶ã€‚ è¿™æ¬¡ï¼Œæˆ‘å‘ç°äº†ä»–å¦‚ä½•å­˜å‚¨æœ‰å…³è¡Œé«˜çš„ä¿¡æ¯ã€‚ å¦‚æœç¤¾åŒºæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºExcelå¦‚ä½•è€ƒè™‘åƒå…ƒèŒƒå›´çš„é«˜åº¦ï¼ˆæ‰°æµå™¨ï¼šæœ‰äº›ç±»ä¼¼äºSQRTåˆ†è§£ï¼Œä½†ç”±äºæŸç§åŸå› è€Œæ²¡æœ‰æ±‚å’Œç¼“å­˜ï¼‰ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å®ƒå¦‚ä½•å°†æ•´æ•°æŒ‰æ¯”ä¾‹ç¼©æ”¾ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN435426/">https://habr.com/ru/post/zh-CN435426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN435416/index.html">DIYé¡¹ç›®æŠ€æœ¯ã€‚ å…¥é—¨éƒ¨åˆ†</a></li>
<li><a href="../zh-CN435418/index.html">åœ¨Flutterä¸­ä½¿ç”¨SQLite</a></li>
<li><a href="../zh-CN435420/index.html">æ‰“å‡»çŠ¯ç½ªçš„æœªæ¥æ˜¯å¯¹å®¶è°±çš„ç ”ç©¶</a></li>
<li><a href="../zh-CN435422/index.html">ç¡…è°·çš„äººå¦‚ä½•æœ‰ç»éªŒ</a></li>
<li><a href="../zh-CN435424/index.html">è§£æå’ŒAndroidï¼šå¯¹æ–°æ‰‹å¼€å‘äººå‘˜çš„å»ºè®®</a></li>
<li><a href="../zh-CN435428/index.html">ä½¿ç”¨Pythonè¿œç¨‹æ§åˆ¶Fceuxä»¿çœŸå™¨</a></li>
<li><a href="../zh-CN435430/index.html">CES 2019æœ€é…·çš„æ–°é—»</a></li>
<li><a href="../zh-CN435432/index.html">æ–°å¹´ï¼Œæ–°çš„GitHubï¼šæ— é™çš„å…è´¹ç§äººå­˜å‚¨åº“</a></li>
<li><a href="../zh-CN435436/index.html">ITåŸºç¡€æ¶æ„çš„5å¤§è¶‹åŠ¿ï¼š2019å¹´çš„é¢„æµ‹</a></li>
<li><a href="../zh-CN435438/index.html">PHPï¼šåœ¨å›¢é˜Ÿå¼€å‘ä¸­æ›´æ”¹æ•°æ®åº“ç»“æ„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>