<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥨 😐 👩‍⚖️ تقليل حركة المرور في نماذج ويب ASP.NET ، و div للنقر والاستقصاء الدوري للخادم ♠️ 🙆 🤴🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="تكنولوجيا نماذج ويب ASP.NET ببطء ولكن بالتأكيد شيء من الماضي. يتم استبداله بواجهة برمجة تطبيقات ويب مع Angular 6 ومكدسات مماثلة. لكنني ورثت مشروعًا في...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تقليل حركة المرور في نماذج ويب ASP.NET ، و div للنقر والاستقصاء الدوري للخادم</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427291/" style=";text-align:right;direction:rtl">  تكنولوجيا نماذج ويب ASP.NET ببطء ولكن بالتأكيد شيء من الماضي.  يتم استبداله بواجهة برمجة تطبيقات ويب مع Angular 6 ومكدسات مماثلة.  لكنني ورثت مشروعًا في نماذج الويب بإرث ضخم.  لدي بعض الأصدقاء الذين لديهم موقف مماثل زائد أو ناقص.  تطبيقات طويلة مكتوبة على التكنولوجيا القديمة التي تحتاج إلى تطوير وصيانة.  نماذج الويب لديها القدرة على PostBack ليس لتحديث الصفحة بأكملها ، ولكن فقط جزء منها.  ما هو ملفوف في UpdatePanel.  هذا يضيف التفاعل ، لكنه لا يزال يعمل ببطء شديد ويستهلك الكثير من حركة المرور ، لأنه  يحدث العرض في كل مرة على الخادم ، ويتم منح العميل ترميزًا جاهزًا يجب إدراجه بدلاً من div الحالي بالداخل.  بالمناسبة ، يتم عرض UpdatePanel فقط في div ، ثم يتم استبدال الترميز. <br><a name="habracut"></a><br>  ما الذي يمكن فعله لتقليل حركة المرور؟ <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> اكتب WebMethod على الصفحة واتصل بها من العميل باستخدام أدوات AJAX ، عندما تتلقى استجابة ، قم بتغيير DOM عبر JS. <br><br>  الجانب السلبي لهذا الحل هو أنه لا يمكنك تحديد WebMethod في التحكم.  لا أرغب في كتابة جميع الوظائف على الصفحة ، خاصة إذا تم استخدامها عدة مرات على صفحات مختلفة. </li><li style=";text-align:right;direction:rtl">  اكتب خدمة asmx ، واتصل بها من العميل.  هذا أفضل ، ولكن في هذه الحالة لا يوجد اتصال صريح بين عنصر التحكم والخدمة.  سيزداد عدد الخدمات مع زيادة عدد الضوابط.  بالإضافة إلى ذلك ، لن تكون ViewState متاحة لنا ، مما يعني أننا سنمر المعلمات بشكل صريح عند الوصول إلى الخدمة ، لذلك سنقوم بالتحقق من الخادم والتحقق مما إذا كان للمستخدم الحق في القيام بما طلبه. </li><li style=";text-align:right;direction:rtl">  استخدم واجهة ICallbackEventHandler.  هذا ، في رأيي ، خيار جيد. <br><br>  سوف أتطرق إلى مزيد من التفاصيل. </li></ol><br>  أول شيء يجب فعله هو توريث UserControl من ICallbackEventHandler وكتابة أساليب RaiseCallbackEvent و GetCallbackResult.  من الغريب أن هناك اثنان منها ، الأول مسؤول عن تلقي المعلمات من العميل ، والثاني مسؤول عن إرجاع النتيجة. <br>  سيبدو شيء من هذا القبيل <br><br><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeControl</span></span> : <span class="hljs-title"><span class="hljs-title">UserControl</span></span>, <span class="hljs-title"><span class="hljs-title">ICallbackEventHandler</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta">  /// &lt;summary&gt; ///    /// &lt;/summary&gt; private Guid _someFileId; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta">  ICallbackEventHandler /// &lt;inheritdoc /&gt; public void RaiseCallbackEvent(string eventArgument) { //    try { dynamic args = JsonConvert.DeserializeObject&lt;dynamic&gt;(eventArgument); _someFileId = (Guid) args.SomeFileId; string type = (string) args.Type; } catch (Exception exc) { //  throw; } } /// &lt;inheritdoc /&gt; public string GetCallbackResult() { //  try { // -  return JsonConvert.SerializeObject(new { Action = actionName, FileId = _someFileId, }); } catch (Exception exc) { //  throw; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> }</span></span></code> </pre> <br>  كان جانب الخادم.  العميل الآن <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SomeControl = { <span class="hljs-attr"><span class="hljs-attr">_successCallbackHandler</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">responseData</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(responseData); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (data.Action) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"continue"</span></span>: <span class="hljs-comment"><span class="hljs-comment">// -   break; case "success": //  -  break; case "fail": //   break; default: //   alert,     alert("      "); break; } }, _failCallbackHandler: function() { alert("      "); }, }</span></span></code> </pre><br>  هذا ليس كل شيء.  ما زلنا بحاجة إلى إنشاء JS لربط جميع وظائفنا. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnLoad</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnLoad(e); <span class="hljs-comment"><span class="hljs-comment">//   SomeControl.js,     Page.ClientScript.RegisterClientScriptInclude(Page.GetType(), "SomeControl", "/Scripts/controls/SomeControl.js?v=2.24.0"); string callbackArgument = //   //***  .***   JS   SomeControl  CallServer.       ,     ScriptManager.RegisterStartupScript(Page, Page.GetType(), "SomeControl.Initialize", $@"SomeControl.CallServer = function(someFileId) {{ let args = JSON.stringify({{ SomeFileId : someFileId, Type: '{callbackArgument}' }}); {Page.ClientScript.GetCallbackEventReference(this, "args", "SomeControl._successCallbackHandler", string.Empty, "SomeControl._failCallbackHandler", true)}; }};", true); //    ScriptManager.GetCurrent(Page)?.RegisterAsyncPostBackControl(this); }</span></span></code> </pre><br>  من الواضح أن هذا رمز وراء عنصر التحكم. <br><br>  الشيء الأكثر إثارة للاهتمام هو إنشاء وظائف JS باستخدام طريقة GetCallbackEventReference. <br><br>  نمر فيه <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  رابط إلى سيطرتنا </li><li style=";text-align:right;direction:rtl">  اسم متغير JS الذي سيتم تمرير قيمته إلى الخادم في طريقة RaiseCallbackEvent عبر eventArgument (السطر أعلاه يقوم بتسلسل الكائن في JSON لإرساله ويقوم بالفعل بتعيين قيمة متغير args) </li><li style=";text-align:right;direction:rtl">  اسم رد وظيفة JS للنجاح </li><li style=";text-align:right;direction:rtl">  سياق التنفيذ (أنا لا أستخدمه) </li><li style=";text-align:right;direction:rtl">  اسم وظيفة رد اتصال JS في حالة حدوث خطأ ما </li><li style=";text-align:right;direction:rtl">  سنقوم بالتحقق من صحة الطلب الذي جاء إلى الخادم باستخدام أدوات ASP.NET </li></ul><br>  كيف سيعمل كل هذا معًا؟ <br><br>  من JS يمكننا استدعاء SomeControl.CallServer ، ستقوم هذه الوظيفة بإنشاء متغيرات محلية وتمرير التحكم إلى وظيفة ستقوم بتقديم طلب إلى الخادم من خلال AJAX. <br>  بعد ذلك ، يتم تمرير التحكم إلى طريقة خادم RaiseCallbackEvent.  كل ما كان في متغير عميل args سقط الآن في eventArgument معلمة إدخال الخادم. <br>  بعد تنفيذ RaiseCallbackEvent ، سيتم تمرير التحكم إلى GetCallbackResult. <br><br>  سيتم إرسال السلسلة التي سنرجعها عبر الإرجاع إلى العميل والدخول إلى معلمة الإدخال الخاصة بدالة SomeControl._successCallbackHandler ، أي في responseData. <br>  إذا طرح رمز الخادم في مرحلة ما استثناءً ، فسيتم نقل التحكم إلى العميل SomeControl._failCallbackHandler <br><br>  ما زلت بحاجة للقول عن ViewState.  يتم نقل ViewState من العميل إلى الخادم ، ويمكن استخدامه ، ولكن فقط في وضع ReadOnly ، مثل  لا يتم إرسال ViewState إلى العميل. <br><br>  التصميم مربك للوهلة الأولى ، ولكن إذا نظرت ، اتضح أنه مريح للغاية ، وتم حفظ حركة المرور. <br><br>  السؤال الثاني الذي أريد تسليط الضوء عليه في هذه المقالة هو divs القابلة للنقر أو كيف يمكنك التسبب في استدعاء UpdatePanel من العميل. <br><br>  لماذا يلزم استخدام divs قابل للنقر ، فهل يمكنك استخدام &lt;asp: Button&gt;؟ <br>  يعجبني أن div يمكن تكوينه كما أريد ، لست مقيدًا بنوع الإدخال = "button" <br><br>  من أجل التنفيذ ، من الضروري أن تكون موروثة من واجهة IPostBackEventHandler <br><br>  لديه طريقة واحدة فقط <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RaisePostBackEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventArgument</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br>  الآن ، كما في الحالة السابقة ، نحتاج إلى إنشاء JS لاستدعاء هذه الطريقة <br><br>  يبدو هذا <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">Page.ClientScript.GetPostBackEventReference(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, callbackArgument)</code> </pre> <br>  تم تعيين callbackArgument على الخادم ولن يعمل تغييره على العميل.  ولكن يمكنك دائمًا وضع شيء ما في HiddenField.  لدينا PostBack الكامل <br><br>  يمكن الآن تعليق نتيجة GetPostBackEventReference بمجرد النقر على أي div أو امتداد أو أيا كان. <br><br>  أو فقط اتصل من JS بواسطة جهاز ضبط الوقت. <br><br>  تأكد من تسجيل عنصر التحكم على أنه غير متزامن (على OnLoad نسميه <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">ScriptManager.GetCurrent(Page)?.RegisterAsyncPostBackControl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre>  ) ، وإلا ، حتى في داخل UpdatePanel ، سيتم استدعاء PostBack المتزامن وسيتم تحديث الصفحة بأكملها ، وليس فقط محتويات UpdatePanel <br><br>  باستخدام الطريقتين الموصوفتين أعلاه ، قمت بتطبيق مثل هذا السيناريو. <br><br>  نقر المستخدم على الزر ، وتم إرسال طلب صغير لعملية طويلة (10-15 ثانية) إلى الخادم ، وتلقى المستخدم استجابة قصيرة ، وأثناء التحليل تم تعيين مكالمات البرنامج النصي للعميل.  في setTimeout ، يتم تمرير وظيفة لاستدعاء للخادم من أجل معرفة نتائج العملية المطلوبة مسبقًا.  إذا كانت النتيجة جاهزة ، فاتصل بـ PostBack في UpdatePanel - يتم تحديث UpdatePanel المحدد.  إذا لم تكن النتيجة جاهزة بعد ، فاتصل setTimeout مرة أخرى. <br><br>  حظاً طيباً لكل من لا يزال يعمل مع نماذج الويب ، آمل أن تجعل المقالة أنظمتكم أسرع وأجمل ، وسيشكرك المستخدمون. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar427291/">https://habr.com/ru/post/ar427291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar427279/index.html">تعاونية: Android Night #Apple</a></li>
<li><a href="../ar427281/index.html">تطوير فئات الواجهة في C ++</a></li>
<li><a href="../ar427283/index.html">كيف يتم ضمان التوفر العالي في Kubernetes</a></li>
<li><a href="../ar427285/index.html">مدرسة حول أساسيات الدوائر الرقمية: نوفوسيبيرسك - حسنًا ، كراسنويارسك - استعد</a></li>
<li><a href="../ar427289/index.html">النمذجة الجيولوجية ثلاثية الأبعاد وتسجيل القطع والتكناتون من ابتكارات أرامكو</a></li>
<li><a href="../ar427293/index.html">أنماط تصميم جافا سكريبت</a></li>
<li><a href="../ar427295/index.html">وظائف JavaScript Currying</a></li>
<li><a href="../ar427297/index.html">Apache Ignite + Apache Spark Data Frames: معًا أكثر متعة</a></li>
<li><a href="../ar427299/index.html">دعونا نحصل على شيء آخر نجمعه؟ منشئ 3 في 1 "أسطول القمر"</a></li>
<li><a href="../ar427301/index.html">تعطل GitHub قاعدة البيانات</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>