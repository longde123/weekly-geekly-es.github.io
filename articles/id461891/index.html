<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥅 ⛹🏼 ♨️ Bagaimana kami berteman di infrastruktur bank menggunakan ManageIQ 🔼 👧🏾 🥂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa tahun yang lalu, tren utamanya adalah otomatisasi, praktik DevOps, dan percepatan pengiriman nilai ke pasar. Home Credit Bank memutuskan untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami berteman di infrastruktur bank menggunakan ManageIQ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/461891/"><p>  Beberapa tahun yang lalu, tren utamanya adalah otomatisasi, praktik DevOps, dan percepatan pengiriman nilai ke pasar.  Home Credit Bank memutuskan untuk mengikuti perkembangan teknologi, apalagi bisikan pengguna yang bosan menunggu beberapa hari untuk menunggu sumber daya baru agar proyek penting mereka menyebar lebih keras di ruang terbuka. </p><br><p>  Kami memutuskan untuk memulai dengan proses menyetujui aplikasi oleh departemen, yang, seperti di banyak perusahaan besar, membutuhkan waktu dan upaya.  Sebagai tugas pertama, kami memilih proses menciptakan mesin virtual terlepas dari lingkungan virtualisasi.  Membuat daftar tugas, kami menyadari bahwa perlu mengintegrasikan dengan sistem lain yang digunakan dalam infrastruktur bank kami, misalnya, melalui API. </p><br><p><img src="https://habrastorage.org/webt/tt/h7/br/tth7br6euodgo1dklwgmaqhdxu4.png" alt="gambar"></p><a name="habracut"></a><br><p> Solusi yang paling cocok adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ManageIQ</a> .  Ini adalah proyek yang diakuisisi Red Hat pada 2012 dan berdasarkan itu diciptakan produk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Red Hat CloudForms</a> komersial.  Pada saat yang sama, ManageIQ tetap dalam status produk sumber terbuka dan berkembang secara paralel dengan CloudForms. </p><br><p>  ManageIQ ditulis dalam Ruby dan mendukung sejumlah besar penyedia virtualisasi, cloud publik, dan penampung yang berbeda.  Saat ini, kami menggunakan versi Gaprindashvili dalam konfigurasi Ketersediaan Tinggi di Rumah. </p><br><h2>  Bagaimana prosesnya telah berubah </h2><br><p>  Sebelumnya, setiap tim membutuhkan pengaturan terpisah dalam bidang tanggung jawabnya.  Setelah persiapan awal, semua data dikumpulkan dan dikirim ke administrator, yang menggunakan dan mengkonfigurasi mesin virtual.  Maka perlu untuk menginformasikan, misalnya, tim pemantauan bahwa tuan rumah baru telah muncul yang perlu ditambahkan ke pemantauan.  Keterlambatan komunikasi, beban kerja spesialis, kesalahan yang disebabkan oleh faktor manusia, dapat memperpanjang proses ini menjadi beberapa hari. </p><br><p>  Setelah memasukkan seluruh proses ke dalam ManageIQ, kami mendapatkan hasil berikut: </p><br><div class="scrollable-table"><table><thead><tr><th>  Jenis sumber daya virtual </th><th>  Sebelum memperkenalkan ManageIQ </th><th>  Setelah menerapkan ManageIQ </th></tr></thead><tbody><tr><td>  Mesin virtual Linux di VMware / oVirt </td><td>  Untuk satu </td><td>  ~ 10 menit </td></tr><tr><td>  Lingkungan mesin virtual Rancher </td><td>  sedang bekerja </td><td>  ~ 15 menit </td></tr><tr><td>  Mesin Virtual Windows di VMware </td><td>  minggu </td><td>  ~ 25 menit </td></tr></tbody></table></div><br><p>  Perbedaan waktu disebabkan oleh fakta bahwa dalam kasus kedua, waktu tambahan diperlukan untuk menyiapkan host untuk bekerja dengan Docker, mengunduh dan mendegradasi gambar untuk wadah infrastruktur dari Artifactory, karena pada tahap ini masih belum ada akses ke Docker Hub.  Dalam kasus Windows, perbedaan dicapai karena fakta bahwa, pertama, waktu pembuatan VM Linux tanpa penyesuaian adalah sekitar 2 menit, dan bahwa dari VM Windows adalah 6 menit.  Kedua, menyesuaikan Windows itu sendiri membutuhkan waktu sekitar 10 menit, versus 2 menit untuk Linux. </p><br><p>  10 menit tidak begitu cepat, mengingat bahwa sekitar 2-3 menit dihabiskan langsung pada proses pembuatan VM.  Untuk sisa waktu, ManageIQ berhasil melakukan hal berikut: </p><br><ol><li>  Sistem mengumpulkan parameter yang ditentukan oleh pengguna dalam formulir pemesanan dan menguraikannya menjadi variabel. </li><li>  Permintaan perubahan baru dibuat dalam sistem manajemen insiden, yang menampilkan data tentang sumber daya baru. </li><li>  Sistem Kueri Nama Sumber Daya ManageIQ mengirimkan nilai untuk sumber daya baru. </li><li>  Sistem manajemen alamat IP mengeluarkan alamat baru berdasarkan parameter yang dimasukkan. </li><li>  Catatan DNS baru terdaftar di server DNS lokal. </li><li>  Berdasarkan pada parameter, lingkungan dan beban sumber daya, jenis virtualisasi dan cluster untuk penempatan dipilih. </li><li>  Selanjutnya, proses pembuatan mesin virtual dengan parameter yang ditentukan. </li><li>  Ketika mesin virtual digunakan dari templat, Anda perlu menjalankan skrip yang akan membuat pengaturan akhir: <br><ul><li>  ekspansi disk ke ukuran yang ditentukan, </li><li>  menghasilkan kata sandi root baru, mengubahnya di host Linux dan menulis ke manajer kata sandi, </li><li>  membuat file konfigurasi YAML untuk Puppet di GitLab, </li><li>  jalankan runbooks yang membawa pengaturan dan pembaruan yang diperlukan untuk Windows VMs atau </li><li>  luncurkan Puppet, yang akan memperbarui dan mengkonfigurasi mesin-mesin Linux. </li></ul></li><li>  Setelah semua ini, permintaan perubahan yang dibuat pada langkah 2 ditutup.  Data baru ditambahkan ke dalamnya, seperti alamat IP dan nama host. </li><li>  Unit baru terdaftar di Basis Manajemen Sumber Daya Komputasi (CMDB). </li><li>  Mesin virtual terdaftar di Zabbix dan ditambahkan ke pemantauan. </li><li>  Pelanggan dan pihak berkepentingan lainnya menerima email berisi informasi tentang unit baru yang dibuat menggunakan ManageIQ. </li></ol><br><h2 id="chto-vnutri">  Apa yang ada di dalamnya </h2><br><p>  Mari kita mempelajari detail teknis dari produk ini.  Secara default, ManageIQ dapat membuat mesin virtual dari templat.  Bagaimana hal ini berbeda dari apa yang kita lakukan, misalnya, di vCenter?  Jawaban yang benar bukanlah apa-apa.  ManageIQ menggunakan metode yang sama dengan sistem virtualisasi, tetapi melakukannya dari satu tempat.  Selain itu, Anda dapat menambahkan skrip Anda sendiri yang tidak sesuai dengan serangkaian fitur standar.  Jadi, jika Anda memiliki sumber daya, misalnya, di Azure publik, di vCenter, yang digunakan pada perangkat keras Anda sendiri, ditambah kluster Kubernet berputar di tempat lain, maka semua ini dapat dikelola dengan mudah dari ManageIQ. </p><br><p>  Selain berbagai penyedia untuk integrasi, ManageIQ memiliki alat yang mudah untuk kustomisasi.  Ini, misalnya, membuat formulir yang mudah untuk menyelesaikan masalah Anda: </p><br><p><img src="https://habrastorage.org/webt/ku/7y/l3/ku7yl3xi9trq-9wndv-ad_vlpvu.png"></p><br><p>  Berkat ini, memungkinkan untuk membuat antarmuka lengkap untuk memesan mesin virtual, menyesuaikan semua parameter yang diperlukan ke dalamnya: </p><br><p><img src="https://habrastorage.org/webt/v7/ey/tf/v7eytf_hbcxxjcpw4hvrzuwyzve.png"></p><br><p>  Kami memilih jumlah sumber daya komputasi, OS, mengisi semua informasi tambahan yang diperlukan untuk integrasi dengan sistem eksternal.  Selanjutnya, dengan menggunakan mekanisme internal (tentang mereka sedikit kemudian), sistem memilih di mana sumber daya baru akan ditempatkan: pusat data, cluster, host dan datastore dipilih tergantung pada semua parameter yang dimasukkan dan sumber daya dimuat. </p><br><p>  Jangan lupa bahwa orang dapat memesan terlalu banyak sumber daya atau tidak sama sekali apa yang benar-benar mereka butuhkan.  Di sini sistem permintaan dan konfirmasi berperan: </p><br><p><img src="https://habrastorage.org/webt/mj/yv/28/mjyv28hsy0ggf6t68jjdkgc8mwc.png"></p><br><p>  Sumber daya apa pun yang dipesan oleh pengguna harus disetujui oleh orang yang bertanggung jawab.  Di Rumah, sekelompok arsitek melakukan ini. </p><br><h2 id="struktura-avtomatizacii">  Struktur otomasi </h2><br><p>  Jika Anda menguraikan semua proses otomatisasi di ManageIQ menjadi bagian-bagian kecil, Anda akan melihat struktur tertentu. </p><br><h3 id="automate-domain">  Otomasi Domain </h3><br><img align="right" src="https://habrastorage.org/webt/xy/ea/c_/xyeac_nx3if-e4txuiuriic4h0w.png"><br><p>  Datastore meng-host semua domain yang dimiliki ManageIQ. </p><br><p>  Secara default, ada domain ManageIQ, yang dikunci dan mirip dengan model referensi.  Jika Anda perlu melakukan perubahan, domain lain dibuat, ke mana elemen dari domain ManageIQ disalin dan diubah untuk tugas Anda sendiri. </p><br><h3 id="automate-namespace">  Otomatis Namespace </h3><br><img align="right" src="https://habrastorage.org/webt/yf/e1/t3/yfe1t3kjxb4rhvenndkfkwtsad4.png"><br><p>  Di dalam, domain dibagi menjadi beberapa bagian yang bertanggung jawab atas proses individu: ini dapat menjadi bagian yang bertanggung jawab untuk mengelola infrastruktur (Infrastruktur) atau untuk bekerja dengan layanan (Layanan).  Kami memiliki Namespace kami sendiri, yang berisi semua yang terkait dengan sistem bank. </p><br><p>  Pertimbangkan struktur secara lebih rinci menggunakan contoh proses penyediaan untuk mesin virtual baru.  Itu dijelaskan dalam Kelas Otomatis yang disebut <em>VMProvision_VM</em> . </p><br><h3 id="automate-class">  Kelas Otomatis </h3><br><p>  Kelas memiliki struktur yang mencakup Mesin <strong>Virtual</strong> , <strong>Metode</strong> , <strong>Properti,</strong> dan <strong>Skema</strong> .  Dari sudut pandang otomatisasi, Skema paling menarik: <br><img src="https://habrastorage.org/webt/vm/jt/lf/vmjtlfd9qpyrqpdpemtxfw2yczs.png"></p><br><p>  Tata letaknya mirip dengan pipeline pada sistem CI / CD.  Ini menjelaskan langkah-langkah yang akan dilakukan dalam proses otomasi. </p><br><h3 id="automate-instance">  Otomatis Mesin Virtual </h3><br><img align="right" src="https://habrastorage.org/webt/ie/wj/fj/iewjfjuzq9rplkcszwsh7wemsqu.png"><br><p>  Kelas yang dijelaskan di atas memiliki dua Instance Otomatis.  Masing-masing dari mereka mewarisi dari sirkuit tahapan-tahapan di mana <em>Nilai Default</em> diatur.  Tahapan yang memiliki nilai nol dijelaskan dalam contoh. </p><br><p><img src="https://habrastorage.org/webt/wy/sl/5c/wysl5c2zze_9_sfplsnykplbf_m.png"></p><br><p>  Dalam contoh tersebut, nilai muncul untuk langkah-langkah yang kosong dalam deskripsi skema.  Anda juga dapat melihat siapa dan kapan melakukan perubahan terakhir. </p><br><p>  Mari kita lihat apa yang diwakili oleh salah satu nilai Value: <br><img src="https://habrastorage.org/webt/rd/j_/v7/rdj_v7hc3wgt7dty2zckjltiacg.png"></p><br><p>  Ini adalah Kelas Otomatis yang disebut Metode, yang memiliki satu Mesin Virtual Otomatis.  Diagramnya menggambarkan atribut <em>ipam_base_uri</em> dan metode <em>eksekusi</em> .  Metode eksekusi, pada gilirannya, memanggil Metode Automate <em>acquir_ip</em> . </p><br><h3 id="automate-method">  Metode Otomatis </h3><br><p>  Ini adalah skrip Ruby yang memungkinkan mesin virtual untuk berkomunikasi melalui REST API dengan sistem lain.  Misalnya, seperti halnya dengan sistem manajemen ruang alamat IPAM.  Dalam IPAM kita mendapatkan alamat, mask, subnet, dan VLAN untuk VM.  Kesulitannya adalah bahwa mesin dapat digunakan dalam lingkungan pengujian atau produktif, untuk aplikasi atau database.  Atau mungkin layanan keamanan memutuskan untuk meletakkannya di loop PCI-DSS.  Semua informasi ini dikumpulkan pada tahap pembuatan VM atau ditransmisikan dalam parameter instance yang disebut (dalam screenshot di atas, Anda dapat melihat bahwa parameter berisi uri dimana metode ini akan mengakses IPAM): </p><br><div class="spoiler">  <b class="spoiler_title">Ini beberapa kode Ruby</b> <div class="spoiler_text"><pre><code class="ruby hljs">base_uri = $evm.object[<span class="hljs-string"><span class="hljs-string">'ipam_base_uri'</span></span>] prov = $evm.root[<span class="hljs-string"><span class="hljs-string">"miq_provision"</span></span>] site = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:site</span></span>) app = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:dialog_dropdown_list_information_system</span></span>) crq = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:crq</span></span>) descr = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:dialog_textarea_box_usernotes</span></span>) owner = $evm.root[<span class="hljs-string"><span class="hljs-string">'user'</span></span>].name scope = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:dialog_dropdown_scope</span></span>) environment = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:landscape</span></span>)</code> </pre> <br><p>  <em>$ evm.root</em> adalah metode yang mengembalikan semua yang dapat disimpan di ManageIQ.  Ini bisa berupa informasi tentang pengguna, lingkungan, variabel, permintaan saat ini ('miq_request'), dll.  Kami tertarik dengan proses penyediaan saat ini. <br><img src="https://habrastorage.org/webt/4m/hz/lm/4mhzlmb6p_lvkagsl7apu41mpdm.png"></p><br><p>  Kemudian kita dapat mengambil nilai yang diperlukan: <em>get_option (: situs)</em> mengambil nilai yang ditransfer pada salah satu langkah sebelumnya, dan, misalnya, <em>get_option (: dialog_dropdown_list_information_system)</em> mengambil dari formulir yang <em>diisi</em> pengguna saat memesan sumber daya baru. <br>  Semua nilai yang diterima ditransmisikan oleh variabel dalam tubuh permintaan dalam format JSON: </p><br><pre> <code class="ruby hljs">options = { <span class="hljs-symbol"><span class="hljs-symbol">verify:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">headers:</span></span> {<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>}, <span class="hljs-symbol"><span class="hljs-symbol">body:</span></span> { <span class="hljs-string"><span class="hljs-string">"site"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{site}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"env"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{env}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"app"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"scope"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{scope}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"role"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{role}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"crq"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{crq}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"descr"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{descr}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"owner"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{owner}</span></span></span><span class="hljs-string">"</span></span>, }.to_json, }</code> </pre> <br><p>  Dengan menggunakan set parameter ini, IPAM akan secara pasti menentukan VLAN mana yang harus ditemukan oleh mesin virtual, dan akan mengembalikan parameter jaringan. </p></div></div><br><p>  Selain menerima data untuk konfigurasi VM yang benar, ManageIQ juga dapat menghasilkan informasi tambahan untuk membuat beberapa pengaturan pada tahap yang disebut penyediaan pos (setelah mesin virtual digunakan dan diluncurkan).  Di Rumah, kami menggunakan Wayang untuk mengelola konfigurasi host Linux.  Untuk setiap unit komputasi, buat file GAML dalam YAML dengan sekelompok grup: </p><br><div class="spoiler">  <b class="spoiler_title">Beberapa kode Ruby lagi</b> <div class="spoiler_text"><pre> <code class="ruby hljs">options = { <span class="hljs-symbol"><span class="hljs-symbol">headers:</span></span> {<span class="hljs-string"><span class="hljs-string">"Private-Token"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{api_token}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>}, } body = { <span class="hljs-string"><span class="hljs-string">"branch"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{branch}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-string"><span class="hljs-string">"author_email"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"email@your.domain"</span></span>, <span class="hljs-string"><span class="hljs-string">"author_name"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"ManageIQ Bot"</span></span>, <span class="hljs-string"><span class="hljs-string">"content"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"commit_message"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"New host created by ManageIQ"</span></span>, } descr = prov.get_option(<span class="hljs-symbol"><span class="hljs-symbol">:long_description</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> descr.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(<span class="hljs-string"><span class="hljs-string">'rancher'</span></span>) &amp;&amp; descr.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> body[<span class="hljs-symbol"><span class="hljs-symbol">:content</span></span>] = <span class="hljs-string"><span class="hljs-string">"---\ngroups:\n - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{yaml_server}</span></span></span><span class="hljs-string">\n - rancher\n - user-devops-UDCR"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> descr.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> descr.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(<span class="hljs-string"><span class="hljs-string">'rancher'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> body[<span class="hljs-symbol"><span class="hljs-symbol">:content</span></span>] = <span class="hljs-string"><span class="hljs-string">"---\ngroups:\n - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{yaml_server}</span></span></span><span class="hljs-string">\n - rancher\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> descr.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(<span class="hljs-string"><span class="hljs-string">'rancher'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> body[<span class="hljs-symbol"><span class="hljs-symbol">:content</span></span>] = <span class="hljs-string"><span class="hljs-string">"---\ngroups:\n - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{yaml_server}</span></span></span><span class="hljs-string">\n - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{$is_id}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>  Grup bergantung pada jenis mesin virtual, lingkungan tempat mesin itu dibuat, dan sistem informasi. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/hv/ig/1ihvigmykpbqlihq2l8oturxxk0.png"></div><br><p>  Setelah berhasil menyelesaikan prosedur, pengguna menerima email berisi informasi: <br><img src="https://habrastorage.org/webt/qf/j-/br/qfj-brpfqe1ukkcvrw_jdtdpigm.png"></p><br><p>  Teks surat juga dapat disesuaikan dengan menambahkan informasi yang diperlukan. <br>  Jika kesalahan terjadi pada salah satu tahap kritis proses, Anda dapat menambahkan kondisi yang secara eksplisit menyatakan bahwa proses tersebut harus terganggu.  Jika kesalahan tidak memiliki konsekuensi fatal, tunjukkan juga apa yang dapat dilanjutkan, meskipun ada masalah. </p><br><h2 id="logirovanie">  Penebangan </h2><br><p>  ManageIQ menulis log dari semua yang dapat dilacak.  Proses otomasi ditulis dalam automation.log.  Selain itu, ada log API, berbagai penyedia cloud, log keamanan, bahkan output dari perintah teratas dicatat. </p><br><p>  Untuk setiap acara di sirkuit, Anda dapat mengonfigurasi entri log dari awal dan akhir mereka: <br><img src="https://habrastorage.org/webt/tv/z0/yy/tvz0yyygspvyltb6d_x4ja00hpg.png"></p><br><p>  Selain itu, Anda dapat menulis pesan di log: </p><br><pre> <code class="ruby hljs">$evm.log(<span class="hljs-symbol"><span class="hljs-symbol">:info</span></span>, <span class="hljs-string"><span class="hljs-string">"Call job status uri: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{item_uri}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{job_id}</span></span></span><span class="hljs-string">/api/json"</span></span>)</code> </pre> <br><p>  Ini sangat berguna ketika mengakses sistem dengan API untuk memahami mengapa ada masalah.  Atau, untuk melacak status saat ini dari proses yang panjang, seperti menjalankan pekerjaan Jenkins atau SCCM Runbook: </p><br><pre> <code class="ruby hljs">$evm.log(<span class="hljs-symbol"><span class="hljs-symbol">:info</span></span>, <span class="hljs-string"><span class="hljs-string">"acquire_osname --- naming jobStatus: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{jobStatus}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> jobStatus.to_s == <span class="hljs-string"><span class="hljs-string">"Completed"</span></span></code> </pre> <br><p>  Anda dapat menggunakan fungsi standar untuk pengecualian untuk menulis ke log: </p><br><pre> <code class="ruby hljs">raise “VM <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified” <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> vm.<span class="hljs-literal"><span class="hljs-literal">nil</span></span>?</code> </pre> <br><p>  Secara default, semua log disimpan di bagian / var / log / manageiq / *, tetapi dari pengalaman saya sendiri, saya dapat mengatakan bahwa mencari masalah melalui tail dan grep bukanlah solusi yang paling nyaman.  Mengingat bahwa ManageIQ menulis banyak log yang berbeda, Anda harus berhati-hati untuk mengarahkan kembali log, misalnya, ke tumpukan ELK. </p><br><h2 id="manageiq-api">  API ManageIQ </h2><br><p>  Selain antarmuka web yang ramah pengguna, ManageIQ memiliki API fungsional.  Dengan itu, misalnya, kami memecahkan masalah secara dinamis menentukan pengidentifikasi template yang akan ditentukan </p><br><div class="spoiler">  <b class="spoiler_title">saat membuat VM:</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_template</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vendor, os, ems)</span></span></span></span> user = <span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{user}</span></span></span><span class="hljs-string">'</span></span> pass = <span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{pass}</span></span></span><span class="hljs-string">'</span></span> options = { <span class="hljs-symbol"><span class="hljs-symbol">verify:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">headers:</span></span> {<span class="hljs-string"><span class="hljs-string">"Accept"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"accept-encoding"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"gzip, deflate"</span></span>}, <span class="hljs-symbol"><span class="hljs-symbol">basic_auth:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">username:</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{user}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{pass}</span></span></span><span class="hljs-string">"</span></span> }, } response = HTTParty.get(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{host}</span></span></span><span class="hljs-string">/api/templates?filter[]=vendor=%27</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{vendor}</span></span></span><span class="hljs-string">%27&amp;filter[]=name=%27%2A</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">%2A%27&amp;filter[]=ems_id=%27</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{ems}</span></span></span><span class="hljs-string">%27"</span></span>, options).to_s link = JSON.parse(response) link[<span class="hljs-string"><span class="hljs-string">"resources"</span></span>].each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|r|</span></span> $url = r[<span class="hljs-string"><span class="hljs-string">"href"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> response = HTTParty.get($url,options).to_s template = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{JSON.parse(response)[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'id'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span>+<span class="hljs-string"><span class="hljs-string">", "</span></span>+<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{JSON.parse(response)[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>  Menggunakan permintaan POST dan menentukan filter untuk pencarian, kami mendapatkan template yang diinginkan. <br>  Selain menyelesaikan masalah internal, Anda dapat membuat metode API baru untuk digunakan oleh sistem eksternal.  Di awal artikel, proses pemesanan mesin virtual baru menggunakan antarmuka web ditunjukkan.  Dan ini adalah tampilannya jika Anda melakukannya dengan </p><br><div class="spoiler">  <b class="spoiler_title">Permintaan POST:</b> <div class="spoiler_text"><pre> <code class="ruby hljs">curl -X POST \ <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/Manageiq.hostname/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/service_catalogs/</span></span><span class="hljs-number"><span class="hljs-number">4</span></span>/service_templates/<span class="hljs-number"><span class="hljs-number">31</span></span> \ -H <span class="hljs-string"><span class="hljs-string">'Authorization: Basic Token-Value'</span></span> \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{ "action": "order", "resource": { "radio_button_vcpu": "a_2", "radio_button_vram": "a_2", "hdd_size": "40", "dropdown_os": "CentOS", "text_box_filter": "dns", "dropdown_list_information_system": "DNS ", "text_box_validator": "OK (DNS )", "textarea_box_usernotes": " ", "dropdown_env": "production", "date_control_retirement_dt": "2022-05-21", "dropdown_scope": "-" } }'</span></span></code> </pre> </div></div><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><h3 id="plyusy">  Pro: </h3><br><ul><li>  Fleksibilitas yang luar biasa: ManageIQ tidak hanya memungkinkan Anda untuk menyesuaikan proses otomasi sesuai kebutuhan, tetapi juga memungkinkan untuk mengubah bagian visualnya dengan menambahkan tombol, bidang, dll. Tambahan </li><li>  Editor kode bawaan dengan penyorotan sintaksis dan validasi kode.  Bagi saya itu solusi yang sangat bagus, jika Anda perlu segera memperbaiki sesuatu. </li><li>  Sejumlah besar sumber yang dapat bekerja dengan sistem.  Awan: Amazon EC2, Google Compute Engine, Azure, OpenStack, VMware vCloud.  Infrastruktur: Microsoft SCVMM, Direktur Platform OpenStack, Virtualisasi Red Hat, VMware vCenter.  Wadah: Kubernetes, OpenShift. </li></ul><br><h3 id="minusy">  Cons: </h3><br><ul><li>  Kemampuan hebat alat ini juga membawa poin negatif.  Tidak semua dokumentasi terstruktur dengan baik, dan kadang-kadang sulit untuk mencari tahu di mana mencari apa yang Anda butuhkan.  Namun, perlu dicatat bahwa situasinya berubah menjadi lebih baik, dokumentasi ditambah dan ditingkatkan. </li><li>  Komunitas kecil.  Jika Anda menemui beberapa masalah yang sangat spesifik, Anda mungkin tidak dapat dengan cepat "google" jawabannya.  Atau tidak berhasil sama sekali. </li><li>  Paragraf yang mengikuti dari dua sebelumnya.  Beberapa hal dasar, pengaturan dan skenario dapat ditemukan dalam dokumentasi atau di Internet, tetapi pertanyaan yang lebih spesifik dan sempit memerlukan banyak waktu untuk memahami dan mempelajari, termasuk metode pencarian ilmiah: senyum:. </li></ul><br><h3 id="kak-u-nas-seychas">  Seperti yang kita miliki sekarang: </h3><br><p>  Karena kenyataan bahwa ManageIQ dapat memanfaatkan sepenuhnya bahasa Ruby, kami dapat mengintegrasikannya untuk bekerja dengan API berikut: </p><br><ul><li>  Pengelola Kata Sandi  Ini menghasilkan kata sandi root sesuai dengan persyaratan layanan keamanan, menulisnya ke database-nya, dan ManageIQ menggunakannya di dalam OS; </li><li>  Layanan Orkestrasi Pusat Layanan untuk mengelola catatan DNS dan nama host; </li><li>  Obat BMC.  Seluruh proses dicatat sebagai komentar atas permintaan.  Setelah eksekusi berhasil, permintaan ditutup; </li><li>  CMDB  Informasi tentang unit konfigurasi baru dibuat dalam database dengan semua data yang diperlukan. </li><li>  Zabbix  Bergantung pada afiliasi dengan sistem informasi dan lingkungan, host ditambahkan ke grup pemantauan yang sesuai. </li><li>  Peternak.  Menerapkan penciptaan lingkungan baru, pemasangan agen dan pendaftaran host di lingkungan yang ada. </li><li>  Jenkins  Jenkins menjalankan pekerjaan untuk mengkonfigurasi VM di oVirt; </li><li>  LDAP  Buat grup baru yang digunakan untuk mengontrol akses di lingkungan Rancher dan untuk mengkonfigurasi kebijakan di Vault; </li><li>  Vault  Di Home, integrasi produk ini ke dalam proses perbankan baru saja dimulai, tetapi kami telah membuat metode untuk membuat grup, kebijakan, dan bagian baru untuk penyimpanan; </li><li>  Wayang dan IPAM disebutkan sebelumnya. </li></ul><br><p>  Fungsi dan kemampuan sistem sangat luas, dan saya berkenalan dengan banyak dari mereka dan terus berkenalan dalam proses penerapan sistem. <br>  Sebagai contoh, saya tidak menyebutkan bahwa sistem memiliki kemampuan untuk membuat dasbor Anda sendiri dengan statistik, pengaturan atau tombol penagihan, di mana Anda dapat melampirkan skrip individual atau seluruh skrip.  Anda dapat menambahkan bidang Anda sendiri untuk merekam informasi tambahan tentang layanan dan mesin virtual, dll. </p><br><h3 id="k-chemu-stremitsya-houm">  Apa yang diperjuangkan Home: </h3><br><ul><li>  Upgrade ke versi Hammer, di mana dalam mode HA Anda dapat mencoba untuk bekerja dengan Ansible built-in. </li><li>  Transisi dari koordinasi untuk setiap unit sumber daya virtual ke manajemen.  Tim akan dapat menerima VM baru bahkan lebih cepat jika kuota tidak habis. </li><li>  Pengembangan metode baru untuk penyediaan lebih lanjut untuk sistem eksternal. </li><li>  Misalnya, berbagai SaaS seperti jenkins, logstash, dll. </li><li>  Implementasi metode API baru di portal yang ada untuk pemilik sistem informasi.  Pengguna tidak perlu memikirkan bagaimana mengintegrasikan dengan elemen infrastruktur baru, mereka hanya akan menggunakannya sebagai layanan untuk mendapatkan sumber daya baru atau mengubah yang sudah ada. </li></ul><br><p>  <em>Pada akhirnya, saya ingin mengingatkan Anda bahwa alat itu hebat, tetapi jangan lupa tentang pentingnya interaksi antara tim yang berbeda.</em>  <em>Perubahan yang dijelaskan dalam artikel tidak akan mungkin terjadi tanpa komunikasi yang mapan dan interaksi terus-menerus tentang masalah yang muncul dari semua pihak yang berkepentingan.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461891/">https://habr.com/ru/post/id461891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461877/index.html">Java vs Kotlin untuk Android: pendapat pengembang</a></li>
<li><a href="../id461879/index.html">Buku "Linux beraksi"</a></li>
<li><a href="../id461881/index.html">Panduan Pencatatan Node.js</a></li>
<li><a href="../id461885/index.html">EDS adalah jenis penipuan lainnya</a></li>
<li><a href="../id461887/index.html">Memasuki Aeronet Episode 2: Dring Homing</a></li>
<li><a href="../id461895/index.html">Learn While Travel - bagaimana kami melaju pada Hari Analisis Bisnis Eropa pertama</a></li>
<li><a href="../id461897/index.html">Bagaimana kami menjaga stabilitas aplikasi Lamoda</a></li>
<li><a href="../id461899/index.html">Pembuatan Acara, CQRS dan Laravel</a></li>
<li><a href="../id461901/index.html">Tiga tahun autotests: cara meningkatkan kecepatan dan tidak hanya</a></li>
<li><a href="../id461903/index.html">Musuh misterius: peminjaman kabur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>