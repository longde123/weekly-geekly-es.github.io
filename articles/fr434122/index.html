<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶ üí§ üëû Sc√©nario - Pas un objet de page üßöüèæ üè¥ üîù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au fil du temps, apporter des modifications √† n'importe quel produit devient plus difficile, et il y a un risque croissant non seulement de publier de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sc√©nario - Pas un objet de page</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/434122/"><p>  Au fil du temps, apporter des modifications √† n'importe quel produit devient plus difficile, et il y a un risque croissant non seulement de publier de nouvelles fonctionnalit√©s, mais aussi de casser les anciennes.  Souvent, au lieu de v√©rifier manuellement l'ensemble du projet, ils essaient d'automatiser ce processus.  Si vous parlez √† des personnes qui testent des interfaces et parcourez des conf√©rences, il devient clair que Selenium r√®gne dans le monde des tests Web, et la grande majorit√© utilise Page Object comme organisation du code. </p><br><p>  Mais pour moi, en tant que programmeur, pour une raison quelconque, je n'ai jamais aim√© ce mod√®le et ce code que j'ai vus avec diff√©rentes √©quipes - les lettres SOLID sonnaient dans ma t√™te.  Mais j'√©tais pr√™t √† accepter le fait que les testeurs √©crivent du code comme ils le souhaitent, en raison du manque d'alternatives, comme il y a environ un an, sur Angular Connect, j'ai entendu un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport</a> sur le test d'applications angulaires √† l'aide du mod√®le de sc√©nario.  Maintenant, je veux partager. </p><br><p><img src="https://habrastorage.org/webt/or/lk/kp/orlkkp4zbclrby1wg1sudwl64cm.jpeg"></p><a name="habracut"></a><br><h1 id="podopytnyy-krolik">  Lapin exp√©rimental </h1><br><p>  Tout d'abord, une br√®ve description des outils utilis√©s.  Comme exemple d'impl√©mentation, je prendrai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SerenityJS</a> du rapport original, avec TypeScript comme langage des scripts de test. </p><br><p> Nous allons mettre des exp√©riences sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">application TODO</a> - une application pour cr√©er une simple liste de t√¢ches.  √Ä titre d'exemples, nous utiliserons le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jan Molak</a> , le cr√©ateur de la biblioth√®que (code TypeScript, donc le point culminant est all√© un peu). </p><br><h1 id="nachnyom-v-2009-m-godu">  Commen√ßons en 2009 </h1><br><p>  √Ä cette √©poque, Selenium WebDriver est apparu et les gens ont commenc√© √† l'utiliser.  Malheureusement, dans un grand nombre de cas, en raison de la nouveaut√© de la technologie et du manque d'exp√©rience en programmation, c'est faux.  Les tests se sont av√©r√©s √™tre du copier-coller complet, non pris en charge et "fragiles". </p><br><p>  Le r√©sultat est une r√©troaction n√©gative et une mauvaise r√©putation avec les autotests.  Finalement, Simon Stewart, cr√©ateur de Selenium WebDriver, a r√©pondu par contumace dans son article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mes tests de s√©l√©nium ne sont pas stables!</a>  .  Le message g√©n√©ral: "si vos tests sont fragiles et ne fonctionnent pas bien - ce n'est pas √† cause du s√©l√©nium, mais parce que les tests eux-m√™mes ne sont pas tr√®s √©crits." </p><br><p>  Pour comprendre ce qui est en jeu, examinons le sc√©nario utilisateur suivant: </p><br><pre><code class="plaintext hljs">Feature: Add new items to the todo list In order to avoid having to remember things that need doing As a forgetful person I want to be able to record what I need to do in a place where I won't forget about them Scenario: Adding an item to a list with other items Given that James has a todo list containing Buy some cookies, Walk the dog When he adds Buy some cereal to his list Then his todo list should contain Buy some cookies, Walk the dog, Buy some cereal</code> </pre> <br><p>  L'impl√©mentation na√Øve "sur le front" ressemblera √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { browser, by, element, protractor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">todoUserSteps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Given(<span class="hljs-regexp"><span class="hljs-regexp">/^.*that (.*) has a todo list containing (.*)$/</span></span>, (name: string, <span class="hljs-attr"><span class="hljs-attr">items</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { browser.get(<span class="hljs-string"><span class="hljs-string">'http://todomvc.com/examples/angularjs/'</span></span>); browser.driver.manage().window().maximize(); listOf(items).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function"> =&gt;</span></span> { element(by.id(<span class="hljs-string"><span class="hljs-string">'new-todo'</span></span>)).sendKeys(item, protractor.Key.ENTER); }); browser.driver.controlFlow().execute(callback); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.When(<span class="hljs-regexp"><span class="hljs-regexp">/^s?he adds (.*?) to (?:his|her) list$/</span></span>, (itemName: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { element(by.id(<span class="hljs-string"><span class="hljs-string">'new-todo'</span></span>)) .sendKeys(itemName, protractor.Key.ENTER) .then(callback); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Then(<span class="hljs-regexp"><span class="hljs-regexp">/^.* todo list should contain (.*?)$/</span></span>, (items: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { expect(element.all(by.repeater(<span class="hljs-string"><span class="hljs-string">'todo in todos'</span></span>)).getText()) .to.eventually.eql(listOf(items)) .and.notify(callback); }); };</code> </pre> <br><p>  Comme vous pouvez le voir, une API de bas niveau est utilis√©e ici, des manipulations avec le DOM, un copier-coller des s√©lecteurs css.  Il est clair qu'√† l'avenir, m√™me avec un petit changement dans l'interface utilisateur, vous devrez changer le code √† de nombreux endroits. </p><br><p>  Comme solution, Selenium devait proposer quelque chose d'assez bon pour se d√©barrasser de ces probl√®mes, et en m√™me temps accessible aux personnes ayant peu ou pas d'exp√©rience en programmation orient√©e objet.  Une telle solution √©tait Page Object, un mod√®le d'organisation du code. </p><br><p>  Martin Fowler le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crit</a> comme un objet d'abstraction autour d'une page HTML ou de son fragment, vous permettant d'interagir avec les √©l√©ments de la page sans toucher au HTML lui-m√™me.  Id√©alement, un tel objet devrait permettre au code client de faire et de voir tout ce qu'une personne peut faire et voir. <br><img src="https://habrastorage.org/getpro/habr/post_images/89d/8a5/9b0/89d8a59b079f3dff71831e7f758d4e8e.png"></p><br><p>  Apr√®s avoir r√©√©crit notre exemple conform√©ment √† ce mod√®le, nous avons ce qui suit: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { browser, by, element, protractor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'protractor'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoList</span></span></span><span class="hljs-class"> </span></span>{ What_Needs_To_Be_Done = element(by.id(<span class="hljs-string"><span class="hljs-string">'new-todo'</span></span>)); Items = element.all(by.repeater(<span class="hljs-string"><span class="hljs-string">'todo in todos'</span></span>)); addATodoItemCalled(itemName: string): PromiseLike&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.What_Needs_To_Be_Done.sendKeys(itemName, protractor.Key.ENTER); } displayedItems(): PromiseLike&lt;string[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Items.getText(); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">todoUserSteps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> todoList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TodoList(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Given(<span class="hljs-regexp"><span class="hljs-regexp">/^.*that (.*) has a todo list containing (.*)$/</span></span>, (name: string, <span class="hljs-attr"><span class="hljs-attr">items</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { browser.get(<span class="hljs-string"><span class="hljs-string">'http://todomvc.com/examples/angularjs/'</span></span>); browser.driver.manage().window().maximize(); listOf(items).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function"> =&gt;</span></span> { todoList.addATodoItemCalled(item); }); browser.driver.controlFlow().execute(callback); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.When(<span class="hljs-regexp"><span class="hljs-regexp">/^s?he adds (.*?) to (?:his|her) list$/</span></span>, (itemName: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { todoList.addATodoItemCalled(itemName).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> callback()); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Then(<span class="hljs-regexp"><span class="hljs-regexp">/^.* todo list should contain (.*?)$/</span></span>, (items: string, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>) =&gt; { expect(todoList.displayedItems()) .to.eventually.eql(listOf(items)) .and.notify(callback); }); };</code> </pre> <br><p>  √Ä premi√®re vue, cela semble bon - nous nous sommes d√©barrass√©s de la duplication et de l'encapsulation suppl√©mentaire.  Mais il y a un probl√®me: tr√®s souvent, ces classes dans le processus de d√©veloppement atteignent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des</a> tailles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©normes</a> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/895/cea/563/895cea563685efb4c86613c9ee17d9f9.jpg"></p><br><p>  Vous pouvez essayer de d√©composer ce code en composants ind√©pendants, mais si le code atteint un tel √©tat, il est d√©j√† si √©troitement coupl√© qu'il peut √™tre tr√®s difficile et n√©cessitera de r√©√©crire √† la fois la classe elle-m√™me et le code client entier (cas de test) qui utilisent ceci l'objet.  En fait, une √©norme classe n'est pas une maladie, mais un sympt√¥me ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">odeur de code</a> ).  Le principal probl√®me est la violation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">principe de responsabilit√© unique</a> et du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">principe ouvert et ferm√©</a> .  Page Object implique une description de la page et de toutes les fa√ßons d'interagir avec elle dans une seule entit√©, qui ne peut pas √™tre d√©velopp√©e sans changer son code. </p><br><p>  Pour nos applications de responsabilit√© de classe TODO sont les suivantes (photos de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> ): <br><img src="https://habrastorage.org/getpro/habr/post_images/e10/92b/0d6/e1092b0d68097724e550dd2f271cf7a3.jpg" alt="Responsabilit√©"></p><br><p>  Si vous essayez de s√©parer cette classe sur la base des principes de SOLID, vous obtenez quelque chose comme ceci: <br><img src="https://habrastorage.org/getpro/habr/post_images/a86/9e3/d57/a869e3d571152689f7c4fd543b214057.jpg"></p><br><h1 id="domennaya-model">  Mod√®le de domaine </h1><br><p>  Le prochain probl√®me que nous avons avec Page Object est qu'il fonctionne sur les pages.  Dans tout test d'acceptation, il est courant d'utiliser des user stories.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le d√©veloppement bas√© sur le comportement (BDD)</a> et le langage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gherkin</a> correspondent parfaitement √† ce mod√®le.  Il est entendu que le chemin de l'utilisateur vers l'objectif (sc√©nario) est plus important que l'impl√©mentation sp√©cifique.  Par exemple, si vous utilisez un widget de connexion dans tous les tests, lorsque vous modifiez la m√©thode de connexion (le formulaire a √©t√© d√©plac√©, est pass√© √† l'authentification unique), vous devrez modifier <em>tous les</em> tests.  Dans les projets particuli√®rement dynamiques, cela peut s'av√©rer co√ªteux et long et pousser l'√©quipe √† reporter les tests d'√©criture jusqu'√† stabilisation des pages (m√™me si tout est clair avec les cas d'utilisation). </p><br><p>  Pour r√©soudre ce probl√®me, il vaut la peine de le regarder de l'autre c√¥t√©.  Nous introduisons les concepts suivants: </p><br><ol><li>  R√¥les - pour qui est-ce tout? </li><li>  Objectifs - pourquoi sont-ils (utilisateurs) ici et que veulent-ils atteindre? </li><li>  T√¢ches - Que doivent-ils faire pour atteindre ces objectifs? </li><li>  Actions - comment exactement un utilisateur doit-il interagir avec une page pour effectuer une t√¢che? </li></ol><br><p>  Ainsi, chaque script de test devient, de facto, un <em>script</em> pour l'utilisateur, destin√© √† l'ex√©cution d'une user story sp√©cifique.  Si vous combinez cette approche avec les principes de programmation orient√©e objet d√©crits ci-dessus, le r√©sultat sera un mod√®le de <em>sc√©nario</em> (ou de <em>parcours utilisateur</em> ).  Ses id√©es et principes ont √©t√© exprim√©s pour la premi√®re fois en 2007, avant m√™me PageObject. </p><br><h1 id="screenplay">  Sc√©nario </h1><br><p>  Nous r√©√©crivons notre code en utilisant les principes r√©sultants. </p><br><p>  James est l'acteur qui jouera notre utilisateur dans ce sc√©nario.  Il sait utiliser un navigateur. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> james = Actor.named(<span class="hljs-string"><span class="hljs-string">'James'</span></span>).whoCan(BrowseTheWeb.using(protractor.browser));</code> </pre> <br><p>  L'objectif de James est d'ajouter le premier √©l√©ment √† sa liste: </p><br><pre> <code class="plaintext hljs"> Scenario: Adding an item to a list with other items</code> </pre> <br><p>  Pour atteindre cet objectif, James a besoin des √©l√©ments suivants: </p><br><ol><li>  commencer par une liste contenant plusieurs √©l√©ments, </li><li>  ajouter un nouvel √©l√©ment. </li></ol><br><p>  Nous pouvons diviser cela en deux classes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PerformsTasks, Task } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'serenity-js/lib/screenplay'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Open } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'serenity-js/lib/screenplay-protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AddATodoItem } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./add_a_todo_item'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Start</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> withATodoListContaining(items: string[]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Start(items); } performAs(actor: PerformsTasks) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> actor.attemptsTo( Open.browserOn(<span class="hljs-string"><span class="hljs-string">'/examples/angularjs/'</span></span>), ...this.addAll(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items) ); } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private items: string[]) { } private addAll(items: string[]): Task[] { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function"> =&gt;</span></span> AddATodoItem.called(item)); } }</code> </pre> <br><p>  L'interface de <code>Task</code> n√©cessite de d√©finir la m√©thode <code>performAs</code> , o√π l'acteur sera transf√©r√© pendant l'ex√©cution.  <code>attemptsTo</code> - combinateur accepte n'importe quel nombre de shuffles.  Ainsi, vous pouvez cr√©er une vari√©t√© de s√©quences.  En fait, tout ce que cette t√¢che fait est d'ouvrir un navigateur sur la page souhait√©e et d'y ajouter des √©l√©ments.  Voyons maintenant la t√¢che d'ajouter un √©l√©ment: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PerformsTasks, Task } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'serenity-js/lib/screenplay'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Enter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'serenity-js/lib/screenplay-protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { protractor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TodoList } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/todo_list'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddATodoItem</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> called(itemName: string) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AddATodoItem(itemName); } <span class="hljs-comment"><span class="hljs-comment">// required by the Task interface performAs(actor: PerformsTasks): PromiseLike&lt;void&gt; { // delegates the work to lower-level tasks return actor.attemptsTo( Enter.theValue(this.itemName) .into(TodoList.What_Needs_To_Be_Done) .thenHit(protractor.Key.ENTER) ); } constructor(private itemName: string) } }</span></span></code> </pre> <br><p>  C'est plus int√©ressant ici, des actions de bas niveau apparaissent - entrez du texte dans l'√©l√©ment de page et appuyez sur Entr√©e.  <code>TodoList</code> est tout ce qui reste de la partie ¬´descriptive¬ª de l'objet Page, nous avons ici des s√©lecteurs CSS: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Target, Question, Text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'serenity-js/lib/screenplay-protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { by } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'protractor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoList</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> What_Needs_To_Be_Done = Target .the(<span class="hljs-string"><span class="hljs-string">'"What needs to be done?" input box'</span></span>) .located(by.id(<span class="hljs-string"><span class="hljs-string">'new-todo'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Items = Target .the(<span class="hljs-string"><span class="hljs-string">'List of Items'</span></span>) .located(by.repeater(<span class="hljs-string"><span class="hljs-string">'todo in todos'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Items_Displayed = Text.ofAll(TodoList.Items); }</code> </pre> <br><p>  Ok, il reste √† v√©rifier qu'apr√®s toutes les manipulations les informations correctes sont affich√©es.  SerenityJS propose l'interface <code>Question&lt;T&gt;</code> - une entit√© qui renvoie une valeur affich√©e ou une liste de valeurs ( <code>Text.ofAll</code> dans l'exemple ci-dessus).  Comment pourrait-on impl√©menter une <em>question</em> qui renvoie le texte d'un √©l√©ment HTML: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Text</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Question</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>(target: Target): Text { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Text(target); } answeredBy(actor: UsesAbilities): PromiseLike&lt;string[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BrowseTheWeb.as(actor).locate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target).getText(); } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private target: Target) { } }</code> </pre> <br><p>  Ce qui est important, la liaison du navigateur est facultative.  <code>BrowseTheWeb</code> est juste une <em>capacit√©</em> , qui vous permet d'interagir avec le navigateur.  Vous pouvez impl√©menter, par exemple, la capacit√© <code>RecieveEmails</code> , qui permet √† l'acteur de lire des lettres (pour l'inscription sur le site). </p><br><p>  En mettant tout cela ensemble, nous obtenons ce sch√©ma (de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jan Molak</a> ): <br><img src="https://habrastorage.org/getpro/habr/post_images/c7c/1c1/ac3/c7c1c1ac30c645ca0d6987348274e419.png"></p><br><p>  et le sc√©nario suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> actor: Actor; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Given(<span class="hljs-regexp"><span class="hljs-regexp">/^.*that (.*) has a todo list containing (.*)$/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name: string, items: string</span></span></span><span class="hljs-function">) </span></span>{ actor = Actor.named(name).whoCan(BrowseTheWeb.using(protractor.browser)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> actor.attemptsTo( Start.withATodoListContaining(listOf(items)) ); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.When(<span class="hljs-regexp"><span class="hljs-regexp">/^s?he adds (.*?) to (?:his|her) list$/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">itemName: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> actor.attemptsTo( AddATodoItem.called(itemName) ) }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Then(<span class="hljs-regexp"><span class="hljs-regexp">/^.* todo list should contain (.*?)$/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> expect(actor.toSee(TodoList.Items_Displayed)).eventually.deep.equal(listOf(items)) });</code> </pre> <br><p>  Au d√©but, le r√©sultat semble un peu massif, mais √† mesure que le syst√®me se d√©veloppe, la quantit√© de code r√©utilis√© augmentera et les modifications de mise en page et de page n'affecteront que les s√©lecteurs CSS et les t√¢ches / questions de bas niveau, laissant les scripts et les t√¢ches de haut niveau pratiquement inchang√©s. </p><br><h2 id="realizacii">  Impl√©mentations </h2><br><p>  Si nous parlons de biblioth√®ques, et non de tentatives de petites villes pour appliquer ce mod√®le, le plus populaire est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Serenity BDD</a> pour Java.  Javascript / TypeScript utilise son propre port <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SerenityJS</a> .  Hors de la bo√Æte, elle sait travailler avec le concombre et le moka. </p><br><p>  Une recherche rapide a √©galement produit une biblioth√®que pour .NET - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tranquire</a> .  Je ne peux rien dire d'elle, puisque je ne l'ai jamais rencontr√©e auparavant. </p><br><p>  Lorsque vous utilisez Serenity et SerenityJS, vous pouvez utiliser l'utilitaire de g√©n√©ration de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapports</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Rapport avec photos</b> <div class="spoiler_text"><p>  Prenez le code en utilisant Mocha: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Finding things to do'</span></span>, () =&gt; { describe(<span class="hljs-string"><span class="hljs-string">'James can'</span></span>, () =&gt; { describe(<span class="hljs-string"><span class="hljs-string">'remove filters so that the list'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'shows all the items'</span></span>, () =&gt; Actor.named(<span class="hljs-string"><span class="hljs-string">'James'</span></span>).attemptsTo( Start.withATodoListContaining([ <span class="hljs-string"><span class="hljs-string">'Write some code'</span></span>, <span class="hljs-string"><span class="hljs-string">'Walk the dog'</span></span> ]), CompleteATodoItem.called(<span class="hljs-string"><span class="hljs-string">'Write some code'</span></span>), FilterItems.toShowOnly(<span class="hljs-string"><span class="hljs-string">'Active'</span></span>), FilterItems.toShowOnly(<span class="hljs-string"><span class="hljs-string">'All'</span></span>), Ensure.theListOnlyContains(<span class="hljs-string"><span class="hljs-string">'Write some code'</span></span>, <span class="hljs-string"><span class="hljs-string">'Walk the dog'</span></span>), )); }); }); });</code> </pre> <br><p>  Le rapport contiendra comme statistiques g√©n√©rales: <br><img src="https://habrastorage.org/getpro/habr/post_images/dd0/8fa/f09/dd08faf09e56d3fc272d7fab91be3d8d.png"></p><br><p>  et une ventilation des √©tapes avec des captures d'√©cran: <br><img src="https://habrastorage.org/getpro/habr/post_images/3c8/19f/c52/3c819fc528d5f1af31d969af7ebbbe6e.png"></p></div></div><br><h1 id="ssylki">  Les r√©f√©rences </h1><br><p>  Quelques articles li√©s: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Objets de page refactoris√©s: √©tapes solides vers le mod√®le de sc√©nario / parcours</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Au-del√† des objets de page: Automatisation des tests de nouvelle g√©n√©ration avec s√©r√©nit√© et mod√®le de sc√©nario</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Serenity BDD et le mod√®le de sc√©nario</a> </li></ol><br><p>  Papiers: </p><br><ol><li><iframe width="560" height="315" src="https://www.youtube.com/embed/8f8tdZBvAbI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></li><li><iframe width="560" height="315" src="https://www.youtube.com/embed/CocG0FBFJLU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></li></ol><br><p>  Biblioth√®ques: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Serenity BDD</a> - Java </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Serenity JS</a> - JavaScript / TypeScript </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tranquire</a> - .NET </li></ol><br><p>  Veuillez √©crire dans les commentaires si vous utilisez d'autres mod√®les / fa√ßons d'organiser le code des autotests. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434122/">https://habr.com/ru/post/fr434122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434112/index.html">Principes de programmation fonctionnelle en JavaScript</a></li>
<li><a href="../fr434114/index.html">19 id√©es pour les d√©veloppeurs de Node.js qui cherchent √† d√©passer leurs capacit√©s en 2019</a></li>
<li><a href="../fr434116/index.html">L'histoire de la facilit√© scandaleuse de pirater l'infrastructure de d√©veloppement de logiciels modernes</a></li>
<li><a href="../fr434118/index.html">Tutoriel React, partie 4: Composants parents et enfants</a></li>
<li><a href="../fr434120/index.html">Tutoriel React, Partie 5: Premiers pas avec une application TODO, style de base</a></li>
<li><a href="../fr434124/index.html">Activez l'acc√©l√©ration GPU dans Photoshop sous Wine</a></li>
<li><a href="../fr434126/index.html">Lire des m√©dias √† l'aide de la biblioth√®que VLCj</a></li>
<li><a href="../fr434128/index.html">PHP Digest n ¬∞ 146 (10-24 d√©cembre 2018) + R√©sultats 2018</a></li>
<li><a href="../fr434130/index.html">Interface r√©active. Conf√©rence d'Artyom Belov √† FrontTalks 2018</a></li>
<li><a href="../fr434132/index.html">Achetez un t√©l√©viseur et roulez-le: LG pr√©voit de commencer √† vendre des t√©l√©viseurs flexibles dans l'ann√©e √† venir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>