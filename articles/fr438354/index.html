<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÄüèæ üëÜüèª ü•¶ Vue, Storybook, TypeScript - d√©marrer un nouveau projet avec les meilleures pratiques √† l'esprit üëÇüèø ‚õπÔ∏è üìè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(initialement publi√© sur Medium ) 


 J'aime √©crire du code React. Cela peut √™tre une √©trange introduction √† une histoire sur Vue, mais vous devez com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vue, Storybook, TypeScript - d√©marrer un nouveau projet avec les meilleures pratiques √† l'esprit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438354/"><p><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  <em>(initialement publi√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Medium</a> )</em> </p><br><p>  J'aime √©crire du code React.  Cela peut √™tre une √©trange introduction √† une histoire sur Vue, mais vous devez comprendre mon exp√©rience pour comprendre pourquoi je parle ici de Vue. </p><br><p>  J'aime √©crire du code React et je d√©teste le lire.  JSX est une bonne id√©e pour assembler les pi√®ces rapidement, Material-UI est une solution incroyable pour d√©marrer l'interface utilisateur de votre prochaine startup, le calcul CSS √† partir des constantes JS vous permet d'√™tre tr√®s flexible.  Pourtant, lire vos anciens JSX est horrible - m√™me avec des pratiques de r√©vision de code scrupuleuses, vous pourriez ne pas vous gratter la t√™te une fois que vous essayez de comprendre l'imbrication complexe des composants. </p><br><p>  J'ai entendu beaucoup de choses √† propos de Vue - le nouveau gamin du quartier - et j'ai finalement d√©cid√© de me mouiller les pieds;  apportant tous mes bagages mentaux de React et Polymer (et Angular, mais ne parlons pas de √ßa). </p><a name="habracut"></a><br><p> Vue ressemble beaucoup √† Polymer, d'autant plus que les auteurs le nomment comme l'une des sources d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inspiration</a> .  La structure des fichiers <code>*.vue</code> semblait √™tre la meilleure partie de Polymer et j'ai plong√© directement.  Quelques jours plus tard, j'ai ramp√© hors du marais du d√©veloppement dactylographi√©, pilot√© par l'interface utilisateur et de nombreuses meilleures pratiques et je suis pr√™t √† partager ce que j'avais trouv√©. </p><br><h2 id="lets-go">  C'est parti! </h2><br><p>  Nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npx</a> pour ex√©cuter les commandes.  Si vous n'avez pas encore de npx, voici comment l'obtenir: <code>npm install -g npx</code> .  Npx est un √©pargnant de vie lorsque vous traitez avec des packages npm cli et que vous ne voulez pas <code>npm install -g</code> dizaines d'applications.  Vous aurez √©galement besoin de Yarn si vous ne l'avez pas - <code>npm install -g yarn</code> devrait vous mettre √† jour. </p><br><pre> <code class="plaintext hljs">$ npx vue create not-a-todo-app Vue CLI v3.3.0 ? Please pick a preset: Manually select features ? Check the features needed for your project: Babel, TS, PWA, Router, Vuex, CSS Pre-processors, Linter, Unit, E2E ? Use class-style component syntax? Yes ? Use Babel alongside TypeScript for auto-detected polyfills? Yes ? Use history mode for router? (Requires proper server setup for index fallback in production) Yes ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Sass/SCSS ? Pick a linter / formatter config: TSLint ? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Lint on save ? Pick a unit testing solution: Jest ? Pick a E2E testing solution: Cypress ? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In dedicated config files ? Save this as a preset for future projects? No</code> </pre> <br><p>  Vue Cli a un joli assistant pour vous guider;  pour ce tutoriel, nous utiliserons le mode manuel et activerons <strong>toutes les fonctionnalit√©s</strong> .  Trop fort?  Peut-√™tre, mais nous voulons voir comment Vue fonctionne avec tout ce qu'il peut fournir hors de la bo√Æte.  Examinons tout de m√™me les options et les raisons de savoir comment et pourquoi. </p><br><p>  Nous devons activer <strong>Babel</strong> et <strong>TypeScript</strong> .  TS sera la langue principale de choix et Babel prendra en charge la gestion du code externe qui n√©cessite un transpiling.  Vous pourriez faire valoir que TypeScript peut √©galement transpiler du code JS, et c'est effectivement le cas, mais dans mes exp√©riences (en particulier en ce qui concerne les tests unitaires et Vuetify), j'ai pens√© qu'il √©tait pr√©f√©rable de conserver TS pour <code>*.ts</code> et d'utiliser Babel pour tout le reste. </p><br><p>  <strong>Les pr√©-processeurs CSS</strong> seront utiles pour Vuetify;  bien qu'il soit livr√© avec du CSS pr√©-minifi√©, vous souhaiterez peut-√™tre inclure les fichiers de style d'origine pour travailler avec les styles.  <strong>Linter / Formatter</strong> est une exigence √©vidente pour tout nouveau projet (vous devez respecter un style de code unique et vous pourrez me remercier dans un an lorsque vous lirez votre ancien code).  Nous activons les <strong>tests unitaires</strong> et les <strong>tests</strong> <strong>E2E - bien</strong> que vous ne souhaitiez peut-√™tre pas effectuer les cas de test e2e complets, il est utile de savoir comment les corriger apr√®s avoir termin√© avec Vuetify. </p><br><p>  <strong>La prise en charge de l'application Web progressive (PWA)</strong> , le <strong>routeur</strong> et <strong>Vuex</strong> ne sont pas strictement requis pour ce didacticiel et nous ne les utiliserons pas, mais leur activation vous simplifiera la vie dans un vrai projet. </p><br><p>  <strong>Utiliser la syntaxe des composants de style classe?</strong>  Oui  Les classes rendent le code l√©g√®rement plus volumineux mais plus lisible et plus facile √† raisonner;  ils facilitent √©galement votre vie TypeScript. </p><br><p>  <strong>Utiliser Babel aux c√¥t√©s de TypeScript pour les polyfills d√©tect√©s automatiquement?</strong>  Oui  Nous voulons √† la fois Babel et TS pour le cas que nous examinerons plus tard. </p><br><p>  <strong>Utiliser le mode historique pour le routeur?</strong>  Oui (mais YMMV).  Nous n'√©crirons aucun backend pour servir cela en production, mais c'est g√©n√©ralement une bonne id√©e d'utiliser l'API historique. </p><br><p>  <strong>Choisissez un pr√©-processeur CSS (PostCSS, Autoprefixer et les modules CSS sont pris en charge par d√©faut):</strong> nous n'utiliserons que des modules CSS dans ce tutoriel, vous √™tes donc libre de choisir sass / less / stylus en fonction de vos pr√©f√©rences. </p><br><p>  <strong>Choisissez une configuration de linter / formateur:</strong> TSlint est un choix √©vident car nous voulons utiliser TypeScript autant que possible. </p><br><p>  <strong>Choisissez des fonctionnalit√©s suppl√©mentaires pour les peluches:</strong> activez les deux ( <code>a</code> ).  Le peluchage est bon. </p><br><p>  <strong>Choisissez une solution de test unitaire:</strong> ce didacticiel se concentre sur Jest, vous devez donc le s√©lectionner. </p><br><p>  <strong>Choisissez une solution de test E2E:</strong> ce tutoriel se concentre sur Cypress. </p><br><p>  <strong>O√π pr√©f√©rez-vous placer la configuration pour Babel, PostCSS, ESLint, etc.?</strong>  Ne pensez-vous pas que c'est un peu √©trange que tout le monde essaie d'encore plus de choses dans <code>package.json</code> ?  Le fichier est √† peine lisible tel qu'il est maintenant.  Utilisez des fichiers de configuration d√©di√©s - ils sont beaucoup plus faciles √† utiliser et votre historique git sera plus joli. </p><br><p>  Il est temps de v√©rifier la configuration, ex√©cuter le <code>yarn serve</code> : <br><img src="https://habrastorage.org/webt/5p/ak/ty/5paktyugcycg2dzdtjt1ss1vfoi.png"></p><br><p>  Il ne devrait y avoir aucune erreur dans la console et la navigation vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8080 /</a> vous accueillera avec: <br><img src="https://habrastorage.org/webt/z4/hj/hv/z4hjhvcto1oaxdxokxi5rmuzque.png"></p><br><p>  V√©rification du travail des tests unitaires, ex√©cuter le <code>yarn test:unit</code> : <br><img src="https://habrastorage.org/webt/gd/v1/i1/gdv1i1hpoxsejeovp1bvbc4jnbg.png"></p><br><p>  Et travail de test e2e ( <code>yarn test:e2e --headless</code> ): <br><img src="https://habrastorage.org/webt/_p/td/ho/_ptdhoshlgew083bq7hfaapmvnu.png"></p><br><p>  Super!  Passons √† l'interface utilisateur. </p><br><h2 id="the-material-dilemma">  Le dilemme mat√©riel </h2><br><p>  Il existe quelques biblioth√®ques d'interfaces mat√©rielles pour Vue √† un niveau de flexibilit√© et de polissage diff√©rent.  Il existe s√ªrement des dizaines d'autres biblioth√®ques de composants, vous √™tes donc libre d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bootstrap Vue</a> si vous en avez envie.  Ce didacticiel se concentre sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vuetify</a> pour plusieurs raisons: </p><br><ul><li>  c'est la biblioth√®que de mat√©riaux la plus √©toil√©e sur GitHub; </li><li>  c'√©tait une douleur royale de le faire fonctionner, c'est donc une excellente d√©monstration de tous les cas de bord dans lesquels vous pouvez tr√©bucher. </li></ul><br><p>  Convaincu?  Proc√©dez ensuite √† l'installation: <code>vue add vuetify</code> .  S√©lectionnez l'option <strong>Configurer (avanc√©)</strong> . </p><br><p>  <strong>Utilisez un mod√®le pr√©d√©fini?</strong>  Vuetify remplacera App.vue et HelloWorld.vue par d√©faut.  R√©pondez oui √† ceci car c'est un nouveau projet. </p><br><p>  <strong>Utiliser un th√®me personnalis√©?</strong>  Oui  Vous en aurez besoin t√¥t ou tard, alors configurons-le.  Pour les m√™mes raisons, r√©pondez oui √† <strong>Utiliser des propri√©t√©s personnalis√©es (variables CSS)?</strong>  . </p><br><p>  <strong>S√©lectionnez la police de l'ic√¥ne:</strong> ic√¥nes de mat√©riau (mais je vais vous montrer comment le corriger pour Font Awesome plus tard √©galement).  <strong>Utiliser des polices comme d√©pendance?</strong>  Non.  Nous obtiendrons les polices de CDN. </p><br><p>  <strong>Utilisez des composants √† la carte?</strong>  Oui  Cela semble √™tre le moyen le plus simple d'utiliser Vuetify. <br><img src="https://habrastorage.org/webt/w1/aa/v9/w1aav901fzrpaeqnnvluidjoufu.png"></p><br><p>  Il y a un tas de changements, mais le plus important lorsque vous ex√©cutez le <code>yarn serve</code> maintenant, vous verrez une image diff√©rente: <br><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  (vous recevrez √©galement une douzaine d'avertissements de votre linter). </p><br><p>  V√©rifions les tests unitaires ... <br><img src="https://habrastorage.org/webt/ov/ks/29/ovks2927ibmuxyxblnxamj_jyb8.png"></p><br><h2 id="making-vuetify-work-with-unit-and-e2e-tests">  Faire fonctionner Vuetify avec les tests unitaires et e2e </h2><br><p>  V√©rifions <code>./tests/unit/example.spec.ts</code> .  Le test v√©rifie que <code>msg</code> affiche ¬´ <em>nouveau message</em> ¬ª mais le mod√®le fourni avec Vuetify ne prend plus en charge cet accessoire.  Dans une situation r√©elle, vous supprimeriez √† la fois le composant HelloWorld et son test, mais ici, nous mettons √† jour le message pour rechercher quelque chose qui se trouve dans le composant: </p><br><pre> <code class="plaintext hljs">const msg = 'Welcome to Vuetify';</code> </pre> <br><p>  Maintenant, le test r√©ussit (v√©rifiez avec le <code>yarn test:unit</code> ) mais il y a encore une bonne douzaine d'avertissements similaires √† </p><br><pre> <code class="plaintext hljs">[Vue warn]: Unknown custom element: &lt;v-layout&gt; - did you register the component correctly? For recursive components, make sure to provide the "name" option.</code> </pre> <br><p>  La fa√ßon dont Vuetify fonctionne, il ajoute <code>./src/plugins/vuetify.ts</code> qui configure Vuetify dans le cadre de l'application.  Ce fichier provient de <code>./src/main.ts</code> .  Malheureusement, <code>main.ts</code> est ignor√© lorsque vous ex√©cutez des tests unitaires. </p><br><p>  Tout d'abord, <code>vuetify.ts</code> les erreurs et les avertissements dans le <code>vuetify.ts</code> g√©n√©r√©. </p><br><p>  Ouvrez votre <code>./tsconfig.json</code> et ajoutez <code>vuetify</code> √† la section <code>compilerOptions.types</code> : </p><br><pre> <code class="plaintext hljs"> "types": [ "webpack-env", "vuetify", "jest" ],</code> </pre> <br><p>  Cela indique au compilateur TypeScript d'o√π obtenir les types Vuetify et l'erreur dans <code>./src/plugins/vuetify.ts</code> dispara√Æt.  Corrigeons quelques avertissements de style pour le nettoyer: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Nous devons maintenant charger Vuetify dans le cadre de nos tests unitaires.  Cr√©ez un nouveau fichier sur <code>./tests/jest-setup.js</code> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">import '@/plugins/vuetify';</code> </pre> <br><p>  et mettez √† jour <code>./jest.config.js</code> pour le charger: </p><br><pre> <code class="plaintext hljs">module.exports = { ... setupFiles: ['./tests/jest-setup.js'], }</code> </pre> <br><p><img src="https://habrastorage.org/webt/xi/xk/-h/xixk-hz2bwqbiqo5_nlxo1ahgq8.png"></p><br><p>  Les tests √©chouent toujours mais de mani√®re plut√¥t cryptique.  Que s'est-il pass√©? </p><br><p>  <code>vuetify/lib</code> est une source brute non trait√©e de Vuetify qui inclut des √©l√©ments comme les modules ES.  Jest ex√©cute les transformations uniquement pour votre code source par d√©faut, ce qui signifie qu'il ignore tout dans <code>node_modules</code> .  Plus encore, √©tant donn√© que nous avons dit √† Vue d'utiliser TypeScript, la plaisanterie n'est pas configur√©e pour transpiler JS. </p><br><p>  Pour r√©soudre ce probl√®me, nous devons apporter deux modifications √† <code>./jest.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = { ... transform: { '^.+\\.vue$': 'vue-jest', '.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$': 'jest-transform-stub', '^.+\\.tsx?$': 'ts-jest', '^.+\\.jsx?$': 'babel-jest', // &lt;-- (1) }, transformIgnorePatterns: [ 'node_modules/(?!(vuetify)/)', // &lt;-- (2) ], }</code> </pre> <br><p>  Dans <strong>(1),</strong> nous demandons √† Jest de transformer tout fichier <code>*.js</code> ou <code>*.jsx</code> avec Babel (et Babel est pr√©configur√© pour nous par Vue Cli), mais qu'est-ce que <strong>(2)</strong> ?  <code>transformIgnorePatterns</code> sp√©cifie les chemins que Jest ignorera lors du transpilage de code et, comme je l'ai not√© pr√©c√©demment, la valeur par d√©faut inclut <code>node_modules</code> .  Ici, nous rempla√ßons la valeur par d√©faut par un regex cryptique <code>node_modules/(?!(vuetify)/)</code> qui signifie ¬´ignorer tout chemin commen√ßant par <code>node_modules/</code> moins qu'il ne soit suivi par <code>vuetify</code> ¬ª: <br><img src="https://habrastorage.org/webt/7e/z_/yi/7ez_yimfw1mdrnxxm0didej0piq.png"></p><br><p>  Remarquez comment les deux premiers chemins ont une correspondance, mais pas le troisi√®me.  Cette astuce sera utile lorsque nous ajouterons Storybook, mais pour l'instant. </p><br><p>  Relancer les tests ... <br><img src="https://habrastorage.org/webt/p9/yy/sa/p9yysa_dproyxl5wtyovsh0p6f8.png"></p><br><p>  Les √©l√©ments personnalis√©s inconnus sont de retour;  mais au moins il compile et s'ex√©cute avec succ√®s.  Vuetify est transpos√© mais nous devons encore enregistrer les composants manuellement.  Il existe quelques options sur la fa√ßon de le faire ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">consultez leurs documents pour d'autres options</a> );  ce que nous allons faire ici, c'est importer les composants requis dans la port√©e globale de Vue.  Ouvrez √† nouveau <code>./src/plugins/vuetify.ts</code> et mettez-le √† jour en: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Enfin, les tests r√©ussissent: <br><img src="https://habrastorage.org/webt/5f/7s/n1/5f7sn17rr8sk9ei5pgib4x3kc_0.png"></p><br><p>  Les tests E2E √©choueront √©galement ( <code>yarn test:e2e --headless</code> ), mais cela est d√ª au fait que <code>./tests/e2e/specs/test.js</code> recherche une cha√Æne qui n'est plus l√†.  Les tests E2E font tourner votre application r√©elle dans un vrai navigateur, donc il n'y a pas de code √† corriger - Vuetify est tout d√©fini dans votre application.  Corrigez le <code>test.js</code> pour rechercher le nouvel en-t√™te: </p><br><pre> <code class="plaintext hljs">cy.contains('h1', 'Welcome to Vuetify')</code> </pre> <br><p>  et il redeviendra vert. </p><br><p>  R√©capitulons.  Nous avons ajout√© Vuetify, corrig√© les tests unitaires et e2e pour g√©rer un nouveau mod√®le et mis √† jour Jest pour transpiler le code source de Vuetify et le charger.  Notre application est fonctionnelle et nous pouvons utiliser diff√©rents composants mat√©riels.  Passons aux histoires! </p><br><h2 id="storybooks">  Livres d'histoires </h2><br><p>  Les livres de contes sont une id√©e g√©niale: vous √©crivez vos cas de test du point de vue du concepteur: de petits composants √† l'application compl√®te.  Vous pouvez raisonner avec le flux de donn√©es, vous assurer que tout ressemble exactement √† ce que votre concepteur d'interface utilisateur a pr√©sent√© dans Photoshop, tester vos composants de mani√®re isol√©e.  Ajoutons le support du livre d'histoires! </p><br><p>  Il y a un plugin Vue Storybook mais j'ai trouv√© que <code>sb init</code> donne un mod√®le par d√©faut plus agr√©able, nous allons donc l'utiliser √† la place.  Ex√©cutez <code>npx -p @storybook/cli sb init</code> et apr√®s quelques minutes, vous devriez obtenir une invite pour ex√©cuter le <code>yarn storybook</code> .  Faisons-le: <br><img src="https://habrastorage.org/webt/zl/nk/zp/zlnkzp3a8aoo-hvz9m_n8yu3moa.png"></p><br><p>  Ajoutons une nouvelle histoire!  Cr√©ez <code>./src/components/LoveButton.stories.ts</code> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import LoveButton from './LoveButton.vue'; storiesOf('LoveButton', module) .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  (notez que vous pouvez utiliser <code>LoveButton.stories.js</code> ici si vous voulez √™tre laxiste en tapant vos histoires). </p><br><p>  TypeScript vous avertira des types manquants que vous pouvez corriger avec <code>yarn add -D @types/storybook__vue</code> . </p><br><p>  Cr√©ez maintenant <code>./src/components/LoveButton.vue</code> avec le contenu suivant: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">export</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">default</span></span></span><span class="javascript"> Vue.extend({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">props</span></span></span><span class="javascript">: [</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'love'</span></span></span><span class="javascript">], }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Le <code>./stories</code> d'histoires se penchera sur <code>./stories</code> pour vos histoires par d√©faut, mais il est souvent plus pratique de garder les histoires plus proches de vos composants (comme nous l'avons fait).  Pour dire au livre de contes o√π chercher ceux-ci, mettez √† jour votre <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Maintenant, ex√©cutez <code>yarn storybook</code> nouveau le <code>yarn storybook</code> : <br><img src="https://habrastorage.org/webt/zp/et/ow/zpetowrxhyjw0fk58backjxdtj8.png"></p><br><p>  Pas trop excitant.  La console regorge d'avertissements: <br><img src="https://habrastorage.org/webt/8r/cr/kj/8rcrkj3uud0cc8kaaya3rr1lkho.png"></p><br><p>  Mais nous savons de quoi il s'agit maintenant.  Storybook est un autre contexte ¬´racine¬ª avec son propre point d'entr√©e;  il n'utilise pas <code>main.ts</code> et en tant que tel ne charge pas Vuetify, nous devons donc lui dire de le faire.  Mettre √† jour <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; import '../src/plugins/vuetify'; // &lt;-- add this const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Nous chargeons √† nouveau notre configuration existante, ce qui garantit que Storybook utilise le m√™me th√®me que la vraie application.  Malheureusement, le <code>yarn storybook</code> √©chouera maintenant: <br><img src="https://habrastorage.org/webt/lb/g0/nq/lbg0nq7fapzeztm7zfrzrhx8lz8.png"></p><br><p>  Storybook ne sait pas que nous utilisons TypeScript, il ne peut donc pas charger le fichier <code>vuetify.ts</code> .  Pour r√©soudre ce probl√®me, nous devons mettre √† jour la propre configuration du webpack de Storybook.  Cr√©ez <code>./.storybook/webpack.config.js</code> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">const ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin'); module.exports = (baseConfig, env, defaultConfig) =&gt; { defaultConfig.resolve.extensions.push('.ts', '.tsx', '.vue', '.css', '.less', '.scss', '.sass', '.html') defaultConfig.module.rules.push({ test: /\.ts$/, exclude: /node_modules/, use: [ { loader: 'ts-loader', options: { appendTsSuffixTo: [/\.vue$/], transpileOnly: true }, } ], }); defaultConfig.module.rules.push({ test: /\.less$/, loaders: [ 'style-loader', 'css-loader', 'less-loader' ] }); defaultConfig.module.rules.push({ test: /\.styl$/, loader: 'style-loader!css-loader!stylus-loader' }); defaultConfig.plugins.push(new ForkTsCheckerWebpackPlugin()) return defaultConfig; };</code> </pre> <br><p>  Cela charge la configuration par d√©faut, ajoute <code>ts-loader</code> pour les fichiers TypeScript et ajoute √©galement la prise en charge de less et styl (que Vuetify utilise). </p><br><p>  Les avertissements sont toujours l√†, car nous devons enregistrer les composants que nous avons utilis√©s.  Utilisons cette fois des composants locaux pour que vous puissiez voir la diff√©rence (dans une vraie application de production, il est cependant beaucoup plus simple de tous les enregistrer dans <code>vuetify.ts</code> ).  Mettez √† jour <code>./src/components/LoveButton.vue</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { VBtn, VIcon } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vuetify/lib'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// &lt;-- add this export default Vue.extend({ components: { VBtn, VIcon }, // &lt;-- and this props: ['love'], }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Le livre d'histoires se rafra√Æchit lors de l'enregistrement: <br><img src="https://habrastorage.org/webt/jb/eb/yn/jbebynfkavexxg2og5kbdcvtaou.png"></p><br><p>  Un peu mieux.  Qu'est-ce qui manque?  Le programme d'installation de Vuetify a ajout√© les polices css directement dans <code>./public/index.html</code> mais Storybook n'utilise pas ce fichier, nous devons donc ajouter la police Material Icons manquante.  Cr√©ez <code>./.storybook/preview-head.hmtl</code> avec ce qui suit (copie √† partir de <code>./public/index.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Material+Icons"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (il existe d'autres fa√ßons de faire de m√™me, par exemple en utilisant CSS <code>@import</code> ). </p><br><p>  Vous devez red√©marrer votre <code>yarn storybook</code> de <code>yarn storybook</code> pour qu'il se re-rende correctement: <br><img src="https://habrastorage.org/webt/ar/pn/i2/arpni2dvklu5w-cdct4fvgtl00q.png"></p><br><p>  Beaucoup mieux mais toujours en dessous: la police de texte est incorrecte car Vuetify s'attend √† ce que tous ses composants soient imbriqu√©s dans <code>v-app</code> qui applique les styles de page.  Nous ne pouvons certainement pas ajouter <code>v-app</code> √† notre bouton, alors d√©corons plut√¥t l'histoire.  Mettez √† jour vos <code>./src/components/LoveButton.stories.ts</code> : </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import { VApp, VContent } from 'vuetify/lib'; // &lt;-- add the import import LoveButton from './LoveButton.vue'; // add the decorator const appDecorator = () =&gt; { return { components: { VApp, VContent }, template: ` &lt;v-app&gt; &lt;div style="background-color: rgb(134, 212, 226); padding: 20px; width: 100%; height: 100%;"&gt; &lt;v-content&gt; &lt;story/&gt; &lt;/v-content&gt; &lt;/div&gt; &lt;/v-app&gt; `, }; }; storiesOf('LoveButton', module) .addDecorator(appDecorator) // &lt;-- decorate the stories .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  Vous devez enregistrer <code>VApp</code> et <code>VContent</code> dans la port√©e globale, mettre √† jour vos <code>./src/plugins/vuetify.ts</code> : </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg, VApp, VContent } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg, VApp, VContent }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Enfin, le r√©sultat est spectaculaire: <br><img src="https://habrastorage.org/webt/gv/4a/nn/gv4ann-op0rqahdnqjpuzjqlgya.png"></p><br><h2 id="adding-storybook-testing">  Ajout de tests de livre de contes </h2><br><p>  Enfin, assurons-nous que nos histoires sont couvertes par des tests unitaires.  Ajoutez les d√©pendances requises: <code>yarn add -D @storybook/addon-storyshots jest-vue-preprocessor babel-plugin-require-context-hook</code> and create <code>./test/unit/storybook.spec.js</code> : </p><br><pre> <code class="plaintext hljs">import registerRequireContextHook from 'babel-plugin-require-context-hook/register'; import initStoryshots from '@storybook/addon-storyshots'; registerRequireContextHook(); initStoryshots();</code> </pre> <br><p>  La configuration du <code>require.context</code> de <code>require.context</code> utilise <code>require.context</code> pour collecter toutes les sources;  cette fonction est fournie par webpack et nous devons utiliser <code>babel-plugin-require-context-hook</code> pour la remplacer dans Jest.  Modifiez votre <code>./babel.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = api =&gt; ({ presets: ['@vue/app'], ...(api.env('test') &amp;&amp; { plugins: ['require-context-hook'] }), });</code> </pre> <br><p>  Ici, nous ajoutons le plugin <code>require-context-hook</code> si babel s'ex√©cute pour des tests unitaires. </p><br><p>  Enfin, nous devons autoriser Jest √† transpiler les fichiers <code>*.vue</code> du livre d'histoires.  Vous vous souvenez de cette expression r√©guli√®re dans <code>./jest.config.js</code> ?  Revoyons-le maintenant: </p><br><pre> <code class="plaintext hljs">module.exports = { ... transformIgnorePatterns: [ 'node_modules/(?!(vuetify/|@storybook/.*\\.vue$))', ], }</code> </pre> <br><p>  Notez que nous ne pouvons pas simplement y ajouter une deuxi√®me ligne.  N'oubliez pas qu'il s'agit d'un mod√®le ignor√©, donc si le premier mod√®le ignore tout sauf Vuetify, les fichiers du livre de contes sont d√©j√† ignor√©s au moment o√π Jest arrive √† la deuxi√®me expression r√©guli√®re. </p><br><p>  Les nouveaux tests fonctionnent comme pr√©vu: <br><img src="https://habrastorage.org/webt/dn/t6/22/dnt622f3au95rkrhcfgusnkdj_e.png"></p><br><p>  Ce test ex√©cutera toutes vos histoires et les v√©rifiera par rapport aux instantan√©s locaux dans <code>./tests/unit/__snapshots__/</code> .  Pour le voir en action, vous pouvez supprimer <code>&lt;v-icon&gt;favorite&lt;/v-icon&gt;</code> de votre composant bouton et relancer le test pour le voir √©chouer: <br><img src="https://habrastorage.org/webt/rf/oh/09/rfoh09qhni7mvf_jzsj_dmzuf_e.png"></p><br><p>  <code>yarn test:unit -u</code> mettra √† jour votre instantan√© pour la nouvelle disposition des boutons. </p><br><h2 id="recap">  R√©capitulatif </h2><br><p>  Dans ce didacticiel, nous avons appris √† cr√©er une nouvelle application Vue avec TypeScript activ√©;  comment ajouter la biblioth√®que Vuetify avec les composants Material UI.  Nous nous sommes assur√©s que nos tests unitaires et e2e fonctionnent comme pr√©vu.  Enfin, nous avons ajout√© la prise en charge des livres d'histoires, cr√©√© un exemple d'histoire et fait en sorte que les modifications de l'interface utilisateur soient couvertes par nos tests unitaires. </p><br><h2 id="closing-thoughts">  Pens√©es de cl√¥ture </h2><br><p>  JS est un monde en mouvement, les choses changent constamment, de nouveaux mod√®les √©mergent, les anciens sont oubli√©s.  Ce tutoriel peut √™tre obsol√®te en seulement quelques mois, voici donc quelques conseils utiles. </p><br><p>  Connaissez votre outillage.  Il est possible de copier-coller des lignes √† partir du d√©bordement de la pile jusqu'√† ce que votre code fonctionne, mais vous <strong>devez</strong> rechercher pourquoi le changement l'a fait fonctionner plus tard.  Lisez les documents et assurez-vous de bien comprendre en quoi consiste exactement le changement. </p><br><p>  Si vous avez quelque chose √† travailler, m√™me partiellement, faites un commit.  M√™me si c'est un travail en cours, vous aurez quelque chose √† revenir au cas o√π vos modifications ult√©rieures casseraient quelque chose. </p><br><p>  Exp√©rimentez!  Si quelque chose ne fonctionne pas comme vous le pensez et les documents disent le contraire, essayez!  Le monde frontal est principalement open-source, alors fouillez les sources tierces et voyez si vous pouvez bricoler vos instruments de l'int√©rieur pour ajouter une journalisation de d√©bogage. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438354/">https://habr.com/ru/post/fr438354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438342/index.html">Pourquoi Cheats AI Amical dans Ghost Recon Wildlands</a></li>
<li><a href="../fr438346/index.html">Comment font-ils? Pr√©sentation des technologies d'anonymisation des crypto-monnaies</a></li>
<li><a href="../fr438348/index.html">Comment apprendre √† programmer √† 9 ans de fa√ßon autonome</a></li>
<li><a href="../fr438350/index.html">Guide complet de recherche professionnelle de cam√©ras cach√©es et d'appareils espions</a></li>
<li><a href="../fr438352/index.html">Vid√©o de la descente du rover "Yutu-2", ses premiers m√®tres √† la surface de la lune. Le sommeil de deux semaines sur la lune est termin√©</a></li>
<li><a href="../fr438356/index.html">Architecture certifi√©e Fast Track (DWFT) de SQL Server Data Warehouse: ce que cela signifie et comment cela fonctionne</a></li>
<li><a href="../fr438358/index.html">D'anciens agents de la NSA espionnant les iPhones des victimes command√©s par les √âmirats arabes unis</a></li>
<li><a href="../fr438362/index.html">Comment nous avons traduit la configuration de nos services de XML en YAML</a></li>
<li><a href="../fr438364/index.html">R√©plication du premier brouilleur vocal num√©rique au monde</a></li>
<li><a href="../fr438366/index.html">Encore un autre examen de la fonctionnalit√© des jetons mat√©riels OATH dans Azure Cloud MFA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>