<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà≥ üíñ ü¶ç 3 Probleme beim √úbertragen von Daten an Google Analytics √ºber das Messprotokoll ‚õµÔ∏è üöò üîπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Mein Name ist Ivan Spiridonov, ich bin der Sch√∂pfer des End-to-End-Analysedienstes R7K12. Unser System hilft dabei, die effektivsten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>3 Probleme beim √úbertragen von Daten an Google Analytics √ºber das Messprotokoll</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485482/">  Hallo allerseits!  Mein Name ist Ivan Spiridonov, ich bin der Sch√∂pfer des End-to-End-Analysedienstes R7K12.  Unser System hilft dabei, die effektivsten Werbequellen zu identifizieren, die dem Unternehmen echten Gewinn bringen und nicht nur das Budget ausgeben.  Zur Analyse von Statistiken zu Besuchen, Verk√§ufen und gezielten Anrufen verwenden einige Kunden nicht nur R7K12, sondern auch Google Analytics (im Folgenden: GA). <br><a name="habracut"></a><br>  Daher m√∂chten wir heute unsere eigenen Erfahrungen bei der √úbertragung von Daten an GA unter Verwendung des Measurement Protocol (im Folgenden: MP) teilen.  Ich bin sicher, dass viele diese Informationen n√ºtzlich finden werden.  Wie Sie das Senden von Informationen mit MP konfigurieren und was dies ist, wird <a href="https://netpeak.net/ru/blog/measurement-protocol-podklyuchayem-offlayn-biznes-k-google-analytics/">hier</a> ausf√ºhrlich beschrieben.  Und ich werde √ºber die ‚ÄûFallstricke‚Äú des Instruments sprechen und zeigen, wie Sie sie umgehen k√∂nnen.  Bei der √úbertragung von Daten an GA √ºber MP treten am h√§ufigsten die folgenden Probleme auf: <br><br><ol><li>  Falsches Lesen der IP-Adresse. </li><li>  Benutzerger√§tetyp √ºberschreiben. </li><li>  Zuf√§llige Zuordnung von Werbequellen. </li></ol><br>  Betrachten wir jeden von ihnen genauer. <br><br><h3>  Ung√ºltiges Lesen der IP-Adresse </h3><br>  MP erm√∂glicht die √úbertragung beliebiger Daten (Anwendungen, Verk√§ufe, Telefonanrufe) von Offline-Quellen an GA.  Das System ermittelt die IP-Adressen der Besucher mithilfe eines auf der Site installierten Z√§hlers genau. <br><br><img src="https://habrastorage.org/webt/ib/uq/yw/ibuqywgt7czcs3rrz5hl8nfqtqk.png"><br><br>  Betrachten Sie diesen Punkt an einem bestimmten Beispiel genauer.  Wir gehen auf die Website <a href="https://www.r7k12.ru/">www.r7k12.ru</a> und √∂ffnen den <a href="https://www.r7k12.ru/">Seitencode</a> .  In der Registerkarte ‚ÄûNetzwerk‚Äú ist zu sehen, dass die Anforderungsparameter keine IP-Adresse enthalten.  Dies liegt daran, dass das System das Land / die Stadt basierend auf der IP des Benutzers bestimmt, wenn der GA-Z√§hler auf der Site ausgel√∂st wird. <br><br><img src="https://habrastorage.org/webt/ht/zb/qx/htzbqxlzr-qrvoygfii43hkiaxg.png"><br><br>  Dementsprechend wird ein Besuch des Analysesystems mit der richtigen Geolokalisierung aufgezeichnet. <br><br><img src="https://habrastorage.org/webt/_g/et/zo/_getzob1u-3of89egtd4x0f5ke0.png"><br><br>  Jetzt werden wir versuchen, die MP-Verkaufsdaten eine halbe Stunde sp√§ter (nach dem Ende der aktuellen Sitzung) unter Angabe der Kunden-ID an GA zu senden.  Ich werde sofort klarstellen, dass ich eine Anfrage von einem Server in Deutschland stelle. <br><br><img src="https://habrastorage.org/webt/dg/ww/xr/dgwwxrb-947zi-ykpx8g8ptg-vy.png"><br><br>  Nachdem wir Daten an GA √ºbertragen haben, sehen wir, dass auf derselben Kunden-ID eine Sitzung aus Deutschland er√∂ffnet wurde.  Warum ist das passiert? <br><br><img src="https://habrastorage.org/webt/mi/nq/pz/minqpzkggkci4na5u9oke4hrnkc.jpeg"><br><br>  Tatsache ist, dass, wenn nach dem Ende der Hauptsitzung zus√§tzliche Informationen zu MP im Analysesystem eingehen, eine neue erstellt wird und GA die IP-Adresse des Servers liest, von dem die Anforderung gesendet wurde.  Dementsprechend erhalten alle auf diese Weise erhaltenen Daten die gleiche IP. <br><br>  Diese Nuance kann zu sehr gro√üen Abweichungen in den Berichten f√ºhren, insbesondere wenn Benutzer und Server unterschiedliche geografische Positionen haben.  In unserem Fall befindet sich der Server beispielsweise in Deutschland, und Anwendungen von Clients stammen aus der Ukraine.  Im GA-Bericht hat eine Bestellung, die nach dem Ende der Sitzung √ºber MP gesendet wurde, jedoch eine ung√ºltige IP-Adresse. <br><br><img src="https://habrastorage.org/webt/at/5x/g2/at5xg2qlfj0ew-jj4f26-4nn-7e.jpeg"><br><br>  Daher legt GA nur die IP-Adresse des Servers und nicht bestimmte Benutzer fest, sodass alle Verk√§ufe eine deutsche IP haben. <br><br><img src="https://habrastorage.org/webt/6r/t0/d0/6rt0d0o4fow3j8matwxqq-koyuu.png"><br><br>  Um dieses Problem zu l√∂sen, empfehle ich, beim Senden einer Anfrage einen speziellen Parameter (uip) hinzuzuf√ºgen, mit dem Sie die IP-Adressen von Besuchern √ºbertragen k√∂nnen.  Wenn die Site in PHP geschrieben ist, k√∂nnen die Daten f√ºr den Parameter der Variablen $ _SERVER ['REMOTE_ADDR'] entnommen werden. <br><br><img src="https://habrastorage.org/webt/lt/mu/3v/ltmu3vmhzmlcf5rxcthvtpal0ms.png"><br><br>  Die letzte Abfrage sollte ungef√§hr so ‚Äã‚Äãaussehen: <br><br><img src="https://habrastorage.org/webt/a8/p-/du/a8p-dur-tyh6aom3m4hp5ukskmy.png"><br><br>  Danach sind folgende √Ñnderungen in GA sichtbar: <br><br><img src="https://habrastorage.org/webt/8u/hy/o3/8uhyo3cgtzkglpzrwuufalklax8.png"><br><br><h3>  √úberschreibung des Benutzerger√§tetyps </h3><br>  Das Analysesystem ermittelt Informationen zum Ger√§tetyp aus den Headern, die zusammen mit der Anforderung √ºbertragen werden.  Daher lautet der Wert dieser Daten wie bei IP-Adressen beim Senden von Daten √ºber MP nach Abschluss der Hauptsitzung in GA h√§ufig "Desktop" (der Benutzeragent des aktuellen Servers wird verwendet), auch wenn der Besucher eine Anfrage von einem Mobiltelefon oder Tablet hinterlassen hat. <br><br><img src="https://habrastorage.org/webt/dj/fw/nc/djfwncc2jox566idkc4xybqbdt4.png"><br><br>  In einer solchen Situation k√∂nnen wir die Konvertierung des Ger√§ts oder des Browsers nicht korrekt ermitteln. Daher m√ºssen wir beim Senden einer Anfrage an GA erneut zus√§tzliche Tags verwenden.  Hier hilft uns der Parameter ua. <br><br><img src="https://habrastorage.org/webt/d8/uc/tb/d8uctbtcles0-rldtnkx2b1zbqu.png"><br><br>  Und so sieht die Abfrage aus, um den Typ des Benutzerger√§ts zu bestimmen. <br><br><img src="https://habrastorage.org/webt/f3/er/wd/f3erwdabajsmn1dtqisvrwojr7a.png"><br><br><h3>  Zuweisen von Anzeigenquellen </h3><br>  Auch beim Versand per MP gibt es einige Besonderheiten bei der Zuordnung von Werbeplattformen.  Der GA-Dienst hat n√§mlich einen eigenen Algorithmus, um sie zu bestimmen.  Beispielsweise hat ein Nutzer die Website von der Google Adwords-Quelle um 15:31 Uhr aufgerufen und eine Anfrage hinterlassen. <br><br><img src="https://habrastorage.org/webt/l8/g8/ze/l8g8zeejhr-nsmtnpc1cvfbbylc.png"><br><br>  Der zweite Besuch war bei Yandex / cpc und der letzte war ein direkter Anruf um 18:13 Uhr.  Schickte den Verkauf um 18:48 Uhr, nach Abschluss des letzten Besuchs der Benutzer.  Dementsprechend startete GA eine weitere Sitzung mit direktem Zugriff auf die Website. <br><br><img src="https://habrastorage.org/webt/1t/ng/fe/1tngfe6bhzxo9dz540xti7jdnvc.png"><br><br>  Der Bericht zeigt, dass alle drei Sitzungen und die Transaktion der yandex / cpc-Werbeplattform zugeordnet wurden, obwohl der Besuch und die Bewerbung tats√§chlich bei Google Adwords stattfanden.  Wie ist es passiert? <br><br><img src="https://habrastorage.org/webt/jc/kq/fd/jckqfdl5tlhnfoabu8uxqtsm-2u.png"><br><br>  GA ordnet Daten in Berichten dem letzten indirekten Benutzerbesuch zu.  Und dies bedeutet, dass, wenn zu dem Zeitpunkt, zu dem die Daten nicht an das Analysesystem gesendet wurden, der Kunde die Website von anderen Werbequellen aus besucht hat, die Anwendung f√ºr eine davon festgelegt wird.  Eine √§hnliche Situation ist typisch f√ºr Websites, bei denen der Verkauf einige Zeit nach Einreichung des Antrags erfolgt und der Kunde die Website erneut besuchen kann.  Zum Beispiel b2b, bei dem das Intervall von der Antragstellung bis zum Verkauf zwischen einem Tag und mehreren Monaten liegen kann. <br><br>  Somit wird die Definition von Werbequellen zum Problem.  Der einzige Ausweg besteht darin, alle verwendeten Sites manuell zu GA hinzuzuf√ºgen, wenn eine MP-Anfrage unter Verwendung spezieller Parameter (cn, ck, cc, cm, cs) gesendet wird. <br><br><img src="https://habrastorage.org/webt/60/td/pf/60tdpf7gwwklsyys523vnj7rxbw.png"><br><img src="https://habrastorage.org/webt/6z/bj/fh/6zbjfhtqj_icmhj4bpxpppkcnxw.png"><br><img src="https://habrastorage.org/webt/fn/25/a-/fn25a-gqlhgtv672mfd8awk6q3e.png"><br><img src="https://habrastorage.org/webt/dq/wi/se/dqwisezb2heu3jgkd900k9utviu.png"><br><br>  Wenn Sie eine Anfrage senden, in der die Quelle angegeben ist (in diesem Beispiel google / cpc), wird die Transaktion dem richtigen Werbekanal zugewiesen. <br><br><img src="https://habrastorage.org/webt/1y/y0/jt/1yy0jtuwgvq9ed0ggaohs38gk2o.png"><br><br>  Der Parametersatz sieht folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/ic/nj/5v/icnj5vookhybrm41vb7xjnithmu.png"><br><br>  Es gibt jedoch eine wichtige Nuance, die bei der Erstellung einer Anfrage ber√ºcksichtigt werden muss.  Werbung f√ºr GoogleAds funktioniert nicht mit UTM-Tags. Das System verf√ºgt jedoch √ºber eine spezielle Funktion f√ºr das automatische Tagging - die Google-Klick-ID (GCLID). <br><br><img src="https://habrastorage.org/webt/9d/oi/mw/9doimwtrl2ioqgke2zedovzwewq.png"><br><br>  Dies bedeutet, dass Unternehmen f√ºr die korrekte Darstellung von Werbung nicht nur UTM-Tags, sondern auch GCLID senden m√ºssen.  Beispiel f√ºr die abschlie√üende Abfrage: <br><br><img src="https://habrastorage.org/webt/m-/bm/oy/m-bmoys5mjiladueveg-ugdta7g.png"><br><br>  Abschlie√üend m√∂chte ich all das zusammenfassen, was MP betrifft.  Dieses Tool verf√ºgt √ºber einige Funktionen, die Sie zum √úbertragen von Informationen an Google Analytics ben√∂tigen.  Damit die Daten korrekt gesendet werden, m√ºssen in der Anfrage unbedingt zus√§tzliche Parameter angegeben werden.  Mit ihrer Hilfe werden die Werbequellen, der Ger√§tetyp, die IP-Adressen der Besucher und andere wichtige Informationen vom GA-Dienst korrekt angezeigt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485482/">https://habr.com/ru/post/de485482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485468/index.html">Variante der Arbeit mit Web-Sockets in iOS in Swift / Schrieb einen Manager f√ºr die Arbeit mit Web-Socket</a></li>
<li><a href="../de485470/index.html">HighLoad ++, Andrey Gushchin (Zabbix): Hochleistung und native Partitionierung</a></li>
<li><a href="../de485472/index.html">Was ist neu bei AMD?</a></li>
<li><a href="../de485476/index.html">Trends und Handel an der B√∂rse: 4 beliebte Indikatoren der technischen Analyse</a></li>
<li><a href="../de485480/index.html">Tragbare S√§ule Z-poject Doublebeef - Doppelmono auf Russisch. Test, Demontage und Upgrade</a></li>
<li><a href="../de485484/index.html">[Case Locomizer] Welches Wissen kann tats√§chlich aus einem anonymen Datensatz mit Benutzerkoordinaten extrahiert werden?</a></li>
<li><a href="../de485486/index.html">Buildpacks-Unterst√ºtzung in Spring Boot 2.3.0</a></li>
<li><a href="../de485488/index.html">Noch einmal √ºber DevOps und SRE</a></li>
<li><a href="../de485490/index.html">Warum konnte Moschus nicht in Russland geboren werden?</a></li>
<li><a href="../de485492/index.html">Wissenschaftler sagen, wie schnell sich das Universum ausdehnt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>