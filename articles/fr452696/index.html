<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📵 🐢 🦔 Comment démarrer des micro-paiements dans votre application 🌠 🐲 👩‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La semaine dernière, j'ai passé à développer mon premier programme public - le bot Telegram qui fonctionne comme un portefeuille Bitcoin et vous perme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment démarrer des micro-paiements dans votre application</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452696/">  La semaine dernière, j'ai passé à développer mon premier programme public - le bot Telegram qui fonctionne comme un portefeuille Bitcoin et vous permet de «jeter des pièces» à d'autres participants dans des chats de groupe et d'effectuer également des paiements Bitcoin externes pour vous-même ou pour d'autres soi-disant  «Lightning Apps».  Je veux dire qu'en général le lecteur est familier avec Bitcoin et Telegram, comme  J'essaierai d'écrire brièvement, sans entrer dans les détails.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une sélection de ressources sur Bitcoin est disponible sur ce lien</a> , mais Telegram est un outil de messagerie instantanée pour les appareils mobiles et les PC qui vous permet de créer vos propres petites applications (chat bots) sur leur plateforme. <br><br><h3>  Quelles sont les principales fonctionnalités de cette application? </h3><br><ul><li>  Vous permet de remercier ou de récompenser l'interlocuteur avec une valeur vraiment matérielle, et pas seulement un <i>«virtuel»</i> , ce qui porte la communication électronique à un tout autre niveau </li><li>  Un exemple concret d'une application qui peut interagir financièrement avec d'autres applications en utilisant un protocole de paiement ouvert </li><li>  Tous les composants d'application sont des projets open source et il est possible de les modifier et de les appliquer à vos tâches.  L'application n'utilise pas de solutions fermées et / ou commerciales, en dépit du fait qu'elle s'adapte au domaine du commerce électronique, qui est aujourd'hui assez difficile à appeler ouvert. </li></ul><br><h3>  Et comment l'appliquer en entreprise? </h3><br>  quelque chose comme ça ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="image"></div><a name="habracut"></a><br>  ou alors ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="image"></div><br>  Que signifient ces chiffres?  Ce sont des <b>unités de Bitcoin - Satoshi</b> .  Au prix de change de la mi-2019, 1000 Satoshi est d'environ 0,06 $.  Satoshi peut être dépensé en ligne ou facilement échangé contre de la monnaie nationale.  C'est pour cette raison (liquidité) qu'il ne s'agit pas simplement d'une autre <i>«entrée dans la base de données»</i> ou de <i>«points que vous pouvez dépenser dans les magasins de nos partenaires»,</i> mais de <b>l'argent réel sur Internet</b> . <br>  <i>* Je tiens à noter tout de suite que je n'essaie délibérément pas d'écrire des mots ou des phrases en russe - soit je ne connais pas la traduction contextuelle elle-même dans certains cas, soit une telle traduction, à mon avis, semble plus déroutante que correcte.</i> <br><br>  La question peut se poser, comment utiliser une telle application s'il n'y a pas de bitcoins.  Ils peuvent être facilement achetés en petites quantités sur l'un des nombreux échanges ou échangeurs, ou vous pouvez les obtenir auprès d'un ami Bitcoin ou même obtenir des pièces des utilisateurs de robots actuels.  De nombreux portefeuilles sur le téléphone proposent d'acheter des bitcoins directement "sans quitter la caisse". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"><br><br>  Lorsque nous avons mis la main sur des bitcoins (mais plutôt Satoshi (?)) - exécutez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@atomic_tipbot</a> et faites / déposez. <br><br>  Le bot en réponse demandera combien de satoshi doit être crédité sur le compte et enverra une facture pour le paiement, qui peut être payée avec un portefeuille mobile en scannant le code QR ou en cliquant sur le bouton ( <i>«ouvrir dans le portefeuille»</i> ) sur la page de facturation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="image"><br><br>  Après avoir confirmé le paiement sur votre portefeuille, presque immédiatement une confirmation de paiement sera envoyée au bot et celle-ci sera visuellement affichée dans le cadre du compte. <br><br>  Jusqu'à ce moment, nous avons abordé deux composants de l'application - le bot de télégramme principal et le système de traitement des paiements par crypto-monnaie (plutôt, son frontal). <br><br>  Pour créer un bot Telegram, j'ai utilisé le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bot Python Telegram</a> .  Et bien sûr, le bot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">open source</a> lui-même. <br><br>  En tant que système de traitement des paiements et de résolution des problèmes UX, le choix est tombé (en fait, il n'y a presque pas de choix) sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BTCPayServer</a> , pour lequel la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation est disponible sur ce lien</a> . <br><br>  Si vous recherchez des solutions pour traiter directement les événements de paiement, vous devez faire attention aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pages de manuel Electrum CLI</a> pour les soi-disant  les paiements en chaîne et pour les solutions de micro-paiements instantanés (Lightning) comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lightning-charge</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sparko</a> . <br><br><h3>  Est-il donc auto-hébergé ou non!? </h3><br>  Oui.  Dans mon application, j'utilise l'hébergement gratuit BTCPayServer - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BTCPayJungle</a> , mais c'est absolument possible et ne nécessite pas beaucoup de temps pour lancer mon propre centre de traitement.  Cependant, il convient de rappeler que vous aurez besoin d'environ 500 Go disponibles sur le chemin de fer pour stocker les chaînes de blocs Bitcoin (et Litecoin).  Cela nécessitera également des ressources informatiques et réseau pour la durée de la synchronisation et, selon vos besoins, les «wrappers» nécessaires pour les blockchains, de sorte qu'il serait pratique d'interagir avec eux.  BTCPayServer ne contient pas <i>de</i> clés privées de <i>conception</i> ou toute autre information qui vous permet de contrôler votre portefeuille. <br><br>  Pour les paiements en chaîne (réguliers), vous devez ajouter ce que l'on appelle  Clé xpub-wallet dans BTCPayServer pour générer des adresses de réception (clés publiques).  Cela rend possible et sûr l'utilisation de BTCPayServer même sous une forme "partagée".  Toutes ces clés et adresses xpub peuvent être facilement obtenues dans de bons portefeuilles comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Electrum</a> , pour un traitement ultérieur. <br><br>  Tous ceux qui ont rencontré Bitcoin ont entendu dire que Bitcoin est lent et que les transactions sont chères, en particulier lorsqu'il est hype, donc pour les micro-paiements instantanés, vous devez utiliser les transactions Lightning Network (hors chaîne). <br><br><h3>  Qu'est-ce que ce réseau Lightning? </h3><br>  C'est un peu un plugin Bitcoin qui construit une couche supplémentaire d'abstraction et vous permet de faire des transactions instantanées et presque gratuites sur le réseau Bitcoin.  Tout cela est possible grâce à la magie cryptographique à multi-signatures, souvent appelée <i>contrat intelligent</i> .  Il existe plusieurs implémentations du protocole Lightning Network, j'utilise l'implémentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">c-lightning</a> en C. <br><br>  La principale différence entre les paiements en chaîne et hors chaîne (Lightning) est la façon dont ils sont stockés.  Toutes <b>les</b> transactions en <b>chaîne</b> sont relayées à tous les nœuds du réseau jusqu'à ce que l'un des nœuds Bitcoin annonce un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau bloc miné</a> avec des transactions incluses.  (Il y a même <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">BitFury sur le moyeu</a> ; ils ne produisent que du fer pour l'exploitation minière).  C'est pour cette raison que nous appelons ces transactions <b>en chaîne</b> .  Ces transactions seront enregistrées dans une blockchain commune et y seront stockées jusqu'à la fin de son existence.  Ces transactions sont également du domaine public et peuvent être surveillées, suivies et analysées. <br><br>  Dans le cas des transactions <b>hors chaîne</b> (Lightning), tout se passe différemment.  Chaque nœud du réseau Lightning a une <i>(ou plusieurs)</i> adresses en chaîne - ce sont les adresses Bitcoin habituelles à partir desquelles tout commence.  Lorsque des bitcoins apparaissent à une telle adresse, il est possible d'ouvrir ce que l'on appelle.  <i>canal de foudre</i> vers un autre nœud, ce qui signifie qu'avec l'aide de techniques cryptographiques, ces deux nœuds se sont mis d'accord sur la disponibilité des fonds entre eux.  Plus tard, toutes les transactions (tant les leurs que les transactions de nœuds étrangers) qui transitent par un tel canal sont stockées uniquement sur les nœuds des participants à la transaction (et les nœuds intermédiaires).  Les seules transactions enregistrées sur la blockchain sont des transactions sur l'ouverture ou la fermeture d'un canal.  À plus grande échelle, nous obtenons un tel réseau de nœuds interconnectés qui construit entre les participants des milliers de façons différentes de «transférer» des fonds d'un nœud à un autre selon certaines règles strictes.  Presque toutes ces transactions sont stockées uniquement dans le fichier de base de données des nœuds eux-mêmes.  C'est pour cette raison que nous les appelons <b>hors chaîne</b> . <br><br><h3>  Le diagramme montre la visualisation de tous les composants de l'application </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="image"><br><br>  En bref: <br><br>  1) L'utilisateur envoie une commande au bot dans <b>Telegram</b> <br><br>  2) Le télégramme envoie un message d'événement <b>python</b> à l' <b>application</b> bot <br><br>  3) une <b>application python</b> envoie une demande à <b>BTCPayServer</b> <br><br>  4) BTCPayServer génère les adresses BTC et LTC entrantes et envoie une demande de facture à <b>lightning-charge</b> , qui à son tour communique avec le démon <b>c-lightning</b> .  À la sortie, nous obtenons une belle forme HTML de traitement des paiements <br><br>  5) L'utilisateur paie la facture et voit une confirmation <br><br>  6) <b>BTCPayServer</b> envoie <i>une notification de paiement de facture</i> (IPN) au callback_url spécifié, dans notre cas <b>callbacks.py</b> (une autre application python pour recevoir des notifications) <br><br>  7) Selon les données reçues, le solde de l'utilisateur change <br><br>  <i>... et si l'utilisateur souhaite retirer des fonds (pièces qu'il a reçues d'autres) ...</i> <br><br>  8) L' <b>application Python</b> du bot attend le texte ou l'image du code QR, et lorsque des données valides sont reçues, le paiement par l'utilitaire <b>paylightning.py *</b> est <b>effectué</b> , ce qui initialise la transaction à l'aide de c-lightning RPC. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="image"><br><br>  <i>* En toute honnêteté, il convient de noter que mon wrapper paylightning.py n'est pas complètement terminé et peut retourner un faux négatif dans des scénarios spécifiques.</i>  <i>Je recommande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'utiliser un wrapper bien débogué</a> dans les cas proches de la production</i> <br><br>  Qu'avons-nous?  Les utilisateurs de notre bot peuvent à l'intérieur d'une discussion de groupe ou directement transférer <b>la valeur matérielle</b> sans restrictions.  Et ce n'est pas tout - grâce au protocole Lightning Network, qui est en quelque sorte un réseau de paiement unifié et simplifié, il est possible d'envoyer le même argent reçu dans le chat à des applications entièrement tierces.  Par exemple, Telegram avait déjà le premier bot pour les paiements Bitcoin - @lntxbot.  «Un équilibre» vous permet d'utiliser n'importe lequel des bots en fonction des préférences d'un chat de groupe particulier (oui, le problème est complètement artificiel et la solution est très inutile, mais l'essentiel est par essence).  Transférer le solde d'un bot à un autre ne coûte rien et prend quelques secondes!  Il est important de noter que les créateurs de ces robots ne se sont même jamais connectés les uns aux autres. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="image"><br><br>  Il suffit de simplement transmettre le message de demande de dépôt de @lntxbot à @atomic_tipbot et voul'a! <br><br>  Il ne s'agit pas seulement de «transférer des numéros vers la base de données», mais un paiement entre deux bases de données différentes et indépendantes.  Ainsi, plusieurs «LApps» sont déjà intégrés dans le bot, parmi eux: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sat2.io</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lnsms.world</a> . <br><br>  <b>Que signifie l' <i>intégration LApp</i> ?</b> <br><br>  Chaque nœud <i>Lightning Network</i> est essentiellement un portefeuille Bitcoin.  Elle a deux soldes: en chaîne et hors chaîne.  Un équilibre en chaîne est nécessaire pour ouvrir de nouveaux canaux et stocker des fonds provenant de canaux fermés.  Mais l'équilibre hors chaîne est exactement ce qui se passe entre les nœuds.  Les exigences principales pour un nœud sont la réception et l'envoi de paiements, donc chaque nœud en tant que logiciel a des fonctions de <i><b>paiement</b></i> et de <i><b>facturation</b></i> .  Je vais montrer comment cela se produit: <br><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br>  Nous obtenons une «facture» de la spécification <a href="">BOLT11</a> dans ce cas, qui est le format de paiement sur le réseau Bitcoin (et Litecoin, d'ailleurs, aussi).  Il s'agit d'une ligne contenant des informations sur le destinataire, le montant de la transaction, l'heure d'expiration de la demande, etc., des informations détaillées peuvent être obtenues en exécutant decodepay par rapport à cette ligne: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> éclair cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre><br>  Mais pour payer une telle «facture», nous avons besoin de la fonction de paiement de c-lightning: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> éclair cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j salariale <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre><br>  Tous les états de transaction sont gérés par l'ensemble du réseau et votre propre nœud en particulier.  Il n'est pas nécessaire (mais il existe une telle opportunité) d'interagir avec les auteurs de l'application bénéficiaire ou l'une de leurs API pour obtenir des informations sur l'état du paiement.  Il n'est pas nécessaire de vérifier l'état du paiement dans le système de traitement intermédiaire.  Pas besoin d'attendre l'approbation de votre transaction par une banque ou une agence gouvernementale.  En fin de compte, il n'y a pas de refacturation et d'autres facteurs externes qui peuvent affecter le solde de votre compte.  Il s'agit d'une solution pour déplacer de la valeur via Internet, sans avoir besoin d'un arbitre externe qui décide si la transaction est conforme aux règles (parfois même des règles internes, dont tous les participants ne sont pas informés auparavant) ou non.  Il n'y a pas de "règles internes" dans le bitcoin.  Les seules règles que vous devez suivre sont les règles de réseau - ouvertes et bien connues. <br><br>  Cela rend <b>les</b> transactions d'argent <b>directes</b> , <b>pratiquement gratuites</b> et <b>instantanées</b> entre des personnes ou des programmes réalistes. <br><br>  Si vous avez la possibilité de recevoir des données de paiement d'une application tierce, il devient alors possible d'interagir financièrement avec cette application.  Par exemple, considérons le service lnsms.world, qui vous permet d'envoyer un SMS à un numéro arbitraire en le payant avec des bitcoins.  Pour intégrer cette application, nous avons seulement besoin de transférer les données du formulaire Web directement vers le script d'envoi de SMS - pour émuler les actions des utilisateurs sur le site Web: <br><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre><br>  Je ne sais pas pour quelle raison, mais lnsms répond avec 201 code de statut HTTP et renvoie une facture au format BOLT11.  Eh bien, cela suffit aux utilisateurs de bots de payer pour envoyer des SMS à partir de leur solde reçu dans les salles de chat.  L'utilisateur ne sait même pas ce qui s'y passe, il vient de payer quelques centimes pour l'envoi de SMS.  Et moi, en tant que développeur, je n'entre pas dans les détails du travail des services SMS.  Je viens de transmettre le paiement et j'ai reçu le service.  Vous pouvez faire une majoration sur le dessus, mais vous ne pouvez pas le faire - c'est mon libre choix.  Aucun compte, accord ou autre API pour des tâches triviales comme l'envoi de SMS. <br><br>  Et maintenant, imaginons pour le moment que notre application soit quelque chose de plus utile qu'un bot de chat et effectue un paiement non pas à un autre bot, mais à une autre application ou appareil connecté à Internet.  Ou ce sont des dizaines, voire des centaines de paiements insignifiants chaque seconde entre des appareils, des services, des magasins ou une sorte de fournisseurs de services.  C'est le pouvoir des micro-paiements, donc l'Internet des objets devrait ressembler.  Il existe déjà des projets comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Althea</a> qui donnent vie à ces idées et dans un avenir proche, nous verrons de grands changements, à mon avis, dans le domaine que nous appelons maintenant le commerce électronique. <br><br>  Si vous avez aimé le post et que vous voulez essayer les bitcoins en action - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">envoyez-moi une bière et des petits pains français</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452696/">https://habr.com/ru/post/fr452696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452684/index.html">Développement d'un jeu sur Svelte 3</a></li>
<li><a href="../fr452686/index.html">Espionnage pour lequel ils n'interdisent pas (une histoire des années 80)</a></li>
<li><a href="../fr452688/index.html">Service Windows. Recherchez les erreurs système et affichez-les dans WinForm C #</a></li>
<li><a href="../fr452690/index.html">Qu'est-ce qui est si intéressant à propos du Transsibérien?</a></li>
<li><a href="../fr452692/index.html">L'auteur du projet rePalm a réécrit Palm OS à partir de zéro et prévoit de le transformer en une plateforme de montre intelligente</a></li>
<li><a href="../fr452698/index.html">Deux en un: les données touristiques et les billets pour les événements culturels étaient accessibles au public</a></li>
<li><a href="../fr452700/index.html">Nouvelles du monde d'OpenStreetMap n ° 460 (7 mai 2019-13 mai 2019)</a></li>
<li><a href="../fr452702/index.html">Tests de code et code de tests</a></li>
<li><a href="../fr452704/index.html">Débogage post mortem sur Cortex-M</a></li>
<li><a href="../fr452706/index.html">En 1983, cet ordinateur de Bella Labs est devenu le premier grand maître.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>