<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéôÔ∏è üì´ ü§∑üèº C√≥mo trabajar con datos de inteligencia cibern√©tica: aprendemos a recopilar e identificar indicadores de compromiso del sistema üç• ‚õπüèª ‚öíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante el a√±o pasado, el tema de la inteligencia cibern√©tica o Inteligencia de amenazas ha ganado una creciente popularidad en la carrera de armas ci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo trabajar con datos de inteligencia cibern√©tica: aprendemos a recopilar e identificar indicadores de compromiso del sistema</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/438798/">  Durante el a√±o pasado, el tema de la inteligencia cibern√©tica o Inteligencia de amenazas ha ganado una creciente popularidad en la carrera de armas cibern√©ticas entre atacantes y defensores.  Obviamente, obtener informaci√≥n de manera proactiva sobre las amenazas cibern√©ticas es algo muy √∫til, pero no proteger√° la infraestructura por s√≠ misma.  Es necesario crear un proceso que ayude a gestionar correctamente tanto la informaci√≥n sobre el m√©todo de un posible ataque como el tiempo disponible para prepararse para √©l.  Y la condici√≥n clave para la formaci√≥n de dicho proceso es la integridad de la informaci√≥n sobre las amenazas cibern√©ticas. <br><br><img src="https://habrastorage.org/webt/xs/up/0s/xsup0shlxsxdrtgzjnomu86flea.jpeg"><br><br>  Los datos primarios de Threat Intelligence se pueden obtener de una amplia variedad de fuentes.  Pueden ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">suscripciones gratuitas</a> , informaci√≥n de socios, un equipo de investigaci√≥n t√©cnica de la empresa, etc. <br><a name="habracut"></a><br>  Hay tres etapas principales de trabajar con la informaci√≥n obtenida a trav√©s del proceso de Inteligencia de amenazas (aunque nosotros, como centro para monitorear y responder a los ataques cibern√©ticos, tenemos una cuarta etapa: notificar a los clientes sobre la amenaza): <br><br><ol><li>  Obtenci√≥n de informaci√≥n, procesamiento primario. </li><li>  Detecci√≥n de indicadores de compromiso (Indicador de compromiso, COI). </li><li>  Verificaci√≥n retrospectiva. </li></ol><br><h3>  Adquisici√≥n de informaci√≥n, procesamiento primario </h3><br>  La primera etapa se puede llamar la m√°s creativa.  Comprender correctamente la descripci√≥n de una nueva amenaza, resaltar los indicadores relevantes, determinar su aplicabilidad a una organizaci√≥n espec√≠fica, filtrar informaci√≥n innecesaria sobre los ataques (por ejemplo, dirigida espec√≠ficamente a ciertas regiones), todo esto es a menudo una tarea dif√≠cil.  Al mismo tiempo, hay fuentes que proporcionan datos exclusivamente verificados y relevantes que se pueden agregar a la base de datos autom√°ticamente. <br><br>  Para un enfoque sistem√°tico del procesamiento de la informaci√≥n, recomendamos dividir los indicadores obtenidos en el marco de Threat Intelligence en dos grandes grupos: host y red.  La detecci√≥n de indicadores de red no significa un compromiso inequ√≠voco del sistema, pero la detecci√≥n de indicadores de host, como regla, se√±ala de manera confiable el √©xito de un ataque. <br><br>  Los indicadores de red incluyen dominios, URL, direcciones de correo, un conjunto de direcciones IP y puertos.  Los indicadores de host est√°n ejecutando procesos, cambios en las ramas y archivos del registro, cantidades hash. <br><br>  Indicadores recibidos como parte de una sola alerta de amenaza, tiene sentido combinarse en un grupo.  En el caso de la detecci√≥n de indicadores, esto facilita enormemente la determinaci√≥n del tipo de ataque y tambi√©n facilita la verificaci√≥n del sistema potencialmente comprometido para todos los posibles indicadores de un informe de amenaza espec√≠fico. <br><br>  Sin embargo, a menudo uno tiene que lidiar con indicadores, cuya detecci√≥n no nos permite hablar inequ√≠vocamente de un sistema comprometido.  Estas pueden ser direcciones IP que pertenecen a grandes corporaciones y redes de alojamiento, dominios de correo de servicios de correo publicitario, nombres y sumas hash de archivos ejecutables leg√≠timos.  Los ejemplos m√°s simples son las direcciones IP de Microsoft, Amazon, CloudFlare, que a menudo se enumeran, o procesos leg√≠timos que aparecen en el sistema despu√©s de instalar paquetes de software, por ejemplo, pageant.exe, un agente para almacenar claves.  Para evitar una gran cantidad de falsos positivos, es mejor filtrar tales indicadores, pero, digamos, no los deseche, la mayor√≠a de ellos no son completamente in√∫tiles.  Si existe la sospecha de un sistema comprometido, se realiza una verificaci√≥n completa de todos los indicadores, y la detecci√≥n de incluso un indicador indirecto puede confirmar estas sospechas. <br><br>  Como no todos los indicadores son igualmente √∫tiles, en Solar JSOC utilizamos el llamado peso del indicador.  Por convenci√≥n, la detecci√≥n del inicio de un archivo, cuya suma de hash coincide con el hash del archivo ejecutable malicioso, tiene un peso umbral.  La detecci√≥n de dicho indicador conduce instant√°neamente a la ocurrencia de un evento de seguridad de la informaci√≥n.  Un solo acceso a la direcci√≥n IP de un host potencialmente peligroso en un puerto no espec√≠fico no conducir√° a un evento IB, pero caer√° en un perfil especial que acumula estad√≠sticas, y la detecci√≥n de nuevas llamadas tambi√©n conducir√° a una investigaci√≥n. <br><br>  Al mismo tiempo, existen mecanismos que nos parecieron razonables en el momento de la creaci√≥n, pero que finalmente se reconocieron como ineficaces.  Por ejemplo, inicialmente se estableci√≥ que ciertos tipos de indicadores tendr√°n una vida √∫til limitada, despu√©s de lo cual se desactivar√°n.  Sin embargo, como lo ha demostrado la pr√°ctica, cuando se conecta a una nueva infraestructura, a veces se encuentran hosts que han estado infectados con varios tipos de malware durante a√±os.  Por ejemplo, una vez al conectar a un cliente, se detect√≥ el virus de Corkow en la m√°quina del jefe del servicio de IS (los indicadores ten√≠an m√°s de cinco a√±os en ese momento), y una investigaci√≥n posterior revel√≥ una puerta trasera explotada y un keylogger en el host. <br><br><h3>  Detecci√≥n de indicadores de compromiso. </h3><br>  Trabajamos con muchas instalaciones de varios sistemas SIEM, sin embargo, la estructura general de los registros que caen en la base de datos de indicadores est√° estandarizada y se ve as√≠: <br><br><img src="https://habrastorage.org/webt/rg/1m/cg/rg1mcgffhwd2sfncfwwcfx7gxey.png"><br><br>  Por ejemplo, al ordenar los indicadores por TIReportID, puede encontrar todos los indicadores que aparecieron en la descripci√≥n de una amenaza espec√≠fica, y al hacer clic en el enlace URL puede obtener una descripci√≥n detallada de la misma. <br><br>  Al construir el proceso de Inteligencia de amenazas, es muy importante analizar los sistemas de informaci√≥n conectados al SIEM en t√©rminos de su utilidad para identificar indicadores de compromiso. <br><br>  El hecho es que la descripci√≥n del ataque generalmente incluye varios tipos de indicadores de compromiso, por ejemplo, la cantidad hash del malware, la direcci√≥n IP del servidor SS que est√° activando, y as√≠ sucesivamente.  Pero si las direcciones IP a las que accede el host son monitoreadas por muchos medios de protecci√≥n, entonces la informaci√≥n sobre las cantidades de hash es mucho m√°s dif√≠cil de obtener.  Por lo tanto, consideramos todos los sistemas que pueden servir como fuente de cualquier registro desde el punto de vista de qu√© indicadores pueden rastrear: <br><table><tbody><tr><td>  Tipo de indicador <br></td><td>  Tipo de fuente <br></td></tr><tr><td>  Dominio <br></td><td rowspan="2">  Servidores proxy, NGFW, servidores DNS <br></td></tr><tr><td>  URL <br></td></tr></tbody><tbody><tr><td>  Z√≥calo <br></td><td>  Proxies, NGFW, FW <br></td></tr><tr><td>  Mail <br></td><td>  Servidores de correo, antispam, DLP <br></td></tr><tr><td>  Proceso <br></td><td>  Registros del host, DB AVPO, Sysmon <br></td></tr><tr><td>  Registro <br></td><td>  Registros del anfitri√≥n <br></td></tr><tr><td>  Hash sum <br></td><td>  Registros del host, DB AVPO, Sysmon, Sandboxes CMDB <br></td></tr></tbody></table><br>  Esquem√°ticamente, el proceso de detecci√≥n de indicadores de compromiso se puede representar de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/ze/sl/va/zeslvaahq-enqif5tbxrujabrza.png"><br><br>  Ya habl√© sobre los primeros dos puntos anteriores, ahora un poco m√°s sobre la verificaci√≥n de la base de datos del COI.  Por ejemplo, tomaremos los eventos que contienen informaci√≥n sobre direcciones IP.  La regla de correlaci√≥n para cada evento lleva a cabo cuatro posibles comprobaciones en funci√≥n de los indicadores: <br><br><img src="https://habrastorage.org/webt/4q/w_/pn/4qw_pn-hh3tq6xm1k9aeitrz6-s.png"><br><br>  La b√∫squeda se lleva a cabo mediante indicadores relevantes del tipo Socket, mientras que el dise√±o general de la direcci√≥n IP y el puerto correspondiente se verifica para verificar el cumplimiento del indicador.  Porque  En la informaci√≥n sobre la amenaza, el puerto espec√≠fico no siempre se indica, la IP: cualquier construcci√≥n comprueba la presencia de una direcci√≥n con un puerto indefinido en la base de datos. <br><br>  Se implementa un dise√±o similar en una regla que detecta indicadores de compromiso en los eventos de cambio de registro.  En la informaci√≥n entrante, a menudo no hay datos sobre una clave o valor en particular, por lo tanto, cuando se ingresa un indicador en la base de datos, los datos que se desconocen o no tienen un valor exacto se reemplazan con 'cualquiera'.  Las opciones de b√∫squeda final son las siguientes: <br><br><img src="https://habrastorage.org/webt/qw/4e/6z/qw4e6zjcm95uxkv0g3iwl12p1hi.png"><br><br>  Habiendo encontrado el indicador de compromiso en los registros, la regla de correlaci√≥n crea un evento de correlaci√≥n marcado con la categor√≠a que procesa la regla de incidente (discutimos esto en detalle en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cocina DERECHA</a> "). <br><br>  Adem√°s de la categor√≠a, el evento de correlaci√≥n se complementar√° con informaci√≥n sobre en qu√© alerta o informe apareci√≥ este indicador, su peso, datos de amenazas y un enlace a la fuente.  El procesamiento posterior de eventos de detecci√≥n de indicadores de todo tipo se realiza mediante la regla de incidentes.  Su trabajo se puede presentar esquem√°ticamente de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/di/2c/6b/di2c6b7rnrhldtltmiam3kgekoi.png"><br><br>  Pero, por supuesto, debe tener en cuenta las excepciones: en casi cualquier infraestructura hay dispositivos cuyas acciones son leg√≠timas, a pesar de que contienen formalmente signos de un sistema comprometido.  Dichos dispositivos a menudo incluyen cajas de arena, varios esc√°neres, etc. <br><br>  La necesidad de correlacionar los eventos de detecci√≥n de indicadores de diferentes tipos tambi√©n se debe al hecho de que los indicadores heterog√©neos suelen estar presentes en la informaci√≥n sobre amenazas. <br>  En consecuencia, una agrupaci√≥n de eventos de detecci√≥n de indicadores puede permitirle ver toda la cadena de ataque desde el momento de la penetraci√≥n hasta la operaci√≥n. <br><br>  Proponemos considerar la implementaci√≥n de uno de los siguientes escenarios como un evento de seguridad de la informaci√≥n: <br><br><ol><li>  Detecci√≥n de un indicador de compromiso altamente relevante. </li><li>  Detecci√≥n de dos indicadores diferentes de un informe. </li><li>  Alcanzando el umbral. </li></ol><br>  Con las dos primeras opciones, todo est√° claro, y la tercera es necesaria cuando no tenemos m√°s datos que la actividad de red del sistema. <br><br><h3>  Verificaci√≥n retrospectiva de indicadores de compromiso </h3><br>  Despu√©s de recibir informaci√≥n sobre la amenaza, identificar los indicadores y organizar su identificaci√≥n, es necesario realizar una verificaci√≥n retrospectiva que le permita detectar un compromiso que ya ha ocurrido. <br><br>  Si profundizo un poco m√°s en c√≥mo funciona esto en SOC, puedo decir que este proceso requiere una cantidad de tiempo y recursos verdaderamente colosales.  La b√∫squeda de indicadores de compromiso en los registros durante medio a√±o nos obliga a mantener una cantidad impresionante de ellos disponibles para cheques en l√≠nea.  Adem√°s, el resultado de la verificaci√≥n no solo debe ser informaci√≥n sobre la presencia de indicadores, sino tambi√©n datos generales sobre el desarrollo del ataque.  Al conectar nuevos sistemas de informaci√≥n del cliente, los datos de ellos tambi√©n deben verificarse en busca de indicadores.  Para esto, es necesario refinar constantemente el llamado "contenido" de SOC: reglas de correlaci√≥n e indicadores de compromiso. <br><br>  Para el sistema ArcSight SIEM, incluso una b√∫squeda de este tipo en las √∫ltimas semanas puede llevar mucho tiempo.  Por lo tanto, se decidi√≥ aprovechar las tendencias. <br><blockquote>  "Una tendencia es un recurso de ESM que define c√≥mo y durante qu√© per√≠odo de tiempo se agregar√°n y evaluar√°n los datos para determinar las tendencias o corrientes predominantes.  Una tendencia ejecuta una consulta espec√≠fica en un horario definido y duraci√≥n de tiempo ". <br><br>  ESM_101_Guide <br></blockquote><br>  Despu√©s de varias pruebas en sistemas cargados, se desarroll√≥ el siguiente algoritmo para usar tendencias: <br><br><img src="https://habrastorage.org/webt/rn/v9/ef/rnv9efyjnwkryekyyzpy5vzdc8o.png"><br><br>  Las reglas de creaci√≥n de perfiles que completan las hojas activas correspondientes con datos √∫tiles le permiten distribuir la carga total en el SIEM.  Despu√©s de recibir los indicadores, las solicitudes se crean en las hojas y tendencias correspondientes, en funci√≥n de los informes que se realizar√°n, que a su vez se distribuir√°n en todas las instalaciones.  De hecho, solo queda ejecutar informes y procesar los resultados. <br><br>  Vale la pena se√±alar que el proceso de procesamiento puede mejorarse y automatizarse continuamente.  Por ejemplo, hemos introducido una plataforma para almacenar y procesar indicadores de compromiso MISP, que actualmente cumple con nuestros requisitos de flexibilidad y funcionalidad.  Sus an√°logos est√°n ampliamente representados en el mercado de c√≥digo abierto - YETI, extranjero - Anomali ThreatStream, ThreatConnect, ThreatQuotinet, EclecticIQ, Russian - TI.Platform, R-Vision Threat Intelligence Platform.  Ahora estamos realizando pruebas finales de descarga automatizada de eventos directamente desde la base de datos SIEM.  Esto acelerar√° en gran medida la notificaci√≥n de indicadores de compromiso. <br><br><h3>  El elemento principal de la inteligencia cibern√©tica. </h3><br>  Sin embargo, el eslab√≥n final en el procesamiento tanto de los indicadores como de los informes son ingenieros y analistas, y las herramientas mencionadas anteriormente solo ayudan a tomar decisiones.  En nuestro pa√≠s, el grupo de respuesta es responsable de agregar indicadores, y el grupo de monitoreo es responsable de la exactitud de los informes. <br><br>  Sin personas, el sistema no funcionar√° lo suficiente; no se pueden prever todas las peque√±as cosas y excepciones.  Por ejemplo, observamos llamadas a las direcciones IP de los nodos TOR, pero en los informes para el cliente compartimos la actividad del host comprometido y el host en el que simplemente se instal√≥ el navegador TOR.  Es posible automatizarlo, pero es bastante dif√≠cil pensar en todos estos puntos de antemano al configurar las reglas.  Resulta que el grupo de respuesta, de acuerdo con varios criterios, elimina los indicadores que crear√°n una gran cantidad de falsos positivos.  Y viceversa: se puede agregar un indicador espec√≠fico que sea muy relevante para algunos clientes (por ejemplo, el sector financiero). <br><br>  El grupo de monitoreo puede eliminar la actividad de la caja de arena del informe final, verificar que los administradores bloqueen con √©xito un recurso malicioso, pero agregar actividad sobre el escaneo externo sin √©xito, mostrando al cliente que los atacantes verifican su infraestructura.  La m√°quina no tomar√° tales decisiones. <br><br><img src="https://habrastorage.org/webt/o6/zb/c8/o6zbc8wr2lgj2oyy33a1isd9g7m.png"><br><br><h3>  En lugar de salida </h3><br>  ¬øPor qu√© recomendamos este m√©todo de trabajar con Threat Intelligence?  En primer lugar, te permite alejarte del esquema, cuando para cada nuevo ataque necesitas crear una regla de correlaci√≥n separada.  Esto lleva un tiempo inaceptablemente largo y revela solo el ataque en curso. <br><br>  El m√©todo descrito aprovecha al m√°ximo las capacidades de TI: solo necesita agregar indicadores, y esto es un m√°ximo de 20 minutos desde el momento en que aparecen, y luego realizar una verificaci√≥n retrospectiva completa de los registros.  Por lo tanto, reducir√° el tiempo de respuesta y obtendr√° resultados de prueba m√°s completos. <br><br>  Si tiene alguna pregunta, bienvenido a comentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438798/">https://habr.com/ru/post/438798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438788/index.html">Monitoreo ambiental en la sala del servidor (Bolid + Zabbix)</a></li>
<li><a href="../438790/index.html">El intercambio de criptomonedas QuadrigaCX no regalar√° $ 137 millones. Solo el director conoc√≠a la contrase√±a de la tienda, y muri√≥</a></li>
<li><a href="../438792/index.html">Uso de AccelStor All Flash Arrays en proyectos VDI</a></li>
<li><a href="../438794/index.html">Detalles del objeto JavaScript</a></li>
<li><a href="../438796/index.html">Aprendizaje Docker Parte 1: Los fundamentos</a></li>
<li><a href="../438800/index.html">PHP Pear pirateado y no disponible</a></li>
<li><a href="../438802/index.html">Programas de verano para 2019 para ense√±ar a adolescentes a programar en el extranjero</a></li>
<li><a href="../438804/index.html">Esperando a todos en la pr√≥xima reuni√≥n de CocoaHeads</a></li>
<li><a href="../438806/index.html">Problemas de traducci√≥n literaria.</a></li>
<li><a href="../438808/index.html">ModelMapper: ida y vuelta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>