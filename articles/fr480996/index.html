<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§  âœŠğŸ¿ ğŸ“» Notes de Pentester: Ã©tuis de chasse - 2 ğŸ‘©ğŸ¼â€ğŸ’¼ ğŸ‘¹ ğŸ¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous continuons la conversation pour des cas intÃ©ressants dans le travail des pentesters. Dans le dernier article, nous avons parlÃ© des tests de pÃ©nÃ©t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notes de Pentester: Ã©tuis de chasse - 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/480996/"><img src="https://habrastorage.org/webt/vr/xh/gw/vrxhgwizzyqzqg0cr2e2qarsfqi.png"><br><br>  Nous continuons la conversation pour des cas intÃ©ressants dans le travail des pentesters.  Dans le dernier <a href="https://habr.com/ru/company/solarsecurity/blog/463971/">article,</a> nous avons parlÃ© des tests de pÃ©nÃ©tration externe, nous parlerons aujourd'hui des pentests internes les plus intÃ©ressants que nous avons mis en Å“uvre rÃ©cemment.  Leur essence est que nous devrions, Ã©tant dans le pÃ©rimÃ¨tre interne du client, recevoir le maximum de privilÃ¨ges dans le domaine et accÃ©der Ã  toutes les donnÃ©es importantes.  C'est arrivÃ© Ã  Ãªtre surpris.  Mais tout d'abord. <br><a name="habracut"></a><br><h2>  Cas 1. Le gestionnaire de mots de passe est bon, mais ils doivent pouvoir utiliser </h2><br>  Nous avons effectuÃ© des tests de pÃ©nÃ©tration interne pour un gros client qui avait dÃ©jÃ  des administrateurs systÃ¨me formÃ©s et un service SI.  Au cours du travail, nous avons reÃ§u plusieurs comptes avec lesquels nous pouvions dÃ©jÃ  aller sur le rÃ©seau et nous connecter aux machines des autres utilisateurs.  Ã€ un moment donnÃ©, ils se sont installÃ©s dans la voiture de l'un des administrateurs systÃ¨me et y ont trouvÃ© un eldorado.  L'administrateur systÃ¨me a utilisÃ© des mots de passe vraiment complexes (il serait difficile d'en trouver) et les a mÃªme stockÃ©s dans keepass.  Mais voici la malchance: le gestionnaire de mots de passe lui-mÃªme n'a jamais Ã©tÃ© bloquÃ© - pas aprÃ¨s 15 minutes, ou au moment du verrouillage de l'Ã©cran.  Avec ce bonus, nous avons obtenu des droits administratifs sur les systÃ¨mes clients critiques sans bruit ni poussiÃ¨re. <br><br>  Un autre client avait un cas similaire.  Mots de passe aussi compliquÃ©s, aussi keepass, bien qu'il y ait toujours un verrouillage automatique aprÃ¨s 15 minutes.  Comment pourrions-nous l'utiliser?  Ils ont attendu que l'administrateur verrouille le bureau et soit parti (pour le dÃ©jeuner?).  Puis ce fut une petite affaire. <br><br>  Si vous utilisez des gestionnaires de mots de passe, utilisez-les judicieusement - activez l'option de verrouillage avec un Ã©cran de verrouillage et en l'absence d'activitÃ© pendant 1 Ã  5 minutes. <br><br><h2>  Cas 2. EmployÃ©s licenciÃ©s </h2><br>  TrÃ¨s souvent, lors des pentests internes, nous y accÃ©dons en sÃ©lectionnant des mots de passe - les utilisateurs sont gÃ©nÃ©ralement trop paresseux pour trouver des combinaisons complexes, en particulier lorsque la politique de mot de passe nÃ©cessite de les mettre Ã  jour tous les mois.  Souvent, les chiffres changent simplement - ainsi, superpassword_03.2019 un mois plus tard se transforme en superpassword_04.2019 et plus bas dans la liste. <br><br>  Mais parfois, les clients semblent tout Ã  fait Ã  l'improviste.  Ainsi, en menant une attaque par pulvÃ©risation de mots de passe dans l'une des sociÃ©tÃ©s, nous avons obtenu un certain nombre de comptes et l'un d'eux Ã©tait particuliÃ¨rement intÃ©ressant pour nous: elle avait des droits assez larges, mais pas des droits d'administrateur.  Un mot de passe facile a Ã©tÃ© dÃ©fini pour elle (qaz12345), et les commentaires sur cette entrÃ©e dans AD indiquent que l'employÃ© a Ã©tÃ© licenciÃ© - Ã  en juger par la date, il y a presque un an.  Autrement dit, aprÃ¨s le licenciement, le compte n'a pas Ã©tÃ© bloquÃ©, mais il suffit de rÃ©initialiser le mot de passe Ã  Â«par dÃ©fautÂ» et de dÃ©finir l'option Â«changer le mot de passe lors de la premiÃ¨re connexionÂ».  Pour le bonheur du client, nous avons Ã©tÃ© les premiers invitÃ©s Ã  le faire. <br><br><h2>  Cas 3. Des correctifs?  Non, non </h2><br>  La partie la plus difficile du pentest interne est d'obtenir le premier compte.  Il existe de nombreux outils et moyens de le faire, Ã  commencer par un dÃ©filÃ© de mode d'espionnage au bureau Ã  la recherche d'autocollants chÃ©ris avec des mots de passe et d'attraper les affligÃ©s avec une connexion Wi-Fi de bureau clonÃ©e, se terminant par des attaques sur Kerberos et le piratage de mots de passe de comptes.  Mais parfois, mÃªme avec l'analyse initiale, vous pouvez trouver un logiciel que personne n'a mis Ã  jour depuis dix mille ans (pourquoi s'embÃªter Ã  mettre Ã  jour le logiciel dans l'infrastructure interne?). <br><br>  Dans un de ces projets, ils sont tombÃ©s sur le logiciel de gestion de HP, dans lequel RCE a Ã©tÃ© trouvÃ© sans authentification - ils en ont obtenu une partie des comptes. <br><br>  Â¯ \ _ (ãƒ„) _ / Â¯ <br><br>  Il semblait que tout serait encore plus simple - Mimikatz, et la chose est dans le chapeau, mais il s'est avÃ©rÃ© que les comptes reÃ§us ne possÃ©daient pas les privilÃ¨ges dont nous avions besoin.  Comme ils le disent, notre force rÃ©side dans la prÃ©paration au cloud: en utilisant la magie de nmap et le script smb-enum-share, nous avons dÃ©couvert que l'un des comptes avait des droits d'administrateur local sur le serveur de test, auquel les administrateurs de domaine Ã©taient activement impliquÃ©s Ã  ce moment =). <br><br><h2>  Cas 4. Serrures </h2><br>  Enfin, parlons un peu du blocage possible de l'accÃ¨s.  Travaux sur la "vnutryanka" que nous rÃ©alisons le plus souvent Ã  distance.  Le schÃ©ma ressemble Ã  ceci: nous nous connectons au VPN, nous obtenons l'adresse interne, puis nous nous accrochons Ã  la machine allouÃ©e pour nous via RDP.  Et avec cette machine, nous commenÃ§ons dÃ©jÃ  Ã  effectuer des travaux, mais pour cela, nous devons en quelque sorte transporter nos outils.  Beaucoup de nos clients utilisent des serveurs proxy avec des listes blanches de sites, parfois mÃªme avec des listes blanches de ports, pour accÃ©der Ã  Internet (par exemple, vous pouvez vous connecter Ã  un site Web avec le port 80, mais vous ne pouvez plus vous connecter au 8081).  Cela rend vraiment le travail un peu plus difficile, surtout si le copier-coller via RDP est interdit. <br><br>  Mais oÃ¹ dans nos affaires sans nuances.  Un client avait des rÃ¨gles trÃ¨s strictes et nous n'Ã©tions pas autorisÃ©s Ã  remplir nos outils de maniÃ¨re officielle, pour ainsi dire, ils ont empÃªchÃ© la pÃ©nÃ©tration par Â«l'entrÃ©e principaleÂ».  Comme, voici une machine virtuelle et des droits minimaux pour vous - souffrez comme de vrais pirates. <br><br>  Je n'ai pas eu Ã  souffrir longtemps.  Le proxy a vraiment beaucoup bloquÃ©, il n'Ã©tait mÃªme pas possible de se connecter simplement Ã  son serveur http (il n'est pas dans les listes blanches), le copier-coller Ã©tait interdit, le navigateur refusait d'aller n'importe oÃ¹ sauf http (80 / tcp) et https (443 / tcp), et ailleurs que sur des portails internes.  Nous avons essayÃ© wget via powershell - cela ne fonctionne pas non plus, il ne va pas sans proxy, et les proxy interdisent.  Mais l'utilitaire FTP intÃ©grÃ© de Windows a bien fonctionnÃ© - il n'y avait pas de rÃ¨gles sur le pare-feu qui bloqueraient un tel trafic.  Nous avons donc traÃ®nÃ© tous nos outils Ã  l'intÃ©rieur du pÃ©rimÃ¨tre et avons pu faire un excellent travail. <br><br><h2>  En fin de compte </h2><br>  Je vais rÃ©pÃ©ter les recommandations de la partie prÃ©cÃ©dente, car la rÃ©pÃ©tition est la mÃ¨re des enseignements du <s>bÃ©gaiement</s> .  Effectuez des tests de pÃ©nÃ©tration pÃ©riodiques - ils vous aideront Ã  trouver des endroits dÃ©licats dans votre dÃ©fense, comme, par exemple, dans le cas 3. Vous pouvez considÃ©rer qu'il n'est pas nÃ©cessaire de patcher les systÃ¨mes dans le pÃ©rimÃ¨tre interne, mais cela entraÃ®ne parfois de graves consÃ©quences. <br><br>  Construisez un systÃ¨me de gestion des correctifs - Ã©liminez non seulement les vulnÃ©rabilitÃ©s Â«de haut niveauÂ» (comme EternalBlue ou BlueKeep), mais aussi moins connues, mais non moins dangereuses dans le cas de leur fonctionnement (comme c'est le cas avec HP AM).  Bref, gardez une trace de tous vos systÃ¨mes. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480996/">https://habr.com/ru/post/fr480996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480982/index.html">3. Mise en route de Fortinet v6.0. PrÃ©paration de la mise en page</a></li>
<li><a href="../fr480984/index.html">Ã‰viter les erreurs de sÃ©curitÃ© rÃ©seau courantes</a></li>
<li><a href="../fr480986/index.html">LEGO Education WeDo 2.0 et Scratch - un nouvel ensemble pour enseigner la robotique aux enfants</a></li>
<li><a href="../fr480990/index.html">Digest rÃ©tro: 30 ressources intÃ©ressantes sur la technologie et les jeux des derniÃ¨res annÃ©es</a></li>
<li><a href="../fr480992/index.html">A propos du mÃ©tier de chef de produit: comment atteindre l'idÃ©al? (partie 2)</a></li>
<li><a href="../fr480998/index.html">MERCH! MERCH! MERCH! et ... les licornes</a></li>
<li><a href="../fr481000/index.html">Informatique sans serveur basÃ©e sur OpenWhisk, partie 4</a></li>
<li><a href="../fr481004/index.html">Java Digest du 18 dÃ©cembre</a></li>
<li><a href="../fr481010/index.html">16 conseils de dÃ©veloppement pour Android dans Kotlin. 3e partie</a></li>
<li><a href="../fr481012/index.html">Ce que j'ai appris en 10 ans sur Stack Overflow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>