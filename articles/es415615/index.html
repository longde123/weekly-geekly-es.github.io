<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêº ü§ó üï∞Ô∏è Interacci√≥n con el servidor a trav√©s de la API en iOS en Swift 3. Parte 2 üé¥ üôèüèæ ‚ôèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es una continuaci√≥n del art√≠culo Interactuar con el servidor a trav√©s de una API en iOS en Swift 3. Parte 1 y actualizar un art√≠culo ant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interacci√≥n con el servidor a trav√©s de la API en iOS en Swift 3. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415615/">  Este art√≠culo es una continuaci√≥n del art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interactuar con el servidor a trav√©s de una API en iOS en Swift 3. Parte 1</a> y actualizar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo antiguo</a> escrito en Objective-C en swift 3. <br><br><h2>  Breve teor√≠a </h2><br><h3>  OBTENER solicitud </h3><br>  GET es el m√©todo de solicitud HTTP m√°s simple, y es lo que usa el navegador para cargar p√°ginas web.  Se utiliza para solicitar contenido ubicado en una URL espec√≠fica.  El contenido puede ser, por ejemplo, una p√°gina web, una imagen o un archivo de audio.  Por convenci√≥n, las solicitudes GET son de solo lectura y, de acuerdo con el est√°ndar W3C, no deben usarse en operaciones que cambien el lado del servidor.  Por ejemplo, no usaremos una solicitud GET para enviar un formulario o una foto, porque estas operaciones requieren algunos cambios en el lado del servidor (usaremos POST en estos casos). <br><br><h3>  Solicitud POST </h3><br>  POST env√≠a datos para su posterior procesamiento a la URL.  Los par√°metros se incluyen en el cuerpo de la solicitud con el mismo formato que GET.  Por ejemplo, si queremos publicar un formulario que contenga dos campos, un nombre y una edad, enviaremos algo similar a name = Martin &amp; age = 29 en el cuerpo de la solicitud. <br><br>  Este m√©todo de env√≠o de par√°metros es ampliamente utilizado en p√°ginas web.  Los casos m√°s populares son las formas.  Cuando completemos el formulario en el sitio y haga clic en Enviar, lo m√°s probable es que la solicitud sea POST. <br><a name="habracut"></a><br>  En nuestra aplicaci√≥n, usamos POST para clasificar los chistes.  Enviaremos votos (o +1, o -1) al servidor remoto. <br><br>  Los datos de solicitud POST pueden estructurarse utilizando diferentes formatos.  Los par√°metros generalmente se formatean de acuerdo con los est√°ndares de codificaci√≥n form-url (de acuerdo con el est√°ndar HTML W3C).  Este es el formato predeterminado y se usa ampliamente en muchos navegadores.  Nuestro m√©todo acepta el diccionario Diccionario como argumento, pero no podemos enviar el diccionario Diccionario a trav√©s de la conexi√≥n HTTP porque es un tipo Swift interno.  Para reenviar una conexi√≥n HTTP, necesitamos crear una representaci√≥n reconocible del diccionario.  Es como comunicarse con un extranjero.  Traducimos nuestro mensaje a un idioma universal, y se traduce de un idioma universal a su idioma nativo.  El lenguaje universal en HTTP es el est√°ndar W3C, nuestro idioma es Swift, el idioma del destinatario es desconocido para nosotros. <br><br>  El est√°ndar W3C define reglas que definen lo que significa una representaci√≥n reconocible para cada caso.  En nuestro caso, necesitamos presentar los par√°metros siguiendo la parte del est√°ndar codificada en formato url (por ejemplo, param1 = var1 &amp; param2 = var2). <br><br><h3>  Webview </h3><br>  Usando herramientas de lenguaje de programaci√≥n, podemos enviar solicitudes a un servidor remoto.  Esto es lo que hacen los navegadores antes de mostrar una p√°gina web.  La diferencia est√° solo en el contenido de la respuesta.  Las p√°ginas web est√°n formateadas utilizando el est√°ndar HTML, que define un conjunto de reglas sobre c√≥mo definir gr√°ficamente varias etiquetas de marcado.  Estas reglas parecen simples, pero mostrar una p√°gina completa siguiendo el est√°ndar W3C es una tarea dif√≠cil.  Afortunadamente, iOS tiene un componente UIWebView incorporado que utiliza el conocido motor WebKit e interpreta HTML / CSS / JavaScript y muestra p√°ginas web completas dentro de una UIView. <br><br>  Hay varios casos en los que queremos controlar el flujo de navegaci√≥n.  Por ejemplo, queremos saber cu√°ndo se carga cierto contenido o una URL espec√≠fica. <br><br>  O tal vez estamos implementando un navegador seguro para ni√±os, queremos impedir que el usuario cargue p√°ginas que caen bajo ciertos criterios, como sexo o drogas.  Para todos estos tipos de personalizaci√≥n, creamos una instancia de una clase que implementa el protocolo UIWebViewDelegate como un delegado UIWebView.  Podemos implementar los siguientes m√©todos: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">webView</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:shouldStartLoadWithRequest</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:navigationType</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webViewDidStartLoad</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webViewDidFinishLoad</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webView</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:didFailLoadWithError</span></span>:</code> </pre> <br>  Usando el primer m√©todo, podemos controlar el flujo de navegaci√≥n al permitir o bloquear solicitudes espec√≠ficas.  Los otros tres m√©todos son eventos informativos (los nombres de los m√©todos dan una buena idea del evento). <br><br><h2>  Implementaci√≥n de votaci√≥n por solicitud POST </h2><br>  <b>Agregaremos los archivos</b> <b>MainViewController.swift</b> y <b>HTTPCommunication.swift</b> , y crearemos un nuevo archivo <b>WebViewController.swift</b> en el que definiremos nuestro webView. <br><br>  Primero, cree un nuevo archivo WebViewController.swift y defina la clase WebViewController en √©l: <br><br>  <b>WebViewController.swift</b> <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController { } extension WebViewController { }</span></span></span></span></code> </pre> <br>  Ahora implementamos la funcionalidad para realizar solicitudes POST en la clase responsable de todas nuestras operaciones HTTP: la clase HTTPCommunication.  Para hacer esto, agregue un nuevo m√©todo postURL (_: params: completeHandler :) en HTTPCommunication.swift, que es similar al m√©todo anterior retrieveURL (_: completarHandler :). <br><br>  <b>HTTPCommunication.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPCommunication</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrieveURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url: URL, completionHandler: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(Data)</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)) { ‚Ä¶ } <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    } // end of class HTTPCommunication</span></span></code> </pre><br>  C√≥digo de m√©todo <br><br><pre> <code class="hljs powershell">func postURL(_ url: URL, params: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">Int</span></span></span><span class="hljs-function">], </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completionHandler</span></span></span></span>: @escaping ((<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>) -&gt; Void)) { // (K.<span class="hljs-number"><span class="hljs-number">1</span></span>) self.completionHandler = completionHandler // (K.<span class="hljs-number"><span class="hljs-number">2</span></span>) func postBody(params: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">Int</span></span></span><span class="hljs-function">]) -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">Data</span></span></span></span>? { // (K.<span class="hljs-number"><span class="hljs-number">3</span></span>) var paramsArr: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">] = [] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (key, value) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params { paramsArr.append(<span class="hljs-string"><span class="hljs-string">"\(key)=\(value)"</span></span>) } let postBodyString: String = paramsArr.joined(separator: <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>) let postBodyData: <span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>? = postBodyString.data(using: .utf8) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> postBodyData } var request: URLRequest = URLRequest(url: url) // (K.<span class="hljs-number"><span class="hljs-number">4</span></span>) request.httpMethod = <span class="hljs-string"><span class="hljs-string">"POST"</span></span> request.httpBody = postBody(params: params) let session: URLSession = URLSession(configuration: .default, delegate: self, delegateQueue: nil) // (K.<span class="hljs-number"><span class="hljs-number">5</span></span>) let task: URLSessionDownloadTask = session.downloadTask(with: request) task.resume() }</code> </pre> <br>  (K.1) Con el cierre, trabajaremos fuera de esta funci√≥n, por lo tanto, lo denotamos por @escaping. <br>  (K.2) Almacenamos el cierre aprobado en la propiedad completeHandler. <br>  (K.3) Escribimos un m√©todo que convierte el diccionario de par√°metros pasados ‚Äã‚Äãen forma de cadena y luego codifica esta cadena en Tipo de datos en codificaci√≥n utf8. <br>  (K.4) Creamos una solicitud con la url pasada y la configuramos: establecemos POST como m√©todo y hacemos nuestros par√°metros del tipo de datos con utf8 como cuerpo de solicitud. <br>  (K.5) Finalmente, cree una sesi√≥n con una configuraci√≥n predeterminada y un delegado como nosotros mismos.  Y creamos una tarea para cargar el resultado de esta solicitud en el almacenamiento temporal.  Al final, descongela la tarea. <br><br>  Ahora agreguemos la interfaz necesaria a MainViewController.swift.  Agregue dos botones para votar voteUp y voteDown, que aumentar√°n o disminuir√°n respectivamente la calificaci√≥n del chiste actual.  Tambi√©n agregamos el bot√≥n "Chuck Who?", Que llenaremos con funcionalidad en la secci√≥n de vista web. <br><br>  En MainViewController.swift, inserte el c√≥digo de inicializaci√≥n voteUpButton, voteDownButton y chuckWhoButton. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jokeLabel: <span class="hljs-type"><span class="hljs-type">UILabel!</span></span> = ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jokeID: <span class="hljs-type"><span class="hljs-type">Int!</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activityView: <span class="hljs-type"><span class="hljs-type">UIActivityIndicatorView!</span></span> = ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    lazy var stackView: UIStackView! = ‚Ä¶</span></span></code> </pre><br>  C√≥digo de inicializaci√≥n del bot√≥n <br><pre> <code class="hljs pgsql">lazy var voteUpButton: UIButton! = { // (L<span class="hljs-number"><span class="hljs-number">.1</span></span>) let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) // (L<span class="hljs-number"><span class="hljs-number">.2</span></span>) button.setTitle("Vote Up", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.voteUp), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) // (L<span class="hljs-number"><span class="hljs-number">.3</span></span>) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) // (L<span class="hljs-number"><span class="hljs-number">.4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button // (L<span class="hljs-number"><span class="hljs-number">.5</span></span>) }() lazy var voteDownButton: UIButton! = { let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) button.setTitle("Vote Down", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.voteDown), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button }() lazy var chuckWhoButton: UIButton! = { let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) button.setTitle("Chuck Who?", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.chuckWho), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button }()</code> </pre> <br>  El c√≥digo de inicializaci√≥n para los tres botones es el mismo. <br><br>  (L.1) Declaramos una variable perezosa y la inicializamos con un cierre. <br>  (L.2) Dentro del cierre, definimos una variable local para el bot√≥n, un tipo de sistema, especificamos el nombre y el tama√±o. <br>  (L.3) Asociamos con el bot√≥n la acci√≥n correspondiente cuando se presiona. <br>  (L.4) Agregar a la jerarqu√≠a de vistas. <br>  (L.5) Y asignamos esta variable local a nuestra variable perezosa. <br><br>  A continuaci√≥n, en MainViewController.swift, inserte el c√≥digo del m√©todo para los botones <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrieveRandomJokes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ‚Ä¶ } <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    } // end of class MainViewController</span></span></code> </pre><br>  C√≥digo de m√©todo para botones <br><pre> <code class="hljs powershell">func voteUp() { let http: HTTPCommunication = HTTPCommunication() // (M.<span class="hljs-number"><span class="hljs-number">1</span></span>) let params: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] = [<span class="hljs-string"><span class="hljs-string">"joke_id"</span></span>: <span class="hljs-type"><span class="hljs-type">self.jokeID</span></span>, <span class="hljs-string"><span class="hljs-string">"vote"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>] // (M.<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = URL(string: <span class="hljs-string"><span class="hljs-string">"http://example.com/rater/vote"</span></span>) { // (M.<span class="hljs-number"><span class="hljs-number">3</span></span>) http.postURL(url, params: params) { (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> // (M.<span class="hljs-number"><span class="hljs-number">4</span></span>) print(<span class="hljs-string"><span class="hljs-string">"\(data). Voted Up"</span></span>) } } } func voteDown() { let http: HTTPCommunication = HTTPCommunication() let params: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] = [<span class="hljs-string"><span class="hljs-string">"joke_id"</span></span>: <span class="hljs-type"><span class="hljs-type">self.jokeID</span></span>, <span class="hljs-string"><span class="hljs-string">"vote"</span></span>: -<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = URL(string: <span class="hljs-string"><span class="hljs-string">"http://example.com/rater/vote"</span></span>) { http.postURL(url, params: params) { (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(<span class="hljs-string"><span class="hljs-string">"\(data). Voted Down"</span></span>) } } } func chuckWho() { }</code> </pre> <br>  El c√≥digo de los m√©todos para votar arriba y abajo es el mismo. <br><br>  (M.1) Cree un objeto de clase para la comunicaci√≥n con el servidor. <br>  (M.2) Creamos un diccionario de par√°metros que incluye la identificaci√≥n del chiste por el que votamos, y el valor real del voto es +1 o -1. <br>  (M.3) A continuaci√≥n, obtenemos de manera segura la URL de la barra de direcciones de nuestro dominio de capacitaci√≥n <code>http://example.com/rater/vote.</code> <br>  (M.4) Y enviamos a trav√©s de POST una solicitud de URL de nuestros par√°metros.  E imprima en la consola una l√≠nea que indique la finalizaci√≥n de la solicitud. <br><br>  A continuaci√≥n, en MainViewController.swift reescribimos el c√≥digo del m√©todo configStackView, teniendo en cuenta los cambios realizados en la interfaz de usuario. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs powershell">func configStackView() -&gt; UIStackView { let innerStackView: UIStackView = UIStackView(arrangedSubviews: [<span class="hljs-type"><span class="hljs-type">self.voteUpButton</span></span>, <span class="hljs-type"><span class="hljs-type">self.voteDownButton</span></span>]) // (N.<span class="hljs-number"><span class="hljs-number">1</span></span>) innerStackView.axis = .horizontal // (N.<span class="hljs-number"><span class="hljs-number">2</span></span>) innerStackView.distribution = .fillEqually let mainStackView: UIStackView = UIStackView(arrangedSubviews: [<span class="hljs-type"><span class="hljs-type">self.jokeLabel</span></span>, <span class="hljs-type"><span class="hljs-type">innerStackView</span></span>, <span class="hljs-type"><span class="hljs-type">self.chuckWhoButton</span></span>]) // (N.<span class="hljs-number"><span class="hljs-number">3</span></span>) mainStackView.spacing = <span class="hljs-number"><span class="hljs-number">50</span></span> // (N.<span class="hljs-number"><span class="hljs-number">4</span></span>) mainStackView.axis = .vertical mainStackView.distribution = .fillEqually self.view.addSubview(mainStackView) // (N.<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mainStackView }</code> </pre> <br>  (N.1) Cree un innerStackView que contenga dos botones para votar. <br>  (N.2) Exponemos el eje vertical;  La distribuci√≥n es la misma. <br>  (N.3) En mainStackView principal, agregue innerStackView y el bot√≥n sobre Chuck Norris a la etiqueta de la √∫ltima parte. <br>  (N.4) Configure mainStackView. <br>  (N.5) Agregue mainStackView a la jerarqu√≠a de vistas. <br><br>  Lanzamos nuestra aplicaci√≥n y vemos la interfaz como en la Fig.  1 <br><br><img src="https://habrastorage.org/webt/wj/nv/ur/wjnvurcfmrxazb2lhifxl689zqa.png"><br>  <i>Fig. 1 La interfaz de nuestra aplicaci√≥n con botones adicionales para votar</i> <br><br>  Verificamos que al votar a favor o en contra de una broma, se muestran los siguientes mensajes en la consola: <br><br> <code>345 bytes. Voted Up</code> <br> <br>  o <br><br> <code>345 bytes. Voted Down</code> <br> <br>  que indica una solicitud POST completada con √©xito al servidor. <br><br>  Escribimos una aplicaci√≥n de broma usando icndb API y GET HTTP verb.  Pudimos mostrar estos chistes en UIView y todos los chistes se pueden apreciar.  Estas acciones env√≠an una solicitud POST al servidor remoto, lo que deber√≠a guardar nuestra estimaci√≥n. <br><br><h2>  Usar webViews para mostrar p√°ginas web </h2><br>  Agregaremos una vista web para mostrar la p√°gina de Wikipedia sobre Chuck Norris.  Ella se confunde con solo tocar un bot√≥n. <br><br>  En el archivo WebViewController.swift, escriba el siguiente c√≥digo auxiliar de funci√≥n: <br><br>  <b>WebViewController.swift</b> <br><br><pre> <code class="hljs haskell"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit class WebViewController: UIViewController { lazy var webView: UIWebView = { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.1) self.configWebView() }() lazy var toolbar: UIToolbar = { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.2) self.configToolbar() }() override func viewDidLoad() { super.viewDidLoad() } func back() { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.3) self.webView.goBack() } func forward() { self.webView.goForward() } } extension WebViewController { func configWebView() -&gt; UIWebView { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.4) } func configToolbar() -&gt; UIToolbar { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.5) } func configConstraints() { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.6) } }</code> </pre> <br>  (O.1) Creamos variables perezosas para webView <br>  (O.2) y barra de herramientas. <br>  (O.3) Creamos m√©todos de ida y vuelta, para la navegaci√≥n en el historial de visitas de enlaces. <br>  (O.4) Agregamos m√©todos de inicializaci√≥n de webView a la extensi√≥n <br>  (O.5) y barra de herramientas <br>  (O.6) y restricciones para la interfaz. <br><br>  Ahora pintamos el c√≥digo de cada funci√≥n: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configWebView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> webView: <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> = <span class="hljs-type"><span class="hljs-type">UIWebView</span></span>() <span class="hljs-comment"><span class="hljs-comment">// (P.1) self.view.addSubview(webView) return webView }</span></span></code> </pre> <br>  (P.1) Inicializamos webView y agregamos la vista a la jerarqu√≠a. <br><br><pre> <code class="hljs smalltalk">func configToolbar() -&gt; <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span> { let toolbar: <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span> = <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span>(frame: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>.zero) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>) let backButton: <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-comment"><span class="hljs-comment">"&lt;"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: <span class="hljs-symbol"><span class="hljs-symbol">#selector</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.back)) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>) let forwardButton: <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-comment"><span class="hljs-comment">"&gt;"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: <span class="hljs-symbol"><span class="hljs-symbol">#selector</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.forward)) toolbar.setItems([backButton, forwardButton], animated: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>) toolbar.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.lightGray // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(toolbar) return toolbar }</code> </pre> <br>  (P.1) Cree una barra de herramientas con un marco cero. <br>  (P.2) Creamos dos botones para navegar por el historial de enlaces de visita.  Con los nombres "&lt;" y "&gt;" y acciones asociadas al m√©todo correspondiente en webView. <br>  (Q.3) Agregue estos botones a la barra de herramientas. <br>  (P.4) Establezca el color de fondo, como la barra de navegaci√≥n, gris claro.  Y agregue la vista a la jerarqu√≠a. <br><br><pre> <code class="hljs powershell">func configConstraints() { self.webView.translatesAutoresizingMaskIntoConstraints = false // (R.<span class="hljs-number"><span class="hljs-number">1</span></span>) NSLayoutConstraint.activate([ // (<span class="hljs-type"><span class="hljs-type">R.2</span></span>) <span class="hljs-type"><span class="hljs-type">self.webView.topAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.topLayoutGuide.topAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.leadingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.leadingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.trailingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.trailingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.bottomAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.toolbar.topAnchor</span></span>) ]) self.toolbar.translatesAutoresizingMaskIntoConstraints = false NSLayoutConstraint.activate([ // (<span class="hljs-type"><span class="hljs-type">R.3</span></span>) <span class="hljs-type"><span class="hljs-type">self.toolbar.leadingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.leadingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.trailingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.trailingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.bottomAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.bottomAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.heightAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalToConstant</span></span>: <span class="hljs-number"><span class="hljs-number">44.0</span></span>) ]) }</code> </pre> <br>  (R.1) Deshabilite las m√°scaras de tama√±o autom√°tico para que no entren en conflicto con nuestras restricciones <br>  (R.2) Para webView, configure los cuatro lados de la vista. <br>  (R.3) Para la barra de herramientas, configure tres lados de la vista, excepto la parte superior, pero establezca adicionalmente la altura en el tama√±o est√°ndar 44.0. <br><br>  Y reescriba el c√≥digo ViewDidLoad () de la siguiente manera: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.configConstraints() <span class="hljs-comment"><span class="hljs-comment">// (S.1) if let url = URL(string: "http://en.wikipedia.org/wiki/Chuck_Norris") { // (S.2) let request: URLRequest = URLRequest(url: url) // (S.3) self.webView.loadRequest(request) // (S.4) } }</span></span></code> </pre> <br>  (S.1) Invoque el establecimiento de restricciones. <br>  (S.2) Obtenga de forma segura la URL de la barra de direcciones de la p√°gina de Wikipedia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en.wikipedia.org/wiki/Chuck_Norris</a> <br>  (S.3) Creamos solicitud de url. <br>  (S.4) Y ejecutamos la solicitud dada en webView. <br><br>  Regresamos al MainViewController y lo llenamos con el m√©todo de llamar a informaci√≥n sobre Chuck Norris. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chuckWho</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController?.show(<span class="hljs-type"><span class="hljs-type">WebViewController</span></span>(), sender: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-comment"><span class="hljs-comment">// (T.1) }</span></span></code> </pre> <br>  (T.1) Cuando haga clic en este bot√≥n en la pila de NavigationController, coloque una nueva instancia de webView. <br><br>  Fig.  2 demuestra c√≥mo se ve webView en nuestra aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/cj/tv/-a/cjtv-a57shzmktsq3btfccu6hme.png"><br>  <i>Fig.</i>  <i>2. La vista final de la webView que hemos implementado</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415615/">https://habr.com/ru/post/es415615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415599/index.html">India tambi√©n quiere obtener helio-3</a></li>
<li><a href="../es415601/index.html">Kubernetes HA cl√∫ster con contenedor. ¬øO hay vida sin estibador?</a></li>
<li><a href="../es415605/index.html">C√≥mo ahorramos el procesamiento de la tarjeta con Exadata</a></li>
<li><a href="../es415611/index.html">PKI: bibliotecas GCrypt y KSBA como alternativa a OpenSSL con soporte para criptograf√≠a rusa. Continuaci√≥n</a></li>
<li><a href="../es415613/index.html">¬øPor qu√© no deber√≠as comprar l√°mparas LED?</a></li>
<li><a href="../es415617/index.html">Uso de la biblioteca FPC de InternetPCools en Delphi</a></li>
<li><a href="../es415619/index.html">Apple y Samsung completan guerra de patentes de 7 a√±os</a></li>
<li><a href="../es415621/index.html">Sistema de monitoreo minero</a></li>
<li><a href="../es415623/index.html">La din√°mica del vuelo vertical de un avi√≥n m√°s ligero que el aire.</a></li>
<li><a href="../es415625/index.html">Kubernetes: seminario web (4 de julio a las 19:30) e intensivo (3-5 de agosto)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>