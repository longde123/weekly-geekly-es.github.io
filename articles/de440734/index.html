<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§® üßòüèø üéπ Open Session In View im Fr√ºhjahr Boot: The Phantom Menace üßîüèª üòø üõÄüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jeder hier hat Recht, jeder auf seine Weise, und deshalb liegt jeder hier falsch. 
 "Die Geschichte der Drei" (A. und B. Strugatsky) 

 Wenn Sie Sprin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Open Session In View im Fr√ºhjahr Boot: The Phantom Menace</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440734/"><blockquote> Jeder hier hat Recht, jeder auf seine Weise, und deshalb liegt jeder hier falsch. <br>  <strong>"Die Geschichte der Drei" (A. und B. Strugatsky)</strong> </blockquote><p>  Wenn Sie Spring Data JPA verwenden, wird nach dem Update auf Spring Boot 2 beim Starten der Anwendung m√∂glicherweise eine neue Warnung im Protokoll angezeigt: </p><br><blockquote>  spring.jpa.open-in-view ist standardm√§√üig aktiviert.  Daher k√∂nnen Datenbankabfragen w√§hrend des Renderns der Ansicht ausgef√ºhrt werden.  Konfigurieren Sie spring.jpa.open-in-view explizit, um diese Warnung zu deaktivieren. </blockquote><p>  In diesem Artikel werde ich versuchen zu erkl√§ren, was es bedeutet, wer schuld ist und was zu tun ist. </p><br><p> Um eine vollwertige Anwendung beim Spring Boot <code>@SpringBootApplication</code> , ist nur eine <code>@SpringBootApplication</code> Annotation <code>@SpringBootApplication</code> .  Um dies zu erm√∂glichen, verwendet das Framework eine gro√üe Anzahl von Autokonfigurationen und Standardeinstellungen.  Dar√ºber hinaus mussten Spring Boot-Entwickler einige Anwendungsentwicklungskonzepte aus mehreren alternativen Optionen ausw√§hlen, damit der Benutzer sie nicht explizit ausw√§hlen musste.  Dies ist einerseits gut f√ºr einen schnellen Start und eine einfache Entwicklung, andererseits kann sich nach einer Weile herausstellen, dass ein Standardkonzept / -paradigma / -einstellung nicht f√ºr das Projekt geeignet ist, und es muss viel Arbeit geleistet werden, um es aufzugeben.  Ein solches Konzept ist der <strong>OSIV-Modus (Open Session In View)</strong> , der standardm√§√üig in Spring Boot enthalten ist. </p><a name="habracut"></a><br><p>  In diesem Modus bleibt die Sitzung im Ruhezustand w√§hrend der gesamten Verarbeitung der HTTP-Anforderung ge√∂ffnet, einschlie√ülich der Phase der Erstellung der Ansicht (JSON-Ressource oder HTML-Seite).  Dies erm√∂glicht es, Daten nach dem Festschreiben einer Transaktion in der Gesch√§ftslogikschicht tr√§ge in die Pr√§sentationsschicht zu laden.  Beispielsweise fordern wir die Artikelentit√§t aus der Datenbank an.  Der Artikel sollte zusammen mit Kommentaren angezeigt werden.  Mit OSIV k√∂nnen Sie beim Rendern von HTML einfach die <code>getComments()</code> aufrufen, und Kommentare werden in einer separaten Anforderung geladen.  Wenn der OSIV-Modus deaktiviert ist, wird eine <code>LazyInitializationException</code> , da die Sitzung bereits geschlossen ist und die <code>LazyInitializationException</code> nicht mehr von Hibernate verwaltet wird.  Die meisten Hibernate-Entwickler haben eine <code>LazyInitializationException</code> .  Mit OSIV k√∂nnen Sie dies vermeiden, indem Sie in jeder Phase der Verarbeitung der HTTP-Anforderung nach Bedarf Daten laden. </p><br><p>  OSIV in Spring Boot wird mithilfe der <code>OpenEntityManagerInViewInterceptor</code> - <code>OpenEntityManagerInViewInterceptor</code> implementiert.  Im Gegensatz zu reinem Fr√ºhling ist es hier standardm√§√üig aktiviert. </p><br><p>  OSIV gilt als Antimuster.  Das Beste ist, dass die sch√§dliche Seite seines Artikels von Vlad Mihalcea, einem der Entwickler von Hibernate: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The Open Session In View Anti-Pattern, erkl√§rt wurde</a> .  Wichtige Punkte: </p><br><ul><li>  Datenbankabfragen ohne Transaktion werden im Auto-Commit-Modus ausgef√ºhrt und stark geladen. </li><li>  Es gibt keine Aufgabentrennung, jede Anwendungsschicht kann SQL-Abfragen generieren, was das Testen schwierig macht. </li><li>  Es gibt ein n + 1-Problem, wenn jede Sammlung, die sich auf eine Entit√§t bezieht, in eine separate Anforderung geladen wird. </li><li>  Lange Verbindungen zur Datenbank erh√∂hen erneut die Belastung und verringern den Durchsatz. </li></ul><br><p>  Dies sind ziemlich unangenehme Probleme des OSIV-Modus und anscheinend starke Argumente daf√ºr, ihn nicht zu verwenden.  Bei der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufforderung, es standardm√§√üig zu deaktivieren</a> , haben die Entwickler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von</a> Spring Boot jedoch auch gute Gr√ºnde angegeben, warum OSIV f√ºr neue Projekte aktiviert werden sollte: </p><br><ul><li>  Abw√§rtskompatibilit√§t.  Bei vorhandenen Anwendungen beim Upgrade auf Spring Boot 2 k√∂nnen aufgrund von deaktiviertem OSIV Fehler und Bugs auftreten.  Um dies zu vermeiden, m√ºssen Sie nur den Einzelwert <code>spring.jpa.open-in-view</code> Dies macht es jedoch auch schwierig, auf die neue Version zu wechseln. </li><li>  Benutzerfreundlichkeit f√ºr Anf√§nger und ein schneller Start sind f√ºr Spring Boot wichtig.  Wenn OSIV deaktiviert ist, ist es f√ºr Anf√§nger m√∂glicherweise nicht klar, warum eine so intuitiv erwartete Sache wie das Empfangen einer Sammlung verwandter Elemente beim Zugriff auf eine Entit√§tsmethode nicht funktioniert.  Stattdessen erh√§lt der Benutzer eine <code>LazyInitializationException</code> , die seinen Pfad zu einer laufenden Anwendung verlangsamt. </li><li>  Mit OSIV k√∂nnen Sie die Einfachheit, Benutzerfreundlichkeit und Entwicklungsgeschwindigkeit von Code erh√∂hen. </li><li>  Es ist schwierig, einfache Beispiele daf√ºr zu finden, wie eine Anwendung ohne OSIV erstellt werden sollte. </li><li>  Ohne OSIV muss die Gesch√§ftslogikschicht wissen, wie die Daten in der Benutzeroberfl√§che dargestellt werden, dh welches DTO ben√∂tigt wird oder welche zugeh√∂rigen Daten zusammen mit der Stammentit√§t geladen werden sollen.  Dies ist wiederum das Fehlen einer Aufteilung der Verantwortung. </li></ul><br><p>  Wir k√∂nnen also zwei Ansichten zu diesem Problem unterscheiden.  Aus Sicht des Datenbankarchitekten (DBA) ist Open Session In View sicherlich nicht akzeptabel, da die Interaktion der Anwendung mit der Datenbank nicht optimal organisiert ist und eine erh√∂hte Last erzeugt.  Wir verwenden jedoch h√§ufig weniger optimale L√∂sungen f√ºr die Geschwindigkeit, die einfache Entwicklung und die einfachen Lernwerkzeuge. Wir schreiben in verwalteten Sprachen, verwenden Textdatenformate f√ºr die Netzwerkinteraktion und so weiter.  Um die Entwicklung und den schnellen Start von Anf√§ngern zu vereinfachen, k√∂nnen Sie mit OSIV die kognitive Belastung und die Anzahl der Konzepte reduzieren, die f√ºr die Entwicklung der Anwendung erforderlich sind.  Wenn sich der Entwickler f√ºr JPA entschied, stimmte er bereits einer Leistungsminderung im Austausch f√ºr die Bequemlichkeit der Entwicklung zu.  JPA hilft dabei, Freunde zum Objekt und zu relationalen Datenmodellen zu machen.  Wenn wir im Objektstil arbeiten, um verwandte Elemente zu erhalten, wenden wir uns einfach der Entit√§tsmethode zu (auch wenn sie sich in der Pr√§sentationsebene befindet). Sie ist einfach, logisch und intuitiv zu erwarten, obwohl diese Einfachheit t√§uscht. </p><br><p>  Es gibt viele Beispiele und Tutorials f√ºr die Arbeit in der offenen Sitzung. Im Ansichtsmodus ist die Architektur insgesamt klar: Die Serviceschicht fordert eine JPA-Entit√§t an, die Pr√§sentationsschicht serialisiert sie direkt in JSON √ºber ein Zwischen-DTO oder verwendet die Daten daraus zum Rendern einer HTML-Seite. </p><br><p>  Weniger klar ist, wie man ohne OSIV arbeitet.  Einer der Spring-Entwickler in der genannten Anfrage beschwert sich dar√ºber, sie schreien viel √ºber das Antimuster, aber es gibt keine einfachen Beispiele daf√ºr, wie man ohne es leben kann.  In dieser Ausf√ºhrungsform k√∂nnen Entit√§ten nur zum Schreiben und Lesen mehrerer DTOs verwendet werden, die f√ºr jeden Datensatz in der Benutzeroberfl√§che getrennt sind und direkt aus der Datenbank zugeordnet werden.  Oder benutzerdefinierte SQL-Abfragen, die den Join der erforderlichen zugeh√∂rigen Sammlungen f√ºr eine bestimmte Webanfrage beschreiben.  Das hei√üt, mehr Boilerplate und eine Beschreibung der Anforderungen der Benutzeroberfl√§che in der Gesch√§ftslogikschicht.  Wenn OSIV deaktiviert ist, beginnt die JPA-Abstraktion zu flie√üen. Die Anwendung beschreibt weitere technische Details der Interaktion mit der Datenbank. </p><br><p>  Somit ist die Entwicklung mit OSIV einfacher.  Das Problem ist jedoch, dass Sie, wenn Sie es in Zukunft aufgeben m√∂chten, viel wiederholen m√ºssen. Das Konzept der Arbeit mit der Datenbank im Projekt durch Festlegen einer Eigenschaft kann nicht ge√§ndert werden.  M√∂glicherweise m√ºssen Sie die gesamte Anwendungsarchitektur wiederholen.  Das Aufgeben von OSIV kann jedoch eine vorzeitige Optimierung sein, die die Entwicklungsgeschwindigkeit verlangsamt, was beispielsweise f√ºr einen Start kritisch sein kann.  Sie k√∂nnen OSIV verwenden und Datenbankabfragen nur an den langsamsten Stellen optimieren.  Beispielsweise leidet das Abfragen von Entit√§tssammlungen am meisten unter dem Problem n + 1, wenn jede Entit√§t mehrere Abfragen aus verwandten Sammlungen abruft. </p><br><p>  Wenn Sie es also richtig machen wollen, m√ºssen Sie ohne OSIV entwickeln.  Wenn jedoch die Entwicklungsgeschwindigkeit und die Einfachheit des Codes wichtig sind, k√∂nnen Sie diesen Modus verwenden, der mit einem gewissen Leistungsverlust verbunden ist. </p><br><p>  Die Hauptsache ist, dass dieses Leistungsproblem nach einigen Jahren nicht zu einer gro√üen technischen Verschuldung wird.  Es ist doppelt gef√§hrlich, wenn die Entwickler nicht vermuten, dass sich diese Schulden in ihnen ansammeln, weil Spring Boot stillschweigend das Konzept von Open Session In View f√ºr sie gew√§hlt hat.  Daher ist es hervorragend, dass aufgrund der oben genannten Anfrage beschlossen wurde, im Protokoll eine Warnung √ºber den verwendeten Modus anzuzeigen, die ich am Anfang des Artikels zitiert habe. </p><br><p>  Ich hoffe, dass die Warnung und dieser Artikel √ºber ihn Entwicklern helfen, eine fundiertere Entscheidung zu treffen - ob das Konzept von Open Session In View in einer Anwendung auf Spring Boot verwendet werden soll.  Ich habe die Hauptargumente daf√ºr und dagegen zitiert und diskutiert, und ich rate auch, die urspr√ºngliche Diskussion zu lesen.  Dieses Problem zeigt, dass eine gro√üe Anzahl von automatischen Konfigurationen und Standardeinstellungen in Spring / Spring Boot f√ºr unaufmerksame Entwickler gef√§hrlich sein kann. </p><br><p>  Verwenden Sie OSIV in Spring Boot-Anwendungen?  Wenn nicht, wie ist die Architektur f√ºr die Interaktion der Pr√§sentationsschicht mit der Datenbank organisiert?  Welche Techniken und / oder Bibliotheken werden daf√ºr verwendet? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440734/">https://habr.com/ru/post/de440734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440722/index.html">Eine kleine √úbung der funktionalen Programmierung in Swift f√ºr Anf√§nger</a></li>
<li><a href="../de440724/index.html">Auswahl: 4 n√ºtzliche Dienste f√ºr potenzielle Einwanderer in die USA, nach Europa und in andere L√§nder</a></li>
<li><a href="../de440726/index.html">Das Spiel der Archetypen: Wie das Geschichtenerz√§hlen f√ºr Tech-Marken funktioniert</a></li>
<li><a href="../de440728/index.html">Mobile Entwicklung: Von der Idee zur Kostensch√§tzung</a></li>
<li><a href="../de440732/index.html">Aktualisieren Sie ein Debug-Board mit einem Baikal-T1-Prozessor: F√ºgen Sie eine SD-Karte hinzu</a></li>
<li><a href="../de440736/index.html">Ich ruiniere das Leben der Entwickler mit meinen Code√ºberpr√ºfungen und es tut mir leid</a></li>
<li><a href="../de440740/index.html">Offenes Webinar ‚ÄûCustomer Journey: Welcher Verkehr und wohin f√ºhren?‚Äú</a></li>
<li><a href="../de440742/index.html">AMP- und Turbo-Seiten: Vor- und Nachteile sowie Implementierungsergebnisse</a></li>
<li><a href="../de440744/index.html">PHP f√ºr Anf√§nger. Fehlerbehandlung</a></li>
<li><a href="../de440746/index.html">Die Wissensmanagement-Technologiezyklen von Gartner werden anhand von Fallstudien bei KnowledgeConf durchgef√ºhrt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>