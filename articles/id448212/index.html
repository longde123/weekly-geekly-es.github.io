<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📋 Ⓜ️ 🤙🏼 Protokol AIBUS Cina dan reaktor kimia laboratorium 🦗 🚊 🐧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salam Habr! Sekali waktu saya menulis artikel tentang rasa reaksi. Banyak waktu berlalu, saya kembali ke pertanyaan ini. 

 Pada artikel ini, saya tid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protokol AIBUS Cina dan reaktor kimia laboratorium</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448212/">  Salam Habr!  Sekali waktu saya menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> tentang rasa reaksi.  Banyak waktu berlalu, saya kembali ke pertanyaan ini. <br><br>  Pada artikel ini, saya tidak akan membahas tentang teknologi untuk mengembangkan rasa reaksi, tetapi akan berbicara tentang pengalaman saya dalam mengotomatisasi jam kerja saya dan berbagi kode yang mungkin berguna.  Saya menemukan reaktor kimia laboratorium buatan China dan, sayangnya, tidak memiliki alat untuk mengotomatisasi pendinginan, membaca dan menulis data, dan mode pemrograman, yang sangat penting.  Reaktor itu sendiri adalah logam kosong biasa pada tripod, dengan pemanas hingga 350 derajat.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengontrol Yudian AI518</a> bertanggung jawab untuk kontrol suhu. <br><br><img src="https://habrastorage.org/webt/ok/r4/as/okr4as_a8vaknn8sdmaaduth2e0.jpeg"><br><a name="habracut"></a><br><br>  Kabar baiknya bagi saya adalah kehadiran port RS-485 di dalamnya. <br><br>  Ya, Yudian AI518 memiliki penghitung waktu dan beberapa program yang sangat sederhana, tetapi pertama-tama, sangat menarik untuk membuat "blackjack" Anda sendiri dengan jendela dan tombol, dan kedua, tidak terlalu nyaman untuk menyodok pada pengontrol biasa, saya ingin itu lakukan di komputer. <br><br>  Karena saya memiliki pengalaman bekerja dengan pengontrol Arduino, saya awalnya memutuskan untuk membuat komunikasi dan kontrol melalui itu, maka saya sudah punya ide untuk menulis sebuah program pada Qt yang akan bertanggung jawab untuk kontrol dan otomatisasi, dan Arduino Mega untuk pembentukan dan dekripsi paket dengan AI518. <br><br>  Karena katup pengaktifan air dingin dapat ditempatkan pada jarak tertentu dari komputer dan pemasangannya sendiri, diputuskan untuk membangun pengontrol tambahan yang akan menghidupkan / mematikan katup air dingin sesuai perintah dan membaca serta mengirim suhu pendinginan.  Ya, pada akhir proyek, saya menyadari bahwa pembangunannya telah menumpuk, akan mungkin untuk menghilangkan peluit RS485 pada komputer dan menggunakan satu program, tetapi ambisi untuk membuat perangkat Anda sendiri memicu minat. <br><br>  Total dalam kelompok kami: <br><br><ol><li>  Pengendali asli Yudian AI518. </li><li>  Konverter Arduino Mega + 2 RS485 (MAX485) </li><li>  Arduino nano + 1 RS485 (MAX485) converter + termokopel + transistor 12V. </li><li>  12V katup air dingin. </li></ol><cut></cut><br>  Pertama-tama, struktur komunikasi antara mega dan nano ditulis. <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_arduino_pomp</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arduino</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nano</span></span></span><span class="hljs-class"> {</span></span> byte start_byte_one;<span class="hljs-comment"><span class="hljs-comment">//    212 byte start_byte_two;//    211 byte temp_pomp;//  byte on_of_pomp;//on-off  (1  0) byte CRC8;//  /**/ void pask() { CRC8 = (start_byte_one + start_byte_two + temp_pomp + on_of_pomp + tmp) / 10; } /* */ bool test_pask() { if (CRC8 == (start_byte_one + start_byte_two + temp_pomp + on_of_pomp + tmp) / 10) return 0; // return 1; //  } };</span></span></code> </pre> <br>  Ketika semuanya berjalan dengan stabil, saya mulai membaca banyak tentang berbagai protokol transfer data, tetapi tidak dapat menemukan yang saya butuhkan.  Faktanya adalah bahwa pengontrol Yudian AI518 standar berkomunikasi dengan dunia luar melalui protokol AIBUS, seperti yang saya pahami itu adalah analog Cina MODBUS.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> ) Saya melakukan ini untuk pertama kalinya dan berfokus pada dokumentasi dan bantuan semua forum yang mungkin. <br><br>  Struktur paket keluar untuk Yudian AI518: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tagREQ_FRM_T</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8DevAddr1; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8DevAddr2; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8ReqType; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8DevPara; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoParam; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiParam; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoSumCheck; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiSumCheck; } ;</code> </pre> <br>  Struktur paket yang masuk untuk Yudian AI518: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tagANS_FRM_T</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoPV; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiPV; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoSV; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiSV; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8MV; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8ALm; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoParam; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiParam; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8LoSumCheck; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> u8HiSumCheck; };</code> </pre> <br>  Bahkan, ternyata paket dari semua perangkat datang ke Mega (dari nano dengan suhu pendingin, dari AI518 dengan suhu reaktor yang diperbarui dan nilai serta perintah lain dari komputer).  Kemudian Mega menyatukan semuanya dalam satu paket dan mengirimkannya ke komputer, tempat program QT membacanya. <br><br>  Struktur paket mega-komputer: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_big</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PC</span></span></span><span class="hljs-class"> {</span></span> byte start_byte_one;<span class="hljs-comment"><span class="hljs-comment">//    254 byte start_byte_two;//    232 byte temp_pomp;//  byte on_of_pomp;//on-off  (1  0) byte ex_temp_reactor_one;//    1 byte ex_temp_reactor_two;//    2 byte current_temp_reactor;//    byte timer_ex;// byte tmp;//   byte CRC8;//   void pask() { CRC8 = (start_byte_one + start_byte_two + temp_pomp + on_of_pomp + ex_temp_reactor_one + ex_temp_reactor_two + current_temp_reactor + timer_ex + tmp) / 10; } /* */ bool test_pask() { if (CRC8 == ((start_byte_one + start_byte_two + temp_pomp + on_of_pomp + ex_temp_reactor_one + ex_temp_reactor_two + current_temp_reactor + timer_ex + tmp)) / 10) return 0; // return 1; //  } };</span></span></code> </pre> <br>  Karena protokol China diam, jika paket yang dikirim tidak sesuai dengan deskripsi, memilih struktur, saya biasanya mulai berpikir bahwa itu rusak, tetapi pada akhirnya semuanya berhasil.  Ketika saya melihat angka yang benar pertama di log, ada kebahagiaan ... <br><br>  Untuk melindungi pengontrol pada Arduino nano dari kelembaban, saya memutuskan untuk mengetsa papan saya sendiri dan memasukkannya ke dalam case.  Ini bukan hal yang rumit, ada banyak deskripsi tentang bagaimana melakukan ini, tetapi saya memilih teknologi LUT.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LUT</a> ).  Yang paling sulit adalah memilih kertas inkjet mengkilap yang cocok, yang biasanya mencetak printer laser.  Tapi setelah semua coba-coba, kami mendapat perangkat seperti itu. <br><br><img src="https://habrastorage.org/webt/wn/jh/nl/wnjhnloq4nhjbnsz9pasaehoh9y.jpeg"><br><br>  Tapi bagaimana dengan program di komputer, dengan tombol dan windows.  Untungnya, hal-hal seperti itu sangat mudah dilakukan pada Qt.  Kami dapat memformulasikan permintaan dan membacanya dari perangkat "Basurman", sekarang kita perlu mengatur mode, membuat grafik suhu-waktu, memberikan pada akhir reaksi laporan tentang laju pemanasan ke suhu yang ditetapkan, waktu reaksi itu sendiri, laju pendinginan hingga suhu tertentu dan dll.  Menggabungkan semua ini ke dalam struktur yang terpisah, menurut QSerialPort, melalui port COM yang terhubung dengan Arduinka, kami mengirimkan dan menerima nilai. <br><br>  Yang paling sulit adalah mengkompilasi proyek yang sudah selesai di bawah Windows XP.  Sayangnya, sistem ini sedang bekerja dan saya harus menari dengan rebana selama beberapa hari untuk membuatnya bekerja.  Karena saya sudah melakukan ini pada hari kedua, saya tidak memberikan instruksi yang tepat tanpa sengaja dan memilah semua opsi yang diusulkan dari forum. <br><br>  Hasilnya adalah sebuah program yang bekerja dan membantu saya di tempat kerja saya dan menghemat banyak waktu (saya tidak akan memposting proyek QT, karena tidak ada yang menarik di sana. Mentransfer data melalui QSerialPort, dan kemudian apa pun yang diinginkan hati Anda). <br><br>  Tautan ke firmware untuk Arduinok: <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk Nano</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untuk Mega</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448212/">https://habr.com/ru/post/id448212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448202/index.html">Kami mengontrol generator atau perang melawan ADC di STM32F030</a></li>
<li><a href="../id448204/index.html">Pulau Bohemian</a></li>
<li><a href="../id448206/index.html">Pengembangan modular atau jalan ke sana, bukan kembali</a></li>
<li><a href="../id448208/index.html">20, 100, 3, 19 - Informasi dalam angka</a></li>
<li><a href="../id448210/index.html">Meriam untuk satelit, blaster dan kapal tenaga surya: proyek yang aneh dan paradoks</a></li>
<li><a href="../id448214/index.html">ES6 Proxy dalam praktiknya</a></li>
<li><a href="../id448216/index.html">Menyiapkan perakitan proyek yang nyaman di Visual Studio</a></li>
<li><a href="../id448218/index.html">Keamanan MFP Baru: imageRUNNER ADVANCE III</a></li>
<li><a href="../id448220/index.html">Dasar-dasar format GLTF dan GLB, bagian 1</a></li>
<li><a href="../id448222/index.html">GPU, akselerator heksagonal, dan aljabar linier</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>