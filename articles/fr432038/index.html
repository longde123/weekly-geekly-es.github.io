<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÜ üë®üèº‚Äçüöí üê∫ Cliquez sur la renomm√©e, ou comment exciter un robot et ... d'autres ü§î üèë üôéüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il √©tait une fois, une conversation clandestine a eu lieu devant une boutique lointaine et lointaine : 


NB: - ?  
 GURU : - ¬´¬ª . .    .   ,  ... 
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cliquez sur la renomm√©e, ou comment exciter un robot et ... d'autres</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432038/"><img src="https://habrastorage.org/webt/px/hq/po/pxhqpot6x9sqphxahh2fzhk4pz8.png"><br><br>  Il √©tait une fois, une conversation clandestine a eu lieu <strike>devant une boutique lointaine et lointaine</strike> : <br><blockquote><pre><code class="plaintext hljs">NB: -         ?</code> </pre> <br> <code><b>GURU</b> : -    ¬´¬ª      . . <b> </b>   <b></b> .  <b> </b> ,         <b></b> ...</code> <br> <br><pre> <code class="plaintext hljs">NB: -      ,     ?</code> </pre> <br> <code><b>GURU</b> : -    <strong>google</strong>   <b>yandex</b>  ,    .    <b></b>       .    ,      .</code> <br> <br><pre> <code class="plaintext hljs">NB: -       ?</code> </pre> <br> <code><b>GURU</b> : - ?‚Ä¶   <strong></strong> ...</code> <br> </blockquote>  <b>NB a</b> cess√© de demander, craignant apparemment d'ennuyer un interlocuteur clairement plus exp√©riment√©. <br>  <b>GURU</b> roula des yeux, comme s'il soulignait l'√©puisement du sujet proxy et se tut ... <br><a name="habracut"></a><br>  Bien s√ªr, <strong>GURU</strong> savait qu'une requ√™te de recherche (par exemple, par le mot: proxy) conduirait tr√®s prochainement <strong>NB</strong> √† obtenir l'adresse souhait√©e: liste des ports.  Mais apr√®s les premi√®res exp√©riences, <strong>NB</strong> , tout aussi rapidement, comprendra: <br><br><ul><li>  Toutes les adresses de sa liste ne fonctionnent pas; </li><li>  Tous les mandataires ne sont pas √©galement bons; </li><li>  ¬´Coller¬ª un site manuellement via un proxy est une t√¢che qui requiert une volont√© consid√©rable; </li><li>  Un ¬´mauvais¬ª mandataire nuira √† la situation, car  le site peut √™tre suspect√© par des scripts de g√©ants dans l'habillage. </li></ul><hr><br>  Dans cet article, je vais parler de la fa√ßon dont improvis√© (et surtout universel) signifie <br>  (sans utiliser de logiciel propri√©taire sp√©cifique, tel que <strong>ZennoPoster</strong> , etc ...) <br>  construire un outil automatis√© pour obtenir une liste de procurations ¬´vraiment adapt√©es¬ª et les utiliser pour organiser des visites (automatis√©es) des promus <br>  site √† l'aide du <strong>navigateur Chrome</strong> . <br><br>  En suivant les instructions, vous obtiendrez un outil pr√™t √† l'emploi qui vous permettra de: <br><br><ul><li>  ¬´Cliquez¬ª sur (visiter) le site cible de mani√®re enti√®rement automatique, sans crainte de compromis; </li><li>  √©muler pleinement le comportement de l'utilisateur; </li><li>  organiser toutes les visites selon un calendrier (sc√©nario); </li><li>  faire tout ce qui pr√©c√®de dans le nombre de fois n√©cessaire pour avancer. </li></ul><br>  Et bien que tout mon travail (ainsi que la recherche) ait pris une semaine, vous n'aurez pas besoin de deux jours pour construire un tel outil, ayant une connaissance de base de la <strong>ligne de commande</strong> , <b>PHP</b> et <b>JavaScript</b> . <br><hr><br>  Cependant, avant de faire d√©filer ci-dessous le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diagramme suivant</a> , je dirai quelques mots sur la raison pour laquelle ce mat√©riel est pr√©par√© et pour qui. <br><br>  Le mat√©riel sera utile si vous voulez comprendre comment les constructions (? Ou constructeurs?) Sont arrang√©es avec lesquelles vous pouvez construire une application relativement rapidement, facilement et sans co√ªt, adaptable aux changements de charge.  Si vous √™tes int√©ress√© par la possibilit√© de construire une application bas√©e sur un bus de service ( <abbr title="Bus de service d'entreprise">ESB</abbr> ). <br><br>  Le texte sera utile si vous souhaitez vous familiariser avec l'utilisation de <strong>Docker</strong> pour les syst√®mes de construction <b>instantan√©e</b> .  Ou si vous √™tes simplement int√©ress√© par <strong>Selenium Server</strong> et les nuances de la r√©ception de contenu / manifestation d'activit√© HTTPx. <br><blockquote>  Pour "utiliser imm√©diatement", lire attentivement tout cela ne vaut pas la peine.  Le code est s√ªr. </blockquote><div class="spoiler">  <b class="spoiler_title">Passez directement √† la configuration de l'outil fini.</b>  <b class="spoiler_title">La configuration prend moins de 20 minutes.</b> <div class="spoiler_text">  Le manuel suppose que vous avez 2 machines √† votre disposition avec Ubuntu 18.04 install√©. <br>  L'un pour l'infrastructure ( <b>docker</b> ), l'autre pour le contr√¥le des <b>processus</b> ( <b>processus</b> ). <br><br>  Il est suppos√© que les packages suivants sont d√©j√† install√©s sur <b>docker</b> : <br><blockquote>  <i>git, docker, docker-compose</i> </blockquote><br>  Il est suppos√© que les packages suivants sont d√©j√† install√©s sur le <b>processus</b> : <br><blockquote>  <i>git, php-common, php-cli, php-curl, php-zip, php-memcached, compositeur</i> </blockquote>  Si vous avez des questions √† ce stade, je vous sugg√®re de passer 15 minutes √† lire l'int√©gralit√© du mat√©riel. <br><br>  <strong>docker</strong> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    root-. # ,     TCP-: # 11300, 11211, 4444, 5930, 8080, 8081, 8082, 8083 #        # " root-"    git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git cd esb-infrastructure docker-compose up --build -d #      3     #   . #       web-.</span></span></code> </pre><br>  <strong>processus</strong> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      . #      process-   , #     -  php- git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/clicker-noserver.git cd clicker-noserver composer update #  .       "XXXXXXXX" mv app/settings.php.dist app/settings.php #   . gnome-terminal \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php curl"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php timezone"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php whoer"' #  . ,     , #  : - log/list.proxy php app/src/Utils/givethejob.php ./log/list.proxy</span></span></code> </pre><br>  Attendez, regardez ce qui se passe via le panneau Web (http: // ip-address-docker-machines: 8080). <br>  Le r√©sultat sera disponible dans la file d'attente <i>localis√©e</i> . <br></div></div><a name="scheme"></a><br><h2>  Concassage et planification </h2><br><img src="https://habrastorage.org/webt/6e/1w/nc/6e1wnczv0tchzm_sq9pey6avk2o.png"><br><br>  Le diagramme ci-dessus d√©crit la s√©quence des √©tapes du processus, le r√©sultat attendu pour chaque √©tape et les ressources qui seront n√©cessaires pour cr√©er chaque pi√®ce (d√©tails: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢che 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢che 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢che 4,5,6</a> ). <br><br>  Dans mon cas, tout se passe sur deux machines <strong>Ubuntu 18.04</strong> .  L'un d'eux contr√¥le le processus.  De l'autre, plusieurs conteneurs Docker d'infrastructure sont en cours d'ex√©cution. <br><br><blockquote><h4>  Excuses et √©checs </h4><br>  Tout le code du package se compose de trois parties. <br>  L'un d'eux n'est pas le mien (je note que c'est un code soign√© et beau).  La source de ce code est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="packagist.org">packagist.org</a> . <br><br>  J'en ai moi-m√™me √©crit un autre, j'ai essay√© de le rendre compr√©hensible et j'ai consacr√© environ une semaine √† cette partie du code. <br><br>  Le reste est un ¬´h√©ritage historique difficile¬ª.  Cette partie du code a √©t√© cr√©√©e sur une p√©riode assez longue.  Y compris √† une √©poque o√π je n'avais pas beaucoup de comp√©tences en programmation. <br><br>  C'est pr√©cis√©ment la raison de l'emplacement des r√©f√©rentiels sur mon <strong>GitLab</strong> et des packages sur mes <strong>Satis</strong> .  Pour √™tre publi√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Github.com">GitHub.com</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="packagist.org">packagist.org,</a> ce code n√©cessitera un traitement et une documentation plus approfondie. <br><br>  Toutes les parties du code sont ouvertes pour une utilisation illimit√©e.  Les r√©f√©rentiels et packages seront disponibles pour toujours. <br><br>  Cependant, lors de la r√©√©dition du code, je serai reconnaissant de poster un lien vers moi ou vers cet article. <br></blockquote><br><h2>  Un peu d'architecture </h2><br>  L'approche qui a √©t√© utilis√©e pour cr√©er notre outil est d'√©crire (ou d'utiliser un utilitaire pr√™t √† l'emploi) pour r√©soudre chaque t√¢che sp√©cifique.  De plus, chaque utilitaire, quelle que soit la t√¢che √† r√©soudre, poss√®de deux propri√©t√©s communes √† tous: <br><br><ul><li>  l'utilitaire peut √™tre lanc√© ind√©pendamment des autres √† partir de la ligne de commande avec des param√®tres contenant la t√¢che; </li><li>  l'utilitaire peut retourner le r√©sultat de l'ex√©cution √† stdout (apr√®s avoir √©t√© configur√© d'une certaine mani√®re). </li></ul><br>  Une solution faite par ce principe vous permet de modifier le nombre de gestionnaires de t√¢ches (travailleurs) en cours d'ex√©cution pour chacune des √©tapes du processus.  Un nombre diff√©rent de travailleurs pour chaque √©tape entra√Ænera un temps d'arr√™t de ¬´0¬ª pour les √©tapes qui suivent en raison de la longueur des t√¢ches de traitement des √©tapes pr√©c√©dentes. <br><br>  Le temps pass√© √† obtenir une unit√© du r√©sultat du processus (dans notre cas, il s'agit d'un proxy v√©rifi√©) d√©pend de facteurs externes (le nombre de proxy inappropri√©s, le temps de r√©ponse d'une ressource externe, etc.). <br><br>  En modifiant le nombre de travailleurs pour chacune des √©tapes du processus, nous transformons cette d√©pendance en d√©pendance du nombre de travailleurs en cours d'ex√©cution (c'est-√†-dire en fonction des capacit√©s de calcul et de canal impliqu√©es). <br><br>  Pour synchroniser le fonctionnement de pi√®ces ind√©pendantes individuelles, il est pratique d'utiliser le serveur de file d'attente de messagerie comme un bus de donn√©es unique.  Il vous permettra d'accumuler les r√©sultats des √©tapes termin√©es dans la file d'attente et de les transmettre √† l'utilitaire ¬´√©tape suivante¬ª au bon moment en entr√©e. <br><br><h3>  File d'attente de messagerie.  MQ et ESB </h3><br>  En tant que niveau inf√©rieur ( <abbr title="File d'attente des messages">MQ</abbr> ), nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Excellent article de synth√®se">beanstalkd</a> .  Petit, l√©ger, sans configuration, disponible dans le package deb et dans le conteneur Docker, un travailleur acharn√© discret.  Le niveau logique ( <abbr title="Bus de service d'entreprise">ESB</abbr> ) impl√©mentera le code en <strong>PHP</strong> . <br><br>  Deux classes seront utilis√©es pour l'impl√©mentation.  <b>esbTask</b> et <b>nextStepWorker</b> . <br><br>  <b>esbTask</b> <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">esbTask</span></span></span><span class="hljs-class"> //   ,     </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// immutable-; // "" (   ESB-),  payload //    //     "" .... }</span></span></code> </pre><br>  Une instance de cette classe sert √† ¬´adresser¬ª le <abbr title="Charge utile">paylod √†</abbr> travers les √©tapes du processus.  Le concept <abbr title="Bus de service d'entreprise">ESB</abbr> applique plusieurs principes / mod√®les.  Deux d'entre eux m√©ritent une attention particuli√®re: <br><br><ul><li>  A propos du chemin (s√©quence d'√©tapes) du processus, √† chaque moment du processus, <br>  personne ne sait sauf l'enveloppe √† transmettre; <br></li><li>  Chaque enveloppe a trois directions possibles des r√©sultats: <br><ul><li>  l'√©tape suivante du processus (poursuite normale); </li><li>  √©tape d'arr√™t (cible d'arr√™t - est s√©lectionn√©e par l'√©tape suivante, s'il est inutile de poursuivre le processus / la situation d'arr√™t); <br></li><li>  √©tape d'erreur (cible d'arr√™t d'urgence - est s√©lectionn√©e √† l'√©tape suivante, en cas d'erreur du travailleur). <br></li></ul><br></li></ul><div class="spoiler">  <b class="spoiler_title">L'objet en file d'attente est repr√©sent√© dans json, cach√© ici ...</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// json- esbTask { //    (   esbTask) "_type":"App\\\\rebean\\\\payloads\\\\ESBtaskQueue", //  "task":"task:queue@XXX.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", //    () "replyto":[ "othertask1:nextqueue1@yyy.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "othertask2:nextqueue2", "othertask3:nextqueue3", ], //    () "onerror":[ "error:errorsstep@zzz.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "error:errorsstep1", "error:errorsstep2", "error:errorsstep3" ], //     () "onstop":[ "stop:stopstep@kkk.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "stop:stopstep1", "stop:stopstep2", "stop:stopstep3" ], //   "payload":{ .... }, //   ... () "till":[ .... ], //     ... () //        // -  (LINUX-TimeStamp) "since":[ 1540073089.8833, ], // -     "points":1, //  .     "groupid":"" }</span></span></code> </pre><br></div></div><br>  <b>nextStepWorker</b> <br><br>  Chaque message qui appara√Æt dans la file d'attente est trait√© par le travailleur qui en est responsable.  Pour ce faire, l'ensemble de fonctions suivant est impl√©ment√©: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nextStepWorker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">workerConstructor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       //     esbTask //    () //    MQ- (beanstalkd) //     (Memcached) //     (MySQL) // : -  (  - ); -    stop-; -      (log, event, mq) .... }</span></span></code> </pre><br>  Les travailleurs pour chacune des √©tapes du processus sont impl√©ment√©s sur la base de cette classe.  Toute la routine de traitement, d'adressage et d'envoi de la prochaine √©tape de l'itin√©raire, la classe s'en charge. <br><br>  La solution √† chacun de ces probl√®mes consiste √†: <br><br><ol><li>  Obtenez esbTask et ex√©cutez le travailleur; </li><li>  Impl√©mentez la logique en stockant les r√©sultats dans la charge utile; </li><li>  Terminez l'ex√©cution du travailleur (d'urgence ou normale - cela n'a pas d'importance). </li></ol><br>  Si les √©tapes sont termin√©es, le r√©sultat sera mis en file d'attente avec le nom appropri√© et le prochain travailleur commencera le traitement. <br><a name="subj2"></a><br><h2>  Faites-le une fois.  V√©rifier la disponibilit√© </h2><br>  En fait, la cr√©ation d'un travailleur pour r√©soudre l'un des probl√®mes est la mise en ≈ìuvre d'une m√©thode.  Un exemple (simplifi√©) de la mise en ≈ìuvre d'un travailleur r√©solvant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me 2 est</a> le suivant: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/curlChecker.php .... class curlChecker extends nextStepWorker { const PROXY_INFO = 'https://api.ipfy.me?format=json&amp;geo=true'; const PROXY_TIMEOUT = '40'; const COMMAND = "curl -m %s -Lx http://%s:%s '%s'"; public function logic() { //    .  ..   payload extract($this-&gt;context()); //  defaults    payload  $curltimeout = $curltimeout ?? self::PROXY_TIMEOUT; $curlchecker = $curlchecker ?? self::PROXY_INFO; //     $line = sprintf( static::COMMAND, $curltimeout, $host, $port, $curlchecker ); exec($line, $info); //      // ( ,  stop-) $info = arrays::valid_json(implode('', info)); if (empty($info)) throw new \Exception("Bad proxy: $host:$port!", static::STATUS_STOP); //    payload $this-&gt;enrich(['info']) -&gt;sets(compact('info')); } }</span></span></code> </pre><br>  Quelques lignes de code et tout est fait et ¬´second√©¬ª √† l'√©tape suivante. <br><a name="subj3"></a><br><h2>  D√©finissez TimeZone.  TimeZoneDB et √† quoi √ßa sert ... </h2><br>  Un test approfondi des demandes entrantes implique de faire correspondre l'heure de la fen√™tre du navigateur avec l'heure √† laquelle l'adresse IP source de la demande existe. <br><br>  Pour √©viter toute suspicion de la part des compteurs, nous devons conna√Ætre l'heure du proxy local. <br><br>  Pour conna√Ætre l'heure, nous prenons la latitude et la longitude des r√©sultats de l'√©tape pr√©c√©dente du processus et obtenons des donn√©es sur le fuseau horaire dans lequel notre future instance de la fen√™tre du navigateur fonctionnera.  Ces donn√©es nous seront fournies par des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="timezonedb.com">professionnels du domaine du temps</a> . <br><br>  Un travailleur simplifi√© pour r√©soudre ce probl√®me ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√¢che 3</a> ) sera compl√®tement similaire au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©c√©dent</a> .  La seule diff√©rence est l'URL de la demande.  Vous pouvez trouver la version compl√®te dans le fichier: <br><blockquote>  // app / src / Process / worker / timeZone.php </blockquote><br><h2>  Un peu sur l'infrastructure </h2><br>  En plus du <strong>beanstalkd</strong> d√©crit, notre outil aura besoin de: <br><br><ul><li>  <strong>Memcached</strong> - pour les t√¢ches de mise en cache; </li><li>  <strong>Serveur Selenium</strong> - il est pratique d'ex√©cuter <strong>Selenium Web Driver</strong> dans un conteneur s√©par√© et vous pouvez surveiller le processus via <strong>VNC</strong> ; </li><li>  Tableaux de bord pour la surveillance de <strong>Beanstald</strong> , <strong>Memcached</strong> et <strong>VNC</strong> . </li></ul><br>  Pour un d√©ploiement rapide de tout cela, Docker ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Docker White Papers">Comment installer sur Ubuntu</a> ) est tr√®s pratique. <br><br><div class="spoiler">  <b class="spoiler_title">Et ¬´l'orchestrateur¬ª pour lui est le docker-compose (commandes d'installation) ...</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y install docker-compose</code> </pre><br></div></div><br>  Ces outils vous permettent d'ex√©cuter des serveurs / processus d√©j√† configur√©s et configur√©s (par quelqu'un plus t√¥t) dans des ¬´conteneurs¬ª distincts du syst√®me d'exploitation parent.  Pour plus de d√©tails, je vous recommande de vous r√©f√©rer √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Bon article Docker">tel</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Un autre bon article Docker">tel</a> article. <br><br>  Alors ... <br><br>  Pour d√©marrer l'infrastructure, vous avez besoin de plusieurs commandes dans la console: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,    docker- #     (   ) #    sudo -s git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git \ panels cd panels docker-compose up --build -d #   .</span></span></code> </pre><br>  Suite √† l'ex√©cution r√©ussie de la commande sur la machine avec l'adresse XXX.XXX.XXX.XXX, <br>  Vous recevrez l'ensemble de services suivant: <br><blockquote>  - XXX.XXX.XXX.XXX:11300 - <strong>beanstalkd</strong> <br>  - XXX.XXX.XXX.XXX:11211 - <strong>Memcached</strong> <br>  - XXX.XXX.XXX.XXX-00-00444 - <strong>Serveur Selenium</strong> <br>  - XXX.XXX.XXX.XXX:5930 - serveur <b>VNC</b> pour contr√¥ler ce qui se passe dans <b>Chrome</b> <br>  - XXX.XXX.XXX.XXX:8081 - Panneau Web pour communiquer avec <strong>Memcached</strong> (admin: pass) <br>  - XXX.XXX.XXX.XXX:8082 - Panneau Web pour communiquer avec <strong>beanstalkd</strong> <br>  - XXX.XXX.XXX.XXX:8083 - Panneau Web pour communiquer avec <strong>VNC</strong> (mot de passe: secret) <br>  - XXX.XXX.XXX.XXX:8080 - Panneau Web g√©n√©ral <br></blockquote><br><div class="spoiler">  <b class="spoiler_title">¬´Voir si tout est en place¬ª, ¬´entrer dans la console pour le conteneur¬ª, ¬´arr√™ter l'infrastructure¬ª peuvent √™tre des commandes dans le spoiler.</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,    docker-, #    ..../panels/ #    docker-compose ps # Name Command State Ports # ------------------------------------------------------------------------------------------------------------------------ # beanstalkd /usr/bin/beanstalkd Up 0.0.0.0:11300-&gt;11300/tcp # chrome start-cron Up 0.0.0.0:4444-&gt;4444/tcp, 0.0.0.0:5930-&gt;5900/tcp # memcached docker-entrypoint.sh memcached Up 0.0.0.0:11211-&gt;11211/tcp # nginx docker-php-entrypoint /sta ... Up 0.0.0.0:8443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp, # 0.0.0.0:8082-&gt;8082/tcp, 0.0.0.0:8083-&gt;8083/tcp, 9000/tcp # vnc /usr/bin/supervisord -c /e ... Up 0.0.0.0:8081-&gt;8081/tcp #       chrome docker exec -ti chrome /bin/bash #       docker-compose stop &amp;&amp; docker rm $(docker ps -a -q)</span></span></code> </pre></div></div><a name="subjs"></a><br><h2>  T√¢ches 4,5,6 - se combinent en un seul utilitaire </h2><br>  Apr√®s avoir examin√© en d√©tail l'√©crasement des t√¢ches ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diagramme ci-dessus</a> ), il est facile de s'assurer qu'une seule des t√¢ches restantes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√¢che 6</a> ) d√©pend d'une ressource externe.  En effectuant des t√¢ches avec des dur√©es d'ex√©cution ¬´conditionnellement garanties¬ª (ind√©pendantes de facteurs non contr√¥l√©s), nous n'obtiendrons pas d'avantages suppl√©mentaires √† la vitesse de l'ensemble du processus.  √Ä cet √©gard, ces t√¢ches ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4,5,6</a> ) ont √©t√© combin√©es en un seul travailleur.  Le fichier de travail est appel√©: <br><blockquote>  // app / src / Process / worker / whoerChecker.php </blockquote><br><h3>  D√©finissez les param√®tres de Chrome.  Plugins </h3><br>  <strong>Chrome est</strong> configur√© de mani√®re flexible avec des plugins. <br><br>  Un plugin pour <strong>Chrome</strong> est une archive qui contient un fichier <i>manifest.json</i> .  Il d√©crit le plugin.  L'archive contient √©galement un ensemble de <b>JavaScript, html, css et autres</b> fichiers n√©cessaires au plugin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Documents officiels Chrome">d√©tails</a> ). <br><br>  Dans notre cas, l'un des fichiers <b>JavaScript</b> sera ex√©cut√© dans le contexte de la fen√™tre de travail de <strong>Chrome</strong> et tous les param√®tres n√©cessaires prendront effet. <br><br>  Nous avons juste besoin de prendre le mod√®le de plugin et de substituer les donn√©es n√©cessaires (protocole d'interaction, adresse et port ou fuseau horaire) pour le serveur proxy sous test aux bons endroits. <br><br>  Un extrait de code qui rend l'archive: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/proxyHelper.php .... class proxyHelper extends sshDocker{ .... // $name -  - // $files - [ ... '   -' =&gt; '', ...] protected function buildPlugin(string $name, array $files) { $this-&gt;last = "$this-&gt;cache/$name"; if (!file_exists("$this-&gt;last")) { $zip = new \ZipArchive(); $zip-&gt;open("$this-&gt;last", \ZipArchive::CREATE | \ZipArchive::OVERWRITE); foreach ($files as $n =&gt; $data) { $zip-&gt;addFromString(basename($n), $data); } $zip-&gt;close(); } $this-&gt;all[] = $this-&gt;last; $this-&gt;all = array_unique($this-&gt;all); return $this; } .... }</span></span></code> </pre><br>  Le mod√®le du plugin de r√©glage du proxy a √©t√© trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="r√©f√©rentiel du plugin pour installer le proxy dans Chrome">dans la tirelire des r√©sultats du travail des personnes qui aiment leur profession</a> , chang√© dans la partie protocole et ajout√© au r√©f√©rentiel. <br><br><h3>  Changement de temps de fen√™tre </h3><br>  Pour modifier l'heure globale d'une instance Chrome en cours d'ex√©cution, nous devons remplacer <i>window.Date</i> par une classe avec des fonctionnalit√©s similaires, mais valide dans le bon fuseau horaire. <br><br>  J'appr√©cie vraiment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="r√©f√©rentiel du plugin pour changer le temps de fen√™tre dans Chrome">le travail de Sampo Juustila</a> .  Le script a √©t√© con√ßu pour les tests automatis√©s de l' <abbr title="Interface utilisateur">interface utilisateur</abbr> , mais apr√®s un petit raffinement a √©t√© appliqu√©. <br><br>  Il y a une nuance ici sur laquelle je veux attirer votre attention.  Il est associ√© au contexte des scripts d√©crits dans <i>manifest.json</i> . <br><br>  Tout le secret est que le contexte global (celui dans lequel le script principal du plug-in est lanc√© et les param√®tres d√©finis, par exemple, connect√© au r√©seau) est isol√© du contexte de l'onglet dans lequel la page est charg√©e. <br><br>  Empiriquement, il a √©t√© constat√© que l'impact sur le prototype de la classe dans le contexte global n'a pas conduit √† son changement dans l'onglet.  Cependant, apr√®s avoir enregistr√© le script dans la page d√©j√† charg√©e et l'avoir ex√©cut√© avant les autres, le probl√®me a √©t√© r√©solu. <br><br>  La solution est repr√©sent√©e par le fragment de code suivant: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/chromePlugins/timeShift/content.js //     var s = document.createElement('script'); //        s.src = chrome.extension.getURL('timeshift.js'); //      (document.head || document.documentElement).appendChild(s);</span></span></code> </pre><br><h3>  Param√®tres proxy </h3><br><div class="spoiler">  <b class="spoiler_title">La configuration d'un proxy dans Chrome est si simple que je vais cacher le code js dans un spoiler</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/chromePlugins/proxy/background.js var config = { mode: "fixed_servers", rules: { singleProxy: { scheme: "%scheme", host: "%proxy_host", port: parseInt(%proxy_port) }, bypassList: ["foobar.com"] } }; chrome.proxy.settings.set({value: config, scope: "regular"}, function () { }); function callbackFn(details) { return { authCredentials: { username: "%username", password: "%password" } }; } chrome.webRequest.onAuthRequired.addListener( callbackFn, {urls: ["&amp;gtall_urls&amp;lt"]}, ['blocking'] );</span></span></code> </pre><br></div></div><br><h3>  Chemin des plugins Chrome </h3><br><div class="spoiler">  <b class="spoiler_title">Tous les plugins sont nomm√©s selon le sch√©ma et sont ajout√©s au dossier temporaire de la machine qui contr√¥le le processus.</b> <div class="spoiler_text"><blockquote>  // sch√©ma de nommage pour le plugin proxy: <br>  proxy- [adresse] - [port] - [protocole]&gt;. zip <br>  Timeshift - ["-" | ""] - [shift_in_minutes_from_GMT] .zip </blockquote></div></div><br>  Ensuite, nous devons installer ces plugins dans un conteneur Docker qui s'ex√©cute sur la machine responsable de l'infrastructure. <br><br>  Nous le ferons avec ssh.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title=" phpseclib  packagist.org">phpseclib</a> (     ).    ,      . <br><br>   ssh       ,     . <br><br>    (  SFTP  SSH)    ().      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title=" phpseclib">phpseclib</a>   . <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/sshDocker.php //    (DOCKER_HOST, DOCKER_USER, DOCKER_PASS) //   : app/settings.php //      .... class sshDocker { .... //  .     docker //    .         // : app/techs.php const EXEC_DOCKER = DOCKER_BIN_PATH . "/docker exec -i %s %s"; .... //     sudo    (  ),  DOCKER_USER -  protected function sudo(string $command, string $expect = '.*'){...} //     Docker-,      //       -    self::EXEC_DOCKER protected function execDocker(string $command, string $expect){...} .... }</span></span></code> </pre><br>    sshDocker      proxyHelper    ,         . <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/proxyHelper.php .... class proxyHelper extends sshDocker { .... public static function new(string $docker, $plugins) { return (new self($docker, $plugins)) -&gt;setupPlugins(); } .... }</span></span></code> </pre><br><h3>  Chome   </h3><br>   <b>Chrome</b>   <b>Selenium Server</b> . <br><br> Selenium Server ‚Äî -,   <strong>FaceBook</strong>    WEB-. <br><br> -           ( <b>Chrome</b>  <b>Firefox</b> ). <br><br> <b>Selenium Server</b>        -       . <br><br>         : <br><br><pre> <code class="bash hljs">composer require facebook/webdriver</code> </pre><br><div class="spoiler"> <b class="spoiler_title">     Selenium Server (RemoteWebDriver)   .</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// URL- $url = "https://example.com/books/196/empire-v-povest-o-nastoyashem-sverhcheloveke"; // URL,     (Selenium Server) $server = 'http://' . DOCKER_HOST . '/wd/hub'; //   ,      $options = new ChromeOptions(); $options-&gt;addArguments(array( '--disable-notifications' )); //    - $capabilities = DesiredCapabilities::chrome(); $capabilities-&gt;setCapability(ChromeOptions::CAPABILITY, $options); //        5000     URL $driver = RemoteWebDriver::create($server, $capabilities, 5000); $page = $driver-&gt;get($url);</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et donc, j'ai l√©g√®rement r√©duit tout cela, optimisant la configuration pour mes besoins: </font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/whoerChecker.php .... class whoerChecker extends nextStepWorker { //    : app/settings.php // URL Selenium Server const SELENIUM_SERVER = CHVM; //  - const DOCKER_NAME = DOCKER_NAME; .... public function config() .... //        : // $driver = RemoteWebDriver::create($server, $capabilities, 5000); $chrome = Chrome::driver( static::SELENIUM_SERVER, Chrome::capabilities(static::DOCKER_NAME, $plugins), 5000 ); .... } ....</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'≈ìil s'accroche imm√©diatement aux plugins $. </font><font style="vertical-align: inherit;">$ plugins est une structure de donn√©es charg√©e de configurer les plugins. </font><font style="vertical-align: inherit;">Pour chaque r√©pertoire et pour remplacer les espaces r√©serv√©s dans </font><font style="vertical-align: inherit;">les fichiers </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du plugin.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La structure est d√©crite dans le fichier app / plugs.php et fait partie des options globales app / settings.php.</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/plugs.php const PLUGS = [ 'timeshift' =&gt; [ 'path' =&gt; PROJECTPATH . '/app/chromePlugins/timeShift', 'files' =&gt; ['manifest.json', 'timeshift.js', 'content.js'], 'fields' =&gt; ['%addsminutes' =&gt; 'timeshift'] ], 'proxy' =&gt; [ 'path' =&gt; PROJECTPATH . '/app/chromePlugins/proxy', 'files' =&gt; ['manifest.json', 'background.js'], 'fields' =&gt; [ '%proxy_host' =&gt; 'host', '%proxy_port' =&gt; 'port', '%scheme' =&gt; 'scheme', '%username' =&gt; 'user', '%password' =&gt; 'pass' ] ] ];</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'analyse d'une page avec </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium WebDriver</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est tr√®s simple.</font></font><br><br><pre> <code class="php hljs">.... $url = <span class="hljs-string"><span class="hljs-string">'https://__/_-_'</span></span>; $page = $chrome-&gt;get($url); .... <span class="hljs-comment"><span class="hljs-comment">//   xPath-   $xpath = '/html[1]/body[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/div[1]/div[1]/strong[1]'; $element = page-&gt;findElement(WebDriverBy::xpath($xpath)); .... //   $text = $element-&gt;getText(); // HTML- $html = $element-&gt;&gt;getAttribute('innerHTML'); ....</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme je l'ai d√©j√† √©crit, toutes ces actions sont impl√©ment√©es par l'utilitaire de la troisi√®me √©tape ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√¢che 4,5,6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> // app / src / Process / worker / whoerChecker.php </font></font><br></blockquote>     <b>Selenium Server</b> ,      ,         (1000 ‚Äî 3000  ),  ,    <b>Selenium Server</b>  .   .       . <br><br>    ¬´¬ª  .  ¬´¬ª 2 .    <b>cron</b> .       Docker-    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">renskiy</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="  ,    cron  docker-"> ,    </a> (   ). <br><br>    Docker-               docker-compose.yml, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="   clicker  docker-  "> </a> .      killcron,   . <br><br><h4> WebRTC </h4><br>   ,      ,       ,      . <br><br>     (  IP ),      ¬´  ¬ª.  flash  <b>WebRTC</b> ,   .    <b>Flash</b> , <b>WebRTC</b> ‚Äî . <br><br>      ‚Äî    <b>UDP</b> -.  <b>WebRTC</b>   : <b>3478</b>  <b>19302</b> . <br><br>    ¬´¬ª   ¬´chrome¬ª,  -      iptables: <br><br><pre> <code class="bash hljs">iptables -t raw -I PREROUTING -p udp -m multiport --dports 3478,19302 -j DROP</code> </pre><br>       proxyHelper. <br><br><h3>   </h3><br>     ‚Äî  ¬´¬ª      ,     . <br><br>     <i>whoerChecker</i> .    ,   ,   . <br><br>    ,    <i>located</i> ,    ¬´¬ª       . <br><br>  ¬´¬ª           .   ¬´  ¬ª      ,    <i>esbTask</i> ( <i>since</i>  <b>ESB</b> ). <br><br>      ,  <b>yandex-</b>       . <br><br><img src="https://habrastorage.org/webt/es/wn/kk/eswnkk5esmtcunc6xvpn90ndefw.png"><br><br><h2>     </h2><br> , : <br><br><ul><li> ,    ¬´ ¬ª (    ) <i>esbTask</i> json-     ,     <strong>beanstalkd</strong> ; </li><li>   ( <b>MQ</b> ),   <b>beanstalkd</b> ; </li><li> Linux- (Process-); </li></ul><br>   ¬´¬ª, ,   <b>libevent</b>  <b>React PHP</b> .  ,   ,    (  )       . <br><br> ,      ,         .   ‚Äî  " <b>noserver</b> ".   ‚Äî " <b>server</b> ". <blockquote><div class="spoiler"> <b class="spoiler_title">      ,  .</b> <div class="spoiler_text"><blockquote>      .      , ,‚Ä¶ . ,  ,    ,   ,     ,         . <br><br>   <b>habr</b>   ,     . , ,          . <br><br>        .     ,        " <b>server</b> ",       <b>README.md</b>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="   clicker  docker-  "> </a> . </blockquote></div></div></blockquote><br>  " <b>noserver</b> ",       (  ).   <s>   </s>     . <br><br>              ¬´¬ª. <br><br>    : <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/noserver/singleProcess.php //   ,    //   include __DIR__ . '/../../../settings.php'; use App\ESB\pipeNcacheService; use App\arrayNstring\queueDSN; use App\arrayNstring\timeSpent; use App\arrayNstring\progressString; //    $path = __DIR__ . '/../worker'; //   $queues = array_keys(WORKERS); $queue = $argv[1] ?? end($queues); $queue = strtolower($queue); if (!in_array($queue, $queues)) die("php $argv[0] &lt;queue_name&gt;" . PHP_EOL); //  - $progress = new progressString("Listenning... Idle: ", 40, 20); // ,      $stopwatch = timeSpent::start(); //    beanstalkd- list($worker, $task) = WORKERS[$queue]; $procid = ['procid' =&gt; posix_getpid()]; //   beanstalkd  Memcached, //     ( ) $dsn = new queueDSN($task, $queue, ...QUEUE_SERVER); //     ESB- $pnc = new pipeNcacheService($dsn); $pipe = $pnc-&gt;getPipe(); echo "Start listener for queue: $queue." . PHP_EOL; echo "Press Ctrl-C to stop listener." . PHP_EOL; //      //       while (true) { try { $job = $pipe-&gt;watch($queue) -&gt;reserve(1); $now = new DateTime(); $opts = json_encode($pipe-&gt;getPayload($job) + $procid); $pipe-&gt;delete($job); echo PHP_EOL . "Task recived at: " . $now-&gt;format('H:i:s') . " Starting worker: $worker. "; $stopwatch = timeSpent::start(); exec("php $path/$worker $opts", $out); echo "Finished. Time spent: $stopwatch" . PHP_EOL; $stopwatch = timeSpent::start(); } catch (Throwable $exception) { echo $progress($stopwatch('%I:%S', null, $now)); } }</span></span></code> </pre><br>      ‚Ä¶   ,      PHP-,   <i>exec(...)</i> . <br><br>      ,       " <b>noserver</b> "          " <b>server</b> ". <br><br><h2>       </h2><br><h3>   </h3><br>       <b><i>app/settings.php</i></b> .         .      <i>app/settings.php.dist</i> .    . <br><br> <b><i>app/settings.php</i></b> ,  ,     . <br><blockquote> ‚Äî <b><i>app/queues.php</i></b>      <br> ‚Äî <b><i>app/plugs.php</i></b>   <b>Chrome</b> - <br> ‚Äî <b><i>app/techs.php</i></b>    <br></blockquote><br><h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour faciliter le traitement des r√©sultats du processus et le placement des t√¢ches, il existe plusieurs utilitaires. </font><font style="vertical-align: inherit;">Les utilitaires sont lanc√©s √† partir de la ligne de commande. </font><font style="vertical-align: inherit;">Fourni avec des descriptions d'arguments. </font><font style="vertical-align: inherit;">Situ√©: </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app / src / Utils</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> backup.php - enregistre les files d'attente dans un fichier</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    clear.php - nettoie les files d'attente</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    exporter.php - exporte √† partir d'un fichier avec une file d'attente enregistr√©e </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     adresse des paires: port</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    givethejob.php - publie des t√¢ches dans le processus </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     (source - adresse: zone de liste d√©roulante des ports).</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     peut exclure certaines adresses de la liste</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    restore.php - restaure une file d'attente enregistr√©e </font></font></pre></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Affiner les travailleurs </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lors de l'utilisation de travailleurs √©crits, il peut √™tre pratique d'utiliser les options de configuration suivantes: </font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/curlChecker.php .... $worker = new curlChecker( [ //    curlChecker::WORKER =&gt; 'curlchecker', //  beanstalkd curlChecker::PIPE_HOSTPORT =&gt; implode(':', QUEUE_SERVER), //  Memcached curlChecker::CACHE_HOSTPORT =&gt; implode(':', MEMCACHED), // ,    . //    -   curlChecker::DB_SCRIPT =&gt; __DIR__ . '/../../../confdb.php', // ,       // (        -) curlChecker::INFO_START =&gt; CURL_START, // ,        // (        -) curlChecker::INFO_END =&gt; CURL_END, //  ,     //    //        curlChecker::INFO_ADDS_END =&gt; ['host', 'port'] ], ['setupworker', 'config', 'logic'] ); ....</span></span></code> </pre><br><a name="deploy"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©ploiement </font></font></h3><br>  ,      2    <b>Ubuntu 18.04</b> . <br>    ( <b>docker</b> ),     ( <b>process</b> ). <br><br> <b>docker</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    root-. # ,     TCP-: # 11300, 11211, 4444, 5930, 8080, 8081, 8082, 8083 #   . sudo -s apt -y update apt -y install git snap snap install docker apt -y install docker-compose # C       # " root-"    cd ~ git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git cd esb-infrastructure docker-compose up --build -d #      3     #   . #       web-.</span></span></code> </pre><br> <b>process</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      . #   . sudo apt -y update sudo apt -y install git php-common php-cli php-curl php-zip php-memcached composer # C     process-   , #     -  php- cd /var/www git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/clicker-noserver.git cd clicker-noserver composer update #  .       "XXXXXXXX" mv app/settings.php.dist app/settings.php #   . gnome-terminal \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php curl"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php timezone"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php whoer"' #  . ,     , #  : - log/list.proxy php app/src/Utils/givethejob.php ./log/list.proxy</span></span></code> </pre><br> ,     web- (http://ip---:8080). <br>      <i>located</i> . <br><br><h2>    </h2><br> ,         ,    . <br><br>        (         ),     : <strong>Message Queue</strong>  <strong>Enterprise Service Bus</strong> . <br><br>    ,         ,          . <br><br>  Je vous remercie </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432038/">https://habr.com/ru/post/fr432038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432024/index.html">Gradle 5.0 - quoi de neuf</a></li>
<li><a href="../fr432030/index.html">Le chemin vers un d√©tecteur de mensonge sans contact, ou comment organiser un hackathon √† vitesse maximale</a></li>
<li><a href="../fr432032/index.html">Nous terminons le champ de recherche Google clou√©</a></li>
<li><a href="../fr432034/index.html">Le livre ¬´L'√©lectricit√© √©tape par √©tape¬ª de Rudolf Svoren</a></li>
<li><a href="../fr432036/index.html">En direct: infrastructure frontale</a></li>
<li><a href="../fr432040/index.html">Validateurs + Aspects: personnaliser la validation</a></li>
<li><a href="../fr432042/index.html">Yandex ouvre le Cloud. Architecture de la nouvelle plateforme</a></li>
<li><a href="../fr432046/index.html">Comp√©tition Grail Telecom Data Cup. Le plus chaud √† venir</a></li>
<li><a href="../fr432048/index.html">Pourquoi quelqu'un prendrait la peine d'apprendre des langues hors de la demande. Une √©tude de cas de la communaut√© F #</a></li>
<li><a href="../fr432050/index.html">Bienvenue au Waves Blockchain Hackathon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>