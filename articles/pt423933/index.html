<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÜ üñêüèΩ üöπ Microsoft Office Security: Objetos incorporados ‚õÖÔ∏è üôèüèæ üê¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inicialmente, a arquitetura do Microsoft Office foi constru√≠da com base no conceito de documentos compostos, eles tamb√©m s√£o documentos OLE , promovid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microsoft Office Security: Objetos incorporados</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/423933/"><img src="https://habrastorage.org/webt/os/-z/yx/os-zyx2ayrnxagtecn42u4spxke.jpeg"><br><br>  Inicialmente, a arquitetura do Microsoft Office foi constru√≠da com base no conceito de documentos compostos, eles tamb√©m s√£o <b>documentos OLE</b> , promovidos ativamente pela Microsoft no in√≠cio do Windows de 32 bits.  Naquela √©poca, a id√©ia de combinar "de maneira perfeita" dados de v√°rios formatos em um documento parecia tentadora e fascinante e, antes de identificar os primeiros problemas, conseguiu crescer firmemente em muitos produtos de grande escala. <br><br>  A ‚Äúm√° not√≠cia‚Äù era que a maneira universal de adicionar dados (e o c√≥digo para processar esses dados) aos documentos se tornou uma maneira universal de introduzir vulnerabilidades no produto, que hoje ainda apresenta surpresas <s>agrad√°veis</s> aos <s>criadores de</s> pesquisadores de seguran√ßa <s>de malware</s> . <a name="habracut"></a><br><br>  Posteriormente, o pacote de aplicativos recebeu um conjunto bastante rico de ferramentas para adicionar imagens, gr√°ficos e tabelas, elementos de controle criados e processados ‚Äã‚Äãpelo aplicativo e fazem parte dele nos documentos.  Do ponto de vista da seguran√ßa, esses elementos t√™m um interesse um pouco menos do que os elementos que (principalmente) ser√£o discutidos no artigo - elementos que usam o c√≥digo de aplicativos externos que s√£o adicionados aos documentos usando OLE. <br><br>  Uma representa√ß√£o de "disco" de um documento composto √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo CFBF</a> .  Este artigo discutir√° a incorpora√ß√£o de objetos nos documentos do Microsoft Office (ou melhor, apenas o aspecto de seguran√ßa) no contexto de <b>dados e c√≥digos carregados na mem√≥ria</b> em tempo de execu√ß√£o. <br><br>  Objetos formalmente incorporados nos documentos do Microsoft Office podem ser divididos nos seguintes grupos: <br><br><ul><li>  Controles ActiveX (controles ActiveX) </li><li>  <b>Objetos incorporados OLE</b> </li><li>  Arquivos incorporados ( <b>pacotes</b> ) </li><li>  Elementos inline <b>n√£o OLE</b> </li></ul><br><h3>  Controles ActiveX </h3><br>  Os controles ActiveX podem ser representados como elementos de uma janela de programa - digamos, bot√µes, bot√µes de op√ß√£o, listas, campos de entrada e outros formul√°rios - projetados para produzir determinados eventos ou responder a eventos.  Era uma vez uma boa id√©ia criar esses elementos de controle universais, com a possibilidade de uso em qualquer aplicativo, e coloc√°-los para esse fim em <b>componentes COM</b> . <br><br>  As p√°ginas da Web incorporadas ao ActiveX representavam uma conhecida viola√ß√£o de seguran√ßa do Internet Explorer; as medidas de seguran√ßa aumentavam com o tempo.  Navegadores de outros fabricantes abandonaram quase imediatamente o suporte a ActiveX.  O novo navegador Microsoft Edge finalmente se separou dessa rel√≠quia do passado.  A incorpora√ß√£o de documentos do Office, no entanto, ainda √© poss√≠vel. <br><br>  O ActiveX em documentos deve ser usado em conjunto com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Visual Basic for Applications</b></a> .  No entanto, o VBA n√£o √© necess√°rio para fazer o download e ativ√°-los, e a permiss√£o do usu√°rio n√£o √© necess√°ria para baixar <b>itens da lista branca</b> . <br><br>  As vulnerabilidades neste √∫ltimo s√£o especialmente perigosas - as configura√ß√µes padr√£o definidas na instala√ß√£o do aplicativo n√£o implicam nenhuma prote√ß√£o contra o carregamento desses elementos, nem um aviso ao usu√°rio.  O administrador precisa restringir as configura√ß√µes proibindo o carregamento de qualquer controle ActiveX (no entanto, observe que o ActiveX n√£o carrega no modo Navega√ß√£o segura). <br><blockquote>  Exemplo: CVE-2012-0158 <br><br>  Uma das vulnerabilidades mais perigosas dos documentos do Office em 2012 foi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2012-0158</a> .  O c√≥digo de carregamento para o elemento Microsoft ListView Control 6.0 da biblioteca MSCOMCTL.OCX continha a possibilidade de estouro de buffer, o que permitia substituir o endere√ßo de retorno e executar c√≥digo arbitr√°rio.  Como o item estava na "lista branca" do ActiveX, o carregamento come√ßou imediatamente quando o documento foi aberto.  A vulnerabilidade est√° corrigida no momento, o controle ListView ainda √© considerado "seguro". </blockquote><h4>  Adicionando ActiveX a um documento </h4><br>  Para adicionar um elemento de controle a um documento do Microsoft Office (para simplificar, use o Word), use a interface do usu√°rio para abrir a guia "Desenvolvedor" (sua visibilidade √© configurada no menu "Op√ß√µes do Word") e selecione Controles -&gt; Ferramentas de vers√µes anteriores -&gt; controles ActiveX.  O menu demonstrar√° um conjunto de √≠cones correspondentes aos elementos do Microsoft Forms, bem como a capacidade de selecionar o ActiveX na lista composta por elementos dispon√≠veis no sistema selecionados de acordo com v√°rios crit√©rios. <br><br><img src="https://habrastorage.org/webt/nn/wt/jt/nnwtjte9nabt8rriqxotr4f7is4.jpeg"><br><br>  A lista exibida n√£o corresponde ao conjunto de elementos que realmente podem ser carregados no documento, portanto, n√£o pode ser guiada ao procurar elementos vulner√°veis.  A verifica√ß√£o sofisticada em v√°rios n√≠veis do ActiveX baixado tem v√°rios est√°gios, difere das vers√µes do Office e varia de atualiza√ß√£o para atualiza√ß√£o; portanto, a maneira mais segura de verificar o download √© ‚Äúcompor‚Äù manualmente o arquivo do documento com o elemento de interesse e tentar abri-lo no Office.  Os poss√≠veis formatos de documento est√£o descritos abaixo. <br><br><h4>  Apresenta√ß√£o do Programa </h4><br>  Cada elemento ActiveX √© essencialmente um objeto de uma das classes COM que atendem a certos requisitos.  Um elemento √© carregado usando o subsistema COM e o c√≥digo execut√°vel est√° contido em um dos m√≥dulos, que geralmente s√£o "externos" ao aplicativo de cont√™iner.  Como qualquer objeto COM, um elemento ActiveX pode ser implementado como uma DLL ou como um arquivo EXE execut√°vel.  No primeiro caso, a biblioteca ser√° carregada no espa√ßo de endere√ßo do cont√™iner, no segundo - o elemento ser√° processado em um processo separado, com a transfer√™ncia de dados entre o cont√™iner e o objeto por meio de empacotamento COM. <br><br>  Como qualquer objeto COM, o ActiveX possui <b>interfaces</b> , <b>propriedades</b> e <b>m√©todos</b> . <br><br>  As interfaces s√£o principalmente um conjunto de interfaces padr√£o que a classe ActiveX deve ter para carregamento completo e intera√ß√£o com o cont√™iner, em particular IOleControl e IOleObject. <br><br>  A aus√™ncia de quaisquer interfaces necess√°rias pode reduzir a funcionalidade do elemento ou interromper seu carregamento em algum est√°gio. <br><blockquote>  Exemplo: CVE-2015-2424 <br>  A vulnerabilidade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2015-2424</a> foi associada ao elemento TaskSymbol Class da biblioteca mmcndmgr.dll.  O elemento n√£o foi projetado para uso em documentos e n√£o exportou a interface IDispatch.  No processo de carregamento de um elemento, o procedimento que solicitou essa interface recebeu um erro e destruiu a estrutura interna do elemento, o que levou a uma vulnerabilidade do tipo usar ap√≥s livre.  No momento, o item n√£o pode ser baixado (apesar disso, ele ainda pode ser encontrado na lista a ser adicionada ao menu "Desenvolvedor").  A vulnerabilidade em si n√£o foi resolvida. <br></blockquote>  Al√©m das padr√£o, cada classe ActiveX exporta a interface "principal", representando sua pr√≥pria funcionalidade exclusiva.  Por exemplo, para a classe Forms.CommandButton.1, este √© ICommandButton. <br><br>  Voc√™ pode exibir interfaces ActiveX usando a ferramenta <b>OleView</b> inclu√≠da no pacote Microsoft Visual Studio. <br><br><img src="https://habrastorage.org/webt/um/cc/zm/umcczmybv5voo3c6bbde66zxdmq.png"><br><br>  A interface de um elemento define seus <b>m√©todos</b> e <b>propriedades</b> .  Propriedades representam alguns dados que determinam a apar√™ncia e a opera√ß√£o de um elemento.  O desenvolvedor de um elemento ActiveX atribui um nome espec√≠fico a cada propriedade, como BackColor ou GridLineWidth, e um tipo, por exemplo, uma seq√º√™ncia de caracteres, n√∫mero inteiro ou precis√£o dupla real.  Para imagens e √≠cones de bitmap, existe um tipo de propriedade, como uma imagem.  O programa cliente pode definir propriedades individuais do controle, definindo seus √≠ndices e valores inteiros. <br><br>  Do ponto de vista de uma implementa√ß√£o de baixo n√≠vel, a divis√£o em m√©todos e propriedades √© formal, uma vez que "propriedades" s√£o representadas por um conjunto de m√©todos get / set.  No entanto, h√° uma diferen√ßa significativa: os m√©todos de um elemento (sua interface principal) s√≥ podem ser chamados de forma program√°tica, no caso de documentos do Office, somente de um programa VBA em execu√ß√£o.  Do ponto de vista da seguran√ßa, isso n√£o √© de grande interesse, pois a execu√ß√£o do VBA j√° √© um comprometimento do sistema operacional.  <b>As propriedades</b> s√£o salvas no documento e, quando abertas, ser√£o <b>processadas e carregadas</b> nas estruturas da mem√≥ria, <b>mesmo que a execu√ß√£o do VBA seja proibida</b> . <br><br>  Do ponto de vista do software, por parte do elemento, para preservar suas propriedades e estado no documento, o cont√™iner fornece as <b>interfaces</b> <b>IStream</b> , <b>IStorage</b> e <b>IPropertyBag</b> .  Sua implementa√ß√£o e apresenta√ß√£o de dados em um arquivo de disco n√£o √© mais a preocupa√ß√£o do elemento ActiveX e depende inteiramente do cont√™iner e do formato do documento.  Note-se que o conjunto e o formato dos dados armazenados podem corresponder a um conjunto de propriedades exportado ‚Äúpublicamente‚Äù ou podem ser completamente diferentes.  Considere exemplos de implementa√ß√£o relacionados ao Microsoft Office. <br><br><h4>  Arquivo composto (CFBF) </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O formato de documento desatualizado do Office</a> , onde o armazenamento de baixo n√≠vel do ObjectPool e subdiret√≥rios separados dentro dele foram alocados para o armazenamento de dados ActiveX.  O fluxo "\ 001CompObj" cont√©m o identificador de classe, que finalmente determina a classe do objeto carregado.  <b>Substituir o identificador</b> diretamente em hexadecimal resultar√° em uma tentativa de carregar um objeto de uma <b>classe</b> completamente <b>diferente</b> . <br><br><img src="https://habrastorage.org/webt/bc/sx/uc/bcsxucmomcw9wnqwgn-84bxosnu.jpeg"><br><br><h4>  XML aberto do Office </h4><br>  Formato de documento XML moderno.  O arquivo √© um arquivo zip.  Os dados de controle ActiveX s√£o armazenados no subdiret√≥rio ActiveX em arquivos com nomes simples como activeX1.xml. <br><br><img src="https://habrastorage.org/webt/su/gx/uq/sugxuqtgsbhdg8tvr53srkbvtsg.png"><br><br>  Arquivo de exemplo: <br> <code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt; <br> &lt;ax:ocx ax: <b>classid="{D7053240-CE69-11CD-A777-00DD01143C57}</b> " ax: <b>persistence="persistPropertyBag"</b> xmlns:ax="http://schemas.microsoft.com/office/2006/activeX" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"&gt; <br> &lt;ax:ocxPr ax:name="Caption" ax:value="CommandButton1"/&gt; <br> &lt;ax:ocxPr ax:name="Size" ax:value="2540;847"/&gt; <br> &lt;ax:ocxPr ax:name="FontName" ax:value="Calibri"/&gt; <br> &lt;ax:ocxPr ax:name="FontHeight" ax:value="225"/&gt; <br> &lt;ax:ocxPr ax:name="FontCharSet" ax:value="204"/&gt; <br> &lt;ax:ocxPr ax:name="FontPitchAndFamily" ax:value="2"/&gt; <br> &lt;ax:ocxPr ax:name="ParagraphAlign" ax:value="3"/&gt; <br> &lt;/ax:ocx&gt;</code> <br> <br>  Nesses arquivos, os identificadores de classe s√£o indicados em forma de texto.  Substituir o identificador tamb√©m causar√° uma tentativa de carregar um elemento de outra classe. <br><br>  Em seguida, o arquivo cont√©m uma indica√ß√£o do tipo de armazenamento de dados do objeto: persistPropertyBag, persistStorage ou persistStream.  Se um elemento suportar propriedades <b>persistPropertyBag</b> , seus dados poder√£o ser armazenados <b>no mesmo arquivo de texto</b> , veja o exemplo acima.  Se ele precisar de <b>armazenamento</b> ou um <b>fluxo bin√°rio</b> , os dados ser√£o salvos em um arquivo com um nome do tipo activeX1.bin, que √© <b>um arquivo CFBF</b> . <br><br><img src="https://habrastorage.org/webt/pt/tx/hp/pttxhpe9gevkgf8l4a7ddmcfspu.png"><br><br><h4>  RTF </h4><br>  Em um documento rtf, o elemento ActiveX √© definido pelas <b>marcas \ object \ objocx</b> .  A <b>marca \ objdata</b> cont√©m o armazenamento de propriedades do elemento como uma representa√ß√£o hexadecimal do arquivo CFBF. <br><br> <code>{\object\objocx\f37\objsetsize\objw1440\objh480{\*\objclass Forms.CommandButton.1} <br> {\*\objdata 010500000200000016000000 <br> 466f726d732e436f6d6d616e64427574746f6e2e31000000000000000000000e0000 <br> <b>d0cf11e</b> 0a1b11ae1000000000000000000000000000000003e000300feff090006</code> <br> <br><h4>  Baixar do arquivo </h4><br>  O processo de carregamento do ActiveX de um documento como um todo √© bastante simples.  O aplicativo de cont√™iner cria um objeto limpo da classe especificada, solicita a interface de armazenamento especificada e fornece um ponteiro para o armazenamento, fluxo ou "pacote de propriedades". <br><br>  A filtragem de itens que podem ser carregados possui v√°rias etapas.  Primeiro de tudo, as classes especificadas na lista negra conhecida como <b>Office COM Kill Bit</b> (dica do registro * OFFICE_KEY * \ Common \ COM Compatibility) s√£o eliminadas.  Por exemplo, os sinalizadores anti-download possuem classes como o Microsoft Scriptlet Component e o Microsoft Web Browser. <br><br>  As demais classes passar√£o pelo carregamento inicial.  Isso significa que <b>a DLL ser√° carregada</b> no aplicativo de cont√™iner ou <b>o processo do servidor COM</b> implementado no arquivo EXE ser√° <b>iniciado</b> .  Somente depois disso as demais verifica√ß√µes ser√£o realizadas, incluindo a elementar - e se o objeto √©, de fato, um representante do ActiveX. <br><blockquote>  Exemplo: CVE-2015-6128 <br>  Em 2015, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pesquisador descobriu</a> que o pr√©-carregamento de m√≥dulos COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode ser usado para ignorar o ASLR e executar c√≥digo arbitr√°rio</a> , carregando falsas bibliotecas din√¢micas.  O CVE-2015-6128 lan√ßado posteriormente n√£o √© uma palavra sobre o Microsoft Office. <br></blockquote>  Se o identificador realmente definir o ActiveX, ele passar√° por v√°rias verifica√ß√µes em v√°rias listas preto e brancas. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de inicializa√ß√£o do ActiveX a partir do .docx no Windows 7 e no Office 2016 limpos nas configura√ß√µes padr√£o.</b> <div class="spoiler_text"> <code>{00024522-0000-0000-C000-000000000046} RefEdit.Ctrl <br> {02AF6DD2-77E6-44DF-B3E1-57CF1476D8EA} Microsoft Forms 2.0 OptionButton <br> {04082FC6-E032-49F2-A263-FE64E9DA1FA3} Microsoft Forms 2.0 HTML TEXT <br> {0B314611-2C19-4AB4-8513-A6EEA569D3C4} Microsoft Slider Control, version 6.0 <br> {13D557B6-A469-4362-BEAF-52BFD0F180E2} Microsoft Forms 2.0 HTML TextAREA <br> {19FED08E-EFD1-45da-B524-7BE4774A6AEE} Microsoft Forms 2.0 ListBox <br> {20DD1B9E-87C4-11D1-8BE3-0000F8754DA1} Microsoft Date and Time Picker Control 6.0 (SP4) <br> {227B1F3B-C276-4DE0-9FAA-C0AD42ADDCF0} Microsoft Forms 2.0 HTML RESET <br> {232E456A-87C3-11D1-8BE3-0000F8754DA1} Microsoft MonthView Control 6.0 (SP4) <br> {3D0FD779-0C2D-4708-A9BA-62F7458A5A53} Microsoft Forms 2.0 ToggleButton <br> {444D2D27-02E8-486B-9018-3644958EF8A9} FieldListCtrl.2 Object <br> {4C599241-6926-101B-9992-00000B65C6F9} Microsoft Forms 2.0 Image <br> {5052A832-2C0F-46c7-B67C-1F1FEC37B280} Microsoft Forms 2.0 Label <br> {5512D110-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SUBMIT <br> {5512D112-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML IMAGE <br> {5512D114-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML RESET <br> {5512D116-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML CHECKBOX <br> {5512D118-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML OPTION <br> {5512D11A-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TEXT <br> {5512D11C-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Hidden <br> {5512D11E-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Password <br> {5512D122-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SELECT <br> {5512D124-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TextAREA <br> {556C2772-F1AD-4DE1-8456-BD6E8F66113B} Microsoft ImageList Control 6.0 (SP6) <br> {585AA280-ED8B-46B2-93AE-132ECFA1DAFC} Microsoft StatusBar Control 6.0 (SP6) <br> {5CBA34AE-E344-40CF-B61D-FBA4D0D1FF54} Microsoft Forms 2.0 HTML CHECKBOX <br> {5E90CC8B-E402-4350-82D7-996E92010608} Microsoft Forms 2.0 HTML OPTION <br> {603C7E80-87C2-11D1-8BE3-0000F8754DA1} Microsoft UpDown Control 6.0 (SP4) <br> {6240EF28-7EAB-4dc7-A5E3-7CFB35EFB34D} Microsoft Forms 2.0 ScrollBar <br> {65BCBEE4-7728-41A0-97BE-14E1CAE36AAE} Microsoft Office List 16.0 <br> {6C177EBD-C42D-4728-A04B-4131892EDBF6} Microsoft Forms 2.0 ComboBox <br> {787A2D6B-EF66-488D-A303-513C9C75C344} Microsoft Forms 2.0 HTML Password <br> {79176FB0-B7F2-11CE-97EF-00AA006D2776} Microsoft Forms 2.0 SpinButton <br> {86F56B7F-A81B-478d-B231-50FD37CBE761} Microsoft Forms 2.0 CommandButton <br> {87DACC48-F1C5-4AF3-84BA-A2A72C2AB959} Microsoft ImageComboBox Control, version 6.0 <br> {8B2ADD10-33B7-4506-9569-0A1E1DBBEBAE} Microsoft Toolbar Control 6.0 (SP6) <br> {8BD21D10-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 TextBox <br> {8BD21D20-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ListBox <br> {8BD21D30-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ComboBox <br> {8BD21D40-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 CheckBox <br> {8BD21D50-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 OptionButton <br> {8BD21D60-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ToggleButton <br> {9432194C-DF54-4824-8E24-B013BF2B90E3} Microsoft Forms 2.0 HTML SUBMIT <br> {95F0B3BE-E8AC-4995-9DCA-419849E06410} Microsoft TreeView Control 6.0 (SP6) <br> {978C9E23-D4B0-11CE-BF2D-00AA003F40D0} Microsoft Forms 2.0 Label <br> {9A948063-66C3-4F63-AB46-582EDAA35047} Microsoft TabStrip Control 6.0 (SP6) <br> {9BDAC276-BE24-4F04-BB22-11469B28A496} Microsoft Forms 2.0 HTML IMAGE <br> {A0E7BF67-8D30-4620-8825-7111714C7CAB} Microsoft ProgressBar Control, version 6.0 <br> {CCDB0DF2-FD1A-4856-80BC-32929D8359B7} Microsoft ListView Control 6.0 (SP6) <br> {D7053240-CE69-11CD-A777-00DD01143C57} Microsoft Forms 2.0 CommandButton <br> {DCA0ED3C-B95D-490f-9C60-0FF3726C789A} Microsoft Forms 2.0 Image <br> {DD4CB8C5-F540-47ff-84D7-67390D2743CA} Microsoft Forms 2.0 TextBox <br> {DFD181E0-5E2F-11CE-A449-00AA004A803D} Microsoft Forms 2.0 ScrollBar <br> {E9729012-8271-4e1f-BC56-CF85F914915A} Microsoft Forms 2.0 CheckBox <br> {EA778DB4-CE69-4da5-BC1D-34E2168D5EED} Microsoft Forms 2.0 SpinButton <br> {EAE50EB0-4A62-11CE-BED6-00AA00611080} Microsoft Forms 2.0 TabStrip <br> {F14E8B03-D080-4D3A-AEBA-355E77B20F3D} Microsoft Forms 2.0 HTML SELECT <br> {F8CF7A98-2C45-4c8d-9151-2D716989DDAB} Microsoft Visio Document <br> {FB453AD8-2EF4-44D3-98A8-8C6474E63CE4} Microsoft Forms 2.0 HTML Hidden <br> {FDEA20DB-AC7A-42f8-90EE-82208B9B4FC0} Microsoft Forms 2.0 TabStrip <br> {FE38753A-44A3-11D1-B5B7-0000C09000C4} Microsoft Flat Scrollbar Control 6.0 (SP4) <br></code> </div></div><br>  Voc√™ pode ver que um lugar significativo na lista √© ocupado pelos componentes do grupo <b>Microsoft Forms</b> .  Este √© um conjunto de controles que acompanham o Office e voc√™ pode v√™-los no painel de controles ActiveX.  Inicialmente, todos foram registrados como "seguros", mas com o tempo ficou claro que isso n√£o √© verdade para elementos individuais.  Por exemplo, o elemento Frame carrega qualquer outro ActiveX sem verificar nenhuma lista (nas vers√µes mais recentes isso √© "fixo", mas a lista negra do pr√≥prio Frame √© diferente da Office geral).  Por esse motivo, alguns elementos do Microsoft Forms podem ser carregados apenas em um documento com a permiss√£o do usu√°rio.  O Microsoft Forms Frame tamb√©m requer o consentimento do usu√°rio (nas configura√ß√µes padr√£o), mas permite que voc√™ baixe alguns itens da lista Kill Bit que n√£o puderam ser carregados sob outras condi√ß√µes. <br><br>  Portanto, se um invasor conseguir convencer o usu√°rio a permitir o carregamento do ActiveX, o Frame o ajudar√° a expandir significativamente o arsenal devido a elementos como, por exemplo, o Navegador da Web. <br><br>  O formato de armazenamento de propriedades do Microsoft Forms √© parcialmente documentado pela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o [MS-OFORMS]</a> . <br><br>  Durante a verifica√ß√£o do ActiveX, verificou-se que o conjunto de classes para doc, docx e rtf √© diferente, tamb√©m existem listas diferentes de ActiveX dispon√≠vel para um aplicativo em execu√ß√£o da maneira usual e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em modo de automa√ß√£o</a> . <br><br>  Muitos aplicativos populares complementam essas listas com seu pr√≥prio ActiveX.  Se uma vulnerabilidade for descoberta, ela ser√° refletida no boletim como relacionada ao aplicativo do qual faz parte.  No entanto, a √∫nica maneira de explorar a vulnerabilidade pode ser documentos do Office. <br><blockquote>  Exemplo: Flash ActiveX <br>  O Flash ActiveX foi especialmente apreciado pelos criadores de v√≠rus por suas vulnerabilidades consistentemente detect√°veis ‚Äã‚Äãe um lugar permanente nas listas brancas do IE e do Office.  As primeiras vulnerabilidades conhecidas nesse componente apareceram em 2008, uma das √∫ltimas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2018-4878 foi</a> fechada em fevereiro deste ano.  Com a crescente popularidade do IE, os documentos do Office se tornaram a principal maneira de distribuir explora√ß√µes para o Flash. <br></blockquote><h3>  Elementos de dados OLE incorporados </h3><br>  Os elementos OLE implementados foram projetados para implementar o conceito de "documento em documento", com a capacidade de editar dados no local de v√°rios formatos processados ‚Äã‚Äãpor outros aplicativos.  Como o ActiveX, os documentos OLE s√£o implementados com base no COM. <br><br>  Voc√™ pode adicionar um elemento OLE a um documento do Word da seguinte maneira: abra a guia "Inserir" e selecione Texto -&gt; Objeto.  O programa exibe uma lista de tipos de documentos para os quais os manipuladores OLE est√£o registrados.  Como √© o caso do ActiveX, esta lista n√£o corresponde ao conjunto de classes que realmente podem ser carregadas como documentos OLE. <br><br><img src="https://habrastorage.org/webt/yi/x9/1g/yix91gwugtk06yq_s37z4iibzy0.png"><br><br><h4>  Apresenta√ß√£o do Programa </h4><br>  Como no caso do ActiveX, a implementa√ß√£o de qualquer documento OLE √© representada pela classe COM correspondente, feita na forma de uma DLL ou EXE.  O componente exporta as interfaces de servi√ßo necess√°rias e o estado √© salvo no documento do cont√™iner por meio das interfaces IPersist *. <br><br>  Em um documento CFBF, os dados do objeto OLE s√£o armazenados no armazenamento de segundo n√≠vel do ObjectPool.  Um conjunto de threads geralmente √© semelhante aos controles ActiveX correspondentes. <br><br><img src="https://habrastorage.org/webt/ir/qt/oc/irqtocl-val1mrwslawmlpzdpsq.png"><br><br>  Nos documentos XML do Open Office, os dados do objeto OLE s√£o armazenados no subdiret√≥rio de incorpora√ß√£o, em um arquivo de armazenamento CFBF com o nome de tipo oleObject1.bin. <br><br><img src="https://habrastorage.org/webt/p-/7e/ww/p-7ewwax0n2gfsbqercoev9tie0.png"><br><br>  Nos documentos RTF, as informa√ß√µes do objeto s√£o armazenadas na tag <b>\ object \ objemb \</b> .  A se√ß√£o tamb√©m cont√©m armazenamento codificado como uma representa√ß√£o hexadecimal do arquivo CFBF. <br><br> <code>{\object\objemb\objw8307\objh553{\*\objclass WordPad.Document.1} <br> {\*\objdata 010500000200000013000000576f72645061642e446f63756d656e742e31000000000000000000000a0000 <br> <b>d0cf11e</b> 0a1b11ae100000000 <br></code> <br><br>  O formato RTF se distingue pelo fato de <b>oferecer</b> suporte √† marca <b>\ objupdate</b> , que causa a ativa√ß√£o autom√°tica do elemento, enquanto, por padr√£o, os elementos OLE ficam inativos quando carregados. <br><blockquote>  Exemplo: CVE-2017-11882 <br>  A vulnerabilidade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2017-11882</a> OLE do componente Equation Editor devido ao processamento do objeto em um processo separado tornou poss√≠vel a opera√ß√£o est√°vel e universal.  A tag \ objupdate fez com que o Word carregasse o componente vulner√°vel imediatamente ap√≥s abrir o documento. <br></blockquote><blockquote>  Exemplo: elementos incorporados do Excel com v√≠rus de macro <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os pesquisadores descobriram</a> documentos rtf maliciosos que n√£o usam novas vulnerabilidades.  Os documentos cont√™m v√°rios documentos do Excel com macros como objetos incorporados.  O c√°lculo √© feito no fato de que o usu√°rio que, ap√≥s abrir o documento v√°rias vezes seguidas, se recusa a executar a macro, como resultado, "se entrega" e permite a execu√ß√£o.  No momento, a t√©cnica ainda est√° funcionando. <br><br><img src="https://habrastorage.org/webt/ih/e_/oq/ihe_oqpkamkndvqbjfcmxhjqhbi.png"><br></blockquote>  Uma diferen√ßa significativa do ActiveX no caso de elementos OLE incorporados √© que o identificador de classe √© gravado diretamente no arquivo de armazenamento pela fun√ß√£o WriteClassStg.  Essa t√©cnica √© herdada de muito tempo atr√°s, quando a Microsoft desenvolveu com entusiasmo o conceito de "serializa√ß√£o" e armazenamento de objetos com seu estado no formato CFBF.  O documento do cont√™iner tamb√©m salva o identificador de classe do elemento implementado, mas o objeto da classe especificada no reposit√≥rio ser√° carregado.  Esse identificador pode ser substitu√≠do for√ßando o aplicativo a carregar um objeto que n√£o se destina a esses fins. <br>  √â poss√≠vel editar os dados do elemento, o que, em certos casos, leva √† identifica√ß√£o de vulnerabilidades. <br><br>  Os objetos OLE tamb√©m passam por in√∫meras verifica√ß√µes de download, dificultando a obten√ß√£o de uma lista completa de itens potencialmente carregados.  O conjunto de elementos que podem ser carregados como objetos OLE √© diferente da lista de ActiveX carregado.  Em particular, eles s√£o verificados na lista KillBit n√£o pertencente ao Office, mas pelo Internet Explorer (Compatibilidade HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Internet Explorer \ ActiveX). <br><br><h4>  OLE por link </h4><br>  O OLE distingue entre dois mecanismos para incorporar conte√∫do em um documento - incorporar diretamente um documento OLE e criar um link dentro de outro documento para outro documento.  No caso de incorporar o objeto OLE por refer√™ncia, o documento principal cont√©m uma indica√ß√£o do caminho para o arquivo do documento incorporado.  O caminho pode ser local ou de rede ou um endere√ßo da Internet.  O manipulador OLE √© determinado pela extens√£o do arquivo; o manipulador correspondente deve ser registrado no sistema operacional. <br><blockquote>  Exemplo: CVE-2017-0199 <br>  A vulnerabilidade do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2017-0199</a> consistiu na possibilidade de adicionar um formato hta "objeto por refer√™ncia" ao documento.  O √∫ltimo √© o html, com a capacidade de executar c√≥digo, ou seja, √© realmente um arquivo execut√°vel.  O manipulador baixou e executou automaticamente o hta, permitindo executar c√≥digo arbitr√°rio ao abrir um documento. <br></blockquote>  Antes de atualizar o objeto incorporado, o aplicativo solicita permiss√£o do usu√°rio.  Nesse caso, o arquivo √© baixado antecipadamente, o que pode servir para divulgar informa√ß√µes sobre o usu√°rio. <br><br><h3>  Arquivos incorporados (pacotes) </h3><br>  Os documentos do Office suportam a capacidade de adicionar qualquer arquivo (Objeto -&gt; Criar a partir do arquivo ou basta arrastar e soltar o √≠cone do arquivo no campo de edi√ß√£o).  Tecnicamente, isso √© implementado adicionando um elemento <b>interno do Object Packager</b> ao documento que grava o arquivo desejado em seus pr√≥prios dados.  O Object Packager permite substituir o √≠cone e a assinatura do arquivo, al√©m de especificar a linha de comando a ser aberta.  Pode incluir <b>arquivos ‚Äúpor refer√™ncia‚Äù</b> quando o arquivo √© aberto n√£o a partir de seu pr√≥prio armazenamento, mas ao longo do caminho especificado, <b>incluindo o de rede</b> . <br><br>  Recentemente, a funcionalidade do Object Packager foi significativamente reduzida e, inicialmente, o elemento poderia salvar qualquer arquivo, incluindo execut√°vel, links e at√© a linha de comando.  Tudo o que o usu√°rio precisou fazer para iniciar o conte√∫do foi clicar duas vezes no √≠cone no texto do documento. <br><blockquote>  Exemplo: arquivos no corpo de uma mensagem do Outlook <br>  As mensagens do Outlook, que tamb√©m s√£o documentos compostos, permitem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adicionar elementos ao Object Packager ao corpo da mensagem</a> .  Para o usu√°rio, o elemento se parece com uma imagem selecionada arbitrariamente por um invasor.  Clicar duas vezes na imagem abre o arquivo compactado.  Um invasor precisa escolher um tipo de dados dentre aqueles que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ainda n√£o foram objeto de pol√≠ticas de seguran√ßa mais r√≠gidas</a> . <br></blockquote><br><img src="https://habrastorage.org/webt/r-/cl/lr/r-cllr7l101bxg1g7noz3ntrs-c.jpeg"><br><br><h3>  Elementos embutidos n√£o implementados usando OLE </h3><br>  No momento, a maior amea√ßa / interesse de elementos n√£o OLE pode ser <b>imagens adicionadas ao documento por refer√™ncia</b> .  Quando um documento √© aberto em um modo n√£o protegido, as imagens s√£o baixadas automaticamente, o que pode levar √† divulga√ß√£o do local e da identidade do usu√°rio que baixou o documento por meio de proxies an√¥nimos ou recebeu um documento confidencial de terceiros.  Essa t√©cnica, em particular, foi implementada na <b>ferramenta Scribbles</b> , que est√° em servi√ßo com a intelig√™ncia dos EUA. <br>  Em uma rede local do Windows, o download autom√°tico de imagens por refer√™ncia possibilita a explora√ß√£o da <b>vulnerabilidade NTLMRelay</b> .  O mecanismo para vincular imagens n√£o √© compat√≠vel com os requisitos de seguran√ßa das redes do ActiveDirectory, pois um administrador que recebe esse documento executa essencialmente um c√≥digo de invasor com privil√©gios administrativos completos. <br><br><h3>  M√©todos de seguran√ßa </h3><br>  O que pode ser feito?  Em suma, um pouco. <br><br>  O m√©todo mais eficaz de prote√ß√£o contra vulnerabilidades em objetos incorporados em documentos do Office √© <b>o modo de exibi√ß√£o protegida</b> .  Nesse modo, o carregamento de objetos e o carregamento de dados de fontes externas s√£o exclu√≠dos.  Infelizmente, a transi√ß√£o para um modo completo exige a√ß√µes elementares do usu√°rio que s√£o facilmente provocadas pelos m√©todos de engenharia social. <br><br><img src="https://habrastorage.org/webt/4r/7l/x_/4r7lx_il1btctygcoor7a9gmvwc.png"><br><br>  Os controles ActiveX podem ser <b>desativados nas configura√ß√µes da Central de Confiabilidade</b> <br><br><img src="https://habrastorage.org/webt/bf/ev/ol/bfevolvqahqwt-6slndlob7phxq.png"><br><br>  Observe que isso n√£o funciona para elementos embutidos OLE. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423933/">https://habr.com/ru/post/pt423933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423921/index.html">10 anos do Android: lembre-se de tudo</a></li>
<li><a href="../pt423923/index.html">SAP Leonardo Hackathon da velcom e SAP para desenvolvedores da Bielorr√∫ssia</a></li>
<li><a href="../pt423925/index.html">Semin√°rio on-line aberto "Modelo recursivo estranho"</a></li>
<li><a href="../pt423927/index.html">10 motores de busca promissores para melhorar o SEO</a></li>
<li><a href="../pt423931/index.html">Como ignorar a autentica√ß√£o de SMS ao se conectar a redes Wi-Fi p√∫blicas?</a></li>
<li><a href="../pt423935/index.html">A Embox responde a perguntas populares do festival de TI TechTrain</a></li>
<li><a href="../pt423937/index.html">Escalonamento de privil√©gios do Windows</a></li>
<li><a href="../pt423939/index.html">Programa√ß√£o din√¢mica ou dividir e conquistar</a></li>
<li><a href="../pt423941/index.html">Relat√≥rios do iOS mitap Redmadrobot</a></li>
<li><a href="../pt423943/index.html">Otimiza√ß√£o de pre√ßo de varejo offline</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>