<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯМН ЁЯРЗ ЁЯЩЖЁЯП┐ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдЗрди рджрд┐рдиреЛрдВ ЁЯСйЁЯП╗тАНЁЯЪА тШ╕я╕П ЁЯОе</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ: 


- рдкреНрд░рдорд╛рдг рдкрд╣рд▓реЗ рд╕реЗ рд╣реА C ++ , JS рдФрд░ PHP рдореЗрдВ рд▓рд╛рдЧреВ рд╣реИ , рдЬрд╛рд╡рд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред 
- рдХреЛрд░рд╛рдЙрдЯрд╛рдЗрди рдФрд░ рдкреНрд░реЛрдорд┐рд╕ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬрд╝ , рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдПрдБред ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдЗрди рджрд┐рдиреЛрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424311/"><p>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ: </p><br><blockquote><ul><li>  рдкреНрд░рдорд╛рдг рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <strong>C ++</strong> , <strong>JS</strong> рдФрд░ <strong>PHP</strong> рдореЗрдВ рд▓рд╛рдЧреВ <strong>рд╣реИ</strong> , <strong>рдЬрд╛рд╡рд╛</strong> рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред </li><li> рдХреЛрд░рд╛рдЙрдЯрд╛рдЗрди рдФрд░ рдкреНрд░реЛрдорд┐рд╕ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ <strong>рддреЗрдЬрд╝</strong> , рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдПрдБред </li><li>  рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реНрдЯреИрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </li><li>  рд╕рднреА рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдбреАрдмрдЧрд┐рдВрдЧ рдЯреВрд▓ рд╕реЗ рдорд┐рддреНрд░рддрд╛ рдХрд░рддрд╛ рд╣реИред </li><li>  рдпрд╣ рдХрд┐рд╕реА рднреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдХрд▓рдХ рдЭрдВрдбреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред </li></ul><br></blockquote><a name="habracut"></a><br><hr><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреАрдЫреЗ рджреЗрдЦреЛ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">FutoIn AsyncSteps - рдХреЛрд░рдЖрдЙрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдХрд▓реНрдк</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирдВрдмрд░реЛрдВ рдХреЛ</a> </li></ul><br><h2 id="vzglyad-nazad">  рдкреАрдЫреЗ рджреЗрдЦреЛ </h2><br><p>  рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рднреЛрд░ рдореЗрдВ, рдЗрдирдкреБрдЯ-рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рдЕрд╡рд░реЛрдз рдХреЗ рд╕рд╛рде рдПрдХ рдПрдХрд▓ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдерд╛ред  рдлрд┐рд░ рдЗрд╕рдореЗрдВ рд▓реЛрд╣реЗ рдХреА рд░реБрдХрд╛рд╡рдЯ рдбрд╛рд▓реА рдЧрдИред  рдЕрдм рдЖрдк рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдзреАрдореА рдФрд░ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд▓реЛрд╣реЗ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рд╡реГрджреНрдзрд┐ рдФрд░ рдЗрд╕рдХреА рдХрдо рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреЗ рд╕рд╛рде, рдХрдИ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рдЧрдпрд╛, рдЬреЛ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рдереЗред  рдЗрд╕рд▓рд┐рдП рд╕рдВрдХреЗрддреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЛрд╣реЗ рд╕реЗ рдЕрдореВрд░реНрдд рд╡реНрдпрд╡рдзрд╛рди рдХреЗ рд╕рд╛рде рдкреГрдердХ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдереАрдВред </p><br><p>  рдЕрдЧрд▓рд╛ рд╡рд┐рдХрд╛рд╕рд╡рд╛рджреА рдЪрд░рдг рдмрд╣реБрдЖрдпрд╛рдореА рдерд╛, рдЬрд┐рд╕реЗ рд╕рдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдиреАрдВрд╡ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рд╕реНрдореГрддрд┐ рдФрд░ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рд╕рд╛рдЭрд╛ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рдеред  рд╕реБрд░рдХреНрд╖рд┐рдд рдУрдПрд╕ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЕрдкрдиреА рд╕реАрдорд╛рдПрдВ рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдУрд╡рд░рд╣реЗрдб рд╣реИрдВред </p><br><p>  рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП, рд╡рд╛рджрд╛ / рднрд╡рд┐рд╖реНрдп рдЕрдореВрд░реНрдд 40 + рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </p><br><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлреЗрд╕ рдФрд░ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╣рд╛рд╕реНрдпрд╛рд╕реНрдкрдж 10K рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рдорд╕реНрдпрд╛ рдиреЗ рдЗрд╡реЗрдВрдЯ рд▓реВрдк, рд░рд┐рдПрдХреНрдЯрд░ рдФрд░ рдкреНрд░реЙрдХреНрдЯрд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдпрд╛ рд╣реИ, рдЬреЛ рд╕реНрдкрд╖реНрдЯ, рд╕реБрд╕рдВрдЧрдд рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдШрдЯрдирд╛-рдЙрдиреНрдореБрдЦ рд╣реИрдВред </p><br><p>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рдЖрдзреБрдирд┐рдХ рдХреЛрд░рдЯрд╛рдЗрди (рдХреЛрд░рдЯрд╛рдЗрди) рдХреЗ рдкрд╛рд╕ рдЖрдП, рдЬреЛ рдХрд┐ рддрддреНрд╕рдВрдмрдВрдзреА рддрдХрдиреАрдХреА рд╕реАрдорд╛рдУрдВ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдирд┐рдпрддрд╛рддреНрдордХ рд╣рд╕реНрддрд╛рдВрддрд░рдг рдХреЗ рд╕рд╛рде рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рд╕рд╛рд░ рдХреЗ рдКрдкрд░ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдПрдХ рдЕрдиреБрдХрд░рдг рд╣реИред </p><br><p>  рдШрдЯрдирд╛рдУрдВ, рдкрд░рд┐рдгрд╛рдореЛрдВ рдФрд░ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡реЗ рд╕рднреА рд╡рд╛рджрд╛ / рднрд╡рд┐рд╖реНрдп рдХреА рдПрдХ рд╣реА рдЕрд╡рдзрд╛рд░рдгрд╛ рдкрд░ рд▓реМрдЯ рдЖрдПред  рдХреБрдЫ рдХрд╛рд░реНрдпрд╛рд▓рдпреЛрдВ рдиреЗ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рдирд╛рдо рджреЗрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ - "рдХрд╛рд░реНрдп"ред </p><br><p> рдЕрдВрдд рдореЗрдВ, рдЙрдиреНрд╣реЛрдВрдиреЗ рд╕рдм рдХреБрдЫ рдПрдХ рд╕реБрдВрджрд░ <code>async/await</code> рдкреИрдХреЗрдЬ рдореЗрдВ рдЫрд┐рдкрд╛ рджрд┐рдпрд╛, рдЬрд┐рд╕реЗ рддрдХрдиреАрдХ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрдХрд▓рдХ рдпрд╛ рдЕрдиреБрд╡рд╛рджрдХ рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><h3 id="problemy-s-tekuschiy-situaciy-asinhronnoy-biznes-logiki">  рд╡рд░реНрддрдорд╛рди рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдПрдВ </h3><br><p>  рдХреЗрд╡рд▓ coroutines рдФрд░ Promise рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, <code>async/await</code> рд╕рд╛рде рд╕рдЬрд╛рдпрд╛ рдЧрдпрд╛, рдЬреИрд╕рд╛ рдХрд┐  рдкреБрд░рд╛рдиреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдореЗрдВ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдЕрд╕реНрддрд┐рддреНрд╡ рд╣реА рд╡рд┐рдХрд╛рд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдпреЗ рджреЛрдиреЛрдВ рд╢рдмреНрдж рд╕рдорд╛рди рдирд╣реАрдВ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдИрд╕реАрдПрдордПрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреЛрдИ рдХреЛрд░рдЯрд╛рдЗрди рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди <code>Promise</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рдВрдЯреИрдХреНрдЯрд┐рдХ рд░рд╛рд╣рдд рд╣реИ, рдЬреЛ рдмрджрд▓реЗ рдореЗрдВ рдХреЗрд╡рд▓ рдХреЙрд▓рдмреИрдХ рдирд░рдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд╛ рдЖрдпреЛрдЬрди рдХрд░рддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, V8 рдЬреИрд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рдЗрдВрдЬрди рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ рдФрд░ рд╢реБрджреНрдз <code>async/await</code> рдХрд╛рд░реНрдпреЛрдВ рдФрд░ рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдХреВрд▓рди рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ <code>co_async/co_await</code> рдХрд┐ рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрд╕рд╛рдзрди рдкрд░</a> C ++ 17 рдореЗрдВ рдирд╣реАрдВ рдЖрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рд╡рд┐рд╢рд╛рд▓рдХрд╛рдп рдХреЛрд░рд╛рдЙрдЯреАрди рд╕реЗ рджрдмрд╛рд╡ рдорд╛рдирдХ рд░реВрдк рдореЗрдВ рдЙрдирдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рдмреАрдЪ, рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реВрдк рд╕реЗ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╕рдорд╛рдзрд╛рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Boost.Context</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Boost.Fiber</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Boost.Coroutine2 рд╣реИ</a> ред </p><br><p>  рдЬрд╛рд╡рд╛ рдореЗрдВ, рднрд╛рд╖рд╛ рдХреЗ рд╕реНрддрд░ рдкрд░ рдЕрднреА рднреА рдХреЛрдИ <code>async/await</code> рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">EA Async</a> рдЬреИрд╕реЗ рд╕рдорд╛рдзрд╛рди рд╣реИрдВ, рдЬреЛ Boost.Context рдХреА рддрд░рд╣, JVM рдФрд░ рдХреЛрдб рдмрд╛рдЗрдЯ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдЧреЛ рдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреЙрд░рдЖрдЙрдЯ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рдЦреБрд▓реА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓реЗрдЦ рдФрд░ рдмрдЧ рд░рд┐рдкреЛрд░реНрдЯ рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реИред  рд╢рд╛рдпрдж рдПрдХ рдкреНрд░рдмрдВрдзрд┐рдд рдирд┐рдХрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрд░рдЯрд╛рдЗрди рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдЦреЛрдирд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рд╣реИред </p><br><h4 id="mnenie-avtora-soprogrammy-na-golom-zheleze-opasny">  рд▓реЗрдЦрдХ рдХреА рд░рд╛рдп: рдирдВрдЧреЗ-рдзрд╛рддреБ рдХреЛрд░рдЯрд╛рдЗрди рдЦрддрд░рдирд╛рдХ рд╣реИрдВ </h4><br><p>  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рд▓реЗрдЦрдХ рдХреЗ рдкрд╛рд╕ рдЧрддрд┐рд╢реАрд▓ рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдХреЛрд░рдЯрд╛рдЗрди рдХреЗ рдЦрд┐рд▓рд╛рдл рдмрд╣реБрдд рдХрдо рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╣ рдорд╢реАрди рдХреЛрдб рдХреЗ рд╕реНрддрд░ рдкрд░ рд╕реНрдЯреИрдХ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдЫреЗрдбрд╝рдЦрд╛рдиреА рд╕реЗ рдмреЗрд╣рдж рд╕рд╛рд╡рдзрд╛рди рд╣реИред </p><br><p>  рдХреБрдЫ рдмрд┐рдВрджреБ: </p><br><ol><li>  рдвреЗрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛: <br><ul><li>  рдвреЗрд░ рдкрд░ рдвреЗрд░ рдХреЗ рдХрдИ рдиреБрдХрд╕рд╛рди рд╣реИрдВ: рдЕрддрд┐рдкреНрд░рд╡рд╛рд╣ рдХреЗ рд╕рдордп рдкрд░ рдирд┐рд░реНрдзрд╛рд░рдг рдХреА рд╕рдорд╕реНрдпрд╛рдПрдВ, рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХреНрд╖рддрд┐ рдФрд░ рдЕрдиреНрдп рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ / рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ, </li><li>  рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдЯреИрдХ рдХреЗ рд▓рд┐рдП рдХрдо рд╕реЗ рдХрдо рдПрдХ рдкреГрд╖реНрда рднреМрддрд┐рдХ рдореЗрдореЛрд░реА, рдПрдХ рд╕рд╢рд░реНрдд рдкреГрд╖реНрда рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдУрд╡рд░рд╣реЗрдб рдХреЛ <code>async</code> рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: 4 + KB (рдиреНрдпреВрдирддрдо) + рдмрдврд╝реА рд╣реБрдИ рд╕рд┐рд╕реНрдЯрдо рд╕реАрдорд╛рдПрдБ, </li><li>  рдЕрдВрддрддрдГ, рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдореЗрдореЛрд░реА рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рдХреЛрд░рдЯрд╛рдЙрди рдбрд╛рдЙрдирдЯрд╛рдЗрдо рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul></li><li>  рдХреЛрд░рдЯрд╛рдЗрдиреНрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрдЪрд╛рдиреЗ, рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХрд╛ рдПрдХ рдЬрдЯрд┐рд▓ рддрд░реНрдХ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: <br><ul><li>  рдкреНрд░реЛрд╕реЗрд╕рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ (рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдореЙрдбрд▓) рдФрд░ рдмрд╛рдЗрдирд░реА рдЗрдВрдЯрд░рдлреЗрд╕ (рдПрдмреАрдЖрдИ) рдХреЗ рд╣рд░ рдорд╛рдорд▓реЗ рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдП</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрджрд╛рд╣рд░рдг</a> , </li><li>  рдирдИ рдпрд╛ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрд╡реНрдпрдХреНрдд рд╕рдорд╕реНрдпрд╛рдУрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрдВрдЯреЗрд▓ TSX, ARM рд╕рд╣-рдкреНрд░реЛрд╕реЗрд╕рд░ рдпрд╛ MIPS) рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреА рд╣реИрдВред </li><li>  рдорд╛рд▓рд┐рдХрд╛рдирд╛ рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рдХрд╛рд░рдг рдЕрдиреНрдп рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдВ рдмрдВрдж рджрд╕реНрддрд╛рд╡реЗрдЬ (рдмреВрд╕реНрдЯ рдкреНрд░рд▓реЗрдЦрди рдЗрд╕реА рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ)ред </li></ul></li><li>  рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЙрдкрдХрд░рдг рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рд╛рде рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдВ: <br><ul><li>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╡реИрд▓реНрдЧреНрд░рд┐рдВрдб рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдПрдХ рд╣реА рдЬрдореНрдкрд┐рдВрдЧ рд╕реНрдЯреИрдХ, </li><li>  рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рдХреЗ рд▓рд┐рдП рдмреЛрд▓рдирд╛ рдХрдард┐рди рд╣реИ, рд▓реЗрдХрд┐рди рд╢рд╛рдпрдж рд╡реЗ рдЕрддреАрдд рдореЗрдВ рдЬреЗрд╡реАрдПрдо рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдЗрд╕реЗ рдкрд╕рдВрдж рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, </li><li>  рдореБрдЭреЗ рдпрдХреАрди рд╣реИ рдХрд┐ рдирдП рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣рдорд▓реЗ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗ рдФрд░ рдХреЛрд░рдЯрд╛рдЗрди рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╕реЗ рдЬреБрдбрд╝реА рдХрдордЬреЛрд░рд┐рдпрд╛рдВ рд╕рд╛рдордиреЗ рдЖрдПрдВрдЧреАред </li></ul></li></ol><br><h4 id="mnenie-avtora-generatory-i-yield-principialnoe-zlo">  рд▓реЗрдЦрдХ рдХреА рд░рд╛рдп: рдЬрдирд░реЗрдЯрд░ рдФрд░ <code>yield</code> рдореМрд▓рд┐рдХ рдмреБрд░рд╛рдИ </h4><br><p>  рдпрд╣ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рддреГрддреАрдп-рдкрдХреНрд╖ рдереАрдо рд╕реАрдзреЗ рддреМрд░ рдкрд░ рдХреЙрд░рдЖрдЙрдЯреНрд╕ рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдФрд░ "рдЬрд╛рд░реА" рд╕рдВрдкрддреНрддрд┐ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред </p><br><p>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдХрд┐рд╕реА рднреА рд╕рдВрдЧреНрд░рд╣ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореМрдЬреВрдж рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред  рдХреНрд░реЙрдкреНрдб рдЗрдЯреЗрд░реЗрдЯрд░-рдЬреЗрдирд░реЗрдЯрд░ рд╕рдорд╕реНрдпрд╛ рдХреНрдпреЛрдВ рдмрдирд╛рддреЗ рд╣реИрдВ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкрд╛рдпрдерди рдореЗрдВ <code>range()</code> рд╕рд╛рде рдПрдХ рдорд╛рдорд▓рд╛ рддрдХрдиреАрдХреА рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣рд╛рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢реЛ рдСрдл рд╣реИред </p><br><p>  рдпрджрд┐ рдорд╛рдорд▓рд╛ рдПрдХ рдЕрдирдВрдд рдЬрдирд░реЗрдЯрд░ рд╣реИ, рддреЛ рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рддрд░реНрдХ рдкреНрд░рд╛рдердорд┐рдХ рд╣реИред  рдПрдХ рдЕрдВрддрд╣реАрди рдЪрд▓ рд░рд╣реЗ рдЪрдХреНрд░ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рддрдХрдиреАрдХреА рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХреНрдпреЛрдВ рдХрд░реЗрдВред </p><br><p>  рдПрдХрдорд╛рддреНрд░ рд╕рдордЭрджрд╛рд░ рдФрдЪрд┐рддреНрдп рдЬреЛ рдмрд╛рдж рдореЗрдВ рдЙрднрд░рд╛ рдХрд┐ рдХреЙрд░рдЖрдЙрдЯ рдХреЗ рдкреНрд░рд╕реНрддрд╛рд╡рдХ рдЙрд▓реНрдЯреЗ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд╕рд╛рде рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реНрдЯреНрд░реАрдо рдкрд╛рд░реНрд╕рд░ рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕реНрддрд░ рдкрд░ рдПрдХрд▓ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХреАрд░реНрдг рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛ рд╣реИ, рди рдХрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХреЗ рд▓рд┐рдПред  рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдкрд░рд┐рдорд┐рдд рд░рд╛рдЬреНрдп рдорд╢реАрдиреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реБрд░реБрдЪрд┐рдкреВрд░реНрдг, рд╕рд░рд▓ рдФрд░ рдЕрдзрд┐рдХ рд╡рд░реНрдгрдирд╛рддреНрдордХ рд╕рдорд╛рдзрд╛рди рд╣реИред  рдЗрди рддрдХрдиреАрдХреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рдЖрдо рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рд╣реИред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рд▓ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдорд╕реНрдпрд╛ рдПрдХ рдЙрдВрдЧрд▓реА рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдФрд░ рджреАрд░реНрдШрдХрд╛рд▓рд┐рдХ рд╕рдорд░реНрдерди рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЧрдВрднреАрд░ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрддрдирд╛ рдХреБрдЫ рд╣реИ рдХрд┐ рдХреБрдЫ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ <code>goto</code> рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдЙрджрд╛рд╣рд░рдг рдпрд╛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЙрджреНрдпреЛрдЧреЛрдВ рдореЗрдВ рдЧрддрд┐рд╢реАрд▓ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рдж рдорд╢реАрди рдХреЛрдб рд╕реНрддрд░ рдХреЗ рдХреЛрд░рдЖрдЙрдЯ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рд▓рдЧрд╛ рд╕рдХрддреА рд╣реИрдВред </p><br><h4 id="mnenie-avtora-model-asyncawait-na-promise-iz-ecmascript-bolee-nadyozhna-no-trebuet-adaptacii">  рд▓реЗрдЦрдХреЛрдВ рдХреА рд░рд╛рдп: ECMAScript рдХрд╛ <code>async/await</code> рд╡рд╛рджрд╛ рдореЙрдбрд▓ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдиреБрдХреВрд▓рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </h4><br><p>  рдХреЙрд░рдЯрд╛рдЗрдиреНрд╕ рдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЗрд╕ рдореЙрдбрд▓ рдореЗрдВ рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдЧреБрдкреНрдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рдЧреИрд░-рд░реБрдХрд╛рд╡рдЯ рд╡рд╛рд▓реЗ рдмреНрд▓реЙрдХ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  C ++ рдореЗрдВ, рдпрд╣ рд╕реНрдореГрддрд┐ рдкреНрд░рдмрдВрдзрди рдХреА рдЦрд╝рд╛рд╕рд┐рдпрдд рдХреЗ рдХрд╛рд░рдг рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реИ, рдПрдХ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeObject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;; <span class="hljs-function"><span class="hljs-function">Promise </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">funcPromise</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Promise.resolved(value_); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">funcCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">()&gt; &amp;&amp;cb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value&amp; val)</span></span></span><span class="hljs-function"> </span></span>{ somehow_call_later(cb); } Value value_; }; <span class="hljs-function"><span class="hljs-function">Promise </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SomeObject some_obj; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> some_obj.funcPromise() .<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>([](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception &amp;e){ <span class="hljs-comment"><span class="hljs-comment">// ... }) .then([&amp;](SomeObject::value &amp;&amp;val){ return Promise([&amp;](Resolve&amp;&amp; resolve, Reject&amp;&amp;){ some_obj.funcCallback(resolve, val); }); }); }</span></span></code> </pre> <br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <code>some_obj</code> рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЬрдм <code>example()</code> рдмрд╛рд╣рд░ <code>some_obj</code> <code>example()</code> рдФрд░ рд▓реИрдореНрдмреНрдбрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗред </p><br><p>  рджреВрд╕рд░реЗ, рд▓реИрдореНрдмреНрдбрд╛ рдЪрд░ рдпрд╛ рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдЧреБрдкреНрдд рд░реВрдк рд╕реЗ рдХреЙрдкреА / рдореВрд╡ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХреИрдкреНрдЪрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдирдХрд╛рд░рд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп <code>std::function</code> рдореЗрдВ рдЯрд╛рдЗрдк рдЗрд░реЗрдЬ рдХреЗ рджреМрд░рд╛рди рд╣реАрдк рдкрд░ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рддреАрд╕рд░реА рдмрд╛рдд, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХреЗ рд▓рдЧрд╛рддрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдмрдЬрд╛рдп, <code>Promise</code> рдЗрдВрдЯрд░рдлреЗрд╕ рдХреА рдХрд▓реНрдкрдирд╛ "рдкрд░рд┐рдгрд╛рдо" рдХреЗ рд╡рд╛рджреЗ рдкрд░ рдХреА рдЧрдИ рдереАред </p><br><p>  рдПрдХ рдпреЛрдЬрдирд╛рдмрджреНрдз рдирд╣реАрдВ рдЗрд╖реНрдЯрддрдо рд╕рдорд╛рдзрд╛рди рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Promise </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalContext</span></span></span><span class="hljs-class"> {</span></span> SomeObject some_obj; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ctx = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt;LocalContext&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> some_obj.funcPromise() .<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>([](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception &amp;e){ <span class="hljs-comment"><span class="hljs-comment">// ... }) .then([ctx](SomeObject::Value &amp;&amp;val){ struct LocalContext2 { LocalContext2(std::shared_ptr&lt;LocalContext&gt; &amp;&amp;ctx, SomeObject::Value &amp;&amp;val) : ctx(ctx), val(val) {} std::shared_ptr&lt;LocalContext&gt; ctx; SomeObject::Value val; }; auto ctx2 = std::make_shared&lt;LocalContext2&gt;( std::move(ctx), std::forward&lt;SomeObject::Value&gt;(val) ); return Promise([ctx2](Resolve&amp;&amp; resolve, Reject&amp;&amp;){ ctx2-&gt;ctx-&gt;some_obj.funcCallback([ctx2, resolve](){ resolve(); }, val); }); }); }</span></span></code> </pre> <br><p>  <em>рдиреЛрдЯ: <code>std::move</code> рдмрдЬрд╛рдп <code>std::move</code> <code>std::shared_ptr</code> рдХрдИ рд▓реИрдореНрдмреНрдбрд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрдерддрд╛ рдФрд░ рдЙрдирдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдХрд╛рд░рдг рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реИред</em> </p><br><p>  <code>async/await</code> рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рднрдпрд╛рд╡рд╣рддрд╛ рдПрдХ рд╕реБрдкрд╛рдЪреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЖрддреА рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">async </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SomeObject some_obj; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { SomeObject::Value val = await some_obj.func(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception&amp; e) ( <span class="hljs-comment"><span class="hljs-comment">// ... } // Capture "async context" return Promise([async](Resolve&amp;&amp; resolve, Reject&amp;&amp;){ some_obj.funcCallback([async](){ resolve(); }, val); }); }</span></span></code> </pre> <br><h4 id="mnenie-avtora-planirovschik-soprogramm---eto-perebor">  рд▓реЗрдЦрдХ рдХреА рд░рд╛рдп: рдХреЛрд░рдЯрд╛рдЗрди рдкреНрд▓рд╛рдирд░ рдПрдХ рд╣рд▓рдЪрд▓ рд╣реИ </h4><br><p>  рдХреБрдЫ рдЖрд▓реЛрдЪрдХ рдПрдХ рдЕрдиреБрд╕реВрдЪрдХ рдХреА рдХрдореА рдФрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ "рдмреЗрдИрдорд╛рди" рдЙрдкрдпреЛрдЧ рдХреЛ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдХрд╣рддреЗ рд╣реИрдВред  рд╢рд╛рдпрдж рдЕрдзрд┐рдХ рдЧрдВрднреАрд░ рд╕рдорд╕реНрдпрд╛ рдбреЗрдЯрд╛ рд╕реНрдерд╛рдиреАрдпрддрд╛ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреИрд╢ рдХрд╛ рдХреБрд╢рд▓ рдЙрдкрдпреЛрдЧ рд╣реИред </p><br><p>  рдкрд╣рд▓реА рд╕рдорд╕реНрдпрд╛ рдкрд░: рд╡реНрдпрдХреНрддрд┐рдЧрдд coroutines рдХреЗ рд╕реНрддрд░ рдкрд░ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдПрдХ рдмрдбрд╝реЗ рдЙрдкрд░рд┐ рдХреА рддрд░рд╣ рд▓рдЧрддреА рд╣реИред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╡реЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдПрдХреАрдХреГрдд рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЯреНрд░реИрдлрд┐рдХ рдлреНрд▓реЛ рдпрд╣реА рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ "рд▓реЛрд╣реЗ" рдзрд╛рдЧреЗ рдФрд░ рдУрдПрд╕ рд╕реНрддрд░ рдкрд░ рдпреЛрдЬрдирд╛ рдХреЗ рд╕рд╛рде рдЗрд╡реЗрдВрдЯ рд▓реВрдк рдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдВрднрд╡ рд╣реИред  рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛ рдФрд░ / рдпрд╛ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдПрдХ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЖрджрд┐рдо (рдореНрдпреВрдЯреЗрдХреНрд╕, рдереНрд░реЙрдЯрд▓) рдЖрджрд┐рдо рдХреЗ рд╕рд╛рде рдХреЛрд░рдЖрдЙрдЯ рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рд╣реИред </p><br><p>  рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд░рдмрд░рдпреБрдХреНрдд рдирд╣реАрдВ рдмрдирд╛рддреА рд╣реИ рдФрд░ рдХреБрд▓ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдкрд░ рдПрдХ рд╕рд╛рде рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдФрд░ рд╕реАрдорд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рддрд┐рдмрдВрдз рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдПрдХ coroutine рдкрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЕрд╡рд░реБрджреНрдз рд╣реЛрдиреЗ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рдХреЗ рд╕рд╛рде рд╕рдорд╛рди рдЙрдкрд╛рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ - рдмреНрд▓реЙрдХрд┐рдВрдЧ рдХреЙрд▓ рдФрд░ рд▓рдВрдмреА рдбреЗрдЯрд╛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдЪрдХреНрд░ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдПред </p><br><p>  рджреВрд╕рд░реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рд▓рд┐рдП рд╢реЛрдз рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрдо рд╕реЗ рдХрдо рдХреЛрд░рдЯрд╛рдЗрди рдЦреБрдж рдХреЛ рдвреЗрд░ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдлреНрдпреВрдЪрд░ / рдкреНрд░реЙрдорд┐рд╕ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рд╡рд┐рд╡рд░рдг рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдбреЗрдЯрд╛ рдХреА рд╕реНрдерд╛рдиреАрдпрддрд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рднрд╡рд┐рд╖реНрдп рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдорд╛рдпрдиреЗ рд░рдЦрддрд╛ рд╣реИ рддреЛ рдЙрд╕реА рдХреЙрд░рдЯреАрди рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рд╣реИред  рдкреВрд░реЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдордп рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рд╕реЗ рдПрдХ рдХреЛрд░рдЯрд╛рдЗрди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдпрд╛ рдРрд╕реА рдирд┐рд░рдВрддрд░рддрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рддрдВрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдпрд╣ рдпрд╛ рддреЛ рдкрд░рд┐рдгрд╛рдо рдирд╣реАрдВ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреИрд╢ рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рдереНрд░реЗрдбреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрд╣реБрдд рд╣реА рджреБрдЧреБрдирд╛ рдкрд░рд┐рдгрд╛рдо рджреЗ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдПрдХ рддреАрд╕рд░рд╛ рдмрд┐рдВрджреБ рднреА рд╣реИ - рдХреЛрд░рдЯрд╛рдЗрди рд╢реЗрдбреНрдпреВрд▓рд░реНрд╕ рдХреЗ рдХрдИ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛрд░ рдкрд░ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рдЬреЛ рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рд╕рд╛рдЭрд╛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдкрд░ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдХрд╛рд░рдг рд╕рдорд╕реНрдпрд╛рдПрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рдПрдХрд▓ рдИрд╡реЗрдВрдЯ рд▓реВрдк рд╕реНрдЯреНрд░реАрдо рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗрд╡рд▓ рддрд╛рд░реНрдХрд┐рдХ рд╕реНрддрд░ рдкрд░ рд╣реЛрддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдкреНрд░рддреНрдпреЗрдХ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЙрд▓рдмреИрдХ рдмреНрд▓реЙрдХ рдХреЛ рджреВрд╕рд░реЛрдВ рдХреЗ рд╕рд╛рде рджреМрдбрд╝ рдХреЗ рдмрд┐рдирд╛ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЧрд╛рд░рдВрдЯреА рд╣реИред </p><br><h4 id="mnenie-avtora-vsyo-horosho-v-meru">  рд▓реЗрдЦрдХ рдХреА рд░рд╛рдп: рдореЙрдбрд░реЗрд╢рди рдореЗрдВ рд╕рдм рдХреБрдЫ рдЕрдЪреНрдЫрд╛ рд╣реИ </h4><br><p>  рдЖрдзреБрдирд┐рдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдереНрд░реЗрдбреНрд╕ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдирдХрд╛рд░рддреА рдирд╣реАрдВ рд╣реИред  рд╕рд╛рде рд╣реА, рдЗрд╡реЗрдВрдЯ рд▓реВрдк рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдирд╛ рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреГрдердХ "рдЖрдпрд░рди" рдереНрд░реЗрдбреНрд╕ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдирдХрд╛рд░рддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><p>  рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдХреЛрд░ рд▓реВрдкреНрд╕ рдФрд░ рдЗрд╡реЗрдВрдЯ рд▓реВрдкреНрд╕ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрд░рд┐рдПрдВрдЯ рдЯреВрд▓реНрд╕ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╕рдорд░реНрдерди рдХреЗ рдмрд┐рдирд╛ рдбрд┐рдмрдЧрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЬрдЯрд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдХреЛрд░рдЖрдЙрдЯ рд╕реНрдЯреИрдХ рдкрд░ рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рдФрд░ рднреА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ - рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рд▓рд┐рдП рдХреЛрдИ рд░рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><hr><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2p/pp/lb/2ppplbzrvm8c0yvbasdwrojknss.png" width="326" height="326"></div><br><h2 id="futoin-asyncsteps---alternativa-soprogrammam">  FutoIn AsyncSteps - рдХреЛрд░рдЖрдЙрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдХрд▓реНрдк </h2><br><p>  рд╣рдо ECMAScript (рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ) рд╡рд╛рджрд╛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрдерд╛рдкрд┐рдд рдЗрд╡реЗрдВрдЯ рд▓реВрдк рдкреИрдЯрд░реНрди рдФрд░ рдХреЙрд▓рдмреИрдХ рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд╕рдВрдЧрдарди рдХреЗ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрддреЗ рд╣реИрдВред </p><br><p>  рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЬрдирд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╣рдо рдЗрд╡реЗрдВрдЯ рд▓реВрдк рд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ: </p><br><ol><li>  <code>Handle immediate(callack)</code> рдПрдХ рд╕рд╛рдл рдХреЙрд▓ рд╕реНрдЯреИрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </li><li>  рдЖрд╕реНрдердЧрд┐рдд рдХреЙрд▓рдмреИрдХ <code>Handle deferred(delay, callback)</code> ред </li><li>  рдХреЙрд▓рдмреИрдХ <code>handle.cancel()</code> рд░рджреНрдж рдХрд░реЗрдВ <code>handle.cancel()</code> ред </li></ol><br><p>  рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ <code>AsyncTool</code> рдирд╛рдо рдХрд╛ рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдорд┐рд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдХрдИ рддрд░реАрдХреЛрдВ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореМрдЬреВрджрд╛ рд╕рд┐рджреНрдз рдШрдЯрдирд╛рдХреНрд░рдо рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред  рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рдЙрдирдХрд╛ рдХреЛрдИ рд╕реАрдзрд╛ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЖрдЧреЗ рдХреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдПрдВрдЧреЗред </p><br><h3 id="derevo-shagov">  рдЪрд░рдгреЛрдВ рдХрд╛ рдкреЗрдбрд╝: </h3><br><p>  AsyncSteps рдЕрд╡рдзрд╛рд░рдгрд╛ рдореЗрдВ, рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдЪрд░рдгреЛрдВ рдХреЗ рдПрдХ рд╕рд╛рд░ рдкреЗрдбрд╝ рдХреЛ рдкрдВрдХреНрддрд┐рдмрджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдирд┐рд░реНрдорд╛рдг рдЕрдиреБрдХреНрд░рдо рдореЗрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдХрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЧрд╣рд░рд╛ рд╕реНрддрд░ рдХреЗ рдЪрд░рдг рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдорд╛рд░реНрдЧ рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИред </p><br><p>  рд╕рднреА рдЗрдВрдЯрд░реИрдХреНрд╢рди рдПрдХ рдПрдХрд▓ <code>AsyncSteps</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <code>AsyncSteps</code> рд╣реИ, рдЬреЛ рдХрд┐ рдХрдиреНрд╡реЗрдВрд╢рди рджреНрд╡рд╛рд░рд╛, рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рдореНрдореЗрд▓рди рджреНрд╡рд╛рд░рд╛, рдкреИрд░рд╛рдореАрдЯрд░ рдирд╛рдо <code>asi</code> рдпрд╛ рдкрджрд╛рд╡рдирдд <code>as</code> ред  рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЖрдкрдХреЛ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдФрд░ рд▓реЗрдЦрди рд╡реНрдпрд╡рд╕рд╛рдп рддрд░реНрдХ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдз рдХреЛ рд▓рдЧрднрдЧ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рд╡рд┐рд╣рд┐рдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиреЛрдВ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЕрдкрдирд╛ рдЙрджрд╛рд╣рд░рдг рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ <code>AsyncSteps</code> рд▓рд╛рдЧреВ <code>AsyncSteps</code> , рдЬреЛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рддрд╛рд░реНрдХрд┐рдХ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рд╕рдордп рдкрд░ рдирдЬрд╝рд░ рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рд╕рд╛рд░ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="hljs lua"> asi.add( // Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> func( asi ){ <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 func"</span></span> ) asi.add( // Level <span class="hljs-number"><span class="hljs-number">1</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> func( asi ){ <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 1 func"</span></span> ) asi.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>( <span class="hljs-string"><span class="hljs-string">"MyError"</span></span> ) }, onerror( asi, <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> ){ // Level <span class="hljs-number"><span class="hljs-number">1</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> catch <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 1 onerror: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> ) asi.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>( <span class="hljs-string"><span class="hljs-string">"NewError"</span></span> ) } ) }, onerror( asi, <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> ){ // Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> catch <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 onerror: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> strequal <span class="hljs-string"><span class="hljs-string">"NewError"</span></span> ) { asi.success( <span class="hljs-string"><span class="hljs-string">"Prm"</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } } ) asi.add( // Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">2</span></span> func( asi, str_param, int_param, array_param ){ <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 func2: "</span></span> + param ) } )</code> </pre> <br><p>  рдирд┐рд╖реНрдкрд╛рджрди рдкрд░рд┐рдгрд╛рдо: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> func <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> func <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> onerror <span class="hljs-number"><span class="hljs-number">1</span></span>: MyError <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> onerror <span class="hljs-number"><span class="hljs-number">1</span></span>: NewError <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> func <span class="hljs-number"><span class="hljs-number">2</span></span>: Prm</code> </pre> <br><p>  рд╕рд┐рдВрдХ рдореЗрдВ, рдпрд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: </p><br><pre> <code class="hljs coffeescript"> str_res, int_res, array_res, bool_res <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 func 1"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Level <span class="hljs-number"><span class="hljs-number">1</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 1 func 1"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"MyError"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error ){ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Level <span class="hljs-number"><span class="hljs-number">1</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 1 onerror 1: "</span></span> + error ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"NewError"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error ){ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 onerror 1: "</span></span> + error ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( error strequal <span class="hljs-string"><span class="hljs-string">"NewError"</span></span> ) { str_res = <span class="hljs-string"><span class="hljs-string">"Prm"</span></span> int_res = <span class="hljs-number"><span class="hljs-number">123</span></span> array_res = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] bool_res = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { re-<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> } } { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Level <span class="hljs-number"><span class="hljs-number">0</span></span> step <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( <span class="hljs-string"><span class="hljs-string">"Level 0 func 2: "</span></span> + str_res ) }</code> </pre> <br><p>  рдкрд╛рд░рдВрдкрд░рд┐рдХ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдХреА рдЕрдзрд┐рдХрддрдо рдирдХрд▓ рддреБрд░рдВрдд рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕реЗ рдкрдардиреАрдпрддрд╛ рдореЗрдВ рдорджрдж рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред </p><br><p>  рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд░реНрдХ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреА</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрдбрд╝реА рдЧрд╛рдВрда</a> рд╕рдордп рдХреЗ рд╕рд╛рде рдмрдврд╝рддреА рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рдордЭреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдиреАрдЪреЗ рд╡рд░реНрдгрд┐рдд рд╣реИ, рдЪрд╛рд░ рд╕рд╛рд▓ рд╕реЗ рдЪрд▓ рд░рд╣реЗ рдЕрднреНрдпрд╛рд╕ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИред </p><br><h3 id="bazovye-api-vremeni-vypolneniya">  рдХреЛрд░ рд░рдирдЯрд╛рдЗрдо рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>add(func[, onerror])</code> - <code>try-catch</code> рдирдХрд▓ред </li><li>  <code>success([args...])</code> - рд╕рдлрд▓ рд╕рдорд╛рдкрди рдХрд╛ рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╕рдВрдХреЗрдд: <br><ul><li>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд╣рд┐рдд </li><li>  рдЕрдЧрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдкрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </li></ul></li><li>  <code>error(code[, reason)</code> - рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрди рдХреА рд░реБрдХрд╛рд╡рдЯ: <br><ul><li>  <code>code</code> - рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рдХрд╛рд░ рд╣реИ рдЬреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлрд╝реНрдЯ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ, </li><li>  <code>reason</code> - рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдордирдорд╛рдирд╛ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдгред </li></ul></li><li>  <code>state()</code> - рдереНрд░реЗрдб рд▓реЛрдХрд▓ рд╕реНрдЯреЛрд░реЗрдЬ рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧред  рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕рд╛рд╣рдЪрд░реНрдп рдХреБрдВрдЬреА: <br><ul><li>  <code>error_info</code> - рдХрд┐рд╕реА рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд┐рдо рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг, </li><li>  <code>last_exception</code> - рдЕрдВрддрд┐рдо рдЕрдкрд╡рд╛рдж рдХреА рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдХ, </li><li>  <code>async_stack</code> - рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЙрд▓ рдХрд╛ рдПрдХ рдвреЗрд░ <code>async_stack</code> рддрдХрдиреАрдХ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, </li><li>  рдмрд╛рдХреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </li></ul></li></ol><br><p>  рдкрд┐рдЫрд▓рд╛ рдЙрджрд╛рд╣рд░рдг рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд╛рд╕реНрддрд╡рд┐рдХ C ++ рдХреЛрдб рдФрд░ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;futoin/iasyncsteps.hpp&gt; using namespace futoin; void some_api(IAsyncSteps&amp; asi) { asi.add( [](IAsyncSteps&amp; asi) { std::cout &lt;&lt; "Level 0 func 1" &lt;&lt; std::endl; asi.add( [](IAsyncSteps&amp; asi) { std::cout &lt;&lt; "Level 1 func 1" &lt;&lt; std::endl; asi.error("MyError"); }, [](IAsyncSteps&amp; asi, ErrorCode code) { std::cout &lt;&lt; "Level 1 onerror 1: " &lt;&lt; code &lt;&lt; std::endl; asi.error("NewError", "Human-readable description"); } ); }, [](IAsyncSteps&amp; asi, ErrorCode code) { std::cout &lt;&lt; "Level 0 onerror 1: " &lt;&lt; code &lt;&lt; std::endl; if (code == "NewError") { // Human-readable error info assert(asi.state().error_info == "Human-readable description"); // Last exception thrown is also available in state std::exception_ptr e = asi.state().last_exception; // NOTE: smart conversion of "const char*" asi.success("Prm", 123, std::vector&lt;int&gt;({1, 2, 3}, true)); } } ); asi.add( [](IAsyncSteps&amp; asi, const futoin::string&amp; str_res, int int_res, std::vector&lt;int&gt;&amp;&amp; arr_res) { std::cout &lt;&lt; "Level 0 func 2: " &lt;&lt; str_res &lt;&lt; std::endl; } ); }</span></span></span></span></code> </pre> <br><h3 id="api-dlya-sozdaniya-ciklov">  рд▓реВрдк рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>loop( func, [, label] )</code> - рдПрдХ рдЕрд╕реАрдо рджреЛрд╣рд░рд╛рд╡ рд╡рд╛рд▓реЗ рд╢рд░реАрд░ рдХреЗ рд╕рд╛рде рдХрджрдоред </li><li>  <code>forEach( map|list, func [, label] )</code> - рд╕рдВрдЧреНрд░рд╣ рд╡рд╕реНрддреБ рдХрд╛ рдЪрд░рдг-рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ред </li><li>  <code>repeat( count, func [, label] )</code> - рдЪрд░рдг-рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдордп рдХреА рд╕рдВрдЦреНрдпрд╛ред </li><li>  <code>break( [label] )</code> рдкрд╛рд░рдВрдкрд░рд┐рдХ рд▓реВрдк рд╡реНрдпрд╡рдзрд╛рди рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╣реИред </li><li>  <code>continue( [label] )</code> рдПрдХ рдирдП рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рд╕рд╛рде рдкрд╛рд░рдВрдкрд░рд┐рдХ рд▓реВрдк рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╣реИред </li></ol><br><p>  <em>рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдЖрд░рдХреНрд╖рд┐рдд рд╢рдмреНрджреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ рдирд╛рдо <code>breakLoop</code> , <code>continueLoop</code> рдФрд░ рдЕрдиреНрдп рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред</em> </p><br><p>  C ++ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="cpp hljs"> asi.loop([](IAsyncSteps&amp; asi) { <span class="hljs-comment"><span class="hljs-comment">// infinite loop asi.breakLoop(); }); asi.repeat(10, [](IAsyncSteps&amp; asi, size_t i) { // range loop from i=0 till i=9 (inclusive) asi.continueLoop(); }); asi.forEach( std::vector&lt;int&gt;{1, 2, 3}, [](IAsyncSteps&amp; asi, size_t i, int v) { // Iteration of vector-like and list-like objects }); asi.forEach( std::list&lt;futoin::string&gt;{"1", "2", "3"}, [](IAsyncSteps&amp; asi, size_t i, const futoin::string&amp; v) { // Iteration of vector-like and list-like objects }); asi.forEach( std::map&lt;futoin::string, futoin::string&gt;(), [](IAsyncSteps&amp; asi, const futoin::string&amp; key, const futoin::string&amp; v) { // Iteration of map-like objects }); std::map&lt;std::string, futoin::string&gt; non_const_map; asi.forEach( non_const_map, [](IAsyncSteps&amp; asi, const std::string&amp; key, futoin::string&amp; v) { // Iteration of map-like objects, note the value reference type });</span></span></code> </pre> <br><h3 id="api-integracii-s-vneshnimi-sobytiyami">  рдмрд╛рд╣рд░реА рдШрдЯрдирд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>setTimeout( timeout_ms )</code> - рдПрдХ <code>Timeout</code> рдмрд╛рдж <code>Timeout</code> рддреНрд░реБрдЯрд┐ рдлреЗрдВрдХрддрд╛ рд╣реИ рдпрджрд┐ рдЪрд░рдг рдФрд░ рдЙрд╕рдХреЗ рдЙрдкрдкреНрд░рдХрд╛рд░ рдиреЗ рдирд┐рд╖реНрдкрд╛рджрди рдкреВрд░рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред </li><li>  <code>setCancel( handler )</code> - рд░рджреНрдж рд╣реИрдВрдбрд▓рд░ рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдереНрд░реЗрдб рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд░рджреНрдж рдХрд░рдиреЗ рдФрд░ рддреНрд░реБрдЯрд┐ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдЪрд░рдгреЛрдВ рдХреЗ рдвреЗрд░ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реЛрдиреЗ рдкрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдкреНрд░рддреАрдХреНрд╖рд╛ рдмрд╛рд╣реНрдп <code>waitExternal()</code> - рдПрдХ рдмрд╛рд╣рд░реА рдШрдЯрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдкреНрд░рддреАрдХреНрд╖рд╛ред <br><ul><li>  <em>рдиреЛрдЯ: рдпрд╣ рдХреЗрд╡рд▓ рдХрдЪрд░рд╛ рдмреАрдирдиреЗ рд╡рд╛рд▓реА рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИред</em> </li></ul></li></ol><br><p>  рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрд▓ <code>success()</code> рд▓рд┐рдП рдПрдХ рд╕реНрдкрд╖реНрдЯ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред </p><br><p>  C ++ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="cpp hljs"> asi.add([](IAsyncSteps&amp; asi) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> handle = schedule_external_callback([&amp;](<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> err) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { asi.error(<span class="hljs-string"><span class="hljs-string">"ExternalError"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (...) { <span class="hljs-comment"><span class="hljs-comment">// pass } } else { asi.success(); } }); asi.setCancel([=](IAsyncSteps&amp; asi) { external_cancel(handle); }); }); asi.add( [](IAsyncSteps&amp; asi) { // Raises Timeout error after specified period asi.setTimeout(std::chrono::seconds{10}); asi.loop([](IAsyncSteps&amp; asi) { // infinite loop }); }, [](IAsyncSteps&amp; asi, ErrorCode code) { if (code == futoin::errors::Timeout) { asi(); } });</span></span></code> </pre> <br><p>  ECMAScript рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="javascript hljs">asi.add( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">asi</span></span></span><span class="hljs-function">) =&gt;</span></span> { asi.waitExternal(); <span class="hljs-comment"><span class="hljs-comment">// disable implicit success() some_obj.read( (err, data) =&gt; { if (!asi.state) { // ignore as AsyncSteps execution got canceled } else if (err) { try { asi.error( 'IOError', err ); } catch (_) { // ignore error thrown as there are no // AsyncSteps frames on stack. } } else { asi.success( data ); } } ); } );</span></span></code> </pre> <br><h3 id="api-integracii-s-futurepromise">  рднрд╡рд┐рд╖реНрдп / рд╡рд╛рджрд╛ рдПрдХреАрдХрд░рдг рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>await(promise_future[, on_error])</code> - рдПрдХ рдХрджрдо рдХреЗ рд░реВрдк рдореЗрдВ рднрд╡рд┐рд╖реНрдп / рд╡рд╛рджрд╛ рдХрд░рдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИред </li><li>  <code>promise()</code> - рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдкреВрд░реЗ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдлреНрдпреВрдЪрд░ / рдкреНрд░реЙрдорд┐рд╕ рдореЗрдВ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ <code>execute()</code> рдмрдЬрд╛рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ol><br><p>  C ++ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="hljs pgsql"> [](IAsyncSteps&amp; asi) { // Proper way <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AsyncSteps instances // <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> hard dependency <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> implementation. auto new_steps = asi.newInstance(); new_steps-&gt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>([](IAsyncSteps&amp; asi) {}); // Can be <span class="hljs-keyword"><span class="hljs-keyword">called</span></span> outside <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AsyncSteps event <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> // new_steps.promise().wait(); // <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> // new_steps.promise&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;().<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(); // Proper way <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> standard std::future asi.await(new_steps-&gt;promise()); // Ensure instance lifetime asi.state()["some_obj"] = std::<span class="hljs-keyword"><span class="hljs-keyword">move</span></span>(new_steps); };</code> </pre> <br><h3 id="api-kontrolya-potoka-vypolneniya-biznes-logiki">  рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдкреНрд░рд╡рд╛рд╣ рдирд┐рдпрдВрддреНрд░рдг рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>AsyncSteps(AsyncTool&amp;)</code> рдПрдХ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдИрд╡реЗрдВрдЯ рд▓реВрдк рдкрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдПрдХ рдзрд╛рдЧрд╛ рдмрд╛рдВрдзрддрд╛ рд╣реИред </li><li>  <code>execute()</code> - рдирд┐рд╖реНрдкрд╛рджрди рдереНрд░реЗрдб рдкреНрд░рд╛рд░рдВрдн рдХрд░рддрд╛ рд╣реИред </li><li>  <code>cancel()</code> - рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдзрд╛рдЧреЗ рдХреЛ рд░рджреНрдж рдХрд░рддрд╛ рд╣реИред </li></ol><br><p>  рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдпрд╣рд╛рдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </p><br><p>  C ++ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;futoin/ri/asyncsteps.hpp&gt; #include &lt;futoin/ri/asynctool.hpp&gt; void example() { futoin::ri::AsyncTool at; futoin::ri::AsyncSteps asi{at}; asi.loop([&amp;](futoin::IAsyncSteps &amp;asi){ // Some infinite loop logic }); asi.execute(); std::this_thread::sleep_for(std::chrono::seconds{10}); asi.cancel(); // called in d-tor by fact }</span></span></span></span></code> </pre> <br><h3 id="prochie-api">  рдЕрдиреНрдп рдПрдкреАрдЖрдИ: </h3><br><ol><li>  <code>newInstance()</code> - рдЖрдкрдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рдкреНрд░рддреНрдпрдХреНрд╖ рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рдмрд┐рдирд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдПрдХ рдирдпрд╛ рдзрд╛рдЧрд╛ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </li><li>  <code>sync(object, func, onerror)</code> - рд╕рдорд╛рди, рд▓реЗрдХрд┐рди рд╕рдВрдмрдВрдзрд┐рдд рд╡рд╕реНрддреБ рдХреЗ рд╕рд╛рде рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рдиред </li><li>  <code>parallel([on_error])</code> - рд╡рд┐рд╢реЗрд╖ <code>add()</code> , рдЬрд┐рд╕рдХреЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдЕрд▓рдЧ рд╣реИрдВ AsyncSteps рдзрд╛рд░рд╛рдПрдБ: <br><ul><li>  рд╕рднреА рдереНрд░реЗрдбреНрд╕ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп <code>state()</code> , </li><li>  рд╕рднреА рдмрдЪреНрдЪреЗ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдкрд░ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рд╣рддрд╛ рд╣реИ </li><li>  рдХрд┐рд╕реА рднреА рдмрдЪреНрдЪреЗ рдореЗрдВ рдПрдХ рдЕрдирдХрд╣реА рддреНрд░реБрдЯрд┐ рддреБрд░рдВрдд рдЕрдиреНрдп рд╕рднреА рдмрдЪреНрдЪреЗ рдзрд╛рдЧреЗ рдХреЛ рд░рджреНрдж рдХрд░ рджреЗрддреА рд╣реИред </li></ul></li></ol><br><p>  C ++ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;futoin/ri/mutex.hpp&gt; using namespace futoin; ri::Mutex mtx_a; void sync_example(IAsyncSteps&amp; asi) { asi.sync(mtx_a, [](IAsyncSteps&amp; asi) { // synchronized section asi.add([](IAsyncSteps&amp; asi) { // inner step in the section // This synchronization is NOOP for already // acquired Mutex. asi.sync(mtx_a, [](IAsyncSteps&amp; asi) { }); }); }); } void parallel_example(IAsyncSteps&amp; asi) { using OrderVector = std::vector&lt;int&gt;; asi.state("order", OrderVector{}); auto&amp; p = asi.parallel([](IAsyncSteps&amp; asi, ErrorCode) { // Overall error handler asi.success(); }); p.add([](IAsyncSteps&amp; asi) { // regular flow asi.state&lt;OrderVector&gt;("order").push_back(1); asi.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order").push_back(4); }); }); p.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order").push_back(2); asi.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order").push_back(5); asi.error("SomeError"); }); }); p.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order").push_back(3); asi.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order").push_back(6); }); }); asi.add([](IAsyncSteps&amp; asi) { asi.state&lt;OrderVector&gt;("order"); // 1, 2, 3, 4, 5 }); };</span></span></span></span></code> </pre> <br><h3 id="standartnye-primitivy-dlya-sinhronizacii">  рддреБрд▓реНрдпрдХрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдЖрджрд┐рдо </h3><br><ol><li>  <code>Mutex</code> - рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ <code>N=1, Q=unlimited</code> рджреНрд╡рд╛рд░рд╛ <code>Q</code> рдореЗрдВ <code>Q</code> рд╕рд╛рде <code>N</code> рдереНрд░реЗрдбреНрд╕ рдХреЗ рдПрдХ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред </li><li>  <code>Throttle</code> - <code>P</code> рдореЗрдВ <code>P</code> <code>Q</code> рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ <code>N=1, P=1s, Q=0</code> рджреНрд╡рд╛рд░рд╛ <code>Q</code> рд╕рд╛рде рдЗрдирдкреБрдЯ <code>N</code> рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред </li><li>  <code>Limiter</code> <code>Mutex</code> рдФрд░ <code>Throttle</code> рдХрд╛ рдПрдХ рд╕рдВрдпреЛрдЬрди рд╣реИ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдмрд╛рд╣рд░реА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдФрд░ рд▓реЛрдб рдХреЗ рддрд╣рдд рд╕реНрдерд┐рд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░реА рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдЗрдирдкреБрдЯ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ol><br><p>  рдХрддрд╛рд░ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЛ <code>DefenseRejected</code> рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ <code>DefenseRejected</code> рддреНрд░реБрдЯрд┐ рдХреЛ <code>DefenseRejected</code> , рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде <code>DefenseRejected</code> рд╡рд┐рд╡рд░рдг рд╕реЗ рд╕реНрдкрд╖реНрдЯ рд╣реИред </p><br><h3 id="klyuchevye-preimuschestva">  рдореБрдЦреНрдп рд▓рд╛рдн </h3><br><p>  AsyncSteps рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдПрдХ рдЕрдВрдд рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рд╕рдордп-рд╕реАрдорд╛, рд░рджреНрдж рдХрд░рдиреЗ рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХреЙрд▓рдмреИрдХ рдХреА рд╕рдордЧреНрд░ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рд┐рдд рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдмрд╛рд╣рд░ рдкреИрджрд╛ рд╣реБрдИ рдереАред  рдЙрд╕ рд╕рдордп рдХреЛрдИ рднреА рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ рдФрд░ рдЕрдм рд╕рдорд╛рди рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП: </p><br><p> <strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> FTN12</a>   </strong> тАФ           . </p><br><p> <strong>  <code>setCancel()</code></strong> тАФ                    .       ,     .   RAII  <code>atexit()</code>   . </p><br><p> <strong>   <code>cancel()</code></strong> тАФ     ,         .   <code>SIGTERM</code>  <code>pthread_cancel()</code> ,       . </p><br><p> <strong>   <code>setTimeout()</code></strong> тАФ                 .    ,    "Timeout". </p><br><p> <strong>     </strong> тАФ  FutoIn AsyncSteps             . </p><br><p> <strong>      </strong> тАФ          ABI     ,    .    Embedded     MMU. </p><br><hr><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yj/8x/wv/yj8xwvibm7tjsj30qhojwbleige.jpeg"></div><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><em> </em></a> </p><br><h2 id="k-cifram">   </h2><br><p>    Intel Xeon E3-1245v2/DDR1333  Debian Stretch    . </p><br><p>   : </p><br><ol><li> Boost.Fiber  <code>protected_fixedsize_stack</code> . </li><li> Boost.Fiber  <code>pooled_fixedsize_stack</code>     . </li><li> FutoIn AsyncSteps   . </li><li> FutoIn AsyncSteps      ( <code>FUTOIN_USE_MEMPOOL=false</code> ). <br><ul><li>      <code>futoin::IMemPool</code> . </li></ul></li><li> FutoIn NitroSteps&lt;&gt; тАФ           . <br><ul><li>         . </li></ul></li></ol><br><p>    Boost.Fiber    : </p><br><ol><li>     1 . . </li><li>       30 .   1 . . <br><ul><li>   30 .     <code>mmap()/mprotect()</code>  <code>boost::fiber::protected_fixedsize_stack</code> . </li><li>          . </li></ul></li><li>   30 .   10 .     . <br><ul><li>    ""          . </li></ul></li></ol><br><p>      "" , ..     ,       .        .   . </p><br><p>    GCC 6.3.0.   lang  tcmalloc  ,     . </p><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitLab</a> . </p><br><h3 id="1-posledovatelnoe-sozdanie"> 1.   </h3><br><table><thead><tr><th>  </th><th>  </th><th>  </th></tr></thead><tbody><tr><td> Boost.Fiber protected </td><td> 4.8s </td><td> 208333.333Hz </td></tr><tr><td> Boost.Fiber pooled </td><td> 0.23s </td><td> 4347826.086Hz </td></tr><tr><td> FutoIn AsyncSteps </td><td> <strong>0.21s</strong> </td><td> <strong>4761904.761Hz</strong> </td></tr><tr><td> FutoIn AsyncSteps no mempool </td><td> 0.31s </td><td> 3225806.451Hz </td></tr><tr><td> FutoIn NitroSteps </td><td> 0.255s </td><td> 3921568.627Hz </td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/ur/y6/qmury65-mbkth_om8smkfi7vamq.png"></div><br><p> <em> тАФ .</em> </p><br><p>     Boost.Fiber -      ,     <code>pooled_fixedsize_stack</code>   ,    AsyncSteps. </p><br><h3 id="2-parallelnoe-sozdanie-i-ispolnenie"> 2.     </h3><br><table><thead><tr><th>  </th><th>  </th><th>  </th></tr></thead><tbody><tr><td> Boost.Fiber protected </td><td> 6.31s </td><td> 158478.605Hz </td></tr><tr><td> Boost.Fiber pooled </td><td> 1.558s </td><td> 641848.523Hz </td></tr><tr><td> FutoIn AsyncSteps </td><td> <strong>1.13s</strong> </td><td> <strong>884955.752Hz</strong> </td></tr><tr><td> FutoIn AsyncSteps no mempool </td><td> 1.353s </td><td> 739098.300Hz </td></tr><tr><td> FutoIn NitroSteps </td><td> 1.43s </td><td> 699300.699Hz </td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0s/gz/lu/0sgzlur2xsrlf-wo4mrcynvzhxi.png"></div><br><p> <em> тАФ .</em> </p><br><p>    ,          .    ,        тАФ            . </p><br><h3 id="3-parallelnye-cikly"> 3.   </h3><br><table><thead><tr><th>  </th><th>  </th><th>  </th></tr></thead><tbody><tr><td> Boost.Fiber protected </td><td> 5.096s </td><td> 1962323.390Hz </td></tr><tr><td> Boost.Fiber pooled </td><td> 5.077s </td><td> 1969667.126Hz </td></tr><tr><td> FutoIn AsyncSteps </td><td> 5.361s </td><td> 1865323.633Hz </td></tr><tr><td> FutoIn AsyncSteps no mempool </td><td> 8.288s </td><td> 1206563.706Hz </td></tr><tr><td> FutoIn NitroSteps </td><td> <strong>3.68s</strong> </td><td> <strong>2717391.304Hz</strong> </td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/c1/17/pbc117djqds0d4twh5fzcklsmfc.png"></div><br><p> <em> тАФ .</em> </p><br><p>   ,        Boost.Fiber      AsyncSteps,    NitroSteps. </p><br><h3 id="ispolzovanie-pamyati-po-rss">   ( RSS) </h3><br><table><thead><tr><th>  </th><th>  </th></tr></thead><tbody><tr><td> Boost.Fiber protected </td><td> 124M </td></tr><tr><td> Boost.Fiber pooled </td><td> 505M </td></tr><tr><td> FutoIn AsyncSteps </td><td> 124M </td></tr><tr><td> FutoIn AsyncSteps no mempool </td><td> <strong>84M</strong> </td></tr><tr><td> FutoIn NitroSteps </td><td> 115M </td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ol/w0/6n/olw06nef5wj3ah1lo9u-pby9sfg.png"></div><br><p> <em> тАФ .</em> </p><br><p>  , Boost.Fiber  . </p><br><h3 id="bonus-testy-na-nodejs"> :   Node.js </h3><br><p>      -  <code>Promise</code> : +    10 . .   10 .          JIT  <code>NODE_ENV=production</code> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>@futoin/optihelp</code></a> . </p><br><p>      <a href="">GitHub</a>  <a href="">GitLab</a> .   Node.js v8.12.0  v10.11.0,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">FutoIn CID</a> . </p><br><table><thead><tr><th> Tech </th><th> Simple </th><th> Loop </th></tr></thead><tbody><tr><td> <strong>Node.js v10</strong> </td><td></td><td></td></tr><tr><td> FutoIn AsyncSteps </td><td> <strong>1342899.520Hz</strong> </td><td> 587.777Hz </td></tr><tr><td> async/await </td><td> 524983.234Hz </td><td> <strong>630.863Hz</strong> </td></tr><tr><td> <strong>Node.js v8</strong> </td><td></td><td></td></tr><tr><td> FutoIn AsyncSteps </td><td> <strong>682420.735Hz</strong> </td><td> <strong>588.336Hz</strong> </td></tr><tr><td> async/await </td><td> 365050.395Hz </td><td> 400.575Hz </td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x7/-n/b5/x7-nb5v9dfkwn1lttyg67w2b_tk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/yj/9p/ghyj9pczw0smbfksq-aad_tltay.png"></div><br><p> <em> тАФ .</em> </p><br><p>   <code>async/await</code> ? ,   V8  Node.js v10       . </p><br><p>  ,   Promise  <code>async/await</code> <strong></strong> Node.js Event Loop.          ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ),   FutoIn AsyncSteps   . </p><br><p> <em>   AsyncSteps  Node.js Event Loop      <code>async/await</code>  -  Node.js v10.</em> </p><br><p> <em>,      ++   тАФ    .  ,    Node.js    10 .</em> </p><br><h3 id="vyvody">  рдирд┐рд╖реНрдХрд░реНрд╖ </h3><br><p>   C++, FutoIn AsyncSteps  Boost.Fiber       ,     Boost.Fiber         <code>mmap()/mprotect</code> . </p><br><p>       ,      -      ,   .     . </p><br><p> FutoIn AsyncSteps  JavaScript  <code>async/await</code>       Node.js v10. </p><br><p>   ,       -,       .        . </p><br><p>   -                        ""  .     тАФ   API. </p><br><hr><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p> ,  FutoIn AsyncSteps ,          "" <code>async/await</code> . ,         .      <code>Promise</code>  ECMAScript, AsyncSteps    ""           . </p><br><p>               .        AsyncSteps  NitroSteps   . </p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ,    - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> . </p><br><p>       Java/JVM         тАФ    .    . </p><br><p>      ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitLab</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi424311/">https://habr.com/ru/post/hi424311/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi424297/index.html">рдПрдордЖрдИрдЯреА рдкрд╛рдареНрдпрдХреНрд░рдо "рдХрдВрдкреНрдпреВрдЯрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛"ред рд╡реНрдпрд╛рдЦреНрдпрд╛рди 9: рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛, рднрд╛рдЧ 3</a></li>
<li><a href="../hi424301/index.html">рдЕрдиреБрдХреВрд▓реА рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЫрд╡рд┐ рдлрд╝рд┐рд▓реНрдЯрд░ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо</a></li>
<li><a href="../hi424305/index.html">рдЙрдмреЗрд░ рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЛрдмрд╛рдЗрд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЖрд░рдЖрдИрдмреА</a></li>
<li><a href="../hi424307/index.html">GitLab 11.3 рдорд╛рд╡реЗрди рднрдВрдбрд╛рд░ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛</a></li>
<li><a href="../hi424309/index.html">DevCore: DevBoy рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╣рд┐рд╕реНрд╕рд╛</a></li>
<li><a href="../hi424313/index.html">рдПрд╡рд░реАрд▓реИрдВрдЧ рдПрдХ рдРрд╕рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдЬреЛ рд▓рдЧрднрдЧ рд╕рдм рдХреБрдЫ рдХрд░ рд╕рдХрддрд╛ рд╣реИ</a></li>
<li><a href="../hi424315/index.html">рдЖрдпрд╛рдд рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдХрд╛ рдПрдХ рдирдпрд╛ рджреМрд░ред рдХрд╣рд╛рдВ рднрд╛рдЧрдирд╛ рд╣реИ рдФрд░ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ?</a></li>
<li><a href="../hi424319/index.html">рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХреА рд╕рдВрд░рдЪрдирд╛ред рднрд╛рдЧ реи</a></li>
<li><a href="../hi424321/index.html">рдиреЗрдЯрдлреНрд▓реЛ рд╕рд╕реНрддрд╛ рдФрд░ рдЧреБрд╕реНрд╕рд╛ рд▓рд╛рдирд╛</a></li>
<li><a href="../hi424323/index.html">Google рдФрд░ Microsoft рдХреЗ рдЙрддреНрдкрд╛рдж рдкреНрд░рдмрдВрдзрдХ рд╕реЗ ICE рдкрджреНрдзрддрд┐ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>