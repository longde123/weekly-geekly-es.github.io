<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîè üë®üèº‚Äçüöí ‚õ¥Ô∏è Briser une simple ¬´fissure¬ª avec Ghidra - Partie 1 üëΩ üôà üë©üèø‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup de gens savent probablement d√©j√† de quel genre de b√™te il s'agit - Ghidra ("Hydra") et ce qu'il mange avec le programme de premi√®re main, bie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Briser une simple ¬´fissure¬ª avec Ghidra - Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447450/">  Beaucoup de gens savent probablement d√©j√† de quel genre de b√™te il s'agit - <b>Ghidra</b> ("Hydra") et ce qu'il mange avec le programme de premi√®re main, bien que cet outil n'ait √©t√© rendu public que r√©cemment - en mars de cette ann√©e.  Je ne d√©rangerai pas les lecteurs avec une description d'Hydra, de ses fonctionnalit√©s, etc.  Ceux qui sont dans le sujet, j'en suis s√ªr, ont d√©j√† √©tudi√© tout cela eux-m√™mes, et ceux qui ne sont pas encore dans le sujet - ils peuvent le faire √† tout moment, car maintenant il est facile de trouver des informations d√©taill√©es sur Internet.  Soit dit en passant, l'un des aspects d'Hydra (le d√©veloppement de plugins pour celui-ci) a d√©j√† √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">couvert</a> sur Habr√© (excellent article!) Je ne donnerai que les liens principaux: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Page officielle sur le site de la NSA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Projet Github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Premi√®re critique dans Hacker Magazine</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grande cha√Æne YouTube avec des programmes d'analyse dans Ghidra</a> </li></ul><br>  Hydra est donc un <em>d√©sassembleur et d√©compilateur interactif multiplateforme gratuit avec une structure modulaire, avec la prise en charge de presque toutes les principales architectures CPU et une interface graphique flexible pour travailler avec du code d√©sassembl√©, de la m√©moire, du code r√©cup√©r√© (d√©compil√©), des symboles de d√©bogage, et bien plus encore</em> . <br><br>  Essayons de casser quelque chose avec cette Hydra! <br><a name="habracut"></a><br><h2>  √âtape 1. Trouvez et √©tudiez la fissure </h2><br>  En tant que ¬´victime¬ª, nous trouvons un simple programme ¬´crackme¬ª.  Je suis juste all√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crackmes.one</a> , indiqu√© dans la recherche le niveau de difficult√© = 2-3 ("simple" et "moyen"), la langue source du programme = "C / C ++" et la plateforme = "Multiplateforme", comme dans la capture d'√©cran ci-dessous: <br><br><img src="https://habrastorage.org/webt/oz/hh/4w/ozhh4w-nraygltspefvjnyrvpjk.png"><br><br>  La recherche a donn√© 2 r√©sultats (en vert ci-dessous).  La premi√®re fissure s'est av√©r√©e √™tre 16 bits et n'a pas d√©marr√© sur mon Win10 64 bits, mais la seconde ( <b>level_2 by seveb</b> ) est apparue.  Vous pouvez le t√©l√©charger √† partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce lien</a> . <br><br>  T√©l√©chargez et d√©compressez la fissure;  Le mot de passe pour l'archive, tel qu'indiqu√© sur le site, est <b>crackmes.de</b> .  Dans l'archive, nous trouvons deux r√©pertoires correspondant √† Linux et Windows.  Sur ma machine, je vais dans le r√©pertoire Windows et j'y rencontre le seul "ex√©cutable" - <b>level_2.exe</b> .  Courons et voyons ce qu'elle veut: <br><br><img src="https://habrastorage.org/webt/qx/mu/yj/qxmuyjfvnatrgoggnmet17egii8.png"><br><br>  Cela ressemble √† une d√©ception!  Au d√©marrage, le programme n'affiche rien.  Nous essayons de l'ex√©cuter √† nouveau, en lui passant une cha√Æne arbitraire comme param√®tre (tout d'un coup, attend-il une cl√©?) - et encore rien ... Mais ne d√©sesp√©rez pas.  Supposons que nous devions √©galement trouver les param√®tres de lancement en tant que t√¢che!  Il est temps de d√©couvrir notre "couteau suisse" - Hydra. <br><br><h2>  √âtape 2. Cr√©ation d'un projet dans Hydra et analyse pr√©liminaire </h2><br>  Supposons que Hydra soit d√©j√† install√©.  Sinon, tout est simple. <br><br><div class="spoiler">  <b class="spoiler_title">Installer Ghidra</b> <div class="spoiler_text">  1) installez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK</a> version 11 ou sup√©rieure (j'en ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">12</a> ) <br><br>  2) t√©l√©chargez Hydra (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'ici</a> ) et installez-le (au moment de la r√©daction, la derni√®re version d'Hydra est 9.0.2, j'ai 9.0.1) <br></div></div><br>  Nous lan√ßons Hydra et dans le gestionnaire de projet ouvert, cr√©ons imm√©diatement un nouveau projet;  Je lui ai donn√© le nom de <b>crackme3</b> (c'est-√†-dire que des projets crackme et crackme2 ont d√©j√† √©t√© cr√©√©s pour moi).  Le projet est, en fait, un r√©pertoire de fichiers, vous pouvez y ajouter tous les fichiers √† √©tudier (exe, dll, etc.).  Nous ajouterons imm√©diatement notre level_2.exe ( <b>Fichier | Importer</b> ou simplement la cl√© <b>I</b> ): <br><br><img src="https://habrastorage.org/webt/sb/gl/_e/sbgl_e0acdolgbxtvjnuohiscua.png"><br><br>  Nous voyons qu'avant l'importation, Hydra a identifi√© notre charlatan exp√©rimental comme un PE 32 bits (ex√©cutable portable) pour le syst√®me d'exploitation Win32 et la plate-forme x86.  Apr√®s l'importation, nous attendons encore plus d'informations: <br><br><img src="https://habrastorage.org/webt/zb/v0/ga/zbv0gatojwqtmbdejhe6zclenac.png"><br><br>  Ici, en plus de la profondeur de bits susmentionn√©e, nous pouvons toujours √™tre int√©ress√©s par l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ordre d'endianness</a> , qui dans notre cas est <b>peu</b> (de bas √† √©lev√©), qui √©tait attendu pour la plate-forme Intel 86e. <br><br>  Avec une analyse pr√©liminaire, nous avons termin√©. <br><br><h2>  √âtape 3. Effectuez une analyse automatique </h2><br>  Il est temps de commencer une analyse enti√®rement automatique du programme dans Hydra.  Cela se fait en double-cliquant sur le fichier correspondant (level_2.exe).  Ayant une structure modulaire, Hydra fournit toutes ses fonctionnalit√©s de base avec un syst√®me de plug-in qui peut √™tre ajout√© / d√©sactiv√© ou d√©velopp√© ind√©pendamment.  Il en va de m√™me pour l'analyse - chaque plugin est responsable de son type d'analyse.  Par cons√©quent, tout d'abord, nous sommes confront√©s √† cette fen√™tre o√π vous pouvez s√©lectionner les types d'analyse d'int√©r√™t: <br><br><div class="spoiler">  <b class="spoiler_title">Fen√™tre Param√®tres d'analyse</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p2/aw/sa/p2awsa9slwl8tkbjo0mtcbkgnh8.png"></div></div><br>  Pour nos besoins, il est logique de laisser les param√®tres par d√©faut et d'ex√©cuter l'analyse.  L'analyse elle-m√™me est effectu√©e assez rapidement (cela m'a pris environ 7 secondes), bien que les utilisateurs des forums se plaignent que pour les grands projets, Hydra perd de la vitesse par rapport √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IDA Pro</a> .  Cela peut √™tre vrai, mais pour les petits fichiers, cette diff√©rence n'est pas significative. <br><br>  Ainsi, l'analyse est termin√©e.  Ses r√©sultats sont affich√©s dans la fen√™tre du navigateur de code: <br><br><img src="https://habrastorage.org/webt/lh/dy/e5/lhdye5faqmse8w2evahggln5bge.png"><br><br>  Cette fen√™tre est la principale pour travailler dans Hydra, vous devez donc l'√©tudier plus attentivement. <br><br><div class="spoiler">  <b class="spoiler_title">Pr√©sentation de l'interface du navigateur de code</b> <div class="spoiler_text">  Les param√®tres d'interface par d√©faut divisent la fen√™tre en trois parties. <br><br>  Dans la <b>partie centrale se</b> trouve la fen√™tre principale - une liste du d√©sassembleur, qui est plus ou moins similaire √† ses "fr√®res" dans IDA, OllyDbg, etc.  Par d√©faut, les colonnes de cette liste sont (de gauche √† droite): adresse m√©moire, opcode de la commande, commande ASM, param√®tres de la commande ASM, r√©f√©rence crois√©e (le cas √©ch√©ant).  Naturellement, l'affichage peut √™tre modifi√© en cliquant sur le bouton sous la forme d'un mur de briques dans la barre d'outils de cette fen√™tre.  Pour √™tre honn√™te, je n'ai jamais vu une telle configuration flexible de la sortie du d√©monteur nulle part, c'est extr√™mement pratique. <br><br>  Dans la <b>partie gauche du</b> panneau 3: <br><br><ol><li>  Sections du programme (cliquez sur la souris pour parcourir les sections) </li><li>  Arbre de caract√®res (importations, exportations, fonctions, en-t√™tes, etc.) </li><li>  Arbre de type des variables utilis√©es </li></ol><br>  Pour nous, la fen√™tre la plus utile ici est une arborescence de symboles, qui vous permet de trouver rapidement, par exemple, une fonction par son nom et d'aller √† l'adresse correspondante. <br><br>  Sur le <b>c√¥t√© droit</b> est une liste du code d√©compil√© (dans notre cas, en C). <br><br>  En plus des fen√™tres par d√©faut, dans le menu <b>Fen√™tre</b> , vous pouvez s√©lectionner et placer des dizaines d'autres fen√™tres et affichages n'importe o√π dans le navigateur.  Pour plus de commodit√©, j'ai ajout√© une fen√™tre d'octets et une fen√™tre avec un graphique de fonction au centre, et √† droite, des variables de cha√Æne (cha√Ænes) et un tableau de fonctions (fonctions).  Ces fen√™tres sont d√©sormais disponibles dans des onglets s√©par√©s.  De plus, toutes les fen√™tres peuvent √™tre d√©tach√©es et rendues "flottantes", en les pla√ßant et en les redimensionnant √† votre discr√©tion - c'est aussi une solution tr√®s r√©fl√©chie, √† mon avis. <br></div></div><br><h2>  √âtape 4. Apprentissage de l'algorithme du programme - fonction main () </h2><br>  Eh bien, proc√©dons √† une analyse directe de nos programmes de crack.  Dans la plupart des cas, vous devez commencer par rechercher le point d'entr√©e du programme, c'est-√†-dire  La fonction principale qui est appel√©e au d√©marrage.  Sachant que notre crack a √©t√© √©crit en C / C ++, nous supposons que le nom de la fonction principale sera <b>main ()</b> ou quelque chose comme √ßa :) C'est dit et fait.  Entrez "main" dans le filtre de l'Arbre des Symboles (dans le panneau de gauche) et voyez la fonction <b>_main ()</b> dans la section <b>Fonctions</b> .  Allez-y avec un clic de souris. <br><br><h3>  Pr√©sentation de la fonction main () et changement de nom des fonctions obscures </h3><br>  Dans la liste des d√©sassembleurs, la section de code correspondante est imm√©diatement affich√©e et √† droite, nous voyons le code C d√©compil√© de cette fonction.  Il convient de noter une autre caract√©ristique pratique de la synchronisation Hydra - s√©lection: lorsqu'une souris s√©lectionne une plage de commandes ASM, la section de code correspondante dans le d√©compilateur est mise en surbrillance et vice versa.  De plus, si la fen√™tre d'affichage de la m√©moire est ouverte, l'allocation est synchronis√©e avec la m√©moire.  Comme on dit, tout ing√©nieux est simple! <br><br>  Imm√©diatement, je note une caract√©ristique importante du travail chez Hydra (contrairement, par exemple, au travail chez IDA).  <em>Le travail dans Hydra est principalement ax√© sur l'analyse de code d√©compil√©</em> .  Pour cette raison, les cr√©ateurs d'Hydra (nous nous souvenons - nous parlons d'espions de la NSA :)) ont accord√© une grande attention √† la qualit√© de la d√©compilation et √† la commodit√© de travailler avec du code.  En particulier, on peut simplement aller √† la d√©finition des fonctions, des variables et des sections de m√©moire en double-cliquant dans le code.  De plus, n'importe quelle variable et fonction peut √™tre imm√©diatement renomm√©e, ce qui est tr√®s pratique, car les noms par d√©faut n'ont pas de sens et peuvent pr√™ter √† confusion.  Comme vous le verrez plus loin, nous utiliserons souvent ce m√©canisme. <br><br>  Voici donc la fonction <b>main ()</b> qu'Hydra a ¬´diss√©qu√©e¬ª comme suit: <br><br><div class="spoiler">  <b class="spoiler_title">Liste main ()</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __cdecl _main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _Argc,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Argv,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Env) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bVar1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iVar2; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> sVar3; FILE *_File; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **ppcVar4; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> local_18; ___main(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); local_18 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (local_18 &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { _text(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); _text(_Dest,_Argv[local_18],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } sVar3 = _text(_Argv[local_18]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((sVar3 == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[local_18] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[local_18][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } local_18 = local_18 + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { _File = _text(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ppcVar4 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar4 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _text(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar4); } _text(_File); } _text(_Dest); iVar2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { iVar2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> iVar2; }</code> </pre> <br></div></div><br>  Il semble que tout semble normal - d√©finitions des variables, types C standard, conditions, boucles, appels de fonction.  Mais en regardant de plus pr√®s le code, nous remarquons que pour une raison quelconque, les noms de certaines fonctions n'ont pas √©t√© d√©finis et remplac√©s par la pseudo- <b>fonction _text ()</b> (dans la fen√™tre du d√©compilateur - <b>.text ()</b> ).  Commen√ßons par d√©finir quelles sont ces fonctions. <br><br>  Double-cliquer sur le corps du premier appel <br><br><pre> <code class="cpp hljs"> _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  nous voyons que c'est juste une fonction wrapper autour de la fonction standard <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">calloc ()</a> , qui est utilis√©e pour allouer de la m√©moire pour les donn√©es.  <b>Renommons donc</b> cette fonction en <b>calloc2 ()</b> .  Positionnez le curseur sur l'en-t√™te de la fonction, appelez le menu contextuel et s√©lectionnez <b>Renommer la fonction</b> (touche de raccourci - <b>L</b> ) et entrez un nouveau nom dans le champ qui s'ouvre: <br><br><img src="https://habrastorage.org/webt/nz/q1/3z/nzq13zx8ddn0vsbvni8mkpencyc.png"><br><br>  On voit que la fonction a √©t√© imm√©diatement renomm√©e.  Nous revenons au corps <b>principal ()</b> (le bouton <b>Retour</b> dans la barre d'outils ou <b>Alt + &lt;-</b> ) et nous voyons qu'ici au lieu du myst√©rieux <b>_text () calloc2 ()</b> se trouve d√©j√†.  Super! <br><br>  Nous faisons de m√™me avec toutes les autres fonctions wrapper: nous entrons dans leur d√©finition une par une, voyons ce qu'elles font, renommons (j'ai ajout√© l'index 2 aux noms standard des fonctions C) et revenons √† la fonction principale. <br><br><h3>  Nous comprenons le code de la fonction main () </h3><br>  D'accord, nous avons d√©couvert des fonctions √©tranges.  Nous commen√ßons √† √©tudier le code de la fonction principale.  En sautant les d√©clarations de variables, nous voyons que la fonction renvoie la valeur de la variable iVar2, qui est z√©ro (signe de succ√®s de la fonction) uniquement si la condition sp√©cifi√©e par la cha√Æne est remplie <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { ... }</code> </pre><br>  <b>_Argc</b> est le nombre de param√®tres de ligne de commande (arguments) pass√©s √† <b>main ()</b> .  Autrement dit, notre programme ¬´mange¬ª 2 arguments (le premier argument, nous nous en souvenons, est toujours le chemin d'acc√®s au fichier ex√©cutable). <br><br>  OK, passons.  Ici, nous cr√©ons une cha√Æne C (tableau de caract√®res) de 256 caract√®res: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)calloc2(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  new char[256]  C++</span></span></code> </pre><br>  Ensuite, nous avons une boucle de 3 it√©rations.  Dans ce document, nous v√©rifions d'abord si l'indicateur <b>bVar1</b> est <b>d√©fini,</b> et si c'est le cas, copiez l'argument (cha√Æne) de ligne de commande suivant dans <b>_Dest</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    .  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> memset2(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    _Dest    */</span></span> strncpy2(_Dest,_Argv[i],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ... }</code> </pre><br>  Cet indicateur est d√©fini lors de l'analyse de l'argument suivant: <br><br><pre> <code class="cpp hljs">n_strlen = strlen2(_Argv[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((n_strlen == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[i] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[i][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  La premi√®re ligne calcule la longueur de cet argument.  De plus, la condition v√©rifie que la longueur de l'argument doit √™tre 2, l'avant-dernier caract√®re == "-" et le dernier caract√®re == "f".  Notez comment le d√©compilateur a "traduit" l'extraction des caract√®res de la cha√Æne √† l'aide d'un masque d'octets. <br><blockquote>  Les valeurs d√©cimales des nombres, et en m√™me temps les caract√®res ASCII correspondants, peuvent √™tre espionn√©s en maintenant le curseur sur le litt√©ral hexad√©cimal correspondant.  Le mappage ASCII ne fonctionne pas toujours (?), Je recommande donc de consulter la table ASCII sur Internet.  Vous pouvez √©galement directement dans Hydra convertir des scalaires de n'importe quel syst√®me num√©rique vers un autre (via le menu contextuel -&gt; <b>Convertir</b> ), dans ce cas, ce nombre sera affich√© partout dans le syst√®me num√©rique s√©lectionn√© (dans le d√©sassembleur et dans le d√©compilateur);  mais personnellement, je pr√©f√®re laisser des hexagones dans le code pour l'harmonie du travail, car  adresses m√©moire, d√©calages, etc.  les hexs sont plac√©s partout. <br></blockquote>  Apr√®s la boucle vient ce code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">/*    1) "-f"  2)  -         */</span></span> _File = fopen2(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*  1    */</span></span> perror2(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ... }</code> </pre><br>  Ici, j'ai imm√©diatement ajout√© des commentaires.  Nous v√©rifions la validit√© des arguments ("-f path_to_file") et ouvrons le fichier correspondant (le 2√®me argument pass√©, que nous avons copi√© dans _Dest).  Le fichier sera lu au format binaire, comme indiqu√© par le param√®tre "rb" de la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fopen ()</a> .  Si la lecture √©choue (par exemple, le fichier n'est pas disponible), un message d'erreur s'affiche dans le flux stderror et le programme se ferme avec le code 1. <br><br>  Le suivant est le plus int√©ressant: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">/* !!!     !!! */</span></span> ppcVar3 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar3 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    ,  "Nope" */</span></span> puts2(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    -      */</span></span> printf2(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar3); } fclose2(_File);</code> </pre><br>  Le descripteur de fichier ouvert ( <b>_File</b> ) est transmis √† la fonction <b>_construct_key ()</b> , qui, √©videmment, effectue la v√©rification de la cl√© recherch√©e.  Cette fonction renvoie un tableau d'octets √† deux dimensions ( <b>char **</b> ), qui est stock√© dans la variable <b>ppcVar3</b> .  Si le tableau est vide, le ¬´Nope¬ª concis est affich√© sur la console (c'est-√†-dire, √† notre avis, ¬´Nope!¬ª) Et la m√©moire est lib√©r√©e.  Sinon (si le tableau n'est pas vide), la cl√© apparemment correcte s'affiche et la m√©moire est √©galement lib√©r√©e.  √Ä la fin de la fonction, le descripteur de fichier se ferme, la m√©moire est lib√©r√©e et la valeur de <b>iVar2 est renvoy√©e</b> . <br><br>  Donc, maintenant nous avons r√©alis√© que nous avons besoin de: <br><br>  <i>1) cr√©ez un fichier binaire avec la bonne cl√©;</i> <i><br></i>  <i>2) passer son chemin dans la fissure apr√®s l'argument "-f"</i> <br><br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me partie de l'article,</a> nous analyserons la fonction <b>_construct_key ()</b> qui, comme nous l'avons d√©couvert, est charg√©e de v√©rifier la cl√© souhait√©e dans le fichier. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447450/">https://habr.com/ru/post/fr447450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447438/index.html">Tests les plus simples et abstraits</a></li>
<li><a href="../fr447440/index.html">RBKmoney Payments sous le capot - la logique de la plateforme de paiement</a></li>
<li><a href="../fr447442/index.html">Pr√©sentation de l'op√©rateur shell: faciliter encore plus les op√©rateurs pour Kubernetes</a></li>
<li><a href="../fr447446/index.html">Ateliers IBM: printemps-√©t√© 2019 - intelligence artificielle, d√©veloppement cloud, chat bots, blockchain et autres technologies</a></li>
<li><a href="../fr447448/index.html">Evolution de l'intelligence: le d√©but</a></li>
<li><a href="../fr447452/index.html">S√©curit√© de la cha√Æne d'approvisionnement: "Si j'√©tais un √âtat-nation ..."</a></li>
<li><a href="../fr447454/index.html">Contr√¥le d'affichage FPGA √† sept segments</a></li>
<li><a href="../fr447456/index.html">Avec quelle pr√©cision Yandex pr√©voit-il les pr√©cipitations en hiver? Nous analysons la pr√©cision des services pr√©dictifs</a></li>
<li><a href="../fr447458/index.html">Comment de nouveaux mots sont cr√©√©s en anglais moderne</a></li>
<li><a href="../fr447460/index.html">Piratez votre aspirateur XiaoMi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>