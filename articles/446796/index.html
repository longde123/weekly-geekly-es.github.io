<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÑÔ∏è ü§Ø ‚úçüèΩ Circuitos no est√°ndar: indicador de siete segmentos en ATtiny13 üé• üë©üèΩ‚Äçü§ù‚Äçüë©üèª ‚ñ´Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No estamos buscando formas simples. 



 Anteriormente, es mi primera publicaci√≥n que caus√≥ resonancia entre los usuarios de Habr. Decidi√≥ no parar. C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Circuitos no est√°ndar: indicador de siete segmentos en ATtiny13</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446796/"><blockquote>  <i>No estamos buscando formas simples.</i> </blockquote><br><br><img src="https://habrastorage.org/webt/gl/vh/go/glvhgoheu-u5slanwr-7y9azjlg.jpeg" alt="imagen"><br><br>  Anteriormente, es mi primera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci√≥n que</a> caus√≥ resonancia entre los usuarios de Habr.  Decidi√≥ no parar.  Continuamos exprimiendo lo imposible de ATtiny13.  Te advierto de inmediato, las soluciones descritas no son est√°ndar nuevamente, y alguien puede causar indignaci√≥n y disonancia cognitiva ("¬øY cu√°l es el objetivo del art√≠culo? ¬øMostrar qu√© elementos pueden conectarse?").  Adem√°s, tal soluci√≥n tampoco es pr√°ctica, lo que escribir√© con m√°s detalle a continuaci√≥n.  Pero sucedi√≥ que las soluciones est√°ndar se conocen desde hace mucho tiempo, y leer sobre ellas no siempre es interesante, pero escribir es desagradecido. <br><a name="habracut"></a><br>  Realmente me gusta este chico ATtiny13.  Tiene suficientes cerebros para resolver muchos problemas cotidianos (enciende las luces, ventilaci√≥n, <s>huye a la tienda por cerveza</s> ).  Y el precio es simplemente rid√≠culo.  Aqu√≠ hay algunas patas y no hay manijas en absoluto.  Por lo tanto, tienes que recurrir a todo tipo de trucos para resolver el problema de la falta de piernas. <br><br>  En el proceso de estudiar la programaci√≥n de microcontroladores (en el entorno Arduino, no se lo digas a nadie), como muchos, pas√© por el paso de conectar un sensor de distancia ultras√≥nico, algo como esto: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/c6c/0c1/2a2c6c0c19d10932dbcffa732d0482d7.jpg" alt="imagen"><br><br>  Dado que el m√©todo de transmisi√≥n de informaci√≥n desde el sensor al controlador es f√°cil de deshonrar, ATtiny13 se las arregla f√°cilmente.  Luego fue necesario mostrar informaci√≥n en un indicador de siete segmentos utilizando registros de desplazamiento.  Es decir, el esquema de la parte de la pantalla era varias veces mayor que el controlador en s√≠.  En ese momento jugu√© y segu√≠ adelante. <br><br>  Recientemente, pens√©, ¬øqu√© otra cosa ser√≠a una tarea abrumadora para asignar a Tinka?  Lo que todav√≠a no pod√≠a manejar en los ejemplos descritos.  Lo primero que recordaba de la indicaci√≥n.  Hace alg√∫n tiempo ya estaba buscando informaci√≥n sobre un tema similar.  Entonces encontr√© una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opci√≥n</a> tan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">interesante</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Imagen</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e08/0b6/2fb/e080b62fbc0864cbe0ba6f8dd6682132.gif" alt="imagen"><br></div></div><br>  21 segmentos de 5 pies del controlador.  Wow!  Ni siquiera necesito tanto, dos signos son suficientes, m√°s un punto, un total de 15 segmentos.  ¬øY si con cuatro patas?  Luego obtenga un m√°ximo de 13 segmentos, no lo suficiente.  A la vista del circuito, surgi√≥ un deseo inmediato de ensamblar e intentar, aunque no es f√°cil elaborar un algoritmo de operaci√≥n.  Pero con una mirada m√°s cercana, entiendes que no funcionar√° recolectar, tales animales de siete segmentos no existen en la naturaleza (muy probablemente).  Puedes hacer, por supuesto, pero este es un nivel diferente.  Entonces la idea fue pospuesta hasta tiempos mejores. <br><br>  Offtopic: ¬øPor qu√© no hay indicadores de siete segmentos con l√≥gica integrada?  ¬øD√≥nde est√°n buscando los desarrolladores?  Qu√© conveniente es la instalaci√≥n y el control: dos patas de alimentaci√≥n y 3 (1, 2) patas de datos.  Y despu√©s de todo, incluso estaban en la URSS: 490IP1, 490IP2.  Dentro del indicador m√°s com√∫n para 2 ... 4 d√≠gitos hay mucho espacio para colocar el microcircuito de chip, y el precio del registro de desplazamiento es 0.064 cu junto con la caja.  Oh bien <br><br>  Y entonces pens√© nuevamente, ¬øc√≥mo reducir el n√∫mero de patas para trabajar con el indicador de siete segmentos?  Las salidas del controlador pueden tomar tres estados (en realidad 4, pero ahora no importa).  ¬øHay alguna forma de usar esto?  Si dos estados con respecto al LED pueden interpretarse solo como brillantes, no brillantes, entonces con tres es un poco m√°s interesante.  Todav√≠a no he descubierto c√≥mo usarlo, pero el siguiente esquema me vino a la mente: <br><br><img src="https://habrastorage.org/webt/cw/f8/32/cwf832ajr1kedukuv_tyigpuzwk.jpeg" alt="imagen"><br><br>  Si la salida del controlador est√° en estado cero, los LED no se iluminan (lo cual es obvio). <br><br>  Si la salida est√° en el estado de la unidad, los LED est√°n encendidos, lo que tambi√©n es comprensible. <br><br>  Pero si la salida no es la salida, sino que se conecta a la entrada, entonces fluye una corriente a trav√©s del circuito de dos resistencias y LED HL1, creando una ca√≠da de voltaje en el punto de conexi√≥n de las resistencias de aproximadamente (5-1.7) / (2.2 + 1.5) * 1.5 + 1.7 = 3.0 V. Esto no es suficiente para que la corriente fluya a trav√©s del circuito VD1_R3_HL2 (se necesitan aproximadamente 3.4 V).  VD1 es un LED adicional que se utiliza como diodo zener (el estabilizador es m√°s correcto), por lo tanto, no lo consideraremos un LED para no confundirnos.  No importa si la resistencia pull-up est√° encendida dentro del microcontrolador, su resistencia (20 kOhm) pr√°cticamente no afecta la situaci√≥n.  No llegu√© a tales clasificaciones de inmediato, antes de eso prob√© con un diodo normal como VD1, tambi√©n funciona bastante bien con las mismas resistencias R1 y R2.  Pero es mejor que R2 sea aproximadamente una vez y media m√°s grande que R1.  Y casi olvid√© lo m√°s importante: todo lo descrito es posible solo con el uso de LED <i>rojos</i> tanto en el indicador como en los adicionales.  En casos extremos, <i>el</i> indicador <i>o los</i> LED adicionales se pueden aplicar en verde.  Y con una tensi√≥n de alimentaci√≥n de 4,5 V a 5 V. <br><br>  ¬øQu√© tenemos al final?  Tres estados: ning√∫n LED (0) brilla, HL1 (1) brilla, o HL1 y HL2 (2) brillan.  Muy similar al sistema ternario.  Pero no podemos encender HL2 sin HL1, esto debe recordarse.  Pero ahora, con la ayuda de las cuatro patas del microcontrolador, podemos controlar ocho LED (quer√≠a pensar que s√≠). <br><br>  Luego intent√© dividir los segmentos indicadores en pares (como en un jard√≠n de infantes: un ni√±o-ni√±a).  La condici√≥n principal es que en cada par uno de los segmentos no puede brillar por s√≠ solo, tal discriminaci√≥n.  Esto es lo que obtuve: <br><br><img src="https://habrastorage.org/webt/rj/oa/dr/rjoadrat5-jro2zaaj6oe4dxrno.jpeg" alt="imagen"><br><br>  Cuatro pares de segmentos, en cada letra may√∫scula se indica el segmento dominante, que puede funcionar solo, el segundo solo puede con √©l.  Puede notar que el segmento "a" se agita con dos a la vez, y nadie lleg√≥ al punto m√°s pobre.  ¬°C√≥mo se ve la vida! <br><br>  Pero con estos pares puede mostrar (casi) todos los n√∫meros: <br><br><div class="spoiler">  <b class="spoiler_title">Imagen</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ux/vb/tv/uxvbtvxvpp1rlhvkqg23uld0oou.jpeg" alt="imagen"><br></div></div><br>  Cada par est√° pintado en su propio color.  Un espectador atento not√≥ que algo andaba mal con el deuce.  No nos centraremos en esto por ahora.  Intent√© algunas opciones m√°s para agrupar segmentos, mejor no aparecer.  Quiz√°s alguien sugiera.  Quiz√°s la red neuronal podr√≠a manejarlo. <br><br>  En la segunda etapa de los experimentos, tuve que usar un indicador con un √°nodo com√∫n.  Por lo tanto, el esquema final es el siguiente: <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cq/nd/jo/cqndjod7jj6ofopx2fcwmuvqums.jpeg" alt="imagen"><br></div></div><br>  Alguien puede preguntar: ¬øa d√≥nde fueron las resistencias de 100 ohmios?  Hace tiempo que se sabe (y se usa activamente) que con indicaciones din√°micas hechas correctamente, se pueden prescindir de las resistencias limitadoras de corriente.  Incluso si el voltaje se aplica constantemente desde la salida del controlador a los dos LED conectados en serie por error, el microcontrolador y los LED normalmente resisten esto, la corriente est√° limitada por la resistencia de transici√≥n dentro del MC.  Y m√°s sobre resistencias.  La corriente m√°xima a trav√©s de HL1 seg√∫n el esquema anterior es de aproximadamente 2 mA, y a trav√©s de HL2 alcanza 25 ... 40 mA (presumiblemente, m√°s adelante dir√© de d√≥nde provienen estos n√∫meros).  Esto significa que la salida de luz de diferentes segmentos ser√° diferente.  Pero como se utilizar√° la indicaci√≥n din√°mica, esto se puede resolver f√°cilmente debido al diferente tiempo de visualizaci√≥n de los segmentos. <br><br>  Todos los experimentos que realic√© con el Arduino Nano en el Arduino IDE.  Una excelente placa de creaci√≥n de prototipos, se pone bien en la placa de pruebas, se actualiza a trav√©s de USB sin problemas.  ¬øAlgo fall√≥?  Arregl√© el boceto y en un minuto cargu√© un nuevo firmware.  Y cuando depur√≥ el c√≥digo, puede ir al firmware en ATtiny13, todav√≠a requiere un poco m√°s de gestos. <br><br>  Por cierto, tambi√©n estoy flasheando con Arduino en el entorno Arduino, esto pr√°cticamente elimina la posibilidad de bloquear MK con los fusibles incorrectos, y mucho m√°s f√°cil. <br><br>  Aqu√≠ hay un ejemplo de c√≥mo mostrar el n√∫mero 4 en el c√≥digo: <br><br><pre><code class="cpp hljs">pinMode(f_a, INPUT); <span class="hljs-comment"><span class="hljs-comment">//    f_a   digitalWrite(f_a, 1); //   F pinMode(d_e, OUTPUT); //    d_e   digitalWrite(d_e, 1); //     1,     D  E pinMode(b_a, INPUT); //    b_a   digitalWrite(b_a, 1); //   B pinMode(c_g, OUTPUT); //    c_g   digitalWrite(c_g, 0); //     0,   C,  G delayMicroseconds (150); // F, B, C, G c  150  pinMode(c_g, INPUT); //    c_g   digitalWrite(c_g, 1); //   G ,     delay (time_2); // F, B, C c  2 </span></span></code> </pre> <br>  En principio, todo debe estar claro, incluso para aquellos que no est√°n familiarizados con Arduino, pero entienden un poco sobre los controladores.  Las cifras de 150 microsegundos y 2 milisegundos se seleccionan experimentalmente por el brillo de los segmentos.  En el c√≥digo final, debe colocarlos en variables separadas para que pueda cambiarlos durante la depuraci√≥n.  A partir de estas cifras, es posible determinar aproximadamente el orden de diferencia en las corrientes a trav√©s de dos segmentos en un par.  Dado que el segmento G brilla aproximadamente 13 veces menos que los otros y proporciona el mismo brillo, se puede suponer que la corriente a trav√©s de este segmento es 13 veces m√°s que a trav√©s de los otros.  De hecho, la dependencia del brillo de la corriente no es lineal, por lo que la corriente puede ser 25 veces mayor, es decir, 50 mA.  Que con dicho ciclo de trabajo es bastante seguro para la salida de MK.  Por cierto, esta diferencia en las corrientes jug√≥ en las manos al resolver el problema de la figura 2. Como escrib√≠ anteriormente, el segmento G solo puede iluminarse junto con el segmento C. Pero si pasa 0 al tramo MK, que es responsable de C y G, en 150 Œºs, y despu√©s 2 ms para mantener 1 en √©l, entonces el segmento G "funcionar√°" a pleno brillo, y el segmento C solo tendr√° un poco de tiempo para encenderse durante los mismos 150 microsegundos.  Tenemos dos casi completos.  Por lo tanto, logr√© romper la regla que yo mismo establec√≠.  Lo que no se puede hacer desde la desesperanza. <br><br>  Entonces, encendimos la figura con las cuatro patas del MK.  En realidad, me perd√≠ esta etapa por m√≠ mismo, inmediatamente mostr√© dos personajes.  Para hacer esto, desconecte la salida del √°nodo com√∫n de uno de los bits indicadores del power plus, y conecte a otra salida MK, y el √°nodo de la otra descarga a la siguiente salida (6 patas ya).  Ahora, a su vez, establezca 1 en el √°nodo del d√≠gito menos significativo, muestre el d√≠gito del d√≠gito menos significativo, luego 1 en el √°nodo del d√≠gito menos significativo, y muestre el d√≠gito del d√≠gito m√°s alto, y as√≠ sucesivamente en un c√≠rculo.  Realic√© este experimento con Arduino Nano, ella tiene suficientes piernas.  Todo el c√≥digo fue depurado, no la primera vez.  Y as√≠ funcion√≥, como deber√≠a. <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m6/5t/jp/m65tjptj6-dkubdfrmwlxup9olm.jpeg" alt="imagen"><br></div></div><br>  Dado que los √°nodos est√°n conectados a su vez, con la ayuda de un refinamiento simple, se puede liberar una salida m√°s del MK.  Aqu√≠ est√° el diagrama de resumen: <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/xe/zc/8exezcoas6flcayfpbvdeenevdm.jpeg" alt="imagen"><br></div></div><br>  Total use 5 patas MK para mostrar un n√∫mero de dos d√≠gitos.  En esta etapa, ya puedes probar con el beb√© ATtiny.  Lo cual hice.  Pero no de inmediato.  Un boceto compilado en un entorno Arduino para ATtiny13 ocupaba aproximadamente 1.7 kB de memoria con 1 kB disponible.  Para reducir el tama√±o, tuve que recurrir a los puertos directamente, lo que iba a hacer m√°s tarde.  Por cierto, en Arduino us√© los mismos puertos que iba a usar en ATtiny, es muy conveniente.  Ya est√°n indicados en el √∫ltimo diagrama.  Despu√©s del procesamiento, el c√≥digo perdi√≥ un kilobyte. <br><br>  Aqu√≠ est√° el c√≥digo resultante para ATtiny13: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 150) { //    150     1 d_ = 0; disp_ = disp_ + 1; if (disp_ &gt; 99)(disp_ = 0); //   0  99 } in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  El c√≥digo anterior permitir√° que su ATtiny13 lea de 0 a 99. Ser√≠a m√°s correcto proporcionar la posibilidad de reasignar las patas MK.  Los gur√∫s de programaci√≥n podr√≠an reducir el c√≥digo varias veces ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øD√≥nde est√° el l√≠mite m√≠nimo de Hello World en AVR?</a> ). <br><br>  Puede agregar la funci√≥n necesaria al c√≥digo para que MK muestre algo consciente.  Es cierto que Tinki ya tiene todas sus piernas ocupadas.  Tambi√©n hay un tramo de reinicio que se puede usar como puerto de entrada / salida.  Pero usarlo fue m√°s dif√≠cil de lo que pensaba.  Por lo tanto, para m√≠ me voy "para despu√©s".  Pero hay una caracter√≠stica interesante que no todos conocen.  La entrada anal√≥gica ADC0 sale al mismo tramo, ¬°y funciona!  Es cierto que cuando el voltaje es inferior a 1/4 del voltaje de suministro, el MK entra en modo de reinicio.  Pero desde 1/4 hasta el voltaje de suministro, es bastante posible medir el voltaje de entrada.  Aprovech√© esto: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 50) { //   50 ... d_ = 0; disp_ = analogRead(A0) / 10; // ...   ,   10,    . if (disp_ &gt; 99)(disp_ = 99); in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  La experiencia muestra que el indicador puede reducirse hasta 21, solo entonces el MK entra en modo de reinicio y comienza a funcionar cuando vuelve a aproximadamente 25 o m√°s.  Por lo tanto, es posible hacer un "indicador" muy incorrecto para indicar el voltaje de 25 a 99 voltios, por supuesto, con un divisor en la entrada de medici√≥n. <br><br>  Ahora sobre la aplicaci√≥n pr√°ctica.  La idea original de mostrar datos de un sensor de distancia se pospuso hasta tiempos mejores debido a la falta de una entrada digital.  ¬øPor qu√© si no puedes aplicar el esquema hasta que surjan ideas?  Otra advertencia: no puede haber ninguna cuesti√≥n de rentabilidad.  Incluso si paga todos los segmentos, una corriente de 2.5 mA fluir√° a trav√©s de la resistencia R2 (seg√∫n el primer esquema), en total 10 mA al indicador, m√°s el control del transistor agrega aproximadamente 5 m√°s.  No mencion√©, el transistor de casi cualquier pnp es moderno. <br><br>  Sobre conveniencia.  La opci√≥n m√°s barata para enviar al segmento siete es ATtiny13 m√°s 74HC595.  Dos casos de SMD me costar√°n aproximadamente 0,50 pies c√∫bicos  El m√°s simple es ATmega8 (y eso es todo, sin resistencias, nada m√°s), es 0.68 pies c√∫bicos  Y la opci√≥n descrita anteriormente es el costo de ATtiny, 9 resistencias, 4 LED, un transistor (todos SMD): esto es aproximadamente 0.46 pies c√∫bicos, aunque es pieza por pieza, todo es m√°s costoso a veces.  Adem√°s, poner todo junto es m√°s complicado que en las versiones anteriores. <br><br>  En realidad, la √∫nica opci√≥n que puedo ver es si tienes un ATtiny13 completo, pero a√∫n necesitas ir a la tienda por ATmega.  Bueno, si un indicador de siete segmentos es la decoraci√≥n principal de su dispositivo, no recomendar√≠a este esquema, la pantalla no es perfecta, en algunas combinaciones los segmentos innecesarios est√°n ligeramente resaltados.  Sucede que la indicaci√≥n es ocasionalmente necesaria cuando se configura, luego el lugar en s√≠. <br><br>  En general, pas√© unos d√≠as en vano. <br><br>  Adem√°s de las cr√≠ticas, estoy esperando sugerencias para mejorar el c√≥digo y simplificar el esquema.  O funcionalidad mejorada sin complicaciones.  Lo que m√°s me interesa es c√≥mo iluminar un punto, esto ampliar√≠a el alcance.  Pero si tambi√©n pudi√©ramos publicar una conclusi√≥n de los 5 involucrados, entonces ser√≠a posible deambular. <br><br>  Me alegrar√≠a si mi soluci√≥n no est√°ndar beneficiar√° a alguien, no ahora, alg√∫n d√≠a. <br><br><blockquote>  UPD: ¬°S√© sobre Charliplexing!  El esquema de terceros que cit√© al comienzo de este art√≠culo es Charliplexing.  Y all√≠ escrib√≠ por qu√© Charliplexing no es adecuado. <br>  No escriba comentarios si lee el art√≠culo en diagonal. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446796/">https://habr.com/ru/post/446796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446782/index.html">Yo-ho-ho y una botella de ron</a></li>
<li><a href="../446786/index.html">¬øPor qu√© rechac√© Disqus y t√∫ tambi√©n deber√≠as ir?</a></li>
<li><a href="../446788/index.html">Consejos y trucos de Kubernetes: sobre desarrollo local y telepresencia</a></li>
<li><a href="../446790/index.html">C√≥mo descubr√≠ un huevo de pascua en la seguridad de Android y no consegu√≠ un trabajo en Google</a></li>
<li><a href="../446794/index.html">Trabajamos con Wordstat correctamente. Gu√≠a completa</a></li>
<li><a href="../446798/index.html">La partida de un ingeniero electr√≥nico de Apple caus√≥ revuelo entre los especuladores burs√°tiles. ¬øC√≥mo llegar a ser como √©l?</a></li>
<li><a href="../446802/index.html">Recarga de cartuchos de puntos: es interesante</a></li>
<li><a href="../446806/index.html">Antecedentes: "Runet aut√≥nomo": qu√© es y qui√©n lo necesita</a></li>
<li><a href="../446808/index.html">Mi compilador para Lisp</a></li>
<li><a href="../446810/index.html">Si tienes un paquete de cigarrillos en el bolsillo ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>