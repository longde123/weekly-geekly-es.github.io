<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👟 🖖🏻 🈁 Pembelajaran Mesin untuk Vertica 🔌 🏇🏻 🧑🏿‍🤝‍🧑🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anotasi 
 Pada artikel ini saya ingin berbagi pengalaman saya sendiri dengan pembelajaran mesin di gudang data di Vertica. 

 Sejujurnya, saya bukan a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pembelajaran Mesin untuk Vertica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436306/"><h2>  Anotasi </h2><br>  Pada artikel ini saya ingin berbagi pengalaman saya sendiri dengan pembelajaran mesin di gudang data di Vertica. <br><br>  Sejujurnya, saya bukan analis ahli yang dapat menjelaskan secara rinci berbagai metode penelitian dan algoritma prediksi data.  Namun tetap, sebagai ahli Vertica dan memiliki pengalaman dasar dengan ML, saya akan mencoba berbicara tentang cara-cara bekerja dengan analisis prediktif di Vertica menggunakan fungsionalitas server bawaan dan bahasa R. <br><br><h2>  Perpustakaan Pembelajaran Mesin Vertica </h2><br>  Dimulai dengan versi 7, Vertica telah diperluas dengan perpustakaan Machine Learning, yang dengannya Anda dapat: <br><br><ul><li>  Siapkan contoh data untuk pembelajaran mesin </li><li> melatih model pembelajaran mesin pada data yang disiapkan; </li><li>  melakukan analisis prediksi data penyimpanan pada model pembelajaran mesin yang disimpan. </li></ul><br>  Perpustakaan segera hadir dengan instalasi Vertica untuk semua versi, termasuk Komunitas gratis.  Bekerja dengannya dibingkai dalam bentuk panggilan ke fungsi dari bawah SQL, yang dijelaskan secara rinci dalam dokumentasi dengan contoh penggunaan pada data demo yang disiapkan. <br><a name="habracut"></a><br><h2>  Contoh bekerja dengan ML di Vertica </h2><br>  Sebagai contoh sederhana tentang cara kerja ML, saya mengambil data demo mtcars yang merupakan bagian dari contoh data ML untuk Vertica.  Data ini mencakup dua tabel: <br><br><ul><li>  mtcars_train - data disiapkan untuk model pembelajaran mesin pelatihan </li><li>  mtcars - data untuk analisis </li></ul><br>  Mari kita lihat data untuk pelatihan: <br><br><pre><code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars_train;</code> </pre> <br><img src="https://habrastorage.org/webt/mu/4_/o0/mu4_o0ovpeupz4c3qkf1uvnegya.jpeg"><br><br>  Dalam kumpulan data pada model mobil, karakteristiknya dijelaskan.  Mari kita coba latih pembelajaran mesin sehingga sesuai dengan karakteristik mobil, dimungkinkan untuk memprediksi jenis gearbox mana yang terlibat dalam mobil - kotak manual atau gearbox otomatis.  Untuk melakukan ini, kita perlu membangun model regresi logistik pada data yang disiapkan, menemukan ketergantungan tipe kotak bidang "am" dan bidang berat kendaraan "wt", jumlah silinder "cyl" dan jumlah kecepatan dalam kotak "gear": <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> LOGISTIC_REG(<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>, <span class="hljs-string"><span class="hljs-string">'mtcars_train'</span></span>, <span class="hljs-string"><span class="hljs-string">'am'</span></span>, <span class="hljs-string"><span class="hljs-string">'cyl, wt, gear'</span></span>); Finished in 19 iterations</code> </pre> <br>  Fungsi yang dipanggil menganalisis hubungan antara am dan bidang cyl, wt, gear, mengungkapkan rumus dependensi dan menulis hasil simulasi ketergantungan dalam database Vertica dalam model “logistic_reg_mtcars”.  Dengan menggunakan model yang disimpan ini, Anda sekarang dapat menganalisis data pada mobil dan memprediksi ketersediaan gearbox otomatis. <br><br>  Informasi tentang model dapat dilihat: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> GET_MODEL_SUMMARY(<span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> model_name=<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>);</code> </pre> <br><img src="https://habrastorage.org/webt/hd/aj/gp/hdajgpkb3a4jvlq2-czafzt9mv0.jpeg"><br><br>  Sekarang kita menggunakan model pada data untuk mobil, menyimpan hasilnya dalam tabel baru: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> mtcars_predict_results <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> car_model, am, PREDICT_LOGISTIC_REG(cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> model_name=<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prediction</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars );</code> </pre> <br>  Dan membandingkan nilai riil am dengan yang diperoleh dalam prediksi prediksi: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars_predict_results;</code> </pre> <br><img src="https://habrastorage.org/webt/48/rt/zh/48rtzhy3c4ahjfqrupulpfy_mqy.jpeg"><br><br>  Dalam hal ini, perkiraan untuk 100% bertepatan dengan jenis kotak asli dalam model yang disajikan.  Dalam hal mempersiapkan data baru untuk pelatihan, Anda harus menghapus dan menyimpan kembali model. <br><br><h2>  Fungsionalitas ML di Vertica </h2><br>  Pustaka Vertica ML mendukung jenis analisis prediktif berikut: <br><br><ul><li>  <b>Peramalan:</b> <br><ul><li>  Regresi linier </li><li>  Hutan acak untuk regresi </li><li>  SVM (Support Vector Machine) untuk Regresi </li></ul></li><li>  <b>Klasifikasi:</b> <br><ul><li>  Regresi logistik </li><li>  Teluk naif </li><li>  Hutan Acak untuk Klasifikasi </li><li>  SVM (Support Vector Machine) untuk Klasifikasi </li></ul></li><li>  <b>Pengelompokan:</b> <br><ul><li>  k-means </li></ul></li></ul><br>  Untuk menyiapkan data untuk pelatihan, fungsionalitas berikut ini disajikan: <br><br><ul><li>  Penyeimbangan data </li><li>  Pembersihan emisi </li><li>  Pengkodean nilai-nilai kategorikal (tekstual) </li><li>  Mengganti Data yang Hilang </li><li>  Normalisasi data </li><li>  Analisis komponen utama </li><li>  Pengambilan sampel data </li><li>  Dekomposisi nilai singular </li></ul><br>  Mempertimbangkan fungsi ML di Vertica, kita dapat mengatakan bahwa perpustakaan bawaan memungkinkan kita untuk memecahkan berbagai masalah yang cukup luas, tetapi tidak memiliki jaminan simpanan untuk mempelajari pola dan dependensi dalam data.  Ada beberapa fungsi untuk menyiapkan data untuk pembelajaran mesin, tetapi tanpa memvisualisasikan distribusi data dalam bentuk grafik, hanya pakar analisis dengan pengetahuan ahli tentang data yang dianalisis yang dapat "menyiapkan" data tersebut dan melatih model pembelajaran di atasnya. <br><br><h2>  R Studio dengan Vertica </h2><br>  Untuk analisis data prediksi yang lebih menyeluruh dan interaktif, bahasa R sangat sesuai, yang memiliki lingkungan visual untuk bekerja dengan data R Studio.  Keuntungan nyata menggunakan R dengan Vertica adalah: <br><br><ul><li>  interaktivitas lingkungan dengan kemampuan untuk menyelamatkan keadaan untuk analisis lebih lanjut setelah menjalankan selanjutnya; </li><li>  tampilan visual data dalam bentuk tabel dan grafik; </li><li>  Kekuatan bahasa R untuk bekerja dengan set data; </li><li>  berbagai algoritma analisis prediktif mirip dengan yang disajikan dalam Vertica ML. </li></ul><br>  Kerugian bekerja dengan R dengan data besar adalah persyaratan RAM, kecepatan bekerja dengan array data besar, dan kebutuhan untuk mengimpor dan mengekspor data Vertica.  Kekurangan ini tercakup oleh kemampuan untuk menanamkan fungsi R tertulis untuk eksekusi langsung pada sebuah cluster di Vertica, yang akan dijelaskan di bawah ini. <br><br><h2>  Pengantar kecil untuk R </h2><br>  Kami akan mereproduksi ramalan untuk kotak otomatis pada data Vertica menggunakan R. Agar tidak menakuti programmer yang tidak terbiasa dengan bahasa ini, saya akan melakukan kursus singkat tentang seorang pejuang muda R. <br><br>  Jadi, bahasa R adalah bahasa prosedural yang sama yang memiliki objek, kelas, dan fungsi. <br>  Objek dapat berupa kumpulan data (vektor, daftar, dataset ...), nilai (teks, angka, tanggal, waktu ...) atau fungsi.  Untuk tipe nilai, numerik, string, boolean, dan tanggal-waktu didukung.  Untuk dataset, penomoran array dimulai dari 1, bukan 0. <br><br>  Secara klasik, alih-alih "=" dalam R, operator penugasan "&lt;-" digunakan.  Meskipun tidak dilarang untuk menggunakan tugas ke sisi lain "-&gt;" dan bahkan yang biasa "=".  Operator "=" sendiri digunakan saat memanggil fungsi untuk menentukan parameter bernama. <br><br>  Alih-alih "."  "$" digunakan untuk mengakses bidang set data.  Titik bukanlah kata kunci dan digunakan dalam nama objek untuk meningkatkan keterbacaannya.  Dengan demikian, "my.data $ field" akan didekripsi sebagai array catatan dari bidang "lapangan" dari kumpulan data "my.data". <br><br>  Anda dapat menggunakan tanda kutip tunggal atau ganda untuk membingkai teks. <br><br>  <b>Yang paling penting:</b> R diarahkan untuk bekerja dengan set data.  Bahkan jika kode mengatakan "a &lt;-1", maka pastikan bahwa R di dalam dirinya percaya bahwa "a" adalah array dari 1 elemen.  Desain bahasa memungkinkan Anda untuk bekerja dengan kumpulan data seperti halnya variabel biasa: tambah dan kurangi, sambungkan dan putuskan, saring dengan pengukuran.  Cara termudah untuk membuat array yang mendaftarkan elemen-elemennya adalah dengan memanggil fungsi "c (elemen-elemen array yang dipisahkan oleh koma)".  Nama "c" tampaknya diambil sebagai kependekan dari Collection, tetapi saya tidak akan mengatakannya dengan pasti. <br><br><h2>  Memuat data dari DBMS ke R </h2><br>  Untuk menggunakan RDBMS melalui ODBC untuk R, Anda harus menginstal paket RODBC.  Itu dapat diinstal di R Studio pada tab paket atau menggunakan perintah R: <br><br><pre> <code class="plaintext hljs">install.packages('RODBC') library('RODBC')</code> </pre> <br><br>  Sekarang kita bisa bekerja dengan Vertica.  Kami membuat alias ODBC ke server dan mendapatkan data uji dan set data lengkap untuk mobil: <br><br><pre> <code class="plaintext hljs">#    Vertica con &lt;- odbcConnect(dsn='VerticaDSN') #    mtcars_train mtcars.train &lt;- sqlQuery(con, "SELECT * FROM public.mtcars_train") #    mtcars&lt;/b&gt; mtcars.data &lt;- sqlQuery(con, "SELECT * FROM public.mtcars") #   odbcClose(con)</code> </pre> <br>  Ketika memuat data dari sumber R untuk bidang tipe teks dan tanggal-waktu, milik mereka faktor secara otomatis ditetapkan.  Bidang "am" adalah tipe numerik dan R dianggap sebagai indikator numerik, dan bukan faktor, yang tidak akan memungkinkan untuk regresi logistik.  Karenanya, kami mengonversi bidang ini ke faktor numerik: <br><br><pre> <code class="plaintext hljs">mtcars.data$am = factor(mtcars.data$am) mtcars.train$am = factor(mtcars.train$am)</code> </pre> <br>  Di R Studio, nyaman untuk menonton data secara interaktif, membuat grafik analisis prediktif dan menulis kode dalam R dengan tips: <br><br> <a href=""><img src="https://habrastorage.org/webt/r2/ft/b8/r2ftb85rnjcmpiblxomwdiicr7k.jpeg"></a> <br><br><h2>  Membangun model dalam R </h2><br>  Kami akan membangun model regresi logistik di atas kumpulan data yang disiapkan untuk dimensi yang sama seperti di Vertica: <br><br><pre> <code class="plaintext hljs">mtcars.model &lt;- glm(formula = am ~ cyl + wt + gear, family = binomial(), data = mtcars.train)</code> </pre> <br>  <b>Penjelasan:</b> dalam bahasa R, rumus analisis prediktif ditunjukkan sebagai: <br><br><pre> <code class="plaintext hljs">&lt;  &gt;~&lt;   &gt;</code> </pre> <br><h2>  Analisis data model dalam R </h2><br>  Kami menginisialisasi set data yang dihasilkan, dengan mengambil dari mtcars semua catatan untuk bidang yang diperlukan: <br><br><pre> <code class="plaintext hljs">mtcars.result &lt;- data.frame(car_model = mtcars.data$car_model, am = mtcars.data$am, predict = 0)</code> </pre> <br>  Sekarang, berdasarkan model yang dibuat, Anda dapat melakukan analisis pada data itu sendiri: <br><br><pre> <code class="plaintext hljs">mtcars.result$predict &lt;- predict.glm(mtcars.model, newdata = subset(mtcars.data, select = c('cyl', 'wt', 'gear')), type = 'response' )</code> </pre> <br>  Hasil analisis dikembalikan ke bidang prediksi sebagai persentase dari probabilitas perkiraan.  Sederhanakan dengan analogi dengan Vertica dengan nilai 0 atau 1, dengan mempertimbangkan ramalan positif dengan probabilitas lebih dari 50%: <br><br><pre> <code class="plaintext hljs">mtcars.result$predict &lt;- ifelse(mtcars.result$predict &gt; 0.5, 1, 0)</code> </pre> <br>  Kami menghitung jumlah total rekaman yang bidang prediksi yang diprediksi tidak cocok dengan nilai sebenarnya di pagi: <br><br><pre> <code class="plaintext hljs">nrow(mtcars[mtcars.result$am != mtcars.result$predict, ])</code> </pre> <br>  R mengembalikan nol.  Dengan demikian, perkiraan tersebut menyatu pada semua model mobil, seperti pada ML Vertica. <br><br>  <b>Harap dicatat:</b> rekaman dari mtcars dikembalikan oleh filter (parameter pertama dalam tanda kurung siku) dengan semua kolom (parameter kedua dihilangkan setelah koma dalam tanda kurung kotak). <br><br><h2>  Menyimpan dan memuat data secara lokal di R </h2><br>  Setelah keluar dari R, studio menyarankan untuk menyimpan status semua objek agar dapat terus bekerja setelah restart.  Jika karena alasan tertentu Anda perlu menyimpan dan mengembalikan keadaan masing-masing objek, untuk fungsi khusus ini disediakan di R: <br><br><pre> <code class="plaintext hljs">#      save(mtcars.model, file = 'mtcars.model') #      load('mtcars.model')</code> </pre> <br><h2>  Menyimpan data dari R ke Vertica </h2><br>  Jika R Studio digunakan untuk menyiapkan data untuk pelatihan model ML Vertica, atau jika analisis dilakukan secara langsung di dalamnya, yang kemudian akan digunakan dalam database Vertica, set data R dapat ditulis ke tabel Vertica. <br><br>  Karena perpustakaan ODBC untuk R dirancang untuk OLTP RDBMSs, ia tidak dapat dengan benar menghasilkan kueri pembuatan tabel untuk Vertica.  Oleh karena itu, untuk berhasil merekam data, Anda harus secara manual membuat tabel yang diperlukan di Vertica menggunakan SQL, kumpulan bidang dan jenis yang bertepatan dengan set data yang dapat direkam R. <br><br>  Selanjutnya, proses perekaman itu sendiri terlihat sederhana (jangan lupa untuk membuka dan kemudian menutup koneksi con): <br><br><pre> <code class="plaintext hljs">sqlSave(con, mtcars.result, tablename = 'public.mtcars_result', append = TRUE, rownames = FALSE, colnames = FALSE)</code> </pre> <br><h2>  Menggunakan Vertica dengan R </h2><br>  Pekerjaan interaktif dengan data dalam R Studio sangat cocok untuk mode penelitian dan persiapan data.  Tapi itu benar-benar tidak cocok untuk analisis aliran data dan array besar dalam mode otomatis.  Salah satu opsi untuk skema analisis prediktif hybrid R dengan Vertica adalah persiapan data untuk pembelajaran R dan mengidentifikasi dependensi untuk membangun model.  Kemudian, dengan menggunakan fungsi ML yang dibangun ke dalam Vertica, model perkiraan untuk data yang disiapkan pada R dilatih dengan memperhitungkan ketergantungan variabel yang teridentifikasi. <br><br>  Ada opsi yang lebih fleksibel ketika semua kekuatan bahasa R digunakan langsung dari bawah Vertica.  Untuk ini, Vertica mengembangkan distribusi R dalam bentuk plug-in library yang memungkinkan Anda untuk menggunakan fungsi transformasi yang ditulis langsung dalam bahasa R. dalam pertanyaan SQL. Dokumentasi menjelaskan secara rinci pemasangan dukungan R untuk Vertica dan paket R tambahan yang diperlukan untuk operasi, jika ada. <br><br><h2>  Menyimpan Model R di Vertica </h2><br>  Untuk menggunakan model analisis yang sebelumnya disiapkan oleh R Studio dalam fungsi R yang berjalan di bawah Vertica, Anda harus menyimpannya di server Vertica.  Menyimpan secara lokal di setiap server cluster dengan file tidak nyaman atau dapat diandalkan, server baru dapat ditambahkan ke cluster, dan ketika mengubah model Anda harus ingat untuk menulis ulang semua file lagi. <br><br>  Cara yang paling mudah adalah dengan membuat serial model R menjadi teks dan menyimpan fungsi Vertica sebagai UDF, yang akan mengembalikan teks ini sebagai konstanta (jangan lupa untuk membuka dan kemudian menutup koneksi con): <br><br><pre> <code class="plaintext hljs">#     mtcars.model.text &lt;- rawToChar( serialize(mtcars.model, connection = NULL, ascii = TRUE)) #       Vertica # (     ) mtcars.func &lt;- paste0( "CREATE OR REPLACE FUNCTION public.MtCarsAnalizeModel() RETURN varchar(65000) AS BEGIN RETURN '", gsub("'", "''", mtcars.model.text), "'; END; GRANT EXECUTE ON FUNCTION public.MtCarsAnalizeModel() TO public;" ) #    Vertica sqlQuery(con, mtcars.func)</code> </pre> <br>  Metode yang diusulkan memungkinkan untuk menghindari pembatasan Vertica pada parameter yang ditransmisikan dalam fungsi transformasi, di mana hanya diperlukan pengalihan konstanta atau ekspresi dari konstanta.  Vertica UDF SQL mengkompilasi bukan sebagai fungsi, tetapi sebagai ekspresi yang dihitung, yaitu, ketika melewati parameter, alih-alih memanggil fungsi, teksnya (dalam hal ini konstanta) akan ditransfer, yang disimpan dalam kode di atas. <br><br>  Jika Anda mengubah model, Anda harus membuat ulang fungsinya di Vertica.  Masuk akal untuk membungkus kode ini dalam fungsi universal yang menghasilkan fungsi di Vertica dengan nama yang ditentukan dari model yang diteruskan. <br><br><h2>  Fungsi R untuk Vertica </h2><br>  Untuk menghubungkan fungsi R ke Vertica, Anda perlu menulis analisis data dan fungsi pendaftaran di Vertica. <br><br>  Fungsi bekerja dengan data dari bawah Vertica itu sendiri harus memiliki dua parameter: set data yang dihasilkan (seperti data.frame) dan parameter kerja (seperti daftar): <br><br><pre> <code class="plaintext hljs">MtCarsAnalize &lt;- function(data, parameters) { if ( is.null(parameters[['model']]) ) { stop("NULL value for model! Model cannot be NULL.") } else { model &lt;- unserialize(charToRaw(parameters[['model']])) } names(data) &lt;- c('car_model', 'cyl', 'wt', 'gear') result &lt;- data.frame(car_model = data$car_model, predict = 0) result$predict &lt;- predict.glm(model, newdata = subset(data, select = c('cyl', 'wt', 'gear')), type = 'response' ) result$predict &lt;- ifelse(result$predict &gt; 0.5, TRUE, FALSE) return(result) }</code> </pre> <br>  Dalam tubuh fungsi, diperiksa bahwa parameter model dilewatkan, teks yang diterjemahkan ke dalam bentuk biner dan deserialized ke objek model analisis.  Karena Vertica mentransfer nama bidangnya sendiri ke dataset untuk fungsi tersebut, nama bidang eksplisit ditetapkan ke dataset.  Berdasarkan data yang diperoleh, satu set hasil dibangun dengan nama model mesin dan prediksi nol.  Selanjutnya, perkiraan dibuat hanya menggunakan bidang yang diperlukan untuk analisis dari kumpulan data yang diperoleh.  Bidang prediksi set hasil diatur ke nilai Boolean (untuk perubahan dan bukan angka) dan hasilnya dikembalikan dari fungsi. <br><br>  Sekarang tinggal menjelaskan pendaftaran fungsi ini di Vertica: <br><br><pre> <code class="plaintext hljs">MtCarsAnalizeFactory &lt;- function() { list(name = MtCarsAnalize, udxtype = c("transform"), intype = c("varchar", "int", "float", "int"), outtype = c("varchar", "boolean"), outnames = c("car_model", "predict"), parametertypecallback=MtCarsAnalizeParameters) } MtCarsAnalizeParameters &lt;- function() { parameters &lt;- list(datatype = c("varchar"), length = 65000, scale = c("NA"), name = c("model")) return(parameters) }</code> </pre> <br>  Fungsi MtCarsAnalizeFactory menjelaskan nama fungsi yang digunakan untuk operasi, bidang untuk kumpulan data yang masuk dan keluar, dan fungsi kedua menjelaskan parameter yang dikirimkan "model".  Tipe bidang adalah tipe data Vertica.  Saat mentransfer dan mengembalikan data, Vertica secara otomatis mengonversi nilai ke tipe data yang diperlukan untuk bahasa R. Anda dapat melihat tabel kompatibilitas jenis dalam dokumentasi Vertica. <br><br>  Anda dapat menguji operasi fungsi tertulis untuk Vertica pada data yang diunggah ke R studio: <br><br><pre> <code class="plaintext hljs">test.data = subset(mtcars.data, select = c('car_model', 'cyl', 'wt', 'gear')) test.params = list(model = mtcars.model.text) test.result = MtCarsAnalize(test.data, test.params)</code> </pre> <br><h2>  Hubungkan pustaka fitur ke Vertica </h2><br>  Kami menyimpan semua fungsi di atas dalam satu file "mtcars_func.r" dan mengunggah file ini ke salah satu server dari cluster Vertica di "/ home / dbadmin". <br><br>  <b>Poin penting:</b> di R Studio, Anda perlu mengatur opsi untuk menyimpan terjemahan baris dalam file dalam mode Posix (LF).  Ini dapat dilakukan di opsi global, bagian Kode, tab Tabungan.  Jika Anda bekerja pada Windows, secara default file akan disimpan dengan carriage return dan tidak akan dapat diunggah ke Vertica. <br><br>  Kami terhubung ke server dari cluster Vertica, tempat kami menyimpan file dan memuat pustaka: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIBRARY</span></span> MtCarsLibs <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'/home/dbadmin/mtcars_func.r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-string"><span class="hljs-string">'R'</span></span>;</code> </pre> <br>  Sekarang dari perpustakaan ini Anda dapat mendaftarkan fungsi R: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> TRANSFORM <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> public.MtCarsAnalize <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-string"><span class="hljs-string">'R'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'MtCarsAnalizeFactory'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIBRARY</span></span> MtCarsLibs; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> TRANSFORM <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> public.MtCarsAnalize(<span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>;</code> </pre> <br><h2>  Panggil fungsi R di Vertica </h2><br>  Kami memanggil fungsi R, mengirimkannya teks model, yang sebelumnya disimpan sebagai fungsi UDF: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MtCarsAnalize(car_model, cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = public.MtCarsAnalizeModel()) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars;</code> </pre> <br><img src="https://habrastorage.org/webt/8a/om/ve/8aomvezlxe_-0n4gnyonxkr25om.jpeg"><br><br>  Dapat diverifikasi bahwa, seperti dalam kasus sebelumnya, perkiraannya adalah 100% konsisten dengan keadaan sebenarnya: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.*, p.predict, p.predict = c.am::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> valid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars c <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MtCarsAnalize(car_model, cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = public.MtCarsAnalizeModel()) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars ) p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.car_model = p.car_model</code> </pre> <br>  <b>Harap dicatat:</b> fungsi transformasi di Vertica mengembalikan kumpulan data mereka sendiri dari bidang dan catatan yang ditentukan dalam fungsi, namun mereka dapat digunakan dalam kueri jika dibungkus dalam subquery. <br><br>  Ketika fungsi R terhubung, Vertica menyalin kode sumber ke instalasinya, yang dikompilasi ke dalam kode mesin.  File sumber R yang diunggah ke server setelah terhubung ke perpustakaan tidak diperlukan untuk pekerjaan lebih lanjut.  Kecepatan fungsi yang mempertimbangkan kompilasi biner cukup tinggi untuk bekerja dengan array data yang besar, namun, perlu diingat bahwa semua operasi R dilakukan dalam memori dan ada risiko akan bertukar jika ada kekurangan memori OS untuk memenuhi kebutuhan Vertica dan R yang bekerja bersama. . <br><br>  Jika fungsi ini dipanggil pada partisi data yang ditentukan dalam PARTITION BY untuk OVER, maka Vertica memparalelkan eksekusi setiap partisi pada server cluster.  Dengan demikian, jika pabrikan masih ada di set data selain model mesin, Anda bisa menentukannya dalam PARTISI OLEH dan memparalelkan analisis untuk setiap pabrikan. <br><br><h2>  Peluang Pembelajaran Mesin Vertica Lainnya </h2><br>  Selain R, Vertica dapat mengembangkan fungsi transformasi sendiri di C, Java, dan Python.  Setiap bahasa memiliki nuansa dan fitur penulisan dan koneksi ke Vertica sendiri.  Bersama dengan ML-nya sendiri, semua ini memberi Vertica cadangan yang baik untuk analisis data prediktif. <br><br><h2>  Terima kasih dan tautan </h2><br>  Saya ingin mengucapkan terima kasih kepada teman dan kolega saya Vlad Malofeev dari Perm, yang memperkenalkan saya kepada R dan membantu saya mencari tahu di salah satu proyek bersama kami. <br><br>  Awalnya, dalam proyek di mana perkiraan dibuat pada kondisi sulit untuk masa depan menggunakan data dari tahun lalu, pengembang mencoba menggunakan SQL dan Java.  Hal ini menyebabkan kesulitan besar dalam mempertimbangkan kualitas sumber-sumber ini dan sangat memperlambat pengembangan proyek.  Vlad datang ke proyek dengan R, kami menghubungkan R ke Vertica, ia mengantarkan data ke studio dan semuanya berputar dan berbelok dengan indah segera.  Secara harfiah dalam beberapa minggu, semua yang berlangsung selama berbulan-bulan disapu, menyelamatkan proyek dari kode kompleks. <br><br>  Contoh data dengan mobil dapat diunduh dari repositori GIT: <br><br><pre> <code class="plaintext hljs">git clone https://github.com/vertica/Machine-Learning-Examples</code> </pre> <br>  dan unggah ke Vertica: <br><br><pre> <code class="plaintext hljs">/opt/vertica/bin/vsql -d &lt;name of your database&gt; -f load_ml_data.sql</code> </pre> <br>  Jika Anda ingin masuk lebih dalam ke ML dan belajar cara bekerja dengan R, saya sarankan buku dalam bahasa Rusia <b>"R in action."</b>  <b>Analisis dan visualisasi data dalam bahasa R. ”</b>  Ini ditulis dalam bahasa manusia yang sederhana dan mudah diakses dan cocok untuk pemula yang belum pernah mengalami pembelajaran mesin. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di sini</a> Anda dapat melihat informasi tentang menghubungkan perpustakaan R ke Vertica. <br><br>  Bagi mereka yang sudah mulai belajar dan menggunakan ML dengan Python, ada baiknya memperhatikan IDE Rodeo, ini adalah analog dari R Studio, karena tanpa analisis kualitas interaktif tidak mungkin.  Saya pikir semua yang dijelaskan dalam artikel ini di bawah R dengan cara yang sama dapat dikembangkan dengan Python, termasuk menyimpan model dalam fungsi UDF dan mengembangkan fungsi analisis untuk Vertica.  Jika Anda memeriksa, jangan lupa untuk berhenti berlangganan tentang hasil di komentar, saya akan berterima kasih atas informasinya. <br><br>  Terima kasih atas waktu Anda dan saya harap saya dapat menunjukkan kesederhanaan dan kemampuan luar biasa dari simbiosis R dan Vertica. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436306/">https://habr.com/ru/post/id436306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436296/index.html">eksplisit dalam detail</a></li>
<li><a href="../id436298/index.html">Gagasan dari meja: vinyl virtual</a></li>
<li><a href="../id436300/index.html">9 praktik keamanan teratas di Kubernetes</a></li>
<li><a href="../id436302/index.html">Pengalaman substitusi impor nyata menggunakan sistem penyimpanan AERODISK Rusia</a></li>
<li><a href="../id436304/index.html">Zimbra Collaboration Suite dan perjuangan melawan phishing</a></li>
<li><a href="../id436308/index.html">Rostelecom dapat menjadi perusahaan monopoli di pasar pusat data</a></li>
<li><a href="../id436310/index.html">Seperti yang dilakukan metrik Ivan, DevOps. Objek pengaruh</a></li>
<li><a href="../id436312/index.html">Sintesis pidato jaringan saraf menggunakan arsitektur Tacotron 2, atau "Dapatkan keselarasan atau mati coba"</a></li>
<li><a href="../id436314/index.html">Hotel robo-Jepang "menembak" setengah dari robot mereka karena masalah yang mereka buat</a></li>
<li><a href="../id436316/index.html">Bagaimana kartu pintar membantu mengarahkan proyek TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>