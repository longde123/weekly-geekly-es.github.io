<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∏ üéöÔ∏è üòº Mon client Dropbox √† ligne unique pour Linux üßôüèΩ üè§ ü§∏üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux parler de ma tentative de cr√©er un client Dropbox simple ligne pour Linux en utilisant uniquement des composants open source gratuits, y compr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mon client Dropbox √† ligne unique pour Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434460/">  Je veux parler de ma tentative de cr√©er un client Dropbox simple ligne pour Linux en utilisant uniquement des composants open source gratuits, y compris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rclone</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entr</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">systemd</a> . <br><br><h2>  Contexte </h2><br>  R√©cemment, le client propri√©taire Dropbox pour Linux a supprim√© la prise en charge de tous les syst√®mes de fichiers Linux sauf <i>ext4 non chiffr√©</i> .  Et mon r√©pertoire personnel est malheureusement crypt√©. <br><br>  D√©but d√©cembre, le client propri√©taire a cess√© de fonctionner.  Il s'est d√©connect√© et a sugg√©r√© de choisir un autre dossier de synchronisation dans le ¬´syst√®me de fichiers pris en charge¬ª. <br><a name="habracut"></a><br>  Soit dit en passant, j'utilise Ubuntu Bionic sur le Thinkpad t460s de deux ans. <br><br><h2>  Pourquoi ai-je besoin de Dropbox </h2><br>  J'utilise activement le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mode Org</a> : je prends des notes en texte brut et Dropbox cr√©e continuellement des copies de sauvegarde des notes tout en tapant. <br><br>  Si vous travaillez √©galement dans le domaine des infrastructures de stockage, mon cas d'utilisation est tr√®s similaire √† la ¬´r√©plication asynchrone √† ma√Ætre unique¬ª, c'est-√†-dire avec un ma√Ætre.  Toutes les entr√©es passent par mon Thinkpad, c'est le ma√Ætre.  Le dossier distant Dropbox n'est qu'une r√©plique en lecture seule, que j'√©mets parfois des demandes en lecture seule ou que j'utilise comme sauvegarde pour cr√©er un nouvel assistant lorsque l'actuel √©choue ou est vol√©. <br><br>  Cependant, cette configuration de r√©plication m'a sauv√© la vie plusieurs fois.  J'ai encore sous les yeux comment le Thinkpad a refus√© de d√©marrer lors de la session de deuxi√®me ann√©e.  Comme j'ai constamment r√©pliqu√© toutes les notes dans Dropbox, je n'ai perdu aucune donn√©e et j'ai pu voir les derni√®res notes sur le Macbook de ma m√®re.  Merci maman! <br><br><h2>  Tentatives infructueuses </h2><br>  Lorsque le client Dropbox a cess√© de fonctionner, je me suis concentr√© sur la recherche d'un autre client distant multifonctionnel similaire pour Linux.  En principe, cela ne me d√©range pas de passer √† un autre service, tel que Google Drive ou AWS S3.  Certaines des options sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">overGrive</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">insync</a> . <br><br>  Cependant, je suis arriv√© √† la conclusion que ces solutions sont trop fonctionnelles et <b>peu adapt√©es √† mon cas</b> . <br><br>  Par exemple, les clients essaient de <i>connecter un syst√®me de fichiers distant √† votre PC</i> .  Ils essaient tr√®s fort d'abstraire les syst√®mes de fichiers distants, les faisant ressembler √† des syst√®mes locaux.  En r√®gle g√©n√©rale, ils impl√©mentent la synchronisation bidirectionnelle, le mappage automatique des types de fichiers distants vers les types de fichiers Linux, etc. <br><br>  Je n'ai pas besoin de ce niveau d'abstraction.  Quelque chose de simple est n√©cessaire pour sauvegarder constamment des notes dans le cloud pendant que je tape.  De plus, les abstractions rendent difficile le r√©glage et le d√©bogage.  Sans oublier que la plupart de ces clients multifonctionnels sont propri√©taires. <br><br><h2>  rclone </h2><br>  Je suis tomb√© <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rclone</a></code> utilitaire <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rclone</a></code> , et j'ai imm√©diatement r√©alis√©: c'est exactement ce que je cherchais.  Un programme simple mais puissant.  Tr√®s similaire √† l'outil <code>rsync</code> , uniquement pour le stockage dans le cloud. <br><br>  Par exemple, <code>rclone</code> prend en charge la tol√©rance aux pannes (v√©rification d'int√©grit√©), dispose d'algorithmes de synchronisation efficaces, etc., tout en fournissant une <a href="">interface CRUD simple</a> pour interagir avec les services de stockage cloud populaires, notamment Amazon S3, Google Drive et Dropbox. <br><br>  La commande suivante synchronise le r√©pertoire de l' <code>org</code> distante avec le r√©pertoire local <code>/home/lpan/org</code> . <br><br><pre> <code class="bash hljs">ORG_DIR=/home/lpan/org REMOTE=dropbox rclone sync <span class="hljs-variable"><span class="hljs-variable">$ORG_DIR</span></span> <span class="hljs-variable"><span class="hljs-variable">$REMOTE</span></span>:org</code> </pre> <br><h2>  entr </h2><br>  L'utilitaire pour ex√©cuter les commandes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entr</a> utilise l'API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inotify</a> .  Essentiellement, il ex√©cute des commandes lors de la modification de fichiers sans <i>interroger le</i> syst√®me de fichiers. <br><br>  Un cas d'utilisation courant consiste √† <i>reconstruire un projet si l'un des fichiers source a chang√©</i> . <br><br>  <code>entr</code> prend une liste de chemins absolus depuis <code>stdin</code> puis ex√©cute la commande pass√©e en argument si l'un des fichiers observ√©s a chang√©. <br><br><pre> <code class="bash hljs">WORKDIR=/path/to/myproject find <span class="hljs-variable"><span class="hljs-variable">$WORKDIR</span></span> | grep <span class="hljs-string"><span class="hljs-string">"\.cpp$"</span></span> | entr make</code> </pre> <br><h2>  Script sur une seule ligne </h2><br>  Maintenant, nous avons <code>rclone</code> et <code>entr</code> .  Le script r√©sultant est tr√®s simple.  Permettez-moi de vous rappeler que mon cas d'utilisation pour Dropbox est tr√®s simple: il vous suffit de r√©pliquer en permanence les fichiers Org locaux lorsqu'ils changent.  Par cons√©quent, vous pouvez utiliser <code>entr</code> pour surveiller les fichiers et <code>rclone</code> pour ¬´synchroniser¬ª avec le stockage distant. <br><br>  Le script r√©sultant ( <code>/home/lpan/sync_dropbox.sh</code> ) est le suivant: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ORG_DIR=/home/lpan/org REMOTE=dropbox find $ORG_DIR | entr -r rclone sync -v $ORG_DIR $REMOTE:org</span></span></code> </pre> <br><h2>  Ex√©cutez le d√©mon </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un d√©mon</a> n'est qu'un programme informatique qui s'ex√©cute en arri√®re-plan.  Nous faisons de notre script un processus d'arri√®re-plan afin qu'il synchronise constamment les changements de fichiers locaux en arri√®re-plan avec le syst√®me de fichiers distant. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">systemd</a> fournit une interface pour contr√¥ler les processus d√©mon. <br><br>  J'ai cr√©√© le <i>service Dropbox</i> dans <code>~/.config/systemd/user/dropbox.service</code> . <br><br><pre> <code class="bash hljs">[Unit] Description=Dropbox Daemon [Service] ExecStart=/home/lpan/sync_dropbox.sh Restart=always [Install] WantedBy=default.target</code> </pre> <br>  Vous pouvez ensuite contr√¥ler le d√©mon √† l'aide des commandes suivantes: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># reload the service file systemctl --user daemon-reload # start the daemon systemctl --user start dropbox.service # start the daemon on login systemctl --user enable dropbox.service # inspect the status of the daemon systemctl --user status dropbox.service</span></span></code> </pre> <br><h2>  Conclusion </h2><br>  Dans cet article, nous avons expliqu√© comment appliquer la philosophie UNIX et utiliser un ensemble d'outils open source gratuits pour remplacer le client Dropbox propri√©taire et h√©rit√©.  Nous avons utilis√© <code>rclone</code> et <code>entr</code> .  J'ai √©galement montr√© comment faire de ce processus un d√©mon et le g√©rer avec <code>systemd</code> . <br><br>  Je veux vous rappeler que l'id√©e cl√© est la simplicit√©.  Nous voulons des solutions simples pour des t√¢ches simples.  Mon cas d'utilisation pour Dropbox est tr√®s simple.  Et c'est pourquoi un script sur une ligne est pr√©f√©rable √† l'utilisation d'un client cloud trop fonctionnel et propri√©taire. <br><br>  Merci beaucoup d'avoir lu!  J'esp√®re vraiment que vous appr√©cierez ce post.  Si vous connaissez la meilleure fa√ßon de faire de m√™me ou d'√©tendre le script pour un autre cas d'utilisation - faites le moi savoir dans les commentaires! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434460/">https://habr.com/ru/post/fr434460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434446/index.html">Pourquoi je n'aime pas y aller</a></li>
<li><a href="../fr434448/index.html">Nous couvrons les tests A / B avec des tests UI. Comment ne pas se perdre dans le code natif</a></li>
<li><a href="../fr434450/index.html">TeamLead Conf: ¬´Le MBA num√©rique n'est pas un camarade¬ª</a></li>
<li><a href="../fr434452/index.html">AXIS vs IDIS - la bataille des fabricants de vid√©osurveillance</a></li>
<li><a href="../fr434456/index.html">O√π avons-nous obtenu la bouteille?</a></li>
<li><a href="../fr434466/index.html">Ce qui d√©termine le co√ªt d'un vol dans la pratique</a></li>
<li><a href="../fr434468/index.html">Enregistrer le contenu vCenter Content Library</a></li>
<li><a href="../fr434470/index.html">Contr√¥leur d'oignon. Nous cassons les √©crans en plusieurs parties</a></li>
<li><a href="../fr434474/index.html">Chat vert sur le contenu de l'espace</a></li>
<li><a href="../fr434476/index.html">ChatOps dans GitLab sera accessible √† tous</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>