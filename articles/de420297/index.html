<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏼 👷 📴 Schritt-für-Schritt-Anleitung zum Wiederherstellen des Zugriffs auf Linux Amazon EC2-Instanzen beim Verlust einer PEM-Datei 🏉 🤟🏾 👨🏻‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn während der Erstellung der Linux-Instanz in AWS kein Schlüsselpaar (KeyPair) erstellt wurde, um über SSH darauf zuzugreifen, oder diese verloren ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schritt-für-Schritt-Anleitung zum Wiederherstellen des Zugriffs auf Linux Amazon EC2-Instanzen beim Verlust einer PEM-Datei</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420297/"> Wenn während der Erstellung der Linux-Instanz in AWS kein Schlüsselpaar (KeyPair) erstellt wurde, um über SSH darauf zuzugreifen, oder diese verloren gehen, müssen eine Reihe von Vorgängen ausgeführt werden, um Zugriff auf den Computer zu erhalten.  Sie können einer bereits ausgeführten Instanz über die AWS-Konsole keine Schlüssel hinzufügen.  Es gibt drei Möglichkeiten, den SSH-Zugriff auf eine Instanz wiederherzustellen. <br><br>  Am einfachsten ist es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Schlüssel mithilfe des Cloud-Init-Mechanismus</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">konfigurieren</a> (danke für den Hinweis von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Yusman</a> ).  Es funktioniert jedoch nicht, wenn die Rechte am Verzeichnis <code>/home</code> beschädigt sind oder die Distribution keine Cloud-Init-Anweisungen unterstützt. <br><br>  Die zweite Möglichkeit besteht darin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, ein Image</a> (Amazon Machine Image) aus einer vorhandenen Instanz zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erstellen</a> und anschließend eine neue darauf basierende Instanz mit einem Schlüssel zu starten.  Somit wird die vorhandene Maschine tatsächlich mit dem einzigen Unterschied geklont, dass es in der letzten Phase möglich ist, neue Schlüssel zu erstellen.  Das Erstellen eines Images kann für eine Instanz mit großen Festplatten lange dauern, und Sie müssen alle mit diesem Computer verbundenen Dienste neu konfigurieren.  Daher dauert diese Methode in den meisten Fällen länger. <br><br>  Die offiziellen Dokumente von Amazon beschreiben einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">anderen Weg</a> .  Sie können den Zugriff wiederherstellen und die Kosten für die Neukonfiguration von Diensten (im Vergleich zur zweiten Methode) minimieren, die an eine Instanz gebunden sind, auf die der Zugriff verloren geht.  Der Artikel enthält eine schrittweise Beschreibung. <br><a name="habracut"></a><br>  <i><b>Achtung!</b></i>  <i>Diese Methode funktioniert nur für Instanzen, die den Blockspeicher (Amazon Elastic Block Store) als Root-Gerät verwenden, und nicht für den lokalen Instanzspeicher (Amazon EC2 Instance Store).</i> <br><br>  Um herauszufinden, welchen Root-Gerätetyp Sie verwenden, öffnen Sie die Amazon EC2-Konsole, gehen Sie zu <b>Instanzen</b> , wählen Sie eine Instanz aus und überprüfen Sie den Wert des Parameters <b>Root-Gerätetyp</b> im Bedienfeld mit detaillierten Informationen. <br><br><div style="text-align:center;"><img alt="Instanz-Root-Gerätetyp" src="https://habrastorage.org/webt/fi/gt/_m/figt_m6allv6zvevj8qrlwrzqos.png"></div><br>  Wenn Ihre Maschine über <abbr title="Amazon Elastic Block Store">EBS</abbr> verfügt, ist diese Methode für Sie geeignet. <br><br><h3>  Schritt 1. Vorbereitung </h3><br>  Zuerst müssen Sie einige Informationen speichern, damit Sie nicht abgelenkt werden und nicht zu anderen Bildschirmen wechseln müssen (zumal dies sehr unpraktisch ist).  Alle Daten finden Sie in den detaillierten Informationen der Instanz (Sie wissen bereits, wie Sie dorthin gelangen).  Notieren Sie die folgenden Einstellungen: <br><br><ul><li>  Instanz-ID </li><li>  AMI ID </li><li>  EBS ID </li><li>  Root-Gerät </li><li>  Verfügbarkeitszone </li></ul><br>  Speichern <b>Sie</b> für eine in <abbr title="Virtuelle private Cloud von Amazon">VPC ausgeführte</abbr> Instanz den <b>VPC-ID-</b> Wert. <br><br>  Für <b>EC2-classic</b> : Wenn für eine Instanz eine elastische IP-Adresse ( <b>Elastic IP</b> ) erstellt wird, muss auch deren Wert gespeichert werden. <br><br><div style="text-align:center;"> <a href=""><img alt="Zu speichernde Instanzeinstellungen" src="https://habrastorage.org/webt/it/by/ga/itbygaladxipdfpdeywopgzb5mu.png"></a> </div>  <i>Klickbares Bild</i> <br><br>  Klicken Sie auf den Namen des <b>Root-Geräts,</b> um die Blockspeicher- <b>ID</b> ( <b>EBS-ID</b> ) <b>abzurufen</b> . <br><br><div style="text-align:center;"><img alt="EBS ID" src="https://habrastorage.org/webt/4c/lp/-q/4clp-q09-_rdn6h7y33b4g8ucw4.png"></div><br><br><h3>  Schritt 2. Erstellen einer temporären Instanz </h3><br>  Der nächste Schritt besteht darin, eine Instanz zu erstellen, mit der Sie die Schlüssel der ursprünglichen Instanz wiederherstellen.  Sie können diesen Schritt überspringen, wenn sich eine andere laufende Instanz in derselben Zone (Verfügbarkeitszone) wie die wiederhergestellte befindet und gleichzeitig mit demselben AMI oder der darauf befindlichen Version des Betriebssystems erstellt wurde, sodass Sie die Festplatte von der ursprünglichen Instanz und verbinden können Kopieren Sie SSH-Schlüssel darauf.  Wenn es keine solche Instanz gibt, gehen Sie folgendermaßen vor: <br><br><ul><li>  Gehen Sie zur EC2-Konsole (im Dashboard oder im Menü <b>Instanzen</b> ) und klicken Sie auf <b>Instanz starten</b> </li><li>  <b>Wählen Sie auf der</b> Auswahlseite AMI ( <b>Choose a Amazon Machine Image</b> ) diejenige aus, mit der die ursprüngliche Instanz erstellt wurde (Sie haben sie im ersten Schritt <b>notiert</b> - <b>AMI ID</b> ).  Wenn dieses AMI aus irgendeinem Grund nicht verfügbar ist, können Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Image</a> aus der ursprünglichen Instanz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erstellen</a> und verwenden oder den AMI-Typ auswählen, mit dem Sie die Root-Festplatte der wiederhergestellten Instanz verbinden können </li><li>  <b>Wählen</b> Sie auf der Seite <b>Instanztyp</b> auswählen den günstigsten verfügbaren Typ aus. </li><li>  <b>Geben Sie auf der</b> Seite Instanzdetails <b>konfigurieren</b> dieselbe <b>Verfügbarkeitszone</b> wie in unserer Instanz an.  Wenn es in VPC ausgeführt wird, wählen Sie dieselbe VPC im Element <b>Netzwerk aus</b> und geben Sie das Subnetz in dieser Zone an. <br><br><div style="text-align:center;"><img alt="Verfügbarkeitszone konfigurieren" src="https://habrastorage.org/webt/co/sf/q8/cosfq8fixautng3nvazmqvqcvqs.png"></div><br>  Die Einstellungen für die Netzwerkschnittstellen müssen jedoch nicht geändert werden. <br></li><li>  Auf der Seite <b>Speicher</b> hinzufügen sind keine Änderungen erforderlich. </li><li>  <b>Fügen</b> Sie auf der Seite "Tags" ( <b>Tags</b> hinzufügen) einen Namen für die temporäre Instanz hinzu, damit Sie die <b>Instanz-ID</b> und die <b>EBS-ID</b> leicht identifizieren und dann keine Zeit damit verbringen können, sie <b>abzustimmen</b> , da auf den Seiten, auf denen Sie bestimmen müssen, mit welcher Instanz oder welchem ​​Volume Sie arbeiten, im Titel Dieser Wert wird angezeigt. <br><br><div style="text-align:center;"><img alt="Name auf der Seite Tags hinzufügen" src="https://habrastorage.org/webt/o4/wb/fh/o4wbfhmxk3fiqjzn-f4h1qykbbe.png"></div><br></li><li>  Klicken Sie auf <b>Überprüfen und starten</b> und dann auf <b>Starten</b> </li><li>  Der letzte Schritt besteht darin, ein vorhandenes Schlüsselpaar auszuwählen oder ein neues zu erstellen.  Laden Sie die Schlüsseldatei (pem) herunter und vergessen Sie nicht, eine Sicherungskopie zu erstellen, damit nicht alle Vorgänge erneut ausgeführt werden müssen. <br><br><div style="text-align:center;"><img alt="KeyPair speichern" src="https://habrastorage.org/webt/lz/jj/qv/lzjjqvfv0wjnnr7neskb6uq9jew.png"></div></li><li>  Starten Sie die Instanz nach dem Speichern der Datei mit der Schaltfläche Instanzen starten </li></ul><br><br><h3>  Schritt 3. Verbinden der Root-Festplatte vom wiederhergestellten Computer mit einer temporären Instanz </h3><br>  Zuerst müssen Sie die Festplatte von der ursprünglichen Instanz trennen und mit einer temporären Instanz verbinden.  Da dies die Root-Festplatte ist, muss die ursprüngliche Instanz gestoppt werden, bevor die Verbindung getrennt werden kann. <br><br><ul><li>  Gehen Sie zur EC2-Konsole im Abschnitt <b>Instanzen</b> und wählen Sie die ursprüngliche Instanz aus (dies kann durch die zuvor aufgezeichnete <b>Instanz-ID</b> oder durch einen Namen bestimmt werden, der von dem Namen abweicht, den Sie beim Erstellen der temporären Instanz angegeben haben). <br><br><div style="text-align:center;"><img alt="Instanzstopp" src="https://habrastorage.org/webt/cf/nb/zt/cfnbztxp4mlphw5s16tqlzqjore.png"></div><br>  Weiter im Menü <b>Aktionen - Instanzstatus - Stopp</b> . <br><br>  <i><b>Achtung!</b></i>  <i>Wenn die Instanz gestoppt wird, werden alle Daten im lokalen Speicher (Amazon EC2 Instance Store) gelöscht.</i>  <i>Wenn Sie Daten zu solchen Volumes haben, sorgen Sie für deren Sicherheit, indem Sie sie gegebenenfalls dauerhaft speichern.</i> <br></li><li>  Wechseln Sie nach dem Stoppen der Instanz zum Abschnitt <b>Elastic Block Store - Volumes</b> und wählen Sie das Root-Volume der ursprünglichen Instanz aus.  Sie kann anhand der gespeicherten <b>Volume-ID</b> oder anhand von Informationen aus der Spalte <b>Anhangsinformationen ermittelt</b> werden, die den Namen der Instanz enthält. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8i/ce/ri/8icerixqy7088x9n8tutprj0dtq.png" alt="Laufwerk stumm schalten"></div><br>  Weiter im Menü <b>Aktionen - Lautstärke trennen</b> </li><li>  Verbinden Sie dieses Volume mit einer temporären Instanz.  Wählen Sie es dazu erneut aus und geben Sie dann im Menü <b>Aktionen - Volume</b> anhängen und im angezeigten Dialogfeld Ihre temporäre Instanz an. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/jh/sx/vqjhsx1mc-pwfdi1khqxeo4ceio.png" alt="Antriebsverbindung"></div><br>  Klicken Sie dann auf <b>Anhängen</b> .  Wenn die ursprüngliche Instanz über <b>AWS Marketplace AMI erstellt wurde</b> und der Abschnitt AWS Marketplace-Codes enthält, wird eine Fehlermeldung angezeigt, dass der Abschnitt nicht mit Codes mit der Arbeitsinstanz verbunden werden kann. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fm/ai/rb/fmairbibwjzh5aohbwori7qvnfs.png" alt="Fehler beim Verbinden des Laufwerks mit den AWS Marketplace-Codes"></div><br>  Stoppen Sie in diesem Fall unsere temporäre Instanz und wiederholen Sie die Schritte, um das Stammvolume der ursprünglichen Instanz mit der temporären Instanz zu verbinden.  Der zweite Versuch sollte erfolgreich sein. <br></li><li>  Sie sollten jetzt sehen, dass beide Laufwerke mit einer temporären Instanz verbunden sind. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jm/wp/km/jmwpkmco-z6kphxqxmpfxqr2g2m.png" alt="Beide Laufwerke sind mit einer temporären Instanz verbunden"></div></li><li>  Wenn Sie die Instanz gestoppt haben, führen Sie sie aus: <br><br><ul><li>  Gehen Sie zum Abschnitt <b>Instanzen</b> der Navigationsleiste. </li><li>  Wählen Sie eine temporäre Instanz </li><li>  Weiter im Menü <b>Aktionen - Instanzstatus - Start</b> . </li></ul><br></li></ul><br><h3>  Schritt 4. Vorbereiten der Schlüssel für die Verbindung mit der Instanz über SSH </h3><br>  Linux-Benutzer müssen keine zusätzlichen Schlüssel generieren.  Sie müssen dieser Datei nur Leseberechtigungen erteilen: <br><br> <code>chmod 400 my-keypair.pem</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Schlüsselvorbereitung, wenn Sie Windows ausführen</b> <div class="spoiler_text">  Um eine Verbindung zu einem Linux-Computer herzustellen, verwenden wir das Dienstprogramm PuTTY. Wenn Sie es nicht installiert haben, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">laden</a> Sie es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herunter</a> .  Um eine Verbindung über SSH <b>herzustellen</b> , benötigen Sie einen <b>ppk-Schlüssel</b> , während bei AWS der Schlüssel im <b>pem-</b> Format <b>gespeichert wurde</b> .  Gehen Sie wie folgt vor, um den Schlüssel zum gewünschten Format zu erhalten: <br><br><ul><li>  Öffnen Sie <b>PuTTYgen</b> (installiert mit PuTTY) </li><li>  Wählen Sie 2048 Bit in den RSA-Parametern <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qo/ha/hd/qohahd_138adlmeua2nwdn2h6nq.png" alt="RSA 2048 Bit"></div></li><li>  Laden Sie den gespeicherten PEM-Schlüssel herunter, indem Sie auf <b>Laden</b> klicken (Vorhandene private Schlüsseldatei laden). </li><li>  Geben Sie die Passphrase ( <b>Schlüsselpassphrase</b> ) an und bestätigen Sie sie ( <b>bestätigen Sie die Passphrase</b> ).  Dies ist nicht notwendig, aber sicherer.  Der einzige Unterschied besteht darin, dass Sie bei der Verbindung mit diesem Schlüssel immer aufgefordert werden, diesen Ausdruck einzugeben, um die Eingabe zu bestätigen </li><li>  Speichern Sie die Datei unter dem Namen, den Sie beim Erstellen des Schlüsselpaars ( <b>KeyPair</b> ) während der Erstellung der temporären Instanz angegeben haben (der Name stimmt mit dem Namen des <b>PEM-Schlüssels überein</b> ). </li></ul><br>  Der Schlüssel ist fertig. <br></div></div><br><br><h3>  Schritt 5. Stellen Sie über SSH eine Verbindung zu einer temporären Instanz her </h3><br>  Verbinden Sie Port 22 mit dem Schlüssel.  Der Benutzername hängt davon ab, mit welchem ​​AMI die Instanz erstellt wurde.  Sie haben es ganz am Anfang aufgeschrieben.  Folgende Benutzernamen sind möglich: <br><br><ul><li>  Amazon Linux 2 oder Amazon Linux AMI - ec2-Benutzer </li><li>  Centos AMI - Centos </li><li>  Debian AMI - Admin oder Root </li><li>  Fedora AMI - ec2-Benutzer oder Fedora </li><li>  RHEL AMI - ec2-Benutzer oder Root </li><li>  SUSE AMI - ec2-Benutzer oder Root </li><li>  Ubuntu AMI - Ubuntu </li><li>  Im Übrigen wenden Sie sich an Ihren AMI-Anbieter, wenn die Namen ec2-user und root nicht funktionieren </li></ul><br>  Der Hostname, zu dem Sie eine Verbindung <i>herstellen</i> möchten, lautet <i>user@aws-host.amazon.com</i> , wobei <i>user</i> der oben beschriebene Name ist, und <i>aws-host.amazon.com</i> die IP-Adresse Ihrer Instanz, die Sie auf der Registerkarte mit den detaillierten Informationen finden (Daraus haben Sie die Parameter ganz am Anfang gespeichert).  Der Parameter heißt <b>IPv4 Public IP</b> .  Bitte beachten Sie, dass wenn Sie <b>Elastic IP</b> nicht verwenden, die Instanz jedes Mal, wenn Sie sie starten, eine neue IP-Adresse hat. <br><br><div class="spoiler">  <b class="spoiler_title">Verbindungsanweisungen für Windows-Benutzer</b> <div class="spoiler_text"><ul><li>  Starten Sie PuTTY </li><li>  Im Feld <b>Hostname</b> hat die Adresse das Format <i>Benutzername @ IP-Adresse</i> <i><br><br></i> <div style="text-align:center;"><img src="https://habrastorage.org/webt/50/mo/sn/50mosnkqgxx0rsby9eihvqq7qb4.png" alt="Konfigurieren Sie PuTTY. Hostname"></div><br></li><li>  Gehen Sie zum Abschnitt <b>Verbindung - SSH -</b> Authentifizierung und laden Sie den <b>ppk-Schlüssel</b> herunter (Private Schlüsseldatei zur Authentifizierung). </li><li>  Klicken Sie auf <b>Öffnen</b> und stimmen Sie zu, dem Server zu vertrauen <br></li><li>  Wenn Sie beim Erstellen eines ppk-Schlüssels eine Passphrase angegeben haben, geben Sie diese ein, um die Eingabe zu bestätigen: <br><br><pre> <code class="bash hljs">Using username <span class="hljs-string"><span class="hljs-string">"ubuntu"</span></span>. Authenticating with public key <span class="hljs-string"><span class="hljs-string">"imported-openssh-key"</span></span> Passphrase <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-string"><span class="hljs-string">"imported-openssh-key"</span></span>:</code> </pre><br></li><li>  Sie befinden sich auf dem Server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hn/tp/r-/hntpr-ztewfqqfvkbv1sonlk_by.png" alt="Erfolgreiche Serveranmeldung"></div><br></li></ul><br></div></div><br><h3>  Schritt 6. Kopieren von Schlüsseln von einer temporären Instanz in das Original </h3><br>  Stellen Sie das Volume bereit, das Sie mit der temporären Instanz verbunden haben, damit Sie auf das Dateisystem zugreifen können. <br><br><div class="spoiler">  <b class="spoiler_title">Partition montieren</b> <div class="spoiler_text">  Wenn der Laufwerksname beispielsweise <code>/dev/sdf</code> (er kann in Ihrer Instanz anders aussehen), verwenden Sie die folgenden Vorgänge, um das Volume in <code>/mnt/tempvol</code> : <br><br><ul><li>  Bestimmen Sie die Partitionsnamen des zugeordneten Laufwerks: <br><br> <code>[user ~]$ <b>lsblk</b></code> <br> <br><pre> <code class="bash hljs">NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 10G 0 disk └─xvda1 202:1 0 10G 0 part / xvdf 202:80 0 10G 0 disk └─xvdf1 202:81 0 10G 0 part</code> </pre><br>  <code>/dev/xvda1</code> und <code>/dev/xvdf1</code> sind Festplattenpartitionen.  <code>/dev/xvdf1</code> hat keinen Einhängepunkt (MOUNTPOINT), daher ist dies die Festplattenpartition, die wir zuvor verbunden haben. <br></li><li>  Erstellen Sie ein temporäres Verzeichnis, um die Partition bereitzustellen: <br><br> <code>[user ~]$ <b>sudo mkdir /mnt/tempvol</b></code> </li> <li>  Hängen Sie die Partition in das erstellte Verzeichnis ein: <br><br> <code>[user ~]$ <b>sudo mount /dev/ <font color="#ff0000">xvdf1</font> /mnt/tempvol</b></code> <br> </li></ul><br></div></div><br>  Kopieren Sie die SSH-Schlüssel von der temporären Instanz auf die bereitgestellte Partition. <br><br>  <i><b>Achtung!</b></i>  <i>Verwenden Sie den in der Befehlszeile angegebenen Benutzernamen.</i>  <i>Dies ist erforderlich, da es trotz der Tatsache, dass Sie erfolgreich eine Verbindung mit einem Standardbenutzernamen hergestellt haben, der vom Betriebssystem abhängt (beschrieben in Schritt 5), im AMI von AWS Marketplace nach der Anmeldung möglicherweise anders sein kann.</i>  <i>Für AMI WordPress Certified by Bitnami lautet die Standardanmeldung für Ubuntu bei der Anmeldung über SSH <code>ubuntu</code> .</i>  <i>Der Benutzername nach dem Anmelden lautet jedoch <code>bitnami</code></i> <br><br><div class="spoiler">  <b class="spoiler_title">Schlüssel kopieren</b> <div class="spoiler_text">  Wenn der Benutzername beispielsweise <code>ubuntu</code> lautet, verwenden Sie den folgenden Befehl zum Kopieren: <br><br> <code>[user ~]$ <b>cp .ssh/authorized_keys /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b> <br></code> <br>  Wenn Sie nicht <code>/mnt/tempvol</code> , die Dateien in <code>/mnt/tempvol</code> zu bearbeiten, kopieren Sie die Dateien mit <code>sudo</code> und überprüfen Sie die Rechte, um sicherzustellen, dass Sie auf die ursprüngliche Instanz zugreifen können: <br><br><ul><li>  Überprüfen Sie die Dateiberechtigungen: <br><br> <code>[user ~]$ <b>sudo ls -l /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> <code>total 4</code> <br> <code>-rw------- 1 <font color="#ff0000">200</font> <font color="#ff0000">500</font> 392 Aug 15 00:06 authorized_keys</code> <br> <br>  Im Beispiel ist 200 die Benutzer-ID und 500 die Gruppen-ID. <br></li><li>  Starten Sie den Schlüsselkopierbefehl mit <code>sudo</code> : <br><br> <code>[user ~]$ <b>sudo cp .ssh/authorized_keys /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b> <br></code> <br></li><li>  Überprüfen Sie, ob sich die Berechtigungen für die Datei geändert haben: <br><br> <code>[user ~]$ <b>sudo ls -l /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> <br>  Wenn sich die Rechte geändert haben, stellen Sie sie wieder her: <br><br> <code>[user ~]$ <b>sudo chown <font color="#ff0000">200</font> : <font color="#ff0000">500</font> /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> </li></ul><br></div></div><br>  Hängen Sie den Abschnitt aus: <br><br> <code>[user ~]$ <b>sudo umount /mnt/tempvol</b></code> <br> <br><h3>  Schritt 7. Starten der Instanz mit wiederhergestelltem Zugriff über SSH </h3><br><ul><li>  Wählen Sie in der EC2-Konsole das Laufwerk aus, das Sie mit dem temporären Laufwerk verbunden haben, und im Menü: <b>Aktionen - Lautstärke trennen</b> .  Warten Sie, bis der Status der Festplatte <b>verfügbar ist</b> (Sie können die Informationen über die Schaltfläche Aktualisieren aktualisieren). <br><br>  <i>Denken Sie daran, die Instanz vorab zu beenden, wenn der Abschnitt AWS Marketplace-Codes enthält.</i> <br></li><li>  <b>Wechseln Sie</b> für dasselbe Laufwerk zum Menü <b>Aktionen - Lautstärke anhängen</b> </li><li>  Wählen Sie die ursprüngliche Instanz aus und geben Sie den Namen der Root-Festplatte an, die Sie zu Beginn aufgezeichnet haben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uq/u_/6o/uqu_6okxfqdxqk4e6tpcers5roc.png" alt="Antriebsverbindung"></div>  <i>Klickbares Bild</i> <br><br>  Klicken Sie auf <b>Anhängen</b> <br></li><li>  Instanz ausführen </li><li>  Für <b>EC2-classic</b> : Wenn <b>Elastic IP</b> für die ursprüngliche Instanz konfiguriert wurde, ordnen Sie sie erneut zu: <br><br><ul><li>  Gehen Sie zum Abschnitt <b>Elastic IP</b> der Navigationsleiste. </li><li>  Wählen Sie die <b>elastische IP-</b> Adresse aus, die Sie ganz am Anfang notiert haben </li><li>  Nächste <b>Aktionen - Zugeordnete Adresse</b> </li><li>  Wählen Sie die ursprüngliche Instanz- <b>ID aus</b> und klicken Sie auf <b>Zuordnen</b> </li></ul><br></li></ul><br><h3>  Schritt 8. Zugriffsprüfung </h3><br>  Stellen Sie mit dem generierten Schlüssel eine Verbindung zur wiederhergestellten Zugriffsinstanz her. <br><br>  <i>Wenn sich der Name des neuen Schlüsselpaars vom vorherigen unterscheidet, stellen Sie sicher, dass Sie eine Verbindung mit dem neuen privaten Schlüssel herstellen.</i> <br><br><h3>  Schritt 9. Die letzte Stufe </h3><br>  Wenn Sie eine neue temporäre Instanz erstellt haben, um alle Vorgänge auszuführen, und keine vorhandene verwendet haben, stoppen Sie sie, wenn Sie sie nicht mehr benötigen: <br><br><ul><li>  Gehen Sie zum Abschnitt <b>Instanzen</b> der Navigationsleiste. </li><li>  Wählen Sie eine temporäre Instanz </li><li>  Weiter im Menü <b>Aktionen - Instanzstatus - Beenden</b> </li></ul><br>  Auf diese Weise haben Sie wieder Zugriff auf die Linux Amazon EC2-Instanz erhalten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420297/">https://habr.com/ru/post/de420297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420285/index.html">MPRU, Umsatz und wie er sich auf Umsatz und Kundenbasisdynamik auswirkt</a></li>
<li><a href="../de420289/index.html">Wie wir die Tabellen in den Smartphone-Bildschirm einpassen und sie als Teil des Design-Systems vereinheitlichen</a></li>
<li><a href="../de420291/index.html">Spectre und Meltdown sind nicht mehr die gefährlichsten Angriffe auf Intel-CPUs. Forscher berichten über Anfälligkeit für Vorboten</a></li>
<li><a href="../de420293/index.html">33 Server mit zwei Einheiten, 13 TB RAM und 0,6 PT verteiltem Speicher - warum ist dies ein Minimum für proaktives UBA?</a></li>
<li><a href="../de420295/index.html">NeoQUEST-2018: der lang erwartete Cold Boot, wissenschaftliche Forschung und Gäste aus Nischni Nowgorod</a></li>
<li><a href="../de420299/index.html">Meine Lieblingsbeispiele für funktionale Programmierung in Kotlin</a></li>
<li><a href="../de420301/index.html">Indischer Premierminister Narendra Modi: Wir werden die Flagge des Landes 2022 an Bord der Gaganyan ins All schicken</a></li>
<li><a href="../de420303/index.html">Lastausgleich beim Parsen von Sites und Verbinden zusätzlicher Cloud-Ressourcen</a></li>
<li><a href="../de420305/index.html">Wie schreibe ich Programme an der Schnittstelle von mobiler Entwicklung und Algorithmen? Yandex Wettbewerb und Geschichten</a></li>
<li><a href="../de420307/index.html">5 CSS-Tricks, die Sie kennen sollten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>